<html>
<head>
<title>Building Shopping Cart for the User</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为用户构建购物车</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/building-shopping-cart-for-the-user-9f58e13aa3e3?source=collection_archive---------4-----------------------#2020-10-06">https://blog.devgenius.io/building-shopping-cart-for-the-user-9f58e13aa3e3?source=collection_archive---------4-----------------------#2020-10-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0228" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用普通JavaScript为用户动态创建购物车功能</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/365f739173480ff60ba561bf25aa4dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTOKOedx7vTY1hb9b23P_A.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">布鲁诺·凯尔泽在<a class="ae ks" href="https://unsplash.com/s/photos/shopping?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="74e8" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">每个购物者都需要一辆手推车</h1><p id="68de" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">对于Mod 3项目，我们的任务是使用JavaScript作为前端，Ruby Rails API作为后端服务器，构建一个单页面应用程序(SPA) <strong class="ln io"> </strong>。我和我的合伙人想出了建立一个销售PPE产品的<a class="ae ks" href="https://github.com/iannakim/Mod-3-Project" rel="noopener ugc nofollow" target="_blank">电子商务网站</a>的主意(我们现在比以往任何时候都更需要口罩，不是吗？😷).首先，我们绘制了领域模型，并提出了以下逻辑图，其中包含<em class="mh"> has_many、属于</em>和<em class="mh"> has_many_through </em>关系:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/11e27f6b1569ccb25bc859ba502ef348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzGtMCw_ypjdbCP8NVEfZg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">显示我的应用程序的6个模型的实体关系图</figcaption></figure><p id="9916" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">正如你所看到的，该应用程序旨在让用户实例化一个新的<strong class="ln io"/><strong class="ln io"/>购物车，这意味着它是一个一对一的关系<strong class="ln io"/>。这意味着<strong class="ln io"> </strong>当一个新用户创建一个账户时，我们的<em class="mh">后端</em>将会创建一个新的购物车，并且这个<strong class="ln io">购物车将会通过他们的user_id </strong>连接到那个特定的用户。很酷，不是吗？现在，当用户在任何其他时间重新登录时，我们不再需要为该用户创建新的购物车；我们可以简单地找到🔍我们后端上预先存在的购物车，并获取购物车对象。我们省去了制造成百上千个一次性手推车的麻烦。</p><h1 id="6879" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">让我们来分解一下:</h1><p id="d8a3" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我将展示如何从注册页面和登录页面检查和/或创建购物车的两种途径。这两个过程使用完全相同的函数。</p><h2 id="52b9" class="mo ku in bd kv mp mq dn kz mr ms dp ld lu mt mu lf ly mv mw lh mc mx my lj mz bi translated"><strong class="ak">从注册页面→ </strong></h2><p id="0f4b" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在注册表单上，我附加了一个事件监听器，它会触发<em class="mh"> handleSignUpForm </em>函数以及所有的用户输入。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="ab gu cl na"><img src="../Images/c09ff0ec2a259a6bccf0610f6e3783eb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*PCNDEYb4UCRaLgQ-isMmEg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">使用事件侦听器注册表单</figcaption></figure><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="4954" class="mo ku in nc b gy ng nh l ni nj">signUpForm.<strong class="nc io">addEventListener</strong>('submit', <strong class="nc io">handleSignUpForm</strong>)</span></pre><p id="e0ac" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated"><strong class="ln io"> handleSignUpForm </strong>根据用户的输入发出POST请求，如果请求成功，我们将返回一个新创建用户的普通旧Javascript对象(POJO)—<em class="mh">new user。</em></p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="43ce" class="mo ku in nc b gy ng nh l ni nj">let <strong class="nc io">handleSignUpForm</strong> = (event) =&gt; {<br/>  event.preventDefault()</span><span id="20d6" class="mo ku in nc b gy nk nh l ni nj">   let newName = event.target["fullname"].value<br/>   let newUsername = event.target["username"].value<br/>   let newStreet1 = event.target["street-1"].value<br/>   let newStreet2 = event.target["street-2"].value<br/>   let newCity = event.target["city"].value<br/>   let newZip = parseInt(event.target["zipcode"].value)<br/>   let newEmail = event.target["email"].value</span><span id="32b0" class="mo ku in nc b gy nk nh l ni nj">fetch(`http://localhost:3000/users`, {<br/>    method: "POST",<br/>    headers: {'Content-Type': 'application/json'},<br/>    body: JSON.stringify({</span><span id="2012" class="mo ku in nc b gy nk nh l ni nj">         name: newName,<br/>         username: newUsername,<br/>         street_address: newStreet1,<br/>         street_address_2: newStreet2,<br/>         city: newCity,<br/>         zip_code: newZip,<br/>         email: newEmail</span><span id="eece" class="mo ku in nc b gy nk nh l ni nj">    })<br/>})<br/>   .then(res =&gt; res.json())<br/>   .then((newUser) =&gt;{</span><span id="730b" class="mo ku in nc b gy nk nh l ni nj">       <strong class="nc io">checkIfCartExists(newUser)<br/></strong>       <strong class="nc io">currentUser = newUser </strong>//set newUser as global var currentUser</span><span id="7e8d" class="mo ku in nc b gy nk nh l ni nj">         renderLogoPage() <br/>      })<br/>    event.target.reset()<br/>}</span></pre><p id="0f63" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">一旦我得到了这个响应，我就可以调用<strong class="ln io"> checkIfCartExists() </strong>来查看在我们的后端是否已经存在该用户的购物车。</p><p id="b66d" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">(旁注:currentUser是一个全局变量，我用来存储当前用户注册或登录应用程序后的信息。这是我在这个单页面应用程序上解决Rails“会话”问题的方法)</p></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="9bd9" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated"><strong class="ln io"> checkIfCartExists() </strong>接受一个参数(用户)并在我们的POST请求主体中传递该用户id，以查看在我们的后端是否已经存在具有该<em class="mh">用户id </em>的购物车。<strong class="ln io">我们只需要user_id </strong>，因为每个购物车都是基于一个唯一的用户分配id创建的。</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="88a2" class="mo ku in nc b gy ng nh l ni nj">let <strong class="nc io">checkIfCartExists</strong> = (user) =&gt; {<br/>   let userLoggingIn = user</span><span id="9b29" class="mo ku in nc b gy nk nh l ni nj"> fetch("http://localhost:3000/findcart", {<br/>    method: "POST",<br/>    headers: {"content-type": "application/json"},<br/>    body: JSON.stringify({<br/>         <strong class="nc io">user_id: userLoggingIn.id<br/>    </strong>})<br/>})<br/>   .then(res =&gt; res.json())<br/>   .then(cart =&gt; {<br/>       <strong class="nc io">if(cart.id)</strong>{<br/>         console.log(cart, "cart already exists!")<br/>         <strong class="nc io">currentCart = cart; /</strong>/set cart as global var currentCart<br/>       } <br/>       <strong class="nc io">else</strong> {<br/>         <strong class="nc io">createCartForUser</strong>(userLoggingIn)<strong class="nc io"><br/>       </strong>}<br/>    })<br/>}</span></pre><h2 id="f3bb" class="mo ku in bd kv mp mq dn kz mr ms dp ld lu mt mu lf ly mv mw lh mc mx my lj mz bi translated">🚊在我们的Rails后端检查购物车:</h2><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="0433" class="mo ku in nc b gy ng nh l ni nj"><strong class="nc io">//carts.controller.rb</strong></span><span id="4c81" class="mo ku in nc b gy nk nh l ni nj">def findUserCart<br/>  @found_cart = Cart.find_by(user_id: params[:user_id])<br/>  if @found_cart<br/>    render json:<strong class="nc io"> @found_cart</strong><br/>  else<br/>    render json: {error: "The user has no cart"}<br/>  end<br/>end</span></pre><p id="27df" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">✅如果cart存在，由于有了全局变量，现在可以访问currentUser和currentCart对象。我还添加了一个控制台日志来帮助您在开发工具中检查cart对象。</p><p id="a1c3" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">⛔️如果购物车不存在，我们将调用checkIfCartExists()中的<strong class="ln io"> createCartForUser() </strong>为用户创建一个空购物车！</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="d492" class="mo ku in nc b gy ng nh l ni nj">let <strong class="nc io">createCartForUser</strong> = (user) =&gt; {<br/>   let userLoggingIn = user</span><span id="ee6f" class="mo ku in nc b gy nk nh l ni nj">fetch(`http://localhost:3000/cart`, {<br/>   method: "POST",<br/>   headers: {"content-type": "application/json"},<br/>   body: JSON.stringify({<br/>          <strong class="nc io">user_id: userLoggingIn.id<br/></strong>   })<br/>})<br/>   .then(res =&gt; res.json())<br/>   .then((cart) =&gt; {<br/>      console.log(cart, "cart created!")<br/>      <strong class="nc io">currentCart = cart;<br/></strong>  })<br/>}</span></pre><p id="6b52" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">新用户显然还没有购物车，必须通过<strong class="ln io"> createCartForUser() </strong>来实例化他们的购物车。但是这两个链接的函数几乎是即时的，在新用户提交表单后，你最终会在dev tools中看到消息“cart created”。</p><div class="kd ke kf kg gt ab cb"><figure class="ns kh nt nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/6cc8cec942699e788c857def1c3f5b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*qvT84qGRs18HHMQgKV7daQ.png"/></div></figure><figure class="ns kh ny nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/4b683ccefbbaeaa154e2fc0d91b17c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1668/format:webp/1*0t9o-pu39Mgr5yitDbNoXQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk nz di oa ob translated">新用户注册屏幕/内部开发工具</figcaption></figure></div><h2 id="eeda" class="mo ku in bd kv mp mq dn kz mr ms dp ld lu mt mu lf ly mv mw lh mc mx my lj mz bi translated">从登录页面→</h2><p id="2b4d" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">对于再次使用的用户来说，这个过程几乎完全相同。当用户填写登录表单时，我们传递用户名来验证该用户是否存在于我们的后端(我们没有在这个项目中实现密码认证)</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="39d3" class="mo ku in nc b gy ng nh l ni nj">logInForm.addEventListener("submit", <strong class="nc io">handleLoginForm</strong>)</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="ab gu cl na"><img src="../Images/12f91013a0fd5ac78a7a8d24e7496e3c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*W23jjhHCZahYaBNjmZBqaQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">具有事件监听器的登录页面</figcaption></figure><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="0e8e" class="mo ku in nc b gy ng nh l ni nj">let <strong class="nc io">handleLoginForm</strong> = (evt) =&gt; {<br/>   evt.preventDefault()<br/>   let userLoggingIn = evt.target["username"].value</span><span id="ae76" class="mo ku in nc b gy nk nh l ni nj">fetch("http://localhost:3000/login", {<br/>    method: "POST",<br/>    headers: {"content-type": "application/json"},<br/>    body: JSON.stringify({</span><span id="393a" class="mo ku in nc b gy nk nh l ni nj">           <strong class="nc io">username: userLoggingIn<br/></strong>    })<br/>})<br/>   .then(res =&gt; res.json())<br/>   .then(user =&gt; {<br/>       <strong class="nc io">if(user.id)</strong>{<br/>       console.log(user)<br/>       <strong class="nc io">currentUser = user;</strong><br/><strong class="nc io">       checkIfCartExists(currentUser)</strong></span><span id="025c" class="mo ku in nc b gy nk nh l ni nj">       renderLogoPage()<br/>      }<br/>     <strong class="nc io"> else</strong> {alert("Username Not Found. Please try again.")}</span><span id="cf78" class="mo ku in nc b gy nk nh l ni nj">})<br/>   evt.target.reset()<br/>}</span></pre><p id="136e" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">如果我们得到一个成功的响应(<em class="mh"> user.id </em>存在)，那么我们将这个用户对象传递给<strong class="ln io"> checkIfCartExists() </strong>并重复上面相同的过程。只有这一次，在你的开发工具将显示，你会看到控制台日志消息“购物车已经存在！”</p><div class="kd ke kf kg gt ab cb"><figure class="ns kh oc nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/fcab0f75d2642fd28d26cb57d9a8890a.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*ZowV68DQrvGHNOpeTdOaSA.png"/></div></figure><figure class="ns kh od nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/9bce492f70c84af5eef68212a3e8247d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1524/format:webp/1*7Jfh1z_jfBhUKey6l_FLMA.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk oe di of ob translated">返回用户/内部开发工具的登录屏幕</figcaption></figure></div></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="3dbe" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">通过这些简单的购物车功能，每个用户都可以拥有自己的购物车，现在我们可以使用他们唯一的cart_id来跟踪所有用户的购买情况！太棒了！😍</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="og oh l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">我们现在可以购物了！！资料来源:Giphy</figcaption></figure><p id="7be5" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated">各位编码快乐！🛍</p><h2 id="ec0a" class="mo ku in bd kv mp mq dn kz mr ms dp ld lu mt mu lf ly mv mw lh mc mx my lj mz bi translated">在我的<a class="ae ks" href="https://github.com/iannakim/Mod-3-Project" rel="noopener ugc nofollow" target="_blank"> Github页面</a>上随意查看剩余的代码！</h2></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><h1 id="81a3" class="kt ku in bd kv kw oi ky kz la oj lc ld jt ok ju lf jw ol jx lh jz om ka lj lk bi translated">号外的🍬</h1><p id="995f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">规划过程中的线框。(我用<a class="ae ks" href="http://Figma.com" rel="noopener ugc nofollow" target="_blank"> Figma </a>来设计这些线框)</p><div class="kd ke kf kg gt ab cb"><figure class="ns kh on nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/3f9d55a5764e1b45f2d0487998154ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*a4M8E332vrOHfu82EzPkQQ.png"/></div></figure><figure class="ns kh oo nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/a0b4c6d82d6bc9babb9b29c8b757a4ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*CQavG1OpehVAJzupl4VhnQ.png"/></div></figure><figure class="ns kh op nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/a38676081f83c7c69399d99257d77b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9IRV5sboSCAxGPDuW9Mlpg.png"/></div></figure></div><div class="ab cb"><figure class="ns kh oq nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/ad1a47853c091d96c0c9c5ea3a25c367.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*p0PIgCUC90UxjZ3xHVp2QA.png"/></div></figure><figure class="ns kh or nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/a35905171f95d728ea8b27bf990b7872.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*6PMBldf3Uae4UZMFqEDUeA.png"/></div></figure><figure class="ns kh os nu nv nw nx paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/74498614ed7dbb02437dd12ee968fe2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*sge3YdAVDEF8wen7kl_tVA.png"/></div></figure></div></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><h1 id="79c8" class="kt ku in bd kv kw oi ky kz la oj lc ld jt ok ju lf jw ol jx lh jz om ka lj lk bi translated">资源:</h1><ul class=""><li id="1fdf" class="ot ou in ln b lo lp lr ls lu ov ly ow mc ox mg oy oz pa pb bi translated"><strong class="ln io">线框化</strong> → <a class="ae ks" href="http://figma.com" rel="noopener ugc nofollow" target="_blank">图玛</a></li><li id="42c4" class="ot ou in ln b lo pc lr pd lu pe ly pf mc pg mg oy oz pa pb bi translated"><strong class="ln io">主页面</strong> <strong class="ln io">图片和海报模板</strong> → <a class="ae ks" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank"> canva </a></li><li id="5b52" class="ot ou in ln b lo pc lr pd lu pe ly pf mc pg mg oy oz pa pb bi translated"><strong class="ln io">领域模型ERD </strong> → <a class="ae ks" href="http://lucidchart.com" rel="noopener ugc nofollow" target="_blank"> lucidchart </a></li></ul><p id="6893" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu ml lw lx ly mm ma mb mc mn me mf mg ig bi translated"><em class="mh">安娜目前在熨斗学校参加纽约的软件工程沉浸式训练营。如果有任何问题，请随时通过</em><a class="ae ks" href="https://www.linkedin.com/in/problemsolveranna/" rel="noopener ugc nofollow" target="_blank"><em class="mh">LinkedIn</em></a><em class="mh">或msg联系我们，或者我们也可以聊聊食物和我们最喜欢的电视节目。⭐️ </em></p></div></div>    
</body>
</html>