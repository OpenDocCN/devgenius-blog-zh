<html>
<head>
<title>Maintainable JavaScript — Browser Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可维护的JavaScript —浏览器检测</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/maintainable-javascript-browser-detection-dc41213ff528?source=collection_archive---------7-----------------------#2020-10-13">https://blog.devgenius.io/maintainable-javascript-browser-detection-dc41213ff528?source=collection_archive---------7-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ef356f44204f8f5be4b997e654c6c320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uye-8p_xUiuwOtzW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@peyankov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Y .佩扬科夫</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d377" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果想继续使用代码，创建可维护的JavaScript代码很重要。</p><p id="9221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过查看如何检测浏览器来了解创建可维护的JavaScript代码的基础。</p><h1 id="5356" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">浏览器检测</h1><p id="e29c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">浏览器检测是一个棘手的话题。</p><p id="b5f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有完美的方法来检测实际的浏览器。</p><h1 id="f786" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用户代理检测</h1><p id="521b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">检测浏览器的一种方法是用户代理检测。</p><p id="f8ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">客户端或服务器可以查看用户代理字符串来确定发出请求的浏览器。</p><p id="bf1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">浏览器的用户代理字符串可以在<code class="fe me mf mg mh b">navigation.userAgent</code>属性中找到。</p><p id="adc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以考虑这样写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1f7e" class="mq lc iq mh b gy mr ms l mt mu">if (navigator.userAgent.includes("MSIE")) {<br/>  // ...<br/>} else {<br/>  // ...<br/>}</span></pre><p id="1921" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过使用用户代理字符串来检查Internet Explorer。</p><p id="b7f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">问题是解析用户代理字符串很困难。</p><p id="d636" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，浏览器之间互相复制以保持兼容性。</p><p id="c868" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着每个新浏览器的发布，我们需要更新用户代理检测代码。</p><p id="401f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这增加了我们的维护负担。</p><p id="8ed4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户代理字符串检查应该是检查正确操作过程的最后一种方法。</p><p id="97a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们检查用户代理字符串，那么我们应该只检查旧的浏览器。</p><p id="5c65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为新的浏览器可能有我们想要的新功能。</p><p id="2d61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">旧浏览器不会增加新功能。</p><h1 id="225b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">特征检测</h1><p id="3da6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查浏览器中是否存在我们想要的功能，而不是检查用户代理字符串。</p><p id="4a01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以检查属性。</p><p id="9fb0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="87dc" class="mq lc iq mh b gy mr ms l mt mu">if (typeof document.getElementById === 'function') {<br/>  // ...<br/>}</span></pre><p id="eeed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查<code class="fe me mf mg mh b">document.getElementById</code>是一个函数。</p><p id="b772" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就能确切地知道我们要找的东西是否存在。</p><p id="5a0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它不依赖于使用哪个浏览器的知识，只依赖于哪些功能可用。</p><p id="7e58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，很容易支持新的浏览器。</p><p id="a4a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果浏览器中没有提供我们想要的功能，我们应该提供一个逻辑后备。</p><p id="dc03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想使用更新的特性，那么我们必须对不同浏览器的实现进行不同种类的检查。</p><p id="096f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="65e5" class="mq lc iq mh b gy mr ms l mt mu">function setAnimation(callback) {<br/>  if (window.requestAnimationFrame) { <br/>    return requestAnimationFrame(callback);<br/>  } else if (window.mozRequestAnimationFrame) {<br/>    return mozRequestAnimationFrame(callback);<br/>  } else if (window.webkitRequestAnimationFrame) { <br/>    return webkitRequestAnimationFrame(callback);<br/>  } else if (window.oRequestAnimationFrame) { <br/>    return oRequestAnimationFrame(callback);<br/>  } else if (window.msRequestAnimationFrame) {<br/>    return msRequestAnimationFrame(callback);<br/>  } else {<br/>    return setTimeout(callback, 0);<br/>  }<br/>}</span></pre><p id="fdd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查每个浏览器对<code class="fe me mf mg mh b">requestAnimation</code>方法的实现。</p><p id="3592" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有可用的变体，那么我们使用<code class="fe me mf mg mh b">setTimeout</code>方法。</p><h1 id="65bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免特征推断</h1><p id="a9fa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该假设，如果一个特性可用，那么相关的特性也可用。</p><p id="85fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们不应该假设如果<code class="fe me mf mg mh b">document.getElementsByTagName()</code>存在，那么<code class="fe me mf mg mh b">document.getElementById()</code>也存在。</p><p id="d6ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也适用于任何其他种类的对象。</p><h1 id="bc15" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免浏览器推断</h1><p id="5598" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">此外，我们不应该根据给定的功能来推断浏览器。</p><p id="d6ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们不应该写这样的话:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a2d0" class="mq lc iq mh b gy mr ms l mt mu">if (document.all) {<br/>  //...<br/>} else {<br/>  //...<br/>}</span></pre><p id="1ab1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要推断is <code class="fe me mf mg mh b">document.all</code>存在，那么IE正在被使用。</p><p id="209c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码不等同于:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6a0f" class="mq lc iq mh b gy mr ms l mt mu">const isIE = navigator.userAgent.includes("MSIE");<br/>if (isIE) {<br/>  //...<br/>} else {<br/>  //...<br/>}</span></pre><p id="5333" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不能假设如果一个特性存在，那么我们的代码就运行在给定的浏览器上。</p><p id="564c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为该功能可以出现在其他浏览器中。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/ac07ed07e00182e0cfbb2b15e347e5a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o_Oir3_QRASZCmWu"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">约翰尼·马丁内斯在Unsplash<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></figcaption></figure><h1 id="4fb5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="526e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">浏览器检测是一个棘手的话题。</p><p id="5db7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户代理字符串检测不是很准确。</p><p id="d528" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们可以在使用这些功能之前检查它们是否存在。</p></div></div>    
</body>
</html>