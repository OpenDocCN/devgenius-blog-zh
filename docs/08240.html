<html>
<head>
<title>CORS — 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CORS——101</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/cors-101-72b462396deb?source=collection_archive---------11-----------------------#2022-05-29">https://blog.devgenius.io/cors-101-72b462396deb?source=collection_archive---------11-----------------------#2022-05-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2c8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博客是我们从零开始讨论 101 个<strong class="jm io"> </strong>概念的系列文章的一部分，读者的入门知识有限。这篇文章属于<strong class="jm io"> <em class="ki">中级</em> </strong>系列，因为它涉及对<strong class="jm io"> CORS(跨源资源共享)</strong>的理解——主要由浏览器使用，以允许资产/资源访问某些白名单域，以及来自同一域的调用。生产中不正确的 CORS 配置通常是跨域攻击的潜在目标。</p><p id="18b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">101 系列中的一些早期博客如下:</p><p id="3ba9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/circuit-breaker-pattern-101-be2d7fdb656"> <strong class="jm io">断路器 101 </strong> <br/> </a> <a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/priority-queues-101-40eb4f6f5ee9"> <strong class="jm io">优先级队列 101</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/api-101-773ec501b485"><strong class="jm io">API 101</strong></a><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/async-communication-101-b04d5c95333a"><strong class="jm io"><br/>异步通信 101</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/database-101-13d593ec4078"><strong class="jm io">数据库 101</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/database-design-101-7c019d69b97f"><strong class="jm io"/></a></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/a144b4a3bde91198dc739b24609cc112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*okHyS6CA_sH5jMYtpJrc-A.jpeg"/></div></div></figure><h1 id="4daf" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是 CORS？</h1><p id="834f" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">CORS 是一种安全协议，允许来自其他域的异步调用访问受<a class="ae kj" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">同源策略</strong> </a> <strong class="jm io"> </strong>限制的资源。用户会话中的<a class="ae kj" href="https://en.wikipedia.org/wiki/HTTP_cookie" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">浏览器 cookie</strong></a>由敏感的客户信息组成，这些信息可能被用来进行恶意攻击，因此需要一个定义良好的 CORS 策略是 UI 应用程序的一个关键要素。不建议使用允许来自<strong class="jm io"> <em class="ki">通配符域(*) </em> </strong>的呼叫的 CORS 策略，因此过滤和白名单方法始终是处理来自多个域的呼叫的安全方式。</p><h1 id="70d4" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如何确定原产地？</h1><p id="3f66" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">Origin 是发出原始请求的 URL，表示服务器或主机名。<strong class="jm io"> <em class="ki">请求头，URL 路径，查询参数</em> </strong>不构成源信息的一部分。可以根据<strong class="jm io"> <em class="ki">端口号、主机名和 http/https 方案来区分来源。</em> </strong></p><p id="ce71" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于起源，<strong class="jm io"><em class="ki"/></strong><a class="ae kj" href="https://mywebsite.com/path/example.html" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ki">【http://mywebsite.com/path/example.html】</em></strong></a>，以下分别视为不同的起源</p><h2 id="de94" class="lz kx in bd ky ma mb dn lc mc md dp lg jv me mf lk jz mg mh lo kd mi mj ls mk bi translated"><strong class="ak">不同的端口</strong></h2><p id="a035" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><a class="ae kj" href="http://mywebsite.com:81/path/example.html" rel="noopener ugc nofollow" target="_blank">http://mywebsite.com:81/path/example.htmlT21</a>。</p><h2 id="dcbd" class="lz kx in bd ky ma mb dn lc mc md dp lg jv me mf lk jz mg mh lo kd mi mj ls mk bi translated"><strong class="ak">不同的 HTTPS 方案</strong></h2><p id="a23b" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><a class="ae kj" href="https://mywebsite.com/path/example.html" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://mywebsite.com/path/example.html</em></a>。</p><h2 id="9db7" class="lz kx in bd ky ma mb dn lc mc md dp lg jv me mf lk jz mg mh lo kd mi mj ls mk bi translated"><strong class="ak">不同的服务器名称</strong></h2><p id="ba86" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><a class="ae kj" href="https://api.%20mywebsite.com/path/example.html" rel="noopener ugc nofollow" target="_blank"> <em class="ki"> https://api。mywebsite.com/path/example.html</em></a>。</p><h1 id="348b" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CORS 工作流程</h1><p id="88d6" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">根据原始请求中的元素，现代浏览器以不同的方式处理 CORS。具有客户报头的请求具有额外的飞行前检查，但是对于简单的请求，来源在单个客户端-服务器交换中被列入白名单。</p><h2 id="cd40" class="lz kx in bd ky ma mb dn lc mc md dp lg jv me mf lk jz mg mh lo kd mi mj ls mk bi translated">简单的请求</h2><p id="cb4a" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">遵循以下规则的请求被分类为简单请求-</p><ul class=""><li id="a214" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated"><strong class="jm io"> GET </strong>，<strong class="jm io"> POST </strong>和<strong class="jm io"> HEAD </strong>是<strong class="jm io"> HTTP </strong>方法。</li><li id="37da" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">内容类型</strong>是<strong class="jm io"> <em class="ki">应用程序/x-www-form-urlencoded、多部分/表单-数据、文本/普通</em> </strong>中的一种</li><li id="953f" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated">请求中不允许有自定义标头</li></ul><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mz"><img src="../Images/f6d64cd49a1a3d34bda98d45be04dcac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smIi556f2OqT6p_77cf_9A.jpeg"/></div></div></figure><p id="ad80" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在对简单请求的跨源调用的服务器响应中设置了以下标头</p><ul class=""><li id="e5d4" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated"><a class="ae kj" href="http://www.w3.org/TR/2012/WD-cors-20120403/#access-control-allow-origin-response-header" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">访问-控制-允许-起源</strong> </a>(必填)</li><li id="6fd5" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><a class="ae kj" href="http://www.w3.org/TR/2012/WD-cors-20120403/#access-control-allow-credentials-response-header" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">访问-控制-允许-凭证</strong> </a>(可选)</li><li id="b64e" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><a class="ae kj" href="http://www.w3.org/TR/2012/WD-cors-20120403/#access-control-expose-headers-response-header" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">访问-控制-暴露-标题</strong> </a>(可选)</li></ul><h2 id="275a" class="lz kx in bd ky ma mb dn lc mc md dp lg jv me mf lk jz mg mh lo kd mi mj ls mk bi translated">飞行前请求</h2><p id="b4df" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">具有比简单请求中预期的更多参数的请求需要以选项调用的形式进行额外的服务器验证。<strong class="jm io">选项</strong>用于从交叉源获取未来请求所需的所有有效响应头。</p><p id="6f95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下图是 ajax 调用发生的整体交换的简化版本</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi na"><img src="../Images/e9ef279fb3b13254bb63ad79941d1676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5W7ieuIN-xqa_9cWqhINg.jpeg"/></div></div></figure><p id="34e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在服务器对飞行前请求的跨原点调用的响应中设置了以下标题</p><ul class=""><li id="bc79" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated"><strong class="jm io">访问控制允许来源</strong>(必填)</li><li id="7607" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">访问控制允许方法</strong>(必填)</li><li id="22d1" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">Access-Control-Allow-Headers</strong>(如果使用自定义标题，则为必填项)</li><li id="b924" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">访问控制允许凭证</strong>(可选)</li><li id="3c9e" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">访问-控制-暴露-标题</strong>(可选)</li><li id="dd4e" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated"><strong class="jm io">访问控制最大年龄</strong>(可选)</li></ul><h1 id="4f84" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CORS 普通支票</h1><p id="5b7c" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">CORS 实施中的一些边缘情况经常表现为常见的可利用攻击，如下所示</p><ul class=""><li id="db62" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated">来自内部或本地环境的调用使用<strong class="jm io"> NULL </strong>作为其原点设置。建议不要将标题<strong class="jm io">的<strong class="jm io"> NULL </strong>列入白名单。</strong></li><li id="5d0f" class="ml mm in jm b jn mu jr mv jv mw jz mx kd my kh mq mr ms mt bi translated">为了处理来自内部网络中多个域的请求，一个<strong class="jm io">通配符(*) </strong>经常被替换为服务器的快捷方式。对于生产中的外部域，应该避免这种情况</li></ul><h1 id="5b30" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h1><p id="9071" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">我们讨论了<strong class="jm io">跨来源资源来源的基础知识，</strong>一种可以利用 XSS(跨站点脚本)的常见安全范例，<a class="ae kj" href="https://owasp.org/www-project-top-ten/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">十大 OWASP </strong> </a>攻击。实施 CORS 检查可以在整个架构的不同层实施，如<strong class="jm io"> L7 代理层</strong>或者后端服务器可以用于将来自可信来源的流量列入白名单。在本系列未来的高级博客中，我们可以使用一个实际的客户示例来讨论一些服务器端函数/库。</p><p id="59fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">如需反馈，请留言至</em><strong class="jm io"><em class="ki">Amit[dot]894[at]Gmail[dot]com</em></strong><em class="ki">或联系</em><a class="ae kj" href="https://about.me/amit_raj" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://about.me/amit_raj</em></a><em class="ki">的任何链接。</em></p></div></div>    
</body>
</html>