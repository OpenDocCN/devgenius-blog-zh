<html>
<head>
<title>Exploring Full-Text Search with Django/PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Django/PostgreSQL 探索全文搜索</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/exploring-full-text-search-with-django-postgresql-b59ac1a6054e?source=collection_archive---------3-----------------------#2022-02-21">https://blog.devgenius.io/exploring-full-text-search-with-django-postgresql-b59ac1a6054e?source=collection_archive---------3-----------------------#2022-02-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f09db7cb8cc2ca51d46ec30c6cd5db57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0VEn8Y7WtU3LDccU5zFEw.png"/></div></div></figure><p id="9b49" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个循序渐进的教程中，您将学习如何使用 PostgreSQL 数据库在 Django 应用程序中使用全文搜索。在本文结束时，您将对全文搜索在您的应用程序中的使用有一个透彻的理解。</p><p id="6d0d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文的要求是要很好的了解 Django 的 ORM 和 Queryset 函数。</p><h1 id="f353" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">什么是全文搜索？</h1><p id="58ef" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在我回答之前，让我问你一件事。文字处理器(MS Word，Notepad)中的查找和替换功能和 Google 中的搜索有什么区别？两者都在寻找，不同的是怎么做。谷歌把你的查询分解成不同的词，爬上每一个网站获取相关的结果，另一方面，查找替换把你的查询作为一个整体，在文本中搜索。前者是全文搜索。它分解查询并删除不必要的部分，如 in、or，然后返回最相关的结果。</p><h1 id="7f21" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">为什么要进行全文搜索？</h1><p id="8c40" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">让我们用一个真实的例子来理解全文搜索的必要性。假设我们有两个给定标题的帖子，用户在 python 中寻找 async。</p><h1 id="2953" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">我们应用程序中的帖子标题示例:</h1><p id="e27d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated"><code class="fe lw lx ly lz b">- Python also supports async function.<br/>- Async in python is amazing</code></p><p id="ddc1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用户在普通正则表达式搜索时只会得到第二篇文章，但是我们可以看到第一篇文章也与用户的查询相关。这就是我们在应用程序中需要全文搜索的原因。</p><h1 id="399c" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">全文搜索的功能</h1><ul class=""><li id="069d" class="ma mb in jx b jy lr kc ls kg mc kk md ko me ks mf mg mh mi bi translated">它要快得多。</li><li id="b5ca" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">结果是相关的。</li><li id="f266" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">更好的结果排名。</li></ul><h1 id="9209" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">在 Python/Django 中搜索</h1><p id="8500" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在深入研究全文搜索之前，我想快速回顾一下 SQLite 数据库搜索的正常工作方式。</p><p id="a2af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面您将找到获取样板文件的存储库。我和 django 一起创建了一个名为 core 的新项目，在那里我创建了一个名为 blog 的新应用。运行<code class="fe lw lx ly lz b">python manage.py migrate</code>之后，将这段代码添加到您的项目中。</p><p id="e480" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">blog/ <em class="mo"> models.py </em>存储博客文章内容和标题的新模型(表)。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="67a7" class="mx ku in lz b gy my mz l na nb">from django.db import models</span><span id="098a" class="mx ku in lz b gy nc mz l na nb"># Create your models here.<br/>class Post(models.Model):<br/> title = models.CharField(max_length=100)<br/> content = models.TextField()</span><span id="8666" class="mx ku in lz b gy nc mz l na nb">def __str__(self):<br/> return f”{self.title}”</span></pre><p id="f81c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">blog/admin.py 在管理站点中添加帖子模型以使用创建/读取/更新/删除操作。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="7c78" class="mx ku in lz b gy my mz l na nb">from django.contrib import admin<br/>from .models import Post</span><span id="47da" class="mx ku in lz b gy nc mz l na nb"># Register your models here.</span><span id="c5e4" class="mx ku in lz b gy nc mz l na nb">admin.site.register(Post)</span></pre><p id="8c14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">blog.views.py 添加主页视图以查看所有帖子</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="1065" class="mx ku in lz b gy my mz l na nb">from django.shortcuts import render<br/>from .models import Post</span><span id="8be0" class="mx ku in lz b gy nc mz l na nb">def home(request):<br/>    qs = Post.objects.all()<br/>    if request.GET.get('query'):<br/>        qs = qs.filter(title__icontains=query)<br/>    return render(request, "index.html", context={"queryset": qs})</span></pre><p id="09d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">core/urls.py 为主视图添加新的 URL。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="c14d" class="mx ku in lz b gy my mz l na nb">urlpatterns = [<br/>    path("admin/", admin.site.urls),<br/>    path("", views.home),<br/>]</span></pre><h1 id="5024" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">要搜索的模板</h1><p id="f51a" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">blog/templates/index.html 用于搜索和查看 queryset 中所有帖子的模板</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="d677" class="mx ku in lz b gy my mz l na nb">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;Full Text Search&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>      &lt;form&gt;<br/>           {% csrf_token %}<br/>          &lt;input type="text" name="query"&gt;<br/>          &lt;input type="submit" value="Search"&gt;<br/>    &lt;form/&gt;<br/>    {% for object in queryset %}<br/>    &lt;h2&gt;{{object.title}}&lt;/h2&gt;<br/>    &lt;p&gt;{{object.content | truncatechars:200}}&lt;/p&gt;<br/>    {% empty %}<br/>    &lt;h2&gt;No Results&lt;/h2&gt;<br/>    {% endfor %}<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="00c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将这些更改添加到项目中后，在提示符/终端中启动该命令。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="d8bf" class="mx ku in lz b gy my mz l na nb">python manage.py runserver</span></pre><p id="fa17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到<a class="ae nd" href="http://127.0.0.1:8000/admin/blog/post/" rel="noopener ugc nofollow" target="_blank">127 . 0 . 0 . 1:8000/admin/blog/post</a>并添加类似任何主题的任意五个帖子。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/c81ee71a170478ca90b769bc8b2b2f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_afz-0-BTN_mPL-Tzvg5_A.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">管理站点中的所有帖子</figcaption></figure><h1 id="ae2f" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">' title__icontains '如何工作。</h1><p id="9378" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我搜索机器人，查询集返回</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/55466755a169691110363a0c8f4c04f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*bctQkpdb_04dHS-o0oawzg.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">没有全文的搜索结果</figcaption></figure><p id="cf48" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是如果我搜索<code class="fe lw lx ly lz b">python bots</code></p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/9beb721463554d6879fae438f01f7c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*Kq7WWBjoOfWmXPJ1xAZnQA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">title__icontains 可以返回相关结果</figcaption></figure><p id="f772" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">没有结果，因为我在帖子的标题中没有具体的术语“python 机器人”。</p><p id="8be5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们用全文搜索来纠正这个错误。</p><h1 id="f902" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">Django 中如何使用 PostgreSQL？</h1><p id="8d08" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">全文只有在 PostgreSQL 这样的高级生产就绪数据库中才有可能。我们可以在 Django 应用程序中使用 PostgreSQL 数据库，方法是在本地下载数据库或使用在线数据库作为服务。在本教程中，我们将使用一个名为<a class="ae nd" href="https://www.elephantsql.com/" rel="noopener ugc nofollow" target="_blank">的服务，一个 PostgreSQL 服务。</a></p><p id="9b17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们必须遵循的步骤:</p><ul class=""><li id="3316" class="ma mb in jx b jy jz kc kd kg nl kk nm ko nn ks mf mg mh mi bi translated">创建远程 PostgreSQL 数据库</li><li id="5f12" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">将此数据库连接到 Django 项目。</li><li id="6fa4" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">更改设置以包括 postgresql 数据库后端</li><li id="2ee0" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">安装 psycopg2，使用 Python 与 PostgreSQL 对话</li></ul><p id="77c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个网站上创建一个新帐户，然后选择小海龟计划(免费/慢速)。创建新实例后，您将看到此页面。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/7afe74c0be22a43fb65d359d6602f3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIQgw8CZO48OcY2zxpEw_A.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">ElephantSQL 中的实例详细信息屏幕</figcaption></figure><p id="3903" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">复制 URL，因为这是将这个数据库连接到您的本地 Django 应用程序所需要的唯一东西。</p><p id="5d8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在设置文件 core/settings.py 中进行以下更改</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="8004" class="mx ku in lz b gy my mz l na nb">.....</span><span id="123a" class="mx ku in lz b gy nc mz l na nb">INSTALLED_APPS = [<br/>    "django.contrib.admin",<br/>    "django.contrib.auth",<br/>    "django.contrib.contenttypes",<br/>    "django.contrib.sessions",<br/>    "django.contrib.messages",<br/>    "django.contrib.staticfiles",<br/>    "django.contrib.postgres",                  #THIS APP<br/>    "blog",<br/>]<br/>.....<br/>DATABASES = {<br/>    "default": {<br/>        # My URL<br/>        """postgres://tdjcpial:<a class="ae nd" href="mailto:7UglyA2MM16ksuez2ICeDxfxZjlQnj9X@salt.db.elephantsql.com" rel="noopener ugc nofollow" target="_blank">7UglyA2MM16ksuez2ICeDxfxZjlQnj9X@salt.db.elephantsql.com</a>/tdjcpial"""<br/>        # Change the below settings according to your Copied URL.<br/>        "ENGINE": "django.db.backends.postgresql",<br/>        "NAME": "tdjcpial",<br/>        "USER": "tdjcpial",<br/>        "PASSWORD": "7UglyA2MM16ksuez2ICeDxfxZjlQnj9X",<br/>        "HOST": "salt.db.elephantsql.com",<br/>    }<br/>}<br/>.....</span></pre><p id="e9b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个改变之后，我们需要使用<code class="fe lw lx ly lz b">pip install psycopg2</code>安装 db 适配器 psycopg2</p><p id="4417" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们的数据库已经完全连接了，要从管理站点使用这个数据库，运行<code class="fe lw lx ly lz b">python manage.py migrate</code>，然后运行<code class="fe lw lx ly lz b">python manage.py createsuperuser</code></p><p id="ce44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您现在可以在这个数据库中创建新的文章来测试全文功能。</p><h1 id="ff40" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">要实现全文搜索，我们需要执行以下步骤:</h1><ul class=""><li id="17d2" class="ma mb in jx b jy lr kc ls kg mc kk md ko me ks mf mg mh mi bi translated">解析查询</li><li id="defb" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">解析内容/数据</li></ul><p id="0aa9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开 blog/views.py 并添加以下代码，然后我们将逐行浏览。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="680a" class="mx ku in lz b gy my mz l na nb">from django.shortcuts import render<br/>from .models import Post<br/>from django.contrib.postgres.search import SearchVector, SearchQuery</span><span id="77a7" class="mx ku in lz b gy nc mz l na nb"># Create your views here.</span><span id="9b38" class="mx ku in lz b gy nc mz l na nb">def home(request):<br/>    qs = Post.objects.all()<br/>    query = request.GET.get("query")<br/>    if query:<br/>        # qs = Post.objects.filter(title__icontains=query)<br/>        qs = Post.objects.annotate(search=SearchVector("title", "content")).filter(search=SearchQuery(query))<br/>    return render(request, "index.html", context={"queryset": qs})<br/></span></pre><p id="853c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面的代码中，我们注释掉了 i_contains，并添加了一个由 Django PostgreSQL 后端提供的全文搜索类。</p><p id="6288" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们了解一下每个班级都在做什么:</p><ul class=""><li id="b32b" class="ma mb in jx b jy jz kc kd kg nl kk nm ko nn ks mf mg mh mi bi translated">SearchVector(*fields):这个类处理查询需要搜索的数据，这个类从 PostgreSQL 中运行 ts_vector 函数，将单词分解成标记，并为每个标记分配一个类型。</li><li id="d0fb" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated">SearchQuery(query):该类处理用户提供的查询，通过将查询分解为标记并删除查询中不必要的部分(如标点符号(，！？)和类似这样的词(and，or，要么)。</li></ul><p id="4006" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">annotate 函数用值 SearchVector(title，content)在一个表中创建了一个新的临时列，这意味着我们希望为查询搜索这两个字段。然后，筛选器会筛选出那些在其搜索列中包含查询的行。</p><p id="6519" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们测试一下将这一更改添加到视图后会得到什么。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/2d964f6e466e0ee72865d82a0e6e22bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*XoWAhJjcIaWxrzefbW-Wnw.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">全文搜索中的相关结果</figcaption></figure><p id="75ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">瞧啊。记得之前我们在<code class="fe lw lx ly lz b">python bots</code>上没有得到任何结果，但现在我们的应用程序显示了一些与我们的查询相关的帖子。</p><h1 id="8e97" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">还有更多:</h1><h1 id="a603" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">SearchHeadline():</h1><p id="824c" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果您的查询与内容匹配，此类用于突出显示结果，第一个参数确定我们需要突出显示的位置在这种情况下，内容，第二个参数采用 SearchQuery(query ),我们已经讨论过了，第三个和第四个参数显示当找到匹配的标记时，我们应该如何将它们括起来，在这种情况下，我们使用粗体、斜体和下划线标签。将以下代码添加到您的 blog/views.py 中</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="aaa2" class="mx ku in lz b gy my mz l na nb">from django.shortcuts import render<br/>from .models import Post<br/>from django.contrib.postgres.search import SearchVector, SearchQuery, SearchHeadline</span><span id="246d" class="mx ku in lz b gy nc mz l na nb"># Create your views here.</span><span id="8181" class="mx ku in lz b gy nc mz l na nb">def home(request):<br/>    qs = Post.objects.all()<br/>    query = request.GET.get("query")<br/>    if query:<br/>        # qs = Post.objects.filter(title__icontains=query)<br/>        # qs = Post.objects.annotate(search=SearchVector("title", "content")).filter(<br/>        #     search=SearchQuery(query)<br/>        # )<br/>        qs = Post.objects.annotate(<br/>            headline=SearchHeadline(<br/>                "content",<br/>                SearchQuery(query),<br/>                start_sel="&lt;b&gt;&lt;u&gt;&lt;i&gt;",<br/>                stop_sel="&lt;/i&gt;&lt;/u&gt;&lt;/b&gt;",<br/>            )<br/>        )<br/>    return render(request, "index.html", context={"queryset": qs})</span></pre><p id="ed10" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要做到这一点，我们需要稍微修改一下模板文件。</p><pre class="mp mq mr ms gt mt lz mu mv aw mw bi"><span id="7cd3" class="mx ku in lz b gy my mz l na nb">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;Full Text Search&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>      &lt;form&gt;<br/>           {% csrf_token %}<br/>          &lt;input type="text" name="query"&gt;<br/>          &lt;input type="submit" value="Search"&gt;<br/>    &lt;form/&gt;<br/>    {% for object in queryset %}<br/>    &lt;h2&gt;{{object.title}}&lt;/h2&gt;<br/>    &lt;p&gt;{{object.headline | safe}}&lt;/p&gt;<br/>    {% empty %}<br/>    &lt;h2&gt;No Results&lt;/h2&gt;<br/>    {% endfor %}<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5485" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们来看看:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/caa83b143cf9f02c8be577c0b510316e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*nslelDBS4xQxyUZ9r4UiNA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">搜索词在结果中突出显示</figcaption></figure><p id="91e7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将<code class="fe lw lx ly lz b">{{object.content}}</code>改为<code class="fe lw lx ly lz b">{{object.headline}}</code>，并添加了安全的模板标签过滤器，这样我们的 HTML <code class="fe lw lx ly lz b">&lt;b&gt;&lt;u&gt;&lt;i&gt;query&lt;/i&gt;&lt;/u&gt;&lt;/b&gt;</code>就可以执行了。</p><p id="5bdb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看看我们的查询是如何变得大胆而符合逻辑的。</p><h1 id="5cc8" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="9d98" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如需更多信息和文档:</p><ul class=""><li id="8309" class="ma mb in jx b jy jz kc kd kg nl kk nm ko nn ks mf mg mh mi bi translated"><a class="ae nd" href="https://docs.djangoproject.com/en/4.0/ref/contrib/postgres/search/" rel="noopener ugc nofollow" target="_blank">姜戈全文</a></li><li id="609b" class="ma mb in jx b jy mj kc mk kg ml kk mm ko mn ks mf mg mh mi bi translated"><a class="ae nd" href="https://www.postgresql.org/docs/current/textsearch-controls.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL 文档</a></li></ul><p id="a248" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae nd" href="https://github.com/vivekthedev/full-text-search-blog-example" rel="noopener ugc nofollow" target="_blank"> GitHub 代码库</a>，我不会改变我的数据库的设置，以防你想篡改数据。</p><p id="708f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你喜欢这篇文章，也可以考虑看看我在 Twitter 上的表现，我在那里每天发布的文章不超过 280 个字符。</p></div></div>    
</body>
</html>