<html>
<head>
<title>Django and HTMX Part 1 (Page no-refresh like button)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django和HTMX第1部分(页面无刷新按钮)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/django-and-htmx-part-1-ff629ae048f1?source=collection_archive---------2-----------------------#2021-12-14">https://blog.devgenius.io/django-and-htmx-part-1-ff629ae048f1?source=collection_archive---------2-----------------------#2021-12-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c897" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在第一篇教程中，我将介绍如何使用HTMX在网页上实现一个简单的<em class="ki"> like </em>按钮，以避免在Django网站上编写JavaScript。</p><p id="af9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望直接跳到<em class="ki">指南</em>？<a class="ae kj" href="https://medium.com/p/ff629ae048f1#cb7d" rel="noopener">点击这里</a></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/bd559ba743df20e8e2f9173b4d0e206b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eK2HGogFkhw7RiBz"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">詹姆斯·哈里森在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><p id="1033" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好的。首先，我想说我不是全栈开发人员，我的时间有限。在过去的几年里，我喜欢学习Django，并希望开发更具互动性的网站。<br/> Django是一个使用Python创建web应用程序的优秀框架。语法简单明了，只要稍加练习就能轻松创建web应用程序，因为Django内置了如此多的特性。</p><p id="8aeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">唯一的问题是，为了创建一个具有交互特性的站点，而不涉及页面重载，简单到像一个like按钮意味着你需要将Django和JavaScript结合起来。</p><p id="e2f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Django本质上是一个<em class="ki">后端</em>框架，它可以在从数据库中提取数据的同时根据设计呈现网页。</p><p id="a6f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在诸如喜欢按钮的简单特征的情况下，用户点击按钮需要网页向存储页面数据的服务器发送请求，以增加点击时喜欢的数量。然而，不幸的是，结果将意味着整个页面都需要重新加载，而不仅仅是页面中需要更新的部分。</p><p id="5231" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用JavaScript可以通过多种方式实现这一点，而且都需要很长的学习时间。我个人没有时间去学习每一种网络技术，因为我的日常工作不允许我这样做。此外，我不使用某项技能的时间越长，当我需要再次使用该技能时，就越有可能需要重新学习该技能。</p><p id="51cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我确信在未来，Django将会包含一些特性，使得调用后端更加容易。在那之前，我先给你介绍一下HTMX。</p><p id="dc65" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">HTMX允许我们包含交互特性，同时只扩展我们无论如何都会创建的HTML模板的基本语法。</p><p id="948a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面我将介绍创建一个简单页面和帖子的like按钮的基础知识。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h2 id="cb7d" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">创建虚拟环境</h2><p id="adae" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">让我们从创建一个简单的Django项目和应用程序开始。</p><p id="7a57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你喜欢在不输入所有代码的情况下重新创建它，请在这里查看GitHub repo:<a class="ae kj" href="https://github.com/bitFez/htmx_guide_1_like_button" rel="noopener ugc nofollow" target="_blank">https://github.com/bitFez/htmx_guide_1_like_button</a></p><p id="117d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我只是列出了Windows PC的步骤。首先，在命令提示符下，在您希望安装Django项目的文件夹中键入以下内容:</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="dd61" class="lh li in mg b gy mk ml l mm mn">virtualenv venv</span></pre><p id="d6a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们将运行虚拟环境</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="c13a" class="lh li in mg b gy mk ml l mm mn">venv/scripts/activate</span></pre><p id="ba1f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设您的计算机上安装了python &gt;= 3.6，请键入:</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="0171" class="lh li in mg b gy mk ml l mm mn">pip install Django==3.2.5</span></pre><p id="ff19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装完成后，让我们开始一个Django项目。下面一行中的<code class="fe mo mp mq mg b">.</code>确保项目安装在当前目录中，而不是当前目录中的另一个目录。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="4d6c" class="lh li in mg b gy mk ml l mm mn">django-admin startproject core .</span></pre><p id="bd45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们已经创建了一个名为核心的Django项目，我们现在想创建一个名为帖子的应用程序。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="cadf" class="lh li in mg b gy mk ml l mm mn">python manage.py startapp posts</span></pre><p id="2961" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该目录应该如下所示:</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="f1a5" class="lh li in mg b gy mk ml l mm mn">- core <br/>- posts<br/>- venv<br/>manage.py</span></pre><p id="d575" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，在核心目录中，打开<code class="fe mo mp mq mg b">settings.py</code>，在<code class="fe mo mp mq mg b">installed_apps</code>数组下添加posts应用程序。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="f508" class="lh li in mg b gy mk ml l mm mn">INSTALLED_APPS = [<br/>  ...<br/>  # my apps<br/>  'posts',<br/>]</span></pre><p id="2bcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在核心应用程序目录中打开<code class="fe mo mp mq mg b">urls.py</code>文件，并在<code class="fe mo mp mq mg b">urlpatterns </code>数组中添加以下内容。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="ed32" class="lh li in mg b gy mk ml l mm mn">from django.urls import path, <strong class="mg io"><em class="ki">include</em></strong> # add include here</span><span id="9b41" class="lh li in mg b gy mr ml l mm mn">urlpatterns = [<br/>  path('admin/', admin.site.urls),<br/>  path('', include('posts.urls')), # &lt;-- Add this line<br/>]</span></pre><p id="19a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在帖子应用程序中，将以下内容添加到<code class="fe mo mp mq mg b">models.py</code>文件中</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="df06" class="lh li in mg b gy mk ml l mm mn">from django.db import models </span><span id="dc88" class="lh li in mg b gy mr ml l mm mn"># Create your models here.                             <br/>from django.db import models                             <br/>from django.contrib.auth.models import User                                                           </span><span id="9408" class="lh li in mg b gy mr ml l mm mn">class Post(models.Model):<br/>    # loads the USER linked to the profile from django AUTH<br/>    post_author = models.ForeignKey(User, on_delete=models.CASCADE)<br/>    post_content = models.TextField(null=True, blank=True)<br/>    likes = models.ManyToManyField(User, blank=True, related_name="collected_votes")</span></pre><p id="7c45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">同样在posts目录中，将以下内容添加到<code class="fe mo mp mq mg b">admin.py</code>文件中。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="13fc" class="lh li in mg b gy mk ml l mm mn">from django.contrib import admin<br/>from .models import Post<br/># Register your models here.<br/><br/><br/>class PostAdmin(admin.ModelAdmin):<br/>    model = Post<br/>    fields = ['post_author', 'post_content', 'likes']<br/><br/>admin.site.register(Post, PostAdmin)</span></pre><p id="23da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们需要在posts目录中创建2个HTML文件。一个是查看帖子的模板。另一个是部分区域，我们将使用它在每次按下按钮时动态更新赞。</p><p id="3610" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在一个文件夹结构中创建两个文件，如下例所示。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="c2a7" class="lh li in mg b gy mk ml l mm mn">posts<br/>│   <br/>└───templates<br/>│   │   post_detail.html<br/>│   │<br/>│   └───partials<br/>│       │   likes_area.html</span></pre><p id="2664" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mo mp mq mg b">post_detail.html</code>文件的内容</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="5c79" class="lh li in mg b gy mk ml l mm mn">&lt;html&gt;<br/>    &lt;head&gt;<br/>        &lt;link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;h1&gt;Post detail page&lt;/h1&gt;<br/>        &lt;br&gt;<br/>        &lt;p&gt;{{post.post_author}}&lt;/p&gt;<br/>        <br/>        &lt;p&gt;{{post.post_content}}&lt;/p&gt;<br/>        &lt;div&gt;<br/>            {% include "posts/partials/likes_area.html" %}<br/>        &lt;/div&gt;<br/>    &lt;/body&gt;<br/>    &lt;script src="https://unpkg.com/htmx.org@1.6.0"&gt;&lt;/script&gt;<br/>    &lt;script&gt;<br/>        document.body.addEventListener('htmx:configRequest', (e) =&gt; {<br/>          e.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';<br/>          })<br/>      &lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="8155" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如您在上面看到的，有一个带有Django标签<code class="fe mo mp mq mg b">{% include “posts/partials/likes_area.html” %}</code>的div。这将加载页面的部分区域，允许我们向页面添加一个按钮和类似的计数器。部分章节如下。</p><p id="8136" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mo mp mq mg b">likes_area.html</code>文件的内容</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="07db" class="lh li in mg b gy mk ml l mm mn">&lt;div class="list-group list-group-horizontal btn-group" id="likesarea" role="group"&gt;<br/>    &lt;p&gt;{{ post.likes.count }} likes<br/>    <br/>        &lt;button hx-post="{% url 'posts:like_post' post.id %}" id="like-button" <br/>          hx-target="#likesarea" hx-swap="outerHTML"&gt;<br/>          {% if request.user in post.likes.all %}<br/>            &lt;i class="material-icons" style="font-size:16px;color:green;"&gt;check_box&lt;/i&gt;<br/>          {% else %}<br/>          &lt;i class="material-icons" style="font-size:16px;color:yellowgreen;"&gt;check_box_outline_blank&lt;/i&gt;<br/>          {% endif %}<br/>        &lt;/button&gt;<br/><br/>    &lt;/p&gt; <br/>    <br/>&lt;/div&gt;</span></pre><p id="b03c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面你可以看到没有一个完整的HTML文件，只有一个<code class="fe mo mp mq mg b">div</code>将被加载到主页面。这就是奇迹发生的地方。div有一个设置为<code class="fe mo mp mq mg b">“likesarea”</code>的id，这是每次按下like按钮时将加载的内容。</p><p id="4cef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在like按钮本身有了简单的HTMX标签<code class="fe mo mp mq mg b"><strong class="jm io"><em class="ki">hx-post</em></strong></code>，它将调用HTMX库来调用<em class="ki">视图函数</em>、<code class="fe mo mp mq mg b">like_post</code>。当我们添加视图时，您会看到，它会根据用户是否已经喜欢它来添加或删除对该帖子的喜欢。</p><p id="d99d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在同一个button标记中，还有另一个HTMX标记，它指定页面上哪个div需要刷新。在这种情况下，它指的是类似于的<em class="ki">区域。</em></p><p id="c4fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们通过在posts app目录中创建一个<code class="fe mo mp mq mg b">urls.py</code>文件并添加以下行来添加我们将需要的路径:</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="1c51" class="lh li in mg b gy mk ml l mm mn">from django.urls import path<br/>from .import views <br/><br/>app_name = 'posts'<br/><br/>urlpatterns = [<br/>    path('post/&lt;int:id&gt;', views.view_post, name='view_post'),<br/>    path('like/&lt;int:id&gt;', views.like_post, name='like_post'),<br/>]</span></pre><p id="5f17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们只剩下最后一个文件了。我们需要将以下内容添加到帖子应用程序的<code class="fe mo mp mq mg b">views.py</code>文件中。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="2b73" class="lh li in mg b gy mk ml l mm mn">from django.contrib.auth.decorators import login_required<br/>from django.contrib.auth.models import User<br/>from django.shortcuts import render<br/><br/>from .models import Post<br/><br/>def view_post(request, id):<br/>    post = Post.objects.get(id=id)<br/>    <br/>    context = {'post':post}<br/>    return render(request, 'posts/post_detail.html', context)<br/><br/><br/>def like_post(request, id):<br/>    if request.method == "POST":<br/>        instance = Post.objects.get(id=id)<br/>        if not instance.likes.filter(id=request.user.id).exists():<br/>            instance.likes.add(request.user)<br/>            instance.save() <br/>            return render( request, 'posts/partials/likes_area.html', context={'post':instance})<br/>        else:<br/>            instance.likes.remove(request.user)<br/>            instance.save() <br/>            return render( request, 'posts/partials/likes_area.html', context={'post':instance})</span></pre><p id="c237" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们创建一个超级用户，然后迁移我们的数据库更改。</p><p id="8486" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在命令提示符下键入以下内容</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="450c" class="lh li in mg b gy mk ml l mm mn">&gt; python manage.py makemigrations<br/>&gt; python manage.py migrate<br/>&gt; python manage.py createsuperuser</span></pre><p id="52f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦你创建了一个管理员用户，运行服务器让网站运行起来。</p><pre class="kl km kn ko gt mf mg mh mi aw mj bi"><span id="68a8" class="lh li in mg b gy mk ml l mm mn">python manage.py runserver</span></pre><p id="d2c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个例子中没有主页，所以直接进入<code class="fe mo mp mq mg b"><a class="ae kj" href="http://127.0.0.1:8000/admin" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/admin</a></code>的管理页面并登录。现在创建一个很棒的帖子，如下例所示。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ms"><img src="../Images/d47f11ad668faff68c3aadd2e1bc5be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kO5dJ98Yj6l9oY-9yuwEvw.png"/></div></div></figure><p id="ec7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，假设你创建的文章是1号文章，去<code class="fe mo mp mq mg b"><a class="ae kj" href="http://127.0.0.1:8000/post/1" rel="noopener ugc nofollow" target="_blank">127.0.0.1:8000/post/1</a></code></p><p id="e7fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">页面应该是这样的。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/b1b52268ab02d74052132f08c2f8ae58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*4rPgGLK4fH6LPS-Z8XPnig.png"/></div></figure><p id="89a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">单击该按钮时，它应该看起来像这样:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/f63e74230c0ec380779567c51f854846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*lDLvoLmhDjMc8BqEjoxWEg.png"/></div></figure><p id="39f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没有页面重新加载…麦克风下降！🎤</p></div></div>    
</body>
</html>