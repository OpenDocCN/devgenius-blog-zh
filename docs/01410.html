<html>
<head>
<title>Development tips on Andriod and iOS In-app Webview.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Andriod 和 iOS 应用内 Webview 开发技巧。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/development-tips-on-andriod-and-ios-in-app-webview-9328cd18136d?source=collection_archive---------29-----------------------#2020-07-02">https://blog.devgenius.io/development-tips-on-andriod-and-ios-in-app-webview-9328cd18136d?source=collection_archive---------29-----------------------#2020-07-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cd0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我想谈谈我在使用应用内 Webview 的职业生涯中的个人经历。我将尝试解释我在 Andriod 和 iOS 的应用内 Webview 中遇到的问题。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/ea6f0afbb6ed3b18bbbd5ce076ba348c.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*q7DS9xzNSHVERy1G299s-Q.png"/></div></figure><h1 id="119e" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak"> 1。如何使用 javascript 检测 Andriod 设备或 iOS 设备？</strong></h1><p id="3860" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">通过使用 javascript，我们可以使用下面的代码来检测 Andriod 或 iOS。</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="d021" class="lz ks in lv b gy ma mb l mc md">function getMobileOperatingSystem() {<br/> var userAgent = navigator.userAgent || navigator.vendor || window.opera;<br/> console.log(userAgent);<br/> if (userAgent.toLowerCase().indexOf("windows") &gt;= 0 || userAgent.toLowerCase().indexOf("x11") &gt;= 0) {<br/>  return "Web";<br/> }<br/> if (/windows phone/i.test(userAgent)) {<br/>  return "Windows Phone";<br/> }<br/> if (/android/i.test(userAgent)) {<br/>  return "Android";<br/> }<br/> if (/iPad|iPhone|iPod/.test(userAgent) &amp;&amp; !window.MSStream) {<br/>  return "iOS";<br/> }<br/> return "unknown";<br/>}</span><span id="5e9e" class="lz ks in lv b gy me mb l mc md">var dtype = getMobileOperatingSystem();<br/>if (dtype == "Android") {<br/> Android.&lt;Andriod Method&gt;;<br/>}else if (dtype == "iOS") {<br/>   window.location.href = "&lt;domain url with http or https and Query string for ios method to call&gt;";<br/>}</span></pre><p id="0ddf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面代码强制调用一个 Andriod 方法</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="0732" class="lz ks in lv b gy ma mb l mc md">Android.&lt;Andriod Method&gt;;</span></pre><p id="d0ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的代码是调用 iOS。这里我们需要用查询参数触发 URL，它调用 iOS 方法。</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="9903" class="lz ks in lv b gy ma mb l mc md">window.location.href = "&lt;domain url with http or https and Query string for ios method to call&gt;";</span></pre><h1 id="93e5" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">2.iOS 相机 pic 上传旋转问题。</h1><p id="fcff" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">如果你想用相机在横向或纵向模式下拍照，请使用应用内网络视图。它需要一个风景模式的图片，这是因为在 iOS 中默认相机的图片是在风景模式。我们需要通过后端处理这种旋转。</p><h1 id="31f4" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">3.第三方 URL 重定向</h1><p id="ad3f" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">如果有任何第三方网址，那么重定向到您的网页可能是一个问题，因为使用 android 或 ios 后退按钮将关闭应用内 Webview。这里我们需要停止所有使用 javascript 的第三方 URL。</p><h1 id="136b" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">4.Webview -&gt;应用和应用-&gt;Webview 通信</h1><p id="e070" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">如果您想将数据从应用程序发送到 Webview:我们可以用参数(GET 或 POST 方法参数)触发 URL，我们可以将数据发送到 web 浏览器。</p><p id="58de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想从 Webview 发送数据到 App:这里我们可以使用 javascript 代码(请参考<em class="ki">第一点</em>中提到的代码)，通过检测 Andriod 或 iOS 设备调用各自的方法。</p><h1 id="264d" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">5.文本框焦点 Webview 缩放问题</h1><p id="a4c5" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">有时你可能会注意到，当我们聚焦在文本框上时，浏览被放大了。通过使用下面的 HTML 代码，我们可以避免缩放问题</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="81ea" class="lz ks in lv b gy ma mb l mc md">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0"/&gt;</span><span id="b306" class="lz ks in lv b gy me mb l mc md">body { font-size: 16px; }<br/>input, select { font-size: 100%; }</span></pre><h1 id="fb54" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">6.在本地系统中调试 Andriod 和 iOS web 浏览器</h1><p id="ae92" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">Andriod :我们需要使用代码级别启用调试模式。之后，我们可以在本地 Google Chrome inspect 元素中调试 Webview。如需参考，请访问谷歌官方网站。</p><div class="mf mg gp gr mh mi"><a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd io gy z fp mn fr fs mo fu fw im bi translated">开始远程调试 Android 设备</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">从您的 Windows、Mac 或 Linux 电脑远程调试 Android 设备上的实时内容。本教程教你如何…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">developers.google.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kp mi"/></div></div></a></div><p id="e72a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> iOS </strong>:这里我们可以通过将 iPhone 设备连接到 Mac 设备，在 Safari 浏览器中检查应用内 Webview。</p><p id="0ff8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，你需要在你的 iOS 设备上启用“网页检查器”。前往“设置”&gt;“Safari”&gt;“高级”,并切换 Web Inspector 使其启用。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/4655b6db0c43694e62ee872fa8038747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*323ZSLBgOmJ8j5RwcrJqTA.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">iPhone 图像</figcaption></figure><p id="2e48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，您需要在 Mac 电脑上的 Safari 中启用“开发”菜单(如果尚未启用)。前往 Safari &gt;偏好设置&gt;高级，并在菜单栏中勾选“<em class="ki">显示开发菜单”复选框。</em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ng"><img src="../Images/9ac5afabe7900f55f578c73ace90b882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsPxktXd9eo3pf62OCKSYg.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">Mac 设备</figcaption></figure><p id="36fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，如果您的 iOS 设备连接到您的电脑，并且您希望调试的网页当前处于打开状态，您可以在桌面 Safari 中进入开发&gt; iOS 设备名称，然后单击您希望调试的页面。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nh"><img src="../Images/ae090d5c4ef5fe3bc9239d0ba4e8c191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwtKI-kbW0MNvPW4n5nKhg.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">Mac 设备</figcaption></figure><p id="5b24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您可以在浏览器中调试代码。</p><h1 id="0588" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">7.如何在 Andriod app Webview 中设置文件拣选权限？</h1><p id="92df" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">为了从 Andriod 应用内 web 视图中选择文件，我们需要在代码级别启用 web view 的权限。下面的 android 代码将使您能够浏览本地存储的文件。</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="e277" class="lz ks in lv b gy ma mb l mc md">//Necessary Variable to implement file chooser in webview<br/>private ValueCallback&lt;Uri&gt; mUploadMessage = null;<br/>private ValueCallback&lt;Uri[]&gt; uploadMessage = null;<br/>private Integer FILECHOOSER_RESULTCODE = 1;<br/>private Integer REQUEST_SELECT_FILE = 2;<br/><br/>// Using WebChromeClient to pick file<br/> private class MyWebChromeClient extends WebChromeClient {<br/>     protected void openFileChooser(ValueCallback&lt;Uri&gt; uploadMsg) {<br/>         mUploadMessage = uploadMsg;<br/>         Intent i = new Intent(Intent.ACTION_GET_CONTENT);<br/>         i.addCategory(Intent.CATEGORY_OPENABLE);<br/>         i.setType("*/*");<br/>         String[] mimetypes = {"image/*", "application/pdf"};<br/>         i.putExtra(Intent.EXTRA_MIME_TYPES, mimetypes);<br/>         startActivityForResult(Intent.createChooser(i, "File Chooser"), FILECHOOSER_RESULTCODE);<br/>     }<br/>     // For Lollipop 5.0+ Devices<br/>     public boolean onShowFileChooser(WebView mWebView, ValueCallback&lt;Uri[]&gt; filePathCallback, WebChromeClient.FileChooserParams fileChooserParams) {<br/>         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {<br/>             if (ContextCompat.checkSelfPermission(ThemeDisplayBrowser.this,<br/>                     Manifest.permission.WRITE_EXTERNAL_STORAGE)<br/>                     != PackageManager.PERMISSION_GRANTED) {<br/>                 // ASK FOR STORAGE PERMISSION HERE<br/>             }<br/>         }<br/>         if (uploadMessage != null) {<br/>             uploadMessage.onReceiveValue(null);<br/>             uploadMessage = null;<br/>         }<br/>         uploadMessage = filePathCallback;<br/>         Intent intent = null;<br/>         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {<br/>             intent = fileChooserParams.createIntent();<br/>             intent.setType("*/*");<br/>             String[] mimetypes = {"image/*", "application/pdf"};<br/>             intent.putExtra(Intent.EXTRA_MIME_TYPES, mimetypes);<br/>         }<br/>         try {<br/>             startActivityForResult(intent, REQUEST_SELECT_FILE);<br/>         } catch (ActivityNotFoundException e) {<br/>             uploadMessage = null;<br/>             Toast.makeText(getApplicationContext(), "Cannot Open File Chooser", Toast.LENGTH_LONG).show();<br/>             return false;<br/>         }<br/>         return true;<br/>     }<br/>     @Override<br/>     public boolean onJsAlert(WebView view, String url, String message, JsResult result) {<br/>         result.confirm();<br/>         return true;<br/>     }<br/> }<br/><br/><br/>// Retriving choosen file using onActivityResult<br/><br/> @Override<br/> protected void onActivityResult(int requestCode, int resultCode, Intent data) {<br/>     if (requestCode == REQUEST_SELECT_FILE) {<br/>         AppUtils.pritLogg("got into 1");<br/>         if (uploadMessage == null) return;<br/>         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {<br/>             uploadMessage.onReceiveValue(WebChromeClient.FileChooserParams.parseResult(resultCode, data));<br/>         }<br/>         uploadMessage = null;<br/>     } else if (requestCode == FILECHOOSER_RESULTCODE) {<br/>         AppUtils.pritLogg("got into 2");<br/>         if (null == mUploadMessage)<br/>             return;<br/>         // Use MainActivity.RESULT_OK if you're implementing WebView inside Fragment<br/>         // Use RESULT_OK only if you're implementing WebView inside an Activity<br/>         Uri result = data == null || resultCode != RESULT_OK ? null : data.getData();<br/>         mUploadMessage.onReceiveValue(result);<br/>         mUploadMessage = null;<br/>     }<br/> }</span></pre><h1 id="3e55" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">9.移动 Safari 浏览器或应用内 iOS webview 中的 HTML 输入控件样式问题</h1><p id="6b5e" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">使用<code class="fe ni nj nk lv b">appearance</code>属性避免专有风格化</p><pre class="kk kl km kn gt lu lv lw lx aw ly bi"><span id="c36e" class="lz ks in lv b gy ma mb l mc md">-moz-appearance: none;/* older firefox */<br/>-webkit-appearance: none; /* safari, chrome, edge and ie mobile */<br/>appearance: none; /* rest */</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/44bb307926ea7ad1aae939dddaf4ecd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*0yIipIBpfgSL_GR1Z05aMQ.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">iOS 下拉列表问题</figcaption></figure></div></div>    
</body>
</html>