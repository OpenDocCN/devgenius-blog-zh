<html>
<head>
<title>Developing a lie: just one more thing…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发展谎言:还有一件事…</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/common-programming-mistakes-just-one-more-thing-c75ee2b5b409?source=collection_archive---------1-----------------------#2019-08-20">https://blog.devgenius.io/common-programming-mistakes-just-one-more-thing-c75ee2b5b409?source=collection_archive---------1-----------------------#2019-08-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5ccc838801da005c825181837933eb60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgQs4c65R-cRRSNtjm3I2g.jpeg"/></div></div></figure><p id="d6ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个关于一个简单的附带项目如何容易升级，如何做出不合理的决定，以及如何从中获得乐趣的故事！</p><h1 id="21ac" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">这个想法</h1><p id="6aac" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我有一个5英寸屏幕的树莓派已经很多年了，它一直在我的书架上积灰。但是上周末，我有了一个如何利用它的绝妙主意。假设是:</p><p id="6e6c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我工作的公司，我们正在运行一个有十几个微服务的平台。那些程序负责处理一切。对我来说，总是看到每个程序的状态是很有用的，这样当一个程序崩溃时，我可以立即做出反应。</p><p id="ec03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这应该不会太难吧？该平台使用Kubernetes，因此访问数据非常容易(使用<a class="ae lx" href="https://kubernetes.io/docs/reference/kubectl/overview/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>)，我会在屏幕上很好地显示出来。会很好的！</p><h1 id="584e" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">原型</h1><p id="d4d2" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我的任务很简单——在屏幕上显示最重要的微服务的数据。这些数据包括:服务运行了多长时间，重启了多少次，以及当前是否正在运行。</p><p id="42cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">设置过程很简单:</p><ol class=""><li id="a1cf" class="ly lz in jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated">下载Raspbian OS(裸机版，因为谁需要台式机)</li><li id="34b4" class="ly lz in jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">将其安装在MicroSD卡上</li><li id="cfee" class="ly lz in jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">在树莓上设置一切(WiFi、ssh、屏幕驱动、kubectl)</li><li id="96b3" class="ly lz in jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">设置一个简单的单行bash命令，每秒刷新一次数据</li><li id="23e4" class="ly lz in jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">让它在启动时运行</li></ol><p id="43d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">基本上，kubectl是一个命令，我可以用它来获取最新的数据，WiFi让树莓与外界对话，ssh让我与树莓对话，而屏幕驱动程序让我实际看到屏幕上的东西。</p><p id="27be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">命令呢？实际上很简单:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="c5f0" class="mv ku in mr b gy mw mx l my mz">watch -n 1 kubectl get pods | grep "sandbox\|memc\|mongo\|postgres"</span></pre><p id="3fb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是我得到的结果:</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/d22d8947b626674b73d8028bad1cc6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BY56FC-D4p9xklJI.png"/></div></div></figure><p id="ffd1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lw">耗时:1.5小时</em></p><p id="c806" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是等等，有一个问题…我觉得这太容易了。我只是没有感受到辛苦工作一天的满足感。我知道，让我再补充一点！</p><h1 id="2ff0" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">掉进兔子洞</h1><p id="f7c7" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">让我用一些颜色来编码。将来它对我来说意味着整个世界。此外，未来的me肯定希望着色逻辑易于编程，因此它可以支持所有它肯定需要的复杂逻辑。</p><p id="b9f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我决定从Bash转向Python。这是我摇滚的地方，很快就会完成。我决定只做一个小小的限制——程序只能使用标准的Python库，否则事情会变得太简单，我想学习一些新的东西。</p><p id="6297" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就这样。有了2个类、1个递归函数和5个常规函数，总共127行代码，我就有了自己定制的彩色编码监控解决方案。当我在配有i7处理器、16GB内存和Nvidia显卡的15英寸笔记本电脑上看着它时，我心想:<em class="lw">这是我可以引以为豪的事情。</em></p><p id="c695" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">…直到我在覆盆子上运行它。在那里，我可以看到每次屏幕刷新时的小故障。它无法清理整个屏幕并足够快地重新打印所有内容。它太慢了，每3秒刷新一次，而不是我设定的1秒。此外，一些颜色使数据更难阅读。相当令人失望。</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ad2a61102162ef19423776cbafbb46ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XhEHyp3r-zT0ep0E.png"/></div></div></figure><p id="0685" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lw">花费时间:3小时</em></p><p id="1b0b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lw">好的，好的，没问题。我只需要稍微优化一下代码。它不需要每秒刷新一次，但我需要消除这个小故障。</em></p><p id="01a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我想到了一些优化方法——每次我得到新数据时，我都会将它与旧数据进行比较。如果是一样的，我会忽略它，因为这意味着什么都没有改变。此外，我会存储所有需要打印出来的内容，这样当我打印时，我可以一次打印所有内容。</p><p id="0005" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我把修改编码后，我很开心！我终于完成了让一切都如此令人满意的一天工作。可惜故障不会消失。</p><h1 id="5254" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">做或不做，没有尝试</h1><p id="ea84" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">这不会打败我。我知道解决办法是找到一种方法，只重新打印改变的数据。经过大量的(StackOverflow)研究，我发现我唯一的解决方案是这个<a class="ae lx" href="https://docs.python.org/3/library/curses.html" rel="noopener ugc nofollow" target="_blank">诅咒库</a>，它允许我编辑单独显示的每一行和每一列。</p><p id="b2e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这意味着我不得不重写整个印刷过程。最后，我绘制了屏幕上每条信息的位置，寻找信息的变化，然后适当地替换它。</p><p id="b78d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这带来了很多痛苦(还有快感？).如果我想在旧的信息上打印一条新的信息，我必须比较字符串，如果新的更短，我必须添加空格来覆盖差异。当服务终止时，它需要从屏幕上消失，这意味着我必须清除该行，然后将所有其他行上移以覆盖空白区域。我还必须注意某一行的颜色何时会根据数据变化而变化，因为整行都需要重新打印。</p><p id="7f31" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">很多这样的小事加起来，最终会有236行代码，而我几乎花了一整天来编程。即使现在我还没有完成，由于小屏幕的尺寸，有一些修改，我将不得不做的一切，以正确渲染。</p><p id="446e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">想想看，我用那一行Bash代码实现了几乎相同的功能。我疯了吗？</p><h1 id="51a4" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">值得吗？</h1><p id="5faf" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">是的。没有。</p><p id="19ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我在编程和解决这些问题的过程中得到了很多乐趣，也遇到了一些通常伴随着这一行的挫折。当你开始以编程为生时，我认为这是经常丢失的东西，因为我们被规范和期限所困扰。我也学到了很多——如何在角色层面上操作屏幕，思考硬件限制通常会有所回报，以及如何让覆盆子看起来很酷。</p><p id="65bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一方面，最终结果并不比我在Bash中开始时好多少，甚至现在我仍然有一些修改要做。所以也许我可以利用这段时间做些别的事情，打破我的常规。</p><p id="80ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对我来说，有趣的是我在这个项目中做出的(不那么)微妙的非理性决定。所以借鉴我的经验。不一定是如何减少不理性，而是如何认识到这种行为，并在你的决策过程中考虑到这一点。此外，尝试并享受乐趣——这是至关重要的部分:)</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="ab gu cl nc"><img src="../Images/31573030d1a65a61fbd5e375cc6c1f55.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b31hiO4ynbDLRrXWEFF4aQ.png"/></div></figure><p id="eafd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lw">花费时间:8小时</em></p><h1 id="4c75" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">你怎么想呢?</h1><p id="c928" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我真的很想知道你的想法。你知道解决我遇到的问题的更好的方法吗？你觉得这有用吗？你想让我在GitHub上发布代码吗？</p></div></div>    
</body>
</html>