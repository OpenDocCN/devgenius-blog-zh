<html>
<head>
<title>Set an Alarm that plays your favorite song on a Raspberry Pi using Cron Job</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Cron Job 设置闹钟，在树莓 Pi 上播放您最喜欢的歌曲</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/set-an-alarm-that-plays-your-favorite-song-on-a-raspberry-pi-using-cron-cda6554d5e49?source=collection_archive---------6-----------------------#2020-06-29">https://blog.devgenius.io/set-an-alarm-that-plays-your-favorite-song-on-a-raspberry-pi-using-cron-cda6554d5e49?source=collection_archive---------6-----------------------#2020-06-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0358" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">家里有备用音箱吗？用它来创建一个响亮的警报与树莓皮！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2caea783f228dccd37cae288f1304014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I7fi68GPWXz2uCmW"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">照片由<a class="ae ks" href="https://unsplash.com/@harrisonbroadbent?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈里森·布罗德本特</a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h2 id="260c" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">为什么一开始要用树莓皮做闹钟？</h2><p id="e1ca" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">最近，我有一个扬声器，它再也装不下电池了，不得不一直插着电源。这给了我一个想法，用树莓皮设置一个额外的响亮的“闹钟”，播放任何 mp3 文件。使用 Raspberry Pi 的优点是:始终插上扬声器，它很便宜，支持大量定制，并且是未来项目的基础。</p><p id="06fe" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">这是最后一张图。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/383e078996c10294aaecb140cd372296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5RVU3xuHpSiJuLXMQrTRsw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">连接到扬声器的 Raspberry Pi 2 型号 B</figcaption></figure><h1 id="a193" class="mo ku in bd kv mp mq mr ky ms mt mu lb jt mv ju lf jw mw jx lj jz mx ka ln my bi translated">概观</h1><p id="fe92" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">为了创建警报，我们将在 Raspberry Pi 上调度一个 cron 作业来运行 python 脚本。这个概念是让 python 脚本在 cron 运行/产生 mp3 文件时播放该文件。因为我们可以为 crontab 设置时间表，所以我们可以设置我们想要闹钟的时间！</p><p id="1828" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">您将学习如何:</p><ol class=""><li id="39f5" class="mz na in lr b ls mi lv mj lc nb lg nc lk nd mh ne nf ng nh bi translated">设置树莓 Pi</li><li id="623d" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh ne nf ng nh bi translated">使用 SSH(安全外壳)连接到您的 Raspberry Pi</li><li id="1045" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh ne nf ng nh bi translated">使用 SCP(安全复制协议)远程传输文件</li><li id="e17b" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh ne nf ng nh bi translated">在 Raspbian 上使用 crontab 来调度 python 脚本</li></ol><p id="35fc" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">您将需要:</p><ul class=""><li id="2e77" class="mz na in lr b ls mi lv mj lc nb lg nc lk nd mh nn nf ng nh bi translated">树莓派</li><li id="4f9d" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh nn nf ng nh bi translated">扬声器</li><li id="db51" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh nn nf ng nh bi translated">适用于您的 Raspberry Pi 的以太网或 Wifi 适配器</li><li id="c945" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh nn nf ng nh bi translated">辅助电缆或蓝牙适配器</li><li id="4599" class="mz na in lr b ls ni lv nj lc nk lg nl lk nm mh nn nf ng nh bi translated">虽然理论上你可以在没有显示器的情况下这样做，但是为你的 Raspberry Pi 使用一个显示器会很有帮助。</li></ul><h2 id="066c" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">Python 脚本</h2><p id="898b" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">脚本本身很简单。你可以在 Github <a class="ae ks" href="https://github.com/TheKasam/Py_Alarm" rel="noopener ugc nofollow" target="_blank">这里</a>找到最终文件夹。创建此文件后，将 cd 放入其文件夹中。使用下面的命令检查脚本是否工作，是否正在您的 PC 上播放音频。用你的脚本和 mp3 文件创建一个文件夹。</p><p id="b228" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated"><code class="fe no np nq nr b">python3 filename.py</code></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="d89f" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">安装 Raspbian</h2><p id="42bc" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">我们现在的任务是在安装了 Raspbian 的情况下启动并运行我们的 Raspberry Pi。</p><p id="483d" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">如果你以前没有用过树莓派，这里的是一个很好的入门指南。要安装 OS，我的建议是使用<a class="ae ks" href="https://www.raspberrypi.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 成像仪</a>，安装推荐的 Raspberry Pi OS。您的 Raspberry Pi 应该会启动到图形桌面。然后按照提示更改密码并连接到互联网，完成设置。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nu"><img src="../Images/8c7925c15f76830105ebb267f9f082c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3FISDhT9APhXPOfc4UtBA.png"/></div></div></figure><h2 id="69f6" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">SSH 到 PI</h2><p id="69a0" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">SSH 是一个软件包，它使我们能够远程连接到我们的 raspberry pi。SSH 在 Raspberry Pi 中是默认禁用的，你必须进入配置菜单才能启用它。这里有一个很好的<a class="ae ks" href="https://itsfoss.com/ssh-into-raspberry/" rel="noopener ugc nofollow" target="_blank">指南</a>教你如何把宋承宪变成树莓派。</p><p id="4cc3" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">如果你有一台 Mac 或 Linux 电脑，你可以通过你的终端来完成，在 windows 上你可以使用一个 SSH 客户端，比如 Putty。使用您的 Raspberry Pi 的 ip 地址打开一个终端并键入以下命令。</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="itsfoss_300x250_320x50_DynamicAds" class="kt ku in nr b gy nz oa l ob oc">ssh pi@192.168.x.x</span></pre><p id="b613" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">或者</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="e35a" class="kt ku in nr b gy nz oa l ob oc">ssh pi@raspberrypi</span></pre><h2 id="df8d" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">单细胞蛋白质</h2><p id="fe9b" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">在我们计划我们的 python 脚本之前，为了首先把我们的文件夹放到我们的 Raspberry Pi 上，我们可以使用<a class="ae ks" href="https://www.geeksforgeeks.org/scp-command-in-linux-with-examples/" rel="noopener ugc nofollow" target="_blank"> SCP </a>(安全复制协议)。编辑您的脚本，使用<em class="od"> mpg123 </em>而不是<em class="od"> afplay </em>，这样它就可以在 linux 上工作，并使用下面的命令来传输您的文件夹。</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="3d51" class="kt ku in nr b gy nz oa l ob oc">scp -r ./full_path_to_folder pi@raspberrypi:/home/pi/desktop</span></pre><h2 id="8720" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">树莓 Pi 上的测试脚本</h2><p id="47dd" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">首先将您的扬声器连接到您的 Raspberry Pi 并将音频输出切换到耳机插孔，然后通过 SSH 连接到它。将 mpg123 和 cd 安装到您的文件夹中，并使用下面的命令运行脚本。我们在这里使用 sudo 来赋予您的脚本管理权限，因为我们在脚本中使用了 os 函数。</p><p id="fe91" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">安装 mpg123</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="f241" class="kt ku in nr b gy nz oa l ob oc">sudo apt install mpg123</span></pre><p id="4a89" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">运行脚本</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="21f0" class="kt ku in nr b gy nz oa l ob oc">sudo python3 file_name.py</span></pre><p id="6a98" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">如果您的扬声器没有播放声音，请检查此链接<a class="ae ks" href="https://www.raspberrypi.org/documentation/configuration/audio-config.md" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多信息。</p><h2 id="49e7" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">计划 cron 作业</h2><p id="eb91" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">一旦你让你的脚本工作，我们必须使用 crontab 按计划运行 python 脚本。<a class="ae ks" href="https://medium.com/@gavinwiener/how-to-schedule-a-python-script-cron-job-dea6cbf69f4e" rel="noopener">这里的</a>是获取更多信息的好资源。加文·维纳很好地解释了这一点。</p><p id="3bfa" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">要访问您的 crontab，请使用下面的命令。我们在这里使用 sudo，因为我们的脚本需要管理员权限。</p><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="48b1" class="kt ku in nr b gy nz oa l ob oc">sudo crontab -e</span></pre><p id="1cca" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">进入编辑器后，我们需要添加一行来调度 cron 作业。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/e2fd8a2d9e41429a6df9c23513e0ac0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PocGCwjSfV2V1NJasvh4Hg.png"/></div></div></figure><pre class="kd ke kf kg gt nv nr nw nx aw ny bi"><span id="ef44" class="kt ku in nr b gy nz oa l ob oc">0 6 * * * cd /home/pi/Desktop/folder_name &amp;&amp; $(which python3) file_name.py &gt;&gt; ~/cron.log 2&gt;1&amp;1</span></pre><p id="7a46" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">上面的代码行让您在每天早上 6 点运行您的脚本，实际上是在早上 6 点给您一个警报！您可以使用这个<a class="ae ks" href="https://crontab.guru/#0_6_*_*_*" rel="noopener ugc nofollow" target="_blank">链接</a>格式化您自己的 cron 作业。</p><p id="95ed" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">如果你想停止脚本，在终端运行:<code class="fe no np nq nr b">pgrep -af mpg123</code>找到 pid 然后:<code class="fe no np nq nr b">kill &lt;pid&gt;</code></p><p id="5118" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">您可以使用命令<code class="fe no np nq nr b">sudo amixer cset numid=1 70%</code>远程<a class="ae ks" href="http://raspberrypi-aa.github.io/session3/audio.html#:~:text=To%20change%20the%20volume%2C%20run,value%20to%20set%20the%20volume." rel="noopener ugc nofollow" target="_blank">控制音量</a></p></div><div class="ab cl oh oi hr oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ig ih ii ij ik"><h2 id="e174" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">后续步骤</h2><p id="6fea" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">这种设置也可以作为将来升级的基础。因为我们已经用我们的树莓派设置了一个扬声器，一个想法是把你的树莓派变成一个<a class="ae ks" href="https://9to5toys.com/2019/01/03/raspberry-pi-airplay-receiver-setup/" rel="noopener ugc nofollow" target="_blank"> AirPlay 接收器</a>。</p><p id="212a" class="pw-post-body-paragraph lp lq in lr b ls mi jo lu lv mj jr lx lc mk lz ma lg ml mc md lk mm mf mg mh ig bi translated">目前就这些。永远感谢反馈和想法。独立日快乐！</p></div></div>    
</body>
</html>