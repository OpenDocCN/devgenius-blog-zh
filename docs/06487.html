<html>
<head>
<title>Snowflake — All about it Architecture, Caching, Clustering and Virtual Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">雪花—关于it架构、缓存、集群和虚拟仓库的一切</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/snowflake-all-about-it-architecture-caching-clustering-and-virtual-warehouse-f2feb5fbe57b?source=collection_archive---------1-----------------------#2022-01-12">https://blog.devgenius.io/snowflake-all-about-it-architecture-caching-clustering-and-virtual-warehouse-f2feb5fbe57b?source=collection_archive---------1-----------------------#2022-01-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eacb0b35f0682b86e51e8c23a1ae2fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nWBldrnPAvtHpyh5j-T_g.png"/></div></div></figure><p id="f8c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我将更多地讨论雪花架构、雪花中不同缓存层的详细解释、虚拟仓库以及雪花中集群的概念。</p><h1 id="6021" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">行动纲要</h1><ol class=""><li id="aba8" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">雪花建筑</li><li id="6747" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">雪花缓存</li><li id="0548" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">缓存时应注意的几点</li><li id="e98c" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">雪花聚类的概念</li><li id="ca96" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">微分区深度</li><li id="4289" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">选择聚类键</li><li id="ea79" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">群集时的注意事项</li><li id="76fa" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">雪花虚拟仓库</li><li id="864e" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">虚拟仓库中的自动扩展与最大化模式</li><li id="db6d" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">虚拟仓库中的扩展策略</li></ol></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="770d" class="kt ku in bd kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ms lo lp lq bi translated">雪花建筑</h1><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/51fbaed832dd2ac9e1d85a52498c6518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tj54naWk0bxqQH3QdrBtSw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">雪花建筑</figcaption></figure><p id="e55a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">雪花架构解决了共享一切和不共享任何架构的问题。雪花将存储和计算分开，使两者相互独立。这有助于独立地扩展和缩减存储和计算。雪花创建了一个云服务层来实现存储和计算之间的通信。云服务层为您处理一切。您不必担心手动管理存储和计算。</p><blockquote class="nc nd ne"><p id="adc1" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">由于存储不与计算捆绑在一起，并且计算可以独立扩展，这一特性使雪花成为一种<strong class="jx io">多集群共享数据架构</strong></p></blockquote><p id="fdb0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">参考—</em><a class="ae nj" href="https://docs.snowflake.com/en/user-guide/intro-key-concepts.html" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://docs . snow flake . com/en/user-guide/intro-key-concepts . html</em></a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="2643" class="kt ku in bd kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ms lo lp lq bi translated">雪花缓存</h1><p id="a645" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">当我们在雪花工作表中运行查询时，该查询将被提交给云服务层，云服务层将检查是否需要优化查询，然后将其提交给虚拟仓库层，再将数据从存储层拉入虚拟仓库层。考虑下面的参考图:</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/fbbf9df306e3bf4a75a7af86e17cb945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8fu6EFRGsC7ADVQgNaENdw.png"/></div></div></figure><p id="dc57" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们用一个例子来了解更多关于雪花中的缓存。我在雪花样本表'<em class="nf"> CUSTOMER' </em>'中对整个数据运行一个选择查询。一旦查询完成，我们可以通过点击查询来查看整个时间消耗和统计数据</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/26ea1facee9a1ed695b6140711549d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srcaE_LrhofriyQHI7kZUA.png"/></div></div></figure><p id="5c14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您查看查询配置文件时，自从我第一次运行查询以来，它从<strong class="jx io">远程磁盘IO </strong>读取数据，这是我们的存储层。查询中的处理(在我的运行中占57%)是将来自存储层的列数据(高度压缩和加密)处理成所需的结果输出。如果您不知道配置文件概述中的<strong class="jx io">本地磁盘IO </strong>，它是来自虚拟仓库的存储缓存。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/db9aa22367c5ad60f686e0602f57375e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dx64jEMgtopVGI1CvbwjDw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">从客户中选择*</figcaption></figure><p id="6c6d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在另一个例子中，我再次在同一个表上运行不同的查询。现在，由于已经从远程磁盘IO扫描了数据，这次更多地从本地磁盘IO使用数据，这意味着结果已经缓存到虚拟仓库的本地缓存中。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/8af5fecdc477cb923669ae41357eda6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dpjXUZ0X3tN1NqFgqIAiYQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">从客户中选择DISTINCT(*)</figcaption></figure><p id="db45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一段时间后，我的虚拟仓库被挂起，现在如果我再次运行select查询，它将不会再次启动我的虚拟仓库来处理该查询，但它会再次从云服务层缓存中获取相同的结果。您可以看到这样的结果，我重用了旧查询的结果，并花了几毫秒来处理它。</p><p id="9624" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这证实了雪花的智能特性，即任何用户运行相同的查询，都不必一次又一次地计算成本。因为相同的结果被缓存在云服务层，所以它独立于用来生成它的虚拟仓库，也独立于运行它的用户。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/9b4092ed3848b6c775b6b98c8fd49b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83CSP7HpYxQGHaiS7vGO1w.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">从客户中选择*</figcaption></figure><p id="0a32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您也可以通过运行ALTER SESSION SET USE _ CACHED _ RESULT = FALSE来禁用云服务层缓存；通过这样做，如果您再次运行相同的查询，那么它将不会使用来自云服务层的缓存结果，而是会使用本地磁盘IO缓存，即虚拟仓库层缓存。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/faf824a892c863e8a11f00415946a007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q61SWdEDPeNBRNSxSlA29g.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">从虚拟仓库本地磁盘缓存生成的结果</figcaption></figure><h2 id="d3c0" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">需要注意的要点:</h2><ol class=""><li id="6a5a" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">无论何时运行查询，都需要将虚拟仓库附加到工作表中。</li><li id="1e96" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">如果您正在寻找数据的概览，则在运行Select * from表查询时，始终首选limit子句。否则，如果您的表是TB大小的，您可能会在运行虚拟仓库上花费更多的时间。</li><li id="976d" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">每当虚拟仓库进入挂起状态时，本地磁盘缓存就会被清除。因此，在开发环境中，始终要尽量长时间保持自动挂起状态，这样就不必花费更多的计算成本从存储层提取数据</li><li id="40e3" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">总是与一组在公共桌子上工作的人共享虚拟仓库。由于它们将使用相同的查询，因此您可以利用云服务缓存以及本地磁盘IO缓存的优势。</li><li id="d2cc" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">在雪花中重用查询结果是免费的。</li><li id="be0e" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">从最后一次执行查询开始，雪花查询结果被缓存<strong class="jx io"> 24小时</strong>。</li><li id="8c3d" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">雪花不收取缓存结果的费用。</li><li id="1d6f" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">如果您在表中进行任何更改(更新/删除)，这些更改会实时反映出来，如果您再次提取数据，刷新后的数据将再次从远程磁盘IO中提取。因此，<strong class="jx io"><em class="nf"/>总是立即执行更新/删除查询，然后提取数据，否则您将花费越来越多的计算成本来从远程磁盘IO(存储层)提取数据<em class="nf"/></strong></li></ol><blockquote class="nc nd ne"><p id="fc0d" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">注意:如果禁用云服务层缓存，每当虚拟仓库进入挂起状态时，在虚拟仓库中进行的缓存将被清除。在这种情况下，将再次从存储层(远程磁盘IO)获取数据。</p></blockquote><p id="f774" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">参考—</em><a class="ae nj" href="https://community.snowflake.com/s/article/Caching-in-Snowflake-Data-Warehouse" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://community . snow flake . com/s/article/Caching-in-snow flake-Data-Warehouse</em></a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="a140" class="kt ku in bd kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ms lo lp lq bi translated">雪花聚类</h1><p id="3aa4" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">每当我们在雪花中运行查询时，它首先被提交到云服务层。云服务层将执行查询优化，并创建执行计划，然后提交给虚拟仓库节点。</p><p id="252a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，节点首先下载所有文件的表文件头，并基于来自这些头文件的元数据信息，相应地扫描微分区。</p><p id="c6df" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">微分区中的数据列以高度压缩的列存储形式存储。</p><blockquote class="nc nd ne"><p id="0481" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">在微分区内对记录进行分组的过程称为聚类。</p></blockquote><p id="7cf6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们用一个例子来讨论。假设您在雪花工作表上运行一个查询<strong class="jx io"> Select EMPID，NAME from EMPLOYEE where EMP JD = 11/2</strong>。然后，虚拟仓库层将从微分区中提取头文件，并将处理元数据信息满足查询结果要求的微分区，并修剪剩余的分区。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi od"><img src="../Images/04ed73bc430aa6e9ea87f310dbbdd04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBSlXDGM_tXzBPkMyp6irw.png"/></div></div></figure><p id="733a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果该表有4个微分区(例如，按照映像)，它将只选择前3个微分区，因为它们满足查询条件。根据查询，它将只在头文件中存在的列偏移量的帮助下请求列，这是存储所需要的(而不是整个表的列)。</p><blockquote class="nc nd ne"><p id="0d8f" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">微分区是在数据被插入/加载到表中时根据数据的排序自动创建的。我们还可以通过在create或alter query中使用CLUSTER BY (COLUMN)来添加我们自己的聚集键。</p></blockquote><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/2e62cfbece337224a9a910eb3b68a5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bV_j5n_08Y-U_korpoRnZw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">在雪花中创建集群键的示例</figcaption></figure><p id="f615" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">雪花中的微分区大小在50–500 MB范围内</strong></p><h2 id="96a5" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">微分区深度:</h2><p id="d767" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">在上面的图像示例中，我们注意到分区2和3有重叠的数据(11/2和其他日期的组合)。如果有更多的重叠，雪花将不得不扫描所有的分区，以满足结果请求。重叠的程度被称为微分区深度。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/a7afde9311ab10fce3f352c660eef47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TD3RR3v3MDQ7h6vC35Blg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">微分区深度示例</figcaption></figure><p id="ef10" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从上图中，您可以注意到重叠越多，微分区的深度就越高。您会注意到，深度1被称为恒定微分区，它没有任何重叠。如果您想检查您的表聚类深度和细节，请尝试运行以下查询:</p><p id="f042" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">SELECT SYSTEM $ CLUSTERING _ INFORMATION(' TABLE _ NAME ')；</em></p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/a112c3767de12f76c3a6c52d8577b827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSDWQIfoH047xrvwQQnPRw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">SYSTEM＄CLUSTERING _ INFORMATION命令的结果输出</figcaption></figure><p id="1584" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们想要重新集群现有的表，我们可以使用alter命令，然后我们可以执行<em class="nf">ALTER TABLE ' TABLE _ NAME ' re cluster；</em>为了洗牌分区。</p><h2 id="017f" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">如何选择一个聚类键？</h2><ol class=""><li id="9ca5" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">列更常用于where子句中。</li><li id="1195" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">列更常用于连接条件中。</li><li id="d7d0" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">在聚集键中，列的排序必须是从最低基数到最高基数。<em class="nf">求列的基数—(列中不同的记录数/表中记录总数)</em></li></ol><h2 id="72f8" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">创建集群时的注意事项:</h2><ol class=""><li id="2d2c" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">聚集键并不适用于雪花图中的所有表</li><li id="4cdc" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">表的大小和表的查询性能定义了表的聚集键。</li><li id="95d9" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">通常，当定期或持续对表执行DML时，范围内TB大小的表会从聚类中受益。</li><li id="ee65" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">在创建集群之后，snowflake对在微分区中安排数据所使用的计算成本进行收费。</li><li id="8d49" class="lr ls in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">如果您确定主要查询哪些数据的聚类键，您可以按这些键的顺序将数据加载到表中，而无需创建聚类。它将在此基础上自动创建微分区，从而降低集群的成本。</li></ol><p id="26f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">参考—</em><a class="ae nj" href="https://docs.snowflake.com/en/user-guide/tables-clustering-keys.html" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://docs . snow flake . com/en/user-guide/tables-clustering-keys . html</em></a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="5c4d" class="kt ku in bd kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ms lo lp lq bi translated">雪花虚拟仓库</h1><p id="eba5" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">虚拟仓库只不过是我们用来处理数据的计算资源。虚拟仓库有不同的大小。</p><p id="0903" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">虚拟仓库的规模随着它使用的服务器数量的增加而增加。XS最少，仅使用1台服务器，而6XL最大，使用512台服务器。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/f16c16eb16c237fbe3c6762f85696aa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SJLZ1JNaz9fFEzTxCtt4A.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">雪花中可用的虚拟仓库类型</figcaption></figure><blockquote class="nc nd ne"><p id="375d" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">单个虚拟仓库可以分配给多个用户，单个用户可以分配多个虚拟仓库</p></blockquote><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/4ff4bbcc35ef4961f4d9fd7e1cc5673c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BC3dNX9yDc92kB4Ul9bBJA.png"/></div></div></figure><p id="665b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当多个用户单个虚拟仓库时，我们可以得到查询开始排队时的情况。在这种情况下，我们可以利用多集群虚拟仓库功能，该功能可以根据负载自动扩展和缩减虚拟仓库。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/fd2aeae3bc742127255b664241c6ad3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m09ziM7mk49dCOb8_WuA-Q.png"/></div></div></figure><p id="6814" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在创建仓库时，我们得到两个选项——最大集群和最小集群，它们可用于定义<strong class="jx io">自动缩放模式</strong>。虚拟仓库在启动时会增加最小的群数量，并将根据负载达到最大的群数量。</p><p id="8459" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果设置<em class="nf">最大集群=最小集群</em>，虚拟仓库将在<strong class="jx io">最大化模式</strong>下启动所有最大集群。</p><p id="8e17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您将最大集群选择为1，它将不会向您显示添加最小集群的选项，并且不会成为多集群虚拟仓库。</p><h2 id="5825" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">虚拟仓库中的扩展策略</h2><p id="82fd" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">如果查询排队，或者如果系统检测到有多个查询，则当前运行的集群系统可以执行，标准策略会立即旋转集群。</p><p id="0dec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一方面，经济策略会一直等待，直到系统估计有足够的查询负载可以让新集群保持忙碌至少6分钟。</p><p id="b96c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于标准策略，在连续2-3次成功检查(1分钟间隔)后，雪花会检查负载最少的群集是否可以将其负载重新分配给其他群集。对于经济保单，雪花执行相同的操作，但它会连续检查5-6次成功的检查。</p><p id="60d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">参考— </em> <a class="ae nj" href="https://docs.snowflake.com/en/user-guide/warehouses-overview.html" rel="noopener ugc nofollow" target="_blank"> <em class="nf"> https://docs .雪花. com/en/user-guide/warehouse-overview . html</em></a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><p id="7712" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">想了解更多关于雪花雪专业认证的教学大纲和指南吗？访问我关于“完成Snow-Pro证书的路线图”的文章</p><div class="oj ok gp gr ol om"><a href="https://medium.com/@divyanshsaxenaofficial/roadmap-to-complete-snowflake-snow-pro-certificate-d20cd91699d6" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd io gy z fp or fr fs os fu fw im bi translated">完成雪花雪专业证书的路线图</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">数据工程、数据分析或数据科学领域的所有人员都曾一度需要学习……</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa jt om"/></div></div></a></div></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h2 id="b32e" class="nr ku in bd kv ns nt dn kz nu nv dp ld kg nw nx lh kk ny nz ll ko oa ob lp oc bi translated">关于我</h2><p id="89e5" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg nk ki kj kk nl km kn ko nm kq kr ks ig bi translated">我是Divyansh Saxena，在IBM工作的云数据工程师。我是一个数据发烧友，对多个云平台有所了解，比如微软Azure、亚马逊Web服务、雪花和谷歌云存储。</p><p id="76b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你喜欢这个博客，请分享你的观点，访问<a class="ae nj" href="https://beacons.ai/data.dude" rel="noopener ugc nofollow" target="_blank">https://beacons.ai/data.dude</a>了解我更多；)</p><blockquote class="nc nd ne"><p id="d64a" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">关注我的媒体频道，了解类似话题的定期更新</p></blockquote></div></div>    
</body>
</html>