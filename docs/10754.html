<html>
<head>
<title>Pause/Resume Kafka Consumer using actuator in Spring Cloud Stream</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">《春云流》中使用致动器的卡夫卡消费者暂停/恢复</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/pause-resume-kafka-consumer-using-actuator-in-spring-cloud-stream-147250055e0d?source=collection_archive---------3-----------------------#2022-11-27">https://blog.devgenius.io/pause-resume-kafka-consumer-using-actuator-in-spring-cloud-stream-147250055e0d?source=collection_archive---------3-----------------------#2022-11-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><blockquote class="jk jl jm"><p id="752a" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">简单的例子</p></blockquote><ol class=""><li id="4398" class="km kn in jq b jr js jv jw ko kp kq kr ks kt kl ku kv kw kx bi translated">让我们从添加所需的依赖项开始</li></ol><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="4ead" class="lh li in ld b be lj lk l ll lm">implementation 'org.springframework.boot:spring-boot-starter-actuator'</span></pre><p id="0452" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">2.现在让我们在 application.yml 中公开我的绑定配置的 Spring Boot 执行器端点</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="1b4b" class="lh li in ld b be lj lk l ll lm">management:<br/>  endpoints:<br/>    web:<br/>      exposure:<br/>        include: health,bindings</span></pre><p id="28b2" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">3.现在写一个简单的卡夫卡生产者和卡夫卡消费者</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="8423" class="lh li in ld b be lj lk l ll lm"><br/>@Configuration<br/>@Slf4j<br/>public class KafkaConfiguration {<br/> Random random = new Random();<br/><br/> @Bean<br/> public Supplier&lt;Flux&lt;Integer&gt;&gt; numbersProducer(){<br/>  return () -&gt; Flux.interval(Duration.ofSeconds(5)).map(value -&gt; random.nextInt(10000 - 1) + 1).log();<br/> }<br/><br/> @Bean<br/> public  Consumer&lt;String&gt; numbersConsumer(){<br/>  return (value) -&gt; log.info("Consumer Received : " + value);<br/> }<br/><br/>}</span></pre><p id="ac47" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">4.添加与我们的生产者和消费者相关的配置</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="6354" class="lh li in ld b be lj lk l ll lm"><br/>spring:<br/>  cloud:<br/>    stream:<br/>      function:<br/>        definition: numbersProducer;numbersConsumer<br/>      bindings:<br/>        numbersProducer-out-0:<br/>          destination: numbers<br/>        numbersConsumer-in-0:<br/>          destination: numbers<br/>      kafka:<br/>        binder:<br/>          brokers: localhost:9092<br/>          auto-create-topics: true</span></pre><p id="fdbd" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">主题名称:numbers <br/>我的 kafka broker 正在 9092 端口上运行</p><p id="a5d5" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">5 .现在开始你的动物园管理员和卡夫卡</p><p id="3210" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">6.启动您的应用程序</p><p id="b36b" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">7.你会开始看到消费者的日志</p><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ln"><img src="../Images/c5e314e5b8ab9f2f5c7e94d8f175d808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tytA4BWcndXAV-B_4iUtNA.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">消费者日志</figcaption></figure><p id="dc58" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">8.现在让我们使用下面的 curl 来尝试在我们的应用程序中配置所有的绑定。</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="9c6c" class="lh li in ld b be lj lk l ll lm">curl --location --request GET 'http://localhost:9001/actuator/bindings' \<br/>--data-raw ''</span></pre><p id="8fa7" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">响应:我的应用程序中只有 2 个绑定，所以结果将包含如下所示的 2 个绑定</p><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lz"><img src="../Images/d61f71580c783884b96129412bb0dbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-Nj55UinJmRPm1wHkEINg.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">消费者绑定</figcaption></figure><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lz"><img src="../Images/71b947163b666ad6af03a5f9db59d93f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAqDQN3M50jkxpDJOJU7DA.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">生产者绑定</figcaption></figure><p id="0159" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated"><strong class="jq io">注意:</strong>在上面的响应中，观察<strong class="jq io"> State </strong>属性，它指定了绑定的状态。<br/><strong class="jq io">pausable</strong>属性指定我们是否可以暂停绑定。您可以看到，对于生产者绑定，pausable 属性被设置为 false，而对于消费者，该属性被设置为 true。<br/>这表明我们只能暂停消费者。</p><p id="95d1" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">9.现在我们可以尝试使用下面的 curl 来获得特定绑定的结果</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="c319" class="lh li in ld b be lj lk l ll lm">curl --location --request GET 'http://localhost:9001/actuator/bindings/numbersConsumer-in-0' \<br/>--data-raw ''</span></pre><p id="4312" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">响应:现在响应将拥有我们请求的绑定数据。</p><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ma"><img src="../Images/a3d654868f69f29cef15981c53951566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cOY4kU490qe6ilJchDB7Og.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">对请求的绑定的响应</figcaption></figure><p id="90c5" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">9.暂停我们消费者的时间，使用下面的 curl 来暂停消费者</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="3a6d" class="lh li in ld b be lj lk l ll lm">curl --location --request POST 'http://localhost:9001/actuator/bindings/numbersConsumer-in-0' \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "state":"paused"<br/>}'</span></pre><p id="7e98" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">点击上面的卷发给它一秒钟，观察日志，你会停止看到来自消费者的日志</p><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi mb"><img src="../Images/11751aa4fa7ac136a360613623f34d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uovVxgXMslHWDb1W5oLzMA.png"/></div></div></figure><p id="95bc" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ko ka kb kc kq ke kf kg ks ki kj kk kl ig bi translated">10.现在让我们试着让我们的消费者重新行动起来，使用下面的 curl 来恢复我们的消费者并检查日志</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="10b1" class="lh li in ld b be lj lk l ll lm">curl --location --request POST 'http://localhost:9001/actuator/bindings/numbersConsumer-in-0' \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "state":"resumed"<br/>}'</span></pre><figure class="ky kz la lb gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi mb"><img src="../Images/a1b4d2ec415fcad4c87adce2dae0eaff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*So9XP3ZSNJSxLSkGKPnumg.png"/></div></div></figure></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><figure class="ky kz la lb gt lo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/1dea9969ab7223ba6975cb9467a57a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*MXgIxjlRXIQ5ueGtHf3-WQ.png"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">显示</figcaption></figure></div></div>    
</body>
</html>