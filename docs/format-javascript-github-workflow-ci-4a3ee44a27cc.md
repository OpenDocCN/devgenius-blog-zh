# 我学习 GitHub 工作流和持续集成的方法

> 原文：<https://blog.devgenius.io/format-javascript-github-workflow-ci-4a3ee44a27cc?source=collection_archive---------21----------------------->

本文将描述我是如何学习 GitHub 工作流和持续集成的。首先，我正在尝试新的有效步骤来定义需求和解决方案。然后，我重复这两个，直到我找到完整的解决方案。

![](img/ae7bc5075386bab41862dd0d9923006b.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的[窗口](https://unsplash.com/@windows?utm_source=medium&utm_medium=referral)拍摄

# 摘要

我有在 CI 上格式化代码的想法——持续集成。首先，我写下了要求。然后，我想检查代码是否被格式化。我需要对新代码进行一致的格式检查。CI 会确保无论谁输入代码他们都会运行。后来我开始阅读 GitHub 工作流程。四个小时后，我读了几十页，寻找符合我要求的描述。我又读了一个小时，才慢慢理解。我在晚上开始实现它，花了大约三十分钟才完成。安装工作完美无缺。

# 配置项上的格式代码

我想格式化持续集成的代码。凭经验我知道。我需要明确我想做什么。之后我就可以想办法做了。

# 定义需求并寻找解决方案

定义需求并寻找解决方案。重复这些步骤，直到问题得到解决。一个模糊的想法是不够的。下一步是研究如何建立持续集成。我发现我可以使用 GitHub 工作流目录并定义一组步骤来完成它。新的问题是我不知道步骤。我再次重新定义了需求。这一次，我更加精确。我想使用持续集成来格式化代码。我想更漂亮地运行，以检查代码是否格式化。这意味着我需要一个包管理器。这样，我需要安装软件包并运行脚本。这一次，我更接近一个解决方案。是时候搜索信息了。我开始从 GitHub 文档中了解工作流。有很多新名词，但我并没有感到不知所措。这是最重要的。第一页提到了工作流、作业、步骤、动作等。我知道我在找什么，所以不是很多。我发现作业是并行运行的。但是，作业中的步骤是按顺序运行的。

此外，我可以定义每个工作可能依赖于前一个。我不需要这些信息，继续前进。在处理了几个小时的信息后，我休息了一下。我自信我有一个解决方案。然而，我发现了一些问题，并想解决它们。

第一，我不知道 GitHub 的行动是什么。我为什么需要它们？操作是设置作业的一组步骤。这就是我对他们的理解。

其次，我必须检查我的存储库并设置 NodeJS 和 Yarn。在那一点上，我感到更加自信。

第三，当 CI 失败时，我希望 pull 请求失败。我寻找一种方法来做到这一点。我又对了。持续集成默认不会这样做。

最后，我需要建立一个分支保护规则。我为支票打开了一个分支保护规则，但没有列出任何内容。我意识到我需要推送一个工作流来将其添加到分支保护中。最后，事实证明我是对的。

# 让信息深入人心

因为我在忙别的事情，所以我让这些信息渗入了我的大脑。不知道有没有帮助。十二个小时后，我用了相当短的时间来实现它。

# 实施解决方案

我首先添加了一个检查，并确保它失败。然后，我丑化了一个文件，找到了一个更漂亮的命令来检查文件。我运行它来检查文件是否格式化，并通知我没有格式化。输出是我所期望的。然而，我很怀疑，因为它没有抛出错误。更漂亮的文档提到，如果检查发现无格式文件，它返回代码 1。我不知道为什么返回代码是相关的。我只是假设返回代码意味着失败。毕竟，这是它的目的。我致力于这些改变，并描述了它们的目的。然后，我开始编写 YAML 格式的配置。我知道我需要什么，但是我不记得语法了。

首先，我添加了一个姓名和职务字段。然后，为任何分支定义在每次推送时运行的工作流。我不需要一个赤裸裸的操作系统或者所谓的 runner。其次，我添加了一个打开我的存储库并设置 node 和 Yarn 的动作。我想我现在可以运行命令了。第三，我更改了路径，安装了包，并运行了 format 命令。然后，我推了推树枝，但是没有成功。原来我没有用相对路径来改变目录。我解决了这个问题，这次成功了。持续集成检查失败。失败是因为文件没有格式化。我运行格式化命令并推送更改。持续集成这次成功了。是时候验证它是否适用于拉取请求了。没用，我回去配置分支保护规则。这次我的工作流程在列表上。在所有这些步骤之后，持续集成为拉请求和分支工作。这很累，因为我不习惯这种解决问题的方法。我总是一头扎进代码里。因为那个我总是弄得一团糟。最后，我打开了拉请求并合并了更改。我很惊讶我花了五到七个小时写了十四行代码。现在想起来，每一行代码背后都有那么多信息。

# 关键要点

关键要点是:

*   花时间定义需求
*   阅读以找到满足需求的优雅解决方案
*   查找可能影响实现的每个细节

定义明确的需求帮助我保持头脑清晰。通读大量的文本让人不知所措。然而，我在任何时候都没有感到不知所措。我认为这是因为我细化了要求。就像在隐喻中一样。如果你知道你在找什么，你会找到的。

阅读寻找优雅的解决方案意味着解决方案的描述与我们定义的问题非常匹配。因此，我知道什么时候我找到了我需要的东西。

我查找了可能干扰我的持续集成设置的细节。我发现了如何设置纱，但我看到有缓存选项。我意识到这可能会干扰我的解决方案。我查了一下，结果证明我是对的。它加快了持续集成设置的速度，但我并不需要使用它。我只有一个软件包，它安装得很快。我放弃了这个选择。

# 成果和知识库结构

这里是[样本结构](https://github.com/srele96/sk-experiments/tree/149c3f58469bf8ce3c72e8f5cdeced5fb3111e07/javascript/experiments/format-javascript-github-workflow-ci)和[我的需要 ci-sk-experiments](https://github.com/srele96/sk-experiments)的存储库。

我花了几个小时整理这份文件。不可思议吧。

这是文件。我花了几个小时来研究和提出它。我想知道里面的每一块是做什么的。我花了几个小时整理这份文件。不可思议吧。

使用 github 工作流格式化 sk 实验的 yaml 配置