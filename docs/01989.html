<html>
<head>
<title>Network Calls in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤动中的网络呼叫</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/network-calls-in-flutter-6ddd008a3a44?source=collection_archive---------0-----------------------#2020-07-16">https://blog.devgenius.io/network-calls-in-flutter-6ddd008a3a44?source=collection_archive---------0-----------------------#2020-07-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="7f9b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">一个关于使用<strong class="ak"> Dio </strong>的指南，它是Flutter中<code class="fe kc kd ke kf b">http</code>包的一个替代品，用于简化网络请求和干净代码实践的方法。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/040a4aa805bd5983bf0fd73cdc6f060d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TG15UhBxVgKUebm69RVnRg.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">颤振+ Dio = ❤️</figcaption></figure><p id="4a0a" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">每个移动应用程序都必须通过互联网与外部API通信，以提供增强用户体验和增加应用程序功能集的附加功能。这可以包括身份验证、自定义业务逻辑、文件上传等。</p><p id="0bff" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">大多数Flutter开发者使用<code class="fe kc kd ke kf b">http</code>包来实现这一点。虽然这很有效，但是还有一个更好的、不太为人所知的包叫做<a class="ae ls" href="https://pub.dev/packages/dio" rel="noopener ugc nofollow" target="_blank"><strong class="ky io"><em class="lt">Dio</em></strong></a>。</p><blockquote class="lu lv lw"><p id="525d" class="kw kx lt ky b kz la jo lb lc ld jr le lx lg lh li ly lk ll lm lz lo lp lq lr ig bi translated">Dio是Dart的一个强大的HTTP客户端，它支持拦截器、全局配置、表单数据、请求取消、文件下载、超时等。</p></blockquote><h2 id="2f1d" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated"><strong class="ak">目录— </strong></h2><ol class=""><li id="1754" class="mt mu in ky b kz mv lc mw lf mx lj my ln mz lr na nb nc nd bi translated">安装和设置</li><li id="beea" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">基本要求</li><li id="3bce" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">表单数据和文件上传</li><li id="453a" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">截击机</li><li id="e483" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">样板工程</li></ol><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/414fa2bc85a098076695c4d35a6860da.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*PZLPS-m1_iGNudZPyfhewA.gif"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">Giphy的GIF</figcaption></figure><h2 id="4b21" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">1.安装和设置</h2><p id="9c9b" class="pw-post-body-paragraph kw kx in ky b kz mv jo lb lc mw jr le lf nk lh li lj nl ll lm ln nm lp lq lr ig bi translated">要将Dio添加到您的flutter项目中，只需将下面一行添加到您的<code class="fe kc kd ke kf b">pubspec.yaml</code>文件中</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="c26a" class="ma mb in kf b gy nr ns l nt nu">dependencies:<br/>   dio: ^3.0.9</span></pre><p id="78fa" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">然后运行— <code class="fe kc kd ke kf b">flutter pub get</code>(如果您的代码编辑器没有自动获取依赖项的话)。</p><p id="e35d" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">要使用Dio，只需通过调用构造函数来创建Dio实例—</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="5ee5" class="ma mb in kf b gy nr ns l nt nu">import 'package:dio/dio.dart';</span><span id="0a19" class="ma mb in kf b gy nv ns l nt nu">Dio dio = <strong class="kf io">new</strong> Dio();</span></pre><h2 id="1846" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">2.基本要求</h2><p id="01fd" class="pw-post-body-paragraph kw kx in ky b kz mv jo lb lc mw jr le lf nk lh li lj nl ll lm ln nm lp lq lr ig bi translated">让我们首先讨论基本的、<code class="fe kc kd ke kf b">GET</code>、<code class="fe kc kd ke kf b">POST</code>、<code class="fe kc kd ke kf b">PUT</code>和<code class="fe kc kd ke kf b">DELETE</code>请求。我将为每种类型的请求创建单独的函数，这样我们就可以在本文末尾编译的helper类中使用它们的更多细节。</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="3ba3" class="ma mb in kf b gy nr ns l nt nu"><strong class="kf io">void</strong> getHTTP(String url) <strong class="kf io">async</strong> {<br/>  <strong class="kf io">try</strong> {<br/>    Response response = <strong class="kf io">await</strong> dio.<strong class="kf io">get</strong>(url);<br/>    // Do whatever<br/>  } <strong class="kf io">on</strong> DioError <strong class="kf io">catch</strong> (e) {<br/>    // Do whatever<br/>  }<br/>}</span><span id="641f" class="ma mb in kf b gy nv ns l nt nu"><strong class="kf io">void</strong> postHTTP(String url, Map data) <strong class="kf io">async</strong> {<br/>  <strong class="kf io">try</strong> {<br/>    Response response = <strong class="kf io">await</strong> dio.<strong class="kf io">post</strong>(url, data: data);<br/>    // Do whatever<br/>  } <strong class="kf io">on</strong> DioError <strong class="kf io">catch</strong> (e) {<br/>    // Do whatever<br/>  }<br/>}</span><span id="b141" class="ma mb in kf b gy nv ns l nt nu"><strong class="kf io">void</strong> putHTTP(String url, Map data) <strong class="kf io">async</strong> {<br/>  <strong class="kf io">try</strong> {<br/>    Response response = <strong class="kf io">await</strong> dio.<strong class="kf io">put</strong>(url, data: data);<br/>    // Do whatever<br/>  } <strong class="kf io">on</strong> DioError <strong class="kf io">catch</strong> (e) {<br/>    // Do whatever<br/>  }<br/>}</span><span id="b5bc" class="ma mb in kf b gy nv ns l nt nu"><strong class="kf io">void</strong> deleteHTTP(String url) <strong class="kf io">async</strong> {<br/>  <strong class="kf io">try</strong> {<br/>    Response response = <strong class="kf io">await</strong> dio.<strong class="kf io">delete</strong>(url);<br/>    // Do whatever<br/>  } <strong class="kf io">on</strong> DioError <strong class="kf io">catch</strong> (e) {<br/>    // Do whatever<br/>  }<br/>}</span></pre><h2 id="2b53" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">3.表单数据和文件上传</h2><p id="2764" class="pw-post-body-paragraph kw kx in ky b kz mv jo lb lc mw jr le lf nk lh li lj nl ll lm ln nm lp lq lr ig bi translated">大多数应用程序需要将文件/图像作为<code class="fe kc kd ke kf b">multipart/form-data</code>发送到服务器，由于Dio包中所有可用的类和方法，使用Dio很容易实现这一点。</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="0de7" class="ma mb in kf b gy nr ns l nt nu">// Single File with Additional Data<br/>FormData formData = FormData.fromMap({<br/>  "name": "Ryan Dsilva",<br/>  "age": 21,<br/>  "file": <strong class="kf io">await</strong> MultipartFile.fromFile("PATH", filename:"OPTIONAL"),<br/>});</span><span id="124c" class="ma mb in kf b gy nv ns l nt nu">// Multiple Files with Additional Data<br/>FormData formData = FormData.fromMap({<br/>  "name": "Ryan Dsilva",<br/>  "age": 21,<br/>  "files": [<br/>    <strong class="kf io">await</strong> MultipartFile.fromFile("PATH", filename:"OPTIONAL"),<br/>    MultipartFile.fromFileSync("PATH", filename:"OPTIONAL")<br/>  ],<br/>});<!-- --> </span></pre><blockquote class="lu lv lw"><p id="bd54" class="kw kx lt ky b kz la jo lb lc ld jr le lx lg lh li ly lk ll lm lz lo lp lq lr ig bi translated">对于任何想使用同步版本读取文件的人来说，有一个函数——<code class="fe kc kd ke kf b">MultipartFile.fromFileSync()</code>，可以不使用<code class="fe kc kd ke kf b">async</code>关键字。</p></blockquote><p id="1ce3" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">然后，这个FormData对象可以像往常一样作为有效负载在<code class="fe kc kd ke kf b">POST</code>和<code class="fe kc kd ke kf b">PUT</code>请求中发送。</p><blockquote class="lu lv lw"><p id="dd1f" class="kw kx lt ky b kz la jo lb lc ld jr le lx lg lh li ly lk ll lm lz lo lp lq lr ig bi translated"><strong class="ky io">注意事项</strong> —当发送多个文件时，表单数据中的关键字作为<code class="fe kc kd ke kf b">files[]</code>而不是<code class="fe kc kd ke kf b">files</code>发送，即包括方括号。所以如果你的API有问题，不要使用FormData的<code class="fe kc kd ke kf b">fromMap()</code>构造函数，自己构建。我已经浪费了好几个小时来解决这个小细节。</p></blockquote><h2 id="9037" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">4.截击机</h2><p id="a75c" class="pw-post-body-paragraph kw kx in ky b kz mv jo lb lc mw jr le lf nk lh li lj nl ll lm ln nm lp lq lr ig bi translated">几乎每个现代API都由JSON Web令牌保护，将授权令牌附加到头部的做法现在被认为是标准的。Dio和常规的<code class="fe kc kd ke kf b">http</code>包都允许给请求添加头，但是Dio有一个更有趣的东西叫做<strong class="ky io"> <em class="lt">拦截器</em> </strong>。</p><p id="a00c" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">拦截器是在预期动作之前运行的代码块，即在动作完成之前拦截动作。拦截器可以在三个地方运行— <code class="fe kc kd ke kf b">onRequest</code>、<code class="fe kc kd ke kf b">onResponse</code>和<code class="fe kc kd ke kf b">onError</code></p><p id="abdc" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">拦截器适用于每个请求、响应或错误，如果配置如下所示。拦截器的一些常见用例是使用JSON Web令牌的授权、JSON解析等。拦截器的一般结构如下所示—</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="c5b2" class="ma mb in kf b gy nr ns l nt nu">dio.interceptors.add(InterceptorsWrapper(<br/>    onRequest:(RequestOptions options) <strong class="kf io">async</strong> {<br/>     <em class="lt">// Do something before the request is sent</em><br/>     <strong class="kf io">return</strong> options;<br/>    },<br/>    onResponse:(Response response) <strong class="kf io">async</strong> {<br/>     <em class="lt">// Do something with response data</em><br/>     <strong class="kf io">return</strong> response;<br/>    },<br/>    onError: (DioError e) <strong class="kf io">async</strong> {<br/>     <em class="lt">// Do something with response error</em><br/>     <strong class="kf io">return </strong>e;<br/>    }<br/>));</span></pre><p id="579b" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">对于附加JSON Web令牌的情况，拦截器可以编写如下</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="f6f8" class="ma mb in kf b gy nr ns l nt nu"><strong class="kf io">Dio</strong> addInterceptors(Dio dio) {<br/>  return dio<br/>    ..interceptors.add(InterceptorsWrapper(<br/>    onRequest: (RequestOptions options) =&gt; reqInterceptor(options),<br/>    onError: (DioError e) <strong class="kf io">async</strong> {<br/>      <strong class="kf io">return</strong> e.response.data;<br/>    }),<br/>  );<br/>}</span><span id="2270" class="ma mb in kf b gy nv ns l nt nu"><strong class="kf io">dynamic</strong> reqInterceptor(RequestOptions options) <strong class="kf io">async</strong> {<br/>  // Fetching JWT logic<br/>  const token = '';  <br/>  options.headers.addAll({"Authorization": "Bearer: $token"});<br/>  <strong class="kf io">return</strong> options;<br/>}</span></pre><p id="ed99" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated"><code class="fe kc kd ke kf b">reqInterceptor()</code>从应用程序中获取JWT，并将其添加到请求的头部。</p><h2 id="8721" class="ma mb in bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">5.样板模板</h2><p id="0459" class="pw-post-body-paragraph kw kx in ky b kz mv jo lb lc mw jr le lf nk lh li lj nl ll lm ln nm lp lq lr ig bi translated">如果您已经阅读了所有这些部分，您会知道这会导致大量样板代码，即使使用Dio带来的语法糖，因此我觉得有必要创建一个可以在每个项目中重用的Helper类——更类似于各种模板。这一个文件可以在每个Flutter项目中创建，你已经设置好Dio并准备好了。这也有助于保持代码的可维护性和可读性。</p><p id="7419" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">这是整个助手类—</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d713" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">这是文件的重要部分—</p><ul class=""><li id="4c12" class="mt mu in ky b kz la lc ld lf ny lj nz ln oa lr ob nb nc nd bi translated"><strong class="ky io"> <em class="lt">基本选项</em> </strong> —这些是可用于所有请求的全局设置。比如基本URL、响应类型、超时等。可以在这里设置为全局变量。</li><li id="9a75" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr ob nb nc nd bi translated"><strong class="ky io"> <em class="lt">拦截器</em> </strong> <em class="lt"> </em> —任何必须在请求/响应/错误之前运行的定制拦截器。对大多数人来说，连接JWT几乎是不需要动脑筋的事情，而且可能是大多数应用程序最常见的用例。</li><li id="2175" class="mt mu in ky b kz ne lc nf lf ng lj nh ln ni lr ob nb nc nd bi translated"><strong class="ky io"> <em class="lt">方法</em></strong>——标准的HTTP方法<code class="fe kc kd ke kf b">GET</code>、<code class="fe kc kd ke kf b">POST</code>、<code class="fe kc kd ke kf b">PUT</code>和<code class="fe kc kd ke kf b">DELETE</code>被一个<code class="fe kc kd ke kf b">try..catch</code>块包围，该块捕获<code class="fe kc kd ke kf b">DioError</code>对象，这是Dio包装任何出现的错误的方式。</li></ul><p id="fdea" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">要使用这个类，只需创建一个对象，然后在需要的地方调用相应的方法</p><pre class="kh ki kj kk gt nn kf no np aw nq bi"><span id="1af0" class="ma mb in kf b gy nr ns l nt nu">ApiBaseHelper api = ApiBaseHelper();</span><span id="8aba" class="ma mb in kf b gy nv ns l nt nu">Response res = api.get('ENDPOINT_URL');</span></pre><p id="356c" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">就是这样！我希望你学到了新的东西，并很高兴在你的下一个项目中尝试Dio。非常感谢你能走到这一步。如果这篇文章对你有帮助，请分享，感谢你的反馈。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/1cee5c9cabde6ac5d07db3d430eb8bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*iK4RVI63e3UTJcP_STzdzA.gif"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">男高音GIF</figcaption></figure><p id="e728" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">我很快会带着更多的内容回来！在GitHub上关注我，了解我的最新项目—</p><div class="od oe gp gr of og"><a href="https://github.com/RyanDsilva" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">RyanDsilva -概述</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">21 ●全栈网络/应用开发者● Python和深度学习●自然语言处理● Flutter ●音乐家…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="oq l or os ot op ou kq og"/></div></div></a></div></div><div class="ab cl ov ow hr ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ig ih ii ij ik"><p id="cffe" class="pw-post-body-paragraph kw kx in ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">[1] Dio by扑华—<a class="ae ls" href="https://pub.dev/packages/dio" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/dio</a></p><div class="od oe gp gr of og"><a href="https://pub.dev/packages/dio" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">飞镖包</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk">Language: English | 中文简体 A powerful Http client for Dart, which supports Interceptors, Global configuration, FormData…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">公共开发</p></div></div><div class="op l"><div class="pc l or os ot op ou kq og"/></div></div></a></div></div></div>    
</body>
</html>