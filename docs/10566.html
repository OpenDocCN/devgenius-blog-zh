<html>
<head>
<title>Simulating Multi-cluster Environment for Druid Nodes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟 Druid 节点的多集群环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/simulating-multi-cluster-environment-for-druid-nodes-323a414e37c2?source=collection_archive---------9-----------------------#2022-11-11">https://blog.devgenius.io/simulating-multi-cluster-environment-for-druid-nodes-323a414e37c2?source=collection_archive---------9-----------------------#2022-11-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2b0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文演示了如何在本地机器上设置生产环境和模拟安全特性。这些步骤将会很简单，并且包含更少的理论。参考资料链接相同的情况下，有人需要它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3feead3ee664e6f5ac4a7eed398771dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYswwE0q-uYee7wZsWm5qQ.png"/></div></div></figure><h1 id="0b43" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">在本地机器上安装德鲁伊</strong></h1><p id="f54c" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated"><a class="ae lx" href="https://druid.apache.org/docs/latest/tutorials/index.html" rel="noopener ugc nofollow" target="_blank">跟随此链接</a>。如果您能够访问图 1 所示的页面，那么您的方向是正确的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/7cf61823f3dfd43029ad7fc78dd91df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTGaP-p_VLwkeWtBGCQnzw.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图 1:德鲁伊路由器仪表板</figcaption></figure><h1 id="94ef" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">决定要运行的集群类型</h1><p id="83bc" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">现在我们应该决定我们需要模拟什么类型的环境。对于本文，让我们模拟 2 个主集群、2 个查询集群和 2 个数据集群。</p><p id="e5b4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在你一定在下载了德鲁伊设置的地方看到了一个文件夹。该文件夹将如图 2 所示。将此特定文件夹视为一个群集。现在在相同的路径下复制这个文件夹。副本的数量应该等于您想要运行的集群的数量(在我们的例子中，是 6)。相应地重命名文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/584d65b47e7073668a35914985c3a10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*eXUZGmtYThht0_DQrwryMA.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图片 2</figcaption></figure><p id="dd37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在你的文件夹结构应该如图 3 所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/f927323430b3d9e77d842c232f1d1914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXRwa25ckru4GzmR91um1Q.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图 3</figcaption></figure><p id="2eef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">既然我们现在已经创建了 6 个节点(集群)，我们应该更改每个节点的端口，以便它们可以独立运行。要更改它们，请参考图 4。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/ed2ff46406fd408ad6ec5c13153f24f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*oqaIh21JOiKZHbg0_9Ddtw.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图 4</figcaption></figure><p id="0c03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">案例 A:主节点:</strong></p><p id="7409" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于主文件夹，在导航到图 4 之后的文件夹，并在最后打开主文件夹后，应该有一个名为<em class="mg">协调器过载的文件夹。</em>打开该文件夹，并在 runtime.properties 文件中更改端口。</p><p id="d4d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">情况 B:数据节点:</strong></p><p id="44b1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于数据节点，在导航到图 4 之后的文件夹，并打开最后的数据文件夹后，应该有三个名为<em class="mg">historic、indexer 和 middleManager 的文件夹。</em>打开这些文件夹，在 runtime.properties 文件中更改端口。</p><p id="4881" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">案例 C:查询节点:</strong></p><p id="9648" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于查询节点，在导航到图 4 之后的文件夹，并打开最后的查询文件夹后，应该有两个名为<em class="mg"> broker 和 router 的文件夹。</em>打开这些文件夹，并在 runtime.properties 文件中更改端口。</p><p id="958c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为方便起见，您可以遵循以下配置(更改端口，保持文件的其余部分不变):</p><h2 id="2ff0" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">master_0:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="fe87" class="my kv in mu b be mz na l nb nc">druid.plaintextPort=8081 </span></pre><h2 id="8f8d" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">master_1:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="f591" class="my kv in mu b be mz na l nb nc">druid.plaintextPort=7081</span></pre><h2 id="0140" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">数据 _0:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="a0ac" class="my kv in mu b be mz na l nb nc">historical:<br/>druid.plaintextPort=4083<br/><br/>indexer:<br/>druid.plaintextPort=4091<br/><br/>middleManager:<br/>druid.plaintextPort=4091</span></pre><h2 id="099d" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">数据 _1:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="2415" class="my kv in mu b be mz na l nb nc">historical:<br/>druid.plaintextPort=5083<br/><br/>indexer:<br/>druid.plaintextPort=5091<br/><br/>middleManager:<br/>druid.plaintextPort=5091</span></pre><h2 id="f514" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">查询 _0:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="0351" class="my kv in mu b be mz na l nb nc">broker:<br/>druid.plaintextPort=3082<br/><br/>router:<br/>druid.plaintextPort=8889</span></pre><h2 id="48ee" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">查询 _1:</h2><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="e298" class="my kv in mu b be mz na l nb nc">broker:<br/>druid.plaintextPort=2082<br/><br/>router:<br/>druid.plaintextPort=8888</span></pre><p id="6505" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一步是管理动物园管理员。您将需要两个动物园管理员来管理两个主节点。</p><p id="b4ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过以下链接下载 zookeeper:<a class="ae lx" href="https://zookeeper.apache.org/releases.html" rel="noopener ugc nofollow" target="_blank">https://zookeeper.apache.org/releases.html</a>对于本教程，我们将继续使用 3.7.1 版本，这是本文撰写时最新的稳定版本。</p><p id="b51e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">复制这个下载的 zookeeper 的内容，并制作这个文件夹的 2 个副本，然后重命名。新的文件夹结构应该如图 5 所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/303c81ee26e3bb835df5679f0f0718eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9e4MRN2rvDUhp3sbudFGg.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图 5</figcaption></figure><p id="dc20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们应该更改动物园管理员的一些配置，如下所示:</p><h2 id="6cd5" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">zookeeper_0/conf/zoo.cfg</h2><pre class="kj kk kl km gt mt mu ne nf aw ng bi"><span id="4dcb" class="mh kv in mu b gy nh ni l nj nc">tickTime=2000</span><span id="c0bf" class="mh kv in mu b gy nk ni l nj nc">dataDir=/Users/ashutosh/Downloads/DRUID_AUTH_SIMULATION/zookeeper_0/logs (Absolute path where zookeeper_0 logs folder is present)</span><span id="79d2" class="mh kv in mu b gy nk ni l nj nc">clientPort=2181</span></pre><h2 id="0baa" class="mh kv in bd kw mi mj dn la mk ml dp le jv mm mn li jz mo mp lm kd mq mr lq ms bi translated">zookeeper_1/conf/zoo.cfg</h2><pre class="kj kk kl km gt mt mu ne nf aw ng bi"><span id="e17a" class="mh kv in mu b gy nh ni l nj nc">tickTime=2000</span><span id="70c0" class="mh kv in mu b gy nk ni l nj nc">dataDir=/Users/ashutosh/Downloads/DRUID_AUTH_SIMULATION/zookeeper_1/logs (Absolute path where zookeeper_1 logs folder is present)</span><span id="2ccd" class="mh kv in mu b gy nk ni l nj nc">clientPort=3181</span></pre><p id="8b84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">设置好所有这些之后，运行不同终端中的所有节点并检查<a class="ae lx" href="http://localhost:8888" rel="noopener ugc nofollow" target="_blank"> http://localhost:8888 </a>，该链接应该会将您重定向到初始仪表板，但会有一些细微的变化，如图 6 所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/47da3a5b228764aa08d3bf50782ab632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbj46Sh0z4awvKKQxVW_eg.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">图 6</figcaption></figure><p id="aa22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:关于如何在 druid 集群节点中启用 TLS 的文章将很快上线，链接将附在本文中。</p><p id="7f60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢阅读！！如果你有任何建议，请联系 ashutosh.garg.code@gmail.com</p><h1 id="ea3f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">参考资料:</h1><div class="nm nn gp gr no np"><a href="https://zookeeper.apache.org/doc/r3.3.3/zookeeperStarted.html#sc_RunningReplicatedZooKeeper" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">动物园管理员入门指南</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">本文档包含的信息可以帮助您快速开始使用 ZooKeeper。它主要面向开发人员…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">zookeeper.apache.org</p></div></div></div></a></div><div class="nm nn gp gr no np"><a href="https://druid.apache.org/docs/latest/tutorials/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">快速入门(本地)阿帕奇德鲁伊</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">该快速入门使用微型快速入门配置让您开始使用 Apache Druid，并向您介绍…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">druid.apache.org</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ks np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://zookeeper.apache.org/doc/r3.3.3/zookeeperStarted.html" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">动物园管理员入门指南</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">本文档包含的信息可以帮助您快速开始使用 ZooKeeper。它主要面向开发人员…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">zookeeper.apache.org</p></div></div></div></a></div></div></div>    
</body>
</html>