<html>
<head>
<title>The missing socket files of brick in glusterfs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">格鲁斯特夫斯缺失的砖的插座文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/the-missing-socket-files-of-brick-in-glusterfs-58ed2536160f?source=collection_archive---------3-----------------------#2020-10-04">https://blog.devgenius.io/the-missing-socket-files-of-brick-in-glusterfs-58ed2536160f?source=collection_archive---------3-----------------------#2020-10-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="24cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有一天，在与 glusterfs 一起工作时，我发现了一些奇怪的事情。I/O 正常进行，所有的砖块进程也在节点上运行，但是在尝试获取卷的状态时，我发现某些砖块处于停止状态！很奇怪不是吗？</p><p id="ca3e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将探究到底是什么造成了这一点，为什么不与叶旧袜子文件。</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="14bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，我开始深入挖掘(这是一个查看日志的时髦术语。如果没有日志，对于任何项目中的任何问题，调试都将是一项艰巨的任务！).现在，程序块进程已经启动，I/O 照常进行，没有任何停顿…那么，谁该受到责备呢？</p><p id="3e56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在跳到日志分析(日志的 grep 的时髦术语)之前，我实际上已经尝试了通常的方法</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="e536" class="ky kz in ku b gy la lb l lc ld"># gluster vol start &lt;volume-name&gt; force</span></pre><p id="c708" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">甚至</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="7eea" class="ky kz in ku b gy la lb l lc ld"># systemctl restart glusterd</span></pre><p id="1aa4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，砖块进程正在运行，glusterd 也在运行，但是 glusterd 仍然认为砖块进程没有启动..</p><p id="020b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">过了一段时间(用头撞木头……也许我们应该对 glusterfs 做些日志分析？而不是手动浏览…)我确实在 glusterd.log 中看到了一些奇怪的东西。</p><ul class=""><li id="7396" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated">glusterd 进程发现 brick 进程已经在运行了(是的，因为我没有杀死它)</li><li id="0ee9" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">它接收/var/run/gluster 中的 sock 文件，该文件特定于 brick 进程，并尝试建立连接。</li><li id="6984" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">出现一条消息，其中砖块的状态设置为已停止！</li></ul><p id="c524" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，下一步自然是检查 sock 文件有什么问题，因为这是用于通信的文件。</p><p id="1941" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你瞧 sock 文件不见了(现在我不知道这是怎么回事…或者为什么…只是它不见了…也许是一些流氓脚本在这里造成的…)。这就是状态被设置为 stopped 的原因，因为 glusterd 无法连接到 brick 进程。</p><p id="07a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我已经在上游提出了一个问题，并且正在考虑对被 glusterd 视为理所当然的 sock 文件路径进行一个健全性检查。</p><p id="e2c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们也许应该检查一下它是否存在，因为我们在尼克斯有相当多的孤儿和僵尸，现在没有人需要一个幽灵:p</p></div></div>    
</body>
</html>