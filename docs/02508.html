<html>
<head>
<title>Laravel API file upload to AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel API 文件上传到 AWS</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-api-file-upload-to-aws-a8e87319b82e?source=collection_archive---------0-----------------------#2020-08-09">https://blog.devgenius.io/laravel-api-file-upload-to-aws-a8e87319b82e?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2c9f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何设置 amazon bucket 并从 Laravel API 应用程序上传文件</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/37f50cf24a0d8930f07f3ab127043ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rks9oGr9mlXCulZZop6gDQ.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">图片作者。由<a class="ae ks" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank">绘制的 SVG 插图</a></figcaption></figure><p id="41ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">亚马逊 S3(简单存储服务)是一个云存储设施，允许上传，存储和检索数据，包括静态网站，图像和文件。你可以在亚马逊的<a class="ae ks" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">官方文档</a>上阅读更多关于 S3 优惠的信息。</p><p id="0c4c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Laravel 提供了驱动程序来方便地连接和上传你的数据到亚马逊 S3，我们将会看到如何。源代码可在<a class="ae ks" href="https://github.com/emygeek/laravel-aws-s3-demo" rel="noopener ugc nofollow" target="_blank">这里</a>获得。本文分为三个部分:</p><ol class=""><li id="4dc4" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><a class="ae ks" href="#7477" rel="noopener ugc nofollow">项目设置</a>，在这里我们创建文档模型以及相关的迁移、控制器和 API 资源</li><li id="4909" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae ks" href="#26e0" rel="noopener ugc nofollow">文件上传</a>，这里我们添加一个脚本来上传文件到 S3</li><li id="7823" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae ks" href="#6959" rel="noopener ugc nofollow">亚马逊存储桶设置</a></li><li id="9dc1" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae ks" href="#2f60" rel="noopener ugc nofollow">环境和配置文件设置</a></li></ol><p id="0c23" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将使用<a class="ae ks" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Postman </a>来测试 API 路由。</p><blockquote class="md me mf"><p id="4d42" class="kt ku mg kv b kw kx jo ky kz la jr lb mh ld le lf mi lh li lj mj ll lm ln lo ig bi translated"><strong class="kv io">免责声明</strong>:本文的重点是亚马逊 S3 的文件上传、检索和删除。API 认证超出了本文的范围。如果需要的话，阅读更多关于<a class="ae ks" href="https://laravel.com/docs/7.x/passport" rel="noopener ugc nofollow" target="_blank">护照认证</a>的内容，但是理想情况下，应该对通过 API 发出请求的用户进行认证。</p></blockquote><h2 id="7477" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">项目设置</h2><p id="bd92" class="pw-post-body-paragraph kt ku in kv b kw nd jo ky kz ne jr lb lc nf le lf lg ng li lj lk nh lm ln lo ig bi translated">让我们创建一个新的 Laravel 项目</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="99b8" class="mk ml in nj b gy nn no l np nq">composer create-project --prefer-dist laravel/laravel laravel-aws-demo</span></pre><p id="6d2b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">移动到项目中，创建文档模型和相关的迁移。</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="09d6" class="mk ml in nj b gy nn no l np nq">cd laravel-aws-demo &amp;&amp; php artisan make:model Models/Document -m</span></pre><p id="2eeb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们修改文档迁移。</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="6958" class="mk ml in nj b gy nn no l np nq">Schema::create('documents', function (Blueprint $table) {<br/>    $table-&gt;id();<br/>    $table-&gt;string('name');<br/>    $table-&gt;string('path');<br/>    $table-&gt;timestamps();<br/>});</span></pre><blockquote class="md me mf"><p id="0991" class="kt ku mg kv b kw kx jo ky kz la jr lb mh ld le lf mi lh li lj mj ll lm ln lo ig bi translated">在您的模型上，您可以使用 UUID 而不是自动递增 ID 作为您的主键。我已经在这篇文章的<a class="ae ks" href="https://medium.com/@emymbenoun/how-to-use-uuids-instead-of-auto-increment-ids-in-your-laravel-app-2e6cc045f6c1" rel="noopener">中介绍了在 Laravel 中使用 UUID。</a></p></blockquote><p id="d365" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">为了将</strong> <a class="ae ks" href="https://laravel.com/docs/7.x/filesystem#driver-prerequisites" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">连接到 Laravel app 内的 s3 bucket </strong> </a> <strong class="kv io">，需要安装这个必需的包:</strong></p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="811b" class="mk ml in nj b gy nn no l np nq">composer require league/flysystem-aws-s3-v3 ~1.0</span></pre><p id="1cb4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，用您的数据库凭证更新您的<code class="fe nr ns nt nj b">.env</code>文件。然后运行<code class="fe nr ns nt nj b">php artisan migrate</code>。</p><h2 id="26e0" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">文件上传</h2><p id="1d64" class="pw-post-body-paragraph kt ku in kv b kw nd jo ky kz ne jr lb lc nf le lf lg ng li lj lk nh lm ln lo ig bi translated">让我们创建文件上传控制器。在这个演示中，我们将只关注存储和销毁方法。</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="2e99" class="mk ml in nj b gy nn no l np nq">php artisan make:controller DocumentsController --api</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3907" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当<code class="fe nr ns nt nj b">store()</code>方法运行时，将在 s3 bucket(我们将在<code class="fe nr ns nt nj b">.env</code>文件中指定)中创建一个文件夹‘user _ documents ’,该文件夹将包含我们上传的文件。文件名将被散列。如果你想指定文件名，你可以使用<code class="fe nr ns nt nj b">storeAs()</code>方法。因为我们没有使用默认的存储路径，所以我们需要指定将要使用的磁盘，在本例中是<code class="fe nr ns nt nj b">s3</code>。同样适用于销毁方法，我们需要指定<code class="fe nr ns nt nj b">s3</code>磁盘。</p><p id="243e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在让我们创建一个文档<a class="ae ks" href="https://laravel.com/docs/7.x/eloquent-resources" rel="noopener ugc nofollow" target="_blank">资源</a>来格式化发送给用户<code class="fe nr ns nt nj b">php artisan make:resource DocumentResource</code>的响应</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="e358" class="mk ml in nj b gy nn no l np nq">&lt;?php</span><span id="2e80" class="mk ml in nj b gy nw no l np nq">namespace App\Http\Resources;</span><span id="a51e" class="mk ml in nj b gy nw no l np nq">use Illuminate\Http\Resources\Json\JsonResource;<br/>use Storage;</span><span id="62d0" class="mk ml in nj b gy nw no l np nq">class DocumentResource extends JsonResource<br/>{<br/>    /**<br/>     * Transform the resource into an array.<br/>     *<br/>     * <a class="ae ks" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a>  \Illuminate\Http\Request  $request<br/>     * <a class="ae ks" href="http://twitter.com/return" rel="noopener ugc nofollow" target="_blank">@return</a> array<br/>     */<br/>    public function toArray($request)<br/>    {<br/>        return [<br/>            "id" =&gt; $this-&gt;id,<br/>            "name" =&gt; $this-&gt;name,<br/>            "path" =&gt; !empty($this-&gt;path) ? Storage::disk('s3')-&gt;url($this-&gt;path) : '',<br/>        ];<br/>    }<br/>}</span></pre><p id="252e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们更新一下<code class="fe nr ns nt nj b">routes/api.php</code>文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nx"><img src="../Images/22782ac8cda71e1e084b700ef6114bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SqOAXi35X1wU22CkVjlmCg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><h2 id="6959" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">亚马逊帐户设置</h2><p id="b33d" class="pw-post-body-paragraph kt ku in kv b kw nd jo ky kz ne jr lb lc nf le lf lg ng li lj lk nh lm ln lo ig bi translated">前往<a class="ae ks" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务</a>并创建一个账户。您需要输入您的账单详情，才能激活您的账户<a class="ae ks" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank"/>。任何列在他们的<a class="ae ks" href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc" rel="noopener ugc nofollow" target="_blank">免费等级</a>下的服务都是免费的，为期 1 年，只要你不超出他们的使用限制。一旦您的帐户被验证并激活，在顶部菜单，点击服务，并选择 S3。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/be8791e762ad87d8689e3fe59c11db91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQlMwkjE14XcO_5abKXENA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nz"><img src="../Images/9930cf42e9c5f4c1cac425a637c74e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CfYsh6hZFlY_hK2gxBZMFg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="2ed9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">单击创建存储桶按钮。在新页面上，输入唯一的时段名称并选择区域:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oa"><img src="../Images/080ea61f8d05b4fb1c6664bbac00a31e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4US5mWsTpyBNRgbFIE6hRw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="51fb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您的地区没有默认显示，您可以为您的帐户<a class="ae ks" href="https://docs.aws.amazon.com/general/latest/gr/rande-manage.html" rel="noopener ugc nofollow" target="_blank">启用它</a>。</p><blockquote class="md me mf"><p id="9171" class="kt ku mg kv b kw kx jo ky kz la jr lb mh ld le lf mi lh li lj mj ll lm ln lo ig bi translated">根据我的配置，在我的 Laravel <code class="fe nr ns nt nj b">.env</code>文件中，我的区域配置将是<code class="fe nr ns nt nj b">AWS_DEFAULT_REGION=af-south-1</code>。我们稍后将更新<code class="fe nr ns nt nj b">.env</code>文件。</p></blockquote><p id="b37a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下一节允许您设置存储桶的可见性。默认情况下，它被设置为阻止所有访问。您需要取消选中以允许读写访问。</p><p id="eb53" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="mg">警告</em> </strong> <em class="mg">！根据您的要求授予或拒绝对您的存储桶的访问权限。在这里阅读更多关于桶安全的</em><a class="ae ks" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/security-best-practices.html" rel="noopener ugc nofollow" target="_blank"><em class="mg"/></a><em class="mg">)</em></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/d539c178786c54725ae95926d77c68f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJL4fBLF4gGVH3Gl0I8gzA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="9f04" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据您的要求更新以下部分</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oc"><img src="../Images/44f139a696411dd1eaac8b741211b26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnd2h0jM4dL15_wpDDfSDg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/94d8766146fa6fe904d941c8681e41f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O6vJmPKUtyYKMQvq_qNQZQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="2aaa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以稍后更新这些设置。点击<strong class="kv io">创建桶</strong>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/b9528a9556038cbfac54e16115b9d8b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Md38cMuICJZ0e2KFuelmRw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="7be1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是你的桶的样子:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi od"><img src="../Images/37ff6c1139c0a8f6f863c2b4d9310ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbGL-wRqRdhtlwiTe50UOg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="3b29" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">既然创建了 bucket，我们需要设置访问键，API 将使用这些键来连接到我们的 bucket。在顶部菜单中，在您的帐户名称下，选择<code class="fe nr ns nt nj b">Security Credentials</code>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi od"><img src="../Images/d3e7ae955bc7d2094987ebd8946a83b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKqB92Hfu3vbBnsbNNXH4Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="6408" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">单击左侧边栏上的用户，然后单击添加用户按钮:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/8380e0c12816dfa6ca085915a70620bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCWWBiLPUUNrl57tg1igCg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="cab2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们开始吧。步骤 1:创建新用户</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/a8f2072684eb7173a028b2923859187b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OYsOTmgF1IUPqaddBnnGWg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="a512" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第二步:点击<strong class="kv io">直接附加现有策略</strong>。在过滤器中搜索 AmazonS3，并选择 AmazonS3FullAccess，以便能够对 bucket 进行读写访问。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/0666273fef27c8f82055bc9f49f76594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQHPf1ugp9wfstn1cgMEkA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="9012" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">步骤 3:添加标签(可选)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/b71dde72c8889a2214f1f9b2d719cb94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6H3yGu46-LD4B8mnY5qPiQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="586a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第四步:检查你的输入</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/8a3063b2c53c507a6faa0016288e508d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSxxYVSn8Hg6P179pygnkA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><p id="bed9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第 5 步:您的用户创建完毕。<strong class="kv io">复制访问密钥 ID 和秘密访问密钥。</strong>这些值将保存到您的<code class="fe nr ns nt nj b">.env</code>文件中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/5da66f7825ed2f091ec5abe002b282a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1m7PTOYjufvK-BAsPtvC3w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">作者图片</figcaption></figure><h2 id="2f60" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">环境和配置文件设置</h2><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="d432" class="mk ml in nj b gy nn no l np nq">AWS_ACCESS_KEY_ID=PUT_THE_ACCESS_KEY_ID<br/>AWS_SECRET_ACCESS_KEY=PUT_THE_SECRET_ACCESS_KEY<br/>AWS_DEFAULT_REGION=PUT_THE_SELECTED_REGION_CODE<br/>AWS_BUCKET=PUT_YOUR_BUCKET_NAME</span></pre><p id="3519" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">设置文件可见性</strong></p><p id="af9a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">打开<code class="fe nr ns nt nj b">config/filesystems.php</code>文件，它包含我们的 Laravel 应用程序的文件系统配置。向下滚动到文件系统磁盘部分。默认情况下，Laravel 包括本地、公共和 s3 磁盘的配置。您可以自由添加其他磁盘或更新现有磁盘。为了能够在文件上传到亚马逊 S3 后访问/查看文件，您可以将 S3 磁盘的可见性更改为公共。</p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="ae31" class="mk ml in nj b gy nn no l np nq">'visibility' =&gt; 'public',</span></pre><p id="91bc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您的 s3 设置将如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nx"><img src="../Images/075ef9657fb659528782cfd12f73e782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtP-Q4x6p8kAgH5i-3FflQ.png"/></div></div></figure><blockquote class="md me mf"><p id="f116" class="kt ku mg kv b kw kx jo ky kz la jr lb mh ld le lf mi lh li lj mj ll lm ln lo ig bi translated">如果您不希望默认情况下可以访问上传到 s3 存储桶的所有文件，而不是将 S3 磁盘的可见性设置添加/更新为 public，您可以基于每个文件来执行此操作。例如，在存储文件时，您需要将可见性设置为 public，如下所示:</p></blockquote><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="60d0" class="mk ml in nj b gy nn no l np nq">$documentPath = $request-&gt;file('document')-&gt;store($base_location, ['disk' =&gt; 's3', 'visibility' =&gt; 'public']);</span></pre><p id="2b7f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">测试</strong></p><p id="506c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们去找邮递员吧。创建新的发布请求。选择正文&gt;表单-数据。</p><p id="10d7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">输入屏幕截图上的密钥名称。默认情况下，属性类型设置为文本。您需要从下拉菜单中选择<strong class="kv io">文件</strong>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/f5b51d1861188adee7e4633312a30212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvNzEWoDnm2piX9Qk_Ys-w.png"/></div></div></figure><p id="653c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦你上传文件并点击<strong class="kv io">发送</strong>，你应该会看到一个类似的结果。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oh"><img src="../Images/ac4bd0fdaef81853851fe3b869434606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jln36rZWlw9utAmIJpT2VA.png"/></div></div></figure><p id="8c57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">数据库将看起来像这样:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/278d10db8b875be123c68b89d7ff8c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1UgZyrTqJH7ntBUULtc9A.png"/></div></div></figure><p id="c84a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">存储桶将显示一个名为 user_documents 的新文件夹，您将在其中找到我们上传的文件:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oj"><img src="../Images/852f3d85c7d1a24fa7774bc184d849f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PpjY1mop2f61dSFu9wjKw.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/4ab35f2db3b7b5d1a045c066e11cdd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*YN7mR91y3O2NjFnvj1FGJA.png"/></div></figure><h2 id="c4ea" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">您可能会遇到的错误</h2><p id="9539" class="pw-post-body-paragraph kt ku in kv b kw nd jo ky kz ne jr lb lc nf le lf lg ng li lj lk nh lm ln lo ig bi translated"><strong class="kv io"> 1-未找到适配器</strong></p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="ca31" class="mk ml in nj b gy nn no l np nq">Class 'League\Flysystem\AwsS3v3\AwsS3Adapter' not found</span></pre><p id="2eef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请确保运行 composer 命令来安装适配器:<code class="fe nr ns nt nj b">composer require league/flysystem-aws-s3-v3 ~1.0</code></p><p id="9c78" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> 2-检索凭证时出错</strong></p><pre class="kd ke kf kg gt ni nj nk nl aw nm bi"><span id="088f" class="mk ml in nj b gy nn no l np nq"><strong class="nj io">Error</strong> retrieving credentials from the instance profile metadata service. (cURL error 7: Failed to connect to xxx.xxx.xxx.xxx port 80: Operation timed out (see https://curl.haxx.se/libcurl/c/libcurl-errors.html)) </span></pre><p id="afe8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">中仔细检查您的 AWS 凭据。环境文件</p><p id="9e01" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> 3-拒绝访问错误</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/9ba8dae375122b8a0661dd9ffe518d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fg79C2mpUuifkMje-IwCLg.png"/></div></div></figure><p id="cdbd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当试图在浏览器上打开 URL 时，您可能会看到此错误。发生这种情况是因为在上传文件时，其可见性被设置为私有。您可以使用<code class="fe nr ns nt nj b">setVisibility</code>方法更改现有文件的可见性。你可以在这里了解更多信息。这也可能是 S3 桶阻止公众访问其数据的一个迹象。</p><h2 id="be81" class="mk ml in bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">结束语</h2><p id="ebf5" class="pw-post-body-paragraph kt ku in kv b kw nd jo ky kz ne jr lb lc nf le lf lg ng li lj lk nh lm ln lo ig bi translated">如果您有任何问题或评论，请在下面留下，或通过 Twitter <a class="ae ks" href="https://twitter.com/MarieInnov" rel="noopener ugc nofollow" target="_blank"> @MarieInnov </a>与我联系。</p></div></div>    
</body>
</html>