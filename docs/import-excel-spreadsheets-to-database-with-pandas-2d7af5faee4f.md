# 用 Pandas 将 Excel 电子表格导入数据库

> 原文：<https://blog.devgenius.io/import-excel-spreadsheets-to-database-with-pandas-2d7af5faee4f?source=collection_archive---------0----------------------->

本教程展示了如何将数据从 excel 电子表格插入到关系数据库中。我们使用 pandas 库，所以本教程对于想要将数据框保存到数据库中的 pandas 用户来说尤其有用。该操作可以在不使用任何附加库的情况下完成。

![](img/34e389458b7ebd367f81de9f1d91eadb.png)

米卡·鲍梅斯特在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

## 导入电子表格

熊猫可以从。csv 格式以及其他 excel 格式(例如。xlsx)。数据框是熊猫的基本实体。它在形状上类似于 excel 中的数据库表或工作表。我将在本教程中使用一个足球数据集，可在[这里](https://www.football-data.co.uk/mmz4281/1819/E0.csv)获得。

## 连接到数据库

我们需要通过 SQLAlchemy 引擎连接到数据库。

连接字符串的格式必须是*方言+驱动程序://用户名:密码@主机:端口/数据库*。这里我将使用 MySQL 数据库，但是 SQLAlchemy 支持 SQL 的其他几种方言，比如 SQLite、Postgresql。

## 插入

我们的数据框架是由足球比赛组成的。我们首先制作一个表，将所有团队放在一个表中。我们保存“HomeTeam”列中的所有唯一值。

值得注意的是，**。to_sql()** 仅适用于数据框，不适用于序列，这就是我们从唯一值构建另一个数据框的原因。

该命令创建一个名为“teams”的新表。但是，该表没有主键。我们可以预先创建表格，然后使用相同的命令。

如你所见， **to_sql** 现在有了两个额外的命令: **index** 和 **if_exists** 。前者在设置为 false 时，会将数据帧的索引设置为不插入表中。在我们的例子中，我们需要这样做，因为带有主键的表会自动生成 id。后者控制当数据库中已经存在一个名为“teams”的表时应该做什么。默认情况下，脚本会失败，因此我们将其更改为 **append** ，这意味着我们的示例会添加到最后。还需要注意的是，我们将 to 系列重命名为“name”。这是因为要求数据框列与表列同名。要重复这个命令，假设您已经预先在 MySQL**中创建了表“teams”。**

## 处理外键

很明显，pandas SQL 连接器不具备处理 SQL 数据库的所有功能，因为它不能在更早的时候设置主键。

让我们创建一个存储所有游戏的表。这个游戏两次引用“teams”表，一次是主队，另一次是客场。因此，我们需要首先从“teams”表中获取所有行的 id。

我们创建一个字典“conversion_dict ”,我们将使用它来修改插入数据帧。我们的新表“games”将有四列，除了两个外键之外，我们还将保存每个队的得分，因此我们使用函数**过滤要插入的列。loc，**我们需要在调用 **to_sql** 函数之前这样做。

然后，可以手动将外键约束添加到表中。还有另一种方法来处理外键。您可以插入主队和客场队的字符串值，而不是外键引用，然后使用 pandas 中的 **merge** 函数，该函数类似于 SQL 中的 **JOIN** 操作。然而，这效率较低。

## 结论

Pandas 具有有用的 SQL 功能。他们不能做你想在数据库中做的所有事情。然而，如果你非常精通熊猫并且不想换库的话，他们会帮你的。