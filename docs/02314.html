<html>
<head>
<title>React Tips — Redirect, Error Handling and Redux, and .env Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 提示—重定向、错误处理和 Redux，以及。环境文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-tips-redirect-error-handling-and-redux-and-env-files-4978e058fbe5?source=collection_archive---------4-----------------------#2020-07-28">https://blog.devgenius.io/react-tips-redirect-error-handling-and-redux-and-env-files-4978e058fbe5?source=collection_archive---------4-----------------------#2020-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/938ab6f05040259cc06d1d8d32c110c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UhQtmtVCt4K51D9Z"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">凯文·基思在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="74dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React 是一个用于创建 web 应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的 React 应用程序的技巧。</p><h1 id="5bd0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">点击时反应按钮重定向页面</h1><p id="4730" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">通过获取<code class="fe me mf mg mh b">history</code>对象，我们可以在单击元素时重定向到页面。</p><p id="b4b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2a7a" class="mq lc iq mh b gy mr ms l mt mu">import React from 'react';<br/>import { useHistory } from "react-router-dom";<br/>function LoginPage () {<br/>  const history = useHistory();<br/>  const onClick = () =&gt; {  <br/>    history.push('new-page');<br/>  }</span><span id="c34d" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;               <br/>      &lt;button<br/>        onClick={onClick}<br/>      &gt;<br/>        Login<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}<br/>export default LoginPage;</span></pre><p id="cbe8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">useHistory</code>得到本机<code class="fe me mf mg mh b">history</code>对象</p><p id="3a7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们定义<code class="fe me mf mg mh b">onClick</code>函数来调用<code class="fe me mf mg mh b">history.push</code>导航到一个新页面。</p><p id="054b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用类组件，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5f5a" class="mq lc iq mh b gy mr ms l mt mu">import { withRouter } from 'react-router-dom';</span><span id="c5af" class="mq lc iq mh b gy mv ms l mt mu">class LoginPage extends Component {<br/>  constuctor() {<br/>    this.routeChange = this.routeChange.bind(this);<br/>  }</span><span id="e10d" class="mq lc iq mh b gy mv ms l mt mu">  onClick() {<br/>    this.props.history.push('forgot-password');<br/>  }</span><span id="e479" class="mq lc iq mh b gy mv ms l mt mu">  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;button onClick={onClick}&gt;Forgot password?&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="d064" class="mq lc iq mh b gy mv ms l mt mu">export default withRouter(LoginPage);</span></pre><p id="177c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">LoginPage</code>类组件。</p><p id="d56b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使<code class="fe me mf mg mh b">history</code> prop 对组件可用，我们将它传递给<code class="fe me mf mg mh b">withRouter</code>。</p><p id="4a9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有调用<code class="fe me mf mg mh b">this.props.history.push</code>方法导航到新页面的<code class="fe me mf mg mh b">onClick</code>方法。</p><p id="d463" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">routerChange</code>方法必须绑定到带有<code class="fe me mf mg mh b">bind</code>的组件，因此我们将组件类设置为<code class="fe me mf mg mh b">this</code>的值。</p><h1 id="68fb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在 JSX 渲染布尔值</h1><p id="96e3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过先将布尔值转换成字符串来呈现 JSX。</p><p id="c722" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6caa" class="mq lc iq mh b gy mr ms l mt mu">Boolean Value: {bool.toString()}</span></pre><p id="6bd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="35e8" class="mq lc iq mh b gy mr ms l mt mu">Boolean Value: {String(bool)}</span></pre><p id="2ad0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f184" class="mq lc iq mh b gy mr ms l mt mu">Boolean Value: {'' + bool}</span></pre><p id="a816" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d9ad" class="mq lc iq mh b gy mr ms l mt mu">{`Boolean Value: ${bool}`}</span></pre><p id="5473" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8bdc" class="mq lc iq mh b gy mr ms l mt mu">Boolean Value: {JSON.stringify(bool)}</span></pre><p id="9709" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有许多方法可以将布尔值转换成字符串。</p><p id="75b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们都很好，除了连接，这可能会令人困惑。</p><h1 id="1d95" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将 event.target 与 React 组件一起使用</h1><p id="86b4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">event.target</code>来获取 DOM 元素的属性。</p><p id="d72f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">dataset</code>属性来获取带有<code class="fe me mf mg mh b">data-</code>前缀的属性。</p><p id="e3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们被认为是自定义属性，允许我们通过元素传递数据。</p><p id="7c93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有一个按钮，那么我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="98c3" class="mq lc iq mh b gy mr ms l mt mu">&lt;button <br/>  data-foo="home" <br/>  data-bar="home" <br/>  onClick={this.props.onClick} <br/>/&gt; <br/>  Button<br/>&lt;/button&gt;</span></pre><p id="eceb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c85e" class="mq lc iq mh b gy mr ms l mt mu">onClick(e) {<br/>   console.log(e.target.dataset.bar, e.target.dataset.foo);<br/>}</span></pre><p id="a452" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从我们用<code class="fe me mf mg mh b">dataset</code>属性单击的按钮中获取<code class="fe me mf mg mh b">foo</code>和<code class="fe me mf mg mh b">bar</code>属性。</p><p id="c6ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">dataset.foo</code>具有<code class="fe me mf mg mh b">data-foo</code>属性的值。</p><p id="abdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">dataset.bar</code>具有<code class="fe me mf mg mh b">data-bar</code>属性的值。</p><h1 id="3e8c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">向 React 项目添加. env 文件</h1><p id="b2e8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们有一个 create-react-app 项目，我们可以添加一个<code class="fe me mf mg mh b">.env</code>文件来添加环境变量。</p><p id="740f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在文件内部，任何以<code class="fe me mf mg mh b">REACT_APP_</code>前缀为前缀的键都被读入应用程序。</p><p id="d6f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以在我们的<code class="fe me mf mg mh b">.env</code>文件中，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0d38" class="mq lc iq mh b gy mr ms l mt mu">REACT_APP_API_KEY=secret</span></pre><p id="b4a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来使用环境变量值:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="68e7" class="mq lc iq mh b gy mr ms l mt mu">fetchData() { <br/>  fetch(`https://example.com?api-key=${process.env.REACT_APP_API_KEY}`)<br/>    .then((res) =&gt; res.json())<br/>    .then((data) =&gt; console.log(data))<br/>}</span></pre><p id="1a94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">process.env</code>对象读取环境变量值。</p><h1 id="0e65" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何向 Input 的 onChange 处理程序传递多个参数</h1><p id="4b4c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以向输入的<code class="fe me mf mg mh b">onChange</code>处理程序传递多个参数。</p><p id="2adf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="aa82" class="mq lc iq mh b gy mr ms l mt mu">&lt;Input <br/>  type="text"<br/>  value={this.state.name}<br/>  onChange={this.onChange.bind(this, this.state.user.id)} <br/>/&gt;</span></pre><p id="cc01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下代码来定义我们的<code class="fe me mf mg mh b">onChange</code>方法:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="17a8" class="mq lc iq mh b gy mr ms l mt mu">onChange(<!-- -->userId<!-- -->, event) {<br/>  const newName = event.target.value;<br/>},</span></pre><p id="6cbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把传入的东西作为第一个参数。</p><p id="a625" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个参数是对象。</p><h1 id="6754" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何用 Redux 和 Axios 捕获和处理错误响应 422</h1><p id="76b1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以调用<code class="fe me mf mg mh b">dispatch</code>来调度 React 组件中的动作。</p><p id="0c1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0da6" class="mq lc iq mh b gy mr ms l mt mu">axios({<br/>  method: 'post',<br/>  responseType: 'json',<br/>  url: `${SERVER_URL}/login`,<br/>  data: {<br/>    username,<br/>    password<br/>  }<br/>})<br/> .then(response =&gt; {<br/>   dispatch(setUser(response));<br/> })<br/> .catch(error =&gt; {<br/>   dispatch({ type: AUTH_FAILED });<br/>   dispatch({ type: ERROR, payload: error.data.error.message });<br/> });</span></pre><p id="a24e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们向 Axios 发出 POST 请求。</p><p id="3bf0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">then</code>回调中，我们获取<code class="fe me mf mg mh b">response</code>并调用<code class="fe me mf mg mh b">dispatch</code>和我们的<code class="fe me mf mg mh b">setUser</code>动作创建者。</p><p id="f4df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用带有回调的<code class="fe me mf mg mh b">catch</code>方法来处理错误。</p><p id="b454" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们称<code class="fe me mf mg mh b">dispatch</code>有无有效载荷。</p><p id="a7ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<code class="fe me mf mg mh b">dispatch</code>会用新的状态值更新存储。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/8b0b659c58a1cf3d90aafe9f7f76a2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B54xJp4GJd9x6zrn"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@anchorlee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">主持人李</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="9299" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f5ae" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以点击重定向页面。</p><p id="d584" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过调用<code class="fe me mf mg mh b">dispatch</code>更新商店来处理 Redux 的错误。</p><p id="1ab7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将布尔值转换成字符串，就可以呈现它们。</p></div></div>    
</body>
</html>