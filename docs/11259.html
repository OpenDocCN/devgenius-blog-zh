<html>
<head>
<title>Creating your first custom react hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建您的第一个自定义 react 挂钩</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/creating-your-first-custom-react-hook-6a812ab031fd?source=collection_archive---------7-----------------------#2022-12-28">https://blog.devgenius.io/creating-your-first-custom-react-hook-6a812ab031fd?source=collection_archive---------7-----------------------#2022-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="1b3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您不熟悉 React 挂钩，它们是跨功能组件重用有状态逻辑和行为的一种方式。它们是在 React 16.8 中引入的，并且已经成为管理组件中的状态和副作用的流行方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0435294d5c8e0c10b7a086ec9a37c59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01NFIfuNYRyaRZM0t4lC8A.jpeg"/></div></div></figure><p id="6eb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">钩子的一个常见用例是从本地存储中存储和检索数据，本地存储是一种 web 存储，允许您在浏览器中存储数据，并在页面刷新之间保存数据。在本教程中，我们将创建一个名为<code class="fe ku kv kw kx b">useLocalStorage</code>的定制钩子，使得在 React 组件的本地存储中存储和检索数据变得容易。</p><p id="ae2e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们使用 Create React App 创建一个新的 React 项目。一旦项目建立，打开你的<code class="fe ku kv kw kx b">App.js</code>文件，从 React 导入<code class="fe ku kv kw kx b">useState</code>钩子。我们稍后还需要<code class="fe ku kv kw kx b">useEffect</code>钩子，所以继续导入它。</p><p id="bf27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，让我们创建我们的<code class="fe ku kv kw kx b">useLocalStorage</code>钩子。在您的项目中，创建一个名为<code class="fe ku kv kw kx b">useLocalStorage.js</code>的新文件，并添加以下代码:</p><pre class="kj kk kl km gt ky kx kz bn la lb bi"><span id="346c" class="lc ld in kx b be le lf l lg lh">import { useState, useEffect } from 'react';<br/><br/>export default function useLocalStorage(key, initialValue) {<br/>  const [storedValue, setStoredValue] = useState(() =&gt; {<br/>    try {<br/>      const item = window.localStorage.getItem(key);<br/>      return item ? JSON.parse(item) : initialValue;<br/>    } catch (error) {<br/>      console.log(error);<br/>      return initialValue;<br/>    }<br/>  });<br/><br/>  const setValue = value =&gt; {<br/>    try {<br/>      const valueToStore =<br/>        value instanceof Function ? value(storedValue) : value;<br/>      setStoredValue(valueToStore);<br/>      window.localStorage.setItem(key, JSON.stringify(valueToStore));<br/>    } catch (error) {<br/>      console.log(error);<br/>    }<br/>  };<br/><br/>  return [storedValue, setValue];<br/>}</span></pre><p id="a765" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个钩子有几个作用:</p><ol class=""><li id="e8ec" class="li lj in jm b jn jo jr js jv lk jz ll kd lm kh ln lo lp lq bi translated">它使用<code class="fe ku kv kw kx b">useState</code>钩子创建一个名为<code class="fe ku kv kw kx b">storedValue</code>的状态，该状态被初始化为在<code class="fe ku kv kw kx b">key</code>参数中指定的键下存储在本地存储器中的值。如果在本地存储器中没有找到值，它使用<code class="fe ku kv kw kx b">initialValue</code>参数作为默认值。</li><li id="167b" class="li lj in jm b jn lr jr ls jv lt jz lu kd lv kh ln lo lp lq bi translated">它创建了一个名为<code class="fe ku kv kw kx b">setValue</code>的函数，允许您更新<code class="fe ku kv kw kx b">storedValue</code>的值并将其保存到本地存储中。</li><li id="4d76" class="li lj in jm b jn lr jr ls jv lt jz lu kd lv kh ln lo lp lq bi translated">它返回一个带有<code class="fe ku kv kw kx b">storedValue</code>和<code class="fe ku kv kw kx b">setValue</code>的数组，就像<code class="fe ku kv kw kx b">useState</code>钩子一样。</li></ol><h2 id="f2f6" class="lw ld in bd lx ly lz dn ma mb mc dp md jv me mf mg jz mh mi mj kd mk ml mm mn bi translated">现在我们有了我们的<code class="fe ku kv kw kx b">useLocalStorage</code>钩子，让我们在我们的<code class="fe ku kv kw kx b">App</code>组件中使用它。首先，导入<code class="fe ku kv kw kx b">App.js</code>文件顶部的钩子:</h2><pre class="kj kk kl km gt ky kx kz bn la lb bi"><span id="bcd5" class="lc ld in kx b be le lf l lg lh">const App = () =&gt; {<br/>  const [name, setName] = useLocalStorage('name', '');<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;input<br/>        type="text"<br/>        placeholder="Enter your name"<br/>        value={name}<br/>        onChange={e =&gt; setName(e.target.value)}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    );<br/>   };</span></pre><p id="e699" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里，我们使用<strong class="jm io"> useLocalStorage </strong>钩子创建一个名为<strong class="jm io"> name </strong>的状态，它被初始化为一个空字符串。我们还将<strong class="jm io">名</strong>键传入挂钩，这样<strong class="jm io">名</strong>的值将存储在本地存储中的<strong class="jm io">名</strong>键下。现在，每当您在输入字段中输入内容时，名称<strong class="jm io">的值就会被更新并保存到本地存储中。您可以刷新页面，由于本地存储的魔力，<strong class="jm io"> name </strong>的值仍然存在！使用<strong class="jm io"> useLocalStorage </strong>挂钩还可以做一些其他的事情。</strong></p><p id="2a8a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，当组件挂载时，您可以使用<strong class="jm io"> useEffect </strong>钩子从本地存储中自动检索值:</p><pre class="kj kk kl km gt ky kx kz bn la lb bi"><span id="5336" class="lc ld in kx b be le lf l lg lh">useEffect(() =&gt; {<br/>const storedName = window.localStorage.getItem('name');<br/>if (storedName) setName(storedName);<br/>}, []);</span></pre><h2 id="9741" class="lw ld in bd lx ly lz dn ma mb mc dp md jv me mf mg jz mh mi mj kd mk ml mm mn bi translated">您也可以向<strong class="ak"> setValue </strong>传递一个函数，根据之前的值更新该值:</h2><pre class="kj kk kl km gt ky kx kz bn la lb bi"><span id="215f" class="lc ld in kx b be le lf l lg lh">setValue(prevName =&gt; prevName + '!');</span></pre><p id="5a94" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望本教程对您有所帮助，向您展示了如何创建和使用自定义钩子来存储和检索 React 组件中本地存储的数据。编码快乐！</p><p id="82d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你喜欢这个博客，请关注我。下一篇博客再见。</p></div></div>    
</body>
</html>