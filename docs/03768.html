<html>
<head>
<title>Django + React Authentication : Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django + React 认证:第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/django-react-authentication-part-1-d351726b284d?source=collection_archive---------0-----------------------#2020-12-14">https://blog.devgenius.io/django-react-authentication-part-1-d351726b284d?source=collection_archive---------0-----------------------#2020-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="74a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 Django，Django Rest 框架，React，React 路由器 Dom 创建一个简单的认证系统。</p><p id="72f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>是我最喜欢的 web 框架。当结合<a class="ae kl" href="https://www.django-rest-framework.org/" rel="noopener ugc nofollow" target="_blank"> Django Rest 框架</a> (DRF)时，它允许你使用 Python 创建强大和健壮的 RESTful API。应用程序中最常见的功能之一是用户身份验证。在这篇文章中，我将指导你使用 Django 和 DRF，以及一些其他的包来创建一个安全的和全功能的认证 API，它使用基于令牌的认证。API 完成后，我们将使用 postman 来测试它，并构建一个 React 前端来消费它。<a class="ae kl" href="https://github.com/tarricsookdeo/django-react-auth" rel="noopener ugc nofollow" target="_blank">这里的</a>是 GitHub repo 的链接，带有完整的代码供您参考。在这一部分，我们将创建 Django 后端 API。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="e058" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">Django 后端 API</h1><p id="a642" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><strong class="jp ir">设置虚拟环境并安装依赖关系:</strong></p><p id="55b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目将使用 pipenv 进行设置。关于 pipenv 的更多信息，你可以在这里查看我的深度文章<a class="ae kl" href="https://levelup.gitconnected.com/beginners-guide-to-pipenv-9340a6c35147?source=friends_link&amp;sk=e91bda5689eddba2934be4b41235c36f" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="cd8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“终端”中转到您想要的项目位置，创建项目文件夹，然后 cd 到其中。我将称它为<code class="fe lw lx ly lz b">django-react-auth</code>:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="cf16" class="mi ku iq lz b gy mj mk l ml mm">mkdir django-react-auth<br/>cd django-react-auth</span></pre><p id="8344" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入项目目录后，使用 pipenv 设置虚拟环境并激活它:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b710" class="mi ku iq lz b gy mj mk l ml mm">pipenv install --python 3.9<br/>pipenv shell</span></pre><p id="dc7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">注意:在撰写本文时，Python 3.9 是 Python 的最新稳定版本。Django 3.1 将用于该项目。由于 async/await 语法的原因，Django 3.1 需要 Python 3.6+。你可以使用任何你喜欢的 Python 版本，只要是 Python 3.6 或更高版本。</em></p><p id="69c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦建立了虚拟环境，您应该会在<code class="fe lw lx ly lz b">django-react-auth</code>目录中看到一个<code class="fe lw lx ly lz b">Pipfile</code>和<code class="fe lw lx ly lz b">Pipfile.lock</code>。我们现在将安装所需的 pip 包。确保您的虚拟环境已激活，并在终端中运行以下内容:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b0bf" class="mi ku iq lz b gy mj mk l ml mm">pipenv install django djangorestframework django-rest-auth django-allauth django-cors-headers</span></pre><p id="9dcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这些 pip 包是什么？</strong></p><p id="71e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Django:Django 框架是整个项目的支柱。</p><p id="b0d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">django-rest-framework: DRF 将为我们提供序列化数据所需的工具，并将我们的 django 应用程序转换成 RESTful API。</p><p id="59f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">django-rest-auth:为我们提供用户认证所需的逻辑和端点。与从头开始编写所有内容相比，节省了大量时间。</p><p id="41f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">django-allauth:允许我们进一步定制认证系统。还提供用户注册所需的端点。</p><p id="75bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">django-cors-headers: Django 附带了很多安全特性。这个包将允许我们指定可以发出请求的域。否则，来自 React 前端的所有请求都将被拒绝。</p><p id="065e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Django 项目和应用:</strong></p><p id="3ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经设置好了，是时候在<code class="fe lw lx ly lz b">django-react-auth</code>目录中创建 Django 项目了:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b903" class="mi ku iq lz b gy mj mk l ml mm">django-admin startproject mysite .</span></pre><p id="5196" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将这个项目命名为<code class="fe lw lx ly lz b">mysite</code>。请注意命令末尾的句点。这将在当前目录下创建项目，而不是创建一个全新的目录。项目文件结构现在应该是这样的。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="fee4" class="mi ku iq lz b gy mj mk l ml mm">- django-react-auth<br/>-- mysite<br/>--- __init__.py<br/>--- asgi.py<br/>--- settings.py<br/>--- urls.py<br/>--- wsgi.py<br/>-- manage.py<br/>-- Pipfile<br/>-- Pipfile.lock</span></pre><p id="bbd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">注意:在现实世界的项目中，您可能会在</em> <code class="fe lw lx ly lz b"><em class="mn">settings.py</em></code> <em class="mn">文件中隐藏敏感信息，比如密钥和数据库凭证。为了简单起见，我们在这里不讨论这些。然而，在一个真实的项目中，请做好你的尽职调查，以防止安全噩梦。</em></p><p id="e31b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在终端中使用以下命令运行 Django 开发服务器:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="7120" class="mi ku iq lz b gy mj mk l ml mm">python manage.py runserver</span></pre><p id="bef8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该在终端中看到类似这样的内容:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/451ef7ad6fa06f0146e96da7b9128f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XcCQ7f-4fSpEccs3xQi3g.png"/></div></div></figure><p id="5d7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您前往<a class="ae kl" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000</a>/您应该看到开发服务器正在运行:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/8f7c308d63202da11915272fe381cbcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTfdx9qIqdQdF6XgNp2o3A.png"/></div></div></figure><p id="fc01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意终端中的未应用迁移警告。重要的是<strong class="jp ir">不要在创建我们的自定义用户模型之前</strong>进行迁移，我们现在就要这样做。</p><p id="86d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建自定义用户模型:</strong></p><p id="5ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自定义用户模型将允许您在以后需要时扩展它。最好是在你开始你的项目时就这样做。Django 官方文档甚至建议创建一个定制的用户模型。我们将用简单的方法来实现这一点，通过扩展已经内置的用户模型。</p><p id="f011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先创建自定义用户模型将存在的<code class="fe lw lx ly lz b">users</code>应用，并将其添加到<code class="fe lw lx ly lz b">settings.py</code>中的已安装应用列表中。</p><p id="58b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在终端中终止开发服务器，并运行以下命令创建应用程序:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bf1b" class="mi ku iq lz b gy mj mk l ml mm">python manage.py startapp users</span></pre><p id="4523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会在项目中看到一个新的<code class="fe lw lx ly lz b">users</code>文件夹，其中有几个文件。将用户应用添加到<code class="fe lw lx ly lz b">settings.py</code>中的<code class="fe lw lx ly lz b">INSTALLED_APPS</code>列表。同时，让我们将通过 pip 安装的第三方应用程序添加到列表中:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="1be0" class="mi ku iq lz b gy mj mk l ml mm"># mysite/settings.py<br/>...<br/>INSTALLED_APPS = [<br/>'django.contrib.admin',<br/>'django.contrib.auth',<br/>'django.contrib.contenttypes',<br/>'django.contrib.sessions',<br/>'django.contrib.messages',<br/>'django.contrib.staticfiles',<br/></span><span id="73b6" class="mi ku iq lz b gy mx mk l ml mm"># 3rd Party Apps<br/>'rest_framework', # new<br/>'rest_framework.authtoken', # new<br/>'rest_auth', # new<br/>'django.contrib.sites', # new<br/>'allauth', # new<br/>'allauth.account', # new<br/>'allauth.socialaccount', # new<br/>'rest_auth.registration', # new<br/>'corsheaders', # new</span><span id="9dd2" class="mi ku iq lz b gy mx mk l ml mm"># Local Apps<br/>'users', # new<br/>]<br/>...</span></pre><p id="d2c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建定制用户模型，请进入<code class="fe lw lx ly lz b">models.py</code>:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="8483" class="mi ku iq lz b gy mj mk l ml mm"># users/models.py</span><span id="54d8" class="mi ku iq lz b gy mx mk l ml mm">from django.contrib.auth.models import AbstractUser<br/>from django.db import models</span><span id="8a28" class="mi ku iq lz b gy mx mk l ml mm">class CustomUser(AbstractUser):<br/>    # Any extra fields would go here<br/>    def __str__(self):<br/>        return self.email</span></pre><p id="3123" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们这里没有任何额外的用户字段。但是，如果我们想添加生日和地址等字段，您可以在这里轻松完成。</p><p id="4418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当您创建一个定制用户模型时，您都需要将 Django 指向它。返回到<code class="fe lw lx ly lz b">settings.py</code>并将它添加到文件的底部:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="40d6" class="mi ku iq lz b gy mj mk l ml mm"># mysite/settings.py</span><span id="b040" class="mi ku iq lz b gy mx mk l ml mm">...</span><span id="a5fc" class="mi ku iq lz b gy mx mk l ml mm">AUTH_USER_MODEL = 'users.CustomUser'</span></pre><p id="d97d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们要向自定义用户模型添加任何额外的字段，我们需要修改内置的表单来处理它们。为此，我们需要创建一个<code class="fe lw lx ly lz b">forms.py</code>文件，并为用户模型扩展 Django 的内置表单类。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="7871" class="mi ku iq lz b gy mj mk l ml mm">touch users/forms.py</span></pre><p id="3c93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加以下代码:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="f19e" class="mi ku iq lz b gy mj mk l ml mm"># users/forms.py</span><span id="a4d7" class="mi ku iq lz b gy mx mk l ml mm">from django import forms<br/>from django.contrib.auth.forms import UserChangeForm,         UserCreationForm </span><span id="2ca7" class="mi ku iq lz b gy mx mk l ml mm">from .models import CustomUser <br/> <br/>class CustomUserCreationForm(UserCreationForm):    <br/>    class Meta:        <br/>        model = CustomUser        <br/>        fields = ('email', )  </span><span id="e420" class="mi ku iq lz b gy mx mk l ml mm">class CustomUserChangeForm(UserChangeForm):    <br/>    class Meta:        <br/>        model = CustomUser        <br/>        fields = UserChangeForm.Meta.fields</span></pre><p id="9735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Django 最好的内置特性之一是管理界面。每当你创建一个新的应用程序，你可以注册它，这样你就可以通过管理界面与它互动。前往<code class="fe lw lx ly lz b">admin.py</code>，放置以下代码:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="dfd4" class="mi ku iq lz b gy mj mk l ml mm"># users/admin.py</span><span id="5a6e" class="mi ku iq lz b gy mx mk l ml mm">from django.contrib import admin<br/>from django.contrib.auth import get_user_model<br/>from django.contrib.auth.admin import UserAdmin</span><span id="89ec" class="mi ku iq lz b gy mx mk l ml mm">from .forms import CustomUserChangeForm, CustomUserCreationForm<br/>from .models import CustomUser</span><span id="c53a" class="mi ku iq lz b gy mx mk l ml mm">class CustomUserAdmin(UserAdmin):    <br/>    add_form = CustomUserCreationForm<br/>    form = CustomUserChangeForm<br/>    model = CustomUser<br/>    list_display = ['email']</span><span id="1ac5" class="mi ku iq lz b gy mx mk l ml mm">admin.site.register(CustomUser, CustomUserAdmin)</span></pre><p id="71a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来关注一下我们的序列化器。使用 DRF，我们将能够轻松地使用一个类序列化器，它会自动将字段序列化为 JSON，并在需要时返回 Python 对象。在用户内部创建一个<code class="fe lw lx ly lz b">serializers.py</code>文件:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bb65" class="mi ku iq lz b gy mj mk l ml mm">touch users/serializers.py</span></pre><p id="e5c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lw lx ly lz b">serializers.py</code>内部:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="2ce9" class="mi ku iq lz b gy mj mk l ml mm"># users/serializers.py</span><span id="9d89" class="mi ku iq lz b gy mx mk l ml mm">from rest_framework.serializers import ModelSerializer</span><span id="afb7" class="mi ku iq lz b gy mx mk l ml mm">from .models import CustomUser</span><span id="8fa3" class="mi ku iq lz b gy mx mk l ml mm">class UserSerializer(ModelSerializer):<br/>    class Meta:<br/>        model = CustomUser<br/>        fields = ('email', 'last_login', 'date_joined', 'is_staff')</span></pre><p id="e352" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是 DRF 如何轻松地将基于 Django 模型的 Python 对象转换成 JSON，反之亦然。注意<code class="fe lw lx ly lz b">fields</code>变量。这是您想要序列化的不同模型属性的元组。</p><p id="4116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来关注将成为 API 端点的 URL。好消息是<code class="fe lw lx ly lz b">django-rest-auth</code>和<code class="fe lw lx ly lz b">django-allauth</code>已经为我们提供了所需的端点和逻辑。所以我们需要做的就是在 users 中的一个<code class="fe lw lx ly lz b">urls.py</code>文件中指定它们。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b96b" class="mi ku iq lz b gy mj mk l ml mm">touch users/urls.py</span></pre><p id="8757" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="5268" class="mi ku iq lz b gy mj mk l ml mm"># users/urls.py</span><span id="e9b8" class="mi ku iq lz b gy mx mk l ml mm">from django.urls import include, path</span><span id="9e4b" class="mi ku iq lz b gy mx mk l ml mm">urlpatterns = [<br/>path('auth/', include('rest_auth.urls')),    <br/>path('auth/register/', include('rest_auth.registration.urls'))<br/>]</span></pre><p id="7100" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要将<code class="fe lw lx ly lz b">users/urls.py</code>添加到<code class="fe lw lx ly lz b">mysite</code>内的<code class="fe lw lx ly lz b">urls.py</code>中:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="0b12" class="mi ku iq lz b gy mj mk l ml mm"># mysite/urls.py</span><span id="7287" class="mi ku iq lz b gy mx mk l ml mm">from django.contrib import admin<br/>from django.urls import include, path</span><span id="f9a9" class="mi ku iq lz b gy mx mk l ml mm">urlpatterns = [<br/>path('admin/', admin.site.urls),<br/>path('api/v1/users/', include('users.urls')),<br/>]</span></pre><p id="4fec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里要做的最后一件事是给<code class="fe lw lx ly lz b">settings.py</code>添加一些配置:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="c5df" class="mi ku iq lz b gy mj mk l ml mm"># mysite/settings.py</span><span id="a11a" class="mi ku iq lz b gy mx mk l ml mm"># Specifies localhost port 3000 where the React<br/># server will be running is safe to receive requests<br/># from. All all of this.<br/>CORS_ALLOWED_ORIGINS = [    <br/>'http://localhost:3000'<br/>]</span><span id="df05" class="mi ku iq lz b gy mx mk l ml mm"># Add the corsheaders middleware to the top of the<br/># middleware list. The middleware list will already<br/># exists and have other items in it.<br/>MIDDLEWARE = [<br/>'corsheaders.middleware.CorsMiddleware',<br/>...<br/>]</span><span id="c131" class="mi ku iq lz b gy mx mk l ml mm"># Django All Auth config. Add all of this.<br/>EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'</span><span id="63a3" class="mi ku iq lz b gy mx mk l ml mm">AUTHENTICATION_BACKENDS = (    "django.contrib.auth.backends.ModelBackend",    "allauth.account.auth_backends.AuthenticationBackend",<br/>)</span><span id="d624" class="mi ku iq lz b gy mx mk l ml mm">SITE_ID = 1 <br/>ACCOUNT_EMAIL_REQUIRED = True<br/>ACCOUNT_USERNAME_REQUIRED = False<br/>ACCOUNT_SESSION_REMEMBER = True<br/>ACCOUNT_AUTHENTICATION_METHOD = 'email'<br/>ACCOUNT_UNIQUE_EMAIL = True</span><span id="a46e" class="mi ku iq lz b gy mx mk l ml mm"># Rest Framework config. Add all of this.<br/>REST_FRAMEWORK = {    <br/>'DATETIME_FORMAT': "%m/%d/%Y %I:%M%P",    'DEFAULT_AUTHENTICATION_CLASSES': [        'rest_framework.authentication.TokenAuthentication',    <br/>],<br/>}</span></pre><p id="7bc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！您已经在 Django 中创建了一个后端 API，它将允许用户使用基于令牌的认证系统进行注册、登录、重置密码等操作。您现在可以迁移更改了。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="83ce" class="mi ku iq lz b gy mj mk l ml mm">python manage.py makemigrations<br/>python manage.py migrate</span></pre><p id="d504" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建超级用户(管理员用户):</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="36e0" class="mi ku iq lz b gy mj mk l ml mm">python manage.py createsuperuser</span></pre><p id="442c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照提示并填写信息，直到您创建了超级用户。</p><h1 id="659e" class="kt ku iq bd kv kw my ky kz la mz lc ld le na lg lh li nb lk ll lm nc lo lp lq bi translated"><strong class="ak">与邮递员一起测试</strong></h1><p id="089a" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>是一个用来测试 API 的工具。它使用简单，而且是免费的。我们将向我们的 API 发出一些请求，看看它是否按预期工作。</p><p id="648e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注册新用户</strong></p><p id="35c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，要注册用户，我们需要一个唯一的电子邮件，一个密码和一个确认密码字段。该请求将如下所示:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nd"><img src="../Images/38b00014bad1e0ae03a9f064cd49d267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PWp0wjgEerQqWVGqc3jo4Q.png"/></div></div></figure><p id="5c71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果成功，它将返回一个我们可以使用的身份验证令牌。否则，我们会得到一个错误。让我们点击发送:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ne"><img src="../Images/f75011cfc2a708d512341603895d9b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oAir4HiDbd6i7Ajyg9ZIrA.png"/></div></div></figure><p id="7862" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会看到我们得到了一个<code class="fe lw lx ly lz b">key</code>。这是认证令牌，我们可以在后续请求中发送它。</p><p id="9009" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注销用户</strong></p><p id="ee3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个令牌，我们可以将它作为一个<code class="fe lw lx ly lz b">Authorization</code>头与 post 请求一起发送到注销端点，如下所示:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nf"><img src="../Images/1287b457cbbfd643690d7f7f5b89a403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w3pkeUe0c0LDfYqELFAmmA.png"/></div></div></figure><p id="0b0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发送请求，它将从服务器端删除令牌，并注销用户。</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ng"><img src="../Images/5f1076cf3ded5eca1661da2e77cffcfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_nJn6YmUsbuZqYugnlE4A.png"/></div></div></figure><p id="aa77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论:</strong></p><p id="32bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经使用 Django 创建了一个认证系统 API！在下一部分中，我们将使用 React 与这个身份验证系统进行交互。敬请期待！</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="97d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇博文，并且觉得它很有用，可以考虑为它鼓掌，并在 Medium 上关注我。此外，考虑使用我的推荐链接在这里注册 Medium<a class="ae kl" href="https://tarricsookdeo.medium.com/subscribe" rel="noopener"/>。只要你还是会员，我就能得到一点回扣。如果你愿意，你也可以在这里给我买杯咖啡。非常感谢！</p></div></div>    
</body>
</html>