# Node.js 最佳实践—微服务

> 原文：<https://blog.devgenius.io/node-js-best-practices-microservices-731cc6608dee?source=collection_archive---------3----------------------->

![](img/6a49245c3a2edec2fb31c40e0ef790e6.png)

安娜·杜德科娃在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。

否则，我们以后会遇到各种各样的问题。

在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。

# 微服务

微服务架构是一种用服务集合来构建应用的风格。

它们非常易于维护和测试。

此外，它们是松散耦合的，所以它们大部分可以独立工作。

它们也可以独立部署。

每项服务都是围绕业务需求组织的。

这种架构让我们能够持续交付和部署大型系统。

我们还可以逐步改进其技术体系。

如果我们正在创建一个简单的应用程序，我们可能不需要微服务。

然而，随着我们系统的增长，我们不想创建一个难以维护和扩展的复杂应用程序。

将它们放在单独的模块中更有意义。

微服务有助于取代在 Docker 等容器解决方案普及之前常见的单片应用。

我们可以将我们的系统划分为具有域驱动设计的微服务。

每个域被划分成互斥的有界上下文。

每个上下文都与一个微服务相关联。

我们的目标是创建一个内聚的、松散耦合的领域模型。

我们可以通过分析我们的领域、定义有界上下文以及定义实体和服务来确定我们需要的微服务。

# Node.js 服务

现在我们将系统划分为微服务，每个微服务都可以有自己的模式来组织代码。

我们的应用程序将是一个 MVC 应用程序，这使得处理模型定义和与应用程序的其余部分的交互更容易。

我们将这些实体划分到它们自己的文件夹中。

MVC 应用程序有控制器来处理请求和响应。

它没有商业逻辑。

服务有业务逻辑。它们被传递给控制器。

控制器可以与许多服务对话。

存储库与模型文件夹中的模型进行交互。

这些是用来查询数据库的，不会有业务逻辑。

模型有模型定义和关联

实用程序有我们的应用程序使用的助手功能。

测试有测试用例。他们针对控制器方法进行测试，以确保最大的代码覆盖率。

# 集群模块

为了最大限度地利用服务器中的 CPU 内核，我们应该创建集群，这样我们就可以使用多个 CPU 内核来运行我们的应用程序。

如果我们在 Docker 之外运行我们的应用程序，这是很有用的。

如果我们在 Docker 中运行我们的应用程序，那么我们每个容器有一个进程，所以我们不需要在 Docker 中用应用程序创建集群。

# Node.js 中的控制流

我们应该承诺在我们的应用程序中运行异步代码。

任何潜在的长期运行的过程都应该写成承诺。

这样，他们就不会阻碍我们应用程序的运行。

承诺是 ES6+原生的，我们不用添加任何东西。

我们也可以将一些模块方法转换成承诺。

fs 模块方法可以转换为承诺。

# 环

我们可以按顺序一步一步地运行循环。

我们可以使用 for-await-of 延迟运行循环。

互不依赖的东西也可以并行运行。

例如,`Promise.all`可用于并行运行多个不相关的承诺。

![](img/9858345d2fc2d63db8ce7823c443c806.png)

[梁杰森](https://unsplash.com/@ninjason?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 结论

微服务架构产生了一致的、松散耦合的服务，这些服务是更大系统的一部分。

这使得维护更容易，我们可以更快地改进。