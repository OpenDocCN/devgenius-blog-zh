<html>
<head>
<title>Vue Router 4–In-Component Guards, Route Meta Fields, and Transitions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue 路由器 4–组件内防护、路由元字段和转换</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/vue-router-4-in-component-guards-route-meta-fields-and-transitions-6c32c3b01c8c?source=collection_archive---------2-----------------------#2020-12-23">https://blog.devgenius.io/vue-router-4-in-component-guards-route-meta-fields-and-transitions-6c32c3b01c8c?source=collection_archive---------2-----------------------#2020-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e1dcb6e5ef1f433a66886823a38ec916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zicq3vUDzoF5wB6o"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">米切尔·奥尔在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="45b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue Router 4 处于测试阶段，可能会有变化。</p><p id="637d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了轻松地构建一个单页面应用程序，我们需要添加路由，以便将 URL 映射到呈现的组件。</p><p id="0ba0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用 Vue 路由器 4 与 Vue 3。</p><h1 id="d7af" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">组件内防护装置</h1><p id="1709" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在渲染组件的路径被确认之前，运行<code class="fe me mf mg mh b">beforeRouteEnter</code>保护</p><p id="3283" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，它没有访问<code class="fe me mf mg mh b">this</code>的权限。</p><p id="ad50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们可以在<code class="fe me mf mg mh b">next</code>回调中访问它。</p><p id="b811" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7f02" class="mq lc iq mh b gy mr ms l mt mu">beforeRouteEnter(to, from, next) {<br/>  next(vm =&gt; {<br/>    // ...<br/>  })<br/>}</span></pre><p id="f39a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">vm</code>有路由组件的实例。</p><p id="56fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是唯一支持为<code class="fe me mf mg mh b">next</code>传入回调的路由。</p><p id="5a62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在<code class="fe me mf mg mh b">beforeRouterUpdate</code>和<code class="fe me mf mg mh b">beforeRouterLeave</code>方法中直接使用<code class="fe me mf mg mh b">this</code>，所以不支持向<code class="fe me mf mg mh b">next</code>传递回调。</p><p id="9cc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b3fe" class="mq lc iq mh b gy mr ms l mt mu">beforeRouteUpdate (to, from, next) {<br/>  this.name = to.params.name<br/>  next()<br/>}</span></pre><p id="63cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7ba9" class="mq lc iq mh b gy mr ms l mt mu">beforeRouteLeave (to, from, next) {<br/>  const answer = window.confirm('Do you really want to leave?')<br/>  if (answer) {<br/>    next()<br/>  } else {<br/>    next(false)<br/>  }<br/>}</span></pre><p id="5572" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">beforeRouteLeave</code>通常用于防止用户意外离开路线。</p><h1 id="f6de" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导航解析流程</h1><p id="1491" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">导航的步骤如下:</p><ol class=""><li id="1d11" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated">导航触发。</li><li id="8aa1" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">调用<code class="fe me mf mg mh b">beforeRouteLeave</code>停用部件中的防护装置。</li><li id="d082" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">呼叫全局<code class="fe me mf mg mh b">beforeEach</code>警卫。</li><li id="cf90" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">调用重复使用组件中的<code class="fe me mf mg mh b">beforeRouteUpdate</code>防护装置。</li><li id="03f0" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">在路线配置中调用<code class="fe me mf mg mh b">beforeEnter</code>。</li><li id="7d4e" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">解析异步路由组件。</li><li id="2947" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">调用激活组件中的<code class="fe me mf mg mh b">beforeRouteEnter</code>。</li><li id="63a7" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">呼叫全局<code class="fe me mf mg mh b">beforeResolve</code>守卫。</li><li id="5717" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">导航确认。</li><li id="8ff4" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">调用全局<code class="fe me mf mg mh b">afterEach</code>钩子。</li><li id="c311" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">DOM 更新被触发。</li><li id="9cfd" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">运行传递给实例化实例的<code class="fe me mf mg mh b">beforeRouteEnter</code>守卫中的<code class="fe me mf mg mh b">next</code>的回调。</li></ol><h1 id="37e5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">路由元字段</h1><p id="2079" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">meta</code>属性添加路由元字段。</p><p id="77dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c532" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar"&gt;bar&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view&gt;&lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;bar&lt;/div&gt;"<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar",<br/>          component: Bar,<br/>          meta: { requiresAuth: true }<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });</span><span id="809c" class="mq lc iq mh b gy nj ms l mt mu">      router.beforeEach((to, from, next) =&gt; {<br/>        console.log(to.meta.requiresAuth);<br/>        next();<br/>      });</span><span id="df5a" class="mq lc iq mh b gy nj ms l mt mu">      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="04df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">向我们的<code class="fe me mf mg mh b">routes</code>数组条目添加一个<code class="fe me mf mg mh b">meta</code>属性。</p><p id="8f9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个属性为<code class="fe me mf mg mh b">requiresAuth</code>的对象。</p><p id="8514" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">beforeEach</code>回调中，我们可以用<code class="fe me mf mg mh b">to.meta.requiresAuth</code>属性访问它。</p><h1 id="d141" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">过渡</h1><p id="04d1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 Vue 路由器为路线变更添加转换。</p><p id="029e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8328" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;style&gt;<br/>      .fade-enter-active,<br/>      .fade-leave-active {<br/>        transition: opacity 0.5s;<br/>      }<br/>      .fade-enter,<br/>      .fade-leave-to {<br/>        opacity: 0;<br/>      }<br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar"&gt;bar&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view v-slot="{ Component }"&gt;<br/>        &lt;transition name="fade"&gt;<br/>          &lt;component :is="Component" /&gt;<br/>        &lt;/transition&gt;<br/>      &lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;bar&lt;/div&gt;"<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar",<br/>          component: Bar<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });</span><span id="5468" class="mq lc iq mh b gy nj ms l mt mu">      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c090" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">向我们的应用程序添加过渡。</p><p id="771e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加<code class="fe me mf mg mh b">router-view</code>并访问<code class="fe me mf mg mh b">Component</code> slot prop 来获得通过<code class="fe me mf mg mh b">router-view</code>显示的组件。</p><p id="1b5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以将它传递给<code class="fe me mf mg mh b">router-view</code>中的<code class="fe me mf mg mh b">component</code>组件。</p><p id="684e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们设置了<code class="fe me mf mg mh b">name</code>属性，这样我们就可以设置为动画添加的 CSS 类的前缀。</p><p id="b4e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">style</code>标签之间，我们有动画不同阶段的样式。</p><p id="d02a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">过渡的阶段在<a class="ae kc" href="https://v3.vuejs.org/guide/transitions-overview.html#class-based-animations-transitions" rel="noopener ugc nofollow" target="_blank">https://v3 . vuejs . org/guide/transitions-overview . html # class-based-animations-transitions</a>中列出。</p><h1 id="77c2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="bafd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 Vue Router 4 添加组件内防护和路由转换。</p><p id="cd72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加路由转换的方式不同于 Vue Router 3。</p></div></div>    
</body>
</html>