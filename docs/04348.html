<html>
<head>
<title>Server-Side Development with Hapi.js — Rendering Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Hapi.js 进行服务器端开发—渲染模板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/server-side-development-with-hapi-js-rendering-templates-8ac6914f386d?source=collection_archive---------3-----------------------#2021-03-04">https://blog.devgenius.io/server-side-development-with-hapi-js-rendering-templates-8ac6914f386d?source=collection_archive---------3-----------------------#2021-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6e2af20d3c5826d859aba25d46c6dc7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dg4QTeSBhsnSolNe"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@wildlittlethingsphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">海伦娜·洛佩斯</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b3fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Hapi.js 是一个用于开发后端 web 应用程序的小型节点框架。</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Hapi.js 创建后端应用程序。</p><h1 id="5f13" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">渲染模板</h1><p id="dcbe" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/vision</code>模块渲染模板。</p><p id="e9ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="033d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2bf9" class="mq lc iq mh b gy mr ms l mt mu">const Ejs = require('ejs');<br/>const Hapi = require('@hapi/hapi');<br/>const Vision = require('@hapi/vision');</span><span id="da04" class="mq lc iq mh b gy mv ms l mt mu">const server = Hapi.Server({ port: 3000 });</span><span id="f44f" class="mq lc iq mh b gy mv ms l mt mu">const rootHandler = (request, h) =&gt; {<br/>  return h.view('index', {<br/>    title: request.server.version,<br/>    message: 'Hello Ejs!'<br/>  });<br/>};</span><span id="7405" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  await server.register(Vision);</span><span id="8a7d" class="mq lc iq mh b gy mv ms l mt mu">  server.views({<br/>    engines: { ejs: Ejs },<br/>    relativeTo: __dirname,<br/>    path: 'templates'<br/>  });</span><span id="cfa2" class="mq lc iq mh b gy mv ms l mt mu">  server.route({ method: 'GET', path: '/', handler: rootHandler });</span><span id="eaf2" class="mq lc iq mh b gy mv ms l mt mu">  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="91cc" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="2ed4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">templates/index.ejs</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="283b" class="mq lc iq mh b gy mr ms l mt mu">&lt;%= message %&gt;</span></pre><p id="e1e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">await server.register(Vision);</code>来注册<code class="fe me mf mg mh b">@hapi/vision</code>插件。</p><p id="83d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">h.view</code>来渲染视图。</p><p id="1a53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">title</code>和<code class="fe me mf mg mh b">message</code>将在模板中可用。</p><p id="d0d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">engines.ejs</code>属性设置为<code class="fe me mf mg mh b">Ejs</code>模块，将其用作我们的渲染引擎。</p><p id="d3f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过编写以下代码来使用车把视图引擎:</p><p id="652c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8ef8" class="mq lc iq mh b gy mr ms l mt mu">const Handlebars = require('handlebars');<br/>const Hapi = require('@hapi/hapi');<br/>const Vision = require('@hapi/vision');</span><span id="85f0" class="mq lc iq mh b gy mv ms l mt mu">const server = Hapi.Server({ port: 3000 });</span><span id="8f47" class="mq lc iq mh b gy mv ms l mt mu">const rootHandler = (request, h) =&gt; {<br/>  return h.view('index', {<br/>    title: request.server.version,<br/>    message: 'Hello!'<br/>  });<br/>};</span><span id="7525" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  await server.register(Vision);</span><span id="519d" class="mq lc iq mh b gy mv ms l mt mu">  server.views({<br/>    engines: { html: Handlebars },<br/>    relativeTo: __dirname,<br/>    path: 'templates'<br/>  });</span><span id="e57c" class="mq lc iq mh b gy mv ms l mt mu">  server.route({ method: 'GET', path: '/', handler: rootHandler });</span><span id="b89f" class="mq lc iq mh b gy mv ms l mt mu">  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="fb70" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="99aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">templates/index.html</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c92e" class="mq lc iq mh b gy mr ms l mt mu">{{message}}</span></pre><p id="f05c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">engines</code>属性更改为<code class="fe me mf mg mh b">{ html: Handlebars }</code>，并要求<code class="fe me mf mg mh b">handlebars</code>模块使用车把视图引擎。</p><p id="61b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要将 Pug 视图引擎用于哈比神，我们编写:</p><p id="dfc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2c1e" class="mq lc iq mh b gy mr ms l mt mu">const Pug = require('pug');<br/>const Hapi = require('@hapi/hapi');<br/>const Vision = require('@hapi/vision');</span><span id="6957" class="mq lc iq mh b gy mv ms l mt mu">const server = Hapi.Server({ port: 3000 });</span><span id="00a9" class="mq lc iq mh b gy mv ms l mt mu">const rootHandler = (request, h) =&gt; {<br/>  return h.view('index', {<br/>    title: request.server.version,<br/>    message: 'Hello!'<br/>  });<br/>};</span><span id="9b64" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  await server.register(Vision);</span><span id="8ebe" class="mq lc iq mh b gy mv ms l mt mu">  server.views({<br/>    engines: { pug: Pug },<br/>    relativeTo: __dirname,<br/>    path: 'templates'<br/>  });</span><span id="8f81" class="mq lc iq mh b gy mv ms l mt mu">  server.route({ method: 'GET', path: '/', handler: rootHandler });</span><span id="3c43" class="mq lc iq mh b gy mv ms l mt mu">  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="7483" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="f9f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">templates/index.pug</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="15b7" class="mq lc iq mh b gy mr ms l mt mu">p #{message}</span></pre><p id="dfd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用 Mustache 视图引擎，我们编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="46a5" class="mq lc iq mh b gy mr ms l mt mu">const Mustache = require('mustache');<br/>const Hapi = require('@hapi/hapi');<br/>const Vision = require('@hapi/vision');</span><span id="9b5b" class="mq lc iq mh b gy mv ms l mt mu">const server = Hapi.Server({ port: 3000 });</span><span id="262c" class="mq lc iq mh b gy mv ms l mt mu">const rootHandler = (request, h) =&gt; {<br/>  return h.view('index', {<br/>    title: request.server.version,<br/>    message: 'Hello!'<br/>  });<br/>};</span><span id="de9d" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  await server.register(Vision);</span><span id="1aa1" class="mq lc iq mh b gy mv ms l mt mu">  server.views({<br/>    engines: {<br/>      html: {<br/>        compile: (template) =&gt; {<br/>          Mustache.parse(template);<br/>          return (context) =&gt; {<br/>            return Mustache.render(template, context);<br/>          };<br/>        }<br/>      }<br/>    },<br/>    relativeTo: __dirname,<br/>    path: 'templates'<br/>  });</span><span id="c1b2" class="mq lc iq mh b gy mv ms l mt mu">  server.route({ method: 'GET', path: '/', handler: rootHandler });</span><span id="06ac" class="mq lc iq mh b gy mv ms l mt mu">  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="7fe6" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="3784" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">templates/index.html</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="82fb" class="mq lc iq mh b gy mr ms l mt mu">{{message}}</span></pre><p id="7446" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">engines.html.compile</code>方法将模板编译成呈现的 HTML。</p><p id="5e59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">context</code>将我们传递的数据放入<code class="fe me mf mg mh b">h.view</code>的第二个参数中。</p><h1 id="505d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="cd65" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/vision</code>插件将各种模板转换成 HTML。</p></div></div>    
</body>
</html>