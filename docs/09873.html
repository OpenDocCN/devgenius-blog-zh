<html>
<head>
<title>Interactive data visualization with Plotly and Dash (Part 1) — Getting started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Plotly 和 Dash 的交互式数据可视化(第 1 部分)-入门</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/interactive-data-visualisation-with-plotly-and-dash-part-1-f9be5782ee3b?source=collection_archive---------7-----------------------#2022-09-19">https://blog.devgenius.io/interactive-data-visualisation-with-plotly-and-dash-part-1-f9be5782ee3b?source=collection_archive---------7-----------------------#2022-09-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/af8061cb3858b459b454cd542cd72c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wV0ZQqz_-rBw3ewFebFBtQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae jz" href="https://unsplash.com/s/photos/data-visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="d19d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="0a2f" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">就在最近，我完成了经济学学士学位。看到数据将成为我可能从事的任何工作不可或缺的一部分，我还通过完成 Datacamp 数据分析师认证(<a class="ae jz" href="http://datacamp.com" rel="noopener ugc nofollow" target="_blank">http://datacamp.com</a>)学习了数据分析和可视化的基础知识。在写关于数据增强对瑞士德语自动语音识别的影响的学士论文时，我爱上了 Wandb(<a class="ae jz" href="https://wandb.ai/site" rel="noopener ugc nofollow" target="_blank">https://wandb.ai/site</a>)提供的交互式可视化工具。</p><p id="27ab" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我的模型训练的这些图形表示帮助我看到发生了什么。因此，他们加快了开发速度，使得在给定的时间框架内撰写学士论文获得切实的成果成为可能。看到交互式可视化帮助我变得更有效率，我想知道我是否可以创建我自己的。</p><h1 id="4997" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">什么是 Plotly 和 Dash？</h1><p id="fedf" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">Dash 文档将 Dash 描述为:“基于 Plotly.js 和 React.js 编写，Dash 是构建和部署具有定制用户界面的数据应用程序的理想选择。它特别适合任何与数据打交道的人。</p><p id="f4fd" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">通过几个简单的模式，Dash 抽象出了构建具有交互式数据可视化的全栈 web 应用程序所需的所有技术和协议。”——<a class="ae jz" href="https://dash.plotly.com/introduction" rel="noopener ugc nofollow" target="_blank">https://dash.plotly.com/introduction</a></p><p id="3b02" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">“<code class="fe mb mc md me b"><a class="ae jz" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank">plotly</a></code> <a class="ae jz" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> Python 库</a>是一个交互式、<a class="ae jz" href="https://plotly.com/python/is-plotly-free" rel="noopener ugc nofollow" target="_blank">开源</a>绘图库，支持 40 多种独特的图表类型，涵盖了广泛的统计、金融、地理、科学和三维用例。”—<a class="ae jz" href="https://plotly.com/python/getting-started/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/getting-started/</a></p><p id="0022" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">将这两者放在一起，可以用很少的样板代码开发基于浏览器的交互式可视化。基本上就是我要找的。</p><h1 id="fe9b" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">数据</h1><p id="dbf2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">与任何可视化项目一样，我们需要一些数据来可视化。为此，我一直在摆弄来自<a class="ae jz" href="https://opendata.swiss/de" rel="noopener ugc nofollow" target="_blank"> https://opendata.swiss </a>的数据集。它通过一个中央目录向公众开放政府数据。该目录还提供了关于如何清楚简明地利用数据的信息。</p><p id="35c8" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">在所有提供的数据集里，我偶然发现了一些关于瑞士交通事故的数据集。作为一个狂热的自行车爱好者，这些数据看起来足够有趣，可以作为创建交互式可视化的起点。</p><p id="7898" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">对于这个项目，我下载了一个 CSV 文件，其中包含事故严重程度、事故发生的道路类型以及事故发生在哪个州(瑞士是由州组成的联邦……)的信息。为简单起见，数据按年份汇总。</p><p id="9756" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">数据由<a class="ae jz" href="https://opendata.swiss/de/organization/bundesamt-fur-statistik-bfs" rel="noopener ugc nofollow" target="_blank">BFS 联邦统计局</a>提供，可通过以下链接找到:<a class="ae jz" href="https://opendata.swiss/en/dataset/strassenverkehrsunfalle-unfalle-mit-personenschaden-nach-unfalltyp2/resource/026f80d4-b600-42dc-90e0-9acc900c7ca3" rel="noopener ugc nofollow" target="_blank">https://open data . Swiss/en/dataset/strassenverkehrsunfalle-un falle-MIT-personenschaden-nach-un falltyp 2/resource/026 f80d 4-b600-42dc-90e 0-9 ACC 900 c7c a3</a>。</p><p id="d44f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">有了数据，我们终于可以开始创建一个交互式的可视化。</p><h1 id="ed72" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">准备</h1><p id="eac6" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">我到底想做什么？</p><p id="e4a4" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">如前所述，我想保持事情简单。有了数据，我想创建一条线，用户可以在这里选择要显示的时间范围。为了弄清楚需要做什么，我喜欢创建一个 Jupyter 笔记本。当然，我将从导入熊猫开始，为了检查我是否可以正确显示数据，我还将导入 Plotly express。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="71f4" class="mn kb in me b gy mo mp l mq mr">import pandas as pd<br/>import plotly.express as px</span></pre><p id="6f00" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">CSV 文件有一个非标准的分隔符，编码有点不可靠。为了正确显示所有内容，我使用了以下导入:</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="46e5" class="mn kb in me b gy mo mp l mq mr">df = pd.read_csv(‘Unfall_nach_Kanton.csv’, encoding=’unicode_escape’, delimiter=’;’)</span></pre><p id="6d4e" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">有一点是显而易见的，那就是年份列。每一年都有单独的列，因此照原样使用会很棘手。理想情况下，我想要一个以年份为值的列。幸运的是，熊猫。熔化函数正是这样做的。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="55f2" class="mn kb in me b gy mo mp l mq mr">df = df.melt(id_vars=[‘Unfallschwere’, ‘Kanton’, ‘Strassenart’, ‘Unfallort’], var_name=’Year’, value_name=’Amount’)</span></pre><p id="f532" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">最后，我只对每年的事故总量感兴趣(截至目前)。一个简单的。groupby 将数据按年份分组，并对数量求和，这将为我提供一个数据框架，用于这个简单的示例。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="1e8e" class="mn kb in me b gy mo mp l mq mr">line_df = pd.DataFrame(df.groupby([‘Year’])[‘Amount’].sum())<br/>line_df.reset_index(inplace=True)</span></pre><p id="1be5" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">使用 Plotly express(作为 px 导入)进行的快速测试表明，我可以绘制一条按年份绘制的事故总数线。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="9ecf" class="mn kb in me b gy mo mp l mq mr">px.line(line_df, x=’Year’, y=’Amount’)</span></pre><p id="5eb8" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">太好了。让我们来互动一下。</p><h1 id="472a" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">破折号</h1><p id="29cb" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">Dash 将处理在浏览器中显示 python 代码的大量复杂性。在其最简单的形式中，Dash 将为您提供一种初始化应用程序、为所述应用程序创建布局并运行它的方法。如果您还没有安装 Dash 和 Plotly:</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="d9f7" class="mn kb in me b gy mo mp l mq mr">pip install dash</span></pre><p id="114b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这也带来了<code class="fe mb mc md me b">plotly</code>图形库。该库正在积极开发中，请经常安装和升级。</p><h1 id="e3f5" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">基本应用布局</h1><p id="c784" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">玩了一会儿 Dash 之后，我设计了一个基本的设置。这样我就能记住所有东西的去向，希望不会搞得太乱。无论如何，我已经在下面提供了我的基本模板(在这种情况下，数据已经被导入):</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0ef5" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这里需要注意一些事情。</p><ol class=""><li id="ec31" class="mu mv in la b lb lw lf lx lj mw ln mx lr my lv mz na nb nc bi translated">文件另存为。py 而不是 Jupyter 笔记本</li><li id="65aa" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">我已经插入了转换数据集的代码</li><li id="ea9b" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">布局部分将负责在哪里显示什么。把它想象成一个需要元素来展示任何东西的网页。</li><li id="27dd" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">回调部分是创建大部分交互逻辑的地方。</li><li id="1a82" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">运行该应用程序会启动一个服务器，您将能够在本地浏览器中检查您的工作。默认情况下，服务器将是<a class="ae jz" href="http://127.0.0.1:8050/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8050/ </a></li><li id="5476" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">当您运行这段代码时，您将看不到任何东西…</li><li id="bf79" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv mz na nb nc bi translated">在本教程中，我们将不使用 dash_bootstrap_components。从代码中删除那一行就可以了。</li></ol><h1 id="d939" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">应用程序布局</h1><p id="f608" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">通常，我倾向于对应用程序的样子做一个粗略的草图。在这种情况下，我认为列出待办事项就足够了:</p><ul class=""><li id="abf6" class="mu mv in la b lb lw lf lx lj mw ln mx lr my lv ni na nb nc bi translated">标题和描述</li><li id="9f8a" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv ni na nb nc bi translated">显示瑞士每年交通事故总量的折线图</li><li id="03ed" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv ni na nb nc bi translated">用户可以选择要显示的时间范围(默认为所有数据)的滑块</li></ul><p id="4424" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">为了显示任何内容，我将从标题开始。Dash 提供了可以在你的应用中使用的 HTML 元素。这些组件可通过以下方式访问:</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="6872" class="mn kb in me b gy mo mp l mq mr">from dash import html</span></pre><p id="672d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这些都是很容易使用的元素。没有任何 HTML 知识，你会走得很远。Dash 将在后台将这些组件转换成浏览器可读的格式。</p><p id="b92f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">要添加标题和描述，我将添加一个 html。H1 和 html。H5 将布局作为主 html 的子元素。Div:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="c202" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">如果你回到浏览器，你会看到应用程序已经自动更新。所以不需要重新运行代码。如果你在代码中犯了一个错误，你的应用将会崩溃，你需要重新运行它并刷新你的浏览器。</p><p id="6e55" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">接下来，我们将为我们的可视化添加一个居住的地方。这是通过从 Dash 核心组件中添加一个图形组件来完成的。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="a310" class="mn kb in me b gy mo mp l mq mr">from Dash import dcc</span></pre><p id="552b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">图的 id 应该是你能记住的(并且是唯一的)，因为这是我们稍后将添加回调以与图交互的地方。为了完成布局的 TODO 列表，我还将添加一个范围滑块。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="24b6" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">dcc.RangeSlider 有几个特点。</p><ul class=""><li id="31a8" class="mu mv in la b lb lw lf lx lj mw ln mx lr my lv ni na nb nc bi translated">首先，我使用已经导入的数据定义了一个最小值和最大值。</li><li id="c372" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv ni na nb nc bi translated">marks 参数负责标记的外观。这有时可能有点复杂…基本思想是将一个字典传递给范围滑块，其中包含所有应该显示为文本的值。</li><li id="798c" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv ni na nb nc bi translated">value 参数负责向用户显示默认值。与 TODO 列表相反，默认值是整个范围，我选择了一个较小的范围。这为用户提供了一个视觉提示，即滑块可以是交互式的。</li><li id="0f17" class="mu mv in la b lb nd lf ne lj nf ln ng lr nh lv ni na nb nc bi translated">id 是我将用来从用户那里获得输入的 id。</li></ul><h1 id="ae5f" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">互动</h1><p id="ba52" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">到目前为止，还没有发生太多的事情。这就是回调发挥作用的地方。回调允许对浏览器中呈现的内容进行交互和动态更新。您可能已经注意到，目前没有显示任何数据。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0da2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">前两行告诉 Dash 在哪里收集和放置什么信息。输出(从 Dash 导入)指的是用于标识图形的 id(DCC)。图)。输入(从 Dash 导入)告诉应用程序在哪里可以找到输入信息。这将返回一个值，在本例中是一个值列表。</p><p id="a633" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">输入值作为 year_range 传递给函数“update_figure”。范围选择器返回要处理的值的列表。使用这个列表，我创建了一个新的数据帧，其中只包含该范围内的值。</p><p id="ea06" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">然后，更新的 DF 用于绘制图形。</p><p id="063d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">为了使过渡漂亮，fig 的 update_layout 属性用于创建一个轻微的延迟。</p><p id="2e95" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">最后，该数字被传递回输出。这然后被传递到 dcc。要在屏幕上显示的图形对象。我还在应用程序中添加了一个外部样式表，只是为了让一切看起来更漂亮。</p><p id="6045" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">到目前为止，应用程序应该是这样的:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/e00e1d44987c89b953b095e915a94ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jc2soLi9mb94-7R6JlBnoA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">交互式可视化的屏幕截图</figcaption></figure><p id="637b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这不是有史以来信息量最大的图表。在第 2 部分中，我将探讨以一种有用的方式展示更多信息的方法。</p><p id="5ec3" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">下面是最终的代码:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="ms mt l"/></div></figure></div></div>    
</body>
</html>