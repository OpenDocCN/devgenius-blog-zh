<html>
<head>
<title>Offline Data Sync In Mobile Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动应用程序中的离线数据同步</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/offline-data-sync-in-mobile-applications-1808b21491b7?source=collection_archive---------4-----------------------#2022-01-10">https://blog.devgenius.io/offline-data-sync-in-mobile-applications-1808b21491b7?source=collection_archive---------4-----------------------#2022-01-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d907537b1adb65ec8d17fffe924c75f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eglbuEmwujFx8GDH"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">离线模式</figcaption></figure><h2 id="8bfd" class="jz ka in bd kb kc kd dn ke kf kg dp kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">在线模式与离线模式</strong></h2><p id="c521" class="pw-post-body-paragraph kv kw in kx b ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp ig bi translated"><strong class="kx io">在线模式:</strong></p><ul class=""><li id="7975" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">始终连接到互联网</li><li id="3526" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">移动应用程序需要一个正常工作的互联网连接，否则根本无法工作。</li><li id="c1ab" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">它不会与服务器通信</li><li id="ac29" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">用户将无法执行任务</li><li id="0203" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">一个最常见的例子是一个银行应用程序，如果没有互联网，你就无法进行任何交易。</li></ul><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/4489c5a92ad7e0804a9107c66dea0498.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/1*R7LEx0a8k8ZaIZhXJhQjxg.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">布拉提尼商业出售</figcaption></figure><p id="4b8e" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">上面附上的截图来自一款名为<a class="ae mo" href="http://www.blatini.com" rel="noopener ugc nofollow" target="_blank"> Blatini </a>的应用。这是一个商业分类应用程序，你可以购买或出售企业。</p><p id="b8b4" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">在附件的 gif 中，你很可能会看到装货标签。当应用程序从需要互联网连接的数据库加载数据时，标签会出现。如果没有互联网连接，您将无法发布广告或查看已发布的广告，因为为了从服务器加载数据，此应用程序需要互联网连接。</p><p id="ff2a" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">让我们借助大理石图来看看完整的场景。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/c3db9c7ca68b227194cf8ed74a0e2d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ekq89TfUFeOqJWYMflOIoA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">布拉提尼商业出售</figcaption></figure><p id="c826" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">应用程序的上图显示了应用程序使用 API 从服务器请求数据。</p><p id="a4cc" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">如下图所示，应用程序已收到服务器的响应，并显示给最终用户。但这一切都是因为互联网连接，这就是为什么应用程序能够与服务器通信。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/87f39b7542cd9e98fe975620c5cfeba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X3Mq4dCq3bnOsJua8W3afw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">布拉提尼商业出售</figcaption></figure><p id="3abe" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">下图向我们展示了没有互联网连接时应用程序的状态。由于没有互联网连接，我们无法与服务器通信。并且用户不能执行任何任务。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/41c82499c3609a324d28e31ed347ecc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z2ZeHhW8JwWGUjqketg1XQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">布拉提尼商业出售</figcaption></figure><p id="eb4b" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated"><strong class="kx io">离线模式:</strong></p><ul class=""><li id="8062" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">不需要互联网连接。</li><li id="021d" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">执行基本操作不需要与服务器通信。</li><li id="5ea3" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">应用在互联网上不是为了执行基本操作而加深的。</li></ul><p id="73f3" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated"><strong class="kx io">离线模式实际上是如何工作的？</strong></p><p id="f582" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">我想用一些图表来解释一下。假设我们的用户想要改变显示图片(DP ),那么会发生什么呢？</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/771c00ec388a740528b1bbc045942d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UknWCcRzpSbq-FJKgtoS7w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">移动应用中的离线存储</figcaption></figure><p id="a287" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">他将在应用程序中上传图片，应用程序将把它保存到移动应用程序数据库，即核心数据。</p><p id="2b2b" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">稍后，一旦您的设备有一个活跃的互联网连接。该应用程序将从核心数据即您的本地存储中获取新保存的 DP，并立即将其上传到服务器。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/7f2b7874d7dba02a321fa4992e650668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w4cVQPX5bxK8oXhRD_62fw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">移动应用中的离线存储</figcaption></figure><p id="71cb" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">离线数据同步不仅仅是<strong class="kx io">将记录推</strong>到服务器，你还必须从服务器<strong class="kx io">拉</strong>新记录。</p><p id="c6b2" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">现在我们有两个事件<strong class="kx io">推</strong>和<strong class="kx io">拉。</strong>离线模式比在线模式更复杂。</p><p id="a9ed" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated"><strong class="kx io">以下是离线模式的复杂性:</strong></p><ul class=""><li id="0b0d" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">主数据同步</li><li id="f0fe" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">增量数据同步/获取更新的记录</li><li id="34d9" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">离线数据同步</li><li id="d256" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">哪些记录首先更新/优先同步</li></ul></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h2 id="6d5b" class="jz ka in bd kb kc kd dn ke kf kg dp kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">主数据同步:</h2><p id="89a4" class="pw-post-body-paragraph kv kw in kx b ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp ig bi translated">在主数据同步中，只要您启动应用程序，它就需要在您的应用程序开始工作/准备使用之前从服务器下载一些记录。</p><p id="dce7" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated"><strong class="kx io">主数据同步用例:</strong></p><p id="31c9" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">下图显示了数据库中的两个表，其中表 1 有 30k 条记录，表 2 有 35k 条记录。当与互联网连接时，用户能够下载总共 65，000 条记录。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/1bf9ac003b0766ec61abe1a8502245bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_9RL63Gsyg6nGJoY3dYig.png"/></div></div></figure><p id="f41f" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">但是，当应用程序下载数据时，会发生以下情况之一:</p><ul class=""><li id="8463" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">互联网数据已达到极限。</li><li id="5209" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">wifi 已断开。</li><li id="7ce7" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">用户关闭应用程序</li><li id="5d4b" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">手机电池没电了</li></ul><p id="e85d" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">出现以上情况之一怎么办？</p><ul class=""><li id="ebbd" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">一旦再次连接到互联网，您的应用程序是否会删除全部数据并重新下载？</li><li id="3f77" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">保持对数据的跟踪，并从先前停止的同一记录处继续。</li></ul><p id="1868" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">所以在你编码之前，一定要考虑这些情况。</p></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h2 id="ee58" class="jz ka in bd kb kc kd dn ke kf kg dp kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">增量数据同步:</h2><p id="d942" class="pw-post-body-paragraph kv kw in kx b ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp ig bi translated">增量同步是一种仅同步数据库中更新的记录的同步。</p><p id="6bdd" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">例如，下图显示了一个应用程序在中午 12:00 和下午 1:00 完成了主同步。设备离线，稍后在晚上 9:00 恢复在线。从下午 1:00 到晚上 9:00，有一些记录被更改。</p><p id="927b" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">因此，您的应用程序将只同步已更改的更新记录，而不是再次下载整个表。</p><p id="5777" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">对于这种数据拉取，您用 api 发送时间，并且只获得在该时间之后发生的更改。</p><p id="ed30" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">我知道有一些实时数据库可以解决这种复杂性，但它们是有偿的。如果你的客户不想得到一个付费的数据库，你将不得不回到 SQLlite，核心数据或领域。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/edc1be52a073753d975efe862f4eae8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bILy1G-QqamYpdkdLIb-vA.png"/></div></div></figure></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h2 id="92c8" class="jz ka in bd kb kc kd dn ke kf kg dp kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">离线数据同步:</h2><p id="1ffd" class="pw-post-body-paragraph kv kw in kx b ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp ig bi translated">假设您下载了记录，您的主同步完成后，您在下午 1:00 离线，并在晚上 9:00 恢复在线。在离线时间，您更新了手机中的本地记录，现在当您上线时，这些记录将被在线推送至您的数据库。与此同时，你的应用程序将做增量同步。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/4152cce6eb29dc60f7edad4a9c835732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fa5TMzha3E2kYgk6iWgHeg.png"/></div></div></figure><p id="eb02" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">那么我们应该先推送离线记录还是做增量同步呢？我建议您在推送离线记录时使用单个 API。您还应该传递最后一次主数据同步时间，并且只获取过去时间之后发生的更改。这样，您不仅可以获取最新的记录，还可以通过一次 API 调用将您所做的更改推送至数据库。</p><p id="c643" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">例如，您有一个在下午 12:00 和下午 1:00 同步的名为“Umair”的记录。您离线后将记录名称从“Umair”更改为“Umair khan”。晚上 9:00 上线后，您会将此记录推送到数据库，并传递最后的主同步时间，即下午 12:00，因此数据库会将记录名称“Umair”更新为“Umair khan ”,但不会重新下载它，只会下载在主同步时间之后更改的记录</p><p id="f598" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">但这真的取决于后端开发人员如何开发 api &amp;只有他能告诉你是否需要先进行增量同步或离线同步，或者两者同时进行，就像我上面提到的那样。</p></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h2 id="5712" class="jz ka in bd kb kc kd dn ke kf kg dp kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">优先级同步:</h2><p id="a5ed" class="pw-post-body-paragraph kv kw in kx b ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp ig bi translated">名字本身就说明了一切。假设两个用户试图更改相同的记录，他们的更改将会发生，而他们的更改将会被服务器拒绝。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/02f2c101dd56bb4a2b75ec187b69fdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4gZ20B0sSaZiMHztRdVMw.png"/></div></div></figure><p id="8aaa" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">用户 A 和用户 B 都更改了名为“A”的记录。现在谁的更改将存储在 DB 上。</p><p id="5b77" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated"><strong class="kx io">这在以下方面有所不同:</strong></p><ul class=""><li id="31b5" class="lq lr in kx b ky ls lc lt ki lu km lv kq lw lp lx ly lz ma bi translated">用户角色(拥有高级角色的用户，其更改将被保存)</li><li id="6e14" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">业务需求(将由客户给出)</li><li id="cc6e" class="lq lr in kx b ky mb lc mc ki md km me kq mf lp lx ly lz ma bi translated">如果没有很好地描述以上两者，那么我们假设两个用户都是平等的，谁的互联网连接更好，谁就会推送更改，而具有慢速互联网连接的用户会忽略这些更改，然后两个用户都会获得由慢速互联网连接用户推送的记录。</li></ul></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><p id="5a51" class="pw-post-body-paragraph kv kw in kx b ky ls la lb lc lt le lf ki ml lh li km mm lk ll kq mn ln lo lp ig bi translated">我希望我能够很好地解释离线数据模式。如果你喜欢我的文章，请分享并关注我，这真的激励我写更多。</p></div></div>    
</body>
</html>