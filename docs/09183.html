<html>
<head>
<title>Change Data Capture — Intro!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">变更数据捕获—简介！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/change-data-capture-intro-7307d3768056?source=collection_archive---------7-----------------------#2022-08-04">https://blog.devgenius.io/change-data-capture-intro-7307d3768056?source=collection_archive---------7-----------------------#2022-08-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7ed009fee8d3d73ee75f14b69b69d447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D_m72PU3AMAn1q9N"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">斯蒂芬·道森在<a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><p id="9f24" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">疾病控制中心的基本介绍</p><h1 id="001d" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">美国疾病控制与预防中心</h1><p id="2c0a" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">变更数据捕获<em class="mb"> (CDC) </em>是一种数据集成设计模式，它允许我们跟踪数据库表中的行级变更，以响应创建、更新和删除操作。CDC 允许我们将 DB 中的变化视为事件并对其做出响应。使用这种技术，我们可以执行增量数据加载，并同步异构数据。CDC 可以使用不同的策略来实现，如轮询、双重写入和日志跟踪。大多数 CDC 管道实现了日志跟踪方法，这种方法从数据库的引擎特定日志中跟踪事件。例如，在 MySQL 中，这些变更数据事件通过<a class="ae ja" href="https://dev.mysql.com/doc/internals/en/binary-log-overview.html" rel="noopener ugc nofollow" target="_blank"> MySQL 二进制日志(binlog) </a>公开。在 Postgres 中，WAL 是使用发布和复制槽公开的。类似地，MongoDB 的变化可以用 OpLog 来跟踪。</p><figure class="md me mf mg gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mc"><img src="../Images/2915302e64242ef288e99414798a82a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0DlzI9oZQSY1DG867XfdQ.png"/></div></div></figure><p id="3717" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je">疾控中心核心理念:</strong></p><ul class=""><li id="4fb9" class="mh mi jd kc b kd ke kh ki kl mj kp mk kt ml kx mm mn mo mp bi translated">将数据更改作为事件公开</li><li id="243b" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mm mn mo mp bi translated">将事件存储在缓冲区中</li><li id="60fe" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mm mn mo mp bi translated">实时使用缓冲区中的事件。</li></ul><h1 id="51cc" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">疾控中心平台</h1><p id="531f" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">有多个 CDC 平台，如 Debezium、DBLog、Maxwell、MySQL Streamer 和 SpinalTap。其中 Debezium 是最受欢迎的。Debezium 用于 Zomato、Oyo、Delhivery 和 Zalando 等公司。它在事务日志中捕获提交给数据库表的所有行级更改，并将它们转换为事件。它利用 Kafka 来处理变更的排队。它也可以连接到 Pulsar 和 kinesis。Debezium 提供了几种单一的消息转换，允许我们进行基于主题/内容的路由和基于内容的过滤。</p><p id="296d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在生产环境中，Debezium 平台在 K8s 集群上以分布式模式运行。Kafka-connect image 被用作基础，debezium 和 source/sink specific 的插件被添加到它的上面。JMX 插件/jar 被添加到映像中进行监控。</p><p id="eb27" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，我们也可以使用 MSK 连接来运行 Kafka-connect 连接器。MSK 连接允许我们在 AWS 上运行完全托管的 Apache Kafka Connect 工作负载。</p><figure class="md me mf mg gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mv"><img src="../Images/3089463dda74fdb482fcbe667adb30f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wwq9GDk9ex2SmP4nCwoYmA.png"/></div></div></figure><p id="00ff" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上图中，我们将 MySQL DB 作为源。我们使用 EKS 集群来托管 Debezium 源和接收器连接器。这些以分布式模式运行。后端 Kafka 集群托管在 AWS MSK。</p><p id="fde3" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如所看到的，源数据库中的单个更改几乎实时地传播到三个不同的用例。首先，它丰富了胡迪表(湖房子)。同时，它还将数据复制到不同地区的 MySQL 中。最后，我们还使用相同的事件来更新应用程序使用的 DynamoDb 表。</p><h1 id="5f00" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">疾控中心的优势</h1><ol class=""><li id="1cd0" class="mh mi jd kc b kd lw kh lx kl mw kp mx kt my kx mz mn mo mp bi translated">仓库和功能商店的实时更新</li><li id="8bfb" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">与其他不兼容的数据库集成</li><li id="d7aa" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">减轻运营数据库的压力</li><li id="ecd4" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">扇出数据库事件</li><li id="1185" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">支持灾难恢复使用案例</li></ol><h1 id="c248" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">CDC 使用案例</h1><ol class=""><li id="4a99" class="mh mi jd kc b kd lw kh lx kl mw kp mx kt my kx mz mn mo mp bi translated">无效缓存</li><li id="502f" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">实体化视图的更新</li><li id="4b38" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">审计日志</li><li id="9db4" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mz mn mo mp bi translated">微服务的发件箱设计模式</li></ol><h2 id="16e6" class="na kz jd bd la nb nc dn le nd ne dp li kl nf ng lm kp nh ni lq kt nj nk lu nl bi translated">要记住的几点:</h2><ul class=""><li id="489a" class="mh mi jd kc b kd lw kh lx kl mw kp mx kt my kx mm mn mo mp bi translated">插件中数据库运行时的不兼容性</li><li id="16cf" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mm mn mo mp bi translated">事务提交大小</li><li id="4258" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mm mn mo mp bi translated">复制插槽中的错误</li><li id="646f" class="mh mi jd kc b kd mq kh mr kl ms kp mt kt mu kx mm mn mo mp bi translated">在繁重的交换表中缺乏并行性</li></ul><h2 id="631c" class="na kz jd bd la nb nc dn le nd ne dp li kl nf ng lm kp nh ni lq kt nj nk lu nl bi translated">附录</h2><figure class="md me mf mg gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nm"><img src="../Images/de5e5b9093846d006081413eabc9c1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bunyMzSREv0XdCSB7VKMZw.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">postgres 上的 CDC 流</figcaption></figure><ul class=""><li id="a85e" class="mh mi jd kc b kd ke kh ki kl mj kp mk kt ml kx mm mn mo mp bi translated">LSN 代表日志序列号(WAL 文件中的字节偏移量)</li></ul><p id="406f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">数据工程快乐！！！</p></div></div>    
</body>
</html>