<html>
<head>
<title>Let’s add a Checkout Feature in Vue.js for Our Ecommerce App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们在 Vue.js 中为我们的电子商务应用程序添加一个结账功能</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/lets-add-a-checkout-feature-in-vue-js-for-our-ecommerce-app-84b5fc2df17a?source=collection_archive---------1-----------------------#2021-03-15">https://blog.devgenius.io/lets-add-a-checkout-feature-in-vue-js-for-our-ecommerce-app-84b5fc2df17a?source=collection_archive---------1-----------------------#2021-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a278" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将学习如何在演示电子商务应用程序中使用 Stripe 在 VueJs 中集成支付网关</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d17de621d64d28dc6a62e74d2994010f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5oqDMy_BSSA33RaMDCeAA.png"/></div></div></figure><h1 id="e1a2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="6d0e" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们正在从头开始构建一个电子商务应用程序，前端使用 Vue.js，后端使用 Java 和 Springboot。你可以在这里查看这个系列的第一个前端教程。</p><div class="ma mb gp gr mc md"><a href="https://javascript.plainenglish.io/lets-create-vue-js-frontend-for-products-in-our-e-commerce-app-14cc8c3459c8" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">让我们用 Vue.js 为我们的电子商务应用程序创建一个前端</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">我们正在从头开始构建一个完整的电子商务应用程序。今天，我们将添加产品功能。</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr kv md"/></div></div></a></div><p id="c8ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">支付网关是电子商务应用程序的重要功能。在上一个教程中，我们使用 Spring Boot 和 Stripe 集成了一个支付网关。现在，我们将构建它的前端部分，如接受购物车商品和卡的细节。</p><blockquote class="ms mt mu"><p id="80cc" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">如果你想参考支付网关的后端部分，请使用下面的链接。</p></blockquote><div class="ma mb gp gr mc md"><a href="https://medium.com/javarevisited/lets-add-a-checkout-feature-in-spring-boot-for-our-ecommerce-app-72b12a7f3648" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">让我们在 Spring Boot 为我们的电子商务应用程序添加一个结账功能</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">在本教程中，我们将学习如何在我们的演示电子商务应用程序中使用 Stripe 来集成 Spring Boot 的支付网关</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">medium.com</p></div></div><div class="mm l"><div class="mz l mo mp mq mm mr kv md"/></div></div></a></div></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="ef26" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">现场演示</h1><p id="17e2" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">https://infallible-swartz-b50174.netlify.app/<a class="ae nm" href="https://infallible-swartz-b50174.netlify.app/" rel="noopener ugc nofollow" target="_blank"/></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/596285d6204de470259676030c2e708f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CgkD82Bw59ykyKfNJ7Jo_A.gif"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">结帐演示 gif</figcaption></figure><p id="5524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在<a class="ae nm" href="https://github.com/webtutsplus/ecommerce-vuejs" rel="noopener ugc nofollow" target="_blank"> Github </a>找到完整的代码。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="7038" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">先决条件</h1><ol class=""><li id="e699" class="ns nt iq jp b jq lv ju lw jy nu kc nv kg nw kk nx ny nz oa bi translated">关于<strong class="jp ir"> Vuejs </strong>的知识</li><li id="6ac6" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated"><a class="ae nm" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio 代码</a> <strong class="jp ir"> — </strong>开源(推荐)</li><li id="f10c" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">一个好的浏览器<strong class="jp ir"> — </strong> (Chrome —推荐)</li></ol></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="61c3" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">我们将使用的 API</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/81b40b3e97b40d783c059281993d9e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*ReLfho3oS8lezT4BzWJcRw.png"/></div></figure><h2 id="f509" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">getCartItems:</h2><p id="929a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这是一个 get 方法，我们将使用它在一个数组中存储购物车商品，这样我们就可以使用 Axios 将它作为请求体传递给我们的后端 API。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/50631f9a7cf0adda2195e09031fb983e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*Bhq1mRF-d5tif8DKftCKCQ.png"/></div></figure><h2 id="14d0" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">checkoutList:</h2><p id="67a7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这是一个 post 方法，作为一个响应体，我们将把购物车商品的数组传递给它。该方法负责生成会话 id。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/3059f186edaeff788cd7540737d12d57.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*szYoVN4Czj7Pj4WaTrfPPQ.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">如果购物车包含这两种产品，则发布主体</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ov"><img src="../Images/4cbc33b430e1a38bfefb50a40c864b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rUJf9A0OfV3qogQg7wuzCg.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">我们获得会话 id 作为响应</figcaption></figure><h2 id="8b52" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">下单:</h2><p id="1184" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这是一个 post 方法，如果支付成功，我们将使用它在我们的数据库中的订单表中添加订单。因此，作为 Axios post 方法的参数，我们将传递登录用户的令牌和生成的会话 id。</p><div class="km kn ko kp gt ab cb"><figure class="ow kq ox oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><img src="../Images/e037e9f6de9bf2c252963b8e51647b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*7htabX3UJZCyVymEmClfKA.png"/></div></figure><figure class="ow kq pc oy oz pa pb paragraph-image"><img src="../Images/833b16d98d4f60cc270251e02046ed61.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*RhtmxF-EsXUQMj9hFqNhSQ.png"/><figcaption class="no np gj gh gi nq nr bd b be z dk pd di pe pf translated">我们将会话 id 和令牌作为参数传递，如果支付成功，订单就会被发出</figcaption></figure></div></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="12a1" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">项目结构</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/8e39f55c23b4bdf024cbd9b27c48c6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*EHVevXyRYQb2N72aNRLBCA.png"/></div></figure></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="fa0d" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">种类</h1><p id="2d28" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Stripe 是处理在线支付的最佳方式之一，最近他们发布了 Stripe 元素。<a class="ae nm" href="https://stripe.com/elements" rel="noopener ugc nofollow" target="_blank"> Stripe Elements </a>是其预建的 UI 组件库，可帮助您轻松创建自己的结账流程。现在，为您的应用程序设置自定义支付表单比以往任何时候都更容易。</p><p id="5349" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将使用<a class="ae nm" href="https://stripe.com/docs/js" rel="noopener ugc nofollow" target="_blank"> Stripe.js </a>来创建<a class="ae nm" href="https://stripe.dev/stripe-java/index.html" rel="noopener ugc nofollow" target="_blank">支付网关</a>。</p><p id="60f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要自己的条纹测试 API key。因此，继续操作，在 stripe 上创建一个帐户,然后从控制面板获取 API 密钥以进行测试。将密钥存储在环境变量中。为此:</p><p id="15a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在源文件目录下创建一个扩展名为<code class="fe ph pi pj pk b">.env</code>的文件</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pl"><img src="../Images/cdadd2a15baaa2e51f47456f74bf2bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*w6ZLrt0lrQn4-TZ2iQxQhw.png"/></div></div></figure><p id="960d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个文件<strong class="jp ir">中创建一个变量</strong>来存储 API 密匙。</p><p id="7df3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将变量命名为<code class="fe ph pi pj pk b">VUE_APP_VARIABLENAME=YOURAPIKEY</code>。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="17b8" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">教程的流程</h1><blockquote class="ms mt mu"><p id="67e1" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">必需数据变量的声明</p><p id="fbea" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">条纹的安装</p><p id="d30b" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">条带元素的初始化和配置</p><p id="93ec" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">实现获取购物车商品的方法</p><p id="0a75" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">实现将购物车物品传递给后端 API 方法，并接收会话 id 作为响应</p><p id="f430" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">根据条纹支付的状态将用户导航到成功或失败支付组件</p></blockquote></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="cfb7" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">现在让我们编码</h1><p id="2c00" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">创建一个名为 Checkout 的文件夹，并在该文件夹中创建一个名为 Checkout 的 vue 文件，该文件将保存支付网关的前端逻辑。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pm"><img src="../Images/3b1c1ec6c0fc1547cb843116d6da46b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7tgub3IwDERGn8UbpeLyg.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">结帐组件</figcaption></figure><h1 id="4017" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">1.数据变量的创建</h1><p id="3318" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><code class="fe ph pi pj pk b">stripeAPIToken</code>:存储 API 密钥</p><p id="7eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ph pi pj pk b">stripe</code>:条纹元素</p><p id="5442" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Stripe Element 是一个包含各种元素的组件集合，您可以使用这些元素来创建结帐表单，如按钮和用于收集用户信息的输入。我们要关注的是卡片元素。card 元素允许您在一个元素中收集所有的卡信息。它包括一个动态更新的卡品牌图标，以及电子邮件，到期，CVV，国家名称，持卡人姓名的输入。</p><p id="655d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ph pi pj pk b">token</code>:存储用户的令牌</p><p id="1c6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ph pi pj pk b">sessionId</code>:按条带存储生成的 sessionId</p><p id="5e1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ph pi pj pk b">checkoutBodyArray</code>:我们将被发送到后端 API 的响应体</p><h1 id="171d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">2.条纹的安装</h1><p id="91b3" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Stripe 元素是<code class="fe ph pi pj pk b">Stripe.js</code>的一部分，因此我们需要通过使用<code class="fe ph pi pj pk b">includeStripe </code>方法(我们将进一步实现)来包含脚本，我们将脚本源 URL 传递给该方法，由于<code class="fe ph pi pj pk b">includeStripe </code>是一个回调函数，我们将调用我们将在前面实现的<code class="fe ph pi pj pk b">configureStripe </code>方法。那么我们什么时候把这个方法叫做<code class="fe ph pi pj pk b">includeStripe </code>方法呢？当组件被渲染时，我们初始化这个方法。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="fc08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也就是说，在<code class="fe ph pi pj pk b">mounted </code>方法中，我们调用这个函数。</p><blockquote class="ms mt mu"><p id="37b9" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">我们正在绑定它，这样我们就可以在回调中访问本地组件的方法，并且一旦所有东西都被加载了，我们就调用 configureStripe。我们还没有实现，但这是下一步！这是我们的回调方法，它将在组件内本地设置 Stripe。</p></blockquote><p id="37ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，当用户从购物车页面单击确认订单时，将呈现这个<code class="fe ph pi pj pk b">checkout </code>页面。如果你想看一看，你可以参考这个。因此，当用户点击确认订单时，我们调用<code class="fe ph pi pj pk b">cart </code>组件中的<code class="fe ph pi pj pk b">checkout</code>方法，其中我们使用路由器方法将用户导航到<code class="fe ph pi pj pk b">Checkout </code>组件。对于这个路由器方法，我们传递 params id 作为购物车的大小(购物车中的商品数量)。</p><pre class="km kn ko kp gt pp pk pq pr aw ps bi"><span id="2e94" class="oh ky iq pk b gy pt pu l pv pw">checkout(){ <br/>this.$router.push({ name: ‘Checkout’,params:{id:this.len}}) <br/>}<br/>//from the Cart.vue</span></pre><blockquote class="ms mt mu"><p id="a915" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">现在，我们为什么要传递参数 id？</p></blockquote><p id="321a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当且仅当用户点击<code class="fe ph pi pj pk b">confirm order button</code>时，我们传递 id 以检查<code class="fe ph pi pj pk b">checkout </code>页面是否被调用。假设用户在某个其他页面上，比如产品页面，并且从那里他通过在 URL 中显式地提及来导航到结帐页面，用户将不能这样做，因为默认情况下 id 将被作为未定义的来传递。在<code class="fe ph pi pj pk b">Checkout</code>组件的<code class="fe ph pi pj pk b">mounted </code>方法中，我们首先检查 id 是否是有效的数据类型(在这种情况下，它应该是字符串，因为我们在<code class="fe ph pi pj pk b">Cart</code>组件的 router 方法中将 id 作为参数传递),然后我们只呈现<code class="fe ph pi pj pk b">Checkout </code>组件。</p><p id="d492" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果 id 未定义，即用户试图导航至<code class="fe ph pi pj pk b">checkout </code>页面而未确认订单，则他将被重定向至<code class="fe ph pi pj pk b">Home </code>页面。此外，如果购物车为空，则确认订单按钮被禁用，但如果用户试图通过在 URL 中明确提及来导航到<code class="fe ph pi pj pk b">checkout </code>页面，则用户仍将被导航到<code class="fe ph pi pj pk b">Home </code>页面，因为在这种情况下，传递给<code class="fe ph pi pj pk b">Checkout </code>组件的 id 也将是未定义的。</p><p id="df3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，从<code class="fe ph pi pj pk b">Cart</code>组件传递 params id(购物车的大小),以确认用户是否通过确认订单导航到<code class="fe ph pi pj pk b">Checkout </code>组件。</p><h1 id="926b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">3.条带元素的初始化和配置</h1><blockquote class="ms mt mu"><p id="ffad" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">动态包含 Stripe.js</p></blockquote><h2 id="5d36" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">3.1 包括条纹:</h2><p id="5a94" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">它将创建一个脚本标签，加载我们的 Stripe javascript 文件，并将其添加到我们的应用程序的头部。这个方法接受两个参数，一个是我们动态加载的文件的 URL，它将是 Stripe JS 文件，另一个是在文件加载时运行的回调函数。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="d357" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们正确加载文件后，我们将进行回调，条带将被配置。</p><blockquote class="ms mt mu"><p id="54b9" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">配置条带元素</p></blockquote><h2 id="c35b" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">3.2 <strong class="ak">配置条纹:</strong></h2><p id="00de" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">还记得在<code class="fe ph pi pj pk b">mounted </code>方法中我们调用了<code class="fe ph pi pj pk b">includeStripe</code>方法，然后作为回调函数我们调用了<code class="fe ph pi pj pk b">configureStripe</code>方法，它负责为特定的支付会话创建 Stripe 对象。</p><p id="a4dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们之前声明为数据变量的<code class="fe ph pi pj pk b">stripe</code>将包含我们加载的 Stripe JS API 中的<code class="fe ph pi pj pk b">Stripe</code>对象的本地实例。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="1fe1" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">4.实现获取购物车商品的方法</h1><p id="3f47" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">首先，我们需要将购物车中的商品存储在一个数组中，并声明为一个名为<code class="fe ph pi pj pk b">checkoutBodyArray</code>的数据变量。</p><blockquote class="ms mt mu"><p id="25b0" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">那么，我们希望如何在数据变量中存储购物车商品呢？</p></blockquote><p id="687d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于 post API，我们在<a class="ae nm" href="https://medium.com/javarevisited/lets-add-a-checkout-feature-in-spring-boot-for-our-ecommerce-app-72b12a7f3648" rel="noopener">之前的</a>教程中实现需要购物车物品列表作为请求体，我们将购物车物品存储在<code class="fe ph pi pj pk b">checkoutBodyArray</code>中。</p><h2 id="9287" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">获取购物车商品</h2><p id="27cd" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们实现了<code class="fe ph pi pj pk b">getAllItems</code>方法，该方法调用 get API /cart，该 API /cart 返回购物车中的商品作为响应。因此，我们将这个响应存储在<code class="fe ph pi pj pk b">checkoutBodyArray</code>中，并将这个数组作为请求体传递给结账后端 API。</p><p id="9a81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在 mounted 方法中调用<code class="fe ph pi pj pk b">getAllItems </code>方法，因为我们希望在呈现 Checkout 组件时获取购物车商品。<strong class="jp ir">所以在我们之前实现的 mounted 方法中调用这个方法。</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure><h1 id="1f62" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">5.实现将购物车物品传递给后端 API 方法</h1><h2 id="98d3" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">将购物车商品传递给后端 API</h2><p id="cbed" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在，由于我们在<code class="fe ph pi pj pk b">checkoutBodyArray</code>中有购物车条目，我们需要将它传递给 post 方法。所以我们实现了调用 Axios post 的函数<code class="fe ph pi pj pk b">goToCheckout</code>。在将购物车商品数组传递给后端 API 之后，我们获得会话 id 作为响应。</p><p id="9121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们将会话 id 存储在本地存储中，然后调用 Stripe 的<code class="fe ph pi pj pk b">redirectToCheckout</code>方法，在该方法中，我们将从响应数据中收到的会话 id 存储在我们的<code class="fe ph pi pj pk b">sessionId</code>中，这将把用户重定向到 Stripe 托管的页面，以安全地收集支付信息。当用户完成购买后，他们会被重定向回我们的网站。</p><p id="6557" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是条纹结帐页面的外观</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi px"><img src="../Images/1150dc7ba11562d30d6321e1a52ab1ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3g-ZnkCWZgeUMFYCGOqz5g.png"/></div></div></figure><h1 id="6785" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">6.根据条纹支付的状态将用户导航到成功或失败支付组件</h1><p id="57a9" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在这里，我们处理付款的结果，即如果付款成功，我们将订单添加到订单表中，如果付款失败，我们将不添加该订单，并将用户导航到订单历史页面。</p><p id="80ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么支付的结果在哪里处理呢？我们没有在前端定义它，所以如果你还记得的话，在<a class="ae nm" href="https://medium.com/javarevisited/lets-add-a-checkout-feature-in-spring-boot-for-our-ecommerce-app-72b12a7f3648" rel="noopener">之前的</a>后端教程中(更准确地说是在<code class="fe ph pi pj pk b">OrderService</code>类中)我们定义了如下的<code class="fe ph pi pj pk b">success URL</code>和<code class="fe ph pi pj pk b">failure URL </code>。</p><pre class="km kn ko kp gt pp pk pq pr aw ps bi"><span id="b317" class="oh ky iq pk b gy pt pu l pv pw">SessionCreateParams params = SessionCreateParams.<em class="mv">builder</em>()<br/>        .addPaymentMethodType(SessionCreateParams.PaymentMethodType.<em class="mv">CARD</em>)<br/>        .setMode(SessionCreateParams.Mode.<em class="mv">PAYMENT</em>)<br/>        .setCancelUrl(failedURL)<br/>        .addAllLineItem(sessionItemsList)<br/>        .setSuccessUrl(successURL)<br/>        .build();</span></pre><p id="17db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且<code class="fe ph pi pj pk b"> failedURL </code>和<code class="fe ph pi pj pk b">successURL </code>被定义为</p><pre class="km kn ko kp gt pp pk pq pr aw ps bi"><span id="9cd4" class="oh ky iq pk b gy pt pu l pv pw">String successURL = baseURL + "payment/success";<br/>String failedURL = baseURL + "payment/failed";</span></pre><p id="1ed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">baseURL 是我们正在开发的<a class="ae nm" href="http://localhost:8081/" rel="noopener ugc nofollow" target="_blank">前端 Vuejs URL </a>。</p><blockquote class="ms mt mu"><p id="e060" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">根据条纹支付的状态将用户导航到成功或失败支付组件</p></blockquote><p id="3c62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要在源目录中创建一个名为<code class="fe ph pi pj pk b">helper </code>的文件夹，并在该文件夹中创建另一个名为<code class="fe ph pi pj pk b">payment</code>的文件夹。在这个文件夹中创建两个 vue 组件<code class="fe ph pi pj pk b">Failed.vue </code>和<code class="fe ph pi pj pk b">Success.vue</code>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi py"><img src="../Images/05fe091d9f0f5efea35ae4e85c34a2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*rxGIKDd9cGV7a2SjlrNPcw.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">文件夹结构</figcaption></figure><h2 id="a6fc" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">支付成功组件</h2><p id="121d" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">因此，在成功组件中，我们创建了<strong class="jp ir">数据变量</strong>令牌和会话 id，并定义了一个<strong class="jp ir">方法</strong>来<strong class="jp ir">将当前订单保存</strong>到我们的数据库中。</p><p id="4c1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在<code class="fe ph pi pj pk b">saveOrder </code>方法中，我们使用后端 API /order/add</p><p id="3429" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将在下一篇教程中讨论这个问题。</p><p id="2b63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解 API 的作用，请参考上面的 API 描述:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="0d8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功后，我们将用户重定向到订单历史组件，在那里可以看到当前订单和旧订单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pz"><img src="../Images/efa8b2358db8f17ae4c832c6d5250c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8DcD2Q_dWEbZ6jYRFaUwg.png"/></div></div></figure><h2 id="dca7" class="oh ky iq bd kz oi oj dn ld ok ol dp lh jy om on ll kc oo op lp kg oq or lt os bi translated">支付失败组件</h2><p id="fc58" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在该组件中，我们从本地存储中删除会话 id，并且不将该订单保存在订单表中。最后，我们仍然将用户导航到订单历史页面，但在这里当前订单不可见，但以前的订单将可用。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="pn po l"/></div></figure></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="b525" class="kx ky iq bd kz la nh lc ld le ni lg lh li nj lk ll lm nk lo lp lq nl ls lt lu bi translated">恭喜你！！！</h1><p id="ab5c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">您已经使用 Vuejs 和 Stripe 成功实现了支付网关的前端部分。你可以在<a class="ae nm" href="https://github.com/webtutsplus/ecommerce-vuejs" rel="noopener ugc nofollow" target="_blank"> Github </a>找到完整的代码。</p></div></div>    
</body>
</html>