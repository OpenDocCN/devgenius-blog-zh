<html>
<head>
<title>How to use pinia with composition script setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将 pinia 与合成脚本设置一起使用</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-pinia-with-composition-script-setup-2352558fb06c?source=collection_archive---------0-----------------------#2022-11-06">https://blog.devgenius.io/how-to-use-pinia-with-composition-script-setup-2352558fb06c?source=collection_archive---------0-----------------------#2022-11-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/24c7daba0f7addf9a0626228c8da2ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7Pf0sxi8yxlAHGaJ23vkQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片来自<a class="ae jz" href="https://dev.to/aaronksaunders/intro-to-using-pinia-for-state-management-in-vuejs-1n39" rel="noopener ugc nofollow" target="_blank">https://dev . to/aaronksaunders/intro-to-using-pinia-for-state-management-in-vuejs-1n 39</a></figcaption></figure><h1 id="f2d2" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">目的</h1><p id="5d10" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">最近，我被分配了一个 vue 项目，使用的是 pinia。这是第一次使用这个状态管理库，所以我想告诉你这个库的优点和缺点以及如何使用它。</p><h1 id="4b33" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">皮尼亚是什么？</h1><p id="68be" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">正如我已经提到的，pinia 是 vue 的一个状态管理库。如果你熟悉 vue，你应该听说过 vuex。是的，vuex 也是一个状态管理库，它是全球状态管理库事实上的标准。不过从 vue3 来看，pinia 是官方推荐使用的。</p><h1 id="a3fc" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">皮尼亚和 vuex 有什么区别？</h1><ol class=""><li id="3af7" class="lw lx in la b lb lc lf lg lj ly ln lz lr ma lv mb mc md me bi translated">省略突变。</li></ol><p id="8330" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">这是一个有争议的话题，但是我同意这个改变。基本上，vuex 来源于 flux 思想，它禁止直接改变状态，以保护状态不受意外变化的影响。因此，vuex 有“突变”方法，这是改变状态的唯一方法，我们需要提交内部操作来改变。当然，这种方式对于保护状态是必不可少的，但是这种特性使得 vuex 很难管理状态，也很复杂。Pinia 省略了这个突变特性，我们可以通过动作改变我们的状态并直接访问状态，因此我们可以更简单地管理状态。</p><p id="ea6d" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">2.完全支持 typescript</p><p id="b677" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">在 vuex 中，不完全支持 typescript，因此如果您想在 vuex 中使用 typescript，您需要创建自定义包装器来使用它。然而，pinia 默认支持 typescript，因此您可以轻松地将 vue3 与 typescript 一起使用。最近有很多项目使用了 typescript，所以添加它很重要。</p><p id="e223" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">3.分开的商店。</p><p id="bb16" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">在 vuex 中，有几个嵌套存储的全局存储用于整个存储。这对于小型项目也很有用，但是对于大型项目来说，管理嵌套存储有点困难。相反，在皮尼亚，有几个商店可以分开使用。这对于使用和管理状态更加灵活，尤其是对于大型项目。</p><p id="0ac6" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">好了，让我们深入一些例子。</p><h1 id="f520" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">示例 1 基本用法</h1><h2 id="1217" class="mk kb in bd kc ml mm dn kg mn mo dp kk lj mp mq ko ln mr ms ks lr mt mu kw mv bi translated">步伐</h2><ol class=""><li id="9c5a" class="lw lx in la b lb lc lf lg lj ly ln lz lr ma lv mb mc md me bi translated">创建 vue 项目并安装 pinia。在本例中，我使用 vite 创建了这个示例项目，但是您可以使用任何想要的东西</li></ol><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="7772" class="mk kb in nb b gy nf ng l nh ni"># npm 6.x<br/>npm create vite@latest my-vue-app --template vue<br/></span><span id="d30f" class="mk kb in nb b gy nj ng l nh ni"># npm 7+, extra double-dash is needed:<br/>npm create vite@latest my-vue-app -- --template vue<br/></span><span id="652f" class="mk kb in nb b gy nj ng l nh ni">#  Then, install pinia<br/>npm install pini</span></pre><p id="8a7a" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">2.创建一个 vue 文件并使用 pinia 作为插件</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a0c7" class="mk kb in nb b gy nf ng l nh ni">// main.js<br/>import { createApp } from 'vue'<br/>import { createPinia } from 'pinia'<br/>import App from './App.vue'<br/></span><span id="15f5" class="mk kb in nb b gy nj ng l nh ni">const pinia = createPinia()<br/>const app = createApp(App)<br/></span><span id="2ac1" class="mk kb in nb b gy nj ng l nh ni">app.use(pinia)<br/>app.mount('#a</span></pre><p id="0e64" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">3.创建您的商店。你可以使用选项存储和组合一。在这种情况下，我将重点讨论使用组合 Api 的选项存储方式。您需要设置 defineStore 并将第一个参数作为 id 传递。然后，可以设置三个对象“状态”、“getters”、“actions”。State 是使用 state 和 getters 添加一些计算属性来改变或处理状态。动作是设置业务逻辑，如获取信息。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="507b" class="mk kb in nb b gy nf ng l nh ni">import { defineStore } from 'pinia'<br/></span><span id="309b" class="mk kb in nb b gy nj ng l nh ni">export const useCounterStore = defineStore('counter', {<br/>  state: () =&gt; ({ count: 0 }),<br/>  getters: {<br/>    doubleCount: (state) =&gt; state.count * 2,<br/>  },<br/>  actions: {<br/>    increment() {<br/>      this.count++<br/>    },<br/>  },<br/>});</span></pre><p id="dfc9" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">4.用你的店。如果你想使用析构，你需要有“stateToRefs”来保持你的状态和 getters 是可反应的。另一方面，你可以只提取动作。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="14e6" class="mk kb in nb b gy nf ng l nh ni">&lt;script setup&gt;<br/>import { useCounterStore } from "./store";<br/>import { storeToRefs } from "pinia";<br/></span><span id="641b" class="mk kb in nb b gy nj ng l nh ni">const store = useCounterStore();<br/>const { doubleCount } = storeToRefs(store);<br/>const { increment } = store;<br/>&lt;/script&gt;<br/></span><span id="67d0" class="mk kb in nb b gy nj ng l nh ni">&lt;template&gt;<br/>  &lt;h1&gt;{{ store }}&lt;/h1&gt;<br/>  &lt;h2&gt;{{ doubleCount }}&lt;/h2&gt;<br/>  &lt;button @click="increment"&gt;count up&lt;/button&gt;<br/>&lt;/template</span></pre><p id="7d66" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">下面是我的屏幕。上述代码工作正常。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/58bf1af5418eade636b406b8392471a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*GnDnrGuOchG_a4sV.gif"/></div></figure><h1 id="327a" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">示例 2 获取数据</h1><h2 id="ef8f" class="mk kb in bd kc ml mm dn kg mn mo dp kk lj mp mq ko ln mr ms ks lr mt mu kw mv bi translated">步伐</h2><p id="38ba" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">*1 和 2 与示例 1 相同。您需要创建您的项目，安装 pinia 并在 main.js 中准备 pinia</p><p id="bf5d" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">3.创建你的商店。在这个例子中，我将关注一个数据获取的例子。我想使用 axios 来获取数据，所以您需要通过“npm i axios”添加 axios(您也可以使用 fetch API，所以这取决于您)。我从 jsonplaceholder 获取用户，并通过“this.users = res.data”注入状态</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="792a" class="mk kb in nb b gy nf ng l nh ni">import { defineStore } from "pinia";<br/>import axios from "axios";<br/></span><span id="22db" class="mk kb in nb b gy nj ng l nh ni">export const useFetchStore = defineStore("fetch", {<br/>  state: () =&gt; ({ users: [] }),<br/>  actions: {<br/>    async fetchUsers() {<br/>      try {<br/>        const res = await axios.get(<br/>          "https://jsonplaceholder.typicode.com/users"<br/>        );<br/>        this.users = res.data;<br/>        console.log("users", this.users);<br/>      } catch (err) {<br/>        console.error(err);<br/>      }<br/>    },<br/>  },<br/>});</span></pre><p id="eca4" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">4.像下面这样使用你的商店。我想在挂载 DOM 时获取数据，所以我使用 onMounted 钩子来获取数据。然后我提取用户名，用 v-for 表示。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="049e" class="mk kb in nb b gy nf ng l nh ni">&lt;script setup&gt;<br/>import { onMounted } from "vue";<br/>import { useFetchStore } from "./store";<br/>import { storeToRefs } from "pinia";<br/></span><span id="0cd3" class="mk kb in nb b gy nj ng l nh ni">const store = useFetchStore();<br/>const { users } = storeToRefs(store);<br/>const { fetchUsers } = store;<br/></span><span id="2f97" class="mk kb in nb b gy nj ng l nh ni">onMounted(() =&gt; {<br/>  fetchUsers();<br/>});<br/>&lt;/script&gt;<br/></span><span id="e8b6" class="mk kb in nb b gy nj ng l nh ni">&lt;template&gt;<br/>  &lt;div v-for="user in users" key="user.id"&gt;<br/>    {{ user.name }}<br/>  &lt;/div&gt;<br/>&lt;/templat</span></pre><p id="f598" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">下面是我的截屏和成功加载的用户名。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1d1e585d308a6f5a5030200b33fbcf90.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/0*87BCd3b6C-gUORMP.png"/></div></figure><p id="8734" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">注意，如果你想过滤第一个用户，你不能使用如下方式。这是因为获取用户数据的时间。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="e9a1" class="mk kb in nb b gy nf ng l nh ni">&lt;script setup&gt;<br/>import { onMounted, computed } from "vue";<br/>import { useFetchStore } from "./store";<br/>import { storeToRefs } from "pinia";<br/></span><span id="d1f4" class="mk kb in nb b gy nj ng l nh ni">const store = useFetchStore();<br/>const { users } = storeToRefs(store);<br/>const { fetchUsers } = store;<br/></span><span id="8ee2" class="mk kb in nb b gy nj ng l nh ni">&lt;------------------wrong code-------------------<br/>//This code is undefined because of the timing of fetching<br/>console.log("firstUser", users &amp;&amp; users[0]);<br/></span><span id="f2bc" class="mk kb in nb b gy nj ng l nh ni">// So, this code also has an error because users are not saving correctly in this time even if you add computed<br/></span><span id="9b22" class="mk kb in nb b gy nj ng l nh ni">const filterUser = computed(() =&gt; {<br/>  const result = users.filter((user) =&gt; user.id === 1);<br/>  console.log("result", result);<br/>  return result;<br/>});<br/></span><span id="05e4" class="mk kb in nb b gy nj ng l nh ni">// an error occured<br/>filterUser();<br/>-------------------------------------&gt;<br/></span><span id="f299" class="mk kb in nb b gy nj ng l nh ni">onMounted(() =&gt; {<br/>  fetchUsers();<br/>});<br/>&lt;/script&gt;<br/></span><span id="34e2" class="mk kb in nb b gy nj ng l nh ni">&lt;template&gt;<br/>  &lt;div v-for="user in users" key="user.id"&gt;<br/>    {{ user.name }}<br/>  &lt;/div&gt;<br/>&lt;/tem</span></pre><p id="0464" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">所以，如果你想过滤第一个用户，你需要在 useFetchStore 中添加 getters，如下所示。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="29d1" class="mk kb in nb b gy nf ng l nh ni">import { defineStore } from "pinia";<br/>import axios from "axios";<br/></span><span id="32e9" class="mk kb in nb b gy nj ng l nh ni">export const useFetchStore = defineStore("fetch", {<br/>  state: () =&gt; ({ users: [] }),<br/> // Need to add filter here<br/>  getters: {<br/>    filteredFirstUser() {<br/>      return this.users[0];<br/>    },<br/>  },<br/>  actions: {<br/>    async fetchUsers() {<br/>      try {<br/>        const res = await axios.get(<br/>          "https://jsonplaceholder.typicode.com/users"<br/>        );<br/>        this.users = res.data;<br/>        console.log("users", this.users);<br/>      } catch (err) {<br/>        console.error(err);<br/>      }<br/>    },<br/>  },<br/>});</span></pre><p id="80f4" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">并使用如下数据</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="8ba2" class="mk kb in nb b gy nf ng l nh ni">&lt;script setup&gt;<br/>import { onMounted } from "vue";<br/>import { useFetchStore } from "./store";<br/>import { storeToRefs } from "pinia";<br/></span><span id="78b8" class="mk kb in nb b gy nj ng l nh ni">const store = useFetchStore();<br/>// destructuring as refs same as state<br/>const { filteredFirstUser } = storeToRefs(store);<br/>const { fetchUsers } = store;<br/></span><span id="7ac1" class="mk kb in nb b gy nj ng l nh ni">onMounted(() =&gt; {<br/>  fetchUsers();<br/>});<br/>&lt;/script&gt;<br/></span><span id="c63c" class="mk kb in nb b gy nj ng l nh ni">&lt;template&gt;<br/>// Use same as state<br/>  &lt;div v-for="firstUserData in filteredFirstUser" key="userData.id"&gt;<br/>    {{ firstUserData }}<br/>  &lt;/div&gt;<br/>&lt;/templat</span></pre><p id="3ee4" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">下面是我的屏幕，你可以看到上面的代码工作正常。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/0cd6dd34ea4643a0426493afdc1247d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QjhHaNouWLto1nd7.png"/></div></div></figure><p id="7ea9" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">获取数据的时间对我来说是最奇怪的部分之一，因为我已经习惯了使用 React 方式。在 react 中，您可以在同一个 JS 脚本中获取数据和过滤数据。但是，vue.js 和 pinia 不允许。</p><p id="3eaa" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">我团队中的一位高级开发人员说 React 专注于‘脚本’。相反，vue 侧重于‘模板’。所以你需要知道 react 和 vue way 之间的区别，我认为这个想法是正确的，因为很难用像' users[0]这样的点来访问获取的数据。name '，或者在脚本文件中的 vue 中过滤和映射(我经常用 React 这种方式)。</p><p id="f794" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">我知道我们可以在 vue 中使用 filter 和 map 以及 computed，但与 react 相比不太常用。</p><h1 id="a35a" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结论</h1><p id="9d9e" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">Pinia 是一个很棒的全球管理商店库，了解如何使用 pinia 很重要。</p><p id="6030" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">我觉得这篇文章对 react 开发者特别有用(但是需要像我一样使用)。</p><h1 id="41ce" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">参考</h1><p id="6e2b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">皮尼亚官方网站:<a class="ae jz" href="https://pinia.vuejs.org/" rel="noopener ugc nofollow" target="_blank">https://pinia.vuejs.org/</a></p><p id="c51d" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">vite 官方网站:【https://vitejs.dev/ T2】</p><p id="67b3" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">感谢您的阅读！！！</p></div></div>    
</body>
</html>