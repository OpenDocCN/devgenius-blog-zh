<html>
<head>
<title>C Programming Hacks 2: Efficiently Reading a File Line-by-line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">c 编程技巧 2:高效地逐行读取文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/c-programming-hacks-2-efficiently-reading-a-file-line-by-line-407ab2bd96cc?source=collection_archive---------14-----------------------#2020-06-24">https://blog.devgenius.io/c-programming-hacks-2-efficiently-reading-a-file-line-by-line-407ab2bd96cc?source=collection_archive---------14-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="23a8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">getline()、fgets()和 fscanf()之间有趣的比较</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cec06fba67e7fe20dbb6d93921c2ad37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gxVJED9tJPRQxmtl"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">伊利亚·巴甫洛夫在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c60a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">读取文件，尤其是逐行读取，是我们作为程序员经常做的事情。我从事一个有趣的项目已经有一段时间了，它有两个重要的方面:</p><ul class=""><li id="6201" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">它涉及到<strong class="ky ir">大量的文件 I/O 和逐行处理</strong></li><li id="fcb9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">主要目标是<strong class="ky ir">最大化性能</strong></li></ul><p id="35ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们大多数人都会同意，C 通常比大多数其他编程语言(如 java、python 等)更好。)说到性能(至少我是这么觉得的:-)。因此，我决定用 c 语言开发这个程序。然而，要逐行读取文件，有多种选择。因为我的程序涉及大量的文件 I/O，所以选择正确的函数来最小化时间消耗是至关重要的。这篇文章是关于那些实验和获得的结果。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="c1fe" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">getline() vs fgets() vs fscanf()</h1><p id="160a" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">可能还有其他几个函数提供相同的功能，但最常用的是 getline()、fgets()和 fscanf()。为了进行性能分析，我使用了一个 6.9 Gb 的文本文件，它包含 40，579，836 行，每行大约 300 个字符。</p><p id="48ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是我使用的代码集。[ <em class="nk">每个功能都可以独立执行</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="85fc" class="nn mo iq bd mp no np dn mt nq nr dp mx lf ns nt mz lj nu nv nb ln nw nx nd ny bi translated">结果呢</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/8c9dbe262d9dffde794a7b8ce0b91ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVpOJPIge8LsDWYqQE0mSQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/b36b68aef0c9a04988c1593821c5a274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-AxV6qtbUBcgK6AuwAkAg.png"/></div></div></figure><p id="d07a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果清楚地表明，fgets()和 getline()具有相似的性能，在时间消耗上的差异可以忽略不计。另一方面，fscanf()几乎比其他的要慢 7 倍。</p><h2 id="76d5" class="nn mo iq bd mp no np dn mt nq nr dp mx lf ns nt mz lj nu nv nb ln nw nx nd ny bi translated">结论是…</h2><p id="f960" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">如果您希望逐行读取文件，并且性能是您主要关心的问题，请选择 fgets()或 getline()。</p><p id="f15d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更重要的是，当有多种选择可用时，养成自己进行这种实验的习惯，找出更适合你需求的一种。盲目地使用 google 搜索中的代码可能会显著降低性能(在我的例子中，选择 fscanf()会使文件 I/O 的运行时间增加 7 倍)。</p></div></div>    
</body>
</html>