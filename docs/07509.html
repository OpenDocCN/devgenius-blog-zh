<html>
<head>
<title>How to install a passwordless OpenSSH server within a docker container using public-private key pairs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ä½¿ç”¨å…¬ç§å¯†é’¥å¯¹åœ¨ docker å®¹å™¨ä¸­å®‰è£…æ— å¯†ç  OpenSSH æœåŠ¡å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/how-to-install-an-openssh-server-within-a-docker-container-with-a-passwordless-public-private-key-f4f4be9ef9f9?source=collection_archive---------9-----------------------#2022-03-31">https://blog.devgenius.io/how-to-install-an-openssh-server-within-a-docker-container-with-a-passwordless-public-private-key-f4f4be9ef9f9?source=collection_archive---------9-----------------------#2022-03-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="64f3" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">ä¸ºä»€ä¹ˆè¦åœ¨ docker å®¹å™¨ä¸­å®‰è£… OpenSSH æœåŠ¡å™¨ï¼Ÿ</h1><p id="0f66" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">å½“æ‚¨ç¼–å†™å®‰è£…è¿œç¨‹æœåŠ¡å™¨æˆ–äº‘å®ä¾‹çš„æ–¹æ³•æ—¶ï¼Œæ‚¨å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œä¹‹å‰ç¡®ä¿å®ƒèƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><p id="c067" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">åœ¨è¿œç¨‹å®ä¾‹ä¸­æµ‹è¯•è¿™ç§è„šæœ¬å¯èƒ½éœ€è¦å°†å…¶é‡ç½®ä¸ºåˆå§‹çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€é¡¹è€—æ—¶çš„ä»»åŠ¡ã€‚</p><p id="8541" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">é€šè¿‡ç”¨æœ¬åœ° docker å®¹å™¨æ›¿æ¢è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‚¨æ— éœ€èŠ±è´¹ä»»ä½•æˆæœ¬ï¼Œæ‚¨å¯ä»¥åŠ é€Ÿå¼€å‘è¿‡ç¨‹ï¼Œå¹¶ä¸”æ¯æ¬¡æ‚¨æƒ³è¦å†æ¬¡è¿è¡Œè„šæœ¬æ—¶ï¼Œæ‚¨åªéœ€é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œå®ƒå°±ä¼šç«‹å³æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚</p><h2 id="e47f" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">ç”Ÿæˆå…¬é’¥-ç§é’¥å¯¹</h2><p id="50be" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">ä½¿ç”¨â€œssh-keygenâ€å‘½ä»¤ç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="7cfc" class="ll jl in mc b gy mg mh l mi mj">ssh-keygen -t rsa -b 4096 -C "<a class="ae mk" href="mailto:ubuntu@example.com" rel="noopener ugc nofollow" target="_blank">ubuntu@example.com</a>" -f id_rsa -P ""</span></pre><p id="b3fc" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">åº”è¯¥ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ id_rsa å’Œ id_rsa.pubï¼Œå®ƒä»¬å°†åœ¨ç¨åç”¨äº SSH è¿æ¥ã€‚</p><h2 id="c3bb" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">æ–‡æ¡£æ–‡ä»¶</h2><p id="5132" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">åˆ›å»ºä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œå¤åˆ¶/ç²˜è´´ä¸‹é¢çš„ä»£ç :</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="608a" class="ll jl in mc b gy mg mh l mi mj">FROM ubuntu:21.10</span><span id="c507" class="ll jl in mc b gy ml mh l mi mj">RUN apt update &amp;&amp; apt install openssh-server sudo -y</span><span id="553b" class="ll jl in mc b gy ml mh l mi mj">RUN useradd -rm -d /home/ubuntu -s /bin/bash -g root -G sudo -u 1000 ubuntu</span><span id="a830" class="ll jl in mc b gy ml mh l mi mj">RUN  echo 'ubuntu:ubuntu' | chpasswd</span><span id="3021" class="ll jl in mc b gy ml mh l mi mj">RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' &gt;&gt; \ /etc/sudoers</span><span id="69e1" class="ll jl in mc b gy ml mh l mi mj">RUN mkdir /home/ubuntu/.ssh</span><span id="876d" class="ll jl in mc b gy ml mh l mi mj">COPY ./id_rsa.pub /home/ubuntu/.ssh/id_rsa.pub</span><span id="24e4" class="ll jl in mc b gy ml mh l mi mj">RUN cat /home/ubuntu/.ssh/id_rsa.pub &gt;&gt; /home/ubuntu/.ssh/authorized_keys</span><span id="d479" class="ll jl in mc b gy ml mh l mi mj">RUN chmod -R go= /home/ubuntu/.ssh</span><span id="3323" class="ll jl in mc b gy ml mh l mi mj">RUN chown -R ubuntu /home/ubuntu/.ssh</span><span id="9dda" class="ll jl in mc b gy ml mh l mi mj">RUN service ssh start</span><span id="b8aa" class="ll jl in mc b gy ml mh l mi mj">EXPOSE 22</span><span id="4bb5" class="ll jl in mc b gy ml mh l mi mj">CMD ["/usr/sbin/sshd","-D"]</span></pre><p id="600a" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">è¿™ä¸ª docker æ–‡ä»¶æ‰©å±•äº†å®˜æ–¹çš„ ubuntu æ˜ åƒï¼Œå®‰è£…äº†â€œopenssh-serverâ€å’Œâ€œsudo â€,ç„¶ååˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œUbuntuâ€çš„ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·æ‹¥æœ‰ root æƒé™ï¼Œæ²¡æœ‰å¯†ç ã€‚</p><p id="bd66" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">å…¬é’¥è¢«å¤åˆ¶å¹¶æ·»åŠ åˆ° authorized_keys æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨ç§é’¥é€šè¿‡ SSH è¿›è¡Œè¿æ¥ã€‚</p><h2 id="2505" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">docker-compose.yml</h2><p id="2eda" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">åˆ›å»ºä¸€ä¸ªåä¸º docker-compose.yml çš„æ–‡ä»¶ï¼Œå¤åˆ¶/ç²˜è´´ä¸‹é¢çš„ä»£ç :</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="4813" class="ll jl in mc b gy mg mh l mi mj">version: '3'</span><span id="caea" class="ll jl in mc b gy ml mh l mi mj">services:</span><span id="6bb8" class="ll jl in mc b gy ml mh l mi mj">    ubuntu_01:<br/>        container_name: ubuntu_01<br/>        build:<br/>            context: .<br/>            dockerfile: Dockerfile<br/>        networks:<br/>            - network</span><span id="2857" class="ll jl in mc b gy ml mh l mi mj">    ubuntu_02:<br/>        container_name: ubuntu_02<br/>        build:<br/>            context: .<br/>            dockerfile: Dockerfile<br/>        networks:<br/>            - network</span><span id="bde6" class="ll jl in mc b gy ml mh l mi mj">    ubuntu_03:<br/>        container_name: ubuntu_03<br/>        build:<br/>            context: .<br/>            dockerfile: Dockerfile<br/>        networks:<br/>            - network</span><span id="a1b0" class="ll jl in mc b gy ml mh l mi mj">networks:<br/>    network:<br/>        driver: bridge</span></pre><p id="d251" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">è¿™ä¸ª docker ç»„åˆä½¿ç”¨ç›¸åŒçš„å…ˆå‰åˆ›å»ºçš„æ˜ åƒå®šä¹‰ 3 ä¸ªå®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬é™„åŠ åˆ°ç½‘ç»œã€‚</p><h2 id="d9c2" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">æ‰“å¼€é›†è£…ç®±</h2><p id="8977" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">è®©æˆ‘ä»¬è¿è¡Œå®ƒä»¬:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="6788" class="ll jl in mc b gy mg mh l mi mj">docker-compose up -d</span></pre><p id="2fe2" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">éªŒè¯ä¸€åˆ‡æ­£å¸¸è¿è¡Œ:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="bdfe" class="ll jl in mc b gy mg mh l mi mj">docker ps</span></pre><p id="9243" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">æ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„å†…å®¹:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="ef3e" class="ll jl in mc b gy mg mh l mi mj">CONTAINER ID   IMAGE                  COMMAND               CREATED             STATUS             PORTS     NAMES<br/>4d1b8091014e   ubuntu-ssh_ubuntu_03   "/usr/sbin/sshd -D"   About an hour ago   Up About an hour   22/tcp    ubuntu_03<br/>506d1af29f25   ubuntu-ssh_ubuntu_02   "/usr/sbin/sshd -D"   About an hour ago   Up About an hour   22/tcp    ubuntu_02<br/>76c85e4fe2ec   ubuntu-ssh_ubuntu_01   "/usr/sbin/sshd -D"   About an hour ago   Up About an hour   22/tcp    ubuntu_01</span></pre><h2 id="c036" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">è·å–â€œubuntu_01â€å®¹å™¨ IP</h2><p id="0203" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ ¹æ®åç§°è·å–å®¹å™¨ IP:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="402d" class="ll jl in mc b gy mg mh l mi mj">docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' ubuntu_01</span></pre><p id="0f87" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">è¾“å‡ºåº”è¯¥ç±»ä¼¼äº:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="fcc5" class="ll jl in mc b gy mg mh l mi mj">172.25.0.4</span></pre><h2 id="ec59" class="ll jl in bd jm lm ln dn jq lo lp dp ju kt lq lr jy kx ls lt kc lb lu lv kg lw bi translated">é€šè¿‡ SSH è¿æ¥åˆ°â€œubuntu_01â€å®¹å™¨</h2><p id="b739" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">ä¸€åˆ‡éƒ½å·²å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨â€œubuntuâ€ç”¨æˆ·å’Œç§é’¥è¿æ¥åˆ°å®¹å™¨â€œubuntu_01 â€:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="0f54" class="ll jl in mc b gy mg mh l mi mj">ssh ubuntu@172.25.0.4 -i id_rsa</span></pre><p id="9986" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">å¯¹äºç¬¬ä¸€æ¬¡è¿æ¥ï¼Œå®ƒä¼šè¦æ±‚æ‚¨ç¡®è®¤ä¸»æœºï¼Œåªéœ€é”®å…¥â€œæ˜¯â€å¹¶æŒ‰â€œå›è½¦â€å³å¯ã€‚</p><p id="e39a" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">é€šè¿‡æ·»åŠ é€‰é¡¹"-o StrictHostKeyChecking=no "æ¥ç¦ç”¨ä¸»æœºæ£€æŸ¥ï¼Œå¹¶ä½¿ç”¨" docker inspect â€¦"æ¥è·å– IP ä½œä¸ºå˜é‡ï¼Œè¿™å°†ä½¿æ‚¨å¯ä»¥ä½¿ç”¨ä¸€æ¡çº¿è·¯è¿›è¡Œè¿æ¥ï¼Œè€Œæ— éœ€å¯†ç æˆ–ä¸»æœºæ£€æŸ¥ã€‚</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="48d7" class="ll jl in mc b gy mg mh l mi mj">ssh -o StrictHostKeyChecking=no ubuntu@$(docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' ubuntu_01) -i id_rsa</span></pre><p id="df0d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">æˆ‘å¸Œæœ›è¿™å°†æ˜¯æœ‰ç”¨çš„ï¼Œæˆ‘æ„¿æ„æ¥å—ä»»ä½•åé¦ˆæ¥æ”¹è¿›è¿™ç¯‡æ–‡ç« ã€‚</p><p id="b80c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">æ„Ÿè°¢æ‚¨çš„é˜…è¯»:)</p><p id="4f73" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">æ¬¢è¿<strong class="kk io">å…³æ³¨</strong>äº†è§£æ›´å¤šå†…å®¹ğŸ””ï¼Œ<strong class="kk io">æ‹æ‹</strong>ğŸ‘ğŸ»<strong class="kk io">ä¸ä½ å–œæ¬¢çš„ä»»ä½•äººåˆ†äº«æ–‡ç« </strong>ã€‚</p><p id="f42c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘æ„Ÿè°¢ä½ çš„æ”¯æŒã€‚</p></div></div>    
</body>
</html>