<html>
<head>
<title>Computed properties with useReducer and Context in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 中带有 useReducer 和上下文的计算属性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/computed-properties-with-usereducer-and-context-in-react-d10d4adfdae5?source=collection_archive---------5-----------------------#2022-05-08">https://blog.devgenius.io/computed-properties-with-usereducer-and-context-in-react-d10d4adfdae5?source=collection_archive---------5-----------------------#2022-05-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c403659fa819b5b401654ca9bbca68fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1nvJ2T-7AYxOSrxZQnEgg.png"/></div></div></figure><h1 id="bcd0" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">一点背景知识</h1><p id="1616" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">最近，我参与了一个<strong class="kv io"> React-Native </strong>移动项目，在这个项目中，我有机会选择我的技术组合。</p><p id="85de" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">由于我有一个主要面向网络的背景，我习惯于默认使用<strong class="kv io"> Redux </strong>作为选择的<strong class="kv io">状态管理</strong>工具。</p><p id="c2af" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">但是由于项目相当小，我试着只使用<strong class="kv io">上下文 API </strong>和<strong class="kv io"> useReducer </strong>来执行状态管理，总体来说效果很好。</p><h1 id="bbaf" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">问题</strong></h1><p id="eb48" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我发现自己编写了同样的逻辑，一遍又一遍地导出状态，并且我注意到在使用这个上下文和 useReducer 时，没有现成的"<strong class="kv io"> computed property' </strong>"特性。</p><h1 id="4422" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">等等，什么是计算属性？</h1><ul class=""><li id="2d4f" class="lw lx in kv b kw kx la lb le ly li lz lm ma lq mb mc md me bi translated">每当<strong class="kv io">所依赖的</strong>值之一发生变化时，该值就会<strong class="kv io">重新计算</strong>。</li><li id="d313" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">它有许多名字，如<strong class="kv io">派生状态</strong>、<strong class="kv io">虚场</strong>、<strong class="kv io">反应性质、</strong>等</li><li id="f534" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">其他成熟的库都是开箱即用的，比如<strong class="kv io"> Redux </strong>、<strong class="kv io"> Vue/Vuex </strong>和<strong class="kv io"> EasyPeasy、</strong>等等。</li></ul><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/e1ff9825a96cb711bcdaa98cf346d2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6IultTVjdN_lrKmyFkTCxg.gif"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><em class="mt">一张 GIF 胜过千言万语，所以我将在这里发布一个计算属性的实例:</em></figcaption></figure></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h1 id="39b4" class="jv jw in bd jx jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks bi translated">酷毙了。现实世界的例子好吗？</h1><p id="c41f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">假设你正在开发一个租车应用，让你在旅途中可以在附近租车。</p><p id="e1a5" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">您和汽车之间的会话模型将具有以下可能的状态:</p><pre class="ml mm mn mo gt ng nh ni nj aw nk bi"><span id="236c" class="nl jw in nh b gy nm nn l no np">'none' | 'booked' | 'started' | 'ended' | 'feedback'</span></pre><ul class=""><li id="68ea" class="lw lx in kv b kw lr la ls le nq li nr lm ns lq mb mc md me bi translated">除非你对汽车做了什么，否则<strong class="kv io">不会有会话</strong>——<strong class="kv io">用户界面不会显示计时器</strong></li><li id="353c" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">为了到达那辆车，你将<strong class="kv io">预订</strong>它— <strong class="kv io"> UI 显示一个剩余预订时间的计时器(可选)</strong></li><li id="a5b9" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">一旦你进入汽车，会话将<strong class="kv io">开始</strong>——<strong class="kv io">用户界面显示会话持续时间的计时器</strong></li><li id="6886" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">一旦您<strong class="kv io">结束</strong>会话— <strong class="kv io"> UI 就会显示一个计费屏幕</strong></li><li id="4b17" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">一旦会话成功结束，它将进入反馈模式— <strong class="kv io"> UI 显示反馈屏幕(可选)</strong></li></ul><blockquote class="nt nu nv"><p id="35a5" class="kt ku nw kv b kw lr ky kz la ls lc ld nx lt lg lh ny lu lk ll nz lv lo lp lq ig bi translated">从上面可以看出，<strong class="kv io">预定的</strong>和<strong class="kv io">开始的</strong>状态都必须显示一个计时器，这可能意味着应用程序有一个正在进行的状态，我们可以将其转换为布尔类型的<strong class="kv io">计算属性</strong>称为<code class="fe oa ob oc nh b">isOngoingSession</code>。</p></blockquote></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h1 id="ef56" class="jv jw in bd jx jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks bi translated">具有状态属性的经典方法</h1><p id="eb37" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">以下是会话模型的精简商店的外观:</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="e9a4" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">例如，如果您尝试注入状态并检查会话是否正在进行:</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="17a1" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">使用这种方法，并将其扩展到一百个不同的文件可能会很麻烦，原因如下:</p><ul class=""><li id="d1c8" class="lw lx in kv b kw lr la ls le nq li nr lm ns lq mb mc md me bi translated">这是一个重复的过程，试图在脑海中记住什么状态定义了一个正在进行的<strong class="kv io">会话，而且你可能会时不时地弄错</strong></li><li id="ad53" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">在编写<strong class="kv io">魔法字符串</strong>时，你必须<strong class="kv io">注意拼写错误</strong></li><li id="382b" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">如果您<strong class="kv io">稍后</strong>想要<strong class="kv io">更新</strong>正在进行的会话的含义，并且需要添加另一个状态，那么遍历每个组件来这样做将是非常糟糕的，并且显然容易出错</li></ul></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h1 id="3809" class="jv jw in bd jx jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks bi translated">具有计算属性的方法</h1><p id="03ba" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们通过直接在状态中移动上面的条件来尝试改进我们已经拥有的。</p><p id="1355" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">这将是引入我们的计算对象(<em class="nw">第 21 行</em>)的好地方，在这里我们现在可以定义一个从处于<code class="fe oa ob oc nh b">booked</code>或<code class="fe oa ob oc nh b">started</code>状态的<code class="fe oa ob oc nh b">session</code>属性派生的<code class="fe oa ob oc nh b">isOngoingSession</code>布尔值。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="09d7" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">现在，让我们尝试将新的计算属性注入到组件中:</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="e229" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">这种方法的好处在于:</p><ul class=""><li id="40ff" class="lw lx in kv b kw lr la ls le nq li nr lm ns lq mb mc md me bi translated">你只需要<strong class="kv io">写一次</strong></li><li id="d6b8" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">它不太容易出错，因为你只是从商店里注射</li><li id="1b09" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">这又回到了那个古老的咒语:将逻辑/状态/无论什么提升到一个更高的层次，我们的是会话存储</li><li id="4619" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">我们让我们的<strong class="kv io">组件更笨，</strong>有时候更笨是可以的</li><li id="60e6" class="lw lx in kv b kw mf la mg le mh li mi lm mj lq mb mc md me bi translated">请记住，当然，您可以传递<strong class="kv io">其他类型的数据</strong>如带参数的<strong class="kv io">函数</strong>。</li></ul><h1 id="e104" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="42c4" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我们通过对计算商店内正在进行的会话的逻辑冒泡，对我们的代码库做了一个小小的改进。</p><p id="7113" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">之前，我们不得不在所有组件中重复相同的逻辑，如果不小心的话，这可能会导致一些<strong class="kv io">错误</strong>。</p><p id="bb8d" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">每当你写完一些代码，你应该<strong class="kv io">总是回头</strong>看看是否有什么方法可以<strong class="kv io">让</strong>写完。</p><p id="073e" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">非常感谢你的阅读！我希望这篇文章提供了一些有用的见解。</p><p id="e6fc" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">祝一切顺利，<br/>——萨沙</p></div></div>    
</body>
</html>