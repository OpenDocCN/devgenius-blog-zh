<html>
<head>
<title>Data Ingestion with PipelineWise and Airflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过管道和气流接收数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/data-ingestion-with-pipelinewise-and-airflow-cdc69f72148f?source=collection_archive---------5-----------------------#2022-09-12">https://blog.devgenius.io/data-ingestion-with-pipelinewise-and-airflow-cdc69f72148f?source=collection_archive---------5-----------------------#2022-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4955" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">欢迎来到我的第一篇文章！我猜你偶然发现了这个指南，因为在互联网上很少有关于 PipelineWise 的资源。我希望这个指南能帮助你实现你的目标。</p><p id="0e1a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我们开门见山吧！</p><h1 id="15f3" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">管道方向和气流</h1><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/a32ac5327bb47ac6103a6dfb9592d120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CAmdJNjYiqdSuQXY_5gFBQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">管线式连接器(来源:管线式文件)</figcaption></figure><p id="ff85" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lw" href="https://transferwise.github.io/pipelinewise/index.html" rel="noopener ugc nofollow" target="_blank"> PipelineWise </a>是由<a class="ae lw" href="https://wise.com/gb/blog/world-meet-wise" rel="noopener ugc nofollow" target="_blank"> TransferWise(现称 Wise) </a>于 2018 年打造的开源数据摄取工具。PipelineWise 构建在<a class="ae lw" href="https://www.singer.io/" rel="noopener ugc nofollow" target="_blank"> Singer.io </a>规范之上，允许您将管道配置为 YAML 文件中的代码。在 ELT 范例中，PipelineWise 在数据管道的提取端扮演类似于 Airbyte、Meltano 和 Stitch 的角色。</p><p id="9cd0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lw" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Airflow </a>是一个流行的调度和数据编排工具，用于创建 Dag 形式的复杂工作流。Airflow 因数据工程管道而受欢迎，由 AirBnB 于 2014 年创建。</p><p id="dac9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本指南中使用这两个工具的目的是:<br/> 1。使用管道方式，定义将数据从源数据库移动到目标数据仓库的数据提取配置。<br/> 2。根据气流时间间隔安排提取管道运行。</p><h1 id="0a8d" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">假设</h1><p id="0aba" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在继续阅读本指南之前，作者假设读者:<br/> -具有 Unix/Linux Bash CLI 命令的基本知识。在本指南中，我们将使用 Ubuntu。<br/> -具有气流设置，适合与 Dag 一起工作。<br/> -对码头工人和集装箱有基本的了解。<br/> -了解数据复制概念，如全负载、增量负载和基于日志的负载(CDC)。</p><p id="4920" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些概念将在本指南中使用。但是，如果它们对您来说是新的，则超出了本文的范围。你仍然可以继续前进，不需要面对很多挑战。请注意，所列概念面临的错误必须在各自的领域中解决。</p><h1 id="cf5f" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">管道式安装</h1><p id="3abd" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">PipelineWise 可以通过从源代码构建或使用 Docker 来安装。对于我们的用例，Docker 是管道式安装的更简单的方法。</p><p id="eddc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，用<code class="fe mc md me mf b">docker info</code>命令验证 Docker 是否安装，否则<a class="ae lw" href="https://docs.docker.com/engine/install/ubuntu/" rel="noopener ugc nofollow" target="_blank">为 Ubuntu 安装 Docker 引擎</a>。</p><p id="7962" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其次，运行以下命令克隆 PipelineWise repo 并构建 docker 映像:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="86d1" class="mk kj in mf b gy ml mm l mn mo">$ git clone https://github.com/transferwise/pipelinewise.git<br/>$ cd ./pipelinewise<br/>$ docker build --no-cache -t pipelinewise:latest .</span></pre><p id="8bc4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第三，为 pipelinewise-docker 入口点创建一个别名。这将允许我们在不指定完整路径的情况下使用<code class="fe mc md me mf b">pipelinewise</code>命令。将这行代码添加到您的<code class="fe mc md me mf b">~/.bashrc</code> : <code class="fe mc md me mf b">alias pipelinewise='&lt;fullpath&gt;/bin/pipelinewise-docker'</code>。将<code class="fe mc md me mf b">&lt;fullpath&gt;</code>替换为克隆的 PipelineWise 安装文件夹的完整路径。您可以通过<code class="fe mc md me mf b">source ~/.bashrc</code>来实现您的更改:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="807d" class="mk kj in mf b gy ml mm l mn mo">$ vi ~\.bashrc<br/>$ source ~\.bashrc</span></pre><p id="6fb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，使用<code class="fe mc md me mf b">pipelinewise status</code>命令验证安装是否成功。如果没有错误消息，您将看到关于 Tap ID、Tap 类型、目标 ID 和 co 的输出:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="0828" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise status</span></pre><h1 id="e858" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">创建管道</h1><p id="5c15" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">管道方面的“管道”基本上是将数据从“分支”或源加载到“目标”或目的地的配置。这些配置是在 YAML 模板中定义的。</p><p id="ac40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先初始化一个新项目。这将为所有支持的连接器创建一个包含示例配置 YAML 文件的文件夹:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="a083" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise init --name samples</span></pre><p id="543e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，您将为您的点击(与源相同)和目标(与目的相同)复制一个样本。对于这个演示，我的 taps 将是<a class="ae lw" href="https://transferwise.github.io/pipelinewise/connectors/taps/mysql.html" rel="noopener ugc nofollow" target="_blank"> MySQL </a>和<a class="ae lw" href="https://transferwise.github.io/pipelinewise/connectors/taps/postgres.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>，我的目标将是<a class="ae lw" href="https://transferwise.github.io/pipelinewise/connectors/targets/redshift.html" rel="noopener ugc nofollow" target="_blank"> Redshift </a>:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="f649" class="mk kj in mf b gy ml mm l mn mo">$ mv /samples/tap_mysql_mariadb.yml.sample tap_mysql_one.yml<br/>$ mv /samples/tap_postgres.yml.sample tap_postgres_one.yml<br/>$ mv /samples/target_redshift.yml.sample  target_redshift.yml</span></pre><p id="e4e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您可以使用选择的文本编辑器修改配置 YAML 文件。你可以查看文档中关于<a class="ae lw" href="https://transferwise.github.io/pipelinewise/installation_guide/creating_pipelines.html#example-replication-mysql-to-snowflake" rel="noopener ugc nofollow" target="_blank">的真实例子</a>。</p><p id="ea62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完成后，您的项目结构应该如下所示:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="236e" class="mk kj in mf b gy ml mm l mn mo">└── pipelinewise_samples<br/>    ├── samples<br/>    ├── .gitignore<br/>    ├── README.md<br/>    ├── tap_mysql_connectel.yml<br/>    ├── tap_mysql_odoo_erp.yml<br/>    ├── target_redshift.yml</span></pre><h2 id="ce7e" class="mk kj in bd kk mp mq dn ko mr ms dp ks jv mt mu kw jz mv mw la kd mx my le mz bi translated">加密密码(可选)</h2><p id="fdf0" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">PipelineWise 使用 Ansible Vault python 库对配置 YAML 文件中使用的机密进行加密。首先，您将创建一个包含主密码的文件。然后，您可以使用主密码文件散列任何秘密字符串(例如 DB password ),并将其添加到配置 YAML 文件中。</p><p id="b143" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要创建主密码文件，请使用以下命令:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="fd01" class="mk kj in mf b gy ml mm l mn mo">$ echo "M@st3rP@ssw0rd" &gt; vault-password.txt</span></pre><p id="2798" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要使用主密码散列秘密字符串，请使用以下命令:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="8662" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise encrypt_string --secret vault-password.txt --string "D@t@baZEpassMord"</span></pre><p id="815e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，您可以将加密的密码复制并粘贴到您的配置 YAML 文件中。点击在文档<a class="ae lw" href="https://transferwise.github.io/pipelinewise/user_guide/encrypting_passwords.html" rel="noopener ugc nofollow" target="_blank">中找到更多关于加密秘密的细节。</a></p><h1 id="1656" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">导入 YAML 配置</h1><p id="8392" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">每当<strong class="jm io">创建或修改</strong>一个配置 YAML 文件时，它必须在使用前被导入。<code class="fe mc md me mf b">pipelinewise import</code>命令在当前用户的<code class="fe mc md me mf b">~/.pipelinewise</code>目录下生成 JSON 文件。Singer 组件使用 JSON 文件。</p><p id="0f20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要将配置 YAML 文件导入当前目录，请使用<code class="fe mc md me mf b">.</code>目录字符。如果你一直遵循我的方法，这个命令应该对你有用。</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="2153" class="mk kj in mf b gy ml mm l mn mo">$ pipleinewise import --dir .</span></pre><p id="f938" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要在不同的目录中导入配置 YAML 文件，请指定该目录的路径:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="51af" class="mk kj in mf b gy ml mm l mn mo">$ pipleinewise import --dir ~/documents/pipelinewise_project/</span></pre><p id="3583" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">如果<em class="na">配置 YAML 文件的任何</em>包含散列密码</strong>，在命令中添加<code class="fe mc md me mf b">--secret</code>参数:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="102e" class="mk kj in mf b gy ml mm l mn mo">$ pipleinewise import --dir . --secret vault-password.txt</span></pre><p id="1fd6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦配置 YAML 文件被导入，您可以用<code class="fe mc md me mf b">pipelinewise status</code>命令来验证管道。</p><h1 id="2090" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">运行管道</h1><p id="b309" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">首先，使用命令检查导入管道的列表:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="c1a2" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise status</span></pre><p id="d541" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以使用<code class="fe mc md me mf b">pipelinewise run_tap</code>命令触发管道运行。您必须指定一个<strong class="jm io"> tap_id </strong>和一个<strong class="jm io"> target_id </strong>，其格式如下:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="1b6a" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise run_tap --tap &lt;TAP-ID&gt; --target &lt;TARGET-ID&gt;</span></pre><p id="25a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，您可以使用示例命令触发管道:</p><pre class="lh li lj lk gt mg mf mh mi aw mj bi"><span id="6c0c" class="mk kj in mf b gy ml mm l mn mo">$ pipelinewise run_tap --tap mysql-one --target company-warehouse</span></pre><p id="78c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将根据导入的配置 YAML 文件加载您的数据。默认情况下，PipelineWise 将使用<a class="ae lw" href="https://transferwise.github.io/pipelinewise/concept/fastsync.html#" rel="noopener ugc nofollow" target="_blank"> FastSync </a>组件进行<em class="na">更快的</em>初始加载。基于您的<a class="ae lw" href="https://transferwise.github.io/pipelinewise/concept/replication_methods.html" rel="noopener ugc nofollow" target="_blank">复制方法</a>的未来负载将使用 Singer 组件。</p><h1 id="758d" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">气流调度</h1><p id="b45f" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">编排管道式管道的最简单方法是使用 Unix Cron 作业。但是，如果您在一个具有复杂数据工作流的企业环境中工作，您将需要一个像 Airflow 这样的 orchestrator。</p><p id="4295" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要在气流中安排管线式管道，你需要:<br/> -指定管线式-码头入口点的完整路径。这是因为气流无法识别<code class="fe mc md me mf b">pipelinewise</code>命令。<br/> -使用 bash 运算符</p><p id="e1bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 Github Gist 中显示了一个 DAG 示例:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2cbc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">瞧啊。只需刷新您的气流用户界面，照常运行 DAG。</p><h1 id="5c02" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">管道式打嗝</h1><p id="1d2e" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">从 PipelineWise 版本 0.48.3 开始，FastSync 组件与 MySQL 8 不完全兼容。我遇到的一些问题是数据库连接问题、散列密码问题和不成功的数据类型解析。这只会影响初始加载，因为使用了 FastSync。</p><p id="1adc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是目前正在努力，可能会被修复。然而，Singer 组件对于后续加载工作良好。</p><h1 id="16c6" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">结论</h1><p id="afe9" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我开始使用 PipelineWise，因为我的公司已经使用它多年，我必须开始维护它。最初，我想改用 Airbyte，但我也想了解 PipelineWise 是如何工作的。然而，在这两者之间，我确实喜欢 PipelineWise 的直截了当的 YAML 配置文件。</p><p id="3d71" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于数据提取工具的新手来说，Airbyte 或 Meltano 是不错的选择。它们配置更简单，提供更多的连接器，并且有更多的维护人员。如果您使用的是通用连接器，并且熟悉配置代码，那么 PipelineWise 将很好地为您服务。</p><p id="a769" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">祝贺您走到这一步，祝您在数据之旅中好运！</p><h1 id="db77" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">证明文件</h1><ul class=""><li id="3a14" class="nd ne in jm b jn lx jr ly jv nf jz ng kd nh kh ni nj nk nl bi translated"><a class="ae lw" href="https://transferwise.github.io/pipelinewise/index.html" rel="noopener ugc nofollow" target="_blank">https://transferwise.github.io/pipelinewise/index.html</a></li></ul></div></div>    
</body>
</html>