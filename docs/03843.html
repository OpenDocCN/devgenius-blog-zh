<html>
<head>
<title>Vue Router 4–Per-Route Transition and Fetch Data During Navigation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue路由器4–导航期间的每条路线转换和获取数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/vue-router-4-per-route-transition-and-fetch-data-during-navigation-cfb953d9997f?source=collection_archive---------3-----------------------#2020-12-24">https://blog.devgenius.io/vue-router-4-per-route-transition-and-fetch-data-during-navigation-cfb953d9997f?source=collection_archive---------3-----------------------#2020-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/419ca2d94a29e3d51845b4a879a17333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BE2fPYnq1AkYeYue"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@anastasia_p?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Anastasia Petrova </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="aa43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue Router 4处于测试阶段，可能会有变化。</p><p id="637d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了轻松地构建一个单页面应用程序，我们需要添加路由，以便将URL映射到呈现的组件。</p><p id="0ba0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用Vue路由器4与Vue 3。</p><h1 id="012a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">每条路线转换</h1><p id="0347" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以为个别路线添加过渡效果。</p><p id="41ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8a32" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;style&gt;<br/>      .fade-enter-active,<br/>      .fade-leave-active {<br/>        transition: opacity 0.15s ease;<br/>      }<br/>      .fade-enter-from,<br/>      .fade-leave-to {<br/>        opacity: 0;<br/>      }<br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar"&gt;bar&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view v-slot="{ Component, route }"&gt;<br/>        &lt;transition :name='route.path.includes("foo") ? `fade`:``'&gt;<br/>          &lt;component :is="Component" /&gt;<br/>        &lt;/transition&gt;<br/>      &lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;bar&lt;/div&gt;"<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar",<br/>          component: Bar<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });<br/>      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="efcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过检查<code class="fe ms mt mu mj b">route</code>对象来动态设置<code class="fe ms mt mu mj b">name</code>属性。</p><p id="a4d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">path</code>地产有该路线的路径。</p><p id="2502" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们可以检查路径以将<code class="fe ms mt mu mj b">name</code>的值设置为我们想要的过渡。</p><h1 id="0141" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">数据提取</h1><p id="b79c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当路由被激活时，我们有时想从服务器获取数据。</p><p id="6f6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可以通过各种挂钩来完成。</p><p id="f879" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c7bf" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar"&gt;bar&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view&gt;&lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;{{bar}}&lt;/div&gt;",<br/>        data() {<br/>          return {<br/>            bar: ""<br/>          };<br/>        },<br/>        created() {<br/>          this.fetchData();<br/>        },<br/>        watch: {<br/>          $route: "fetchData"<br/>        },<br/>        methods: {<br/>          async fetchData() {<br/>            this.bar = "bar";<br/>          }<br/>        }<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar",<br/>          component: Bar<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });<br/>      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="cc8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们观察<code class="fe ms mt mu mj b">$route</code>对象，并在<code class="fe ms mt mu mj b">$route</code>改变时调用<code class="fe ms mt mu mj b">fetchData</code>方法。</p><h1 id="9b5b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导航前提取</h1><p id="2e03" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以运行方法来获取before <code class="fe ms mt mu mj b">before</code>导航钩子中的数据。</p><p id="44c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="40a9" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar/1"&gt;bar 1&lt;/router-link&gt;<br/>        &lt;router-link to="/bar/2"&gt;bar 2&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view&gt;&lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;{{id}}&lt;/div&gt;",<br/>        data() {<br/>          return {<br/>            id: ""<br/>          };<br/>        },<br/>        beforeRouteEnter(to, from, next) {<br/>          next((vm) =&gt; vm.fetchData(to.params.id));<br/>        },<br/>        beforeRouteUpdate(to, from, next) {<br/>          this.fetchData(to.params.id);<br/>          next();<br/>        },<br/>        methods: {<br/>          async fetchData(id) {<br/>            this.id = id;<br/>          }<br/>        }<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar/:id",<br/>          component: Bar<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });<br/>      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c5cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe ms mt mu mj b">beforeRouterEnter</code>和<code class="fe ms mt mu mj b">beforeRouteUpdate</code>钩子，它们分别在组件渲染之前和路径参数改变时运行。</p><p id="2ac2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回调中运行<code class="fe ms mt mu mj b">fetchData</code>方法来获取数据。</p><p id="ddbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有2个<code class="fe ms mt mu mj b">router-link</code>用自己的参数连接到<code class="fe ms mt mu mj b">/bar</code>路线。</p><p id="efb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们获取导航保护方法中的参数<code class="fe ms mt mu mj b">id</code>并调用<code class="fe ms mt mu mj b">fetchData</code>将其值设置为<code class="fe ms mt mu mj b">this.id</code>状态。</p><p id="2581" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们将在模板中看到它们。</p><h1 id="331d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d676" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们有一种新的方式来添加每路由转换与Vue路由器4。</p><p id="d5fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以用Vue Router 4在Vue Router挂钩中获取数据。</p></div></div>    
</body>
</html>