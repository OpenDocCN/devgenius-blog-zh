<html>
<head>
<title>Deploy Images To DockerHub With CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨ CircleCI å°†æ˜ åƒéƒ¨ç½²åˆ° DockerHub</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/deploy-images-to-dockerhub-with-circleci-3f5b716cfe1e?source=collection_archive---------4-----------------------#2021-04-05">https://blog.devgenius.io/deploy-images-to-dockerhub-with-circleci-3f5b716cfe1e?source=collection_archive---------4-----------------------#2021-04-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c675997a0b576c292e2653d5a03a8b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-iALiU8xDV_FI4YAwxmZA.png"/></div></div></figure><p id="e034" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å®¹å™¨ã€å›¾åƒã€äº‘ã€dockerã€Kubernetes ç­‰ã€‚éƒ½æ˜¯æˆ‘ä»¬ä» DevOps å·¥ç¨‹å¸ˆå’Œé«˜çº§åç«¯å·¥ç¨‹å¸ˆæˆ–äº‘æ¶æ„å¸ˆé‚£é‡Œå¬åˆ°çš„å¸¸ç”¨æœ¯è¯­ã€‚æ„å»ºåº”ç”¨æˆ–æœåŠ¡å™¨éå¸¸å¥½ï¼Œä½†æ›´é‡è¦çš„æ˜¯æ‰˜ç®¡ã€éƒ¨ç½²ã€ç»´æŠ¤å’Œæ‰©å±•å®ƒä»¬ã€‚</p><p id="a225" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://circleci.com/docs/2.0/about-circleci/" rel="noopener ugc nofollow" target="_blank"> CirclCI </a>ä½¿å·¥ç¨‹å›¢é˜Ÿèƒ½å¤Ÿè‡ªåŠ¨åŒ–æ‚¨çš„è½¯ä»¶æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚</p><p id="d91d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Docker æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–å·¥å…·ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ç§°ä¸ºå®¹å™¨çš„åŒ…ä¸­äº¤ä»˜è½¯ä»¶ã€‚</p><p id="96e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æ‚¨çš„æ“ä½œç³»ç»Ÿä¸Šæœ¬åœ°æ„å»ºæ‚¨çš„å®¹å™¨å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œè¿™å–å†³äºæ‚¨çš„ç³»ç»Ÿæœ‰å¤šå¤æ‚ï¼Œæœ‰æ—¶å¯èƒ½æ— æ³•è¿è¡Œ dockerã€‚æ­¤å¤–ï¼Œæ‰‹åŠ¨æ„å»ºå®¹å™¨åŒ–çš„åº”ç”¨å¹¶å°†å…¶æ¨é€åˆ°<a class="ae kt" href="http://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> docker-hub </a>å¯èƒ½ä¼šæœ‰å‹åŠ›ï¼Œæˆ–è€…ä¸æ˜¯æœ€ä½³å®è·µã€‚<br/>ä½ å¯ä»¥ä½¿ç”¨ GitHub å’Œ CircleCi æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p id="58c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å°†å¼€å‘ä¸€ä¸ªç®€å•çš„ express æœåŠ¡å™¨ï¼Œå¹¶ä¸ºå®ƒæ„å»ºä¸€ä¸ª docker æ˜ åƒï¼Œç„¶åä½¿ç”¨ circleci å°†å…¶æ¨é€åˆ° docker hubã€‚</p><p id="538b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æ‚¨è¿›ä¸€æ­¥é˜…è¯»ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨æ‹¥æœ‰ githubã€circleci å’Œ docker hub çš„å¸æˆ·ã€‚</p><h2 id="62ed" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">é¡¹ç›®è®¾ç½®</h2><p id="984a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">æ‰“å¼€ä½ çš„ github å¹¶åˆ›å»ºä¸€ä¸ªå…¬å…± repoï¼Œå§‘ä¸”ç§°ä¹‹ä¸º*my-first-dockerhub*ï¼Œä½ ç°åœ¨å¯ä»¥åœ¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸Šå…‹éš†è¿™ä¸ªé¡¹ç›®äº†ã€‚</p><p id="dcfa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹æ–‡ä»¶â€”â€”index . js docker fileã€‚dockerignoreã€‚gitignore</p><blockquote class="ls lt lu"><p id="bc1e" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">è§¦æ‘¸ index.js Dockerfileã€‚dockerignoreã€‚gitignore</p></blockquote><p id="9a01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨ index.js æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="dc0c" class="ku kv in me b gy mi mj l mk ml"><br/>require(â€œdotenvâ€);<br/>const express = require(â€œexpressâ€);</span><span id="2a4f" class="ku kv in me b gy mm mj l mk ml">const app = express();</span><span id="720e" class="ku kv in me b gy mm mj l mk ml">const { log } = console;</span><span id="bbf0" class="ku kv in me b gy mm mj l mk ml">app.get(â€œ/userâ€, (req, res) =&gt; {<br/> res.send({<br/> result: [<br/> {<br/> name: â€œarmstrongâ€,<br/> status: â€œdeveloperâ€,<br/> },<br/> ],<br/> });<br/>});</span><span id="8349" class="ku kv in me b gy mm mj l mk ml">const port = process.env.PORT || 5000;</span><span id="5ace" class="ku kv in me b gy mm mj l mk ml">app.listen(port, () =&gt; log(`Server running on port ${port} ğŸ”¥`));</span></pre><h2 id="a5f9" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">Docker çš„è®¾ç½®</h2><p id="ce06" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">è®©ä½ çš„åº”ç”¨æˆä¸º docker é•œåƒçš„é­”æ³•å®é™…ä¸Šæ˜¯åœ¨ä½ åˆšåˆšåˆ›å»ºçš„*Dockerfile*é‡Œé¢å®Œæˆçš„ã€‚</p><p id="d430" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨ docker æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="280e" class="ku kv in me b gy mi mj l mk ml"><br/>FROM node:14</span><span id="de08" class="ku kv in me b gy mm mj l mk ml">WORKDIR /project</span><span id="53c9" class="ku kv in me b gy mm mj l mk ml">COPY package*.json ./</span><span id="0cab" class="ku kv in me b gy mm mj l mk ml">RUN npm ci</span><span id="a9b2" class="ku kv in me b gy mm mj l mk ml">COPY . .</span><span id="919a" class="ku kv in me b gy mm mj l mk ml">EXPOSE 8081</span><span id="1721" class="ku kv in me b gy mm mj l mk ml">CMD [â€œnodeâ€, â€œindex.jsâ€]</span></pre><p id="989d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">*FROM node:14*è°ˆåˆ°æˆ‘ä»¬å¸Œæœ›åœ¨å…¶ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼Œå½“ç„¶æ˜¯ node åº”ç”¨ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹© node ç‰ˆæœ¬ 14</p><p id="3c21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä½ å¯ä»¥åœ¨å®˜æ–¹<a class="ae kt" href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>ä¸Šé˜…è¯»æ›´å¤šå…³äºå…¶ä»–å£°æ˜çš„å«ä¹‰</p><p id="a254" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™æ ·ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¾èµ–é¡¹å°†é€šè¿‡ RUN å‘½ä»¤å®‰è£…ï¼Œå¹¶åœ¨ docker å®¹å™¨çš„ 8081 ç«¯å£ä¸Šè¿è¡Œ</p><h2 id="0ef0" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">Circleci çš„è®¾ç½®</h2><p id="0a4c" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">è¿™æ˜¯è¿™ç¯‡æ–‡ç« å¯¹æˆ‘æ¥è¯´æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚ä¸Šä¸€æ­¥ä¹‹åçš„ä¸‹ä¸€æ­¥æ˜¯æ„å»º docker æ˜ åƒï¼Œä½¿ç”¨å‘½ä»¤- <br/> <br/> docker build <br/> <br/>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ circleci ä¸°å¯Œçš„åŸºç¡€è®¾æ–½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æœ¬åœ°æ“ä½œç³»ç»Ÿã€‚</p><h2 id="4ddf" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">å°† Git Repo è¿æ¥åˆ° Circleci</h2><p id="ccc7" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">æ‰“å¼€ä½ çš„ circleci ä»ªè¡¨ç›˜ï¼Œæ‰¾åˆ°ä½ çš„ github repoï¼Œç‚¹å‡»*è®¾ç½®é¡¹ç›®*æŒ‰é’®ï¼Œè¿™å¯èƒ½ä¼šè¦æ±‚ä½ æä¾›*ã€‚circleci*ç›®å½•ï¼Œæš‚æ—¶å¯ä»¥å¿½ç•¥ã€‚</p><h2 id="1e64" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">åœ†å½¢æ„å‹</h2><p id="d0f1" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•â€” *ã€‚circleci*ï¼Œåœ¨ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶*config.yml*</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="613f" class="ku kv in me b gy mi mj l mk ml"><br/>touch .circleci/config.yml<br/></span></pre><p id="1ed9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨ config.yml ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç </p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b9ab" class="ku kv in me b gy mi mj l mk ml"><br/>orbs:<br/> docker: circleci/docker@1.5.0<br/>version: 2.1<br/>executors:<br/> docker-publisher: <br/> environment:<br/> IMAGE_NAME: ndukwearm19docker/docker-node-app<br/> docker: # Each job requires specifying an executor<br/> # (either docker, macos, or machine), see<br/> â€” image: circleci/node:latest<br/> auth:<br/> username: $DOCKERHUB_USERNAME<br/> password: $DOCKERHUB_PASSWORD</span><span id="501d" class="ku kv in me b gy mm mj l mk ml">jobs:<br/> publishLatestToHub: <br/> executor: docker-publisher<br/> <br/> steps: <br/> â€” checkout<br/> â€” setup_remote_docker<br/> â€” run: <br/> name: Publish Docker Image to Docker Hub<br/> command: |<br/> echo â€œ$DOCKERHUB_PASSWORDâ€ | docker login -u â€œ$DOCKERHUB_USERNAMEâ€ â€” password-stdin<br/> docker build -t $IMAGE_NAME .<br/> docker push $IMAGE_NAME:latest<br/>workflows:<br/> version: 2<br/> build-master:<br/> jobs:<br/> â€” publishLatestToHub<br/><br/>The config.yml is the magic that tells circleci what to do with our app, for this demo we want it to build a docker image.<br/>In circleci *workflows* are simply orchestrators, they order how things should be done, *executors* defines or groups up task, *jobs* define the basic steps and commands to run.</span></pre><p id="6899" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å› æ­¤ï¼Œæˆ‘æœ‰ä¸€ä¸ªåä¸º*build-master*çš„å·¥ä½œæµï¼Œå®ƒé€šè¿‡è¿è¡Œä¸€ä¸ªåä¸º*docker-publisher*çš„æ‰§è¡Œå™¨å¼€å§‹å·¥ä½œï¼Œè¯¥æ‰§è¡Œå™¨è®¾ç½®ä¸€ä¸ªåä¸º IMAGE_NAME çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶è¿è¡Œä¸€ä¸ª docker ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒåº”è¯¥è¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„ nodeã€‚</p><p id="2b97" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ¥ä¸‹æ¥çš„å‡ è¡Œä»£ç æ˜¯</p><ul class=""><li id="15ef" class="mn mo in jx b jy jz kc kd kg mp kk mq ko mr ks ms mt mu mv bi translated">checkout â€”è¿™è¦æ±‚ circleci æŸ¥çœ‹æˆ‘ä»¬çš„å­˜å‚¨åº“æˆ–è€ƒè™‘æˆ‘ä»¬åœ¨å›è´­ä¸Šæ‹¥æœ‰çš„æ•´ä¸ªç›®å½•å’Œæ–‡ä»¶ï¼Œ</li><li id="8610" class="mn mo in jx b jy mw kc mx kg my kk mz ko na ks ms mt mu mv bi translated">setup_remote_docker â€”è¿™å‘Šè¯‰ docker åœ¨ä¸€ä¸ªéš”ç¦»çš„ docker ç¯å¢ƒä¸­æ„å»ºæ˜ åƒï¼Œåœ¨è¿™é‡Œé˜…è¯»æ›´å¤š<a class="ae kt" href="https://circleci.com/docs/2.0/building-docker-images/" rel="noopener ugc nofollow" target="_blank"/>ï¼Œ</li><li id="e4c8" class="mn mo in jx b jy mw kc mx kg my kk mz ko na ks ms mt mu mv bi translated">runâ€”â€”run å‘½ä»¤å°±åƒæ‚¨çš„å¸¸è§„ cmd æˆ– shellï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé”®å…¥ docker å‘½ä»¤æ¥æ„å»ºæ‚¨çš„æ˜ åƒå¹¶æ¨é€åˆ° docker hubã€‚</li></ul><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2433" class="ku kv in me b gy mi mj l mk ml"><br/> echo â€œ$DOCKERHUB_PASSWORDâ€ | docker login -u â€œ$DOCKERHUB_USERNAMEâ€ â€” password-stdin<br/> docker build -t $IMAGE_NAME .<br/> docker push $IMAGE_NAME:latest</span></pre><p id="6384" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">DOCKERHUB_PASSWORD å’Œ DOCKERHUB_USERNAME åº”è¯¥åœ¨ä½ çš„ circleci ä»ªè¡¨æ¿ä¸­è®¾ç½®ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡</p><h2 id="d080" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">ç»ˆäºï¼</h2><p id="a05c" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">ä½ ç°åœ¨å¯ä»¥æäº¤å’Œæ¨é€ githubï¼Œå›åˆ°ä½ çš„ circleci ä»ªè¡¨ç›˜ï¼Œçœ‹ä½ çš„å›¾ç‰‡è¢«æ¨é€åˆ° docker hubã€‚</p><p id="b012" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é€šè¯»ï¼Œå…³æ³¨æˆ‘çš„æ›´å¤šæ–‡ç« ï¼Œæ‚¨å¯ä»¥åœ¨<a class="ae kt" href="https://twitter.com/AI_Lift" rel="noopener ugc nofollow" target="_blank"> Twitter </a>ä¸Šå…³æ³¨æˆ‘ï¼Œåœ¨<a class="ae kt" href="https://www.linkedin.com/in/ndukwearmstrong/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>ä¸Šé‚€è¯·æˆ‘å‚ä¸æ‚¨çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ã€‚</p><p id="ced8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è®°å¾—ç»§ç»­ç¼–ç ï¼Œé˜…è¯»ï¼Œæ­£ç¡®çš„ç”Ÿæ´»ã€‚</p><p id="6c51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://github.com/armstrong99/circleci-docker-CICD-pipeline-NodeJS" rel="noopener ugc nofollow" target="_blank">é“¾æ¥è‡³å›è´­</a></p></div></div>    
</body>
</html>