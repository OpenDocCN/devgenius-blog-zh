<html>
<head>
<title>JavaScript Unit Test Best Practices — Test and Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 单元测试最佳实践—测试和自动化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/javascript-unit-test-best-practices-test-and-automation-f03a70ba593?source=collection_archive---------8-----------------------#2020-09-02">https://blog.devgenius.io/javascript-unit-test-best-practices-test-and-automation-f03a70ba593?source=collection_archive---------8-----------------------#2020-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/37b300883de1784a68a1d9e0694cb24a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CGaEjPvUTTOmaJzX"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@agkdesign?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚历山大·奈特</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">号航天飞机</a>上拍摄的照片</figcaption></figure><p id="1475" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序是如何工作的非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究在编写 JavaScript 单元测试时应该遵循的一些最佳实践。</p><h1 id="e8ef" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在类似生产的环境中执行端到端测试</h1><p id="073d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在类似生产的环境中运行我们的端到端测试，这样我们就知道我们的代码可能会在生产环境中工作。</p><p id="5308" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用 Docker 创建一个孤立的环境——用一个命令编写。</p><p id="a785" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将创建一个文档化的环境，我们只需要一个命令。</p><p id="f8e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以使用类似 AWS Local 的东西来存根 AWS 服务。</p><h1 id="7513" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">并行化测试执行</h1><p id="9a98" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该并行运行测试，这样我们就可以在更短的时间内运行更多的测试。</p><p id="2c51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有像 Jest 和 Mocha 这样的测试框架的扩展，可以让我们并行运行测试。</p><p id="5e22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我们应该保持测试彼此独立，我们应该能够轻松做到这一点。</p><p id="cf7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用多个流程运行测试，以大大加快反馈时间。</p><h1 id="f08d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">远离法律问题</h1><p id="c876" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查许可证，这样我们就不会违反它们。</p><p id="4fa5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，如果有人抓住我们，我们就会遇到麻烦。</p><p id="0c20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不看许可证就很容易不小心使用东西。</p><p id="ed75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用许可证检查包来检查我们的代码。</p><p id="dba2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8b56" class="mn lc iq mj b gy mo mp l mq mr">npm install -g license-checker</span></pre><p id="e772" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过运行以下命令来检查依赖项的许可证:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e1b6" class="mn lc iq mj b gy mo mp l mq mr">license-checker --summary --failOn BSD</span></pre><h1 id="ef1c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查是否存在易受攻击的依赖项</h1><p id="3e38" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查易受攻击的依赖项，这样攻击者就不能攻击我们的应用程序。</p><p id="6d41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们运行<code class="fe ms mt mu mj b">npm audit</code>或使用 snyk 自动检查易受攻击的依赖项。</p><h1 id="6d73" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自动进行依赖项更新</h1><p id="7155" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以自动更新我们的依赖关系，这样我们就不必自己做任何事情。</p><p id="cc1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像 ncu 这样的工具让我们可以自动管理依赖关系。</p><p id="01b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有<code class="fe ms mt mu mj b">npm outdated</code>来检查过时的依赖关系。</p><p id="3da1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在我们的配置项中运行它来停止和构建已经过时的依赖项。</p><p id="b237" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以检查每个拉请求的更新依赖性。</p><h1 id="a0c8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">本地码头工人支持</h1><p id="5df2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Docker 使 devops 更容易，所以我们可以用它来部署和运行我们的应用程序。</p><h1 id="88b6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提前失败</h1><p id="ebf1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该先运行我们最快的测试，这样我们就可以快速检查我们的应用程序。</p><p id="410b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有任何失败，它会提前发生。</p><h1 id="40bf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查生成工件</h1><p id="6184" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">构建工件，如测试和覆盖报告、日志等。应该很容易找到，这样我们就不用浪费时间去找他们了。</p><h1 id="e8af" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建多个管道</h1><p id="0d93" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">管道对自动化我们的工作很有用。</p><p id="4a98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以为功能分支提交配置一个作业，为主 PR 配置不同的作业。</p><p id="a8e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们可以重用它们之间的逻辑，这样我们就不必两次做同样的工作。</p><h1 id="5aaa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">没有秘密</h1><p id="da94" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的工作中不应该有秘密。</p><p id="c33c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们应该从作业配置的机密存储中检索。</p><h1 id="1218" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">发布版本中的缓冲版本</h1><p id="2a3b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">发布版本中的版本应该被删除，这样我们才能区分它们。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/f2158aa5570fb55f42d98b58eff10270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*as-ol89cQTfENuXM"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@lenin33?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">列宁·埃斯特拉达</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">号航天飞机</a>上的照片</figcaption></figure><h1 id="e6b6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="dfae" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以自动化其他事情，以减少工作量。</p></div></div>    
</body>
</html>