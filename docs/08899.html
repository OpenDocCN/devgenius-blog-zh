<html>
<head>
<title>oAuth and OpenID connect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">oAuth 和 OpenID 连接</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/oauth-and-openid-connect-a87072fb602a?source=collection_archive---------9-----------------------#2022-07-17">https://blog.devgenius.io/oauth-and-openid-connect-a87072fb602a?source=collection_archive---------9-----------------------#2022-07-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b94b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">OAuth 2.0 和 OpenID Connect 是对 oAuth 2.0 的安全增强。这是为了防止证件被盗。在本文中，我们将讨论什么是 oAuth，什么是 open id，这两者是如何联系在一起的，有何区别，有哪些用例以及何时使用。</p><p id="6120" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们进入这篇文章之前，让我们看看可能用到的技术术语。</p><ul class=""><li id="bb06" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated"><em class="kr">访问令牌:一个随机字符串，在人类阅读中没有意义</em></li><li id="dd3e" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><em class="kr">刷新令牌:与接入令牌相同，但用于在接入令牌过期后，在允许的刷新时间内更新接入令牌</em></li><li id="47e9" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><em class="kr"> Client-id / Secret:赋予 app 用于标识 app(客户端)范围:允许权限</em></li><li id="8061" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">JWT:广泛使用的在服务间传递信息的机制。这也支持加密。</li></ul><h1 id="8688" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">oAuth 2:</h1><ul class=""><li id="bf19" class="ki kj in jm b jn lv jr lw jv lx jz ly kd lz kh kn ko kp kq bi translated">oAuth 2 是基于令牌的授权协议。</li><li id="958b" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">这是一种无需共享凭证的授权访问方式。它可以授权客户端代表用户执行某些操作</li><li id="56db" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">从技术上讲，oAuth 并不验证用户身份。用户必须已经过身份验证才能获得访问令牌。然而，大多数提供者同时实现这两者会导致一些混乱</li><li id="24cc" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">我们可以有第三方 oAuth 提供商，如谷歌，脸书，Github 或自己的 oAuth 服务器</li></ul><p id="e884" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们弄清楚 oAuth 是如何工作的</p><blockquote class="ma mb mc"><p id="f974" class="jk jl kr jm b jn jo jp jq jr js jt ju md jw jx jy me ka kb kc mf ke kf kg kh ig bi translated">想象一个场景，你创建一个脸书的个人资料。然后脸书需要给你的朋友发电子邮件，告诉他们你在脸书。因此，脸书想代表你给你的朋友发电子邮件。所以脸书需要代表你进入你的账户。但是你不喜欢把你的密码给脸书。所以这就是我们要用 oAuth 2 解决的问题。</p></blockquote><p id="0bd7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以在 oAuth 范式中有一个资源所有者。根据上述情况，这就是你。所以我们有授权服务器，客户端和资源服务器。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/ab4dfadcb52c00260ee2632b5cd8e78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jILAhKPz1h17LF0DZ6hMdg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">真实演员</figcaption></figure><p id="1979" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">资源所有者同意授权服务器。因此，它将授权客户端访问脸书资源服务器。现在，资源服务器与授权服务器验证该访问，然后授予访问权限。</p><p id="caea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">一般流程</strong></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mw"><img src="../Images/73d345141cddb2cb747acca930a9a264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iti86VCEj-wnNQ_m3QXoNA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">流动口</figcaption></figure><ol class=""><li id="78e6" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh mx ko kp kq bi translated">你可以去脸书网站，创建你的个人资料，并要求你需要邀请你的朋友</li></ol><ul class=""><li id="9b4a" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">现在，脸书向资源所有者(您)发送请求，要求联系 gmail 服务器。</li></ul><p id="971a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.现在，您(资源所有者)将自动被重定向到授权服务器(在这种情况下是 gmail 服务器)。</p><ul class=""><li id="3193" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">因此，现在 gmail 服务器将验证您(资源所有者)的用户名和密码。</li></ul><p id="b057" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.因此授权服务器向客户端发放令牌。</p><p id="71e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.现在，客户端向资源服务器发送令牌</p><p id="7ec3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.资源服务器将该令牌发送给授权服务器进行验证。</p><p id="8798" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.验证后，资源服务器将资源交付给客户端。</p><p id="8471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">授予类型</strong></p><ul class=""><li id="98e3" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">授权码:这是最广泛使用的授权类型。</li><li id="9104" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">客户端凭据</li><li id="fb78" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">含蓄的</li><li id="cf7e" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">密码</li><li id="0553" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">设备码</li></ul><p id="27c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">授权代码流</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi my"><img src="../Images/2d3aefb9ad9db9ccf19ee9b625e02718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WivY4mNelT87aFLGuXkxVA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">授权代码流</figcaption></figure><ol class=""><li id="85fd" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh mx ko kp kq bi translated">客户端将请求发送到授权服务器(gmail 服务器)</li></ol><p id="f016" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.现在授权服务器弹出一个对话框，说脸书将访问您的联系人列表。你同意还是不同意？</p><p id="1ffc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.所以 gmail 有很多功能(日历/电子邮件/聊天等)，但除此之外，脸书只要求访问你的联系人。他们只能访问联系人列表。(授予 ok 后，它将重定向回授权服务器)</p><p id="5dd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.所以现在授权服务器发送代码</p><p id="d468" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.客户端再次向授权服务器发送令牌请求。</p><p id="8667" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.现在，授权服务器将令牌发送给客户端。</p><p id="2108" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">7.客户端将令牌发送到资源服务器。</p><p id="7227" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">8.资源服务器获得令牌后，将向授权服务器验证该令牌。</p><p id="3f82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">9.在验证过程之后，资源服务器将把相关的资源传递给客户端。</p><ul class=""><li id="13fc" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">当资源所有者(你)不信任客户端(这里是 facebook)时，这是非常理想的</li><li id="81c7" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">你现在应该知道，我们不能按照请求直接移交令牌。如果你直接从前端获得令牌，那么未授权方可以看到你的凭证。(代码共享应该只通过后端)</li></ul><h1 id="019f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">OpenID 连接</h1><ul class=""><li id="6106" class="ki kj in jm b jn lv jr lw jv lx jz ly kd lz kh kn ko kp kq bi translated">oAuth 不是为处理认证而设计的。这是一个授权协议。(这限制了他们的能力)</li></ul><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/169732cd0d893dd08d46cfaaef4ed762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*az10RaOhMBETcs1BNxOvQw.png"/></div></figure><ul class=""><li id="149b" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">OIDC 是与认证相关的协议。OIDC 允许客户端通过授权服务器的身份验证来验证最终用户的身份。</li><li id="a155" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">OIDC 有一个单独的作用域，叫做 Open ID o，我们可以用它来认证用户。</li><li id="c116" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">通过将 OIDC 和 oAuth 2 捆绑在一起，我们可以使用这两者进行认证和授权</li></ul><p id="3a19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参考:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="na nb l"/></div></figure></div></div>    
</body>
</html>