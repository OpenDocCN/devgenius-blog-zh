<html>
<head>
<title>Create a Background Job Service with DynamoDB Streams and Lambda Functions with “Serverless” Framework. :: Part 01</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 DynamoDB 流和 Lambda 函数创建一个后台作业服务，使用“无服务器”框架。*第一部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-a-background-job-service-with-dynamodb-streams-and-lambda-functions-with-serverless-60b7bc49fd48?source=collection_archive---------9-----------------------#2022-04-05">https://blog.devgenius.io/create-a-background-job-service-with-dynamodb-streams-and-lambda-functions-with-serverless-60b7bc49fd48?source=collection_archive---------9-----------------------#2022-04-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3c46c692bea447b9a0dc29da37f972a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9rMxPJ86XGhU-6n9jwFXeA.png"/></div></div></figure><p id="70f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">DynamoDB 流允许我们创建事件驱动的架构。更具体地说，创建数据“插入”、“修改”或“删除”的事件驱动功能。该事件名称取自 DynamoDB <a class="ae kt" href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_streams_Record.html" rel="noopener ugc nofollow" target="_blank">记录</a>。</p><h1 id="3db8" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么我们需要后台工作服务？</h1><p id="fb45" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">当我们处理 AWS Lambda 函数时，它们的最大超时是 300 秒。但是触发这些 Lambdas 最常见的方式是通过 API 网关请求。这为请求添加了最长 30 秒的超时限制。如果 Lambda 包含复杂或耗时的逻辑(发送电子邮件、创建用户认知等)。)，在这种情况下可能需要 30 秒以上。</p><h1 id="4b55" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么不使用 AWS 事件桥？</h1><p id="e655" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">事件桥用于将 Lambdas 作为预定事件触发。不作为后台作业:)</p><h1 id="12c3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置作业服务</h1><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/06fb141341e1025bcd9c9529c756ea81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHRqQKnCz0-qjItyiTzUTg.png"/></div></div></figure><h2 id="3b4c" class="mc kv in bd kw md me dn la mf mg dp le kg mh mi li kk mj mk lm ko ml mm lq mn bi translated"><em class="mo">第 01 步</em></h2><ul class=""><li id="fbd8" class="mp mq in jx b jy ls kc lt kg mr kk ms ko mt ks mu mv mw mx bi translated">创建一个启用了<strong class="jx io">流的 DynamoDB 表</strong>。在本例中，它的名称是“Jobs”表。下面是一个云形成脚本，用于在 DynamoDB 中创建一个支持流的表</li></ul><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><ul class=""><li id="bd63" class="mp mq in jx b jy jz kc kd kg na kk nb ko nc ks mu mv mw mx bi translated">我已经将流视图类型添加为“新图像和旧图像”。新图像是添加到数据库中的新数据，旧图像是其以前的条目值。在这个实现中，我们需要这两者。</li></ul><blockquote class="nd ne nf"><p id="a270" class="jv jw ng jx b jy jz ka kb kc kd ke kf nh kh ki kj ni kl km kn nj kp kq kr ks ig bi translated">"<strong class="jx io"> INSERT </strong>事件只会给你一个新的图像，因为在条目被创建之前没有先前的值。</p><p id="2193" class="jv jw ng jx b jy jz ka kb kc kd ke kf nh kh ki kj ni kl km kn nj kp kq kr ks ig bi translated">"<strong class="jx io">修改</strong>"事件会给你新图像和旧图像:)</p><p id="976e" class="jv jw ng jx b jy jz ka kb kc kd ke kf nh kh ki kj ni kl km kn nj kp kq kr ks ig bi translated">“<strong class="jx io">删除</strong>事件只会给你旧的图像</p></blockquote><h2 id="66d2" class="mc kv in bd kw md me dn la mf mg dp le kg mh mi li kk mj mk lm ko ml mm lq mn bi translated">步骤 02</h2><ul class=""><li id="e15f" class="mp mq in jx b jy ls kc lt kg mr kk ms ko mt ks mu mv mw mx bi translated">您可以将 2 个 Lambda 函数与 DynamoDB 流集成在一起。我们只会用一个。因此，让我们创建一个 Lambda 函数，并添加“<strong class="jx io">流 ARN </strong>”作为它的事件。我的 Lambda 叫“monitorJobTableChanges”。</li></ul><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><ul class=""><li id="32f8" class="mp mq in jx b jy jz kc kd kg na kk nb ko nc ks mu mv mw mx bi translated">可以从 AWS 控制台找到 ARN 流。在您的“作业”表设置中，有一个名为“<strong class="jx io">导出和流</strong>的选项卡。ARN 河就在那里。</li><li id="eda0" class="mp mq in jx b jy nk kc nl kg nm kk nn ko no ks mu mv mw mx bi translated">我们还需要一个 POST 端点，它将触发 lambda 在 jobs 表中创建一个“作业”。在我的例子中，lambda 被称为“createJob”。</li></ul><p id="da1d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是 it 人员为我们的工作服务设置的无服务器后端。阅读第 2 部分的实现:)</p><p id="b162" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://medium.com/@iwiick/create-a-background-job-service-with-dynamodb-streams-and-lambda-functions-with-serverless-dc8e0eac4a1c" rel="noopener"> <strong class="jx io"> <em class="ng">用“无服务器”框架，用 DynamoDB 流和 Lambda 函数创建后台作业服务。第 02 部分</em> </strong> </a></p><p id="2df1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ng">由</em> <strong class="jx io"> <em class="ng">和</em> </strong>组成</p></div></div>    
</body>
</html>