<html>
<head>
<title>How To Create a TCP Socket Connection to the Android Emulator or a Connected Phone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建到 Android 模拟器或连接的手机的 TCP 套接字连接</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-a-tcp-socket-connection-to-the-android-emulator-or-a-connected-phone-472f35ac18be?source=collection_archive---------0-----------------------#2022-03-07">https://blog.devgenius.io/how-to-create-a-tcp-socket-connection-to-the-android-emulator-or-a-connected-phone-472f35ac18be?source=collection_archive---------0-----------------------#2022-03-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3055" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在手机和电脑之间传输数据流</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e345dd115a45a9655cdcb6bc6bbd7b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afMPbIUC6AbQ3uuw_UZm-g.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由来自<a class="ae kv" href="https://www.pexels.com/photo/person-holding-smartphone-while-using-laptop-1181244/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae kv" href="https://www.pexels.com/@divinetechygirl?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜·莫里洛</a>拍摄</figcaption></figure><p id="bf3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经用我的手机作为网络摄像头有一段时间了，但当我想创建自己的应用程序，将相机信号从我的手机传输到我的电脑时，我无法找到任何好的资源来解释如何做到这一点。所以在花了太多时间试图弄明白之后，我想创建一个简短的教程。</p><p id="67d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在手机和电脑之间传输数据有很多原因。除了前面提到的摄像头信号，你还可以从你的手机上获取 GPS 数据，使用它的加速度传感器，甚至在它上面显示额外的信息作为第二个屏幕。</p><p id="0453" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">似乎在 Android 设备上运行服务器，在您的计算机上运行客户端是更容易的选择。我第一次在 Android 的客户端上试了一下，它在模拟器上运行得很好。然而，当我在用 USB 线连接的手机上测试它时，它再也无法连接了。我还没能弄清楚为什么，但是对于两个设备之间的连接来说，哪个是服务器并不重要。因此，让我们看看如何在您的计算机和 Android 模拟器或您的手机之间创建 TCP 套接字连接。</p><h1 id="6e34" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建服务器</h1><p id="af72" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从在 Android 端创建一个非常简单的服务器应用开始。打开<a class="ae kv" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank"> Android Studio </a>并创建一个包含空活动的新项目。然后为服务器添加一个新的 Java 类。</p><p id="ce55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Android 使用普通的 Java <a class="ae kv" href="https://developer.android.com/reference/java/net/ServerSocket" rel="noopener ugc nofollow" target="_blank"> ServerSockets </a>，所以我们可以非常容易地创建一个基本的服务器。唯一值得一提的是，我们必须在一个单独的线程中启动套接字，因为 Android 不允许主线程上有任何网络代码，如果你尝试，它会抛出一个异常。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="bece" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在应用程序的主活动中，我们只需要创建一个新的服务器对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a1ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们需要给我们的应用程序 internet 权限，这可以通过将这些行添加到 AndroidManifest.xml 文件中来完成。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="0786" class="mw lt iq ms b gy mx my l mz na">&lt;uses-permission android:name="android.permission.INTERNET" &gt;<br/>&lt;/uses-permission&gt;<br/>&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" &gt;<br/>&lt;/uses-permission&gt;</span></pre><h1 id="5931" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">简单的客户</h1><p id="3702" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们还需要一个简单的 TCP 客户端来测试我们是否可以连接到我们的服务器。我正在使用我自己的 C++网络库，但是为了本教程，让我们用 Java 创建一个简单的客户机:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="72e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，如果你试图连接到运行在模拟器上的服务器或者一个连接的电话，它现在还不能工作。您可能在这一行<code class="fe nb nc nd ms b">this.socket = new Socket( “127.0.0.1” , 12345 );</code>中注意到我们正在连接到 localhost，考虑到我们想要连接到不同的设备，这有点奇怪。但这是有原因的:</p><h1 id="28cf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">亚洲开发银行(Asian Development Bank)</h1><p id="10cc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.android.com/studio/command-line/adb" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> ADB </strong>或<strong class="ky ir"> Android 调试桥</strong> </a>是 Android 开发的官方工具。它用于与仿真器和设备通信，这正是我们想要做的。首先，我们需要下载<a class="ae kv" href="https://developer.android.com/studio/releases/platform-tools" rel="noopener ugc nofollow" target="_blank"> ADB/SDK 平台工具</a>并将其解压到某个地方。然后，我们可以在提取的文件夹中打开一个终端(Windows 提示:在浏览器的导航行中单击并键入"<em class="ne"> cmd" </em>，点击 ENTER <em class="ne"> </em>，它将在当前文件夹中打开一个命令行界面)。在那里，我们需要输入以下命令:</p><p id="2d3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nb nc nd ms b">adb forward tcp:12345 tcp:12345</code></p><p id="d569" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将把 TCP 流量从计算机本地主机的端口 12345 转发到同一端口上的设备。在此之后，运行在您的计算机上的客户端应该能够连接到运行在您的 Android 设备上的服务器。</p><h1 id="a5ab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">重要说明</h1><p id="2766" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">每次在模拟器和 USB 连接的智能手机之间切换时，您都需要再次输入 adb 命令。</p><p id="cb4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一种方法是在连接前直接从客户端程序调用命令:</p><p id="d3b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nb nc nd ms b">C++: system( “<em class="ne">PATH_TO</em>/adb.exe forward tcp:12345 tcp:12345” );</code></p><p id="a6b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nb nc nd ms b">Java: Runtime.getRuntime().exec( “<em class="ne">PATH_TO</em>/adb.exe forward tcp:12345 tcp:12345” );</code></p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="5dd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你知道如何做，用 TCP 套接字将 Android 模拟器或连接的智能手机连接到你的电脑并不太难。我花了一段时间才弄明白，但希望这篇教程能帮助你更快地使用它。</p></div></div>    
</body>
</html>