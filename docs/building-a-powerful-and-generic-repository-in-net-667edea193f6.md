# ä¸­æ„å»ºä¸€ä¸ªâ€œå¼ºå¤§çš„â€å’Œâ€œé€šç”¨çš„â€å­˜å‚¨åº“ã€‚ç½‘

> åŸæ–‡ï¼š<https://blog.devgenius.io/building-a-powerful-and-generic-repository-in-net-667edea193f6?source=collection_archive---------5----------------------->

å“å‘€ï¼åˆæ¥äº†ï¼ï¼Ÿæ‚¨å¯èƒ½ä¼šå‘ç°è¿™ç¯‡æ–‡ç« å¹¶ä¸æœ‰è¶£ï¼Œå› ä¸ºæ‚¨å¯èƒ½å·²ç»å¼€å‘äº†å‡ ä¸ªâ€œå¾ˆæ£’â€çš„åº“ã€‚ç„¶è€Œï¼Œåœ¨è®¾è®¡ä¸€ä¸ªå¼ºå¤§çš„é€šç”¨å­˜å‚¨åº“æ—¶ï¼Œæœ¬æ–‡æŒ‡çš„æ˜¯â€œä¸€ä¸ªç‰¹æ®Šçš„ä¸œè¥¿â€ã€‚æ‰€ä»¥ï¼Œè¯·ä¸è¦é”™è¿‡è¿™é¢—å®çŸ³ï¼ğŸ’ğŸ’ğŸ’

æ˜¯çš„ï¼Œæˆ‘ä»¬æ­£åœ¨è°ˆè®ºâ€œå¼ºå¤§çš„â€å’Œâ€œé€šç”¨çš„â€å­˜å‚¨åº“ã€‚å®ƒæ˜¯ä¸€ç§å¯ç§»æ¤çš„å­˜å‚¨åº“ï¼Œå¯ä»¥å¤„ç†æ•°ç™¾ä¸‡è¡Œè€Œä¸å½±å“æœåŠ¡å™¨æ€§èƒ½ã€‚å®ƒæ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾—åˆ°ä½¿ç”¨ã€éªŒè¯å’Œæµ‹è¯•ã€‚

**TLï¼›DR:** ä¸€ç§å®ç°éå¸¸å¼ºå¤§å’Œé€šç”¨çš„åŸºäºå®ä½“çš„å­˜å‚¨åº“çš„æ–°æŠ€æœ¯ã€‚å®ƒéå¸¸å®¹æ˜“ï¼Œå¹²å‡€/å¯ç»´æŠ¤å’Œä¼˜è¶Šï¼ğŸ‘ŒğŸ»ğŸ‘¦ğŸ¼

![](img/1269ff9c8296016ec36f52685cfff67d.png)

æ‰˜é©¬æ–¯Â·å°¼æ ¼ä¼¦Â·æ±‰æ£®æŠ¥é“

> ç°åœ¨ï¼Œåœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨å­˜å‚¨åº“æ¨¡å¼å·²ç»æˆä¸ºä¸€ç§è¡Œä¸šæ ‡å‡†(ä¸“é—¨é’ˆå¯¹æ•°æ®åº“è¿æ¥)ã€‚è¿™æ˜¯ä¸€ä¸ªå¹¿ä¸ºäººçŸ¥çš„æ¨¡å¼ï¼Œå¼ºçƒˆæ¨èç»™æ¯ä¸ªäººå’Œ/æˆ–ä»»ä½•å½¢å¼çš„è½¯ä»¶å¼€å‘ã€‚

**æ‚¨å¯ä»¥ä¸‹è½½ä¸‹é¢çš„æºä»£ç ï¼Œç”¨äºä¸ªäººæˆ–å•†ä¸šç”¨é€”ã€‚** ğŸ–ğŸ»ğŸ»

å¯¹äºé‚£äº›ä»ç„¶ä¸çŸ¥é“ä»€ä¹ˆæ˜¯å­˜å‚¨åº“çš„äººã€‚â€œå­˜å‚¨åº“â€æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼å’Œå®è·µï¼Œå®ƒè¢«å®ç°ä¸ºåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„é™„åŠ å±‚ã€‚é€šè¿‡ repositoryï¼Œæ‚¨å¯ä»¥ç®¡ç†å¦‚ä½•ä»/å‘æ•°æ®åº“æ“ä½œæ•°æ®ã€‚

**ä¸ºäº†è®©æ‚¨ä»é«˜å±‚æ¬¡äº†è§£ä»€ä¹ˆæ˜¯å­˜å‚¨åº“ï¼Œ**ä¸‹é¢æ˜¯é«˜å±‚æ¬¡çš„å›¾è¡¨ã€‚

![](img/aa6dc75fe5f63f416a87b6b0fdf0ffe5.png)

å­˜å‚¨åº“å›¾è¡¨â€”â€”è¿ˆå…‹å°”Â·å½­ç™»

åº”ç”¨ç¨‹åºä¸æ•°æ®åº“çš„äº¤äº’ç”±å­˜å‚¨åº“æ§åˆ¶ã€‚æŒ‰ç…§è®¾è®¡ï¼Œæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨å¿…é¡»åœ¨åº”ç”¨ç¨‹åºä¸­æœ‰ç›¸åº”çš„æ¨¡å‹/å®ä½“ã€‚æ­¤å¤–ï¼Œè¡¨ä¸­çš„æ‰€æœ‰åˆ—éƒ½å¿…é¡»åœ¨æ¨¡å‹/å®ä½“ä¸­å…·æœ‰ç›¸åº”çš„å±æ€§ã€‚å­˜å‚¨åº“å°†ä½¿ç”¨ç»™å®šçš„æ“ä½œ(å³:æ’å…¥ã€åˆ é™¤ã€åˆå¹¶ã€æ›´æ–°å’ŒæŸ¥è¯¢)è‡ªåŠ¨æ˜ å°„å®¢æˆ·æœºå’Œæ•°æ®åº“ä¹‹é—´çš„å¯¹è±¡ã€‚

# å¼ºå¤§çš„çŸ¥è¯†åº“ğŸ’ªğŸ»

è¿™æ˜¯ä¸€ç§å¯ä»¥å¸®åŠ©æ‚¨çš„åº”ç”¨ç¨‹åºå‘æŒ¥æœ€å¤§æ€§èƒ½çš„å­˜å‚¨åº“(åœ¨ä»»ä½•æƒ…å†µä¸‹)ã€‚å®ƒåº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨ã€æ™ºèƒ½ã€é«˜æ•ˆå’Œé«˜æ€§èƒ½çš„ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»å…¬å¼€/ç¬¦åˆ [ACID](https://en.wikipedia.org/wiki/ACID) åŸåˆ™ã€‚

![](img/c9371303cd7e1cd8ee57ff343837d7fa.png)

å¼ºå¤§çš„çŸ¥è¯†åº“â€”â€”è¿ˆå…‹å°”Â·å½­ç™»

ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å…è®¸æ‚¨çš„å­˜å‚¨åº“åœ¨å¯¹æ•°æ®åº“æ‰§è¡Œæ´»åŠ¨æ—¶ä½¿ç”¨æ­£ç¡®çš„æ“ä½œã€‚é€šè¿‡æˆä¸ºæ™ºèƒ½å­˜å‚¨åº“â€¦

> â€œåŸå­â€æ“ä½œæœ€æœ‰å¯èƒ½åœ¨å¤„ç†å°‘é‡è¡Œæ—¶æ‰§è¡Œã€‚è€Œå¯¹äºå‡ ç™¾è¡Œæ‰§è¡Œâ€œæ‰¹å¤„ç†â€æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¼ºåˆ¶ä½¿ç”¨â€œæ‰¹é‡â€æ“ä½œã€‚

å°±å¥å£®æ€§è€Œè¨€ï¼Œæ‚¨æœ€æœ‰å¯èƒ½è®¾è®¡ä¸€ä¸ªå…·æœ‰çº¿ç¨‹å®‰å…¨ã€é«˜æ•ˆå’Œé«˜æ€§èƒ½æ“ä½œçš„å­˜å‚¨åº“ã€‚ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²å’Œè¿è¡Œåä¸ä¼šå½±å“æœåŠ¡å™¨èµ„æºã€‚

# é€šç”¨ä¿¡æ¯åº“â™»ï¸

è¿™æ˜¯ä¸€ç§å…è®¸æ‚¨ä½¿ç”¨å¤šä¸ªæ•°æ®åº“ã€è¡¨å’Œ/æˆ–æ¨¡å‹çš„å­˜å‚¨åº“ã€‚å®ƒé€šå¸¸è¢«ç§°ä¸ºæ‰€æœ‰å…¶ä»–åŸºäºå®ä½“çš„å­˜å‚¨åº“çš„â€œåŸºç¡€â€å­˜å‚¨åº“ã€‚å®ƒåº”è¯¥å¯ä»¥è¢«ä»»ä½•å½¢å¼çš„å…·æœ‰ç‰¹å®šç›®çš„çš„å­˜å‚¨åº“æ‰©å±•ã€‚å¦å¤–ï¼Œè¦å°½é‡ç®€å•([å»](https://en.wikipedia.org/wiki/KISS_principle)åŸç†)ã€‚

![](img/6042403b6eb4b2d34695f75eb8eedda4.png)

é€šç”¨çŸ¥è¯†åº“â€”â€”è¿ˆå…‹å°”Â·å½­ç™»

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡è®¾æ‚¨æ­£åœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ä¸Šå·¥ä½œï¼Œå…¶ä¸­çš„æ•°æ®åº“é©»ç•™åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶ç”±ä¸åŒçš„ RDBMS æä¾›è€…(å³:SQL Serverã€MySQL å’Œ PostgreSQL)æä¾›æœåŠ¡ã€‚æ‚¨å¸Œæœ›å°†æ•°æ®æ•´åˆåˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ã€‚

å¦ä¸€æ–¹é¢ï¼Œå‡è®¾æ•°æ®åº“ä¸­æœ‰æ‚¨æƒ³è¦ä½¿ç”¨çš„é¢„å®šä¹‰è¡¨ï¼›æ‚¨å¸Œæœ›ä¸ºåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰è¡¨æä¾›å¿…è¦çš„(ç›¸ç­‰çš„)æ“ä½œã€‚æ‚¨å¸Œæœ›ç¡®ä¿åœ¨æ“ä½œå®ç°ä¸­åº”ç”¨ [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) åŸåˆ™(å³:ä¿å­˜ã€è·å–ã€åˆå¹¶ã€æ›´æ–°ç­‰)ã€‚

# è¯†åˆ«æ•°æ®è®¿é—®æ¡†æ¶ğŸ¤”

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è¿æ¥åˆ°æ•°æ®åº“æ—¶ï¼ŒADO.NET è¢«ç”¨ä½œæ•°æ®è®¿é—®æŠ€æœ¯ã€‚ç„¶è€Œï¼Œè¿™ç§ä½çº§æŠ€æœ¯è¦æ±‚æˆ‘ä»¬å®ç°å­˜å‚¨åº“å·¥ä½œæ‰€éœ€çš„æ¯ä¸€æ®µä»£ç ã€‚å› æ­¤ï¼Œä½¿ç”¨å„ç§æ•°æ®è®¿é—®æ¡†æ¶æ˜¯éå¸¸æ˜æ™ºçš„ã€‚

å¼ºçƒˆå»ºè®®ä½¿ç”¨ micro-ORM æ¥å®ç°ã€‚ä½¿ç”¨ micro-ORMï¼Œæ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶æ‰€æœ‰å¿…è¦çš„æ“ä½œã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä¸»è¦ä½¿ç”¨ [RepoDb](https://repodb.net/) ï¼Œå®ƒæ˜¯ä¸ºè¿åˆè¿™äº›ç‹¬ç‰¹çš„åœºæ™¯è€Œè®¾è®¡å’Œå¼€å‘çš„ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒæ˜¯â€œæœ€å¿«â€å’Œâ€œæœ€é«˜æ•ˆâ€çš„ ORMï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒæ˜¯. NET çš„â€œæ··åˆè®¾è®¡â€ã€‚

> è€å®è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨å¾®è½¯çš„å®ä½“æ¡†æ¶ï¼Œå®ç°è¿™ç§å­˜å‚¨åº“æ˜¯ç›¸å½“å›°éš¾çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸æ”¯æŒâ€œæ‰¹å¤„ç†â€å’Œâ€œæ‰¹é‡â€æ“ä½œã€‚æ‚¨å¯èƒ½æœ€ç»ˆä¼šå› ä¸ºå¤§é‡å®šåˆ¶çš„å®ç°è€Œæ±¡æŸ“æ‚¨çš„å­˜å‚¨åº“ã€‚å¦‚æœæ‚¨å–œæ¬¢ raw-SQL å®ç°ï¼Œå¹¶ä¸”å¸Œæœ›ç”¨ raw å®ç°æ‰€æœ‰ä¸œè¥¿ï¼Œé‚£ä¹ˆä½¿ç”¨ [Dapper](https://dapper-tutorial.net/dapper) ã€‚ä½ æ€»æ˜¯å¯ä»¥ç”¨ä½ å–œæ¬¢çš„ ORM æ¥å®ç°è¿™æ ·çš„åº“è®¾è®¡ã€‚

**å…è´£å£°æ˜:**é€‰æ‹©å“ªä¸ª ORM æ¡†æ¶ç”±ä½ å†³å®šã€‚è¯•ç€çœ‹çœ‹ [ORM é£Ÿè°±](https://grauenwolf.github.io/DotNet-ORM-Cookbook/ORMs.htm)æ¥é€‰æ‹©ä½ è®¤ä¸ºæœ€é€‚åˆä½ æƒ…å†µçš„ ORMã€‚

# å®é™…çš„å­˜å‚¨åº“å®ç°ğŸ”¨

è¦å®ç°ï¼ŒåŸºæœ¬å­˜å‚¨åº“å¿…é¡»ä¿å­˜è¿æ¥å­—ç¬¦ä¸²çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¿…é¡»æ¥å—â€œæ•°æ®å®ä½“â€å’Œâ€œæ•°æ®åº“æä¾›è€…â€ç±»å‹ä½œä¸ºæ³›å‹ç±»å‹ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ã€‚

å®ƒè¿˜å¿…é¡»å®ç°æ‰€æœ‰éœ€è¦çš„é€šç”¨æ“ä½œ(å³:æ’å…¥ã€åˆ é™¤ã€è·å–ã€æ›´æ–°å’Œåˆå¹¶)ä»¥è¾¾åˆ°é‡ç”¨çš„ç›®çš„ã€‚

è¯·å‚è§ä¸‹é¢çš„ä»£ç ç‰‡æ®µä½œä¸ºè£¸å®ç°ã€‚

> ç±»å¿…é¡»æ˜¯â€œæŠ½è±¡çš„â€,æ–¹æ³•å¿…é¡»æ˜¯â€œè™šæ‹Ÿçš„â€,ä»¥ç¡®ä¿å­˜å‚¨åº“æ˜¯å¯æ‰©å±•çš„ï¼Œå¹¶ä¸”åœ¨ç»§æ‰¿åéµå¾ªâ€œæ‰“å¼€-å…³é—­â€åŸåˆ™ã€‚

åœ¨æ¯ä¸ªæ–¹æ³•ä¸­ï¼Œå¿…é¡»æ‰“å¼€å’Œå…³é—­ä¸€ä¸ªæ–°çš„è¿æ¥å¯¹è±¡ã€‚å‚è§ä¸‹é¢çš„â€œSaveAllâ€æ‰¹å¤„ç†æ“ä½œç¤ºä¾‹ä»£ç ã€‚

è€Œä¸‹é¢æ˜¯å¯¹" MergeAll "çš„æ‰¹é‡æ“ä½œã€‚

å¿…é¡»åœ¨ä¸Šè¿°æ‰€æœ‰ç»™å®šæ“ä½œä¸­å®æ–½ç›¸åŒçš„æ–¹æ³•ã€‚

## æ‰¹é‡è€ƒè™‘

åœ¨æ‰¹å¤„ç†æ“ä½œçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæ‰¹å·çš„æ•°å­—å¿…é¡»ä½œä¸ºå±æ€§å®ç°ã€‚

ç„¶åï¼Œæ·»åŠ ä¸€ä¸ªé€»è¾‘ï¼Œåœ¨æ‰§è¡Œæ“ä½œæ—¶æ€»æ˜¯æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚å‚è§ä¸‹é¢çš„â€œSaveAllâ€æ‰¹å¤„ç†æ“ä½œçš„ç¤ºä¾‹ä»£ç ã€‚

è¿˜å¿…é¡»ä¸ºå…¶ä»–æ‰¹å¤„ç†æ“ä½œ(å³:InsertAllã€DeleteAllã€UpdateAll å’Œ MergeAll)å®ç°å®ƒã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼Ÿ**åŸå­æ“ä½œåœ¨å¤„ç†å°‘é‡è¡Œæ—¶æ›´å¿«æ›´æœ‰æ•ˆï¼Œè€Œæ‰¹é‡æ“ä½œåœ¨å¤„ç†å¤§é‡è¡Œæ—¶æ›´å¥½ã€‚

> è¯·è®¿é—®æ­¤[é“¾æ¥](https://medium.com/dev-genius/why-choose-repodb-orm-over-dapper-da87432c7830#38cb)ä»¥è¿›ä¸€æ­¥äº†è§£åŸå­ã€æ‰¹å¤„ç†å’Œæ‰¹é‡æ“ä½œä¹‹é—´çš„åŒºåˆ«ã€‚

# å¦‚ä½•ä½¿ç”¨å­˜å‚¨åº“âœï¸

åˆ°è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸâ€œEntityRepositoryâ€å®ç°å·²ç»å®Œæˆã€‚ä¸ºäº†åˆ©ç”¨å­˜å‚¨åº“ï¼Œæ‚¨å¿…é¡»å®ç°ä¸€ä¸ªåŸºäºå®ä½“çš„å­˜å‚¨åº“ï¼Œå®ƒç»§æ‰¿äº†åŸºæœ¬çš„â€œEntityRepositoryâ€ç±»ã€‚

æ¯”æ–¹è¯´ï¼Œæ‚¨æœ‰ä¸€ä¸ªæ¥è‡ª SQL Server æ•°æ®åº“çš„â€œå®¢æˆ·â€è¡¨ã€‚ç„¶åï¼Œå¿…é¡»å®ç°ä¸‹é¢çš„å­˜å‚¨åº“ã€‚

é€šè¿‡å®ç°è¿™æ ·çš„å­˜å‚¨åº“ï¼Œæ¥è‡ªåº•å±‚å­˜å‚¨åº“çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«ç»§æ‰¿ã€‚

## è°ƒç”¨å­˜å‚¨åº“æ–¹æ³•

ä¸‹é¢æ˜¯ä»å­˜å‚¨åº“ä¸­è°ƒç”¨æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ã€‚

è€Œä¸‹é¢æ˜¯ä¸ºâ€œåˆ é™¤â€å‡†å¤‡çš„ã€‚

æœ€å¥½çš„æ–¹æ³•æ˜¯é€šè¿‡ä¾èµ–æ³¨å°„ã€‚

**ä¸ºå…¶ä»–æ•°æ®åº“æä¾›å•†æä¾›æœåŠ¡**

åŒä¸Šï¼Œé€šç”¨å­˜å‚¨åº“èƒ½å¤Ÿè¿æ¥åˆ°å…¶ä»– RDBMS æä¾›è€…ã€‚

åœ¨æˆ‘ä»¬çš„å›¾è¡¨ä¸­ï¼Œè®¢å•å¿…é¡»èƒ½å¤Ÿè¿æ¥åˆ° MySQL RDBMSã€‚

OrderItem ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

æœ€åï¼Œè¯¥äº§å“å¿…é¡»è¿æ¥åˆ° PostgreSQL RDBMSã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨å·²ç»å°†å­˜å‚¨åº“å®ç°ä¸ºâ€œé€šç”¨çš„â€,ä»å¯é‡ç”¨æ€§çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯éå¸¸æ··åˆå’ŒåŠ¨æ€çš„ã€‚

**ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŠ¿:**

*   ä»£ç ç®€æ´æ˜äº†ï¼Œæ˜“äºç»´æŠ¤å’Œæ“ä½œ
*   å¿…é¡»æ›´å¿«æ›´é«˜æ•ˆ
*   å°è£…ï¼Œæ˜“äºé‡‡ç”¨

# **ä¸“é—¨çš„å­˜å‚¨åº“(** SQL Server)ğŸ”¥

è¿™æ˜¯ä¸ºç‰¹å®š RDBMS æä¾›è€…ä½¿ç”¨ä¸“é—¨æ–¹æ³•çš„å­˜å‚¨åº“(å³:æ‰¹é‡æ“ä½œ)ã€‚è¯·æ³¨æ„ï¼Œå¹¶éä¸€ä¸ªæä¾›å•†çš„æ‰€æœ‰åŠŸèƒ½å¯¹å…¶ä»– RDBMS æä¾›å•†ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚è¿™åªæ˜¯åœ¨ä¸€ä¸ªåœºæ™¯çš„åŸºç¡€ä¸Šï¼Œæ‰€ä»¥å¾ˆé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå¹¶ä¸æ€»æ˜¯å¦‚æ­¤ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸ SQL Server çš„â€œæ‰¹é‡â€æ“ä½œç›¸å…³çš„åœºæ™¯ã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç»§æ‰¿â€œEntityRepositoryâ€çš„ç±»ï¼Œè¯¥ç±»ä¹Ÿæ¥å—â€œæ•°æ®å®ä½“â€çš„æ³›å‹ç±»å‹ï¼Œå¹¶æ˜¾å¼åœ°å°† DB provider è®¾ç½®ä¸ºâ€œSqlConnectionâ€ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ã€‚

ç„¶åï¼Œå®ç°è¡¨ç¤ºæ‰¹é‡æ“ä½œè§¦å‘å™¨çš„ number å±æ€§ã€‚

ç„¶åï¼Œä¸ºæ‰¹é‡æ“ä½œå®ç°å¿…è¦çš„æ–¹æ³•ã€‚

> åœ¨ä¸Šé¢çš„ä»£ç ç¬¬ 5 è¡Œä¸­ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†æ–°åˆ›å»ºçš„â€œDbConnectionâ€å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºâ€œSqlConnectionâ€ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºç¬¬ 7 è¡Œä¸­çš„â€œBulkMergeAsyncâ€å°±æ˜¯è¿™ç§ç±»å‹çš„æ‰©å±•æ–¹æ³•ã€‚

è¦å®ç°çš„æ‰€æœ‰å…¶ä»–æ‰¹é‡æ“ä½œ(å³:DeleteAllã€InsertAll å’Œ UpdateAll)å¿…é¡»ä½¿ç”¨ä¸Šè¿°ç›¸åŒçš„æŠ€æœ¯ã€‚

# å®é™…æºä»£ç  Implementationâœ‚ï¸

ä½ å¯ä»¥ä»æˆ‘çš„ Github è´¦æˆ·ä¸‹è½½ä¸‹é¢çš„åº“ä½œä¸º gistsã€‚

*   [EntityRepository](https://gist.github.com/mikependon/b409cc549052e2b5d77574e2b0948c3b) â€”åŸºæœ¬é€šç”¨å­˜å‚¨åº“(ä»»ä½• RDBMS)ã€‚
*   [SqlConnectionEntityRepository](https://gist.github.com/mikependon/d61928bd1230a41c249b72d24a24ab21)â€”åŸºäº SQL Server çš„å®ä½“çš„åŸºæœ¬å­˜å‚¨åº“ã€‚

äº‹åŠ¡/å·¥ä½œå•å…ƒå®ç°ä¸æ˜¯å­˜å‚¨åº“çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥æ‰©å±•å­˜å‚¨åº“æ¥åŒ…å«è¿™æ ·çš„å®ç°ä¾›æ‚¨ä½¿ç”¨ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨è°ƒç”¨æ“ä½œä¹‹å‰ï¼Œåªéœ€åœ¨å­˜å‚¨åº“ä¸­å…¬å¼€ä¸€ä¸ªå±æ€§å¹¶è®¾ç½®å®ƒã€‚ç„¶åï¼Œåœ¨æ¯ä¸ªå­˜å‚¨åº“æ“ä½œä¸­ï¼Œåªéœ€ä¼ é€’â€œTransactionâ€å±æ€§ã€‚

# è¿è¡Œç»™å®šçš„å­˜å‚¨åº“ğŸš€

é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸‹è½½ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„å­˜å‚¨åº“ï¼Œå¹¶å°†å…¶æ”¾åœ¨æ‚¨çš„è§£å†³æ–¹æ¡ˆ/é¡¹ç›®ä¸­ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åˆ›å»ºä¸€ä¸ªâ€œå­˜å‚¨åº“â€æ–‡ä»¶å¤¹å¹¶æ”¾åœ¨é‚£é‡Œã€‚

## å®‰è£…åº“

åœ¨æ‚¨çš„è½¯ä»¶åŒ…ç®¡ç†å™¨æ§åˆ¶å°ä¸­ï¼Œåªéœ€é”®å…¥ä»¥ä¸‹ä»£ç ã€‚

```
> Install-Package RepoDb.SqlServer
```

å¦‚æœæ‚¨è¦ä½¿ç”¨â€œSqlConnectionEntityRepositoryâ€ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚

```
> Install-Package RepoDb.SqlServer.BulkOperations
```

å®‰è£…å®Œæˆåï¼Œåªéœ€ä»ä»£ç çš„ä»»ä½•åœ°æ–¹è°ƒç”¨å¼•å¯¼ç¨‹åºã€‚

```
RepoDb.SqlServerBootstrap.Initialize();
```

ä¹Ÿå¯ä»¥è®¿é—®å®˜æ–¹[æ•™ç¨‹](https://repodb.net/tutorial/get-started-sqlserver)é¡µé¢äº†è§£æ›´å¤šå‚è€ƒã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨æ­¤å¤„[æŠ¥å‘Šã€‚](https://github.com/mikependon/RepoDb/issues/new)

**~æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚~**