<html>
<head>
<title>JaVers: Simplify Domain Data Audit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JaVers:简化领域数据审计</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/javers-simplify-domain-data-audit-1940eed6e068?source=collection_archive---------1-----------------------#2021-12-18">https://blog.devgenius.io/javers-simplify-domain-data-audit-1940eed6e068?source=collection_archive---------1-----------------------#2021-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5e6a16d7190e0dc1f38c3693240f0d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*04UPmS4UrWStrG7Z"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">卢克·切瑟在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="91e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应用程序或系统通常会在数据库中执行数据处理，例如存储或更改现有数据。这个过程中可能出现的问题是，当我们想知道数据发生变化之前的状态，而数据库只会存储数据的最后状态。此外，当我们想要将状态数据返回到先前的状态时。此外，我们还会发现很难知道谁对数据进行了更改。</p><p id="6f06" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从上面关于数据的一些问题出发，有一个开放源代码，我们可以使用它来审计从一个数据状态到另一个数据状态，这样我们就可以找出哪些数据发生了变化，以及谁改变了它。另外，如果我们想回滚到以前的状态，会更容易。开源工具是<strong class="kc io"> Javers </strong>。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h2 id="8f0d" class="lf lg in bd lh li lj dn lk ll lm dp ln kl lo lp lq kp lr ls lt kt lu lv lw lx bi translated">什么是贾维斯</h2><p id="7f08" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">Javers 是一个审计日志框架，可以帮助我们跟踪数据变化。以下是该库的一些优势:</p><ul class=""><li id="c6b1" class="md me in kc b kd ke kh ki kl mf kp mg kt mh kx mi mj mk ml bi translated">它是开源的，可以免费使用，并且仍然被积极维护</li><li id="1e2f" class="md me in kc b kd mm kh mn kl mo kp mp kt mq kx mi mj mk ml bi translated">它支持 RDBMS 或非 RDBMS，如 NoSQL</li><li id="b471" class="md me in kc b kd mm kh mn kl mo kp mp kt mq kx mi mj mk ml bi translated">易于与 Spring 框架集成</li></ul><p id="964d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我将给出一个例子，说明如何将<strong class="kc io"> Javers </strong>与 Spring Boot 集成，以跟踪 MongoDB 中的数据变化。</p><h2 id="fdc0" class="lf lg in bd lh li lj dn lk ll lm dp ln kl lo lp lq kp lr ls lt kt lu lv lw lx bi translated"><strong class="ak">先决条件</strong></h2><p id="62e8" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">用 MongoDB 创建一个 spring boot 项目，并添加 Javers 依赖项。</p><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1b54" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">如何使用</strong></p><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="020f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将<em class="mx">@ javerspringdataauditable</em>注释添加到存储库中。因此 Javers 可以保存更改，比如被更改、保存或删除的数据，保存在数据库中的一个新集合中，称为<em class="mx"> jv_snapshots </em>。此外，Javers 将创建一个新的集合<em class="mx"> jv_head_id </em>来存储最后一个提交 id。</p><figure class="mr ms mt mu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/893809eb4e672be3c489557e9382b13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u95wsW1U4c1KbsrNX68UYQ.png"/></div></div></figure><p id="9044" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个<em class="mx"> jv_snapshots </em>集合中，将存储数据的每个状态变化。我将解释存储在这个集合中的一些字段。</p><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mz mw l"/></div></figure><p id="1660" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">默认情况下，在<em class="mx"> commitMetadata </em>字段中，如果我们不定义谁更改了数据，数据将被保存为未知(匿名)。要更改这个默认配置，我们可以创建一个实现<em class="mx"> AuthorProvider 的<em class="mx"> bean </em>，这样</em>我们就可以根据会话或登录到应用程序的用户来找出是谁进行了数据更改。</p><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="23a4" class="lf lg in bd lh li lj dn lk ll lm dp ln kl lo lp lq kp lr ls lt kt lu lv lw lx bi translated">贾维斯查询</h2><p id="cec7" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">Javers 还提供了一种机制来查询使用 Javers 查询语言(JQL)存储的审计日志数据。有 3 种收集数据的方法:</p><ul class=""><li id="6faa" class="md me in kc b kd ke kh ki kl mf kp mg kt mh kx mi mj mk ml bi translated">影子:从快照中检索域对象的历史版本</li><li id="42ae" class="md me in kc b kd mm kh mn kl mo kp mp kt mq kx mi mj mk ml bi translated">变化:表示对象的原子差异</li><li id="2f5d" class="md me in kc b kd mm kh mn kl mo kp mp kt mq kx mi mj mk ml bi translated">快照:作为键值存储和显示的对象的状态历史。</li></ul><p id="e2e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">详情请参考本文档:<a class="ae jz" href="https://javers.org/documentation/jql-examples/" rel="noopener ugc nofollow" target="_blank">https://javers.org/documentation/jql-examples/</a></p><h2 id="aacd" class="lf lg in bd lh li lj dn lk ll lm dp ln kl lo lp lq kp lr ls lt kt lu lv lw lx bi translated">结论</h2><p id="45e2" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">Javers 非常有助于跟踪数据库中的数据变化。除此之外，还有其他功能需要考虑。我们可以将审计数据存储在一个单独的数据库中，该数据库与应用程序或系统使用的主数据库是同一个数据库。不幸的是，在撰写本文时，仍然不支持与反应式系统(web flux)的集成。</p><h2 id="5afd" class="lf lg in bd lh li lj dn lk ll lm dp ln kl lo lp lq kp lr ls lt kt lu lv lw lx bi translated"><strong class="ak">参考文献</strong></h2><div class="na nb gp gr nc nd"><a href="https://javers.org/" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">JaVers——Java 中对象审计和区分的领先框架</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">比较复杂对象结构提交对您的域对象执行的更改将数据更改历史记录保存在…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">javers.org</p></div></div><div class="nm l"><div class="nn l no np nq nm nr jt nd"/></div></div></a></div><p id="6bee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">【https://www.baeldung.com/javers T4】</p><p id="cf3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://www.baeldung.com/spring-data-javers-audit" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/spring-data-javers-audit</a></p><figure class="mr ms mt mu gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div></div>    
</body>
</html>