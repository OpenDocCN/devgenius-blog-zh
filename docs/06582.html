<html>
<head>
<title>Automated MariaDB Replication using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Docker 实现自动化 MariaDB 复制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/automated-mariadb-replication-using-docker-a585defcc047?source=collection_archive---------4-----------------------#2022-01-18">https://blog.devgenius.io/automated-mariadb-replication-using-docker-a585defcc047?source=collection_archive---------4-----------------------#2022-01-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d2c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">实现主-主或主-从 MariaDB 复制总是一个挑战。我使用 docker 容器自动化了这个过程。</p><p id="c898" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们回顾一下什么是 MariaDB 复制，以及拥有主-主或主-从复制的重要性，然后解释我们如何使用 docker 容器来自动化它。</p><p id="e52d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，你可以在我的<a class="ae ki" href="https://github.com/hosein-yousefii/MariaDB-replication-docker-stack" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> GitHub </strong> </a> <strong class="jm io"> </strong>资源库中找到下面的代码和解释，还有另一个与使用 Docker  的<a class="ae ki" href="https://github.com/hosein-yousefii/MYSQL-replication-docker-stack" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> MySQL 复制相关的资源库，类似于具有不同代码的 MariaDB。</strong></a></p><p id="e011" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其次，你可以为这个项目做贡献，增加更多的功能。</p><h1 id="6e52" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是 MariaDB？！</h1><p id="1cd7" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">MariaDB 数据库服务是一个完全托管的数据库服务，用于部署云原生应用程序。是 MySQL 的一个分支。</p><h1 id="d368" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是复制？</h1><p id="7016" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">术语<em class="lm">主</em>和<em class="lm">从</em>在历史上曾用于复制，但术语<em class="lm">主</em>和<em class="lm">副本</em>现在更受欢迎。虽然<a class="ae ki" href="https://mariadb.com/kb/en/what-is-mariadb-105/" rel="noopener ugc nofollow" target="_blank"> MariaDB 10.5 </a>已经开始了重命名的过程，但是在整个文档和 MariaDB 命令中都使用了旧的术语。</p><p id="9f77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">复制是一种功能，允许将一台或多台服务器(称为主服务器)的内容镜像到一台或多台服务器(称为从服务器)上。</p><p id="b1e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以控制要复制的数据。所有数据库、一个或多个数据库或数据库中的表都可以有选择地进行复制。</p><p id="2365" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">复制在许多常见场景中使用。用途包括:</p><p id="7ad6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">可伸缩性</strong>:通过拥有一个或多个从服务器，读取可以分散到多个服务器上，减少主服务器的负载。</p><p id="e032" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">数据分析</strong>:分析数据可能会对主服务器产生太大的影响，这同样可以在从服务器上处理。</p><p id="d6ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">备份帮助:</strong> <a class="ae ki" href="https://mariadb.com/kb/en/backing-up-and-restoring/" rel="noopener ugc nofollow" target="_blank">如果服务器没有主动更改数据，备份</a>可以更容易地运行。常见的情况是将数据复制到从设备，然后从设备与主设备断开连接，数据处于稳定状态。</p><p id="88a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">数据分发:</strong>不需要连接到远程主机，可以在本地复制数据，并根据这些数据进行工作。</p><h1 id="2aa6" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">常见复制设置</h1><p id="7a22" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated"><strong class="jm io">主从:</strong></p><p id="b01e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">MariaDB 复制是将存储在 MariaDB 数据库中的单个数据集实时复制到第二台服务器的过程。这种配置称为“主-从”复制，是一种典型的设置。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/eded3c7cc073d7ada8913d2a123eeb03.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*Z6-INvEbSOuwSmqEFjjFGA.png"/></div></figure><p id="0d4a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">主-主:</strong></p><p id="7c44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">MariaDB 主-主复制允许将数据从一台服务器复制到另一台服务器。这一细微但重要的区别允许我们从任一服务器执行 MariaDB 读取或写入。在处理数据访问时，这种配置增加了冗余并提高了效率。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/29b32c6be6814826df9932f064e8fe43.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*pN5LL2Pel2Wvad2BpkXDpg.png"/></div></figure></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="ed34" class="kj kk in bd kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg bi translated">docker-compose 入门:</h1><p id="26fa" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">我们需要为我们的场景部署 2 个容器，所以让我们创建一个名为<a class="ae ki" href="https://github.com/hosein-yousefii/MariaDB-replication-docker-stack/blob/main/docker-compose-mariadb.yaml" rel="noopener ugc nofollow" target="_blank">docker-compose-Maria db . YAML</a>的文件，并将这些代码放入其中:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="70e8" class="mn kk in mj b gy mo mp l mq mr">version: '3'</span><span id="a51d" class="mn kk in mj b gy ms mp l mq mr">services:<br/>  mariadb-master:<br/>    container_name: $FIRST_DB_NAME<br/>    image: mariadb:latest<br/>    restart: unless-stopped<br/>    volumes:<br/>      - 'db_master_data:/var/lib/mysql'<br/>      - './first-host.cnf:/etc/mysql/conf.d/mysql.cnf'<br/>    environment:<br/>      MARIADB_ROOT_PASSWORD: $FIRST_ROOT_PASSWORD<br/>    ports:<br/>      - "$IP_ADDR:3306:3306"<br/>    networks:<br/>      - db-stack<br/>    mem_limit: 2G<br/>    labels:<br/>      app.docker.created: "Hossein Yousefi"<br/>      app.docker.env: "production"<br/>      app.docker.service: "database"</span><span id="78b9" class="mn kk in mj b gy ms mp l mq mr">mariadb-slave:<br/>    container_name: $SECOND_DB_NAME<br/>    image: mariadb:latest<br/>    restart: unless-stopped<br/>    volumes:<br/>      - 'db_slave_data:/var/lib/mysql'<br/>      - './second-host.cnf:/etc/mysql/conf.d/mysql.cnf'<br/>    environment:<br/>      MARIADB_ROOT_PASSWORD: $SECOND_ROOT_PASSWORD<br/>    ports:<br/>      - "$IP_ADDR:3307:3306"<br/>    networks:<br/>      - db-stack<br/>    mem_limit: 2G<br/>    labels:<br/>      app.docker.created: "Hossein Yousefi"<br/>      app.docker.env: "production"<br/>      app.docker.service: "database"</span><span id="ea68" class="mn kk in mj b gy ms mp l mq mr">volumes:<br/>  db_master_data:<br/>    name: db_master_data<br/>    driver: local<br/>  db_slave_data:<br/>    name: db_slave_data<br/>    driver: local</span><span id="ceaf" class="mn kk in mj b gy ms mp l mq mr">networks:<br/>  db-stack:<br/>    name: db-stack<br/>    driver: bridge</span></pre><p id="15e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用不同的变量来促进我们的工作。最重要的是主端口公布在 3306 上，从端口在 3307 上。</p><p id="396c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要为它们中的每一个创建两个配置文件。对于 master，我们创建一个名为<a class="ae ki" href="https://github.com/hosein-yousefii/MariaDB-replication-docker-stack/blob/main/first-host.cnf" rel="noopener ugc nofollow" target="_blank"> first-host.cnf </a>的文件:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="9a3b" class="mn kk in mj b gy mo mp l mq mr">[mysqld]<br/>default_authentication_plugin= mysql_native_password</span><span id="67a5" class="mn kk in mj b gy ms mp l mq mr"># these configs are mandatory, Don't change them.<br/># able to add other configs at the end of this file.<br/>bind-address = 0.0.0.0<br/>log-bin         = master-bin<br/>binlog_format   = mixed<br/>server-id       = 1</span></pre><p id="6071" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的第二个文件是 second-host.cnf:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="1aed" class="mn kk in mj b gy mo mp l mq mr">[mysqld]<br/>default_authentication_plugin= mysql_native_password</span><span id="b900" class="mn kk in mj b gy ms mp l mq mr"># these configs are mandatory, Don't change them.<br/># able to add other configs at the end of this file.</span><span id="999c" class="mn kk in mj b gy ms mp l mq mr">bind-address = 0.0.0.0<br/>log_bin         = slave-bin<br/>server-id       = 2</span></pre><p id="965d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些 docker-compose 应该只由它的脚本来实现，否则它不会工作，因为有几个变量应该被指定。</p><p id="39b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">部署脚本名为 mariadb-deployment.sh:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="0c97" class="mn kk in mj b gy mo mp l mq mr">#!/bin/bash<br/># written by Hosein Yousefi &lt;<a class="ae ki" href="mailto:yousefi.hosein.o@gmail.com" rel="noopener ugc nofollow" target="_blank">yousefi.hosein.o@gmail.com</a>&gt;<br/># GITHUB <a class="ae ki" href="https://github.com/hosein-yousefii" rel="noopener ugc nofollow" target="_blank">https://github.com/hosein-yousefii</a></span><span id="1c63" class="mn kk in mj b gy ms mp l mq mr"># Automated script to replicate 2 instances of MariaDB<br/># Default method is master-slave You are able to change<br/># the method by specifying it on the command line or<br/># with REPLICATION_METHOD variable.<br/># FORINSTANCE:<br/># export REPLICATION_METHOD=master-master</span><span id="02a3" class="mn kk in mj b gy ms mp l mq mr">master-slave() {</span><span id="e50e" class="mn kk in mj b gy ms mp l mq mr">echo<br/> echo starting deploying...<br/> echo</span><span id="71d9" class="mn kk in mj b gy ms mp l mq mr">export FIRST_DB_NAME=${MARIADB_FIRST_DB_NAME:-'db-master'}<br/> export SECOND_DB_NAME=${MARIADB_SECOND_DB_NAME:-'db-slave'}</span><span id="9d3f" class="mn kk in mj b gy ms mp l mq mr">export FIRST_REPL_USER=${MARIADB_FIRST_REPLICATION_USER:-'repl'}</span><span id="676b" class="mn kk in mj b gy ms mp l mq mr">export FIRST_REPL_PASSWORD=${MARIADB_FIRST_REPLICATION_PASSWORD:-'qazwsx'}</span><span id="a43c" class="mn kk in mj b gy ms mp l mq mr">export FIRST_ROOT_PASSWORD=${MARIADB_FIRST_ROOT_PASS:-'qazwsx'}<br/> export SECOND_ROOT_PASSWORD=${MARIADB_SECOND_ROOT_PASS:-'qazwsx'}<br/> <br/> export FIRST_HOST=${MARIADB_FIRST_HOST:-'db-master'}<br/> export SECOND_HOST=${MARIADB_SECOND_HOST:-'db-slave'}<br/> <br/> export IP_ADDR=${DOCKER0_IP:-$(ip a show dev docker0 |grep inet|awk '{print $2}'|awk -F\/ '{print $1}'|grep -v ::)}</span><span id="961e" class="mn kk in mj b gy ms mp l mq mr">docker-compose -f docker-compose-mariadb.yaml up -d</span><span id="81c6" class="mn kk in mj b gy ms mp l mq mr">echo<br/> echo waiting 30s for containers to be up and running...<br/> echo Implementing mariadb master slave replication...<br/> sleep 30<br/> echo</span><span id="5f61" class="mn kk in mj b gy ms mp l mq mr"># Create user on master database.<br/> docker exec $FIRST_HOST \<br/>   mysql -u root --password=$FIRST_ROOT_PASSWORD \<br/>   --execute="create user '$FIRST_REPL_USER'@'%' identified by '$FIRST_REPL_PASSWORD';\<br/>   grant replication slave on *.* to '$FIRST_REPL_USER'@'%';\<br/>   flush privileges;"</span><span id="bfd3" class="mn kk in mj b gy ms mp l mq mr"># Get the log position and name.<br/> result=$(docker exec $FIRST_HOST mysql -u root --password=$FIRST_ROOT_PASSWORD --execute="show master status;")<br/> log=$(echo $result|awk '{print $5}')<br/> position=$(echo $result|awk '{print $6}')</span><span id="c71c" class="mn kk in mj b gy ms mp l mq mr"># Connect slave to master.<br/> docker exec $SECOND_HOST \<br/>   mysql -u root --password=$SECOND_ROOT_PASSWORD \<br/>   --execute="stop slave;\<br/>   reset slave;\<br/>   CHANGE MASTER TO MASTER_HOST='$FIRST_HOST', MASTER_USER='$FIRST_REPL_USER', \<br/>   MASTER_PASSWORD='$FIRST_REPL_PASSWORD', MASTER_LOG_FILE='$log', MASTER_LOG_POS=$position;\<br/>   start slave;\<br/>   SHOW SLAVE STATUS\G;"</span><span id="9bcc" class="mn kk in mj b gy ms mp l mq mr">echo<br/> echo in case of any errors, check if your containers up and running, then rerun this script.<br/> echo<br/> echo The master is running on $IP_ADDR:3306,  <br/> echo The slave is running on $IP_ADDR:3307.<br/> echo<br/>}</span><span id="c9b1" class="mn kk in mj b gy ms mp l mq mr">master-master() {</span><span id="41bc" class="mn kk in mj b gy ms mp l mq mr">echo<br/>        echo starting deploying...<br/> echo</span><span id="a1d1" class="mn kk in mj b gy ms mp l mq mr">export FIRST_DB_NAME=${MARIADB_FIRST_DB_NAME:-'db-master1'}<br/>        export SECOND_DB_NAME=${MARIADB_SECOND_DB_NAME:-'db-master2'}</span><span id="7adf" class="mn kk in mj b gy ms mp l mq mr">export SECOND_REPL_USER=${MARIADB_SECOND_REPLICATION_USER:-'repl-master2'}<br/>        export FIRST_REPL_USER=${MARIADB_FIRST_REPLICATION_USER:-'repl-master1'}</span><span id="73aa" class="mn kk in mj b gy ms mp l mq mr">export FIRST_REPL_PASSWORD=${MARIADB_FIRST_REPLICATION_PASSWORD:-'qazwsx'}<br/>        export SECOND_REPL_PASSWORD=${MARIADB_SECOND_REPLICATION_PASSWORD:-'qazwsx'}</span><span id="974d" class="mn kk in mj b gy ms mp l mq mr">export FIRST_ROOT_PASSWORD=${MARIADB_FIRST_ROOT_PASS:-'qazwsx'}<br/>        export SECOND_ROOT_PASSWORD=${MARIADB_SECOND_ROOT_PASS:-'qazwsx'}</span><span id="30c8" class="mn kk in mj b gy ms mp l mq mr">export FIRST_HOST=${MARIADB_FIRST_HOST:-'db-master1'}<br/>        export SECOND_HOST=${MARIADB_SECOND_HOST:-'db-master2'}</span><span id="52fc" class="mn kk in mj b gy ms mp l mq mr">export IP_ADDR=${DOCKER0_IP:-$(ip a show dev docker0 |grep inet|awk '{print $2}'|awk -F\/ '{print $1}'|grep -v ::)}</span><span id="d3e3" class="mn kk in mj b gy ms mp l mq mr">docker-compose -f docker-compose-mariadb.yaml up -d</span><span id="7032" class="mn kk in mj b gy ms mp l mq mr">echo<br/>        echo waiting 30s for containers to be up and running...<br/> echo Implementing mariadb master master replication...<br/>        sleep 30<br/>        echo</span><span id="d878" class="mn kk in mj b gy ms mp l mq mr"># Create user on master database.<br/>        docker exec $FIRST_HOST \<br/>                        mysql -u root --password=$FIRST_ROOT_PASSWORD \<br/>                        --execute="create user '$FIRST_REPL_USER'@'%' identified by '$FIRST_REPL_PASSWORD';\<br/>                        grant replication slave on *.* to '$FIRST_REPL_USER'@'%';\<br/>                        flush privileges;"</span><span id="213a" class="mn kk in mj b gy ms mp l mq mr">docker exec $SECOND_HOST \<br/>                        mysql -u root --password=$SECOND_ROOT_PASSWORD \<br/>                        --execute="create user '$SECOND_REPL_USER'@'%' identified by '$SECOND_REPL_PASSWORD';\<br/>                        grant replication slave on *.* to '$SECOND_REPL_USER'@'%';\<br/>                        flush privileges;"</span><span id="5586" class="mn kk in mj b gy ms mp l mq mr"># Get the log position and name.<br/>        master1_result=$(docker exec $FIRST_HOST mysql -u root --password=$FIRST_ROOT_PASSWORD --execute="show master status;")<br/>        master1_log=$(echo $master1_result|awk '{print $5}')<br/>        master1_position=$(echo $master1_result|awk '{print $6}')</span><span id="20ff" class="mn kk in mj b gy ms mp l mq mr">master2_result=$(docker exec $SECOND_HOST mysql -u root --password=$SECOND_ROOT_PASSWORD --execute="show master status;")<br/>        master2_log=$(echo $master2_result|awk '{print $5}')<br/>        master2_position=$(echo $master2_result|awk '{print $6}')</span><span id="9414" class="mn kk in mj b gy ms mp l mq mr"># Connect slave to master.<br/>        docker exec $SECOND_HOST \<br/>                        mysql -u root --password=$SECOND_ROOT_PASSWORD \<br/>                        --execute="stop slave;\<br/>                        reset slave;\<br/>                        CHANGE MASTER TO MASTER_HOST='$FIRST_HOST', MASTER_USER='$FIRST_REPL_USER', \<br/>                        MASTER_PASSWORD='$FIRST_REPL_PASSWORD', MASTER_LOG_FILE='$master1_log', MASTER_LOG_POS=$master1_position;\<br/>                        start slave;\<br/>                        SHOW SLAVE STATUS\G;"</span><span id="23d4" class="mn kk in mj b gy ms mp l mq mr">docker exec $FIRST_HOST \<br/>                        mysql -u root --password=$FIRST_ROOT_PASSWORD \<br/>                        --execute="stop slave;\<br/>                        reset slave;\<br/>                        CHANGE MASTER TO MASTER_HOST='$SECOND_HOST', MASTER_USER='$SECOND_REPL_USER', \<br/>                        MASTER_PASSWORD='$SECOND_REPL_PASSWORD', MASTER_LOG_FILE='$master2_log', MASTER_LOG_POS=$master2_position;\<br/>                        start slave;\<br/>                        SHOW SLAVE STATUS\G;"</span><span id="1343" class="mn kk in mj b gy ms mp l mq mr">sleep 2<br/> echo<br/> echo ################### SECOND status</span><span id="2f94" class="mn kk in mj b gy ms mp l mq mr">docker exec $SECOND_HOST \<br/>                        mysql -u root --password=$SECOND_ROOT_PASSWORD \<br/>                        --execute="SHOW SLAVE STATUS\G;"</span><span id="bc76" class="mn kk in mj b gy ms mp l mq mr">sleep2<br/> echo<br/> echo ################### FIRST status</span><span id="bd59" class="mn kk in mj b gy ms mp l mq mr">docker exec $FIRST_HOST \<br/>                        mysql -u root --password=$FIRST_ROOT_PASSWORD \<br/>                        --execute="SHOW SLAVE STATUS\G;"</span><span id="45fb" class="mn kk in mj b gy ms mp l mq mr">sleep 2<br/>        echo<br/>        echo in case of any errors, check if your containers up and running, then rerun this script.<br/>        echo<br/>        echo The master1 is running on $IP_ADDR:3306,<br/>        echo The master2 is running on $IP_ADDR:3307.<br/>        echo</span><span id="815a" class="mn kk in mj b gy ms mp l mq mr">}</span><span id="1c03" class="mn kk in mj b gy ms mp l mq mr">METHOD=${REPLICATION_METHOD:-'master-slave'}</span><span id="31bd" class="mn kk in mj b gy ms mp l mq mr">case ${METHOD} in</span><span id="a181" class="mn kk in mj b gy ms mp l mq mr">master-master)<br/>                master-master<br/>        ;;</span><span id="5ae7" class="mn kk in mj b gy ms mp l mq mr">master-slave)<br/>                master-slave<br/>        ;;</span><span id="6144" class="mn kk in mj b gy ms mp l mq mr">*)<br/>                echo """</span><span id="b771" class="mn kk in mj b gy ms mp l mq mr">Automated script to replicate 2 instances of MariaDB<br/> Default method is master-slave You are able to change<br/> the method by specifying it on the command line or<br/> with REPLICATION_METHOD variable.<br/> FORINSTANCE:<br/> export REPLICATION_METHOD=master-master</span><span id="a168" class="mn kk in mj b gy ms mp l mq mr">"""</span><span id="ee08" class="mn kk in mj b gy ms mp l mq mr">;;</span><span id="01a4" class="mn kk in mj b gy ms mp l mq mr">esac</span></pre><h1 id="4760" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">让我们讨论主从配置:</h1><p id="4bd9" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">有几个变量是您的复制配置，它们都有默认值，因此如果您不指定任何变量，它将正常工作，但最好更改其中一些变量，例如您的 root 密码或复制用户和密码。为此，您可以导出下面指定的变量:</p><p id="e172" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(对于测试环境，没有必要设置任何变量，它使用默认值。)</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="fbe8" class="mn kk in mj b gy mo mp l mq mr"># First DB container name.<br/>export MARIADB_FIRST_DB_NAME='db-master'<br/><br/># Second DB container name.<br/>export MARIADB_SECOND_DB_NAME='db-slave'<br/><br/># User on master container for repliation.<br/>export MARIADB_FIRST_REPLICATION_USER='repl'<br/><br/># Password for replica user on master container.<br/>export MARIADB_FIRST_REPLICATION_PASSWORD='qazwsx'<br/><br/># Root password for master DB.<br/>export MARIADB_FIRST_ROOT_PASS='qazwsx'<br/><br/># Root password for slave DB.<br/>export MARIADB_SECOND_ROOT_PASS='qazwsx'<br/><br/># Master container address (it depends on the container name #"MARIADB_FIRST_DB_NAME" and should be same. You can specify IP addr #instead "NOT RECOMMENDED").<br/>export MARIADB_FIRST_HOST='db-master'<br/><br/># Slave container address (it depends on the container name #"MARIADB_SECOND_DB_NAME" and should be same. You can specify IP #addr instead "NOT RECOMMENDED").<br/>export MARIADB_SECOND_HOST='db-slave'<br/><br/># Your docker bridge IP addr on host.<br/>export DOCKER0_IP='172.17.0.1'</span></pre><p id="cd51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在设置了这些变量中的一些或者没有设置之后，您可以通过执行以下命令来部署 MariaDB 主从复制:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="23f4" class="mn kk in mj b gy mo mp l mq mr">./mariadb-deployment.sh</span></pre><h1 id="5241" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">让我们来看看主-主配置:</h1><p id="632b" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">首先，您应该设置一个变量来受益于主-主复制“REPLICATION _ METHOD = master-master”。</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="5e2c" class="mn kk in mj b gy mo mp l mq mr">export REPLICATION_METHOD=master-master</span></pre><p id="b129" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“复制方法”的默认值是主从式。</p><p id="a713" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">像主-从复制一样，主-主复制也有几个变量。所有这些都有默认值，因此如果您不指定任何变量，它将正常工作，但是，更改其中的一些(例如，您的 root 密码或复制用户和密码)将是一个好主意。为此，您可以导出下面指定的变量:</p><p id="e618" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(对于测试环境，没有必要设置任何变量，它使用默认值。)</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="8642" class="mn kk in mj b gy mo mp l mq mr"># First DB container name.<br/>export MARIADB_FIRST_DB_NAME='db-master1'<br/><br/># Second DB container name.<br/>export MARIADB_SECOND_DB_NAME='db-master2'<br/><br/># User on master1 container for repliation.<br/>export MARIADB_FIRST_REPLICATION_USER='repl-master1'<br/><br/># User on master2 container for repliation.<br/>export MARIADB_SECOND_REPLICATION_USER='repl-master2'<br/><br/># Password for replica user on master1 container.<br/>export MARIADB_FIRST_REPLICATION_PASSWORD='qazwsx'<br/><br/># Password for replica user on master2 container.<br/>export MARIADB_SECOND_REPLICATION_PASSWORD='qazwsx'<br/><br/># Root password for master1 DB.<br/>export MARIADB_FIRST_ROOT_PASS='qazwsx'<br/><br/># Root password for master2 DB.<br/>export MARIADB_SECOND_ROOT_PASS='qazwsx'<br/><br/># Master1 container address (it depends on the container name #"MARIADB_FIRST_DB_NAME" and should be same. You can specify IP addr #instead "NOT RECOMMENDED").<br/>export MARIADB_FIRST_HOST='db-master1'<br/><br/># Master2 container address (it depends on the container name #"MARIADB_SECOND_DB_NAME" and should be same. You can specify IP #addr instead "NOT RECOMMENDED").<br/>export MARIADB_SECOND_HOST='db-master2'<br/><br/># Your docker bridge IP addr on host.<br/>export DOCKER0_IP='172.17.0.1'</span></pre><p id="113a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在设置了这些变量中的一些或者没有设置之后，您可以通过执行以下命令来部署 MariaDB 主从复制:</p><pre class="lo lp lq lr gt mi mj mk ml aw mm bi"><span id="fa2b" class="mn kk in mj b gy mo mp l mq mr">./mariadb-deployment.sh</span></pre><p id="0f29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">几分钟后，你就有了复制的 MariaDB。<br/>这些代码都在我的<a class="ae ki" href="https://github.com/hosein-yousefii" rel="noopener ugc nofollow" target="_blank"> GitHub </a>里，你可以克隆欣赏！</p><p id="7c78" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">欢迎所有的贡献。如果您觉得这篇文章有用，请查看项目 GitHub 资源库。祝你好运。</p></div></div>    
</body>
</html>