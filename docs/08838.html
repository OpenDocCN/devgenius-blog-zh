<html>
<head>
<title>.NET Core and k8s Tip 1: Beware of TimeZones across platforms like Windows OS and Linux Docker Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。NET Core 和 k8s 技巧 1:小心跨平台的时区，如 Windows OS 和 Linux Docker 容器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/net-core-tip-1-beware-of-timezones-across-platforms-like-windows-os-and-linux-docker-containers-9fd3287b1e16?source=collection_archive---------2-----------------------#2022-07-14">https://blog.devgenius.io/net-core-tip-1-beware-of-timezones-across-platforms-like-windows-os-and-linux-docker-containers-9fd3287b1e16?source=collection_archive---------2-----------------------#2022-07-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/c407efa596f2f93d0488bfe18b42fdc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*Dq5MUyF0uVxtl493.png"/></div></figure><p id="99b4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> TL/DR:当您需要使用/插入日期时间</strong>时，请确保在运行不同服务的每个操作系统中使用相同的时区</p><p id="9bf9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">先决条件</strong></p><ul class=""><li id="31e3" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">Windows 10</li><li id="3aa4" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">。网络核心 3.1</li><li id="2c2b" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">Visual Studio 2022</li><li id="46dc" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">带有 WSL 2 的 Docker 桌面</li><li id="58aa" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">目标:Linux Docker 容器</li></ul><p id="278c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">演示项目</p><div class="ld le gp gr lf lg"><a href="https://github.com/nicoclau/TimeZoneLinuxContainerDateTime" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">GitHub-nicoclau/time zonelinuxcontainerdatetime:从 Dockerfile 设置 Linux 上的正确时区</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu jp lg"/></div></div></a></div><h1 id="e556" class="lv lw in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">简介</strong></h1><h1 id="6a41" class="lv lw in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">语境</strong></h1><p id="87b8" class="pw-post-body-paragraph jr js in jt b ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk mx km kn ko ig bi translated">我们有两个应用程序:</p><p id="7135" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">- <strong class="jt io">应用 A </strong>运行在<strong class="jt io"> Windows 操作系统</strong>上，时区为<strong class="jt io">巴黎</strong>巴黎<br/> - <strong class="jt io">应用 B 使用 ASP.NET CORE 3.1</strong>开发，运行在 Kubernetes 集群内的<strong class="jt io"> Docker 容器</strong>内的<strong class="jt io"> Linux </strong>上</p><p id="700c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">应用程序 A 向应用程序 B 发送带有新的<strong class="jt io">日期时间</strong>的消息。应用程序 B 需要将新的<strong class="jt io">日期时间</strong>存储在一个 SQL Server 表中。</p><p id="a01a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">不幸的是，我遇到了一个问题。</p><h1 id="a9f7" class="lv lw in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">问题</strong></h1><p id="b38c" class="pw-post-body-paragraph jr js in jt b ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk mx km kn ko ig bi translated">我有以下问题</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi my"><img src="../Images/9ee02711a0cfb7749a718220d6ec9c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyHRS5nY8wtsG6Px9tLFdw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">SQL Server 表中的日期时间错误</figcaption></figure><p id="a94d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们注意到 SQL Server 表上的日期时间落后了 2 个小时。例如，我们从 19:00 到 17:00。</p><h1 id="039a" class="lv lw in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">分析</strong></h1><p id="0a5c" class="pw-post-body-paragraph jr js in jt b ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk mx km kn ko ig bi translated">在解决这个问题之前，我们需要知道在 ASP.NET 核心 3.1 上运行的应用程序 B 使用的是哪个 Linux 发行版。</p><p id="5f37" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为什么？因此，我们将知道在 Linux 操作系统上使用什么命令可以解决这个问题。</p><p id="9f71" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了开发我们的应用程序 B，我们使用了 x86–64 架构的开发机器。我们使用 ASP.NET 核心 3.1，因为应用 B 是一个 REST Web API，而 3.1 版是我们项目时微软 ASP.NET 核心的 LTS。</p><p id="1911" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在稍后的演示中，我们将看到当我们使用 Visual Studio 2022 添加<strong class="jt io">docker 文件</strong>时，它选择基本 docker 图像:</p><p id="e561" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">以 mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim 为基地</strong></p><p id="d05c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以找到适用于 x86–64 架构的 ASP.NET 核心 3.1 Dockerfile 文件:</p><div class="ld le gp gr lf lg"><a href="https://github.com/dotnet/dotnet-docker/blob/main/src/aspnet/3.1/buster-slim/amd64/Dockerfile" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">主 dotnet/dotnet-docker 上的 dotnet-docker/Dockerfile</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="nl l lr ls lt lp lu jp lg"/></div></div></a></div><p id="8b04" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以看到 Dockerfile 使用了:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="317e" class="nr lw in nn b gy ns nt l nu nv">mcr.microsoft.com/dotnet/<strong class="nn io">runtime:3.1.27-buster-slim</strong></span></pre><p id="6708" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Dockerfile 然后在文件系统中下载并安装 x64 的 ASP.NET 核心 3.1.27:</p><p id="1bf7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae nw" href="https://dotnetcli.azureedge.net/dotnet/aspnetcore/Runtime/3.1.27/aspnetcore-runtime-3.1.27-linux-x64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dotnetcli . azure edge . net/dotnet/aspnetcore/Runtime/3 . 1 . 27/aspnetcore-Runtime-3 . 1 . 27-Linux-x64 . tar . gz</a></p><p id="fedd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后，我们来看看 mcr.microsoft.com/dotnet/runtime:3.1.27-buster-slim 用的是什么 Linux 发行版</p><p id="0797" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它依赖于 MCR . Microsoft . com/dot net/runtime-deps:3 . 1 . 27-buster-slim-arm 64v 8 它自身依赖于<strong class="jt io">arm 64v 8/debian:buster-slim</strong></p><p id="7d69" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以 mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim 的 T2 使用的是 Linux Debian 发行版。</p><p id="8b6f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以检查我们的运行容器:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="cb09" class="nr lw in nn b gy ns nt l nu nv">root@xxx:/app# cat /etc/os-release <br/>PRETTY_NAME="Debian GNU/Linux 10 (buster)"<br/>NAME="Debian GNU/Linux"<br/>VERSION_ID="10"<br/>VERSION="10 (buster)"<br/>VERSION_CODENAME=buster<br/>ID=debian<br/>HOME_URL="<a class="ae nw" href="https://www.debian.org/" rel="noopener ugc nofollow" target="_blank">https://www.debian.org/</a>"<br/>SUPPORT_URL="<a class="ae nw" href="https://www.debian.org/support" rel="noopener ugc nofollow" target="_blank">https://www.debian.org/support</a>"<br/>BUG_REPORT_URL="<a class="ae nw" href="https://bugs.debian.org/" rel="noopener ugc nofollow" target="_blank">https://bugs.debian.org/</a>"</span></pre><p id="000c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以现在我们确定我们使用的是 Debian GNU Linux 版本 10 (buster)。<br/>现在，我们能做些什么来解决我们的问题呢？</p><p id="61f9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在我们知道 Debian GNU Linux 已经安装了<a class="ae nw" href="https://www.iana.org/time-zones" rel="noopener ugc nofollow" target="_blank">https://www.iana.org/time-zones</a>的<strong class="jt io"> tzdata</strong></p><p id="fc42" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以用/etc/localtime 和/etc/timezone 来检查它</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/42f905e1c759c54614f5a22c8f83958e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mMOUNNrLgq2oYYJDi__fQ.png"/></div></div></figure><p id="cdfc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">举例来说，如果 Linux 发行版是 Linux Alpine，这将是一个不同的故事，需要进一步的步骤来安装<strong class="jt io"> tzdata </strong>。</p><p id="5c56" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以我们要做的就是直接设置正确的时区。<br/>来看看解决方案。</p><p id="4eaa" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">解决方案</strong></p><p id="31c5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们需要在 Windows 和 Debian Linux 中使用相同的时区。我们将拭目以待。</p><p id="4447" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在我们的例子中，Windows Server 使用了。net 核心程序。<br/>所以在 Linux os(运行我们的应用程序 B 的容器使用的 Debian Linux)中，我们需要将时区设置为<strong class="jt io">“欧洲/巴黎”。</strong></p><p id="8c75" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将看到我们可以在许多层面上做到这一点。</p><p id="8c1c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们会遇到以下情况，我们会看到问题得到解决:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/2a4589448aaf3b551d5f6d1f3b71b49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDh2CpMoz4HGAnNhgkxWcQ.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd lx">时区相同，但不同操作系统的名称不同</strong></figcaption></figure><p id="a102" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以更改 Linux Debian 操作系统的时区:</p><ul class=""><li id="f482" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">OS 环境变量:我们将在这里使用的最灵活的解决方案</li><li id="0612" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">操作系统文件系统</li><li id="eb08" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">代码库 C#。网络核心</li></ul><blockquote class="nz oa ob"><p id="c4fe" class="jr js oc jt b ju jv jw jx jy jz ka kb od kd ke kf oe kh ki kj of kl km kn ko ig bi translated">注意，正如你在图表上看到的，Windows 和 Linux 的时区名称是不同的。</p></blockquote><p id="2627" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将使用操作系统环境变量解决方案。<br/>为什么？因为我们可以在操作系统和代码库之外改变环境变量。所以非常灵活。</p><p id="eb8b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以在三个不同的可能位置更改环境变量:</p><ul class=""><li id="9ede" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">dockerfile 文件</li><li id="3020" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">docker 运行时(docker 运行时的选项)</li><li id="84b3" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">kubernetes 部署(yaml 文件)</li></ul><p id="e5ac" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将在演示中使用 dockerfile 选项。</p><h1 id="236c" class="lv lw in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">演示</h1><p id="7eb3" class="pw-post-body-paragraph jr js in jt b ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk mx km kn ko ig bi translated">我们刚刚用。网络核心 3.1</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f42ec18b19ca48bb6de3690f683cb89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*0NA_g7cJPd3smj3KsM-NNw.png"/></div></figure><p id="5644" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它只会显示日期。</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="a649" class="nr lw in nn b gy ns nt l nu nv">using System;<br/>using System.Text.Json;</span><span id="b7b5" class="nr lw in nn b gy oh nt l nu nv">namespace TimeZoneLinuxContainerDateTime<br/>{</span><span id="a075" class="nr lw in nn b gy oh nt l nu nv">  internal class Program<br/>  {<br/>    static void Main(string[] args)<br/>    {<br/>      Console.WriteLine(DateTime.Now);<br/>    }<br/>  }<br/>}</span></pre><p id="03ff" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将 docker 支持添加到我们的控制台项目中。</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oi"><img src="../Images/909e96a0aed9d8d2470e7a1986f3f7e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rDU4H0mvZKzOq4jB_aHSw.png"/></div></div></figure><p id="4fc8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">点击 Docker Support 并选择 Linux 作为目标操作系统:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/267d0e64f0e0eb21cf47328ab9e170a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*0mkTXn1w_qtycUCgOvqvfA.png"/></div></figure><p id="9a85" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">点击确定。</p><p id="17aa" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Visual Studio 2022 将在后台运行 Docker:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="6456" class="nr lw in nn b gy ns nt l nu nv">========== Checking for Container Prerequisites ==========</span><span id="9732" class="nr lw in nn b gy oh nt l nu nv">Verifying that Docker Desktop is installed...</span><span id="4b48" class="nr lw in nn b gy oh nt l nu nv">Docker Desktop is installed.</span><span id="c797" class="nr lw in nn b gy oh nt l nu nv">========== Verifying that Docker Desktop is running... ==========</span><span id="ae47" class="nr lw in nn b gy oh nt l nu nv">Verifying that Docker Desktop is running...</span><span id="e90d" class="nr lw in nn b gy oh nt l nu nv">Docker Desktop is running.</span><span id="5852" class="nr lw in nn b gy oh nt l nu nv">========== Verifying Docker OS ==========</span><span id="0738" class="nr lw in nn b gy oh nt l nu nv">Verifying that Docker Desktop's operating system mode matches the project's target operating system...</span><span id="9181" class="nr lw in nn b gy oh nt l nu nv">Docker Desktop's operating system mode matches the project's target operating system.</span><span id="3943" class="nr lw in nn b gy oh nt l nu nv">========== Pulling Required Images ==========</span><span id="d2b5" class="nr lw in nn b gy oh nt l nu nv">Checking for missing Docker images...</span><span id="27f9" class="nr lw in nn b gy oh nt l nu nv">Pulling Docker images. To cancel this download, close the command prompt window.</span><span id="6355" class="nr lw in nn b gy oh nt l nu nv">docker pull mcr.microsoft.com/dotnet/runtime:3.1</span><span id="6b92" class="nr lw in nn b gy oh nt l nu nv">Docker images are ready.</span><span id="6b4c" class="nr lw in nn b gy oh nt l nu nv">========== Warming up container(s) for TimeZoneLinuxContainerDateTime ==========</span><span id="7402" class="nr lw in nn b gy oh nt l nu nv">Starting up container(s)...</span><span id="ce76" class="nr lw in nn b gy oh nt l nu nv">docker build -f "C:\Dev\TimeZoneLinuxContainerDateTime\TimeZoneLinuxContainerDateTime\Dockerfile" --force-rm -t timezonelinuxcontainerdatetime:dev --target base  --label "com.microsoft.created-by=visual-studio" --label "com.microsoft.visual-studio.project-name=TimeZoneLinuxContainerDateTime" "C:\Dev\TimeZoneLinuxContainerDateTime"</span><span id="d992" class="nr lw in nn b gy oh nt l nu nv">#1 [internal] load build definition from Dockerfile</span><span id="eb45" class="nr lw in nn b gy oh nt l nu nv">#1 sha256:a3f449de26c280f82facd0cfe113e19009b34882c0092ca5f2b6f2b8a6a662a5</span><span id="8768" class="nr lw in nn b gy oh nt l nu nv">#1 transferring dockerfile: 893B 0.0s done</span><span id="1531" class="nr lw in nn b gy oh nt l nu nv">#1 DONE 0.1s</span><span id="0a32" class="nr lw in nn b gy oh nt l nu nv">#2 [internal] load .dockerignore</span><span id="94b4" class="nr lw in nn b gy oh nt l nu nv">#2 sha256:0c0d7ec41ea95c8f3d3d0c411c7a88079bdfcc88396cb7ebc856b651e82a345d</span><span id="4197" class="nr lw in nn b gy oh nt l nu nv">#2 transferring context: 382B 0.0s done</span><span id="ef2d" class="nr lw in nn b gy oh nt l nu nv">#2 DONE 0.1s</span><span id="29ce" class="nr lw in nn b gy oh nt l nu nv">#3 [internal] load metadata for mcr.microsoft.com/dotnet/runtime:3.1</span><span id="7301" class="nr lw in nn b gy oh nt l nu nv">#3 sha256:0553f26b35189d38deb0143a81e5c83c941e9b39a74cfa379650145f26f6db1f</span><span id="4d5c" class="nr lw in nn b gy oh nt l nu nv">#3 DONE 0.0s</span><span id="c29c" class="nr lw in nn b gy oh nt l nu nv">#4 [base 1/2] FROM mcr.microsoft.com/dotnet/runtime:3.1</span><span id="2a43" class="nr lw in nn b gy oh nt l nu nv">#4 sha256:84cc03a55bd4a33aba1714c34d872646c9ef15055bd99dc6df9422de3007a647</span><span id="3543" class="nr lw in nn b gy oh nt l nu nv">#4 DONE 0.0s</span><span id="fd8f" class="nr lw in nn b gy oh nt l nu nv">#5 [base 2/2] WORKDIR /app</span><span id="6e18" class="nr lw in nn b gy oh nt l nu nv">#5 sha256:5127c3c72b2387bd931efa010eae7503fb3d72051e78617116669bc0d87685dc</span><span id="c1ba" class="nr lw in nn b gy oh nt l nu nv">#5 CACHED</span><span id="6d88" class="nr lw in nn b gy oh nt l nu nv">#6 exporting to image</span><span id="3652" class="nr lw in nn b gy oh nt l nu nv">#6 sha256:e8c613e07b0b7ff33893b694f7759a10d42e180f2b4dc349fb57dc6b71dcab00</span><span id="3c3d" class="nr lw in nn b gy oh nt l nu nv">#6 exporting layers done</span><span id="47ae" class="nr lw in nn b gy oh nt l nu nv">#6 writing image sha256:e090c4f7d0a7473c836c0200b7414636e4e3fdd9057a07456815add40f91b4ea done</span><span id="9207" class="nr lw in nn b gy oh nt l nu nv">#6 naming to docker.io/library/timezonelinuxcontainerdatetime:dev done</span><span id="63e9" class="nr lw in nn b gy oh nt l nu nv">#6 DONE 0.0s</span><span id="bd6b" class="nr lw in nn b gy oh nt l nu nv">Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them</span><span id="6364" class="nr lw in nn b gy oh nt l nu nv">docker run -dt -v "C:\Users\xxx\vsdbg\vs2017u5:/remote_debugger:rw" -v "C:\Dev\TimeZoneLinuxContainerDateTime\TimeZoneLinuxContainerDateTime:/app" -v "C:\Dev\TimeZoneLinuxContainerDateTime:/src/" -v "C:\Users\xxx\.nuget\packages\:/root/.nuget/fallbackpackages3" -v "C:\Program Files (x86)\Microsoft Visual Studio\Shared\NuGetPackages:/root/.nuget/fallbackpackages" -v "C:\Program Files\dotnet\sdk\NuGetFallbackFolder:/root/.nuget/fallbackpackages2" -e "DOTNET_USE_POLLING_FILE_WATCHER=1" -e "NUGET_PACKAGES=/root/.nuget/fallbackpackages3" -e "NUGET_FALLBACK_PACKAGES=/root/.nuget/fallbackpackages;/root/.nuget/fallbackpackages2;/root/.nuget/fallbackpackages3" --name TimeZoneLinuxContainerDateTime --entrypoint tail timezonelinuxcontainerdatetime:dev -f /dev/null</span><span id="532c" class="nr lw in nn b gy oh nt l nu nv">fdf2a2d45bbcbb806679b06ffbd163386ae7021e5f1e2bf178120d0ae20b100f</span><span id="45ff" class="nr lw in nn b gy oh nt l nu nv">Container started successfully.</span><span id="2342" class="nr lw in nn b gy oh nt l nu nv">========== Finished ==========</span></pre><p id="d8cc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">发生了什么事？VS 在 Docker 容器中构建并运行我们的应用程序，并将调试器附加到它上面。此外，它通过使用卷将我们的项目代码链接到它。</p><p id="6a54" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">下面是完整的命令:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="4407" class="nr lw in nn b gy ns nt l nu nv">docker run -dt -v "C:\Users\xxx\vsdbg\vs2017u5:/remote_debugger:rw" -v "C:\Dev\TimeZoneLinuxContainerDateTime\TimeZoneLinuxContainerDateTime:/app" -v "C:\Dev\TimeZoneLinuxContainerDateTime:/src/" -v "C:\Users\xxx\.nuget\packages\:/root/.nuget/fallbackpackages3" -v "C:\Program Files (x86)\Microsoft Visual Studio\Shared\NuGetPackages:/root/.nuget/fallbackpackages" -v "C:\Program Files\dotnet\sdk\NuGetFallbackFolder:/root/.nuget/fallbackpackages2" -e "DOTNET_USE_POLLING_FILE_WATCHER=1" -e "NUGET_PACKAGES=/root/.nuget/fallbackpackages3" -e "NUGET_FALLBACK_PACKAGES=/root/.nuget/fallbackpackages;/root/.nuget/fallbackpackages2;/root/.nuget/fallbackpackages3" --name TimeZoneLinuxContainerDateTime --entrypoint tail timezonelinuxcontainerdatetime:dev -f /dev/null</span></pre><p id="a55b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以在 Docker 桌面上检查容器:</p><p id="4895" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在 Docker 图像部分:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ok"><img src="../Images/cc8f1161911e41fa3ea6f32478e224ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWhySb3oQ3k6Jlz-7oqNbQ.png"/></div></div></figure><p id="404c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以看到它正在使用，这意味着我们有一个运行的容器。</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ol"><img src="../Images/05ab22d101e9b93350adfba7e60edca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIausQgbpQwLW50zQHrAPg.png"/></div></div></figure><p id="36a8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们去贝壳(红色箭头):</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/6af0d723adf4a8adf4548e320267359b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQcH0HsjfuddUPTvMN29zg.png"/></div></div></figure><p id="c64c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们检查运行命令所使用的时区</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="639d" class="nr lw in nn b gy ns nt l nu nv"># date</span></pre><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/78ca29f21edcfeb0ee13fa65a50395ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPHvDPMzLgcoqwlawP1XWQ.png"/></div></div></figure><p id="9edb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们可以看到日期是在 UTC 时区。</p><p id="8ab5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这会给我们的程序带来问题，让我们看看。</p><p id="2dbd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们在我们的程序中增加一个断点。</p><p id="c030" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们通过点击“Docker”从 VS 运行程序:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div class="gh gi om"><img src="../Images/25c9b900526dbf4f6c8886812d04330f.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*RovvPdzyZ2gwQFVWP-zwHw.png"/></div></figure><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi on"><img src="../Images/5f65d245ee11f10722d69b59a7715856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Nmop5phAKqZ7gQTFzc48A.png"/></div></div></figure><p id="5452" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">调试暂停，当我们单击我们的容器时，我们可以看到环境、卷等..</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/7d35e75fb726d513dfe01cbb61970c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*ZiBNJh6kxxCsXUlso1d00A.png"/></div></figure><p id="5ce6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们在“Logs”选项卡上看看我们的程序在日期时间显示了什么:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="f383" class="nr lw in nn b gy ns nt l nu nv">07/14/2022 13:28:33</span></pre><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi op"><img src="../Images/7eae30efd28a375c3be2ba639ae9126d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlImFVwevZRmi_i6EamA3w.png"/></div></div></figure><p id="403d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">但是我们预计是 CEST 时区的 15:28:33。</p><p id="94ea" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在让我们试试我们的解决方案:</p><p id="730e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们在 docker 文件中添加环境变量<strong class="jt io"> TZ </strong> =“欧洲/巴黎”,并重新构建和运行我们的应用程序:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="b53e" class="nr lw in nn b gy ns nt l nu nv">#See https://aka.ms/containerfastmode to understand how Visual Studio uses this Dockerfile to build your images for faster debugging.</span><span id="ff5e" class="nr lw in nn b gy oh nt l nu nv">FROM mcr.microsoft.com/dotnet/runtime:3.1 AS base</span><span id="15bd" class="nr lw in nn b gy oh nt l nu nv">WORKDIR /app</span><span id="522a" class="nr lw in nn b gy oh nt l nu nv">ENV TZ="Europe/Paris"</span><span id="7f4d" class="nr lw in nn b gy oh nt l nu nv">FROM mcr.microsoft.com/dotnet/sdk:3.1 AS build</span><span id="ff86" class="nr lw in nn b gy oh nt l nu nv">WORKDIR /src</span><span id="f2af" class="nr lw in nn b gy oh nt l nu nv">COPY ["TimeZoneLinuxContainerDateTime/TimeZoneLinuxContainerDateTime.csproj", "TimeZoneLinuxContainerDateTime/"]</span><span id="70af" class="nr lw in nn b gy oh nt l nu nv">RUN dotnet restore "TimeZoneLinuxContainerDateTime/TimeZoneLinuxContainerDateTime.csproj"</span><span id="460e" class="nr lw in nn b gy oh nt l nu nv">COPY . .</span><span id="9bef" class="nr lw in nn b gy oh nt l nu nv">WORKDIR "/src/TimeZoneLinuxContainerDateTime"</span><span id="2b2e" class="nr lw in nn b gy oh nt l nu nv">RUN dotnet build "TimeZoneLinuxContainerDateTime.csproj" -c Release -o /app/build</span><span id="dc4f" class="nr lw in nn b gy oh nt l nu nv">FROM build AS publish</span><span id="7154" class="nr lw in nn b gy oh nt l nu nv">RUN dotnet publish "TimeZoneLinuxContainerDateTime.csproj" -c Release -o /app/publish</span><span id="d3f1" class="nr lw in nn b gy oh nt l nu nv">FROM base AS final</span><span id="824c" class="nr lw in nn b gy oh nt l nu nv">WORKDIR /app</span><span id="a19e" class="nr lw in nn b gy oh nt l nu nv">COPY --from=publish /app/publish .</span><span id="5074" class="nr lw in nn b gy oh nt l nu nv">ENTRYPOINT ["dotnet", "TimeZoneLinuxContainerDateTime.dll"]</span></pre><p id="a3ba" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们再次看到程序被断点暂停，但是我们注意到环境中的不同:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/531c24b4ca00756ef749225cae71ef9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*Ml6EK4j4djH2OXJE3_SjXQ.png"/></div></figure><p id="dd3e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以现在运行我们的应用程序的 linux 应该显示预期的当前日期时间(不是 2 小时后):</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi or"><img src="../Images/51959c1d44c6f24aab37b2b2248c99ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AMiQU2JahXPN18JE7YBOsA.png"/></div></div></figure><p id="50e6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们得到:</p><pre class="mz na nb nc gt nm nn no np aw nq bi"><span id="dc24" class="nr lw in nn b gy ns nt l nu nv">07/14/2022 15:35:28</span></pre><p id="78cc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后，我们可以在 shell 上检查时区:</p><figure class="mz na nb nc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/e8756f6a9a3b1bf11f5403bbf2b713df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdDMvTmFdGcwENRUbbNb7g.png"/></div></div></figure><p id="feea" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们确实在 CEST 时区。</p><p id="b65b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请查找演示项目:</p><div class="ld le gp gr lf lg"><a href="https://github.com/nicoclau/TimeZoneLinuxContainerDateTime" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">GitHub-nicoclau/time zonelinuxcontainerdatetime:从 Dockerfile 设置 Linux 上的正确时区</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu jp lg"/></div></div></a></div><p id="0e31" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">结论:</strong></p><p id="9953" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">当我们使用不同的操作系统时，我们需要知道时区。<br/>当我们使用 Linux Docker 容器运行我们的工作负载时，情况更是如此。</p><p id="7287" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">参考文献:</strong></p><p id="af85" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">关于这个问题的一些文章:</p><div class="ld le gp gr lf lg"><a href="https://devblogs.microsoft.com/dotnet/cross-platform-time-zones-with-net-core/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">跨平台时区。网络核心</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">中开发跨多个操作系统的应用程序。NET Core 在处理时区信息时可以…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">devblogs.microsoft.com</p></div></div><div class="lp l"><div class="os l lr ls lt lp lu jp lg"/></div></div></a></div><div class="ld le gp gr lf lg"><a href="https://dejanstojanovic.net/aspnet/2018/july/differences-in-time-zones-in-net-core-on-windows-and-linux-host-os/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">中时区格式的差异。Windows 和 Linux 主机上的 NET Core</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">最近，我正在将日期时间值转换为不同的时区，因为服务器运行在一个…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">dejanstojanovic.net</p></div></div><div class="lp l"><div class="ot l lr ls lt lp lu jp lg"/></div></div></a></div><div class="ld le gp gr lf lg"><a href="https://www.howtogeek.com/devops/how-to-handle-timezones-in-docker-containers/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">如何处理 Docker 容器中的时区</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">时区是容器化应用程序时常见的混淆来源。你的 cron 任务会在右边运行吗…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">www.howtogeek.com</p></div></div><div class="lp l"><div class="ou l lr ls lt lp lu jp lg"/></div></div></a></div><p id="1604" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">关于这个主题的最佳文章:</p><div class="ld le gp gr lf lg"><a href="https://hoa.ro/blog/2020-12-08-draft-docker-time-timezone/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd io gy z fp ll fr fs lm fu fw im bi translated">指南:修复 Docker 中的所有时间和时区问题</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">在介绍本指南的 Docker 部分之前，有必要记住如何设置 Linux 上的时间和时区…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">和乐</p></div></div><div class="lp l"><div class="ov l lr ls lt lp lu jp lg"/></div></div></a></div></div></div>    
</body>
</html>