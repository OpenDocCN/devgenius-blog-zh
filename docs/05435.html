<html>
<head>
<title>Combining Production and Remote Debugging in Java Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Java应用程序中结合生产和远程调试</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/combining-production-and-remote-debugging-in-java-applications-8a849ee93ca9?source=collection_archive---------5-----------------------#2021-08-10">https://blog.devgenius.io/combining-production-and-remote-debugging-in-java-applications-8a849ee93ca9?source=collection_archive---------5-----------------------#2021-08-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="15e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如今，系统变得越来越复杂。一个大的应用程序可能由微服务组成，依赖于不同的API，是一个很难控制的整体，因为它包含旧的遗留代码，或者有许多开发人员一起工作。</p><p id="fa97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随着web应用程序的增长，您的软件架构师(如果您有)可能会引入标准实践，如IOC(控制反转)和TDD(测试驱动开发),以最小化产品错误或崩溃。或者，你可以使用已经实现了这些技术的框架，比如<a class="ae ki" href="https://spring.io/guides/gs/serving-web-content/" rel="noopener ugc nofollow" target="_blank"> Spring </a>。然而，即使有了这些工具，错误和崩溃仍然会发生，你必须处理它们！</p><p id="4acb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么你能做什么呢？你需要能够看到并管理出现的错误，为此，我发现<a class="ae ki" href="https://lightrun.com/cloud/" rel="noopener ugc nofollow" target="_blank"> Lightrun Cloud </a>是最有效的。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/c635f98bb1f3345ee8022e94ee237892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J-N9bBmdK6rDrsBK"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Lightrun主页</figcaption></figure><h1 id="733c" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Lightrun Cloud:什么和为什么</h1><p id="8429" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">Lightrun Cloud是一个免费的可观察性平台，它为您提供了使用CLI或您最喜欢的IDE(在我的例子中是<a class="ae ki" href="https://www.jetbrains.com/idea/" rel="noopener ugc nofollow" target="_blank"> IntelliJ IDEA </a>)在暂存或生产环境中执行实时调试和日志记录所需的工具。</p><p id="fa8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用IntelliJ IDEA安装很快:你打开它，进入设置页面，找到“Lightrun”插件，然后点击“安装”。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mc"><img src="../Images/2109ee0eaf63b2e8624b6f2d0e732f41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bFwjKUI0hU53isQK"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">设置过程</em></figcaption></figure><p id="6f04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装完成后，重启IntelliJ IDEA，点击“登录”，它就会打开浏览器，将你的IDE与你的账号同步。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi me"><img src="../Images/ee4dbbdbda24ddddc21dbe8ff2c9daf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PcPbIbBiDhnRYz9A"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">安装Lightrun后的Intellij想法</em></figcaption></figure><p id="9be6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦你的IDE准备好了，平台会自动知道。缺少的是你要调试的环境。这是安装向导的第二步。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mf"><img src="../Images/b72fcd771bb51f7c65f844d532150c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8OKi5KrotjZXcfpV"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">代理安装说明</figcaption></figure><p id="9b0f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">代理应该安装在您要调试或测试的环境中。它由一个库组成，该库将安装在您的系统上，并将加载java运行时环境，充当Java和您的应用程序之间的中间件。这样，您几乎可以调试它。</p><p id="91f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，安装是指将代理与Java和JAR文件一起使用。但是如果你仔细阅读<a class="ae ki" href="https://docs.lightrun.com/tomcat/" rel="noopener ugc nofollow" target="_blank">文档</a>，你会注意到Lightrun Cloud支持大多数主流框架和服务器，比如Tomcat、Glassfish、Wildfly、Jetty和Weblogic。这意味着，如果您的应用程序不是一个JAR文件，并且您没有测试服务，而是想直接使用服务，那么您可以简单地使用一个“Hello World”应用程序来跳过这一步，并根据您的环境正确地配置代理。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mg"><img src="../Images/3acd91efe33366849d99154fc0365d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XD4KbX7efdzCtHRO"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae ki" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=monokai&amp;wt=none&amp;l=application%2Fx-sh&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=java%2520-agentpath%253A%252Fmnt%252Fpath%252Fto%252Fagent%252Flightrun_agent.so%2520-jar%2520target%252Ftest-api-0.0.1-SNAPSHOT.jar" rel="noopener ugc nofollow" target="_blank"> <em class="md">使用Lighrun代理作为中间件启动应用的命令</em> </a></figcaption></figure><p id="d35d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Windows和WSL是模拟开发和登台环境的好方法，因为许多开发人员通常在Windows上运行他们的ide，并部署在可以用WSL表示的Linux机器上。</p><h1 id="06d6" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">构建测试Web应用程序</h1><p id="459f" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">现在我们已经建立了Lightrun，是时候用一个有缺陷的web应用程序来弄脏我们的手了。对于本教程，我选择了一个打包在JAR文件中的假Spring Boot应用程序来在Lightrun上测试。我选择这个来演示Lightrun Cloud与一个依赖于一些有缺陷的API的web应用程序的使用，我们认为这些API非常稳定，稳定到我们没有回退错误处理策略。</p><p id="c0b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们来布置舞台。我们有一个很好的web应用程序，它具有模拟我们正在连接的API的特性和单元测试，以及一个将触发构建并将其直接部署到我们的环境中的连续交付系统。</p><p id="ca27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了生成模拟假API的随机数据，我们可以使用<a class="ae ki" href="https://github.com/DiUS/java-faker" rel="noopener ugc nofollow" target="_blank"> Java Faker </a>，一个简单的库来生成假数据。你可以通过Maven或者Gradle把它添加到你的应用中。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mh"><img src="../Images/530cd60e37c5a60d266b44f6769293ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xJBQLxVB5IXU696u"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae ki" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=monokai&amp;wt=none&amp;l=auto&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=package%2520dev.testing.demo.model%253B%250A%250Aimport%2520com.github.javafaker.Faker%253B%250A%250Apublic%2520class%2520TestUser%2520%257B%250A%2520%2520%2520%2520private%2520int%2520id%253B%250A%2520%2520%2520%2520private%2520String%2520name%253B%250A%250A%2520%2520%2520%2520public%2520TestUser%28%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520Faker%2520faker%2520%253D%2520new%2520Faker%28%29%253B%250A%250A%2520%2520%2520%2520%2520%2520%2520%2520id%2520%253D%2520faker.number%28%29.numberBetween%281%252C%252010000%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520name%2520%253D%2520faker.name%28%29.firstName%28%29%253B%250A%2520%2520%2520%2520%257D%250A%250A%2520%2520%2520%2520public%2520int%2520getId%28%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520return%2520id%253B%250A%2520%2520%2520%2520%257D%250A%250A%2520%2520%2520%2520public%2520String%2520getName%28%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520return%2520name%253B%250A%2520%2520%2520%2520%257D%250A%257D" rel="noopener ugc nofollow" target="_blank"> <em class="md">假TestUser型号代码</em> </a></figcaption></figure><p id="c82b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TestUser将是我们的假API将返回的内容。假设假API的失败率是30%。这意味着我们可以提取0到100之间的一个数字，如果这个数字大于70，我们可以认为API调用失败。如果发生这种情况，我们将在系统抛出未处理的异常时使用RuntimeException。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mg"><img src="../Images/414d4bc16648209864e9e60fcea9db86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FdfqdzpZBVQgB8yZ"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae ki" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=monokai&amp;wt=none&amp;l=auto&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=package%2520dev.testing.demo.controller%253B%250A%250Aimport%2520com.github.javafaker.Faker%253B%250Aimport%2520dev.testing.demo.model.TestUser%253B%250Aimport%2520org.springframework.web.bind.annotation.GetMapping%253B%250Aimport%2520org.springframework.web.bind.annotation.RestController%253B%250A%250A%2540RestController%250Apublic%2520class%2520TestController%2520%257B%250A%2520%2520%2520%2520%2540GetMapping%28%2522%252Ftest%2522%29%250A%2520%2520%2520%2520public%2520TestUser%2520read%28%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520Faker%2520faker%2520%253D%2520new%2520Faker%28%29%253B%250A%250A%2520%2520%2520%2520%2520%2520%2520%2520%252F*%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520*%2520We%2520suppose%2520that%2520the%2520fail%2520rate%2520is%252030%2525%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520*%2520A%2520number%2520between%252070%2520and%2520100%2520will%2520mean%2520failed%2520request.%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520*%252F%250A%2520%2520%2520%2520%2520%2520%2520%2520int%2520randomPercentage%2520%253D%2520faker.number%28%29.numberBetween%280%252C%2520100%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520if%2520%28randomPercentage%2520%253E%253D%252070%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520throw%2520new%2520RuntimeException%28%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520%257D%250A%250A%2520%2520%2520%2520%2520%2520%2520%2520return%2520new%2520TestUser%28%29%253B%250A%2520%2520%2520%2520%257D%250A%257D%250A" rel="noopener ugc nofollow" target="_blank"> <em class="md">假控制器，会随机抛出异常</em> </a></figcaption></figure><p id="1514" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要将我们的API构建为一个JAR，我们可以很容易地调整pom.xml来使用<a class="ae ki" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-maven-plugin" rel="noopener ugc nofollow" target="_blank"> spring-boot-maven-plugin </a>。</p><h1 id="44b8" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">运行中的Lightrun云</h1><p id="da60" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在连接了Lightrun Cloud的情况下启动您的应用程序后，它将在您的IDE上弹出，生成连接的环境。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/408475e278e79e20c150ae18a92feee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/0*LP_Lm2yjOfJnGt62"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">IntelliJ IDEA面板</em></figcaption></figure><p id="732f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这意味着它当前连接到您的进程，并等待您设置日志记录或<a class="ae ki" href="https://lightrun.com/debugging/remote-debugging/" rel="noopener ugc nofollow" target="_blank">远程调试</a>。你所要做的就是右击你想要记录的行，打开“Lightrun”子菜单，点击“log”。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mj"><img src="../Images/d6ed762a7ea38fbf902e7a732c066e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RCHhgNMw-rGipA6y"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">日志启用</em></figcaption></figure><p id="aee6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将产生一个弹出窗口，您可以在其中设置您希望在日志中看到的内容:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mk"><img src="../Images/30ac88184519869031ad5a0897c3142f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s5bZ1nYXLRNJP5k2"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">测井条件和格式</em></figcaption></figure><p id="d07c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">出于测试目的，我不会设置任何特定的条件，只是记录消息。添加这些日志记录条件后，控制台将会出现，日志将会快速填充。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ml"><img src="../Images/83d48dc22748c8a9a85d7de89b5f27aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*251fIhjCNwqC1vsM"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><em class="md">日志</em></figcaption></figure><p id="19bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这只是冰山一角。想象一下，在一个真实的生产环境中使用Lightrun Cloud，您可以记录来自API、db、if条件或AJAX调用的所有内容，以供每个用户和应用程序的每个实例使用。拥有多个服务器或应用程序实例或多个微服务对于这样的日志记录器来说绝不会是问题。您可以使用虚拟快照来记录所有本地变量和表达式，就像在本地环境中设置断点一样。通过测量应用程序执行的指标，您可以做得更多。</p><h1 id="88d8" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">不再有边缘条件</h1><p id="0df7" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">Lightrun Cloud是一个强大的系统，可以改进您的web应用程序和所有Java应用程序。你可能会想:如果我从头开始开发一个web应用程序，尊重所有众所周知的模式和通用审计技术来阻止所有的错误，<strong class="jm io">那么我还需要Lightrun Cloud吗？</strong></p><p id="2f9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个问题没有正确的答案，但是<strong class="jm io">拥有这样一个强大的工具将显著改善您的测试体验</strong>，尤其是对于像边缘条件或未知状态这样的特殊情况，捕捉并修复生产中所有可能的bug！</p></div></div>    
</body>
</html>