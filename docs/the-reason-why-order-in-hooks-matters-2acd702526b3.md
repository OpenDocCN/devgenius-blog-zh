# é’©å­ä¸­çš„é¡ºåºå¾ˆé‡è¦çš„åŸå› 

> åŸæ–‡ï¼š<https://blog.devgenius.io/the-reason-why-order-in-hooks-matters-2acd702526b3?source=collection_archive---------13----------------------->

![](img/144184eec512046093b5754e7737fce5.png)

ç”±[åŠ³å¡”ç½—Â·å®‰å¾·çƒˆäºšå°¼](https://unsplash.com/@lautaroandreani?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) æ‹æ‘„çš„ç…§ç‰‡

React é’©å­æ˜¯ React 16.8 ä¸­çš„æ–°ç‰¹æ€§ã€‚å®ƒä»¬å…è®¸æ‚¨åœ¨ä¸ç¼–å†™ç±»çš„æƒ…å†µä¸‹ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React ç‰¹æ€§ã€‚å®ƒä»¬æ˜¯ç¼–å†™æœ‰çŠ¶æ€ç»„ä»¶çš„å¼ºå¤§æ–¹æ³•ï¼Œä¹Ÿæ˜¯ç¼–å†™åŠŸèƒ½ç»„ä»¶çš„å¥½æ–¹æ³•ã€‚

ç„¶è€Œï¼Œæ‰€æœ‰è¿™äº›åŠ›é‡éƒ½æ˜¯æœ‰ä»£ä»·çš„ã€‚å®ƒä»¬æœ‰ä¸€äº›ä½ åº”è¯¥éµå®ˆçš„çº¦æŸï¼Œä»¥ä½¿å®ƒä»¬å¾ˆå¥½åœ°å·¥ä½œï¼Œå¦åˆ™ï¼Œä½ æœ€ç»ˆä¼šæœ‰å¾ˆå¤š bugã€‚

ä»Šå¤©æˆ‘æƒ³è°ˆè°ˆä¸€ä¸ªå…·ä½“çš„è§„åˆ™:

> *ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨é’©å­ã€‚*

æ‰€ä»¥ï¼Œç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·åš:

```
import * as React from "react";

const Iron = ({ isMelted = false }) => {
  if (isMelted) {
    const [temperature, setTemperature] = React.useState(null);
  }

  return <div>{...}</div>;
};
```

æˆ–è€…æ›´ç³Ÿçš„æ˜¯:

```
<button onClick={() => useRequest({ id: 12 })}>
  {n + 1}
</button>
```

æœ‰æ—¶å€™ï¼Œé˜…è¯»è¿™æ¡è§„åˆ™çš„äººä¼šåº”ç”¨å®ƒï¼Œè€Œä¸ä¼šé—®å¤ªå¤šä¸ºä»€ä¹ˆå’Œå¦‚ä½•åº”ç”¨çš„é—®é¢˜ï¼Œå¦‚æœä½ ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œé‚£æ²¡å…³ç³»ï¼Œéµå¾ªæ–‡æ¡£è€Œä¸æ·±å…¥å¹¶ä¸å¯è€»ï¼Œä½†å‘½è¿å¸Œæœ›ä½ åœ¨è¿™é‡Œå°±æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥æˆ‘é—®ä½ :ä½ èƒ½å‘Šè¯‰æˆ‘ä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤é‡è¦å—ï¼Ÿ

åœ¨åšä»»ä½•è§£é‡Šä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ æ‰“å¼€ä½ çš„é—®é¢˜è§£å†³å·¥å…·â€”â€”å¤§è„‘ï¼Œæˆ‘ä¼šç»™ä½ äº”åˆ†é’Ÿæ—¶é—´æƒ³å‡ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç„¶åä½ å¯ä»¥æµè§ˆè¿™ç¯‡æ–‡ç« æ¥å¯»æ±‚å¯å‘ï¼

ä½ è§£å†³é—®é¢˜çš„è¿‡ç¨‹å¦‚ä½•ï¼Ÿå¸Œæœ›ä½ æ‰¾åˆ°äº†å¾ˆé…·çš„ä¸œè¥¿ï¼è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ï¼Œå®ç°æˆ‘ä»¬è‡ªå·±çš„**ä½¿ç”¨çŠ¶æ€**ã€‚

é¦–å‘åº”ç”¨ä¼šæ˜¯è¿™ä¸ªï¼Œä½ çŒœæ€ä¹ˆç€ï¼Ÿå¦ä¸€ä¸ªè®¡æ•°å™¨â€¦ä½†æ˜¯å°†è‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆä¸çœŸå®è§£å†³æ–¹æ¡ˆè¿›è¡Œæ¯”è¾ƒä¼šå¾ˆæœ‰ç”¨ã€‚

```
import ReactDOM from "react-dom";
import { useState } from "react";

// The actual Component
export default function App() {
  const [counter, setCounter] = useState(10);
  const increment = () => setCounter(counter + 1);

  return (
    <div>
      <button onClick={increment}>{counter}</button>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById("root"));
```

> *æˆ‘ä»¬å°†ä½¿ç”¨ React 17ï¼Œå› ä¸º 18 ç‰ˆæœ¬ä¸­çš„æ–°æ¸²æŸ“é€»è¾‘ä¸èƒ½å¾ˆå¥½åœ°ä¸â€œè‡ªåˆ¶â€è§£å†³æ–¹æ¡ˆä¸€èµ·å·¥ä½œï¼Œä½†ä½ çŸ¥é“ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå®éªŒğŸ˜‡*

# æˆ‘ä»¬çš„è‡ªå®šä¹‰ä½¿ç”¨çŠ¶æ€

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è°ƒç”¨è‡ªå®šä¹‰çš„ useStateï¼Œè€Œä¸æ˜¯çœŸå®çš„ useStateï¼Œè®©æˆ‘ä»¬æ­å¼€è¿™ä¸ªé’©å­çš„è¡Œä¸ºçš„ç¥ç§˜é¢çº±:

*   å¯ä»¥æ¥å—å¸¦æœ‰çŠ¶æ€åˆå§‹å€¼çš„å‚æ•°ã€‚
*   å®ƒè¿”å›ä¸€ä¸ªå…·æœ‰å®é™…å€¼çš„å…ƒç»„å’Œä¸€ä¸ªæ›´æ–°è¯¥å€¼çš„å‡½æ•°ã€‚
*   ä¸€æ—¦çŠ¶æ€è¢«æ›´æ–°ï¼Œå®ƒè§¦å‘ç»„ä»¶çš„é‡æ–°å‘ˆç°ï¼Œä¿æŒæ›´æ–°çš„å€¼ã€‚

æ‰€ä»¥æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç”¨ä¸€äº›åŸºæœ¬çš„å ä½ç¬¦æ¥å£°æ˜æˆ‘ä»¬çš„å‡½æ•°ï¼Œå¹¶æ³¨é‡ŠçœŸæ­£çš„å‡½æ•°ğŸ’…

```
// import { useState } from "react";

function useState(initialValue) {
  const setValue = (newValue) => {};
  const tuple = [initialValue, setValue];
  return tuple;
}
```

å¤ªå¥½äº†ï¼Œç°åœ¨æ²¡æœ‰ä¸œè¥¿å´©æºƒäº†ï¼Œä½†å®ƒä¹Ÿä¸èµ·ä½œç”¨â€¦æˆ‘ä»¬çš„ setValue å‡½æ•°ä»€ä¹ˆä¹Ÿä¸åšã€‚æˆ‘ä»¬éœ€è¦ç»™å¥¹å®é™…çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™é‡Œçš„ä¸€ä¸ªé—®é¢˜:çŠ¶æ€æ˜¯å¦‚ä½•å­˜å‚¨åœ¨å‡½æ•°ä¸­çš„ï¼Ÿ

æˆ‘çš„æ„æ€æ˜¯ï¼Œæ¯ä¸ªäººéƒ½çŸ¥é“ React ç»„ä»¶åªæ˜¯å‡½æ•°ï¼Œå¯¹å—ï¼ŸReact æœ¬èº«è°ƒç”¨è¿™äº›è§¦å‘ç»„ä»¶æ¸²æŸ“çš„å‡½æ•°ï¼Œä½†æ˜¯å¯¹äºæ¯ä¸€æ¬¡å¯¹`App`ç»„ä»¶çš„æ–°è°ƒç”¨ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆå§‹åŒ–ä¸€ä¸ªå…¨æ–°çš„ useState å‡½æ•°ã€‚

```
App(); // A new useState is invoked
App(); // A new useState is invoked
App(); // A new useState is invoked
```

å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤–éƒ¨å˜é‡æ¥å­˜å‚¨æˆ‘ä»¬çš„é’©å­å£°æ˜ï¼å§‘ä¸”ç§°ä¹‹ä¸º**çŠ¶æ€**ã€‚

```
// This variable will be persistent between renders!
let state = [];

function useState(initialValue) {
  const setValue = (newValue) => {};
  const tuple = [initialValue, setValue];
  return tuple;
}
```

ç°åœ¨æ˜¯æ—¶å€™å®ç°é’©å­çš„æ ¸å¿ƒé€»è¾‘äº†ï¼Œåˆå§‹ç‰ˆæœ¬å¯èƒ½æ˜¯è¿™æ ·çš„:

```
let state = null;

function useState(initialValue) {
  if (state && state[0]) {
    return state;
  }

  const setValue = (newValue) => {
    state[0] = newValue;
    customRender(); // Who am I?
  };

  state = [initialValue, setValue];

  return state;
}
```

è®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹è¡Œä¸º:åœ¨åˆå§‹è°ƒç”¨æ—¶ï¼ŒuseState å°†æ£€æŸ¥åœ¨ States æ•°ç»„çš„ç‰¹å®šç´¢å¼•å¤„æ˜¯å¦å·²ç»æœ‰äº†ä»€ä¹ˆï¼Œå¦‚æœæ˜¯ï¼Œå®ƒå°†è¿”å›å®ƒï¼Œå¦åˆ™å®ƒç”¨å…ƒç»„å¡«å…… state å˜é‡å¹¶è¿”å›å®ƒã€‚

```
// First Render: Initialize with the Tuple
// Second Render: State is not null, so returns it.
// Third Render: State is not null. so returns it.
// Continue Infinitely...
```

> *ä½†æ˜¯ the é›·çº³æ‰˜ï¼Œæˆ‘è¿«ä¸åŠå¾…åœ°å°è¯•äº†è¿™æ®µä»£ç ï¼Œä½†ä»€ä¹ˆéƒ½æ²¡ç”¨ã€‚ä½ åœ¨å¼€ç©ç¬‘å—ï¼Ÿï¼ï¼Ÿ*

ä»”ç»†çœ‹å‰é¢çš„ä»£ç ç‰‡æ®µï¼Œçœ‹åˆ°`customRender`å‡½æ•°è°ƒç”¨äº†å—ï¼Ÿè¿™æ˜¯æˆ‘ä»¬åœ¨ react ä¸­æ¨¡æ‹Ÿé‡æ–°æ¸²æŸ“çš„å¥‡æ€ªæŠ€å·§ã€‚ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…è£…äº†`ReactDOM.render()`è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶åœ¨è®¾ç½®æ–°å€¼æ—¶è°ƒç”¨å®ƒã€‚

```
// Wrap the render function into a function.
function customRender() {
  ReactDOM.render(<App />, document.getElementById("root"));
}

// Don't forget to call it immediately, we need our initial render :)
customRender();
```

å¦‚æœä½ å°è¯•è¿™æ®µä»£ç ï¼Œä½ ä¼šå‘ç°å®ƒå®é™…ä¸Šå’ŒçœŸå®çš„ä¸€æ ·ï¼Œæˆ‘ä¼šæŠŠæ²™ç®±ç•™åœ¨è¿™é‡Œã€‚

é…·ï¼Œç°åœ¨æ˜¯æ—¶å€™è®©ä¸€åˆ‡çˆ†ç‚¸äº†ï¼

çœ‹çœ‹æˆ‘æ”¾åœ¨è¿™é‡Œçš„è¿™ä¸ªæ–°æ²™ç®±:

ä½ èƒ½å‘ç°è¿™ä¸ªæ¼æ´å—ï¼Ÿè¿™å¹¶ä¸é…·â€¦æ¯ä¸ªæŒ‰é’®éƒ½æœ‰ç›¸åŒçš„çŠ¶æ€å€¼ğŸ¥²ï¼Œä¹Ÿè®¸æ˜¯æ—¶å€™æ›´å¥½çš„å®ç°äº†ï¼

# æ˜¯æ—¶å€™æ›´å¥½åœ°å®ç°äº†ï¼

ç¬¬ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬çš„ **state** å˜é‡æ¥å—å•ä¸ªå€¼ï¼Œæ‰€ä»¥å®ƒéœ€è¦æˆä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·Ÿè¸ªæˆ‘ä»¬çš„`useState`è°ƒç”¨çš„ç´¢å¼•ï¼Œå› ä¸ºï¼Œå¯¹äºæ¯ä¸ªçŠ¶æ€ï¼Œå°†æœ‰ä¸åŒçš„å€¼ï¼

åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„æŒ‰é’®ï¼Œæœ€ç»ˆäº«å—è‡ªå·±çš„ä»·å€¼å·¥ä½œç‰ˆæœ¬ï¼

# æˆ‘ä»¬é—®é¢˜çš„ç­”æ¡ˆ

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é—®è‡ªå·±ä¸ºä»€ä¹ˆé’©å­çš„é¡ºåºå¾ˆé‡è¦ï¼Œæˆ‘å¸Œæœ›ç°åœ¨ä½ è‡ªå·±å·²ç»æ‰¾åˆ°äº†ç­”æ¡ˆã€‚

åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯è¿™ä¸ªå˜é‡:

```
const states = []; // I'm a bad Guy ğŸ˜™
```

å°½ç®¡è¿™æ˜¯ä¸€ä¸ªéå¸¸å¹¼ç¨šçš„å®ç°ï¼Œä½† internally react çš„å·¥ä½œæ–¹å¼ä¸æ­¤ç±»ä¼¼ã€‚æ¯ä¸ªé’©å­å®šä¹‰éƒ½å­˜å‚¨æœ‰ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå› æ­¤ React ä¾èµ–å®ƒæ¥è¿”å›æ­£ç¡®çš„å€¼ã€‚

æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œè¿™å°±æ˜¯è¿™æ ·åšä¸æ­£ç¡®çš„åŸå› :

```
import * as React from "react";

const Iron = ({ isMelted = false }) => {
  // Sometimes the index can be zero, sometimes not?
  // There is no consistency between renders!
  if (isMelted) {
    const [temperature, setTemperature] = React.useState(null);
  }

  return <div></div>;
};
```

æ‚¨å¯èƒ½è¿˜ä¼šå‘ç° React å¸¸è§é—®é¢˜è§£ç­”ä¸­çš„è¿™ä¸ªç­”æ¡ˆå¾ˆæœ‰ç”¨:

> ***React å¦‚ä½•å°†é’©å­è°ƒç”¨ä¸ç»„ä»¶å…³è”èµ·æ¥ï¼Ÿ***
> 
> *æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨â€œå­˜å‚¨å•å…ƒâ€åˆ—è¡¨ã€‚å®ƒä»¬åªæ˜¯ JavaScript å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®ä¸€äº›æ•°æ®ã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ªç±»ä¼¼ useState()ï¼Œ* ***çš„é’©å­æ—¶ï¼Œå®ƒè¯»å–å½“å‰å•å…ƒæ ¼(æˆ–è€…åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶åˆå§‹åŒ–å®ƒ)ï¼Œç„¶åå°†æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª*** *ã€‚è¿™å°±æ˜¯å¤šä¸ª useState()è°ƒç”¨å„è‡ªè·å¾—ç‹¬ç«‹çš„æœ¬åœ°çŠ¶æ€çš„æ–¹å¼ã€‚*

*æœ€åˆå‘å¸ƒäº*[*https://renatopozzi . me*](https://renatopozzi.me/articles/the-reason-why-order-in-react-hooks-matters)*ã€‚*

[](https://www.linkedin.com/in/itsrennyman/) [## é›·çº³æ‰˜Â·æ³¢é½|èŒä¸šç®€ä»‹| LinkedIn

### æŠŠå–„è‰¯å’ŒçŸ¥è¯†å¸¦ç»™å…¶ä»–äººã€‚æˆ‘æ˜¯ä¸€åè½¯ä»¶å¼€å‘äººå‘˜ï¼Œç›®å‰åœ¨æ„å¤§åˆ©ç±³å…°ï¼ŒğŸ‡®ğŸ‡¹ï¼Œæˆ‘æ›¾ç»â€¦

www.linkedin.com](https://www.linkedin.com/in/itsrennyman/)