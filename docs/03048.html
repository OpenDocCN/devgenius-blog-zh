<html>
<head>
<title>Configure Azure AD B2C login with ReactJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 ReactJS 配置 Azure AD B2C 登录</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/secure-login-in-reactjs-with-azure-ad-b2c-fc0f919db1dc?source=collection_archive---------0-----------------------#2020-09-24">https://blog.devgenius.io/secure-login-in-reactjs-with-azure-ad-b2c-fc0f919db1dc?source=collection_archive---------0-----------------------#2020-09-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bcad4a380f45fee7de709dae9a6469e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxaFdG6ioJb2-Nebq3sqyA.jpeg"/></div></div></figure><p id="a88c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我打算写这篇文档，因为我无法找到 Cleary 提到的如何使用 Azure active Directory b2c 设置 react 前端登录的完美文档。</p><p id="c7e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在学习本教程之前，我将简要讨论一下什么是 Azure active directory b2c 及其优势。Azure Active Directory B2C 提供企业对客户身份即服务。应用程序的客户可以使用他们首选的社交、企业或本地帐户来获得对您的应用程序的单点登录访问。它使用可以下拉作为主题如下。如需详细信息，请访问<a class="ae kt" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/active-directory-B2C/</a></p><ul class=""><li id="0087" class="ku kv in jx b jy jz kc kd kg kw kk kx ko ky ks kz la lb lc bi translated">定制品牌的身份解决方案(您可以根据需要定制登录)</li><li id="274e" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">使用用户提供的身份进行单点登录访问</li><li id="6796" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">与外部用户存储集成</li><li id="c42f" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">渐进剖析</li><li id="770b" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">第三方身份验证和校对</li></ul><p id="3933" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">先决条件</strong></p><ol class=""><li id="1328" class="ku kv in jx b jy jz kc kd kg kw kk kx ko ky ks li la lb lc bi translated">拥有 Azure 帐户。如果没有，请访问 https://azure.microsoft.com/en-us/<a class="ae kt" href="https://azure.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank"/></li><li id="49e2" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">基本反应知识</li><li id="076e" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">b2c 活动目录租户。如果你还没有一个<a class="ae kt" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/tutorial-create-tenant" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/active-directory-B2C/tutorial-create-tenant</a>请跟随教程？</li></ol><p id="bacd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好吧，我们开始吧，</p><p id="44cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先使用链接<a class="ae kt" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">https://portal.azure.com</a>登录你的 azure 门户，点击过滤器按钮，将目录更改为创建的 azure b2c 租户</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/df517f2a7818003e54639809c5fe40b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*Ttys7z2rSfjHwPZClntNnA.png"/></div></figure><ul class=""><li id="c58a" class="ku kv in jx b jy jz kc kd kg kw kk kx ko ky ks kz la lb lc bi translated">然后点击所有服务并搜索<strong class="jx io"> Azure AD B2C </strong></li><li id="0b55" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">点击<strong class="jx io">应用</strong>然后点击<strong class="jx io">添加</strong>然后用一个唯一的名称填写表格，如下图</li></ul><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lo"><img src="../Images/00c1d364473933c0c9edbc2fedb6e874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlJIKulotDm2u3on0Ks-QQ.png"/></div></div></figure><p id="a427" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用此 URI，您将允许您的应用程序访问您的目录中的某些功能。例如，这可能是读取用户配置文件信息。</p><p id="32ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建应用程序后，您必须获得足够的许可，请遵循以下步骤</p><ol class=""><li id="fe15" class="ku kv in jx b jy jz kc kd kg kw kk kx ko ky ks li la lb lc bi translated">点击<strong class="jx io">应用</strong>标签</li><li id="1628" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">单击您刚刚创建的应用程序。</li><li id="524b" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">点击<strong class="jx io"> API 访问</strong>标签</li><li id="a51f" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">点击<strong class="jx io"> +添加</strong></li><li id="5fa8" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">从<strong class="jx io">选择 API </strong>下拉菜单中选择步骤 4 中的应用程序。</li><li id="a9e4" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">选择“代表登录用户访问此应用程序…”</li><li id="dfcb" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks li la lb lc bi translated">点击<strong class="jx io">确定</strong></li></ol><p id="a7e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后点击创建按钮</p><p id="6929" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在 Azure AD B2C 的左窗格中，你可以找到名为<strong class="jx io">用户流</strong>的标签。</p><p id="ce1a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后点击<strong class="jx io"> +新用户流量</strong></p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lp"><img src="../Images/76d32a9ccc3f34854e1de09e7b4c548b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-oWrZQYXJBm7bNqvyRlXtg.png"/></div></div></figure><p id="6e42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后点击<strong class="jx io">注册并登录</strong>然后选择版本下的<strong class="jx io">推荐</strong>并点击<strong class="jx io">创建</strong></p><p id="9a19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">之后，给你的用户流起一个名字，勾选电子邮件注册，并在返回令牌中勾选你想要的详细信息，如下图所示</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/082756ff205c5d88c410a3a95e3e5c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4kNNaxdcSrFv717UuhYZQ.png"/></div></div></figure><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/22cbf056f5717c07aaabcfc07f4fca83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZgUgQjGMMYuW6D6_GMgsg.png"/></div></div></figure><p id="a017" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在您可以看到创建的用户流，甚至可以使用<strong class="jx io">运行用户流</strong>来运行用户流</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ls"><img src="../Images/f1d0c5562c11183d9176a24c977686be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLr47JjjYEJd3AaUf_kGbA.png"/></div></div></figure><h1 id="836e" class="lt lu in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">现在让我们从创建一个新的 ReactJS 项目开始</h1><p id="7dd8" class="pw-post-body-paragraph jv jw in jx b jy mr ka kb kc ms ke kf kg mt ki kj kk mu km kn ko mv kq kr ks ig bi translated">转到您希望创建 reactjs 应用程序的目录，键入下面的命令在 cmd opened 中创建 react。</p><pre class="lk ll lm ln gt mw mx my mz aw na bi"><span id="f6ef" class="nb lu in mx b gy nc nd l ne nf">$ npx create-react-app b2c-react</span></pre><p id="1128" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，通过键入以下命令导航到新创建的项目目录</p><pre class="lk ll lm ln gt mw mx my mz aw na bi"><span id="4966" class="nb lu in mx b gy nc nd l ne nf">$ cd b2c-react</span></pre><p id="3c85" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行 react 应用程序</p><pre class="lk ll lm ln gt mw mx my mz aw na bi"><span id="ed63" class="nb lu in mx b gy nc nd l ne nf">$ npm start</span></pre><p id="0ed5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将讨论两种方法来实现使用 Azure Active Directory B2C 在 reactJS 应用程序中获取创建登录的目标。</p><h1 id="cb6d" class="lt lu in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">方法一</strong></h1><p id="bc94" class="pw-post-body-paragraph jv jw in jx b jy mr ka kb kc ms ke kf kg mt ki kj kk mu km kn ko mv kq kr ks ig bi translated">首先，我将访问使用微软提供的库创建的 b2c 用户流，该库使用<strong class="jx io"> msal </strong>库。</p><p id="9587" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，创建一个名为 B2c.js 的新文件，并添加所提供的代码</p><p id="07f4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ng">注意，您必须根据您创建的实例配置 msalAppConfig</em></p><p id="a21f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">也就是说，</p><pre class="lk ll lm ln gt mw mx my mz aw na bi"><span id="1788" class="nb lu in mx b gy nc nd l ne nf">var msalAppConfig = {</span><span id="7489" class="nb lu in mx b gy nh nd l ne nf">auth: {</span><span id="2e1b" class="nb lu in mx b gy nh nd l ne nf">clientId: '&lt;client Id&gt;',</span><span id="2622" class="nb lu in mx b gy nh nd l ne nf">authority:'https://&lt;TenantSubDomain&gt;.b2clogin.com/&lt;Tenant&gt;/&lt;signInPolicy&gt;',</span><span id="9390" class="nb lu in mx b gy nh nd l ne nf">redirectUri: '&lt;Redirect Url&gt;',</span><span id="05f6" class="nb lu in mx b gy nh nd l ne nf">validateAuthority: false,</span><span id="17ad" class="nb lu in mx b gy nh nd l ne nf">postLogoutRedirectUri: 'window.location.origin'},</span><span id="5aa8" class="nb lu in mx b gy nh nd l ne nf">cache: {</span><span id="675e" class="nb lu in mx b gy nh nd l ne nf">cacheLocation: 'sessionStorage',</span><span id="30c3" class="nb lu in mx b gy nh nd l ne nf">storeAuthStateInCookie: isIE()</span><span id="7420" class="nb lu in mx b gy nh nd l ne nf">}</span></pre><p id="8d82" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在需要替换 Azure AD B2C 应用程序中值的&lt;&gt;项。</p><p id="0519" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了获取<strong class="jx io">租户的价值，</strong>回到你的 Azure AD B2C 目录。在概述下，复制“域名”字段中的值。</p><p id="8d2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">租户</strong>子域是 onmicrosoft.com 之前租户的第一部分。</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/2ef9cfbf5275ebb1fa5268622653d0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPbOzYZADpThlPmXVk4v4A.png"/></div></div></figure><p id="7cc4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，要获取<strong class="jx io"> clientId </strong>，单击<strong class="jx io">应用程序</strong>标签，并从新创建的应用程序中复制 Id，替换<strong class="jx io">应用程序 Id </strong>字段中的值。</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/04a27fced53945a43fc035b4ba8a8a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MKR-A4ApxybMnHTXzzJqhA.png"/></div></div></figure><p id="1196" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在单击<strong class="jx io">用户流(策略)</strong>标签，复制策略的名称并替换<strong class="jx io"> signInPolicy </strong>字段中的值。</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/953daf63772b2eb1e1644260021eb819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_PHijjGSVZjnWJOEpl1-g.png"/></div></div></figure><p id="8d8f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完整的 B2c.js 会是这样的</p><figure class="lk ll lm ln gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="f584" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后编辑 index.js，如下所示</p><figure class="lk ll lm ln gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="2cc5" class="lt lu in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">方法二</strong></h1><p id="2fc0" class="pw-post-body-paragraph jv jw in jx b jy mr ka kb kc ms ke kf kg mt ki kj kk mu km kn ko mv kq kr ks ig bi translated">这是使用第三方库开发的登录 azure 活动目录 b2c。这个库很适合这个任务，如果你不需要特殊的配置，我推荐你使用它。为此，请使用以下命令安装库。</p><pre class="lk ll lm ln gt mw mx my mz aw na bi"><span id="fb7b" class="nb lu in mx b gy nc nd l ne nf">$ npm install react-azure-b2c --save</span></pre><p id="e086" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后根据从 Azure active directory 获得的上述信息配置以下对象。</p><figure class="lk ll lm ln gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="04a6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么您的 index.js 文件应该如下所示</p><figure class="lk ll lm ln gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="bb3a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在方法一或方法二之后，你可以使用安全的 Azure active directory 登录。重定向的门户将如下所示。</p><p id="97c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你将能够自定义界面，如你所愿，我希望在未来写它。</p><figure class="lk ll lm ln gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/17d10b5ef7ff7931e2e01e3282d54d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKebl3tqLvgp7L-vr0bH8g.png"/></div></div></figure><p id="6bc8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">结论</strong></p><p id="d81c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Azure active directory 将管理用户，并以更安全的方式登录您的前端。在这篇文章中，我讨论了两种方法来实现它。我更喜欢方法二，因为它让你的生活变得简单。但是，如果你有一个问题，使用第三方库，然后微软提供的库方法一更好。</p></div></div>    
</body>
</html>