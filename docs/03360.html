<html>
<head>
<title>An Immersive Guide to Geospatial MongoDB Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理空间MongoDB数据沉浸式指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/an-immersive-guide-to-geospatial-mongodb-data-9ee3529aab9d?source=collection_archive---------4-----------------------#2020-10-26">https://blog.devgenius.io/an-immersive-guide-to-geospatial-mongodb-data-9ee3529aab9d?source=collection_archive---------4-----------------------#2020-10-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/df9e30587ed2444f13031721db1d4731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZ-Nlj10HeImwcHlBmPswQ.png"/></div></div></figure><p id="c5d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">处理坐标可能是一个巨大的痛苦，所以为什么不采取简单的方法呢？与其在前端纠结坐标，不如把它推到后端，让mongoDB来做这项工作。今天，我们将看看如何在mongoDB或mongoose中处理地理空间数据。我们名单上的第一个是<code class="fe kt ku kv kw b">GeoJSON</code>。</p><h1 id="e131" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">杰奥森</h1><p id="c5b2" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">它有各种数据类型，使处理坐标变得容易。请记住，经度在纬度之前:</p><h2 id="247a" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">要点</h2><p id="2925" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">所有类型中最简单的，它基本上是一个坐标，即经度和纬度:</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/91f0daa9d2f38de39d7b0d508049b1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:314/format:webp/0*je_VLwm8s_RwlQSD.png"/></div></figure><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="9d89" class="ma ky in kw b gy mv mw l mx my">// A point<br/>{ type: "Point", coordinates: [ 40, 5 ] }</span></pre><h2 id="f65f" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">线串</h2><p id="cac4" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这是一个坐标数组的数组，它们将被连接起来形成一条线。它基本上由一系列点组成。</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/01322a688ce9781404edf59907165e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/0*yT41lOFt3nlEZCHx.png"/></div></figure><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="da05" class="ma ky in kw b gy mv mw l mx my">// A linestring<br/>{ type: "LineString", coordinates: [ [ 40, 5 ], [ 41, 6 ] ] }</span></pre><h2 id="63f3" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">多边形</h2><p id="648f" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">是多边形，就是这样！正方形、长方形、六边形、十边形、四边形等等。这必须是一个封闭的数字(第一点必须与最后一点相同，我现在听起来像我的数学老师😅).</p><p id="dca5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们使用<code class="fe kt ku kv kw b">LineString</code> s绘制多边形的边。现在，为了更好地说明这一点，我将绘制一个非常非常简单的坐标网格(别担心，没什么复杂的)。</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/88bde45bbc16399e93f4a8e430c8377b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mv6_va1J0ETvpAg7.png"/></div></div></figure><p id="44d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">(我代表我糟糕的设计技巧为这个粗糙的网格道歉😅)</p><p id="e1d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们画一个简单的多边形:</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/a4bc2ff4ccd1367386e4de0d307a86a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i7UQnhpAIehA7AsQ.png"/></div></div></figure><p id="c683" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是我们如何用代码来表示这一点:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="31c1" class="ma ky in kw b gy mv mw l mx my">{<br/>  type : "Polygon",<br/>  coordinates : [<br/>     [ [ 1 , 2 ] , [ 4 , 4 ] , [ 6 , 3 ] , [ 5 , 1 ], [1, 2] ],<br/>  ]<br/>}</span></pre><p id="6309" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一些需要注意的地方:</p><ul class=""><li id="aa61" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated">嵌套的数组有3层，我一会儿会再回到这个问题上</li><li id="58e1" class="nc nd in jx b jy nl kc nm kg nn kk no ko np ks nh ni nj nk bi translated">在图中，只有4个点，但是我们在代码中写了5个点。这是因为图中的第一个点和最后一个点重叠，所以看不到。为了使这成为一个封闭的数字和一个有效的<code class="fe kt ku kv kw b">Polygon</code>，我们需要指定最后一个值与第一个值相同，以告诉mongoDB该数字已经结束。</li></ul><p id="1419" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我之前承诺的，我将解释嵌套数组的秘密:</p><ul class=""><li id="27ff" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated">第一个数组保存所有的环(我马上会解释这一点)。</li><li id="5b19" class="nc nd in jx b jy nl kc nm kg nn kk no ko np ks nh ni nj nk bi translated">第二个持有每个戒指</li></ul><h2 id="3ee2" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">戒指</h2><p id="1da5" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">现在，什么是戒指？基本上就是多边形里面的一个洞。因此，该图形包含多边形之间的区域。这里有一个图表:</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/15f5556cf78fc25cacae0a48f1df2bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E2l2oUG77TnA8t6e.png"/></div></div></figure><p id="fd91" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">里面的白色三角形是一只<code class="fe kt ku kv kw b">ring</code>。该图包含外部多边形内部但在白色区域外部的区域(包含红色阴影区域)。</p><p id="0289" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此多边形的代码如下所示:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="b1fa" class="ma ky in kw b gy mv mw l mx my">{<br/>  type : "Polygon",<br/>  coordinates : [<br/>     [ [ 1 , 2 ] , [ 4 , 4 ] , [ 6 , 3 ] , [ 5 , 1 ], [1, 2] ],<br/>     [ [ 3 , 2 ] , [ 5 , 3 ] , [ 4 , 2 ] , [ 3 , 2 ] ],<br/>  ]<br/>}</span></pre><p id="b199" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那是一堂很长的数学课(希望不会无聊)。让我们实际上研究一下这些类型，并了解更多的操作符。</p><h1 id="dcef" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">$几何</h1><p id="9aa9" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">它保存我们的几何数据类型(例如:<code class="fe kt ku kv kw b">Point</code>，<code class="fe kt ku kv kw b">Polygon</code>)，并与其他操作符协同使用。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="cec1" class="ma ky in kw b gy mv mw l mx my">{<br/>  $geometry: {<br/>    type : "Polygon",<br/>    coordinates : [<br/>     [ [ 1 , 2 ] , [ 4 , 4 ] , [ 6 , 3 ] , [ 5 , 1 ], [1, 2] <br/>    ]<br/>  }<br/>}</span></pre><h1 id="a937" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><code class="fe kt ku kv kw b">$geoIntersects</code></h1><p id="a59d" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">它检查文档中的坐标是否与提供的几何类型相交(不一定完全在里面)(必须是2d类型，即<code class="fe kt ku kv kw b">Polygon</code>)。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="4eb3" class="ma ky in kw b gy mv mw l mx my">Places.find(<br/>   {<br/>     location: {<br/>       $geoIntersects: {<br/>            $geometry: {<br/>              type : "Polygon",<br/>            coordinates : [<br/>               [ <br/>                  [ 1 , 2 ] , [ 4 , 4 ] , [ 6 , 3 ] , [ 5 , 1 ], [1, 2] <br/>               ]<br/>            ]<br/>         }<br/>       }<br/>     }<br/>   }<br/>)</span></pre><h1 id="a98b" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">$地理范围内</h1><p id="68b8" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">检查文件中的坐标是否完全在提供的<code class="fe kt ku kv kw b">Polygon</code>(单/多圈)内。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="c0a5" class="ma ky in kw b gy mv mw l mx my">Places.find(<br/>   {<br/>     location: {<br/>       $geoWithin: {<br/>            $geometry: {<br/>              type : "Polygon",<br/>            coordinates : [<br/>               [ <br/>                  [ 1 , 2 ] , [ 4 , 4 ] , [ 6 , 3 ] , [ 5 , 1 ], [1, 2] <br/>               ]<br/>            ]<br/>         }<br/>       }<br/>     }<br/>   }<br/>)</span></pre><p id="75c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想做同样的事情，但在一个圆里(即在一个特定的坐标半径内)，我们使用<code class="fe kt ku kv kw b">$center</code>。它接受一个有两个元素的数组。第一个是中心的坐标，第二个是半径。格式是<code class="fe kt ku kv kw b">[[coordinateX, coordinateY], radius]</code></p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="c407" class="ma ky in kw b gy mv mw l mx my">Places.find(<br/>  {<br/>    location: { $geoWithin: { $center: [ [-74, 40.74], 10 ] }  <br/>  }<br/>);</span></pre><h1 id="e891" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">附近的美元</h1><p id="1508" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">获取与指定坐标有一定距离的所有文档，该坐标可以使用最小和最大长度进行控制。此外，它将从最近到最远的文件排序。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="d96a" class="ma ky in kw b gy mv mw l mx my">Places.find(<br/>   {<br/>     location:<br/>       { $near :<br/>          {<br/>            $geometry: {<br/>              type: "Point",<br/>              coordinates: [ -68, 35 ] <br/>            },<br/>          }<br/>       }<br/>   }<br/>)</span></pre><p id="77c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以随意指定一个<code class="fe kt ku kv kw b">$minDistance</code>和<code class="fe kt ku kv kw b">$maxDistance</code>。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="30d0" class="ma ky in kw b gy mv mw l mx my">Places.find(<br/>   {<br/>     location:<br/>       { $near :<br/>          {<br/>            $geometry: {<br/>              type: "Point",<br/>              coordinates: [ -68, 35 ],<br/>              $minDistance: 500,<br/>              $maxDistance: 2000<br/>            },<br/>          }<br/>       }<br/>   }<br/>)</span></pre><h1 id="5cb5" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="f81a" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">你可能会想，这有什么用？嗯，假设我们的用户正在寻找他附近的餐馆，我们可以提供10英里半径内的所有餐馆。</p><p id="f299" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读到这里。如果你喜欢这篇文章，并且今天学到了一些东西，别忘了留下你的赞，在medium上关注我！此外，查看我的<a class="ae nr" href="https://twitter.com/akashshyam11" rel="noopener ugc nofollow" target="_blank"> twitter </a>，在那里我为开发者发布了技巧、窍门和迷因。</p></div></div>    
</body>
</html>