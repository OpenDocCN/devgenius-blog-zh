<html>
<head>
<title>Bitcoin Mining using the MS-DOS laptop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MS-DOS笔记本电脑进行比特币挖掘</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/bitcoin-mining-using-the-ms-dos-laptop-7720b884c85c?source=collection_archive---------0-----------------------#2021-10-02">https://blog.devgenius.io/bitcoin-mining-using-the-ms-dos-laptop-7720b884c85c?source=collection_archive---------0-----------------------#2021-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6cc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从ASIC或GPU卡到Raspberry Pi，许多设备都可以用于比特币挖矿。为什么不试试真正有异国情调的东西呢？比如32年前的笔记本电脑？为什么？因为我们可以。</p><p id="7295" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">研究任何技术的最好方法就是去尝试。我想读者已经可以猜到，在30年前的PC上进行比特币挖矿不会让你变得富有。但这是一个很好的尝试，可以理解它在“引擎盖下”是如何工作的，也可以比较计算机的性能在这段时间内是如何增长的。</p><p id="1f59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一台32岁的东芝T3200SX笔记本电脑，产于1989年，其原始成本为6299美元(2021年为13896美元):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9869f7b7d7ec6b42531237a0b2f3bace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYIgSOrq5YTFlt6keOzMbA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">1989年的东芝T3200SX</figcaption></figure><p id="e341" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它有一个16 MHz的80386SX CPU，是当时的尖端技术。可以在上面挖掘比特币吗？我们开始想办法吧。</p><h1 id="256b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">采矿是如何工作的</h1><p id="26d7" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">首先，让我们大致了解一下，比特币挖矿是如何进行的。有足够多的好文章解释细节，我只展示基本的想法。每笔比特币交易都有两个关键部分。首先是区块链的想法。每个事务包含与前一个事务组合的数据的散列数，因此如果链中的任何字节将被改变，校验和将失败。第二个组成部分——区块链中的每个新事务都应该有一个双SHA256哈希，该哈希与特定的“困难”条件相匹配。而这实际上是所有比特币操作的“秘密成分”——对于每一笔交易，矿工都应该找到一个合适的值(它被称为“nonce”)，这使得哈希小于一个特定的值，由系统确定。这个过程可能需要数百万次的尝试，发现并上传了正确值的矿工群体获得奖励。</p><p id="b032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们考虑一个实际的例子。比特币块头有几个参数:</p><ul class=""><li id="3578" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated">版本号:02</li><li id="673f" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">前一个块的哈希:000000000 000000002 7e 7 ba 6 Fe 7 bad 39 fa F3 b5 a83d aed 765 f 0 5f 7 D1 b 71 a 1632249</li><li id="5505" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">Merkle root(块中所有事务的哈希):5e 049 f 40 30 E0 ab 2d ebb 92378 f 53 c0a 6 e 09548 AEA 083 F3 ab 2 5e 1d 94 ea 1155 e 29d</li><li id="af72" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">时间戳:52be05ce (1388185038 Unix时间，或2013年12月27日22:57:18)</li><li id="b8cb" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">难度位:1903a30c</li><li id="92ce" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">nonce——这个参数实际上是挖掘者需要找到的。</li></ul><p id="900d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">矿工们究竟在做什么？首先，难度位决定了符合难度标准的最小散列。对于我们的值1903a30c，哈希阈值将是000000000000003 a30c 000000000000000000000000000000000000000000。矿工正试图改变“nonce”参数，直到数据块的double SHA256值小于该标准。</p><p id="ab83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了说明这个想法，我将使用Python，因为它允许以非常紧凑的方式编写代码。“nonce”变量位于数据块的最后4个字节(“01000000”、“02000000”等):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/51425ad82b63963ecda6c15073de8e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRPon7oeod5iOPyRMqyuZw.png"/></div></div></figure><p id="c8a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是人们为之支付数千美元的过程吗？很容易看出，第一个散列值比系统要求的“0000000000000000003 a30…”值大得多。矿工只能改变“nonce”变量，并且只有在4215469400 (0xfb42f558)次尝试后，我们才能获得正确的哈希:“000000000000002 a7 bbd 25 a 417 c 0374 cc 552610 21e 8 a9 ca 74442 b 01 284 f 0569”。这个哈希对这个数据块有效，矿工会得到一些比特币和一笔交易费奖励。这个交易实际上是真实的，因为所有交易都存储在一个区块链中，所以很容易看到<a class="ae mt" href="https://www.blockchain.com/bch/block/0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569" rel="noopener ugc nofollow" target="_blank">交易细节</a>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/a25ed89f66a1477c36e0d130e57d5eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xti9WZ89kkxYjvc_yfS2Q.png"/></div></div></figure><p id="0044" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们所看到的，找到的哈希值“00000000000002a7bb…f0569”实际上被指定为事务id。难度一直在增加，哈希id不能重复。顺便说一下，奖励是在矿工之间分摊的，所以最终的金额不会像截图上显示的那么大。</p><p id="c36e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以理解为什么比特币的计算速度是以每秒的哈希数来衡量的了——这个参数对于寻找和上传合适的数据块至关重要。让我们试着在MS-DOS机上做。</p><h1 id="efb0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">编码</h1><p id="38b9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">显然没有MS-DOS的比特币挖矿软件。但它仍然很有趣，首先是为了好玩，其次是作为一个比较不同机器计算速度的很好的基准——比特币挖矿近年来变得很流行，几乎每个平台都很容易找到基准。</p><p id="1c9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">计算的关键部分是SHA256算法。我尝试了几种C实现，但其中一些在16位平台上无法正常工作——16位和32位C编译器上的变量大小不同，代码中的一些基于位的算法可能会被破坏。最后，我创建了自己的代码，可以从<a class="ae mt" href="https://github.com/dmitryelj/SHA256-Benchmark/releases" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>下载。</p><p id="8114" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种方法可以为MS-DOS编译C++项目。我们可以在Windows上使用免费的<a class="ae mt" href="https://github.com/open-watcom/open-watcom-v2/releases" rel="noopener ugc nofollow" target="_blank"> Open Watcom </a>编译器来实现:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/3badd1cc1d8df8cd53effe64b1867e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eo952nA8ChxP7hiQ36VZtg.png"/></div></div></figure><p id="14f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二种，也是更“本土”的方式，是使用MS-DOS编译器来编译项目，比如Borland C++:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/18579f4e5da563a96785f475e09023fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Os2c4TCZQiiNyDu2JYQdFA.png"/></div></div></figure><p id="a3c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以使用DOSBox模拟器完成，编译后的文件可以使用CF卡或串口电缆传输到DOS机器上。显然，如果没有像DOSBox这样的模拟器，我们就无法在现代的Windows PC上运行MS-DOS应用程序，我们会得到一条错误消息:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/c7682cbbacf99d2488cf6a5f4c6f4777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PEOjMpx3ufdvbRfIr9VW_Q.png"/></div></div></figure><p id="674c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是C++代码可以在任何地方编译，所以标准的Visual C++或任何其他IDE都可以很容易地用于调试。</p><h1 id="551a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结果</h1><p id="094c" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">最后，我们来看看它是如何工作的。我在笔记本电脑上运行编译后的应用程序，得到了以下结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/8432c0d3de8e4f7ba9f4ac4431d724e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOOTyC1Iu6FA7Xhw-q-Wew.png"/></div></div></figure><p id="bea6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终判决是什么？可以在MS-DOS机上运行比特币计算吗？从技术上来说，80386 CPU可以以每秒15个双散列的“不可思议”速度计算SHA256个散列。而且说不定连8086或者Z80都能做到这一点。我们可以用这台笔记本电脑参与任何加密货币挖掘池吗？理论上，如果在这台笔记本电脑上配置以太网卡和IP地址，这是可能的，但对于MS-DOS来说，这并不容易。这样做有实际的理由吗？好吧，仅仅过了5.84亿年，你就可以得到1美元，如果有些历史学家还记得“笔记本电脑”、“比特币”和“1美元”这些词的意思，这可能会很有趣，而且思考我们人类在这段时间里将如何进化和发展肯定很有趣。</p><p id="29c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后但同样重要的是，功耗呢？令人惊讶的是，它并没有那么大:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/218d98000395f8b9872760682399f9a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdXkz0kMf890ZnKbMYZk8A.png"/></div></div></figure><p id="0f6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它肯定比Raspberry Pi 4好得多(顺便说一下，它的哈希/秒性能约为200K)，但无论如何，它都低于我对一台7.9千克、配有气体等离子屏幕的机器的预期。</p><p id="0351" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为对读者的小小奖励，我在1986年发布的老式笔记本电脑东芝T1100 Plus上测试了相同的代码:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/c64b4512a0b35b7f117efe6cd7fb5ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKDFSBd0EK32B1s57bjNog.png"/></div></div></figure><p id="211e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">T1100 Plus型号有一个7.1MHz的8086 CPU，计算速度明显较慢——我只获得了3.6 hash/s的性能，比相同代码上的80386SX慢4倍左右。</p><p id="b2f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，测试MS-DOS笔记本电脑的性能并与现代笔记本电脑进行比较是很有趣的。关于东芝T3200SX的更多信息可以在<a class="ae mt" href="https://medium.com/geekculture/the-luggable-laptop-how-does-it-look-today-part-ii-toshiba-t3200-from-1989-6d15ce56eadd" rel="noopener">另一篇文章</a>中找到。那些想在自己的硬件上做同样测试的人可以从GitHub 下载一个基准<a class="ae mt" href="https://github.com/dmitryelj/SHA256-Benchmark/releases" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="8ebd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>