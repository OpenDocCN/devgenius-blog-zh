<html>
<head>
<title>Manage your Azure deployment slots with Azure CLI and Kudu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure CLI和Kudu管理您的Azure部署插槽</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/manage-your-azure-deployment-slots-with-azure-cli-and-kudu-5341e3d810c0?source=collection_archive---------3-----------------------#2020-12-26">https://blog.devgenius.io/manage-your-azure-deployment-slots-with-azure-cli-and-kudu-5341e3d810c0?source=collection_archive---------3-----------------------#2020-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/870ef57ca03e263068e25315d6297de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kUAWh_fkKTLax3hQ0zusYQ.jpeg"/></div></div></figure><div class=""/><p id="58b8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将向您展示如何使用Azure CLI创建和管理Azure部署插槽。</p><h1 id="c8f6" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建Azure Web应用资源</h1><p id="2b1b" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">首先，您需要登录您的Azure帐户。为此，请执行以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d3ff" class="mi kx jb me b gy mj mk l ml mm">az login</span></pre><p id="31fd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您可以继续创建资源组、应用服务计划和web ap资源。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9176" class="mi kx jb me b gy mj mk l ml mm"># Login to your Azure account<br/>az login</span><span id="53ab" class="mi kx jb me b gy mn mk l ml mm"># Create a new resource group<br/>az group create -n training-rg -l westus</span><span id="ea66" class="mi kx jb me b gy mn mk l ml mm"># Create a new app service plan<br/>az appservice plan create -g training-rg -n training-plan --sku S1</span><span id="75db" class="mi kx jb me b gy mn mk l ml mm"># Create a new Web App resource<br/>az webapp create -g training-rg -p training-plan -n origintechnologiestraining</span></pre><h2 id="42e9" class="mi kx jb bd ky mo mp dn lc mq mr dp lg kj ms mt lk kn mu mv lo kr mw mx ls my bi translated">添加部署插槽</h2><p id="484c" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要创建新的插槽，请使用以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="e492" class="mi kx jb me b gy mj mk l ml mm">az webapp deployment slot create -n origintechnologiestraining -g training-rg --slot staging</span></pre><h1 id="c02d" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建和部署. NET 5应用程序</h1><p id="ebc9" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">既然你的Azure资源已经准备好了，是时候创建你的web应用了。在这个演示中，我将使用dotnet CLI创建一个新的API项目。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f5d2" class="mi kx jb me b gy mj mk l ml mm">dotnet new webapi -o Training -f net5.0</span></pre><p id="0ec5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在本地运行您的应用程序，请运行以下命令</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0906" class="mi kx jb me b gy mj mk l ml mm">dotnet run -p Training\Training.csproj</span><span id="5a65" class="mi kx jb me b gy mn mk l ml mm">Building...<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Now listening on: <a class="ae mz" href="https://localhost:5001" rel="noopener ugc nofollow" target="_blank">https://localhost:5001</a><br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Now listening on: <a class="ae mz" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a><br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Application started. Press Ctrl+C to shut down.<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Hosting environment: Development<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Content root path: C:\Users\ivanp\Desktop\Training</span></pre><h1 id="1eee" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">部署应用程序</h1><p id="da15" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">是时候部署您的应用程序了。为此，你必须编译并创建一个应用程序及其依赖项的发布包，压缩该包，然后使用kudu将其推送到Azure。这听起来可能不太容易，因为这只是几个命令的问题。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="af31" class="mi kx jb me b gy mj mk l ml mm"># Compile and publish the application and its dependencies<br/>dotnet publish -f net5.0 -o Release -c Release Training.csproj</span><span id="21c4" class="mi kx jb me b gy mn mk l ml mm"># Create a ZIP archive of the output folder of the dotnet publish command<br/>Compress-Archive -Path Release/* -DestinationPath release.zip</span><span id="dc5a" class="mi kx jb me b gy mn mk l ml mm"># Deploy the ZIP file to your web app using the kudu zip push deployment<br/>az webapp deployment source config-zip -g training-rg -n origintechnologiestraining --src release.zip</span></pre><p id="d770" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了最后一条指令之外，前面的指令对于部署插槽是相同的，最后一条指令也将使用<strong class="ka jc"> -s </strong>参数指定插槽名称。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="14bd" class="mi kx jb me b gy mj mk l ml mm">az webapp deployment source config-zip -g training-rg -n origintechnologiestraining --src release.zip -s staging</span></pre><p id="5d28" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！您已经成功地在Azure上部署了新的API。</p><h1 id="1324" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">交通路线</h1><p id="febc" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">使用Azure CLI，插槽之间的路由流量配置非常简单。事实上，您只需执行以下命令就可以做到:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="95d5" class="mi kx jb me b gy mj mk l ml mm">az webapp traffic-routing set --distribution staging=50 --name origintechnologiestraining -g training-rg</span></pre><h1 id="211d" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">交换部署插槽</h1><p id="db67" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要交换两个插槽，请在命令提示符下执行以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="827f" class="mi kx jb me b gy mj mk l ml mm">az webapp deployment slot swap -g training-rg -n origintechnologiestraining --slot staging --target-slot production</span></pre><h1 id="ecfe" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">参考</h1><ul class=""><li id="3d6c" class="na nb jb ka b kb lu kf lv kj nc kn nd kr ne kv nf ng nh ni bi translated"><strong class="ka jc">蔚蓝CLI:</strong>https://docs.microsoft.com/en-us/cli/azure/?<a class="ae mz" href="https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank">view=azure-cli-latest </a></li></ul></div></div>    
</body>
</html>