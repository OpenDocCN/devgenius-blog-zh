<html>
<head>
<title>EC2: No Space Left On Device Error</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EC2:设备上没有剩余空间错误</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ec2-no-space-left-on-device-error-539fac18ac24?source=collection_archive---------3-----------------------#2020-05-29">https://blog.devgenius.io/ec2-no-space-left-on-device-error-539fac18ac24?source=collection_archive---------3-----------------------#2020-05-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="db16" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">亚马逊 EC2 Ubuntu</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/7ef65f8728b8ec6edf97cb512ffa81cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKw2iCDCM_P9k3-tCgOkzw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com/s/photos/spill?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ks" href="https://unsplash.com/@curology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Curology </a>拍摄</figcaption></figure><p id="ffed" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">就在昨天，迎接我的是一件令我吃惊的事情，完全出乎我的意料。我连接到 AWS 上的一个远程服务器，提交我对 EC2 上运行的 PDF 报告生成器服务所做的一些更改。当我试图从 Github 中取出我的改变时，我被迎接了</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="e70c" class="lu lv in lq b gy lw lx l ly lz">[log_config:warn] [pid 10720:tid 140282565658368] (28)No space left on device: </span></pre><p id="737b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我感到困惑的是，在这个服务器上运行的应用程序相当小。我不知道从哪里开始找。以下是最终解决问题的步骤。</p><ul class=""><li id="e0d2" class="ma mb in kv b kw kx kz la lc mc lg md lk me lo mf mg mh mi bi translated"><strong class="kv io">首先，使用下面的命令检查您有多少可用空间以及哪个分区被填满:</strong></li></ul><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="ed6c" class="lu lv in lq b gy lw lx l ly lz">$ df -h</span></pre><p id="e5be" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">输出将如下所示</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="31f7" class="lu lv in lq b gy lw lx l ly lz">Filesystem      Size  Used Avail Use% Mounted on<br/>udev            992M     0  992M   0% /dev<br/>tmpfs           200M   21M  180M  11% /run<br/>/dev/xvda1       10G   10G     0 100% /<br/>tmpfs          1000M     0 1000M   0% /dev/shm<br/>tmpfs           5.0M     0  5.0M   0% /run/lock<br/>tmpfs          1000M     0 1000M   0% /sys/fs/cgroup<br/>tmpfs           200M     0  200M   0% /run/user/1000</span></pre><p id="5b95" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从表面上看，该实例已经用完了磁盘空间，但是是什么填满了所有应该是空的空间呢？</p><ul class=""><li id="801c" class="ma mb in kv b kw kx kz la lc mc lg md lk me lo mf mg mh mi bi translated"><strong class="kv io">第二，找出哪些深藏不露的大文件被吸走储存。</strong></li></ul><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="c867" class="lu lv in lq b gy lw lx l ly lz">$ sudo du -shx /* | sort -h</span></pre><p id="173b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这可能需要一点时间，一旦完成运行，它将返回以下内容</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="b8af" class="lu lv in lq b gy lw lx l ly lz">...<br/>4.0K    /srv<br/>8.0K    /snap<br/>16K     /lost+found<br/>28K     /root<br/>6.5M    /etc<br/>7.1M    /tmp<br/>14M     /sbin<br/>16M     /bin<br/>21M     /run<br/>75M     /boot<br/>185M    /lib<br/>218M    /home<br/>550M    /var<br/>4.8G    /usr</span></pre><ul class=""><li id="6f1a" class="ma mb in kv b kw kx kz la lc mc lg md lk me lo mf mg mh mi bi translated">看来<code class="fe mj mk ml lq b">/usr</code>目录还需要进一步检查，调整之前的命令。</li></ul><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="bc0d" class="lu lv in lq b gy lw lx l ly lz">$ sudo du -shx /usr/* | sort -h</span></pre><p id="3f29" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后我们会看到类似</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="ecfa" class="lu lv in lq b gy lw lx l ly lz">...<br/>4.0K    /usr/games<br/>20M     /usr/include<br/>35M     /usr/sbin<br/>221M    /usr/bin<br/>221M    /usr/share<br/>3.8G    /usr/src<br/>461M    /usr/local<br/>488M    /usr/lib</span></pre><p id="8b56" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我的例子中，<code class="fe mj mk ml lq b">/usr/src</code>目录已经满了。</p><p id="6a85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">再次调整命令，这样我们可以进一步检查<code class="fe mj mk ml lq b">/usr/src</code>目录。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="5ac1" class="lu lv in lq b gy lw lx l ly lz">$ <!-- -->sudo du -shx /usr/src/* | sort -h</span></pre><p id="6959" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mj mk ml lq b">/usr/src</code>目录中有大量的 Linux 头文件，占据了整个驱动器。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="45a8" class="lu lv in lq b gy lw lx l ly lz">13M     /usr/src/linux-headers-4.4.0-1085-aws<br/>13M     /usr/src/linux-headers-4.4.0-1087-aws<br/>13M     /usr/src/linux-headers-4.4.0-1107-aws<br/>106M    /usr/src/linux-aws-headers-4.4.0-1085<br/>106M    /usr/src/linux-aws-headers-4.4.0-1087<br/>106M    /usr/src/linux-aws-headers-4.4.0-1107</span></pre><p id="8a8a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">据我所知，这是由于 Ubuntu 服务器的自动更新。我仍然不确定为什么服务器会慢慢地自我毁灭而没有发出任何警报，但至少这是你的实例被填满的原因之一。</p><ul class=""><li id="6400" class="ma mb in kv b kw kx kz la lc mc lg md lk me lo mf mg mh mi bi translated">最后，使用下面的命令安全地清除那些内存吸取头，并庆祝您的胜利。</li></ul><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="400c" class="lu lv in lq b gy lw lx l ly lz">$ sudo apt autoremove</span></pre><p id="6133" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">运行<code class="fe mj mk ml lq b">$ df -h</code>来检查并确保你已经重新获得了空间。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="04bb" class="lu lv in lq b gy lw lx l ly lz">Filesystem      Size  Used Avail Use% Mounted on<br/>udev            992M     0  992M   0% /dev<br/>tmpfs           200M   21M  180M  11% /run<br/>/dev/xvda1      9.7G  2.9G  6.8G  30% /<br/>tmpfs          1000M     0 1000M   0% /dev/shm<br/>tmpfs           5.0M     0  5.0M   0% /run/lock<br/>tmpfs          1000M     0 1000M   0% /sys/fs/cgroup<br/>tmpfs           200M     0  200M   0% /run/user/1000</span></pre><p id="af50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您也可以使用<code class="fe mj mk ml lq b">$ lsblk</code>获得更好的视角</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="3692" class="lu lv in lq b gy lw lx l ly lz">Filesystem     Type  Size  Used Avail Use% Mounted on<br/>/dev/xvda1     ext4  9.7G  2.9G  6.8G  30% /</span></pre><p id="21a6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您仍然需要更多的空间，只需重复前面概述的步骤，找到更多的大目录或扩展您的分区。一旦通过 AWS 控制台扩展了分区，记得重新启动实例以应用更改。</p></div></div>    
</body>
</html>