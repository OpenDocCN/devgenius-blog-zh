<html>
<head>
<title>Deploy Flask server to an EC2 instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Flask 服务器部署到 EC2 实例</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploy-flask-server-to-an-ec2-instance-13e1a26bc7c9?source=collection_archive---------0-----------------------#2022-02-25">https://blog.devgenius.io/deploy-flask-server-to-an-ec2-instance-13e1a26bc7c9?source=collection_archive---------0-----------------------#2022-02-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="dfb8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">据报道，超过数十万家公司在他们的技术堆栈中使用 Flask。优步、Airbnb、网飞、优步、Lyft 和 Reddit 就是这些公司之一。据报道，Pinterest 使用 Flask 应用程序来使用整个后端 API 框架。</p><p id="d462" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Flask 是一个微框架，这意味着它是非常轻量级的，因为默认情况下它不包括各种授权、加密、速率限制等模块。好的一面是，你可以在你的应用程序中手动设置这些模块，这听起来可能有点麻烦，但事实是它们非常容易设置，给应用程序开发带来了很大的灵活性。</p><p id="857f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 EC2 云服务是部署 Flask 应用程序的方法之一。使用 EC2 服务可以让您在管理和打包应用程序时有很大的灵活性。</p><p id="acf0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您是 EC2 服务的新手，您应该阅读我关于启动 EC2 实例的另一个故事，然后您可以回到这个故事来完成剩余的过程。</p><p id="61d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">链接:<a class="ae ki" href="https://neelratan-93840.medium.com/setup-an-ec2-instance-with-ubuntu-20-04-server-552c6530bb7c" rel="noopener">https://Neel ratan-93840 . medium . com/setup-an-ec2-instance-with-Ubuntu-20-04-server-552 c 6530 bb7c</a></p><p id="9538" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你有一个 EC2 实例运行在 Ubuntu Server 18.04/20.04 操作系统上，那么我们可以马上开始。</p><p id="ab53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们更新 Linux 包。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="7319" class="ks kt in ko b gy ku kv l kw kx">$ sudo apt-get update<br/>$ sudo apt-get upgrade -y</span></pre><p id="cccb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装 python3</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="2769" class="ks kt in ko b gy ku kv l kw kx">$ sudo apt-get install python3 python3-pip -y</span></pre><p id="79b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装虚拟</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="f86a" class="ks kt in ko b gy ku kv l kw kx">$ pip3 install virtualenv</span></pre><p id="3db9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装 Apache web 服务器</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="e25f" class="ks kt in ko b gy ku kv l kw kx">$ sudo apt-get install apache2 libapache2-mod-wsgi-py3 -y</span></pre><p id="2fb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建我们的烧瓶项目的文件夹</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="273f" class="ks kt in ko b gy ku kv l kw kx">$ mkdir ~/flaskapp<br/>$ sudo ln -sT ~/flaskapp /var/www/html/flaskapp<br/>$ cd ~/flaskapp</span></pre><p id="a1ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以验证 Apache 服务器的安装是否正确。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ky"><img src="../Images/d2c0be70ebadbcb3390d1a6fe13701ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2y_tgdQwZgIenPKBSvVjgg.png"/></div></div></figure><p id="1b58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以在浏览器的地址栏中复制并粘贴公共 IP 地址。您应该会看到下面这样的页面。如果没有，可能是不允许对 HTTP 的入站访问。要修复此问题，请单击如上图所示的“安全”选项卡。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lg"><img src="../Images/8062a31dc19ba090a7c3f688b60f3fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6xxzbnKKaoPfSBkOSrGnA.png"/></div></div></figure><p id="09cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后单击 select EC2 实例中的安全组名称。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lh"><img src="../Images/f63b6676c1ac795945b5ba5db51da9d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3JU1WJvjkA2PkFi81wKG8Q.png"/></div></div></figure><p id="975f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后点击<em class="li">编辑入库规则</em>按钮。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lj"><img src="../Images/ae148648dfbd8d99b600c2837decd853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcQmkZvzA6muLR-p4rSYLw.png"/></div></div></figure><p id="862f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里点击<em class="li">添加规则</em>来添加两个新的 HTTP 规则，源选择为<em class="li"> Anywhere-IPv4 </em>和<em class="li"> Anywhere-IPv6。</em>点击<em class="li">保存规则</em>。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lk"><img src="../Images/f3e0210dfc53c7cd040a0969e8a1a1a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMSbuku_tx5MbQzi8KEI5w.png"/></div></div></figure><p id="01c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请重试查看 apache 默认测试网页。</p><p id="6b21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">制作一个 Python3 虚拟环境</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="0bc6" class="ks kt in ko b gy ku kv l kw kx">$ python3 -m virtualenv venv</span></pre><p id="a48f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">激活虚拟环境</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="d133" class="ks kt in ko b gy ku kv l kw kx">$ source venv/bin/activate</span></pre><p id="f3d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装烧瓶</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="9484" class="ks kt in ko b gy ku kv l kw kx">$ pip3 install flask</span></pre><p id="99c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们需要创建两个文件。一个是<strong class="jm io"> app.py </strong>另一个是<strong class="jm io"> app.wsgi </strong>。您可以根据自己的选择使用 nano 或 vim 编辑器。</p><p id="bb4a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将以下代码粘贴到每个文件中。</p><p id="334b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> app.py </strong></p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="611e" class="ks kt in ko b gy ku kv l kw kx">from flask import Flask<br/>app = Flask(__name__)</span><span id="7bb7" class="ks kt in ko b gy ll kv l kw kx">@app.route('/')<br/>def hello_world():<br/>    return 'Hello, World!'</span><span id="ffb7" class="ks kt in ko b gy ll kv l kw kx">if __name__ == "__main__":<br/>    app.run()</span></pre><p id="9dfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> app.wsgi </strong></p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="94d2" class="ks kt in ko b gy ku kv l kw kx">activate_this = '/home/ubuntu/flaskapp/venv/bin/activate_this.py'</span><span id="d520" class="ks kt in ko b gy ll kv l kw kx">with open(activate_this) as f:<br/>    exec(f.read(), dict(__file__=activate_this))</span><span id="422a" class="ks kt in ko b gy ll kv l kw kx">import sys<br/>import logging<br/>logging.basicConfig(stream=sys.stderr) sys.path.insert(0,"/var/www/html/flaskapp/")</span><span id="8f05" class="ks kt in ko b gy ll kv l kw kx">from app import app as application</span></pre><p id="598d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:仔细注意你添加的激活 _ 这个变量的路径。它可能与您创建的文件夹不同。</em></p><p id="e83e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编辑 Apache 配置文件</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="f8c6" class="ks kt in ko b gy ku kv l kw kx">$ sudo nano /etc/apache2/sites-enabled/000-default.conf</span></pre><p id="1b29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将以下几行粘贴到<em class="li">document root/var/www/html</em>下面</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="041c" class="ks kt in ko b gy ku kv l kw kx">WSGIDaemonProcess flaskapp threads=5<br/>WSGIScriptAlias / /var/www/html/flaskapp/app.wsgi </span><span id="7977" class="ks kt in ko b gy ll kv l kw kx">&lt;Directory flaskapp&gt; <br/>    WSGIProcessGroup flaskapp <br/>    WSGIApplicationGroup %{GLOBAL}<br/>    Order deny,allow <br/>    Allow from all<br/>&lt;/Directory&gt;</span></pre><p id="5c0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后保存该文件，并在终端中运行以下命令来重启 Apache 服务器。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="623a" class="ks kt in ko b gy ku kv l kw kx">$ sudo service apache2 restart</span></pre><p id="aac5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样。在浏览器中粘贴公共 IPv4 地址应该会显示 Flask 应用程序的输出。</p><figure class="kj kk kl km gt kz gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/17e1bb8185849e01043ad54ad11a4c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*XbJE6A6OAlH7sbJ4keSOXA.png"/></div></figure><p id="2735" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您在使用 Apache web 服务器时遇到问题。您可以使用以下命令来调试应用程序。它将显示 Apache 和 Flask 应用程序的输出。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="911d" class="ks kt in ko b gy ku kv l kw kx">$ sudo tail -100 /var/log/apache2/error.log</span></pre><p id="a8d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">感谢阅读。</em></p></div></div>    
</body>
</html>