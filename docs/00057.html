<html>
<head>
<title>How To Create a Safari Ad Blocker For iOS Using Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Swift为iOS创建Safari广告拦截器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-a-safari-ad-blocker-for-ios-using-swift-8dda420ed3b7?source=collection_archive---------0-----------------------#2019-08-26">https://blog.devgenius.io/how-to-create-a-safari-ad-blocker-for-ios-using-swift-8dda420ed3b7?source=collection_archive---------0-----------------------#2019-08-26</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="4f8e" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">广告无处不在，但它们不一定出现在你的浏览器中</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/0ad0eac96192af7881a5f26f6b6223aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_tXXyvqUf3yv3u21"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">由<a class="ae kw" href="https://unsplash.com/@joshuaearle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·厄尔</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="b453" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">说实话:我们在日常生活中每天都会看到很多广告。平均而言，我们每天会看到<a class="ae kw" href="https://stopad.io/blog/ads-seen-daily" rel="noopener ugc nofollow" target="_blank">5000个广告</a>，如果你觉得太多了，试着想想你最后一次看到广告是什么时候。大概是五分钟前。</p><p id="e1b3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如今广告无处不在:城市纸板、LED大屏幕、报纸、收音机、互联网和移动应用只是广告商接触消费者的一些主要方式。</p><p id="d0e9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了缓解这个问题(至少在Safari上)，在iOS 9中，苹果增加了使用内容拦截器的可能性，内容拦截器可以做四件重要的事情，可以针对单个域进行定制:</p><ul class=""><li id="1da2" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">块域</li><li id="1e1f" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">阻止cookies</li><li id="2898" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">通过CSS隐藏页面元素</li><li id="039c" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">HTTPS部队</li></ul><p id="20a2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">下面你可以找到一个示例项目，但要了解更多信息和详细了解它是如何工作的，你可以在这里找到苹果文档<a class="ae kw" href="https://developer.apple.com/documentation/safariservices/creating_a_content_blocker#//apple_ref/doc/uid/TP40016265" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="5c23" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">介绍</h1><p id="f6ae" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">首先，新建一个Xcode项目。可以从单视图app开始。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nl"><img src="../Images/ddb3f08f0840e518c9ae349a112948b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rr1kQu2kYQ3AQXl6WnNeSg.png"/></div></div></figure><p id="81d5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在进入文件→新建→目标，并选择内容拦截器扩展。单击Next，在命名项目之后，单击Finish。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nl"><img src="../Images/7601cc0fb1d9404f68133e8fd54966d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxmLuSpn0y2nqT3cGDGshA.png"/></div></div></figure><p id="3471" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">您的项目应该如下所示:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nm"><img src="../Images/dfc748e2abbc36aea93189fdff83517b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vos_myDYcYaqhcTP0aijwA.png"/></div></div></figure><p id="7a1a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">深入研究，我们可以看到在我们刚刚添加的扩展中自动创建的两个文件。我们有:</p><ul class=""><li id="0333" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">这个<code class="fe nn no np nq b">ContentBlockerRequestHandler</code>将加载包含所有配置的文件，并返回主应用程序。</li><li id="414c" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">JSON文件包含一个列表，其中包含我们之前解释过的所有内容拦截器规则。</li></ul></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="4e84" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated"><strong class="ak">找点乐子</strong></h1><p id="aa60" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">好了，现在我们可以开始玩了。尝试添加一些域名到你的<code class="fe nn no np nq b">blockerList.json</code>文件中。下面你可以找到一个JSON文件需要什么结构的例子。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nr ns l"/></div></figure><p id="0f15" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在这个例子中，我屏蔽了Google并隐藏了YouTube的标志。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="486b" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">最后试验</h1><p id="ba33" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">我添加了一个标签，并更改了<code class="fe nn no np nq b">ViewController</code> <em class="nt"> </em>上的背景，这样我就不会在启动时出现黑屏。现在让我们试着运行它，看看在模拟器上会发生什么。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/a1e4ee601782ac415fe9edc21241baea.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*dMwhN7mP9c-Qfg2I1GTb2A.png"/></div></figure><p id="5105" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们的应用程序正在运行，但如果我们打开Safari，我们仍然可以打开谷歌和YouTube仍然有一个标志，对不对？</p><div class="kh ki kj kk gu ab cb"><figure class="nv kl nw nx ny nz oa paragraph-image"><img src="../Images/3bbb6f071106bb5dea400dba1666416e.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*nt-RTvNKoaCIjw1-wqzTWA.png"/></figure><figure class="nv kl nw nx ny nz oa paragraph-image"><img src="../Images/3e9daab3e037524e3b8686368247f505.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*2ELAUgmahpBZJPfwKYkZug.png"/></figure></div><p id="d1c6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">那么，我们还缺少什么来完成我们的内容拦截应用程序呢？我们需要配置Safari才能使用它。</p><p id="f215" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">进入“设置”→“Safari”→“内容拦截器”,在这里我们应该会看到需要启用的应用程序扩展。</p><p id="63a5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后回到Safari，再试一次。下面你可以看到我们的工作成果。</p><div class="kh ki kj kk gu ab cb"><figure class="nv kl nw nx ny nz oa paragraph-image"><img src="../Images/7f753265667df55958245b06e08d2af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*ICNhFBebhZIY99iwgQ1lMw.png"/></figure><figure class="nv kl nw nx ny nz oa paragraph-image"><img src="../Images/37a765f75774dd1a4fd2ee9cf4212b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*_7HLG7OSjDFQmJgkRUp8gA.png"/><figcaption class="ks kt gk gi gj ku kv bd b be z dk ob di oc od translated">谷歌屏蔽了，Youtube的标志也不见了</figcaption></figure></div></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj oe"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><p id="7bf0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">你可以在这里</strong>  <strong class="kz is">找到</strong> <a class="ae kw" href="https://github.com/domeniconicoli/ContentBlocker" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is">的完整代码。</strong></a></p><h1 id="cab7" class="mo mp ir bd mq mr of mt mu mv og mx my jx oh jy na ka oi kb nc kd oj ke ne nf bi translated">未来的改进</h1><p id="98e9" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">在本指南中，我解释了如何为Safari配置内容拦截器，但这样一来，规则是针对应用捆绑包内的静态内容<strong class="kz is"> t </strong>的。如果在应用程序发布后，我们发现我们屏蔽了真正的谷歌，而不是一个诈骗网站，会怎么样？</p><p id="f4d8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们必须修改JSON文件，上传一个新版本到<code class="fe nn no np nq b">AppStoreConnect</code>，等待24到48小时进行审查，然后祈祷我们的用户在删除我们的应用程序或给我们留下0星评级之前升级到最新版本。</p><h2 id="8a94" class="ok mp ir bd mq ol om dn mu on oo dp my lg op oq na lk or os nc lo ot ou ne ov bi translated">我们如何解决这个问题？</h2><p id="032a" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">我们需要在我们的主应用程序(不是在扩展中)上添加逻辑，从远程服务器下载列表(例如，对于一个开源项目，您可以使用GitHub)。本地保存文件，然后刷新Safari规则，调用<a class="ae kw" href="http://SFContentBlockerManager.reloadContentBlockerWithIdentifier" rel="noopener ugc nofollow" target="_blank">Safari content blocker</a><em class="nt"/>方法。</p><p id="5753" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你觉得这很辛苦吗？别担心。不是的！试着一步一步来，有问题就在下面留言评论吧！</p></div></div>    
</body>
</html>