<html>
<head>
<title>Setup Project and Fastify Platform — NestJs with Passport #01</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置项目和 Fastify 平台—带 Passport #01 的 NestJs</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-project-and-fastify-platform-nestjs-with-passport-01-61a8a5bc2b5?source=collection_archive---------4-----------------------#2022-01-11">https://blog.devgenius.io/setup-project-and-fastify-platform-nestjs-with-passport-01-61a8a5bc2b5?source=collection_archive---------4-----------------------#2022-01-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/a58f4a875bf1e32888b663494e88b6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sV4eoX6dfzRXvhwBvB7SVw.png"/></div></div></figure><div class=""/><p id="72d0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这一系列的文章中，我将使用社会认证和 JWT 创建一个护照认证系统。让我们用 NestJs + Passport + Fastify 的组合来创建一个完整的认证系统。</p><p id="c5b5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以在第一部分中，我们从一个空白项目开始，将使用 Fastify 平台并理解 NestJs 是如何工作的。</p><h1 id="6494" class="kt ku iy bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">什么是 NestJs？</h1><p id="2a8e" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">NestJs 是一个用于构建高效且可伸缩的 Node.js 服务器端应用程序的框架。它使用健壮的 HTTP 服务器框架，如 Express 或 Fastify。NestJs 在公共 Node.js 框架之上提供了一个抽象层次，并向开发人员公开了它们的 API。这为使用第三方模块提供了很大的自由度。</p><p id="a135" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用于编写可伸缩、可测试和松散耦合的应用程序。它支持 PostgreSQL、MongoDB、MySQL 等数据库。</p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="a369" class="kt ku iy bd kv kw md ky kz la me lc ld le mf lg lh li mg lk ll lm mh lo lp lq bi translated">启动项目</h1><p id="fade" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们将使用<code class="fe mi mj mk ml b">@nestjs/cli</code>创建一个启动项目，并在我们的项目中不使用这些文件时清除它们。如果你想了解细节，请查阅官方文档。</p><p id="19f4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们在您的计算机中全局安装<code class="fe mi mj mk ml b">@nestjs/cli</code>,并初始化一个空白项目。我推荐使用 yarn 来安装包，但是你也可以选择你喜欢的包管理器。</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="67c9" class="mu ku iy ml b gy mv mw l mx my">yarn global add @nestjs/cli<br/>nest new nest-auth</span></pre><p id="4571" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以访问该文件夹并在 VSCode 中运行(如果您愿意，也可以在另一个编辑器中运行)。</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="7c02" class="mu ku iy ml b gy mv mw l mx my">cd nest-auth<br/>code .</span></pre><p id="d5f1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下图中，您可以看到文件结构，此时我们有一个应用程序模块、控制器和服务。</p><figure class="mm mn mo mp gt ip gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/64b175a769e2c61dd1c42f7723896111.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*xhNfpdDAxykcjAvO.png"/></div></figure><h1 id="0417" class="kt ku iy bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">NestJs 中的块类型</h1><p id="327e" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated"><strong class="jx iz">模块:</strong>用于组织代码，并将特性分解成逻辑上可重用的单元。分组的 TypeScript 文件用“@ Module”decorator 来修饰，它提供了 NestJs 用来组织应用程序结构的元数据。</p><p id="bb57" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">提供者:</strong>也称为服务，设计用于抽象任何形式的复杂性和逻辑。可以创建提供者并将其注入控制器或其他提供者。</p><p id="cd52" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">控制器:</strong>负责处理传入的请求，并向应用程序的客户端返回适当的响应(例如调用 API)。</p><h1 id="e606" class="kt ku iy bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">配置 Fastify 平台</h1><p id="0440" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在这个项目中，我选择使用 Fastify，因为它比 Express 有更好的性能和功能。</p><blockquote class="na nb nc"><p id="c8f0" class="jv jw nd jx b jy jz ka kb kc kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ks ig bi translated"><em class="iy"> Fastify 为 Nest 提供了一个很好的替代框架，因为它以类似 Express 的方式解决设计问题。然而，fastify 比 Express 快得多，达到了几乎两倍的基准测试结果。一个公平的问题是为什么 Nest 使用 Express 作为默认的 HTTP 提供者？原因是 Express 被广泛使用，众所周知，并且有一个庞大的兼容中间件集，可用于嵌套用户开箱即用。</em></p></blockquote><p id="6ed8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们来配置一下，在<code class="fe mi mj mk ml b">main.ts</code>中，如果我们使用 Fastify，我们会配置平台。</p><p id="f8eb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要安装所需的软件包:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="4c0a" class="mu ku iy ml b gy mv mw l mx my">yarn add @nestjs/platform-fastify</span></pre><p id="01b1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mi mj mk ml b">src/main.ts</code>中，你导入<code class="fe mi mj mk ml b">FastifyAdapter</code>和<code class="fe mi mj mk ml b">NestFastifyApplication</code>来初始化<code class="fe mi mj mk ml b">NestFactory.create</code>中的。</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="3c52" class="mu ku iy ml b gy mv mw l mx my">// src/main.ts</span><span id="1884" class="mu ku iy ml b gy nh mw l mx my">import { NestFactory } from '@nestjs/core';<br/>import {<br/>  FastifyAdapter,<br/>  NestFastifyApplication,<br/>} from '@nestjs/platform-fastify';<br/>import { AppModule } from './app.module';</span><span id="fb47" class="mu ku iy ml b gy nh mw l mx my">async function bootstrap() {<br/>  const app = await NestFactory.create&lt;NestFastifyApplication&gt;(<br/>    AppModule,<br/>    new FastifyAdapter()<br/>  );<br/>  await app.listen(3000);<br/>}<br/>bootstrap();</span></pre><p id="92a8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们不需要更多的设置，现在 Fastify 已经配置好了，可以使用了👏</p><h1 id="1498" class="kt ku iy bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">运行第一条路线</h1><p id="c008" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">当使用<code class="fe mi mj mk ml b">@nestjs/cli</code>创建一个项目时，它会创建一个示例路由，因此将使用该路由来测试我们的配置。在接下来的教程中，我将解释在 NestJs 中路由是如何工作的。现在我们想知道 Fastify 是否有效。</p><p id="3cdc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开<code class="fe mi mj mk ml b">app.controller</code>文件，我们看到使用<code class="fe mi mj mk ml b">http://localhost:3000/</code>时在<code class="fe mi mj mk ml b">/</code>路径中使用 GET 方法默认路由，服务器运行<code class="fe mi mj mk ml b">getHello</code>函数并从<code class="fe mi mj mk ml b">AppService</code>返回响应</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="23d1" class="mu ku iy ml b gy mv mw l mx my">// src/app.controller.ts</span><span id="8e00" class="mu ku iy ml b gy nh mw l mx my">import { Controller, Get } from '@nestjs/common';<br/>import { AppService } from './app.service';</span><span id="d031" class="mu ku iy ml b gy nh mw l mx my">@Controller()<br/>export class AppController {<br/>  constructor(private readonly appService: AppService) {}</span><span id="2d0c" class="mu ku iy ml b gy nh mw l mx my">  @Get()<br/>  getHello(): string {<br/>    return this.appService.getHello();<br/>  }</span></pre><p id="b2d2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mi mj mk ml b">AppService</code>有一个名为<code class="fe mi mj mk ml b">getHello</code>的方法，它返回一个字符串<code class="fe mi mj mk ml b">Hello World</code></p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="297a" class="mu ku iy ml b gy mv mw l mx my">// src/app.service.ts</span><span id="6fe2" class="mu ku iy ml b gy nh mw l mx my">import { Injectable } from '@nestjs/common';</span><span id="a8b9" class="mu ku iy ml b gy nh mw l mx my">@Injectable()<br/>export class AppService {<br/>  getHello(): string {<br/>    return 'Hello World!';<br/>  }<br/>}</span></pre><p id="7ea5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，让我们使用 Postman 为这条路线发送一个请求，看看返回什么</p><figure class="mm mn mo mp gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ni"><img src="../Images/35242a769ea91a0ccf3286f0b1547822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qo9ijcPFKe4h_378.png"/></div></div></figure><p id="6029" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好消息是它起作用了👏</p><h1 id="02a7" class="kt ku iy bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">记录器</h1><p id="bedd" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果你想得到一个你发送一个请求的日志，你可以在<code class="fe mi mj mk ml b">Fastify Adapter</code>中设置这个选项</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="2875" class="mu ku iy ml b gy mv mw l mx my">// src/main.ts</span><span id="2947" class="mu ku iy ml b gy nh mw l mx my">async function bootstrap() {<br/>  const app = await NestFactory.create&lt;NestFastifyApplication&gt;(<br/>    AppModule,<br/>    new FastifyAdapter({ logger: true }),<br/>  );</span><span id="720b" class="mu ku iy ml b gy nh mw l mx my">await app.listen(3000);<br/>}<br/>bootstrap();</span></pre><p id="3c51" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用此选项，下面是一个示例</p><figure class="mm mn mo mp gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/302a665cd421cd2e8661cb7f15e351a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MvjS1uzBEbr8zRau.png"/></div></div></figure></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="e05d" class="kt ku iy bd kv kw md ky kz la me lc ld le mf lg lh li mg lk ll lm mh lo lp lq bi translated">直到下次</h1><p id="bb9f" class="pw-post-body-paragraph jv jw iy jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">这就是我们将在本文中讨论的所有内容，我们了解了 NestJs，并为我们的项目发展做了初步设置。在本系列的下一篇文章中，我们将使用 Prisma、Docker 和 Postgresql 配置数据库。</p><p id="54db" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您的阅读！</p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><p id="8925" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">遵循存储库来查阅代码</p><p id="4d62" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae nk" href="https://github.com/mnzsss/nest-auth-explained" rel="noopener ugc nofollow" target="_blank">https://github.com/mnzsss/nest-auth-explained</a></p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="ea99" class="kt ku iy bd kv kw md ky kz la me lc ld le mf lg lh li mg lk ll lm mh lo lp lq bi translated">参考</h1><ul class=""><li id="1c94" class="nl nm iy jx b jy lr kc ls kg nn kk no ko np ks nq nr ns nt bi translated"><a class="ae nk" href="https://docs.nestjs.com/" rel="noopener ugc nofollow" target="_blank"> NestJs 文档</a></li><li id="f21a" class="nl nm iy jx b jy nu kc nv kg nw kk nx ko ny ks nq nr ns nt bi translated"><a class="ae nk" href="https://selleo.com/blog/why-choose-nest-js-as-your-backend-framework" rel="noopener ugc nofollow" target="_blank">为什么选择 NestJS 作为你的后端框架？</a></li></ul></div></div>    
</body>
</html>