<html>
<head>
<title>Let’s Build!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们来建吧！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/builder-pattern-fd0fed6002ff?source=collection_archive---------4-----------------------#2021-01-22">https://blog.devgenius.io/builder-pattern-fd0fed6002ff?source=collection_archive---------4-----------------------#2021-01-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/985f89a8efbc6242cded0c16a0473b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wxlg9_ZX_JX4OlnZ84fU6w.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@danist07?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">贝莉儿 DANIST</a> on <a class="ae jz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a09e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设你拥有一个网站，人们可以在那里买卖汽车。不用说，您必须有一个搜索页面，用户可以在其中指定大量的搜索条件。类似下面的页面来自<a class="ae jz" href="https://www.cars.com/for-sale/advanced-search/" rel="noopener ugc nofollow" target="_blank">cars.com</a>:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/45b3d2215ac49301ae223e70cf7a157e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*YW2bijWHL7pPkf9ltS8MaA.png"/></div></figure><p id="35cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你如何对这个需求建模？</p><p id="ac74" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嗯，我想到的第一个想法是创建并填充一个搜索条件实例，并将其传递给一个方法，该方法将根据该条件返回结果。大概是这样的:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="5357" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种方法的一些问题:</p><ol class=""><li id="9e21" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">这里最明显的问题是参数的数量。根据<a class="ae jz" href="https://twitter.com/thebrainlady" rel="noopener ugc nofollow" target="_blank"> Susan Weinschenk 博士</a>的研究，将你提供给人们的信息限制在四条以内几乎是最佳的。任何超过这一点的事情，作为人类，我们都容易忘记，或者至少会对此感到紧张/不舒服。这一点以及她出色的书<a class="ae jz" href="https://www.amazon.com/Things-Designer-People-Voices-Matter/dp/0321767535" rel="noopener ugc nofollow" target="_blank">中的更多内容，每个设计师都需要知道的关于人的 100 件事</a>，我强烈推荐给每个软件开发人员。毕竟，我们——软件开发人员是设计师。</li><li id="aa3e" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lk ll lm ln bi translated">具有长参数列表的方法的另一个问题是，您可能很容易忘记哪个值是什么。在上面的例子中，当你看到第 8 个参数为零时，你可能很容易弄不清楚这个值是什么。是一个最小里程数，一个最低价格，甚至是一个二进制值来指定汽车是否有天窗。<strong class="kc io">如果你作为一名开发人员看着代码感到困惑，这意味着它没有被正确设计</strong>。一个设计良好的产品是不含糊的，因为它是不言自明的或直观的，给人一种愉快的体验，而且非常漂亮。</li><li id="4925" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lk ll lm ln bi translated">如果用户只指定车身样式，并希望列出轿车车身样式的所有汽车，该怎么办？我们该怎么办？我们只需填充第一个参数，并将所有内容设置为默认值，如下所示:</li></ol><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="2baa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我敢肯定，你们大多数人都会同意，这是相当丑陋的。一堆没有附加值，有很多问号的代码。<strong class="kc io">没有附加值的代码不仅无用，而且有害；它需要灭亡</strong>。</p><p id="ac3b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于这种情况，我不打算解释为什么我们不应该创建然后调用一个新的构造函数；我认为这不是一个好主意的原因是显而易见的。</p><p id="1ff8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.最后，但同样重要的是，我将引用罗伯特·c·马丁的必读书籍《干净的代码》中的一句名言:</p><ul class=""><li id="7840" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lt ll lm ln bi translated">函数的理想参数数是零(niladic)。</li><li id="bafd" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated"><em class="lu">接下来是一(一元)，紧接着是二(二元)。</em></li><li id="963c" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated"><em class="lu">在可能的情况下，应该避免三个论点。</em></li><li id="3def" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated">超过三个(多元的)需要非常特殊的理由——而且无论如何都不应该使用。</li></ul><p id="a870" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">尽管一开始他似乎强调了参数的数量，但也许这里更重要的问题是关于软件测试的。如果您曾经编写过任何单元测试，或者对它略有所知，那么您一定知道，随着参数总数的增加，方法中每个新引入的参数都需要您创建越来越多的测试用例。一个方法的变量越多，它的业务逻辑就越复杂。</p></div><div class="ab cl lv lw hr lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ig ih ii ij ik"><p id="d8d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那么，我们如何解决所有这些问题，同时保持一切干净简单呢？嗯，每个决定都有取舍。修改代码会耗费我们宝贵的时间和精力，但从长远来看，这是值得的。无论是就你正在开发的产品还是你的个人职业生涯/进步而言。</p><p id="9b42" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在比较这些:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="2a47" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">后者看起来像是某个<a class="ae jz" href="https://www.goodreads.com/quotes/7630389-clean-code-always-looks-like-it-was-written-by-someone" rel="noopener ugc nofollow" target="_blank">关心</a>的人写的。关心他正在开发的产品。关心他工作的公司。关心队友。关心她/他自己的名誉。最后，他开始关心那些他永远也不会认识的人——在他去世后很久仍在从事代码工作的程序员同事。</p><p id="851e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，我们以流畅的方式一个接一个地链接方法(如果你好奇，可以谷歌“方法链接”、“流畅接口”、“流畅 API”)。我相信你已经知道这种技术是 LINQ 中的<a class="ae jz" href="https://www.geeksforgeeks.org/linq-method-syntax/" rel="noopener ugc nofollow" target="_blank">方法语法。</a></p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="b83e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我可以听到我懒惰的内心声音在抱怨:当我们可以简单地只设置所需的属性时，为什么要费心编写所有额外的代码呢？</p><p id="6eda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好吧，很公平。:)我建议你不要仅仅因为你可能错过一些<a class="ae jz" href="https://www.goodreads.com/quotes/568877-i-choose-a-lazy-person-to-do-a-hard-job" rel="noopener ugc nofollow" target="_blank">捷径</a>而忽视你懒惰的内心声音，它甚至可能<a class="ae jz" href="https://www.telegraph.co.uk/money/consumer-affairs/lazy-procrastinating-could-make-wildly-successful/" rel="noopener ugc nofollow" target="_blank">让你成功</a>。有时候最好的解决方案是最直接的。</p><p id="92c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，我恐怕要告诉你，这次不是。提议的惰性解决方案会带来以下问题:</p><ul class=""><li id="65af" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lt ll lm ln bi translated">我们需要尽可能避免将所有字段都公开为公共可设置属性，而更喜欢具有只读属性的构造函数。</li><li id="9b65" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated"><a class="ae jz" href="https://www.codemag.com/Article/0705061/All-Input-Data-is-Evil-So-Make-Sure-You-Handle-It-Correctly-and-with-Due-Care" rel="noopener ugc nofollow" target="_blank">所有输入数据都是邪恶的</a>，需要验证。如果我们没有任何限制/验证，对象可能会转换到无效状态。举个例子，假设有两个属性，分别是 MinYear 和 MaxYear。当我们将 MinYear 设置为 2019，将 MaxYear 设置为 2018 时，对象会切换到无效状态，使用此搜索条件实例进行搜索变得毫无意义。当然，您可以在实际进行搜索的方法中添加一些验证，但是我坚信对象首先不应该处于错误的状态。</li></ul><p id="2872" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可能已经从构建器模式代码示例中注意到，在末尾有一个 Build()方法。该方法是方法链中的最后一环，是添加一些规则的最佳位置，例如:</p><ul class=""><li id="cda2" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lt ll lm ln bi translated">最小年份不能大于最大年份。</li><li id="5dc5" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated">一对夫妇必须总是正好有两扇门。</li><li id="99dd" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lt ll lm ln bi translated">一辆汽车的汽缸数量必须在 1 到 12 之间。</li></ul><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="bcb5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不想用很长的代码块让你窒息，所以我会留下一个链接，你可以在这里 下载所有的源代码<a class="ae jz" href="https://github.com/anar-khalilov/builder-pattern" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">。</strong></a></p><p id="c353" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总而言之，当我们需要以简单、干净和可持续的方式创建高度可配置的对象时，我们使用构建器模式。</p></div></div>    
</body>
</html>