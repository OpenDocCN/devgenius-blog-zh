<html>
<head>
<title>Install K8s v1.25 on AWS Amazon Linux 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 AWS 亚马逊 Linux 2 上安装 K8s v1.25</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/install-k8s-v1-25-on-amazon-linux-2-e2a717444736?source=collection_archive---------0-----------------------#2022-09-09">https://blog.devgenius.io/install-k8s-v1-25-on-amazon-linux-2-e2a717444736?source=collection_archive---------0-----------------------#2022-09-09</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="8f67" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何在 Amazon Linux 2 实例上安装单节点 K8s v1.25</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj kg"><img src="../Images/eef70117e0fef9e8cb3017c56235a194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*8rVwqNOHN8ZxzUbTojPy1w.png"/></div><figcaption class="ko kp gk gi gj kq kr bd b be z dk translated">图片来自 k8s.io</figcaption></figure><p id="ebe3" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">K8s v1.25.0 于 2022 年 8 月 23 日发布，命名为<code class="fe lo lp lq lr b">Combiner</code>，可以从这里查看发布说明<a class="ae ls" href="https://github.com/kubernetes/sig-release/blob/master/releases/release-1.25/release-notes/release-notes-draft.md" rel="noopener ugc nofollow" target="_blank"> K8s v1.25.0 发布说明</a>。本文向您展示了如何在 Amazon Linux 2 上使用<code class="fe lo lp lq lr b">kubeadm</code>安装这个新版本的 K8s。</p><h1 id="3b17" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">用 kubeadm 创建 K8s 集群</h1><p id="8b29" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">使用<code class="fe lo lp lq lr b">kubeadm</code>，您可以创建一个符合最佳实践的最小可行 K8s 集群。您还可以使用<code class="fe lo lp lq lr b">kubeadm</code>创建一个生产就绪的 K8s 集群。本文仅涵盖单节点控制平面安装。</p><p id="fc8e" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><code class="fe lo lp lq lr b">kubeadm</code>专注于在现有基础设施上引导 K8s 集群，并执行一系列重要的维护任务。<code class="fe lo lp lq lr b">kubeadm</code>接口的核心非常简单:通过运行<code class="fe lo lp lq lr b">kubeadm init</code>创建新的控制平面节点，通过运行<code class="fe lo lp lq lr b">kubeadm join</code>将工作节点加入控制平面。</p><h1 id="c9f8" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">服务器规格</h1><ul class=""><li id="7d89" class="mq mr ir ku b kv ml ky mm lb ms lf mt lj mu ln mv mw mx my bi translated"><strong class="ku is">云平台</strong> : AWS</li><li id="c4d7" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated"><strong class="ku is">实例类型</strong> : m5.large</li><li id="94af" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated"><strong class="ku is">磁盘大小</strong> : 100GB gp3</li></ul><h1 id="1105" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">更新系统包</h1><p id="2922" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">让我们首先更新系统 yum 包:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="4a31" class="ni lu ir lr b gz nj nk l nl nm">$ yum update -y<br/>Loaded plugins: extras_suggestions, langpacks, priorities, update-motd<br/>amzn2-core                                                                                                                                         | 3.7 kB  00:00:00<br/>Resolving Dependencies<br/>--&gt; Running transaction check<br/>---&gt; Package chrony.x86_64 0:4.0-3.amzn2.0.2 will be updated<br/>---&gt; Package chrony.x86_64 0:4.2-5.amzn2.0.2 will be an update<br/>...<br/>Installed:<br/>  kernel.x86_64 0:5.10.135-122.509.amzn2</span><span id="ada4" class="ni lu ir lr b gz nn nk l nl nm">Updated:<br/>  chrony.x86_64 0:4.2-5.amzn2.0.2      dhclient.x86_64 12:4.2.5-79.amzn2.1.1          dhcp-common.x86_64 12:4.2.5-79.amzn2.1.1   dhcp-libs.x86_64 12:4.2.5-79.amzn2.1.1<br/>  gnupg2.x86_64 0:2.0.22-5.amzn2.0.5   kernel-tools.x86_64 0:5.10.135-122.509.amzn2   tzdata.noarch 0:2022c-1.amzn2</span><span id="f649" class="ni lu ir lr b gz nn nk l nl nm">Complete!</span></pre><h1 id="19eb" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">安装 kubeadm、kubelet 和 kubectl</h1><p id="95f8" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">我们将在 EC2 实例上安装这些包:</p><ul class=""><li id="a8ea" class="mq mr ir ku b kv kw ky kz lb no lf np lj nq ln mv mw mx my bi translated"><code class="fe lo lp lq lr b">kubeadm</code>:引导集群的命令。</li><li id="9f2f" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated"><code class="fe lo lp lq lr b">kubelet</code>:在集群中的所有机器上运行的组件，负责启动 pod 和 containers。</li><li id="f976" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated"><code class="fe lo lp lq lr b">kubectl</code>:命令行 util 与您的集群对话。</li></ul><h2 id="fcf5" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装 K8s yum repo</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="2a86" class="ni lu ir lr b gz nj nk l nl nm"># cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo<br/>[kubernetes]<br/>name=Kubernetes<br/>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch<br/>enabled=1<br/>gpgcheck=1<br/>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg<br/>exclude=kubelet kubeadm kubectl<br/>EOF</span><span id="7d40" class="ni lu ir lr b gz nn nk l nl nm">[kubernetes]<br/>name=Kubernetes<br/>baseurl=<a class="ae ls" href="https://packages.cloud.google.com/yum/repos/kubernetes-el7-$basearch" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/repos/kubernetes-el7-$basearch</a><br/>enabled=1<br/>gpgcheck=1<br/>gpgkey=<a class="ae ls" href="https://packages.cloud.google.com/yum/doc/yum-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/yum-key.gpg</a> <a class="ae ls" href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</a><br/>exclude=kubelet kubeadm kubectl</span></pre><h2 id="98f1" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">禁用 SELinux</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="b9ce" class="ni lu ir lr b gz nj nk l nl nm"># <!-- -->setenforce 0<br/>setenforce: SELinux is disabled<br/># sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config</span></pre><h2 id="ef9f" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装 kubeadm、kubelet 和 kubectl</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="6a96" class="ni lu ir lr b gz nj nk l nl nm"># yum install -y kubelet-1.25.0-0 kubeadm-1.25.0-0 kubectl-1.25.0-0 --disableexcludes=kubernetes<br/>...<br/>Installed:<br/>  kubeadm.x86_64 0:1.25.0-0                               kubectl.x86_64 0:1.25.0-0                               kubelet.x86_64 0:1.25.0-0</span><span id="9525" class="ni lu ir lr b gz nn nk l nl nm">Complete!</span><span id="8d94" class="ni lu ir lr b gz nn nk l nl nm"># systemctl enable --now kubelet<br/>Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span></pre><h1 id="1af6" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">安装容器运行时</h1><p id="3fc4" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">您需要在集群中的每个节点上安装一个<a class="ae ls" href="https://kubernetes.io/docs/setup/production-environment/container-runtimes" rel="noopener ugc nofollow" target="_blank">容器运行时</a>，以便 Pods 可以在那里运行。</p><p id="da95" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><code class="fe lo lp lq lr b">K8s v1.25.0</code>要求您使用符合<a class="ae ls" href="https://kubernetes.io/docs/concepts/overview/components/#container-runtime" rel="noopener ugc nofollow" target="_blank">容器运行时接口</a> (CRI)的运行时。我们将使用<code class="fe lo lp lq lr b">containerd</code>作为 CRI。</p><h2 id="3630" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">转发 IPv4 并让 iptables 看到桥接的流量</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="a265" class="ni lu ir lr b gz nj nk l nl nm"># cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf<br/>overlay<br/>br_netfilter<br/>EOF</span><span id="a58d" class="ni lu ir lr b gz nn nk l nl nm"># modprobe overlay<br/># modprobe br_netfilter<br/># lsmod | egrep  "overlay|netfilter"<br/>br_netfilter           32768  0<br/>bridge                258048  1 br_netfilter<br/>overlay               151552  0</span></pre><h2 id="751d" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">设置所需的系统参数</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="d864" class="ni lu ir lr b gz nj nk l nl nm"># cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf<br/>net.bridge.bridge-nf-call-iptables  = 1<br/>net.bridge.bridge-nf-call-ip6tables = 1<br/>net.ipv4.ip_forward                 = 1<br/>EOF</span><span id="8b34" class="ni lu ir lr b gz nn nk l nl nm"># sysctl --system<br/>...<br/>* Applying /etc/sysctl.conf ...</span></pre><h2 id="68cf" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装容器 d</h2><p id="3781" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">从<a class="ae ls" href="https://github.com/containerd/containerd/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/containerd/containerd/releases</a>下载<code class="fe lo lp lq lr b">containerd-&lt;VERSION&gt;-&lt;OS&gt;-&lt;ARCH&gt;.tar.gz</code>档案，验证其 sha256sum，解压到<code class="fe lo lp lq lr b">/usr/local</code>下:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="ef01" class="ni lu ir lr b gz nj nk l nl nm"># tar Cxzvf /usr/local containerd-1.6.8-linux-amd64.tar.gz<br/>bin/<br/>bin/containerd-shim-runc-v2<br/>bin/containerd-shim<br/>bin/ctr<br/>bin/containerd-shim-runc-v1<br/>bin/containerd<br/>bin/containerd-stress</span></pre><h2 id="cb83" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装 containerd 系统服务</h2><p id="ad50" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">将<code class="fe lo lp lq lr b">containerd.service</code>单元文件从<a class="ae ls" href="https://github.com/containerd/containerd/blob/main/containerd.service" rel="noopener ugc nofollow" target="_blank">https://github . com/container d/container d/blob/main/container d . service</a>下载到<code class="fe lo lp lq lr b">/usr/lib/systemd/system/containerd.service</code>中，运行以下命令:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="a7ad" class="ni lu ir lr b gz nj nk l nl nm"># cp containerd.service /usr/lib/systemd/system/<br/># systemctl daemon-reload<br/># systemctl enable --now containerd<br/>Created symlink from /etc/systemd/system/multi-user.target.wants/containerd.service to /usr/lib/systemd/system/containerd.service.</span></pre><h2 id="d260" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装 runc</h2><p id="9d18" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">从<a class="ae ls" href="https://github.com/opencontainers/runc/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/opencontainers/runc/releases</a>下载<code class="fe lo lp lq lr b">runc.&lt;ARCH&gt;</code>二进制文件，验证其 sha256sum，安装为<code class="fe lo lp lq lr b">/usr/local/sbin/runc</code>。</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="c426" class="ni lu ir lr b gz nj nk l nl nm"># install -m 755 runc.amd64 /usr/local/sbin/runc</span></pre><h2 id="0991" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装 CNI 插件</h2><p id="78ac" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">从<a class="ae ls" href="https://github.com/containernetworking/plugins/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/containernetworking/plugins/releases</a>下载<code class="fe lo lp lq lr b">cni-plugins-&lt;OS&gt;-&lt;ARCH&gt;-&lt;VERSION&gt;.tgz</code>档案，验证其 sha256sum，解压到<code class="fe lo lp lq lr b">/opt/cni/bin</code>下:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="d959" class="ni lu ir lr b gz nj nk l nl nm"># mkdir -p /opt/cni/bin<br/># tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz<br/>./<br/>./macvlan<br/>./static<br/>./vlan<br/>./portmap<br/>./host-local<br/>./vrf<br/>./bridge<br/>./tuning<br/>./firewall<br/>./host-device<br/>./sbr<br/>./loopback<br/>./dhcp<br/>./ptp<br/>./ipvlan<br/>./bandwidth</span></pre><h1 id="fc9e" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">安装 K8s v.1.25.0</h1><h2 id="187e" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">下拉所需图像</h2><p id="e894" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">下载图像</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="60a4" class="ni lu ir lr b gz nj nk l nl nm"># kubeadm config images pull --v=5<br/>...<br/>[config/images] Pulled registry.k8s.io/kube-apiserver:v1.25.0<br/>[config/images] Pulled registry.k8s.io/kube-controller-manager:v1.25.0<br/>[config/images] Pulled registry.k8s.io/kube-scheduler:v1.25.0<br/>[config/images] Pulled registry.k8s.io/kube-proxy:v1.25.0<br/>[config/images] Pulled registry.k8s.io/pause:3.8<br/>[config/images] Pulled registry.k8s.io/etcd:3.5.4-0<br/>[config/images] Pulled registry.k8s.io/coredns/coredns:v1.9.3</span></pre><h2 id="f674" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">初始化控制平面</h2><p id="75eb" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">控制平面节点是控制平面组件运行的机器，包括<a class="ae ls" href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/" rel="noopener ugc nofollow" target="_blank"> etcd </a>(集群数据库)和<a class="ae ls" href="https://kubernetes.io/docs/concepts/overview/components/#kube-apiserver" rel="noopener ugc nofollow" target="_blank"> API 服务器</a>(与<a class="ae ls" href="https://kubernetes.io/docs/user-guide/kubectl-overview/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>命令行工具通信)。</p><p id="55bf" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">要初始化控制平面节点，请运行:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="fa81" class="ni lu ir lr b gz nj nk l nl nm"># kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=172.31.83.51 --node-name "ip-172-31-83-51.ec2.internal" --v=9<br/>...<br/>Your Kubernetes control-plane has initialized successfully!</span><span id="3e6a" class="ni lu ir lr b gz nn nk l nl nm">To start using your cluster, you need to run the following as a regular user:</span><span id="1815" class="ni lu ir lr b gz nn nk l nl nm">mkdir -p $HOME/.kube<br/>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><span id="e4cb" class="ni lu ir lr b gz nn nk l nl nm">Alternatively, if you are the root user, you can run:</span><span id="95d3" class="ni lu ir lr b gz nn nk l nl nm">export KUBECONFIG=/etc/kubernetes/admin.conf</span><span id="6c5d" class="ni lu ir lr b gz nn nk l nl nm">You should now deploy a pod network to the cluster.<br/>Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:<br/>  <a class="ae ls" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></span><span id="8b44" class="ni lu ir lr b gz nn nk l nl nm">Then you can join any number of worker nodes by running the following on each as root:</span><span id="9320" class="ni lu ir lr b gz nn nk l nl nm">kubeadm join 172.31.83.51:6443 --token xxxx \<br/> --discovery-token-ca-cert-hash sha256:1bf0cf842e56f84bdb1156a2635910bda519d20203fcbc2f99127abbf2bd626c</span></pre><p id="397e" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">注意<code class="fe lo lp lq lr b">--apiserver-advertise-address</code>是私有 ip。</p><h2 id="f84b" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">检查舱运行正常</h2><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="29a7" class="ni lu ir lr b gz nj nk l nl nm"># mkdir -p $HOME/.kube<br/># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/># chown $(id -u):$(id -g) $HOME/.kube/config<br/># kubectl get po -A</span></pre><p id="45b5" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">输出应该类似于:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gi gj oc"><img src="../Images/7610aba485478fc4eef45caaee1dd3f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnFIVmUcmLOjd3UafCVksA.png"/></div></div></figure><p id="de67" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">不要担心<code class="fe lo lp lq lr b">coredns</code>吊舱，它需要安装网络插件。</p><h2 id="25da" class="ni lu ir bd lv nr ns dn lz nt nu dp md lb nv nw mf lf nx ny mh lj nz oa mj ob bi translated">安装网络插件</h2><p id="dde7" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">我们将使用 Calico 作为我们的 K8s 集群网络插件。下载<code class="fe lo lp lq lr b">tigera-operator.yaml</code>和<code class="fe lo lp lq lr b">custom-resources.yaml</code>文件</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="b79d" class="ni lu ir lr b gz nj nk l nl nm"># curl <a class="ae ls" href="https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/tigera-operator.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/tigera-operator.yaml</a> -O<br/>$ curl <a class="ae ls" href="https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/custom-resources.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/custom-resources.yaml</a> -O</span></pre><p id="4768" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">更新<code class="fe lo lp lq lr b">custom-resources.yaml</code> CIDR 配置，使用<code class="fe lo lp lq lr b">--pod-network-cidr=10.244.0.0/16</code>代替默认的<code class="fe lo lp lq lr b">192.168.0.0/16</code></p><p id="f2d8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">安装 tigera 操作员</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="3ead" class="ni lu ir lr b gz nj nk l nl nm"># kubectl create -f tigera-operator.yaml<br/>namespace/tigera-operator created<br/>...<br/>customresourcedefinition.apiextensions.k8s.io/tigerastatuses.operator.tigera.io created<br/>serviceaccount/tigera-operator created<br/>clusterrole.rbac.authorization.k8s.io/tigera-operator created<br/>clusterrolebinding.rbac.authorization.k8s.io/tigera-operator created<br/>deployment.apps/tigera-operator created</span><span id="e63b" class="ni lu ir lr b gz nn nk l nl nm"># kubectl get po -n tigera-operator<br/>NAME                               READY   STATUS    RESTARTS   AGE<br/>tigera-operator-6675dc47f4-fflhn   1/1     Running   0          44s</span></pre><p id="50b7" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">安装 calico 自定义资源</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="31b0" class="ni lu ir lr b gz nj nk l nl nm"># kubectl create -f custom-resources.yaml<br/>installation.operator.tigera.io/default created<br/>apiserver.operator.tigera.io/default created</span></pre><p id="be35" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">观看 pod 创建过程:</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="c339" class="ni lu ir lr b gz nj nk l nl nm"># watch kubectl get po -A</span></pre><p id="f25b" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">直到所有吊舱准备就绪:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gi gj oh"><img src="../Images/90ef14df6c242b106c77ffa78f645947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTP6UcIB3nqHAT6lAK5FkA.png"/></div></div></figure><p id="c8d7" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">恭喜你！您已经成功构建了您的 K8s v1.25 集群！</p><pre class="kh ki kj kk gu ne lr nf ng aw nh bi"><span id="5d1e" class="ni lu ir lr b gz nj nk l nl nm"># kubectl version --short<br/>Client Version: v1.25.0<br/>Kustomize Version: v4.5.7<br/>Server Version: v1.25.0</span><span id="dab1" class="ni lu ir lr b gz nn nk l nl nm"># kubectl get node<br/>NAME                           STATUS   ROLES           AGE   VERSION<br/>ip-172-31-83-51.ec2.internal   Ready    control-plane   11m   v1.25.0</span></pre><h1 id="d9bf" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">参考</h1><ul class=""><li id="7dae" class="mq mr ir ku b kv ml ky mm lb ms lf mt lj mu ln mv mw mx my bi translated">containrd:<a class="ae ls" href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md" rel="noopener ugc nofollow" target="_blank">https://github . com/containerd/containerd/blob/main/docs/getting-started . MD</a></li><li id="2374" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated">kube ADM:<a class="ae ls" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/setup/production-environment/tools/kube ADM/create-cluster-kube ADM/</a></li><li id="0e64" class="mq mr ir ku b kv mz ky na lb nb lf nc lj nd ln mv mw mx my bi translated">https://projectcalico.docs.tigera.io/about/about-calico</li></ul></div></div>    
</body>
</html>