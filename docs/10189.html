<html>
<head>
<title>PHP — P73: Errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P73:错误</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p73-errors-7c8abc9c6a13?source=collection_archive---------11-----------------------#2022-10-13">https://blog.devgenius.io/php-p73-errors-7c8abc9c6a13?source=collection_archive---------11-----------------------#2022-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/daed65ca87767c55c578955ecb3e0d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UbBZqpKgwl6tVKvDnTCxw.jpeg"/></div></div></figure><p id="340d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在过去的 72 篇文章中，我们生活在乐观的一面。我们从来没有停下来想过可能会发生错误。我们是程序员，我们非常擅长我们的工作。为什么我们会认为我们应该担心错误处理呢？哦，使用我们应用程序的用户。谁在乎呢。他们应该知道如何在提示时输入有效数据。当我们说他们应该输入他们的年龄时，显然我们的意思是这应该是一个数字(整数)而不是一个字符串。如果他们不知道如何遵循指示，那是他们的责任。你说他们可能会破坏数据库？好吧，这才是问题所在。</p><p id="f32c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管大声说出来很可怕，但是把你的应用程序的每个用户都当成一个绝对的白痴。不要当着他们的面说，而是在幕后想一想。我不会责怪你，即使你笑了，因为你允许自己在脑海中尖叫“白痴”。你不会离真相太远的。人们会有意或无意地找到破坏你的应用程序的方法。全靠你全力守护。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p72-errors-intro-83e7b58700d5"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P72:错误介绍</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">在我们开始研究如何处理 PHP 中的错误之前，我想先谈一些初级程序员…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="194a" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">认真对待错误</h1><p id="63d5" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">从 PHP 7 开始，通过抛出<code class="fe mr ms mt mu b">Error</code>异常来报告错误。我们可能会遇到哪些类型的错误？</p><ul class=""><li id="ed1e" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">ArithmeticError</code>是数学运算失败时抛出的错误。</li><li id="a717" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">DivisionByZeroError</code>是一种当你试图被零除时出现的<code class="fe mr ms mt mu b">ArithmeticError</code>。</li><li id="c6eb" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">AssertionError</code>断言失败时抛出。</li><li id="9d99" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">CompileError</code>因编译错误而抛出。</li><li id="4158" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">ParseError</code>是一种在解析 PHP 代码时出现的<code class="fe mr ms mt mu b">CompileError</code>。例如，在使用<code class="fe mr ms mt mu b">eval()</code>函数时，您会看到这个错误。</li><li id="72a3" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">TypeError</code>在某些情况下，当数据类型不正确时会发生，例如类属性不匹配，参数类型与声明的参数类型不匹配，或者返回类型与声明不同。</li><li id="fc3b" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">ArgumentCountError</code>是<code class="fe mr ms mt mu b">TypeError</code>的一种。当一个方法有一组预定义的参数，但传递给它的实参太少时，就会发生这种情况。</li><li id="4779" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">ValueError</code>是一个棘手的问题。当数据类型正确，但预期值不正确时，就会出现这种情况。例如，期望正整数，但收到负整数。</li><li id="07d3" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">UnhandledMatchError</code>当匹配表达式没有手臂时发生。</li><li id="c948" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">对<code class="fe mr ms mt mu b">Fiber</code>函数的无效操作会引发<code class="fe mr ms mt mu b">FiberError</code>。</li></ul><h1 id="6662" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">没有捕捉到错误</h1><p id="67d7" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们可以在 PHP 中快速创建一个错误进行测试，看看会发生什么。创建一个新的 php 文件并编写:<code class="fe mr ms mt mu b">echo 10/0;</code></p><p id="5923" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你会得到一个错误。</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="b90a" class="nr lp iq mu b gy ns nt l nu nv">Fatal error: Uncaught DivisionByZeroError: Division by zero in /home/user/scripts/code.php:3</span><span id="caaa" class="nr lp iq mu b gy nw nt l nu nv">Stack trace:<br/>#0 {main}<br/>  thrown in /home/user/scripts/code.php on line 3</span></pre><p id="f079" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们之前看到的<code class="fe mr ms mt mu b">DivisionByZero</code>错误。有趣的是，上面写着<code class="fe mr ms mt mu b">Uncaught</code>。我们没有<code class="fe mr ms mt mu b">catch</code>它。但是我们如何捕捉错误呢？用<code class="fe mr ms mt mu b">try/catch</code>块。</p><h1 id="5e7e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">尝试/抓住</h1><p id="2238" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">try/catch 块代表了一种测试方法，如果它不起作用，就在错误显示在屏幕上之前捕捉它，并向用户提供负 UX。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="cf1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的<code class="fe mr ms mt mu b">try</code>块中我们可以尝试什么？我们可以尝试执行我们的<code class="fe mr ms mt mu b">echo 10/0;</code>语句。将它放入你的<code class="fe mr ms mt mu b">try { }</code>身体。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f4ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们知道，在这种情况下，将抛出的错误是<code class="fe mr ms mt mu b">DivisionByZero</code>错误。我们看到，我们之前尝试了代码，PHP 返回了一个<code class="fe mr ms mt mu b">Uncaught</code>错误。一个<code class="fe mr ms mt mu b">DivisionByZero</code>只是一个数据类型。它是由 PHP 开发人员创建的一种数据类型。把它想象成一个<code class="fe mr ms mt mu b">string</code>或<code class="fe mr ms mt mu b">int</code>数据类型。如果你读过我以前的文章，你会记得你可以声明参数的数据类型。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p48-type-declarations-47114a7a0e0b"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P48:类型声明</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果您来自 PHP 的旧时代，您可能已经被 PHP 自动为您声明类型所宠坏了…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="nz l lk ll lm li ln jw kz"/></div></div></a></div><p id="ec5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们抓住我们的<code class="fe mr ms mt mu b">DivisionByZero</code>错误。我们将在我们的<code class="fe mr ms mt mu b">catch()</code>语句中捕获它。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d3ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行代码。应该会出现一个空白屏幕。我们发现了错误，并阻止它出现在屏幕上！它现在存储在我们的<code class="fe mr ms mt mu b">$error</code>变量中。我们可以优雅地处理它，就像发送一封电子邮件，声明发生了一个错误，或者将其记录到我们的日志文件中。我们也可以重复一些更加用户友好的东西。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="c098" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次运行代码，您将看到屏幕上显示消息<code class="fe mr ms mt mu b">Dear idiot user. You cannot divide by zero</code>。</p><p id="da1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看$error 对象包含什么，只需使用<code class="fe mr ms mt mu b">var_dump</code>并将其转储到屏幕上。</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="9fed" class="nr lp iq mu b gy ns nt l nu nv">/app/72 Errors/72 Errors Intro.php:10:<br/><strong class="mu ir">object</strong>(<em class="oa">DivisionByZeroError</em>)[<em class="oa">1</em>]<br/>  <em class="oa">protected</em> 'message' =&gt; string 'Division by zero' <em class="oa">(length=16)</em><br/>  <em class="oa">private</em> 'string' (Error) =&gt; string '' <em class="oa">(length=0)</em><br/>  <em class="oa">protected</em> 'code' =&gt; int 0<br/>  <em class="oa">protected</em> 'file' =&gt; string '/app/72 Errors/72 Errors Intro.php' <em class="oa">(length=34)</em><br/>  <em class="oa">protected</em> 'line' =&gt; int 5<br/>  <em class="oa">private</em> <em class="oa">array</em> 'trace' (Error) =&gt; <br/>    <strong class="mu ir">array</strong> <em class="oa">(size=0)</em><br/>      <em class="oa">empty</em><br/>  <em class="oa">private</em> <em class="oa">?Throwable</em> 'previous' (Error) =&gt; null<br/>  <em class="oa">public</em> 'xdebug_message' =&gt; string '&lt;tr&gt;&lt;th align='left' bgcolor='#f57900' colspan="5"&gt;&lt;span style='background-color: #cc0000; color: #fce94f; font-size: x-large;'&gt;( ! )&lt;/span&gt; DivisionByZeroError: Division by zero in /app/72 Errors/72 Errors Intro.php on line &lt;i&gt;5&lt;/i&gt;&lt;/th&gt;&lt;/tr&gt;<br/>&lt;tr&gt;&lt;th align='left' bgcolor='#e9b96e' colspan='5'&gt;Call Stack&lt;/th&gt;&lt;/tr&gt;<br/>&lt;tr&gt;&lt;th align='center' bgcolor='#eeeeec'&gt;#&lt;/th&gt;&lt;th align='left' bgcolor='#eeeeec'&gt;Time&lt;/th&gt;&lt;th align='left' bgcolor='#eeeeec'&gt;Memory&lt;/th&gt;&lt;th align='left' bgcolor='#eeeeec'&gt;Function&lt;/th&gt;&lt;th align=''... <em class="oa">(length=842)</em></span></pre><h1 id="625c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为什么要测试这种东西？</h1><p id="5d3e" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们为什么要测试这种东西？我们知道<code class="fe mr ms mt mu b">10 / 0</code>总会把<code class="fe mr ms mt mu b">DivisionByZeroError</code>扔出去，所以何必呢？用户输入。我们可以从用户那里得到输入，取而代之的是这样的内容:</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="7c8a" class="nr lp iq mu b gy ns nt l nu nv">echo 10 / $_POST['user_number'];</span></pre><p id="a2b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，用户可以在表单中键入他们想要的任何内容，当他们单击 submit 时，信息就会被发送过来进行处理。如果他们输入 0，错误将被捕获。</p><h1 id="07b8" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">链接 Catch 语句</h1><p id="b6e0" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">如果他们输入的不是数字，那该怎么办？如果用户输入一个字母呢？我们得到了一种新的错误。</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="2f3c" class="nr lp iq mu b gy ns nt l nu nv">Fatal error: Uncaught TypeError: Unsupported operand types: int / string in /home/user/scripts/code.php:3</span><span id="de56" class="nr lp iq mu b gy nw nt l nu nv">Stack trace:<br/>#0 {main}<br/>  thrown in /home/user/scripts/code.php on line 3</span></pre><p id="1628" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">收到的错误是一个<code class="fe mr ms mt mu b">TypeError</code>。我们如何抓住它？我们已经赶上了我们的<code class="fe mr ms mt mu b">DivisionByZeroError</code>。我们在哪里放置<code class="fe mr ms mt mu b">TypeError</code>的捕获物。你会紧紧抓住它。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h1 id="fef0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">一个更普通的捕捉</h1><p id="15df" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">还会出现其他错误吗？当然了。如果我们想确保我们所有的错误都被处理，在 try/catch/catch/…/catch 语句的末尾，我们需要添加一个更通用的 catch 语句来捕获任何可能被遗漏的内容。就像您可以用<code class="fe mr ms mt mu b">DivisionByZeroError</code>和<code class="fe mr ms mt mu b">ArithmeticError</code>处理程序捕捉被零除的错误一样(因为 division by zero error 是算术错误类型)，您也可以用错误处理程序捕捉任何错误。我们上面看到的所有东西，比如<code class="fe mr ms mt mu b">TypeError</code>，都是<code class="fe mr ms mt mu b">Error</code>类型的。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h1 id="d204" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">最终声明</h1><p id="fe38" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">如果您想每次都执行一段代码，而不管是否捕捉到错误，该怎么办？您可以使用<code class="fe mr ms mt mu b">finally</code>语句来实现。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3cf7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您运行上面的代码，您将得到:</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="fad6" class="nr lp iq mu b gy ns nt l nu nv">Dear idiot user. You cannot divide by zero<br/>Dear idiot user. This code always executes.</span></pre><h1 id="2cc0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">结论</h1><p id="882d" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我认为，在这篇文章中，我们陷入了我所希望的最深的错误之中。他们很直接。我见过开发人员纠结于尝试/捕捉概念。就把它想象成一个 if/else 语句，其中 if = try，else = catch。如果有多个条件，就开始引入 if/elseif/else 语句。类似于 try/catch/catch 的概念。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="ob ny l"/></div></figure><div class="kw kx gp gr ky kz"><a href="https://github.com/dinocajic/php-youtube-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-dinocajic/PHP-YouTube-tutorials:PHP YouTube 教程的代码</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">PHP YouTube 教程的代码确保你已经安装了 Docker。克隆回购。运行以下命令…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="oc l lk ll lm li ln jw kz"/></div></div></a></div></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6b4f6c11928bbc970ba326e49ee4975b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wxjUbSud7cSlCh9L.jpeg"/></div></figure><p id="302d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡伊奇目前是<a class="ae ol" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(生命周期生物科学公司)</a>、<a class="ae ol" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae ol" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae ol" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物</a>、<a class="ae ol" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae ol" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="0fc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae ol" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae ol" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae ol" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="61d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ol" href="https://dinocajic.medium.com/membership" rel="noopener"> <em class="oa">阅读迪诺·卡吉克(以及媒体上成千上万其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。</em> </a></p></div></div>    
</body>
</html>