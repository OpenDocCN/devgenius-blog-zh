<html>
<head>
<title>Testing Vue 3 Apps — Form Triggered Events and Set Values of Form Elements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试 Vue 3 应用程序—表单触发的事件和设置表单元素的值</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/testing-vue-3-apps-form-triggered-events-and-set-values-of-form-elements-fb7f90bccaa2?source=collection_archive---------3-----------------------#2021-01-31">https://blog.devgenius.io/testing-vue-3-apps-form-triggered-events-and-set-values-of-form-elements-fb7f90bccaa2?source=collection_archive---------3-----------------------#2021-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6d29289f6e99a7adf2a37f3dd6b9d4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bpf1utfcR6ANol5T"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@battlecreekcoffeeroasters?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Battlecreek 咖啡烘焙师</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d168" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着应用程序变得越来越复杂，自动测试它们变得非常重要。我们可以通过单元测试做到这一点，然后我们就不必手动测试所有的东西了。</p><p id="ca81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过编写一个简单的应用程序并测试它来看看如何测试 Vue 3 应用程序。</p><h1 id="a1f3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试表单触发的事件</h1><p id="be68" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以测试提交表单时触发的事件。</p><p id="5575" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fb51" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="500a" class="mn lc iq mj b gy ms mp l mq mr">const EmailInput = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;input type="email" v-model="email"&gt;<br/>      &lt;button @click="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      email: ''<br/>    }<br/>  },<br/>  methods: {<br/>    submit() {<br/>      this.$emit('submit', this.email)<br/>    }<br/>  }<br/>}</span><span id="5f98" class="mn lc iq mj b gy ms mp l mq mr">test('sets the value', async () =&gt; {<br/>  const wrapper = mount(EmailInput)<br/>  const input = wrapper.find('input')<br/>  await input.setValue('abc@mail.com')<br/>  expect(input.element.value).toBe('abc@mail.com')<br/>})</span><span id="99b2" class="mn lc iq mj b gy ms mp l mq mr">test('submit event is triggered', async () =&gt; {<br/>  const wrapper = mount(EmailInput)<br/>  await wrapper.find('button').trigger('click')<br/>  expect(wrapper.emitted()).toHaveProperty('submit')<br/>})</span></pre><p id="9684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二个测试中，我们得到按钮并触发<code class="fe mt mu mv mj b">click</code>事件。</p><p id="4409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查是否用<code class="fe mt mu mv mj b">wrapper.emitted</code>方法发出了<code class="fe mt mu mv mj b">submit</code>事件。</p><p id="e6f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用发出事件的参数来检查事件触发了什么。</p><p id="e450" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0d1b" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="e1bb" class="mn lc iq mj b gy ms mp l mq mr">const EmailInput = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;input type="email" v-model="email"&gt;<br/>      &lt;button @click="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      email: ''<br/>    }<br/>  },<br/>  methods: {<br/>    submit() {<br/>      this.$emit('submit', this.email)<br/>    }<br/>  }<br/>}</span><span id="1671" class="mn lc iq mj b gy ms mp l mq mr">test('emits the input to its parent', async () =&gt; {<br/>  const wrapper = mount(EmailInput)<br/>  await wrapper.find('input').setValue('abc@mail.com')<br/>  await wrapper.find('button').trigger('click')<br/>  expect(wrapper.emitted('submit')[0][0]).toBe('abc@mail.com')<br/>})</span></pre><p id="2b47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们登上<code class="fe mt mu mv mj b">EmailInput</code>。</p><p id="5c54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在输入上调用<code class="fe mt mu mv mj b">setValue</code>来设置它的值。</p><p id="3519" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们触发按钮上的<code class="fe mt mu mv mj b">click</code>事件。</p><p id="612f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查是否用输入值发出了<code class="fe mt mu mv mj b">submit</code>事件。</p><h1 id="794c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用各种表单元素</h1><p id="622d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在测试中操作其他表单元素。</p><p id="253e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a75f" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="5ba8" class="mn lc iq mj b gy ms mp l mq mr">const FormComponent = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;form @submit.prevent="submit"&gt;<br/>        &lt;input type="email" v-model="form.email"&gt;<br/>        &lt;textarea v-model="form.description"/&gt;</span><span id="3a9d" class="mn lc iq mj b gy ms mp l mq mr">        &lt;select v-model="form.city"&gt;<br/>          &lt;option value="new-york"&gt;New York&lt;/option&gt;<br/>          &lt;option value="toronto"&gt;Toronto&lt;/option&gt;<br/>        &lt;/select&gt;</span><span id="7a5b" class="mn lc iq mj b gy ms mp l mq mr">        &lt;input type="checkbox" v-model="form.subscribe"/&gt;<br/>        &lt;input type="radio" value="weekly" v-model="form.interval"/&gt;<br/>        &lt;input type="radio" value="monthly" v-model="form.interval"/&gt;</span><span id="7da5" class="mn lc iq mj b gy ms mp l mq mr">         &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      form: {<br/>        email: '',<br/>        description: '',<br/>        city: '',<br/>        subscribe: false,<br/>        interval: ''<br/>      }<br/>    }<br/>  },<br/>  methods: {<br/>    async submit() {<br/>      this.$emit('submit', this.form)<br/>    }<br/>  }<br/>}</span><span id="1bc9" class="mn lc iq mj b gy ms mp l mq mr">test('submits a form', async () =&gt; {<br/>  const wrapper = mount(FormComponent)<br/>  await wrapper.find('input[type=email]').setValue('name@mail.com')<br/>  await wrapper.find('textarea').setValue('Lorem ipsum')<br/>  await wrapper.find('select').setValue('toronto')<br/>  await wrapper.find('input[type=checkbox]').setValue()<br/>  await wrapper.find('input[type=radio][value=monthly]').setValue()<br/>})</span></pre><p id="8113" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过<code class="fe mt mu mv mj b">textarea</code>、<code class="fe mt mu mv mj b">selecrt</code>、复选框和单选按钮来使用<code class="fe mt mu mv mj b">setValue</code>方法。</p><p id="6ef6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以触发复杂的事件。</p><p id="cd01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bbce" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="b89d" class="mn lc iq mj b gy ms mp l mq mr">const FormComponent = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;form @submit.prevent="submit"&gt;<br/>        &lt;input type="email" v-model="form.email"&gt;<br/>        &lt;textarea v-model="form.description"/&gt;</span><span id="bc70" class="mn lc iq mj b gy ms mp l mq mr">        &lt;select v-model="form.city"&gt;<br/>          &lt;option value="new-york"&gt;New York&lt;/option&gt;<br/>          &lt;option value="toronto"&gt;Toronto&lt;/option&gt;<br/>        &lt;/select&gt;</span><span id="f71b" class="mn lc iq mj b gy ms mp l mq mr">        &lt;input type="checkbox" v-model="form.subscribe"/&gt;<br/>        &lt;input type="radio" value="weekly" v-model="form.interval"/&gt;<br/>        &lt;input type="radio" value="monthly" v-model="form.interval"/&gt;</span><span id="a062" class="mn lc iq mj b gy ms mp l mq mr">        &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      form: {<br/>        email: '',<br/>        description: '',<br/>        city: '',<br/>        subscribe: false,<br/>        interval: ''<br/>      }<br/>    }<br/>  },<br/>  methods: {<br/>    async submit() {<br/>      this.$emit('submit', this.form)<br/>    }<br/>  }<br/>}</span><span id="a745" class="mn lc iq mj b gy ms mp l mq mr">test('submits a form', async () =&gt; {<br/>  const wrapper = mount(FormComponent)<br/>  const email = 'name@mail.com'<br/>  const description = 'Lorem ipsum'<br/>  const city = 'toronto'<br/>  await wrapper.find('input[type=email]').setValue(email)<br/>  await wrapper.find('textarea').setValue(description)<br/>  await wrapper.find('select').setValue(city)<br/>  await wrapper.find('input[type=checkbox]').setValue()<br/>  await wrapper.find('input[type=radio][value=monthly]').setValue()<br/>  await wrapper.find('form').trigger('submit.prevent')<br/>  expect(wrapper.emitted('submit')[0][0]).toMatchObject({<br/>    email,<br/>    description,<br/>    city,<br/>    subscribe: true,<br/>    interval: 'monthly',<br/>  })<br/>})</span></pre><p id="9ce5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有相同的成分。</p><p id="c9f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在测试中，我们挂载组件并调用<code class="fe mt mu mv mj b">setValue</code>来设置每个字段的值。</p><p id="32a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查用<code class="fe mt mu mv mj b">submit</code>事件发出的对象是否与用<code class="fe mt mu mv mj b">toMatchObject</code>方法预期的对象匹配。</p><p id="db30" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们测试了<code class="fe mt mu mv mj b">submit</code>方法中的<code class="fe mt mu mv mj b">this.form</code>对象是否与最后一行中的匹配。</p><h1 id="2059" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="700a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以测试表单触发的事件，并用 Vue 测试工具在我们的 Vue 3 组件测试中设置各种表单元素的值。</p></div></div>    
</body>
</html>