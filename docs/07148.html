<html>
<head>
<title>Disaster Recovery on Azure Cloud — Building Blocks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 云上的灾难恢复—构造块</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/disaster-recovery-on-azure-cloud-building-blocks-6ff826adbc8b?source=collection_archive---------12-----------------------#2022-03-01">https://blog.devgenius.io/disaster-recovery-on-azure-cloud-building-blocks-6ff826adbc8b?source=collection_archive---------12-----------------------#2022-03-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="e5d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博客是我们从零开始讨论<strong class="jm io">云</strong>概念的系列文章的一部分，面向的是入门知识有限的读者。本文属于<em class="ki">中级</em>系列，因为它涉及在 Azure Cloud 上构建<strong class="jm io">高可用性和灾难恢复</strong>构建块。</p><p id="3ef5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">云系列中的一些早期博客如下。</p><p id="0f92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/disaster-recovery-on-aws-cloud-building-blocks-e013bffd6244"><strong class="jm io">AWS 云上的灾难恢复</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/navigating-azure-storage-authentication-options-using-a-java-client-d8ab31e12308"><strong class="jm io">Azure 存储认证</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/azure-cosmos-db-rbac-authentication-using-a-java-client-720b20c637fe"><strong class="jm io">Azure 宇宙 RBAC 认证</strong> </a></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/e7c9470665a4ccdd6ae3c81b908bbb6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_MSpn3YaWlpABeZkApLyQ.png"/></div></div></figure><h1 id="2ba6" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">高可用性和灾难恢复</h1><p id="9ba6" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">构建具有正确正常运行时间 SLA 的分布式系统的关键原则之一是拥有一个健壮的高可用性和灾难恢复计划。</p><p id="a517" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">高可用性</strong>通过在称为<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/availability-zones/az-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">可用性区域的冗余区域内部署块中托管基础架构组件的多个副本来消除单点故障。</strong> </a></p><p id="ba7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">灾难恢复通过在两个区域复制整个部署拓扑来消除完全区域性故障的停机时间，以确保满足正确的 SLA<strong class="jm io">RPO(恢复点目标)</strong>和<strong class="jm io"> RTO(恢复时间目标)</strong>。基于上述部署，拓扑可分为以下几类</p><ul class=""><li id="7586" class="lz ma in jm b jn jo jr js jv mb jz mc kd md kh me mf mg mh bi translated"><strong class="jm io">主动部署— </strong>零停机时间但有数据丢失风险的系统。<strong class="jm io"> <em class="ki"> Ex 电子商务门户网站。</em>T41】</strong></li><li id="6069" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">主动被动部署— </strong>系统不会丢失数据，但在发生区域性灾难时会影响可用性。<strong class="jm io"> <em class="ki"> Ex 银行系统。</em>T47】</strong></li></ul><h1 id="ffe1" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">与 AWS 的区别</strong></h1><p id="1bbc" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">与<strong class="jm io"> AWS </strong>不同，只有少数地区和服务支持这里  <strong class="jm io">所列的<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/availability-zones/az-region" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">可用区。</strong>此外，在通过 UI 或自动化创建这些 Azure 服务时，服务的可用性区域的选择是由 Azure 内部驱动的，而不是用户。</a></strong></p><p id="b744" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所有基于区域冗余的 Azure 服务分为以下几类-</p><ul class=""><li id="dc17" class="lz ma in jm b jn jo jr js jv mb jz mc kd md kh me mf mg mh bi translated"><strong class="jm io">分区服务— </strong>针对严格的延迟和性能要求部署到单个分区的服务。<strong class="jm io"> <em class="ki">前 Azure 应用网关 V2，Azure 虚拟机</em> </strong></li><li id="1e7e" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">区域冗余— </strong>跨区域复制服务，以提高容错能力。<em class="ki"> </em> <strong class="jm io"> <em class="ki"> Ex- Azure SQL、Azure KeyVault、Azure EventHub 等</em> </strong></li><li id="0f4f" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">始终可用— </strong>在全球范围内可用的服务，能够应对区域范围和地区范围的中断<strong class="jm io"> <em class="ki">例如。Azure 流量管理器、Azure 活动目录等</em> </strong></li></ul><p id="25c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，Azure 应用程序的数据库层位于虚拟网络之外，并作为防火墙规则的一部分通过<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-vnet-service-endpoint" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">服务端点</strong> </a>进行保护。</p><h1 id="a070" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">三层应用程序</h1><p id="475c" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">出于本博客的目的，我们将总体技术讨论限制在三层主动-主动系统</p><ul class=""><li id="85fe" class="lz ma in jm b jn jo jr js jv mb jz mc kd md kh me mf mg mh bi translated"><strong class="jm io">前端层— </strong>带有 UI 资产(<strong class="jm io"> <em class="ki">静态和非静态</em> </strong>)，该层服务于客户交互所需的业务流程页面</li><li id="a294" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">后端层— </strong>无状态微服务受到关注点分离<em class="ki"> ( </em> <strong class="jm io"> <em class="ki">读与写功能</em> </strong> <em class="ki"> ) </em>，这一层充当业务流背后核心逻辑的主干。</li><li id="af1c" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">数据库层— </strong>这一层充当所有静态数据(关系型与非关系型)的主干，由后端层通过<strong class="jm io"> <em class="ki">模型和视图进行访问。</em>T53】</strong></li></ul><h1 id="75e9" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">多区域部署拓扑</h1><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mn"><img src="../Images/1c6857d571a982acec106308a5ae65cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9W6wkq0S7itNLdRCbUDyw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated"><strong class="bd ky">Azure 上简单的 3 层部署拓扑</strong></figcaption></figure><p id="f683" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">详细查看—</strong><a class="ae kj" href="https://github.com/amit894/diagrams/blob/main/AWS%20Deployment%20Topology/3%20Tier.png" rel="noopener ugc nofollow" target="_blank">https://github . com/Amit 894/diagrams/blob/main/AWS % 20 deployment % 20 topology/3% 20 tier . png</a></p><h1 id="65f7" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Azure 服务</h1><ul class=""><li id="3984" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><a class="ae kj" href="https://docs.microsoft.com/en-us/azure/application-gateway/overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">应用网关</strong></a><strong class="jm io">—</strong>L7 负载均衡器，可用于配置 HTTP 规则，如<strong class="jm io"> <em class="ki"> url 重定向、请求头修改等</em> </strong></li><li id="46ce" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae kj" href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Azure 负载均衡器</strong></a><strong class="jm io">—</strong>L4 负载均衡器，工作在 TCP 层，用于设置端口转发和其他基本网络规则。</li><li id="fa9e" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae kj" href="https://azure.microsoft.com/en-us/services/virtual-machines/linux/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Azure 虚拟机</strong> </a> <strong class="jm io"> — </strong>计算实例，用于在 UI 和后端微服务层部署。</li><li id="e982" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae kj" href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">Azure Cosmos DB</strong></a><strong class="jm io">—</strong>一个 NoSQL 数据库，用于以键值对的形式存储非关系数据。这可以配置为具有<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/cosmos-db/consistency-levels" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ki">会话一致性的始终可用的服务。</em></strong>T38】</a></li><li id="0c3e" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae kj" href="https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Azure 流量管理器</strong> </a> <strong class="jm io"> — </strong>一个全球可用的 DNS 负载平衡器，用于在区域之间分配流量</li><li id="f0e6" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae kj" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">Azure VNET</strong></a><strong class="jm io">—</strong>公有云中的私有地址空间，使用可配置的<a class="ae kj" href="https://en.wikipedia.org/wiki/IP_address" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> IP 空间托管所有 AWS 服务。</strong> </a></li></ul><h1 id="48b6" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">VNET 设置</h1><p id="c766" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">给定区域的 3 个本地子网。</p><h1 id="3c04" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">网关子网</h1><ul class=""><li id="ccbc" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Components</code>:应用负载均衡器和 NAT 网关</li><li id="f1c0" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Routing</code>:VNET 内部，通过路由表和 Azure 应用网关防火墙限制的公共 IP。</li></ul><h1 id="2bc7" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">负载平衡器子网</h1><ul class=""><li id="67b8" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Components</code> : Azure 内部负载平衡器</li><li id="df43" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Routing</code>:VNET 内部直通路由表。</li></ul><h1 id="5cce" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用子网</h1><ul class=""><li id="e9bc" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Components</code> : Azure 虚拟机</li><li id="0196" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Routing</code>:VNET 内部直通路由表。</li></ul><h1 id="f710" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">网络设置</h1><h1 id="eca7" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用程序网关 V2 (L7)</h1><ul class=""><li id="e45a" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Security Group</code>:允许来自互联网的流量通过端口 443。</li><li id="abdb" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Communication Protocol</code> : HTTPS</li><li id="ba54" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">SSL</code>:强制</li></ul><h1 id="ef8a" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">前端虚拟机</h1><ul class=""><li id="a115" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Security Groups:</code>允许来自应用网关 V2 的流量通过<strong class="jm io">端口 443。</strong></li><li id="23cb" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Communication Protocol</code> : HTTPS</li><li id="85a2" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">SSL</code>:强制</li></ul><h1 id="7d07" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">内部负载平衡器(L4)</h1><ul class=""><li id="bd08" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Security Groups:</code>允许来自前端虚拟机的流量通过<strong class="jm io">端口 443。</strong></li><li id="889f" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Communication Protocol</code> : HTTPS</li><li id="ec51" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">SSL</code>:强制</li></ul><h1 id="cabb" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">后端虚拟机</h1><ul class=""><li id="1082" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Security Groups:</code>允许来自<strong class="jm io">端口 80 上的内部负载平衡器的流量。</strong></li><li id="2577" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Communication Protocol</code> : HTTPS</li><li id="1aff" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">SSL</code>:强制</li></ul><h1 id="2109" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">蔚蓝宇宙数据库(MangoDB)</h1><ul class=""><li id="f4af" class="lz ma in jm b jn lu jr lv jv ms jz mt kd mu kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Security Groups:</code>允许来自后端虚拟机的流量通过<strong class="jm io">端口</strong> 10250 <strong class="jm io">。</strong></li><li id="a25b" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">Communication Protocol</code> : TCP</li><li id="6110" class="lz ma in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><code class="fe mv mw mx my b">SSL</code>:首选</li></ul><h1 id="1f12" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="35e1" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">给定的文档仅涵盖了在 Azure Cloud 中的两个区域上实现全功能主动-主动部署的高级概述。为了进一步理解其中的复杂性，我们将进一步深入探讨未来的博客主题。</p><p id="0727" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如需反馈，请留言至<strong class="jm io"><em class="ki">Amit[dot]894[at]Gmail[dot]com</em></strong><em class="ki">或联系</em><a class="ae kj" href="https://about.me/amit_raj" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://about.me/amit_raj</em></a><em class="ki">的任何链接。</em></p></div></div>    
</body>
</html>