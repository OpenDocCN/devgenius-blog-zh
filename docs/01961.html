<html>
<head>
<title>How MVC Frameworks Taught Us Bad Habits â€” Part 1 ActiveRecord</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MVC æ¡†æ¶å¦‚ä½•æ•™ä¼šæˆ‘ä»¬åä¹ æƒ¯â€”â€”ç¬¬ 1 éƒ¨åˆ† ActiveRecord</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/how-mvc-frameworks-taught-bad-habits-part-1-activerecord-6f2858efcc16?source=collection_archive---------12-----------------------#2020-07-15">https://blog.devgenius.io/how-mvc-frameworks-taught-bad-habits-part-1-activerecord-6f2858efcc16?source=collection_archive---------12-----------------------#2020-07-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="647f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">è®©æˆ‘ä»¬å›é¡¾è¿‡å»ï¼Œè¯•å›¾å¼„æ¸…æ¥šæ¡†æ¶æ˜¯å¦‚ä½•æ•™ä¼šæˆ‘ä»¬ä¸å»æ³¨æ„é”™è¯¯çš„äº‹æƒ…çš„ã€‚</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/f3f105aeac59093f67f89852b0b23852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*TsclgsI38_jAVCYU00HSRA.jpeg"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">åä¹ æƒ¯</figcaption></figure><h1 id="1811" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">ä»‹ç»</h1><p id="ded8" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">è®©æˆ‘ä»¬å›åˆ° 200Xã€‚è¿™æ˜¯ MVC æ¡†æ¶çš„ç¹è£æ—¶æœŸã€‚Ruby on Railsï¼ŒDjangoï¼ŒZendFrameworkï¼ŒSpring ç­‰ã€‚ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­çš„å„ç§æ¡†æ¶åˆ›å»ºã€å¤åˆ¶å¹¶æ”¹è¿›äº†å„ç§ç‰¹æ€§ã€‚</p><p id="1099" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æ¡†æ¶åœ¨ web å¼€å‘ä¸­è¿ˆå‡ºäº†å·¨å¤§çš„ä¸€æ­¥ã€‚ä»–ä»¬ç»™è¿™ä¸ªè¡Œä¸šå¸¦æ¥äº†å¾ˆå¤šå¥½çš„ä¸œè¥¿ï¼Œç¦æ­¢ä¸ºå¼€å‘è€…åšåäº‹ã€‚ä½¿ç”¨æ¡†æ¶è®©åˆå­¦è€…å¾ˆå®¹æ˜“å¼€å§‹ã€‚æˆ‘çš„ç½‘é¡µå¼€å‘èŒä¸šç”Ÿæ¶¯å§‹äº 2007 å¹´ã€‚å‡ å¹´æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨ä½¿ç”¨è¿™äº›æ¡†æ¶ï¼Œè€Œæ²¡æœ‰è€ƒè™‘è¿™äº›æ¡†æ¶æä¾›çš„æ¶æ„å’Œå·¥å…·ã€‚</p><p id="24dd" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æˆ‘ä»¬å¦‚æ­¤ä¹ æƒ¯äºä½¿ç”¨æ¡†æ¶ï¼Œä»¥è‡³äºæˆ‘ä»¬å¾ˆéš¾æƒ³è±¡å¯èƒ½ä¼šæœ‰ä»»ä½•æ›¿ä»£é€‰é¡¹ã€‚ä»–ä»¬æ— æ„ä¸­æ•™ä¼šæˆ‘ä»¬ä¾èµ–ä»–ä»¬ä½¿ç”¨çš„æ–¹æ³•ã€‚é—®é¢˜æ˜¯é€‚ç”¨äºä¸­å°å‹åº”ç”¨çš„<strong class="li io">æ–¹æ³•å¹¶ä¸é€‚ç”¨äºå¤§å‹åº”ç”¨</strong>ã€‚åä¹‹äº¦ç„¶ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¤„ç†ä¸­å°å‹åº”ç”¨ç¨‹åºï¼Œæ‚¨æ²¡æœ‰ä»€ä¹ˆå¯æ‹…å¿ƒçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è§‰å¾—æ‚¨çš„åº”ç”¨ç¨‹åºå·²ç»ç¼ºå°‘äº†ä»¥å‰çš„çµæ´»æ€§ï¼Œæ¬¢è¿æ‚¨ã€‚</p><p id="ca5e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æˆ‘æƒ³åˆ†äº«ä¸€äº›æˆ‘çœ‹åˆ°çš„æ¡†æ¶æ— æ³•æœ‰æ•ˆå¤„ç†çš„å¤§å‹åº”ç”¨ç¨‹åºçš„ç¼ºç‚¹ã€‚æˆ‘å¸Œæœ›ä½ ä»ä¸åŒçš„è§’åº¦çœ‹å¾…ç†Ÿæ‚‰çš„äº‹ç‰©</p><p id="a632" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æˆ‘ä»¬ä» ActiveRecord æ¨¡å¼å¼€å§‹ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¡†æ¶éƒ½ä½¿ç”¨å®ƒã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ€å–œæ¬¢çš„æ¡†æ¶ä½¿ç”¨å­˜å‚¨åº“æ¨¡å¼ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ä½ å¯ä»¥è·³è¿‡è¿™ç¯‡æ–‡ç« ã€‚</p><h1 id="1609" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">æˆ‘ä»¬ä¸ºä»€ä¹ˆå–œæ¬¢ ActiveRecord</h1><p id="186d" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">è¿˜è®°å¾—åœ¨ 15 åˆ†é’Ÿå†…åˆ›å»ºä¸€ä¸ªåšå®¢æœ‰å¤šé…·å—ï¼Ÿå½“æ—¶ï¼Œè®¸å¤šæ¡†æ¶æä¾›äº† CLI ç”šè‡³ Web ç•Œé¢ï¼Œç”¨äºåœ¨ä¸€ä¸ªåŠ¨ä½œä¸­åˆ›å»ºæ¨¡å‹ã€æ§åˆ¶å™¨å’Œè§†å›¾ã€‚ä½ å¾—åˆ°äº†ä¸€ä¸ªå’Œè¿™ä¸ªç›¸ä¼¼çš„éª¨æ¶ã€‚</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="8c5c" class="mm kp in mi b gy mn mo l mp mq">def<!-- --> <!-- -->create<br/>  <strong class="mi io">@user</strong> <!-- -->= User.new(user_params)<br/>  if<!-- --> <strong class="mi io">@user</strong>.save<br/>    redirect_to <strong class="mi io">@user<br/>  </strong>else<br/>    render <em class="mr">'new'<br/>  </em>end<br/>end</span></pre><p id="fc08" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><code class="fe ms mt mu mi b">Convention Over Configuration</code>å’Œ<code class="fe ms mt mu mi b">Keep It Simple</code>æ˜¯ä¸»è¦è§„åˆ™ã€‚æ„å»ºè¿™æ ·ä¸€ä¸ªç®€å•ä»£ç çš„åŸºç¡€æ˜¯ ActiveRecordã€‚ä¸æ˜¯æ‰€æœ‰ï¼Œä½†æ˜¯éå¸¸å¤šçš„æ¡†æ¶ä½¿ç”¨å’Œä½¿ç”¨æ´»åŠ¨è®°å½•ï¼Œä¸æä¾›ä»»ä½•æ›¿ä»£</p><p id="51ec" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">ç°åœ¨ä½ å¯ä»¥åœ¨å„ç§æ¡†æ¶æŒ‡å—ä¸­æ‰¾åˆ°éå¸¸ç›¸ä¼¼çš„ä»£ç ã€‚ä»£ç ç®€çŸ­è€Œä¼˜é›…ã€‚é‚£ä¹ˆ ActiveRecord æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><h1 id="5b08" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">ActiveRecord æ€ä¹ˆäº†</h1><p id="87c9" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">ä¹ä¸€çœ‹ï¼Œéå¸¸æ–¹ä¾¿å’Œç›´è§‚ã€‚å®é™…ä¸Š<strong class="li io">å½“ä½ å¤„ç†ç®€å•çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒéå¸¸å¥½ç”¨ã€‚</strong></p><p id="1601" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">ä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œåˆ›å»ºæ–°ç”¨æˆ·æˆ–è®¢å•ä¸ä»…ä»…æ˜¯å†™å…¥æ•°æ®åº“ã€‚å¦‚æœæˆ‘ä»¬è°ˆè®ºçš„æ˜¯ç”¨æˆ·åˆ›å»ºâ€”â€”è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ³¨å†Œè¿‡ç¨‹ã€‚è®©æˆ‘ä»¬ä¼°è®¡ä¸€ä¸‹åœ¨æ³¨å†Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å“ªäº›é™„åŠ æ“ä½œ:</p><ul class=""><li id="47dc" class="mv mw in li b lj mc lm md lp mx lt my lx mz mb na nb nc nd bi translated">ä¿å­˜å¤´åƒ</li><li id="099a" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ¥è‡ªç¬¬ä¸‰æ–¹æ¥æºçš„é¢„å¡«å……æ•°æ®</li><li id="ea83" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">é‡è¦çš„éªŒè¯â€”å‘¼å«ç¬¬ä¸‰æ–¹</li><li id="269f" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ä¸åŒçš„æ³¨å†Œåœºæ™¯â€”â€”é€šè¿‡ FB æ³¨å†Œã€é€šè¿‡é‚€è¯·å‡½æ³¨å†Œã€é€šè¿‡è¡¨æ ¼æ³¨å†Œç­‰</li><li id="3492" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">é™„åŠ éªŒè¯â€”ç”µè¯å·ç éªŒè¯ã€ä¿¡ç”¨å¡çš„åˆ†é…å’ŒéªŒè¯</li><li id="b8dc" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">é»‘åå•æ£€æŸ¥</li><li id="6a71" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">é™„åŠ  post é€»è¾‘â€”â€”é€šçŸ¥å…¶ä»–æœåŠ¡å…³äºæ–°ç”¨æˆ·çš„ä¿¡æ¯</li><li id="7dc1" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ç­‰ç­‰</li></ul><p id="bc34" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">è®¢å•åˆ›å»ºã€é¢„çº¦å®‰æ’ã€ç”šè‡³é‚®ä»¶åˆ›å»ºç­‰â€”â€”åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œä¸šåŠ¡é€»è¾‘æ¯”ä¹çœ‹èµ·æ¥è¦å¤æ‚å¾—å¤šã€‚ActiveRecord å¦‚ä½•åº”å¯¹æ‰€æœ‰è¿™äº›å•†ä¸šè§„åˆ™ï¼Ÿ</p><h2 id="3ac8" class="mm kp in bd kq nj nk dn ku nl nm dp ky lp nn no la lt np nq lc lx nr ns le nt bi translated">æ‰©å±•æ‚¨çš„éªŒè¯è§„åˆ™</h2><p id="86de" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">è¿™äº›æ¡†æ¶æä¾›äº†å¹¿æ³›çš„éªŒè¯èƒ½åŠ›ã€‚æ‚¨çš„éªŒè¯è§„åˆ™åƒæ‚è‰ä¸€æ ·ç”Ÿé•¿ï¼Œè¯•å›¾è·Ÿä¸Šä¸šåŠ¡è§„åˆ™ã€‚(PHP å’Œ Yii1)</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="7b82" class="mm kp in mi b gy mn mo l mp mq">&lt;?php <br/><br/>class Yii1Model <br/>{<br/>    public function rules()<br/>    {<br/>        return array(<br/>            // Required fields<br/>            array('customer', 'required', 'message' =&gt; Yii::t('rezdy', 'Please create or select a customer'), 'on' =&gt; 'create, update'),<br/><br/>            // Safe on booking form<br/>            array('customer, customer[mailingAddress], additionalFields, paymentOption, payFullAmount', 'safe', 'on' =&gt; 'bookingForm, partners'),<br/>            array('customerAgreedToTermsAndConditions', 'safe', 'on' =&gt; 'bookingForm'),<br/><br/>            // Safe on create and update<br/>            array('status, surcharge, sourceChannel, agentUserName', 'safe', 'on' =&gt; 'create, update'),<br/>            array('internalNotes, resellerComments, resellerReference, agentUserName', 'safe', 'on' =&gt; 'partners'),<br/><br/>            // Safe on commissions report<br/>            array('startTime, endTime, dateRange, resellerId, reconciled, lastInvoice', 'safe', 'on' =&gt; 'commissionDetails'),<br/><br/><br/>            // Top level fields with children<br/>            array('customer, items, paymentDetails, creditCard', 'safe'),<br/>            array('status, searchString, startTime, endTime, dateRange, productId, paymentStatus, entityState', 'safe', 'on' =&gt; 'search'),<br/><br/>            // Special fields<br/>            array('date', 'date'),<br/>            array('customer[phone], customer[mobile]', 'match', 'pattern' =&gt; '/^([0-9+() -])+$/'),<br/><br/>            // Trim<br/>            array('comments, internalNotes, voucherCode, resellerComments, resellerReference', 'filter', 'filter' =&gt; [$this, 'sanitize']),<br/><br/>            // Email validation<br/>            array('customer[email]', 'ext.validators.EmailValidator', 'allowEmpty' =&gt; true),<br/><br/>            //Check for TC agreement<br/>            array('customerAgreedToTC', 'ext.validators.EConditionalValidator', 'conditionalRules' =&gt; array('companySettings[explicitAgreementToTermsAndPolicy]', 'compare', 'compareValue' =&gt; true), 'rule' =&gt; array('required'), 'on' =&gt; 'bookingForm'),<br/>            // Max length<br/>            array('email, customer[email]', 'length', 'max' =&gt; 254),<br/>            array('customer[phone]', 'length', 'max' =&gt; 25),<br/>            array('customer[firstName], customer[lastName], customer[mailingAddress][addressLine], customer[mailingAddress][addressLine2], customer[mailingAddress][city], customer[mailingAddress][state]', 'length', 'max' =&gt; 200),<br/>            array('customer[mailingAddress][countryCode]', 'length', 'max' =&gt; 4),<br/>            array('customer[mailingAddress][postCode]', 'length', 'max' =&gt; 10),<br/>        );<br/>    }<br/>}</span></pre><p id="c3b7" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æœæ‚¨çš„æ¨¡å‹å¤„ç†åµŒå¥—æˆ–ç›¸å¯¹æ¨¡å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€äº›é€‰é¡¹ã€‚Ruby on Rails</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="0e0c" class="mm kp in mi b gy mn mo l mp mq"><strong class="mi io"># </strong><a class="ae nu" href="https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html" rel="noopener ugc nofollow" target="_blank">https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html</a><strong class="mi io"><br/>class Member &lt; ActiveRecord::Base</strong><br/>  has_many :posts<br/>  accepts_nested_attributes_for :posts, allow_destroy: <strong class="mi io">true, </strong> update_only: <strong class="mi io">true</strong>, reject_if: proc { |attributes| attributes['title'].blank? }<br/><strong class="mi io">end</strong></span></pre><p id="83e0" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æœä½ éœ€è¦ä¸€äº›æ›´æ–°åçš„é€»è¾‘ï¼Œä½ å¯ä»¥ç”¨</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="b1e7" class="mm kp in mi b gy mn mo l mp mq">class<!-- --> <!-- -->PictureFile &lt; ApplicationRecord<br/>  after_commit <strong class="mi io">:delete_picture_file_from_disk</strong>, on: <strong class="mi io">:destroy</strong></span><span id="9e99" class="mm kp in mi b gy nv mo l mp mq">  def<!-- --> <!-- -->delete_picture_file_from_disk<br/>    if<!-- --> <!-- -->File.exist?(filepath)<br/>      File.delete(filepath)<br/>    end<br/>  end <br/>end</span></pre><p id="96b3" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">ä½ çš„æ¨¡ç‰¹çŸ¥é“å¦‚ä½•</p><ul class=""><li id="bb9c" class="mv mw in li b lj mc lm md lp mx lt my lx mz mb na nb nc nd bi translated">éªŒè¯ä¸åŒåœºæ™¯çš„ç”¨æˆ·è¾“å…¥</li><li id="2283" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">å°†æ›´æ–°ä¿å­˜åˆ°æ•°æ®å­˜å‚¨</li><li id="a17f" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ‰¾åˆ°é€‚åˆä¸åŒåœºæ™¯çš„æ¨¡å‹</li><li id="0d31" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ›´æ–°ç”šè‡³éªŒè¯ç›¸å…³æ¨¡å‹</li><li id="f368" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">åˆ¶å®šä¸€äº›æ›´æ–°åçš„é€»è¾‘(é€šå¸¸ä¸å½“å‰é¢†åŸŸæ²¡æœ‰ç›´æ¥å…³ç³»)</li></ul><p id="c8d5" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æœæˆ‘é”™äº†ï¼Œè¯·çº æ­£æˆ‘ï¼Œä½†æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ¨¡å¼æ˜¯è¿™æ ·çš„</p><ul class=""><li id="b60d" class="mv mw in li b lj mc lm md lp mx lt my lx mz mb na nb nc nd bi translated">ä½ éœ€è¦ä¸€ä¸ªæ–°åŠŸèƒ½</li><li id="0194" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ‚¨åœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ–°è¡¨</li><li id="3403" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">åœ¨æ‚¨çš„ä»£ç åº“ä¸­åˆ›å»ºä¸€ä¸ªå…è®¸è¿›è¡Œ CRUD æ“ä½œçš„æ¨¡å‹</li><li id="64c8" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ‚¨ä¸æ–­åœ°å°†ä¸è¯¥é¢†åŸŸæ¨¡å‹ç›¸å…³çš„åŠŸèƒ½æ·»åŠ åˆ°å•ä¸ªç±»ä¸­</li></ul><p id="a00c" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æœæ‚¨çš„é¡¹ç›®ç»§ç»­å‘å±•ï¼Œæ–°çš„éœ€æ±‚å®šæœŸå‡ºç°ï¼Œå‡ ä¸ªæœˆåæ‚¨ä¼šå‘ç°æ‚¨çš„<code class="fe ms mt mu mi b">models </code>æ–‡ä»¶å¤¹æœ‰ 200 å¤šä¸ªç±»ã€‚ä½ æ‰€æœ‰çš„æ¨¡ç‰¹éƒ½äº’ç›¸è®¤è¯†ã€‚</p><p id="6d21" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æ¯•ç«Ÿï¼Œä½ ä¼šå¾—åˆ°åƒ<a class="ae nu" href="https://gist.github.com/radzserg/79a2eaeacd247fec2c12128f60b9b4e3" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>ä¸€æ ·çš„æ€ªç‰©ã€‚åªæ˜¯å®ƒå¤ªå¤§äº†ï¼Œä¸èƒ½æ”¾åœ¨è¿™é‡Œï¼Œä½†çœ‹çœ‹å§ã€‚æ‰¿è®¤è¿™ä¸€ç‚¹æœ‰ç‚¹å°´å°¬ï¼Œä½†è¿™éƒ¨ä½œå“çš„ä½œè€…æ˜¯æˆ‘ğŸ¤«ã€‚å†™äº 2014 å¹´å·¦å³ã€‚ä½†æ˜¯æˆ‘è§è¿‡æ›´å¤§çš„æ¨¡å‹ã€‚</p><p id="5d8b" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æ­¤å·¨å¤§çš„<strong class="li io">æ¨¡å‹æ‰“ç ´äº†å•ä¸€è´£ä»»åŸåˆ™</strong>ã€‚æ–¹æ³•çš„æ•°é‡ä¸å†å…è®¸æˆ‘ä»¬çš„å¤§è„‘æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒ(æ‰¾å‡º<a class="ae nu" href="https://medium.com/@radzserg/why-is-it-hard-for-a-brain-to-understand-spaghetti-code-278d9b5d760c" rel="noopener">ä¸ºä»€ä¹ˆå¤§è„‘å¾ˆéš¾ç†è§£æ„å¤§åˆ©é¢æ¡ä»£ç </a>)ã€‚æœ€åï¼Œä½ çš„ç­çº§æœ‰ 1K æˆ– 10K çº¿å·²ç»ä¸é‡è¦äº†ã€‚ç”šè‡³è€ƒè™‘åˆ°ä½ å¯ä»¥ä¸€ç›´å¤„ç† Ctrl+Fï¼Œè¿™ç§æ–¹æ³•çš„ä¸»è¦é—®é¢˜- <strong class="li io">ä¸€åˆ‡éƒ½æ˜¯ç´§å¯†è€¦åˆçš„</strong>ã€‚ç°åœ¨ä½ å¼€å§‹æ„è¯†åˆ°ä½ çš„ä»£ç æåº¦ç¼ºä¹çµæ´»æ€§(è™½ç„¶ä½ ä»ç„¶å¯ä»¥æŠµåˆ¶å®ƒ)ã€‚ä½ éœ€è¦æ£€æŸ¥æ›´å¤šçš„åœ°æ–¹ï¼Œä»¥ç¡®ä¿ä½ ä¸ä¼šæ‰“ç ´ä»»ä½•ä¸œè¥¿ã€‚é—®é¢˜æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å…¸å‹çš„ä»£ç ï¼Œåœ¨ 2020 å¹´çš„ç°åœ¨å¾ˆå¸¸è§ã€‚å½“ä¸€ä¸ªå›¢é˜Ÿå’Œä»£ç æˆé•¿æ—¶ï¼Œä½ å¼€å§‹ç†è§£ç°åœ¨çš„å˜åŒ–éœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚è€Œ<strong class="li io">å½“åˆå¾ˆæ–¹ä¾¿çš„ç°åœ¨ç¼ºä¹çµæ´»æ€§</strong>ã€‚</p><h1 id="c969" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">ActiveRecord åªæ˜¯ä¸€ä¸ªå·¥å…·</h1><p id="f600" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">æ‚¨æ›¾ç»ä¸å¾—ä¸å°†åº”ç”¨ç¨‹åºä»ä¸€ä¸ªæ¡†æ¶ç§»æ¤åˆ°å¦ä¸€ä¸ªæ¡†æ¶å—ï¼Ÿå¹³æ—¶é‚£ä¹ˆè´¹åŠ²ï¼Œä»€ä¹ˆéƒ½ä»é›¶å¼€å§‹æ›´å®¹æ˜“ã€‚è€Œè¿™äº›é—®é¢˜çš„ç½ªé­ç¥¸é¦–å°±æ˜¯ç´§è€¦åˆæ¨¡å‹ã€‚</p><p id="9878" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">åƒ<code class="fe ms mt mu mi b">AcriveRecord</code>è¿™æ ·çš„æ¨¡å¼å·²ç»æˆä¸ºä¸€äº›æ¡†æ¶ä¸­äº‹å®ä¸Šçš„æ ‡å‡†ã€‚æˆ‘ä»¬æ²¡æœ‰å›´ç»•ä¸šåŠ¡è§„åˆ™æ„å»ºé¢†åŸŸå±‚ï¼Œè€Œæ˜¯æŒ‰ç…§æä¾›çš„æŒ‡å—ï¼Œå›´ç»•æä¾›çš„å·¥å…·(å¦‚ ActiveRecord)æ„å»ºä¸šåŠ¡è§„åˆ™ã€‚æ‚¨çš„ä¸šåŠ¡è§„åˆ™ä¸å…³å¿ƒæ‚¨æ˜¯ä½¿ç”¨ ActiveRecord è¿˜æ˜¯ Repository æ¨¡å¼ï¼Œæ‚¨æ˜¯ä½¿ç”¨ Mysql è¿˜æ˜¯ DynamoDBã€‚<strong class="li io">ä¸šåŠ¡è§„åˆ™ä»ç„¶æ˜¯æ‚¨ç³»ç»Ÿçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†</strong>ï¼Œè€Œæ´»åŠ¨è®°å½•åªæ˜¯ä¸€ä¸ªå·¥å…·ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜ä¿å­˜æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜å­˜å‚¨æ–¹å¼ï¼Œä½†æˆ‘ä»¬ä¸èƒ½æ”¹å˜ä¸šåŠ¡è§„åˆ™ã€‚ç”Ÿæ„å†³å®šè§„åˆ™ã€‚æˆ‘ä»¬ä¸ºè¿™äº›ä¸šåŠ¡è§„åˆ™æ„å»ºåº”ç”¨ç¨‹åºã€‚</p><p id="781e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">ä¸šåŠ¡è§„åˆ™ä¸åº”è¯¥ä¾èµ–äºå·¥å…·ã€‚æ‚¨å¿…é¡»é¦–å…ˆè®¾è®¡å®ç°æ‚¨çš„ä¸šåŠ¡è§„åˆ™çš„é«˜å±‚ç»„ä»¶ã€‚ç„¶åæ‰æ‹¿èµ·ä½çº§å·¥å…·ã€‚è€Œä¸æ˜¯ç›¸åã€‚æ•°æ®åº“åªæ˜¯ä¸€ä¸ªä½ å¯ä»¥æ”¹å˜çš„ç»†èŠ‚ã€‚</strong></p><h1 id="2f61" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">å¦‚ä½•æ­£ç¡®åœ°åšå®ƒ</h1><p id="8eee" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">å‡è®¾æ‚¨éœ€è¦å®ç°åº”ç”¨ç¨‹åºä¸­å¤„ç†è®¢å•çš„éƒ¨åˆ†ã€‚è®¢å•æ˜¯åœ¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„ï¼Œç°åœ¨æ‚¨éœ€è¦ä»˜æ¬¾ã€‚æ‚¨æœ‰ä»¥ä¸‹è¦æ±‚:</p><ul class=""><li id="b35d" class="mv mw in li b lj mc lm md lp mx lt my lx mz mb na nb nc nd bi translated">æ‚¨éœ€è¦éªŒè¯ç”¨æˆ·è¾“å…¥</li><li id="f042" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ‚¨éœ€è¦é‡æ–°è®¡ç®—æ€»é‡‘é¢ï¼Œå¹¶ç¡®ä¿å®ƒä¸æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­æ˜¾ç¤ºçš„é‡‘é¢ç›¸åŒ¹é…</li><li id="a903" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">é€šè¿‡ X æ”¯ä»˜ç½‘å…³å¤„ç†æ”¯ä»˜</li><li id="8fab" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">æ›´æ–°æ•°æ®åº“ä¸­çš„è®¢å•çŠ¶æ€</li><li id="e503" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">å°†æ–°è®¢å•é€šçŸ¥ä»“åº“æ¨¡å—</li><li id="4596" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ä¸ºå®¢æˆ·å‘é€æ”¶æ®</li></ul><p id="2e68" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">ä¸å…¶åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°è¡¨å’Œç›¸å…³çš„ ActiveModelï¼Œä¸å¦‚è®©æˆ‘ä»¬ç”¨è¿™äº›é«˜å±‚æ¬¡çš„éœ€æ±‚åšä¸€ä¸ªè‰ç¨¿</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="3ddb" class="mm kp in mi b gy mn mo l mp mq">class class OrderService {<br/>    public Order processOrder(Order order) {<br/>        <em class="mr">// validate input<br/>        // re-calculate total amount with TAX and make sure that the match previous price<br/>        // process payment<br/>        // update order state in DB<br/>        // notify warehouse<br/>        // send receipt<br/>    </em>}</span><span id="2495" class="mm kp in mi b gy nv mo l mp mq">    public createOrder(...)  {}<br/>}</span></pre><p id="ab05" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æ‚¨æ‰€è§ï¼Œä¿å­˜æ•°æ®åªæ˜¯ä¼—å¤šæ­¥éª¤ä¸­çš„ä¸€æ­¥ã€‚é«˜å±‚æ“ä½œå’Œå®ƒä»¬ä¹‹é—´çš„ç›¸äº’ä½œç”¨ç°åœ¨æ›´é‡è¦äº†ã€‚æˆ‘æƒ³æ¨è¿Ÿä¿å­˜æ•°æ®çš„ç»„ä»¶çš„å®ç°ã€‚æˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="6dd7" class="mm kp in mi b gy mn mo l mp mq">public class OrderService {<br/>    priivate final OrderRepository repository;<br/>    public OrderService(OrderRepository repository) {<br/>        this.repository = repository;<br/>    }<br/><br/>    public Order processOrder(Order order) {<br/>        <em class="mr">this.orderValidator.validate(order);<br/>        Long total = this.orderPrice.calculateTotal(order);<br/>        if (!total.equal(order.getTotal())) {<br/>            throw new OrderPriceException("Price has been changed")<br/>        }<br/>        try {<br/>            this.stripePaymentGateway.processOrder(order);<br/>        } catch (StripeException exception) {<br/>            // <br/>        </em>}</span><span id="9efc" class="mm kp in mi b gy nv mo l mp mq"><em class="mr">        </em><strong class="mi io"><em class="mr">order = </em>this.repository.confirm(order);</strong></span><span id="1c1e" class="mm kp in mi b gy nv mo l mp mq">        this.applicationEventPublisher.publishEvent(new OrderConfirmed(order));<em class="mr"><br/>        this.customerNotifier.sendOrderReceipt(order);<br/>    </em>}<br/>    public createOrder(...)  {}<br/>}</span></pre><p id="9a18" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å…¶ä¸­ OrderRepository æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”šè‡³ä¸æ˜¯çœŸæ­£çš„å®ç°ã€‚æˆ‘ä½¿ç”¨äº†<a class="ae nu" href="https://martinfowler.com/eaaCatalog/repository.html" rel="noopener ugc nofollow" target="_blank">å­˜å‚¨åº“</a>æ¨¡å¼ã€‚å¥½äº†ï¼Œç°åœ¨æˆ‘å‡†å¤‡å¥½æµ‹è¯•æˆ‘çš„è®¢å•æœåŠ¡äº†ã€‚</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="550f" class="mm kp in mi b gy mn mo l mp mq">@ExtendWith(MockitoExtension.class)<br/>public class ChargeServiceTest {<br/><br/>    @Mock<br/>    private OrderRepository orderRepository;<br/><br/>    @InjectMocks<br/>    private OrderService orderService;<br/><br/>    @Test<br/>    public void testProcessOrderSuccess() {<br/>        // test validation<br/>        // test order price recalculation<br/>        // etc<br/>        <em class="mr">when</em>(orderRepository.confirm(order)).thenReturn(order);<br/>    }<br/>}</span></pre><p id="af34" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå’Œæµ‹è¯•å®ç°ä¸šåŠ¡è§„åˆ™çš„é«˜çº§ç»„ä»¶ã€‚</p><p id="74e9" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">æ³¨:</strong></p><ul class=""><li id="f005" class="mv mw in li b lj mc lm md lp mx lt my lx mz mb na nb nc nd bi translated">æˆ‘ä¸éœ€è¦æ•°æ®åº“æˆ–ä¸ DynamoDB æˆ–ä»»ä½•å…¶ä»–å­˜å‚¨çš„é›†æˆæ¥åšåˆ°è¿™ä¸€ç‚¹</li><li id="2fc9" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ä»£ç ä¸ä¾èµ–äºæ¡†æ¶æˆ–ç‰¹å®šçš„åº“æ¥å¤„ç†æ•°æ®åº“ã€‚</li><li id="e71c" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">è¿™å¾ˆå®¹æ˜“æµ‹è¯•ã€‚æˆ‘ä»¬å°† OrderRepository è§†ä¸ºå¦ä¸€ä¸ªå•å…ƒã€‚å®ƒå°†æ¥å—å¦ä¸€é¡¹æµ‹è¯•ã€‚ç”±äºæˆ‘ä»¬ä¸éœ€è¦å°†æ•°æ®å†™å…¥çœŸå®çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æµ‹è¯•æ˜¯å•å…ƒçš„å’Œå¿«é€Ÿçš„ã€‚</li><li id="96a3" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ç»„ä»¶çš„ç»“æ„ä½¿ç”¨å¯¹ä¸šåŠ¡å’Œå¼€å‘äººå‘˜æ¥è¯´å¾ˆæ¸…æ¥šçš„é€šç”¨è¯­è¨€</li></ul><p id="8377" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">å¦‚æœæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿ç§»åˆ°æ–°çš„æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬åªéœ€ç…§åŸæ ·å¤åˆ¶ä»£ç ï¼Œå®ƒå°±ä¼šç»§ç»­å·¥ä½œã€‚å®ƒæ²¡æœ‰ä»»ä½•ç¡¬ç¼–ç çš„ä¾èµ–å…³ç³»ã€‚</p><p id="fac4" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">ç­‰ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šéœ€è¦å°†æ•°æ®ä¿å­˜åˆ°å­˜å‚¨å™¨ä¸­ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçœŸæ­£çš„å®ç°ã€‚çœŸçš„å—ï¼Ÿå“¦ï¼Œå¯¹äº†ã€‚å¥½äº†ï¼Œè¡¥å……ä¸€ä¸‹å§ã€‚è¿™äº›å¤©ä½ æ›´å–œæ¬¢ä»€ä¹ˆï¼ŸMysql æˆ– DynamoDb</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="3b1f" class="mm kp in mi b gy mn mo l mp mq"><a class="ae nu" href="http://twitter.com/Repository" rel="noopener ugc nofollow" target="_blank">@Repository</a><br/>public class MysqlOrderRepository implements OrderRepository {<br/> <br/>    <a class="ae nu" href="http://twitter.com/PersistenceContext" rel="noopener ugc nofollow" target="_blank">@PersistenceContext</a><br/>    private EntityManager entityManager;</span><span id="127b" class="mm kp in mi b gy nv mo l mp mq"><a class="ae nu" href="http://twitter.com/Transactional" rel="noopener ugc nofollow" target="_blank">    @Transactional</a><br/>    public void confirm(Order order) {<br/>        order.setConfirmed(true);         <br/>        this.entityManager.persist(person);<br/>    } <br/>}</span></pre><h1 id="b5d9" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">ç»“è®º</h1><ul class=""><li id="f3a1" class="mv mw in li b lj lk lm ln lp nw lt nx lx ny mb na nb nc nd bi translated">å°½ç®¡ ActiveRecord è¿åäº† SRP å¹¶å€¾å‘äºè€¦åˆç»„ä»¶ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸­å°å‹åº”ç”¨ç¨‹åºçš„å¥½é€‰æ‹©ã€‚</li><li id="6656" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">ActiveRecord åªæ˜¯ä¸€ä¸ªå·¥å…·ã€‚å§‹ç»ˆå…³æ³¨å¤‡é€‰æ–¹æ¡ˆï¼Œå¹¶æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æ‚¨éœ€è¦çš„æ–¹æ¡ˆã€‚</li><li id="b15c" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">å°½ç®¡å­˜å‚¨åº“å’Œå®ä½“æ›´å¥½ğŸ˜›</li><li id="bba1" class="mv mw in li b lj ne lm nf lp ng lt nh lx ni mb na nb nc nd bi translated">åŸºäºä¸šåŠ¡è§„åˆ™è®¾è®¡åº”ç”¨ç¨‹åºã€‚é«˜å±‚é‡è¦ï¼Œä½å±‚ç»†èŠ‚å¯ä»¥å»¶åã€‚</li></ul></div></div>    
</body>
</html>