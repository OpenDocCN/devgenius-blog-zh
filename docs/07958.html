<html>
<head>
<title>How to create npx script | CLI with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 NodeJS 创建 npx 脚本| CLI</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-npx-script-cli-with-nodejs-3927f8bb91eb?source=collection_archive---------5-----------------------#2022-05-06">https://blog.devgenius.io/how-to-create-npx-script-cli-with-nodejs-3927f8bb91eb?source=collection_archive---------5-----------------------#2022-05-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="fb25" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过几个简单的步骤，这篇文章将向你展示如何使用 JavaScript 和 NodeJS 创建一个基本的 script | CLI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/600452bac55158cefe8fef0073c43b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*NhBV2-lJsMHUzJUiFqGwQA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">带有 shebang 注释的 nodejs npx 脚本</figcaption></figure><h1 id="e7aa" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">注意</h1><p id="a567" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">CLI —命令行界面。</p><p id="5b88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我用的是 NodeJS 的 v16.13.1。</p><h1 id="5e5f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">要求</h1><p id="7157" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">为了获得最佳的学习体验，请使用 NPM。要在命令提示符下运行脚本，我将使用 npm link 命令。</p><p id="c7a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 NPM 之前，我试图用纱，但纱和 NPM 链接不一样。为了使体验尽可能顺利，请使用 NPM。</p><p id="c830" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，如果这不是一个选项，最后，我会提供一种方法来测试包，即使你使用纱。但是，我觉得有点不方便。</p><h1 id="b90d" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">一个入口</h1><p id="0594" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我将首先创建一个入口点 JavaScript 文件，并在顶部添加一个注释。NPM 要求该注释将该文件标记为可执行文件。你可以在这里阅读更多<a class="ae lx" href="https://stackoverflow.com/questions/33509816/what-exactly-does-usr-bin-env-node-do-at-the-beginning-of-node-files" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/33509816/what-exact-does-usr-bin-env-node-do-at-the-begin-of-node-files</a>。</p><p id="b472" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于 NodeJS 解析算法，文件名是 index。你可以通过这个链接<a class="ae lx" href="https://faun.pub/how-does-nodejs-require-modules-dcb8a4dfdab8" rel="noopener ugc nofollow" target="_blank">https://faun . pub/how-do-nodejs-require-modules-dcb 8 a 4 DFD ab 8</a>了解更多信息。</p><p id="3455" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，我们已经有了一个索引 JavaScript 文件，其顶部带有注释:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ly"><img src="../Images/a06cc8252f95a030f7a32f4775b0b0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mDJw2U4jl9t224f12zxwA.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">顶部带有注释的索引 JavaScript 文件</figcaption></figure><h1 id="e07b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">告诉 NPM 脚本| CLI 在哪里，它的名称是什么</h1><p id="d670" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">在包 JSON 文件中，我将添加 bin 属性，该属性将包含命令的名称和文件的位置。</p><p id="2de0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">新的结构包含前面提到的新的包 JSON 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi md"><img src="../Images/d24c08fe1ee6f7cdca9dbe325eb98672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RtDPS7xD8iX9uAgzpOnY2Q.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">带有 bin 属性的包 JSON 文件</figcaption></figure><p id="53eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">脚本| CLI 可以通过以下方式运行:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="5702" class="mj kv in mf b gy mk ml l mm mn">npx-cli-package</span></pre><h1 id="90ac" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">添加脚本| CLI 逻辑</h1><p id="75dc" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">目前，脚本| CLI 没有任何代码。作为一个好的起点，我将添加一些文本的常规日志。运行脚本| CLI 后，我将向您展示如何提取参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mo"><img src="../Images/d915f0ebcbfb13a9c20683f1bcc7745a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NhjMriNCQ2f1C6p9XKf-A.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">打印 npx cli 包的索引 JavaScript 文件</figcaption></figure><h1 id="c3fb" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置运行脚本| CLI</h1><p id="60fe" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">为了运行脚本| CLI，我将向包 JSON 添加一个名称，因为它是必填字段。没有名称字段，我们无法运行脚本| CLI。</p><p id="0286" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加字段后，包 JSON 和结构如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mp"><img src="../Images/b3ed93ec21a7eaff61dee5a5a4e1f654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DN2wxJhTPNv4rKxzaybNyw.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">添加字段后，包 JSON 有了一个额外的属性——name</figcaption></figure><h1 id="cf41" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">运行脚本| CLI</h1><p id="4f46" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">第一步是运行 npm link 命令，之后脚本将在命令提示符下运行。</p><p id="3bd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行 npm 链接。您应该会看到类似下图的输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mq"><img src="../Images/b51d79df884e39e601eeffeea1515a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XlyKqLmzXMMIYnIZc_7Ilw.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">npm 链接输出</figcaption></figure><p id="4828" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行如下命令:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="5dec" class="mj kv in mf b gy mk ml l mm mn">npx-cli-package</span></pre><p id="e396" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您应该会看到类似的输出，如图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/35598c2d672dfbfad35e58eb583934d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*sjNz4kiDkmqrpg-tniTExQ.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">npx-CLI-包输出</figcaption></figure><h1 id="6ee0" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">提取参数</h1><p id="a2d4" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">脚本| CLI 已准备就绪。提取参数很简单。我建议您打印出流程变量，因为它有您可能想要使用的属性。这是关于它的文件<a class="ae lx" href="https://nodejs.org/api/process.html" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/api/process.html</a>。</p><p id="c5d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将继续从命令行提取参数。我也会把文字印刷删掉，因为我不再需要它了。</p><p id="360d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将 index JavaScript 代码更改为以下代码，并从命令提示符运行该脚本。你应该能看到图中的论点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ms"><img src="../Images/eb993a799ef99ba63fb99555b41d21b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMJJ8AqZAzgqFk2Y2LIH2A.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">npx-cli-package 将参数打印到 cmd 输出中</figcaption></figure><p id="d757" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是，有一个问题。我在没有任何参数的情况下运行了这个脚本，但是它打印了两个默认的参数。我会传递更多的。它们将被提取并打印出来。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mt"><img src="../Images/2e90407eca3c7db2b7096aa6878692e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSQHU62OJb-br0TxkACMeg.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">另外两个参数被打印出来</figcaption></figure><h1 id="8418" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">对于纱线用户</h1><p id="87bf" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我有一个纱线连接的问题，因为它不起作用。我在谷歌上搜索解决方案，但没有找到。但是，我发现如果我从本地目录安装包，我可以运行脚本| CLI。</p><p id="63d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建另一个目录，并将其命名为相同的名称，但是在名称后面附加 test。我建议您将它创建为另一个的邻居，因为这对您来说更容易。</p><p id="a59b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对我来说，就像下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/fe18a30b1ccc108440c41f7f44751b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*AaYDxl76V469d_5JOFBKfA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">创建另一个目录来测试脚本| CLI</figcaption></figure><p id="6948" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是，您可以将测试目录放在任何地方。当我运行纱线添加时，我将使用它的绝对路径。</p><p id="0266" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">打开测试目录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/0a962e06462118324671a8c117358a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRrj7QQ4So1vTs1U2g9Fow.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">测试目录已打开</figcaption></figure><p id="a106" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行纱线初始化命令。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="6846" class="mj kv in mf b gy mk ml l mm mn">yarn init -y</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/28b0bec394c0fad959e5cf2fb8f6fb88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMcl3VbokxPgjDn1wjL9dg.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">纱线初始化-y 命令</figcaption></figure><p id="b8ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用脚本| CLI 的绝对路径运行 Yarn 安装。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mw"><img src="../Images/041a40dc49ee1bd1307cc0944d178be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7HLIoWdAsSFfhlcXv6R-w.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">纱线添加<absolute_path_to_the_package> —错误</absolute_path_to_the_package></figcaption></figure><p id="6ebf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你跟着我做，你应该会有同样的错误。我必须带着代码回到 script | CLI 包。在包 JSON 文件中，我将添加 version 属性。Yarn 因为不知道版本所以无法安装。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mp"><img src="../Images/5c29f8e1dce823ae1847684dae4c53ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nZTi3a1IjogsCtwyASvHQ.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">npx-CLI-软件包</figcaption></figure><p id="4d5d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行纱线添加它应该工作了。</p><p id="3fb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="mx">重要提示:</em> </strong>使用绝对路径。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/c4d36a33866d2fec252e36583102c291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkMFlcQjyKbxyeatZVKxQw.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">加纱<absolute_path_to_the_package> —成功</absolute_path_to_the_package></figcaption></figure><p id="cb15" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从命令提示符运行脚本| CLI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/a7d9e6332b211020ec23a6584640ff60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7OSF4RzZGyOcu1WaWl2OWA.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">从测试目录运行脚本</figcaption></figure><p id="a83a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="mx">重要提示:</em> </strong></p><ul class=""><li id="8b01" class="my mz in jm b jn jo jr js jv na jz nb kd nc kh nd ne nf ng bi translated">脚本| CLI 仍然必须使用 npx 命令运行。</li><li id="c741" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated">另一种方法是添加脚本| CLI 来打包 JSON 脚本。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/91096d3572e633a8b18b22a9b6f3d0b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8RlfP5U7xpr7NLRCQFfogw.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">使用包 JSON 中的脚本运行包</figcaption></figure><h1 id="246c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">包含代码的存储库</h1><p id="606c" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">你可以在这个库中找到代码:<a class="ae lx" href="https://github.com/srele96/npx-cli-package" rel="noopener ugc nofollow" target="_blank">https://github.com/srele96/npx-cli-package</a>。</p><p id="804f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="mx">重要提示:</em> </strong>我没有为我使用 Yarn 的目录创建一个存储库。我使用绝对路径安装了 CLI 包。在本地机器上运行 Yarn install 将会失败。那是因为我的绝对路径极不可能存在于你的机器上。</p></div></div>    
</body>
</html>