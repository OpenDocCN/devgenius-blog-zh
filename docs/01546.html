<html>
<head>
<title>Using SQL in Python and Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python和Jupyter笔记本中使用SQL</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-sql-in-python-and-jupyter-notebook-457768b45b71?source=collection_archive---------7-----------------------#2020-07-06">https://blog.devgenius.io/using-sql-in-python-and-jupyter-notebook-457768b45b71?source=collection_archive---------7-----------------------#2020-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="826f" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">入门</strong></h1><p id="92e9" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我会很简短——这篇文章背后的想法是简单地向您展示如何编写sql来操作您的数据。如果你只是不知道如何编写那段<code class="fe lg lh li lj b">pandas</code>代码，但你是sql方面的专家——这里有几个步骤让你开始。</p><ul class=""><li id="b0de" class="lk ll in kk b kl lm kp ln kt lo kx lp lb lq lf lr ls lt lu bi translated">在python程序中编写sql，除了这个方法之外，还有很多方法。这个方法将讨论<code class="fe lg lh li lj b">pandasql</code>。</li></ul><h1 id="240d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">导入库和数据</h1><p id="e016" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这些都上传到了我的github上——只需将repo和cd复制到那个目录中。</p><pre class="lw lx ly lz gt ma lj mb mc aw md bi"><span id="31d4" class="me jl in lj b gy mf mg l mh mi">#import the libraries<br/>import pandas as pd<br/>import pandasql as ps</span><span id="be3a" class="me jl in lj b gy mj mg l mh mi">#display options<br/>pd.set_option('display.max_rows', 500)<br/>pd.set_option('display.max_columns', 500)<br/>pd.set_option('display.width', 1000)</span><span id="c0e4" class="me jl in lj b gy mj mg l mh mi">#import the csv<br/>df = pd.read_csv('austin_cases.csv')</span></pre><h1 id="aa5d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">普通熊猫命令/代码</h1><p id="a683" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我相信你已经习惯于看到正常熊猫代码是什么样子了。这是我为了演示<code class="fe lg lh li lj b">pandasql</code>而写的一个非常小的笔记本的片段:</p><pre class="lw lx ly lz gt ma lj mb mc aw md bi"><span id="e42b" class="me jl in lj b gy mf mg l mh mi">#add a first letter column because it's hard to do in pandasql<br/>df['first_letter'] = df['County_Name'].astype(str).str[0]</span><span id="40e6" class="me jl in lj b gy mj mg l mh mi">#dropna<br/>df = df[df['County_Name'].notna()]</span><span id="3f26" class="me jl in lj b gy mj mg l mh mi">#convert population dtype<br/>df = df.replace(',','', regex=True)<br/>df['Population'] = df.Population.astype(int)</span></pre><p id="ff76" class="pw-post-body-paragraph ki kj in kk b kl lm kn ko kp ln kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">您正在创建变量、向您的<code class="fe lg lh li lj b">df</code>添加列、替换字符、重置索引等等。但是当你需要<code class="fe lg lh li lj b">rank over partition</code>或者<code class="fe lg lh li lj b">case when</code>什么的时候，你会怎么做呢？如果你是初学者，困难的方法是搜索你想写的代码，希望你问的问题足够具体，以至于弹出一些stackoverflow帖子。简单的作弊方式(因为你真的应该学习如何在python中做到这一点，但我明白，有时你只是没有时间去学习它的新功能)。</p><h1 id="50a8" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建查询变量并编写SQL:</h1><p id="3612" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我不打算过多地讨论这个查询——假设您正在尝试用python编写sql，您可能已经知道如何编写sql了。但是有一些排名，<code class="fe lg lh li lj b">case whens,</code>子查询，分组，排序功能等。在查询中。Pandasql非常健壮——你可以用任何其他sql语言做任何你能做的事情(至少对于<code class="fe lg lh li lj b">select</code>语句)。我没有和<code class="fe lg lh li lj b">inserts</code> <code class="fe lg lh li lj b">deletes</code>等乱七八糟。</p><pre class="lw lx ly lz gt ma lj mb mc aw md bi"><span id="40a2" class="me jl in lj b gy mf mg l mh mi">##sql time<br/>select_query = """<br/>select<br/>    df.County_Name as county_name<br/>    ,df.first_letter<br/>    ,df.Population as population<br/>    ,case when df.County_Name = 'Austin' then 'yes' else 'no' end as is_austin --CASE STATEMENTS WORK<br/>    ,case when df1.county_name_joined is not null then 'left_joins_workkkk' else null end as do_joins_work_questionmark --looks like it works to me<br/>    ,rank() over (order by df.Population) as ranked --RANK FUNCTION WORKS<br/>    ,df2.sum_pop<br/>    ,df2.count_beginning_letter_counties<br/>from df df<br/>left join ( --JOINS WORK<br/>    select<br/>        df.County_Name as county_name_joined<br/>        ,df.Population as population_joined<br/>    from df df<br/>    where df.County_Name = 'Austin'<br/>    ) df1 on df.County_Name = df1.county_name_joined<br/>left join (<br/>    select<br/>        df.first_letter<br/>        ,sum(df.Population) as sum_pop<br/>        ,count(df.Population) as count_beginning_letter_counties<br/>    from df df<br/>    group by<br/>        1<br/>    ) df2 on df.first_letter = df2.first_letter<br/>where <br/>    lower(df.County_Name) like 'a%'<br/>        or lower(df.County_Name) like 'b%'<br/>        or lower(df.County_Name) like 'c%'<br/>group by<br/>    1,2,3,4,5<br/>order by<br/>    df.County_Name<br/>--limit 30<br/>"""</span></pre><h1 id="742f" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">调用您的查询变量并打印出来</h1><p id="eaa2" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这是最后一步。这实际上只是三个步骤——导入库真的不应该被认为是一个步骤！使用您的查询创建变量，并调用该变量。然后坐回到你的椅子上，说“好了，儿子”。</p><pre class="lw lx ly lz gt ma lj mb mc aw md bi"><span id="fed4" class="me jl in lj b gy mf mg l mh mi">#display the query results<br/>print(ps.sqldf(select_query, locals()))</span></pre><figure class="lw lx ly lz gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mn"><img src="../Images/892ef55f1240ec474fd0abfc62b57ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQyrW9mjhTQCvoyccti6mg.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">搞定儿子</figcaption></figure><h1 id="770b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="8421" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">随时向我提问。这是非常基本的东西，但无论如何祝你好运！</p><p id="0e06" class="pw-post-body-paragraph ki kj in kk b kl lm kn ko kp ln kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">马克斯·巴德</p></div></div>    
</body>
</html>