<html>
<head>
<title>Redis — Beyond caching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redis —超越缓存</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/redis-beyond-caching-1237058033d?source=collection_archive---------3-----------------------#2022-12-31">https://blog.devgenius.io/redis-beyond-caching-1237058033d?source=collection_archive---------3-----------------------#2022-12-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="3aad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最受欢迎的数据库— SOF</p><p id="f8a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">是<strong class="jm io">Re</strong>mote<strong class="jm io">Di</strong>dictionary<strong class="jm io">S</strong>server 的简称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e102ccaba749f9040305d9d7fab97ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qIy3PMmEWNcD9Czh_21C8g.png"/></div></div></figure><p id="9e24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Redis 是一个快速、开源、内存中的键值(NoSQL)数据库。Redis 使用 RAM，提供亚毫秒级的响应时间，每秒可以处理数百万个请求。Redis 主要用于缓存，但对于数据变化不太频繁的应用程序，它甚至可以用作主数据库。Redis 有内置的复制、服务器端脚本(带 Lua)脚本、LRU 驱逐、定时过期和事务。</p><p id="7e72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Redis 的使用案例包括:</p><ul class=""><li id="f6c3" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated">数据投影服务</li><li id="2d14" class="ku kv in jm b jn ld jr le jv lf jz lg kd lh kh kz la lb lc bi translated">短暂消息代理</li><li id="6a8b" class="ku kv in jm b jn ld jr le jv lf jz lg kd lh kh kz la lb lc bi translated">事件来源系统</li></ul><p id="a1c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注:Redis 是用 c 写的</em></p><h2 id="aa9c" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">Redis 为什么快？</h2><ul class=""><li id="0254" class="ku kv in jm b jn mc jr md jv me jz mf kd mg kh kz la lb lc bi translated">Redis 是基于 RAM 的。RAM 访问比随机磁盘访问快。</li><li id="91ee" class="ku kv in jm b jn ld jr le jv lf jz lg kd lh kh kz la lb lc bi translated">IO 多路复用和单线程执行循环提高了执行效率。</li><li id="6f33" class="ku kv in jm b jn ld jr le jv lf jz lg kd lh kh kz la lb lc bi translated">高效的低层数据结构(SDS、ZipList、SkipList、分层索引)</li></ul><h2 id="7cce" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">在 Linux 上安装</h2><p id="eec7" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">用以下内容创建文件<code class="fe mk ml mm mn b">/etc/yum.repos.d/redis.repo</code>。</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="c67f" class="ms lk in mn b be mt mu l mv mw">[Redis]<br/>name=Redis<br/>baseurl=http://packages.redis.io/rpm/rhel7<br/>enabled=1<br/>gpgcheck=1</span></pre><p id="3529" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后运行以下命令:</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="b1a0" class="ms lk in mn b be mt mu l mv mw">curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key<br/>sudo rpm --import /tmp/redis.key<br/>sudo yum install epel-release<br/>sudo yum install redis-stack-server</span></pre><h2 id="ec39" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">高级 CLI 命令</h2><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="ef04" class="ms lk in mn b be mt mu l mv mw">$ redis-cli <br/>INFO - info about cluster<br/>SELECT - to select the namespace / database<br/>DBSIZE - number of keys<br/>KEYS * - list all keys (pattern) (prefer scan)<br/>SCAN - Returns subset of results with cursor <br/>EXISTS - check if key exists<br/>TYPE - check data type of key<br/>EXPIRE - set expiration of key <br/>RENAME - Rename a key to new name<br/>FLUSHDB - clear all keys from namespace<br/>FLUSHALL - clear all keys from all namespace<br/>ROLE - checks nodes role, master, slave, sentinel<br/>CLAER - clear cli context terminal<br/>QUIT - get out of cli<br/><br/>&gt;&gt; redis-cli --pipe #stream commands to redis from file or stdin<br/>&gt;&gt; redis-cli --hotkeys</span></pre><h2 id="993e" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">关于一些命令的几点</h2><ul class=""><li id="57ba" class="ku kv in jm b jn mc jr md jv me jz mf kd mg kh kz la lb lc bi translated">Redis 数据库是为键创建隔离和命名空间的逻辑方法。默认情况下，Redis 有 0-15 个数据库索引。在集群模式下，这些数据库不存在。</li></ul><blockquote class="mx my mz"><p id="9adb" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">选择索引号</p></blockquote><ul class=""><li id="08a8" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated">通常会给命令添加以下后缀。然后，这些命令会根据该键的存在进行操作</li></ul><blockquote class="mx my mz"><p id="ca21" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">NX —如果不存在<br/> XX —如果存在</p></blockquote><p id="2280" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:</em> <code class="fe mk ml mm mn b"><strong class="jm io"><em class="li">M</em></strong></code> <em class="li">加在命令前面一般表示多。MGET 对掘地。同样，前面加一个</em> <code class="fe mk ml mm mn b"><strong class="jm io"><em class="li">P</em></strong></code> <em class="li">表示基于模式的命令。</em></p><ul class=""><li id="27d4" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated">KEYS 命令是顺序的[O(n)] &amp;同步的[阻塞]。在你的应用程序中优先扫描按键。</li></ul><blockquote class="mx my mz"><p id="f9fb" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated"><a class="ae nd" href="https://redis.com/redis-enterprise/redis-insight/" rel="noopener ugc nofollow" target="_blank"> RedisInsight </a> —这是一个使用 Redis 服务器的 UI。</p></blockquote><h2 id="2628" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">试用 Redis 的链接</h2><blockquote class="mx my mz"><p id="b155" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated"><a class="ae nd" href="https://try.redis.io/" rel="noopener ugc nofollow" target="_blank">https://try.redis.io/</a>T22<a class="ae nd" href="https://redis.com/try-free/" rel="noopener ugc nofollow" target="_blank">https://redis.com/try-free/</a></p></blockquote><h2 id="198a" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">支持的数据结构</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/55c60ad658ef3a60ee9259b961363799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f96hoFTEAiCt2jCF-s7EmA.png"/></div></div></figure><h2 id="9ce1" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">线</h2><blockquote class="mx my mz"><p id="83d3" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">大多数基本和常见的 Redis 数据类型<br/> Redis 字符串存储字节序列。<br/>最大 512 MB</p></blockquote><pre class="kj kk kl km gt mo mn nf ng aw nh bi"><span id="7352" class="lj lk in mn b gy ni nj l nk mw">SET | GET | DEL <br/>INCR | INCRBY | INCRBYFLOAT<br/>MSET | MGET </span></pre><p id="c614" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:DEL 是阻塞的，而 UNLINK 是非阻塞的</em></p><h2 id="994f" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">目录</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/ab65d1a84434e4a927e10181a1dc6ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-DoC-iO1T8qRKUgd9mEG5A.png"/></div></div></figure><blockquote class="mx my mz"><p id="32f8" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">字符串值链表<br/>元素集合<br/>每个元素都是一个字符串<br/>可以包含&gt;40 亿个元素<br/>元素顺序基于插入顺序<br/>进行编码和内存优化</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="a067" class="ms lk in mn b be mt mu l mv mw">LPUSH | LRANGE | RPUSH | LPOP | RPOP | LLEN<br/>LTRIM | LINDEX | LINSERT | LSET | LPOS | LREM</span></pre><h2 id="9cb2" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">一组</h2><blockquote class="mx my mz"><p id="c8f6" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 集是唯一字符串(成员)的无序集合。这可以用来跟踪唯一的元素。</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="2cae" class="ms lk in mn b be mt mu l mv mw">SADD | SREM | SCARD | SMEMBERS | SDIFF | SDIFFSTORE <br/>SISIMEMBER | SMISMEMBER | SMOVE | SPOP</span></pre><h2 id="52dd" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">混杂</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/ab35ee32eadacb1ce49a58296365ffa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBB3vFuBYooNrPuS-Fnz9Q.png"/></div></div></figure><blockquote class="mx my mz"><p id="0279" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 散列是结构化为字段-值对集合的记录类型。<br/>每个哈希最多可以存储 4，294，967，295(2-1)个字段-值对。哈希可用于存储应用程序中的会话和配置文件。</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="4990" class="ms lk in mn b be mt mu l mv mw">HSET | HGET | HGETALL | HDEL | HEXIST | HMSET | HMGET</span></pre><h2 id="f59b" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">排序集合</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/af60107d5b767e6296f01a085947a333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*CkISVoBW8dIyC4YOu9005Q.png"/></div></figure><blockquote class="mx my mz"><p id="e721" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 排序集是按相关分数排序的唯一字符串(成员)的集合。它可用于排行榜、优先级队列、二级索引和限速器。</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="5d15" class="ms lk in mn b be mt mu l mv mw">ZADD | ZCARD | ZSCORE | ZRANK | ZREVRANK | ZREM | ZRANGE</span></pre><h2 id="adf3" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">超对数</h2><blockquote class="mx my mz"><p id="df77" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">超对数是一种估计集合基数的数据结构。它可以用来跟踪独特的访问者数量。超对数实现使用高达 12 KB。</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="e2dd" class="ms lk in mn b be mt mu l mv mw">PFADD | PFCOUNT | PFMERGE</span></pre><h2 id="6330" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">流</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/e77ca4ddfe85538b49bae152aab98928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NRb5TeJ34Jf08do8OzGxg.png"/></div></div></figure><p id="0c70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Redis 流是一种数据结构，其作用类似于只附加日志。您可以使用流来实时记录并同时整合事件。</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="0225" class="ms lk in mn b be mt mu l mv mw">XADD | XREAD | XTRIM | XDEL<br/>XGROUP CREATE | XGROUP DESTROY | XREADGROUP<br/>XGROUP CREATECONSUMER | XGROUP DELCONSUMER<br/></span></pre><p id="b00d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Redis Streams 允许最多一次或至少一次。Redis 流允许同步和异步读取。</p><h2 id="16d4" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">位图</h2><p id="3b31" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">Redis 位图是 string 数据类型的扩展，允许您将字符串视为位向量。</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="e5d6" class="ms lk in mn b be mt mu l mv mw">BITOP | BITPOS | BITCOUNT</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/7529885544902f51877ce947239ffbbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QZ7buW1SRfDIeccgmiXxGw.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图片来源—bytebytego.com</figcaption></figure><h2 id="ce0e" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">位域</h2><p id="5c43" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">Redis 位域允许您设置、递增和获取任意位长的整数值。</p><h2 id="f7f0" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">地理空间的</h2><blockquote class="mx my mz"><p id="aa9a" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 地理空间索引允许您存储坐标并进行搜索。在给定的半径或边界框内寻找附近的点。</p></blockquote><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="1661" class="ms lk in mn b be mt mu l mv mw">GEOADD | GEODIST | GEORADIUS | GEOSEARCH | GEOPOS</span></pre><ul class=""><li id="7732" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated"><em class="li">雷迪斯使用哈弗辛公式计算距离。</em></li><li id="bd12" class="ku kv in jm b jn ld jr le jv lf jz lg kd lh kh kz la lb lc bi translated"><em class="li"> Redis 将地理空间点存储在有序集合中。这些组的分数用于编码坐标对。</em></li></ul><h2 id="b350" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">密钥过期</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/473730b1570898765363d72f1402e235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tf8z_SgKoz69y4sXtpwIxg.png"/></div></div></figure><blockquote class="mx my mz"><p id="1bb2" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">EX —给定秒后过期<br/> PX —给定毫秒后过期<br/> EXAT —时间戳时过期(秒)<br/> PXAT —时间戳时过期(毫秒)<br/> TTL —密钥剩余的大致寿命<br/> PERSIST —删除当前过期时间</p></blockquote><h2 id="2581" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">管道铺设</h2><p id="a591" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">Redis 遵循客户机-服务器模型。客户端发送请求，服务器处理请求并返回响应。吞吐量主要由往返时间决定(通常以毫秒为单位，请求处理通常以微秒为单位)。Redis 管道技术是一种提高性能的技术，它一次发出多个命令，而无需等待每个命令的响应。这是一种网络优化，因为我们减少了客户端和服务器之间的多次往返。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/09a6a9c3d688a8188b0e8f7756607adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*28YYGTWdlbCIKMVw3j4nrA.png"/></div></div></figure><p id="2499" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注:1。管道不保证命令的执行顺序。2.</em> <code class="fe mk ml mm mn b"><em class="li">Writes</em></code> <em class="li">后接</em> <code class="fe mk ml mm mn b"><em class="li">Reads</em></code> <em class="li">在一个流水线内是不可能的，因为所有命令的结果最终会聚集在一起。3.在进行流水线操作时，我们需要使用散列标签，这样我们可以强制将键映射到同一个碎片上。4.管道不是原子的。5.Python 库管道被包装成</em> <code class="fe mk ml mm mn b"><em class="li">MULTI/EXEC</em></code> <em class="li">。</em></p><h2 id="e0e6" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">脚本</h2><p id="c759" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">调用服务器端 Lua 脚本的执行。</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="98f8" class="ms lk in mn b be mt mu l mv mw">SCRIPT LOAD | FUNCTION LOAD | EVAL | FCALL | FUNCTION KILL | SCRIPT KILL</span></pre><p id="e47a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:Lua 脚本是原子的&amp;阻塞。</em></p><h2 id="d46a" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">发布/订阅</h2><p id="ff64" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">Redis 使用发布/订阅提供了一个解耦的消息传递范例。发布者将消息发送到通道中，订阅者确认他们对一个或多个通道的兴趣，并接收感兴趣的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/caab107d5ebd976f3e3d636d89cedc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tV8vZ9MMnYPok7PiTKKjyQ.png"/></div></div></figure><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="0d14" class="ms lk in mn b be mt mu l mv mw">SUBSCRIBE | PUBLISH | PUBSUB CHANNELS | UNSUBSCRIBE</span></pre><p id="65a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:发布/订阅与密钥空间无关。</em></p><h2 id="e06b" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">处理</h2><p id="7151" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">Redis 事务允许在单个步骤中执行一组命令，它们以下列命令为中心:</p><blockquote class="mx my mz"><p id="cee1" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">MULTI —事务开始<br/> EXEC —事务结束<br/> DISCARD —退出事务<br/> WATCH —继续检查自我们开始监视<br/> UNWATCH 以来密钥是否已被修改</p></blockquote><p id="49a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">事务中的所有命令都被序列化并按顺序执行。在 Redis 事务的执行过程中，不会处理另一个客户机发送的请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/654c942b6588c28377c7d755f10c5f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLHM_sFayUdEoT3AOKs5tg.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">时间复杂度</figcaption></figure><h2 id="0c82" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">分布式锁—红锁</h2><p id="4a1c" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated"><code class="fe mk ml mm mn b">Redlock</code>是一个安全可靠的锁，用于协调对跨线程、进程甚至机器共享的资源的访问，没有单点故障。Python 红锁实现:</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="0a8b" class="ms lk in mn b be mt mu l mv mw">from pottery import Redlock<br/>my_demo_key_lock = Redlock(key='my_demo_key', masters={redis}, auto_release_time=.2)<br/>with my_demo_key_lock:<br/>    # do operation here<br/>    print('my_demo_key is locked')<br/><br/># Async version<br/><br/>import asyncio<br/>from redis.asyncio import Redis as AIORedis<br/>from pottery import AIORedlock<br/><br/>asyncio.set_event_loop(asyncio.new_event_loop())<br/>async def main():<br/>    aioredis = AIORedis.from_url('redis://localhost:6379/1')<br/>    my_async_key_lock = AIORedlock(key='my_async_key', masters={aioredis})<br/>    async with my_async_key_lock:<br/>        # Critical section - no other coroutine can enter while we hold the lock.<br/>        print(f"Key is {'occupied' if await my_async_key_lock.locked() else 'available'}")<br/>    print(f"Key is {'occupied' if await my_async_key_lock.locked() else 'available'}")<br/><br/>asyncio.run(main(), debug=True)<br/></span></pre><h2 id="5a51" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">重要的配置文件</h2><blockquote class="mx my mz"><p id="a05a" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">redis . conf<br/>sentinel . conf<br/>。rediscli_history</p></blockquote><h2 id="bfea" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">使用 python 与 Redis 交互</h2><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="d277" class="ms lk in mn b be mt mu l mv mw"># pip install redis<br/><br/>import redis, json<br/><br/>def redis_connect():<br/>    try:<br/>        client = redis.Redis(host="localhost",port=6379,db=0,socket_timeout=5,)<br/>        ping = client.ping()<br/>        if ping is True:<br/>            return client<br/>    except redis.AuthenticationError:<br/>        print("AuthenticationError")<br/>        sys.exit(1)<br/><br/>redis_client = redis_connect()<br/><br/>my_value = redis_client.get('my_key')<br/>redis_client.set('new_key', json.dumps({'hello' : 'redis'}))</span></pre><h2 id="3e77" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">Redis 模块</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/3394e6618f28a34253a1f681dedfe4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNzMcsNGooE_f3mRL45ukw.png"/></div></div></figure><p id="1626" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Redis 在单个数据库中支持多种数据格式。它遵循模块化的方法来处理不同的数据类型。通过添加一个新的模块，我们确保特定的数据类型以本机方式得到支持。</p><blockquote class="mx my mz"><p id="6194" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">redis 搜索—对 Redis 进行查询、二级索引和全文搜索<br/> Redis JSON —在 Redis 中添加 JSON 作为第一类数据类型<br/> Redis Bloom —概率 DS (Bloom filter，Count Min Sketch，t-digest) <br/> Redis 图形—图形数据库支持<br/> Redis 时间序列—在 Redis 中添加时间序列数据支持</p></blockquote><p id="236e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="li">注意:亚马逊 ElastiCache for Redis 不提供对 Redis 模块的支持</em>。</p><h2 id="43e3" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">坚持</h2><p id="1657" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">在 Redis 中，如果启用，数据将持久存储到磁盘。当它重新启动时，它将数据加载到内存中进行计算。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/4f45ffa4e5eda05b63fe8dbd642674dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r497z2Kjtg3iEa12LmDHsw.png"/></div></div></figure><blockquote class="mx my mz"><p id="3261" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">RDB —特定时间间隔的时间点快照<br/> AOF —记录每个写操作、每秒同步、后台线程的日志，以备恢复时重放</p></blockquote><p id="ef1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:您可以通过发出 BGSAVE 命令来手动拍摄快照</p><h2 id="98c3" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">高可用性和故障转移</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/ae5c0c8ab36ebc1bbf88262e7a0b9ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbcQV2_hZtB6ZhUNrdsbNw.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图片来自<a class="ae nd" href="https://architecturenotes.co/redis/" rel="noopener ugc nofollow" target="_blank">https://architecturenotes.co/redis/</a></figcaption></figure><blockquote class="mx my mz"><p id="3b8a" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 副本<br/> Redis 哨兵<br/> Redis 集群</p></blockquote><h2 id="0ce3" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">缩放比例</h2><blockquote class="mx my mz"><p id="f068" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">群集—主副本+从副本配置<br/>分片—将特定哈希范围(片段)分配给各个节点<br/> CRDT —企业功能</p></blockquote><h2 id="7014" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">一致性</h2><blockquote class="mx my mz"><p id="146d" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">最终一致性—默认<br/>因果一致性—主动主动部署<br/>强一致性—重分发</p></blockquote><h2 id="8605" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">用例</h2><blockquote class="mx my mz"><p id="1049" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">缓存<br/>会话管理<br/>发布-订阅<br/>速率限制<br/> IP 白名单<br/>高速事务</p></blockquote><h2 id="4616" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">Redis 中常见的缓存问题</h2><blockquote class="mx my mz"><p id="e910" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">缓存渗透—不在缓存中，不在数据库中，redis 将缓存具有空<br/>缓存故障的键—不在缓存中，存在于数据库中<br/>缓存雪崩—大量缓存过期</p></blockquote><h2 id="2c94" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">在 K8s 上安装 Redis 集群</h2><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="2d15" class="ms lk in mn b be mt mu l mv mw">$ helm repo add my-repo https://charts.bitnami.com/bitnami<br/>$ helm install my-release my-repo/redis-cluster<br/>$ export REDIS_PASSWORD=$(kubectl get secret --namespace redis staging-redis-cluster -o jsonpath="{.data.redis-password}" | base64 --decode)</span></pre><h2 id="c63d" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">再视</h2><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="ae2d" class="ms lk in mn b be mt mu l mv mw">helm install redisinsight redisinsight-chart-0.1.0.tgz --set service.type=NodePort<br/># Get URL<br/>export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services redisinsight-redisinsight-chart)<br/>export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")<br/>echo http://$NODE_IP:$NODE_PORT </span></pre><p id="41b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在可以使用<code class="fe mk ml mm mn b">http://&lt;endpoint&gt;:&lt;port&gt;</code>访问我们的 RedisInsight UI。我们可以单击<code class="fe mk ml mm mn b">Connect to a Redis Database</code>来配置 Redis 集群属性。一旦连接配置完成，我们将可以访问一个全功能的 web UI 来查看和管理 Redis 集群。</p><h2 id="39a4" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">要监控的指标</h2><p id="699a" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">使用<code class="fe mk ml mm mn b">INFO, SLOWLOG, and LATENCY </code>我们可以跟踪 Redis 的关键数据。</p><blockquote class="mx my mz"><p id="90ae" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">used _ memory<br/>total _ commands _ processed<br/>latency<br/>fragmentation ratio<br/>evictions<br/>CPU wait<br/>复制延迟</p></blockquote><p id="f84b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还可以使用<a class="ae nd" href="https://github.com/oliver006/redis_exporter" rel="noopener ugc nofollow" target="_blank"> Redis exporter </a>向 Prometheus 发布这些指标。</p><pre class="kj kk kl km gt mo mn mp bn mq mr bi"><span id="3178" class="ms lk in mn b be mt mu l mv mw">helm repo add Prometheus-community https://prometheus-community.github.io/helm-charts<br/>helm repo update<br/>helm install my-release prometheus-community/prometheus-redis-exporter</span></pre><h2 id="bb54" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">托管产品:</h2><blockquote class="mx my mz"><p id="4e27" class="jk jl li jm b jn jo jp jq jr js jt ju na jw jx jy nb ka kb kc nc ke kf kg kh ig bi translated">Redis 企业云<br/>scale grid For Redis<br/>AWS elastic cache For Redis<br/>GCP memory store For Redis</p></blockquote><h2 id="456e" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">使用 Redis 的公司？</h2><p id="83f2" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated"><a class="ae nd" href="http://www.infoq.com/presentations/Real-Time-Delivery-Twitter" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae nd" href="https://github.com/blog/530-how-we-made-github-fast" rel="noopener ugc nofollow" target="_blank"> GitHub </a>，<a class="ae nd" href="http://engineering.pinterest.com/post/55272557617/building-a-follower-model-from-scratch" rel="noopener ugc nofollow" target="_blank"> Pinterest </a>，<a class="ae nd" href="https://twitter.com/robustcloud/status/448503100056535040" rel="noopener ugc nofollow" target="_blank"> Snapchat </a>，<a class="ae nd" href="http://meta.stackoverflow.com/questions/69164/does-stackoverflow-use-caching-and-if-so-how/69172" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>，<a class="ae nd" href="http://code.flickr.com/blog/2011/10/11/talk-real-time-updates-on-the-cheap-for-fun-and-profit/" rel="noopener ugc nofollow" target="_blank"> Flickr </a>，<a class="ae nd" href="https://www.atlassian.com/engineering/reducing-jql-database-load-with-caches" rel="noopener ugc nofollow" target="_blank"> Atlassian </a>，<a class="ae nd" href="http://www.odbms.org/2018/03/verizon-counts-on-redis-enterprise-to-elevate-its-customer-engagement-experience/" rel="noopener ugc nofollow" target="_blank">威瑞森</a>，Trip Advisor，沃达丰</p><h2 id="61dc" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">Redis 的替代方案</h2><p id="5817" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated"><a class="ae nd" href="https://docs.keydb.dev/" rel="noopener ugc nofollow" target="_blank">KeyDB</a><br/><a class="ae nd" href="https://hazelcast.com/" rel="noopener ugc nofollow" target="_blank">hazel cast</a><br/><a class="ae nd" href="https://aerospike.com/" rel="noopener ugc nofollow" target="_blank">气塞</a> <br/> <a class="ae nd" href="https://www.alachisoft.com/ncache/" rel="noopener ugc nofollow" target="_blank"> NCache </a></p><p id="67c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">快乐缓存！！</p></div></div>    
</body>
</html>