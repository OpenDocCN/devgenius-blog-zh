<html>
<head>
<title>Code Smell 88 — Lazy Initialization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味 88 —惰性初始化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/code-smell-88-lazy-initialization-48e1b95a949e?source=collection_archive---------1-----------------------#2021-09-29">https://blog.devgenius.io/code-smell-88-lazy-initialization-48e1b95a949e?source=collection_archive---------1-----------------------#2021-09-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/60b7f12dac09d1a3abfde2cbc53a8a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXgZfisQeWaGqsttGB7xrg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">萨姆·索罗门在<a class="ae jz" href="https://unsplash.com/s/photos/lazy" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="e4e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">又一个过早优化模式</em></p><blockquote class="kz la lb"><p id="8c38" class="ka kb ky kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated"><em class="in">TL；DR:不要使用延迟初始化。请改用对象提供程序。</em></p></blockquote><h1 id="708e" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">问题</h1><ul class=""><li id="d5b0" class="md me in kc b kd mf kh mg kl mh kp mi kt mj kx mk ml mm mn bi translated">令人惊讶的副作用</li><li id="a852" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">过早优化</li><li id="7b51" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">快速违规失败</li><li id="499a" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">实现耦合</li><li id="8f3e" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">最不令人惊讶的违反原则</li><li id="fda7" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">无效用法</li><li id="a14f" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">易变性</li><li id="7465" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">事务性和多线程应用问题</li><li id="9001" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated"><a class="ae jz" href="https://martinfowler.com/bliki/LazyInitialization.html" rel="noopener ugc nofollow" target="_blank">调试问题</a></li></ul><h1 id="8810" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">解决方法</h1><ol class=""><li id="b232" class="md me in kc b kd mf kh mg kl mh kp mi kt mj kx mt ml mm mn bi translated">用第一类对象注入职责</li></ol><h1 id="85fd" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">示例代码</h1><h2 id="c0d3" class="mu lg in bd lh mv mw dn ll mx my dp lp kl mz na lt kp nb nc lx kt nd ne mb nf bi translated">错误的</h2><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="dfef" class="mu lg in nl b gy np nq l nr ns">class Employee<br/>  def emails<br/>    @emails ||= []<br/>  end</span><span id="bda2" class="mu lg in nl b gy nt nq l nr ns">  def voice_mails<br/>    @voice_mails ||= []<br/>  end<br/>end</span></pre><h2 id="9461" class="mu lg in bd lh mv mw dn ll mx my dp lp kl mz na lt kp nb nc lx kt nd ne mb nf bi translated">对吧</h2><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="7cd4" class="mu lg in nl b gy np nq l nr ns">class Employee<br/>  attr_reader :emails, :voice_mails</span><span id="a683" class="mu lg in nl b gy nt nq l nr ns">  def initialize<br/>    @emails = []<br/>    @voice_mails = []<br/>  end<br/>end<br/>#We can also inject a design pattern to externally deal<br/>#with voice_mails so we can mock it in our tests</span></pre><h1 id="5859" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">侦查</h1><ul class=""><li id="dfb8" class="md me in kc b kd mf kh mg kl mh kp mi kt mj kx mk ml mm mn bi translated">惰性初始化是一种常见的模式，用于检查未初始化的变量。</li><li id="056f" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">检测它们应该很简单。</li></ul><h1 id="97ea" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">标签</h1><ul class=""><li id="a84c" class="md me in kc b kd mf kh mg kl mh kp mi kt mj kx mk ml mm mn bi translated">过早优化</li></ul><h1 id="4c0e" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="8f99" class="pw-post-body-paragraph ka kb in kc b kd mf kf kg kh mg kj kk kl nu kn ko kp nv kr ks kt nw kv kw kx ig bi translated"><a class="ae jz" href="https://dev.to/mcsee/singleton-the-root-of-all-evil-50bh" rel="noopener ugc nofollow" target="_blank">单例模式</a>是另一种经常与惰性初始化结合的反模式。</p><p id="7adf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们必须避免过早的优化。如果我们有真正的性能问题，我们应该使用代理、门面或更独立的解决方案。</p><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/code-smell-32-singletons-d6d7b0a9f251"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">代码气味 32 —单件</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">世界上最常用和最著名的设计模式正在给我们带来巨大的伤害。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">blog.devgenius.io</p></div></div><div class="oj l"><div class="ok l ol om on oj oo jt oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/code-smell-12-null-64fbd7792a7c"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">代码气味 12 —空</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">程序员使用 Null 作为不同的标志。它可以提示缺席、未定义的值、错误等。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">blog.devgenius.io</p></div></div><div class="oj l"><div class="op l ol om on oj oo jt oa"/></div></div></a></div><h1 id="c8ba" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">更多信息</h1><ul class=""><li id="fa62" class="md me in kc b kd mf kh mg kl mh kp mi kt mj kx mk ml mm mn bi translated"><a class="ae jz" href="https://en.wikipedia.org/wiki/Lazy_initialization" rel="noopener ugc nofollow" target="_blank">维基百科</a></li><li id="f637" class="md me in kc b kd mo kh mp kl mq kp mr kt ms kx mk ml mm mn bi translated">马丁·福勒</li></ul></div><div class="ab cl oq or hr os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ig ih ii ij ik"><blockquote class="kz la lb"><p id="3cb6" class="ka kb ky kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated"><em class="in">我们要停止为程序员优化，开始为用户优化。</em></p></blockquote><p id="eec9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">杰夫·阿特伍德</p><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/software-engineering-great-quotes-3af63cea6782"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">软件工程名言</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">blog.devgenius.io</p></div></div><div class="oj l"><div class="ox l ol om on oj oo jt oa"/></div></div></a></div></div><div class="ab cl oq or hr os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ig ih ii ij ik"><p id="defc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文是 CodeSmell 系列的一部分。</p><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">如何找到你的代码中有问题的部分</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">blog.devgenius.io</p></div></div><div class="oj l"><div class="oy l ol om on oj oo jt oa"/></div></div></a></div></div></div>    
</body>
</html>