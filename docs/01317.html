<html>
<head>
<title>The New Photos Picker in iOS 14 - Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 14中新的照片拾取器-第1部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/the-new-photos-picker-in-ios-14-part-1-c15e4820b335?source=collection_archive---------1-----------------------#2020-06-30">https://blog.devgenius.io/the-new-photos-picker-in-ios-14-part-1-c15e4820b335?source=collection_archive---------1-----------------------#2020-06-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3d65" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">iOS 14带来了一个新的图像拾取器，具有更新的用户界面和功能。让我们探索这个API带来的令人兴奋的新特性和更新，以及如何使用它。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/356792c5d3d98fdf49fc4fbf30cfe7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nsdapYI0cZGGEbYqs3TSSw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">照片由<a class="ae ks" href="https://unsplash.com/@invictar1997?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Soragrit Wongsa </a>在<a class="ae ks" href="/s/photos/photo-collection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="7ffb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">iOS 14推出了新的PHPickerViewController API，用于从iPhones照片库中拾取图像、实时照片和视频。这个API是PhotoKit的一部分，属于PhotosUI框架。这个picker立即<strong class="kv io">用<strong class="kv io"> </strong> UIImagePickerController解决了一个老问题</strong>,即<strong class="kv io">不能一次挑选/选择多个资产</strong>!允许多重选择是这个API的最大特点，这将迫使所有开发人员更新他们的代码，并使用这个选择器，而不是UIImagePickerController或其他第三方库。不仅如此，我们还可以选择<strong class="kv io">搜索图片</strong>，就像我们在iPhone的照片应用中所做的那样。让我们探索一下所有这些新API都提供了什么。</p><h2 id="810f" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated"><strong class="ak">新提货人的隐私</strong></h2><p id="38c4" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">在WWDC20会议<a class="ae ks" href="https://developer.apple.com/videos/play/wwdc2020/10652/" rel="noopener ugc nofollow" target="_blank"> 10652:认识新的照片拾取器</a>中提到，该拾取器在主机应用程序进程之外运行，主机应用程序无法访问。只有用户选择的内容才会与主机应用程序共享。还提到主机应用程序将无法对该选取器的内容进行截图。<strong class="kv io">我试图以编程方式对这个呈现的选取器视图进行截图</strong>，但是<strong class="kv io">它没有在截图</strong>中呈现任何内容。另外对于那些不清楚的人来说，即使在iOS 14中也可以对UIImagePickerViewControllers内容进行截图(<strong class="kv io">我试过了！</strong>)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/e7c7564bf9ce398730c773230ed8912e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVc-NLZywkQbY3wI4D8yGg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">WWDC20会议<a class="ae ks" href="https://developer.apple.com/videos/play/wwdc2020/10652/" rel="noopener ugc nofollow" target="_blank"> 10652:认识新的照片挑选者</a></figcaption></figure><h2 id="6023" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated"><strong class="ak">新拾取器的用户界面</strong></h2><div class="kd ke kf kg gt ab cb"><figure class="mo kh mp mq mr ms mt paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/59b43d4d18260823fd0f9728dcfafdda.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*w2GQZcrj19uSyQB4NkhNHQ.png"/></div></figure><figure class="mo kh mp mq mr ms mt paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/a7e14812f56cb5f79b710183bbfc64ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*3Fb5MFOfy-E7RcQI3PKTgg.png"/></div></figure><figure class="mo kh mp mq mr ms mt paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/7ff9b8d615805430f571afdf26ebc4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zsbPXupzlM1tCbo3mBh84Q.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk mu di mv mw translated">新照片拾取器的用户界面</figcaption></figure></div><p id="7e06" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">新Picker的UI就是这样的，是不是很棒？我们可以选择所有的照片或相册，一个“添加”按钮，一个“取消”按钮和一个搜索栏。只有当我们指定选择多张照片时，添加按钮才会出现，我们还可以通过收缩来调整网格，以放大和缩小。在继续之前，我们必须注意到<strong class="kv io">该API处于测试阶段</strong>并且仍在开发中，因此这不是最终版本，可能会在测试阶段进行修改。</p><h2 id="5fae" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated"><strong class="ak">使用PHPickerViewController </strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/c4b6e0aedaf90c003d26f9ce5d7bd25d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CvXJBARg4y5SwQfMfXorQQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">仍然来自WWDC20会议<a class="ae ks" href="https://developer.apple.com/videos/play/wwdc2020/10652/" rel="noopener ugc nofollow" target="_blank"> 10652:认识新的照片拾取器</a></figcaption></figure><p id="ed57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">PHPickerViewController将PHPickerConfiguration作为初始化参数和实例属性。首先要创建PHPickerConfiguration的实例或引用。</p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="04ae" class="lp lq in mz b gy nd ne l nf ng">// Create configuration for photo picker<br/><strong class="mz io">var configuration = PHPickerConfiguration()</strong></span></pre><p id="cba1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里需要考虑两个主要属性，<strong class="kv io">过滤器</strong>和<strong class="kv io">选择限制</strong>。Filter属性告诉选取器要显示哪种资产以供选择。该属性是可选的，类型为PHPickerFilter。如果没有指定任何过滤器，它显示所有媒体类型，即图像，现场照片和视频。</p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="9be0" class="lp lq in mz b gy nd ne l nf ng">// Specify type of media to be filtered or picked. Default is all<br/><strong class="mz io">configuration.filter = .images</strong></span></pre><p id="1b57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该过滤器的组合可以指定如下</p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="f002" class="lp lq in mz b gy nd ne l nf ng"><strong class="mz io">configuration.filter = .any(of: [.images,.livePhotos,.videos])</strong></span></pre><p id="0abb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">selectionLimit属性以整数为值，该值应为<strong class="kv io"> ≥ 0 </strong>。当前指定负整数<strong class="kv io">值</strong>导致应用<strong class="kv io">崩溃。该属性的默认值为1，这意味着只能选择1项资产。如果设置为0，它可以选择无限的图像(它做到了，我尝试选择我的照片库中的所有图像，它的工作！).为该属性设置一个特定的数字将导致选择限制在设定的范围内。</strong></p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="9d75" class="lp lq in mz b gy nd ne l nf ng">// For unlimited selections use 0. Default is 1<br/><strong class="mz io">configuration.selectionLimit = 1</strong></span></pre><p id="dd32" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们已经准备好实例化我们的新选择器并呈现它。</p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="0253" class="lp lq in mz b gy nd ne l nf ng">// Create instance of PHPickerViewController<br/><strong class="mz io">let picker = PHPickerViewController(configuration: configuration)</strong><br/>// Set the delegate<br/><strong class="mz io">picker.delegate = self<br/>// </strong>Present the picker<br/><strong class="mz io">present(picker, animated: true)</strong></span></pre><p id="c683" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里需要注意的一点是，与UIImagePickerViewController不同，我们<strong class="kv io">不需要设置UINavigationControllerDelegate</strong>和PHPickerViewControllerDelegate。现在，当我们已经将选择器设置为呈现所有正确的配置时，就该从这个选择器接收数据并解析它了。要接收数据，首先要实现PHPickerViewControllerDelegate的didFinishPicking方法。</p><pre class="kd ke kf kg gt my mz na nb aw nc bi"><span id="bbc4" class="lp lq in mz b gy nd ne l nf ng"><strong class="mz io">func picker(_ picker: PHPickerViewController, didFinishPicking results: [PHPickerResult])</strong></span></pre><p id="0ceb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如我们所看到的，我们有一个结果对象，它是一个PHPickerResult类型的数组，包含一个NSItemProvider对象。现在我们需要从这个项目提供者那里获取图像。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">使用NSItemProvider对象分析图像的代码</figcaption></figure><p id="bfc8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这正是在WWDC20会议上演示的方式<a class="ae ks" href="https://developer.apple.com/videos/play/wwdc2020/10652/" rel="noopener ugc nofollow" target="_blank"> 10652:认识新的照片拾取器</a>。这是从NSItemProvider解析图像的演示方式。</p><h2 id="6d2a" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">如何解析livePhoto和Video？</h2><p id="3015" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">由于这篇文章已经变得相当长，我将<strong class="kv io">写另一篇</strong>作为这篇文章的延续，这篇文章将有这个问题的答案以及一个演示项目的链接。我还将在接下来的文章中包括讨论的要点，如-</p><p id="7eb7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">UIImagePickerController会怎么样？</p><p id="03d5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">PHPickerViewController允许通过设备摄像头拍摄照片/视频吗？</p><p id="4e12" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">更新:</strong>本文第二部分发表。你可以在这里查看<a class="ae ks" href="https://medium.com/@aarsh.parekh/the-new-photos-picker-in-ios-14-part-2-f4864b5df837" rel="noopener">T5T7】</a></p></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><blockquote class="nq nr ns"><p id="1b89" class="kt ku nt kv b kw kx jo ky kz la jr lb nu ld le lf nv lh li lj nw ll lm ln lo ig bi translated">如果你想雇我做app开发，可以从<a class="ae ks" href="https://www.fiverr.com/aarsh_parekh" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">这里</strong> </a></p></blockquote></div></div>    
</body>
</html>