<html>
<head>
<title>Server-Side Development with Fastify â€” Middleware and Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨ Fastify è¿›è¡ŒæœåŠ¡å™¨ç«¯å¼€å‘â€”â€”ä¸­é—´ä»¶å’Œé’©å­</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/server-side-development-with-fastify-middleware-and-hooks-ca36fbcececa?source=collection_archive---------2-----------------------#2021-02-24">https://blog.devgenius.io/server-side-development-with-fastify-middleware-and-hooks-ca36fbcececa?source=collection_archive---------2-----------------------#2021-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1234b1ecd8e20c546d723d095499ac45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lADRcPH5-gckp7l9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kc" href="https://unsplash.com/@emileseguin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">ç±³å‹’Â·å¡ç”˜Â·ğŸ‡¨ğŸ‡¦</a>åœ¨<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="49ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fastify æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘åç«¯ web åº”ç”¨ç¨‹åºçš„å°å‹èŠ‚ç‚¹æ¡†æ¶ã€‚</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Fastify åˆ›å»ºåç«¯åº”ç”¨ç¨‹åºã€‚</p><h1 id="bfe8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ä¸­é—´ä»¶</h1><p id="9d2b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">ä»ç‰ˆæœ¬ 3 å¼€å§‹ï¼ŒFastify æ¡†æ¶å°±ä¸å†æ”¯æŒä¸­é—´ä»¶äº†ã€‚</p><p id="c094" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæˆ‘ä»¬æƒ³å¢åŠ å¯¹ Express é£æ ¼ä¸­é—´ä»¶çš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…<code class="fe me mf mg mh b">fastify-express</code>æˆ–<code class="fe me mf mg mh b">middle</code>æ’ä»¶ã€‚</p><p id="55a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å†™:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="03de" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')()</span><span id="163a" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.register(require('fastify-express'))<br/>    fastify.use(require('cors')())</span><span id="838a" class="mq lc iq mh b gy mv ms l mt mu">    fastify.get('/', function (request, reply) {<br/>      reply.send({ hello: 'world' })<br/>    })</span><span id="7642" class="mq lc iq mh b gy mv ms l mt mu">    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="5075" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬è¡¥å……:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c122" class="mq lc iq mh b gy mr ms l mt mu">await fastify.register(require('fastify-express'))<br/>fastify.use(require('cors')())</span></pre><p id="80c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç”¨<code class="fe me mf mg mh b">cors</code>ä¸­é—´ä»¶æ·»åŠ <code class="fe me mf mg mh b">fastify-express</code>æ’ä»¶ã€‚</p><p id="be72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸ºäº†ä½¿ç”¨<code class="fe me mf mg mh b">middle</code>æ¨¡å—ï¼Œæˆ‘ä»¬ç¼–å†™:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="03f4" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')()</span><span id="c0ac" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.register(require('middie'))<br/>    fastify.use(require('cors')())</span><span id="fff5" class="mq lc iq mh b gy mv ms l mt mu">    fastify.get('/', function (request, reply) {<br/>      reply.send({ hello: 'world' })<br/>    })</span><span id="b3ba" class="mq lc iq mh b gy mv ms l mt mu">    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="b10d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ·»åŠ ä¸­é—´ä»¶ï¼Œæ·»åŠ <code class="fe me mf mg mh b">cors</code>ä¸­é—´ä»¶ã€‚</p><h1 id="e4c8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">å°†ä¸­é—´ä»¶çš„æ‰§è¡Œé™åˆ¶åœ¨ç‰¹å®šçš„è·¯å¾„ä¸Š</h1><p id="0fcf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">æˆ‘ä»¬å¯ä»¥å°†ä¸­é—´ä»¶çš„æ‰§è¡Œé™åˆ¶åœ¨ç‰¹å®šçš„è·¯å¾„ä¸Šã€‚</p><p id="5401" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å†™:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="dde3" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')({})<br/>const path = require('path')</span><span id="7b22" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.register(require('fastify-express'))<br/>    const serveStatic = require('serve-static')</span><span id="3223" class="mq lc iq mh b gy mv ms l mt mu">    fastify.use('/css', serveStatic(path.join(__dirname, '/assets')))<br/>    fastify.use('/css/(.*)', serveStatic(path.join(__dirname, '/assets')))<br/>    fastify.use(['/css', '/js'], serveStatic(path.join(__dirname, '/assets')))</span><span id="30e3" class="mq lc iq mh b gy mv ms l mt mu">    fastify.get('/', function (request, reply) {<br/>      reply.send({ hello: 'world' })<br/>    })</span><span id="fe26" class="mq lc iq mh b gy mv ms l mt mu">    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="a4c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬ç”¨ä¸­é—´ä»¶è¿è¡Œçš„è·¯å¾„ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥è°ƒç”¨<code class="fe me mf mg mh b">fastify.use</code>ã€‚</p><p id="5a34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æƒ³è¦è¿è¡Œçš„ä¸­é—´ä»¶ã€‚</p><p id="52d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ä¸é€‚ç”¨äºå¸¦å‚æ•°çš„è·¯å¾„ã€‚</p><p id="5aee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fastify ä¸ºæœ€å¸¸ç”¨çš„ä¸­é—´ä»¶æä¾›äº†ä¸€äº›æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ç”¨<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/fastify/fastify-helmet" rel="noopener ugc nofollow" target="_blank">fastify-helmet</a></code>ä»£æ›¿<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/helmetjs/helmet" rel="noopener ugc nofollow" target="_blank">helmet</a></code>ï¼Œç”¨<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/fastify/fastify-cors" rel="noopener ugc nofollow" target="_blank">fastify-cors</a></code>ä»£æ›¿<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/expressjs/cors" rel="noopener ugc nofollow" target="_blank">cors</a></code>ï¼Œç”¨<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/fastify/fastify-static" rel="noopener ugc nofollow" target="_blank">fastify-static</a></code>ä»£æ›¿<code class="fe me mf mg mh b"><a class="ae kc" href="https://github.com/expressjs/serve-static" rel="noopener ugc nofollow" target="_blank">serve-static</a></code>ã€‚</p><h1 id="4830" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">é’©ä½</h1><p id="4bca" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">æˆ‘ä»¬å¯ä»¥ç”¨<code class="fe me mf mg mh b">fastify.addHook</code>æ–¹æ³•æ³¨å†Œé’©å­ã€‚</p><p id="1fa3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å†™:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7a87" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')({})<br/>const asyncMethod = () =&gt; Promise.resolve('foo')</span><span id="100d" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    fastify.addHook('onRequest', async (request, reply) =&gt; {<br/>      await asyncMethod()<br/>      return<br/>    })</span><span id="6fec" class="mq lc iq mh b gy mv ms l mt mu">    fastify.get('/', function (request, reply) {<br/>      reply.send({ hello: 'world' })<br/>    })</span><span id="47d4" class="mq lc iq mh b gy mv ms l mt mu">    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="fe11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸º<code class="fe me mf mg mh b">onRequest</code>äº‹ä»¶è°ƒç”¨<code class="fe me mf mg mh b">addHook</code>ã€‚</p><p id="96d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å†™:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e2a3" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')({})<br/>fastify.addHook('onRequest', (request, reply, done) =&gt; {<br/>  done()<br/>})<br/>const start = async () =&gt; {<br/>  try {<br/>    fastify.get('/', function (request, reply) {<br/>      reply.send({ hello: 'world' })<br/>    })</span><span id="b208" class="mq lc iq mh b gy mv ms l mt mu">    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="ca0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åšåŒæ ·çš„äº‹æƒ…ã€‚æˆ‘ä»¬è°ƒç”¨<code class="fe me mf mg mh b">done</code>æ¥æŒ‡ç¤ºé’©å­å·²ç»å®Œæˆè¿è¡Œã€‚</p><h1 id="c323" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ç»“è®º</h1><p id="1910" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">æˆ‘ä»¬å¯ä»¥ç”¨ Fastify æ·»åŠ  Express ä¸­é—´ä»¶å’Œé’©å­ã€‚</p></div></div>    
</body>
</html>