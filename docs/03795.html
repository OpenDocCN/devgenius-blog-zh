<html>
<head>
<title>DevOps — Achieve CI / CD via Jenkins in 15 mins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevOps —通过Jenkins在15分钟内实现CI / CD</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/devops-achieve-ci-cd-via-jenkins-in-15-mins-eddf8e25b0a6?source=collection_archive---------0-----------------------#2020-12-17">https://blog.devgenius.io/devops-achieve-ci-cd-via-jenkins-in-15-mins-eddf8e25b0a6?source=collection_archive---------0-----------------------#2020-12-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/010fffbe2bb7742d31521467c1d2ecdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1i2Ssnj74yNosBWSvG1vw.png"/></div></div></figure><p id="c320" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">CI / CD(持续集成/持续交付)是现代应用开发环境的重要组成部分之一。CI/CD是一种通过在应用程序开发阶段引入自动化来频繁集成和向最终用户交付应用程序的方法。这种方法有助于开发和运营团队以敏捷的方式一起工作。虽然DevOps、敏捷和CI / CD是三个不同的东西，但它们以某种方式粘合在一起，产生了无缝的应用程序开发和交付体验。首先，让我们了解CI和CD的含义，然后我将带您一步一步地通过Jenkins设置CI / CD管道。</p><h1 id="1594" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak"> CI:持续集成</strong></h1><p id="34fa" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">CI / CD的CI部分只是开发代码到主存储库的<em class="lw">常规集成。CI的主要目的是尽早发现集成错误，这些错误可能会导致交付的延迟。在敏捷世界中，每个开发人员在他们自己的特性分支中开发他们的代码，他们定期将这些特性分支集成到主分支中。CI和自动化确保这种集成或合并不会破坏现有的功能。自动化是CI的一个基本要素，没有自动化，您就无法充分发挥CI的威力。通过将CI管道应用于您的应用程序，您可以实现以下目标</em></p><ol class=""><li id="0d79" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">自动代码质量扫描</li><li id="2775" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">发布测试覆盖报告</li><li id="cb11" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">自动代码构建</li></ol><h1 id="956a" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">CD:持续部署</h1><p id="c39b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">CI / CD的CD部分简单来说就是<em class="lw">定期为客户发布代码</em>。CD最小化了部署新代码的工作量，与CI一起，它最小化了发布后潜在失败的风险。在当今的微服务世界中，常规部署和监控很难管理。CD使它变得容易和无摩擦。CI / CD一起在敏捷软件开发中产生最好的ROI。根据<a class="ae ml" href="https://agilemanifesto.org/principles.html" rel="noopener ugc nofollow" target="_blank">敏捷宣言</a>，持续交付也是敏捷软件开发的代码思想之一。</p><blockquote class="mm mn mo"><p id="200c" class="jv jw lw jx b jy jz ka kb kc kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ks ig bi translated"><em class="in">“我们最优先考虑的是通过早期和持续交付有价值的软件来满足客户。”</em></p></blockquote><h1 id="a464" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">没有CI / CD的应用程序开发—传统方法</h1><p id="9530" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">让我们遵循传统的应用程序开发方法，找到可以通过应用CI / CD管道来解决的棘手问题。过去，在大多数组织中，开发和部署是两个独立的部门。开发团队的核心关注点是"<em class="lw">开发"</em>，而部署团队的核心关注点是"<em class="lw">保持生产服务器正常运行，并在最短的停机时间内部署更新"</em>。这种职责分离是传统应用程序开发方法中的首要问题。</p><p id="4dea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">按照传统的非敏捷方法，开发团队基本上由开发人员和QA组成。他们的主要工作是在开发服务器上开发和测试代码。如上所述，软件开发人员倾向于只专注于编写代码。一旦应用程序被编码，它就被移交给问答团队。如果测试人员发现了“bug ”,他们会记录错误，并将它们发回给开发人员进行纠正。一旦应用程序通过了测试阶段，开发团队的目标就实现了，他们将代码移交给部署团队。</p><p id="8200" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">部署团队需要在部署代码之前配置操作系统、执行数据库部署、配置网络和安全性，同时保持生产服务器运行。由于应用程序开发团队大多不了解生产环境的复杂性，这导致了不稳定的产品发布和不必要的推广。</p><p id="4e10" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">CI/ CD在克服职责分离、长发布周期和人工依赖等问题上发挥着关键作用。</p><h1 id="311c" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">用CI / CD开发应用程序——现代敏捷方法</h1><p id="fefb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在使用CI / CD的现代敏捷方法中，开发人员在他们自己的功能分支上开发代码，并在完成后将代码合并到master中。一旦他们将代码合并到主分支，CI / CD就会从那里接收代码。像Jenkins这样的CI / CD工具会收到一个新代码被推/合并到主分支的通知。它从存储库中提取代码，构建所需的工件，并执行自动化来测试代码的集成。如果构建失败，它会向开发人员发送带有问题的电子邮件；如果构建通过，它会部署到生产服务器，无需任何手动干预。</p><p id="0237" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过CI / CD，我们解决了基本的责任问题，因为现在整个团队负责开发和生产部署，即开发运维。这样，我们通过减少每一步的人工干预和协调，将错误发布的风险降至最低。</p><h1 id="c246" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">我们如何实现这一目标:</h1><p id="63bd" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">CI / CD不难实现，但它始于改变团队文化，团队必须开始以敏捷的方式思考。有很多可用的工具，如Jenkins、CircleCI等，通过它们我们可以实现在项目上实施CI / CD的目标。现在，bitbucket还在存储库中提供了“管道”,可以用来实现CI / CD，而无需安装任何第三方软件。本文的目的是提供安装和设置Jenkins以启用CI/CD的步骤，因此让我们首先确定此实施的先决条件。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/68f1199e3c853991b1cef9022f1a0b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8m8uLGCp5XZluzeDyn1OtQ.png"/></div></div></figure><h1 id="d6ea" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">先决条件和假设:</h1><p id="81fc" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我的重点是通过Jenkins在Linux ubuntu机器上安装和实现CI/CD。根据操作系统的不同，步骤和先决条件可能会有所不同。我也在为一个LARAVEL项目写实现CI/CD的文章。其他应用程序的CI / CD实施可能稍有不同，但您仍然可以遵循此指南来获得为任何类型的应用程序定义CI/CD管道的重要知识。请确保在开始前准备好以下先决条件。</p><ol class=""><li id="48ab" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">一台至少有2 GB内存、20 GB可用硬盘、双核CPU和Ubuntu的机器— <em class="lw">用于Jenkins安装和配置</em>。</li><li id="d945" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">bitbucket account — <em class="lw">用于管理bitbucket repository </em>下应用的代码。</li><li id="7a15" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">生产机器——取决于应用程序的规模和用户。(<em class="lw">安装了apache2和MySQL的Ubuntu机器将用作生产服务器。</em>)</li></ol><p id="381e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我假设你对ubuntu安装和服务器管理有基本的了解，所以这篇文章适合中级水平。在我的文章中，我将AWS EC2机器用于Jenkins和生产机器。你可以自由地使用任何提供SSH登录功能的基于云的服务器，并以Ubuntu作为操作系统。一旦你有了上面要求的组件，你就可以开始了。</p><h1 id="cf7d" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">让我们开始吧:</h1><p id="5647" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">请按顺序执行以下步骤，最后，您将为您的项目实现CI / CD管道。</p><p id="85ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">I)请通过SSH登录到您要安装Jenkins的服务器，然后依次运行以下命令。请注意，您必须为登录用户启用“sudo”权限。</p><p id="998e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ii) <code class="fe mx my mz na b">sudo apt-get update</code></p><p id="8d86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">iii) <code class="fe mx my mz na b">sudo apt-get upgrade</code></p><p id="d954" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">iv) <code class="fe mx my mz na b">sudo<strong class="jx io"> </strong>apt-get install openjdk-8-jre openjdk-8-jdk</code>(目前，Jenkins支持JAVA 8和11，但为了简单起见，我使用JAVA 8)</p><p id="da01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">v) <code class="fe mx my mz na b">wget -q -O — <a class="ae ml" href="https://pkg.jenkins.io/debian-stable/jenkins.io.key" rel="noopener ugc nofollow" target="_blank">https://pkg.jenkins.io/debian-stable/jenkins.io.key</a> | sudo apt-key add -</code></p><p id="3ee8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">六)<code class="fe mx my mz na b">sudo sh -c ‘echo deb <a class="ae ml" href="http://pkg.jenkins.io/debian-stable" rel="noopener ugc nofollow" target="_blank">http://pkg.jenkins.io/debian-stable</a> binary/ &gt; /etc/apt/sources.list.d/jenkins.list’</code></p><p id="2814" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">vii) <code class="fe mx my mz na b">sudo apt-get update</code></p><p id="ed11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">viii) <code class="fe mx my mz na b">sudo apt install jenkins</code></p><p id="1cb0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ix) <code class="fe mx my mz na b">sudo systemctl start jenkins</code>(开始詹金斯)</p><p id="5cf6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">x) <code class="fe mx my mz na b">sudo systemctl status jenkins </code>(检查詹金斯的状态)</p><p id="d0cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xi) <code class="fe mx my mz na b">sudo ufw allow 8080</code>(如果你安装了ufw，那么你必须打开ufw上的8080端口)</p><p id="81f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xii) <code class="fe mx my mz na b">sudo ufw allow OpenSSH</code></p><p id="1256" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xiii) <code class="fe mx my mz na b">sudo ufw enable</code></p><p id="b39d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">十四)<code class="fe mx my mz na b">sudo ufw status</code></p><p id="a22e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xv)现在，您的Jenkins已准备好安装。您可以通过<a class="ae ml" href="http://your_server_ip_or_domain:8080" rel="noopener ugc nofollow" target="_blank">http://your _ server _ IP _ or _ domain:8080</a>运行Jenkins并输入密码。请按照安装过程安装推荐的插件。(您需要运行命令“<code class="fe mx my mz na b">sudo cat /var/lib/jenkins/secrets/initialAdminPassword</code>”来获取登录Jenkins的初始密码。)</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/4541142306133d743865c08c8c4c80c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gM0c8e21TclAn-CadvhScw.png"/></div></div></figure><p id="e2c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xvi)现在Jenkins机器已经准备好了，让我们通过SSH运行以下命令来安装composer。Composer习惯于为Laravel项目安装依赖项</p><pre class="mt mu mv mw gt nc na nd ne aw nf bi"><span id="d3a6" class="ng ku in na b gy nh ni l nj nk"> →<strong class="na io"> </strong>php -r “copy(‘https://getcomposer.org/installer', ‘composer-setup.php’);”<br/> → <!-- -->php -r “if (hash_file(‘sha384’, ‘composer-setup.php’) === ‘756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3’) { echo ‘Installer verified’; } else { echo ‘Installer corrupt’; unlink(‘composer-setup.php’); } echo PHP_EOL;”<br/> →<strong class="na io"> </strong>php composer-setup.php<br/> →<strong class="na io"> </strong>php -r “unlink(‘composer-setup.php’);”</span></pre><p id="5d56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xvii)现在，composer安装已准备就绪。您可以通过运行命令“<code class="fe mx my mz na b">php composer.phar</code>”来测试这一点</p><p id="8a56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xviii)现在，您需要将composer移动到“bin”目录，以便通过直接命令运行它。请运行命令“<code class="fe mx my mz na b">sudo mv composer.phar /usr/local/bin/composer</code>”来移动文件</p><p id="81cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xix)现在您可以在命令提示符下运行命令“<code class="fe mx my mz na b">composer</code>”来测试composer的安装是否正确。</p><p id="1a4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xx)安装composer后，让我们在Jenkins机器上安装git。Git将用于与bitbucket交互。您可以通过命令"<code class="fe mx my mz na b">sudo apt-get install git</code>"安装git</p><p id="1e44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxi)现在让我们安装ZIP模块，它将用于压缩或解压缩文件夹。您可以通过命令“<code class="fe mx my mz na b">sudo apt-get install zip unzip</code>”安装ZIP模块</p><p id="e6ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxii)现在通过<a class="ae ml" href="http://your_server_ip_or_domain:8080" rel="noopener ugc nofollow" target="_blank">http://your _ server _ IP _ or _ domain:8080</a>在浏览器中打开Jenkins页面，点击“管理Jenkins”，然后点击“管理插件”——&gt;“可用”，搜索“bitbucket”插件，安装该插件并重启。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/214ea5e5722d2374c56ef695b3269247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f49qngtUhX4bMfBYeXfXpA.png"/></div></div></figure><p id="09c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxiii)现在我们需要Jenkins服务器的SSH密钥，它将用于通过SSH与bitbucket交互。要在Jenkins服务器上生成新的ssh密钥，请运行以下命令</p><pre class="mt mu mv mw gt nc na nd ne aw nf bi"><span id="83b7" class="ng ku in na b gy nh ni l nj nk"> →<strong class="na io"> </strong>ssh-keygen -t rsa -C “&lt;your email&gt;” (It will ask for the path of the file. Provide the path or use the default one ~/.ssh/id_rsa)<br/> → cat ~/.ssh/id_rsa.pub (To copy the public file of the key and copy. Please replace the path with the path where you installed the SSH keys)</span></pre><p id="c6b6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxiv)您的Jenkins机器现在几乎准备好了。现在让我们转到bitbucket并配置存储库以与Jenkins机器交互</p><p id="2497" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxv)打开bitbucket上的项目存储库，单击“项目设置”,然后单击“访问密钥”,然后添加上面的密钥，这样Jenkins服务器就可以通过SSH与bitbucket进行交互</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/525340c23af7c79361503f080a4ad9ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6T7G1FdQ-ueuAhTBjrOXng.png"/></div></div></figure><p id="530d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxvi)现在在bitbucket上点击“项目设置”-&gt;“webhooks”，然后点击“添加web hook”。然后输入网址为“http://<your jenkins="" url="">:8080/bit bucket-hook/”。单击“SSL/TLS”和“启用请求历史记录收集”,然后添加webhook。(只要任何开发人员将代码推送到这个存储库，这个钩子就会将请求推送到Jenkins。请注意，这将为任何分支中的每次推送向Jenkins发送通知，因此我们必须配置Jenkins，以便只接受和处理存储库特定分支的通知。)</your></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/5d875d18415d89c7e942c04d20784f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LNQx6XLmKx_TPx87povjow.png"/></div></div></figure><p id="cd40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxvii)现在转到Jenkins页面，从左侧菜单中单击“新项目”。输入名称，选择“自由式项目”，点击“确定”。然后选择“源代码管理”，进入存储库“<em class="lw"> SSH URL </em>”，然后点击“<em class="lw">添加(在凭证下)——&gt;Jenkins</em>”，添加SSH凭证登录bitbucket。它将打开一个弹出窗口来添加凭据。然后在“<em class="lw">种类”</em>下拉列表中选择“<em class="lw">带私钥的SSH用户名”</em>，并输入用户名作为您在前面步骤中生成ssh-keygen时使用的电子邮件。然后运行“猫~/。ssh/id_rsa”(来复制私有文件。请用您生成的私钥路径替换该路径)并粘贴到“<em class="lw">私钥</em>部分并保存。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/088bf0390ac573819497e30358494f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxIDsyGalQapepPP0smt8A.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/9ef47bb8fc26184fc2014199adc8cca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7ij23qLKTxvO9dtGVni2Q.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/b4c8cf1d026cb9e1891af0a3b1460dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cyAYwVHfSUWHJ7Th3aH0A.png"/></div></div></figure><p id="e8d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxviii)然后在构建触发器下选择“<em class="lw">当一个变更被推送到BitBucket </em>时构建”，并在这里输入存储库的“<em class="lw"> HTTP URL </em>”。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/d0c93b768f00b90d44f4d80584aba8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7goqFiBcFYYy4uTORwd5ng.png"/></div></div></figure><p id="67f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxix)现在，在build部分下，选择"<em class="lw"> Execute Shell </em>，并输入以下行<br/> → <code class="fe mx my mz na b">composer install </code>(安装LARAVEL依赖项)<br/> → <code class="fe mx my mz na b">mv .env.example .env </code>(您应该在. env.example文件中添加您的生产服务器细节，以便您可以在持续集成期间复制它们，这将用于连接到生产服务器)<br/> → <code class="fe mx my mz na b">php artisan key:generate</code>(生成LARAVEL密钥)<br/> → <code class="fe mx my mz na b">./vendor/bin/phpunit ./tests</code>(运行自动化测试)</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/42ec71f06e35b3b671a7f578b3c6c7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTW2Ge40ewIq0z21uwFbYg.png"/></div></div></figure><p id="a552" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxx)现在，您的Jenkins服务器已准备好接收来自bitbucket的推送通知，并执行CI部分。它将从主分支获取最新的代码，安装依赖项，并运行自动化测试用例来验证集成。所以现在持续集成完成了。让我们现在完成CD部分。</p><p id="a0df" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxxi) Jenkins使用“Jenkins”用户连接到任何服务器进行持续部署。因此，我们将更改该用户的权限，并生成SSH密钥。不要在这里混淆。前面的SSH密钥用于连接CI部分的bitbucket，这个SSH密钥将用于通过SSH连接CD部分的生产服务器。通过ssh登录到Jenkins服务器，并运行以下命令。<br/>→<code class="fe mx my mz na b">sudo su -s /bin/bash jenkins</code>→<br/>→<code class="fe mx my mz na b">ssh-keygen -f ~/.ssh/id_rsa -t rsa -b 4096 -C “devops”</code><br/>→<code class="fe mx my mz na b">cat ~/.ssh/id_rsa.pub </code>(复制ssh公钥到剪贴板)<br/> →现在登录<strong class="jx io"> <em class="lw"> AWS云生产</em> </strong> <strong class="jx io"> <em class="lw">服务器(您将用作生产服务器的服务器)</em> </strong>通过SSH并转到“~/。ssh”文件夹，然后运行以下命令<br/>→<code class="fe mx my mz na b">sudo nano authorized_keys</code><br/>→现在粘贴从JENKINS服务器复制的密钥并保存该文件<br/> → <code class="fe mx my mz na b">sudo /etc/init.d/ssh restart</code>(重启SSH服务器)</p><p id="2d46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">xxxii)现在通过URL<a class="ae ml" href="http://your_server_ip_or_domain:8080" rel="noopener ugc nofollow" target="_blank">http://your _ server _ IP _ or _ domain:8080</a>打开Jenkins，并通过单击configure编辑之前创建的管道，然后在同一个构建部分中修改以下命令。您的构建部分现在应该看起来像下面这样(请注意，下面的命令还将运行DB迁移和seeder来填充数据库。请根据您的使用情况修改命令)</p><pre class="mt mu mv mw gt nc na nd ne aw nf bi"><span id="7fd2" class="ng ku in na b gy nh ni l nj nk"> composer install<br/> mv .env.example .env<br/> php artisan key:generate<br/> ./vendor/bin/phpunit ./tests</span><span id="9869" class="ng ku in na b gy nq ni l nj nk"> rsync -vrzhe “ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa” — exclude vendor/ . ubuntu@&lt;your production server IP&gt;:/var/www/html</span><span id="156d" class="ng ku in na b gy nq ni l nj nk"> ssh ubuntu@&lt;your production server IP&gt;-i ~/.ssh/id_rsa -o StrictHostKeyChecking=no &lt;&lt;EOF<br/> cd /var/www/test<br/> composer install — no-dev<br/> sudo chgrp -R www-data storage bootstrap/cache<br/> sudo chmod -R ug+rwx storage bootstrap/cache<br/> php artisan migrate <br/> php artisan db:seed<br/> EOF</span></pre><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/6edd152cae23909fde1b0747f6faedd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTbEb-Cw1RdSdLoOOEqVLg.png"/></div></div></figure><p id="3afd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">至此，您的Jenkins服务器可以对该web服务器运行“rsync”命令了。祝贺您成功地使用Jenkins实施了CI / CD。现在，一旦开发人员将bitbucket主分支中的代码推送出去，它就会通过webhook向Jenkins服务器发送推送通知。Jenkins服务器将从bitbucket主分支提取代码，并运行自动化测试用例来验证构建。一旦测试成功，它将通过“rsync”命令将代码复制到SSH上的生产服务器，以完成CI / CD管道。现在可以打开http:// <your production="" server="" ip="">运行生产服务器了。</your></p><p id="986c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这只是开始。从这里你可以做很多事情。您可以通过在Jenkins上安装和配置SONACUBE来添加自动代码质量检查。我将添加另一篇文章来描述在Jenkins上安装SONARCUBE并在Jenkins上启用电子邮件通知的逐步过程。</p></div></div>    
</body>
</html>