<html>
<head>
<title>Arduino based SMS alert system (Life Alert inspired)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Arduino的短信提醒系统(生活提醒启发)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/arduino-based-sms-alert-system-life-alert-inspired-88ad3dc5129a?source=collection_archive---------10-----------------------#2020-06-30">https://blog.devgenius.io/arduino-based-sms-alert-system-life-alert-inspired-88ad3dc5129a?source=collection_archive---------10-----------------------#2020-06-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3245" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">这个项目是一个如何使用ESP8266、基于LM393的声音传感器和Twilio API在传感器被触发时发送SMS警报的例子。</h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/8a011fda6f8916931d42556ffa925ac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjfopLQv6igEMWS3iFhV1w.jpeg"/></div></div></figure><p id="2239" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">我发现Twilio文档中当前的<a class="ae ll" href="https://www.twilio.com/docs/sms/tutorials/how-to-send-sms-messages-esp8266-cpp" rel="noopener ugc nofollow" target="_blank">教程</a>对于如何让它在ESP8266上运行有点混乱。因此，我决定记录将Twilio的API合并到我的项目中的过程，以便任何想做同样事情的人都清楚地了解如何完成它。但是首先，这个项目的背景是什么。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h1 id="e07b" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">背景</h1><p id="57d7" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated">要理解这个项目的有用性，你必须首先理解创建它的必要环境。</p><p id="f2d4" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">我哥哥患有一种高功能自闭症，叫做T4阿斯伯格综合症。在很多情况下，包括他的情况，患有这种疾病的人可能会崩溃。最近几个月，他崩溃的频率和强度急剧增加。以至于有几次他在不知不觉中弄伤了自己。很多时候，这些都发生在半夜我父母睡着的时候。虽然这些情绪崩溃通常与奔跑、跳跃和尖叫有关，但通常情况下并不会惊醒他们。能够干预并给他一些帮助他冷静下来的东西，已经成为防止他伤害自己的必要条件。但是如果我的父母没有意识到这一点，他们怎么能干预呢？</p><p id="6619" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">进来的是我认为的“生命警报”。</p><p id="cc5a" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">就像实际的生命警报一样，当它被触发时，这个传感器会发出通知来提醒某人。在这个系统中，因为他的崩溃总是与尖叫有关，当声音传感器在一定的分贝水平被触发时，ESP8266就会通过Twilio向我的父母发送短信，提醒他们，以便他们可以干预。</p><p id="4568" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated"><em class="mq">该项目可根据您的需求调整使用任何传感器。然而，重点将是如何将Twilio集成到您的项目中。</em></p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h1 id="9e77" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">所需材料</h1><p id="5f01" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated"><em class="mq"> (1) ESP8266 <br/> (1) LM393模拟声音传感器<br/> (3)母到母跳线<br/>(或者您可以使用普通线、焊料和烙铁)<br/> (1)微型USB电缆<br/> (1) 5V电源适配器</em></p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h1 id="ffd2" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">设置</h1><p id="725d" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated">我假设你已经安装了Arduino IDE，但是如果没有，你可以在这里找到它。</p><p id="5954" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">我使用的是ESP8266，它需要一些配置才能与Arduino配合使用。如果您使用不同的主板，过程可能会略有不同。</p><p id="9f99" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">首先，您需要下载并安装允许通过usb与ESP8266通信的驱动程序。根据您的ESP8266的具体版本，所需的驱动程序可能会有所不同，因此请参考随附的文档来确定具体的驱动程序。我的用的是CP2102驱动，你可以在这里找到<a class="ae ll" href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1a97" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">接下来，您需要将ESP8266添加到Arduino IDE中的电路板管理器中。在IDE中导航到<strong class="kr io">首选项</strong> &gt; <strong class="kr io">附加板管理器URL</strong>和<strong class="kr io"> </strong>粘贴到以下内容:<a class="ae ll" href="http://arduino.esp8266.com/stable/package_esp8266com_index.json" rel="noopener ugc nofollow" target="_blank"><strong class="kr io">http://arduino . esp8266 . com/stable/package _ esp8266 com _ index . JSON</strong></a></p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mr"><img src="../Images/f5dd32707115e4b7eb9e869e246e2e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvxIeTJ8xDbySYomhRvlYw.png"/></div></div></figure><p id="6fca" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">现在进入<strong class="kr io">工具&gt;板&gt;板管理器</strong>打开板管理器，搜索“<em class="mq"> ESP8266 </em>”，安装<strong class="kr io"> ESP8266社区</strong>的板管理器。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mr"><img src="../Images/61a6ab37980b2d3efd5ffb7600a777c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyDFtEdf_b-Ao5nUgLac5Q.png"/></div></div></figure><p id="6e73" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">现在你应该已经准备好上传代码了。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h1 id="d607" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">特维利奥</h1><p id="ebc6" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated">要通过Twilio API集成短信通知，你需要创建一个<a class="ae ll" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">账户</a>。完成后，您需要创建一个新项目并验证一个电话号码。接下来，你需要一个电话号码来发送信息。点击项目仪表板中的<strong class="kr io">获取试用号</strong>并选择一个电话号码。</p><p id="d231" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">现在开始下载Twilio的ESP8266项目文件。你可以在这里找到它们。下载后，将文件夹从<strong class="kr io">twilio _ esp8266 _ arduino _ example-master</strong>重命名为<strong class="kr io">twilio _ esp8266 _ arduino _ example</strong>。虽然这种改变看起来微不足道，但却很重要，这样Arduino IDE就可以正确地读取文件。现在在Arduino IDE中打开它，方法是转到<strong class="kr io">文件&gt;打开</strong>并导航到您刚刚重命名的文件夹。打开标题为<strong class="kr io">twilio _ esp 8266 _ arduino _ example . ino</strong>的文件。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi ms"><img src="../Images/826723624dd93994dcbbea38f3e3902b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8zepdSl-s5mvCcex2_5Pw.png"/></div></div></figure><p id="19e7" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">在这里，您可以根据自己的喜好定制项目。从设置活动和非活动时间段到向自定义API发出POST请求以存储日志。但是为了简单起见，我将展示如何在传感器被触发时发送通知。</p><p id="aa01" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">你要做的第一件事就是配置Wi-Fi设置。将<strong class="kr io"> ssid </strong>和<strong class="kr io">密码</strong>变量更改为您的网络名称和密码。接下来，我们需要一个有效的<strong class="kr io">指纹</strong>。这个问题花了我一分钟才弄明白，但是很容易得到。在Chrome中，转到<strong class="kr io">api.twilio.com。</strong>点击<strong class="kr io">锁图标&gt;证书。</strong></p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mt"><img src="../Images/984d49b45961770bf900d448af9c8e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgglRZVfWj8-4NDmZffxdw.png"/></div></div></figure><p id="5670" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">展开模式中的<strong class="kr io">细节</strong>下拉菜单，滚动到底部显示<strong class="kr io">指纹</strong>的地方，并复制<strong class="kr io"> SHA-1 </strong>键的值。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mu"><img src="../Images/f3037e790a4fd5efe81efc5cf981b83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fp5jI1Oqr5rJMLZswXLc7g.png"/></div></div></figure><p id="c205" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">现在将该键粘贴到草图中的<strong class="kr io">指纹</strong>变量中。</p><p id="99c0" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">回到你的Twilio项目的仪表板。你需要<strong class="kr io">试用号</strong>、<strong class="kr io">账号sid </strong>和<strong class="kr io">认证令牌。</strong>分别粘贴到<strong class="kr io"> from_number、account_sid、</strong>和<strong class="kr io"> auth_token </strong>变量中。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mv"><img src="../Images/96880497eb50804437878d752bfbbad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GGxNQCK_dpFkG8-KFt_hFw.png"/></div></div></figure><p id="1838" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">您还需要在<strong class="kr io"> to_number </strong>变量中提供一个电话号码，以接收这些文本消息。</p><p id="b56b" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated"><strong class="kr io">注:</strong> <em class="mq">如果您的项目使用的是Twilio的试用版，则只有</em> <strong class="kr io">验证过的号码</strong> <em class="mq">才能接收短信。默认情况下，您用来注册的号码已经过验证。如果您希望向注册号码以外的号码发送消息，您需要将该电话号码添加到项目仪表板的</em> <strong class="kr io">验证号码</strong>部分。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi mw"><img src="../Images/e93872c13d1975061851278ec9f03aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Z034TPBAoetVpaTcOGvww.png"/></div></div></figure></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h1 id="e1be" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">密码</h1><p id="3a0e" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated">在这个例子中，我只演示了如何发送消息，所以我已经删除了任何不必要的代码，这些代码与发送的消息无关。草图可以在下面找到。</p><p id="8a64" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated"><em class="mq">如果您跟随的是ESP8266和声音传感器，您需要将传感器连接到+3.3v、接地和ESP8266上的GPIO引脚4 (D2)。</em></p><pre class="ke kf kg kh gt mx my mz na aw nb bi"><span id="f50b" class="nc lu in my b gy nd ne l nf ng">/*<br/> * Twilio SMS and MMS on ESP8266 Example.<br/> */</span><span id="f9d9" class="nc lu in my b gy nh ne l nf ng">#include &lt;ESP8266WiFi.h&gt;<br/>#include &lt;WiFiClientSecure.h&gt;<br/>#include &lt;ESP8266WebServer.h&gt;</span><span id="9e2d" class="nc lu in my b gy nh ne l nf ng">#include "twilio.hpp"</span><span id="6b29" class="nc lu in my b gy nh ne l nf ng">// Use software serial for debugging?<br/>#define USE_SOFTWARE_SERIAL 0</span><span id="82d5" class="nc lu in my b gy nh ne l nf ng">// Print debug messages over serial?<br/>#define USE_SERIAL 1</span><span id="b333" class="nc lu in my b gy nh ne l nf ng">// Your network SSID and password<br/>const char* ssid = "The_Sailboat";<br/>const char* password = "club848!";</span><span id="eaa0" class="nc lu in my b gy nh ne l nf ng">// Find the api.twilio.com SHA1 fingerprint, this one was valid as <br/>// of August 2019.<br/>const char fingerprint[] = "06 86 86 C0 A0 ED 02 20 7A 55 CC F0 75 BB CF 24 B1 D9 C0 49";</span><span id="3050" class="nc lu in my b gy nh ne l nf ng">// Twilio account specific details, from <a class="ae ll" href="https://twilio.com/console" rel="noopener ugc nofollow" target="_blank">https://twilio.com/console</a><br/>// Please see the article: <br/>// <a class="ae ll" href="https://www.twilio.com/docs/guides/receive-and-reply-sms-and-mms-messages-esp8266-c-and-ngrok" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/docs/guides/receive-and-reply-sms-and-mms-messages-esp8266-c-and-ngrok</a></span><span id="7b9b" class="nc lu in my b gy nh ne l nf ng">// If this device is deployed in the field you should only deploy a revocable<br/>// key. This code is only suitable for prototyping or if you retain physical<br/>// control of the installation.<br/>const char* account_sid = "ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";<br/>const char* auth_token = "Your AUTH TOKEN";</span><span id="b372" class="nc lu in my b gy nh ne l nf ng">// Details for the SMS we'll send with Twilio.  Should be a number you own <br/>// (check the console, link above).<br/>String to_number    = "+18005551212";<br/>String from_number = "+18005551212";<br/>String message_body    = "Hello from Twilio and the ESP8266!";</span><span id="080d" class="nc lu in my b gy nh ne l nf ng">// The 'authorized number' to text the ESP8266 for our example<br/>//String master_number    = "+18005551212";</span><span id="68e2" class="nc lu in my b gy nh ne l nf ng">// Optional - a url to an image.  See 'MediaUrl' here: <br/>// <a class="ae ll" href="https://www.twilio.com/docs/api/rest/sending-messages" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/docs/api/rest/sending-messages</a><br/>//String media_url = "";</span><span id="98bc" class="nc lu in my b gy nh ne l nf ng">// Global twilio objects<br/>Twilio *twilio;<br/>ESP8266WebServer twilio_server(8000);</span><span id="5b85" class="nc lu in my b gy nh ne l nf ng">//  Optional software serial debugging<br/>#if USE_SOFTWARE_SERIAL == 1<br/>#include &lt;SoftwareSerial.h&gt;<br/>// You'll need to set pin numbers to match your setup if you<br/>// do use Software Serial<br/>extern SoftwareSerial swSer(14, 4, false, 256);<br/>#else<br/>#define swSer Serial<br/>#endif</span><span id="1aad" class="nc lu in my b gy nh ne l nf ng">//initialize sensor on GPIO pin 4<br/>int micPin = 4;</span><span id="76a4" class="nc lu in my b gy nh ne l nf ng">/* Setup function for ESP8266 Twilio Example.<br/> * Here we connect to a friendly wireless network, set the time, instantiate <br/> * our twilio object, optionally set up software serial, then send a SMS <br/> * or MMS message.<br/> */<br/>void setup() {<br/>        WiFi.begin(ssid, password);<br/>        twilio = new Twilio(account_sid, auth_token, fingerprint);</span><span id="da3a" class="nc lu in my b gy nh ne l nf ng">#if USE_SERIAL == 1<br/>        swSer.begin(115200);<br/>        while (WiFi.status() != WL_CONNECTED) {<br/>                delay(1000);<br/>                swSer.print(".");<br/>        }<br/>        swSer.println("");<br/>        swSer.println("Connected to WiFi, IP address: ");<br/>        swSer.println(WiFi.localIP());<br/>        #else<br/>        while (WiFi.status() != WL_CONNECTED) delay(1000);<br/>        #endif      <br/>}<br/>void loop() {<br/>        //if sensor is triggered send a notification<br/>        if (digitalRead(micPin) == LOW){<br/>        // Response will be filled with connection info and Twilio API responses<br/>        // from this initial SMS send.<br/>        String response;<br/>        twilio-&gt;send_message(<br/>                to_number,<br/>                from_number,<br/>                message_body,<br/>                response,<br/>                media_url<br/>        );<br/>        swSer.println(response);<br/>        delay(100);<br/>        }<br/>}</span></pre><p id="1d54" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">就是这样！这个循环将持续运行，如果它感应到<strong class="kr io">鼠标</strong>被触发<strong class="kr io"> </strong> <em class="mq">(变低)</em>，那么它将向您提供的<strong class="kr io"> to_number </strong>发送短信。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi ni"><img src="../Images/1b7ec9145f68bed77bd638e71cc184d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2qydzuOYRhyX_j3Vj6kC3g.png"/></div></div></figure><h1 id="d9b6" class="lt lu in bd lv lw nj ly lz ma nk mc md jt nl ju mf jw nm jx mh jz nn ka mj mk bi translated">后续步骤</h1><p id="d987" class="pw-post-body-paragraph kp kq in kr b ks ml jo ku kv mm jr kx ky mn la lb lc mo le lf lg mp li lj lk ig bi translated">如前所述，有许多方法可以修改这个项目，使其符合您的需要，但这只是一个样板文件，可以帮助您启动并运行Twilio，以便您可以集成到自己的项目中。</p><p id="da6a" class="pw-post-body-paragraph kp kq in kr b ks kt jo ku kv kw jr kx ky kz la lb lc ld le lf lg lh li lj lk ig bi translated">如果有兴趣创建一个完整的堆栈应用程序来记录和显示数据，我将创建本教程的<strong class="kr io">第2部分</strong>。</p></div></div>    
</body>
</html>