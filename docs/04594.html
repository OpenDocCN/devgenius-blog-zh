<html>
<head>
<title>Add Heat Maps into Our React App with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Visx库将热图添加到我们的React应用中</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-heat-maps-into-our-react-app-with-the-visx-library-31abb33a7a90?source=collection_archive---------8-----------------------#2021-04-07">https://blog.devgenius.io/add-heat-maps-into-our-react-app-with-the-visx-library-31abb33a7a90?source=collection_archive---------8-----------------------#2021-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/34ce600ef3cc42460ea858b95d5aa89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ScQQWMkoH4qwatqF"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">克里斯蒂安·斯特克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="29e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx是一个库，让我们可以轻松地将图形添加到React应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将热图添加到React应用程序中。</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/group @visx/heatmap @visx/mock-data @visx/responsive @visx/scale</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="0120" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加热图</h1><p id="3f8b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下内容来添加热图:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5a81" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { Group } from "@visx/group";<br/>import genBins from "@visx/mock-data/lib/generators/genBins";<br/>import { scaleLinear } from "@visx/scale";<br/>import { HeatmapCircle, HeatmapRect } from "@visx/heatmap";</span><span id="5a87" class="mn lc iq mj b gy ms mp l mq mr">const hot1 = "#77312f";<br/>const hot2 = "#f33d15";<br/>const cool1 = "#122549";<br/>const cool2 = "#b4fbde";<br/>const background = "#28272c";</span><span id="552d" class="mn lc iq mj b gy ms mp l mq mr">const binData = genBins(/* length = */ 16, /* height = */ 16);</span><span id="0f37" class="mn lc iq mj b gy ms mp l mq mr">function max(data, value) {<br/>  return Math.max(...data.map(value));<br/>}</span><span id="10e4" class="mn lc iq mj b gy ms mp l mq mr">function min(data, value) {<br/>  return Math.min(...data.map(value));<br/>}<br/>const bins = (d) =&gt; d.bins;<br/>const count = (d) =&gt; d.count;</span><span id="dda0" class="mn lc iq mj b gy ms mp l mq mr">const colorMax = max(binData, (d) =&gt; max(bins(d), count));<br/>const bucketSizeMax = max(binData, (d) =&gt; bins(d).length);</span><span id="ca7a" class="mn lc iq mj b gy ms mp l mq mr">// scales<br/>const xScale = scaleLinear({<br/>  domain: [0, binData.length]<br/>});<br/>const yScale = scaleLinear({<br/>  domain: [0, bucketSizeMax]<br/>});<br/>const circleColorScale = scaleLinear({<br/>  range: [hot1, hot2],<br/>  domain: [0, colorMax]<br/>});<br/>const rectColorScale = scaleLinear({<br/>  range: [cool1, cool2],<br/>  domain: [0, colorMax]<br/>});<br/>const opacityScale = scaleLinear({<br/>  range: [0.1, 1],<br/>  domain: [0, colorMax]<br/>});<br/>const defaultMargin = { top: 10, left: 20, right: 20, bottom: 110 };</span><span id="5229" class="mn lc iq mj b gy ms mp l mq mr">const Example = ({<br/>  width,<br/>  height,<br/>  events = false,<br/>  margin = defaultMargin,<br/>  separation = 20<br/>}) =&gt; {<br/>  const size =<br/>    width &gt; margin.left + margin.right<br/>      ? width - margin.left - margin.right - separation<br/>      : width;<br/>  const xMax = size / 2;<br/>  const yMax = height - margin.bottom - margin.top;<br/>  const binWidth = xMax / binData.length;<br/>  const binHeight = yMax / bucketSizeMax;<br/>  const radius = min([binWidth, binHeight], (d) =&gt; d) / 2;</span><span id="05e8" class="mn lc iq mj b gy ms mp l mq mr">xScale.range([0, xMax]);<br/>  yScale.range([yMax, 0]);</span><span id="2be8" class="mn lc iq mj b gy ms mp l mq mr">return width &lt; 10 ? null : (<br/>    &lt;svg width={width} height={height}&gt;<br/>      &lt;rect<br/>        x={0}<br/>        y={0}<br/>        width={width}<br/>        height={height}<br/>        rx={14}<br/>        fill={background}<br/>      /&gt;<br/>      &lt;Group top={margin.top} left={margin.left}&gt;<br/>        &lt;HeatmapCircle<br/>          data={binData}<br/>          xScale={(d) =&gt; xScale(d) ?? 0}<br/>          yScale={(d) =&gt; yScale(d) ?? 0}<br/>          colorScale={circleColorScale}<br/>          opacityScale={opacityScale}<br/>          radius={radius}<br/>          gap={2}<br/>        &gt;<br/>          {(heatmap) =&gt;<br/>            heatmap.map((heatmapBins) =&gt;<br/>              heatmapBins.map((bin) =&gt; (<br/>                &lt;circle<br/>                  key={`heatmap-circle-${bin.row}-${bin.column}`}<br/>                  className="visx-heatmap-circle"<br/>                  cx={bin.cx}<br/>                  cy={bin.cy}<br/>                  r={bin.r}<br/>                  fill={bin.color}<br/>                  fillOpacity={bin.opacity}<br/>                  onClick={() =&gt; {<br/>                    if (!events) return;<br/>                    const { row, column } = bin;<br/>                    alert(JSON.stringify({ row, column, bin: bin.bin }));<br/>                  }}<br/>                /&gt;<br/>              ))<br/>            )<br/>          }<br/>        &lt;/HeatmapCircle&gt;<br/>      &lt;/Group&gt;<br/>      &lt;Group top={margin.top} left={xMax + margin.left + separation}&gt;<br/>        &lt;HeatmapRect<br/>          data={binData}<br/>          xScale={(d) =&gt; xScale(d) ?? 0}<br/>          yScale={(d) =&gt; yScale(d) ?? 0}<br/>          colorScale={rectColorScale}<br/>          opacityScale={opacityScale}<br/>          binWidth={binWidth}<br/>          binHeight={binWidth}<br/>          gap={2}<br/>        &gt;<br/>          {(heatmap) =&gt;<br/>            heatmap.map((heatmapBins) =&gt;<br/>              heatmapBins.map((bin) =&gt; (<br/>                &lt;rect<br/>                  key={`heatmap-rect-${bin.row}-${bin.column}`}<br/>                  className="visx-heatmap-rect"<br/>                  width={bin.width}<br/>                  height={bin.height}<br/>                  x={bin.x}<br/>                  y={bin.y}<br/>                  fill={bin.color}<br/>                  fillOpacity={bin.opacity}<br/>                  onClick={() =&gt; {<br/>                    if (!events) return;<br/>                    const { row, column } = bin;<br/>                    alert(JSON.stringify({ row, column, bin: bin.bin }));<br/>                  }}<br/>                /&gt;<br/>              ))<br/>            )<br/>          }<br/>        &lt;/HeatmapRect&gt;<br/>      &lt;/Group&gt;<br/>    &lt;/svg&gt;<br/>  );<br/>};</span><span id="be7a" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ebd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在代码的顶部定义了热图的颜色代码。</p><p id="f1cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">binData</code>有热图的数据。</p><p id="460c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">max</code>和<code class="fe mt mu mv mj b">min</code>返回数据的最大值和最小值。</p><p id="7def" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">bins</code>和<code class="fe mt mu mv mj b">count</code>是数据的获取方法。</p><p id="0a05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">colorMax</code>和<code class="fe mt mu mv mj b">bucketSizeMax</code>函数得到颜色和桶尺寸的最大值。</p><p id="86cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们计算热图的<code class="fe mt mu mv mj b">xScale</code>和<code class="fe mt mu mv mj b">yScale</code>，以获得热图值的范围。</p><p id="116c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">circleColorScale</code>和<code class="fe mt mu mv mj b">rectColorScale</code>是热图圆形或矩形的色标。</p><p id="3e44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">opacityStyle</code>具有圆形或矩形的不透明度。</p><p id="a28f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">Example</code>组件中，我们获得了热图的宽度。</p><p id="adf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">binWidth</code>和<code class="fe mt mu mv mj b">binHeight</code>具有热图中箱子的宽度和高度。</p><p id="a6ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">radius</code>获取热图中圆圈的半径。</p><p id="5df1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将所有变量传递给<code class="fe mt mu mv mj b">HeatmapCircle</code>组件，以创建一个带圆圈的热图。</p><p id="9951" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe mt mu mv mj b">HeatmapRect</code>组件做同样的事情来创建一个带有矩形的热图。</p><p id="3a5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些图块在每个图块的渲染属性中进行渲染。我们根据热图类型渲染<code class="fe mt mu mv mj b">circle</code>或<code class="fe mt mu mv mj b">rect</code>。</p><h1 id="d681" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e62b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Visx库在React应用程序中创建包含不同类型图块的热图。</p></div></div>    
</body>
</html>