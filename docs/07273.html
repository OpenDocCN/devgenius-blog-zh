<html>
<head>
<title>Analytics of chatbots in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中聊天机器人的分析</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/analytics-of-chatbots-in-python-e044024c0db7?source=collection_archive---------16-----------------------#2022-03-10">https://blog.devgenius.io/analytics-of-chatbots-in-python-e044024c0db7?source=collection_archive---------16-----------------------#2022-03-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="23cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">即使创建了一个聊天机器人，创建者也总是想知道有多少人使用它，他们给机器人写了什么。尤其是如果这个机器人是为商业目的编写的。Telegram 中的广告出现后，聊天机器人的分析变得更加必要，因为现在可以直接向用户宣传机器人。与市场上的其他解决方案相比，我的解决方案的优势在于:它是免费的，易于实施，20 个分析指标，您可以创建自己的指标，数据只与您一起存储，适合每月任何数量的消息，存储整个连接时间的历史记录，可以在一个地方存储任何数量的机器人的数据。此外，该解决方案不仅可以用于电报聊天机器人，还可以用于任何其他聊天机器人(Slack、Discord、Vk 等)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc339af747b1dfbc320f3ed81fb3dfb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w67inzQ0w0DU-6Lv_1W-rQ.png"/></div></div></figure><p id="ef9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将这个库命名为<a class="ae ku" href="https://github.com/aleksspevak/lorabot" rel="noopener ugc nofollow" target="_blank">劳拉机器人</a>。Analytics 作为第三方库连接到您的 bot，所有数据都存储在 PostgreSQL 中。您可以使用 docker-compose 文件在服务器上部署数据库，该文件位于存储库中。如果您有自己的数据库，或者想将它作为 SaaS 部署在云中，您需要自己创建一个用户，运行<a class="ae ku" href="https://github.com/aleksspevak/lorabot/tree/main/lorabot/sql" rel="noopener ugc nofollow" target="_blank"> create_tables.sql </a>文件并将凭证放入。环境文件。此外，在<a class="ae ku" href="https://github.com/aleksspevak/lorabot" rel="noopener ugc nofollow" target="_blank">库</a>中，你可以找到 Telegram、Slack、Discord、Vk 聊天机器人，它们已经实现了分析功能，并且可以从 LoraBot 获取分析信息。</p><h2 id="8f24" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated">如何在你的聊天机器人中实现分析？</h2><p id="b361" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">你需要下载 LoraBot 作为<a class="ae ku" href="https://github.com/aleksspevak/lorabot" rel="noopener ugc nofollow" target="_blank"> zip </a>或者使用 git:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="95d8" class="kv kw in lu b gy ly lz l ma mb">git clone https://github.com/aleksspevak/lorabot.git</span></pre><p id="1d44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用以下命令运行 LoraBot 的数据库。如果你没有安装 docker-compose，你可以在这里阅读如何安装:<a class="ae ku" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/compose/install/</a></p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="2194" class="kv kw in lu b gy ly lz l ma mb">docker-compose up -d</span></pre><p id="15c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为 LoraBot 安装必要的库:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="4f5d" class="kv kw in lu b gy ly lz l ma mb">pip3 install -r requirements.txt</span></pre><p id="9528" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">设置密码以访问中的分析。环境文件:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="5ef3" class="kv kw in lu b gy ly lz l ma mb">ANALYTICS_PASSWORD=lorabot</span></pre><p id="6d0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在你的机器人中初始化 LoraBot:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="ec45" class="kv kw in lu b gy ly lz l ma mb">from lorabot import LoraBot<br/>lora_bot = LoraBot("your bot's name")</span></pre><p id="7bd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">设置您需要 LoraBot 功能的位置，开始获取信息进行分析，如下例所示:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="968d" class="kv kw in lu b gy ly lz l ma mb">#to track new users, for example, in a telegram, it is appropriate to put a function in the processing functions of the /start command<br/>lora_bot.user(USER_ID)<br/>#to track commands, menu messages, messages<br/>lora_bot.message(TEXT, TEXT_TYPE, USER_ID)<br/>#to track events<br/>lora_bot.event(EVENT, EVENT_TYPE, USER_ID)<br/>#to track review <br/>lora_bot.review(REVIEW, USER_ID)<br/>#to track bot assessment<br/>lora_bot.assessment(RATING_IN_INT_FORMAT, USER_ID)</span></pre><p id="8fa6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要获得分析，进行某种条件分支，例如在 telegram_bot.py 文件中，条件是接收带有关键字的消息，之后检查密码，然后 bot 所有者获得对分析的访问权限:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/75c7a96e3204da187f6178b46c5f03b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2WTm7nkfxiRypJn4fROQQ.png"/></div></div></figure><h2 id="3143" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated">分析度量</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/44221f638f9cb49b8d97f7613ce2431e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*92hU13EB8CJi0CmS.png"/></div></div></figure><p id="db5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">跟随<a class="ae ku" href="https://github.com/aleksspevak/lorabot#analytics-metrics" rel="noopener ugc nofollow" target="_blank">链接</a>找到 LoraBot 中分析的所有指标。请注意，一些指标具有用于设置分析周期、返回的数据量或用于设置消息/事件类型的参数。此外，有些函数只返回文本信息，但有些函数同时返回数据可视化和文本信息。以下是如何在电报机器人中从分析中返回信息的一些示例:</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="e15d" class="kv kw in lu b gy ly lz l ma mb">#Return total information of users that using your bot(only text)<br/>info = lora_bot.analyze_total(START_PERIOD, END_PERIOD)<br/>bot.send_message(message.chat.id, info)<br/>#Return information about daily active users(photo+text)<br/>photo, info = lora_bot.analyze_dau(START_PERIOD, END_PERIOD)<br/>bot.send_message(message.chat.id, info)<br/>bot.send_photo(message.chat.id, photo)</span></pre><p id="a4e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">劳拉机器人总共有<a class="ae ku" href="https://github.com/aleksspevak/lorabot#analytics-metrics" rel="noopener ugc nofollow" target="_blank"> 20 个指标</a>，可以分为以下几组:</p><ul class=""><li id="20db" class="me mf in jm b jn jo jr js jv mg jz mh kd mi kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#total-metrics" rel="noopener ugc nofollow" target="_blank">通用指标</a></li><li id="0d16" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#users-metrics" rel="noopener ugc nofollow" target="_blank">用户指标</a></li><li id="654e" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#messages-metrics" rel="noopener ugc nofollow" target="_blank">消息分析的指标</a></li><li id="f1d2" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#events-metrics" rel="noopener ugc nofollow" target="_blank">事件分析的指标</a></li><li id="dd0e" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#assessment-and-review-metrics" rel="noopener ugc nofollow" target="_blank">用于分析机器人用户评论和评级的指标</a></li><li id="9956" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><a class="ae ku" href="https://github.com/aleksspevak/lorabot#other-metrics" rel="noopener ugc nofollow" target="_blank">其他指标</a></li></ul><p id="afe3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还有一个单独的<a class="ae ku" href="https://github.com/aleksspevak/lorabot#how-create-custom-metrics" rel="noopener ugc nofollow" target="_blank">函数</a>，您可以直接从 bot 向其传递 SQL 查询。这将有助于创建自定义指标。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/b0f426545bb1671e8429c2f00492bc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hy3vX5enUksX6MQa.png"/></div></div></figure><p id="52c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">存储用户、消息、事件和评论信息的数据库模式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/3d03a8dbb9e22ff6315fc500964f3f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/0*RmNG8Fax7mFv4iqE.png"/></div></figure><h2 id="fb24" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated">结论</h2><p id="fb55" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">目前，这个解决方案已经被我测试了一个月，结果令我满意。我希望这个解决方案也能帮助你。</p><p id="97cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">附言</strong>分析当然是好的，但是如果你需要你的机器人在没有手动启动的情况下工作，把它包装在 docker 文件中，并在启动数据库的同一个 docker-compose 文件中运行它。在服务器上托管一个机器人将变得更加容易。</p></div></div>    
</body>
</html>