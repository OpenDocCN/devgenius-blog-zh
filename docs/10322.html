<html>
<head>
<title>Argo CD Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿尔戈 CD 游戏攻略</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/argo-cd-introduction-4b16f50b0d56?source=collection_archive---------1-----------------------#2022-10-24">https://blog.devgenius.io/argo-cd-introduction-4b16f50b0d56?source=collection_archive---------1-----------------------#2022-10-24</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="d01e" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">什么是 ArgoCD，为什么使用它</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj kg"><img src="../Images/2a471bd66b34dc60082aa7affbbc9722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*p6smylhwhQi2s8Qpem2M_Q.png"/></div></figure><h1 id="bc2a" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">阿尔戈概述</h1><p id="3ea3" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">在讲 ArgoCD 之前，我们先来快速看一下<code class="fe mc md me mf b">Argo</code>。<code class="fe mc md me mf b">Argo</code>或<code class="fe mc md me mf b">ArgoProj</code>，是一个在 K8s 中完成工作并显著提高生产力的工具集合。2020 年 4 月 7 日，CNCF 技术监督委员会(TOC)投票通过<code class="fe mc md me mf b">Argo</code>项目进入 CNCF 孵化。</p><p id="3f5d" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">最初的<code class="fe mc md me mf b">ArgoProj</code>由 Applatix 创建，并于 2018 年初被 Intuit 收购。之后，贝莱德贡献了<code class="fe mc md me mf b">Argo Events</code>子项目，现在两家公司都在积极参与开发<code class="fe mc md me mf b">ArgoProj</code>。</p><p id="6bc4" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated"><code class="fe mc md me mf b">ArgoProj</code>由四个主要产品组成，专注于各种用例，共同构成了一个强大的应用交付平台。</p><ul class=""><li id="aad3" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated"><strong class="li is"> Argo Workflows </strong> —一个开源的容器本地工作流引擎，用于编排 K8s 上的并行作业。<code class="fe mc md me mf b">Argo Workflows</code>实现为 K8s CRD(自定义资源定义)。</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj mu"><img src="../Images/9118882e45aff79fcae1cd4af4729df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rZFutlq4iB3vYbZF.png"/></div></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">图片来自<a class="ae nd" href="https://github.com/argoproj/argo-workflows/blob/master/README.md#community-blogs-and-presentations" rel="noopener ugc nofollow" target="_blank"> Argo 工作流程</a></figcaption></figure><ul class=""><li id="7787" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">Argo CD  —一个用于 K8s 的声明式 GitOps 连续交付工具。</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj ne"><img src="../Images/74cbfd929f9bb7dcb736cbed2d4fa17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*45_RXMttNvEPXwFR"/></div></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">图片来自<a class="ae nd" href="https://github.com/argoproj/argo-cd/blob/master/README.md#community-blogs-and-presentations" rel="noopener ugc nofollow" target="_blank"> Argo CD </a></figcaption></figure><ul class=""><li id="d289" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">Argo Events  —一个事件驱动的 K8s 工作流自动化框架。</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj nf"><img src="../Images/521b75acbdd2dcd8f2d41aa4cbc2be43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FDg5qRLRjbjtz-La"/></div></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">图片来自<a class="ae nd" href="https://github.com/argoproj/argo-events/blob/master/README.md#community-blogs-and-presentations" rel="noopener ugc nofollow" target="_blank">蓉城事件</a></figcaption></figure><ul class=""><li id="f505" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated"><strong class="li is"> Argo 部署</strong> —一个 K8s 控制器和一组 CRD，为 K8s 提供高级部署功能，如蓝绿色、金丝雀、金丝雀分析、实验和渐进交付功能。</li></ul><h1 id="a9b5" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">什么是阿尔戈光盘</h1><p id="391c" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">如上所述，<code class="fe mc md me mf b">Argo CD</code>是一款面向 K8s 的声明式 GitOps 持续交付工具。<code class="fe mc md me mf b">Argo CD</code>支持多种配置管理工具，包括 ksonnet/jsonnet、kustomize、Helm 等。它扩展了声明式和基于 Git 的配置管理的优势，以加速应用程序部署和生命周期管理，而不会影响安全性和合规性。</p><h1 id="9906" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">阿尔戈光盘功能</h1><p id="bcc7" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">一些主要的<code class="fe mc md me mf b">Argo CD</code>特性是:</p><ul class=""><li id="5f76" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated"><strong class="li is">自动化部署</strong> —它可以自动将您的应用程序部署到 K8s 中。Argo CD 支持部署到公共云(AWS/GCP/Azure)或本地数据中心托管的多个集群中。</li><li id="d359" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is"> GitOps 风格部署</strong> —实现 GitOps 风格的软件交付。它在 Git 中声明应用程序的期望状态，<code class="fe mc md me mf b">Argo CD</code>会自动将应用程序配置同步到当前声明的状态。</li><li id="7b06" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">部署策略</strong> —快速将任何应用回滚到 Git 中的任何先前版本。</li><li id="46b3" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is"> SSO 集成</strong> —借助 OIDC、OAuth2、LDAP、SAML 2.0、GitHub、GitLab、微软等 SSO 提供商的内置集成，轻松支持您的团队访问<code class="fe mc md me mf b">Argo CD</code>。</li><li id="8da6" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">多租户</strong>和<strong class="li is"> RBAC </strong>政策授权</li><li id="57b5" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">健康状态</strong>应用资源分析</li><li id="6443" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is"> Web UI </strong>提供应用活动的实时视图</li><li id="581f" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">自动化和 CI 集成的 CLI </li><li id="305c" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">普罗米修斯指标</strong></li></ul><h1 id="ee25" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Argo CD 架构</h1><p id="6317" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated"><code class="fe mc md me mf b">Argo CD</code>的建筑看起来像:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj nl"><img src="../Images/44abf7ba34ba24694d5fb56c1cd4edd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1PYO5mISpXdp8BBU.png"/></div></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">图片来自<a class="ae nd" href="https://argo-cd.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">阿尔戈</a></figcaption></figure><p id="48fa" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">从上图中，我们可以看到<code class="fe mc md me mf b">Argo CD</code>有三个主要组件:</p><h2 id="bf6e" class="nm kp ir bd kq nn no dn ku np nq dp ky lp nr ns la lt nt nu lc lx nv nw le nx bi translated">API 服务器</h2><p id="dc95" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">它是一个 gRPC/REST 服务器，公开 Web UI、CLI 和 CI/CD 系统使用的 API，其职责包括:</p><ul class=""><li id="44e4" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">应用程序管理和状态报告</li><li id="47df" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">同步、回滚等应用操作</li><li id="4142" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">凭证管理</li><li id="391e" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">证明</li><li id="be30" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">RBAC 执法</li></ul><h2 id="0f70" class="nm kp ir bd kq nn no dn ku np nq dp ky lp nr ns la lt nt nu lc lx nv nw le nx bi translated">存储库服务器</h2><p id="7769" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">这是一个内部服务，维护 Git repos 的本地缓存，保存应用程序清单。当提供以下输入时，它负责生成并返回 K8ss 清单:</p><ul class=""><li id="992c" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">回购 URL</li><li id="43b4" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">修订(提交、标记、分支)</li><li id="0de2" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">应用程序路径</li><li id="9e94" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated">模板特定设置:参数，舵值. yaml</li></ul><h2 id="76e3" class="nm kp ir bd kq nn no dn ku np nq dp ky lp nr ns la lt nt nu lc lx nv nw le nx bi translated">应用控制器</h2><p id="2494" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">在引擎盖下是一个 K8s 控制器，它持续监听正在运行的应用程序，并将当前的实时状态与所需的目标状态进行比较。像其他 K8s 控制器一样，它检测<code class="fe mc md me mf b">OutOfSync</code>应用程序状态并采取行动。</p><h1 id="e8f7" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Argo CD 核心概念</h1><p id="dfc0" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">一些核心概念是:</p><ul class=""><li id="7f0f" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated"><strong class="li is">应用</strong> —由清单定义的一组 K8s 资源。这是自定义资源定义(CRD)。</li><li id="d574" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">应用程序源类型</strong> —哪个工具用于构建应用程序。</li><li id="33b1" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">目标状态</strong> —应用程序的期望状态。</li><li id="082a" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">实时状态</strong> —该应用的实时状态。</li><li id="1803" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">同步状态</strong> —实时状态是否与目标状态匹配。</li><li id="5b16" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">同步运行状态</strong> —同步是否成功。</li><li id="abcb" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">刷新</strong> —将 Git 中的最新代码与 live 状态进行比较。找出不同之处。</li><li id="3afa" class="ml mm ir li b lj ng lm nh lp ni lt nj lx nk mb mq mr ms mt bi translated"><strong class="li is">健康</strong> —应用程序的健康状况，运行是否正确？</li></ul><p id="6fe6" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">更多详情可以查看官网:<a class="ae nd" href="https://argo-cd.readthedocs.io/en/stable/core_concepts/" rel="noopener ugc nofollow" target="_blank">https://argo-cd.readthedocs.io/en/stable/core_concepts/</a></p><h1 id="9dc4" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">安装 Argo 光盘</h1><ul class=""><li id="6021" class="ml mm ir li b lj lk lm ln lp ny lt nz lx oa mb mq mr ms mt bi translated">创建一个名为“argocd”的新命名空间</li></ul><pre class="kh ki kj kk gu ob mf oc od aw oe bi"><span id="7fc9" class="nm kp ir mf b gz of og l oh oi">$ kubectl create ns argocd</span></pre><ul class=""><li id="880d" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">安装<code class="fe mc md me mf b">Argo CD</code></li></ul><pre class="kh ki kj kk gu ob mf oc od aw oe bi"><span id="7326" class="nm kp ir mf b gz of og l oh oi">$ kubectl apply -n argocd -f <a class="ae nd" href="https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</a><br/>customresourcedefinition... created<br/>...<br/>robinding..created<br/>...</span></pre><ul class=""><li id="a8eb" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">检查安装状态</li></ul><pre class="kh ki kj kk gu ob mf oc od aw oe bi"><span id="2a2d" class="nm kp ir mf b gz of og l oh oi">$ kubectl get po -n argocd</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj oj"><img src="../Images/122326033de59796b9953e15bc964020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GROB9cAehQbcCq5TkGdiA.png"/></div></div></figure><ul class=""><li id="ce45" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">要访问<code class="fe mc md me mf b">argocd</code>网络用户界面</li></ul><pre class="kh ki kj kk gu ob mf oc od aw oe bi"><span id="96d6" class="nm kp ir mf b gz of og l oh oi">$ kubectl port-forward --namespace=argocd service/argocd-server --address 0.0.0.0 8080:80</span></pre><ul class=""><li id="a518" class="ml mm ir li b lj mg lm mh lp mn lt mo lx mp mb mq mr ms mt bi translated">打开浏览器并转到:http:// <ip> :8080</ip></li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj ok"><img src="../Images/5a44f6dd75eb74a0e908dfb6e5727a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pvaeh6Tzn9iQX2sRLHoU5A.png"/></div></div></figure><p id="195d" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">用户名为“admin ”,密码从以下命令获得:</p><pre class="kh ki kj kk gu ob mf oc od aw oe bi"><span id="8d10" class="nm kp ir mf b gz of og l oh oi">$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d</span></pre></div></div>    
</body>
</html>