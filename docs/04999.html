<html>
<head>
<title>How To Build A Marvelous Tech Stack Of Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立一个了不起的弹性搜索技术栈</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-a-marvelous-tech-stack-of-elasticsearch-798bae89b13c?source=collection_archive---------5-----------------------#2021-06-01">https://blog.devgenius.io/how-to-build-a-marvelous-tech-stack-of-elasticsearch-798bae89b13c?source=collection_archive---------5-----------------------#2021-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0b50" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Elasticsearch、Logstash、Kibana和Grafana快速指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e6bbf3ae44568b5f655c614e188058e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w_uo3OBK274IJ6PJ3cVsyA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">内特·雷菲尔德在<a class="ae kv" href="https://unsplash.com/s/photos/earth-landscape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a0c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">全文搜索几乎是许多系统的必备功能。由于谷歌搜索引擎的普遍使用，键入一些文本来寻找一些东西是一种习惯行为，用户在电子商务网站和其他系统中寻找文件或记录时，只是希望有相同的功能。</p><p id="e483" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，实现强大的搜索功能从来都不容易。大多数关系数据库(如MySQL)都提供全文搜索功能，这可能是一个立竿见影的解决方案，但您会发现，当涉及到搜索准确性的微调和对非结构化数据的支持时，它不够灵活。</p><p id="1b95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您正在考虑为您的系统构建全文搜索功能的解决方案，那么Elasticsearch是一个受欢迎的选择，它可能是一个不错的候选。这是一个支持非结构化数据的NoSQL文档数据库。它的索引机制由Luene支持，支持高性能的全文搜索。</p><p id="127a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅仅部署Elasticsearch实例作为数据库是不够的，其他功能(如数据馈送、数据可视化和可观察性)也很重要，不容忽视。在本文中，我将向您简要介绍Elasticsearch的技术架构。您将学习如何使用和部署Elasticsearch的技术堆栈，设置数据馈送以及数据可视化。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="667e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">技术堆栈概述</h1><p id="40fb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">整体技术格局由Logstash、Elasticsearch和Kibana组成。该技术堆栈被称为ELK堆栈。下面的组件图说明了技术堆栈的数据流。</p><p id="eb76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数企业系统的数据库不仅连接到应用程序，还将其他系统与数据源集成在一起。例如，在线电子商务系统可以从分析工具获取数据，以提供量身定制的用户体验。Logstash是一个中间件，它以各种格式(如CSV和JSON)从源系统中提取数据，然后转换并加载到Elasticsearch中。</p><p id="03fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然应用程序为客户的业务功能提供数据，但内部操作也需要数据访问，以便进行报告和分析。Kibana充当前端层，允许数据分析师访问数据并创建有意义的图表和报告。</p><p id="3213" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要忘记系统监控，可观察性对于快速访问系统指标的系统支持至关重要，以便评估系统状态并在需要系统恢复时采取必要的措施。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5db9798822fceda36ce991d7b528f8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*DZx-nlDXUrCPxub0JM5XTw.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索技术堆栈</figcaption></figure><p id="12eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了浏览ELK stack的部署和使用，我将向您展示设置，并基于作为样本数据的国家书目图书数据集演示使用方法。本文涉及的所有材料，如docker compose定义、配置文件和样本数据集，都可以在这个<a class="ae kv" href="https://github.com/gavinklfong/docker-compose-collection/tree/main/elasticsearch" rel="noopener ugc nofollow" target="_blank"> GitHub存储库</a>中获得。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8821" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Docker编写技术堆栈定义</h1><p id="5e99" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Docker使系统配置变得非常容易，服务器堆栈部署可以通过定义YAML格式的docker compose来完成。我们在docker compose定义中定义了一个Elasticsearch实例和Kibana。这里的示例在单节点模式下部署了一个Elasticsearch实例，这只是为了进行演示。在生产环境中，建议部署一个包含3个节点的集群，以支持高弹性和可用性。详见<a class="ae kv" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html" rel="noopener ugc nofollow" target="_blank">官方页面</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3ea5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要打开技术堆栈，请在命令提示符下将目录切换到docker-compose.yml文件的文件夹中，然后运行以下命令</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f707" class="ne ma iq na b gy nf ng l nh ni">docker compose up</span></pre><h2 id="d282" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">弹性搜索GUI</h2><p id="1396" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Elasticsearch不提供任何GUI管理控制台，获取服务器集群状态、数据操作、搜索数据记录等所有操作都是通过REST APIs完成的。多亏了开发者社区的贡献，许多GUI客户端都是免费的。客户端使用Elasticsearch的REST APIs，并在浏览器视图上显示信息。</p><p id="ac57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中一个GUI客户端是<a class="ae kv" href="https://elasticvue.com/" rel="noopener ugc nofollow" target="_blank"> Elasticvue </a>，它可以作为插件在Chrome上运行。一旦你在Chrome上安装了插件，当你运行Elasticvue时，你会看到这个屏幕。只需点击“连接”按钮进入主屏幕，无需输入用户名/密码，因为新创建的Elasticsearch实例没有任何身份验证设置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/9eddfd9c5fd9af230134b3e410f03f3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gckroogu_68Mfi8ngjP8mA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性值—连接屏幕</figcaption></figure><p id="eb58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主页屏幕将显示表明系统健康状况的集群节点信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/3ad5617299067a004ad66a4c3cc95c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EElg3e2ODo7SqAAAvYP3JQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性值—节点信息</figcaption></figure><p id="8862" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你点击“索引”标签时，它不显示任何数据，因为这是一个新创建的Elasticsearch实例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/8d255e45bc3c0eb82a149514e9e75795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qefEI5xIEdHuYTcAT2AIkw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性值—指数</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fcd1" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Logstash数据管道</h1><p id="811a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">随着Elasticsearch实例的启动和运行，是时候研究关于数据管道设置的细节了。Logstash数据管道简单易懂。这是一个典型的ETL模式，即获取数据输入、转换数据记录并输出到目标。</p><p id="631e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看将数据从CSV文件加载到Elasticsearch的示例管道。</p><ul class=""><li id="7f77" class="nx ny iq ky b kz la lc ld lf nz lj oa ln ob lr oc od oe of bi translated"><strong class="ky ir">输入</strong> —从CSV文件开始读取，从起始位置开始读取数据。</li><li id="dfdb" class="nx ny iq ky b kz og lc oh lf oi lj oj ln ok lr oc od oe of bi translated"><strong class="ky ir">过滤器</strong> —指定数据字段列表，以便管道知道如何提取CSV记录。</li><li id="1844" class="nx ny iq ky b kz og lc oh lf oi lj oj ln ok lr oc od oe of bi translated"><strong class="ky ir">输出</strong> —将记录发送到两个输出— (1)写入控制台标准输出和(2)发送到Elasticsearch以创建新文档。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/dad06edb52c95ca3dce2e3d0babe5758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMa_01OMCLUw6BCO9phKkw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">log stash—CSV文件馈送的示例管道</figcaption></figure><p id="56c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">管道配置是声明性的和直观的，因此您只需查看配置文件就可以快速了解数据流的概念。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6d6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与本演示一起，GitHub存储库中提供了一个包含<strong class="ky ir"> logstash-log </strong>文件夹中的50k图书记录(<strong class="ky ir"> book-sample-data.csv </strong>)的样本数据集，它是英国国家书目图书数据集的子集。如果你对获得大约300万条记录的完整数据集感兴趣，你可以从<a class="ae kv" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/YGHGQB" rel="noopener ugc nofollow" target="_blank">哈佛数据节</a>下载CSV文件</p><p id="fdfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行这个命令来打开Logstash的docker容器</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="9441" class="ne ma iq na b gy nf ng l nh ni">./run-logstash.sh</span></pre><p id="979f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">初始化完成后，Logstash的管道将自动读取和处理CSV数据文件。由于数据管道会将记录输出到控制台和Elasticsearch，因此在数据导入过程中，您会在控制台终端上看到提取的CSV数据记录。</p><p id="17e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为Logstash将继续监视文件中的新数据条目，所以它将在数据导入完成后继续运行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/2d656952660e49525a0082bffd9e101f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_egLWKsJobc7ve52iINoQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Logstash —示例CSV管道的控制台输出</figcaption></figure><p id="23e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您在Elasticvue上查看，那么您会发现新创建的索引“book”有50k条记录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/b0556ce4cb25f7c6337b5ba139ef0581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W75glm_prY1w16U2Dg4TLQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">elastic value—包含新导入数据的索引</figcaption></figure><p id="50fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您选择一个数据记录时，Elasticvue将向您显示记录的详细信息。这里有一个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/05f9ec1a084a62af0c719d4469756fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACdPJua2a68nggChauw3KA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性值—查看记录详细信息</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c321" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">弹性搜索—REST API</h1><p id="f8b1" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Elasticsearch为CRUD操作提供REST APIs。应用程序通过使用数据存储的API与数据存储集成。让我们使用新导入的图书索引来简单探索一下REST APIs。</p><h2 id="2611" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">搜索</h2><p id="d629" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了进行查询，Elasticsearch提供了GET和POST HTTP方法的API。使用GET方法的URI搜索是一种简单的获取数据的方法，其搜索阶段在URI指定。下面的示例在所有字段中对文本短语“new age”进行全文搜索。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="9a1c" class="ne ma iq na b gy nf ng l nh ni">curl --request GET --url 'http://localhost:9200/book/_search?pretty&amp;q=new%20age'</span></pre><p id="66c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还可以基于特定字段的值搜索记录。本示例获取出版物place = "new york "的所有图书记录。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="faae" class="ne ma iq na b gy nf ng l nh ni">curl --request GET --url 'http://localhost:9200/book/_search?pretty&amp;q=publicationPlace:new%20york'</span></pre><p id="36ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">POST方法的查询支持更复杂的搜索标准。该查询是基于JSON格式的领域特定语言(DSL)。例如，此查询包含2个搜索条件—标题包含“水果”，出版地点是“伦敦”</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="b77f" class="ne ma iq na b gy nf ng l nh ni">curl -X POST "localhost:9200/book/_search?pretty" -H 'Content-Type: application/json' -d'<br/>{<br/>  "query": {<br/>    "bool": {<br/>      "must": [<br/>        {<br/>          "match": {"title": "fruit"}<br/>        },<br/>        {<br/>          "term": {"publicationPlace.keyword": "London"}<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}’</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/32073668f59714efc779ed91b90f4407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-14b6PZ8G8-GNaw64GOqw.jpeg"/></div></div></figure><p id="ca09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，Elasticsearch Query DSL是强大的，它支持复杂的搜索标准，如基于命中分数的搜索和其他专门的查询。如果您有兴趣了解更多信息，请访问<a class="ae kv" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/query-dsl.html" rel="noopener ugc nofollow" target="_blank"> Elasticsearch Query DSL </a>了解详情。</p><h2 id="94e6" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">插入</h2><p id="4436" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要插入新记录，请使用PUT或POST HTTP方法插入JSON格式的数据。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="2882" class="ne ma iq na b gy nf ng l nh ni">curl -X PUT "localhost:9200/book/50001" -H 'Content-Type: application/json' -d'<br/>{<br/>"publicationPlace": "London",<br/>"publicationAgent": "B.S.I",<br/>"id": "50001",<br/>"description": "NA",<br/>"title": "Methods for the analysis of fruit and vegetable products",<br/>"creatorOrg": "British Standards Institution",<br/>"creatorPerson": "",<br/>"contributorOrg": "",<br/>"subjects": "Fruit--Standards;Vegetables--Standards",<br/>"uri": "http://bnb.data.bl.uk/id/resource/005590057",<br/>"publicationDate": "1975",<br/>"contributorPerson": ""<br/>}’</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/b1c43fd7ac8f501c4deec59d905eb309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*efGHg1Lx6WFbZ4mMUaWuWQ.jpeg"/></div></div></figure><h2 id="feb9" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">更新</h2><p id="0f38" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">数据更新与插入非常相似。您可以放入一个完整的文档，或者只指定某些字段值，用于目标文档id的记录更新。如果具有相同文档id的记录已经存在，那么Elasticsearch将更新现有记录。否则，它会将数据视为新记录。</p><p id="5b34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个例子演示了一个更新文档id 50001的发布地点和描述的请求</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="1e70" class="ne ma iq na b gy nf ng l nh ni">curl -X PUT "localhost:9200/book/50001" -H 'Content-Type: application/json' -d'<br/>{<br/>"publicationPlace": "Leeds",<br/>"description": "New description"<br/>}’</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/aeb5b15b559cae2fe8f12e21bdbb9e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8H0h7NTPj0Am5tBJilFKjA.jpeg"/></div></div></figure><h2 id="4e35" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">删除</h2><p id="96e2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">删除可以简单到使用DELETE HTTP方法为目标文档id触发一个请求。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="c26d" class="ne ma iq na b gy nf ng l nh ni">curl --request DELETE --url '<a class="ae kv" href="http://localhost:9200/book/_search?q=new%20york&amp;pretty" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/book/</a>50001’'</span></pre><p id="5558" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您希望根据查询条件删除一些记录，那么您可以使用POST HTTP方法。以下示例删除了所有出版地点为伦敦的书籍</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a782" class="ne ma iq na b gy nf ng l nh ni">curl -X POST "localhost:9200/book/_delete_by_query" -H 'Content-Type: application/json' -d'<br/>{<br/>  "query": {<br/>    "bool": {<br/>      "must": [<br/>        {<br/>          "term": {"publicationPlace.keyword": "London"}<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}’</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/d7bea832f7c5eb7c47cbcd8d12494ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xsxZVyIknJFHLlfNZU69-w.jpeg"/></div></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="10a9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Kibana —数据可视化</h1><p id="e224" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Kibana通过在仪表板、图表、仪表和世界地图中呈现数据来实现数据可视化。它允许您通过创建数据检索查询来浏览数据，而无需发出任何REST API请求。</p><p id="2530" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进入<a class="ae kv" href="http://localhost:5601" rel="noopener ugc nofollow" target="_blank"> http://localhost:5601 </a>，你会看到一个欢迎界面。只需点击“自己探索”按钮，并进入主屏幕。</p><p id="2320" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要将新导入的图书数据集添加到Kibana，请转到左侧菜单中的“管理”,然后单击“索引模式”下的“创建索引模式”按钮。将索引名“book”输入到模式中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/e5441854e11c7e09bae80b7c6e84ba2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMXyRmZw04aGkEYIANXM0w.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Kibana —添加索引模式</figcaption></figure><p id="997a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦添加了图书索引的模式，请转到左侧菜单中的Discover。您可以指向“图书”索引并浏览数据集。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/ceee0e2d6212576500090e7f14a372ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMy2-Pi8-xdPsaRihl66eg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Kibana —发现图书索引</figcaption></figure><p id="98d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尝试搜索一个关键字或文本短语，你会看到一个记录列表与亮点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/ce6e84b2dfe3243c7413f5fc71d8c76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_ZvDarhkalhYO1DU8H89w.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Kibana查询结果</figcaption></figure><h2 id="895d" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">数据可视化</h2><p id="d0ac" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">查看左侧菜单中的可视化功能。创建一个新的垂直条形图，Y轴为记录数，X轴为出版地点，Kibana将分析数据并生成一个条形图，显示按地点出版的图书数量。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/31007bb9c8a8e14515a4c87525d96518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*liyYDtU9TVqQuNS085nNJw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">基巴纳—数据可视化—条形图</figcaption></figure><p id="4484" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此示例在饼图中显示了书籍数量排名前5位的作者。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/886b3759197b5407494c943343d43ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opr4KeEPgRnkIFZgtHQtAQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">基巴纳—数据可视化—饼图</figcaption></figure><p id="ecde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要汇总数据，您可以利用数据网格来呈现数字</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/404614282b61884954ba5f3008d9cf1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YL_2K_GmvJzfBwLYDf2yYw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">基巴纳—数据网格</figcaption></figure><h2 id="f119" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">更多样本…</h2><p id="7ee4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Kibana带有内置的样本数据，展示了数据可视化的能力。环顾四周，探索各种仪表板和图表是很有趣的。</p><p id="ff82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了样本数据，还有仪表盘、图表和地图视图，让您了解Kibana的功能。Kibana是一个强大的工具，允许数据分析师审查数据，创建有意义的可视化和洞察力。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/8200d9c7c62ce093a6b987f1755422d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6IZwogFm4NwYYgGawqfxA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Kibana —仪表板示例</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bd60" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可观察性——Grafana仪表板</h1><p id="e0b4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">没有适当监控的系统注定会失败。在缺乏系统度量和服务状态的信息的情况下，系统支持不可能排除故障并采取必要的措施来保持系统处于运行状态。</p><p id="6747" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，快速访问系统状态和指标(如资源利用率和性能状态)对于维护健康的系统至关重要。用时序图表以组织良好的格式呈现系统状态不仅可以提供快速的洞察力，还允许系统专家预测趋势，以便通过制定预防措施来避免潜在的问题。</p><p id="5d57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Grafana是一个出色的前端系统，它组织系统指标，并在仪表板中显示数字和图表。下面的屏幕截图是Elasticsearch的仪表板示例，仪表板中的KPI数字是系统健康状况的关键指标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/67d0d540330863676b95892b1027955b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2wK-snify8rllJQk6zNWg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —弹性搜索仪表板</figcaption></figure><h2 id="6772" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">监控系统是如何工作的？</h2><p id="bcbf" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">系统监控的实现是相当标准的。使用Grafana + Prometheus是业内通行的做法。下面的组件图概述了组件如何协同工作。Prometheus是一个时间序列数据库，是收集和存储各种系统的系统指标的中心点。由于它可能无法与所有类型的系统直接集成，因此它依赖于导出器来抓取这些系统的信息。然后，Grafana从Prometheus获取指标，并在仪表板中显示系统信息。</p><p id="ae0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了仪表板显示之外，如果系统使用率超过预定义的阈值，如内存使用率超过80%，Prometheus还支持警报触发。我将在另一篇文章中讨论细节。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/262e18ba80aab05235dc28e5ea5e8b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6EnJb2BjiFPH9YQSDUTJQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">可观察性的技术栈</figcaption></figure><h2 id="6e7f" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">用于系统监控的技术堆栈实施</h2><p id="bf63" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">使用docker compose进行部署是构建服务组件堆栈的一种便捷方法。这个docker组合定义实现了上面组件图的设置。假设Elasticsearch在一个名为“elasticsearch_default”的docker网络上运行在一个独立的docker compose堆栈上，因此导出器通过同一个docker网络连接到elasticsearch服务器实例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="0e03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在系统初始化时，Prometheus被配置为获取此配置文件，该文件指示Prometheus每3秒钟从导出器创建一个系统指标检索作业。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="0da8" class="ne ma iq bd mb nj nk dn mf nl nm dp mj lf nn no ml lj np nq mn ln nr ns mp nt bi translated">在Grafana中创建仪表板</h2><p id="16a2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">一旦技术栈启动并运行，请访问<a class="ae kv" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。您将看到Grafana登录屏幕。使用默认id &amp;密码登录:admin / admin。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/17deb129273db683b1bbf45123c40fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajfB1HrCeTy0hqhuWAK7Rg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —登录屏幕</figcaption></figure><p id="a1c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Grafana需要知道从哪里获得系统指标。因此，首先要做的是创建一个指向普罗米修斯的数据源。转到左侧菜单中的“配置→ IData源”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/c6e064c61b1bb6afe562589b85d9f370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gT0d5roTfGd29gPY1B9qPQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana添加数据源</figcaption></figure><p id="4819" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输入网址:“<a class="ae kv" href="http://prometheus:9000" rel="noopener ugc nofollow" target="_blank"> http://prometheus:9000 </a>”。在docker网络中，DNS名称与容器名称相同，因此您可以通过其容器名称连接到Prometheus。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/fad7b225f65c087e955e58c192789756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFyGUaUjj2TD305LHi5x9A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana添加数据源</figcaption></figure><p id="dc15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，转到“创建→导入”,通过导入创建新的仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/2a3e6a3b90823e13c855aced9b50c9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDvr_ccBoXCUXT6dAVNGSA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —导入仪表板</figcaption></figure><p id="2fd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Grafana的官方网站维护着一个仪表盘库。一些仪表板是官方的，而另一些是由社区中的个人提交的贡献。存储库中新注册的仪表板会分配一个唯一的编号。在本例中，我们将导入这个仪表板(【https://grafana.com/grafana/dashboards/2322】T2)</p><p id="c204" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要导入仪表板，只需提供仪表板的唯一id。然后，将从grafana.com检索定义</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/627255f9774179cbddb9979d1882e040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELHqIgIjuerAr3HBKk6xQw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana按ID导入仪表板</figcaption></figure><p id="6afd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，将新导入的仪表板的数据源设置为Prometheus。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/84d9b60ac51939bd4b0ee85f7adb4f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKLJj0BZ84eMGEf5rxWsnw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —导入仪表板—设置数据源</figcaption></figure><p id="fff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，仪表板创建完成。模板是一个起点，如果需要，您可以微调和定制仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/67d0d540330863676b95892b1027955b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2wK-snify8rllJQk6zNWg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana仪表板</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1987" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后的想法</h1><p id="a3c2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Elasticsearch是一个强大的全文搜索工具，它在数据查询方面优于其他数据库，因为它在索引方面非常灵活，并提供了出色的数据搜索性能。除了与Elasticsearch的应用程序集成之外，使用Logstash和Kibana建立完整的技术堆栈可以实现无缝数据集成和有效的数据可视化。实现简单明了，不需要构建任何应用程序代码。此外，观察能力也同样重要。Grafana + Prometheus是仪表板创建的最佳选择。系统健康指标和有洞察力的数字提供了关键信息，这些信息对于维护健康的系统是必不可少的。</p></div></div>    
</body>
</html>