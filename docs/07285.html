<html>
<head>
<title>Setup Master Slave Replication with MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 MySQL 设置主从复制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-master-slave-replication-with-mysql-e528dcd3b24a?source=collection_archive---------0-----------------------#2022-03-12">https://blog.devgenius.io/setup-master-slave-replication-with-mysql-e528dcd3b24a?source=collection_archive---------0-----------------------#2022-03-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5bc8c15e1ac89c21b3ba0e83829c428e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhMN5Ji_nH-Djn2VvHOZ3Q.jpeg"/></div></div></figure><p id="7509" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们期望更高的吞吐量时，通常会增加数据库的读操作和写操作。因此，我们需要一种方法，通过添加多个服务器(从服务器)来复制数据库中的数据，允许应用服务器而不是主服务器从这些服务器中读取数据。主设备将只处理写操作。</p><p id="1a98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种设置主从复制的方式非常有用，因为它将制作您数据的多个副本，在其中一个从服务器出现故障时提供冗余。它可以提高可用性和可扩展性，因为我们可以在获得更高吞吐量和整体性能时添加更多从服务器。这种在多个数据库上进行同步的做法称为复制。</p><p id="7792" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本教程期望您已经掌握了一些关于关系数据库管理系统和使用 GNU/Linux 操作系统的基本知识。</p><p id="2f2a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我们现在首先要做的就是安装第一台主 MySQL 服务器。我会在 Ubuntu 21.10 上安装这个。我们还将在本地机器上使用 VirtualBox，我们可以下载一个准备好的 Ubuntu 21.10 镜像，我们可以将它导入 VirtualBox，而不必自己安装操作系统。</p><p id="18a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们当然也可以使用云提供商来设置服务器，这些服务器也已经准备好了可以使用的映像。但是不管怎样，只要对本教程有用。</p><h1 id="a061" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">安装 VirtualBox 并下载 Ubuntu 映像</h1><p id="9690" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">所以我们从这里开始下载 VirtualBox:<a class="ae lw" href="https://www.virtualbox.org/wiki/Linux_Downloads" rel="noopener ugc nofollow" target="_blank">https://www.virtualbox.org/wiki/Linux_Downloads</a>选择 Ubuntu 19.10 / 20.04 / 20.10 / 21.04。然后在 Ubuntu 软件中打开软件，按安装。</p><p id="c65a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们在这里下载 Ubuntu 镜像:【https://www.osboxes.org/ubuntu/ T2】选择 Ubuntu 21.10 Impish Indri。这个文件将用 7zip 下载，所以我们需要解压它。我们可以通过按下<strong class="jx io">信息</strong>按钮找到稍后需要的登录信息。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/41d882a73943d0dab8102015068a8936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*Tnt6CkfAM9P7TIsw7II1mw.png"/></div></figure><p id="5b02" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开 VirtualBox 并按下按钮<strong class="jx io">新建</strong></p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/ea6e3cbf5b8879f18b3d2a4450c7b8dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIOzmBO9KwnSkSFDUKhsrw.png"/></div></div></figure><p id="eeff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在将出现一个弹出窗口，您可以在其中输入虚拟机名称、存放数据的目录、操作系统类型和版本。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/0157e25dc961d20b36641ed74a7cdbd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*CrX5OTsSIxaONtxfeIrIlg.png"/></div></figure><p id="954d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除机器文件夹外，填写以上信息，然后按下一步:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/ad78ecec77f173612279e8e52bd0e943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*z_5gptXQbZhRYe59FvhNDg.png"/></div></figure><p id="92c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在它将询问应该分配多大的内存。使用默认设置。如果你发现</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/d7a0bdba1ac1e6deb0ff303db878e495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*xhnwXWFnt0yxC1QUiqc67Q.png"/></div></figure><p id="8ae4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我们将按“使用现有的虚拟硬盘文件”,并按下目录图标。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/1607d437a4605c77865c61ebe84ef494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HK4IUjBZ1R0rYeKFs5ZceA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">添加硬盘(VDI)</figcaption></figure><p id="4dd2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个弹出窗口将出现，我们按添加。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/af45a6b019a55a840734718f55d835f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M912gtVX1i90ddHBVxchcQ.png"/></div></div></figure><p id="0a40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">找到你的<strong class="jx io">。vdi </strong>文件，您在其中导出了 7zip 文件，然后按 Open。现在继续保存虚拟机。</p><p id="48f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">开始之前，我们需要通过进入<strong class="jx io">设置</strong>将网络设置为桥接适配器，以便我们可以为虚拟机获取唯一的 IP:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/7a9d04f639a8a1e7d1feaddcf49bdcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bnegn_6Zt59irPUaW_eHjQ.png"/></div></div></figure><p id="eefe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们有了一个可以启动的虚拟机，所以按下开始按钮，Ubuntu 就会加载。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/7a37010f6042928f9c47cc5bd3083584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZ6p1leeZBhlUDxh2BSVSA.png"/></div></div></figure><p id="1bb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您遇到光标闪烁的问题或启动困难。您可能希望增加虚拟机的 RAM 或图形内存。还要检查你的 CPU 是否支持硬件虚拟化。这可以通过 GNU/Linux 中的命令来完成:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="59c0" class="mr ku in mn b gy ms mt l mu mv">egrep -c ‘(vmx|svm)’ /proc/cpuinfo</span></pre><p id="f192" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你得到任何大于 0 的值，你的硬件支持它。</p><p id="1d2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在使用凭证登录</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/53fa833d89267f05d2b685bd0e39eebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHSNONgiYzEmRJy4lKrMTA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">使用密码 osboxes.org 登录系统</figcaption></figure><p id="33a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以通过打开终端并输入以下命令来禁用 GUI:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="502b" class="mr ku in mn b gy ms mt l mu mv">sudo systemctl set-default multi-user</span></pre><p id="0cec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在重新启动系统，我们将只看到 CLI:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/704aa3632e9a5be08a6d7c233ebcb56e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqpmN_-uYpg9PjOT-mSfhA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">Ubuntu CLI</figcaption></figure><h1 id="813b" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置 MySQL 主虚拟机</h1><p id="814d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">现在，我们使用凭据登录，开始安装所有必需的软件包和依赖项。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="bca5" class="mr ku in mn b gy ms mt l mu mv">sudo apt-get update<br/>sudo apt-get install mysql-server mysql-client -y</span></pre><p id="768a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要使用以下命令来获取虚拟机的 IP 地址</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="1758" class="mr ku in mn b gy ms mt l mu mv">ip addr show</span></pre><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/a1176754d7a3656c59c288afc65298b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMOov2TrfJ0A1FeDSJcbmw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">192.168.32.10</figcaption></figure><p id="a55e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第二个以太网上复制 inet 的值，在这种情况下，它应该是<strong class="jx io"> 192.168.32.10 </strong>。</p><h1 id="a633" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置 MySQL 从属虚拟机</h1><p id="94c0" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">因此，按照之前的说明，使用我们下载的相同映像创建一个新的虚拟机。但是附加上<strong class="jx io">可能会有问题。vdi </strong>文件，因为它将具有相同的 UUID。因此，我们需要首先通过进入命令行并输入:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="9ab0" class="mr ku in mn b gy ms mt l mu mv">VBoxManage internalcommands sethduuid &lt;filename&gt;.vdi</span></pre><p id="64d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后继续安装虚拟机，然后我们再次安装软件包。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="6e63" class="mr ku in mn b gy ms mt l mu mv">sudo apt-get update<br/>sudo apt-get install mysql-server mysql-client -y</span></pre><p id="5cad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们像以前一样获取这个虚拟机的 IP 地址，并保存它。</p><h1 id="b10f" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">MySQL 主配置</h1><p id="c890" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">使用 VIM 或 Nano 打开配置:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="1dbe" class="mr ku in mn b gy ms mt l mu mv">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span></pre><p id="10b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">找到包含 bind-address 的行，并用我们之前得到的 MySQL master 的 IP 地址替换该值。接下来，我们将在文件中找到这些行并删除注释:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="ebef" class="mr ku in mn b gy ms mt l mu mv">server-id = 1<br/>log_bin = /var/log/mysql/mysql-bin.log</span></pre><p id="a2e7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了避免我长期以来遇到问题，我也删除了这一行:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="ccb4" class="mr ku in mn b gy ms mt l mu mv">mysqlx-bind-address = 127.0.0.1</span></pre><p id="d126" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们重启 MySQL 服务</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="8025" class="mr ku in mn b gy ms mt l mu mv">sudo service mysql restart</span></pre><p id="32a6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确认 MySQL 是否正在运行:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="90d7" class="mr ku in mn b gy ms mt l mu mv">systemctl status mysql</span></pre><p id="b10c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们在配置中出错或 IP 不正确，我们会看到它在这里处于失败状态。</p><p id="273c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将在稍后阶段对此服务器进行一些额外的配置。我们首先要设置 MySQL 从属虚拟机。</p><p id="1fc1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在将创建一个应该用于从服务器的用户，以便它们可以登录到 MySQL 主服务器。在下面输入以下命令。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="fd11" class="mr ku in mn b gy ms mt l mu mv">sudo mysql -uroot<br/>mysql&gt; CREATE USER ‘slave’@’SLAVE_IP_ADDRESS‘ IDENTIFIED BY ‘SLAVE_PASSWORD‘;<br/>mysql&gt; GRANT REPLICATION SLAVE ON *.* TO ‘slave’@’SLAVE_IP_ADDRESS‘;<br/>mysql&gt; FLUSH PRIVILEGES;<br/>mysql&gt; FLUSH TABLES WITH READ LOCK;</span></pre><p id="6b11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以使用以下命令来验证状态</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="6dc6" class="mr ku in mn b gy ms mt l mu mv">mysql&gt; SHOW MASTER STATUS;</span></pre><p id="67e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要将现有的数据转移到从属服务器。所以退出 MySQL CLI。我们进行 MySQL 转储，并将其保存到一个. SQL 文件中。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="fc6c" class="mr ku in mn b gy ms mt l mu mv">sudo mysqldump -–all-databases &gt; data.sql</span></pre><h1 id="5a43" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">MySQL 从属配置</h1><p id="29f4" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们打开从 MySQL 配置，在这里将绑定地址设置为 IP，并像以前一样注释掉这些行，但是记住将<strong class="jx io">服务器 id </strong>设置为 2 而不是 1。然后我们重启 MySQL 服务。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="8a32" class="mr ku in mn b gy ms mt l mu mv">mysql&gt; CHANGE MASTER TO<br/>     MASTER_HOST='&lt;master-ip&gt;' ,<br/>     MASTER_USER='slave' ,<br/>     MASTER_PASSWORD='Test1234!!#' ,<br/>     MASTER_LOG_FILE='mysql-bin.000001' ,<br/>     MASTER_LOG_POS=1232;</span></pre><p id="5c9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用您的主 IP 地址替换 MASTER_HOST，用运行 SHOW MASTER STATUS 时获得的文件名替换 MASTER _ LOG _ FILE 并在 MASTER_LOG_POS 上获取位置并设置它。</p><h1 id="15a1" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置用于传输的公共/私有 SSH 密钥</h1><p id="e692" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">让我们将 data.sql 文件从主服务器传输到从服务器。但是我们需要生成一个公钥/私钥，这样我们就可以用 SCP 传输它。因此，通过运行以下命令从主服务器创建一个密钥:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="eb5b" class="mr ku in mn b gy ms mt l mu mv">ssh-keygen</span></pre><p id="124b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">跳过不同的名称或密码。然后打开公钥:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="4d25" class="mr ku in mn b gy ms mt l mu mv">cat ~/.ssh/id_rsa.pub</span></pre><p id="6035" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">复制内容，然后转到 MySQL 从服务器。这里我们需要安装 openssh-server。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="626f" class="mr ku in mn b gy ms mt l mu mv">sudo apt-get install openssh-server</span></pre><p id="9088" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后打开 SSH 配置:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="c59c" class="mr ku in mn b gy ms mt l mu mv">sudo nano /etc/ssh/sshd_config</span></pre><p id="2a04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">修改<strong class="jx io"> PermitRootLogin </strong>并设置为<strong class="jx io"> Yes </strong>。保存文件。然后创建以下文件:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="8bca" class="mr ku in mn b gy ms mt l mu mv">touch ~/.ssh/authorized_keys</span></pre><p id="c904" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后打开它，粘贴我们之前生成的公钥。现在运行以下命令来重新启动 SSH 服务。</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="87ae" class="mr ku in mn b gy ms mt l mu mv">sudo systemctl restart ssh</span></pre><p id="35ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们应该能够与从属服务器通信了。我们可以通过以下方式进行测试:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="a1f7" class="mr ku in mn b gy ms mt l mu mv">ssh -v &lt;ip-of-slave&gt; /bin/true</span></pre><p id="aa74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们得到的退出状态为 0，应该没问题。现在我们将实际传输我们生成的转储文件:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="d820" class="mr ku in mn b gy ms mt l mu mv">scp data.sql osboxes@&lt;ip-of-slave&gt;:/home/osboxes</span></pre><p id="969b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们应该可以看到文件了，我们看到了！</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/326ee37689286acb9ac0c959dc700c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGMzr17Pr7cbrS-7T7bo_w.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们可以看到 data.sql 存在于主目录中</figcaption></figure><h1 id="f858" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">将 MySQL 转储文件导入 MySQL 从属服务器</h1><p id="ec05" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">现在让我们导入 MySQL 转储文件:</p><pre class="ly lz ma mb gt mm mn mo mp aw mq bi"><span id="63b9" class="mr ku in mn b gy ms mt l mu mv">sudo mysql -uroot &lt; data.sql</span></pre><p id="2c58" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们的 slave 中应该有相同的数据。我们可以通过进入 MySQL CLI 确认这一点。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/ec45e0a76e17d1397dae618809ef010f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LXKIrwRBb4ODdHudZ_Miog.png"/></div></div></figure><p id="c4ad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我们有相同的数据。很好！</p><p id="9485" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们向 master 添加一个新的数据库，以检查我们的复制是否有效。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/601abdb5d2ac292420822554b46b39b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uWk7iyi6iXzF2EXZ_5dxaQ.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们在 MySQL master 中添加了一个新的数据库 replicate_db</figcaption></figure><p id="ae5b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好的，我们现在有五个数据库。让我们检查是否所有东西都复制到了我们的 MySQL 从属服务器上。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/9319af25a5aba0027e932e961d15c4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUlNR6o86-ydp1_Bol1uhw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们现在看到我们的 replicate_db 已经被添加到了从属数据库中</figcaption></figure><p id="0862" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你在安装过程中遇到问题，你可以在这里查看复制清单:<a class="ae lw" href="https://dev.mysql.com/doc/mysql-replication-excerpt/8.0/en/replication-problems.html" rel="noopener ugc nofollow" target="_blank">https://dev . MySQL . com/doc/MySQL-Replication-extract/8.0/en/Replication-problems . html</a></p><p id="fe73" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本教程到此为止。我们应该为产品添加许多设置，但我不会在这里讨论，因为这将是非常广泛的，也许在未来的教程中。如果你想了解更多，请给我发评论。</p></div></div>    
</body>
</html>