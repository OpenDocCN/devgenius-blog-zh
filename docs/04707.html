<html>
<head>
<title>Quickly Debug Your AWS Lambda Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速调试 AWS Lambda 函数</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/quickly-debug-your-aws-lambda-functions-ff45ce433463?source=collection_archive---------4-----------------------#2021-04-23">https://blog.devgenius.io/quickly-debug-your-aws-lambda-functions-ff45ce433463?source=collection_archive---------4-----------------------#2021-04-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="5d22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将探讨如何更快地调试 AWS Lambda 函数的四种不同方法。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/5ec48341a3fa0d035073538a5cb6b5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NiLfeqf2Dz3Lk7t6JmdILQ.png"/></div></div></figure><p id="7544" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">伟大的作家使用隐喻来表达他们的观点，所以让我很快的尝试一下。</p><p id="fddc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虫子是讨厌的小害虫。要除掉他们很难，但除了只是到处喷毒，剩下的选择就很少了。其中一个选择是利用自然捕食者来消灭这些虫子，比如鸟类。</p><p id="cc83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以鸟可以帮你摆脱 bug，我在一家叫 Dashbird 的公司工作，帮助开发者调试他们的 AWS Lambda 应用。</p><p id="3c72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">看到我做了什么吗？<strong class="jm io">害虫\臭虫⇔鸟\大鲵</strong>？</p><h1 id="857d" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">使用 AWS Lambda 函数的主要原因</h1><p id="3225" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">AWS Lambda 的主要好处之一是，正如 AWS 所声称的那样，<strong class="jm io">“你可以忘记项目的基础设施，只专注于在云中启动应用程序，同时你将能够与其他亚马逊服务进行集成。”</strong>可扩展性和使用 AWS 计算资源的低成本是随之而来的其他好处。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/902a5ae2ee1d4b9d21949823afc28e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3xzmIVJErA-zHj6O.png"/></div></div></figure><p id="1b0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">Lambda 函数的剖析— AWS re:Invent 2017 </em></p><p id="b33c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你所需要做的就是<strong class="jm io">编写你的函数</strong>，<strong class="jm io">将它连接到一个事件</strong>，<strong class="jm io">部署它</strong>，然后<strong class="jm io"> AWS 会处理剩下的事情</strong>。Lambda 函数将在 AWS 上每小时处理数千个请求，而不需要您付出任何努力。</p><p id="0aeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">但是当 Lambda 函数失败时会发生什么</strong>？</p><h1 id="d504" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">如何调试 AWS Lambda 函数？</h1><p id="eb71" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">在谈到 AWS Lambda 函数的调试过程时，<strong class="jm io">四种方法是最常用的</strong>。这些方法可以分为两类。第一个是离线调试，第二个是日志记录。</p><h1 id="2059" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">离线调试 Lambda 函数</h1><p id="caaa" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">在标准开发过程中，脱机调试允许您在本地工作。</p><p id="ef10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">无服务器离线库非常适合在你的应用程序还在开发的时候调试它。它的行为非常类似于 AWS，让你访问各种服务，如 SQS，社交网络，S3 等。不同的是，不是请求命中实时服务，<strong class="jm io">而是请求去往本地仿真服务</strong>。</p><h1 id="408e" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">在线记录 Lambda 函数</h1><p id="7be0" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">假设你有一个<strong class="jm io">实时服务</strong>或者有一个<strong class="jm io">开发/登台环境</strong>或者<strong class="jm io">多个开发者同时在同一个项目上工作</strong>。在这种情况下，你需要开始关注现场调试服务。尽管调试 monolith 应用程序的工具数不胜数，但对于无服务器应用程序来说，调试工具却很少，有些比其他的好。</p><p id="aaf3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是当您将 Lambda 函数部署到真实的基础设施时，<strong class="jm io">日志记录可能是唯一剩下的调试方法</strong>。<strong class="jm io">可以通过三种方式进行记录</strong>。</p><ol class=""><li id="aa8b" class="ma mb in jm b jn jo jr js jv mc jz md kd me kh mf mg mh mi bi translated"><strong class="jm io">首先</strong>，直接登录 AWS CloudWatch，只需简单写入标准输出即可。这可能是最流行的方法，因为它很容易设置。CloudWatch 的缺点是所有的日志都是分组的，当你的应用程序中有许多活动部件时，需要花费大量时间来找出问题所在。然而，如果你刚开始使用 AWS Lambda，这可能是最好的选择。</li><li id="cdb7" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">第二种方式</strong>是<strong class="jm io">用像 Kinesis 这样的 AWS 服务编写自己的测井工具</strong>。在这个过程中，需要手动创建这些工具<strong class="jm io">将花费开发人员大量的时间</strong>，这进一步意味着成本会更高，因为将使用额外的亚马逊基础设施。但乍一看，这个过程似乎相当快。</li><li id="4887" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">第三种方式</strong>是使用第三方日志服务。它们没有使用 CloudWatch 的缺点，也不需要你浪费开发时间。</li></ol><p id="509f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Dashbird 是唯一完全致力于监控和调试 AWS Lambda 应用程序和无服务器系统的工具，我们的用户喜欢这项服务的主要原因是它的简单性。只需几次点击，您就可以连接您的 AWS 帐户，无需更改代码，并开始发现和排除<strong class="jm io">未知和已知错误</strong>，从微服务的一般统计数据到单个功能执行配置文件。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mo"><img src="../Images/677907f1ada56f9d34b535d1e4c29a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rfPzh-s5fyo-UwZl.png"/></div></div></figure><h1 id="c02c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">用 Dashbird 调试 AWS Lambda 函数</h1><p id="d091" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">Dashbird 是一个很好的选择，因为它是专门为无服务器开发者打造的，它能够快速检测任何类型的故障。Dashbird 为有效调试提供了相当多的功能，例如:</p><ul class=""><li id="0f1b" class="ma mb in jm b jn jo jr js jv mc jz md kd me kh mp mg mh mi bi translated"><a class="ae lz" href="https://dashbird.io/failure-detection/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">错误视图</strong> </a>在<strong class="jm io">中显示和发现故障点</strong>时必不可少，这让开发人员能够洞察哪里出错了。</li><li id="b94e" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mp mg mh mi bi translated"><strong class="jm io">日志搜索</strong>允许你<strong class="jm io">搜索 Lambda 日志</strong>，这意味着你将能够找到相关的调用。</li><li id="3a0c" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mp mg mh mi bi translated"><strong class="jm io">函数视图</strong>允许您<strong class="jm io">更仔细地查看任何看起来行为不当的函数</strong>并彻底解决它。</li><li id="71d6" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mp mg mh mi bi translated"><strong class="jm io">实时跟踪</strong>允许开发者<strong class="jm io">对函数的活动</strong>进行实时观察。</li><li id="ff4d" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mp mg mh mi bi translated"><strong class="jm io">跟踪</strong>让您对您的调用正在做什么以及它们是如何相互连接的有一个不可思议且令人信服的<strong class="jm io">洞察。</strong></li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mq"><img src="../Images/3c9b7a1499cb2f519866fa7869221f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dD65ago-Yy30MBRu.png"/></div></div></figure><h1 id="40f5" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">调试示例 Lambda 函数</h1><p id="ec63" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">让我们试着调试一个示例函数。我们可以用<strong class="jm io"> AWS Lambda web 控制台</strong>创建一个。我假设您知道如何做到这一点，并在此给出示例代码:</p><pre class="kk kl km kn gt mr ms mt mu aw mv bi"><span id="cec0" class="mw kw in ms b gy mx my l mz na">exports.handler = async (event, context) =&gt; {<br/>  console.log("Logging!");<br/>  <br/>  const x = event.a.b;<br/>};</span></pre><p id="a1f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该函数将生成两种类型的日志。首先调用<code class="fe nb nc nd ms b">console.log</code>函数，然后访问一个未定义的事件属性。</p><p id="9e8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你打开仪表板，首先看到的是主仪表板。这个错误将显而易见。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/4eb922a4e8a80481e80ada76f88adb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/0*qerOgax7SBL--DkW.png"/></div></figure><p id="8c66" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“<code class="fe nb nc nd ms b">Cannot read property ‘b’ of undefined</code>”—众所周知的 JavaScript 错误消息。当你点击它时，你会得到<strong class="jm io">事件视图</strong>，里面有更多的错误细节。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nf"><img src="../Images/8459474534c5798df171e086e7c5e6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Itx5g5kbdDY3Brsa.png"/></div></div></figure><p id="86d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Dashbird 的错误详细信息将向您显示<strong class="jm io">错误第一次发生的时间、最后一次发生的时间、发生的地点以及实际的严重程度</strong>。</p><p id="3aef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它甚至给你一个堆栈跟踪，这有助于在下一次部署之前调试错误。</p><p id="0bbc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是打给<code class="fe nb nc nd ms b">console.log</code>的电话最终去了哪里？如果你去<strong class="jm io">库存</strong>并在打开<strong class="jm io">的列表中点击你的<strong class="jm io"> Lambda 函数</strong>，你可以选择那个函数</strong>的最后调用。我的函数叫做<code class="fe nb nc nd ms b">extractRecords</code>，所以这就是我要搜索的。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nf"><img src="../Images/6240b691c5834ee2b19863b9347f7d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oZyoGLgH0GFGG5sx.png"/></div></div></figure><p id="de12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我单击最后一次调用，将打开该调用的日志，我将看到日志调用和错误。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/00df3f1120f95244ae22289d6147c72c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/0*be3PC6BIUVKtEvqu.png"/></div></figure><p id="2d8d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据你在函数中写的日志的数量，找到错误会变得很难，这就是为什么<strong class="jm io">我建议在调试</strong>时使用错误细节。</p><h1 id="c94c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">摘要</h1><p id="bc8a" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">AWS Lambda 函数在<strong class="jm io">隔离的远程环境</strong>中工作，这使得调试越来越复杂。当你的代码处于<strong class="jm io">开发阶段</strong>时，通过框架(想想<a class="ae lz" href="https://github.com/aws/serverless-application-model" rel="noopener ugc nofollow" target="_blank">无服务器应用模型</a>)到<strong class="jm io">在你的机器上监控和调试你的代码</strong>仍然是至关重要的。</p><p id="0061" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您最终<strong class="jm io">将您的功能部署到云</strong>时，需要不同的方法来获得您需要的<a class="ae lz" href="https://dashbird.io/serverless-observability/" rel="noopener ugc nofollow" target="_blank">洞察力</a>。如果你认为 CloudWatch 太笨重，并且你想一目了然地看到正在发生的事情，那么试试 Dashbird 吧。它是为了监控无服务器应用程序而从头开始构建的<strong class="jm io">，并且<strong class="jm io">消除了您在构建自己的日志服务时会发现的许多障碍</strong>。</strong></p></div></div>    
</body>
</html>