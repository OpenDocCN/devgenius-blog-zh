<html>
<head>
<title>Slack Clone with React | Semantic UI | GraphQL | PostgresSQL (PART 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 React |语义 UI | GraphQL | PostgresSQL 的松弛克隆(第 2 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/slack-clone-with-react-semantic-ui-graphql-postgressql-part-2-a392fefd1603?source=collection_archive---------4-----------------------#2020-09-16">https://blog.devgenius.io/slack-clone-with-react-semantic-ui-graphql-postgressql-part-2-a392fefd1603?source=collection_archive---------4-----------------------#2020-09-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5909b664182aab354de59ca3efd0081d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H7NWwdwf-25ILwqf"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Volodymyr Hryshchenko 在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fb35" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">之前，我们复习了 PostgreSQL 的介绍和安装。你可以在这里找到那篇文章</p><p id="cb71" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天，我们将快速设置我们的 Graphql 服务器。</p><h1 id="c067" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">文件夹设置</h1><p id="ba41" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">让我们从在一个你方便的地方创建一个文件夹开始。我把我的文件夹叫做聊天室。完成后，在文本编辑器中打开这个项目(我的是 VScode)。</p><h1 id="5a42" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">初始化项目</h1><p id="f335" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在您的终端(项目文件夹内)中运行此命令，启动您的项目。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="d501" class="mk kz in mg b gy ml mm l mn mo">npm init -y</span></pre><p id="6285" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦你看到文件夹中的<code class="fe mp mq mr mg b">package.json</code>文件，我们就可以开始了。接下来，我们需要安装我们将在后端使用的包。</p><h1 id="9088" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安装软件包</h1><p id="a75c" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在您的终端中运行此命令(在项目文件夹中)</p><p id="f461" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">依赖关系:</strong></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="dad7" class="mk kz in mg b gy ml mm l mn mo">npm i apollo server graphql pg pg-hstore sequelize bcrypt</span></pre><p id="2921" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在一行中这样做将为您安装所有这些软件。</p><p id="d5bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">依赖关系:</strong></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="4a28" class="mk kz in mg b gy ml mm l mn mo">npm i --save--dev nodemon sequelize-cli</span></pre><p id="10bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，您可能想知道这些包到底是做什么的？好问题。</p><h1 id="6cd5" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包装说明</h1><ul class=""><li id="00a9" class="ms mt in kc b kd lw kh lx kl mu kp mv kt mw kx mx my mz na bi translated"><strong class="kc io"> apollo server </strong>在我们的后端设置一个 Graphql 服务器。</li><li id="01d3" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">graphql 允许我们设置查询和变异，并在应用程序中定义端点。</li><li id="c4dd" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><strong class="kc io"> pg </strong>和<strong class="kc io"> pg-hstore </strong>处理我们的 PostgreSQL。pg-hstore 将我们的 JSON 数据转换成 hstore 格式。(后台工作)。</li><li id="918a" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">sequelize 是我们将用来创建模型的 ORM。它用来把我们的模型变成数据库的表格。</li><li id="c3a6" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">nodemon 允许我们保持服务器一直运行</li><li id="c10a" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">sequelize-cli 是一个命令行界面，我们将使用它来轻松地生成模型和其他东西。</li></ul><p id="1d1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文中我们要做的最后一件事是设置 apollo 服务器。</p><h1 id="919c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Apollo 服务器设置</h1><p id="b620" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在您的<code class="fe mp mq mr mg b">package.json</code>文件中，确保将您的主入口点设置为<code class="fe mp mq mr mg b">server.js</code>,如下所示</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="f402" class="mk kz in mg b gy ml mm l mn mo">"main" : "server.js"</span></pre><p id="e5d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在根项目文件夹中创建<code class="fe mp mq mr mg b">server.js</code>文件。</p><p id="d7a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在顶部，将这些文件导入<code class="fe mp mq mr mg b">server.js</code>。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7257" class="mk kz in mg b gy ml mm l mn mo">const { ApolloServer } = require("apollo-server");<br/>const typeDefs = require("./graphql/typeDefs");<br/>const resolvers = require("./graphql/resolvers");</span></pre><p id="33ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们包括了 apollo 服务器，这样我们就可以启动并运行服务器，我们需要创建另外两个文件。</p><p id="2656" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mp mq mr mg b">typeDefs</code>和<code class="fe mp mq mr mg b">resolvers</code>是我们需要传递到 apollo 服务器的文件，以使我们的 Graphql 工作。</p><p id="b811" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些文件很重要，<code class="fe mp mq mr mg b">typeDefs</code>将会有定义我们的端点应该是什么样子的代码。根据我们在<code class="fe mp mq mr mg b">typeDefs</code>中定义的方式，<code class="fe mp mq mr mg b">resolvers</code>将拥有返回这些端点数据的代码。(简而言之)</p><p id="6bbb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们创建这些文件。他们现在将是简单的，只是让我们开始。</p><p id="1b2b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在根项目文件夹中，创建一个<code class="fe mp mq mr mg b">graphql</code>文件夹。在这个文件夹中创建一个<code class="fe mp mq mr mg b">typeDefs.js</code>文件和一个<code class="fe mp mq mr mg b">resolvers.js</code>文件。</p><p id="3710" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe mp mq mr mg b">typeDefs.js</code>内部创建这个<code class="fe mp mq mr mg b">const { gql } = require("apollo-server");</code></p><p id="9bea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mp mq mr mg b">module.exports = gql`<br/> type Query {<br/> sayHi: String<br/> }<br/>`;</code></p><p id="4f07" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要将我们的类型定义包装在一个<code class="fe mp mq mr mg b">gql</code>模板中，然后导出这些类型，这样我们就可以在我们的 Graphql 服务器中访问这些端点。</p><p id="1989" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">稍后我们将深入探讨它们是如何工作的，这样我们就可以在我们的 apollo 服务器中导入一些东西。接下来让我们做解析器。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="c8d2" class="mk kz in mg b gy ml mm l mn mo">module.exports = {<br/>  Query: {<br/>    sayHi: () =&gt; "HI!!!"<br/>  }<br/>};</span></pre><p id="ef86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个<code class="fe mp mq mr mg b">sayHi</code>查询具有我们在类型中定义的确切名称。这是因为它们是相同的(稍后再深入探讨)。</p><p id="5c93" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们回到我们的<code class="fe mp mq mr mg b">server.js</code>文件，传入那些<code class="fe mp mq mr mg b">typeDefs</code>和<code class="fe mp mq mr mg b">resolvers</code>文件，同时启动我们的 apollo 服务器。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="242f" class="mk kz in mg b gy ml mm l mn mo">const server = new ApolloServer({<br/>  typeDefs,<br/>  resolvers<br/>});</span><span id="b28d" class="mk kz in mg b gy ng mm l mn mo">server<br/>  .listen(4000, () =&gt; {<br/>    console.log(`🚀 Server ready at port 4000`);<br/>  })<br/>  .catch(err =&gt; console.log(err, "err running server"));</span></pre><p id="6d46" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们初始化我们的服务器，传入我们的类型和解析器，最后在<code class="fe mp mq mr mg b">localhost:4000</code>启动我们的服务器</p><p id="20ce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们对此进行测试之前，我们需要运行一个脚本来用<code class="fe mp mq mr mg b">nodemon</code>启动它。转到<code class="fe mp mq mr mg b">package.json</code>，在你的脚本中，创建一个这样的</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="230f" class="mk kz in mg b gy ml mm l mn mo">"dev": "nodemon server.js"</span></pre><p id="763a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要启动它，请运行</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="c1be" class="mk kz in mg b gy ml mm l mn mo">npm run dev</span></pre><p id="e29a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果一切顺利，您应该看到您的 Graphql 服务器像这样运行。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/816ea0022b14149059b7232203bca395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WxdC_zz97g25_Ke2"/></div></div></figure><p id="a0c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总的来说，你的<code class="fe mp mq mr mg b">package.json</code>和<code class="fe mp mq mr mg b">server.js</code>最后应该是这个样子。</p><p id="b24f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">package.json</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a677" class="mk kz in mg b gy ml mm l mn mo">{<br/>  "name": "chatroom",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "server.js",<br/>  "scripts": {<br/>    "dev": "nodemon server.js"<br/>  },<br/>  "keywords": [],<br/>  "author": "",<br/>  "license": "ISC",<br/>  "dependencies": {<br/>    "apollo-server": "^2.16.1",<br/>    "bcrypt": "^5.0.0",<br/>    "graphql": "^15.3.0",<br/>    "pg": "^8.3.3",<br/>    "pg-hstore": "^2.3.3",<br/>    "sequelize": "^6.3.4",<br/>  },<br/>  "devDependencies": {<br/>    "nodemon": "^2.0.4",<br/>    "sequelize-cli": "^6.2.0"<br/>  }<br/>}</span></pre><p id="80db" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">server.js</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7b52" class="mk kz in mg b gy ml mm l mn mo">const { ApolloServer } = require("apollo-server");<br/>const typeDefs = require("./graphql/typeDefs");<br/>const resolvers = require("./graphql/resolvers");</span><span id="dc74" class="mk kz in mg b gy ng mm l mn mo">const server = new ApolloServer({<br/>  typeDefs,<br/>  resolvers<br/>});</span><span id="ca0c" class="mk kz in mg b gy ng mm l mn mo">server.listen(4000, () =&gt; {<br/>  console.log(`🚀 Server ready at port 4000`);<br/>});</span></pre><p id="7f3c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是这一个人的全部。接下来，我们将开始让我们的数据库连接到我们的项目。直到那时😄</p><p id="e7ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">附注:如果你无法启动 Graphql 服务器，请随时告诉我，我很乐意帮忙😄 👍</p></div></div>    
</body>
</html>