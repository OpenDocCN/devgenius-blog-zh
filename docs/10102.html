<html>
<head>
<title>Laravel-Excel — P7: Chunk Reading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel-Excel — P7:组块读取</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-excel-p7-chunk-reading-631de427f2d?source=collection_archive---------9-----------------------#2022-10-07">https://blog.devgenius.io/laravel-excel-p7-chunk-reading-631de427f2d?source=collection_archive---------9-----------------------#2022-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e2c4d144d358748aa24d3e9231342372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XS7b98_yhBky3PGDFfXexg.jpeg"/></div></div></figure><p id="7e59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上一篇文章中，我们讨论了批量插入，一次插入 100 行。块读取处理将一定量的数据拉入内存。如果不读取数据块，我们会将整张表拉入内存。如果 excel 表中有大量数据，这可能会很大。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-excel-p6-batch-imports-261c80e46448"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">laravel-Excel-P6:批量导入</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">到目前为止，当我们将 excel 表导入数据库时，我们所做的是为每一行创建一个导入:一个实际的…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="491b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">如何使用组块阅读？</h1><p id="974c" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我希望你能看到一种趋势的出现:使用 Laravel-Excel，大多数事情都非常简单。我们所要做的就是实现<code class="fe mr ms mt mu b">WithChunkReading</code>关注点并使用<code class="fe mr ms mt mu b">chunkSize</code>方法。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="b26b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">向块读取添加批量插入</h1><p id="19ae" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">这是组块阅读真正开始发光的地方。您可以从文件中读取有限数量的数据，然后将其作为块插入。对于这个例子，我们将一次读取 20 行并批量插入 20 行。我们的文件有 100 行。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="fdef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们在<code class="fe mr ms mt mu b">UserController</code>类中创建我们的方法并添加我们的路线。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="de5c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">你在哪里？</h1><p id="13eb" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">如果你需要知道你在哪一行，你可以<code class="fe mr ms mt mu b">use</code>这个<code class="fe mr ms mt mu b">RemembersRowNumber</code>特征，然后调用<code class="fe mr ms mt mu b">$this-&gt;getRowNumber()</code>来获得当前的行号。这适用于整篇或整段阅读的纸张。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="cfe7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行这段代码，并删除所有<code class="fe mr ms mt mu b">UserController</code>方法中对<code class="fe mr ms mt mu b">/</code>的重定向，会产生以下结果:</p><pre class="mv mw mx my gt nb mu nc nd aw ne bi"><span id="3099" class="nf lp iq mu b gy ng nh l ni nj">string(6) "Row: 2" <br/>string(6) "Row: 3" <br/>string(6) "Row: 4" <br/>string(6) "Row: 5"<br/>...<br/>string(6) "Row: 101"</span></pre><p id="8a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还可以看到带有<code class="fe mr ms mt mu b">RemembersChunkOffset</code>特征的块偏移量是多少。一旦使用，就调用<code class="fe mr ms mt mu b">$this-&gt;getChunkOffset()</code>方法。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="bb50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个<code class="fe mr ms mt mu b">var_dump</code>的结果如下所示。</p><pre class="mv mw mx my gt nb mu nc nd aw ne bi"><span id="c207" class="nf lp iq mu b gy ng nh l ni nj">string(18) "Row: 2 -- Chunk: 2" <br/>string(18) "Row: 3 -- Chunk: 2" <br/>string(18) "Row: 4 -- Chunk: 2" <br/>string(18) "Row: 5 -- Chunk: 2" <br/>string(18) "Row: 6 -- Chunk: 2"<br/>...<br/>string(20) "Row: 99 -- Chunk: 82" <br/>string(21) "Row: 100 -- Chunk: 82" <br/>string(21) "Row: 101 -- Chunk: 82"</span></pre><p id="c658" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们离让导入变得非常棒只有一步之遥，那就是排队导入。有了块读取，排队导入将会很棒。我们接下来会解决这些问题。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4df5c00d0bca6594f9bf1b397e2a6ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hHQ-rYSXv_MqmEtZ.jpeg"/></div></figure><p id="edc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae ns" href="https://www.absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 负责人，该公司是<a class="ae ns" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae ns" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute 抗体</a>、<a class="ae ns" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae ns" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae ns" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae ns" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="c425" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae ns" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae ns" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae ns" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="976d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T25】</p></div></div>    
</body>
</html>