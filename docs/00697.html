<html>
<head>
<title>How to scrape a website with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Go刮网站</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-scrape-a-website-go-a3e9d8390c6d?source=collection_archive---------29-----------------------#2020-06-14">https://blog.devgenius.io/how-to-scrape-a-website-go-a3e9d8390c6d?source=collection_archive---------29-----------------------#2020-06-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/051ee0c89667e64cd9e20234dbc7ba73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oEP1ibkOeKXgeyMy"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Pathum Danthanarayana 在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="467f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">抓取网站对于许多应用程序都很有用，无论您是构建一个个人项目来从网站中提取一些细节，还是构建一个网络爬虫。但是，在做任何网络抓取之前，要合乎道德。确保你没有造成<a class="ae jz" href="https://en.wikipedia.org/wiki/Denial-of-service_attack" rel="noopener ugc nofollow" target="_blank">拒绝服务</a>，并了解目标网站的条款和条件，以免自己陷入麻烦。不要害怕，因为这是相当无害的，但是如果您正在构建一个生产应用程序或试图将其用于您的业务，请确保您了解它的所有方面。现在，让我们进入技术细节。</p><h1 id="9ca7" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">发出Http请求</h1><p id="3555" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">像任何编程语言一样，Go也有http库，提供连接和检索内容的实用方法。看看http包-<a class="ae jz" href="https://golang.org/pkg/net/http/" rel="noopener ugc nofollow" target="_blank">https://golang.org/pkg/net/http/</a>。</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="d76b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">http“get”方法向给定的url发出“GET”请求。默认情况下，超时值为0。这意味着，它是不确定的，它永远不会超时，这可能会使您的应用程序挂起。一般来说，在创建客户端时更新超时是一种好的做法。</p><p id="1dea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">设置超时</strong></p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="2cdd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建新的客户端允许您更新默认配置，并使用创建的客户端来获取网页。这将确保您的应用程序不会无限期等待，如果目标网站需要永远连接。当这种情况发生时，它会在“err”中给出一个超时错误，您可以相应地处理它。</p><pre class="mb mc md me gt mh mi mj mk aw ml bi"><span id="32c5" class="mm kz in mi b gy mn mo l mp mq">Received error while craping:  Get "<a class="ae jz" href="https://www.crawler-test.com/" rel="noopener ugc nofollow" target="_blank">https://www.crawler-test.com/</a>": context deadline exceeded (Client.Timeout exceeded while awaiting headers)</span></pre><p id="95ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">超时设置看起来很直观，但是有一些隐藏的细节。http调用包含-</p><pre class="mb mc md me gt mh mi mj mk aw ml bi"><span id="121b" class="mm kz in mi b gy mn mo l mp mq">Dial -&gt; TLS Handshake -&gt; Request -&gt; Response.Headers -&gt; Response.Body -&gt; Idle</span></pre><p id="a0b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“http客户端”的“超时”字段涵盖了所有这些方面，但是如果需要，您可以单独处理超时的每个部分。请务必在此处查看cloudflare关于超时<a class="ae jz" href="https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/" rel="noopener ugc nofollow" target="_blank">的指南。</a></p><p id="e973" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">设置标题</strong></p><p id="c780" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">连接到网站时，设置请求头通常会很有用。一个例子是在标题中设置“用户代理”字段。设置这些标题是一个很好的做法，这样网站所有者就可以看到客户端请求的细节。对上面的代码进行一些修改，以允许设置这样的头值。</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e20a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这段代码让你连接到一个网页，并检索网页的内容。下面这个简单的代码可以让你打印网站内容，作为一个起点。但是，在检索到响应正文之后，您可以做很多事情，比如解析所有链接(web crawler的主要用例)或统计页面中的单词数(用于创建搜索索引)等。</p><pre class="mb mc md me gt mh mi mj mk aw ml bi"><span id="2ec4" class="mm kz in mi b gy mn mo l mp mq">_, err = io.Copy(os.Stdout, response.Body)</span></pre></div></div>    
</body>
</html>