<html>
<head>
<title>Extract stock prices with Python (Multiple stocks)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 提取股票价格(多只股票)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/extract-stock-prices-with-python-multiple-stocks-fe2209261cfd?source=collection_archive---------8-----------------------#2022-12-18">https://blog.devgenius.io/extract-stock-prices-with-python-multiple-stocks-fe2209261cfd?source=collection_archive---------8-----------------------#2022-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="269d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Python 股票价格分析 02:用股票代码列表提取股票价格</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44e762b09de21eb67b1629ab2aa895cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W8oFvRvRuPqPgeU87InWQw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">模板由 Canva 提供，照片由<a class="ae ky" href="https://unsplash.com/@chrisliverani?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae ky" href="https://unsplash.com/s/photos/stock-trading?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="8d75" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">目录</h1><blockquote class="lx ly lz"><p id="fc71" class="jk jl ma jm b jn jo jp jq jr js jt ju mb jw jx jy mc ka kb kc md ke kf kg kh ig bi translated"><a class="ae ky" href="#da2d" rel="noopener ugc nofollow">简介</a> <br/> <a class="ae ky" href="#f64b" rel="noopener ugc nofollow">修改—如何提取股票价格</a> <br/> <a class="ae ky" href="#db75" rel="noopener ugc nofollow">多只股票</a> <br/> <a class="ae ky" href="#ae9e" rel="noopener ugc nofollow">输出</a> <br/> <a class="ae ky" href="#3871" rel="noopener ugc nofollow">结论</a> <br/> <a class="ae ky" href="#a5b8" rel="noopener ugc nofollow">视频教程</a> <br/> <a class="ae ky" href="#5da7" rel="noopener ugc nofollow">关于我</a></p></blockquote></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="da2d" class="kz la in bd lb lc ml le lf lg mm li lj lk mn lm ln lo mo lq lr ls mp lu lv lw bi translated">介绍</h1><p id="9cfb" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">我之前的<a class="ae ky" href="https://medium.com/dev-genius/extract-stock-price-data-with-python-fa53300120e0" rel="noopener">文章</a>讲了用 Python 代码提取股价数据的基本思路。但是，我只谈到了提取 1 只股票的股价。</p><p id="4be8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我想分析所有 FAANG 股票之间的关系怎么办？如果我想提取 SP500 所有股票的价格，该怎么办？</p><p id="d175" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在今天的文章中，我们来谈谈批量提取股票价格。</p><h1 id="f64b" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">修订版—如何提取股票价格</h1><p id="7a9b" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">回想一下，这是提取我们指定的股票价格的代码。在这种情况下，我选择了 MSFT。</p><pre class="kj kk kl km gt mv mw mx bn my mz bi"><span id="2aa2" class="na la in mw b be nb nc l nd ne">import requests<br/><br/>url = "https://alpha-vantage.p.rapidapi.com/query"<br/><br/>querystring = {"function":"TIME_SERIES_DAILY_ADJUSTED","symbol":"MSFT","outputsize":"full","datatype":"json"}<br/><br/>headers = {<br/> "X-RapidAPI-Key": 'your-api-key',<br/> "X-RapidAPI-Host": "alpha-vantage.p.rapidapi.com"<br/>}<br/><br/>response = requests.request("GET", url, headers=headers, params=querystring)<br/><br/>print(response.text)</span></pre><p id="57fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你是第一次运行这个，请参考我的前一篇文章来设置 API 并了解更多关于提取股票价格的信息。</p></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="db75" class="kz la in bd lb lc ml le lf lg mm li lj lk mn lm ln lo mo lq lr ls mp lu lv lw bi translated">多只股票</h1><p id="52aa" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">我们不能只是将一个股票代码列表传递到查询字符串中。将这个列表['MSFT '，' AAPL']传递给 symbol 参数将只返回 AAPL(最后一个报价机)价格数据。</p><pre class="kj kk kl km gt mv mw mx bn my mz bi"><span id="3b66" class="na la in mw b be nb nc l nd ne">querystring = {"function":"TIME_SERIES_DAILY_ADJUSTED","symbol":["MSFT","AAPL"],"outputsize":"full","datatype":"json"}</span></pre></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><p id="38e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要编写一个股票代码列表，并遍历该列表来请求每个代码的股票价格数据。比方说，我们想要检索 FAANG-MT 股票的价格。我们将创建一个列表来存储这些股票的股票代码。</p><pre class="kj kk kl km gt mv mw mx bn my mz bi"><span id="391b" class="na la in mw b be nb nc l nd ne">stocks = ['META','AAPL','AMZN','NFLX','GOOG','MSFT','TSLA']</span></pre><p id="77ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们将遍历这些股票代码，并将这些数据保存到一个 JSON 文件中。在我们开始编写代码之前，记得在 python 代码所在的目录中创建一个 JSON 文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/d38cdfcd280124cc879cf6e729d42fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*8CrsNSEiEkAhft5nWhrRFA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://medium.com/@foocheechuan" rel="noopener">作者</a></figcaption></figure><p id="6aeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们可以编写一个循环，用 API 请求数据，并写入一个 JSON 文件。</p><pre class="kj kk kl km gt mv mw mx bn my mz bi"><span id="ef16" class="na la in mw b be nb nc l nd ne">import requests<br/>import json<br/>import os<br/><br/>json_path = f"{os.getcwd()}\\JSON"<br/>url = "https://alpha-vantage.p.rapidapi.com/query"<br/>headers = {<br/>    "X-RapidAPI-Key": "your-api-key",<br/>    "X-RapidAPI-Host": "alpha-vantage.p.rapidapi.com"<br/>}<br/><br/>for symbol in stocks:<br/>    # Change ticker symbol in the query string in each loop<br/>    querystring = {"function":"TIME_SERIES_DAILY_ADJUSTED","symbol":symbol,"outputsize":"full","datatype":"json"}<br/>    print(f"Symbol = {symbol}")<br/>    <br/>    # Get a new request in every loop<br/>    response = requests.request("GET", url, headers=headers, params=querystring)<br/>    print(f"Done request {symbol} data")<br/>    <br/>    # Write the response into a JSON file in the JSON folder<br/>    with open(f"{json_path}/{symbol} stock prices.json", "w") as outfile:<br/>        json.dump(response.json(), outfile)<br/>    <br/>    # Output message to indicate a successful loop<br/>    print(f"Wrote {symbol} to JSON file")<br/>    print("")<br/>    print('-'*30)<br/>    print("")<br/>    <br/>else:<br/>    # Output message to indicate the loop is complete<br/>    print(f"Wrote all symbols to JSON file")</span></pre><h1 id="ae9e" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">输出</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/e821223159ff9002b6822a786b587cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unmOhd5Ke_RGBOX6eqmVxQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者<a class="ae ky" href="https://medium.com/@foocheechuan" rel="noopener">作者</a></figcaption></figure><p id="dceb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，您可以使用我们在上一篇文章中讨论的方法将其转换为 pandas 数据框。</p><h1 id="3871" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="2c67" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">今天的文章到此为止。在我的下一篇文章中，我将讨论如何将这些 JSON 文件存储到一个 CSV 文件中，以及这样做所需的准备工作。</p><p id="1b37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢您阅读今天的文章。下一篇文章再见。</p></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="a5b8" class="kz la in bd lb lc ml le lf lg mm li lj lk mn lm ln lo mo lq lr ls mp lu lv lw bi translated">视频教程</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="5da7" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">关于我</h1><p id="61a4" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">目前担任数据科学家。我为世界各地的客户提供数据分析问题的咨询、培训和专业服务。我很乐意分享我作为顾问的经验，这样每个人都可以从中学到一些东西。</p><p id="f26a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">领英:<a class="ae ky" href="https://www.linkedin.com/in/foocheechuan/?source=about_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/foocheechuan/</a></p><p id="7487" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">中:【medium.com/@foocheechuan】T2</p><p id="8b95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Youtube: <a class="ae ky" href="https://www.youtube.com/channel/UC73tyElpkCE_6cbZxMLKnkw" rel="noopener ugc nofollow" target="_blank">车志川</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/4b4515e18f9221c8673bd0ab7aeb8c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8fub_El0Is8B1fBhwdwdTA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">安妮·斯普拉特在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div></div>    
</body>
</html>