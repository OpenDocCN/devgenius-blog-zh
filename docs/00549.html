<html>
<head>
<title>What is Circuit Breaker? Why do we need it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是断路器？我们为什么需要它？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/what-is-circuit-breaker-why-do-we-need-it-f0ce20e386e0?source=collection_archive---------13-----------------------#2020-06-10">https://blog.devgenius.io/what-is-circuit-breaker-why-do-we-need-it-f0ce20e386e0?source=collection_archive---------13-----------------------#2020-06-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><p id="169a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">断路器</strong>是现代<strong class="jt io">软件</strong>开发中使用的一种设计模式。它用于检测故障，并封装了防止故障在维护期间、临时外部系统故障或意外系统困难中不断重复出现的逻辑。</p><p id="0f12" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">断路器模式的目的是处理长期的瞬时故障。这种模式背后的想法是，我们将把服务调用包装在断路器中。</p><ul class=""><li id="4d35" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">如果重试失败的次数达到某个阈值以上，我们将使该电路断开，这意味着该服务此时不可用。</li><li id="8ad4" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">一旦电路达到打开状态，对服务的进一步调用将立即向调用者返回失败，而不是执行我们的重试逻辑。</li><li id="1f50" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">该断路器将有一段超时时间，在此之后，它将进入半开状态。在这种状态下，它将允许服务调用，该调用将确定服务是否可用。</li><li id="d0bf" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">如果服务不可用，它将返回到开放状态。</li><li id="7a67" class="kp kq in jt b ju ky jy kz kc la kg lb kk lc ko ku kv kw kx bi translated">如果该服务在超时后变得可用，断路器将变为闭合状态。</li></ul><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/146674ea5c5f67f9d980ad0b849402c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*jxoPWIFEYWWJN2ItGe1RMg.png"/></div></figure><p id="60ec" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在开发应用程序时，使用断路器模式可能有多种原因。在这里，我列出了一些原因及其解决方案。</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><p id="64f1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="ll">瞬时故障<br/> </em> </strong>瞬时故障是在与外部组件或服务通信时发生的故障，外部服务不可用。这种不可用或连接失败不是由于服务中的任何问题，而是由于一些原因，如网络故障或服务器过载。这些问题都是短暂的。如果我们再次调用该服务，我们的调用很可能会成功。这种故障被称为瞬时故障。</p><blockquote class="lm ln lo"><p id="10a2" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated"><strong class="jt io">重试模式<br/>实现重试的典型方式如下:</strong></p><p id="f676" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">1.确定故障是否为瞬时故障。<br/> 2。定义最大重试次数。<br/> 3。重试服务呼叫，并增加重试计数。<br/> 4。如果调用成功，将结果返回给调用者。<br/> 5。如果我们仍然得到相同的故障，继续重试，直到达到最大重试次数。<br/> 6。如果在最大重试次数后调用仍失败，让调用者模块知道目标服务不可用。</p></blockquote><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/ed0f51cd5d3689a4fa44c6b67ee4bf9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfMcFwSuKiCJm2LEZUNWdA.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">重试模式</figcaption></figure><blockquote class="mb"><p id="fca9" class="mc md in bd me mf mg mh mi mj mk ko dk translated">但是后退！！！！！</p></blockquote><blockquote class="lm ln lo"><p id="4a9b" class="jr js ll jt b ju ml jw jx jy mm ka kb lp mn ke kf lq mo ki kj lr mp km kn ko ig bi translated">让我们设想一个场景，其中由于服务过载或在服务端实现了一些节流而发生了瞬时故障。我们的重试请求可能会进一步增加繁忙服务的过载，这意味着如果我们的应用程序有多个实例重试相同的服务，服务将处于过载状态更长时间，并且需要更长时间才能从这种状态中恢复。</p><p id="15e2" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">在重试中使用<strong class="jt io">指数补偿</strong>的想法是，在每次重试失败后，我们增加重试之间的等待时间，而不是在等待固定时间后重试。因此，对于指数补偿，我们的重试算法将如下所示:</p><p id="eda3" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">1.确定故障是否为瞬时故障。</p><p id="e778" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">2.定义最大重试次数。</p><p id="e19b" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">3.重试服务呼叫，并增加重试计数。</p><p id="5393" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">4.如果调用成功，将结果返回给调用者。</p><p id="cedf" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">5.如果我们仍然得到相同的故障，增加下一次重试的延迟时间。</p><p id="1ada" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">6.不断重试并不断增加延迟时间，直到达到最大重试次数。</p><p id="dfa4" class="jr js ll jt b ju jv jw jx jy jz ka kb lp kd ke kf lq kh ki kj lr kl km kn ko ig bi translated">7.如果在最大重试次数后调用仍失败，让调用者模块知道目标服务不可用。</p></blockquote><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e87b59f92d551a0f77097c12836b72cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*kYDgUIW9BY-AL_0LpavKzA.png"/></div></figure><blockquote class="mb"><p id="6f16" class="mc md in bd me mf mg mh mi mj mk ko dk translated"><strong class="ak"> <em class="mr">指数退避</em> </strong>影响重试算法，使其更有弹性。</p></blockquote><figure class="mt mu mv mw mx li gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ms"><img src="../Images/ef7d54b8e83bc81bea3e7fb2f78bffc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kiVgJjkb9Mzxz0FWhfBng.png"/></div></div></figure></div></div>    
</body>
</html>