<html>
<head>
<title>Calling Python and C++ Code using PyBind</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyBind 调用 Python 和 C++代码</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/calling-python-and-c-code-using-pybind-99ab7fefa685?source=collection_archive---------0-----------------------#2021-09-17">https://blog.devgenius.io/calling-python-and-c-code-using-pybind-99ab7fefa685?source=collection_archive---------0-----------------------#2021-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2225" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 PyBind11 在 Python 和 C++之间进行调用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/917e9a2c5696d5ab7a2c78626255d91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4TLlisFk7XvtREAsS7C7Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@cgower?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯托弗·高尔</a>在<a class="ae kv" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f475" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的软件的一个组件是用 C++写的，而另一个组件是用 Python 写的，这种情况有多常见？也许用 Python 编写的函数需要被 C++代码调用，反之亦然？随着软件复杂性的增加，某些特性或组件更适合用不同的语言编写，这可能是一种常见的模式。幸运的是，PyBind11 提供了一种从 C++调用 Python 代码和从 Python 调用 C++代码的简单方法！</p><p id="7380" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PyBind11 是一个只有头文件的库，允许 C++类型在 Python 中公开，反之亦然。本文概述了如何从 C++调用 python 和从 python 调用 C++。</p><h1 id="7264" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.安装 PyBind</h1><p id="b325" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在 MacOS 上，PyBind 可以使用自制软件安装</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="4b5e" class="mu lt iq mq b gy mv mw l mx my">&gt; brew install pybind11</span></pre><p id="91c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在其他平台上，可以使用 pip 安装 PyBind</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="af6d" class="mu lt iq mq b gy mv mw l mx my">&gt; pip install pybind11</span></pre><h1 id="e066" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.从 C++调用 Python</h1><p id="4f35" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">假设我们想从 C++代码中调用 python。这可以通过将 pybind11 库包含到 C++源文件中来实现。</p><p id="b2f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个示例<code class="fe mz na nb mq b">CMakeLists.txt</code>文件，如果使用<a class="ae kv" href="https://cmake.org/" rel="noopener ugc nofollow" target="_blank"> cmake </a>构建 C++应用程序，可以使用该文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CMakeLists.txt</figcaption></figure><p id="c666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在创建将调用 python 代码的 cpp 源文件。在将 pybind11 名称空间声明为<code class="fe mz na nb mq b">py</code>之后，可以使用<code class="fe mz na nb mq b">py::module::import</code>调用导入数学模块。python 调用返回的输出是一个<code class="fe mz na nb mq b">py::object</code>对象，然后可以将其转换为所需的输出类型，在本例中是一个浮点型。本例中调用的 python 代码是:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="bd27" class="mu lt iq mq b gy mv mw l mx my">import math<br/>math.sqrt(25)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">演示. cpp</figcaption></figure><p id="8980" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过运行<code class="fe mz na nb mq b">make</code>编译 C++代码。运行<code class="fe mz na nb mq b">demo</code>可执行文件将产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/7722bc7e52852d7b8257199882713228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7tw3tg32SwTLqLzUuUpJYQ.png"/></div></div></figure><h1 id="69ea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.从 Python 调用 C++</h1><p id="3d5a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">考虑这样一个场景，需要从 python 调用一个 C++函数。第一步是写出 C++函数，并使用<code class="fe mz na nb mq b">PYBIND11_MODULE</code>宏将该函数包装在 python 绑定中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">示例. cpp</figcaption></figure><p id="635f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个示例<code class="fe mz na nb mq b">CMakeLists.txt</code>文件。该文件将创建在导入绑定时使用的<code class="fe mz na nb mq b">example.so</code>目标。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CMakeLists.txt</figcaption></figure><p id="aeae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过运行<code class="fe mz na nb mq b">make</code>编译 C++代码。</p><p id="02dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">python 现在可以使用<code class="fe mz na nb mq b">example</code>模块和<code class="fe mz na nb mq b">multiply</code>函数了。确保<code class="fe mz na nb mq b">example.so</code>文件与 python 文件在同一个目录中，或者在 python <code class="fe mz na nb mq b">PATH</code>中。</p><p id="2f10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个将导入<code class="fe mz na nb mq b">example</code>模块的<code class="fe mz na nb mq b">test.py</code> python 文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">测试. py</figcaption></figure><p id="5c27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行 test.py:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/32b7c330fb955a292d273e16a5b3a006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1eJUADJBA5rTU3qjRm8aCA.png"/></div></div></figure><h1 id="40fa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="d128" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Pybind11 是一个强大的库，用于创建 python 绑定，从 python 调用 C++代码，从 C++调用 python。希望这份循序渐进的指南能让 PyBind 的入门变得更容易！</p></div></div>    
</body>
</html>