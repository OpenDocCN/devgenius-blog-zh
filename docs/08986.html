<html>
<head>
<title>Create Docker NGINX Image and Push to AWS ECR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建 Docker NGINX 映像并推送到 AWS ECR</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-docker-nginx-image-and-push-to-aws-ecr-a09522932d3d?source=collection_archive---------1-----------------------#2022-07-23">https://blog.devgenius.io/create-docker-nginx-image-and-push-to-aws-ecr-a09522932d3d?source=collection_archive---------1-----------------------#2022-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e6d7e216e881e5e3df1c658f74b6914d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clh9oAvwxKiagjhIj-plCg.jpeg"/></div></div></figure><p id="5865" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">我们的场景:</strong></p><p id="a1d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">您的团队需要您快速部署自定义映像，并在文件中编写快速脚本来完成任务。你将会做一个你以前可能没有做过的任务，所以如果你不知道怎么做的话，一定要研究一下。</em></p><p id="410d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt"> 1。使用 Nginx 创建您自己的映像，并添加一个文件来告诉您容器部署的日期</em></p><p id="c97e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt"> 2。在端口 8080 打开的情况下部署您的容器</em></p><p id="9012" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt"> 3。将您的容器数据保存到 AWS 弹性容器注册表(ECR) </em></p><p id="ff48" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kt">我们开始吧！</em> </strong></p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="347f" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">1|创建目录</h2><p id="d6da" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">在您选择的 IDE 中，您需要创建一个目录来保存您的 HTML &amp; Dockerfile。为此，我们将使用以下命令来制作目录，然后将 cd 放入所述目录:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1425" class="lb lc in me b gy mi mj l mk ml">mkdir &lt;DIRECTORY NAME&gt;<br/>cd &lt;DIRECTORY NAME&gt;</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="b149" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">2|从注册表中提取图像</h2><p id="4e96" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">在我们的场景中，我们被要求使用 Nginx 来部署我们的网站，所以我们将从 Docker 注册中心获取 Nginx 的最新版本。</p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/cf8014635ab54f12889269f616756dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6pbPi3tm5s-xN05pKIHNTQ.png"/></div></div></figure><p id="7b4c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您从上图中看到的，拉取是成功的——但是，让我们验证我们拉取了最新的图像。</p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/e4c074378b71f33d568a1eb224c6b1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XPVWr3AuXsMB6zJyA2T8Q.png"/></div></div></figure><p id="3357" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">成功！现在我们可以进入下一步了！</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="2b3c" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">3|创建 docker file &amp; index.html</h2><p id="585f" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">使用终端，确保更改目录<code class="fe mo mp mq me b">$ cd</code>并使用命令<code class="fe mo mp mq me b">$ touch Dockerfile</code>创建新文件。一旦创建完成，打开文件并开始工作！</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0d79" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将在同一个目录中创建我们的 index.html 文件。</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/086c17cce18825b0b4f0fe8597193014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xod4baW9-qyWjgD2glrvA.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="a7c6" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">4|从 Dockerfile 构建映像</h2><p id="d74b" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">为了开始构建 docker 容器，我们将运行以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="bd85" class="lb lc in me b gy mi mj l mk ml">docker build -t &lt;nameofcontainer&gt; .</span><span id="0b26" class="lb lc in me b gy mu mj l mk ml">docker build -t nginx16 .</span></pre><p id="14ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">注:“容器名后面的句点非常重要。这将确保我们在当前工作目录中查找文件。</em></p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/4df2e751486296959676cbf44b3bb601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l37EAnSEVxJXMMuS-HMdsQ.png"/></div></div></figure><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/ba5aa35fa77b61d53e8af844dd5378ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMnUxXo5JFaGzqqtaIpzBA.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="7e28" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">5|创建 Docker 容器</h2><p id="bf6a" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">使用以下命令根据您的新映像创建容器:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b301" class="lb lc in me b gy mi mj l mk ml">docker run -d --name &lt;container-name&gt; -p 8080:80 nginx16</span><span id="27c9" class="lb lc in me b gy mu mj l mk ml">docker run -d --name kinsey-container -p 8080:80 nginx16</span></pre><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/c209360ab4aacf73d4975f068af46172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6aHus55bl9J3JtAnhguLQ.png"/></div></div></figure><p id="1c04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过使用命令<code class="fe mo mp mq me b">$ docker ps</code>，你可以看到我们的新容器已经完成了！现在，我们将确认我们的容器可以访问互联网(v 重要！！)通过使用以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8912" class="lb lc in me b gy mi mj l mk ml">curl localhost:8080</span></pre><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/8fae9a1e0f098aaa00bc643db6a33bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ajlz6i52JOQj41tmWxkjAg.png"/></div></div></figure><p id="3009" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要查看您的网站，在浏览器中键入<code class="fe mo mp mq me b"><a class="ae mz" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>，您将看到一切正常:</p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/99c33fd7d5f2443f49af18d4850fa32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZ3VxUxJ1GgnVWG5NIlKFA.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="bb56" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">6|将集装箱数据保存并推送到 AWS ECR</h2><p id="ef69" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">要将数据推送到 AWS ECR，我们必须首先创建一个存储库。使用以下命令初始化新的存储库:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="aaa1" class="lb lc in me b gy mi mj l mk ml">aws ecr create-repository --repository-name &lt;Project name&gt; --region &lt;region&gt;</span><span id="2e4f" class="lb lc in me b gy mu mj l mk ml">aws ecr create-repository --repository-name docker-<!-- -->nginx16<!-- --> --region us-east-1</span></pre><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/74f7f0170d85ae4fa4c67e26b6f1d1e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHU4gVd5Y_2hzTAyyPlHuA.png"/></div></div></figure><p id="da65" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以通过查看 AWS 存储库控制台来确认存储库的创建:</p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/cbd7d835ea75c760ee651d06164a75b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dcWhtUGwkInq9ofQiLo9Q.png"/></div></div></figure><p id="7cbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将登录 Docker CLI，但我们需要先获取一个令牌。为此，运行以下命令并复制非常长的输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="52ae" class="lb lc in me b gy mi mj l mk ml">aws ecr get-login-password --region us-east-1</span></pre><p id="a528" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要完成登录，请输入以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a02c" class="lb lc in me b gy mi mj l mk ml">aws ecr --region us-east-1| docker login -u AWS -p &lt;Token Output&gt; &lt;ECR Repository URI&gt;</span></pre><p id="47cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">登录成功！现在，我们将需要标记我们的图像，以便它可以被推送到我们的 ECR 存储库。我们将使用以下命令来完成这项工作:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8b24" class="lb lc in me b gy mi mj l mk ml">docker tag &lt;Image Name&gt; &lt;ECR Repository URI&gt;</span><span id="1865" class="lb lc in me b gy mu mj l mk ml">docker tag nginx16 &lt;ECR Repository URI&gt;</span></pre><p id="19dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用以下命令推送 Docker 映像:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d3d6" class="lb lc in me b gy mi mj l mk ml">docker push &lt;ECR Repository URI&gt;</span></pre><p id="7b58" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kt">哒哒！成功了！</em>T3】</strong></p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/27dadcef3ed77d3c6c382e7a204c5950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAuZC1o6iOuy2NquvZa-WQ.png"/></div></div></figure><p id="da6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">看。在。你！</em>恭喜您，您刚刚创建了一个 Docker NGINX 映像并推送到 ECR。不要忘记使用以下命令删除终端中的容器和图像:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="46e7" class="lb lc in me b gy mi mj l mk ml">Remove ALL containers: docker   rm -f $(docker ps -a -q)</span><span id="b07c" class="lb lc in me b gy mu mj l mk ml">Remove ALL images: docker   rm -f $(docker images -q)</span></pre></div></div>    
</body>
</html>