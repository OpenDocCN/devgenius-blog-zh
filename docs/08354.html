<html>
<head>
<title>Add cryptocurrency payments to your website with metamask and javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 metamask 和 javascript 将加密货币支付添加到您的网站</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-cryptocurrency-payments-to-your-website-with-metamask-and-javascript-5e11326431c6?source=collection_archive---------0-----------------------#2022-06-08">https://blog.devgenius.io/add-cryptocurrency-payments-to-your-website-with-metamask-and-javascript-5e11326431c6?source=collection_archive---------0-----------------------#2022-06-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9eb8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如何让顾客使用 Metamask 钱包进行支付的分步指南。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/931ae52838b3f31f21049bc22fbe960a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EozaQ8LZwgaN2BMFaGxANg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@toanchu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">托安楚</a>在<a class="ae ky" href="https://unsplash.com/s/photos/washington?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的背景照片</figcaption></figure><p id="4fc8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设您有一家在线商店，并希望允许您的客户使用加密货币进行购物。在本文中，我们将介绍用 Javascript 和元掩码实现一个简单的加密货币支付流程的步骤。</p><p id="7250" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">整个流程将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/f592ac0b2d7ae9ecc407c9fba52b4b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vWeye6X0ldvtXs5k4E98Ig.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">元掩码付款流程</figcaption></figure><p id="774b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，您将在 Etherscan 中看到如下所示的交易页面:</p><p id="3ff4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ky" href="https://etherscan.io/tx/0x6d63a635c853d251900b9b76c970a028fd71f24bb8d0c2a82262126023085f5e" rel="noopener ugc nofollow" target="_blank">https://ethers can . io/tx/0x6d 63 a 635 c 853d 251900 b 9 b 76 c 970 a 028 FD 71 f 24 bb 8 d0c 2 a 82262126023085 f5e</a></p><h2 id="7c7f" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">支付流程</h2><p id="55a9" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">执行支付的流程如下所示:</p><ol class=""><li id="26b8" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated">应用程序加载并自动检查 Metamask 钱包是否已连接。如果没有，显示连接按钮。</li><li id="5fc6" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">如果用户没有连接，他按下连接按钮，并签署消息连接到应用程序。</li><li id="8905" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">用户查看并确认付款。</li><li id="cc23" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">创建元掩码事务请求，并显示一个弹出窗口供用户确认事务。</li><li id="24dc" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">用户确认交易，生成 Eherscan url，用户和应用程序都会收到支付确认。</li></ol><h2 id="99f1" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">检查用户是否登录</h2><p id="76ca" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">首先，当页面第一次加载时，我们要检查用户是否已经将钱包连接到应用程序。为此，我们只需使用“eth_accounts”方法获取用户的帐户。如果没有帐户返回，这意味着用户没有连接。以下是执行此操作的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="1ccf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果用户登录了，我们显示结帐菜单，如果没有，我们显示连接按钮。</p><h2 id="f472" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">将用户连接到应用程序</h2><p id="cc93" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">如果用户没有连接，我们希望为我们的连接按钮分配一个功能，将钱包连接到应用程序。这可以通过使用“eth_requestAccounts”方法来实现。该方法将创建一个 Metamask 弹出窗口，供用户签署消息并确认他想要连接到应用程序。</p><p id="a070" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是该函数的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="7af7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户现在将连接到网站，并能够继续进行结帐。</p><h2 id="f59c" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">处理付款</h2><p id="079a" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">对于最后一部分，我们希望提示用户通过元掩码确认事务。这可以通过“eth_sendTransaction”方法实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h2 id="e6d2" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">完整的代码片段</h2><p id="c488" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">这个代码的完整工作版本可以在下面的链接中看到。这个代码片段使用 Vue.js 和 Tailwindcss 来实现本文开头所示的接口。</p><p id="8261" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ky" href="https://gist.github.com/duartefdias/95f3808eb05e60c2426aa9fd7423cc24" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/duartefdias/95f 3808 EB 05 e 60 c 2426 a9 FD 7423 cc 24</a></p><h2 id="fb81" class="la lb in bd lc ld le dn lf lg lh dp li jv lj lk ll jz lm ln lo kd lp lq lr ls bi translated">结论</h2><p id="9c96" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">这篇文章是一个简短实用的指南，介绍了如何使用 Metamask 快速实现一个基本的区块链支付系统。</p><p id="13a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是可能的最简单的实现，但如果您想跟踪您的客户和订单，则不推荐这样做。如果你有兴趣学习<strong class="jm io">如何创建一个更健壮的架构</strong>来处理订单跟踪和更健壮的流程，请在 Medium 上关注我，因为我将很快发布一篇关于我如何创建一个具有无服务器云功能的全栈实现的文章。</p><p id="708c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编码快乐！</p></div></div>    
</body>
</html>