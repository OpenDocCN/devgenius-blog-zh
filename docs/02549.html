<html>
<head>
<title>Node.js Best Practices — Data Validation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 最佳实践—数据验证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-best-practices-data-validation-f7d2a608e599?source=collection_archive---------1-----------------------#2020-08-11">https://blog.devgenius.io/node-js-best-practices-data-validation-f7d2a608e599?source=collection_archive---------1-----------------------#2020-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7279157aa7e895af4b715aed2a39aecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q5MnAV44sI_le74o"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@ohleighann?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Leighann Blackwood </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9f14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="f6a5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">具有已知安全漏洞的组件</h1><p id="f5a5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该用 AWS CloudTrail 记录和审计每个对云管理服务的 API 调用。</p><p id="60fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应该运行我们的云提供商提供的安全检查器。</p><h1 id="a625" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">记录和监控</h1><p id="5457" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">记录和监控应该足够了。</p><p id="5b54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该寻找任何可疑的审计事件，如用户登录、用户创建、权限更改等。</p><p id="ed00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有登录失败，我们应该得到警告。</p><p id="8467" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应该记录每个数据库记录中启动更新的时间和用户名。</p><h1 id="18d3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">跨站点脚本</h1><p id="b35d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了避免跨站点脚本，我们应该使用模板引擎和框架，它们通过设计自动转义脚本。</p><p id="0f6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应该大部分都有这个特点。</p><p id="70a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应根据 HTML 输出对不受信任的 HTTP 请求数据进行转义。</p><p id="a7f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在客户端修改浏览器文档时应用上下文相关编码可以防止在 DOM 上跨站点编写脚本。</p><p id="7e78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们应该启用内容安全策略来防御跨站点脚本。</p><h1 id="c43c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">保护个人身份信息</h1><p id="83ac" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">个人认为，可识别的信息应该受到保护。</p><p id="8f04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何可用于识别个人身份的数据都应该加密。</p><p id="7a61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不同国家制定了隐私法，所以我们应该遵守。</p><h1 id="1a55" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在生产中有一个 security.txt 文件</h1><p id="da3b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">名为<code class="fe me mf mg mh b">security.txt</code>的文本文件应该在<code class="fe me mf mg mh b">./well-known</code>目录或根目录下。</p><p id="fe02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它应该给出哪些安全研究人员可以报告漏洞的细节以及负责人的联系方式。</p><p id="3edc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过这种方式，我们可以在发现任何安全漏洞时得到通知。</p><h1 id="a0c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">有一个 SECURITY.md 文件</h1><p id="752d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在一个代码项目中，我们可以有一个<code class="fe me mf mg mh b">security.md</code>文件，里面有项目所有者的联系方式。</p><p id="cfb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，人们可以报告在项目中发现的漏洞。</p><h1 id="62d2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">调整 HTTP 响应头以增强安全性</h1><p id="615f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该调整 HTTP 响应头以增强安全性。</p><p id="25ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像跨站点脚本、点击劫持和其他恶意攻击这样的攻击利用响应标头中公开的数据来实施攻击。</p><h1 id="7be0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不断自动检查易受攻击的依赖项</h1><p id="1f0d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用<code class="fe me mf mg mh b">npm audit</code>或<code class="fe me mf mg mh b">snyk </code>来跟踪、监控和修补易受攻击的依赖项。</p><p id="fcad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些可以集成到我们的 CI 设置中，以便在生产之前发现易受攻击的依赖项。</p><h1 id="ae17" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免使用 Node.js 加密库来处理密码</h1><p id="6078" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Node 加密库不像<code class="fe me mf mg mh b">bcrypt</code>那么安全，它允许我们加盐和散列我们的密码。</p><p id="c7b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们不加盐和散列，那么它们可能会被暴力破解或用字典攻击来猜测。</p><h1 id="3853" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">转义 HTML、JS 和 CSS 输出</h1><p id="2906" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该避开 HTML、JavaScript 和 CSS，以便防止跨站脚本攻击。</p><p id="21e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用专用库，将数据标记为不应运行的纯内容。</p><h1 id="7ed3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">验证传入的 JSON 模式</h1><p id="b6b6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">传入的 JSON 应该用 JSON 模式进行验证，以确保来自请求的数据是有效的。</p><p id="0f23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们不检查它们，那么恶意的和无效的数据会进入我们的系统并引起问题。</p><p id="aee4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像<a class="ae kc" href="https://www.npmjs.com/package/jsonschema" rel="noopener ugc nofollow" target="_blank"> jsonschema </a>或<a class="ae kc" href="https://www.npmjs.com/package/joi" rel="noopener ugc nofollow" target="_blank"> joi </a>这样的库让我们很容易地进行检查。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/4e43614828f35a9ee79bc006c5559b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W3wJIcBcla68k3d9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@theflouffy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗洛菲</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="6901" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="3635" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查我们的数据，使它们不是恶意的或无效的。</p><p id="4622" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何可以在我们的数据中运行的东西都应该被转义。</p></div></div>    
</body>
</html>