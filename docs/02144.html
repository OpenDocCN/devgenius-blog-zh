<html>
<head>
<title>Singleton Design Pattern in Modern C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç°ä»£ C++ä¸­çš„å•ä¾‹è®¾è®¡æ¨¡å¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/singleton-design-pattern-in-modern-c-faa90630fe30?source=collection_archive---------21-----------------------#2020-07-20">https://blog.devgenius.io/singleton-design-pattern-in-modern-c-faa90630fe30?source=collection_archive---------21-----------------------#2020-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ccb4197aebac2290ec77a1ad29a1cebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4fOx0rIZjDaw0nqlc1rrA.png"/></div></div></figure><p id="fcec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œåˆ›é€ æ€§çš„è®¾è®¡æ¨¡å¼å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯•å›¾ä»¥é€‚åˆæƒ…å†µçš„æ–¹å¼åˆ›å»ºå¯¹è±¡ã€‚å¯¹è±¡åˆ›å»ºçš„åŸºæœ¬æˆ–æ™®é€šå½¢å¼ä¼šå¯¼è‡´è®¾è®¡é—®é¢˜æˆ–å¢åŠ è®¾è®¡çš„å¤æ‚æ€§ã€‚åœ¨è¿™ç¯‡å…³äºåˆ›é€ æ€§è®¾è®¡æ¨¡å¼çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹åœ¨ç¼–ç¨‹é¢è¯•ä¸­æœ€è®¨åŒçš„&amp;æœ€å¸¸è¢«é—®åˆ°çš„è®¾è®¡æ¨¡å¼ã€‚è¿™æ˜¯ç°ä»£ C++ä¸­çš„å•ä¸€è®¾è®¡æ¨¡å¼ï¼Œæ‰¹è¯„å®ƒçš„å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ã€‚æˆ‘è¿˜å°†ä»‹ç»ä¸ Singleton å®Œå…¨ç›¸åçš„ Multiton è®¾è®¡æ¨¡å¼ã€‚</p><blockquote class="kt ku kv"><p id="9a51" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><em class="in"> /ï¼\:è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘çš„åšå®¢ä¸Šã€‚å¦‚æœä½ æœ‰å…´è¶£æ¥æ”¶æˆ‘çš„æœ€æ–°æ–‡ç« ï¼Œ</em> <a class="ae la" href="http://eepurl.com/gDNybv" rel="noopener ugc nofollow" target="_blank"> <em class="in">è¯·æŠ¥åå‚åŠ æˆ‘çš„ç®€è®¯</em> </a> <em class="in">ã€‚</em></p></blockquote><p id="7629" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡æˆ‘å…³äºåˆ›é€ æ€§è®¾è®¡æ¨¡å¼çš„å…¶ä»–æ–‡ç« ï¼Œé‚£ä¹ˆä¸‹é¢æ˜¯åˆ—è¡¨:</p><ol class=""><li id="6751" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lg lh li lj bi translated"><a class="ae la" href="http://www.vishalchovatiya.com/factory-design-pattern-in-modern-cpp/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">å·¥å‚</strong> </a></li><li id="5975" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated"><a class="ae la" href="http://www.vishalchovatiya.com/builder-design-pattern-in-modern-cpp/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">å»ºé€ è€…</strong> </a></li><li id="b398" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated"><a class="ae la" href="http://www.vishalchovatiya.com/prototype-design-pattern-in-modern-cpp/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">åŸå‹</strong> </a></li><li id="16f9" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated"><a class="ae la" href="http://www.vishalchovatiya.com/singleton-design-pattern-in-modern-cpp/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">å•èƒ</strong> </a></li></ol><p id="18e3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ‚¨åœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­çœ‹åˆ°çš„ä»£ç ç‰‡æ®µæ˜¯ç®€åŒ–çš„ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ã€‚æ‰€ä»¥ä½ ç»å¸¸çœ‹åˆ°æˆ‘ä¸ä½¿ç”¨åƒ<code class="fe lp lq lr ls b">override</code>ã€<code class="fe lp lq lr ls b">final</code>ã€<code class="fe lp lq lr ls b">public</code>(åŒæ—¶ç»§æ‰¿)è¿™æ ·çš„å…³é”®å­—ï¼Œåªæ˜¯ä¸ºäº†è®©ä»£ç ç´§å‡‘&amp;(å¤§éƒ¨åˆ†æ—¶é—´)åœ¨å•ä¸€æ ‡å‡†å±å¹•å°ºå¯¸ä¸‹å¯æ¶ˆè€—ã€‚æˆ‘ä¹Ÿæ›´å–œæ¬¢<code class="fe lp lq lr ls b">struct</code>è€Œä¸æ˜¯<code class="fe lp lq lr ls b">class</code>ï¼Œåªæ˜¯ä¸ºäº†èŠ‚çœä»£ç è¡Œï¼Œæœ‰æ—¶ä¸å†™<code class="fe lp lq lr ls b">public:</code>ï¼Œä¹Ÿæ•…æ„å¿½ç•¥<a class="ae la" href="http://www.vishalchovatiya.com/part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/" rel="noopener ugc nofollow" target="_blank">è™šææ„å‡½æ•°</a>ï¼Œæ„é€ å‡½æ•°<a class="ae la" href="http://www.vishalchovatiya.com/all-about-copy-constructor-in-cpp-with-example/" rel="noopener ugc nofollow" target="_blank">ï¼Œå¤åˆ¶æ„é€ å‡½æ•°</a>ï¼Œå‰ç¼€<code class="fe lp lq lr ls b">std::</code>ï¼Œåˆ é™¤åŠ¨æ€å†…å­˜ã€‚æˆ‘ä¹Ÿè®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªåŠ¡å®çš„äººï¼Œå¸Œæœ›ç”¨å°½å¯èƒ½ç®€å•çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„æ–¹å¼æˆ–ä½¿ç”¨æœ¯è¯­æ¥ä¼ è¾¾ä¸€ä¸ªæƒ³æ³•ã€‚</p><p id="8e17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kw">æ³¨:</em> </strong></p><ul class=""><li id="6f53" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">å¦‚æœä½ æ˜¯åœ¨è¿™é‡Œè¢«ç›´æ¥ç»Šå€’çš„ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ æµè§ˆä¸€ä¸‹<a class="ae la" href="http://www.vishalchovatiya.com/what-is-design-pattern/" rel="noopener ugc nofollow" target="_blank">ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</a>ä¸€ã€å“ªæ€•æ˜¯é¸¡æ¯›è’œçš®çš„å°äº‹ã€‚ç›¸ä¿¡ä¼šé¼“åŠ±ä½ å¯¹è¿™ä¸ªè¯é¢˜è¿›è¡Œæ›´å¤šçš„æ¢ç´¢ã€‚</li><li id="cbbe" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æ‚¨åœ¨æœ¬ç³»åˆ—æ–‡ç« ä¸­é‡åˆ°çš„æ‰€æœ‰è¿™äº›ä»£ç éƒ½æ˜¯ä½¿ç”¨ C++20 ç¼–è¯‘çš„(å°½ç®¡æˆ‘åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨äº† C++17 ä¹‹å‰çš„<a class="ae la" href="http://www.vishalchovatiya.com/21-new-features-of-modern-cpp-to-use-in-your-project/" rel="noopener ugc nofollow" target="_blank">ç°ä»£ C++ </a>ç‰¹æ€§)ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ²¡æœ‰è·å¾—æœ€æ–°çš„ç¼–è¯‘å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨<a class="ae la" href="https://wandbox.org/" rel="noopener ugc nofollow" target="_blank">https://wandbox.org/</a>ï¼Œå®ƒä¹Ÿå·²ç»é¢„è£…äº† boost åº“ã€‚</li></ul><h1 id="19c3" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">ç›®çš„</h1><blockquote class="kt ku kv"><p id="1886" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><strong class="jx io">åˆ›å»ºä¸€ä¸ª&amp;åœ¨ä»»ä½•æ—¶é—´ç‚¹ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</strong></p></blockquote><ul class=""><li id="6940" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">Singleton è®¾è®¡æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å¯¹è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚å½“åªæœ‰ä¸€ä¸ªå¯¹è±¡éœ€è¦åè°ƒæ•´ä¸ªç³»ç»Ÿçš„åŠ¨ä½œæ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</li><li id="35c2" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">å› æ­¤ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œå•ä¾‹è®¾è®¡æ¨¡å¼åªä¸è¿‡æ˜¯æŒ‡å®šä¸€ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</li></ul><h1 id="08f1" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">C++ä¸­çš„å•ä¾‹è®¾è®¡æ¨¡å¼ç¤ºä¾‹</h1><ul class=""><li id="296a" class="lb lc in jx b jy ms kc mt kg mu kk mv ko mw ks lt lh li lj bi translated">æ‰€ä»¥ä½¿ç”¨å•ä¾‹è®¾è®¡æ¨¡å¼çš„åŠ¨æœºæ˜¯ç›¸å½“æ˜æ˜¾çš„ã€‚æˆ‘ä»¬ç³»ç»Ÿä¸­çš„ä¸€äº›ç»„ä»¶åªéœ€è¦æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä»æ„é€ å‡½æ•°åŠ è½½åˆ°å†…å­˜ä¸­çš„æ•°æ®åº“&amp;ç„¶åç»™å‡ºå…³äºå…¶å†…å®¹çš„ä¿¡æ¯ã€‚ä¸€æ—¦å®ƒè¢«åŠ è½½ï¼Œä½ çœŸçš„ä¸æƒ³è¦ä¸€ä¸ªä»¥ä¸Šçš„å®ä¾‹ï¼Œå› ä¸ºæ²¡æœ‰æ„ä¹‰ã€‚</li><li id="4d1b" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æ‚¨è¿˜æƒ³é˜²æ­¢æ‚¨çš„å®¢æˆ·/API ç”¨æˆ·åˆ¶ä½œé‚£ä¸ª<a class="ae la" href="http://www.vishalchovatiya.com/inside-the-cpp-object-model/" rel="noopener ugc nofollow" target="_blank">å¯¹è±¡</a>çš„ä»»ä½•é¢å¤–å‰¯æœ¬ã€‚ä¸‹é¢æ˜¯ C++ä¸­å•ä¾‹è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªç®€å•ä¾‹å­ã€‚</li></ul><pre class="mx my mz na gt nb ls nc nd aw ne bi"><span id="db98" class="nf lv in ls b gy ng nh l ni nj">/* country.txt <br/>Japan<br/>1000000<br/>India<br/>2000000<br/>America<br/>123500<br/>*/<br/>class SingletonDatabase {<br/>    std::map&lt;std::string, int32_t&gt;  m_country;</span><span id="0a41" class="nf lv in ls b gy nk nh l ni nj">    SingletonDatabase() {<br/>        std::ifstream ifs("country.txt");</span><span id="07df" class="nf lv in ls b gy nk nh l ni nj">        std::string city, population;<br/>        while (getline(ifs, city)) {<br/>            getline(ifs, population);<br/>            m_country[city] = stoi(population);<br/>        }<br/>    }</span><span id="7678" class="nf lv in ls b gy nk nh l ni nj">public:<br/>    SingletonDatabase(SingletonDatabase const &amp;) = delete;<br/>    SingletonDatabase &amp;operator=(SingletonDatabase const &amp;) = delete;</span><span id="1644" class="nf lv in ls b gy nk nh l ni nj">    static SingletonDatabase &amp;get() {<br/>        static SingletonDatabase db;<br/>        return db;<br/>    }</span><span id="e971" class="nf lv in ls b gy nk nh l ni nj">    int32_t get_population(const std::string &amp;name) { return m_country[name]; }<br/>};</span><span id="386b" class="nf lv in ls b gy nk nh l ni nj">int main() {<br/>    SingletonDatabase::get().get_population("Japan");<br/>    return EXIT_SUCCESS;<br/>}</span></pre><ul class=""><li id="6ab2" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">ä»è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</li><li id="3de1" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">ç§æœ‰æ„é€ å‡½æ•°</li><li id="40ee" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">åˆ é™¤äº†<a class="ae la" href="http://www.vishalchovatiya.com/all-about-copy-constructor-in-cpp-with-example/" rel="noopener ugc nofollow" target="_blank">å¤åˆ¶æ„é€ å‡½æ•°</a> &amp; <a class="ae la" href="http://www.vishalchovatiya.com/2-wrong-way-to-learn-copy-assignment-operator-in-cpp-with-example/" rel="noopener ugc nofollow" target="_blank">å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦</a></li><li id="dbae" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">é™æ€å¯¹è±¡åˆ›å»ºå’Œé™æ€è®¿é—®æ–¹æ³•</li></ul><h1 id="14b2" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">å•ä¾‹çš„å¯æµ‹æ€§é—®é¢˜</h1><ul class=""><li id="3d1d" class="lb lc in jx b jy ms kc mt kg mu kk mv ko mw ks lt lh li lj bi translated">æˆ‘ä»¬æœ‰äº†å•ä¾‹æ•°æ®åº“ï¼Œå‡è®¾æˆ‘ä»¬å†³å®šä½¿ç”¨è¿™ä¸ªæ•°æ®åº“æ¥åšä¸€äº›ç ”ç©¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ªåä¸º<code class="fe lp lq lr ls b">SingletonRecordFinder</code>çš„æ–°ç±»ï¼Œå®ƒå°†ä»å‚æ•°ä¸­æä¾›çš„åŸå¸‚åç§°é›†åˆä¸­æ‰¾åˆ°æ€»äººå£ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</li></ul><pre class="mx my mz na gt nb ls nc nd aw ne bi"><span id="ec52" class="nf lv in ls b gy ng nh l ni nj">struct SingletonRecordFinder {<br/>    static int32_t total_population(const vector&lt;string&gt;&amp;   countries) {<br/>        int32_t result = 0;<br/>        for (auto &amp;country : countries)<br/>            result += SingletonDatabase::get().get_population(country);<br/>        return result;<br/>    }<br/>};</span></pre><ul class=""><li id="06fb" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">ä½†æ˜¯è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å†³å®šè¦æµ‹è¯•<code class="fe lp lq lr ls b">SingletonRecordFinder</code>ï¼Œè¿™æ˜¯æ‰€æœ‰é—®é¢˜å‡ºç°çš„åœ°æ–¹ã€‚</li></ul><pre class="mx my mz na gt nb ls nc nd aw ne bi"><span id="dfb6" class="nf lv in ls b gy ng nh l ni nj">vector&lt;string&gt; countries= {"Japan", "India"}; // Strongly tied to data base entries<br/>TEST(1000000 + 2000000, SingletonRecordFinder::total_population(countries));</span></pre><ul class=""><li id="cf38" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">ä¸å¹¸çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çœŸå®çš„æ•°æ®åº“ç´§å¯†ç›¸è¿ï¼Œæ²¡æœ‰åŠæ³•æ›¿ä»£è¿™ä¸ªæ•°æ®åº“ã€‚æˆ‘å¿…é¡»ä½¿ç”¨æ¥è‡ªå®é™…æ–‡ä»¶çš„å€¼ã€‚å½“ç¨åè¿™äº›æ¡ç›®æ”¹å˜æ—¶ï¼Œæ‚¨çš„æµ‹è¯•å°†å¼€å§‹å¤±è´¥ï¼Œå› ä¸ºæ‚¨å¯èƒ½æ²¡æœ‰æ›´æ–°ä»£ç ã€‚è¿™å°†æ˜¯ä¸€ä¸ªæŒç»­çš„é—®é¢˜ã€‚</li><li id="812f" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æ­¤å¤–ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œè€Œæ˜¯ä¸€ä¸ªé›†æˆæµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä»…è¦æµ‹è¯•æˆ‘ä»¬çš„ä»£ç ï¼Œè¿˜è¦æµ‹è¯•ä¸€ä¸ªä¸æ˜¯å¥½è®¾è®¡çš„ç”Ÿäº§æ•°æ®åº“ã€‚</li><li id="9646" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">å½“ç„¶æœ‰ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªç‰¹æ®Šçš„æ„é€ ï¼Œè¿™æ ·æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨å•ä¾‹ï¼Œä½†æ˜¯å¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›æˆ‘ä»¬è‡ªå·±çš„è™šæ‹Ÿæ•°æ®æ¥æä¾›å•ä¾‹å®ç°çš„æ›¿ä»£æ–¹æ¡ˆã€‚</li></ul><h1 id="60c8" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">ä¾èµ–æ³¨å…¥çš„å•ä¾‹è®¾è®¡æ¨¡å¼</h1><ul class=""><li id="4098" class="lb lc in jx b jy ms kc mt kg mu kk mv ko mw ks lt lh li lj bi translated">æˆ‘ä»¬åœ¨æµ‹è¯•<code class="fe lp lq lr ls b">SingletonRecordFinder</code>æ—¶é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æœ¬è´¨ä¸Šä¾èµ–äºæ•°æ®åº“å¦‚ä½•æä¾›æ•°æ®çš„ç»†èŠ‚ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ä¾èµ–äºå•ä¾‹æ•°æ®åº“ï¼Œäº‹å®ä¸Šå®ƒæ˜¯å•ä¾‹çš„ã€‚</li><li id="523c" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æ‰€ä»¥æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸åœ¨æ¥å£æˆ–æŠ½è±¡ç±»ä¸Šä½¿ç”¨ä¸€ç‚¹ç‚¹<a class="ae la" href="https://en.wikipedia.org/wiki/Dependency_injection" rel="noopener ugc nofollow" target="_blank">ä¾èµ–æ³¨å…¥</a>ï¼</li></ul><pre class="mx my mz na gt nb ls nc nd aw ne bi"><span id="5aa0" class="nf lv in ls b gy ng nh l ni nj">struct Database { // Dependency <br/>    virtual int32_t get_population(const string&amp; country) = 0;<br/>};</span><span id="026a" class="nf lv in ls b gy nk nh l ni nj">class SingletonDatabase : Database {<br/>    map&lt;string, int32_t&gt;    m_countries;</span><span id="6b6a" class="nf lv in ls b gy nk nh l ni nj">    SingletonDatabase() {<br/>        ifstream ifs("countries.txt");</span><span id="694c" class="nf lv in ls b gy nk nh l ni nj">        string city, population;<br/>        while (getline(ifs, city)) {<br/>            getline(ifs, population);<br/>            m_countries[city] = stoi(population);<br/>        }<br/>    }</span><span id="b1ff" class="nf lv in ls b gy nk nh l ni nj">public:<br/>    SingletonDatabase(SingletonDatabase const &amp;) = delete;<br/>    SingletonDatabase &amp;operator=(SingletonDatabase const &amp;) = delete;</span><span id="9c2a" class="nf lv in ls b gy nk nh l ni nj">    static SingletonDatabase &amp;get() {<br/>        static SingletonDatabase db;<br/>        return db;<br/>    }</span><span id="7f1b" class="nf lv in ls b gy nk nh l ni nj">    int32_t get_population(const string &amp;country) { return m_countries[country]; }<br/>};</span><span id="2ec9" class="nf lv in ls b gy nk nh l ni nj">class DummyDatabase : public Database {<br/>    map&lt;string, int32_t&gt;    m_countries;<br/>public:<br/>    DummyDatabase() : m_countries{{"alpha", 1}, {"beta", 2}, {"gamma", 3}} {}<br/>    int32_t get_population(const string &amp;country) { return m_countries[country]; }<br/>};</span><span id="2f33" class="nf lv in ls b gy nk nh l ni nj">/* Testing class ------------------------------------------------------------ */<br/>class ConfigurableRecordFinder {<br/>    Database&amp;       m_db;  // Dependency Injection<br/>public:<br/>    ConfigurableRecordFinder(Database &amp;db) : m_db{db} {}<br/>    int32_t total_population(const vector&lt;string&gt; &amp;countries) {<br/>        int32_t result = 0;<br/>        for (auto &amp;country : countries)<br/>            result += m_db.get_population(country);<br/>        return result;<br/>    }<br/>};<br/>/* ------------------------------------------------------------------------- */</span><span id="8116" class="nf lv in ls b gy nk nh l ni nj">int main() {<br/>    DummyDatabase db;<br/>    ConfigurableRecordFinder rf(db);<br/>    rf.total_population({"Japan", "India", "America"});<br/>    return EXIT_SUCCESS;<br/>}</span></pre><ul class=""><li id="5a1c" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">ç”±äºä¾èµ–æ³¨å…¥å³<code class="fe lp lq lr ls b">Database</code>æ¥å£ï¼Œæˆ‘ä»¬çš„ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³:</li></ul><ol class=""><li id="f82e" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lg lh li lj bi translated">æˆ‘ä»¬å·²ç»å®Œæˆäº†é€‚å½“çš„å•å…ƒæµ‹è¯•ï¼Œè€Œä¸æ˜¯é›†æˆæµ‹è¯•ï¼Œ</li><li id="48d2" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">ç°åœ¨æˆ‘ä»¬çš„æµ‹è¯•ç±»å¹¶æ²¡æœ‰ç›´æ¥ç»‘å®šåˆ° Singletonã€‚æ‰€ä»¥æ²¡æœ‰å¿…è¦æ ¹æ®æ•°æ®åº“çš„å˜åŒ–ä¸€éåˆä¸€éåœ°æ”¹å˜æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ã€‚</li></ol><h1 id="fbac" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">å¤šéŸ³è®¾è®¡æ¨¡å¼</h1><ul class=""><li id="4809" class="lb lc in jx b jy ms kc mt kg mu kk mv ko mw ks lt lh li lj bi translated">Multiton æ˜¯ singleton çš„å˜ä½“ï¼Œä½†ä¸å®ƒæ²¡æœ‰ç›´æ¥è”ç³»ã€‚è¯·è®°ä½ï¼Œsingleton é˜»æ­¢æ‚¨æ‹¥æœ‰é¢å¤–çš„å®ä¾‹ï¼Œè€Œ Multiton è®¾è®¡æ¨¡å¼è®¾ç½®äº†æŸç§é”®-å€¼å¯¹ï¼Œå¹¶é™åˆ¶äº†å®ä¾‹åˆ›å»ºçš„æ•°é‡ã€‚</li></ul><pre class="mx my mz na gt nb ls nc nd aw ne bi"><span id="7895" class="nf lv in ls b gy ng nh l ni nj">enum class Importance { PRIMARY, SECONDARY, TERTIARY };</span><span id="cb5f" class="nf lv in ls b gy nk nh l ni nj">template &lt;typename T, typename Key = std::string&gt;<br/>struct Multiton {<br/>    static shared_ptr&lt;T&gt; get(const Key &amp;key) {<br/>        if (const auto it = m_instances.find(key); it != m_instances.end()) { // C++17<br/>            return it-&gt;second; <br/>        }<br/>        return m_instances[key] = make_shared&lt;T&gt;();<br/>    }</span><span id="3074" class="nf lv in ls b gy nk nh l ni nj">private:<br/>    static map&lt;Key, shared_ptr&lt;T&gt;&gt;  m_instances;<br/>};</span><span id="979b" class="nf lv in ls b gy nk nh l ni nj">template &lt;typename T, typename Key&gt;<br/>map&lt;Key, shared_ptr&lt;T&gt;&gt;     Multiton&lt;T, Key&gt;::m_instances; // Just initialization of static data member<br/></span><span id="d376" class="nf lv in ls b gy nk nh l ni nj">struct Printer {<br/>    Printer() { cout &lt;&lt; "Total instances so far = " &lt;&lt; ++InstCnt &lt;&lt; endl; }</span><span id="205f" class="nf lv in ls b gy nk nh l ni nj">private:<br/>    static int InstCnt;<br/>};<br/>int Printer::InstCnt = 0;<br/></span><span id="6b46" class="nf lv in ls b gy nk nh l ni nj">int main() {<br/>    using mt = Multiton&lt;Printer, Importance&gt;;</span><span id="5207" class="nf lv in ls b gy nk nh l ni nj">    auto main = mt::get(Importance::PRIMARY);<br/>    auto aux = mt::get(Importance::SECONDARY);<br/>    auto aux2 = mt::get(Importance::SECONDARY); // Will not create additional instances<br/>    return EXIT_SUCCESS;<br/>}</span></pre><ul class=""><li id="f44f" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸‰å°æ‰“å°æœºï¼Œå³ä¸»æ‰“å°æœºã€äºŒçº§æ‰“å°æœºå’Œä¸‰çº§æ‰“å°æœºï¼Œå®ƒä»¬çš„è®¿é—®å’Œå®ä¾‹åŒ–ç”±<code class="fe lp lq lr ls b">Multiton</code>æ§åˆ¶ã€‚æˆ‘å¸Œæœ›ä»£ç çš„å…¶ä½™éƒ¨åˆ†æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚</li></ul><h1 id="ae6d" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">å•ä½“è®¾è®¡æ¨¡å¼çš„å¥½å¤„</h1><ol class=""><li id="9ce6" class="lb lc in jx b jy ms kc mt kg mu kk mv ko mw ks lg lh li lj bi translated">å•ä¾‹è®¾è®¡æ¨¡å¼å¯¹äºåº”ç”¨ç¨‹åºé…ç½®éå¸¸æœ‰å¸®åŠ©ï¼Œå› ä¸ºé…ç½®å¯èƒ½éœ€è¦å…¨å±€è®¿é—®ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºé…ç½®çš„æœªæ¥æ‰©å±•å¯ä»¥æ•´åˆåœ¨ä¸€ä¸ªä½ç½®ã€‚</li><li id="ab42" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">è¯¥ç±»çš„ç¬¬äºŒä¸ªå¸¸è§ç”¨é€”æ˜¯æ›´æ–°æ—§ä»£ç ä»¥åœ¨æ–°æ¶æ„ä¸­å·¥ä½œã€‚ç”±äºå¼€å‘äººå‘˜å¯èƒ½å·²ç»è‡ªç”±åœ°ä½¿ç”¨äº†å…¨å±€å˜é‡ï¼Œå°†å®ƒä»¬è½¬ç§»åˆ°ä¸€ä¸ªç±»ä¸­å¹¶ä½¿å…¶æˆä¸ºå•ä¾‹ï¼Œå¯ä»¥ä½œä¸ºå°†ç¨‹åºå†…è”åˆ°æ›´å¼ºçš„é¢å‘å¯¹è±¡ç»“æ„çš„ä¸­é—´æ­¥éª¤ã€‚</li><li id="1ef0" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">å•ä½“è®¾è®¡æ¨¡å¼è¿˜å¢å¼ºäº†å¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºå®ƒæä¾›äº†å¯¹ç‰¹å®šå®ä¾‹çš„å•ç‚¹è®¿é—®ã€‚</li></ol><h1 id="ebd0" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">å¸¸è§é—®é¢˜æ±‡æ€»</h1><p id="0974" class="pw-post-body-paragraph jv jw in jx b jy ms ka kb kc mt ke kf kg nl ki kj kk nm km kn ko nn kq kr ks ig bi translated"><strong class="jx io">å•ä¾‹è®¾è®¡æ¨¡å¼æœ‰ä»€ä¹ˆä¸å¥½ï¼Ÿ</strong></p><ul class=""><li id="c62f" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">Singleton å¯¹è±¡åœ¨åº”ç”¨ç¨‹åºçš„ç”Ÿå­˜æœŸå†…ä¿å­˜çŠ¶æ€ã€‚è¿™å¯¹æµ‹è¯•æ˜¯ä¸åˆ©çš„ï¼Œå› ä¸ºä½ å¯èƒ½æœ€ç»ˆä¼šé‡åˆ°æµ‹è¯•éœ€è¦æ’åºçš„æƒ…å†µï¼Œè¿™å¯¹äºå•å…ƒæµ‹è¯•æ¥è¯´æ˜¯ä¸€ä¸ªå¤§ç¦å¿Œã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæ¯ä¸ªå•å…ƒæµ‹è¯•éƒ½åº”è¯¥ç›¸äº’ç‹¬ç«‹ã€‚</li><li id="2f1d" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">å•ä¾‹å¯¹è±¡å¯¼è‡´ä»£ç ç´§å¯†è€¦åˆã€‚è¿™ä½¿å¾—çŒœæµ‹æµ‹è¯•åœºæ™¯ä¸‹çš„é¢„æœŸç»“æœå˜å¾—ç›¸å½“å›°éš¾ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„æ•°æ®åº“ç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥å’Œå•ä¾‹è®¾è®¡æ¨¡å¼æ¥å…‹æœå®ƒã€‚</li><li id="1dd4" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æƒ³è±¡ä¸€ä¸‹è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæœ‰ä¸€ä¸ªå¹¶å‘åº”ç”¨ç¨‹åºä»åº”ç”¨ç¨‹åºçš„æ¯ä¸ªéƒ¨åˆ†è®¿é—® Singleton å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨äº’æ–¥ä½“æˆ–ä»»ä½•å…¶ä»–åŒæ­¥åŸè¯­ï¼Œå®ƒåªæ˜¯æ··åˆäº†ä¸€äº›ä¸œè¥¿æˆ–å‡æ…¢äº†å®ƒçš„é€Ÿåº¦ã€‚</li></ul><p id="172d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">å®ç°å•ä½“è®¾è®¡æ¨¡å¼çš„æ­£ç¡®æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p id="c803" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å®ç° singleton çš„æ­£ç¡®æ–¹æ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥ä¸è¦ç›´æ¥ä¾èµ–äº Singletonï¼Œä½ å¯ä»¥è€ƒè™‘ä¾èµ–äºä¸€ä¸ªæŠ½è±¡(æ¯”å¦‚ä¸€ä¸ªæ¥å£)ã€‚æˆ‘ä¹Ÿé¼“åŠ±ä½ ä½¿ç”¨åŒæ­¥åŸè¯­(æ¯”å¦‚äº’æ–¥ã€ä¿¡å·é‡ç­‰)æ¥æ§åˆ¶è®¿é—®ã€‚</p><p id="6cda" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Ÿ</strong></p><ul class=""><li id="ace1" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lt lh li lj bi translated">é€šå¸¸ï¼ŒSingleton ç”¨äºç¡¬ä»¶æ¥å£ä½¿ç”¨é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‰“å°æœºçš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ singleton æˆ– multiton è®¾è®¡æ¨¡å¼æ¥ç®¡ç†è®¿é—®ã€‚</li><li id="8ee7" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">å•ä¾‹è®¾è®¡æ¨¡å¼ä¹Ÿå¹¿æ³›åº”ç”¨äºç®¡ç†é…ç½®æˆ–å±æ€§æ–‡ä»¶ä»¥ç®¡ç†è®¿é—®ã€‚</li><li id="1f9c" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lt lh li lj bi translated">æˆ‘ä»¬å¯ä»¥å°†ç¼“å­˜ç”¨ä½œå•ä¾‹å¯¹è±¡ï¼Œå› ä¸ºå®ƒå¯ä»¥æœ‰ä¸€ä¸ªå…¨å±€å¼•ç”¨ç‚¹ï¼Œå¹¶ä¸”å¯¹äºæ‰€æœ‰å°†æ¥å¯¹ç¼“å­˜å¯¹è±¡çš„è°ƒç”¨ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†ä½¿ç”¨å†…å­˜ä¸­çš„<a class="ae la" href="http://www.vishalchovatiya.com/memory-layout-of-cpp-object/" rel="noopener ugc nofollow" target="_blank">å¯¹è±¡</a>ã€‚</li></ul><p id="0afb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae la" href="http://www.vishalchovatiya.com/contact-2/" rel="noopener ugc nofollow" target="_blank">æœ‰ä»€ä¹ˆå»ºè®®ã€ç–‘é—®æˆ–è€…æƒ³è¯´</a> <code class="fe lp lq lr ls b"><a class="ae la" href="http://www.vishalchovatiya.com/contact-2/" rel="noopener ugc nofollow" target="_blank">Hi</a></code> <a class="ae la" href="http://www.vishalchovatiya.com/contact-2/" rel="noopener ugc nofollow" target="_blank">ï¼Ÿå‡è½»å‹åŠ›ï¼Œåªéœ€ç‚¹å‡»ä¸€ä¸‹é¼ æ ‡ã€‚</a> ğŸ–±ï¸</p></div></div>    
</body>
</html>