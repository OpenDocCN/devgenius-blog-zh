<html>
<head>
<title>Lower Your AWS Lambda Bill by Increasing Memory Size — yep!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过增加内存大小来降低AWS Lambda账单——没错！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/lower-your-aws-lambda-bill-by-increasing-memory-size-yep-aaf7fbfae2bb?source=collection_archive---------7-----------------------#2021-01-21">https://blog.devgenius.io/lower-your-aws-lambda-bill-by-increasing-memory-size-yep-aaf7fbfae2bb?source=collection_archive---------7-----------------------#2021-01-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c56b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我们为Lambda函数指定内存大小时，AWS将按比例分配CPU。例如，256 MB功能的处理能力是128 MB功能的两倍。这看起来简单明了，但是…</p><blockquote class="ki kj kk"><p id="6538" class="jk jl kl jm b jn jo jp jq jr js jt ju km jw jx jy kn ka kb kc ko ke kf kg kh ig bi translated">我有这样一个问题:在Lambda上运行一个给定任务时，会有一个理想的内存大小来最小化成本吗？</p></blockquote><p id="be0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了回答这个问题，我测试了在多种内存大小上运行的相同任务，以检查是否存在这样的成本/内存权衡最佳点。</p><h1 id="e317" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">基准Lambdas</h1><p id="173f" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">我创建了两个Lambda函数来运行这个测试:</p><ul class=""><li id="ca14" class="ls lt in jm b jn jo jr js jv lu jz lv kd lw kh lx ly lz ma bi translated">斐波那契:产生一系列…你猜对了，斐波那契数的基本代码！这只是一个低内存、CPU密集型的任务。</li><li id="d2ae" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">Benchmarker:多次调用Fibonacci函数(或任何其他函数)，切换内存大小；最后，它会对结果进行平均，以确定哪个内存大小可以优化速度和成本。</li></ul><p id="c2a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想测试你自己的Lambdas，<a class="ae mg" href="https://github.com/byrro/awslambda-memory-tradeoff" rel="noopener ugc nofollow" target="_blank">代码是开源的</a>。下面给出的结果肯定会根据您测试的函数而有所不同，所以我鼓励您下载Benchmarker Lambda并亲自运行它。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mh"><img src="../Images/828a3caceda10370a3a93150e92f13e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*da_P5zne6xLTpKqgugZJwA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">由<a class="ae mg" href="https://unsplash.com/photos/qwtCeJ5cLYs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">斯蒂芬·道森</a>在<a class="ae mg" href="https://unsplash.com/search/photos/data-center?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="5488" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">测试参数</h1><ul class=""><li id="9faf" class="ls lt in jm b jn ln jr lo jv mx jz my kd mz kh lx ly lz ma bi translated">AWS地区:美国东部-1(北弗吉尼亚)</li><li id="cb53" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">测试的内存大小:128、256、512、768、1024、1280、1536、1792、2048、2304、2560、2752、3008</li><li id="e5b3" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">对于每种内存大小，斐波那契被调用20次</li><li id="df01" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">调用以10个并发请求为一批运行，以加快进程</li><li id="3156" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">每次调用时，Fibonacci函数都会构建前30个Fibonacci数的序列</li><li id="cfa2" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">忽略冷启动以标准化持续时间结果</li></ul><p id="38c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#测试结果</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1a35f7bdb89905344e6f15155a3c1a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*IH8lJQdGU7wN0F6RH2fcwQ.png"/></div></figure><p id="a688" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">斐波那契数列生成器每百万次执行的平均成本(美元)( n=30)</p><h1 id="9eb3" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">成本方面最有利的地方是:</h1><ul class=""><li id="4e4f" class="ls lt in jm b jn ln jr lo jv mx jz my kd mz kh lx ly lz ma bi translated">768 MB :这是我们在Lambda上能得到的最便宜的任务了；为什么128 MB不便宜？它需要更长的处理时间，长到足以使它的总成本更高！</li><li id="6e78" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><strong class="jm io"> 2048 MB </strong>:虽然价格比768 MB高~3%，但运行速度快2.5倍；在某些情况下，多花点钱来加快处理速度可能是值得的。</li></ul><p id="dd33" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">举例来说，与128 MB相比，运行768 MB的任务花费更少，这是违反直觉的。这意味着在某些情况下，我们实际上可以通过增加内存大小来降低AWS账单。当然，在考虑改变设置时，我们需要知道我们的函数需要的最小内存是多少。我们创建了]dash bird](<a class="ae mg" href="https://dashbird.io/features/aws-lambda-serverless-monitoring/" rel="noopener ugc nofollow" target="_blank">https://dash bird . io/features/AWS-lambda-server less-monitoring/</a>)来更容易地分析Lambda内存使用情况并确定这种基准测试分析的阈值。</p><p id="3b0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">内存容量越大，线斜率(上图)的急剧上升引起了我的注意。从那时起，有报道称——尽管不是官方的Lambda提供了两个内核。我的假设是处理能力在内核之间分配，由于我的工作只使用了一个内核，测试实际上是在惩罚双核功能设置。这是在未来的测试中需要更密切关注的事情，这项任务可以利用多个内核。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi na"><img src="../Images/320ea8ea46766f1ff8fb41f697a66a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*9cYqfdVdBuPeW6PHHiBl_w.png"/></div></figure><p id="2822" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行斐波纳契数列生成器的平均持续时间(毫秒)( n=30)</p><p id="bc33" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在时长方面，上图看似没有什么惊喜，但我其实在结果中发现了一贯诡异的地方:<strong class="jm io"> 2048 MB </strong>总是比<strong class="jm io"> 2304 </strong>和<strong class="jm io"> 2560 MB </strong>表现的更快，这是意料之外的。放大到最高内存大小，我们可以注意到差异。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi na"><img src="../Images/00dc2f03fc0e45531181966cffbf06dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*BwY6L_AKcVIebMB4nj83Tw.png"/></div></figure><p id="5cab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行斐波纳契数列生成器的平均持续时间(毫秒)( n=30)</p><p id="d901" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这可能是可以忽略的，因为它代表大约2%的额外执行时间。尽管如此，如果我们运行这个函数数百万次，或者如果延迟非常重要，那么这些额外的毫秒可能是相关的。</p><p id="22c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很难准确理解哪些因素在产生这些意想不到的结果中发挥了作用。Lambda基础设施是一种黑箱。也许服务于每个请求的硬件有所不同，这将在我们的测试中引入一些不期望的可变性。底线是:如果你想优化Lambda的使用，以获得最快的执行速度或最低的成本，你应该明确地对你的函数进行基准测试。</p><p id="6ae3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经发布了<a class="ae mg" href="https://github.com/byrro/awslambda-memory-tradeoff" rel="noopener ugc nofollow" target="_blank">基准测试函数</a>，这样你就可以自己部署和测试你自己的Lambda函数。</p><h1 id="5c3b" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">通过实时Lambda成本跟踪节省资金</h1><p id="0b69" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">为了从Lambda这个专为AWS Lambda定制的性能监控工具中获益并节省更多，您可以<a class="ae mg" href="https://dashbird.io/#register" rel="noopener ugc nofollow" target="_blank">立即注册Dashbird </a> —一个免费的端到端无服务器监控平台。</p><p id="64c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">获得Lambda函数的详细概述，它们有多健康和有效，以及每个函数的成本。凭借全面的Lambda度量知识，您将能够识别趋势以帮助节省资金。</p><p id="43f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Dashbird通过监控、提供可观察性和洞察力以及实时错误警报来帮助您构建和操作复杂的<strong class="jm io">无服务器应用程序</strong>。</p><ul class=""><li id="c860" class="ls lt in jm b jn jo jr js jv lu jz lv kd lw kh lx ly lz ma bi translated">快速<strong class="jm io"> 3分钟</strong>设置。<a class="ae mg" href="https://dashbird.io/register/" rel="noopener ugc nofollow" target="_blank">从这里开始</a>！</li><li id="f244" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">零代码更改</li><li id="e8f1" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">立即开始调试、监控和接收警报<strong class="jm io"/></li><li id="e371" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">易于访问的集中式数据</li><li id="770c" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><strong class="jm io">监控错误、冷启动和异常情况</strong></li><li id="e66c" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">已经设置了自动提醒</li><li id="d4a9" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><strong class="jm io">针对优化定制的见解</strong></li><li id="7528" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">复杂数据可视化</li><li id="c85c" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">没有安全或性能影响</li></ul></div></div>    
</body>
</html>