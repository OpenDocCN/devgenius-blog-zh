<html>
<head>
<title>Controlling home lights and appliances with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python控制家居灯和电器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/controlling-home-lights-and-appliances-with-python-c411eb019724?source=collection_archive---------2-----------------------#2022-01-12">https://blog.devgenius.io/controlling-home-lights-and-appliances-with-python-c411eb019724?source=collection_archive---------2-----------------------#2022-01-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="eba5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你们大多数人听说过或使用过谷歌助手或亚马逊Alexa提供的家庭自动化。用手机或语音命令控制设备非常方便。作为一名软件开发人员，我想从自己的应用程序中使用API来控制灯光和电器。</p><p id="cfd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TpLink Kasa Wifi插头和灯泡可让您以最少的投资实现这一目标，并且易于安装。我将使用以下两种设备:</p><p id="a17a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://www.bunnings.com.au/tp-link-kasa-kp115-smart-plug-with-energy-monitoring_p0247164" rel="noopener ugc nofollow" target="_blank">带电源监控的Kasa WiFi插头KP115】在Bunnings、JB HiFi等店售价29澳元</a></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/908cb0f9704070e81355a81e9a931551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-PRU_wP9SOHyPOK_Iu4EQ.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Kasa KP115 WiFi插头</figcaption></figure><p id="6758" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">KL110B智能灯泡(在“好人”以14澳元的价格出售)</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kz"><img src="../Images/505df60fae747da4bfc1f220eaa32632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5ppp_k58OLUOAXMJKg29Q.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Tp-Link Kasa WiFi智能灯泡(KL110B)</figcaption></figure><p id="774a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与其他设备相比，这些设备不需要单独的集线器设备，并使用2.4GHz频段直接连接到您的WiFi路由器。</p><p id="0da8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了控制和获取设备状态，我将使用<a class="ae ki" href="https://github.com/python-kasa/python-kasa" rel="noopener ugc nofollow" target="_blank"> python-kasa </a>库。可以使用pip进行安装:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="ceff" class="lf lg in lb b gy lh li l lj lk">pip install python-kasa</span></pre><p id="933d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们需要找出存在哪些设备。要显示本地网络上的所有Kasa设备及其IP地址，请使用:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="ffdf" class="lf lg in lb b gy lh li l lj lk">from kasa import Discover, SmartBulb, SmartPlug</span><span id="6d93" class="lf lg in lb b gy ll li l lj lk">devices = await Discover.discover()<br/>for addr, dev in devices.items():<br/>   await dev.update()<br/>   print(f”{addr} &gt;&gt; {dev}”)</span><span id="499d" class="lf lg in lb b gy ll li l lj lk"><strong class="lb io">192.168.1.21 &gt;&gt; &lt;DeviceType.Plug model KP115(AU) at 192.168.1.21 (Aquarium), is_on: False - dev specific: {'LED state': True, 'On since': None}&gt;<br/>192.168.1.23 &gt;&gt; &lt;DeviceType.Bulb model KL110B(UN) at 192.168.1.23 (Standup light), is_on: False - dev specific: {'Brightness': 100, 'Is dimmable': True}&gt;<br/>...</strong></span></pre><p id="06da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在IP地址192.168.1.21上，我有KP115插头。它可以打开和关闭。除此之外，该型号还具有能源监控功能，因此您可以监控设备每天或每月的耗电量。</p><p id="e710" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们通过使用IP地址作为构造函数参数来连接到plug:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="fbb2" class="lf lg in lb b gy lh li l lj lk">plug = SmartPlug(“192.168.1.21”)</span></pre><p id="c6c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要获取设备名称和交换机状态:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="2460" class="lf lg in lb b gy lh li l lj lk"># check if plug is on<br/>await plug.update()<br/>print(f”Alias: {plug.alias}”)<br/>print(f”is_on: {plug.is_on}”)</span><span id="9ce8" class="lf lg in lb b gy ll li l lj lk"><strong class="lb io">Alias: Aquarium<br/>is_on: False</strong></span></pre><p id="caef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要打开它:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="3193" class="lf lg in lb b gy lh li l lj lk">await plug.turn_on()</span></pre><p id="7acb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在设备已打开，状态已更新:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="a9b0" class="lf lg in lb b gy lh li l lj lk">await plug.update()<br/>plug.is_on</span><span id="a7a5" class="lf lg in lb b gy ll li l lj lk"><strong class="lb io">True</strong></span></pre><p id="ac16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要获取能源监控和WiFi信号数据:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="7f83" class="lf lg in lb b gy lh li l lj lk">print(f”Power {plug.emeter_realtime.power} W”)<br/>print(f”Voltage {plug.emeter_realtime.voltage} V”)<br/>print(f”Current {plug.emeter_realtime.current} A”)<br/>print(f”Power consumed today: {plug.emeter_today} kW”) <br/>print(f”Power consumed this month: {plug.emeter_this_month} kW”)</span><span id="ef16" class="lf lg in lb b gy ll li l lj lk">print(f”Wifi signal strength RSSI: {plug.rssi}”)</span><span id="c550" class="lf lg in lb b gy ll li l lj lk"><strong class="lb io">Power 23.281 W<br/>Voltage 242.363 V<br/>Current 0.17 A<br/>Power consumed today: 0.058 kW<br/>Power consumed this month: 1.183 kW<br/>Wifi signal strength RSSI: -37</strong></span></pre><p id="9cc8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用mine灯泡，除了开关之外，您还可以控制亮度:</p><pre class="kk kl km kn gt la lb lc ld aw le bi"><span id="ce40" class="lf lg in lb b gy lh li l lj lk">await bulb.update()<br/>await bulb.set_brightness(50)<br/>await bulb.update()<br/>bulb.brightness</span><span id="aa77" class="lf lg in lb b gy ll li l lj lk"><strong class="lb io">50</strong></span></pre><p id="6e94" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其他灯泡型号可以使用<em class="lm"> set_color_temp() </em>、<em class="lm"> set_hsv() </em>方法改变颜色和温度。</p><h1 id="1156" class="ln lg in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">这个API怎么用？</h1><p id="7a1e" class="pw-post-body-paragraph jk jl in jm b jn mk jp jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh ig bi translated">这取决于你的想象力，但我发现一些有用的东西可能是:</p><ul class=""><li id="bbaf" class="mp mq in jm b jn jo jr js jv mr jz ms kd mt kh mu mv mw mx bi translated">当你在耳机上听重金属音乐时，闪烁的灯光让你知道有电话进来</li><li id="85ab" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">在家办公时收到即将召开的在线工作会议通知</li><li id="7a3b" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">当你所有的单元测试都通过了，就去煮一杯咖啡</li><li id="84c3" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">找到家中最耗电的设备，并以条形图的形式显示结果</li><li id="ae71" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">使用RGB智能灯泡，为你的整个家增添色彩缤纷的闪烁圣诞灯</li><li id="6153" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">使用Brain neuro connector API，根据您的心情改变房间灯光😊</li></ul><h1 id="b343" class="ln lg in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">我为什么喜欢卡萨？</h1><ul class=""><li id="75c4" class="mp mq in jm b jn mk jr ml jv nd jz ne kd nf kh mu mv mw mx bi translated">易于设置</li><li id="15e6" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">没有用户名和密码，开发者API密钥和其他复杂的配置。您所需要的只是与Kasa设备在同一个本地网络上。</li><li id="175a" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">API调用直接发送到设备，因此响应时间非常快</li><li id="bf9b" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">不需要叫电工来安装设备。把它插在插座上就行了</li><li id="a27d" class="mp mq in jm b jn my jr mz jv na jz nb kd nc kh mu mv mw mx bi translated">插头较窄，因此您可以将两个智能插头并排插入澳大利亚双电源插座</li></ul><h1 id="4476" class="ln lg in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">澳大利亚市场上的其他品牌智能设备</h1><p id="8c29" class="pw-post-body-paragraph jk jl in jm b jn mk jp jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh ig bi translated">我在测试和研究澳大利亚的其他智能开关品牌。宜家。</p><p id="c1d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">图雅设备</strong>(如<strong class="jm io">并网</strong>和<strong class="jm io">强光</strong>)通过API控制相当复杂。你需要在一个网站上注册成为开发者，并获得一个API访问密钥。API本身理解起来也相当复杂。API命令被发送到区域数据中心(对于澳大利亚，数据中心位于欧洲(！)，不知什么原因)。他们把它和奥地利混淆了吗？也许吧。Python库<a class="ae ki" href="https://pypi.org/project/tinytuya/" rel="noopener ugc nofollow" target="_blank"> TinyTuya </a>可用于控制图雅设备。市场上有很多图雅设备，尤其是在海外，所以我希望他们的API更容易使用。</p><p id="41ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">IKEA tr DFRI</strong>灯泡和无线开关非常好，价格合理，但它们使用<a class="ae ki" href="https://en.wikipedia.org/wiki/Zigbee" rel="noopener ugc nofollow" target="_blank"> Zigbee协议</a>，所以你需要购买一个Zigbee网关来控制这些设备。</p></div></div>    
</body>
</html>