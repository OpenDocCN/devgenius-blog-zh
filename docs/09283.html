<html>
<head>
<title>Stop Using “extends” in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止在 PHP 中使用“扩展”</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/stop-using-extends-in-php-37c9da1cce83?source=collection_archive---------0-----------------------#2022-08-12">https://blog.devgenius.io/stop-using-extends-in-php-37c9da1cce83?source=collection_archive---------0-----------------------#2022-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="58e5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你在你的域代码中使用了抽象类 T1 还是 T2 扩展类 T3？希望从今天开始，你<strong class="ak">会停止</strong>那样做。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/8011beba0f15386a87f2c8582c9ac82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cg3DJ1y-RxoYo_3wK9Zhew.jpeg"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">图片由 Andrea Piacquadio 拍摄</figcaption></figure><p id="8af9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们深入讨论这个问题之前，让我先澄清一些事情。今天，我们将讨论与任何框架都无关的代码。扩展类可能是必要的，因为你选择的框架(Laravel，Symfony，随便你怎么说)或者你使用的库可能会强迫你这么做。</p><p id="0cd8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">今天我想讨论一下你的应用程序的核心代码。你可以随意称呼它:根代码，<strong class="kz ir">核心域</strong>，<strong class="kz ir"> <em class="lt"> DDD </em> </strong>代码。您和/或您的团队负责的代码。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="46f1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">话虽如此，你是否在代码中使用了类似“<strong class="kz ir">扩展</strong>”或“<strong class="kz ir">抽象</strong>”的关键词？我从 2015 年开始专业编程，从那以后，我发现没有理由在我的代码中使用抽象类或扩展任何类。我仍然记得 Marco Pivetta 的精彩文章，它永远改变了我设计代码的方式。</p><p id="3f54" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">本文概述了为什么让类成为 final 对您的代码有好处。这是我的类模板在 PHPStorm 中从那时起每个项目的样子:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="1877" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我已经看过和听过太多次了。扩展类给了你灵活性吗？给你这样的类继承有多灵活:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="097c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">根类中的任何变化，比如这里的<em class="lt"> BaseUser </em>，都可能给整个应用程序带来灾难性的后果。我在这里只能看到可能的问题，但没有收获。你要做的是:</p><h1 id="2bb4" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">1.拥抱构图胜过继承❗</h1><p id="fe05" class="pw-post-body-paragraph kx ky iq kz b la mv jr lc ld mw ju lf lg mx li lj lk my lm ln lo mz lq lr ls ij bi translated"><strong class="kz ir">使用接口；通过应用<em class="lt"> final </em>关键字</strong>来防止继承</p><p id="40cf" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">代码应该是这样的:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="611a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">很多人然后告诉我:“为什么，看看有多少代码将被复制，我们至少可以使用特征吗？”但是这种特质将会是脆弱的部分。这里是第二个提示:</p><h1 id="7a78" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">2.不要寻找模式，❗</h1><p id="4337" class="pw-post-body-paragraph kx ky iq kz b la mv jr lc ld mw ju lf lg mx li lj lk my lm ln lo mz lq lr ls ij bi translated"><strong class="kz ir">不再害怕重复代码</strong></p><p id="d9b2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是我们大脑的工作方式:它迫使你寻找模式。避免抽象类和继承有助于防止糟糕的代码决策。</p><p id="1e70" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你需要任何新的功能吗？从一个界面开始。使用文档块来描述输入、输出及其背后的原因。这看起来像是减速，但是它帮助你计划你真正需要的东西。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="b75d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我想分享一个例子来说明这项技术的强大之处。假设我们需要在应用程序中发送通知。怎么做和对谁做都不重要。我们只关心功能性。</p><p id="3339" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们从将要发送的通知定义开始。我们真的不在乎任何细节。这只是通知类型(sms 消息、电子邮件消息、whatsapp 消息等)的一个起点。):</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="1db5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在让我们创建一个管理器来完成这项工作。尽管如此，它并不关心消息的任何细节。它保证看到工作完成。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="fe76" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这就是我所说的真正的灵活性。您可能需要哪些通知？</p><h2 id="0e1c" class="na me iq bd mf nb nc dn mj nd ne dp mn lg nf ng mp lk nh ni mr lo nj nk mt nl bi translated">电子邮件通知</h2><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><h2 id="4577" class="na me iq bd mf nb nc dn mj nd ne dp mn lg nf ng mp lk nh ni mr lo nj nk mt nl bi translated">WhatsApp 通知</h2><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="3ed7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我可以一直这样列举下去。使用框架的依赖注入特性，可以在应用程序没有察觉的情况下交换接口的实现。这样，您的应用程序就与通知系统的细节分离了。让我们想出一个简单的实现。我们需要一个传输机制来传递我们的通知。我们可以使用另一个界面:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="c90e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">传递电子邮件的真正传输方式是:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="afd7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后是简单的通知管理器:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="7072" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我已经爱上了这段代码的每一个部分:</p><ul class=""><li id="0536" class="nm nn iq kz b la lb ld le lg no lk np lo nq ls nr ns nt nu bi translated">遵守单一责任原则:每个部分只关心自己的部分</li><li id="bd86" class="nm nn iq kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated">遵循开闭原则:我们可以在不破坏当前功能的情况下以任何方式修改功能(添加新的传输、添加新的通知类型等)</li><li id="679a" class="nm nn iq kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated">传输机制的变化不会影响应用程序的其他部分</li><li id="6581" class="nm nn iq kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated">只要您坚持我们在开始时设计的接口契约，通知模块的任何部分的更改都不会影响应用程序</li></ul><p id="bf83" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因为我们已经完成了全部功能，所以我们要做的就是创建一个新的通知。假设我们想在每次用户注册时发送一封欢迎电子邮件。我们需要电子邮件通知接口的实现:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="65a1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将从用户对象构建通知的服务:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="2ffe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我将挂钩到应用程序的注册后事件来发送通知。瞧啊。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="0bdc" class="na me iq bd mf nb nc dn mj nd ne dp mn lg nf ng mp lk nh ni mr lo nj nk mt nl bi translated">灵活扩展的装饰服务</h2><p id="586a" class="pw-post-body-paragraph kx ky iq kz b la mv jr lc ld mw ju lf lg mx li lj lk my lm ln lo mz lq lr ls ij bi translated">我想分享的最后一个强大的技术是<a class="ae kw" href="https://en.wikipedia.org/wiki/Decorator_pattern" rel="noopener ugc nofollow" target="_blank">装饰模式</a>。我发现这一点非常有用，因为它允许安全地扩展一个类的功能，而无需深入其内部。</p><p id="e30e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">假设我们的 SMTP 服务器经常出现问题，并且喜欢阻止电子邮件的发送。多亏了装饰模式，我们可以在任何传输中引入重发:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mb mc l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="a170" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">有疑问吗？想法？请给我留下你的看法。让我们一起让我们的代码变得美丽。</p><p id="ef0c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个故事<em class="lt">对你有价值吗</em>？请留言支持我的工作👏<strong class="kz ir">鼓掌表示感谢</strong>你知道你可以不止一次鼓掌吗？🥰 <em class="lt">谢谢你。</em></p></div></div>    
</body>
</html>