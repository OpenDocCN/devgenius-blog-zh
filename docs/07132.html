<html>
<head>
<title>How to use useLastCall hook in your react project.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 react 项目中使用 useLastCall 钩子？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-uselastcall-hook-in-your-react-project-af096e37871c?source=collection_archive---------13-----------------------#2022-02-28">https://blog.devgenius.io/how-to-use-uselastcall-hook-in-your-react-project-af096e37871c?source=collection_archive---------13-----------------------#2022-02-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/b985391f251e9374d596c921c2b3d731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTVn09QrncZ11RpOSngWYw.png"/></div></figure><p id="5841" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">是的，我们走吧，我们如何在你的项目中使用 useLastCall 钩子。首先，我们需要知道它是什么，有什么用。首先这里是知识库更好理解:<a class="ae kp" href="https://github.com/HubertRyanOfficial/react-lastcall-hook" rel="noopener ugc nofollow" target="_blank">https://github.com/HubertRyanOfficial/react-lastcall-hook</a></p><h1 id="aee0" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">最后一次呼叫是为了什么？</h1><p id="92c9" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated"><strong class="jt io"> useLastCall </strong>创建库是为了避免调用数据库，而不需要缓存本身，通过比较数据库中最后一次调用与执行相同功能的时间之间的时间差来确定应该多长时间调用一次。当然，对于您的 reacts 和 react 本地项目。</p><p id="ca68" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">由于我们使用 react 自己的钩子，我们建议使用 react 16.8 以后的版本，这样就可以使用 useEffect 和 useState 钩子。</p><h1 id="00f6" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">如何申请</h1><p id="7bbc" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">其中一个例子是使确定的最后一次呼叫之间的时间差超过 1 分钟。因此，检查从执行或调用数据库开始是否已经过了 1 分钟。所以让我们看看它会是什么样子！</p><p id="c35c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们模拟一下，我们将进行一个一流的 api 调用来获取我们的帖子，看看有多简单。😍😊</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="3591" class="mc kr in ly b gy md me l mf mg">$ yarn add react-lastcall-hook<br/><br/>or<br/><br/>$ npm install react-lastcall-hook --save</span></pre></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><pre class="lx ly lz ma aw mb bi"><span id="5b42" class="mc kr in ly b gy mo mp mq mr ms me l mf mg">import useLastCall from "react-lastcall-hook";<br/><br/>function ExampleComponent() {<br/><br/>  const callPosts = useLastCall(ms,lastCallTime, functionToCall);<br/><br/>  useEffect(() =&gt; {<br/>    if(callPosts) {<br/>      callPosts()<br/>    }<br/>  }, [callPosts])<br/><br/>  return (...)<br/>}</span></pre><p id="1abd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">记住<a class="ae kp" href="https://github.com/HubertRyanOfficial/react-lastcall-hook" rel="noopener ugc nofollow" target="_blank">仓库</a>有更多的细节</p><h1 id="77c2" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">例子</h1><p id="24a5" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">现在我们来看一个更真实的例子。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="7cca" class="mc kr in ly b gy md me l mf mg">...<br/><br/>import useLastCall from "react-lastcall-hook";<br/><br/>function ExampleComponent() {<br/><br/>  const callPosts = useLastCall(1000 * 64, new Date().valueOf, getPosts);<br/><br/>  useEffect(() =&gt; {<br/>    if(callPosts) {<br/>      callPosts()<br/>    }<br/>  }, [callPosts]);<br/><br/><br/>  async function getPosts() {<br/>    await fetch(...)<br/>  }<br/><br/>  return (...)<br/>}</span></pre><h2 id="eea3" class="mc kr in bd ks mt mu dn kw mv mw dp la kc mx my le kg mz na li kk nb nc lm nd bi translated">Yump，耶！！！</h2><p id="f3a4" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">现在，只有从最后一次调用到新调用的时间超过 1 分钟，才会调用获取帖子的功能。在本例中，我将它放在 ms 中，以便于我们的定制。我们看到最后一次调用的时间是我们的<strong class="jt io">日期</strong>，这意味着函数将被调用为任何<strong class="jt io"> useEffect </strong>，这就是为什么这个时间与为当前小时添加的时间没有区别。</p><p id="915d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">存储上次调用该函数的值的一个非常好的方法是使用 Context 或 redux。我将展示一个例子，其中<strong class="jt io"> redux </strong>总是用时间戳中最后一次调用的值来更新 reducer。现在获取并总是保存到一个名为<strong class="jt io"> callPostsLastTime </strong>的 reducer 或上下文中的属性。如果你有其他改进的方法，请与我们分享。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0ab0" class="mc kr in ly b gy md me l mf mg">...<br/><br/>import {useDisptach, connect} from "react-redux";<br/><br/>import useLastCall from "react-lastcall-hook";<br/><br/>function ExampleComponent({callPostLastTime = new Date().valueOf}) {<br/>  const disptach = useDisptach();<br/><br/>  const callPosts = useLastCall(1000 * 64, callPostLastTime, updateCallPostLastTime);<br/><br/>  useEffect(() =&gt; {<br/>    if(callPosts) {<br/>      callPosts()<br/>    }<br/>  }, [callPosts]);<br/><br/>  function updateCallPostLastTime() {<br/><br/>    disptach({<br/>      type: "UPDATE_CALLPOSTS_LASTTIME",<br/>      payload: new Date().valueOf();<br/>    })<br/>    getPosts()<br/>  }<br/><br/>  async function getPosts() {<br/>    await fetch(...)<br/>  }<br/><br/>  return (...)<br/>}<br/><br/>const mapStateToProps = store =&gt; ({<br/>  callPostLastTime: store.postsReducer.lastTime<br/>});<br/><br/>export default connect(mapStateToProps, null)(ExampleComponent);</span></pre><p id="839f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">是的，现在使用来自<strong class="jt io"> react-redux </strong>的<strong class="jt io">used dispatch</strong>钩子，这样我们可以在 redux 内更新我们的减速器中的值。如果你对 Redux 架构不太了解，这里有一个链接可以让你了解更多:<a class="ae kp" href="https://redux.js.org/introduction/getting-started" rel="noopener ugc nofollow" target="_blank">https://redux.js.org/introduction/getting-started</a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="bd77" class="kq kr in bd ks kt ne kv kw kx nf kz la lb ng ld le lf nh lh li lj ni ll lm ln bi translated">你猜对了！👍😁</h1><p id="c107" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">如果你想在使用上下文的架构中使用它，它也非常有用。记住这是为了我们可以存储最后一次调用函数的时间，这样我们就可以看到开始执行的时间差。</p><p id="eec5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://github.com/HubertRyanOfficial/react-lastcall-hook" rel="noopener ugc nofollow" target="_blank">储存库</a></p><p id="c84a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://github.com/HubertRyanOfficial" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><p id="f7a0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">塔普丁:</strong>@休伯特里安</p><p id="070f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://twitter.com/hubertryanoff" rel="noopener ugc nofollow" target="_blank">推特</a></p><p id="6dc1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://www.instagram.com/hubertryanofficial" rel="noopener ugc nofollow" target="_blank"> Instagram </a></p><p id="0819" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">非常感谢，希望对伟大的 React 社区有所帮助。❤🙌</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/5449d80e7221e0f8479e9ed9396abdb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*wa8vJzdSKCkajwyJL4nbIQ.png"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">休伯特·瑞恩标志</figcaption></figure></div></div>    
</body>
</html>