<html>
<head>
<title>Configure Html5 History Mode in VueJS and Apache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在VueJS和Apache中配置Html5历史模式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/configure-html5-history-mode-in-vuejs-and-apache-52daa0c76a75?source=collection_archive---------1-----------------------#2021-01-23">https://blog.devgenius.io/configure-html5-history-mode-in-vuejs-and-apache-52daa0c76a75?source=collection_archive---------1-----------------------#2021-01-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5de4" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何通过设置<code class="fe kc kd ke kf b">html5 history mode</code>删除您的路线URL中不需要的hashbang。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/31899a453f1227bee84b66c5767326fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CZviGW0TsgxH50Q1Q_WBA.jpeg"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">Jan baborak在<a class="ae kw" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b355" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">使用框架构建app时，有时需要配置一些路由。如果您正在使用类似AngularJs或VueJs这样的框架，您可能会在您的routes的URL中获得一个免费的hashbang ( <code class="fe kc kd ke kf b">#!</code>)，这可能会很烦人。</p><p id="bc94" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这意味着我们将得到<code class="fe kc kd ke kf b">#!/myUrl</code>，当我们想要<code class="fe kc kd ke kf b">/myUrl</code>的时候。</p><p id="9612" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">解决这个问题的方法是在routes文件中设置一个html5历史模式。你可能会在网上找到答案，例如，在StackOverflow的<a class="ae kw" href="https://stackoverflow.com/questions/34623833/how-to-remove-hashbang-from-url" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中。然而，当我在代码中实现它时，我遇到了问题。这就是为什么我想和你分享我是如何做到的，我是如何解决这些问题的，希望能对任何人有所帮助。</p><p id="adc1" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">根据您使用的框架，实现这一点的方式会有所不同。我将在VueJs中解释我是如何做的。</p><h1 id="1db4" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">首先，让我们从URL中移除hashbang。</h1><p id="6d85" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">在VueJs中，要移除hashbang，你需要在你的<code class="fe kc kd ke kf b">router.js</code>中设置模式为<code class="fe kc kd ke kf b">history</code>。该模式将利用来自Vue的<code class="fe kc kd ke kf b">history.pushState</code>来实现我们的导航，而无需重新加载页面:</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="504c" class="mu lu in kf b gy mv mw l mx my">const router = new VueRouter({<br/>  routes: […],<br/>  root: '/',<br/>  mode: 'history'<br/>});</span></pre><p id="a221" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">如果你现在尝试运行你的应用，hashbang就会消失。但是如果你试图刷新任何不是根网址的网址，你会得到一个空白页面或者一个错误。</p><p id="a86c" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这就是我如何在开发和生产模式下解决这个问题的:</p><h1 id="e52b" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated"><strong class="ak">发展中</strong></h1><p id="9359" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">我在编码时使用浏览器同步来热重新加载我的应用程序，所以我必须在我的<code class="fe kc kd ke kf b">gulpfile.js</code>中配置与<code class="fe kc kd ke kf b">browser-sync</code>相关的任务来使用npm包<code class="fe kc kd ke kf b">connect-history-api-fallback</code>。</p><p id="11ee" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">因此，我在gulpfile.js中添加了相应的任务:</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="c335" class="mu lu in kf b gy mv mw l mx my">var historyApiFallback = require('connect-history-api-fallback');</span><span id="7f00" class="mu lu in kf b gy mz mw l mx my">gulp.task('browser-sync', function () {<br/>  return browserSync.init({<br/>    open: true,<br/>    port: 3001,<br/>    startPath: 'index.html',<br/>    notify: false,<br/>    server: {<br/>      baseDir: ['.'],<br/>      middleware: [ historyApiFallback() ]<br/>    }<br/>  });<br/>});</span></pre><p id="2f39" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">注意写着<code class="fe kc kd ke kf b">middleware: [historyApiFallback]</code>的那一行。这就是你要求<code class="fe kc kd ke kf b">browser-sync</code>使用html5历史模式来实现我们的导航，而不需要重新加载页面。</p><p id="b6e2" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">但是在生产中，我们需要小心地根据这种模式配置我们的应用程序webserver否则，每次我们在根(<code class="fe kc kd ke kf b">index.html</code>)以外的任何地方刷新页面，我们很可能会得到一个404。</p><h1 id="3878" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated"><strong class="ak">生产中</strong></h1><p id="0ebb" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">如果您还记得在托管应用程序的服务器上添加一些配置，以允许应用程序在所有路线上运行，并能够随时刷新页面，这将是最好的。</p><p id="d5e6" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我在我的ubuntu服务器上使用apache来为我所有的站点提供服务，所以我做的是在我的应用程序的根目录下添加一个<code class="fe kc kd ke kf b">.htaccess</code>文件，路径和我的<code class="fe kc kd ke kf b">index.html</code>一样。我听说有些人把它添加到apache配置的根目录中。</p><p id="76aa" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">看起来是这样的:</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="a9dd" class="mu lu in kf b gy mv mw l mx my">&lt;IfModule mod_rewrite.c&gt;<br/>  RewriteEngine On<br/>  RewriteBase /<br/>  RewriteRule ^index\.html$ - [L]<br/>  RewriteCond %{REQUEST_FILENAME} !-f<br/>  RewriteCond %{REQUEST_FILENAME} !-d<br/>  RewriteRule . /index.html [L]<br/>&lt;/IfModule&gt;</span></pre><p id="ece5" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">重启apache服务(<code class="fe kc kd ke kf b">service apache2 restart</code>)并刷新您的站点。</p><p id="0961" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">所有的路线现在都可以工作了。</p><h1 id="969a" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">可能误差</h1><p id="c560" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">如果在进行这些更改后，您在控制台中得到一个错误消息，说:</p><p id="0823" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe kc kd ke kf b"><strong class="kz io">Uncaught SyntaxError : Unexpected Token &lt;</strong></code></p><p id="c862" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这可能是因为浏览器期望JavaScript，但是它返回HTML作为结果。</p><p id="a453" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">你应该看看你的<code class="fe kc kd ke kf b">index.html</code>和上面定义的所有路径。您可能没有指向正确的路径，因此您的服务器不知道如何安装应用程序。</p><p id="d62e" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">比如不要设置<code class="fe kc kd ke kf b">src=”main.js”</code>而是<code class="fe kc kd ke kf b">src=”/main.js”</code>。<br/>这最后一点也拯救了我的一天！</p><p id="25b3" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">希望这一切对你有所帮助！</p></div></div>    
</body>
</html>