<html>
<head>
<title>Parsing cookie strings in Java with HttpCookie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HttpCookie解析Java中的cookie字符串</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/parsing-cookie-strings-in-java-with-httpcookie-bb4c83b17142?source=collection_archive---------3-----------------------#2021-07-22">https://blog.devgenius.io/parsing-cookie-strings-in-java-with-httpcookie-bb4c83b17142?source=collection_archive---------3-----------------------#2021-07-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/482dea256f7688b53be75d1bae280a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ECpta3oIgZbBQuyG.jpg"/></div></figure><p id="73af" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">前几天，我正在解决一个非常复杂的bug，涉及一些粘性会话cookies和多个反向代理。在解决bug的过程中，我发现我需要解析set-cookie头字符串，并在我们的一个反向代理中进行一些值过滤。</p><p id="e335" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我的第一个想法是编写某种正则表达式来解析字符串并得到我想要的值。我选择了这样的方式:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="a9bb" class="ky kz in ku b gy la lb l lc ld">(.*?)=(.*?)($|;|,(?! ))</span></pre><p id="efa0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这里有一个<a class="ae le" href="https://regexr.com/62bdp" rel="noopener ugc nofollow" target="_blank"> regexer链接</a>。</p><p id="6667" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">原来这比简单的正则表达式更复杂。一个字符串可以包含多个cookie、可选参数等，那么就有一个关于cookie字符串的多种格式的问题。我需要围绕我的正则表达式写很多逻辑。</p><p id="cee7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">自然，我有点懒，所以我开始研究Java能提供什么。对此必须有一个现有的解决方案。我找到了一个名为<code class="fe lf lg lh ku b">HttpCookie</code>的类。</p><p id="67ad" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">用法非常简单:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="d37f" class="ky kz in ku b gy la lb l lc ld">List&lt;HttpCookie&gt; cookies = HttpCookie.parse(cookie);</span></pre><p id="df91" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它将把字符串中的所有cookies解析成一个包含所有需要信息的对象集合。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="fcfa" class="ky kz in ku b gy la lb l lc ld">private final String name; // NAME= ... "$Name" style is reserved</span><span id="3c79" class="ky kz in ku b gy li lb l lc ld">private String value; // value of NAME</span><span id="cee2" class="ky kz in ku b gy li lb l lc ld">// Attributes encoded in the header's cookie fields.</span><span id="5f19" class="ky kz in ku b gy li lb l lc ld">private String comment; // Comment=VALUE ... describes cookie's use</span><span id="9c63" class="ky kz in ku b gy li lb l lc ld">private String commentURL; // CommentURL="http URL" ... describes cookie's use</span><span id="32e6" class="ky kz in ku b gy li lb l lc ld">private boolean toDiscard; // Discard ... discard cookie unconditionally</span><span id="fb93" class="ky kz in ku b gy li lb l lc ld">private String domain; // Domain=VALUE ... domain that sees cookie</span><span id="0773" class="ky kz in ku b gy li lb l lc ld">private long maxAge = MAX_AGE_UNSPECIFIED; // Max-Age=VALUE ... cookies auto-expire</span><span id="a76e" class="ky kz in ku b gy li lb l lc ld">private String path; // Path=VALUE ... URLs that see the cookie</span><span id="fa1e" class="ky kz in ku b gy li lb l lc ld">private String portlist; // Port[="portlist"] ... the port cookie may be returned to</span><span id="6cc9" class="ky kz in ku b gy li lb l lc ld">private boolean secure; // Secure ... e.g. use SSL</span><span id="c509" class="ky kz in ku b gy li lb l lc ld">private boolean httpOnly; // HttpOnly ... i.e. not accessible to scripts</span><span id="348d" class="ky kz in ku b gy li lb l lc ld">private int version = 1; // Version=1 ... RFC 2965 style</span></pre><p id="8a07" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这节省了我很多时间。</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><p id="c79c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="lq">最初发表于</em><a class="ae le" href="https://ppolivka.com/posts/parsing-cookie-string-in-java-with-httpcookie" rel="noopener ugc nofollow" target="_blank"><em class="lq"/></a><em class="lq">。</em></p></div></div>    
</body>
</html>