<html>
<head>
<title>Laravel 8.x Events and Listeners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel 8.x事件和侦听器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-8-x-events-and-listeners-5608ff25f997?source=collection_archive---------0-----------------------#2020-11-02">https://blog.devgenius.io/laravel-8-x-events-and-listeners-5608ff25f997?source=collection_archive---------0-----------------------#2020-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1bcf92a7c10ffc001c9cb95359984d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4qbogLU9RfLxZ2DWidTygg.jpeg"/></div></div></figure><p id="cfa3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">什么是事件？说白了，就是“发生的事情。”只要代码中发生了什么，就可以触发一个事件。Laravel会说“我刚刚完成了一件事，我要让所有听到的人都知道。谁因为这个事件被触发而想做什么，就去做吧。”假设一个用户刚刚购买了一些东西。您可能希望:</p><ul class=""><li id="43d3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">创建发票</li><li id="520a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">通过电子邮件通知管理员</li><li id="8164" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">通过松弛消息通知管理员</li><li id="544a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">通过电子邮件通知客户</li><li id="d4eb" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">通过短信通知客户</li></ul><p id="4c1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您试图将这些任务合并到一个控制器中，那么您的代码将会紧密耦合。大多数程序员都认为解耦代码是一条出路。您的发票管理员应该不知道如何通知管理员；它应该只知道如何管理发票。</p><p id="b65a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个应该触发事件的例子是当用户注册在线访问时。您可能希望向用户发送一封欢迎电子邮件，并获得一个延迟通知，让您知道用户已经订阅。</p><p id="baa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们不打算讨论身份验证系统；我想让它尽可能简单，所以我们将做一些更基本的事情。每当我们访问一个特定的页面，让我们发送一封电子邮件给用户。在正常环境下，您很可能不会这样做，但是我想完全去掉所有不必要的代码。</p><h2 id="a2e8" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">Laravel 8.x应用程序</h2><p id="9634" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">首先，创建一个新的Laravel 8.x应用程序。如果你需要这方面的帮助，你可以看看我下面的文章。</p><div class="mi mj gp gr mk ml"><a href="https://medium.com/dev-genius/setting-up-laravel-8-x-with-jetstream-auth-84bbeafc0cd3" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">使用JetStream Auth设置Laravel 8.x</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">是时候用Laravel安装JetStream认证了。有时简单，有时不简单。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz jw ml"/></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://medium.com/dev-genius/laravel-homestead-on-windows-10-348062f07848" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">Windows 10上的Laravel家园</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">揭开拉勒维尔家园的神秘面纱</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="na l mw mx my mu mz jw ml"/></div></div></a></div><h2 id="74e4" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">可邮寄的</h2><p id="4a52" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">接下来，我们需要创建Mailable类的一个实例，这样我们就有东西要发送了。如果您需要关于Mailable类的详细介绍性解释，请查看我关于Mailables的文章。在本文中，我将在不做更多解释的情况下浏览它。</p><div class="mi mj gp gr mk ml"><a href="https://dinocajic.medium.com/laravel-8-x-mailable-29cffdd19332" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">Laravel 8.x可邮寄</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">Laravel附带了一个Mailable类，您可以使用它毫不费力地发送电子邮件。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">dinocajic.medium.com</p></div></div><div class="mu l"><div class="nb l mw mx my mu mz jw ml"/></div></div></a></div><p id="38ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将使用<a class="ae nc" href="https://mailtrap.io/" rel="noopener ugc nofollow" target="_blank">邮件陷阱</a>来测试我的代码。如果您还没有，请设置一个邮件陷阱帐户，并将配置变量添加到您的。环境文件。</p><p id="5b60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用降价模板选项创建新的可邮寄类别:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="4798" class="lk ll iq ni b gy nm nn l no np">php artisan make:mail FunnyEmail -m emails.funny</span></pre><p id="38b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令将生成两个文件:</p><ul class=""><li id="43bf" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><em class="nq"> app/Mail/FunnyEmail.php </em></li><li id="8c61" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><em class="nq">资源/观点/邮件/搞笑.刀锋. php </em></li></ul><p id="a345" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<em class="nq"> FunnyEmail </em> Mailable类，并验证它在<em class="nq"> build() </em>方法中返回了<em class="nq"> emails.funny </em> markdown模板。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0abc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<em class="nq">funny.blade.php</em>降价文件。您应该会看到类似这样的内容。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="3032" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们想展示一些有趣的东西，你可以修改markdown文件来说一些有趣的东西。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0834" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看那是什么样子。打开您的【web.php】路线文件(<em class="nq"> routes/web.php </em>)并创建一条新路线；我给我的<em class="nq">起名叫搞笑</em>。在这个过程中，我们将返回我们的<em class="nq"> FunnyEmail </em>类的一个新实例。请确保将其导入到顶部。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="2d22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在浏览器中访问该页面；你可能用Homestead设置了一个测试域，或者你可能用<code class="fe nt nu nv ni b">php artisan serve</code>启动了服务器。不管是什么情况，你都应该知道如何访问你的<code class="fe nt nu nv ni b">funny</code>页面。</p><p id="c125" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到类似如下的页面:</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/59c129f5ea6b8b57464b194f8b7dc4b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sc29z8nMU4E6DCex0FhQkQ.png"/></div></div></figure><p id="5c7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们知道这是可行的，我们可以测试我们的邮件陷阱设置。让我们从相同的路线发送电子邮件。<em class="nq">现在您应该已经配置好了邮件陷阱设置。</em></p><p id="9aa3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们首先需要修改我们的<em class="nq">funny email</em>maible类，以包含<em class="nq"> from() </em>和<em class="nq"> subject() </em>方法。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="3688" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修改发送电子邮件的路线，并返回“电子邮件已发送”确认消息。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="edd4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过在浏览器中访问路线来验证它是否有效。我可以在浏览器中看到“电子邮件已发送”消息。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/dd760f705caec1dbbe4d7d26bb0b25c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wS28cSMJi0KnH0ULhPy0Eg.png"/></div></div></figure><p id="3593" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">进入我的邮件陷阱账户，我能够确认我收到了邮件。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/da322c4384fe5c3439182a4ebf250eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3szkog8stZqxeyzo0MvCww.png"/></div></div></figure><h2 id="a89d" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">事件/侦听器</h2><p id="19bb" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">现在我们可以验证电子邮件是否可以发送，让我们创建一个事件/侦听器系统来完成相同的任务。你可能忘了系统的点是什么，赶紧刷新吧。假设一个客户下了一本书的订单(我们只卖搞笑书)。订单控制器可以存储订单细节，并向客户发送电子邮件，让他/她知道已经下了订单。订单控制器然后可以发送显示几个笑话的另一封电子邮件，随后向管理员发送松弛消息，随后向客户发送文本消息，随后向时事通讯注册用户，等等。</p><p id="3a7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以很快判断出，订单控制器除了管理订单之外不应该知道如何做任何事情。订单控制器应该在存储完订单后发出一个标志(一个事件),监听该事件的监听器应该配合并做它需要做的事情，比如发送一封有趣的电子邮件。</p><p id="07ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，我们没有订单控制器。我们就按<em class="nq">/搞笑</em>路线来做。</p><p id="12fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的<em class="nq">/搞笑</em>路线中，我们将在<em class="nq"> event() </em>全球助手的帮助下发起一个事件。可以从应用程序的任何地方访问<em class="nq"> event() </em>全局助手；它接受一个参数，该参数是事件的一个实例。如果这是一个客户注册页面，您可以引发一个<em class="nq"> CustomerRegistered </em>事件；如果已经下了一个新订单，您可以引发一个<em class="nq"> OrderCreated </em>事件。每次有人访问我们的<em class="nq">/有趣的</em>路线时，我们都会引发一个事件；我把它命名为<em class="nq"> FunnyPageAccessedEvent </em>。</p><p id="9704" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们将<em class="nq"> FunnyPageAccessedEvent </em>事件的新实例传递给<em class="nq"> event() </em>全局助手。FunnyPageAccessedEvent 事件还不存在。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="b0ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建事件和侦听器有手动方式和自动方式。让我们两个都看看。</p><h2 id="b5e7" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">手动创建事件和侦听器</h2><p id="fe7d" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">要创建一个事件，您将使用<code class="fe nt nu nv ni b">make:event</code> artisan命令。我们已经知道要给这个事件起什么名字了:<em class="nq"> FunnyPageAccessedEvent </em>。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="70b0" class="lk ll iq ni b gy nm nn l no np">php artisan make:event FunnyPageAccessedEvent</span></pre><p id="0c70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到一个新文件，位于:<em class="nq">app/Events/funnypageaccessedevent . PHP</em>。如果你打开它，你会看到一个类似这样的文件:</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="ef6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">新注册的事件<em class="nq"> FunnyPageAccessedEvent </em>可以通过构造函数接受数据，比如电子邮件地址。所以让我们把电子邮件地址传递给它。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，无论何时调用该事件，都需要电子邮件地址。这意味着我们需要在我们的<em class="nq">有趣的</em>路由中向实例传递一个电子邮件地址。这也是在文档顶部导入<em class="nq">App \ Events \ FunnyPageAccessedEvent</em>的好时机。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="189e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">于是，当用户访问<em class="nq">滑稽</em>路由时，<em class="nq"> event() </em>全局助手对Laravel应用大喊:“嘿，滑稽页面被访问了。任何在听的人，做你想做的事！”</p><p id="6471" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还没有人在听任何东西。在我们创建任何监听器之前，让我们看一下<em class="nq"> FunnyPageAccessedEvent </em>类。我们初始化了email，并将其设置为私有属性。如果我们将其更改为<em class="nq"> public </em>，那么监听器将可以访问那个<em class="nq"> public </em>属性。所以让我们现在就做这个小小的改变。对于这个例子，我们也不需要<em class="nq"> broadcastOn() </em>方法，所以让我们也删除它。您的<em class="nq"> FunnyPageAccessedEvent </em>类现在应该是这样的。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="427e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是时候创建监听器了。我们将使用<code class="fe nt nu nv ni b">make:listener</code> artisan命令。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="db07" class="lk ll iq ni b gy nm nn l no np">php artisan mke:listener SendFunnyEmailListener</span></pre><p id="927c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到一个新文件已经创建:<em class="nq">app/Listeners/sendfunnyemaillistener . PHP</em>。</p><p id="b322" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开该文件，您将看到新创建的侦听器。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="822b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们想给我们的访问者发一封电子邮件。我们可以复制相同的<em class="nq"> Mail::to() </em>代码，它是我们在测试我们的maible类时创建的，并将其粘贴到我们的<em class="nq"> handle() </em>方法中。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2b88" class="lk ll iq ni b gy nm nn l no np">Mail::to('dinocajic+test@gmail.com')-&gt;send(new FunnyEmail());</span></pre><p id="4939" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">确保导入了<em class="nq">邮件</em>外观和<em class="nq"> FunnyEmail </em>邮件类。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="653b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你看一下<em class="nq"> handle() </em>方法，它接收事件作为参数。因此，我们可以通过<em class="nq"> $event </em>参数访问<em class="nq"> FunnyPageAccessedEvent </em>的<em class="nq"> public $email </em>属性。让我们修改硬编码的电子邮件，改为接收传递给事件的电子邮件。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1fce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了。我们现在有一个在<em class="nq">滑稽</em>路线中“分派”的事件和一个侦听器，但是侦听器只是存在的；它没有监听这个事件。</p><p id="9636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一个阶段是确保<em class="nq"> SendFunnyEmailListener </em>确实在监听<em class="nq"> FunnyPageAccessedEvent。</em>这是通过位于<em class="nq">app/Providers/EventServiceProvider . PHP中的<em class="nq"> EventServiceProvider </em>来完成的</em>你的<em class="nq"> EventServiceProvider </em>应该是这样的。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c90e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到<em class="nq"> $listen </em>数组属性。您必须为每个事件/侦听器创建一个映射。在这个例子中，我们有一个事件和一个监听器。将事件和监听器添加到<em class="nq"> $listen </em>数组:</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="d8d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们回顾一下。</p><ol class=""><li id="27ea" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nz lc ld le bi translated">用户访问<em class="nq">搞笑</em>路线。</li><li id="c705" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq">滑稽</em>路由内部的回调函数调用<em class="nq"> event() </em>全局助手，全局助手“调度”事件。</li><li id="0923" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated">被调度的事件是<em class="nq"> FunnyPageAccessedEvent </em>。它以字符串形式接收<em class="nq">电子邮件</em>地址。</li><li id="e3c4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated">在<em class="nq"> FunnyPageAccessedEvent </em>的实例化过程中，email参数被分配给<em class="nq"> FunnyPageAccessedEvent </em>类中的<em class="nq"> $email </em>公共属性。</li><li id="fbaa" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated">监听器<em class="nq"> SendFunnyEmailListener </em>正在监听<em class="nq"> FunnyPageAccessedEvent。</em>它知道监听这个特定事件的方式是由于在<em class="nq"> EventServiceProvider </em>类中完成的映射。</li><li id="7067" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq"> SendFunnyEmailListener </em>听到<em class="nq"> FunnyPageAccessedEvent </em>事件。</li><li id="07ff" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated">调用<em class="nq"> SendFunnyEmailListener </em>内部的<em class="nq"> handle() </em>方法，并将<em class="nq">funnypageacessdevent</em>事件作为参数传递给<em class="nq"> handle() </em>方法。</li><li id="2b4b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq"> handle() </em>方法现在可以从<em class="nq"> FunnyPageAccessedEvent </em>事件中访问<em class="nq"> $email </em>属性。</li><li id="0c30" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated">调用<em class="nq">邮件外观</em>并且<em class="nq"> to() </em>方法接受来自<em class="nq">FunnyPageAccessedEvent-&gt;$ email</em>属性的<em class="nq"> $email </em>地址。</li><li id="c6e7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq">邮件外观</em>也调用<em class="nq"> send() </em>方法，并传递<em class="nq">FunnyEmail maillable</em>类。</li><li id="a86a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq">funny email maible</em>类从和<em class="nq">主题</em>字段返回<em class="nq"> markdown </em>模板和<em class="nq">。</em></li><li id="06da" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nz lc ld le bi translated"><em class="nq">邮件门面</em>将邮件发送到指定的邮件地址。</li></ol><p id="00ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看它是否有效。在你的浏览器中刷新有趣的路线，并查看你的邮件收件箱。我成功地收到了邮件。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/4f1a7046ea68fbdf6ff1130404dedeae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bs4jnTUv1zHw4CsPR05Sjg.png"/></div></div></figure><p id="cfec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们再创建三个侦听器。我们只是要模拟动作已经发生，而不是实际实现它。创建以下监听器:</p><ul class=""><li id="1c0b" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><em class="nq">SendFunnySlackMessageToAdminListener</em></li><li id="907a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><em class="nq">sendfunnytextmessagetovisitolistener</em></li><li id="aabb" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><em class="nq">SignVisitorUpForNewsletter</em></li></ul><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="dae0" class="lk ll iq ni b gy nm nn l no np">php artisan make:listener SendFunnySlackMessageToAdminListener</span><span id="c12c" class="lk ll iq ni b gy oa nn l no np">php artisan make:listener SendFunnyTextMessageToVisitorListener</span><span id="5e20" class="lk ll iq ni b gy oa nn l no np">php artisan make:listener SignVisitorUpForNewsletter</span></pre><p id="8866" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开每个监听器(从<em class="nq">应用程序/监听器</em>)并添加以下内容:</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9c8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，听众是存在的，但他们并没有真正在听。让我们确保他们正在监听何时调度<em class="nq"> FunnyPageAccessedEvent </em>。打开<em class="nq"> EventServiceProvider </em>类，将三个新的监听器添加到<em class="nq"> FunnyPageAccessedEvent </em>数组中。确保在顶部导入每个侦听器。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f7e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">刷新你的<em class="nq">搞笑</em>页面，看看会发生什么。您应该会看到如下所示的页面:</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/540847c2601a3af575a964109109eb19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_iPCuh3AxiEddv7NLqkIaQ.png"/></div></div></figure><p id="fb87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查MailTrap并验证电子邮件确实已发送。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/a0a517b525ad12c8caf55d5aa93c3f18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SxDB55Onvkr3ArLgdIsB2Q.png"/></div></div></figure><p id="4b3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以得出结论，映射到<em class="nq"> EventServiceProvider </em>类中的所有侦听器实际上都触发了。</p><h2 id="224a" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">自动方式</h2><p id="0414" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">您不必执行我们上面列出的所有命令。您可以访问您的<em class="nq"> EventServiceProvider </em>类，在创建事件和侦听器之前映射它们。</p><p id="899e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们采用自动化的方法来创建这个事件/侦听器系统。该事件将被称为<em class="nq">NewCustomerRegisteredEvent</em>，并将在每次新客户注册新帐户时被触发。我们还想创建三个新的侦听器:</p><ul class=""><li id="a483" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><em class="nq">EmailCustomerNewAccountDetailsListener</em></li><li id="8eaf" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><em class="nq">slackdadminnewaccountregistered listener</em></li><li id="1250" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><em class="nq">SignCustomerUpForDiscountsListener</em></li></ul><p id="e8c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开您的<em class="nq"> EventServiceProvider </em>类，并将它们添加到您的<em class="nq"> $listen </em>属性中。<strong class="ka ir">确保为事件添加完整的名称空间</strong>:<strong class="ka ir"><em class="nq">\ App \ Events</em></strong>，为监听器添加<strong class="ka ir"><em class="nq">\ App \ Listeners</em></strong>。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9c03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，用artisan运行<code class="fe nt nu nv ni b">event:generate</code>命令。<code class="fe nt nu nv ni b">event:generate</code>命令查看<em class="nq"> EventServiceProvider </em>类，并生成它没有找到的所有事件和侦听器。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6b89" class="lk ll iq ni b gy nm nn l no np">php artisan event:generate</span></pre><p id="524f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查您的<em class="nq">应用程序/事件</em>和<em class="nq">应用程序/监听器</em>文件夹。你所有的文件都应该在那里。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ce80ee1ddca725366b8ba9d721e595fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*qBwegEfCX-AgTkO0uSmIPA.png"/></div></figure><p id="f04a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在可以像以前一样修改这些文件。如果你需要单独添加一个新的监听器，你可以把它添加到<em class="nq"> EventServiceProvider </em>类中，然后运行<code class="fe nt nu nv ni b">event:generate</code> artisan命令。假设我们想给客户发一条短信；我们首先将新的监听器类名添加到<em class="nq"> EventServiceProvider </em>中。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="dd0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe nt nu nv ni b">php artisan event:generate</code>并验证新的监听器是否在您的<em class="nq"> app/Listeners </em>文件夹中。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ff5166cf812dd20e6dbe5070d11ad2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*PyvbQm8e-LCjWRm_Vvd8Jg.png"/></div></figure><p id="4084" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要阅读关于事件和侦听器的更多细节，请访问Laravel文档。</p><div class="mi mj gp gr mk ml"><a href="https://laravel.com/docs/8.x/events" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">事件</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">Laravel的事件提供了一个简单的观察者实现，允许您订阅和监听各种事件…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">laravel.com</p></div></div></div></a></div></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0ff3caf9c35e83c18fd3dfd64372e433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y5w2fzX6xhy0-dF1.jpeg"/></div></div></figure><p id="d247" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic目前是<a class="ae nc" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae nc" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae nc" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae nc" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae nc" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae nc" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的IT主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="6994" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae nc" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae nc" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae nc" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体刊物</a>。</p><p id="c033" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读Dino Cajic(以及Medium上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T3】</p></div></div>    
</body>
</html>