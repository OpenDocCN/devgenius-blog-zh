<html>
<head>
<title>The curious case of duplicate certificate entries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">奇怪的重复证书条目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/the-curious-case-of-duplicate-certificate-entries-34ae161160af?source=collection_archive---------2-----------------------#2021-02-18">https://blog.devgenius.io/the-curious-case-of-duplicate-certificate-entries-34ae161160af?source=collection_archive---------2-----------------------#2021-02-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="076c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从凯撒时代(甚至更早)开始，加密和安全就已经变得非常重要，因为帝国、王国、个人、企业和所有人都在寻求保护他们的数据，尽管出于他们自己的原因。</p><p id="31c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是，如果一个人不小心的话，一个简单的重复证书就可能对您自己的安全系统造成严重破坏。</p><p id="d2fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个故事不会告诉你如何创建证书，或者在Glusterfs的情况下如何启用TLS/SSL选项。</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><h1 id="0cfa" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">奇怪的错误</strong></h1><p id="ea7e" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">假设这是一个美丽的星期五晚上，你已经完成了当天的大部分任务。web应用程序部署在集群中，数据库得到优化，负载平衡得到处理，您只剩下一件小事——“在glusterfs中启用TLS”。</p><p id="79b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">文档非常简单。你也知道该怎么做。您继续创建自签名证书，即在glusterfs中为N个节点创建大约N个证书，然后将所有公共证书连接到一个名为glusterfs.ca的文件中。现在您可以使用另一种方法，即使用根ca和CSR等..等等。但是现在又是一个星期五的晚上，周末露营似乎已经很近了。只需执行一个命令行。</p><p id="02a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">只有。</p><p id="00fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">事情开始变得疯狂。对等体之间没有联系。存储本身是不可访问的，因为数据库正在使用此存储，而web应用程序正在使用数据库…您明白了吗？</p><p id="0704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">再见露营！</p><p id="8a85" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么是什么出了问题呢？你问..</p><p id="23a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你浏览日志，找到一个条目…</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="302d" class="mb kq in lx b gy mc md l me mf">[2021-02-18 11:11:11.12312] E [socket.c:246:ssl_dump_error_stack]  0-socket.management:   error:0B07C065:x509 certificate  routines:X509_STORE_add_cert:cert already in hash table</span></pre><p id="8a0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">想起什么了吗？</p><p id="c653" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没有吗？</p><p id="77ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是出问题的部分..glusterfs.ca</p><p id="2597" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">错误描述指出哈希表中已经有一个证书(现在从技术上讲，您只是将证书添加到一个文件中。).要点是glusterfs.ca中有一个重复的证书条目。</p><p id="6349" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，松了一口气之后，您可以转到glusterfs.ca，清除重复的证书条目，恢复依赖的服务，然后开始野营旅行。</p><p id="df40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于那些希望避免这种情况的人，他们希望避免在第一次无意中在。ca文件，破坏群集及其依赖的服务的稳定，那么必须先发制人。</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><h1 id="0964" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">预先检查重复的证书条目</h1><p id="bc04" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">现在可以手动浏览glusterfs.ca(请不要！)但是如果您有一个包含多个节点的集群呢？</p><p id="47d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，更好的方法是在glusterfs.ca部署到节点之前，使用脚本来查找重复条目。</p><p id="64b6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我已经创建了一个脚本，它检查glusterfs.ca并找到重复的条目，并且只通知哪个公共证书是重复的。对于那些想使用它的人来说，回购链接是<a class="ae mg" href="https://github.com/srijan-sivakumar/duplCertDetect" rel="noopener ugc nofollow" target="_blank">dupcertdetect</a>。</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="d4bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可以改进上述脚本，甚至删除重复的条目。(有人愿意贡献一些代码吗？)</p><p id="2f53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">总之，大多数的错误和失败都是由于一些人为因素造成的，手动验证永远不是解决问题的方法，也不是运行事物然后查看我们是否遇到任何错误的方法。很多时候，一个简单的林挺甚至解析都可以防止严重的错误，这些错误会毁了你的野营旅行(或者你的周末计划)。</p></div></div>    
</body>
</html>