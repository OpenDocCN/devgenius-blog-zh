# Swift CALayer: 3D åŠ¨ç”»åœ°çƒä»ªğŸŒå¸¦ CALayer

> åŸæ–‡ï¼š<https://blog.devgenius.io/swift-3d-looking-animated-globe-with-calayer-307942174caf?source=collection_archive---------15----------------------->

åˆ›å»ºä¸€ä¸ªæ—‹è½¬çš„ 3D åœ°çƒï¼Œåªéœ€ä½¿ç”¨ CALayer å’Œ 2 ç»„å›¾åƒè§†å›¾ã€‚è¾“å‡ºå¦‚ä¸‹å›¾æ‰€ç¤º ***ã€‚gif*** æ–‡ä»¶ä¸æ— æ•…éšœåŠ¨ç”»ï¼Œç›¸ä¿¡æˆ‘ğŸ˜ã€‚

![](img/467d4df6bfff46663278160d86fceeb4.png)

æ ¸å¿ƒåŠ¨ç”»æ¡†æ¶æ”¯æŒ CALayerï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨å±å¹•ä¸Šç»˜åˆ¶ã€ç®¡ç†å’ŒåŠ¨ç”»æ˜¾ç¤ºå¯è§†å†…å®¹ã€‚æ ¹æ®è‹¹æœçš„[æ–‡æ¡£](https://developer.apple.com/documentation/quartzcore/calayer)ï¼Œlayer è¿˜ä¿å­˜äº†å…³äºå…¶å†…å®¹çš„å‡ ä½•ä¿¡æ¯(å¦‚ä½ç½®ã€å¤§å°å’Œå˜æ¢)ï¼Œç”¨äºåœ¨å±å¹•ä¸Šå‘ˆç°è¯¥å†…å®¹ã€‚

è¯´å¤Ÿäº†ğŸ˜ã€‚è®©æˆ‘ä»¬å¼€å§‹çƒ¹é¥ªæˆ‘ä»¬çš„é¡¹ç›®ğŸ¥˜ã€‚æœ¬é¡¹ç›®æ‰€éœ€çš„é…æ–™å¦‚ä¸‹ã€‚

## å…³é”®æˆåˆ†:

*   1 `CAShapeLayer`å®ä¾‹
*   1 ä¸ª`CAGradientLayer`å®ä¾‹
*   1 å¹…ä¸–ç•Œåœ°å›¾å›¾åƒğŸ—ºï¸(å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨çœŸå®çš„å›¾åƒ)
*   2 `ImageView`
*   2 `UIView`
*   1 `UIImageView`æ‰©å±•ï¼Œç”¨äºåœ¨å°† AspectFit å†…å®¹ç±»å‹åˆ†é…ç»™å›¾åƒåè®¡ç®—å›¾åƒé«˜åº¦
*   1 `CGAffineTransform`å‘ UIView æä¾›åŠ¨ç”»
*   1 å¼ é»‘è‰²/è“è‰²å¤©ç©ºå›¾åƒï¼Œç”±æ‚¨é€‰æ‹©ğŸŒŒ(ç”¨äºæµ‡å¤´ğŸ˜‰)

## çƒ¹é¥ª ProcedureğŸ§‘â€ğŸ³ï¼š

*   åœ¨ä½ çš„æ•…äº‹æ¿ä¸­æ‹–åŠ¨ **UIView** (åä¸º *tempView* )ã€‚å°†å…¶ä¸å±å¹•çš„å‚ç›´å’Œæ°´å¹³ä¸­å¿ƒå¯¹é½ã€‚è®¾ç½® **300x300 çš„å®½åº¦å’Œé«˜åº¦ã€‚**åŒæ ·ï¼Œåœ¨ ViewController æ–‡ä»¶ä¸­åˆ›å»ºè¯¥è§†å›¾çš„ **IBOutlet** åŠå…¶é«˜åº¦çº¦æŸã€‚
*   åœ¨ *tempView* ä¸­ï¼Œå–å¦ä¸€ä¸ªè§†å›¾(åä¸º *vwImgContainer* )ç›¸å¯¹äºè¶…çº§è§†å›¾(å³ *tempView)åˆ†é…å°¾éƒ¨ã€åº•éƒ¨å’Œé¡¶éƒ¨çº¦æŸã€‚*æä¾› **600 çš„**å®½åº¦**ã€‚C** ä¹Ÿä¸ºè¿™ä¸ª UIView åˆ›å»º ViewController æ–‡ä»¶ä¸­çš„ **IBOutlet** ã€‚
*   ç°åœ¨ *vwImgContainer* å°†æœ‰ä¸¤ä¸ª **UIImageView** åœ¨é‡Œé¢ï¼Œä½†æ˜¯æ˜¯å¹¶æ’çš„ã€‚ç¬¬ä¸€ä¸ªå›¾åƒè§†å›¾(åä¸º *imgFirst* )å°†å…·æœ‰é¡¶éƒ¨ã€åº•éƒ¨ã€å°¾éƒ¨ã€ä¸­å¿ƒç­‰çº¦æŸï¼Œç›¸å¯¹äºè¶…çº§è§†å›¾(å³ *vwImgContainer* )å‚ç›´å¯¹é½ï¼Œå¹¶å°†å…·æœ‰ **300 çš„**å®½åº¦**ã€‚ç¬¬äºŒä¸ª**å›¾åƒè§†å›¾(åä¸º *imgSecond* )å°†æœ‰çº¦æŸï¼Œå¦‚å‰å¯¼ã€åº•éƒ¨ã€é¡¶éƒ¨ã€**å°¾éš**åˆ° ***imgFirstã€*** *å’Œ*å‚ç›´å±…ä¸­å¯¹é½ã€‚æ‚¨è¿˜éœ€è¦ ViewController æ–‡ä»¶ä¸­ *imgFirst çš„ **IBOutlet** ã€‚æ­¤å¤–ï¼Œå°†ä¸–ç•Œåœ°å›¾å›¾åƒåˆ†é…ç»™ä¸¤ä¸ªå›¾åƒè§†å›¾ï¼Œå¹¶èµ‹äºˆå®ƒä»¬å†…å®¹ç±»å‹`AspectFit`*
*   åœ¨å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ çš„åŠç†Ÿçš„é¡¹ç›®å’Œè§†å›¾çš„å±‚æ¬¡ç»“æ„åº”è¯¥çœ‹èµ·æ¥åƒä¸‹å›¾æ‰€ç¤º

![](img/e70eca733308ab7908e05d3ace3e1258.png)

*   ç°åœ¨ç§»åŠ¨åˆ° ViewController æ–‡ä»¶ï¼Œåˆ›å»ºå¦‚ä¸‹çš„`CAShapeLayer`å’Œ`CAGradientLayer`çš„å®ä¾‹ã€‚

```
**let** circularMaskLayer = CAShapeLayer()
**let** gradient = CAGradientLayer()
```

*   åˆ›å»ºä¸€ä¸ªå‡½æ•°`setUpMaskAndGradientLayer`ï¼Œæˆ‘ä»¬å°†åœ¨`viewDidAppear`ä¸­è°ƒç”¨å®ƒã€‚ç°åœ¨æˆ‘ä»¬å°†åœ¨ *tempView* çš„ä¸­å¿ƒåˆ›å»ºä¸€ä¸ªåœ†å½¢`UIBezierPath`ï¼Œå®ƒçš„å®½åº¦å’Œé«˜åº¦ç­‰äº *imgFirst çš„*å›¾åƒçš„é«˜åº¦ï¼Œå°†å…¶å†…å®¹ç±»å‹è®¾ç½®ä¸º`AspectFit`ã€‚å°† BezierPath åˆ†é…ç»™`circularMaskLayer`ï¼Œè¿›ä¸€æ­¥å°†`*circularMaskLayer*`åˆ†é…ç»™ *tempViews* å›¾å±‚çš„è’™ç‰ˆå±æ€§ã€‚

> **æ³¨æ„:**éœ€è¦è®¡ç®—é«˜åº¦ï¼Œå› ä¸ºæˆ‘ä»¬çš„**ä¸–ç•Œåœ°å›¾å›¾åƒ**æ˜¯çŸ©å½¢çš„ï¼Œè€Œæˆ‘ä»¬çš„ **imgFirst** æ˜¯æ–¹å½¢çš„ï¼Œå½“æ‚¨å°†å†…å®¹ç±»å‹è®¾ç½®ä¸º AspectFit æ—¶ï¼Œå›¾åƒå®Œå…¨é€‚åˆå›¾åƒè§†å›¾çš„æ°´å¹³æ–¹å‘ï¼Œä½†åœ¨é¡¶éƒ¨å’Œåº•éƒ¨ç•™æœ‰ç©ºç™½ã€‚

ç°åœ¨è®¾ç½®*æ¸å˜*çš„æ¡†æ¶ç­‰äº *UIBezierPath* å˜é‡*çš„è¾¹ç•Œã€‚*è®¾ç½®æ¸å˜ç±»å‹ä¸º`**radial**`ã€‚æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„é¢œè‰²ä»åœ†å¿ƒå‘åœ†çš„è¾¹ç¼˜ç§»åŠ¨ã€‚åŒæ ·ï¼Œå°†æ¸å˜çš„ç¬¬ä¸€ç§é¢œè‰²(ä¸­å¿ƒé¢œè‰²)è®¾ç½®ä¸º**é€æ˜**ï¼Œå°†ç¬¬äºŒç§é¢œè‰²(æœå‘åœ†è¾¹ç¼˜çš„é¢œè‰²)è®¾ç½®ä¸º **HSB** ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

```
gradient.colors = [UIColor.clear.cgColor, UIColor(hue: 0.60 , saturation: 1, brightness: 0.90, alpha: 0.7).cgColor]
```

è¿™å°†åœ¨åœ†çš„è¾¹ç¼˜äº§ç”Ÿæ¨¡ç³Šçš„ ***è“è‰²*** è‰²è°ƒï¼Œä½¿æˆ‘ä»¬çš„åœ°çƒçœ‹èµ·æ¥æ›´åŠ çœŸå®å’Œ 3Dã€‚æ·»åŠ *æ¸å˜*ä½œä¸º *tempViews* å›¾å±‚å±æ€§çš„å­å±‚ã€‚

*   ç°åœ¨ï¼Œä¸ºäº†ç»™åœ°çƒæä¾›æ—‹è½¬åŠ¨ç”»ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`animateTheWorld`çš„å‡½æ•°ï¼Œè°ƒç”¨ UIView çš„ animate å‡½æ•°ï¼ŒæŒç»­æ—¶é—´ä¸º 10ï¼Œå¸¦æœ‰é‡å¤é€‰é¡¹ã€‚å¯¹äºæ—‹è½¬åŠ¨ç”»ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‡½æ•°`CGAffineTransform(translationX:)`ã€‚æ‰€ä»¥åŸºæœ¬ä¸Šåœ°çƒä¸æ˜¯åœ¨æ—‹è½¬ğŸ˜œä½†æ˜¯æˆ‘ä»¬æ­£åœ¨ä»¥é‡å¤çš„æ–¹å¼ä»å·¦åˆ°å³ç§»åŠ¨æˆ‘ä»¬çš„å®¹å™¨ï¼Œè¿™å¯¼è‡´äº†é€šè¿‡åœ†å½¢é®ç½©å±‚çœ‹åˆ°çš„æ—‹è½¬çš„é”™è§‰ã€‚ä½ çš„å‡½æ•°çœ‹èµ·æ¥å¦‚ä¸‹ï¼Œä½ å°†åœ¨`setUpMaskAndGradientLayer`ç»“æŸæ—¶è°ƒç”¨å®ƒã€‚

> **æ³¨æ„:**è®¾ç½® **translationX** å€¼ä¸ vwImgContainer çš„å®½åº¦ç›¸åŒï¼Œy å€¼ä¸º **0** ï¼Œå› ä¸ºæˆ‘ä»¬åªæƒ³æ°´å¹³ç§»åŠ¨è§†å›¾ã€‚

```
**func** animateTheWorld() {
     UIView.animate(withDuration: 10,
                    delay: 0,
                    options: [.repeat, .curveLinear],
                    animations: {
                        **self**.vwImgContainer.transform = CGAffineTransform(translationX: 300, y: 0)
     }, completion: **nil**)
}
```

*   ç°åœ¨æœ€åä¸€æ­¥æ˜¯æ·»åŠ ä¸€äº›é¡¶å±‚ï¼Œå³æ·»åŠ ä»»ä½•ä¸å¤©ç©ºæˆ–æ˜Ÿç³»ç›¸å…³çš„å›¾åƒä½œä¸ºèƒŒæ™¯å›¾åƒã€‚
*   ç°åœ¨æˆ‘ä»¬çš„é£Ÿç‰©å‡†å¤‡å¥½äº†ğŸ˜‹ã€‚æˆ‘çš„æ„æ€æ˜¯è¿™ä¸ªé¡¹ç›®å·²ç»å¯ä»¥æµ‹è¯•äº†ã€‚ç‚¹å‡»â€œè¿è¡Œâ€æŒ‰é’®ï¼Œäº«å—ç¾é£Ÿã€‚

# **ç»“è®º:**

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä½¿ç”¨ CALayer åˆ›å»ºåœ†å½¢ã€å¾„å‘æ¸å˜å’Œå›¾å±‚è’™ç‰ˆã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ CGAffineTransform å°†è§†å›¾ä»ä¸€ä¸ªä½ç½®è½¬æ¢åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚

å®Œæ•´çš„é¡¹ç›®å¯ä»¥åœ¨ä¸‹é¢çš„ Github repo ä¸­æ‰¾åˆ°ã€‚

[](https://github.com/DharmeshRathod712/3DGlobeAnimation.git) [## dharmeshrathod 712/3d globe animation

### è‹¹æœå…è®¸ä½ ä½¿ç”¨ CALayer åˆ›å»ºä¸åŒçš„å½¢çŠ¶ã€æ¸å˜å’Œé®ç½©æ•ˆæœã€‚è¿™ä¸ªé¡¹ç›®è¯•å›¾åˆ©ç”¨â€¦

github.com](https://github.com/DharmeshRathod712/3DGlobeAnimation.git) 

äº«å—â€¦ğŸ™ŒğŸ»å¿«ä¹ç¼–ç â€¦ ğŸ¥³