<html>
<head>
<title>Configure Web Server Docker Container on EC2 Instance using Ansible (Dynamic Inventory )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Ansible(动态清单)在 EC2 实例上配置 Web 服务器 Docker 容器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/configure-web-server-docker-container-on-ec2-instance-using-ansible-dynamic-inventory-82b659bed494?source=collection_archive---------3-----------------------#2022-04-13">https://blog.devgenius.io/configure-web-server-docker-container-on-ec2-instance-using-ansible-dynamic-inventory-82b659bed494?source=collection_archive---------3-----------------------#2022-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/5d395d5ffb8252da9938cf1de74eb994.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*RWqBqhalg7Yb4wmgZpTGcA.png"/></div></figure><h1 id="2564" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">供应 AWS EC2 实例，并使用 Ansible Playbook 和动态清单在 Docker 容器中配置 HTTPD 服务器。</h1><p id="a333" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="b5d4" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated"><strong class="ak"> ✅涵盖的话题有:- </strong></h2><ol class=""><li id="8c13" class="lz ma in kr b ks kt kw kx la mb le mc li md lm me mf mg mh bi translated">使用 Ansible 预配 AWS EC2 实例。</li><li id="6787" class="lz ma in kr b ks mi kw mj la mk le ml li mm lm me mf mg mh bi translated">使用动态清单检索实例的 IP 地址以进行进一步配置。</li><li id="6e20" class="lz ma in kr b ks mi kw mj la mk le ml li mm lm me mf mg mh bi translated">通过配置存储库安装 Docker。</li><li id="5d03" class="lz ma in kr b ks mi kw mj la mk le ml li mm lm me mf mg mh bi translated">使用 Ansible 拉出并启动 web 服务器容器。</li></ol><p id="46d1" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="4766" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹在直接跳到 Ansible-Playbook 之前，我们先来了解一下 Ansible &amp;到底有什么用，它到底是怎么工作的！！</strong></p><p id="159b" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="0264" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated"><strong class="ak">🔰什么是 Ansible？</strong></h2><p id="500f" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">假设您必须配置 10 个不同的操作系统，它们的功能与其他操作系统略有不同。因此，如果你的任务是在这些系统上配置一个 HTTPD 软件&amp;你不知道要安装什么命令，例如(Red hat Linux 使用 Yum 进行安装，而 Ubuntu 使用 apt-get &amp;等等)。这可能是学习和安装的正确方法，但不是有效的方法，因为在 DevOps 的世界里，每件事都需要尽可能自动化。</p><p id="41ce" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">因此，最好的和成熟的工具来了，叫做<strong class="kr io"> Ansible </strong>，它根据命令&amp;模块来配置每一件事情，我们将进一步看到。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/78a2160f4fa354ee5ffb6ff4dabb2bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*qfpmUVTYpMVXDslFlrwDdg.png"/></div></figure><p id="ed70" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">Ansible 是一个非常简单的 IT 自动化引擎，它自动化了<a class="ae mx" href="https://www.ansible.com/provisioning?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">云供应</a>、<a class="ae mx" href="https://www.ansible.com/configuration-management?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">配置管理</a>、<a class="ae mx" href="https://www.ansible.com/application-deployment?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">应用部署</a>、<a class="ae mx" href="https://www.ansible.com/orchestration?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">内部服务编排</a>以及许多其他 IT 需求。</p><p id="858f" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">Ansible 从第一天起就为多层部署而设计，它通过描述所有系统之间的相互关系来模拟您的 IT 基础设施，而不仅仅是一次管理一个系统。</p><p id="953d" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">它不使用代理和额外的定制安全基础设施，因此易于部署，最重要的是，它使用非常简单的语言(YAML，以可翻译剧本的形式)，允许您以接近简单英语的方式描述您的自动化作业。</p><p id="0a37" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="7a9b" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹既然我们已经很好地了解了 Ansible 是什么，现在让我们来看看这个工具的工作基础设施！！</strong></p><p id="a502" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="ce67" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated"><strong class="ak">🔰Ansible 如何工作:</strong></h2><p id="7c0f" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹因为这个工具是用于配置管理的，所以它将管理操作系统，但是它将如何验证要配置的系统呢？</p><p id="e87c" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹这里第一个库存的概念开始发挥作用，库存只不过是一个普通的文件。txt 或者。yaml/。yml 作为扩展取决于您的使用。参考下图以供参考</p><p id="04d5" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹Ansible 清单文件位置:/etc/ansible/hosts 或者您可以在任何目录中创建，然后在配置文件中指定位置(。cfg)。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/096f85900d30525ef5e465ae948ef6b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7xzw-kktGLe3gZ16BmMVw.jpeg"/></div></div></figure><p id="2fa9" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹在这里，主机只是要配置的系统的 IP 地址。CSR -1、2、3 是主机的名称，<strong class="kr io"> ansible_host= &lt; IP 地址&gt; </strong>是写入 IP 地址时必须遵循的语法。除了 IP 地址，3 个同样重要的关键字是<strong class="kr io"> (ansible_connection) </strong>，它指定了您将使用哪个协议连接到系统&amp;还有<strong class="kr io"> (ansible_ssh_pass) </strong>，它指定了系统的密码&amp;<strong class="kr io">(ansible _ user)</strong>表示 ansi ble 将使用哪个用户 id 与服务器通信。因此，将这些参数组合在一起后，这就是库存的样子。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nd"><img src="../Images/db15e8c349f2e167a3de6afb0f8c91ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqpjVAM1HzkCZPvXfTtIyg.jpeg"/></div></div></figure><p id="7b8a" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹最后，如果您想在一个行动手册中一起配置所有系统，而不是分别为每个系统配置。我们通过在[方括号]内的 IP 组顶部添加一个组名来创建 IP 组，因此在这种情况下，CSR-1、2、3 将位于[CSR-路由器]下，而[交换机]只有一个 IP 地址。</p><p id="c416" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹以上盘点在。txt 格式&amp;如果你想写的话。yaml 格式，这就是它的样子！！</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ne"><img src="../Images/5ed72eeba89a4b5fce180a82dd41c307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Rnd7FHje10K55F0UKPM0Q.jpeg"/></div></div></figure><p id="0446" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="5f9e" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰<strong class="ak">最后，您将如何使用剧本中的这些 IP 地址？</strong></h2><p id="4b6b" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="7d43" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹为此，这里有一个使用 Ping 测试/模块检查连通性的 Ansible 行动手册的简单示例。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/7c69926c10d245dc58e96de54205fe7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-ZqoyF2EdYwLohTqKzXsQ.png"/></div></div></figure><p id="2379" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹这是<strong class="kr io"> yaml </strong>语法，其中前三个模块 hosts =指定 IP 组，然后 name=不是必需的，但作为一种良好的做法，只是为了说明我们为什么要运行本行动手册或特定任务。最后，任务=根据需求执行哪些任务。</p><p id="9ecd" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="b179" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰注意:</h1><p id="8d15" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹对于 Ansible 来说，几乎每个 YAML 文件都是以列表开始的。列表中的每一项都是一个键/值对列表，通常称为<strong class="kr io">“哈希”或“字典”</strong>。所以，我们需要知道如何在 YAML 写列表和字典。</p><p id="826b" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹YAML 还有一个小怪癖。所有 YAML 文件(不管它们是否与 Ansible 关联)都可以选择以<code class="fe ng nh ni nj b">---</code>开始，以<code class="fe ng nh ni nj b">...</code>结束。这是 YAML 格式的一部分，表示文档的开始和结束。</p><p id="5336" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹列表的所有成员都是从相同缩进层次开始的行，以<code class="fe ng nh ni nj b">"- "</code>(一个破折号和一个空格)开始:</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/16d8ec42fe02d8eb12a8d785efc5ea01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gCZhykNS3RsV6jfsdJwCA.png"/></div></div></figure><p id="7b28" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹字典以简单的<code class="fe ng nh ni nj b">key: value</code>形式表示(冒号后面必须跟一个空格):</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/4d186e2a743b939dfd447506cac220a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aZ0WkyQo7yAmGCa7NCZ6g.png"/></div></div></figure><p id="b732" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹更复杂的数据结构是可能的，例如字典列表、其值是列表的字典或者两者的混合:</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/b81f01dc69be7a04c9c8c3cfc3cddbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RY0JUzpJpKSmf8dd_tIrfA.png"/></div></div></figure><p id="4802" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="0842" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔹配置“ansible.cfg”文件:</h2><p id="9d43" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">现在我们需要配置我们的 Ansible 配置文件。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/2875b10609a8695c0918274d39938d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGDeYVi26a4p6OT2T6arsw.png"/></div></div></figure><p id="20fc" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="d01b" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰<strong class="ak">主机 _ 钥匙 _ 检查:</strong></h2><p id="11e6" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹Ansible 默认启用主机密钥检查。检查主机密钥<strong class="kr io">可以防止服务器欺骗和中间人攻击</strong>，但是它确实需要一些维护。如果主机被重新安装，并且在“known_hosts”中具有不同的密钥，这将导致一条错误消息，直到得到纠正。</p><p id="8664" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹默认情况下，主机密钥检查是打开的。如果您愿意，可以通过在/etc/ansible/ansible 的[default]部分添加 host_key_checking=False 来禁用它。 <strong class="kr io"> cfg 或~/ansible。</strong> <strong class="kr io"> cfg 或通过导出 ansi ble _ HOST _ KEY _ CHECKING = False</strong>。</p><p id="1ff1" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="26a4" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰远程用户:</h2><p id="699c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹正如我们在。txt inventory 部分，我们提到 ansible_user 来指定 ansible 将通过哪个用户访问。</p><p id="c695" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹remote_user 是登录到机器的账户<strong class="kr io">(ssh vagger @ tmp _ ansi ble _ test _ VM 将把 vagger 作为远程用户)。<strong class="kr io">如果该用户要以 root 或其他用户身份执行任务，则应具有 sudo 权限(即，添加到 Red Hat Linux 上的 sudoers 文件或 CentOS 上的 wheel 组等)。</strong></strong></p><p id="252f" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="3dfa" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰提问 _ 通过:</h2><p id="d160" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹Ask_pass 是可翻译剧本中的<strong class="kr io">控制模块。这控制了剧本执行时的密码提示。默认情况下，它总是设置为 True。如果您使用 SSH 密钥进行身份验证，那么您根本不需要更改这个设置。但是不要每次都干涉，因为我们会在操作系统之前验证每一件事，然后我们会将它设置为 False。</strong></p><p id="cabb" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="acfa" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰私有密钥文件:</h2><p id="6d3d" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹当您必须使用 ssh 协议连接到本地系统时，情况并非如此，但是当访问这些在线实例时，我们使用私钥来代替密码，并指定私钥的位置。pem)放在配置文件中。</p><h2 id="e0f0" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰注意:<strong class="ak">确保您的工作区中有“pem”格式的 AWS 密钥对。&amp;您可以在此部分创建私钥</strong></h2><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b03afc82635723c8c9fcfd92218a9a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*B3DnVGxbbfVbpef_H-huiA.png"/></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9e05f1885cef6774811652d988144c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ncDb7hDNRIQJkq_9uixGww.png"/></div></figure><p id="2c71" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="2e08" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰最后一个同样重要的部分是[特权升级]:</h2><p id="3ed0" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹Ansible 允许您“成为”另一个用户，不同于登录到机器的用户(远程用户)。这是通过使用现有的特权提升工具完成的，您可能已经使用或配置了这些工具，如 sudo、su、pfexec、doas、pbrun、dzdo、ksu 等。</p><p id="6758" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="b291" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">[特权 _ 升级] <br/>成为=真<br/>成为 _ 方法= sudo <br/>成为 _ 用户= root <br/>成为 _ 询问 _ 通过=假</h2><p id="e69c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="ef0d" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹所以在这里，<strong class="kr io">变得=真</strong>表示是，<strong class="kr io">变得方法= sudo </strong>表示我们希望将 sudo(管理)权限授予我们将使用的用户，<strong class="kr io">变得 _ 用户= root </strong>表示使用 sudo 方法的用户的管理权限将由 root 帐户授予，最后<strong class="kr io">变得 _ask_pass = false </strong>表示我们不希望通过询问密码来干扰正在运行的剧本，因为我们是经过身份验证的用户。</p><p id="2900" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="b065" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">🔰现在，有了这些知识就足以开始编写一个剧本来供应 AWS EC2 实例，并使用 Ansible 剧本和动态库存在 Docker 容器中配置 HTTPD 服务器。</h2><p id="fe1e" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="1f96" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹剧本是<strong class="kr io">编写可译代码的文件</strong>。剧本是用 YAML 格式写的。YAML 代表另一种标记语言。剧本是 Ansible 的核心特性之一，它告诉 Ansible 应该执行什么。它们就像 Ansible 的一个包含任务列表的待办事项列表。</p><p id="b045" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="2461" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰设置 EC2 实例:</h1><p id="94ef" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹AWS 是一个全球知名的云计算平台，提供多种服务。在这些服务中，我们将使用亚马逊弹性计算云(Amazon EC2 ),它提供了最广泛、最深入的计算平台，拥有超过 500 个实例和最新处理器、存储、网络、操作系统和购买模式的选择，可帮助您最好地满足工作负载的需求。我们是第一家支持英特尔、AMD 和 Arm 处理器的主要云提供商，也是唯一拥有按需 EC2 Mac 实例的云，以及唯一拥有 400 Gbps 以太网网络的云。我们为机器学习培训提供最佳性价比，以及云中每推理实例的最低成本。在 AWS 上运行的 SAP、高性能计算(HPC)、ML 和 Windows 工作负载比任何其他云都多。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ba479d05ed888a1d871a47622d2ab89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*nk2cAE1QsXU_7meLJR9RuA.gif"/></div></figure><p id="ec26" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="0566" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">✅安装 Boto3 Python 库:</h2><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/eb817881e6c42adb57c75578faeca2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ln07GJmw9l3CB2cCx86ojw.png"/></div></div></figure><p id="58a0" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹这里介绍两个新模块:</p><h1 id="aa9d" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰<strong class="ak">变量 _ 文件:</strong></h1><p id="aad4" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹<em class="nn"> vars_file </em>指令只能在定义一个指定变量文件时使用。这些文件中的变量包含在行动手册中。由于<strong class="kr io">用于播放</strong>的开始，这很可能意味着其他播放(在此播放之前)创建了这些 vars 文件，或者它们是在运行配置之前静态创建的；意味着它们是这出戏的配置变量。</p><p id="c472" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹<strong class="kr io">如果这些文件与剧本在同一个目录中，则可以直接提及，或者通过指定 var 文件所在的完整路径来提及。</strong></p><p id="73d0" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="ce05" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰pip:</h1><p id="02e3" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹该模块是<code class="fe ng nh ni nj b">ansible-core</code>的一部分，包含在所有 Ansible 安装中。在大多数情况下，即使没有指定<code class="fe ng nh ni nj b">collections:</code>关键字，也可以使用短模块名<code class="fe ng nh ni nj b">pip</code>。但是，我们建议您使用 FQCN 来轻松链接到模块文档，并避免与可能具有相同模块名称的其他集合冲突。</p><p id="9ba3" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹这里，pip 模块的名称在 vars.yml 文件中提到。如果你想使用 yml 文件中的变量，你必须使用<strong class="kr io"> "{{ &lt;变量&gt; }}" </strong>语法&amp; state = present 表示我们希望模块已经安装，这也意味着已经存在于远程系统中。</p><p id="681b" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="6fb7" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">✅创建安全组:</h2><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi no"><img src="../Images/6138f3da93bcb9e1722f11a70840d94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRJdYjnaz-k1K4XXfe5e2w.png"/></div></div></figure><p id="0076" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹因为我们正在创建一个定制的操作系统。因此，我们还需要创建一个安全组，就像阻止操作系统上各种攻击/活动的防火墙。</p><p id="fcf0" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="813b" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">✅在此使用 ec2_group 模块，该模块具有以下参数:</h2><p id="e083" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="3ebd" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰名称:</h1><p id="60f7" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹这个名字和我们平时在 Playbook 开头用的不一样。这里在 SG 模块中使用的名称是您提供给安全组的名称，并且将在供应 E2 实例时进一步使用。</p><h1 id="3369" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰描述:</h1><p id="077e" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹这只是为了给安全组一个有意义的身份。</p><h1 id="05ce" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰地区:</h1><p id="426a" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹这些是数据中心所在的 AWS 上可用的区域&amp;我们的操作系统以及其他设置将被调配。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b94527ef3503e26ed5b63a3a9e6a56b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*_hqe08E9_zjpsrwmWxGp5g.png"/></div></figure><h1 id="9cc3" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰aws_access &amp; aws_secret 密钥:</h1><p id="04e6" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹如果您仔细注意，在开始时，我们看到我们创建了一个清单，其中存储了 IP 地址以及连接类型和用户、密码。但是，我们并没有从拥有组/主机 IP 名称开始我们的行动手册。</p><p id="e675" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹这是因为要连接到 AWS 云服务，我们需要在本地主机上安装 boto3 库，我们按照指定使用了 local host。但是 AWS 云在互联网上，ansible 如何连接到 AWS 云？</p><h1 id="0e94" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰这里，API 开始发挥作用:</h1><p id="f358" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">🔹API 是应用程序编程接口的首字母缩写，它是一个软件中介，允许两个应用程序相互通信。每次你使用脸书这样的应用程序，发送即时消息，或者在手机上查看天气，你都在使用 API。</p><p id="da1a" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹<strong class="kr io">API 的一个例子是什么？</strong></p><p id="7c44" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">当您使用手机上的应用程序时，该应用程序会连接到互联网并将数据发送到服务器。然后，服务器检索这些数据，对其进行解释，执行必要的操作，并将其发送回您的手机。然后，应用程序解释这些数据，并以可读的方式向您提供您想要的信息。这就是 API——所有这些都是通过 API 实现的。</p><p id="d383" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔹因此，我们有了一个连接 AWS 的方法，但是在连接之后，ansible 如何知道要为安全组配置哪个用户 ID，因为有数百万的 AWS 用户？</p><h1 id="410e" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰这里需要 aws_access &amp; aws_secret 密钥，但是如何创建它呢？</h1><p id="5615" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹转到搜索栏，键入 IAM 并点击角色</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nq"><img src="../Images/70415758ea83fb2d11ff9134c6cee917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNGndjarEP3ll8_g2RKYZg.png"/></div></div></figure><p id="7977" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹最初没有添加用户，所以单击右上角的添加用户。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nr"><img src="../Images/662c2751cf0cb0848b0aeb049dd58007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XwtJ28ga4IRwq22h90ZjKA.png"/></div></div></figure><p id="e51e" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹根据我们在 ec2 模块中的要求，提供用户名和访问密钥。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ns"><img src="../Images/60e6b96164d7134358f2164216dc5b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SF-r-h6wbmIN9vBfXkKErA.png"/></div></div></figure><p id="26a8" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹现在给出您想要给用户的策略(访问)。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nt"><img src="../Images/8f732c071494368883292fceaa26e8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Fbkmu11QuPh3dtobTQxwg.png"/></div></div></figure><p id="a826" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹此页面是可选的，对于配置安全组和启动 EC2 实例来说并不太需要，因此单击 Next: Review。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nr"><img src="../Images/b04a72d9f34491baf16fd09ec4e81a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3glBB8O_2-iR8FY2LGqk6g.png"/></div></div></figure><p id="86c4" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹这是创建用户的最后一步。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nr"><img src="../Images/46e010b85ae32d06cf8afa3fb0caff98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXlP1NS0rI3kUrzaFRKQUg.png"/></div></div></figure><p id="6d1e" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹我们已经成功地创建了访问密钥和秘密密钥。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nu"><img src="../Images/9e3b62058aebd4e71019797b1c808c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccGQUI-PmTfvBABTgwzFRA.png"/></div></div></figure><p id="dbc1" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹在这里，您可以看到用户被添加到列表中。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nv"><img src="../Images/c8abd744b63fbf94cc2715183415f6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XyDrEyAHy59FAQ1BUfGyPg.png"/></div></div></figure><p id="9624" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h2 id="06fd" class="ln js in bd jt lo lp dn jx lq lr dp kb la ls lt kf le lu lv kj li lw lx kn ly bi translated">✅注意:正如你在倒数第二张图中看到的，秘密访问密钥是隐藏的，这表明这个密钥是多么重要，它可以多么容易地被用来访问 AWS 资源。因此，将该文件存储在普通变量文件中并不是一个好的做法。所以在这里，拱顶扮演着重要的角色。</h2><p id="ec98" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="d1e2" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰要创建 Vault 文件，请执行以下操作:</h1><p id="0def" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">语法:</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi no"><img src="../Images/d85d8b17c9649e15ec113dae01dfc2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sbqP5NV89JPywCAPugKhA.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/7671092866c6e477b5966621cfc07740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24BafhY6dcGMjr3O2SnqXg.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/b94f763df6484da544d70b6012b8da3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VU6U-tILtvex7ozeAp1SA.png"/></div></div></figure><p id="3828" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹要在剧本中使用这个文件，只需在剧本的开头指定 var 文件。</strong></p><p id="11e1" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="3696" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰<strong class="ak"> </strong>故回奏本:</h1><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi no"><img src="../Images/6138f3da93bcb9e1722f11a70840d94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRJdYjnaz-k1K4XXfe5e2w.png"/></div></div></figure><p id="da62" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹</strong>最后要使用的部分是规则，这意味着您希望允许哪些防火墙端口进行访问。这里我们有两个规则，第一个规则指定协议是 TCP，from-to 端口是指所有流量的端口号范围，从 0 到 65535。<strong class="kr io">但是这里我们将它保持为 22，因为 ssh 协议要求相同，并允许端口 80 上的所有流量，因为我们将部署一个每个人都可以访问的网页。</strong></p><p id="c022" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹</strong> Rules_egress 表示如果没有提供，则采用默认的全输出规则。如果提供了空列表，将不会启用任何出站规则。版本 2.4 中添加了规则出口源列表支持。在 2.5 版本中，增加了对规则描述的支持。</p><p id="3d58" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹最后一个<strong class="kr io">vars:ansible _ python _ interpreter:/bin/python 3</strong>是可选的，因为它只是指定 ansi ble 应该使用哪个 python 解释器，但如果您的操作系统有不同版本的 python，这是强制性的，因此您应该指定使用哪个以避免错误。</strong></p><p id="1547" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="32da" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰预配 EC2 实例:</h1><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/a00e0b1bb8224b39e963f6f5dcbee746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ow8Ke5FVU8JAeG1pNyHY0Q.png"/></div></div></figure><p id="e101" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹因为我们有 ec2_group 来创建安全组，所以类似地，我们有 ec2_instance 来启动 AWS EC2 服务上的新实例。让我们看看它需要的参数。这里我们只讨论那些我们不熟悉的参数。</strong></p><p id="986f" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="8149" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰图像 ID:</h1><p id="7ec4" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹转到 EC2 服务&amp;根据要求选择映像的 ID，因此单击启动实例。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ny"><img src="../Images/8c0441ff34f06263fb4a8c6e32ca903d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVp2bpl85LnmBcHU7UEjqQ.png"/></div></div></figure><p id="89d3" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹选择操作系统映像的映像 ID</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/40b6b744f9e78c5a61d21457303057d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*miDplYGQfbgluUzUG7QIkA.png"/></div></div></figure><p id="1fdf" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="0c18" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰实例类型:</h1><p id="4efe" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹实例类型是指资源，即(RAM &amp; CPU ),我们将与这个实例&amp;一起使用，随后根据使用情况收费。但是有一个名为 t2.micro 的符合自由层条件的类型，对于我们的使用情形来说已经足够了，因此我们将使用这个。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/8a65af5ee52c45621fb55b3b98c5d7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFTpvFB6Zhk-3slOPqpOPg.png"/></div></div></figure><p id="901c" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="aa40" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰VPC 子网 ID:</h1><p id="421b" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹</strong>启动实例的子网 ID(VPC)如果没有提供，则<a class="ae mx" href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/ec2_instance_module.html" rel="noopener ugc nofollow" target="_blank"> amazon.aws.ec2 实例</a>将选择默认 VPC 的默认区域。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nz"><img src="../Images/251fb7a4dfa4cdeea059b13eea5f5d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YpOeM6GSokA4dk7c2OuxHA.png"/></div></div></figure><p id="d597" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="5716" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰私钥:</h1><p id="494e" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹</strong>这与我们在开始时看到的如何创建的私钥相同，只需指定密钥对的名称。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9e05f1885cef6774811652d988144c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ncDb7hDNRIQJkq_9uixGww.png"/></div></figure><p id="0981" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="f8c5" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹该名称就是您希望为实例指定的名称，启动状态意味着 EC2 实例在启动后应该成功运行，并等待 EC2 状态检查报告 OK，如果 wait= yes(true)意味着等待操作系统完全启动。最后，我们使用注册模块，该模块存储 Ansible 在启动实例时收集的所有信息，包括 IP 地址、MAC 地址、DNS 服务器名称等，我们将使用这些信息检索 IP 以使用动态清单。</strong></p><p id="6703" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="43c1" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰现在是进行动态清点的时候了，我们将通过检索最近启动的实例的 IP 地址来连接到该实例:</h1><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/15bc0587ffedc88344dd238603879447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEIh0648e4hjpValqnx-vg.png"/></div></div></figure><p id="e5aa" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹add_host —将主机(或者组)添加到 ansible-playbook 内存清单中。</strong>根据记忆，这意味着组名只会保留到剧本运行时。您可以将此称为[ &lt;组名&gt; ]，这是我们在库存概念开始时看到的。</p><p id="cb8d" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹此外，在“{{ }}”内的循环模块中指定的 ec2.instances 不是来自 vars(变量文件)</strong>。如上所述，注册模块存储 Ansible 在启动实例时收集的所有信息，包括 IP 地址、MAC 地址、DNS 服务器名称等。这就是它在内部存储的方式，我们必须从这个信息中检索 IP，这个信息被称为<strong class="kr io"> <em class="nn">可回答的事实</em>。</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi oa"><img src="../Images/6fd4cac5fa208079b53f219c09c0e236.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*Lq9nj_ranVWuZDPAQj4s3w.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/296d6107b0e0a14f06f91927a66c5c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dj7oWxig1AvJCmNNbyPyUA.png"/></div></div></figure><p id="a0b1" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹因此，从这些事实中检索 IP 的语法是</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/15bc0587ffedc88344dd238603879447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEIh0648e4hjpValqnx-vg.png"/></div></div></figure><p id="382f" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹对于 wait_for 模块，我们也是这样做的，我们等待 SSH 协议启动，否则 Ansible 将无法与 EC2 实例建立连接。</strong></p><p id="13bf" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹这里更重要的一点是，当你在循环中使用任何变量时(如果我们有多个实例和</strong> <strong class="kr io">的话，这将获取启动的 IP 地址实例，然后将它们的公共 IP 放在一个名为“hostname”的变量中)，在这种情况下是 ec2.instances，对于其余的游戏/任务，该变量被视为 item，因此 item.public_ip_address 是 noting，但 ec2 . Instances . public _ IP _ address 和 public_dns_name 是相同的。</strong></p><p id="ec00" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="378e" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰现在，与 EC2 的连接将会成功建立，因此现在是时候进入我们的最后一步，即安装和配置 Docker:</h1><p id="773e" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><strong class="kr io">🔹让我们首先设置 Yum 存储库:</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/49ea3a65706b14c45690e8e47c3e27a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELT1D5gK5L67KTfxu-JbJA.png"/></div></div></figure><p id="4fa4" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹该主机现在已更改为由 add_host 模块创建的主机组。</strong></p><p id="a335" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹get_url 将下载预先创建的存储库，dest:将从 url 下载的 repo 存储在指定的位置，即/etc/yum.repos.d </strong></p><p id="8d99" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹第二个被替换的模块是我特意使用的，以防我们下载的库可能已经过时，或者可能无法在我们的实例中安装 Docker，因此我们使用替换模块来指定要被替换的文件的路径。然后是 regexp:“rhel”是将被替换为“centos”的字符串。</strong></p><p id="be66" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="8d7c" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated">🔰安装 Docker 就像我们详细讨论的 Docker &amp; Container 一样简单，你可以通过<a class="ae mx" href="https://www.linkedin.com/posts/swaroop--shinde_vimaldaga-righteducation-educationredefine-activity-6862244416606801920-8x-r?utm_source=linkedin_share&amp;utm_medium=member_desktop_web" rel="noopener ugc nofollow" target="_blank"> <strong class="kr io">点击这里</strong> </a>来检查，因为所有的任务都与我们在命令行中使用的命令完全相同。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/3d990e01537c6706f8b0fa60857dd5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jIoVOuTsmsEZF1KRj6wiZQ.png"/></div></div></figure><p id="9815" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹这里唯一重要的一点是，在最后一个任务中，我们从 httpd 映像启动名为 webserver 的容器映像，状态是 started，因为我们希望在启动容器后立即启动网页服务，并且在命令行中指定为-p 的端口是“8080:80”，这意味着本地主机的 8080 端口号将被重定向到容器的 80 端口，这是 httpd 服务的默认值。</strong></p><p id="829e" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="58aa" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰现在，使用以下命令运行剧本</h1><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ob"><img src="../Images/a5bef3f34924de74be8f8a0b7647a48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDkjH0jHoQPdX_5aSUMeEw.png"/></div></div></figure><p id="7fa9" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹ask-vault-pass 将询问您存储凭证的 access_key 和 private_key 文件的密码！</strong></p><p id="06d0" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="3527" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰这是没有任何错误的输出。</h1><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/66ebebb2d3dbdd9fd4ff49b127b1238e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQ-BqbaQsoEt_tk0Kpngyw.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/0eecfae06792db8b5d664ce57d618c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYbFfi9ZDGTsw0DnjQqOkA.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/2dc5596229027f1c9d32a9b740621c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n60Vtw5G8dejeTX3-VRUHQ.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/a49fa9252e44160a67d57a2b49dc285b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84tqwVl8LYABl0tRAJZc-g.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/d92a586521ebc4fc5f0de9952d1c97fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_jaPBhI2e9oHiTWpErW_w.png"/></div></div></figure><p id="8cef" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹剧本已经成功执行，如你所见，我们已经获得了新启动的 EC2 实例的 IP 地址，现在让我们看看网页是否工作</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/1f4e657d296fe4cd5fe9cc50088c41b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*doBfzSeoFiilh4mkrxA15g.png"/></div></div></figure><p id="8e72" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹正如您在 8080 端口上看到的那样，web 服务器已经启动了！！</strong></p><p id="f002" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi translated"><strong class="kr io">🔹此外，如果我们看一下 AWS 控制台，您可以看到实例运行良好！！</strong></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi oc"><img src="../Images/ec6374f2aec43c216bd9e36a0fc573e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEGfWtSjVLC7bOxI_0UMng.png"/></div></div></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi od"><img src="../Images/390cfb27b3c05a386fe83372ab13a469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYbLPwDD2RPzCI30WdHVSA.png"/></div></div></figure><p id="f3e9" class="pw-post-body-paragraph kp kq in kr b ks mn ku kv kw mo ky kz la mp lc ld le mq lg lh li mr lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="f7e9" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">🔰从这篇博客中，我们学习了如何使用 ansi ble Playbook &amp; Dynamic Inventory 配置 AWS EC2 实例以及在 Docker 容器中配置 HTTPD 服务器。</h1><p id="f60c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p></div></div>    
</body>
</html>