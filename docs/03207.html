<html>
<head>
<title>Understanding Magento 2 Module-Based Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解 Magento 2 基于模块的架构</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/understanding-magento-2-module-based-architecture-f0dac539c367?source=collection_archive---------6-----------------------#2020-10-12">https://blog.devgenius.io/understanding-magento-2-module-based-architecture-f0dac539c367?source=collection_archive---------6-----------------------#2020-10-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/de5a966baba00db68c4206ddc2972c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAewNEIXS4NbR8-ps2ltGw.png"/></div></div></figure><p id="5a5f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">先说什么是模块，模块怎么工作，怎么注册。</p><h1 id="2d87" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模块概述</h1><p id="44b9" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">Magento 2 文档解释了关于模块的以下内容:</p><blockquote class="lw lx ly"><p id="eb27" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">模块是一个逻辑组，即包含块、控制器、助手、模型的目录，它们与特定的业务特性相关。为了与 Magento 对最佳模块化的承诺保持一致，一个模块封装了一个特性，对其他模块的依赖性最小。— <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/architecture/archi_perspectives/components/modules/mod_intro.html" rel="noopener ugc nofollow" target="_blank"> Magento DevDocs —模块概述</a></p><p id="3fa5" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">模块和主题是 Magento 中的定制单元。模块提供支持逻辑的业务特性，而主题强烈影响用户体验和店面外观。这两个组件都有一个生命周期，允许安装、删除和禁用它们。从商家和扩展开发者的角度来看，模块是 Magento 组织的中心单元。— <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/architecture/archi_perspectives/components/modules/mod_intro.html" rel="noopener ugc nofollow" target="_blank"> Magento DevDocs —模块概述</a></p><p id="7c71" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">Magento 框架提供了一组核心逻辑:PHP 代码、库以及由模块和其他组件继承的基本功能。— <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/architecture/archi_perspectives/components/modules/mod_intro.html" rel="noopener ugc nofollow" target="_blank"> Magento DevDocs —模块概述</a></p></blockquote><p id="daf4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">简而言之:模块是一个逻辑组(文件夹),它包含了特定特性的业务逻辑。一个模块可以安装在两个地方。</p><ol class=""><li id="51b9" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks mj mk ml mm bi translated">在 vendor(安装 composer 时):<em class="lz">vendor/[vendor]/[type]/[type]-[module-name]/[module-name]</em>。</li><li id="fbee" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated">在应用程序中/(无编写器):</li></ol><ul class=""><li id="9212" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks ms mk ml mm bi translated">as 模块:<em class="lz"> app/code/【供应商名称】/【模块名称】</em></li><li id="887e" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">as 主题:<em class="lz"> app/design/【类型】/【供应商名称】/【主题名称】</em></li><li id="c90c" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">as 语言包:<em class="lz"> app/i18n/en_EN.csv </em></li></ul><p id="2cfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们谈论“类型”时，我们谈论的是一个模块、主题(管理或前端主题)或语言包。</p><p id="1564" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果一个模块包含一个只与特定项目相关的特定定制，我们可以把它放在<em class="lz"> app/code/【厂商】/【类型】-【模块名】</em>。</p><p id="1f15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常，首先在 app/中开发我们的模块，当第一个“稳定”版本准备好时，将它转移到供应商中。</p><h1 id="a9ac" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模块注册</h1><p id="fd7d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">Magento 组件，包括模块、主题和语言包，必须通过 Magento ComponentRegistrar 类在 Magento 系统中注册。— <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/extension-dev-guide/build/component-registration.html" rel="noopener ugc nofollow" target="_blank"> Magento DevDocs —注册您的组件</a></p><p id="ebdd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们构建一个模块时，它必须被注册才能被 Magento 识别。这是通过 registration.php 的<em class="lz">中的 Magento <a class="ae md" href="https://github.com/magento/magento2/blob/2.4-develop/lib/internal/Magento/Framework/Component/ComponentRegistrar.php" rel="noopener ugc nofollow" target="_blank"> ComponentRegistrar 类</a>来完成的。您可以在模块的根目录下创建它。</em></p><p id="4162" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注册模块:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="de22" class="nc ku in my b gy nd ne l nf ng">&lt;?php<br/>use \Magento\Framework\Component\ComponentRegistrar;<br/>ComponentRegistrar::register(ComponentRegistrar::MODULE, '[Vendor_ModuleName]', __DIR__);</span></pre><p id="78a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注册语言包:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="d253" class="nc ku in my b gy nd ne l nf ng">&lt;?php<br/>use \Magento\Framework\Component\ComponentRegistrar;<br/>ComponentRegistrar::register(ComponentRegistrar::LANGUAGE, '[Vendor_PackageName], __DIR__);</span></pre><p id="e129" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注册一个前端或管理主题，其中<em class="lz">【区域】</em>为前端或 adminhtml:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="b45e" class="nc ku in my b gy nd ne l nf ng">&lt;?php<br/>use \Magento\Framework\Component\ComponentRegistrar;<br/>ComponentRegistrar::register(ComponentRegistrar::THEME, '[area]/[vendor]/[theme-name], __DIR__);</span></pre><p id="c729" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们必须在/composer.json(模块的根目录)中自动加载我们的 registration.php。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="1956" class="nc ku in my b gy nd ne l nf ng">{<br/>    "name": [vendor]/[module-name]<br/>    "autoload" {<br/>        "psr-4": { "[Vendor]\\[ModuleName]\\": "" },<br/>        "files": ["registration.php"]<br/>    }<br/>}</span></pre><p id="472d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们创建了 registration.php 并将其添加到我们的 composer autoload 之后，我们需要创建一个<em class="lz"> /etc/module.xml </em>。它基本上告诉 Magento 它存在。</p><p id="65c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">序列节点描述了模块必须加载的顺序。当你使用插件、偏好或其他依赖项(如布局)时，这可能很有用。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="af04" class="nc ku in my b gy nd ne l nf ng">&lt;?xml version="1.0"?&gt;<br/>&lt;config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>        xsi:noNamespaceSchemaLocation="urn:magento:framework:Module/etc/module.xsd"&gt;<br/>    &lt;module name="YourCompany_YourModule" setup_version="1.0.0"&gt;<br/>        &lt;sequence&gt;<br/>            &lt;module name="TheirCompany_TheirModule" /&gt;<br/>            &lt;module name="AnotherCompany_AnotherModule" /&gt;<br/>        &lt;/sequence&gt;<br/>    &lt;/module&gt;<br/>&lt;/config&gt;</span></pre><h1 id="24d2" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模块交互</h1><p id="e0c6" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">Magento 2 中模块之间的交互方式是依赖注入、服务契约或数据服务契约。交互的一个重要方面是组件所在的范围。换句话说，一个 Magento 区域。</p><p id="2815" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用服务契约的一些好处是，这些契约确保了其他模块和第三方扩展可以实现定义良好的、持久的 API。此外，这些契约使得将服务配置为 web APIs 变得容易。</p><p id="61d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Magento docs: <a class="ae md" href="https://devdocs.magento.com/guides/v2.2/architecture/archi_perspectives/service_layer.html#service-contract-anatomy" rel="noopener ugc nofollow" target="_blank">服务合同剖析</a></p><h1 id="ec0b" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模块限制和副作用</h1><p id="a124" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">然而，当你在 Magento 2 中使用模块时，有一些限制应该被考虑。你应该使用依赖来表示一个模块依赖于另一个模块— <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/architecture/archi_perspectives/components/modules/mod_depend.html" rel="noopener ugc nofollow" target="_blank">模块依赖</a></p><ol class=""><li id="b523" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks mj mk ml mm bi translated">一个模块负责一个特性。</li><li id="96d7" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated">依赖于其他模块的模块必须使用 depends 在<em class="lz"> etc/modules.xml </em>中明确声明。</li><li id="594a" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated">当一个模块被安装或删除时，它不应该影响其他模块。</li></ol><p id="ded1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一些常见的错误有:</p><ul class=""><li id="7556" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks ms mk ml mm bi translated"><a class="ae md" href="https://laracasts.com/discuss/channels/laravel/reflectionexception-class-not-found-on-repository" rel="noopener ugc nofollow" target="_blank">缺少类反射异常</a></li><li id="1cd6" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated"><a class="ae md" href="https://stackoverflow.com/questions/31364289/error-class-does-not-exist" rel="noopener ugc nofollow" target="_blank">类缺失类不存在</a></li><li id="6283" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated"><a class="ae md" href="https://dev.to/dechamp/php---how-to-fix-class--not-found-error-1gp9" rel="noopener ugc nofollow" target="_blank"> PHP 警告:未捕获的错误:类丢失找不到类</a></li></ul><h1 id="91ee" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">Magento 地区</h1><p id="b0a5" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">Magento 区域仅加载与该区域相关的组件。当加载一个组件时，您只需要查看请求发生的区域。这确保了更优化的过程。此外，它确保一个组件不会影响不同的区域。</p><blockquote class="lw lx ly"><p id="3a80" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated"><em class="in">您可以启用或禁用模块内的某个区域。如果启用了这个模块，它会将一个区域的路由器注入到一般应用程序的路由过程中。如果此模块被禁用，Magento 将不会加载一个区域的路由器，因此，一个区域的资源和特定功能将不可用。— </em> <a class="ae md" href="https://devdocs.magento.com/guides/v2.4/architecture/archi_perspectives/components/modules/mod_and_areas.html" rel="noopener ugc nofollow" target="_blank"> <em class="in"> Magento DevDocs —模块和区域</em> </a></p></blockquote><h1 id="5399" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">Magento 区域类型</h1><ol class=""><li id="cb55" class="me mf in jx b jy lr kc ls kg nh kk ni ko nj ks mj mk ml mm bi translated"><strong class="jx io"> Adminhtml </strong> —你在管理面板中看到的任何代码</li><li id="579e" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><strong class="jx io">前端</strong> —店面(或前端)有你在前面看到的所有模板和布局文件。</li><li id="934e" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><strong class="jx io"> Base </strong> —这是没有 adminhtml 或前端区域时的回退。</li><li id="1b6b" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><strong class="jx io"> Crontab </strong> —位于 cron.php，加载了<em class="lz">\ Magento \ Framework \ App \ Cron</em>。</li><li id="a0e8" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><strong class="jx io"> webapi_rest </strong> —用于 REST APIs</li><li id="b564" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><strong class="jx io"> webapi_soap </strong> —用于 SOAP APIs</li></ol><p id="b205" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要了解区域是如何工作的，你可以找到代码<a class="ae md" href="https://github.com/magento/magento2/blob/2.0/lib/internal/Magento/Framework/App/Area.php" rel="noopener ugc nofollow" target="_blank">Magento/Framework/App/area . PHP</a></p></div></div>    
</body>
</html>