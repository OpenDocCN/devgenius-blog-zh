<html>
<head>
<title>ValueNotifier and ValueListenableBuilder in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter 中的 ValueNotifier 和 ValueListenableBuilder</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/flutter-valuenotifier-and-valuelistenablebuilder-41c700315786?source=collection_archive---------0-----------------------#2022-06-04">https://blog.devgenius.io/flutter-valuenotifier-and-valuelistenablebuilder-41c700315786?source=collection_archive---------0-----------------------#2022-06-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="de7c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">今天我们要<strong class="ak"> <em class="kc">使用 ValueNotifier 在不使用 setState 的情况下重建一个 widget。</em>T11】</strong></h2></div><blockquote class="kd ke kf"><p id="c686" class="kg kh ki kj b kk kl jo km kn ko jr kp kq kr ks kt ku kv kw kx ky kz la lb lc ig bi translated">颤振数值通知器完全指南</p></blockquote><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/f8a03bdc3d0ce1a4c1e7496332b73dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FOvUd2QFYSvfKf0URU_GRw.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lp"><img src="../Images/861a61d642882fff2c4cd26b46525f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*28quE3AV9Jjr1W5pvct_nQ.png"/></div></div></figure></div><div class="ab cl lq lr hr ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ig ih ii ij ik"><p id="6c2c" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">Flutter 是 2020 年最受欢迎的移动应用开发跨平台框架之一。Flutter 是 Google 的 UI 工具包，用于从单一代码库为移动、web 和桌面构建漂亮的本地编译应用程序。在本帖中，我们将深入探讨 ValueNotifier 及其相应的主题。</p><p id="3797" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">首先，为了理解 ValueNotifier 的需求，我们需要理解 Flutter 的底层架构。我们需要了解调用时小部件是如何重建的。</p></div><div class="ab cl lq lr hr ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ig ih ii ij ik"><blockquote class="kd ke kf"><p id="7d6a" class="kg kh ki kj b kk kl jo km kn ko jr kp kq kr ks kt ku kv kw kx ky kz la lb lc ig bi translated">颤振中的 ValueNotifier 简介</p></blockquote><p id="c853" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">ValueNotifier 是一种特殊类型的类，它扩展了一个<code class="fe ma mb mc md b"><strong class="kj io">ChangeNotifier</strong></code>。ValueNotifier 是 Flutter 本身固有的，它提供单个元素的反应性。Flutter 默认也有一个小部件，用它我们可以监听名为<code class="fe ma mb mc md b">ValueListenableBuilder</code>的 ValueNotifier。也可以使用<code class="fe ma mb mc md b">AnimationBuilder</code>收听，因为它是可收听的。</p><blockquote class="kd ke kf"><p id="b811" class="kg kh ki kj b kk kl jo km kn ko jr kp kq kr ks kt ku kv kw kx ky kz la lb lc ig bi translated"><em class="in">把 ValueNotifier 想象成保存一个值的数据流。我们为它提供一个值，每个侦听器都会收到一个值更改的通知。</em></p></blockquote><p id="c84a" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">我们可以创建任何类型的 ValueNotifier，例如 int、bool、list 或任何自定义数据类型。您可以像这样创建 ValueNotifier 对象:</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="0d22" class="mi mj in md b gy mk ml l mm mn">ValueNotifier&lt;int&gt; counter = ValueNotifier&lt;int&gt;(0);</span></pre><p id="7756" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">我们可以像这样更新该值:</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="5a0a" class="mi mj in md b gy mk ml l mm mn">counter.value = counter.value++;<br/>//OR<br/>counter.value++;</span></pre><p id="5912" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">另外，我们可以这样听<code class="fe ma mb mc md b">ValueNotifier</code>:</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="4da9" class="mi mj in md b gy mk ml l mm mn">counter.addListener((){<br/>   print(counter.value); <br/>});</span></pre><p id="2825" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">如果我们想在一个小部件中监听值，我们使用 ValueListenableBuilder 小部件，该小部件开箱即用，负责在视图之外删除订阅。因此，当使用 ValueListenableBuilder 时，我们不需要手动添加和删除侦听器，它会自动为我们完成这项工作。</p><h1 id="0bd7" class="mo mj in bd mp mq mr ms mt mu mv mw mx jt my ju mz jw na jx nb jz nc ka nd ne bi translated">移除值通知颤振中的监听器</h1><p id="3f1b" class="pw-post-body-paragraph kg kh in kj b kk nf jo km kn ng jr kp lx nh ks kt ly ni kw kx lz nj la lb lc ig bi translated">如果我们手动监听一个 ValueNotifier，我们不<code class="fe ma mb mc md b">dispose</code>它，因为它在应用程序的某个地方是需要的。我们可以使用<code class="fe ma mb mc md b">removeListener </code>函数，在当前页面上不使用时，从 ValueNotifier 中手动删除一个侦听器。</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="3a58" class="mi mj in md b gy mk ml l mm mn">ValueNotifier&lt;int&gt; valueNotifier = ValueNotifier(0);</span><span id="48fa" class="mi mj in md b gy nk ml l mm mn">void removeDemo() {<br/>  valueNotifier.removeListener(doTaskWhenNotified);<br/>}</span><span id="e210" class="mi mj in md b gy nk ml l mm mn">void addDemo(){<br/>  valueNotifier.addListener(doTaskWhenNotified);<br/>}</span><span id="6731" class="mi mj in md b gy nk ml l mm mn">void doTaskWhenNotified() {<br/>  print(valueNotifier.value);<br/>}</span></pre><h1 id="eb23" class="mo mj in bd mp mq mr ms mt mu mv mw mx jt my ju mz jw na jx nb jz nc ka nd ne bi translated">在 Flutter 中处理 ValueNotifier</h1><p id="500a" class="pw-post-body-paragraph kg kh in kj b kk nf jo km kn ng jr kp lx nh ks kt ly ni kw kx lz nj la lb lc ig bi translated">当不再使用时，最好使用<code class="fe ma mb mc md b">dispose</code>值通知程序，否则可能会导致内存泄漏。通知程序上的<code class="fe ma mb mc md b">dispose</code>方法将释放任何订阅的侦听器。</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="ef3b" class="mi mj in md b gy mk ml l mm mn">@override<br/> void dispose() {<br/>    counter.dispose();<br/>    super.dispose();<br/> }</span></pre><h1 id="878a" class="mo mj in bd mp mq mr ms mt mu mv mw mx jt my ju mz jw na jx nb jz nc ka nd ne bi translated">什么是 ValueListenableBuilder？</h1><p id="bf39" class="pw-post-body-paragraph kg kh in kj b kk nf jo km kn ng jr kp lx nh ks kt ly ni kw kx lz nj la lb lc ig bi translated">Flutter 中有许多类型的构建器，如 StreamBuilder、AnimatedBuilder、FutureBuilder 等。他们的名字暗示了他们消费的物品类型。ValueListenableBuilder 使用 ValueNotifier 对象。每次我们收到值更新时，都会执行 builder 方法。当我们路由到另一个页面时，ValueListenableBuilder 会自动在内部删除侦听器。</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="1e96" class="mi mj in md b gy mk ml l mm mn">const ValueListenableBuilder({<br/>    @required this.valueListenable,<br/>    @required this.builder,<br/>    this.child,<br/>  })</span></pre><p id="f07c" class="pw-post-body-paragraph kg kh in kj b kk kl jo km kn ko jr kp lx kr ks kt ly kv kw kx lz kz la lb lc ig bi translated">这是 ValueListenableBuilder 的构造函数。这里，valueListenable 是要监听的 ValueNotifier。构建器函数接收 3 个参数<code class="fe ma mb mc md b">(BuildContext context, dynamic value, Widget child)</code>。<code class="fe ma mb mc md b">value</code>是从提供的<code class="fe ma mb mc md b">valueNotifier</code>接收的数据。可以使用子参数。如果子进程构建起来很昂贵，并且不依赖于通知程序的值，我们就用它来进行优化。</p><h1 id="fa65" class="mo mj in bd mp mq mr ms mt mu mv mw mx jt my ju mz jw na jx nb jz nc ka nd ne bi translated">在颤振中使用值通知器的计数器应用程序</h1><p id="65f7" class="pw-post-body-paragraph kg kh in kj b kk nf jo km kn ng jr kp lx nh ks kt ly ni kw kx lz nj la lb lc ig bi translated">使用 ValueNotifer 和 ValueListenableBuilder 的计数器 app 看起来是这样的。注意没有使用<code class="fe ma mb mc md b">setState</code>，我们只重建了文本部分以防值发生变化。</p><pre class="le lf lg lh gt me md mf mg aw mh bi"><span id="3f61" class="mi mj in md b gy mk ml l mm mn">import 'package:flutter/material.dart';<br/><br/>void main() {<br/>  runApp(const App());<br/>}<br/><br/>class App extends StatelessWidget {<br/>  const App({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return const MaterialApp(<br/>      home: HomePage(),<br/>    );<br/>  }<br/>}<br/><br/>class HomePage extends StatefulWidget {<br/>  const HomePage({Key? key}) : super(key: key);<br/><br/>  @override<br/>  State&lt;HomePage&gt; createState() =&gt; _HomePageState();<br/>}<br/><br/>class _HomePageState extends State&lt;HomePage&gt; {<br/>  final _counterNotifier = ValueNotifier&lt;int&gt;(0);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('HOMEPAGE BUILT');<br/>    return Scaffold(<br/>      appBar: AppBar(title: const Text('Counter App')),<br/>      body: Center(<br/>        child: ValueListenableBuilder(<br/>          valueListenable: _counterNotifier,<br/>          builder: (context, value, _) {<br/>            return Text('Count: $value');<br/>          },<br/>        ),<br/>      ),<br/>      floatingActionButton: FloatingActionButton(<br/>        onPressed: () {<br/>          _counterNotifier.value++;<br/>        },<br/>        child: const Icon(Icons.add),<br/>      ),<br/>    );<br/>  }<br/><br/>  @override<br/>  void dispose() {<br/>    _counterNotifier.dispose();<br/>    super.dispose();<br/>  }<br/>}</span></pre></div></div>    
</body>
</html>