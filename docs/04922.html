<html>
<head>
<title>MySQL: Brief Introduction to MySQL Event Scheduler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MySQL:MySQL事件调度器简介</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mysql-brief-introduction-to-mysql-event-scheduler-1035219694dd?source=collection_archive---------1-----------------------#2021-05-22">https://blog.devgenius.io/mysql-brief-introduction-to-mysql-event-scheduler-1035219694dd?source=collection_archive---------1-----------------------#2021-05-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cef03a85f732c0be606dee6a3986e815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LkJuiSMgnDvqp7-oyi_p4Q.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在<a class="ae jz" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jz" href="https://unsplash.com/@writecodenow" rel="noopener ugc nofollow" target="_blank"> Boitumelo Phetla </a>拍摄的照片</figcaption></figure><p id="9570" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将利用MySQL事件调度器来创建一些负责完成某些任务的事件。此外，我们将比较Cronjob(一个用于类似Unix的计算机操作系统的软件工具)和MySQL事件调度程序。</p><blockquote class="ky kz la"><p id="e761" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated"><strong class="kc io">注意</strong>:如果阅读让你昏昏欲睡，先拿起你的咖啡杯，然后继续。<em class="in">😃</em></p></blockquote></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="c409" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">先决条件</h1><ol class=""><li id="9fe5" class="mk ml in kc b kd mm kh mn kl mo kp mp kt mq kx mr ms mt mu bi translated">MySQL安装在您的机器上</li><li id="caff" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">MySQL数据库背景</li><li id="e430" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">能够简化总是一个优势😃</li></ol><h1 id="6943" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">什么是MySQL事件调度器？</h1><p id="9124" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi ni translated">MySQL事件调度器是一个管理事件的调度和执行的工具，这些事件就是所谓的根据时间表运行的任务。MySQL在版本5.1.6中引入了事件调度器。当我们创建一个事件时，实际上我们是在创建一个包含一个或多个SQL语句的命名数据库对象，这些SQL语句以一个或多个固定的时间间隔执行，在特定的日期和时间开始和结束。这个事件调度器的想法类似于<strong class="kc io"> </strong> Unix <strong class="kc io"> crontab </strong>(也称为“cronjob”)或<strong class="kc io"> Windows任务调度器</strong>的想法。</p><h1 id="7e9f" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">什么时候使用MySQL事件调度器？</h1><p id="9101" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">假设您管理由两个表组成的数据库。一个表包含与用户信息相关的数据，如姓名、年龄、出生日期、性别等。在另一个表中，我们希望每天只输入一次数据，在这个表中，我们推送每天创建的用户条目数。</p><p id="a6aa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，这个问题陈述对你来说看起来很简单！让我们首先使用cronjob方法。我们可以编写一个脚本来获取每天创建的所有用户条目，并将结果插入到另一个表中。我们将通过使用crontab表达式设置计划时间来使用cronjob执行我们的脚本。</p><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/25b9ad600aa5056b17320fcb699ca099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/1*rsptbaJTXFLXjphYH0XQ5w.gif"/></div></figure><p id="2819" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是等等！让我们重复一次这个方法。</p><ul class=""><li id="cc43" class="mk ml in kc b kd ke kh ki kl nw kp nx kt ny kx nz ms mt mu bi translated">我们必须编写处理业务逻辑的代码块。</li><li id="a787" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">然后，我们需要添加一个cronjob，它将以特定的时间间隔触发我们的脚本。</li><li id="7bf7" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">现在我们在这里使用两台机器，一台在数据库中，另一台是我们设置cronjob的机器。</li></ul><blockquote class="ky kz la"><p id="eb1f" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated">你不认为这是资源的浪费吗？我们能用单台机器做它吗？感谢MySQL任务调度程序！</p></blockquote><p id="f04b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们的任务完全以数据为中心或者补充已经内置到数据库中的功能时，我们可以使用MySQL事件调度程序。我们可以使用这个事件调度器进行数据清理、记录某些事件、聚合某些数据等。</p><h1 id="cce9" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">CronJob上的MySQL事件调度程序</h1><p id="8498" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">在一些用例中，我们更喜欢MySQL事件调度程序而不是Cronjob。但是我们不能基于这些用例做出决定，并声明哪一个是最好的。以下是我们使用MySQL事件调度程序的优势:</p><ul class=""><li id="2916" class="mk ml in kc b kd ke kh ki kl nw kp nx kt ny kx nz ms mt mu bi translated">是直接用MySQL服务器写的。</li><li id="953b" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">这是独立于平台的方法。因此，如果我们的应用程序是用任何语言编写的都没关系，我们只需要知道MySQL。</li><li id="47fd" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">每当需要定期更新或清理数据库时，我们可以使用这种事件调度方法。</li><li id="cc8a" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">没有必要每次都编译查询，这样可以提高性能。</li></ul><h1 id="1f15" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">MySQL事件调度程序配置</h1><p id="1a18" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">MySQL使用一个名为<strong class="kc io">事件调度器线程</strong>的特殊线程来执行所有调度的事件。我们可以通过执行以下命令来查看事件调度程序线程的状态:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="fcb3" class="of ln in ob b gy og oh l oi oj">SHOW PROCESSLIST;</span></pre><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ok"><img src="../Images/7a4c75618b169a6e3d98e1ce744303d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuyz3t5QikCqCsxSowU13A.png"/></div></div></figure><p id="19b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果未启用事件调度程序，我们可以使用以下命令将事件调度程序系统变量设置为启用并启动它:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="62c9" class="of ln in ob b gy og oh l oi oj">SET GLOBAL event_scheduler = ON;</span></pre><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ol"><img src="../Images/95c744efdc01f948c8cb0526bf2fe837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tw_E4izGdOXAjiWKXWLQqQ.png"/></div></div></figure><p id="de6a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，如果我们执行第一个命令，我们可以看到事件调度程序线程的状态:</p><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/be62263d7fafe6c3b08134c803f4d628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TahB5tBwrg9wnurvUe3skg.png"/></div></div></figure><h1 id="1c7b" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">创建新的MySQL事件语法</h1><p id="0995" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">让我们使用下面的基本语法创建我们的第一个MySQL事件:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="8a11" class="of ln in ob b gy og oh l oi oj">CREATE EVENT [IF NOT EXIST] event_name <br/>ON SCHEDULE schedule <br/>DO event_body</span></pre><p id="70a0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在此语法中:</p><p id="873d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们用“CREATE EVENT”关键字指定想要创建的事件的名称。<strong class="kc io">事件名称在同一个数据库中必须是唯一的。</strong>其次，在“ON SCHEDULE”关键字后指定一个日程表。</p><p id="f1d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果事件是一次性事件，我们使用下面的语法:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="d9fd" class="of ln in ob b gy og oh l oi oj">AT timestamp [+ INTERVAL]</span></pre><p id="8815" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果事件是重复发生的事件，我们使用EVERY子句:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="991c" class="of ln in ob b gy og oh l oi oj">EVERY interval STARTS timestamp [+INTERVAL] ENDS timestamp [+INTERVAL]</span></pre><p id="8b85" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第三，将SQL语句放在DO关键字之后。我们可以在事件体内调用存储过程。如果我们有复合语句，我们可以把它们放在一个“BEGIN END”块中。</p><h1 id="e3a6" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">为我们的用例实现MySQL事件</h1><p id="3e1a" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">让我们使用下面的命令创建一个包含用户信息(如姓名、年龄、性别、出生日期)的表:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="c64f" class="of ln in ob b gy og oh l oi oj">CREATE TABLE USERS ( <br/>id INT PRIMARY KEY AUTO_INCREMENT,<br/>Name VARCHAR(20) NOT NULL,      <br/>Gender VARCHAR(1) NOT NULL, <br/>AGE INT NOT NULL, <br/>CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, <br/>UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE  CURRENT_TIMESTAMP <br/>);</span></pre><p id="dbfe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们将创建另一个表来存储每天的用户条目数，并使用以下命令创建该表:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="418d" class="of ln in ob b gy og oh l oi oj">CREATE TABLE USERS_COUNT_DAY_WISE (<br/>id INT PRIMARY KEY AUTO_INCREMENT,<br/>USER_ENTRIES_ON DATETIME,<br/>COUNT INT<br/>);</span></pre><p id="5b46" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的MySQL事件调度程序的时间到了。我们将创建一个事件，从“USERS”表中获取每天的用户条目数，并将结果插入到“USERS_COUNT_DAY_WISE”表中。我们将每天执行一次这个任务。使用下面的命令，我们可以创建此事件，并为其安排一个特定的时间间隔:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="25cc" class="of ln in ob b gy og oh l oi oj">CREATE EVENT USERS_ENTRY_COUNT<br/>ON SCHEDULE EVERY 1 DAY <br/>STARTS (TIMESTAMP(CURRENT_DATE) + INTERVAL 1 DAY + INTERVAL 1 HOUR)<br/>DO<br/>INSERT INTO USERS_COUNT_DAY_WISE (USER_ENTRIES_ON, COUNT) SELECT NOW(), COUNT(*) FROM USERS WHERE CREATED_AT &gt;= DATE_SUB(NOW(), INTERVAL 1 DAY);</span></pre><p id="7524" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要检查我们执行的事件，我们可以使用下面的命令:</p><pre class="ns nt nu nv gt oa ob oc od aw oe bi"><span id="879f" class="of ln in ob b gy og oh l oi oj">SELECT event_schema, event_definition, status, starts, last_executed FROM INFORMATION_SCHEMA.EVENTS</span></pre><h1 id="fa51" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">问候！🥳</h1><p id="2e15" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated"><em class="lb">我们已经成功地创建了我们的第一个MySQL事件，它将负责一个特定的任务，我们也在特定的时间间隔内激活这个任务。</em></p><p id="a32e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为胜利的一页，让我们检查一下我们预定的事件是否被添加到进程列表中。</p><div class="ns nt nu nv gt ab cb"><figure class="on jo oo op oq or os paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><img src="../Images/e9f0cc4075f274bac27c9ef3f7f346ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1404/format:webp/1*YtKTpjZ4OfAgh4C2OeQqVQ.png"/></div></figure><figure class="on jo ot op oq or os paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><img src="../Images/5bc9333237a86fd0d4f822e9fc0c79bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/1*hcCg9Ak8FJLzyEumrPP4LQ.gif"/></div></figure></div><h1 id="06fc" class="lm ln in bd lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf ne mh mi mj bi translated">摘要</h1><p id="a63e" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">为了这篇文章的完整性，让我们快速回顾一下到目前为止我们所学的内容。</p><ul class=""><li id="561d" class="mk ml in kc b kd ke kh ki kl nw kp nx kt ny kx nz ms mt mu bi translated">什么是MySQL事件调度器？</li><li id="e92c" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">我们什么时候可以在Cronjob上使用它？</li><li id="3b92" class="mk ml in kc b kd mv kh mw kl mx kp my kt mz kx nz ms mt mu bi translated">MySQL事件调度器的基本命令</li></ul><blockquote class="ou"><p id="2176" class="ov ow in bd ox oy oz pa pb pc pd kx dk translated">如果你喜欢这篇文章，别忘了给它一个掌声！</p></blockquote><figure class="pf pg ph pi pj jo gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/a7d8c1ca5201216f8856b10e902b2fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/1*L2RLgwJSAbkkDfTKTb5G8A.gif"/></div></figure><p id="92f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请随时在<a class="ae jz" href="https://www.linkedin.com/in/shubham-kaushik-temp/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> Linkedin </strong> </a> <strong class="kc io"> </strong>上ping我，敬请期待下一期！</p></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="3207" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考</h1><p id="dfc5" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl nf kn ko kp ng kr ks kt nh kv kw kx ig bi translated">[1] MySQL官方文档<a class="ae jz" href="https://dev.mysql.com/doc/" rel="noopener ugc nofollow" target="_blank">https://dev.mysql.com/doc/</a></p><p id="e002" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">[2] MySQL教程网站<a class="ae jz" href="http://mysqltutorial.org/" rel="noopener ugc nofollow" target="_blank">http://mysqltutorial.org/</a></p></div></div>    
</body>
</html>