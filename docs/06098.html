<html>
<head>
<title>My first 77 hours with Haskell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我和哈斯克尔在一起的第一个77小时</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/my-first-77-hours-with-haskell-188222314040?source=collection_archive---------7-----------------------#2021-12-13">https://blog.devgenius.io/my-first-77-hours-with-haskell-188222314040?source=collection_archive---------7-----------------------#2021-12-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d7bd9172a021fbeed4b31926c61ff4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcYydeEPHW1ki-A-Pc5gVA.png"/></div></div></figure><p id="215f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我忍不住要讲我和哈斯克尔在一起的第一个77小时的故事。为什么？因为这是一个在爱与恨之间不断变化的故事。</p><p id="87ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这一切都是从我第一次对<a class="ae kt" href="https://cardano.org/" rel="noopener ugc nofollow" target="_blank"> Cardano </a>项目感兴趣开始的(附注:这不是一篇关于Cardano的帖子)。多年来，我一直对区块链的项目感兴趣，但直到现在，我读到的项目(比特币、以太坊、Hyperledger等)都没有真正引起我的注意。我对它非常感兴趣，我决定了解它的内部工作原理，并深入研究它。那正是我第一次知道哈斯克尔的时候。</p><p id="0bd8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就像我一样，许多人正试图开始学习Haskell，我开始阅读《<a class="ae kt" href="http://learnyouahaskell.com/" rel="noopener ugc nofollow" target="_blank">为了更好地学习Haskell！</a>”。虽然这本书写得很好，但这是<strong class="jx io">我第一次开始讨厌哈斯克尔</strong>。来自一个完全命令式语言的背景，Haskell函数式的代码编写方式对我来说看起来非常混乱和难以理解。</p><p id="b192" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这与命令式编程语言几乎是作为一组指令编写的这一事实有关。因此，阅读这种类型的代码几乎就像阅读一套指令。哈斯克尔就不是这样了。尽管如此，哈斯克尔还是引起了我的注意。最重要的是，我太固执了，不能让一种新的编程语言来征服我，所以我继续前进。</p><p id="214b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看了其他的书，网页，看了几十个小时的视频(<em class="ku">我的意思是，单子周围的绒毛都是什么？我开始掌握和理解一些Haskell基础知识，并开始理解一些代码。但是众所周知，<strong class="jx io">仅仅通过阅读和观看视频是学不会编程的。所以，我决定抓住我的一个非常小的项目，试着把它翻译给Haskell。</strong></em></p><p id="37ba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个项目很简单。它使用非常好的<a class="ae kt" href="https://p5js.org/" rel="noopener ugc nofollow" target="_blank"> p5.js </a> JavaScript库创建一个画布，上面有一组正方形。然后，给定一个特定的数学函数，正方形以特定的方式着色。比如下图。</p><figure class="kw kx ky kz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kv"><img src="../Images/ad0896eab181854075f25ac84ab43f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdWhcRvGofmGRaTj9HL0IA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">用Haskell制作的10x30正方形数组</figcaption></figure><p id="72d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">很简单，对吧？<strong class="jx io">否</strong>。至少对初学者来说不是。</p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><h1 id="8846" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">挑战#1:环境和包</h1><p id="30a1" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">Cabal还是Stack？没有明显的原因，我决定用Stack。在这里，我的主要障碍是学习和理解Stack如何工作，以及如何将一个包导入到我的项目中。</p><p id="99a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为我的目标是处理图像，所以我必须找到一个图像处理包。通过快速的谷歌搜索，我最终找到了一个名为<a class="ae kt" href="https://www.stackage.org/package/hip" rel="noopener ugc nofollow" target="_blank"> hip </a> (haskell图像处理)的包。到目前为止，一切顺利。</p><p id="d438" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，如何将包添加到我的项目中？我对哈斯克尔的第二次仇恨就是从那里开始的。和第一个问题一样，其中一个主要原因就是我缺乏经验。第二个，包装页缺乏明确的说明。我天真的自我心想:“这应该和JavaScript的npm差不多；我所要做的就是将包的名称添加到我的package.yaml文件的依赖项列表中。但是那没有用！为什么？<strong class="jx io">快照</strong>！</p><p id="d513" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我花了一段时间才明白Stack到底是怎么工作的。并且意识到我使用的快照并不包含我想要使用的包。稍作谷歌研究，解决方案似乎很简单:“只需使用<code class="fe mo mp mq mr b">extra-deps</code>函数从不同的快照添加包”。简单。不要！！！因为我想使用的包有其他依赖项，需要其他快照版本，这些也有同样的问题。在给<code class="fe mo mp mq mr b">extra-deps</code>增加了一堆包裹后，这个建筑就会完全崩溃。太好了。</p><p id="a9b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，几个小时后我找到了什么解决方案呢？使用包含我要使用的包的最后一个快照来设置我的环境。没那么简单。</p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><h1 id="9734" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">挑战#2:文档</h1><p id="69a5" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">好了，现在我可以构建包含<em class="ku"> hello world </em>示例和<code class="fe mo mp mq mr b">hip </code>包的项目了。成功。最后，我们来写点代码吧！第一步，让我们看看这个包是如何工作的。</p><blockquote class="ms mt mu"><p id="5b03" class="jv jw ku jx b jy jz ka kb kc kd ke kf mv kh ki kj mw kl km kn mx kp kq kr ks ig bi translated">我的下一个噩梦来了。文档不是Haskell的强项。</p></blockquote><p id="a807" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我期望看到某种类型的<code class="fe mo mp mq mr b">*.md</code>文件或任何其他关于我自己设置使用的包的文档。总的来说，包在npm或pip(至少是最常用的)中有很好的文档记录。但是对于<code class="fe mo mp mq mr b">hip</code>软件包来说，文档并不是最好的。这里，我需要提到的是，由于没有详细的文档，我缺乏使用Haskell的经验使得理解一个包如何工作变得更加复杂。</p><p id="6ffe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是，这最终对我有利。是的，我失去了相当多的时间来学习如何使用<code class="fe mo mp mq mr b">hip</code>，但是因为我没有其他选择，除了在代码内部挑选，我最终在浏览和试图理解它的时候学习了一些好的Haskell课程。虽然软件包缺乏详细的文档，但代码写得很好。</p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><h1 id="529a" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">挑战#3:性能</h1><p id="cf98" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">好的。所以，现在我可以编译一个空项目，并开始创建一些空图像。再过几个小时，我就有一个正方形了。再多一些，我得到一条有三个正方形的线。接下来，一个3x3正方形阵列的图像。成功！对吗？你可能已经知道答案了。</p><figure class="kw kx ky kz gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/ff13fa14594a27ca256b37dc967597d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*7OPNoEh1b6mcZh7EUKWE0w.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">用Haskell制作的3x3方形数组</figcaption></figure><p id="1466" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我的代码正在运行，我可以创建一个3x3的正方形数组图像，我想创建一个有许多正方形的真实图像，我可以在社交媒体上发布，以显示我对自己有多自豪。因此，我再次运行我的程序，这次请求一个30x30的正方形数组图像，然后我等待。我等待着。我再等一会儿。10分钟后，我不敢相信花了这么长时间，于是我终止了程序的执行。可能是代码中的错误。</p><p id="5f41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不完全是。我的节目有一个<strong class="jx io">糟糕的表现</strong>。以至于我不得不学习如何在Haskell中分析程序，试图找出问题所在。我还记录了创建1、4、9、16、25个正方形的图像需要多长时间，以便估计创建一个900个正方形的图像(30x30数组)需要多长时间。大约需要6400秒！真是一场灾难。有些事非常不对劲。</p><p id="8162" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">经过一些剖析和代码审查，我最终找到了一些罪魁祸首。</p><ol class=""><li id="50c6" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated">我的程序多次写入相同的像素。例如，我将首先创建一个画布，然后创建每个正方形并用正方形覆盖原始画布。这会造成不必要的执行。</li><li id="d70a" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated">我使用列表来存储图像数据。由于我用来覆盖原始画布的方法，我在列表中做了大量的搜索和索引。因为列表不是为此目的而创建的，所以它们缺乏良好的性能。</li></ol><p id="568a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是，我最大的错误是我自己写的代码。即使我在开始编码之前做了大量关于Haskell和函数式编程的研究，我最终还是让我的命令式编码器占了上风。我最终做的是用伪函数方法创建了一个伪命令式代码。糟透了。</p><p id="ce89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想看看这个可怕的模块，你可以在这里查看<a class="ae kt" href="https://gist.github.com/fabiomolinar/301d7ea6628d4687203bf5ffa450afa2" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><h1 id="9a65" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">重构</h1><p id="6ae8" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">但是我还没说完。在大量的代码剖析之后，我明白我应该远离列表。这样做不是为了存储在任意随机位置频繁访问的数据数组。此外，我意识到我没有正确地使用<code class="fe mo mp mq mr b">hip</code>库，我的代码也根本不起作用。</p><p id="cc55" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">经过几个小时的重构，我得到了一个更小(几乎小了50%)、功能更好、更简洁(类型的使用将代码的清晰度和可读性提高了一个数量级)并且效率更高的模块！仅仅经过几个小时的重构，这是多么大的进步啊。</p><p id="ae40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，创建一个30×30的正方形阵列图像只需要3.7秒(快了1730倍)，而不是6400秒！这就是我所说的进步。</p><p id="9b15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">想看改进版，点此查看<a class="ae kt" href="https://gist.github.com/fabiomolinar/3c71c09dc4502af339df086894b77827" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><h1 id="be0e" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">下一个</h1><p id="5584" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">尽管我强调的主要是我在学习和试用Haskell时的“厌恶”，但在整个旅程中，我实际上享受了<strong class="jx io">的许多乐趣</strong>。强迫我的大脑以不同的方式思考是一个非常好的、令人愉快的思维练习。不仅如此，我脑海中一直有个声音在说“上帝，这一切都变得有意义了；为什么不是所有的语言都这样？”和“该死，这段代码就是这么简短、简单、切中要害、漂亮！”。</p><p id="26d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">谈到哈斯克尔，我只是略知皮毛。我想尝试和接触大量更高级的主题。我已经阅读了他们，我一直在提高我的理论背景。但是我还是缺乏一些实际的编码经验。但是我希望在不久的将来，我的下一个项目能解决这个问题。</p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><p id="dc3a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你一路来到这里，你想阅读更多，已经有一个关于这个主题的<a class="ae kt" href="https://medium.com/@fabiomolinar/importing-csv-data-with-haskell-and-the-worlds-dependency-on-fossil-fuels-7070e7796b4a" rel="noopener">后续故事</a>。希望你喜欢。</p></div></div>    
</body>
</html>