<html>
<head>
<title>Upgrade to react 18 — Issues and resolution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">升级以作出反应 18-问题和解决方案</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/upgrade-to-react-18-issues-and-resolution-4838df8322b1?source=collection_archive---------0-----------------------#2022-04-23">https://blog.devgenius.io/upgrade-to-react-18-issues-and-resolution-4838df8322b1?source=collection_archive---------0-----------------------#2022-04-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8a3089e9c4fc000814d7b6e383f6cf6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7YGc3_5yL6bLUTEvoQPqQ.jpeg"/></div></div></figure></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><p id="d76f" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">reactor 18 已经过时，大多数人都希望升级到 reactor 18，以便通过在承诺范围内自动批处理来利用性能改进，并通过并发 reactor 获得更好的用户界面体验。在并发 reactor 中，渲染可能会因用户输入等紧急更新而中断，并且会同时准备多个版本的用户界面。您可以从这里获得更多信息—<a class="ae la" href="https://reactjs.org/blog/2022/03/29/react-v18.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/blog/2022/03/29/react-v18.html</a>。作为使用所有这些功能的第一步，我们需要先升级到 React 18。以下是我根据<a class="ae la" href="https://reactjs.org/blog/2022/03/08/react-18-upgrade-guide.html" rel="noopener ugc nofollow" target="_blank">https://react js . org/blog/2022/03/08/react-18-upgrade-guide . html</a>对我的 react/redux 应用程序执行的步骤。反应路由器 dom 问题没有记录在那里，所以我想分享我的经验。</p></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><ol class=""><li id="74cb" class="lb lc in ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated">安装最新版本的 React:</li></ol><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="6680" class="lt lu in lp b gy lv lw l lx ly">npm install react react-dom</span></pre><p id="9862" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">2.移动到新的根应用编程接口。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="1dda" class="lt lu in lp b gy lv lw l lx ly">// Before</span><span id="1638" class="lt lu in lp b gy lz lw l lx ly">import { render } from 'react-dom';<br/>const container = document.getElementById('app');<br/>render(<br/>  &lt;React.StrictMode&gt;<br/>   &lt;Provider store={store}&gt;<br/>    &lt;MyApp /&gt;<br/>   &lt;/Provider&gt;<br/>  &lt;/React.StrictMode&gt;, <br/>container);</span><span id="854c" class="lt lu in lp b gy lz lw l lx ly"><br/>// After</span><span id="aee9" class="lt lu in lp b gy lz lw l lx ly">import { createRoot } from 'react-dom/client';<br/>const container = document.getElementById('app');<br/>const root = createRoot(container); <br/>root.render(<br/>  &lt;React.StrictMode&gt;<br/>   &lt;Provider store={store}&gt;<br/>    &lt;MyApp /&gt;<br/>   &lt;/Provider&gt;<br/>  &lt;/React.StrictMode&gt;<br/>);</span></pre><p id="312c" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">3.我没有任何 unmountComponentAtNode 的用法，也没有来自 render 的回调。我的应用程序也没有使用服务器端呈现或类型脚本。如果您使用其中任何一种，可以按照此处的说明进行操作—<a class="ae la" href="https://reactjs.org/blog/2022/03/08/react-18-upgrade-guide.html#updates-to-client-rendering-apis" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/blog/2022/03/08/react-18-upgrade</a></p><p id="96cd" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">4.升级反应-redux 到 8，因为 redux 8 支持反应 18。在版本 8 中，React Redux 的两个公共 API(<code class="fe ma mb mc lp b">connect</code>和<code class="fe ma mb mc lp b">useSelector</code>)被重写以支持 React 18。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="91d4" class="lt lu in lp b gy lv lw l lx ly">npm install react-redux</span></pre><p id="700c" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">5.升级反应脚本到 5.0.1。反应脚本 5.0.1 提高了与反应 18 的兼容性。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="b30c" class="lt lu in lp b gy lv lw l lx ly">npm install react-scripts</span></pre><p id="ae79" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">如果您以前使用过 react-scripts 4，您可能会看到 webpack5 的一些问题，因为 react-scripts 5 使用 webpack5。就我而言，我有两个问题。</p><p id="6978" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">I .反应-脚本开始显示来自内部使用的一个节点模块的“无法解析源映射”警告。使用反应脚本时，将 GENERATE_SOURCEMAP 设置为 false。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="e937" class="lt lu in lp b gy lv lw l lx ly">GENERATE_SOURCEMAP=false react-scripts start</span></pre><p id="efbd" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">ii .我用<a class="ae la" href="https://www.npmjs.com/package/msw" rel="noopener ugc nofollow" target="_blank"> msw </a>作为 API 的模拟库。MSW 对 webpack 5 有意见。相关链接—<a class="ae la" href="https://github.com/mswjs/msw/issues/1142" rel="noopener ugc nofollow" target="_blank">https://github.com/mswjs/msw/issues/1142</a><a class="ae la" href="https://github.com/mswjs/msw-storybook-addon/issues/47" rel="noopener ugc nofollow" target="_blank">https://github.com/mswjs/msw-storybook-addon/issues/47</a>。使用以下技术解决—<a class="ae la" href="https://github.com/mswjs/msw-storybook-addon/pull/53" rel="noopener ugc nofollow" target="_blank">https://github.com/mswjs/msw-storybook-addon/pull/53</a></p><h1 id="09aa" class="md lu in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">问题和决议</h1><ol class=""><li id="289a" class="lb lc in ke b kf na kj nb kn nc kr nd kv ne kz lg lh li lj bi translated">经过上述更改后，我的应用程序呈现了空白页面。</li></ol><h2 id="8684" class="lt lu in bd me nf ng dn mi nh ni dp mm kn nj nk mq kr nl nm mu kv nn no my np bi translated">分辨率:</h2><p id="bd83" class="pw-post-body-paragraph kc kd in ke b kf na kh ki kj nb kl km kn nq kp kq kr nr kt ku kv ns kx ky kz ig bi translated">做出反应。StrictMode 组件我的 src/index.js 文件中 Provider 组件的子/后代。</p><p id="a82b" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">React 18—<a class="ae la" href="https://reactjs.org/blog/2022/03/08/react-18-upgrade-guide.html#updates-to-strict-mode" rel="noopener ugc nofollow" target="_blank">https://React js . org/blog/2022/03/08/React-18-upgrade-guide . html</a>中对 StrictMode 进行了一些重大更新，所以我必须将 strict mode 下移一级才能让它工作。</p><p id="799f" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">2.之后一切看起来都很好，但是我意识到 BrowserRouter 中的 Link 标记只改变了 URL，而没有呈现组件。react-router-dom@5 和 React 18 之间目前存在不兼容问题。</p><h2 id="7ac6" class="lt lu in bd me nf ng dn mi nh ni dp mm kn nj nk mq kr nl nm mu kv nn no my np bi translated">分辨率:</h2><p id="ab54" class="pw-post-body-paragraph kc kd in ke b kf na kh ki kj nb kl km kn nq kp kq kr nr kt ku kv ns kx ky kz ig bi translated">为此，我尝试了两种解决方案。</p><p id="1b9f" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">1.做出反应。StrictMode 组件 BrowserRouter 组件的子/后代。</p><p id="ecdc" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">这很有效，尽管我喜欢下一个更干净的解决方案。</p><p id="3ff8" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">2.升级到 react-router-dom@6。我用的是 react-router-dom@5.3</p><p id="c130" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">下面是我升级到 react-router-dom@6 的步骤。</p><ol class=""><li id="a584" class="lb lc in ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated">安装最新的 react-router-dom 6</li></ol><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="bf9d" class="lt lu in lp b gy lv lw l lx ly">npm install react-router-dom</span></pre><p id="7a8f" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">2.将所有<switch>元素更新为<routes>，并将所有路线元素更新为具有元素属性而非组件。</routes></switch></p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="ab88" class="lt lu in lp b gy lv lw l lx ly">// Before</span><span id="d805" class="lt lu in lp b gy lz lw l lx ly">&lt;BrowserRouter&gt;<br/>   &lt;Switch&gt;<br/>      &lt;Route exact path="/" component=Home /&gt;<br/>      &lt;Route path="/users" component=Users /&gt;<br/>   &lt;/Switch&gt;<br/>&lt;/BrowserRouter&gt;<br/></span><span id="2038" class="lt lu in lp b gy lz lw l lx ly">// After</span><span id="6436" class="lt lu in lp b gy lz lw l lx ly">&lt;BrowserRouter&gt;<br/>   &lt;Routes&gt;<br/>      &lt;Route exact path="/" element=&lt;Home /&gt; /&gt;<br/>      &lt;Route path="/users" element=&lt;Users /&gt; /&gt;<br/>   &lt;/Routes&gt;<br/>&lt;/BrowserRouter&gt;</span></pre><p id="c58f" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">3.用<navigate>替换所有的<redirect>标签，如果<redirect>存在于<switch>内部，将<code class="fe ma mb mc lp b">&lt;Redirect&gt;</code>移动到<code class="fe ma mb mc lp b">&lt;Route render&gt;</code>道具中。</switch></redirect></redirect></navigate></p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="c2f1" class="lt lu in lp b gy lv lw l lx ly">// Before</span><span id="6465" class="lt lu in lp b gy lz lw l lx ly">&lt;Switch&gt;<br/>  &lt;Redirect from="about" to="about-us" /&gt;<br/>&lt;/Switch&gt;</span><span id="67c3" class="lt lu in lp b gy lz lw l lx ly"><br/>// After</span><span id="09ca" class="lt lu in lp b gy lz lw l lx ly">&lt;Switch&gt;<br/>  &lt;Route path="about" render={() =&gt; &lt;Navigate to="about-us" /&gt;} /&gt;<br/>&lt;/Switch&gt;</span></pre><p id="778e" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">4.用带钩路由器替换任何路由器。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="00e3" class="lt lu in lp b gy lv lw l lx ly">// Before</span><span id="24c2" class="lt lu in lp b gy lz lw l lx ly">import { withRouter } from 'react-router';<br/><br/><br/>const ShowTheLocation = ({ match, location, history }) =&gt; {<br/>    return &lt;div&gt;You are now at {location.pathname}&lt;/div&gt;;<br/>}<br/><br/>const ShowTheLocationWithRouter = withRouter(ShowTheLocation);<br/></span><span id="88fe" class="lt lu in lp b gy lz lw l lx ly">// After</span><span id="498d" class="lt lu in lp b gy lz lw l lx ly">import { useLocation } from 'react-router-dom';</span><span id="abd1" class="lt lu in lp b gy lz lw l lx ly">const ShowTheLocation = () =&gt; {<br/>  const location = useLocation();<br/>  <br/>  return &lt;div&gt;You are now at {location.pathname}&lt;/div&gt;;<br/>}</span></pre><p id="cb26" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">经过这些修改后，我的应用程序看起来不错。希望以上几点有帮助。计划很快开始使用并发渲染特性，将在我的下一篇文章中分享我的经验。快乐升级到 React 8！</p></div></div>    
</body>
</html>