<html>
<head>
<title>Best of Modern JavaScript — Regex y Flag</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华—正则表达式y标志</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-of-modern-javascript-regex-y-flag-d6d8768b7816?source=collection_archive---------5-----------------------#2020-11-08">https://blog.devgenius.io/best-of-modern-javascript-regex-y-flag-d6d8768b7816?source=collection_archive---------5-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8127b57918600d4fecbb3fa9bc504892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CTyABrho9CixFE6I"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">斯蒂芬·莱昂纳迪在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="073b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究JavaScript regex的新特性。</p><h1 id="0765" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">搜索和y标志</h1><p id="4267" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">String.prototype.search</code>方法忽略了<code class="fe me mf mg mh b">y</code>标志。</p><p id="6d24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">lastIndex</code>不为它所改变。</p><p id="03a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1ffe" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /foo/y;</span><span id="710a" class="mq lc iq mh b gy mv ms l mt mu">REGEX.lastIndex = 8;<br/>const match = 'barfoobarfoo'.search(REGEX);<br/>console.log(match.index);<br/>console.log(REGEX.lastIndex);</span></pre><p id="829f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe me mf mg mh b">match</code>美国<code class="fe me mf mg mh b">undefined</code>和<code class="fe me mf mg mh b">lastIndex</code>停留在8。</p><p id="51dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只能用它从字符串的开头开始搜索。</p><p id="488b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据<code class="fe me mf mg mh b">g</code>标志是否添加了<code class="fe me mf mg mh b">y</code>,<code class="fe me mf mg mh b">String.prototype.match</code>的工作方式不同。</p><p id="6668" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">g</code>不是，就像<code class="fe me mf mg mh b">exec</code>一样工作。</p><p id="abdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果设置了<code class="fe me mf mg mh b">g</code>，那么它返回一个包含匹配的字符串部分的数组或<code class="fe me mf mg mh b">null</code>。</p><p id="0dd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8cd7" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/;</span><span id="92cd" class="mq lc iq mh b gy mv ms l mt mu">REGEX.lastIndex = 7;<br/>console.log('abab'.match(REGEX).index); <br/>console.log(REGEX.lastIndex);</span></pre><p id="0a8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe me mf mg mh b">index</code>为0，<code class="fe me mf mg mh b">lastIndex</code>为7。</p><p id="4c03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有添加标志，它将获得第一个。</p><p id="1565" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们添加<code class="fe me mf mg mh b">y</code>标志:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f86f" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/y;</span><span id="e1df" class="mq lc iq mh b gy mv ms l mt mu">REGEX.lastIndex = 2;<br/>console.log('abab'.match(REGEX).index); <br/>console.log(REGEX.lastIndex);</span></pre><p id="6cac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么只有当搜索从<code class="fe me mf mg mh b">lastIndex</code>开始时才返回匹配。</p><p id="2737" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">索引必须准确。</p><p id="4856" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">lastIndex</code>找到匹配后将被更新。</p><p id="e001" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果设置了<code class="fe me mf mg mh b">g</code>标志，那么<code class="fe me mf mg mh b">match</code>将匹配所有子字符串，并将它们放入数组中。</p><p id="2bf8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d1d1" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a|b/g;</span><span id="5a7e" class="mq lc iq mh b gy mv ms l mt mu">REGEX.lastIndex = 0;<br/>console.log('abab'.match(REGEX)); <br/>console.log(REGEX.lastIndex);</span></pre><p id="591b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">match</code>返回<code class="fe me mf mg mh b">[“a”, “b”, “a”, “b”]</code>。</p><p id="7249" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">lastIndex</code>仍为0。</p><p id="1c71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">lastIndex</code>被忽略，启用<code class="fe me mf mg mh b">g</code>标志。</p><p id="dee8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加<code class="fe me mf mg mh b">gy</code>标志后，结果相同。</p><p id="b4f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">match</code>和<code class="fe me mf mg mh b">lastIndex</code>都给我们同样的结果。</p><h1 id="b470" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe me mf mg mh b">Split Strings</code></h1><p id="1aaa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">方法让我们拆分一个字符串。</p><p id="4973" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">y</code>标志将改变方法的行为。</p><p id="2e88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3de8" class="mq lc iq mh b gy mr ms l mt mu">console.log('abb'.split(/b/y))<br/>console.log('bba'.split(/b/y))</span></pre><p id="e0a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">字符串将以<code class="fe me mf mg mh b">b</code>为分隔符进行拆分。</p><p id="6138" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5166" class="mq lc iq mh b gy mr ms l mt mu">["a", "", ""]</span></pre><p id="b79b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="808a" class="mq lc iq mh b gy mr ms l mt mu">["", "", "a"]</span></pre><p id="ee2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论旗帜在什么位置，<code class="fe me mf mg mh b">y</code>旗帜都起作用。</p><p id="13da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以将模式放在一个捕获组中:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c4a1" class="mq lc iq mh b gy mr ms l mt mu">console.log('abb'.split(/(b)/y))</span></pre><p id="1eec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d62f" class="mq lc iq mh b gy mr ms l mt mu">["a", "b", "", "b", ""]</span></pre><p id="ac79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果。</p><h1 id="6a23" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">替换字符串</h1><p id="d58a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">String.prototype.replace</code>方法让我们通过用正则表达式匹配字符串来替换它们。</p><p id="4c77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4237" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/;<br/>console.log('baba'.replace(REGEX, 'x'));</span></pre><p id="0bdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们让<code class="fe me mf mg mh b">'bxba’</code>登录。</p><p id="42dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它只记录第一个匹配的条目。</p><p id="94a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果添加了<code class="fe me mf mg mh b">y</code>标志，我们也最多得到一个匹配。</p><p id="a81b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是匹配总是从字符串的开头开始搜索。</p><p id="94c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="50c7" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/y;<br/>REGEX.lastIndex = 2;<br/>console.log('baba'.replace(REGEX, 'x'));</span></pre><p id="e07a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们让<code class="fe me mf mg mh b">'baba’</code>登录。</p><p id="6f45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">lastIndex</code>超出了第一个匹配，那么它将被忽略，即使有匹配可用。</p><p id="8338" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过<code class="fe me mf mg mh b">g</code>标志，<code class="fe me mf mg mh b">replace</code>替换所有匹配。</p><p id="ed48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cc1a" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/g;<br/>REGEX.lastIndex = 2;<br/>console.log('baba'.replace(REGEX, 'x'));</span></pre><p id="bec4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe me mf mg mh b">'bxbx'</code>日志。</p><p id="abd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们组合<code class="fe me mf mg mh b">g</code>和<code class="fe me mf mg mh b">y</code>标志:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6408" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/gy;<br/>console.log('baba'.replace(REGEX, 'x'));</span></pre><p id="9e47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后从<code class="fe me mf mg mh b">replace</code>方法返回<code class="fe me mf mg mh b">'baba’</code>。</p><p id="2684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3cdd" class="mq lc iq mh b gy mr ms l mt mu">const REGEX = /a/gy;<br/>console.log('aaba'.replace(REGEX, 'x'));</span></pre><p id="72b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe me mf mg mh b">‘xxba’</code>。这意味着第一个匹配必须在字符串的开头，这样<code class="fe me mf mg mh b">replace</code>才能工作。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/930c9d37bea21e924db3793617e1cfa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vpxgv57Ll0RVQbbb"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">阿什利·罗斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="675b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f962" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">y</code>标志是ES6中引入的新标志，使用不同的方法会有不同的效果。</p></div></div>    
</body>
</html>