<html>
<head>
<title>Host a WordPress site for free using Google Cloud Platform and Cloudflare</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云平台和 Cloudflare 免费托管一个 WordPress 站点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/host-a-wordpress-site-for-free-using-google-cloud-platform-and-cloudflare-ba48efd91b42?source=collection_archive---------10-----------------------#2022-02-18">https://blog.devgenius.io/host-a-wordpress-site-for-free-using-google-cloud-platform-and-cloudflare-ba48efd91b42?source=collection_archive---------10-----------------------#2022-02-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="546f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">小型网站和企业的预算解决方案</h2></div><p id="a420" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章将包括一系列我自己提出和回答的问题，以找到解决方案。这更多的是描述我的个人经历，而不是关于这个主题的一步一步的教程，所以一些概念解释将被省略。欢迎对任何错误进行更正！如果这篇文章对你有帮助，你可以在 https://hungvu.tech/<a class="ae ky" href="https://hungvu.tech/?utm_source=medium.com&amp;utm_medium=referral&amp;utm_campaign=medium_crossposting" rel="noopener ugc nofollow" target="_blank">阅读我的其他文章。</a></p><h1 id="6350" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题陈述</h1><p id="20ec" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">WordPress 站点是使用几个插件(例如 Elementor)构建的。要使用插件，我需要一份在 WordPress.com<a class="ae ky" href="http://WordPress.com" rel="noopener ugc nofollow" target="_blank">的商业计划，每月 25 美元，对我的用例来说太贵了。也就是说，我需要一个更经济的选择，那么我应该从哪里开始呢？</a></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/007c74e3c89bf5961770ac72030a8808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wBUfQJept1z0ZT9n"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">WordPress.com 相当贵</figcaption></figure><h1 id="796d" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:我对谷歌云平台有一些经验，也许我需要先看看那里？</h1><p id="3294" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">事实上，他们确实提供了解决方案。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mm"><img src="../Images/c858e2627a6d49e06bab37dcd00e956a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VdaPlArgsuJn2NGp"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">在 GCP 上托管 WordPress 网站的选项</figcaption></figure><p id="c982" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我的目标是有一个类似于<a class="ae ky" href="https://hungvu.tech/WordPress.com" rel="noopener ugc nofollow" target="_blank">WordPress.com</a>的东西，一个几乎没有代码的环境。交互是通过管理面板中的图形用户界面。在这三个引擎中，只有谷歌计算引擎(GCE)能满足我的需求，所以我选择了它。</p><h1 id="c0aa" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问:价格呢？</h1><p id="bae5" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">幸运的是，谷歌为 GCE 提供了一个免费的等级。2021 年，Google 将一个免费 GCE 实例的规范从<code class="fe mn mo mp mq b">f1-micro</code>升级到<code class="fe mn mo mp mq b">e2-micro</code>，这对于我的用例来说已经足够了。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mr"><img src="../Images/6b8a394307ad6ccfd1ba3b6b5878188e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rZ7PNBwvOood82MO"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">谷歌计算引擎免费层</figcaption></figure><h1 id="960b" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问:GCE 是一个虚拟机实例，这意味着我必须从头开始配置一切？</h1><p id="7879" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">从某种意义上说，这是真的，但也是不利的一面。使用托管服务，如<a class="ae ky" href="http://WordPress.com" rel="noopener ugc nofollow" target="_blank">WordPress.com</a>意味着我还支付了所有的后端管理(软件栈和服务器配置)。走自主路线意味着我需要做所有的事情，是吗？</p><p id="fa0d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通常，一个成熟的平台会提供某种预配置的包。在这里，我有<a class="ae ky" href="https://cloud.google.com/marketplace" rel="noopener ugc nofollow" target="_blank">谷歌云市场</a>。在那里使用关键词“WordPress”进行普通搜索，会出现几个选项。就我而言，我选择了 Bitnami 认证的<em class="ms"> WordPress 和 automatic</em>。这个包是免费的，将为我做大部分的配置。况且这个包在某种意义上是跨平台的，所以我去亚马逊 Web Service (AWS)等另一家云提供商也会有同样的体验。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mt"><img src="../Images/83023683d2b4d55a60db6052de48f1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ElwDz3AV4QWsY8qk"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">GCP WordPress 设置的 Bitnami 包</figcaption></figure><p id="beee" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">注意</strong>，似乎没有官方的方法来更新已安装的堆栈，无论是通过 GUI 还是 SSH。我需要删除一个虚拟机，并使用最新的 Bitnami 包创建一个新实例。</p><h1 id="5f6e" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:我需要手动配置什么？</h1><p id="fa9d" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">这里有一些要考虑的。</p><ol class=""><li id="2be5" class="mu mv in ke b kf kg ki kj kl mw kp mx kt my kx mz na nb nc bi translated">虚拟机规范设置。</li><li id="5cfd" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">域设置，IP 设置，DNSSEC。</li><li id="e249" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">SSL 设置。</li><li id="34cf" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">HTTP/2 设置。默认情况下，配置是 HTTP/1.1。</li></ol><h1 id="b90b" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:第一步，虚拟机配置如何？</h1><p id="3223" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">使用自由层中指定的配置，我使用</p><ol class=""><li id="85a1" class="mu mv in ke b kf kg ki kj kl mw kp mx kt my kx mz na nb nc bi translated">区域:<code class="fe mn mo mp mq b">us-west1-a</code></li><li id="f34d" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">机器类型:<code class="fe mn mo mp mq b">e2-micro</code></li><li id="bd27" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">启动盘:30 GB，硬盘</li></ol><p id="89bb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">其他设置为默认设置。接受服务条款并继续创建实例。这可能需要几分钟时间。完成后，现在我可以使用提供的 VM 的外部 IP 地址登录 WordPress admin。</p><p id="c42f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是自托管的，所以我拥有常规 WordPress 应用程序的全部功能。插件现在可以用了。一些在<a class="ae ky" href="https://hungvu.tech/WordPress.com" rel="noopener ugc nofollow" target="_blank">WordPress.com</a>上实现的特定功能不会在这里出现，我猜是专有的吧？</p><h1 id="b635" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:第二步，如何维护静态 IP 地址，设置域名？</h1><ol class=""><li id="8be3" class="mu mv in ke b kf lr ki ls kl ni kp nj kt nk kx mz na nb nc bi translated">默认情况下，GCE 的 IP 地址是短暂的，这意味着它会在每次重置后发生变化。我需要一个静态 IP 地址，这样我的域就可以始终指向正确的位置。为此，转到<em class="ms"> VPC 网络/外部 IP 地址</em>并为 GCE 实例保留一个静态 IP 地址。</li><li id="0995" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">我需要注册一个域名。大多数域名注册商也有 DNS 服务。然后我设置我的域指向 GCE 静态 IP 地址。这只是一个初始配置。</li></ol><p id="4882" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 Cloudflare DNS 页面上，有一个 DNSSEC 设置说明。设置相当简单，主要是复制和粘贴值。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/509da7f416b17159ce3b2f1fd2698537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/0*a3PPMpvg--4jxUZx"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">云闪上的 DS 记录</figcaption></figure><h1 id="b92e" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:第三步，如何设置 SSL 证书？</h1><p id="43c5" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">到目前为止，由于缺少 SSL 证书，我的网站是不安全的。有两个选项:</p><ol class=""><li id="2fbd" class="mu mv in ke b kf kg ki kj kl mw kp mx kt my kx mz na nb nc bi translated">从您的域名注册商处购买证书。通常，这是不必要的，除非您是一个大客户，需要对数百个域、子域进行适当的 SSL 管理和遵从。</li><li id="7c29" class="mu mv in ke b kf nd ki ne kl nf kp ng kt nh kx mz na nb nc bi translated">使用免费的，让我们加密可以通过 SSH 注册的 SSL 认证。这里可以看到<a class="ae ky" href="https://youtu.be/LDVQhN7zJvQ" rel="noopener ugc nofollow" target="_blank">的说明</a>。<strong class="ke io">注意</strong>，即使指令在亚马逊 Web 服务(AWS)上，也还是 Bitnami 栈，所以配置是一样的。所有目标子域名都必须注册，否则会导致 SSL 握手错误(例如，通过 CNAME 记录将<code class="fe mn mo mp mq b">www</code>映射到非 www)。</li></ol><p id="841b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，返回到 Cloudflare，将 SSL 模式更改为<code class="fe mn mo mp mq b">Full (strict)</code>。你的网站应该是安全的，这可以通过浏览器栏上的挂锁来检查。别忘了，Cloudflare 还有更多服务，您可以根据需要对它们进行微调。</p><h1 id="af14" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:第四步，如何设置 HTTP/2？</h1><p id="73cc" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">HTTP/2 比 HTTP/1.1 协议提供了更多的优势。另一家大型云提供商 Digital Ocean 的文章中有更详细的讨论。在我看来，最值得注意的是速度的提高，这可以通过灯塔测试看出。</p><p id="5af4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Bitnami 有一个关于用 HTTP/2 配置 Apache 服务器的官方文档。</p><p id="0cf2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">HTTP/2 支持可以使用<a class="ae ky" href="https://tools.keycdn.com/http2-test" rel="noopener ugc nofollow" target="_blank">关键 CDN 站点</a>进行测试，看起来我的成功了。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/40745d68598851c1626a9663abe4c835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tqNKDV8YOA4OOSNR"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">使用密钥 CDN 成功进行 HTTP/2 检查</figcaption></figure><h1 id="26b4" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">问题:为什么我在计费报告中看到一些小额费用？我以为这应该是免费的？</h1><p id="31b7" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">是的，设置是免费的，也就是说，如果我留在提供的配额。如下图所示，我的计算引擎实例有一些费用。我还没有找到根本原因，但我相信这是由于出口交通到中国或澳大利亚(不自由出口目的地)。在一些小尖峰之后，它再次回到零。如果您不为这些地区的客户提供服务，IP 地址块可能是一个选择。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/de1fab9c8e0f50a4a1e007907441e8e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*e93wnrr6TUuB0rW-"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">WordPress 的 GCE 实例的少量费用</figcaption></figure><h1 id="0b99" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">包裹</h1><p id="2cb6" class="pw-post-body-paragraph kc kd in ke b kf lr jo kh ki ls jr kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">这一次，我学到了一个省钱的方法，也是一个玩 GCE 服务的机会。当然，在考虑将应用程序投入生产之前还有很多任务，但是，我可以使用<a class="ae ky" href="https://wordpress.org/plugins/all-in-one-wp-migration/" rel="noopener ugc nofollow" target="_blank"> All-in-One WP Migration </a>将旧站点迁移到 GCE，所以没有太多事情要做。</p><p id="4d08" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我会说，一个意想不到的，但重要的教训是关于收费“免费”一个 GCE 实例。这意味着我需要在任何情况下都仔细监控账单。截至目前，当账单金额超过阈值时，GCP 似乎没有关闭服务的选项。幸运的是，这不是我身上的 1000 美元。</p></div></div>    
</body>
</html>