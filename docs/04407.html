<html>
<head>
<title>CircleCI — The Modern Cloud-Based Platform of Pipeline Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">circle ci——基于云的现代管道自动化平台</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/circleci-the-modern-cloud-based-platform-of-pipeline-automation-a5b293c9e171?source=collection_archive---------2-----------------------#2021-03-13">https://blog.devgenius.io/circleci-the-modern-cloud-based-platform-of-pipeline-automation-a5b293c9e171?source=collection_archive---------2-----------------------#2021-03-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ce1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">云计算之旅从 Jenkins 到 CircleCI</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2e6e82883529080ec17e74a9cc70098a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*voFl7OSu6degHiiOwfvZhA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">哈利勒·易卜拉欣·切廷卡亚在<a class="ae kv" href="/collections/45649460/modern-architecture?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2217" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">软件工程师花在业务功能开发上的时间越多，交付给业务的价值就越多。事实是，构建新的功能和业务逻辑需要程序员保持高度专注，以便进行分析、设计、编码和测试。然而，现实是，他们被许多其他任务分散了注意力和占用了他们日常工作的大部分时间。这些都是软件开发的开销，比如那些用于系统构建和部署的重复而乏味的手动过程。因此，在过去的几年中，自动化是许多公司软件开发团队的基调。</p><p id="e6ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CI/CD 管道无疑是 DevOps 支持的关键基础设施，因为它提供了自动化，并提供了允许开发和运营团队无缝合作的方法。Jenkins 是一个开源项目，是管道供应中最广泛采用的产品。它是免费的，成熟的，有强大社区支持的各种插件。虽然 Jenkins 是市场的主导者，但近年来出现了一些云平台，它们提供了出色的管道自动化服务。</p><p id="812b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CircleCI 是提供 CI/CD 管道即服务的流行平台之一。由于云计算的本质，它在易用性、效率和避免维护开销方面提供了无与伦比的优势。如果您正在寻找一种方法，使用 CircleCI 作为传统 Jenkins 管道的替代选项，如何快速设置自动化管道，那么这篇文章就是为您准备的。我将基于一个典型的 CI/CD 管道的例子来分享使用方法以及如何在 CircleCI 上创建管道。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5e2f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是 CI/CD 管道？</h1><p id="8485" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，我们快速说一下管道的概念。下图展示了一个典型的工作流程——编译、代码分析、测试用例执行、打包和部署到目标环境。每一步都将涉及一系列的命令执行，这些任务可能是单调乏味和重复的，而且容易因人为错误而出错。因此，它是通过自动化整个流程来高效运行工作流的管道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/07ee48c8e879baaefb5e64dde0330315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YSUj5zUJ82LXzhocjnTFVQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">典型的 CI/CD 管道(我自己制作的图表)</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f7c2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">CircleCI 一览</h1><p id="5805" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">CircleCI 是一个云平台，YAML 格式的管道声明性定义是您提供管道所需的全部内容。您的管道定义是完全自包含的，这意味着您可以运行您的工作流，而不用担心平台上的依赖插件或工具安装。此外，它利用 docker 映像的生态系统，您可以在指定的 docker 映像上运行作业，并访问映像中可用的任何工具。CircleCI 的管道设计涵盖了最常见的场景，它当然适合最典型的应用程序和团队结构。尽管如此，如果您的管道在复杂的企业环境中高度定制了特殊功能，Jenkins 仍然是一个合适的选择。</p><h2 id="007a" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">管道定义</h2><p id="8c58" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">CircleCI 的管道定义简单易懂。它采用 YAML 格式，这是一种人类可读的格式。该定义主要由两部分组成——作业和工作流。</p><p id="0f21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面这个简单的例子向您简要介绍了管道定义。本例中有两个作业-</p><ul class=""><li id="9990" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir"> <em class="ns">作业 1 </em> </strong> —在 docker 镜像上运行<strong class="ky ir"> alpine:3.7 </strong>有 2 个执行 echo 命令的步骤</li><li id="a39b" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir"> <em class="ns">作业 2 </em> </strong> —在 docker 映像<strong class="ky ir">circleci/Node:10-browsers</strong>上运行，这是 circle ci 为带有节点 JS 的执行环境预先构建的映像。该命令只是为了获取节点 JS 版本。</li></ul><p id="e483" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，工作流定义将作业放在一起形成一个管道。工作流指定作业 2 依赖于作业 1，因此管道首先执行作业 1，然后执行作业 2。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/7027928d42cca8a35bd0e440061e6dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mD6fbi1nFUnc_m_6Pq9c2g.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 管道定义(自己创建的图表)</figcaption></figure><h2 id="b8ff" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">CircleCI 管道概述</h2><p id="1146" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">基于流水线定义，CircleCI 启动单个 docker 容器或虚拟机来运行作业。该作业利用 docker 映像或 VM 映像附带的工具来执行命令，如 JDK、Maven、Node JS 等。换句话说，它通过使用预先配置了特定工具的映像，节省了工具安装和设置的工作量。因为每个作业都运行在一个单独的临时容器上，所以有一个持久数据存储的工具，这样同一管道中的所有作业将共享相同的上下文。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/dfda075cbd3f05f254f10f32d44e4f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vyNG4v3xOvEe0L4E5NyU_A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 管道组件(自己制作的图表)</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f138" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">实施概述</h1><h2 id="9814" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">关于示例管道</h2><p id="f059" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了演示 CircleCI 管道设置，我将基于一个典型的管道，逐步演示如何在 CircleCI 中实现管道。这里的示例管道是一个强制实施质量控制的 Java 应用程序的构建过程。关于 Jenkins 的概念和实现细节，你可以参考我的分享:</p><div class="oa ob gp gr oc od"><a href="https://medium.com/dev-genius/devops-software-quality-control-using-jenkins-ci-cd-pipeline-373ade18d738" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">DevOps—使用 Jenkins CI/CD 管道进行软件质量控制</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">Java 技术软件质量保证的基本技巧</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or kp od"/></div></div></a></div><p id="8334" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，在每一步结束时都实施了质量关，以确保在进入下一步之前满足特定的退出标准:</p><ul class=""><li id="2994" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir">单元测试</strong> —所有的单元测试用例都应该通过。</li><li id="6bbb" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">代码质量分析</strong> —代码分析的总体结果应该通过一组预定义的质量属性，例如 bug 发现、代码发布数量、单元测试覆盖率等。</li><li id="3b9f" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">集成测试</strong> —所有的集成测试用例都应该通过。</li><li id="6646" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">端到端测试</strong> —所有端到端测试用例都应该通过。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/793b0ad62c3c6198c78814e30cd4c655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApG8rltcOUuz06EqftS5AA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">具有质量关口的管道(我自己创建的图表)</figcaption></figure><h2 id="0f6d" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">CircleCI 是如何工作的？</h2><p id="2524" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在 CircleCI 工作流程中，每个步骤将被定义为一个单独的作业。由于它是一个 Java 应用程序，管道作业被配置为在 docker image<strong class="ky ir">circle ci/open jdk-11-JDK</strong>上运行，为整个管道的构建过程提供 JDK 和 Maven。</p><p id="fda2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pipeline 调用外部服务— SonarCloud，这是 Sonarqube 的云平台版本，用于源代码扫描和分析。</p><p id="dc86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于测试覆盖分析和代码分析，Maven 将检索插件来完成工作，因此相同的 docker 映像足以运行这些工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/123e5ef80b2fd15d52f0f03941687e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZtnCWSrGWpSQNC_RHvzEA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 管道中工具的使用(自己制作的图表)</figcaption></figure><h1 id="dc1b" class="lz ma iq bd mb mc ou me mf mg ov mi mj jw ow jx ml jz ox ka mn kc oy kd mp mq bi translated">管道的逐步演练</h1><p id="104a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">让我们看看 CircleCI 管道定义的实现细节。</p><h2 id="b485" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">1.构建源</h2><p id="7961" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">CircleCI 作业定义及说明:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/98b3effb0dba84142a96ce09d221d931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHdeUUgks9wgckeD9W6uBQ.jpeg"/></div></div></figure><ul class=""><li id="4b6d" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir">签出 Git 存储库源代码</strong>——第一步是从 Git 存储库签出源代码，内置命令“Checkout”可以为我们完成这项工作。</li><li id="a8d5" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">依赖关系缓存</strong> —在开始编译源代码之前，让我们通过下载并缓存所有依赖关系来加快流水线进程。它可以避免在后续作业中或在作业重新运行期间再次下载所有依赖项所需的时间。每个缓存都有一个相关的关键字，我们使用 Maven pom.xml 的校验和值作为关键字的一部分，以确定是否可以重用同一个缓存。如果 pom.xml 发生了变化，您可能已经添加或删除了依赖项。</li><li id="1d03" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">执行命令</strong> —这一步运行 Maven 命令来编译源代码。</li><li id="5fea" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">持久化工作空间</strong> —当您编译了源代码时，存储工作空间允许后续作业继续在其上工作。工作空间是所有作业在同一数据上下文中工作的缓冲区。</li></ul><h2 id="764c" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">2.运行测试—单元测试/集成测试/端到端测试</h2><p id="7dfd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">CircleCI 作业定义及说明:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/98b3effb0dba84142a96ce09d221d931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHdeUUgks9wgckeD9W6uBQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 工作定义—集成测试(自己创建的图表)</figcaption></figure><ul class=""><li id="ac94" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir">恢复工作区&amp;缓存</strong> —在源代码构建之后，测试用例执行的作业首先附加工作区，然后从缓存中恢复依赖关系。</li><li id="049a" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">执行命令</strong> —这一步运行 Maven 命令来运行测试。</li><li id="45a9" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">存储测试结果</strong> —如果您想在 CircleCI UI 屏幕上查看测试摘要，那么您可以在测试执行完成后存储测试结果。</li><li id="b312" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">持久化工作空间</strong> —同样，存储工作空间用于下一步。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/086aaace27f4c734aadc218797520dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HyHdJrF1b52Y22mJXoeSxg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 测试结果(在我的工作站上捕获的屏幕截图)</figcaption></figure><h2 id="eb5b" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">3.分析源代码</h2><p id="d87f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这一步将源代码提交给 SonarCloud，sonar cloud 是一个用于代码分析的云平台，然后等待分析结果。如果有主要的代码问题，新提交的代码就不能满足质量关。对于这种情况，管道应该触发警报并停止管道进程。</p><p id="64e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Orbs — CircleCI 可重用组件</strong></p><p id="b028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与其他步骤类似，Maven 插件非常有用，因为它支持向 SonarCloud 提交源代码。但是，没有办法检索分析结果。幸运的是，有人开发了一个<strong class="ky ir">orb</strong>“extendaretail/sonar cloud”来轮询分析进程状态并获得分析结果。“Orb”是 CircleCI 中一组可重用的作业和命令。就像编程中的函数一样，您可以使用 orb 并简化管道定义。</p><p id="e34d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在管道中使用 orb，您需要声明它并在管道中调用它的作业或命令。由于本例中的<strong class="ky ir">检查质量门</strong>命令需要报告任务文件。scannerwork 文件夹，以便获得 SonarCloud 状态检查的任务 id，这样您就可以看到在执行 maven 命令后有命令复制报告任务文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/7a0cfe94bd979c952fc4e21386bfb449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJilajWF-U11weQfvwn3cQ.jpeg"/></div></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b1d8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">将一切放在一起—工作流定义</h1><p id="30e2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">有了作业定义，让我们把它们粘在一起形成一个工作流。您将学习如何定义具有以下特征的工作流:</p><ul class=""><li id="8e17" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir">上下文注入</strong> —将敏感信息作为环境变量注入管道。</li><li id="1996" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">手动审批</strong> —在进行下一步之前提示手动审批。</li><li id="057b" class="nj nk iq ky b kz nt lc nu lf nv lj nw ln nx lr no np nq nr bi translated"><strong class="ky ir">作业执行顺序</strong> —顺序并行运行作业的定义。</li></ul><p id="354d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是流水线流程——源代码编译、单元测试和代码分析一个接一个地执行。一旦代码分析通过，集成测试和端到端测试都会被触发，它们将并行运行，以加速测试的执行。最后，在进行部署之前，需要进行人工批准。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/3dbad3aeccad01044e7e337ba4c0f8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hKLI_y6uRnwnDgQ-aJNgw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 工作流程(自己创建的图表)</figcaption></figure><h2 id="bae1" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">CircleCI 管道投入使用</h2><p id="cec8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是 CircleCI 管道概述，它显示了当前和历史管道执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/24ecc941cdedd2aa08ba855aef67f845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4iXTbQmfX8DG322Nd0cTw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 管道概述(在我的工作站上截取的屏幕截图)</figcaption></figure><p id="267e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">集成测试和端到端测试是并行执行的，因为它们只依赖于代码分析工作。一旦这两项都完成，pipeline 状态将变为“暂挂”并等待人工批准。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/5626f3140618b19aa154a03c3462b9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T3g4kexCEAboDOHPOVrrJw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI Pipeline —等待批准(在我的工作站上捕获的屏幕截图)</figcaption></figure><p id="09bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">批准人可以点击工作，然后提供批准。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/b5a0dbd99156aca5ffbb8799ec77d196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orHokxaYoXPYnT4aE4fkQg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI Pipeline 批准屏幕(在我的工作站上捕获的屏幕截图)</figcaption></figure><p id="d831" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦获得批准，管道将继续 rest 过程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/530a58ee7f11e04680db7f3e763d220b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8Wxup-TxYLczVhqmpGkgg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 管道-批准的流程(在我的工作站上捕捉的屏幕截图)</figcaption></figure><h2 id="92f5" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">上下文注入</h2><p id="2fad" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">SonarCloud 需要一个身份验证令牌来访问代码分析结果。我们应该把认证令牌放在哪里？出于安全考虑，我们绝不应该将这种敏感信息以纯文本格式放在管道定义中。CircleCI 为我们提供了一种在组织环境中定义凭证的方法，它会在管道执行期间自动将敏感信息作为环境变量注入。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/f8623d1be2df9ab1c9141086d5f99eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHwNGltYY36uos33coZzHw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 组织环境(在我的工作站上捕获的屏幕截图)</figcaption></figure><p id="d2ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在工作流定义中，您可以简单地将作业链接到类似于以下定义的上下文:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/fabcfca8f21682de48cf6a2d19582bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_59yY6A9mdRPEfJdu8jfrw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 工作流—带上下文的作业(我自己创建的图表)</figcaption></figure><h2 id="859d" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">人工批准</h2><p id="4801" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果您需要某人在某个时候手动给予同意，以便继续管道流程，那么您可以将类型属性设置为“批准”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/0e745bed1988b70c6c884bc6db483128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtJtxc9g0GO6i-R3GVjbYQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">循环工作流—工作需要批准(我自己创建的图表)</figcaption></figure><h2 id="290a" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">作业执行顺序</h2><p id="1936" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">使用“requires”属性指定作业依赖关系。CircleCI 会在所有必需的作业完成后启动作业。您可以参考下面的示例，该示例演示了并行运行作业的场景以及多个作业的相关性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/7b21042a229cacb7d1fabb42af9baacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWOdq2qmPw9drGnf9yk70w.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CircleCI 工作流程—作业执行顺序(自己创建的图表)</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ca13" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后的想法</h1><p id="5768" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">CircleCI 是一个强大的工具，因为它提供了一种快速的方式来建立一个自动化的管道，用于云平台中的持续集成。此外，使用 docker 映像作为作业执行环境使得工具的使用更加灵活，而不会影响环境的安装和维护。虽然 CircleCI 的工作流设计支持大多数场景，但它不能完全取代 Jenkins，因为某些用例有特定的管道要求，需要高度定制的流程。然而，如果你想建立一个新的管道或寻找一种方法来降低现有管道的维护成本，CircleCI 是值得探索的。</p><h2 id="1f6f" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">GitHub 知识库</h2><p id="cc3e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果您想详细研究示例实现，这里是带有 CircleCI 管道配置的示例应用程序的 Git 存储库</p><div class="oa ob gp gr oc od"><a href="https://github.com/gavinklfong/reactive-spring-forex-trade" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">gavinklfong/无功-弹簧-外汇-贸易</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">创建这个库的目的是展示 Spring framework 的主流非阻塞技术…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="pl l oo op oq om or kp od"/></div></div></a></div></div></div>    
</body>
</html>