<html>
<head>
<title>NodeJS Gateway — Part 1: Initial Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeJS 网关—第 1 部分:初始设置</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/building-a-payment-gateway-using-javascript-nodejs-a98e51f0ea6d?source=collection_archive---------4-----------------------#2022-08-23">https://blog.devgenius.io/building-a-payment-gateway-using-javascript-nodejs-a98e51f0ea6d?source=collection_archive---------4-----------------------#2022-08-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3a2ae43c1fff5c72a7b824c55e523fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*psAjSrWlIdEqTUbfgSgMoQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@flowforfrank?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">费伦茨·阿尔马西</a>在<a class="ae jz" href="https://unsplash.com/s/photos/javascript?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="dfe4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">距离我上一篇关于使用 Javascript 构建支付解决方案的文章已经过去 3 个多月了。</p><div class="ky kz gp gr la lb"><a href="https://medium.com/@nkunzecaleb/how-i-build-a-payment-gateway-using-javascript-2e4f3e52b7cd" rel="noopener follow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">我如何使用 Javascript 构建支付网关。</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">在我的大学/学院学习之后(大约 5 年前)，我渴望建立一个项目，不仅是为了创收…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jt lb"/></div></div></a></div><p id="58f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，对于一个朝九晚五的人来说，这有时会让人不知所措，我很高兴能够最终完成如何使用 Javascript 构建支付网关或解决方案的未来系列的一部分。</p><p id="b58e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上一篇文章中，我谈到了我为什么选择 Javascript，我在这里不再重复，但是，我已经意识到使用其他框架(不是 JavaScript)或语言也可以给你一个非常好的和健壮的解决方案。因此，我将在未来分享如何使用其他语言(PHP 和 Python)和框架(Laravel 和 Django)来提出类似甚至更好的解决方案。这完全取决于你熟悉哪一个。</p><p id="b894" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，现在让我们深入网关(JavaScript — NodeJS)。</p><h1 id="18a1" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">开始</strong></h1><p id="644e" class="pw-post-body-paragraph ka kb in kc b kd mo kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">这样，我们将使用 TypeScript，我认为这比只使用 JavaScript 更有优势，可以避免可能已经渗透到运行时的错误。你看，基本 JavaScript 是动态的和弱类型的，这可能会给管理不断增长的代码库带来挑战，而 TypeScript 是 JavaScript 的超集，具有强大的静态类型、编译和面向对象的编程特性，这在查看大型代码项目或不断增长的代码库(如支付网关)时很方便(从上一篇博客中，你会看到我们正在考虑移动货币集成、VISA 和 MasterCard、SMS、电子邮件和其他计费和安全功能，这些功能往往会不断变化)</p><p id="62bb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">既然我们已经解决了这个问题，让我们从用 TypeScript、Express 和 MongoDB 设置网关开始。</p><h2 id="8a0d" class="mt lr in bd ls mu mv dn lw mw mx dp ma kl my mz me kp na nb mi kt nc nd mm ne bi translated">第一步</h2><p id="8973" class="pw-post-body-paragraph ka kb in kc b kd mo kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">我们将创建我们的文件夹并移入其中:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="e05b" class="mt lr in nk b gy no np l nq nr">$ mkdir gateway<br/>$ cd gateway</span></pre><p id="a8bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们可以开始初始化我们的 npm 项目:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="555c" class="mt lr in nk b gy no np l nq nr">$ npm init</span></pre><p id="78ad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用<code class="fe ns nt nu nk b">-y</code>标志，通过自动说 yes 来使用默认的<code class="fe ns nt nu nk b">npm init</code>。然而，对我来说，我喜欢把它个人化😎所以我想出了这样的东西:</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="71a9" class="mt lr in bd ls mu mv dn lw mw mx dp ma kl my mz me kp na nb mi kt nc nd mm ne bi translated">步骤 2 -添加和配置 TypeScript</h2><p id="8bdc" class="pw-post-body-paragraph ka kb in kc b kd mo kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">初始化我们的项目后，接下来是添加和配置 TypeScript。请记住，这是在我们的网关文件夹中完成的。</p><p id="6d96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们安装如下的字体:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="8aae" class="mt lr in nk b gy no np l nq nr">$ npm install --save-dev typescript</span></pre><p id="0133" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们向根目录<code class="fe ns nt nu nk b">gateway</code>添加一个<code class="fe ns nt nu nk b">tsconfig.json</code>文件，用于配置 TypeScript 的编译选项。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="ac15" class="mt lr in nk b gy no np l nq nr">$ nano tsconfig.json</span></pre><p id="3c29" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后插入下面的代码:</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="ae00" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">查看上面的片段，下面是对我们使用的变量的简单解释:</p><ul class=""><li id="c5cf" class="nx ny in kc b kd ke kh ki kl nz kp oa kt ob kx oc od oe of bi translated"><code class="fe ns nt nu nk b">module</code>:指定模块代码生成方式。节点使用<code class="fe ns nt nu nk b">commonjs</code>。</li><li id="876c" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><code class="fe ns nt nu nk b">esModuleInterop</code>:在导入过程中启用 CommonJS 和 es 模块之间的互操作性。</li><li id="8e10" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><code class="fe ns nt nu nk b">target</code>:指定输出语言级别(我们用的是 ES6)。</li><li id="305e" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><code class="fe ns nt nu nk b">moduleResolution</code>:这有助于编译器理解导入指的是什么。值<code class="fe ns nt nu nk b">node</code>模拟节点模块解析机制。</li><li id="e0ec" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><code class="fe ns nt nu nk b">sourceMap</code>:分别创建。允许调试器和其他工具在处理发出的 JavaScript 文件时显示原始 TypeScript 源代码的映射文件。</li><li id="9454" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><code class="fe ns nt nu nk b">outDir</code>:编译后输出<code class="fe ns nt nu nk b">.js</code>文件的位置。在我们的项目中，我们将使用<code class="fe ns nt nu nk b">dist</code>文件夹。</li></ul><p id="62a1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里阅读更多相关信息<a class="ae jz" href="https://www.typescriptlang.org/docs/handbook/compiler-options.html" rel="noopener ugc nofollow" target="_blank"> TypeScript 编译器选项</a></p><h2 id="1a63" class="mt lr in bd ls mu mv dn lw mw mx dp ma kl my mz me kp na nb mi kt nc nd mm ne bi translated">步骤 3 -添加和配置 Express 服务器</h2><p id="ea03" class="pw-post-body-paragraph ka kb in kc b kd mo kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">让我们从安装 express 开始:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="879e" class="mt lr in nk b gy no np l nq nr">$ npm install --save express<br/>$ npm install -save-dev @types/express</span><span id="990d" class="mt lr in nk b gy ol np l nq nr">//We use the @types/express package for TypeScript to know about the types of Express classes.</span></pre><p id="b974" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我们在我们的<code class="fe ns nt nu nk b">gateway</code>文件夹中创建<code class="fe ns nt nu nk b">src</code>文件夹来保存扩展名为<code class="fe ns nt nu nk b">.ts</code>的类型脚本文件:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="da91" class="mt lr in nk b gy no np l nq nr">$ mkdir src</span></pre><p id="e330" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们添加一个名为<code class="fe ns nt nu nk b">app.ts</code>的文件，它将作为我们的主项目应用程序，我们稍后将在<code class="fe ns nt nu nk b">package.json</code>中添加相应的传输<code class="fe ns nt nu nk b">app.js</code>文件，以作为主文件运行，而不是作为<code class="fe ns nt nu nk b">index.js</code>:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a845" class="mt lr in nk b gy no np l nq nr">$ nano src/app.ts</span></pre><p id="d3d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加下面的代码来创建一个极简的 express 服务器:</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1a74" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的代码创建了一个运行在端口<code class="fe ns nt nu nk b">3000</code>上的 express 服务器。让我们继续编译，然后运行我们的服务器来测试是否一切正常。为了进行编译，我们在终端中运行以下命令:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="2883" class="mt lr in nk b gy no np l nq nr">$ npx tsc</span></pre><p id="1ec1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以上使用<code class="fe ns nt nu nk b">tsconfig.json</code>中的配置选项在<code class="fe ns nt nu nk b">dist</code>文件夹中生成<code class="fe ns nt nu nk b">.js</code>文件，我们将使用这些文件运行应用程序，如下所示:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="4ead" class="mt lr in nk b gy no np l nq nr">$ node dist/app.js</span></pre><p id="4e68" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了成功运行，我们将得到以下输出:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="e646" class="mt lr in nk b gy no np l nq nr">Express is listening at <a class="ae jz" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="2052" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在浏览器中打开该链接，并且应该能够在浏览器中看到<code class="fe ns nt nu nk b">Hello World!</code>。Hurayyyy！！您已经设置并配置了 express 服务器。可以打开<code class="fe ns nt nu nk b">dist/app.js</code>看看是什么样子。下面是一个片段。</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="c455" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，让我们安装和配置 MongoDB。</p><h2 id="7e03" class="mt lr in bd ls mu mv dn lw mw mx dp ma kl my mz me kp na nb mi kt nc nd mm ne bi translated">步骤 4 -添加和配置 MongoDB</h2><p id="9259" class="pw-post-body-paragraph ka kb in kc b kd mo kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">首先，你需要确保你的机器上已经安装并运行了 MongoDB，你可以根据你的操作系统使用下面的链接来安装、运行和创建一个数据库(在我们的例子中应该是<code class="fe ns nt nu nk b">gateway</code>)。</p><ul class=""><li id="e21f" class="nx ny in kc b kd ke kh ki kl nz kp oa kt ob kx oc od oe of bi translated"><strong class="kc io">在 MacOS 上</strong><br/><a class="ae jz" href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-os-x/" rel="noopener ugc nofollow" target="_blank">https://www . MongoDB . com/docs/manual/tutorial/install-MongoDB-On-OS-x/</a></li><li id="f31b" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><strong class="kc io">在 Linux 上</strong><a class="ae jz" href="https://www.mongodb.com/docs/manual/administration/install-on-linux/" rel="noopener ugc nofollow" target="_blank">https://www . MongoDB . com/docs/manual/administration/install-On-Linux/</a></li><li id="46d4" class="nx ny in kc b kd og kh oh kl oi kp oj kt ok kx oc od oe of bi translated"><strong class="kc io">在 Windows 上<br/></strong><a class="ae jz" href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-windows/" rel="noopener ugc nofollow" target="_blank">https://www . MongoDB . com/docs/manual/tutorial/install-MongoDB-On-Windows/</a></li></ul><p id="c9b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以使用下面的命令将<code class="fe ns nt nu nk b">mongodb</code>和<code class="fe ns nt nu nk b">mongoose</code>添加到我们的项目中:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a837" class="mt lr in nk b gy no np l nq nr">$ npm install mongodb mongoose<br/>$ npm install -save-dev <a class="ae jz" href="http://twitter.com/types/mongodb" rel="noopener ugc nofollow" target="_blank">@types/mongodb</a> @types/mongoose</span></pre><p id="8f2f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将连接到我们通过更新<code class="fe ns nt nu nk b">app.ts</code>代码创建的数据库，如下所示:</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="77d1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经导入了 mongoose 模块，并使用它连接到使用 url <code class="fe ns nt nu nk b">mongodb://localhost:27017/gateway</code>的数据库。在成功的<code class="fe ns nt nu nk b">db</code>连接上，express 服务器将被启动，您将得到以下输出:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="2605" class="mt lr in nk b gy no np l nq nr">Express is listening at <a class="ae jz" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="88a9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哇！这是一个很长的线程，但我很感谢你花时间来通过它。如果您能为这个系列和其他主题的未来帖子鼓掌，甚至跟随我，那将是非常棒的。接下来，我们将看看数据库操作。</p><p id="015b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想在这篇文章中使用代码，你可以使用下面的链接:</p><div class="ky kz gp gr la lb"><a href="https://github.com/Cank256/payie/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">GitHub - Cank256/payie:支付解决方案项目</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">支付解决方案项目。在 GitHub 上创建一个帐户，为 Cank256/payie 开发做贡献。</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">github.com</p></div></div><div class="lk l"><div class="om l lm ln lo lk lp jt lb"/></div></div></a></div></div></div>    
</body>
</html>