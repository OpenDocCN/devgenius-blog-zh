<html>
<head>
<title>Better JavaScript — Things that Shouldn’t be Automatic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好的JavaScript——不应该是自动的</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/better-javascript-things-that-shouldnt-be-automatic-3ba96fc4e572?source=collection_archive---------9-----------------------#2020-10-05">https://blog.devgenius.io/better-javascript-things-that-shouldnt-be-automatic-3ba96fc4e572?source=collection_archive---------9-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1a15a0d86b20363847b79796f0843dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D40CT-ZqteBr7rK3"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="eb51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究改进JavaScript代码的方法。</p><h1 id="2579" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">胁迫的问题</h1><p id="017d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">数据强制不会将数据更改为我们期望的格式。</p><p id="fdf0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a508" class="mn lc iq mj b gy mo mp l mq mr">const date = new Date("2020/12/31");<br/>date == "2020/12/31"</span></pre><p id="d9b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么比较将是<code class="fe ms mt mu mj b">false</code>。</p><p id="8117" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为<code class="fe ms mt mu mj b">date</code>转换成了字符串it:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="90a5" class="mn lc iq mj b gy mo mp l mq mr">"Thu Dec 31 2020 00:00:00 GMT-0800 (Pacific Standard Time)"</span></pre><p id="0806" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">toString</code>方法转换成它想要的格式。</p><p id="e8b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要将日期转换为YYYY/MM/DD格式，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0e79" class="mn lc iq mj b gy mo mp l mq mr">function toYMD(date) {<br/>  const y = date.getFullYear(),<br/>    m = date.getMonth() + 1,<br/>    d = date.getDate();<br/>    return `${y}/${(m &lt; 10 ? "0" + m : m)}/${(d &lt; 10 ? "0" + d : d)}`;<br/>}</span></pre><p id="6fd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到年、月、日。</p><p id="bd95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们把它们放在一个字符串中。</p><p id="ccd8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果月份或日期有一个数字，那么我们在它前面加一个0。</p><p id="cad8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以将它们作为相同格式的字符串进行比较:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5598" class="mn lc iq mj b gy mo mp l mq mr">toYMD(date) === "2020/12/31";</span></pre><h1 id="449e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分号插入</h1><p id="68ae" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript让我们去掉分号。</p><p id="51fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，它只是自动为我们插入它。</p><p id="052a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这称为自动分号插入。</p><p id="7a82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript引擎自动将分号推断到我们的程序中。</p><p id="8db5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">分号插入机制在ES标准中。</p><p id="be58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着该机制可以在JavaScript引擎之间移植。</p><p id="a8df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">分号插入有其缺陷。</p><p id="e14c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们跳过分号，我们就无法避免学习它的规则。</p><p id="f630" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">分号存在于<code class="fe ms mt mu mj b">}</code>字符之前，一行或新行之后，或程序输入的结尾。</p><p id="559e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只能在一行、一个块或一个程序的末尾留下semucolons。</p><p id="7924" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4033" class="mn lc iq mj b gy mo mp l mq mr">function Point(x, y) {<br/>  this.x = x || 0<br/>  this.y = y || 0<br/>}</span></pre><p id="41f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2618" class="mn lc iq mj b gy mo mp l mq mr">function area(r) { r = +r return Math.PI * r ** 2 }</span></pre><p id="c909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到一个错误。</p><p id="4d78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，当下一个输入标记无法解析时，会插入一个分号。</p><p id="688a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f7c0" class="mn lc iq mj b gy mo mp l mq mr">a = b<br/>(foo());</span></pre><p id="0124" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与以下内容相同:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6cea" class="mn lc iq mj b gy mo mp l mq mr">a = b(foo());</span></pre><p id="5f87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b0a8" class="mn lc iq mj b gy mo mp l mq mr">a = b<br/>foo();</span></pre><p id="56b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">被解析为2条语句，因为:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="73e6" class="mn lc iq mj b gy mo mp l mq mr">a = b foo();</span></pre><p id="0495" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不是有效的JavaScript代码。</p><p id="3794" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们总是要注意下一个语句的开始，以检测我们是否可以省略分号。</p><p id="cece" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果下一行的第一个标记可以解释为语句的延续，我们就不能省略分号。</p><p id="16ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="71fa" class="mn lc iq mj b gy mo mp l mq mr">a = b<br/>["foo", "bar", "baz"].forEach((key) =&gt; {<br/>  //...<br/>});</span></pre><p id="c363" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么它被解释为:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d6f8" class="mn lc iq mj b gy mo mp l mq mr">a = b["foo", "bar", "baz"].forEach((key) =&gt; {<br/>  //...<br/>});</span></pre><p id="bbbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">括号表达式没有意义，因为我们在里面有多个项目。</p><p id="740e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2529" class="mn lc iq mj b gy mo mp l mq mr">a = b<br/>/foo/i.test(str) &amp;&amp; bar();</span></pre><p id="a5b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后这两行被解析为一条语句。</p><p id="a60e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个<code class="fe ms mt mu mj b">/</code>被视为除法运算符。</p><p id="6073" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个问题是当我们不用分号连接文件时。</p><p id="9a40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><p id="03bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">file1.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4296" class="mn lc iq mj b gy mo mp l mq mr">(function() {<br/>  // ...<br/>})()</span></pre><p id="787c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">file2.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4d05" class="mn lc iq mj b gy mo mp l mq mr">(function() {<br/>  // ...<br/>})()</span></pre><p id="63a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们可能会遇到问题。</p><p id="4d85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两个文件的内容在连接时可以被视为一个语句:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2418" class="mn lc iq mj b gy mo mp l mq mr">(function() {<br/>  // ...<br/>})()(function() {<br/>  // ...<br/>})()</span></pre><p id="f780" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在每个文件后连接这些文件:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8ea1" class="mn lc iq mj b gy mo mp l mq mr">(function() {<br/>  // ...<br/>})();<br/>(function() {<br/>  // ...<br/>})();</span></pre><p id="4720" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们不用担心连接时的分号。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/be6a17ea64367b50e743685b3efe2c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R96UH7uhCNghLmic"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="18dc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="979b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">省略分号有很多问题。</p><p id="6da9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该把它们放在我们自己身上，而不是让JavaScript引擎在错误的地方为我们做这些。</p><p id="5e4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们应该避免自动胁迫。</p></div></div>    
</body>
</html>