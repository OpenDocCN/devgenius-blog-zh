<html>
<head>
<title>How to Configure a Magento Multistore in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Dockerä¸­é…ç½®Magento Multistore</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/how-to-configure-a-magento-multistore-in-docker-5c26491d4ac5?source=collection_archive---------8-----------------------#2020-08-16">https://blog.devgenius.io/how-to-configure-a-magento-multistore-in-docker-5c26491d4ac5?source=collection_archive---------8-----------------------#2020-08-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/afe7cb1fafb7a30402f1ffcd04e9f5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMagqbMepn0qISltDnFKOg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">ä¿ç½—Â·åŸƒæ–½-æ´›æœ—åœ¨<a class="ae jz" href="https://unsplash.com/s/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="36d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨wardenä¸­ï¼Œå¯ä»¥ä¸ºæ‚¨çš„é¡¹ç›®è®¾ç½®å¤šä¸ªåŸŸã€‚Wardenä½¿ç”¨Traefikï¼Œå¹¶ä½œä¸ºå…¨å±€æœåŠ¡å®‰è£…ã€‚</p><p id="9ba9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Traefikç¡®ä¿è¯·æ±‚è¢«æ‹¦æˆªå¹¶å‘é€åˆ°æ­£ç¡®çš„åç«¯æœåŠ¡ï¼Œä¾‹å¦‚https://app . example 1 . test https://app . example 2 . testã€‚ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨HTTPåå‘ä»£ç†å’Œè´Ÿè½½å¹³è¡¡å™¨ã€‚</p><p id="56cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å®ƒè¿˜æœ‰ä¸€ä¸ªä»ªè¡¨æ¿æ¥ç›‘æ§ä¸åŒçš„æŒ‡æ ‡ã€‚è¿™ä¸ªä½ å»https:ã€https://traefik.warden.test/<a class="ae jz" href="https://traefik.warden.test/" rel="noopener ugc nofollow" target="_blank">å°±èƒ½æ‰¾åˆ°ã€‚</a></p><blockquote class="ky"><p id="a8eb" class="kz la in bd lb lc ld le lf lg lh kx dk translated">åå‘ä»£ç†æ˜¯ä½äºwebæœåŠ¡å™¨å‰é¢çš„æœåŠ¡å™¨ï¼Œå®ƒå°†å®¢æˆ·ç«¯(ä¾‹å¦‚webæµè§ˆå™¨)è¯·æ±‚è½¬å‘åˆ°é‚£äº›webæœåŠ¡å™¨ã€‚</p></blockquote><figure class="lj lk ll lm ln jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/3a7c121e482f2f72c6ffcd9a02f5d69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpVhk7cIf7HEMNOktiFX5w.png"/></div></div></figure><p id="0d13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»åœ¨Magentoä¸­è®¾ç½®äº†ä¸€ä¸ªå¤šå•†åº—ã€‚ä½ å¯ä»¥åœ¨æˆ‘ä¹‹å‰çš„åšå®¢æ–‡ç« <a class="ae jz" href="https://rickdaalhuizen.com/posts/how-to-create-a-multi-store-in-magento/" rel="noopener ugc nofollow" target="_blank">â€œå¦‚ä½•åœ¨Magento 2ä¸­è®¾ç½®ä¸€ä¸ªå¤šå•†åº—â€</a>ä¸­è¯»åˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p id="0793" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¦åœ¨æœ¬åœ°ä¸ºæ‚¨çš„Magentoå•†åº—è®¾ç½®å¤šåŸŸï¼Œå¿…é¡»è¿›è¡Œä»¥ä¸‹é…ç½®ã€‚</p><ol class=""><li id="bd71" class="lo lp in kc b kd ke kh ki kl lq kp lr kt ls kx lt lu lv lw bi translated">ä¸ºæ‚¨çš„æ–°åŸŸç­¾ç½²è¯ä¹¦</li><li id="5f6c" class="lo lp in kc b kd lx kh ly kl lz kp ma kt mb kx lt lu lv lw bi translated">é…ç½®Nginxå’ŒVarnishæ¥å¤„ç†æ¥è‡ªæ–°åŸŸçš„æµé‡</li><li id="f629" class="lo lp in kc b kd lx kh ly kl lz kp ma kt mb kx lt lu lv lw bi translated">é€šè¿‡è®¾ç½®è¿è¡Œå‚æ•°ï¼Œé…ç½®Magento 2åŠ è½½ä¸åŒçš„å•†åº—æˆ–ç½‘ç«™ã€‚</li></ol><h1 id="3596" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">æ­¥éª¤1:ä¸ºæ–°åŸŸç­¾ç½²è¯ä¹¦</h1><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="de9f" class="nj md in nf b gy nk nl l nm nn">warden sign-certificate &lt;your_new_domain&gt;.test</span></pre><p id="eca0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿™å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚</p><ol class=""><li id="018f" class="lo lp in kc b kd ke kh ki kl lq kp lr kt ls kx lt lu lv lw bi translated">æ›´æ–°æ‚¨çš„sslè¯ä¹¦</li><li id="5672" class="lo lp in kc b kd lx kh ly kl lz kp ma kt mb kx lt lu lv lw bi translated">åˆ›å»ºæ–°çš„sslè¯ä¹¦ã€‚</li><li id="bd70" class="lo lp in kc b kd lx kh ly kl lz kp ma kt mb kx lt lu lv lw bi translated">æ›´æ–°Traefik</li></ol><p id="2f68" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿™æ˜¯è¾“å‡º</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="6db9" class="nj md in nf b gy nk nl l nm nn">â¯ warden sign-certificate sportdrinks.test<br/>==&gt; Generating private key sportdrinks.test.key.pem<br/>Generating RSA private key, <strong class="nf io">2048</strong> bit long modulus<br/>..+++<br/>......................+++<br/>e is <strong class="nf io">65537</strong> (0x10001)<br/>==&gt; Generating signing req sportdrinks.test.crt.pem<br/>==&gt; Generating certificate sportdrinks.test.crt.pem<br/>Signature ok<br/>subject=/C=US/O=Warden.dev/CN=sportdrinks.test<br/>Getting CA Private Key<br/>==&gt; Updating traefik<br/>traefik is up-to-date<br/>Connecting traefik to example_default network<br/>Connecting tunnel to example_default network<br/>Connecting mailhog to example_default network<br/>Restarting traefik ... <strong class="nf io">done</strong></span></pre><h1 id="4acd" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">æ­¥éª¤2:é…ç½®Nginxå’ŒVarnish</h1><p id="5c3c" class="pw-post-body-paragraph ka kb in kc b kd no kf kg kh np kj kk kl nq kn ko kp nr kr ks kt ns kv kw kx ig bi translated">ä»é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª. warden/warden-env.ymlæ–‡ä»¶ã€‚æ­¤æ–‡ä»¶è¶…å‡ºäº†wardenä¸­çš„ç¯å¢ƒæ¨¡æ¿ã€‚è¦æŸ¥çœ‹å®Œæ•´çš„é…ç½®ï¼Œè¯·ä½¿ç”¨:warden env configã€‚</p><blockquote class="ky"><p id="9ee4" class="kz la in bd lb lc ld le lf lg lh kx dk translated"><em class="nt">æ¯ä¸ªç¯å¢ƒçš„é…ç½®éƒ½ä½¿ç”¨ä¸€ä¸ªåŸºæœ¬é…ç½®YAMLæ–‡ä»¶å’Œä¸€ä¸ªå¯é€‰çš„darwinå’Œlinuxæ–‡ä»¶æ¥å°†æ‰€æœ‰å†…å®¹æ·»åŠ åˆ°åŸºæœ¬é…ç½®ä¸­ã€‚</em></p></blockquote><p id="9bb4" class="pw-post-body-paragraph ka kb in kc b kd nu kf kg kh nv kj kk kl nw kn ko kp nx kr ks kt ny kv kw kx ig bi translated">å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„ã€‚warden/warden-env.yml</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="ba06" class="nj md in nf b gy nk nl l nm nn"><strong class="nf io">version</strong>: "3.5"<br/><strong class="nf io">services</strong>:<br/>  <strong class="nf io">varnish</strong>:<br/>    <strong class="nf io">labels</strong>:<br/>      - traefik.http.routers.${WARDEN_ENV_NAME}-varnish.rule=<br/>          HostRegexp(`{subdomain:.+}.${TRAEFIK_DOMAIN}`)<br/>          || HostRegexp(`{subdomain:.+}.&lt;your_new_domain&gt;.test`)<br/>  <strong class="nf io">nginx</strong>:<br/>    <strong class="nf io">labels</strong>:<br/>      - traefik.http.routers.${WARDEN_ENV_NAME}-nginx.rule=<br/>          HostRegexp(`{subdomain:.+}.${TRAEFIK_DOMAIN}`)<br/>          || HostRegexp(`{subdomain:.+}.&lt;your_new_domain&gt;.test`)</span></pre><p id="a7fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç„¶åè¿è¡Œwarden env up -dæ¥æ›´æ–°æ‚¨çš„å®¹å™¨ã€‚</p><h1 id="830a" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">æ­¥éª¤3:é…ç½®Magento 2è¿è¡Œå‚æ•°</h1><p id="0fa0" class="pw-post-body-paragraph ka kb in kc b kd no kf kg kh np kj kk kl nq kn ko kp nr kr ks kt ns kv kw kx ig bi translated">åˆ›å»ºä¸€ä¸ªapp/etc/Stores.phpï¼ŒæŒ‰ç…§PSR-4æ ‡å‡†é€šè¿‡composer.jsonåŠ è½½ã€‚</p><p id="8080" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶app/etc/Stores.php:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="326d" class="nj md in nf b gy nk nl l nm nn">&lt;?php</span><span id="8010" class="nj md in nf b gy nz nl l nm nn"><strong class="nf io">use</strong> \Magento\Store\Model\StoreManager;<br/>$serverName = isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : <strong class="nf io">null</strong>;</span><span id="6587" class="nj md in nf b gy nz nl l nm nn"><strong class="nf io">switch</strong> ($serverName) {<br/>    <strong class="nf io">case</strong> app.&lt;your_new_domain&gt;.test':<br/>        $runCode = &lt;code&gt;;<br/>        $runType = &lt;type&gt;;<br/>        <strong class="nf io">break</strong>;<br/>}</span><span id="4042" class="nj md in nf b gy nz nl l nm nn"><strong class="nf io">if</strong> ((!isset($_SERVER[StoreManager::PARAM_RUN_TYPE])<br/>        || !$_SERVER[StoreManager::PARAM_RUN_TYPE])<br/>    &amp;&amp; (!isset($_SERVER[StoreManager::PARAM_RUN_CODE])<br/>        || !$_SERVER[StoreManager::PARAM_RUN_CODE])<br/>) {<br/>    $_SERVER[StoreManager::PARAM_RUN_CODE] = $runCode;<br/>    $_SERVER[StoreManager::PARAM_RUN_TYPE] = $runType;<br/>}</span></pre><p id="9a38" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿è¡Œä»£ç å’Œè¿è¡Œæ—¶é—´æ˜¯æ‚¨çš„Magentoå•†åº—æˆ–ç½‘ç«™çš„å•†åº—ä»£ç å’Œç±»å‹ã€‚æ‚¨å¯ä»¥åœ¨Stores -&gt; Settings -&gt; All Storesä¸‹æˆ–è€…åœ¨store_ *è¡¨ä¸­æ‰¾åˆ°å®ƒã€‚</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="9a0f" class="nj md in nf b gy nk nl l nm nn">{<br/>    "autoload": {<br/>        "files": [<br/>            "app/etc/stores.php"<br/>        ]<br/>    }<br/>}</span></pre><p id="af3d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿è¡Œcomposer dump-autoloadä»¥é‡æ–°ç”Ÿæˆè‡ªåŠ¨åŠ è½½é…ç½®ã€‚</p><p id="3b0d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç„¶åé‡æ–°å¯åŠ¨warden containerså¹¶å¯¼èˆªåˆ°æ‚¨çš„æ–°åŸŸåº”ç”¨ç¨‹åºã€‚<your_new_domain>.æµ‹è¯•</your_new_domain></p><h1 id="9367" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">è§‰å¾—è¿™ä¸ªå¸–å­æœ‰ç”¨å—ï¼Ÿè¯·ç‚¹å‡»ğŸ‘ä¸‹é¢çš„æŒ‰é’®ï¼:)</h1><h2 id="5f37" class="nj md in bd me oa ob dn mi oc od dp mm kl oe of mq kp og oh mu kt oi oj my ok bi translated">æ¥æº:</h2><ul class=""><li id="075e" class="lo lp in kc b kd no kh np kl ol kp om kt on kx oo lu lv lw bi translated"><a class="ae jz" href="https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/" rel="noopener ugc nofollow" target="_blank">ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ|ä»£ç†æœåŠ¡å™¨è§£é‡Š</a></li><li id="a24f" class="lo lp in kc b kd lx kh ly kl lz kp ma kt mb kx oo lu lv lw bi translated"><a class="ae jz" href="https://docs.warden.dev/configuration/multipledomains.html" rel="noopener ugc nofollow" target="_blank">å…¸ç‹±é•¿â€”â€”å¤šä¸ªåŸŸ</a></li></ul></div></div>    
</body>
</html>