# 红宝石真度

> 原文：<https://blog.devgenius.io/ruby-truthiness-b3c451e440ca?source=collection_archive---------9----------------------->

![](img/cea56f1274a9e0a31a5a5ba70cd8777d.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

表达“真”或“假”的能力在任何编程语言中都是一个重要的概念。它帮助我们建立条件逻辑，理解对象或表达式的状态。通常一个值是“真”还是“假”的概念在`boolean`数据类型中被捕获。一个`boolean`是一个对象，它的唯一目的是传达它是“真”还是“假”。

> "布尔运算最大的好处是，即使你错了，你也只错了一点点."
> 
> —未知

# 布尔运算

在 Ruby 中，布尔值由`true`和`false`对象表示。像 Ruby 中的其他东西一样，布尔对象背后也有一个真实的类，你可以在`true`和`false`上调用方法。

你可以在条件句中使用这两个布尔对象。

## 示例 1

下面会一直输出`'hi'`。

## 示例 2

反之，下面会一直输出`'goodbye'`。

在实际代码中，你不会在条件中直接使用`true`或`false`对象。相反，您可能会在条件表达式中计算一些表达式或方法调用。无论表达式是什么，它都应该计算为一个`true`或`false`对象。

## 示例 3

上述输出`"small number"`是因为表达式`num < 10`的计算结果为`true`。

## 实例 4

如果`some_method_call`返回真值，下面将输出`"it's true!"`。

当以这种方式使用方法调用作为条件表达式时，您通常会希望方法返回一个布尔值，而不是依赖于非布尔值返回值的真假。

## 实例 5

对两个表达式求值时，逻辑运算符将返回 truthy falsey 值。

*   `&&`是“and”运算符，在下面的例子中，只有当两个表达式都为真时，才会返回`true`。

没什么好惊讶的。但是请注意，我们不必将`num > 10`放在括号中。这意味着 Ruby 的操作符优先级顺序认为`>`比`&&`优先级高。换句话说，Ruby 没有被弄糊涂；它没想到你是想这么做:`num > (10 && num.odd?)`。

## 实例 6

你可以用`&&`链接任意多的表达式，它将从左到右进行计算。如果任意一个表达式为`false`，整个`&&`链将返回`false`。

*   `||`是“或”操作符，在下面的例子中，如果任一被评估对象为真，将返回`true`。它没有`&&`操作符严格。

## 例 7

返回`false`的唯一方法是如果所有表达式都是`false`。

*   `&&`和`||`操作符表现出一种被称为*短路*的行为，这意味着一旦能够保证返回值，它将停止对表达式求值。

## 实施例 8

当`&&`操作符遇到第一个`false`表达式时*会将*短路。

注意上面的代码没有生成`ZeroDivisionError`。这是因为`&&`操作符甚至没有对第二个表达式求值；由于第一个表达式是`false`，所以可以短路返回`false`。

另外，注意`false || 3/0`会产生一个错误。

## 示例 9

当`||`遇到第一个`true`表达式时会短路。

上面的代码没有生成`ZeroDivisionError`，因为`||`没有计算第二个表达式；遇到`true`后短路了。

与之前类似，注意`true && 3/0`会产生一个错误。

依赖短路行为可能很危险，但有时却很方便。我们将在下面的普通 Ruby 代码中看到一些使用它的例子。

# 真实性

在回顾了布尔和逻辑运算符之后，我们终于能够谈论“真”的概念了。真实与`true`的不同之处在于，Ruby 认为不仅仅是`true`对象是“真实的”。事实上，Ruby 是一种非常自由的语言，除了 `*false*` *和* `*nil*`之外，*认为一切都是真实的。*

这意味着我们可以在条件中使用任何表达式，或者使用逻辑运算符，只要它的计算结果不是`false`或`nil`，它就被认为是真的。注意，Ruby *认为真的表达式*与`true`对象不同。这就是“真实”的含义。让我们看一个例子。

如果你对 Ruby 一无所知，你可能会猜测上面应该输出`"error!"`，或者程序应该产生某种错误。但是如果你运行那个代码，它实际上会输出`"valid number"`。原因是 Ruby 认为任何整数都是“真的”。然而，这并不意味着上面的`num`变量等于`true`:

这意味着即使是整数`0`也被认为是真的，而在其他一些语言中却不是这样。Ruby 爱好者利用 Ruby 的真实性编写一些有趣的代码。例如，有时您会在条件或逻辑运算符中看到赋值:

据推测，`find_name`方法要么返回一个有效的对象，要么返回`nil`或`false`。像这样写代码是危险的，很容易被其他人误解为相等比较，而不是赋值。

更常见的是，您会看到这样的代码:

上面的`if`条件是检查`name`不是`nil`，然后检查`name`的有效性。如果`name`为`nil`，它就依靠`&&`短路行为不执行`name.valid?`来实现这一点。记住如果`&&`遇到`false`就会短路，而`nil`被认为是“假的”。

当包含条件、逻辑操作符和真实性考虑时，它会变得令人困惑。但是有了上面的知识，我们就可以慢慢练习拆开复杂的代码了。

> 记住这条规则:除了`false`和`nil`，Ruby 中的所有东西都被认为是“真实的”。