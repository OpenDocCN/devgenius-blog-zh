<html>
<head>
<title>Deploy Python App into Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Python 应用程序部署到 Kubernetes</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploy-python-app-into-kubernetes-4e783dbad320?source=collection_archive---------1-----------------------#2022-12-13">https://blog.devgenius.io/deploy-python-app-into-kubernetes-4e783dbad320?source=collection_archive---------1-----------------------#2022-12-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/b22847fe98e72d59365b5169cef4f8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*s7P6Gt3vnTdeFjnbPjeD0Q.png"/></div></figure><p id="6a83" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">本文旨在概述 Kubernetes/ <em class="kp"> K8s </em>的基础知识，并学习如何在 Kubernetes 中部署一个简单的 python 服务。</p><h2 id="745d" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated"><strong class="ak">什么是 Kubernetes / k8s？</strong></h2><p id="f210" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">Kubernetes 或简称 k8s 是一个开源的容器编排系统，允许部署、扩展和管理容器化的应用程序。</p><h2 id="9f63" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated"><strong class="ak">关键术语</strong></h2><ul class=""><li id="4915" class="lo lp in jt b ju lj jy lk kc lq kg lr kk ls ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp"> Image- </em> </strong>它是一个不可变的文件，包含运行一个 app 的源代码、库、依赖项和工具。</li><li id="0d72" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp">容器</em></strong>——它是一个图像的运行实例。</li><li id="070c" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp">集群- </em> </strong>是运行容器化 app 的节点集合。</li><li id="b346" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp">节点- </em> </strong>它是 Kubernetes 中计算硬件的最小单位。</li><li id="ca8d" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp"> Pod- </em> </strong>它们是 Kubernetes 中最小的可展开单位。每个 pod 可以由一个或多个容器组成。</li><li id="a9d0" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp">服务- </em> </strong>它支持对 Kubernetes 中的一组 pod 进行网络访问。</li><li id="461b" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><strong class="jt io"> <em class="kp">部署</em></strong>——用于创建或修改 pod 的实例，并向应用程序提供声明性更新。</li><li id="8665" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated"><a class="ae mc" href="https://medium.com/dev-genius/containerize-a-python-application-using-docker-f8cea56568dd" rel="noopener"><strong class="jt io"><em class="kp">Docker-</em></strong></a>它是一套用于构建、共享容器映像和运行容器的工具。</li></ul><figure class="me mf mg mh gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/f341ebdc704aeec45f6647de4ac34b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*H36Zr2EmfJMKi6KpEPFdmQ.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">概观</figcaption></figure><h2 id="c1af" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated"><strong class="ak"> Kubernetes 对象</strong></h2><p id="a714" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">它们是库伯内特系统中的持久实体。你可以创建这些对象，然后 Kubernetes 确保你想要的状态得到维护。Pods、服务、卷、名称空间、作业、cronjobs、部署是 kubernetes 对象的几个例子。每个对象都有两个特定的属性</p><ol class=""><li id="5156" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko mp lu lv lw bi translated"><strong class="jt io"> <em class="kp">状态- </em> </strong>对象的当前状态(创建、运行、终止、挂起等)</li><li id="89c9" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko mp lu lv lw bi translated"><strong class="jt io"> <em class="kp"> spec- </em> </strong>包含关于对象的详细信息(标签、要显示的端口、要运行的容器图像等)</li></ol><p id="94cf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Kubernetes 对象是用一个<a class="ae mc" href="https://medium.com/dev-genius/yaml-with-python-d6787a9bd8ab" rel="noopener"> YAML </a>文件描述的。这个<a class="ae mc" href="https://medium.com/dev-genius/yaml-with-python-d6787a9bd8ab" rel="noopener"> YAML </a>文件由一组称为必填字段的字段组成。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/8d233efb9ea22a43823b88a767fcb6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*TS8XJ7U_PTwjN7OJ9KrU-w.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">必填字段</figcaption></figure><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">pod 的示例描述</figcaption></figure><h2 id="398d" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">库贝特尔</h2><p id="32bb" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">它是一个命令行工具，用于对 Kubernetes 集群运行命令。kubectl 命令的一般语法是</p><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="c831" class="my kr in mu b be mz na l nb nc">kubectl &lt;command&gt;&lt;type&gt;&lt;name&gt;&lt;flag&gt;</span></pre><p id="b17e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">命令</em> </strong> -要执行的动作(删除、获取、应用、创建)</p><p id="2e61" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">类型</em> </strong> - kubernetes 对象(pod、service、deployment)</p><p id="245e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">名称</em></strong>——赋予 kubernetes 对象的名称</p><p id="d9f7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">标志</em> </strong> -指定选项</p><p id="b7c2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最常用的 kubectl 命令是:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c5395b821d95555e531de98adc823b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*J0YPVpkR1iIBHI2BmTRCFg.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">最常用的命令</figcaption></figure><h1 id="e720" class="ne kr in bd ks nf ng nh kv ni nj nk ky nl nm nn lb no np nq le nr ns nt lh nu bi translated">入门指南</h1><p id="739e" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">我们将创建一个简单的通知服务，其主要功能是发送电子邮件，然后将这个 python 服务部署到 kubernetes 中。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/240a98427b920cdf5077417449644d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDrCsi3w1QFqq2yuSWo3VQ.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">项目概述</figcaption></figure><h2 id="a1ef" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">1.装置</h2><ul class=""><li id="772c" class="lo lp in jt b ju lj jy lk kc lq kg lr kk ls ko lt lu lv lw bi translated">下载<a class="ae mc" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>，<a class="ae mc" href="https://kubernetes.io/releases/download/" rel="noopener ugc nofollow" target="_blank"> kubernetes </a></li><li id="660a" class="lo lp in jt b ju lx jy ly kc lz kg ma kk mb ko lt lu lv lw bi translated">安装库<a class="ae mc" href="https://flask.palletsprojects.com/en/2.1.x/installation/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>，<a class="ae mc" href="https://pypi.org/project/mailjet-rest/" rel="noopener ugc nofollow" target="_blank"> mailjet_rest </a></li></ul><h2 id="0045" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">2.密码</h2><ul class=""><li id="ced2" class="lo lp in jt b ju lj jy lk kc lq kg lr kk ls ko lt lu lv lw bi translated">app.py</li></ul><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">app.py(通知服务)</figcaption></figure><ul class=""><li id="fce5" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">requirements.txt</li></ul><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">requirement.txt</figcaption></figure><ul class=""><li id="74e7" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">Dockerfile 文件</li></ul><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">Dockerfile 文件</figcaption></figure><ul class=""><li id="91cf" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">部署. yml</li></ul><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">部署. yml</figcaption></figure><h2 id="2293" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">3.部署</h2><p id="a68b" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">打开“终端”并导航到项目。</p><ul class=""><li id="1da8" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">通过运行下面的命令从 Dockerfile 构建一个映像。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="0338" class="my kr in mu b be mz na l nb nc">docker build -t notification-service .</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oa"><img src="../Images/d6206165a4b250490ac6a23972c467c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GyxuRuxMpclVp2emweV6g.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">码头工人建造</figcaption></figure><ul class=""><li id="6395" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">要验证构建的映像，请使用以下命令。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="0a27" class="my kr in mu b be mz na l nb nc">docker images</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ob"><img src="../Images/f08bc8c79d7f792f9721316b27af9dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99ZLguvVZM1s1iIWU_YH5A.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">docker 图像</figcaption></figure><ul class=""><li id="d4a8" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">使用下面的命令创建部署对象。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="e24d" class="my kr in mu b be mz na l nb nc">kubectl apply -f deployment.yml</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oc"><img src="../Images/9c5d9774554b867dc40e9e2edb6640de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lz5l7TvYAS9Arjc4U1ph-Q.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">kubectl 应用</figcaption></figure><ul class=""><li id="5a1d" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">交叉检查已创建的部署和 pod 是否启动并运行。执行这两个命令。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="6967" class="my kr in mu b be mz na l nb nc">kubectl get deployments</span></pre><pre class="od mt mu mv bn mw mx bi"><span id="c676" class="my kr in mu b be mz na l nb nc">kubectl get pods</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oe"><img src="../Images/aba22aa001232159849e78c6fdf57d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ldop-eftCSgKj_RnLZRXw.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">kubectl get</figcaption></figure><h2 id="f248" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">4.测试</h2><ul class=""><li id="814b" class="lo lp in jt b ju lj jy lk kc lq kg lr kk ls ko lt lu lv lw bi translated">要测试通知服务的功能，首先进入交互终端，然后点击 curl 命令。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="cfc0" class="my kr in mu b be mz na l nb nc">kubectl exec -it notification-service-5545c8f696-2vdjf -- bash</span></pre><pre class="od mt mu mv bn mw mx bi"><span id="6210" class="my kr in mu b be mz na l nb nc">curl -H 'Content-Type: application/json' -d  '{"name": "Ashish M J" ,"email": "your_mail@gmail.com"}' -X POST http://localhost:5000/sendEmail</span></pre><p id="3caa" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">注意:替换第一个命令中的 pod 名称，并在第二个命令</em> </strong>中使用正确的 emailId</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ob"><img src="../Images/1e96bc3c20400c703b3a657b3d2cead4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muY-s-x-_-k8DfUbzNXoug.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">回应状态 202(已接受)</figcaption></figure><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi of"><img src="../Images/8ea358b091178f38edd3c960e58fdb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*enKikxs2gEarytbem8ncJg.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">收到电子邮件</figcaption></figure><ul class=""><li id="f1f6" class="lo lp in jt b ju jv jy jz kc mm kg mn kk mo ko lt lu lv lw bi translated">如果出现任何问题，可以通过执行以下命令来检查日志。</li></ul><pre class="me mf mg mh gt mt mu mv bn mw mx bi"><span id="57d1" class="my kr in mu b be mz na l nb nc">kubectl logs notification-service-5545c8f696-2vdjf</span></pre><p id="235b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">注:替换吊舱名称</em> </strong></p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ob"><img src="../Images/adeea41d7ac8ea653755de1028d1fd66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWbCq1ixUzOgGp5OzWTb3w.jpeg"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">kubectl 日志</figcaption></figure><h2 id="a986" class="kq kr in bd ks kt ku dn kv kw kx dp ky kc kz la lb kg lc ld le kk lf lg lh li bi translated">结论</h2><p id="e474" class="pw-post-body-paragraph jr js in jt b ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko ig bi translated">在这个故事中，我们已经了解了 kubernetes 的基础知识，并学习了如何通过简单的步骤将 python 应用程序部署到 kubernetes 中。希望你已经了解了 kubernetes 的基本知识。</p><p id="4b39" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">感谢阅读！</p><p id="103a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae mc" href="https://github.com/ashish-mj/Kubernetes" rel="noopener ugc nofollow" target="_blank">Github</a>T26】网站 T28】Linkedin</p></div></div>    
</body>
</html>