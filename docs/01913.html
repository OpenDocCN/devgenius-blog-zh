<html>
<head>
<title>The Unidirectional Data Flow and Time Traveling of States in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 中状态的单向数据流和时间旅行</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/the-unidirectional-data-flow-and-time-traveling-of-states-in-ios-24698d5d4a55?source=collection_archive---------6-----------------------#2020-07-14">https://blog.devgenius.io/the-unidirectional-data-flow-and-time-traveling-of-states-in-ios-24698d5d4a55?source=collection_archive---------6-----------------------#2020-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e31134f4a9a88eb42e9ddceb0e1016ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LF-HtFqMIS5s4067MCaA5w.jpeg"/></div></div></figure><p id="4f40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated">这些天来，我一直在开发一个功能，比如实现注册表单详细信息页面，在流程完成之前，我不想将它写入数据库。然而我在我的项目中使用了 MVVM 模式，这当然是一个非常简单和干净的架构，像这样积累中间状态会导致单例滥用和其他问题。</p><p id="5d15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些来自状态的多个副本，如果您允许您的应用程序来回导航，那么您必须确保最新视图控制器中的最新状态在其他视图控制器中也是可用的。维护通过委托或回调涉及的所有控制器的状态变得很麻烦。我想这种问题在 iOS 开发者中很常见。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/a48b676f5b4d0c747a8f10cdfdd5e4d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdYxunMUZTfGL9KzGX8qaA.jpeg"/></div></div></figure><p id="17e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，我选择在我的实现中集成单向数据流(Redux)方法和 MVVM。在这篇文章中，我试图解释单向数据流的<strong class="ka ir">工作流程</strong>流程(redux)和<strong class="ka ir">我们如何在我们的应用程序中使用它进行状态的时间旅行。</strong>吼吼！让我们开始…</p><blockquote class="lk ll lm"><p id="685a" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="iq">单向数据流</em> </strong>是使用基于 web 的应用程序的一个基本特性。</p></blockquote><p id="674a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据自上而下流动的原因是，从根组件开始，每次都要对每个组件自上而下地执行变更检测策略。这太棒了，因为单向数据流比周期更容易预测。</p><h1 id="a110" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">那么 Redux 是什么，它是如何工作的？</h1><p id="d10c" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">Redux 是脸书开发的<a class="ae mu" href="https://github.com/facebook/flux" rel="noopener ugc nofollow" target="_blank"> flux 框架</a>的替代或变体，脸书现在将其用于大多数 web 应用程序。主要思想是<strong class="ka ir">信息总是只向一个方向流动。</strong></p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/8ee5704ae89383949862d75e85cd769d.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*45vuFO_dmWn0Wj0VEREoOQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">redux 的单向数据流</figcaption></figure><p id="ba27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来分解一下每个组件在我们的实施中的作用，好吗…</p><ul class=""><li id="76e8" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated"><strong class="ka ir">视图</strong>:订阅<strong class="ka ir">存储</strong>变更并在屏幕上显示。观点派<strong class="ka ir">行动派</strong>。</li><li id="73ea" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><strong class="ka ir">动作</strong>:动作不包含任何代码，是描述状态变化的小段数据。一个动作由<strong class="ka ir">减速器</strong>操纵。</li><li id="edbf" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><strong class="ka ir">还原器</strong>:提供基于当前动作和当前 app 状态的纯函数，返回新的 app 状态。</li><li id="4b1e" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><strong class="ka ir">存储</strong>:存储应用状态的当前值。其他模块如<strong class="ka ir">视图</strong>可以订阅并对其变化做出反应。</li></ul><p id="9b99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将使用 Reswift 实现单向数据流。Reswift 是一个框架，帮助您在 swift 中创建类似 Redux 的架构。</p><p id="b960" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ln">我们将创建一个应用程序，从网络 api 获取热门电影列表，并包括像搜索电影的功能。然后我们将从 redux store 中获取搜索历史。</em></p><blockquote class="lk ll lm"><p id="f981" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">1.首先，我们需要从创建状态开始设置 ReSwift 的连接。</p></blockquote><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="f9fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">状态实际上是一个数据结构，包含子状态，如 navigationState <em class="ln">(例如，哪个视图当前是活动的)</em>，通常应用程序的每个视图都有一个子状态。在本例中，只有一个 AppState 包含两个视图的两个子状态。</p><blockquote class="lk ll lm"><p id="3c3d" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">2.我们还定义了两个动作，一个用于将搜索结果添加到存储中，另一个用于根据搜索关键字获取搜索历史。</p></blockquote><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><blockquote class="lk ll lm"><p id="3277" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">3.根据不同的动作类型，商店将通知 Reducer 返回新的状态。</p></blockquote><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="60af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了有一个可预测的应用程序状态，重要的是 reducer 总是没有副作用，它接收当前的应用程序状态和一个动作，并返回新的应用程序状态。然后我们把我们的减压器包在一个主减压器里，这样我们就可以一次注射到商店里。</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><blockquote class="lk ll lm"><p id="84a5" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">为了维护我们的状态并将操作委托给 reducers，我们需要一个存储。让我们称它为<code class="fe nq nr ns nt b">mainStore</code>，并将其定义为一个全局常量，例如在 app delegate 文件中:</p></blockquote><pre class="lg lh li lj gt nu nt nv nw aw nx bi"><span id="92c6" class="ny ls iq nt b gy nz oa l ob oc"><strong class="nt ir">var</strong> <em class="ln">mainStore</em> = Store&lt;AppState&gt;(reducer: appReducer, state: <strong class="nt ir">ni</strong></span></pre><blockquote class="lk ll lm"><p id="6626" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">在最后一步之前，我们需要在我们的视图中扩展<strong class="ka ir"> StoreSubscriber </strong>，这样每当有新的应用程序状态可用时，<code class="fe nq nr ns nt b"><em class="iq">Store</em></code>就会调用<code class="fe nq nr ns nt b"><em class="iq">newState</em></code>方法。这是我们需要调整视图以反映最新应用状态的地方。</p></blockquote><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="0525" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们都准备好了。咱们把行动调度电话扔了吧，吼吼！…</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/710139aac8a45f36d5b3b2094b744184.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*7_8OuMG7x-tuRX_k9psDOQ.jpeg"/></div></figure><blockquote class="lk ll lm"><p id="40e3" class="jy jz ln ka b kb kc kd ke kf kg kh ki lo kk kl km lp ko kp kq lq ks kt ku kv ij bi translated">最后，我们的视图层，在本例中是一个视图控制器，需要通过订阅存储更新并在应用程序状态需要更改时发出动作来绑定到这个系统:</p></blockquote><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="6757" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们可以看到时间旅行的能力，这有助于在应用程序的先前状态之间来回移动，并实时查看结果。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/a307eaf126c4acc0c412e6b8df90dfc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*ssqmMEdwYZuKPDWIgFoAXQ.gif"/></div></figure><p id="e93f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你觉得这篇文章有趣，对你的项目有用。欢迎任何问题或评论！</p><h1 id="ea92" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">参考链接</h1><div class="of og gp gr oh oi"><a href="https://github.com/ReSwift/ReSwift" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">resswift/resswift</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">支持的 Swift 版本:Swift 4.2、5.0 对于 Swift 3.2 或 4.0 支持使用 5.0.0 版或更早版本。对于 Swift 2.2…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow jw oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://medium.com/commencis/using-redux-with-mvvm-on-ios-18212454d676" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">在 iOS 上使用 Redux 和 MVVM</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">在我们开始之前，Redux 是什么？来自 redux.js.org:</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow jw oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://medium.com/mackmobile/getting-started-with-redux-in-swift-54e00f323e2b" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">with Redux 入门-第 1 部分</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">学习 Swift 中 Redux 开头的简单方法。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="oy l ot ou ov or ow jw oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://www.raywenderlich.com/516-reswift-tutorial-memory-game-app" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">ReSwift 教程:记忆游戏 App</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">在本 ReSwift 教程中，您将学习在 Swift 中创建一个类似 Redux 的应用架构，该架构利用单向…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">www.raywenderlich.com</p></div></div><div class="or l"><div class="oz l ot ou ov or ow jw oi"/></div></div></a></div></div></div>    
</body>
</html>