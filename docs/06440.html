<html>
<head>
<title>Why You Should Treat Your SQL Like Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么应该像对待代码一样对待SQL</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/why-google-treats-sql-like-code-and-you-should-too-53f97925037e?source=collection_archive---------1-----------------------#2022-01-08">https://blog.devgenius.io/why-google-treats-sql-like-code-and-you-should-too-53f97925037e?source=collection_archive---------1-----------------------#2022-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="af3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">在过去的两年里，我在一家大型硅谷科技公司工作，观察到数据工程师对待SQL的方式就像软件工程师对待代码一样。这种必胜的心态可以融入任何规模的任何公司的数据战略中。我将向您介绍将SQL视为代码可以带来哪些好处，并提供所有组织都可以从这些原则中受益的具体方法。</p><h2 id="aa12" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">SQL是一种查询语言。为什么我们要把它当成代码？</h2><p id="2b99" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">就像面向对象的代码一样，SQL编写起来很耗时，调试起来很费力，很难理解，会造成版本控制的挑战，并且必须是可维护的。从一家硅谷公司的角度来说；SQL也可以用来创建数据管道。当数据管道出现故障时，必须能够方便地调试和修复数据管道。考虑到所有这些因素，很明显代码集中化必须是数据策略的核心组成部分。</p><p id="7788" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了代码管理工具的额外好处，很容易理解谁在更改或维护给定的SQL脚本，并跟踪作者对其他相关查询的更改。它使查找失败的提交、恢复更改或应用相关的修复变得快速而容易。提交SQL代码后，代码会立即部署到开发环境中。然后可以执行开发管道，并立即识别和修复故障。定期地，测试环境发布发生，并且代码被提升以确保代码可能通过产品发布。一旦成功，自上一个生产发布以来提交的所有SQL的生产发布就发生了，并且在这个阶段，很少出现失败。</p><blockquote class="ls lt lu"><p id="b032" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><em class="iq">我的小公司能做些什么？</em></p></blockquote><p id="e5d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">观察你的软件工程文化；因为这可能是一种更成熟的文化，开始理解和采用他们可能使用的工具，如Git、IDE等。开始把所有代码公开，放到索引位置。花时间将脚本从本地位置迁移到全球位置，消除视图、物化视图和存储过程。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="d610" class="mg kv iq bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">我们如何使用工具来管理SQL代码</h1><p id="2407" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">大公司在大规模集中的代码库中管理几乎所有的代码。当需要对任何SQL进行更改，或者可能要创建新的脚本时，会创建一个更改列表；本质上类似于拉请求。通道在经过测试后，必须得到另一名工程师的批准。一旦评审者签字同意，作者就可以将代码变更提交给代码库。尽管变更控制在许多公司都很常见，但我在大公司观察到的一个关键区别是代码格式的重要性。虽然我以前不太重视代码格式，但是格式良好的代码大大减少了理解、调试和修改另一位作者的代码所需的时间。大多数具有成熟工程文化的公司非常重视代码格式，以至于存在自动拒绝不符合编码标准的变更的机制。</p><blockquote class="ls lt lu"><p id="7332" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated">我的小公司能做些什么？</p></blockquote><p id="7900" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择一个代码库，并坚持下去。理想情况下，代码存储库应该与工程共享，但至少要将所有SQL代码集中在一个存储库中。这应包括所有数据功能，如数据工程、分析、商业智能。开始采用代码格式标准。存在许多开源代码格式化工具。它易于采用，并极大地提高了代码的可读性和可维护性。花必要的时间(或编写必要的工具)通过格式化工具运行所有先前的代码，并要求所有未来的代码符合格式化标准。在几天或几周内，所有的数据工程师都将采用该标准，它使SQL更容易阅读、编写和理解。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="ab58" class="mg kv iq bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">为什么版本控制和环境节省了每个人的时间</h1><p id="cbd4" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">变更经常发生，如果没有版本控制，很容易实现难以补救的回归。有了版本控制，当提交的代码破坏了管道、产生了不需要的值或者不可执行时，可能很难确定为回滚所做的准确更改。这一原则与代码集成方法是一致的。当不受欢迎的改变被批准时(相信我；在一个结构良好的环境中，业务不会中断。SQL更改在提交时直接影响开发环境，并且可以在早期发现失败。在极少数情况下，代码更改在开发中成功(不要立即失败),但在生产中可能会失败。这可能是由许多因素造成的。在这种情况下，测试环境作为一种预生产环境被引入。</p><p id="5feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它可以很容易地用环境变量来管理，这些变量可以通过工具(如DBT)中的解释层注入到表名中。</p><blockquote class="ls lt lu"><p id="5797" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><em class="iq">我的小公司能做些什么？</em></p></blockquote><p id="6296" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">至少实现一个开发环境是必不可少的。在您组织的数据基础设施的更大环境中测试代码将确保最小的失败。像DBT这样的免费开源工具增加了一个抽象层，使这变得容易。所有表可以存在两次；一次作为开发表，一次作为生产表。在每日、每周或每月的发布时间表中，自之前的发布时间表以来提交的所有代码都可以提升到生产环境中。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="1a0a" class="mg kv iq bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">广泛的代码访问</h1><p id="b8a3" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">具有广泛工程需求的公司利用大规模代码库来存储几乎所有的代码。有时很难知道谁是一个人产品的所有消费者。例如，一个软件工程师可能正在更新一个生产应用程序，如果没有一个可广泛访问的集中式代码库，他们可能不知道这些变化的下游结果。通过集中化，他们可以轻松搜索可能依赖于其应用程序输出的脚本、查询和其他应用程序，并通知适当的工程师，或协作进行同步更改。代码中的秘密是脱节开发的秘诀。虽然一些高度敏感项目的代码库可能并不广为人知，但它们是很少的，并且只针对一些最极端的情况。一些公司大规模运作，但是代码架构是建立在信任的基础上的；你也应该如此。</p><blockquote class="ls lt lu"><p id="d653" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated">我的小公司能做些什么？</p></blockquote><p id="2d93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更加信任和交流你的代码库和存储库。你的项目不需要像你可能认为的那样保密；从工程的角度来看。停止雇佣你不信任的工程师来查看你的整个代码库。鼓励软件工程和数据工程之间更多的合作。在代码投入生产之前处理下游后果的内置过程和程序。</p></div></div>    
</body>
</html>