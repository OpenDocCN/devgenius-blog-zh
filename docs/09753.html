<html>
<head>
<title>Building a data pipeline with Apache Airflow, Snowflake, AWS S3 and Slack alerts (part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Apache Airflow、雪花、AWS S3 和 Slack alerts 构建数据管道(第 1 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/building-a-data-pipeline-with-apache-airflow-snowflake-aws-s3-and-slack-alerts-part-1-e4c428d1c620?source=collection_archive---------4-----------------------#2022-09-10">https://blog.devgenius.io/building-a-data-pipeline-with-apache-airflow-snowflake-aws-s3-and-slack-alerts-part-1-e4c428d1c620?source=collection_archive---------4-----------------------#2022-09-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2cb8793501b7e06b98c4abbf1ead2a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rKmNQp5eXDdom9mFgp7aHA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由作者创建</figcaption></figure><p id="e567" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如今，许多组织依靠现代数据堆栈来构建高度可扩展、可靠且高效的管道。批处理是获取数据洞察力的关键，公司可以利用这些洞察力来实现其业务目标。</p><p id="24f1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这一系列文章中，我们构建了一个管道，使用 Apache Airflow 作为我们的编排器，使用 Snowflake 作为数据分析引擎，使用 S3 来存储已经处理的数据和 Slack 警报，以便获得关于管道执行的通知。</p><h2 id="b49b" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">目标:</h2><ul class=""><li id="396d" class="lq lr in kb b kc ls kg lt kk lu ko lv ks lw kw lx ly lz ma bi translated">了解数据集和业务需求</li><li id="e668" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">创建我们的雪花帐户，并设置模式和表</li><li id="4fa7" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">使用 docker-compose 在本地运行 Apache Airflow</li><li id="ce06" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">建立一个气流管道，并每天安排</li><li id="7c33" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">集成气流和松弛警报以获得通知</li></ul></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><h2 id="9d35" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated"><strong class="ak">数据集和我们正在解决的问题</strong></h2><p id="9d3b" class="pw-post-body-paragraph jz ka in kb b kc ls ke kf kg lt ki kj kk mn km kn ko mo kq kr ks mp ku kv kw ig bi translated">以下来自 Kaggle 的<a class="ae mq" href="https://www.kaggle.com/datasets/megelon/meetup?select=members.csv" rel="noopener ugc nofollow" target="_blank"> <em class="mr"> meetup 数据集</em> </a>包含关于属于特定群组的人的信息，这些人可以在特定的日子聚在一起谈论特定的话题。提出的问题是分析<strong class="kb io">有多少成员在前一天</strong>加入了一个特定的组，在某种意义上，我们可以将注意力集中在那个特定的组上。你可以想到任何其他业务需求，就像你在组织这些活动一样，也许哪个团体需要更多的食物或活动空间，没有限制？</p><h2 id="413f" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated"><strong class="ak">雪花和设置我们的账户、模式和表格</strong></h2><p id="46de" class="pw-post-body-paragraph jz ka in kb b kc ls ke kf kg lt ki kj kk mn km kn ko mo kq kr ks mp ku kv kw ig bi translated">雪花是一个软件即服务(SaaS)云解决方案，支持数据存储、处理和分析解决方案，您可以在 www.snowflake.com<a class="ae mq" href="http://www.snowflake.com" rel="noopener ugc nofollow" target="_blank">了解雪花提供的方法的更多信息。在本教程中，我们将使用它作为我们的数据仓库解决方案，所以让我们开始吧。</a></p><p id="9bf9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">a)我们需要创建一个免费的雪花账户。截至目前，您可以使用以下链接中的<a class="ae mq" href="https://signup.snowflake.com/" rel="noopener ugc nofollow" target="_blank">进行操作。填写必填字段，并选择标准版本，亚马逊网络服务作为云提供商，美国东部(北弗吉尼亚)作为 AWS 地区，然后点击<em class="mr">“开始”</em>。您应该会收到一封电子邮件到您的收件箱，并将被重定向到创建您的雪花帐户。</a></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/415faace33b43403f9f7798e30e79888.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/0*OnLAhPnZbz-HTI-Z"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图一。在雪花中创建免费帐户</figcaption></figure><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/2800fe0629e7e83a5884c1315aea417e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/0*2XBtw-xwoUCVzf77"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="my">图二。在雪花中创建你的用户名</em></figcaption></figure><p id="c3c5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们准备好出发了。您应该能够访问如图 3 所示的雪花。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/e27c6c08e65e5f35b638470296545a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SeOJzMMgJ76A5Mqj"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="my">图 3。雪花的首次使用</em></figcaption></figure><p id="1bcc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">b)现在，让我们从 Kaggle 下载我们的<a class="ae mq" href="https://www.kaggle.com/datasets/megelon/meetup" rel="noopener ugc nofollow" target="_blank">数据，以便将其导入到雪花中。点击“下载”按钮，你会在默认的下载文件夹中看到一个“archive.zip”文件。提取它，你会得到 9 个 CSV 文件。</a></p><p id="be84" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">c)我们还需要下载 SnowSQL，这是雪花的命令行界面，以便将本地文件加载到平台中。为此，使用 Windows 中的<a class="ae mq" href="https://docs.snowflake.com/en/user-guide/snowsql-install-config.html#installing-snowsql-on-microsoft-windows-using-the-installer" rel="noopener ugc nofollow" target="_blank">链接</a>下载它。你也可以用自制软件安装<a class="ae mq" href="https://docs.snowflake.com/en/user-guide/snowsql-install-config.html#installing-snowsql-on-macos-using-homebrew-cask" rel="noopener ugc nofollow" target="_blank">用于 MacOS 的 SnowSQL】。在安装向导的最后，将提示您需要访问终端来执行 SnowSQL。</a></p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/96de3a5ab9d4df01992d7d730fca5e2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/0*5LRsv9fwNQ-FLm_f"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="my">图 4。SnowSQL 安装向导</em></figcaption></figure><p id="2cf5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">d)那么……我们从雪花那里得到这个帐户名称呢？它在用户界面上。如果您还记得，当您第一次登录时，在左下角我们可以获得如图 5 所示的这些详细信息。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/c499ef8f041a9a48b9fb152193f8af09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KjPmZ6gg2OfmeZBp"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="my">图五。雪花账户详情</em></figcaption></figure><p id="df4d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">复制帐户 id 和地区(在我的例子中，我得到了:<a class="ae mq" href="https://kdb00834.us-east-1.snowflakecomputing.com" rel="noopener ugc nofollow" target="_blank">https://kdb00834.us-east-1.snowflakecomputing.com</a>，因此相应的<em class="mr"> &lt;帐户名称&gt; </em>应该是 kdb00834.us-east-1)并在您的终端中执行以下命令:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="cb7b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">输入您的密码，我们就可以使用雪花。</p><p id="149e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，将以下查询(<strong class="kb io">不要忘记更改您下载的文件夹的位置</strong>)粘贴到终端中，以便为 CSV 文件创建我们的数据库、模式、文件格式和 stage。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="fe48" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您应该会在 UI 中看到以下视图:</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/cb5307b50e512651b789e4aa026a9bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*a7rfeLWY17lDm8dK"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="my">图 6。在雪花中创建的表格</em></figcaption></figure><p id="492b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，您已经成功地将 CSV 文件和相应的数据库、模式和表加载到了雪花中。您可以随意查看这些查询，并对它们进行试验，这样您就可以真正了解实际情况了。</p><p id="7e87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，是气流时间…让我们在之后的<a class="ae mq" href="https://medium.com/@kevin.pereda26/building-a-data-pipeline-with-apache-airflow-snowflake-aws-s3-and-slack-alerts-part-2-f97403ceac1f" rel="noopener">中查看一下。</a></p></div></div>    
</body>
</html>