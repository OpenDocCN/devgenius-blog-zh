<html>
<head>
<title>TLS and Mutual TLS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TLS 和相互 TLS</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/tls-and-mutual-tls-e00d47eb647b?source=collection_archive---------6-----------------------#2022-01-22">https://blog.devgenius.io/tls-and-mutual-tls-e00d47eb647b?source=collection_archive---------6-----------------------#2022-01-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安全通信的基础知识</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a255b8293cb765f9ec4ce2b12af94404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PuPOmckH-7um3akt5B_6Vg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</figcaption></figure><p id="5163" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我们在互联网(或类似互联网的媒体)上做任何活动时，我们基本上都在发送和接收数据。</p><p id="6d0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些数据可以以原始格式传输，任何用户都可以读取(从二进制转换后)。这有点像过去的“明信片”。但是如果你想让任何人都不能阅读它，我们必须加密数据。</p><h2 id="1a38" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated">对称加密:</h2><p id="f031" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">在这种情况下，共享密钥用于加密和解密数据。任何有密钥的人都可以解密加密的数据。</p><p id="760f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该方法实现简单，占用计算资源少，速度快。另一方面，共享加密密钥是一个挑战。</p><h2 id="e67c" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated">不对称加密:</h2><p id="6a1d" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">在这种情况下，加密密钥和解密密钥是不同的。用公钥加密的数据可以只用私钥解密，反之亦然。</p><p id="8c30" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它很复杂，需要更多的计算资源，并且比对称加密慢。优点是它非常安全。</p><h1 id="780c" class="lw kz in bd la lx ly lz ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm bi translated">传输层安全性:</h1><p id="a991" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">我们举个简单的例子。我想转账，为此我需要从我的桌面登录我的银行账户。我连接到银行，输入客户 id 和密码等敏感信息。</p><blockquote class="mn mo mp"><p id="0a1e" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">如果我与银行的沟通渠道不安全，这些信息可能会泄露。为了确保这种情况不会发生，需要解决以下问题</p></blockquote><ol class=""><li id="710f" class="mu mv in jm b jn jo jr js jv mw jz mx kd my kh mz na nb nc bi translated">所有信息都被加密了。</li><li id="81fb" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh mz na nb nc bi translated">加密应该是健壮的和强有力的，这样除了预期的系统之外没有人能解密它——在这个例子中是银行服务器。</li><li id="5ef9" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh mz na nb nc bi translated">信息被发送到银行服务器，而不是任何伪装成银行服务器的系统。</li></ol><blockquote class="mn mo mp"><p id="e5f2" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">TLS(传输层安全性)是实现这一切的最流行的方法之一。</p><p id="374e" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">下面是 TLS 如何工作的鸟瞰图。</p></blockquote><ol class=""><li id="beb8" class="mu mv in jm b jn jo jr js jv mw jz mx kd my kh mz na nb nc bi translated">当我们在浏览器中键入服务器地址时，就与服务器建立了连接。</li></ol><p id="67f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.当初始连接建立后，客户端向服务器发送一个客户端问候。</p><p id="1f0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.Client hello 基本上是通知服务器客户端希望使用 TLS 进行安全通信。它分享了 TLS 版本的细节，它支持的加密机制。这被称为共享密码套件。</p><blockquote class="mn mo mp"><p id="79cc" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">密码套件包含以下信息(以下列表为示例值，并非详尽无遗):</p></blockquote><ul class=""><li id="d083" class="mu mv in jm b jn jo jr js jv mw jz mx kd my kh ni na nb nc bi translated"><strong class="jm io">协议</strong> : TLS 1.3，TLS 1.2</li><li id="d74c" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated"><strong class="jm io">密钥交换</strong> : RSA，DHE，ECDHE，ADHE</li><li id="f8b8" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated"><strong class="jm io"> Auth </strong> : RSA，ECDSA</li><li id="2660" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated"><strong class="jm io">密码</strong> : AES，GCM</li><li id="f499" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated"><strong class="jm io"> MAC </strong> : SHA，MD5</li></ul><p id="de1d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.服务器查看客户端支持的选项，并通知客户端它将使用什么协议/机制。因此客户端和服务器都同意在进一步通信中使用加密选项。</p><p id="8dda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.服务器还向它发送一个公共证书。简单地说，服务器有一个公钥和一个私钥。私钥安全地存储在服务器上，不会被共享。公钥需要共享。</p><blockquote class="mn mo mp"><p id="6ebf" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">服务器的公共证书包含以下信息</p></blockquote><ul class=""><li id="2353" class="mu mv in jm b jn jo jr js jv mw jz mx kd my kh ni na nb nc bi translated">服务器的公钥和</li><li id="a494" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated">证书颁发机构(CA)的详细信息及其有效性。</li><li id="d5fa" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated">CA 是客户端和服务器信任的相互信任的第三方。想要使用 TLS 的域的所有者可以连接到 CA。验证域后，CA 将使用其私钥对服务器的公钥进行签名(加密)。下图显示了公共证书 CA 和有效性</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/4eae70c4ed9e9cd957b380154f1dd08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*S6i-vH3Iv0cFlFI6G57ckQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">公共证书:点击浏览器上的锁状符号查看证书</figcaption></figure><p id="38b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.客户端接收公共证书。浏览器(如 chrome)或移动操作系统已经加载了可信 CA 的公钥。它使用 CA 公钥来读取证书并提取服务器的公钥。此外，CA 证书确认了服务器的身份。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e5956a8cbcc7fcd3fbfabbd2a8fb7fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*fY_U5abDfd3A3ki94R_evQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">chrome 中的可信 CA 列表。</figcaption></figure><p id="eda4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">7.客户端使用服务器公钥(在步骤 6 中获得)来加密“预主密钥”。它将加密的密钥发送到服务器。</p><p id="fec5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">8.服务器用自己的私钥解密，并向客户端确认能够解密。</p><p id="185e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">9.客户端和服务器都使用这个“预主密钥”来计算“共享密钥”。</p><blockquote class="mn mo mp"><p id="aba9" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">请注意，此密钥从不通过网络传输。基于商定的预主密钥和密码套件选项，该密钥是独立生成的(并且是相同的)。</p><p id="ecba" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated"><strong class="jm io">该“共享密钥”或“会话密钥”随后用于加密所有进一步的数据交换(对称加密)。</strong></p></blockquote><p id="9daa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面是一个高层次的概述——每个步骤都有细节，而且都很复杂。作为一个用户，甚至作为一个开发者，这些细节大部分是由 API 的提供者抽象出来的。</p><h1 id="91b9" class="lw kz in bd la lx ly lz ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm bi translated">相互传输层安全性(MTLS):</h1><p id="42dd" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">在 MTLS，还有一个核实客户身份的额外步骤。因此，在步骤 6 之后，客户端将其由 CA 颁发的公共证书发送到服务器。那么服务器</p><ul class=""><li id="87e4" class="mu mv in jm b jn jo jr js jv mw jz mx kd my kh ni na nb nc bi translated">验证客户端的身份。</li><li id="e8b8" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated">CA 和证书有效性。</li><li id="10d7" class="mu mv in jm b jn nd jr ne jv nf jz ng kd nh kh ni na nb nc bi translated">它还检查撤销列表(CA 共享的撤销证书列表)。</li></ul><blockquote class="mn mo mp"><p id="a94d" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">需要注意的重要一点是，mTLS 与客户端身份验证没有任何关系。因此，用户可能会被要求输入他的名字和密码来验证他，但这并不涉及或 MTLS 的一部分。</p><p id="a5e9" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated">mTLS 中的客户端验证是关于验证服务器/浏览器/应用程序)。</p></blockquote><p id="632e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是为什么在 mTLS 范例中我们很少使用像客户端和服务器这样的词。</p><h2 id="45f1" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated">为了进一步阅读</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><div class="nn no gp gr np nq"><a href="https://www.amazon.com/Real-World-Cryptography-David-Wong/dp/1617296716/ref=sr_1_11?crid=1G8037912LC06&amp;keywords=encryption&amp;qid=1642838663&amp;s=books&amp;sprefix=enryption%2Cstripbooks-intl-ship%2C297&amp;sr=1-11&amp;asin=1617296716&amp;revisionId=&amp;format=4&amp;depth=1" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd io gy z fp nv fr fs nw fu fw im bi translated">真实世界密码术</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">Amazon.com 的真实世界密码学。*符合条件的优惠可享受免费*运输。真实世界密码术</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">www.amazon.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe ks nq"/></div></div></a></div><p id="7c0c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">对于系统设计，机器学习博客在介质上遵循</strong><a class="ae of" href="https://smverma.medium.com/" rel="noopener"><strong class="jm io">anantech . ai</strong></a><strong class="jm io">。</strong></p></div></div>    
</body>
</html>