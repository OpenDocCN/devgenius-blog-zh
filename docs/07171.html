<html>
<head>
<title>Setting up a NextJS env with Yarn 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用纱线 2 设置 NextJS 环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/yarn-2-setting-up-a-nextjs-env-ae503a2f9f7f?source=collection_archive---------5-----------------------#2022-03-03">https://blog.devgenius.io/yarn-2-setting-up-a-nextjs-env-ae503a2f9f7f?source=collection_archive---------5-----------------------#2022-03-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="cfc7" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated"><em class="kc">还有，纱 2: ALE &amp; ESLint 不工作？</em></h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi kd"><img src="../Images/3909cd2e427dce834971c7a0930ea882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*W7MSsFCQflfEPSFg35uujg.png"/></div></figure><p id="c23c" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><strong class="kn io">纱线 2 </strong>(或者是纱线 3？当我检查<code class="fe lh li lj lk b">--version</code>时，它显示为 3，但我实际上是在外壳上调用<code class="fe lh li lj lk b">yarn init -2</code>……)通过其“<a class="ae ll" href="https://yarnpkg.com/features/zero-installs" rel="noopener ugc nofollow" target="_blank">零安装</a>”和“即插即用”诡计提供了一些漂亮的功能。如何做超出了本文的范围，但是我们只能说你可以给<code class="fe lh li lj lk b"><strong class="kn io">node_modules</strong></code>一记<em class="lm">结实的屁股</em>一脚。</p><p id="db2f" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">这一切都很美好，直到你意识到<strong class="kn io"> ALE 并没有显示 ESLint 错误</strong>，即使你故意写了一段愚蠢的胡言乱语。我们稍后会解决这个问题。所有维姆的粉丝们，冷静点。</p><p id="6400" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><strong class="kn io">TL；<br/> </strong> <code class="fe lh li lj lk b">let g:ale_javascript_eslint_use_global = 1</code>博士</p><p id="8886" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">编辑:由于我不使用 VSCode，我不知道这也是一个问题。我测试了一个解决方案，详情在文末。</p><h1 id="aaa5" class="ln lo in bd lp lq lr ls lt lu lv lw lx jt ly ju lz jw ma jx mb jz mc ka md me bi translated">WTF 是纱 2？</h1><p id="e818" class="pw-post-body-paragraph kl km in kn b ko mf jo kq kr mg jr kt ku mh kw kx ky mi la lb lc mj le lf lg ig bi translated">Yarn 1 很可能仍然是默认的全局，所以如果出于某种原因你从来没有听说过它，那么绝对是时候尝试一下了…</p><p id="0440" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">根据<a class="ae ll" href="https://yarnpkg.com/getting-started/install" rel="noopener ugc nofollow" target="_blank">文档</a>，如果你有<strong class="kn io">节点 v. ≥16.10 </strong>:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="a1e7" class="mo lo in lk b gy mp mq l mr ms">$ corepack enable</span></pre><p id="c837" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">如果不是，即<strong class="kn io">节点&lt; 16.10 </strong>:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="5a1d" class="mo lo in lk b gy mp mq l mr ms">$ npm i -g corepack</span></pre><p id="d6b0" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">现在让我们</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="e6c6" class="mo lo in lk b gy mp mq l mr ms">$ mkdir yarn2-next &amp;&amp; cd yarn2-next</span></pre><p id="a044" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">然后:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="1251" class="mo lo in lk b gy mp mq l mr ms">$ yarn set version stable</span></pre><p id="447f" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">不幸的是，<code class="fe lh li lj lk b">init</code>会自动运行，这意味着你基于旧架构的命令，比如<code class="fe lh li lj lk b">create next-app</code>，将无法工作。我试过了，但是失败了，所以我们现在只能手动操作了。</p><p id="a8d2" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">但是不要绝望，NextJs 跟他妈的一样流畅<em class="lm">，即使是手动完成的时候。你有没有尝试过从头开始建立一个 vanilla React 环境？</em></p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/6f1a5b8cfb24777f5d325f2f000c64ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b5qrcsBjyfIDj3rVtXYPwQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">从<a class="ae ll" href="https://www.youtube.com/watch?v=1L2hrG-7i2Y" rel="noopener ugc nofollow" target="_blank"> Fireship </a>偷了这个，看看他的 youtube 频道。</figcaption></figure><p id="e583" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">如果你正在读这篇文章，我想你已经对 NextJs 略知一二了。如果没有，<a class="ae ll" href="https://www.youtube.com/watch?v=Sklc_fQBmcs&amp;t=601s" rel="noopener ugc nofollow" target="_blank">这是一个很棒的 100 秒介绍，包括所有的基础知识和 10 分钟的额外教程</a>。</p><p id="08a3" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">没有其他事要做，</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="94c9" class="mo lo in lk b gy mp mq l mr ms">$ yarn add next react react-dom</span></pre><p id="a2d6" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">一切都将由纱 2 来完成。像往常一样，我扔了一些</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="bfbd" class="mo lo in lk b gy mp mq l mr ms">"scripts": {<br/>  "dev": "next dev",<br/>  "build": "next build",<br/>  "start": "next start",<br/>  "lint": "next lint"<br/>}</span></pre><p id="aaa7" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">进入<code class="fe lh li lj lk b">package.json</code>然后继续进行</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="a80c" class="mo lo in lk b gy mp mq l mr ms">$ yarn add eslint --dev</span><span id="7c3f" class="mo lo in lk b gy nc mq l mr ms">$ yarn create @eslint/config</span></pre><p id="f583" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">而当你选择了一套类似<em class="lm"> Airbnb </em>的规则，并被提示用<strong class="kn io"> npm </strong>安装额外的东西时，只要说<strong class="kn io">不</strong>就可以了。这会毁了你一直努力争取的一切。只需说“不”,然后尝试这样的方法:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="5a2f" class="mo lo in lk b gy mp mq l mr ms">$ yarn add --dev eslint-config-airbnb@latest eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-jsx-a11y eslint-plugin-import</span></pre><p id="3aa4" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">或者你喜欢的规则的对等 dep。或者像往常一样，花一下午的时间一条一条地挑选规则。纱线 2 看起来像这样:</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nd"><img src="../Images/5b201dc58f639631f8d8b78acd98c477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXWpDNLb2NzK4UkkN7_bzQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">不幸的是，npx 安装程序不起作用</figcaption></figure><p id="ab37" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">现在我们要添加一些文件夹和文件！我们针对的就是这种<strong class="kn io">文件夹</strong>结构:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="7986" class="mo lo in lk b gy mp mq l mr ms">.<br/>├── public/<br/>│   └── static/<br/>│<br/>└── src/<br/>    ├── api/<br/>    ├── components/<br/>    ├── contexts/<br/>    ├── pages/<br/>    └── styles/</span></pre><p id="7b25" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">我选择将所有静态文件，如 SVG 和 png，放在 public 文件夹中。主要原因是您不必导入文件，因为 Next 会自动将路径<code class="fe lh li lj lk b">/</code>理解为公共文件夹。您可以随时使用<code class="fe lh li lj lk b">./src/assets/</code>子文件夹导入文件，如果您喜欢这样做的话。</p><p id="f0c2" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><code class="fe lh li lj lk b"><strong class="kn io">src</strong></code>文件夹是完全可选和支持的。像往常一样，Next 将自动为在<code class="fe lh li lj lk b">./pages/</code>或<code class="fe lh li lj lk b">./src/pages</code>中找到的所有内容创建路由，但是如果您错误地创建了这两个目录，它将忽略嵌套的目录。</p><p id="ef8c" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">对于小项目，我通常创建并设计自己的迷你可重用组件库。<a class="ae ll" href="https://atomicdesign.bradfrost.com/chapter-2/" rel="noopener ugc nofollow" target="_blank">原子设计方法论</a>是给定的。大多数时候我会将各自的<code class="fe lh li lj lk b">atoms/</code>、<code class="fe lh li lj lk b">molecules/</code>、<code class="fe lh li lj lk b">organisms/</code>和<code class="fe lh li lj lk b">templates/</code>子文件夹添加到<code class="fe lh li lj lk b">src/components/</code>中，但有时这样做只是矫枉过正。不管怎样，我喜欢用单独的<code class="fe lh li lj lk b">MyComponent.module.sass</code>文件来设计组件的样式，因为 Next <em class="lm">会自动给你编译的类名加上前缀</em>，以避免所有模块被捆绑到一个缩小的 css 文件中时发生冲突。这允许你保持你的名字简短并区分大小写，这使得它们更容易从 styles 对象中导入(如果你不知道我在说什么，<a class="ae ll" href="https://nextjs.org/docs/basic-features/built-in-css-support#adding-component-level-css" rel="noopener ugc nofollow" target="_blank">我会让你参考 docs </a>，非常简单的东西)。您还可以避免像 BEM 这样的命名约定的缺点，因为您可以在不同的文件中轻松地重用像<code class="fe lh li lj lk b">.cardContainer</code>这样的名称。自然，全局样式放在<code class="fe lh li lj lk b">styles</code>文件夹中。在那里，我通常会定义所有的彩色和印刷样式。</p><p id="a7e0" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">如果你打算使用<code class="fe lh li lj lk b"><strong class="kn io">sass</strong></code>，别忘了安装它。虽然没什么可配置的，接下来会处理的。</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="cce9" class="mo lo in lk b gy mp mq l mr ms">$ yarn add sass</span></pre><p id="5d9c" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">让我们转到 pages 目录并创建一些文件:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="3087" class="mo lo in lk b gy mp mq l mr ms">src<br/>├── pages/<br/>    ├── _app.jsx<br/>    ├── _document.jsx<br/>    └── index.jsx</span></pre><p id="3ea5" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><code class="fe lh li lj lk b"><strong class="kn io">_app.jsx</strong></code>文件允许您操作主要的“app”组件。如果您正在使用上下文 API 或类似的东西，并且希望在所有组件之间共享该上下文，这将非常有用。这也是你可以导入你的全局风格的唯一地方，同样的道理在应用程序范围内分享它们。它们被直接导入，而不是作为一个模块中的对象，然后剩下的自动完成。</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="3968" class="mo lo in lk b gy mp mq l mr ms">// _app.jsx</span><span id="0233" class="mo lo in lk b gy nc mq l mr ms">import React from 'react';<br/>import '../styles/globals.sass';</span><span id="df9a" class="mo lo in lk b gy nc mq l mr ms">function App({ Component, pageProps }) {<br/>  return &lt;Component {...pageProps} /&gt;<br/>}</span><span id="bbee" class="mo lo in lk b gy nc mq l mr ms">export default App;</span></pre><p id="1034" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">如果您要添加一个上下文，只需将<code class="fe lh li lj lk b">&lt;Component /&gt;</code>包含在其中。如果您正在运行 MUI，它可能看起来像这样；别忘了导入你所有的东西。</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="195d" class="mo lo in lk b gy mp mq l mr ms">return (<br/>    &lt;&gt;<br/>      &lt;CssBaseline /&gt;<br/>      &lt;ThemeProvider theme={theme}&gt;<br/>        &lt;Component {...pageProps} /&gt;<br/>      &lt;/ThemeProvider&gt;<br/>    &lt;/&gt;<br/>  );</span></pre><p id="acaa" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">注意，ESLint 可能<a class="ae ll" href="https://github.com/yannickcr/eslint-plugin-react/blob/master/docs/rules/jsx-props-no-spreading.md" rel="noopener ugc nofollow" target="_blank">不喜欢道具传播</a>。这是我避免的一种模式，但这是唯一一个我让 ESLint 闭嘴的地方。您可以简单地<code class="fe lh li lj lk b">/* eslint-disable */</code>文件或在您的<code class="fe lh li lj lk b">.eslintrc.json</code>中添加一个例外。</p><p id="a9bb" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><code class="fe lh li lj lk b"><strong class="kn io">_document.jsx</strong></code>文件是完全可选的(<code class="fe lh li lj lk b">_app.jsx</code>也是可选的)。它允许你以一种非常老式的方式操作“html 文件”，比如向<code class="fe lh li lj lk b">&lt;head&gt;</code>添加东西或者向<code class="fe lh li lj lk b">&lt;html&gt;</code>添加可访问性标签。</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="d4ba" class="mo lo in lk b gy mp mq l mr ms">// _documents.jsx</span><span id="fb48" class="mo lo in lk b gy nc mq l mr ms">import React from 'react';<br/>import {<br/>  Html,<br/>  Head,<br/>  Main,<br/>  NextScript,<br/>} from 'next/document';</span><span id="e28c" class="mo lo in lk b gy nc mq l mr ms">function Document() {<br/>  return (<br/>    &lt;Html lang="en-US" dir="ltr"&gt;<br/>      &lt;Head&gt;<br/>        &lt;link<br/>          rel="stylesheet"<br/>          href="<a class="ae ll" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap</a>"<br/>        /&gt;<br/>      &lt;/Head&gt;</span><span id="af25" class="mo lo in lk b gy nc mq l mr ms">      &lt;body&gt;<br/>        &lt;Main /&gt;<br/>        &lt;NextScript /&gt;<br/>      &lt;/body&gt;<br/>    &lt;/Html&gt;<br/>  );<br/>}</span><span id="e905" class="mo lo in lk b gy nc mq l mr ms">export default Document;</span></pre><p id="84a7" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">当使用普通字体时(sass 不算，呵呵),我通常在我的 gobal 样式中导入带有<code class="fe lh li lj lk b">@import</code>语法的字体。但是当使用一个主题库时，你通常从一个<em class="lm">主题对象</em>中控制你的全局，我宁愿在这里导入它们，而在其他地方避免任何全局样式。请注意，该文件将影响<em class="lm">您的所有应用程序路线</em>。如果您需要一种更具选择性的基于文件的方法，<a class="ae ll" href="https://nextjs.org/docs/advanced-features/custom-document#caveats" rel="noopener ugc nofollow" target="_blank">这是一种简单且自然实现的方法</a>，但是超出了本文的范围。还要注意，它总是 SSR 的，所以不要尝试任何花哨的东西，因为它可能会失败得很惨。</p><p id="2efa" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">在您的<code class="fe lh li lj lk b">index.jsx</code>中，让一个默认导出的功能组件返回“hello，world！”或者别的什么，检查一下是否一切正常，你就可以走了。我鼓励你阅读一下<code class="fe lh li lj lk b">api/</code>文件夹，以及文档中所有新的中间件特性。你现在可以走了。</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="aa11" class="mo lo in lk b gy mp mq l mr ms">$ yarn dev</span></pre></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><h1 id="35af" class="ln lo in bd lp lq nl ls lt lu nm lw lx jt nn ju lz jw no jx mb jz np ka md me bi translated">ALE，Vim 和 ESLint 是怎么回事？</h1><p id="53e7" class="pw-post-body-paragraph kl km in kn b ko mf jo kq kr mg jr kt ku mh kw kx ky mi la lb lc mj le lf lg ig bi translated">ALE 仍然会寻找<code class="fe lh li lj lk b">node_modules</code>文件夹，所以虽然您确实可以从 shell 中“lint”您的文件，但是您不会在 Vim 中得到任何反馈。这个问题仍在解决中，但同时我们可以设定:</p><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="38b5" class="mo lo in lk b gy mp mq l mr ms">let g:ale_javascript_eslint_use_global = 1</span></pre><p id="88b6" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">你不应该使用全球诚信通，所以我认为你没有全球安装它。让我们保持这种方式。也就是说，这个否则无用的规则将使 ALE 停止寻找<code class="fe lh li lj lk b">node_modules</code>并失败，它应该从那里正常工作。</p><h1 id="8a8e" class="ln lo in bd lp lq lr ls lt lu lv lw lx jt ly ju lz jw ma jx mb jz mc ka md me bi translated">VSCode 呢？</h1><pre class="ke kf kg kh gt mk lk ml mm aw mn bi"><span id="1c1d" class="mo lo in lk b gy mp mq l mr ms">yarn dlx @yarnpkg/sdks vscode</span></pre><p id="3305" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">它将创建一个配置文件，告诉 VSCode 在哪里查找 ESLint 可执行文件。它工作了。</p><p id="d12c" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">如果您使用带有<code class="fe lh li lj lk b">coc-eslint</code>而不是<code class="fe lh li lj lk b">ALE</code>的 Vim，同样的命令，但是用<code class="fe lh li lj lk b">vim</code>代替<code class="fe lh li lj lk b">vscode</code>，应该可以工作。对于其他编辑，他们在这个<a class="ae ll" href="https://yarnpkg.com/getting-started/editor-sdks" rel="noopener ugc nofollow" target="_blank">文档</a>的结尾提到了如何“解包”ESLint。</p></div></div>    
</body>
</html>