<html>
<head>
<title>Feature Switching — Toggle off Your Production Headaches</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">功能切换—解决您的生产难题</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/feature-switching-toggle-off-your-production-headaches-2817c9f2b70?source=collection_archive---------4-----------------------#2019-05-09">https://blog.devgenius.io/feature-switching-toggle-off-your-production-headaches-2817c9f2b70?source=collection_archive---------4-----------------------#2019-05-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cb3f3193dff872c67870c03f20e0bb4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*Yrf_iGUGz7-HD_sFSbjvNw.jpeg"/></div></div></figure><p id="031f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">多年来，我在许多企业工作过。在许多不同类型的项目上，从Windows应用程序，一直到流行的基于服务的网站。每个企业都有一个不同的流程来更新新代码，并在生产环境中引入新特性。有些流程比其他流程更容易获得代码。所有这些过程的一个共同点是都有回滚机制。允许您“撤销”任何可能导致生产环境中出现问题的更改。与正常的回滚过程类似，功能切换为代码部署过程增加了另一层。</p><p id="404c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">实施回滚过程是一个很好的方法，可以确保您总是可以用最少的努力备份和运行您的软件、产品或服务。在我看来，这个过程是一种“要么全有要么全无的方法”。如果你发布一个特性或者一次修复一个。这种释放机制工作正常。</p><p id="33d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我参与过的一些项目通过将新功能或补丁分批发布到一个版本中，在生产软件中部署了许多新特性。然而，如果你有一些新功能，你正试图尽快向客户推出，而其中一个功能出现了问题。你也必须放弃所有其他的新功能。而不管其他功能是否如预期那样工作。</p><p id="208f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我工作过的一两个企业，要么有一个“特性切换”机制，要么我们设法在我们的软件交付过程中建立一个。我将在下一节解释什么是“功能切换”(也称为功能切换或功能标记)。</p><h1 id="2fad" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">什么是功能切换</h1><p id="0ebf" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">那么，什么是功能切换、切换或标记。在最高水平上。特性切换是一种管理代码的方式，它允许您将新的增强功能添加到产品中，但是它们可以在您希望使用它们的时候打开或关闭。</p><p id="bfc4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">“你是什么意思”，我听到你问。我将试着用一个例子来解释它。我登录了一个网站。登录后，我看到了显示4个图表的主页。这些图表详细列出了与我的业务相关的关键信息。每个图形的加载都需要几秒钟来显示信息。图表的风格就像是20世纪80年代的东西。</p><h1 id="89bb" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">轻而易举</h1><p id="c3a7" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我已经付钱给设计师和开发商来改善这些图表。这是一种全新的显示关键信息的方式。因此，这有可能打破我的网站主页。</p><p id="81ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了解决这个问题，我使用了一个功能切换系统来创建4个功能切换。我要求开发人员实现代码，以便能够检查是否为特定图形启用了特性切换。如果是，显示新版本。否则，我希望我的网站显示旧版本的图表，我们知道工程。下面是一段示例代码，显示了我希望图形如何显示。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="f6c4" class="mf ku in mb b gy mg mh l mi mj">if (featureSwitch.IsEnabled("GraphOne")) then displayTheNewGraphOne() else displayTheOldGraphOne() end if</span></pre><p id="ec09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">默认情况下，所有功能开关都关闭。我发布了一个对我的网站的更新，有4段代码类似于上面的例子。我登录到网站，主页看起来和我网站的旧版本一样。使用我的切换系统，我启用了“GraphOne”开关。回到我的网站，我刷新主页。“嘿，很快”新的图表出现在我屏幕的左上方，在这个过程中取代了旧的图表。</p><p id="adc8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我现在可以对其他三张图重复这个过程。在进入下一个图表之前，确保每个图表都按预期工作。</p><h1 id="fc54" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">功能切换的好处</h1><p id="c7c9" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">使用功能切换有很多好处。我将介绍一下我认为使用功能切换系统的主要原因。</p><h1 id="1ce1" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">仅安全部署一次代码</h1><p id="1607" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">从我的产品发布经验来看。他们的压力有多大。尤其是当你已经做了一整天的工作，还不得不在工作时间之外发布代码的时候。</p><p id="50b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将一个版本部署到生产环境可能需要一些时间，这取决于它所包含的功能的大小。不值得考虑回滚和重新部署先前版本的代码和组件。部署和重新部署都需要时间，并且可能会使您的产品或服务离线。如果回滚失败会发生什么？它不需要思考。</p><p id="b045" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果出现问题，您必须再次关闭生产系统，以将其恢复到之前的工作状态。使用功能切换可以降低出错的风险。一旦您将代码投入生产，并且验证了一切都像以前的版本一样工作。您不需要重新部署任何代码。接下来就是启用一个功能开关，看看它是否有效。哎呀，有东西坏了，或者开关后面的功能没有按预期工作。要解决此问题，只需再次禁用交换机，即可恢复之前的行为。</p><p id="89ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">没有进一步的停机时间，也不需要回滚。令人惊异的</p><h1 id="8208" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">取消“全有或全无”的方法</h1><p id="2099" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我在前一节的例子中提到了这一点。如果我需要在我的网站上更新一个页面中的4个图表。我可以为所有4个图形部署代码，并根据需要打开它们。</p><p id="49cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">举个例子。我发现前两个图表工作得很好，和设计的一样。然而，后两个图表没有正确显示信息。假设第三和第四张图中有一个bug。两个图表都只显示了过去七天的信息。事实上，这些图表旨在显示过去30天的关键信息。我关闭了最后两个功能开关，旧图形再次显示，显示正确的信息。</p><p id="5e43" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我已经设法在一个版本中发布了四个特性中的两个。如果我没有使用功能切换，那么我将不得不回滚所有四个功能。这意味着我们会有一个失败的发布和额外的产品停机时间。啊。</p><h1 id="1a50" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">使测试和故障查找更容易</h1><p id="5068" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">再次用我的例子。如果不使用特性切换，我将不得不测试所有四个新图形是否如我所愿地工作。这意味着这可能是一个仓促的过程，以确保一切正常。我非常清楚，匆忙会导致错误。我不想错误地签署一份释放书。</p><p id="b7c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开每个图表，测试它是否按要求工作。在进入下一个图表之前。使测试人员能够专注于确保某个特定特性的所有内容都是正确的。在任何时候，只有一小部分系统可能无法正常工作。这减少了对客户的影响。</p><h2 id="f184" class="mf ku in bd kv mk ml dn kz mm mn dp ld kg mo mp lh kk mq mr ll ko ms mt lp mu bi translated">故障探测</h2><p id="8297" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果最坏的情况发生，四个图表中有一个不起作用。开发团队可以使用特性开关来查明生产环境中的问题。</p><p id="2ca8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为有错误的代码仍在生产中。当最小数量的客户使用产品时，开发团队可以打开这个特性。在基础设施等其他部门的帮助下，调查问题所在。一旦发现问题，可以再次关闭该功能。然后，团队可以满怀信心地着手解决问题，因为他们知道潜在的问题是什么。</p><p id="7f47" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">过去，我曾经在发布中发现一个问题只发生在生产环境中。我们的试运行环境中的所有测试和验证都没有出现任何问题。如果我们回滚了代码，我们就不会团结起来调查这个问题。它会被留给“我们认为这就是它坏的原因”，而不是“是的，这就是它不工作的原因”。(我在与开发团队一起工作时使用的一句话是“假设是所有混乱之母”)。</p><h1 id="1c95" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">使编写新功能更加容易</h1><p id="20eb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在软件开发方面。你可能听说过<a class="ae mv" href="https://deviq.com/solid/" rel="noopener ugc nofollow" target="_blank">稳固原则</a>、干净代码和<a class="ae mv" href="https://en.wikipedia.org/wiki/KISS_principle" rel="noopener ugc nofollow" target="_blank">亲吻原则</a>。这些都很棒，我非常相信使用这些指南。然而，软件会很快变得复杂。</p><p id="3cba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">比如说。我想实施一项新的改进。但是，如果新的功能不起作用，我必须以某种方式退回到旧的方式，例如提供图表。我的代码会很快变得很乱，我接触到的原则会被扔出窗外。</p><p id="8da8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将新功能放在特性切换之后，可以让开发人员专注于以专业和可维护的方式构建一个东西。你不需要担心最坏的情况和后退。所有这些都由功能切换系统为您处理。</p><h1 id="6d39" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">删除功能切换和旧代码</h1><p id="174d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我可能只是我和我的强迫症。但是我喜欢删除旧的、不用的代码。我乐在其中。这也适用于功能开关。我喜欢删除旧的。你想想，这是好事。</p><p id="8e8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你改进了产品的一部分，现在已经投入生产很长时间了。为什么你不想删除旧的发臭的代码和功能开关是围绕它。这意味着你做得很好。</p><p id="2314" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">代码变得越来越有机。每天都在以前所未有的速度发展。旧的代码和功能需要不断地删除，以保持项目的精益。尽可能少地使用代码，可以使部署变得快速而简单。</p><h1 id="d41a" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">实现功能切换</h1><p id="15a2" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我不打算详细介绍如何实现一个功能切换系统。公司使用的大多数功能交换系统都是由他们现有的开发团队“内部”构建的。因此适合每个企业的需求。然而，每个系统中的用法和基本原理几乎是相同的。</p><p id="c9d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用功能切换为您的发布过程增加了额外的安全层。以及在现有回滚机制的基础上为您提供更细粒度的“回滚”过程。这也给你的开发团队带来了压力，因为他们相信确实会出问题。如果需要，有问题的代码可以很快关闭。</p><p id="1129" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您想了解更多有关功能切换以及如何在项目中实施该系统的信息。请不要犹豫<a class="ae mv" href="https://www.philliphughes.co.uk" rel="noopener ugc nofollow" target="_blank">联系我</a>。我非常乐意帮忙。</p></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="ba8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nd">原载于2019年5月9日</em><a class="ae mv" href="https://www.philliphughes.co.uk/tech/feature-switching/" rel="noopener ugc nofollow" target="_blank"><em class="nd">【https://www.philliphughes.co.uk</em></a><em class="nd">。</em></p></div></div>    
</body>
</html>