<html>
<head>
<title>Easy Git Hooks for Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">容易抖动的 Git 挂钩</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/easy-git-hooks-for-flutter-f2927cbbcfd4?source=collection_archive---------1-----------------------#2021-05-30">https://blog.devgenius.io/easy-git-hooks-for-flutter-f2927cbbcfd4?source=collection_archive---------1-----------------------#2021-05-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4eac" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用 git 挂钩自动化您的工作流，进行各种活动，如林挺、格式化、测试等。在使用 Lefthook 的颤振项目中</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/90211ccb1ecd2ac5d5b2b36682802433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8sWTXMuJxFv0n8aoJ_5Iw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">左勾拳+扑击= ❤</figcaption></figure><p id="4925" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi lo translated"><span class="l lp lq lr bm ls lt lu lv lw di">随着</span>项目变得越来越大，多个开发人员同时不断地编辑代码库，维护代码标准和代码质量的需求变得非常重要。当然，这是每个开发人员的责任，但是使用 git 钩子可以让这个过程变得非常高效和轻松。</p><p id="cfd5" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">Git 挂钩是在执行 git 命令(提交、推送等)之前启动定制脚本/动作的一种方式。在 git 官方网站上有很多 git 挂钩可以使用，如<a class="ae lx" href="https://git-scm.com/docs/githooks" rel="noopener ugc nofollow" target="_blank">所记录的</a>，但是在本文中，我们将主要关注两个:<code class="fe ly lz ma mb b">pre-push</code>和<code class="fe ly lz ma mb b">pre-commit</code>，以及如何在一个 Flutter 项目中轻松实现它们。</p><p id="5c56" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">Roberta 有一篇很棒的文章<a class="ae lx" href="https://medium.com/kinandcartacreated/githooks-explained-using-flutter-babcdeb4048d" rel="noopener">解释了如何通过修改<code class="fe ly lz ma mb b">.git</code>文件夹中的内容在 Flutter 项目中设置自定义 git 挂钩。<code class="fe ly lz ma mb b">.git</code>文件夹是存储库根目录下的一个隐藏文件夹。但是还有另一种方法来实现它，使用 left hook——一个多语言的 git 钩子管理器。</a></p><p id="b2ca" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">首先，我们需要全局安装 lefthook。基于您的环境，有几个选项—</p><p id="5a75" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你安装了 Node.js】</p><p id="1fc1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你在一个基于 Ruby 的环境中:<code class="fe ly lz ma mb b">gem install lefthook</code></p><blockquote class="mc md me"><p id="8613" class="ks kt mf ku b kv kw jo kx ky kz jr la mg lc ld le mh lg lh li mi lk ll lm ln ig bi translated">您可能需要以<code class="fe ly lz ma mb b">sudo</code>的身份运行这些命令</p></blockquote><p id="159f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">就是这样，lefthook 现在可以用了。导航到您的项目根目录并运行— <code class="fe ly lz ma mb b">lefthook install</code></p><blockquote class="mc md me"><p id="78c8" class="ks kt mf ku b kv kw jo kx ky kz jr la mg lc ld le mh lg lh li mi lk ll lm ln ig bi translated">每个项目/存储库必须运行一次<code class="fe ly lz ma mb b">lefthook install</code>命令</p></blockquote><p id="3266" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">Lefthook 的工作原理是使用一个位于项目根目录下的 YAML 文件。让我们创建这个文件— <code class="fe ly lz ma mb b">lefthook.yaml</code></p><p id="4670" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这个文件定义了应该使用哪些 git 挂钩，以及在这些挂钩期间应该运行哪些脚本/命令。使用 Flutter，可以很容易地根据单个开发人员的偏好设置不同格式的代码。为了解决这个问题，我们可以使用 Flutter SDK 中可用的命令，在提交/推送版本控制之前标准化我们的代码。</p><p id="82c2" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在提交之前，我们将配置两个命令。第一个是使用 Flutter SDK 的默认规则 lint dart 代码，第二个是格式化代码。该文件以钩子的名称开始，后面是下一级缩进的一组命令。我定义了两个命令—</p><pre class="kd ke kf kg gt mj mb mk ml aw mm bi"><span id="5b42" class="mn mo in mb b gy mp mq l mr ms">pre-commit:<br/>  commands:<br/>    lint_code:<br/>      glob: '*.dart'<br/>      run: dart fix lib &amp;&amp; git add .<br/>    format_code:<br/>      glob: '*.dart'<br/>      run: flutter format {staged_files} &amp;&amp; git add .</span></pre><p id="d7dd" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里，<em class="mf"> lint_code </em>和<em class="mf"> format_code </em>是我给命令起的名字。这些可以是任何东西。glob 参数定义了在哪些文件上运行命令，还有一些特殊的 git 变量可用，如<code class="fe ly lz ma mb b">{staged_files}</code>。有关这方面的详细参考，请参考 lefthook 文档。</p><p id="6fbf" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">第二组命令是在我们将任何东西推送到版本控制之前使用的。开发人员社区普遍认为，在将任何东西提交到版本控制之前，您应该总是测试您的代码。除此之外，运行代码分析以发现任何潜在的问题是队列中的第二个任务。这两项任务都是独立的，可以并行运行，我们会做到这一点。</p><pre class="kd ke kf kg gt mj mb mk ml aw mm bi"><span id="9d24" class="mn mo in mb b gy mp mq l mr ms">pre-push:<br/>  parallel: true<br/>  commands:<br/>    tests:<br/>      run: flutter test<br/>    static_code_analysis:<br/>      run: flutter analyze</span></pre><p id="b316" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe ly lz ma mb b">parallel</code>参数指定命令是否应该并行运行，默认设置为<code class="fe ly lz ma mb b">false</code>，这意味着命令将按顺序运行。</p><p id="4b5c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">使用 git 钩子的全部意义在于，如果钩子定义的任何命令失败，将会抛出一个错误，退出当前的 git 操作，这意味着 git 命令将不会执行。这真的很有帮助，并确保开发人员产生良好的代码质量，即使他们一开始忘记了。</p><p id="6563" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这是完整的 lefthook.yaml 文件—</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">颤振项目的左钩 YAML</figcaption></figure><p id="f78e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这是一个基本设置，可以扩展以满足您的特定需求。现在，无论何时运行 git 命令——commit/push，lefthook 都会运行您的命令，并显示命令成功通过或失败的输出摘要。此外，lefthook 可以与各种其他语言和框架一起使用，因为它不是为一种特定的语言或框架开发的——因此是多语言的。</p><p id="91d3" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">感谢您花时间阅读本文，如果您觉得有用，请分享！</p></div><div class="ab cl mv mw hr mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ig ih ii ij ik"><h2 id="c4e4" class="mn mo in bd nc nd ne dn nf ng nh dp ni lb nj nk nl lf nm nn no lj np nq nr ns bi translated">参考</h2><p id="570a" class="pw-post-body-paragraph ks kt in ku b kv nt jo kx ky nu jr la lb nv ld le lf nw lh li lj nx ll lm ln ig bi translated">Roberta 用 Flutter 解释 Git 挂钩</p><p id="4e67" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">[2] <a class="ae lx" href="https://github.com/evilmartians/lefthook" rel="noopener ugc nofollow" target="_blank"> Lefthook </a> —多语言 git hooks 管理器</p></div></div>    
</body>
</html>