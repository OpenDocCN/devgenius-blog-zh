<html>
<head>
<title>Overview of the Kube Controller Manager in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes中的Kube控制器管理器概述</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/overview-of-the-kube-controller-manager-in-kubernetes-2628b5576540?source=collection_archive---------11-----------------------#2020-07-16">https://blog.devgenius.io/overview-of-the-kube-controller-manager-in-kubernetes-2628b5576540?source=collection_archive---------11-----------------------#2020-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="89f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读完这篇文章后，你会有:</p><ul class=""><li id="299a" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">理解Kube管理员的职责。</li></ul><p id="94d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想从这篇文章中得到最大的收获，我强烈推荐我的文章，这篇文章简要概述了kubernetes架构。<a class="ae ku" href="https://medium.com/dev-genius/the-kubernetes-cluster-architecture-simplified-3c4a5fb41449" rel="noopener">链接此处</a>。</p><p id="2a5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为初学者，理解kubernetes架构可能会令人望而生畏。为了简化，我将使用船只的类比来解释Kubernetes的架构。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/fd3c168386fbf3e97a8c4a856de36b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOkmbTLNlTNV3IpH9TicTg.jpeg"/></div></div></figure><p id="2b9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，我们有两种船:</p><ol class=""><li id="a417" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk lh kr ks kt bi translated"><strong class="jp ir">货船</strong>:从事将集装箱运送到海上的实际工作。</li><li id="7b65" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk lh kr ks kt bi translated"><strong class="jp ir">控制船</strong>:负责监控和管理货船。</li></ol><p id="6750" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes集群由一组节点组成，这些节点可以是物理的、虚拟的、本地的或云上的，以容器的形式托管应用程序。在这个类比中，这些与<strong class="jp ir">货船</strong>相关。</p><p id="3060" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，控制船拥有不同的办公室和部门、监控设备、通信设备、用于在船之间移动集装箱的起重机等。<strong class="jp ir">控制船</strong>与kubernetes集群中的<strong class="jp ir">主节点</strong>相关，它负责管理集群。控制船完成的任务包括:</p><ul class=""><li id="4a68" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><strong class="jp ir">存储关于不同节点的</strong>信息。</li><li id="b883" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk kq kr ks kt bi translated"><strong class="jp ir">计划</strong>哪些集装箱去哪里。</li><li id="36d9" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk kq kr ks kt bi translated"><strong class="jp ir">监控</strong>节点以及其上的容器。</li></ul><p id="e1ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经猜到了，kube控制器管理器是<strong class="jp ir">控制船</strong>中的一个“部门”，也就是说，它帮助管理整个集群。</p><p id="3544" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">kube管理员管理Kubernetes 的各种管理员。</p><p id="085e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提醒一下，管制员也是船长船上的一个办公室或部门，有它自己的一套职责。这种船舶办公室将负责:</p><ol class=""><li id="a624" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk lh kr ks kt bi translated">持续监视货船的状况。</li><li id="6bb7" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk lh kr ks kt bi translated">采取必要措施补救不利情况。</li></ol><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi ln"><img src="../Images/6ed647db8c6786b5f7e2f9eb82fef49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-g8YiAYPlv1YmOWu5HLtQ.jpeg"/></div></div></figure><p id="2bdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用kubernetes的话来说:</p><p id="d85d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">控制器</strong>是一个持续监控系统内各种组件状态的过程，致力于使整个系统达到所需的运行状态。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="2f20" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">控制器的第一个例子:节点控制器</h1><p id="e671" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">节点控制器负责监控节点的状态，并采取必要的措施来保持应用程序的运行。</p><p id="e8e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它通过<strong class="jp ir"> kube-api </strong>服务器来完成这项工作。</p><p id="2c01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">节点控制器每5秒检查一次节点的状态。通过这种方式，它可以监控节点的健康状况。</p><p id="c9c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果节点控制器停止接收来自某个节点的心跳信号，它将被标记为不可达，但它会等待40秒后再将其标记为不可达。</p><p id="f232" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在一个节点被标记为不可达后，它会给它五分钟的时间来恢复，如果不可达，它会删除分配给该节点的pod，并将它们配置到健康的pod上。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi my"><img src="../Images/d484c58126b105cd08ef527673c035d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBY7spC7T9XiFtj8r5Uwaw.jpeg"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="cd89" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">控制器的第二个例子:复制控制器</h1><p id="4d75" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated"><strong class="jp ir">复制控制器</strong>负责监控<strong class="jp ir">副本集</strong>的状态，并确保所需数量的<strong class="jp ir">容器</strong>在副本集内始终可用。</p><p id="1a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一个<strong class="jp ir"> POD </strong>死亡，则<strong class="jp ir">复制控制器</strong>会创建另一个。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="831f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这只是控制器的两个例子。</p><p id="6106" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【kubernetes中还有更多这样的控制器。</p><p id="8da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论您在kubernetes中熟悉什么概念，例如:</p><ul class=""><li id="1c67" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">部署</li><li id="2c42" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk kq kr ks kt bi translated">服务</li><li id="b865" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk kq kr ks kt bi translated">名称空间</li><li id="2b3f" class="kl km iq jp b jq li ju lj jy lk kc ll kg lm kk kq kr ks kt bi translated">持久卷</li></ul><p id="d0a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论在这些结构中构建什么样的智能，都是通过这些不同的控制器来实现的。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi mz"><img src="../Images/01f3fca7d7da1106d208b23ef86317b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64gXCfRjzAGJxAFKmJZkRw.jpeg"/></div></div></figure><p id="ea73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以想象，这些控制器可以被看作是kubernetes中许多事物背后的“大脑”。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="6462" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">您如何看待这些控制器，它们在您的集群中位于何处？</strong></h1><p id="6e04" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">它们都被打包到一个称为kubernetes控制器管理器的单一进程中。</p><p id="e045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您安装kubernetes控制器管理器时，也会安装不同的控制器。</p><p id="bc90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何安装和查看kubernetes控制器管理器？</strong></p><p id="e658" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从kubernetes发布页面下载kube控制器管理器。提取它并将其作为服务运行:</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="4e51" class="nf lw iq nb b gy ng nh l ni nj">wget <a class="ae ku" href="https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-controller-manager" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-controller-manager</a></span><span id="dca4" class="nf lw iq nb b gy nk nh l ni nj">kube-controller-manager.service</span></pre><p id="303f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您运行它时，您可以看到提供了一个选项列表。在这里您可以提供额外的选项来定制您的控制器。</p><p id="d099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，我们之前讨论的节点控制器的一些默认设置，如节点监控周期、宽限期和驱逐超时。这些作为选项放在这里。</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="3ace" class="nf lw iq nb b gy ng nh l ni nj">--node-monitor-period=5s<br/>--node-monitor-grace-period=40s<br/>--pod-eviction-timeout=5m0s</span></pre><p id="5175" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个称为控制器的附加选项，您可以使用它来指定要启用哪些控制器:</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="d725" class="nf lw iq nb b gy ng nh l ni nj">--controllers</span></pre><p id="4339" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，所有这些都是启用的，但您可以选择启用少数几个。</p><p id="423a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果你的任何控制器似乎不工作或不存在，这将是一个很好的起点看看。</p><p id="90b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何看待Kube-controller-manager服务器选项？</strong></p><p id="03ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这取决于您如何设置集群。</p><p id="6dbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果使用<strong class="jp ir"> kubeadm </strong>工具进行设置，<strong class="jp ir"> kubeadm </strong>将kube-controller-manager部署为主节点上kube-system名称空间中的一个pod。</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="ef3a" class="nf lw iq nb b gy ng nh l ni nj">kubectl get pods -n kube-system</span></pre><p id="81c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在位于以下位置的pod定义文件中看到这些选项:</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="904e" class="nf lw iq nb b gy ng nh l ni nj">cat /etc/kubernetes/manifests/kube-controller-manager.yaml</span></pre><p id="2944" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">非kubeadm </strong>设置中，您可以通过查看位于服务目录的kube-controller-manager服务来检查选项。</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="5389" class="nf lw iq nb b gy ng nh l ni nj">cat /etc/kubernetes/system/kube-controller-manager.service</span></pre><p id="d66b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以通过在主节点上列出流程并搜索kube-controller-manager来查看正在运行的流程和有效选项:</p><pre class="kw kx ky kz gt na nb nc nd aw ne bi"><span id="a313" class="nf lw iq nb b gy ng nh l ni nj">ps -aux | grep kube-controller-manager</span></pre><p id="03d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢关注，如果你想了解更多关于kubernetes的信息，可以看看我的其他帖子。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="7834" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nl">原载于</em> <a class="ae ku" href="https://luispreciado.blog/posts/kubernetes/core-concepts/kube-controller-manager" rel="noopener ugc nofollow" target="_blank"> <em class="nl">我的博客</em> </a>。</p></div></div>    
</body>
</html>