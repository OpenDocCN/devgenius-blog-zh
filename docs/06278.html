<html>
<head>
<title>Kafka Cluster on Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker Compose 上的卡夫卡集群</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kafka-cluster-on-docker-compose-dae9fcc8c092?source=collection_archive---------6-----------------------#2021-12-27">https://blog.devgenius.io/kafka-cluster-on-docker-compose-dae9fcc8c092?source=collection_archive---------6-----------------------#2021-12-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/577ef6e1d8c36bba87aa4a9730062459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gw6N04k4d28aefmb"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@miinyui?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杜凡</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1e7d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文描述了如何在可信、一致和隔离的环境中配置和运行 Kafka 集群。如果您正在开发或测试一个微服务应用程序，并且想知道如何在没有任何依赖性的情况下运行它，那么这篇文章就是为您准备的。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="b723" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">简介</strong></p><p id="4c17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">毫无疑问，微服务架构模式的使用正在快速增长。</p><p id="7926" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">采用这些模式带来了较小组件(微服务)之间有效通信通道的问题。</p><p id="65a4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Apache Kafka 为微服务之间的通信提供了一个简单的解决方案，并且是现代应用程序架构的关键组件。在生产中，Apache Kafka 可以在您的本地环境中运行。</p><div class="lf lg gp gr lh li"><a href="https://kafka.apache.org/quickstart" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd io gy z fp ln fr fs lo fu fw im bi translated">阿帕奇卡夫卡</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">Apache Kafka:分布式流媒体平台。</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">kafka.apache.org</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw jt li"/></div></div></a></div><p id="2354" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者您可以连接到云 Kafka 服务:</p><div class="lf lg gp gr lh li"><a href="https://aws.amazon.com/msk/" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd io gy z fp ln fr fs lo fu fw im bi translated">完全托管的阿帕奇卡夫卡-亚马逊 MSK -亚马逊网络服务</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">Amazon Managed Streaming for Apache Kafka(MSK)消除了运营开销，包括资源调配…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">aws.amazon.com</p></div></div><div class="lr l"><div class="lx l lt lu lv lr lw jt li"/></div></div></a></div><p id="f99b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为代码开发和单元测试提供一个可信的、一致的、隔离的环境是非常重要的。这种环境应该有在任何地方运行的好处。另一个优势是易于设置——它允许您立即开始项目工作。</p><p id="77c3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">集装箱化是实现机动性、可重复性、灵活性和模块化的有效方式。所有这些都促进了发展中的生产力。</p><p id="3269" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Docker 容器作为隔离运行时环境的基础设施带来了巨大的改进。Docker 容器使得创建、部署和运行应用程序变得更加容易。</p><p id="722b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，作为一个开发环境选项，Apache Kafka 可以在容器中运行。已经有大量的操作指南。这里有一个我发现很有用的:<a class="ae jz" href="https://registry.hub.docker.com/r/wurstmeister/kafka#!" rel="noopener ugc nofollow" target="_blank">https://registry.hub.docker.com/r/wurstmeister/kafka#!</a></p><p id="703f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现代微服务应用是服务的组合。下一步是考虑多个容器的编排和组织。我们应该能够定义和运行多容器 Docker 应用程序，包括应用程序微服务容器以及 Kafka 集群容器。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="ab gu cl mc"><img src="../Images/1b282831040632192fac877ccbfb7495.png" data-original-src="https://miro.medium.com/v2/format:webp/1*FdWNrntU6RC1IJiO4K450Q.jpeg"/></div></figure><p id="0db8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">解决方案</strong></p><p id="b653" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Docker Compose 是一个工具，它可以让您根据定义的配置，用一个命令运行所有的服务。该工具允许您从同一个应用程序中同时管理多个容器。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="5fb0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">配置</strong></p><p id="dba2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Docker Compose 创建了一个内部网络，容器使用它来相互通信。容器通过它们的服务名相互引用。例如，一个 Kafka 集群正在 Docker Compose 中的端口 9092 上运行。Kafka producer 应用程序(运行在同一个 Docker Compose 上)可以通过内部 Docker Compose 网络向 Kafka 集群发送消息到 host="kafka "和 port="9092 "。生产者的引导服务配置将被定义为“kafka:9092”</p><p id="7817" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一个必须完成的有意义的配置是为每种客户端类型(内部和外部)配置一个(至少)监听器:KAFKA_LISTENERS 和 KAFKA_ADVERTISED_LISTENERS。</p><p id="e8db" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用这样的配置运行 Kafka 代理将允许内部和外部客户端访问 Kafka 代理。您应该配置这两个参数。</p><p id="5127" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">KAFKA _ LISTENERS—KAFKA 绑定到的接口的定义。</p><p id="a3ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">KAFKA_ADVERTISED_LISTENERS —客户端可以连接到的运行 KAFKA 代理的定义。</p><p id="00ea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更详细的解释，可以看这篇<a class="ae jz" href="https://www.confluent.io/blog/kafka-listeners-explained/" rel="noopener ugc nofollow" target="_blank">文章</a></p><div class="lf lg gp gr lh li"><a href="https://www.confluent.io/blog/kafka-listeners-explained/" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd io gy z fp ln fr fs lo fu fw im bi translated">卡夫卡听众-解释|汇合</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">您需要将 advertised.listeners(或者 KAFKA_ADVERTISED_LISTENERS，如果您使用 Docker 图像的话)设置为外部…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">www.confluent.io</p></div></div><div class="lr l"><div class="md l lt lu lv lr lw jt li"/></div></div></a></div><p id="f2b2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一个 docker-compose。yml 文件工作示例:</p><pre class="ly lz ma mb gt me mf mg mh aw mi bi"><span id="4df3" class="mj mk in mf b gy ml mm l mn mo">version: '3'<br/><br/>services:<br/><br/>  zookeeper:<br/><br/>    image: 'bitnami/zookeeper:latest'<br/><br/>    ports:<br/><br/>      - '2181:2181'<br/><br/>    environment:<br/><br/>      - ALLOW_ANONYMOUS_LOGIN=yes<br/><br/>  kafka:<br/><br/>    image: 'bitnami/kafka:latest'<br/><br/>    environment:<br/><br/>      - KAFKA_BROKER_ID=1<br/><br/>      - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181<br/><br/>      - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT<br/><br/>      - KAFKA_LISTENERS=PLAINTEXT://:9092<br/><br/>      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092<br/><br/>      - ALLOW_PLAINTEXT_LISTENER=yes<br/><br/>  your-application:<br/><br/>    image: &lt;YOUR APPLICATION IMAGE&gt;<br/><br/>volumes:<br/><br/>  zookeeper_data:<br/><br/>    driver: local<br/><br/>  kafka_data:<br/><br/>    driver: local</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="c24a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">方案验证</strong></p><p id="22f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用以下方式启动容器:</p><pre class="ly lz ma mb gt me mf mg mh aw mi bi"><span id="d16d" class="mj mk in mf b gy ml mm l mn mo">docker-compose up -d</span></pre><p id="2ec4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以编写 Kafka 生产者和消费者应用程序，也可以运行以下脚本:</p><pre class="ly lz ma mb gt me mf mg mh aw mi bi"><span id="7e67" class="mj mk in mf b gy ml mm l mn mo">kafka-console-producer.sh — broker-list kafka:9092 — topic &lt;topic name&gt;</span><span id="5683" class="mj mk in mf b gy mp mm l mn mo">kafka-console-consumer.sh — bootstrap-server kafka:9092 — topic &lt;topic name&gt; — from-beginning</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="adf7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将为您提供运行完全隔离的开发环境的足够知识。</p><p id="39b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">快乐编码</p></div></div>    
</body>
</html>