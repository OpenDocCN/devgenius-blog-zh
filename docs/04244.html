<html>
<head>
<title>iOS Biometric Authentication Implementation with FaceID and TouchID</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FaceID和TouchID实现iOS生物认证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ios-biometric-authentication-implementation-with-faceid-and-touchid-4155c804fea4?source=collection_archive---------3-----------------------#2021-02-15">https://blog.devgenius.io/ios-biometric-authentication-implementation-with-faceid-and-touchid-4155c804fea4?source=collection_archive---------3-----------------------#2021-02-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/551481227e926c313eb96a60a3978bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bll8CvKDHZQ4qA1aHiTQAQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">谷歌图片</figcaption></figure><p id="a1fd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如你所知，苹果在iOS 7和iPhone 5S中推出了生物认证系统TouchID。</p><p id="d8ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">认证系统允许用户解锁设备，并在AppStore/iTunes/others中进行购买。</p><p id="7593" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在iOS 8中，苹果允许开发者在应用程序中使用指纹传感器认证机制来识别用户。</p><p id="c145" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在iPhone X生产之前，名为TouchID的身份验证系统一直与iPhone home键配合使用。然后在2017年9月12日，苹果推出了一款新的旗舰手机，这就是iPhone X。</p><p id="0029" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在iPhone X中，名为FaceID的认证系统取代了TouchID。</p><p id="2ca3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我想这就够了。在这一点之后，我们不需要历史性的发展。</p><p id="fa03" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">让我们开始编码</strong></p><p id="2ea1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于FaceID用法，请在应用程序的“Info.plist”文件中包含“NSFaceIDUsageDescription”关键字。没有此密钥，系统将不允许你的应用使用Face ID。</p><p id="8199" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">iPhone应用开发中的这个认证系统被称为本地认证框架。</p><p id="62d7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要在您的应用程序中使用本地身份验证框架，我们需要添加local authentication框架。</p><p id="58ba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">转到项目设置&gt;常规&gt;链接的框架和库标题。单击+号并添加LocalAuthentication.framework。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kx"><img src="../Images/d0f3f96184de03a591bf0a5d79788f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VW1oREeaTeR3wYtk2IjBKQ.png"/></div></div></figure><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lc"><img src="../Images/9b7b64265d09060cafbbb4a0e119af85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDB9LnO7DKeS-cwxBgNimw.png"/></div></div></figure><p id="34d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在视图控制器或你使用的认证系统的类中导入LocalAuthentication框架。</p><p id="bb78" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有了这个框架，我们将从“LAContext”类开始。这非常小，并且管理所有整个认证过程。</p><p id="6b27" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">首先，创建一个身份验证上下文的实例，如下所示。</p><pre class="ky kz la lb gt ld le lf lg aw lh bi"><span id="f6cf" class="li lj in le b gy lk ll l lm ln">let localAuthenticationContext = LAContext()</span></pre><p id="ced9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这个定义之后，我们将调用“canEvaluatePolicy”方法。通过这种方法，我们应该提供两种不同类型的“LAPolicy”中的一种。</p><p id="5d7b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">苹果在他们的文件中解释了这一点:</p><blockquote class="lo lp lq"><p id="be6f" class="jz ka lr kb b kc kd ke kf kg kh ki kj ls kl km kn lt kp kq kr lu kt ku kv kw ig bi translated">该策略控制身份验证的行为方式。例如，此示例中使用的la policy . deviceownerauthenationalization策略指示当生物识别失败或不可用时，允许恢复到密码。或者，您可以指示不允许恢复到设备密码的la policy . deviceownerauthenticationwith biometrics策略。</p></blockquote><p id="352d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第二个参数localizedReason将在对话框中通知用户。</p><p id="61df" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">通过“canEvaluatePolicy ”,我们将检查设备上的生物识别可用性。</p><pre class="ky kz la lb gt ld le lf lg aw lh bi"><span id="f8d3" class="li lj in le b gy lk ll l lm ln">if localAuthenticationContext.canEvaluatePolicy(.deviceOwnerAuthenticationWithBiometrics, error: &amp;authError) {<br/> //call evaluatePolicy method to handle session or log in.<br/>}</span></pre><p id="d8cc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">authError会返回一个错误。有很多不同的错误。</p><p id="665e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在Apple文档中:</p><p id="9046" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">案例app cancel<br/>—app取消认证。<br/>案例系统取消<br/> —系统取消认证。<br/>案例用户取消<br/> —用户点击认证对话框中的取消按钮。</p><p id="b0bc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">案例认证失败<br/> —用户未能提供有效凭证。</p><p id="0eda" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">静态变量biometryLockout <br/> —生物统计学被锁定，因为尝试失败的次数太多。<br/>static var biometryNotAvailable<br/>—生物统计学在仪器上不可用。<br/>静态var biometryNotEnrolled <br/> —用户没有注册生物识别身份。</p><p id="c027" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">iOS 11之前:<br/> case touchIDLockout <br/> —触控ID因为尝试失败次数太多而被锁定。<br/>病例触摸不可用<br/> —触控ID在设备上不可用。<br/>案例触摸未注册<br/> —用户没有注册触控ID手指。</p><p id="4e38" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">完整的身份验证代码如下:</p><figure class="ky kz la lb gt jo"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0c69" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">从<a class="ae lx" href="https://github.com/batikansosun/iOSBiometricAuthentication" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载项目。</p><p id="fcbf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对您的应用程序实现本地身份验证非常容易。例如，如果您想要实现登录。在首次认证之前，要求用户进行本地认证并记住我。如果用户选择了“记住我”选项，则将用户的登录凭据存储在钥匙串中。之后，在UserDefaults中用一个键标记这个用户。</p><p id="b523" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于所有下次登录检查“用户默认值”的关键，并开始使用生物认证。</p><p id="4f2e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">仅此而已。</p><p id="5cb1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你喜欢这一切，请分享它，然后其他人喜欢它。</p><p id="a5c4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我创建的一些开源项目。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/batikansosun/NetGuard" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">batikansosun/网络卫士</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">NetGuard是一个轻量级的原生iOS网络调试器。NetGuard监控并捕获网络请求。NetGuard商店…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp jt mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://github.com/batikansosun/ENVGadgetFW" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">batikansosun/ENVGadgetFW</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Compatible Plaforms iOS ENV Gadget是一个帮助您轻松管理服务端点、服务密钥…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="mq l mm mn mo mk mp jt mb"/></div></div></a></div></div></div>    
</body>
</html>