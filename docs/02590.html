<html>
<head>
<title>Node.js Best Practices — Project Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践—项目设置</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-best-practices-project-setup-bf5276a199fe?source=collection_archive---------2-----------------------#2020-08-14">https://blog.devgenius.io/node-js-best-practices-project-setup-bf5276a199fe?source=collection_archive---------2-----------------------#2020-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2bf74885281ea99e62a3f186659ca1ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tsDYcmVI6DUpuEb3"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@todoranb_26?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">波格丹一世·托多兰</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d5bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="3856" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">坚持小写</h1><p id="ba53" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该坚持使用小写文件名，以使文件可移植。</p><p id="33c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于Node是跨平台的，如果我们的名字有不同的大小写，我们可能会遇到问题。</p><p id="4b82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使我们的生活更容易，我们应该在任何地方都使用小写字母。</p><h1 id="3c77" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">聚集我们的应用</h1><p id="e383" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了让我们的应用在所有内核可用的情况下运行，我们应该将我们的应用集群化。</p><p id="2a19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的应用程序的一个实例只能使用一个CPU核心和1.5GB的内存。</p><p id="f15f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们不对它们进行集群，许多资源可能会被闲置。</p><p id="c450" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了超越极限，我们应该将我们的应用集群化。</p><p id="e7ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以使用<a class="ae kc" href="https://www.npmjs.com/package/forky" rel="noopener ugc nofollow" target="_blank"> forky </a>和<a class="ae kc" href="https://www.npmjs.com/package/throng" rel="noopener ugc nofollow" target="_blank">through</a>来创建我们的集群。</p><h1 id="01b2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">有环保意识</h1><p id="5594" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使我们的应用程序可配置，以便它可以在任何环境下运行。</p><p id="fb31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们将所有配置读入我们的文件。</p><p id="82c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c03a" class="mn lc iq mj b gy mo mp l mq mr">DATABASE_URL='postgres://localhost/foobar'<br/>HTTP_TIMEOUT=10000</span></pre><p id="00c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe ms mt mu mj b">.env</code>文件中。</p><p id="6935" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用一些像dotenv这样的库来读取文件。</p><h1 id="4697" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免垃圾</h1><p id="fe13" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在回收未使用的内存之前，节点将等待达到内存限制。</p><p id="c2cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你改变这一点，我们可以设置一些设置，当我们运行我们的应用程序，以回收更快的内存。</p><p id="b89a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过键入以下内容来运行它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="362b" class="mn lc iq mj b gy mo mp l mq mr">node --optimize_for_size --max_old_space_size=920 --gc_interval=100 server.js</span></pre><p id="91f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">optimize_for_size</code>选项将更快地回收内存。</p><p id="4b74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将使节点减少内存大小，但在速度上妥协，因为未使用的内存回收更快。</p><p id="7ca0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">gc-interval</code>将垃圾收集间隔设置为100毫秒。</p><p id="5eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">max_old_space_size</code>限制堆中对象的总大小。</p><h1 id="c04a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">钩住</h1><p id="a517" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加生命周期脚本来添加定制挂钩。</p><p id="281d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们添加了<code class="fe ms mt mu mj b">package.json</code>的所有<code class="fe ms mt mu mj b">scripts</code>部分来添加脚本。</p><p id="fab3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5458" class="mn lc iq mj b gy mo mp l mq mr">"scripts": {<br/>  "build": "bower install &amp;&amp; grunt build",<br/>  "start": "grunt"<br/>}</span></pre><p id="97cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加2个脚本，<code class="fe ms mt mu mj b">build</code>和<code class="fe ms mt mu mj b">start</code>。</p><p id="a443" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以运行<code class="fe ms mt mu mj b">npm run build</code>和<code class="fe ms mt mu mj b">npm start</code>来运行脚本。</p><p id="611f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更好地控制脚本，我们可以运行一个外部脚本文件:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="faba" class="mn lc iq mj b gy mo mp l mq mr">"build": "scripts/build.sh"</span></pre><h1 id="5b66" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">只跟踪重要的部分</h1><p id="4835" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只跟踪我们创建的代码文件。</p><p id="c11d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其余的应该放在<code class="fe ms mt mu mj b">.gitignore</code>中，这样它们就被忽略了。</p><p id="f061" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">node_modules</code>应该被忽略，所以我们用<code class="fe ms mt mu mj b">npm install</code>来安装它们，而不是将大量的包提交到我们的项目库中。</p><p id="43c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将大大减少我们项目的规模，我们可以进行任何操作，如检出、分支等。快多了。</p><p id="0f81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们签入了<code class="fe ms mt mu mj b">node_modules</code>文件夹，我们应该通过运行以下命令来删除该文件夹:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a145" class="mn lc iq mj b gy mo mp l mq mr">echo 'node_modules' &gt;&gt; .gitignore<br/>git rm -r --cached node_modules<br/>git commit -am 'ignore node_modules'</span></pre><p id="cdad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把第一行的<code class="fe ms mt mu mj b">node_modules</code>放入<code class="fe ms mt mu mj b">.gitignore</code>。</p><p id="0fa3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们从第二行的跟踪中移除<code class="fe ms mt mu mj b">node_modules</code>。</p><p id="6f9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用第三行中的更改进行新的提交。</p><p id="58a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用同样的方式忽略<code class="fe ms mt mu mj b">npm-debug.log</code>文件:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5ba9" class="mn lc iq mj b gy mo mp l mq mr">echo 'npm-debug.log' &gt;&gt; .gitignore<br/>git commit -am 'ignore npm-debug'</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/28fbcc2f587dda091bbfae8345e68208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*spuEeu5y6fxl1pos"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@reskp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jametlene Reskp </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="dd99" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="aa64" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">对于我们的节点项目，我们可以做一些事情来改进它。</p><p id="9d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以让垃圾收集更频繁，我们应该忽略自动生成的文件和文件夹。</p></div></div>    
</body>
</html>