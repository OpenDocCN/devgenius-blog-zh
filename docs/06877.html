<html>
<head>
<title>Microservices [Part 1] — With Maven, Spring Boot, And Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务[第 1 部分] —与 Maven、Spring Boot 和 Docker 合作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/microservices-part-1-with-maven-spring-boot-and-docker-4888a6bd05b5?source=collection_archive---------0-----------------------#2022-02-09">https://blog.devgenius.io/microservices-part-1-with-maven-spring-boot-and-docker-4888a6bd05b5?source=collection_archive---------0-----------------------#2022-02-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/020b7991efcbb31f6eba8b94f588d9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TXPmC8qLCfZ5vpnW56h49w.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">微服务插图由<a class="ae jz" href="https://dribbble.com/shots/3274271-Microservices-illustration-for-magazine-1" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ka">贝林圣</strong>T3】</a></figcaption></figure><p id="7743" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> <em class="kz">微服务</em> </strong>现在在 IT 界已经是家喻户晓，不需要特别介绍了。如果你以前使用过单体程序，你就会理解部署它们有多困难。从一系列的观点来看，软件越大，维护起来就越困难。</p><p id="4159" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">微服务<strong class="kd io"> <em class="kz">将组件</em> </strong>解耦，让我们可以专注于整个应用的一部分，部署更快，改进更快。最好的特性之一是能够使用各种数据库和技术。</p><p id="c32c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在本文中，我将教你如何使用<strong class="kd io"> <em class="kz"> Spring Boot </em> </strong>创建一个连接到运行在<strong class="kd io"> <em class="kz"> Docker </em> </strong>上的<strong class="kd io"> <em class="kz"> PostgreSQL </em> </strong>数据库的微服务。到源代码库的链接将在本教程的末尾添加。</p><h2 id="740a" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">设置 Maven</h2><p id="82bd" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">我们将使用<strong class="kd io"> <em class="kz"> Maven </em> </strong>作为这个项目的构建工具。如果已经安装了 Maven，可以跳过这一部分。如果没有，可以在  这里找到您的操作系统的安装指南<a class="ae jz" href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kd io"> <em class="kz">。然而，如果将 Maven 添加到您的路径变得令人头痛，有另一种方法可以解决它，如果您使用<strong class="kd io"> <em class="kz"> IntelliJ IDEA </em> </strong>作为您当前的 IDE。</em></strong></a></p><p id="c425" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你可以在你的 IntelliJ 目录下的 plugins 文件夹中找到 Maven 的路径(如果你像我一样使用 Windows 的话)。之后，进入<strong class="kd io"> <em class="kz">系统属性</em> </strong>，选择<strong class="kd io"> <em class="kz">环境变量</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/d6e0ce8fcf6a87eb93ad896ea1e4478c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*EvQC9YErm0PukDKPx7ylJg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">系统属性菜单</figcaption></figure><p id="0a5c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">然后，在【系统变量】<strong class="kd io"> <em class="kz">中添加一个新变量</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/c269e0b56522fee585b069021fa3870f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmsnpI2whwKC82HQqqKmPg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">向环境变量添加 MAVEN_HOME</figcaption></figure><p id="4d90" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">保存更改并使用您的命令提示符<strong class="kd io"> <em class="kz">检查您的 Maven 版本</em> </strong>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="36cc" class="la lb in me b gy mi mj l mk ml">mvn -v</span></pre><p id="83da" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">它看起来会像这样:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/e102d6364522718c8ea0a39171abddc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VtX7PWOE8In6YSPoNygMw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">检查 Maven 版本</figcaption></figure><h2 id="1fc9" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">创建项目</h2><p id="16cf" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">在你喜欢的任何地方创建一个目录，并从那里运行一个 shell。通过浏览到要从中启动命令提示符窗口的文件夹，并在窗口顶部的地址栏中输入 cmd，可以快速打开文件夹中的终端窗口。一旦你按下回车键，命令提示符将在你选择的地方打开。这在过去节省了我很多时间。</p><p id="ee1d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在你的命令行上执行下面的<strong class="kd io"> <em class="kz"> Maven 目标</em> </strong>来创建一个新的 Maven 项目(你可以改变<em class="kz"> groupId </em>、<em class="kz"> artifactId </em>以及类似的其他参数):</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="125c" class="la lb in me b gy mi mj l mk ml">mvn archetype:generate -DgroupId=com.anita.practice -DartifactId=anitaservices -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DinteractiveMode=false</span></pre><p id="f972" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">成功的生成过程如下所示:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/5a2f8fd960f99adabca475a2d1b88d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1LgwKaQSS3uK5PrAH1OeA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">成功生成 Maven 项目</figcaption></figure><p id="04b8" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如您所见，<strong class="kd io"> <em class="kz">生成目标</em> </strong>创建了一个与<em class="kz"> artifactId </em>同名的新目录。转到该目录，使用命令查看文件夹的结构:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="8b06" class="la lb in me b gy mi mj l mk ml">tree</span></pre><p id="1800" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">它将类似于这样:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/7c65e304f3f8ed014cfdbaa5889cfee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vt3sDgIOceT2xpnOo5RMng.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">父项目结构</figcaption></figure><p id="9a0f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如你所见，这是一个标准的 Maven 项目。让我们从在<strong class="kd io"> <em class="kz"> IntelliJ </em> </strong>中打开项目开始。</p><h2 id="3d0a" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">设置父模块相关性</h2><p id="f476" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">你可以自由使用任何 Java LTS 版本，只要它与我们的教程兼容。我用的是<strong class="kd io"> <em class="kz"> Java 17 </em> </strong>下面是我的项目结构:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/cd43019ea87a594aa64019bf53d15fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYVfuJ6yRO1BcXhMYYkmUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">项目结构</figcaption></figure><p id="cd84" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">根文件夹是<strong class="kd io"> <em class="kz">父项目</em> </strong>，在我的例子中是“<strong class="kd io"><em class="kz">anti taservices</em></strong>”。我们将使用 Maven 的多模块来拥有许多不同的依赖项，每个子模块将能够选择导入和使用哪些依赖项。在父模块中，我们还可以对所有微服务实施依赖。</p><p id="49b2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">您现在可以从父项目中移除 src 文件夹；我们在本课中不需要它，因为它只是一个父模块。</p><p id="820e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">打开<strong class="kd io"> <em class="kz"> pom.xml </em> </strong>文件。保留属性并删除依赖项的内容，因为我们将在几分钟后添加我们自己的内容。也删除所有插件。之后，文件应该如下所示:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="18d7" class="la lb in me b gy mi mj l mk ml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/><br/>&lt;project  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br/>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/><br/>  &lt;groupId&gt;com.anita.practice&lt;/groupId&gt;<br/>  &lt;artifactId&gt;anitaservices&lt;/artifactId&gt;<br/>  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br/><br/>  &lt;name&gt;anitaservices&lt;/name&gt;<br/>  &lt;url&gt;https://www.example.com&lt;/url&gt;<br/><br/>  &lt;properties&gt;<br/>    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br/>    &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;<br/>    &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;<br/>  &lt;/properties&gt;<br/><br/>  &lt;dependencies&gt;<br/>  &lt;/dependencies&gt;<br/><br/>  &lt;build&gt;<br/>    &lt;pluginManagement&gt;<em class="kz">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;<br/>      </em>&lt;plugins&gt;<br/>      &lt;/plugins&gt;<br/>    &lt;/pluginManagement&gt;<br/>  &lt;/build&gt;<br/>&lt;/project&gt;</span></pre><p id="ad52" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">首先，让我们为插件添加一些<strong class="kd io"> <em class="kz">新属性</em> </strong>和<strong class="kd io"> <em class="kz">依赖管理</em> </strong>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="04d2" class="la lb in me b gy mi mj l mk ml">&lt;properties&gt;<br/>  &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br/>  &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;<br/>  &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;<br/>  &lt;spring.boot.maven.plugin.version&gt;2.5.7&lt;/spring.boot.maven.plugin.version&gt;<br/>  &lt;spring.boot.dependencies.version&gt;2.5.7&lt;/spring.boot.dependencies.version&gt;<br/>&lt;/properties&gt;</span></pre><p id="99f6" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果你愿意，你可以单独控制这些版本<strong class="kd io"><em class="kz"/></strong>。</p><p id="72c2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在依赖关系上面，添加<strong class="kd io"><em class="kz">dependency management</em></strong>标签和下面的依赖关系:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="35a3" class="la lb in me b gy mi mj l mk ml">&lt;dependencyManagement&gt;<br/>  &lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>      &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;<br/>      &lt;version&gt;${spring.boot.dependencies.version}&lt;/version&gt;<br/>      &lt;scope&gt;import&lt;/scope&gt;<br/>      &lt;type&gt;pom&lt;/type&gt;<br/>    &lt;/dependency&gt;<br/>  &lt;/dependencies&gt;<br/>&lt;/dependencyManagement&gt;</span></pre><p id="4fa4" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这里我们将为项目中的每个模块添加<strong class="kd io"> <em class="kz">可选</em> </strong>的依赖项。</p><p id="3d01" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们现在添加一些<strong class="kd io"> <em class="kz">强制依赖</em> </strong>。</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="0591" class="la lb in me b gy mi mj l mk ml">&lt;dependencies&gt;<br/>  &lt;dependency&gt;<br/>    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>    &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>  &lt;/dependency&gt;<br/>  &lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>  &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="3a4c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">之后，我们再来添加一个<strong class="kd io"> <em class="kz">插件，用于构建神器</em> </strong>。</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="05db" class="la lb in me b gy mi mj l mk ml">&lt;build&gt;<br/>  &lt;pluginManagement&gt;<em class="kz">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;<br/>    </em>&lt;plugins&gt;<br/>      &lt;plugin&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;${spring.boot.maven.plugin.version}&lt;/version&gt;<br/>      &lt;/plugin&gt;<br/>    &lt;/plugins&gt;<br/>  &lt;/pluginManagement&gt;<br/>&lt;/build&gt;</span></pre><p id="7b42" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">修改后重新加载文件，您会注意到所有必需的子项目依赖项都被添加到了<strong class="kd io"> <em class="kz">父模块依赖项</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/33c4a6af0d7ed4fec232a36f604a1a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*kQ8j9mkJg2PMyoFQ4teKLA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">父模块依赖关系</figcaption></figure><p id="1e6a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你可以运行<strong class="kd io"> <em class="kz">清理</em> </strong>和<strong class="kd io"> <em class="kz">验证</em> </strong>来确保一切顺利运行。</p><h2 id="c6b5" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">添加第一个微服务</h2><p id="6030" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">现在我们已经完成了基础架构，我们可以开始考虑我们的第一个微服务，<strong class="kd io"> <em class="kz">学生</em> </strong>。我们还将构建一个 RESTful API，允许我们发布关于学生和数据库的信息。</p><p id="f890" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">让我们从在父文件夹中创建一个<strong class="kd io"> <em class="kz">独立模块</em> </strong>开始:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/250a4e0918b06aa3c2d18ba0a8efe353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sj3QplJJcKyOLN2YmNqrcw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">为学生微服务创建单独的模块</figcaption></figure><p id="858e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">通过命名下一页中的模块，您实际上就是在命名微服务。本模块的<strong class="kd io"> <em class="kz"> groupId </em> </strong>与父模块的相同，但是<strong class="kd io"> <em class="kz"> artifactId </em> </strong>不同，可以在<strong class="kd io"> <em class="kz">中看到工件坐标</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/b56289bc32cd81078a3454a4d9eac304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bJZHZZg1-F4Kdfp1kXSNw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">学生微服的神器坐标</figcaption></figure><p id="db81" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">单击“完成”后，项目中将出现一个新文件夹。如果打开<strong class="kd io"> <em class="kz">父 pom.xml </em> </strong>文件，您还会看到新添加的<strong class="kd io"> <em class="kz">模块部分</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/6d2cad56ddd5a5ed8d3de7974c38bbe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*0GVRbQbbR66OfAh0JpPBxw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">父模块的 pom.xml 文件中的模块部分</figcaption></figure><p id="8e00" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">当您打开 student 文件夹时，您会注意到它的结构与标准 Maven 项目非常相似。<strong class="kd io"> <em class="kz">学生的 pom.xml </em> </strong>文件中还有一个<strong class="kd io"> <em class="kz">父节</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/b1dcb6d8e6b5b491621c2fdda55c2eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MxvxmsqwN0Yy3YlS2KyJHg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">模块的 pom.xml 文件中的父节</figcaption></figure><p id="e96c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在这个模块中，我们需要一个<strong class="kd io"> <em class="kz"> RESTful web 服务</em> </strong>。我们将通过向 pom.xml 文件添加以下几行来添加一个<strong class="kd io"> <em class="kz"> web 依赖关系</em> </strong>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="1bca" class="la lb in me b gy mi mj l mk ml">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="4616" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果您单击依赖项部分旁边的这个小<strong class="kd io"> <em class="kz">符号</em> </strong></p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/301c678004a6b3bd1b3bb565711a5621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lg2ZF7H06zeNxAlsTFLDZg.png"/></div></div></figure><p id="a3c3" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">它会将您导航到版本 2.5.7  的<strong class="kd io"> <em class="kz">春季启动依赖项</em></strong></p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/eb51ccaec9fd2c42cb941ef568634868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eM-clIBI0qgxbEoyuMnRcA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">根据父 pom.xml 文件中指定的版本的 Spring Boot 依赖项</figcaption></figure><p id="e6c2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">正如您可能已经预料到的，这个 web 依赖项来自于<strong class="kd io"> <em class="kz">父 pom.xml </em> </strong>文件中提到的 spring boot 依赖项。从这里，每个微服务可以选择它需要的依赖项。</p><p id="2a9d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在项目的 java 文件夹中创建一个<strong class="kd io"> <em class="kz">新包</em> </strong>，并在那里创建一个<strong class="kd io"><em class="kz">student application</em></strong>类:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/04bb9e8e727df673590230d01a9d51a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PR9amEPkRmL5oqa--GucQA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">学生应用程序主类</figcaption></figure><p id="562a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们准备用<strong class="kd io"><em class="kz">@ spring boot application</em></strong>来注释这个类，并插入负责运行应用的 main 方法。完成这个基本设置后，该类应该如下所示:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="bac9" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">org.springframework.boot.SpringApplication</em>;<br/>import <em class="kz">org.springframework.boot.autoconfigure.SpringBootApplication</em>;<br/><br/><em class="kz">@SpringBootApplication<br/></em>public class <em class="kz">StudentApplication </em>{<br/><br/>    public static void main(<em class="kz">String</em>[] <em class="kz">args</em>) {<br/>        <em class="kz">SpringApplication</em>.<em class="kz">run</em>(<em class="kz">StudentApplication</em>.class, <em class="kz">args</em>);<br/>    }<br/>    <br/>}</span></pre><p id="f48a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们也在模块的<strong class="kd io"> <em class="kz">资源</em> </strong>文件夹中创建一个<strong class="kd io"> <em class="kz"> application.yml </em> </strong>文件，并声明基本属性:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="9f4c" class="la lb in me b gy mi mj l mk ml">server:<br/>  port: 8080<br/>  <br/>spring:<br/>  application:<br/>    name: student</span></pre><p id="3f5e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在，如果您在 IDE 中检查您的<strong class="kd io"> <em class="kz"> Maven 部分</em> </strong>，您将会看到它也包含我们新模块的动作:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/64d050a30811d02055093d5305a1cc0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*nrU2S4f-d5jYPcipT5lb8g.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Maven 部分包含学生模块及其自己的依赖项</figcaption></figure><p id="59a2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">Web 依赖项仅包含在学生模块中，测试和 Lombok 依赖项对于父模块的 pom.xml 中指定的模块是必需的。</p><p id="93c7" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你也可以为你的模块创建一个<strong class="kd io"> <em class="kz">自定义横幅</em> </strong>，这很疯狂吧？前往<a class="ae jz" href="https://devops.datenkollektiv.de/banner.txt/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kd io"> <em class="kz">本网站</em> </strong> </a>并从那里复制横幅:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/8f618f25a9bcbfc238542dcba37af7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDVhK6n-XPaabf5Ze9pi3w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">为 Spring Boot 应用程序创建自定义横幅</figcaption></figure><p id="bf7f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">返回，在 resources 文件夹中创建一个<strong class="kd io"> <em class="kz"> banner.txt </em> </strong>文件并粘贴到。Spring Boot 会自动帮你捡起来。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/82e0cb61955f9de8b09841d38f90a716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9gf4S9UbbroeW3ZLR369Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">将 banner.txt 添加到资源文件夹</figcaption></figure><p id="e421" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在，如果您运行<strong class="kd io"><em class="kz">student application</em></strong>，您会看到应用程序将以指定的自定义横幅开始:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/74ceb7b3baeec226f8f684bde5e1fed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5aqY9DWCV5efDCqgaoQFA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">应用程序已使用自定义横幅成功启动</figcaption></figure><h2 id="16c8" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">创建模型、控制器和服务</h2><p id="aa44" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">如你所见，用 Spring Boot 启动这个项目非常容易。现在，在我们的主工作文件夹中，让我们为我们的微服务创建一个简单的<strong class="kd io"> <em class="kz">学生</em> </strong>模型:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="d504" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">lombok.Builder</em>;<br/>import <em class="kz">lombok.Data</em>;<br/><br/><em class="kz">@Data<br/>@Builder<br/></em>public class <em class="kz">Student </em>{<br/>    private <em class="kz">Long </em>id;<br/>    private <em class="kz">String </em>firstName;<br/>    private <em class="kz">String </em>lastName;<br/>    private <em class="kz">String </em>email;<br/>}</span></pre><p id="dd47" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">接下来，让我们创建一个用于表示学生注册请求的<strong class="kd io"><em class="kz">StudentRegistrationRequest</em></strong>模型。为此，我使用了 Java 的新记录特性。Record 是一个很棒的特性，因为它消除了 POJOs 附带的样板代码，但是如果您使用的是旧版本的 Java，您可以只使用一个普通的类。</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="f9f3" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>public record <em class="kz">StudentRegistrationRequest</em>(<br/>        <em class="kz">String </em>firstName,<br/>        <em class="kz">String </em>lastName,<br/>        <em class="kz">String </em>email) {<br/>}</span></pre><p id="d9fc" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">让我们创建一个<strong class="kd io"> <em class="kz">学生服务</em> </strong>来处理这些请求:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="e32b" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">org.springframework.stereotype.Service</em>;<br/><br/><em class="kz">@Service<br/></em>public record <em class="kz">StudentService</em>() {<br/>    public void registerStudent(<em class="kz">StudentRegistrationRequest request</em>) {<br/>        <em class="kz">Student </em>student = <em class="kz">Student</em>.<em class="kz">builder</em>()<br/>                .firstName(<em class="kz">request</em>.firstName())<br/>                .lastName(<em class="kz">request</em>.lastName())<br/>                .email(<em class="kz">request</em>.email())<br/>                .build();<br/><br/>        <em class="kz">// TODO: Validate Request<br/>        // TODO: Store Student in DB<br/>    </em>}<br/>}</span></pre><p id="288e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">目前，我已经在代码中插入了一些 TODOs，但我们会很快回来。</p><p id="a1fa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们还需要为我们的服务定义一个 REST<strong class="kd io"><em class="kz">student controller</em></strong><em class="kz"/>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="34be" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">lombok.extern.slf4j.Slf4j</em>;<br/>import <em class="kz">org.springframework.web.bind.annotation.PostMapping</em>;<br/>import <em class="kz">org.springframework.web.bind.annotation.RequestBody</em>;<br/>import <em class="kz">org.springframework.web.bind.annotation.RequestMapping</em>;<br/>import <em class="kz">org.springframework.web.bind.annotation.RestController</em>;<br/><br/><em class="kz">@Slf4j<br/>@RestController<br/>@RequestMapping</em>("api/v1/students")<br/>public record <em class="kz">StudentController</em>(<em class="kz">StudentService </em>studentService) {<br/><br/>    <em class="kz">@PostMapping<br/>    </em>public void registerStudent(<em class="kz">@RequestBody StudentRegistrationRequest studentRegistrationRequest</em>) {<br/>        log.info("New Student Registration {}", <em class="kz">studentRegistrationRequest</em>);<br/>        studentService.registerStudent(<em class="kz">studentRegistrationRequest</em>);<br/>    }<br/>}</span></pre><p id="e758" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如您所见，该应用程序正在逐渐成形。现在是时候让<strong class="kd io"> <em class="kz">建立我们的数据库</em> </strong>和<strong class="kd io"> <em class="kz">配置我们的应用程序</em> </strong>以便我们可以在其中存储我们的学生。</p><h2 id="ed62" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">Docker 上的 PostgreSQL 和 pgAdmin</h2><p id="8f08" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">在父文件夹 anitaservices 中创建一个名为<strong class="kd io"><em class="kz">docker-compose . yml</em></strong>的新文件，并将以下设置放入其中:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="b561" class="la lb in me b gy mi mj l mk ml">services:<br/>  postgres:<br/>    container_name: postgres<br/>    image: postgres<br/>    environment:<br/>      POSTGRES_USER: postgres<br/>      POSTGRES_PASSWORD: postgres<br/>      PGDATA: /data/postgres<br/>    volumes:<br/>      - postgres:/data/postgres<br/>    ports:<br/>      - "5432:5432"<br/>    networks:<br/>      - postgres<br/>    restart: unless-stopped</span><span id="0fcf" class="la lb in me b gy nc mj l mk ml">  pgadmin:<br/>    container_name: pgadmin<br/>    image: dpage/pgadmin4<br/>    environment:<br/>      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL:-pgadmin4@pgadmin.org}<br/>      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD:-admin}<br/>      PGADMIN_CONFIG_SERVER_MODE: 'False'<br/>    volumes:<br/>      - pgadmin:/var/lib/pgadmin<br/>    ports:<br/>      - "5050:80"<br/>    networks:<br/>      - postgres<br/>    restart: unless-stopped<br/><br/>networks:<br/>  postgres:<br/>    driver: bridge<br/><br/>volumes:<br/>  postgres:<br/>  pgadmin:</span></pre><p id="11d2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们不会涉及太多细节，但是请记住，我们在这里声明了两个<em class="kz">服务、网络和卷</em>。对于数据库和 GUI，我们将分别使用<strong class="kd io"> <em class="kz"> Postgres </em> </strong>和<strong class="kd io"> <em class="kz"> pgAdmin </em> </strong>。在设置中，我们将<strong class="kd io"> <em class="kz">暴露端口</em> </strong>并在它们之间定义一个<strong class="kd io"> <em class="kz">共享网络</em> </strong>。</p><p id="1031" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果您有 IntelliJ IDEA 的终极版，您可以直接从文件中运行它，但是我将教您如何从终端运行它。在 docker-compose.yml 文件所在的目录下打开一个 shell，运行以下命令<strong class="kd io"> <em class="kz">启动 docker 进程</em> </strong>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="ff86" class="la lb in me b gy mi mj l mk ml">docker compose up -d</span></pre><p id="66c1" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这些进程将在一个<em class="kz">分离线程</em>中运行。您可以通过调用<strong class="kd io"> <em class="kz">来检查状态</em> </strong></p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="a9bd" class="la lb in me b gy mi mj l mk ml">docker compose ps </span></pre><p id="233a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你会看到我们有两个容器<strong class="kd io"><em class="kz"/></strong><strong class="kd io"><em class="kz">【Postgres】在端口 5432 </em> </strong>和<strong class="kd io"> <em class="kz"> pgAdmin 在端口 5050 </em> </strong>通过共享网络相互通信。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/37557fcc3566a455724688d2b446f138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NI_Jo0nIOCZFiyCWvKhmwg.png"/></div></div></figure><p id="d5aa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">您可以在浏览器中导航到 URL<a class="ae jz" href="http://HTTP://localhost:5050" rel="noopener ugc nofollow" target="_blank"><strong class="kd io"><em class="kz">HTTP://localhost:5050</em></strong></a>，如果您看到类似这样的内容，那么恭喜您，您已经成功启动了 docker 进程:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/25897597b4bb6511bd9702cfff96203b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaJEtshOgrDnvqNYkl7gJg.png"/></div></div></figure><h2 id="86d2" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">创建新服务器</h2><p id="5f93" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">让我们创建一个<strong class="kd io"> <em class="kz">新服务器</em> </strong>。当我们从一个容器连接到另一个容器时，主机是 Postgres。网络已在配置文件中定义。为该服务器命名，并使用您的凭据填写连接属性，如下所示:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/98184dd6dcf64986077fd6a9427fad51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wWPmJkVpK1qpixaSpe4ziQ.png"/></div></div></figure><p id="1073" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在添加新服务器时，如果你和我一样有<strong class="kd io"> <em class="kz">奇怪的问题</em> </strong>，当<em class="kz">主机拒绝连接</em>或者你因为<em class="kz"> Postgres 角色不存在</em>而无法登录 Postgres 容器时，让我来帮助你，让你节省一天的研究和调试时间。</p><p id="39aa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">其中一个问题可能是<em class="kz"> Postgres 在本地同一个端口</em>上运行，所以容器运行有问题。如果您不需要 PostgreSQL，您可以在本地删除它，或者只是从 Windows 服务菜单中停止该服务(如果您使用的是 Windows)。</p><p id="0c2e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">第二个问题可能是错误消息<em class="kz">“数据库认证失败”，同时提供正确的凭证</em>。即使您尝试使用用户 postgres 登录容器，它也可能会告诉您找不到角色 postgres。这些命令可以节省您的时间，并允许您最终创建一个新服务器:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="ddd7" class="la lb in me b gy mi mj l mk ml">docker-compose down --volumes<br/>docker-compose down --rmi all --volumes<br/>docker-compose up -d --force-recreate</span></pre><p id="80e5" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">希望您已经有了一个我们可以使用的数据库，现在，我们可以<strong class="kd io"> <em class="kz">配置我们的微服务</em> </strong>来连接它。</p><h2 id="f619" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">春季数据 JPA</h2><p id="99c4" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">复制以下代码，并将其粘贴到您的<strong class="kd io"> <em class="kz"> application.yml </em> </strong>文件中的应用程序名称下方:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="a48d" class="la lb in me b gy mi mj l mk ml">datasource:<br/>  username: 'postgres'<br/>  url: jdbc:postgresql://localhost:5432/student<br/>  password: 'postgres'<br/>jpa:<br/>  properties:<br/>    hibernate:<br/>      dialect: org.hibernate.dialect.PostgreSQLDialect<br/>      format_sql: 'true'<br/>  hibernate:<br/>    ddl-auto: update<br/>  show-sql: 'true'</span></pre><p id="07a6" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">数据源键、用户名、URL 和密码都存在。因为我们的应用程序不是作为容器启动的，所以<strong class="kd io"> <em class="kz"> URL 是 localhost </em> </strong>。如果它是一个容器，我们必须通过网络连接。</p><p id="4828" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">由于我们的数据库的名称是 student，让我们用这个名称<strong class="kd io"> <em class="kz">创建一个数据库</em> </strong>:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/efe26fc9d8da9cc92f3476c8d8273442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q2Me0Pb6YkrkiLbQVRNdGA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">数据库学生</figcaption></figure><p id="5c16" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">最后一步是打开<strong class="kd io"> <em class="kz">学生的 pom.xml </em> </strong>文件，添加<strong class="kd io"> <em class="kz"> JPA </em> </strong>和<strong class="kd io"> <em class="kz"> PostgreSQL </em> </strong>依赖项。</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="1f4a" class="la lb in me b gy mi mj l mk ml">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>    &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>    &lt;scope&gt;runtime&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="471e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">要正确地将学生表示为数据库对象，请打开您的<strong class="kd io"> <em class="kz">学生</em> </strong>类，并进行以下更改:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="9ecd" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">lombok.AllArgsConstructor</em>;<br/>import <em class="kz">lombok.Builder</em>;<br/>import <em class="kz">lombok.Data</em>;<br/>import <em class="kz">lombok.NoArgsConstructor</em>;<br/><br/>import <em class="kz">javax.persistence.</em>*;<br/><br/><em class="kz">@Data<br/>@Builder<br/>@Entity<br/>@AllArgsConstructor<br/>@NoArgsConstructor<br/></em>public class <em class="kz">Student </em>{<br/>    <em class="kz">@Id<br/>    @SequenceGenerator</em>(<br/>            name = "student_id_sequence",<br/>            sequenceName = "student_id_sequence"<br/>    )<br/>    <em class="kz">@GeneratedValue</em>(<br/>            strategy = <em class="kz">GenerationType</em>.SEQUENCE,<br/>            generator = "student_id_sequence"<br/>    )<br/>    private <em class="kz">Long </em>id;<br/>    private <em class="kz">String </em>firstName;<br/>    private <em class="kz">String </em>lastName;<br/>    private <em class="kz">String </em>email;<br/>}</span></pre><p id="29dd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">为学生创建一个简单的 JPA<strong class="kd io"><em class="kz">StudentRepository</em></strong>:</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="619f" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">org.springframework.data.jpa.repository.JpaRepository</em>;<br/><br/>public interface <em class="kz">StudentRepository </em>extends <em class="kz">JpaRepository</em>&lt;<em class="kz">Student</em>, <em class="kz">Long</em>&gt; {<br/>}</span></pre><p id="9f3c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> <em class="kz">将</em> </strong>这个资源库注入到<strong class="kd io"> <em class="kz">学生服务</em> </strong>和<strong class="kd io"> <em class="kz">保存</em> </strong>学生数据库中。</p><pre class="ly lz ma mb gt md me mf mg aw mh bi"><span id="93c2" class="la lb in me b gy mi mj l mk ml">package <em class="kz">com.anita.student</em>;<br/><br/>import <em class="kz">org.springframework.stereotype.Service</em>;<br/><br/><em class="kz">@Service<br/></em>public record <em class="kz">StudentService</em>(<em class="kz">StudentRepository </em>studentRepository) {<br/>    public void registerStudent(<em class="kz">StudentRegistrationRequest request</em>) {<br/>        <em class="kz">Student </em>student = <em class="kz">Student</em>.<em class="kz">builder</em>()<br/>                .firstName(<em class="kz">request</em>.firstName())<br/>                .lastName(<em class="kz">request</em>.lastName())<br/>                .email(<em class="kz">request</em>.email())<br/>                .build();<br/><br/>        <em class="kz">// TODO: Validate Request<br/>        <br/>        </em>studentRepository.save(student);<br/>    }<br/>}</span></pre><h2 id="e7f9" class="la lb in bd ka lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">测试应用程序</h2><p id="bc7b" class="pw-post-body-paragraph kb kc in kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ig bi translated">重新启动应用程序以应用更改。如果您检查 pgAdmin，您将看到新添加的表和序列:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/ce748eba750060ae7ad954422fc43bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_AO7H_pCEPXz91qE_Bn1Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">学生数据库中的学生表和序列</figcaption></figure><p id="1bc2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">然而，该表目前是空的。您可以使用<strong class="kd io"> <em class="kz"> Postman </em> </strong>向我们的 API 提交 POST 请求，并检查我们是否可以保存一个学生:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/1f85e28ea15af8507c18a118757303d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVJ_2e2fOn0ITM7hj5jBNQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">向学生 API 提交发布请求</figcaption></figure><p id="052f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">让我们<strong class="kd io"> <em class="kz">对我们的表运行一个查询</em> </strong>，看看我们得到了什么:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/1ba9637be91f4804e14afc652f676645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wr5MoOTmDX9QO2GuNy9ekQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">检查数据库中的学生表</figcaption></figure><p id="daa3" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你可以看到我们的微服务连接到自己的数据库。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3e14ce70edecfa3f0410aaa2aeb107f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*V7ZSau79A5SFgtj2-N6A7Q.gif"/></div></figure></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="c7e5" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我知道这个教程有点冗长，但是我希望你喜欢学习这些东西。如果你错过了什么，所有代码都可以在我的<a class="ae jz" href="https://github.com/anitalakhadze/microservices_practice" rel="noopener ugc nofollow" target="_blank"> <strong class="kd io"> <em class="kz"> GitHub 资源库</em> </strong> </a>上找到。</p><p id="07b7" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在下面的教程中，让我们看看如何使用我们的项目和<strong class="kd io"> <em class="kz"> Spring Cloud </em> </strong>和<em class="kz"> Kubernetes </em> 。</p><p id="b24e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> <em class="kz">敬请期待，不要错过！</em>T73】</strong></p></div></div>    
</body>
</html>