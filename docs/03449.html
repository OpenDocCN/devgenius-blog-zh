<html>
<head>
<title>Best of Modern JavaScript — Generator Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华——生成器方法</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-of-modern-javascript-generator-methods-e4eee6e002bb?source=collection_archive---------4-----------------------#2020-11-05">https://blog.devgenius.io/best-of-modern-javascript-generator-methods-e4eee6e002bb?source=collection_archive---------4-----------------------#2020-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7c88dade9190abcc91f62b5f8f5392e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jOf9fETpTSb5Bquh"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@jeisblack?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jason Blackeye </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1239" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究JavaScript生成器。</p><h1 id="78df" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第<code class="fe lz ma mb mc b">next()</code></h1><p id="a341" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">next</code>调用启动一个观察器。</p><p id="3cdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一次调用<code class="fe lz ma mb mc b">next</code>的唯一目的是启动观察器。</p><p id="49fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们向第一个<code class="fe lz ma mb mc b">next</code>调用传递一个值，它不会被<code class="fe lz ma mb mc b">yield</code>获得。</p><p id="5938" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="21e8" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  while (true) {<br/>    console.log(yield);<br/>  }<br/>}</span><span id="8851" class="mq lc iq mc b gy mv ms l mt mu">const gen = genFn();<br/>gen.next('a');<br/>gen.next('b');<br/>gen.next('c');</span></pre><p id="f99a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="564c" class="mq lc iq mc b gy mr ms l mt mu">b<br/>c</span></pre><p id="db66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已记录。</p><p id="7350" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">next</code>的第一个调用将<code class="fe lz ma mb mc b">'a'</code>提供给生成器，但是由于没有<code class="fe lz ma mb mc b">yield</code>语句，所以无法接收它。</p><p id="8fe1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦它运行<code class="fe lz ma mb mc b">yield</code>，那么就可以接收值。</p><p id="0580" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<code class="fe lz ma mb mc b">next</code>后，返回<code class="fe lz ma mb mc b">yield</code>的操作数。</p><p id="fdb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回值将是<code class="fe lz ma mb mc b">undefined</code>,因为我们没有操作数。</p><p id="cb07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二次调用<code class="fe lz ma mb mc b">next</code>将<code class="fe lz ma mb mc b">'b'</code>送入<code class="fe lz ma mb mc b">next</code>，由<code class="fe lz ma mb mc b">yield</code>接收。</p><p id="2209" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将记录在控制台日志中。</p><p id="ae23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为<code class="fe lz ma mb mc b">yield</code>没有操作数，所以<code class="fe lz ma mb mc b">next</code>再次返回<code class="fe lz ma mb mc b">undefined</code>值。</p><p id="bc8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们只能在调用<code class="fe lz ma mb mc b">next</code>时向<code class="fe lz ma mb mc b">yield</code>馈送数据。</p><p id="7fef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="8f77" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  while (true) {<br/>    console.log(yield);<br/>  }<br/>}</span><span id="3cba" class="mq lc iq mc b gy mv ms l mt mu">const gen = genFn();<br/>gen.next();<br/>gen.next('a');<br/>gen.next('b');<br/>gen.next('c');</span></pre><p id="0ac9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="b5e0" class="mq lc iq mc b gy mr ms l mt mu">a<br/>b<br/>c</span></pre><p id="2d2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已登录控制台。</p><h1 id="cf28" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">yield</code>捆绑松散</h1><p id="2414" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">yield</code>将它后面的整个表达式视为其操作数。</p><p id="51fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="bc6d" class="mq lc iq mc b gy mr ms l mt mu">yield foo + bar + baz;</span></pre><p id="5cc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么它被视为:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="a641" class="mq lc iq mc b gy mr ms l mt mu">yield (foo + bar + baz);</span></pre><p id="f3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而不是:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="bb58" class="mq lc iq mc b gy mr ms l mt mu">(yield foo) + bar + baz;</span></pre><p id="921d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们必须用括号将我们的<code class="fe lz ma mb mc b">yield</code>表达式括起来，这样我们可以避免语法错误。</p><p id="4e27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，不要写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="88ba" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  console.log('yielded: ' + yield);<br/>}</span></pre><p id="7710" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写道:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="5b8e" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  console.log('yielded: ' + (yield));<br/>}</span></pre><h1 id="3b79" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">return()</code>和<code class="fe lz ma mb mc b">throw()</code></h1><p id="e79d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">return</code>和<code class="fe lz ma mb mc b">throw</code>的方法与<code class="fe lz ma mb mc b">next</code>相似。</p><p id="f066" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们在<code class="fe lz ma mb mc b">yield</code>的位置返回一些东西。</p><p id="8146" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">throw</code>让我们在<code class="fe lz ma mb mc b">yield</code>的位置抛出一个表达式。</p><p id="2a65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">next</code>方法在<code class="fe lz ma mb mc b">yield</code>操作员处暂停。</p><p id="c610" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来自<code class="fe lz ma mb mc b">next</code>的值被发送到<code class="fe lz ma mb mc b">yield</code>。</p><p id="80a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">return</code>终止发电机。</p><p id="8650" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="86a3" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  try {<br/>    console.log('start');<br/>    yield;<br/>  } finally {<br/>    console.log('end');<br/>  }<br/>}</span><span id="2a81" class="mq lc iq mc b gy mv ms l mt mu">const gen = genFn();<br/>gen.next()<br/>gen.return('finished')</span></pre><p id="a8b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lz ma mb mc b">genFn</code>函数返回一个带有给定值的生成器。</p><p id="4ddf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">next</code>方法将运行发电机。</p><p id="b257" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe lz ma mb mc b">return</code>结束发电机。</p><p id="c54f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们记录<code class="fe lz ma mb mc b">return</code>调用的值，我们得到:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="684d" class="mq lc iq mc b gy mr ms l mt mu">{value: "finished", done: true}</span></pre><h1 id="fa44" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">throw() lets us Throw Errors</code></h1><p id="79f3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用关键字<code class="fe lz ma mb mc b">throw</code>抛出错误。</p><p id="7d00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="58a5" class="mq lc iq mc b gy mr ms l mt mu">function* genFn() {<br/>  try {<br/>    console.log('started');<br/>    yield;<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>}</span><span id="dd8b" class="mq lc iq mc b gy mv ms l mt mu">const gen = genFn();<br/>gen.next();<br/>console.log(gen.throw(new Error('error')));</span></pre><p id="f2e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用生成器函数调用<code class="fe lz ma mb mc b">throw</code>。</p><p id="9560" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们调用<code class="fe lz ma mb mc b">next</code>启动发电机，就会调用<code class="fe lz ma mb mc b">catch</code>块。</p><p id="41c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们会看到:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="99dc" class="mq lc iq mc b gy mr ms l mt mu">Error: error</span></pre><p id="671e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<code class="fe lz ma mb mc b">catch</code>区块的控制台日志记录。</p><p id="ac83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且从<code class="fe lz ma mb mc b">throw</code>调用返回<code class="fe lz ma mb mc b">{value: undefined, done: true}</code>。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d600437e18ba6ce286fe131173ddeaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8GkthRzCjawEAvtn"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@z734923105?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jerry Zhang </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="3071" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="bcb3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以调用<code class="fe lz ma mb mc b">next</code>方法，并使用不带操作数的<code class="fe lz ma mb mc b">yield</code>操作符。</p><p id="6b60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将从<code class="fe lz ma mb mc b">next</code>获取值并返回它。</p><p id="1eae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">生成器也有<code class="fe lz ma mb mc b">return</code>和<code class="fe lz ma mb mc b">throw</code>方法来结束生成器并抛出错误。</p></div></div>    
</body>
</html>