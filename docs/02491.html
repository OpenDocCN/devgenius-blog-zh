<html>
<head>
<title>Forecasting Football Fever</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测足球热</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/forecasting-football-fever-fe46fa779b69?source=collection_archive---------5-----------------------#2020-08-07">https://blog.devgenius.io/forecasting-football-fever-fe46fa779b69?source=collection_archive---------5-----------------------#2020-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fa03" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">探索深水港的季节性数据集</h2></div><p id="bb02" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">阿迪蒂亚·佩思</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/c44efac63930ca5cedff9af09c4ed35e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pA7ImOCtuN0njz0W"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">戴夫·阿达姆松在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ad63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每年九月到一月，足球接管美国。游戏主宰了周日和周一晚上的电视节目，我哥哥每周都为他一直表现不佳的梦幻球队而焦虑不安。当季后赛来临的时候，炒作似乎达到了一个无法忍受的程度。</p><p id="a5f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，有没有一种方法来衡量和预测这种炒作呢？我决定使用我最喜欢的NFL球员之一，培顿·曼宁，来探索Deephaven的Jupyter笔记本的季节性。使用从2008年到2016年8年期间曼宁的维基百科搜索频率的<a class="ae lr" href="https://github.com/facebook/prophet/blob/master/examples/example_wp_log_peyton_manning.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>，我的目标是打破足球炒作如何在整个赛季中演变。</p><p id="4131" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我决定采用两种方法来分析季节性。第一个是传统的ARIMA模型，第二个是更新的Fbprophet库。我会用这两种方法来拟合、预测和验证模型，看看哪种方法更能理解NFL的炒作。</p><h1 id="895a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">我们的数据</strong></h1><p id="9b59" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们可以使用以下代码在Deephaven中绘制数据:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="96b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">粗略看来，我们的数据是大约8年来每天对培顿·曼宁的维基百科页面浏览量的日志转换。这些数据似乎显示了一些我们可以研究的强烈的季节性趋势。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mr"><img src="../Images/4191d65e005b807da11e870446edfbf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nVs1sjhHzGM2864t"/></div></div></figure><p id="44f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，在我们开始分解数据之前，我们需要一种一致的方式来可视化我们的预测。我们可以创建一个函数，将我们的训练、测试和任何预测数据与Deephaven一起绘制出来。这使我们能够将来自多个库和方法的分析与Deephaven强大的交互式绘图相结合。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="0178" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak"> ARIMA </strong></h1><p id="04a2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">ARIMA模型代表自回归综合移动平均模型。</p><p id="3f1e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模型的自回归或AR分量是前N个季节滞后的线性组合。对于我们的培顿·曼宁模型，这意味着前N周、前N个月或前N年的线性组合。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/bfb00e1184f122c9da8461f2feef9e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*-F642ttLORlqUJkD"/></div></figure><p id="8df6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模型的移动平均分量是前N个季节滞后的误差项的线性组合，如下所示:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/7afc45fd8b8a81bdc3784272603dfb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/0*QCho8cFUdA9sDBte"/></div></figure><p id="64d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给定三个参数作为输入，ARIMA模型将估计这两种线性组合的系数:</p><ul class=""><li id="8fd2" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated"><strong class="kh ir"> p: </strong>自回归模型的阶数(滞后项的个数)，在上面的AR方程中描述。</li><li id="d847" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated"><strong class="kh ir">问:</strong>移动平均线模型的阶数(滞后项的个数)，在上面的MA方程中有描述。</li><li id="44fb" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated"><strong class="kh ir"> d: </strong>使时间序列平稳所需的差数。平稳时间序列本质上是一个没有时间相关趋势的时间序列，不包括季节性。</li></ul><p id="79eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下面的示例中，蓝色时间序列被认为是平稳的，而红色时间序列则是非平稳的，尽管两者都可能呈现出季节性模式。</p><p id="9629" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们知道了我们需要找到什么参数，我们可以分析我们的培顿·曼宁数据。乍一看，我们的数据似乎是稳定的。除了季节性波动之外，似乎没有与时间相关的趋势，但我们可以使用扩展的Dickey-Fuller检验来检验这一点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ac95d4dce01b26492a505e1ab0ef535e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*N49sgEkQuJfuf5Jv"/></div></figure><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="7adc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的测试返回了远低于显著性水平的p值，因此我们可以确认我们的模型确实是稳定的。d的参数值为零。</p><p id="9033" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们需要找到P和q的参数值。为了做到这一点，我使用了自相关图。自相关和偏自相关图可以显示滞后项与给定观察值的相关性有多强。虽然部分自相关图显示了滞后项与其他滞后项的相关性，但自相关图将其他滞后项的“惯性”考虑在内。因此，我们可以使用部分自相关来估计P的参数，使用自相关来估计q的参数。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ni"><img src="../Images/ee8085bf01cd51fe12ebe7742afc8ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ky17hqEGV-ycITs_"/></div></div></figure><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ni"><img src="../Images/7d42e736fa051ff75a5e057418f8406b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JHZgRGiSfZjMKLry"/></div></div></figure><p id="2784" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两个图都显示滞后的周期性行为，每个长度约为7天。这是有道理的——培顿·曼宁搜索频率可能会在比赛之夜增加，当足球比赛正在进行时。事实上，这些自相关图甚至显示了轻微的6天相关性，这很可能是由于周日晚上的足球比赛。但是由于7天的滞后与观察值的相关性最高，我们可以估计P和Q都是7。</p><p id="671a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我应该指出，这些自相关图提出了一个问题。ARIMA参数没有考虑到超过10的滞后输入，这意味着观察年度(365)或月度(30)季节性将非常困难。</p><p id="ca95" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了参数，我们可以生产我们的ARIMA模型。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="715b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们做出预测之前，我们可以用残差图和密度图来检查模型假设的方差和正态性。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nj"><img src="../Images/ff02df46e0c97166410656900e9e3164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WtXuiK7b3GX7tHuw"/></div></div></figure><p id="d356" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为残差看起来是随机分布的，并且核概率密度图看起来是正态的，所以我们的模型假设是正确的。</p><p id="8e3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">绘制我们的模型会产生以下结果:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mr"><img src="../Images/68a86f5d402c4dd2231c3202804279ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yDfx2W14CtC9AbmG"/></div></div></figure><p id="c685" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所看到的，没有其他季节性尺度会损害这个模型的可行性。不能捕捉多个季节趋势意味着ARIMA一次只能被一个季节所限制。不管怎样，我们可以返回一些误差估计量来验证我们的模型。</p><ul class=""><li id="8d16" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated"><strong class="kh ir">均方误差</strong>(均方误差):0 . 46860 . 48686868661</li><li id="d58a" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated"><strong class="kh ir"> MAPE </strong>(平均绝对百分误差):0.1。36866.88868688661</li></ul><h1 id="cf5d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">萨里玛</strong></h1><p id="28cd" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们实际上可以使用来自pmdarima的auto-SARIMA模型来验证我们的ARIMA模型。auto-SARIMA模型为我们估算了<strong class="kh ir"> p </strong>、<strong class="kh ir"> q </strong>和<strong class="kh ir"> d </strong>的参数值，因此不需要上述前奏。此外，SARIMA将季节性周期m作为一个参数。不幸的是，模型参数限制再次将我们限制在<strong class="kh ir"> m &lt; 10 </strong>内，因此我们可能只关注每周的季节性。</p><p id="0382" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">拟合和绘制我们的模型给我们提供了以下内容:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mr"><img src="../Images/4a539b0e29e555ddbcef9ed277e39481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OyPPpACAvMOp2dxw"/></div></div></figure><p id="55a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以用误差指标来验证我们的模型:</p><ul class=""><li id="e655" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">均方差(均方误差):0 . 46860 . 48686868661</li><li id="694d" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">MAPE (平均绝对百分比误差):0.1000000000001</li></ul><p id="f13f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到，我们的萨里玛模型与我们的ARIMA模型表现几乎相同，事实上，我们的ARIMA模型给出的平均绝对百分比误差比萨里玛略低。我们可以高兴的是，我们选择了最佳参数来拟合我们的ARIMA模型。</p><h1 id="912c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">先知</strong></h1><p id="0d76" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">对于我们的最终模型，我们将使用Fbprophet。</p><p id="86c4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fbprophet是脸书的一个库，用于处理季节性时间序列数据集。Prophet实现了一个基于加法模型预测时间序列数据的过程，其中非线性趋势与每年、每周和每天的季节性以及假日影响相适应。一般来说，使用prophet比我们的ARIMA模型需要更少的手工操作，而且在大多数情况下，我们可以像这样直接将数据输入Prophet:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a699" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使我们能够预测未来一年的情况，并将实际数据与预期值及其界限进行比较。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nk"><img src="../Images/a3b51c9c74fd0d41a56e40a0ba47288d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kTOVyfr7rsVB1T2c"/></div></div></figure><p id="2908" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，Prophet允许我们将这些数据分解为季节性的组成部分:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nl"><img src="../Images/82154e9e0c24ed4462c82805a2dc0b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QuaRQYWEAg6c6UCS"/></div></div></figure><p id="63b2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">曼宁的页面浏览量在2012-2013年达到顶峰，这是他的MVP年。不出所料，周一晚上的足球赛是大多数球迷看起来像男子汉的时候，月度季节性细分显示，12月和3月的疯狂高点与夏季的大旱形成鲜明对比。</p><p id="1d67" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Prophet可以做得更多，并在数据中添加变化点，这是趋势最有可能发生变化的地方。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nk"><img src="../Images/cbe39e1d51d6f9315f70a1ef5ada89c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YhXIjsYQBpXOpW-I"/></div></div></figure><p id="bad0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">利用这个特性，Prophet粗略估计了赛季的开始和结束，尤其是捕捉到了季后赛的窗口期。</p><p id="48ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅通过视力测试，我们的先知模型看起来比ARIMA更好，更连贯。但是我们可以使用MSE和MAPE再次验证模型预测。</p><ul class=""><li id="7687" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">平均误差(均方误差):0.30000363636767</li><li id="d2f0" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">MAPE (平均绝对百分比误差):0.0000000000001</li></ul><h1 id="9249" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="22d0" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">两个误差估计器都明确指出Prophet是更准确的模型。对于具有多个季节性的大型时间序列数据，ARIMA有许多缺点。在预测更复杂的时间序列数据集时，简单地使用以前滞后的回归来估计未来值是行不通的。ARIMA可能适用于具有简单季节效应的更有限的数据集，但特别是对于传感器数据、页面浏览量或能耗等数据，需要复杂的非线性模型(如Prophet)来进行预测。</p><p id="ae89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deephaven与Jupyter笔记本的集成允许用户拥有独特的、特定于库的绘图方法和操作以及Deephaven功能。Deephaven的绘图特别是在与fbprophet等新的尖端库结合使用时，在交互式绘图中提供了用户友好的可视化选项。</p></div></div>    
</body>
</html>