# 奇怪的重复证书条目

> 原文：<https://blog.devgenius.io/the-curious-case-of-duplicate-certificate-entries-34ae161160af?source=collection_archive---------2----------------------->

从凯撒时代(甚至更早)开始，加密和安全就已经变得非常重要，因为帝国、王国、个人、企业和所有人都在寻求保护他们的数据，尽管出于他们自己的原因。

但是，如果一个人不小心的话，一个简单的重复证书就可能对您自己的安全系统造成严重破坏。

这个故事不会告诉你如何创建证书，或者在 Glusterfs 的情况下如何启用 TLS/SSL 选项。

# **奇怪的错误**

假设这是一个美丽的星期五晚上，你已经完成了当天的大部分任务。web 应用程序部署在集群中，数据库得到优化，负载平衡得到处理，您只剩下一件小事——“在 glusterfs 中启用 TLS”。

文档非常简单。你也知道该怎么做。您继续创建自签名证书，即在 glusterfs 中为 N 个节点创建大约 N 个证书，然后将所有公共证书连接到一个名为 glusterfs.ca 的文件中。现在您可以使用另一种方法，即使用根 ca 和 CSR 等..等等。但是现在又是一个星期五的晚上，周末露营似乎已经很近了。只需执行一个命令行。

只有。

事情开始变得疯狂。对等体之间没有联系。存储本身是不可访问的，因为数据库正在使用此存储，而 web 应用程序正在使用数据库…您明白了吗？

再见露营！

那么是什么出了问题呢？你问..

你浏览日志，找到一个条目…

```
[2021-02-18 11:11:11.12312] E [socket.c:246:ssl_dump_error_stack]  0-socket.management:   error:0B07C065:x509 certificate  routines:X509_STORE_add_cert:cert already in hash table
```

想起什么了吗？

没有吗？

这是出问题的部分..glusterfs.ca

错误描述指出哈希表中已经有一个证书(现在从技术上讲，您只是将证书添加到一个文件中。).要点是 glusterfs.ca 中有一个重复的证书条目。

因此，松了一口气之后，您可以转到 glusterfs.ca，清除重复的证书条目，恢复依赖的服务，然后开始野营旅行。

对于那些希望避免这种情况的人，他们希望避免在第一次无意中在。ca 文件，破坏群集及其依赖的服务的稳定，那么必须先发制人。

# 预先检查重复的证书条目

现在可以手动浏览 glusterfs.ca(请不要！)但是如果您有一个包含多个节点的集群呢？

因此，更好的方法是在 glusterfs.ca 部署到节点之前，使用脚本来查找重复条目。

我已经创建了一个脚本，它检查 glusterfs.ca 并找到重复的条目，并且只通知哪个公共证书是重复的。对于那些想使用它的人来说，回购链接是[dupcertdetect](https://github.com/srijan-sivakumar/duplCertDetect)。

可以改进上述脚本，甚至删除重复的条目。(有人愿意贡献一些代码吗？)

总之，大多数的错误和失败都是由于一些人为因素造成的，手动验证永远不是解决问题的方法，也不是运行事物然后查看我们是否遇到任何错误的方法。很多时候，一个简单的林挺甚至解析都可以防止严重的错误，这些错误会毁了你的野营旅行(或者你的周末计划)。