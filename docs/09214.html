<html>
<head>
<title>3 Steps to Deploy TypeScript to AWS Elastic Beanstalk with Continuous Delivery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过持续交付将 TypeScript 部署到 AWS Elastic Beanstalk 的 3 个步骤</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/3-steps-to-deploy-typescript-to-aws-elastic-beanstalk-with-continuous-delivery-611bc7ecf15c?source=collection_archive---------4-----------------------#2022-08-07">https://blog.devgenius.io/3-steps-to-deploy-typescript-to-aws-elastic-beanstalk-with-continuous-delivery-611bc7ecf15c?source=collection_archive---------4-----------------------#2022-08-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3b34" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">查看我在<a class="ae kc" href="https://yumingchang1991.medium.com/technical-article-structure-on-medium-954850e1ef4d" rel="noopener">我的技术文章</a>中的所有帖子</h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/29bb20cfc3bbd8702860ab60c33d5b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uosPZqWbZz85-Akf"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@dianamia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> C 达斯汀</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="cb0f" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">背景</h1><p id="69f2" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我正在处理我的投资组合，并考虑在哪里部署我的 web 服务器。我加入的编码新兵训练营用的是 Heroku 然而，我注意到越来越多的职位空缺将 AWS 放在了他们的职位描述中。所以我问自己，这次把我的服务器部署到 AWS 怎么样？</p><h1 id="b304" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">目标</h1><p id="78cf" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">设置一个连续交付环境，这样我只需要在我的 repo 中管理 TypeScript，AWS 负责编译和部署。</p><h1 id="de2a" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">结果</h1><p id="199c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我最终使用以下 AWS 服务来实现我的目标:</p><ol class=""><li id="41f0" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated"><strong class="ln io">部署</strong>:使用<em class="ms"> AWS Elastic Beanstalk </em>自动整合 AWS 资源来托管和运行 web 应用程序</li><li id="a761" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated"><strong class="ln io">连续交付(CD) </strong>:使用<em class="ms"> AWS 代码管道</em>从 GitHub Repo 中拉源代码，配置 AWS 编译 TypeScript，并将编译结果部署到 AWS Elastic Beanstalk 中</li></ol></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><p id="4cd3" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">在继续之前，让我给你一些参考</p><ul class=""><li id="9ae4" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg ni mp mq mr bi translated">这是我的 GitHub 回购协议，如果你更有兴趣看看一个真正的回购协议</li><li id="1890" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">一旦我部署了中间件来阻止对我的服务器的随机请求，我将共享我的 AWS API 服务器的 URL(或者，出于安全考虑，我不应该共享它？请在评论中告诉我)</li></ul><p id="b891" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">我写这篇文章的动机是因为我找不到一个对初学者友好的教程。</p><p id="0af1" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">有两篇文章，但是它们要求我们知道存储弹性 Beanstalk 操作系统的相对目录:</p><ul class=""><li id="082f" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg ni mp mq mr bi translated">第一个是 Andrew Chung 在 2019 年发表的<a class="ae kc" href="https://medium.com/quick-code/how-i-automatically-deployed-typescript-to-elastic-beanstalk-to-speed-up-server-development-22b89870e159" rel="noopener"> <em class="ms">我如何自动将 Typescript 部署到 Elastic Beanstalk 以加快服务器端开发</em> </a></li><li id="0ccf" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">第二个是<a class="ae kc" href="https://medium.com/@lhviet88/deploy-a-typescript-expressjs-into-elasticbeanstalk-nodejs-server-8381e00e7e52" rel="noopener"> <em class="ms">在 2019 年由 Viet Hoang Le 在 ElasticBeanstalk NodeJS 服务器</em> </a>中部署一个 TypeScript，ExpressJS 应用程序</li><li id="c20a" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">这两篇文章是循环引用的</li></ul><p id="2f8b" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">在我的例子中，我不知道如何验证目录路径，所以我最终自己发现了一种不同的方法。(如果你知道找出目录路径的魔法，请告诉我怎么做)</p></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><h1 id="1f0b" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">将 TypeScript 部署到 AWS Elastic Beanstalk</h1><h2 id="dc73" class="no ku in bd kv np nq dn kz nr ns dp ld lu nt nu lf ly nv nw lh mc nx ny lj nz bi translated">先决条件</h2><ol class=""><li id="29ec" class="mh mi in ln b lo lp lr ls lu oa ly ob mc oc mg mo mp mq mr bi translated">您有一个 AWS 帐户<br/>(如果您没有，现在就去注册)</li><li id="4eed" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated">你对什么是 AWS 弹性豆茎和 AWS 代码管道有一个大致的概念</li><li id="0af0" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated">你不反对与 YAML <br/>合作(因为我们将使用它进行定制配置)</li><li id="0d58" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated">你知道如何运行一个打字服务器<br/>(如果你不知道编译对打字意味着什么，你可能想在继续之前<a class="ae kc" href="https://www.typescriptlang.org/docs/handbook/typescript-tooling-in-5-minutes.html#compiling-your-code" rel="noopener ugc nofollow" target="_blank">阅读这个官方文件</a></li></ol><h2 id="f6ba" class="no ku in bd kv np nq dn kz nr ns dp ld lu nt nu lf ly nv nw lh mc nx ny lj nz bi translated">步骤 1 —创建 AWS 弹性 Beanstalk 应用程序</h2><p id="f3ea" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">创建 AWS 弹性 Beanstalk 应用程序的过程应该非常直观。应用程序代码，我们现在只选择示例代码，稍后将通过 AWS 代码管道由我们的 repo 替换。</p><p id="d759" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">为我们的应用程序创建一个 AWS 弹性 Beanstalk 环境需要几分钟时间。一旦完成，我们可以进入下一步。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi od"><img src="../Images/a7be50f355376075dd421c22b7d7dd87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhLgT7QJcNy5-3Y__Rz0YQ.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">创建新的 AWS 弹性 Beanstalk 应用程序</figcaption></figure></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><h2 id="20a1" class="no ku in bd kv np nq dn kz nr ns dp ld lu nt nu lf ly nv nw lh mc nx ny lj nz bi translated">步骤 2 —创建新的 AWS 代码管道</h2><p id="8f6d" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">这一步需要注意的事项:</p><ol class=""><li id="d7b8" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated"><strong class="ln io">选择 GitHub repo 作为该管道的源代码。</strong>如果您是第一次在 AWS 上连接到 GitHub repo，它会要求您提供凭证以进行身份验证</li><li id="9f6a" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated"><strong class="ln io">选择 AWS 代码构建作为构建提供者</strong>。您需要创建一个新的代码构建项目。选择 docker 图像时要小心。<a class="ae kc" href="https://docs.aws.amazon.com/codebuild/latest/userguide/available-runtimes.html" rel="noopener ugc nofollow" target="_blank"> <em class="ms">查看此表</em> </a>以确保为您的预期运行时间选择正确的图像。</li><li id="8288" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg mo mp mq mr bi translated"><strong class="ln io">选择 AWS Elastic Beanstalk 作为部署提供商</strong>。您应该能够看到我们在步骤 1 中创建的应用程序和环境的名称。</li></ol><p id="d0ad" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">设置好 AWS 代码管道后，下一次我们向我们的 repo 推送新的提交时，它将触发这个 AWS 代码管道，并将我们的新代码部署到 AWS Elastic Beanstalk。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi oe"><img src="../Images/2cd08150e9a92aa8813c0293e1da9a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htXfz_RoCDoNEzO3PlszLA.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">创建新的 AWS 代码管道</figcaption></figure><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi of"><img src="../Images/a07151015dee1b93ad1777c81f494d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*669Iq5u9tR7qFTbdB_aIbA.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">配置此管道的源代码</figcaption></figure><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi og"><img src="../Images/2c9be1661d2262b801b843aa3137dae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1s7BtACzoHljlihTVsWbnQ.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">为此管道配置一个生成项目。让我们为我们的案例选择 AWS 代码构建。</figcaption></figure><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi oh"><img src="../Images/7ddd6a41e31c755ee07385c68d019970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaKee9_lXZ873Gkq-slelw.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">配置部署目标。让我们为我们的案例选择 AWS 弹性豆茎。</figcaption></figure><h2 id="f400" class="no ku in bd kv np nq dn kz nr ns dp ld lu nt nu lf ly nv nw lh mc nx ny lj nz bi translated">步骤 3 —在 GitHub Repo 的根路径中创建一个 buildspec.yml</h2><p id="ce47" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">现在我们已经准备好了 AWS 代码管道，但是它还不知道在构建阶段做什么。让我们创建一个<code class="fe oi oj ok ol b">buildspec.yml</code>文件，并将其放在 GitHub repo 的根路径中。这个文件告诉 AWS 代码构建要执行什么 Linux 命令。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="472e" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">需要注意的事项:</p><ul class=""><li id="77ff" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg ni mp mq mr bi translated">默认情况下，文件名必须是<code class="fe oi oj ok ol b">buildspec.yml</code>，除非您在浏览器控制台中创建新的 AWS 代码构建项目时指定了不同的名称</li><li id="e53c" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">第 1 行的<code class="fe oi oj ok ol b">version: 0.2</code>是强制的。它让 AWS 代码构建知道这个文件引用的是哪个构建规范版本。<code class="fe oi oj ok ol b">0.2</code>是我在 2022 年 8 月写这篇文章时的最新版本。<br/>在<a class="ae kc" href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html#build-spec-ref-versions" rel="noopener ugc nofollow" target="_blank"> <em class="ms"> AWS 官方文档</em>文档</a>上查看当前版本和语法</li><li id="d4bc" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">我们的构建环境需要在编译之前安装 typescript</li><li id="33bd" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated"><code class="fe oi oj ok ol b">artifacts</code>AWS 是用来指代输出文件集合的名称。只有在<code class="fe oi oj ok ol b">artifacts: files:</code>中指定的文件名将被捆绑并传递到 AWS 代码管道的下一阶段。<br/>AWS 代码构建的默认行为是捆绑从其输入构件接收的所有内容。然而，我们只需要将<code class="fe oi oj ok ol b">.js</code>文件部署到 AWS Elastic Beanstalk，这就是我在这里指定某些文件名的原因:只将<code class="fe oi oj ok ol b">javascript</code>文件传递到下一阶段。</li><li id="89c2" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">另一个要叫出来的是<code class="fe oi oj ok ol b">artifacts: files:</code>中的<code class="fe oi oj ok ol b">'build/**/*'</code>。在我的<code class="fe oi oj ok ol b">tsconfig.json</code>中，我将输出目录指定为根路径中一个名为<code class="fe oi oj ok ol b">build</code>的文件夹。因此字符串<code class="fe oi oj ok ol b">'build/**/*'</code>意味着传递名为<code class="fe oi oj ok ol b">build</code>的目录下的所有文件</li><li id="0f06" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated"><code class="fe oi oj ok ol b">discard-paths</code>表示我们是否希望输出 JavaScript 文件的结构与输入 TypeScript 文件的结构相同，或者我们是否希望放弃当前的文件结构，以便在输出中没有文件夹结构。<strong class="ln io">丢弃路径影响文件引用</strong>，所以是否丢弃路径取决于我们项目的复杂程度。<br/> <em class="ms">注</em> <br/> <em class="ms">当我在 2022 年 8 月写这篇文章的时候，这个项目非常简单，根本不需要单独的</em> <code class="fe oi oj ok ol b"><em class="ms">routes, controllers, services, and models</em></code> <em class="ms">所以上面的 config 设置了</em> <code class="fe oi oj ok ol b"><em class="ms">discard-paths</em></code> <em class="ms">到</em> <code class="fe oi oj ok ol b"><em class="ms">yes</em></code> <em class="ms">。到 2022 年底，我的项目发展到了值得花时间构建文件的地步，这样我就可以毫不费力地在杂乱的代码库中找到特定的部分。<br/>喊出来</em> <a class="oo op ep" href="https://medium.com/u/7e95a0734f83?source=post_page-----611bc7ecf15c--------------------------------" rel="noopener" target="_blank"> <em class="ms">阿卜杜勒·萨拉姆</em> </a> <em class="ms">谁点这个出来。</em></li><li id="b730" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated">最后，AWS Elastic Beanstalk 执行命令<code class="fe oi oj ok ol b">npm run start</code>来启动应用程序。由于我们只将<code class="fe oi oj ok ol b">javascript</code>文件传递给部署阶段，我们应该指定在我们的<code class="fe oi oj ok ol b">package.json</code>中执行一个<code class="fe oi oj ok ol b">.js</code>文件，如下所示</li></ul><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><p id="b4ae" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">在本地 repo 中创建了<code class="fe oi oj ok ol b">buildspec.yml</code>文件后，将这些更改推送到 GitHub repo 中，并观察代码管道的状态。</p><p id="d65a" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nf lw lx ly ng ma mb mc nh me mf mg ig bi translated">它现在像魔法一样工作，对吗？</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi oq"><img src="../Images/374eda0be6956a41bf105a7d1ebe25bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RD4JhvKN6kwQQBP8eCWGOg.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">通过 AWS 代码管道成功地将 TypeScript 服务器部署到 AWS Elastic Beanstalk</figcaption></figure></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><h1 id="5caa" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">参考</h1><p id="ed3b" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">帮助我完成这个挑战的唯一来源是通过挖掘 AWS 文档。</p><ul class=""><li id="b064" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg ni mp mq mr bi translated"><a class="ae kc" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/Welcome.html" rel="noopener ugc nofollow" target="_blank">关于弹性豆茎的 AWS 文件</a></li><li id="0931" class="mh mi in ln b lo mt lr mu lu mv ly mw mc mx mg ni mp mq mr bi translated"><a class="ae kc" href="https://docs.aws.amazon.com/codebuild/latest/userguide/welcome.html" rel="noopener ugc nofollow" target="_blank">关于代码构建的 AWS 文档</a></li></ul></div></div>    
</body>
</html>