<html>
<head>
<title>Filtering reviewers from Elsevier Expert Lookup from funder's database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从资助者数据库的 Elsevier 专家查询中筛选审查者</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/filtering-reviewers-from-expert-lookup-against-funder-datawarehouse-database-86df621191b5?source=collection_archive---------19-----------------------#2022-07-14">https://blog.devgenius.io/filtering-reviewers-from-expert-lookup-against-funder-datawarehouse-database-86df621191b5?source=collection_archive---------19-----------------------#2022-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5fc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">资助者使用 Elsevier Expert Lookup 查找已提交研究提案的评审者列表。仍然需要花费大量时间来检查从专家查找中选择的评审者是否已经与资助者联系，或者他们是否已经评估了来自资助者的提议。</p><p id="d02c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢，请在 https://www.buymeacoffee.com/rahulli 买咖啡给我</p><p id="8ce1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个脚本，资助者可以很容易地从资助者的数据库中的专家查找筛选审查者名单。</p><p id="ea1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您必须有一个相关提案的审阅者列表，作为一个 csv 文件，从 Expert Lookup 下载。此外，您还可以使用资助方数据库中的提案信息、申请人建议和阻止的评审人以及评审人的 excel 文件。总共有五个输入文件。</p><p id="877b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的 github 存储库中给出了文件的空示例(申请人信息、专家查找的审核人、建议的审核人、被阻止的审核人、数据库)及其列名:</p><div class="km kn gp gr ko kp"><a href="https://github.com/RaThorat/filtering_reviewers_from_Expert_Lookup" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">GitHub-RaThorat/filtering _ reviewers _ from _ Expert _ Lookup:资助者使用专家查找来获得一个列表…</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">资助者使用专家查找来查找提交的研究提案的评审者列表。仍然需要很多时间来…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">github.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><h1 id="46ce" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">韩德玲桂</h1><p id="a18b" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">如果您在 IDE 中运行以下代码，将出现一个图形用户界面(GUI ):单击“get proposal info ”(获取建议信息)以上传申请人信息文件。单击“获取建议的审核人”上传申请人建议的审核人文件。单击“获取数据仓库审核者”从资助方上传审核者数据库(这可能需要一两分钟。)单击“获取专家查找审阅者”从专家查找中上传 csv 文件。点击“获取非审核者”上传非审核者。然后关上窗户。</p><p id="2899" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该脚本将自动运行，然后您将在运行该文件的同一文件夹中获得一个筛选出的审阅者的 excel 文件。</p><h1 id="3d56" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">代码的准备:</h1><p id="534f" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">导入各种模块进行分析:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2606" class="mr lg iq mn b gy ms mt l mu mv">import pandas._libs.tslibs.base<br/>import numpy as np<br/>import os<br/>os.getcwd()<br/>from tkinter import filedialog<br/>import pandas as pd<br/>from tkinter import*<br/>import re<br/>from nameparser import HumanName</span></pre><p id="4341" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构造函数:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1ebf" class="mr lg iq mn b gy ms mt l mu mv">#function to get proposals information<br/>def getproposalinfo():<br/>    global df_pv3<br/>    import_file_path1 = filedialog.askopenfilename()<br/>    df_pv3 = pd.read_excel (import_file_path1)<br/><br/>#function to get suggested reviewers    <br/>def getsuggestedreviewers():<br/>    global df_SR<br/>    import_file_path2 = filedialog.askopenfilename()<br/>    df_SR = pd.read_excel (import_file_path2)<br/>    <br/>#function to get reviewers information from YOUR datawarehouse    <br/>def getdwhreviewers():<br/>    global df_dwh<br/>    import_file_path3 = filedialog.askopenfilename()<br/>    df_dwh = pd.read_excel (import_file_path3)<br/><br/>#function to get Expert Lookup CSV<br/>def getelcsv():<br/>    global df_RL<br/>    import_file_path4 = filedialog.askopenfilename()<br/>    df_RL = pd.read_csv(import_file_path4)<br/><br/>#function to get list of non reviewers<br/>def getnonreviewers():<br/>    global df_nonref<br/>    import_file_path5 = filedialog.askopenfilename()<br/>    df_nonref = pd.read_excel(import_file_path5)</span></pre><p id="c4d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 Tkinter 开发用户界面:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9684" class="mr lg iq mn b gy ms mt l mu mv">#Tkinter buildup    <br/>root=Tk()<br/>topframe=Frame(root)<br/>topframe.pack(side=TOP)<br/>bottomframe=Frame(root)<br/>bottomframe.pack(side=BOTTOM)<br/>redbtn=Button(topframe, command=getproposalinfo, text="get proposal info", fg="Red")<br/>redbtn.pack(side=LEFT)<br/>bluebtn=Button(topframe, command=getsuggestedreviewers, text="get suggested reviewers", fg="Blue")<br/>bluebtn.pack(side=LEFT)<br/>greenbtn=Button(topframe, command=getdwhreviewers, text="get datawarehouse reviewers", fg="Green")<br/>greenbtn.pack(side=LEFT)<br/>blackbtn=Button(bottomframe, command=getelcsv, text="get Expert Lookup reviewers", fg="Black")<br/>blackbtn.pack(side=LEFT)<br/>yellowbtn=Button(bottomframe, command=getnonreviewers, text="get non reviewers", fg="Violet")<br/>yellowbtn.pack(side=LEFT)<br/><br/>root.mainloop()</span></pre><h1 id="8908" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">正在处理专家查找中的审阅者列表:</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="33f6" class="mr lg iq mn b gy ms mt l mu mv">#replacing non existent values with nan<br/>df_RL =df_RL.replace(r'^\s*$', np.nan, regex=True)<br/>#resetting index<br/>df_RL=df_RL.reset_index()<br/>grantnumber=df_RL['GrantNumber'][0]<br/>df_pv3=df_pv3[df_pv3['Aanvraag dossier']==grantnumber]<br/>#resetting index<br/>df_pv3=df_pv3.reset_index()<br/>#For getting full name of the applicant from pivot table<br/>df_RL['Hoofdaanvrager']=df_pv3['Hoofdaanvrager']<br/><br/>#Renaming columns<br/>df_RL.rename(columns = {'GrantNumber':'Dossiernummer', 'Name':'Referent', 'Organization':'Inst','Country':'Land',<br/>                        'Scopus Author Detail Page Link': 'ScopusLink', 'Web Search link':'WebSearchLink', 'Notes':'Opmerking'}, inplace=True)<br/>#extracting details about the reviewers, such as title, first name, surname, gender<br/>Title=[]<br/>First_Name=[]<br/>Middle_Name=[]<br/>Last_Name=[]<br/>for person in df_RL['Referent']:<br/>    name = HumanName(person)<br/>    Title.append(name.title)<br/>    First_Name.append(name.first)<br/>    Middle_Name.append(name.middle)<br/>    Last_Name.append(name.last)<br/>df_RL.loc[:, ('Rangorde')] = ""<br/>df_RL.loc[:, ('Titel')]=Title<br/>df_RL.loc[:, ('Voornaam')] = First_Name<br/>df_RL.loc[:, ('Tuss')]=Middle_Name<br/>df_RL.loc[:, ('Achternaam')] = Last_Name<br/>df_RL.loc[:, ('URL')]=''<br/>df_RL.loc[:, ('m/v')]=''<br/>df_RL =df_RL.replace(r'^\s*$', np.nan, regex=True)</span></pre><h1 id="eb67" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">处理申请者或其他人建议的考核人</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="b6f4" class="mr lg iq mn b gy ms mt l mu mv">#Renaming columns of suggested reviewers<br/>df_SR.rename(columns = {'Grant No.':'Dossiernummer', 'Last Name':'Achternaam', 'First Name':'Voornaam', 'Affiliation':'Inst','Country':'Land', 'Scopus Author ID': 'ScopusLink'}, inplace=True)<br/><br/><br/>#filtering the suggested reviewers for the given proposal<br/>df_SR=df_SR[df_SR['Dossiernummer']==grantnumber]<br/>df_SR=df_SR.reset_index()</span></pre><p id="097f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在主审阅者列表(RL)中插入的建议审阅者行的“opmerking”列中撰写注释</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4215" class="mr lg iq mn b gy ms mt l mu mv">Bron=[]#Empty list<br/>for i in range(len(df_RL)):<br/>    for j in range(len(df_SR)):<br/>        if df_RL['Achternaam'][i]==df_SR['Achternaam'][j]:<br/>            item='Aanvrager, geen COI'# if the reviewer is selected by the applicant<br/>        else: item='Expert Lookup'<br/>        Bron.append(item)<br/>#creation of 'Bron' column<br/>df_RL['Bron'] = pd.DataFrame({'col':Bron})<br/><br/><br/>#rearranging columns<br/>df_RL=df_RL[['Rangorde','Bron', 'Dossiernummer', 'Referent','Titel','Voornaam','Tuss','Achternaam', 'Inst', 'Land', 'Email','m/v', 'URL', 'Opmerking', 'ProposalTitle', 'ProposalLink','Applicants','Hoofdaanvrager', 'ScopusLink', 'WebSearchLink', ]]<br/>df_RL=df_RL.reset_index(drop=True)<br/>#df_RL.head(2)</span></pre><p id="00e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">处理建议的审阅者列表并将其添加到审阅者主列表:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a0f2" class="mr lg iq mn b gy ms mt l mu mv">df_SR1=df_SR[['Dossiernummer', 'Achternaam', 'Voornaam',<br/>       'ScopusLink', 'Email', 'Inst', 'Land']]</span><span id="2db8" class="mr lg iq mn b gy mw mt l mu mv"># adding column with constant value<br/>if len(df_SR1.index)&gt;0:<br/>    df_SR1.loc[:, ('Bron')] = 'Aanvrager, maar misschien COI'<br/>    df_SR1.loc[:, ('Rangorde')] = ''<br/>    df_SR1.loc[:, ('Referent')] = ''<br/>    df_SR1.loc[:, ('Titel')]=' '<br/>    df_SR1.loc[:, ('Tuss')]=''<br/>    df_SR1.loc[:, ('URL')]=' '<br/>    df_SR1.loc[:, ('m/v')]=''<br/>    df_SR1.loc[:, ('Opmerking')] = ''<br/>    df_SR1.loc[:, ('ProposalTitle')]=df_RL['ProposalTitle']<br/>    df_SR1.loc[:, ('Referent')]= ''<br/>    df_SR1.loc[:, ('ProposalLink')]=df_RL['ProposalLink']<br/>    df_SR1.loc[:, ('Applicants')]=df_RL['Applicants']<br/>    df_SR1.loc[:, ('Hoofdaanvrager')]=df_RL['Hoofdaanvrager']<br/>    df_SR1.loc[:, ('WebSearchLink')]=''<br/>    #rearranging columns<br/>    df_SR1=df_SR1[['Rangorde','Bron', 'Dossiernummer', 'Referent','Titel','Voornaam','Tuss','Achternaam', 'Inst', 'Land', 'Email','m/v', 'URL', 'Opmerking', 'ProposalTitle', 'ProposalLink','Applicants', 'Hoofdaanvrager','ScopusLink', 'WebSearchLink']]<br/>        <br/>#adding suggested reviewers to reviewers master list    <br/>df_RL_ = pd.concat([df_RL, df_SR1], axis=0)<br/><br/><br/>#dropping duplicate records<br/>df_RL_=df_RL_.drop_duplicates(subset=['Dossiernummer', 'Achternaam'],keep="first")<br/><br/>df_RL_=df_RL_.sort_values('Dossiernummer')<br/><br/>df_RL_1=df_RL_.reset_index(drop=True)</span></pre><p id="7ed7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查“数据框架的形状”审阅者列表是否保持不变。这意味着审阅者的来源列表中没有添加额外的列。</p><h1 id="252c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">清理审阅者列表</h1><p id="635c" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">执行以下操作</p><p id="c1d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> i .栏目名称变更</strong></p><p id="b540" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NeR:否定回答，NoR:未回答，PoR:肯定回答，</p><p id="d130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">二世。删除不必要的列</strong></p><p id="aed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NeR2021 '，' NeR0 '，' NoR2021 '，' NoR0 '，' PoR2021 '，' PoR0 '，</p><p id="67a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">三。过滤非审核者</strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="b3c4" class="mr lg iq mn b gy ms mt l mu mv">df_dwh.columns=['Referent','Achternaam', 'Onbeschikbaar', 'Email', 'Inst', 'Geslacht', 'Opmerking', 'Overleden', 'Voornaam', 'Land', 'Dossiernummer', 'Hoofdaanvrager','NeR2022','NeR2021','NeR2020', 'NeR2019','NeR2018', 'NeR2017',<br/>                'NeR2016', 'NeR2015','NoR2022','NoR2021', 'NoR2020', 'NoR2019', 'NoR2018','NoR2017', 'NoR2016','NoR2015','PoR2022', 'PoR2021','PoR2020', 'PoR2019', 'PoR2018', 'PoR2017', 'PoR2016', 'PoR2015', 'Eindtotaal']<br/><br/><br/><br/>df_dwh1 = df_dwh.iloc[6:]<br/>df_dwh1=df_dwh1.reset_index(drop=True)</span></pre><h1 id="612a" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">查找评论者的称呼(博士或教授)</h1><p id="21bd" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">(假设:只选择审稿人的第一个称呼。)</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="db2c" class="mr lg iq mn b gy ms mt l mu mv">df_dwh1.loc[:, ('ScopusLink')]=''<br/>df_dwh1.loc[:, ('WebSearchLink')]=''<br/>df_dwh1.loc[:, ('ProposalTitle')]=''<br/>df_dwh1.loc[:, ('ProposalLink')]=''<br/><br/>#df_dwh1.head()</span></pre><p id="f093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将审核人列表数据框与“电子邮件”上的数据库数据框合并:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a74c" class="mr lg iq mn b gy ms mt l mu mv">#Merging reviewers list dataframe with database dataframe on 'email'</span><span id="583e" class="mr lg iq mn b gy mw mt l mu mv">df_RL2=df_RL_1.merge(df_dwh1, on='Email', how='left', indicator=True)<br/><br/><br/>#replacing NaN values with zero for further calculation<br/>df_RL2['Eindtotaal'].fillna(0, inplace=True)<br/><br/><br/>#changing the type of column Eindtotaal for comparison<br/>np.int64(df_RL2['Eindtotaal'])<br/></span></pre><p id="fa41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“opmerking”栏中填写已经注册的评审者是在资助者数据库中还是新加入数据库的</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="cddc" class="mr lg iq mn b gy ms mt l mu mv"><br/>df_RL2.loc[df_RL2['Eindtotaal']!=0, 'Opmerking']='Info is in datawarehouse'<br/><br/><br/>df_RL2.loc[df_RL2['Eindtotaal']==0, "Opmerking"]='New'</span></pre><h1 id="2d66" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">检查数据库中存在的审查者是否在 2021 年为资助者工作过</h1><p id="42dd" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated"><strong class="jp ir">替换 NaN 值，改变列“2021”的类型:</strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e65d" class="mr lg iq mn b gy ms mt l mu mv">df_RL2['PoR2021'].fillna(0, inplace=True)<br/>df_RL2['NoR2021'].fillna(0, inplace=True)<br/>df_RL2['NeR2021'].fillna(0, inplace=True)</span><span id="068a" class="mr lg iq mn b gy mw mt l mu mv">np.int64(df_RL2['PoR2021'])<br/>np.int64(df_RL2['NoR2021'])<br/>np.int64(df_RL2['NeR2021'])</span></pre><p id="e279" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">设置检查过滤器:</strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="15db" class="mr lg iq mn b gy ms mt l mu mv">df_RL2.loc[df_RL2['PoR2021']!=0, 'Opmerking']='Info is in datawarehouse, has assessed another application or round this year (2021)'<br/><br/><br/>df_RL2.loc[df_RL2['NoR2021']!=0, 'Opmerking']='Info is in datawarehouse, did not respond to another request or round this year (2021)'<br/><br/><br/>df_RL2.loc[df_RL2['NoR2021']!=0,'Opmerking']='Info is in datawarehouse, said no to review this year (2021) on another application or round'</span></pre><p id="ad5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">清理数据帧，删除不必要的列，重命名列，更改列的顺序以适应最终结果:</strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2f7e" class="mr lg iq mn b gy ms mt l mu mv">df_RL2=df_RL2.drop(columns={'Referent_y', 'Titel_x',<br/>       'Achternaam_y', 'Onbeschikbaar', 'Inst_y', 'm/v', 'Opmerking_y', 'Opmerking_x',<br/>       'Overleden', 'Voornaam_y', 'Land_y', 'Dossiernummer_y',<br/>       'ProposalTitle_y', 'ProposalLink_y', 'Hoofdaanvrager_y',<br/>       'ScopusLink_y', 'WebSearchLink_y',  'NeR2022','NeR2021','NeR2020', 'NeR2019', 'NeR2018',<br/>       'NeR2017', 'NeR2016', 'NeR2015', 'NoR2022','NoR2021', 'NoR2020','NoR2019',<br/>       'NoR2018', 'NoR2017', 'NoR2016', 'NoR2015', 'PoR2022','PoR2021', 'PoR2020',<br/>        'PoR2019', 'PoR2018', 'PoR2017', 'PoR2016', 'PoR2015', 'Eindtotaal',})<br/><br/><br/>df_RL2=df_RL2.rename(columns={'Dossiernummer_x':'Dossiernummer', 'Referent_x':'Referent', 'Titel_y':'Titel',<br/>       'Voornaam_x':'Voornaam', 'Achternaam_x':'Achternaam', 'Inst_x':'Inst', 'Land_x':'Land', <br/>'ProposalTitle_x':'ProposalTitle', 'ProposalLink_x':'ProposalLink', 'Hoofdaanvrager_x':'Hoofdaanvrager','ScopusLink_x': 'ScopusLink', 'WebSearchLink_x':'WebSearchLink','Geslacht':'m/v'})<br/><br/><br/>df_RL2=df_RL2[['Dossiernummer', 'Bron', 'Referent', 'Titel','Voornaam','Achternaam', 'Inst', 'Land', 'Email','m/v','Opmerking','ProposalTitle', 'ProposalLink', 'Applicants', 'Hoofdaanvrager',<br/>       'ScopusLink', 'WebSearchLink']]<br/><br/><br/>df_RL2 = df_RL2.assign(Rangorde='')<br/>df_RL2 = df_RL2.assign(Tuss='')<br/>df_RL2 = df_RL2.assign(URL='')<br/><br/><br/>df_RL2 =df_RL2.replace(r'^\s*$', np.nan, regex=True)</span></pre><p id="f4aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更改列的顺序</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1b68" class="mr lg iq mn b gy ms mt l mu mv">df_RL2 = df_RL2[['Rangorde','Bron','Dossiernummer', 'Referent', 'Titel', 'Voornaam', 'Tuss', 'Achternaam',<br/>       'Inst', 'Land', 'Email', 'Opmerking', 'URL', 'm/v','ProposalTitle', 'ProposalLink', 'Applicants','Hoofdaanvrager',<br/>       'ScopusLink', 'WebSearchLink']]</span></pre><h1 id="bf5b" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">搜索之前在 2018 年、2019 年和 2020 年申请的申请人</h1><p id="74e2" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">如果当前一轮 2021 年的申请人已经申请了前几年的申请，则在审核当前申请时，可以考虑这些申请的审核人。审查者可能会被要求再次审查申请，因为他们熟悉该主题。或者可以避开这些评审员，以防止对申请产生偏见。</p><p id="d81d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在资助者数据库中，我们搜索给定年份的申请号的公共字符串。例如，对于 2020 年，使用的申请号包含 2020 年和补贴名称。下面使用该公共字符串来分隔 2018 年、2019 年和 2020 年的申请。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9b48" class="mr lg iq mn b gy ms mt l mu mv">df_dwh_her=df_dwh1[(df_dwh1['Dossiernummer'].str.contains('COMMON STRING of APPLICATION NUMBERS 2018')) |(df_dwh1['Dossiernummer'].str.contains('COMMON STRING of APPLICATION NUMBERS 2019'))|(df_dwh1['Dossiernummer'].str.contains('COMMON STRING of APPLICATION NUMBERS 2020'))]<br/><br/><br/>df_dwh_her=df_dwh_her.reset_index()</span></pre><p id="4982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查数据仓库数据库和应用程序信息中的列</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="439f" class="mr lg iq mn b gy ms mt l mu mv"><br/>df_dwh_her.columns</span><span id="afa2" class="mr lg iq mn b gy mw mt l mu mv">df_pv3.columns</span></pre><p id="23ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将数据仓库数据帧与提案信息数据帧合并，得到重复申请的数据帧</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9622" class="mr lg iq mn b gy ms mt l mu mv">df_her=df_pv3.merge(df_dwh_her, on='Hoofdaanvrager', how='left', indicator=True)</span></pre><p id="1d34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查复制列</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a5df" class="mr lg iq mn b gy ms mt l mu mv">df_her.columns</span></pre><p id="e3f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">df_pv2 列是 Dossiernummer、Hoofdaanvrager、Hoofdaanvrager_Achternaam、Voornaam、Geslacht、Promotiedatum、C_Email、communicate Taal、HoofdOrganisatie、C_Organisatie、C_Postcode、C_Plaats、Titel、Samenvatting、Hoofddiscipline、Subdiscipline、Woord、SubsidieRonde_Naam、atl_Ingetrokken、atl _ Gehonoreerd</p><p id="0910" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除不必要的列并重命名剩余的列</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="7a83" class="mr lg iq mn b gy ms mt l mu mv">df_her=df_her.drop(columns='Dossiernummer')</span><span id="f0fb" class="mr lg iq mn b gy mw mt l mu mv">df_her=df_her.rename(columns={'Aanvraag dossier':'Dossiernummer', 'Titel_y':'Titel', 'Geslacht':'m/v'})</span></pre><p id="1035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查申请人‘hoofdaanvrager’是否在 2018 年、2019 年、2020 年申请过:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="536e" class="mr lg iq mn b gy ms mt l mu mv">df_her1=df_her[['Dossiernummer','Referent', 'Titel','Voornaam','Achternaam', 'Inst', 'Land', 'Email','m/v','Opmerking','Hoofdaanvrager', 'NeR2018','NoR2018','PoR2018', 'NeR2019','NoR2019','PoR2019', 'NeR2020','NoR2020','PoR2020']]<br/><br/><br/>df_her1 = df_her1.assign(Rangorde='')<br/>#df_her1 = df_her1.assign(Info_in_datawarehouse='Ja, herindiening')<br/>df_her1 = df_her1.assign(Tuss='')<br/>df_her1 = df_her1.assign(URL='')<br/>df_her1 = df_her1.assign(ProposalTitle='')<br/>df_her1 = df_her1.assign(ProposalLink='')<br/>df_her1 = df_her1.assign(ScopusLink='')<br/>df_her1 = df_her1.assign(WebSearchLink='')<br/><br/><br/>i=0<br/>k=df_her1.columns.get_loc('Hoofdaanvrager')<br/>l=len(df_her1.index)<br/>m=len(df_RL2.index)<br/>n=df_RL2.columns.get_loc('Hoofdaanvrager')<br/>for i in range(0,l):<br/>    j=0<br/>    for j in range(0,m):<br/>        if df_her1.iloc[i,k]==df_RL2.iloc[j,n]:<br/>            df_her1['ProposalTitle'][i]=df_RL2['ProposalTitle'][j]<br/>            df_her1['ProposalLink'][i]=df_RL2['ProposalLink'][j]         <br/>#df_her1.head(2)</span></pre><h1 id="1360" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">检查资助者数据库中已知的审查者是否审查过 2018 年的申请</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="254b" class="mr lg iq mn b gy ms mt l mu mv">#replacing NaN values with zero for further calculation<br/>df_her1['PoR2018'].fillna(0, inplace=True)<br/>df_her1['NoR2018'].fillna(0, inplace=True)<br/>df_her1['NeR2018'].fillna(0, inplace=True)<br/><br/><br/>#changing the type of column 2021 for comparison<br/>np.int64(df_her1['PoR2018'])<br/>np.int64(df_her1['NoR2018'])<br/>np.int64(df_her1['NeR2018'])<br/><br/><br/>df_her1.loc[df_her1['PoR2018']==1, 'Opmerking']='Info is in datawarehouse, reviewed an application from the same applicant last time (2018)'<br/><br/>df_her1.loc[df_her1['NoR2018']==1, 'Opmerking']='Info is in datawarehouse, did not respond last time (2018) to review an application from the same applicant'<br/><br/><br/>df_her1.loc[df_her1['NeR2018']==1, 'Opmerking']='Info is in datawarehouse, said no last time (2018) to review an application from the same applicant'</span></pre><h1 id="434a" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">检查资助者数据库中已知的审查者是否审查过 2019 年的申请</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="de48" class="mr lg iq mn b gy ms mt l mu mv">#replacing NaN values with zero for further calculation<br/>df_her1['PoR2019'].fillna(0, inplace=True)<br/>df_her1['NoR2019'].fillna(0, inplace=True)<br/>df_her1['NeR2019'].fillna(0, inplace=True)<br/><br/><br/>#changing the type of column 2021 for comparison<br/>np.int64(df_her1['PoR2019'])<br/>np.int64(df_her1['NoR2019'])<br/>np.int64(df_her1['NeR2019'])<br/><br/><br/>df_her1.loc[df_her1['PoR2019']==1, 'Opmerking']='Info is in datawarehouse, reviewed an application from the same applicant last time (2019)'<br/><br/><br/>df_her1.loc[df_her1['NoR2019']==1, 'Opmerking']='Info is in datawarehouse, did not respond last time (2019) to review an application from the same applicant'<br/><br/><br/>df_her1.loc[df_her1['NeR2019']==1, 'Opmerking']='Info is in datawarehouse, said no last time (2019) to review an application from the same applicant'</span></pre><h1 id="5b6d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">检查资助者数据库中已知的审查者是否审查过 2020 年的申请</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="b0c3" class="mr lg iq mn b gy ms mt l mu mv">#replacing NaN values with zero for further calculation<br/>df_her1['PoR2020'].fillna(0, inplace=True)<br/>df_her1['NoR2020'].fillna(0, inplace=True)<br/>df_her1['NeR2020'].fillna(0, inplace=True)<br/><br/><br/>#changing the type of column 2020 for comparison<br/>np.int64(df_her1['PoR2020'])<br/>np.int64(df_her1['NoR2020'])<br/>np.int64(df_her1['NeR2020'])</span><span id="be9a" class="mr lg iq mn b gy mw mt l mu mv"><br/>df_her1.loc[df_her1['PoR2020']==1, 'Opmerking']='Info is in datawarehouse, reviewed an application from the same applicant last time (2020)'<br/><br/>df_her1.loc[df_her1['NoR2020']==1, 'Opmerking']='Info is in datawarehouse, did not respond last time (2020) to review an application from the same applicant'<br/><br/>df_her1.loc[df_her1['NeR2020']==1, 'Opmerking']='Info is in datawarehouse, said no last time (2020) to review an application from the same applicant'<br/></span><span id="38cd" class="mr lg iq mn b gy mw mt l mu mv">df_her1 =df_her1.replace(r'^\s*$', np.nan, regex=True)<br/><br/>df_her1=df_her1.drop(columns={'NeR2018',<br/>       'NoR2018', 'PoR2018', 'NeR2019', 'NoR2019', 'PoR2019','NeR2020', 'NoR2020', 'PoR2020'})<br/><br/><br/>df_her1.loc[:, ('Bron')]=''<br/>df_her1.loc[:, ('Applicants')]=''<br/><br/><br/>#changing the order of the columns  <br/>df_her1 = df_her1[['Rangorde','Bron','Dossiernummer', 'Referent', 'Titel', 'Voornaam', 'Tuss', 'Achternaam',<br/>       'Inst', 'Land', 'Email', 'Opmerking', 'URL', 'm/v','ProposalTitle', 'ProposalLink','Applicants',  'Hoofdaanvrager',<br/>       'ScopusLink', 'WebSearchLink']]</span></pre><h1 id="9919" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">筛选在过去三年中审核过申请人任何提案的审核人</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="547e" class="mr lg iq mn b gy ms mt l mu mv">df_dwh2=df_dwh1[(df_dwh1['PoR2018']==1) |(df_dwh1['PoR2019']==1)|(df_dwh1['PoR2020']==1)]<br/>df_dwh2 = df_dwh2.reset_index(drop=True)</span><span id="c8d0" class="mr lg iq mn b gy mw mt l mu mv">df_her2=df_pv3.merge(df_dwh2, on='Hoofdaanvrager', how='left', indicator=True)<br/><br/><br/>df_her2=df_her2.drop(columns='Dossiernummer')<br/>df_her2=df_her2.rename(columns={'Aanvraag dossier':'Dossiernummer','Titel_y':'Titel', 'Geslacht':'m/v'})<br/>#To check if in 2019 or 2018 there is a reapplication<br/>df_her3=df_her2[['Dossiernummer','Referent', 'Titel','Voornaam','Achternaam', 'Inst', 'Land', 'Email','m/v','Opmerking','Hoofdaanvrager', 'PoR2018', 'PoR2019', 'PoR2020']]<br/>df_her3 = df_her3.assign(Rangorde='')<br/>#df_her1 = df_her1.assign(Info_in_datawarehouse='Ja, herindiening')<br/>df_her3 = df_her3.assign(Tuss='')<br/>df_her3 = df_her3.assign(URL='')<br/>df_her3 = df_her3.assign(ProposalTitle='')<br/>df_her3 = df_her3.assign(ProposalLink='')<br/>df_her3 = df_her3.assign(ScopusLink='')<br/>df_her3 = df_her3.assign(WebSearchLink='')<br/><br/><br/>df_her3.loc[:, ('Opmerking')]='has assessed an application from the main applicant in the past three years'<br/><br/><br/>df_her3.loc[:, ('Bron')]=''<br/>df_her3.loc[:, ('Applicants')]=''<br/><br/><br/>#changing the order of the columns  <br/>df_her3 = df_her3[['Rangorde','Bron','Dossiernummer', 'Referent', 'Titel', 'Voornaam', 'Tuss', 'Achternaam',<br/>       'Inst', 'Land', 'Email', 'Opmerking','URL', 'm/v','ProposalTitle', 'ProposalLink','Applicants',  'Hoofdaanvrager',<br/>       'ScopusLink', 'WebSearchLink']]</span></pre><h1 id="6e7c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">过滤非审阅者</h1><p id="6bf3" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">(如果申请人提交了不希望其申请被审查的非审查人员名单):</p><p id="b05b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常按申请号提供带有非审核者姓名的 excel 文件。通常，非评审人员的姓名与大学名称和电子邮件地址一起提供，用逗号分隔。</p><p id="73c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果姓名和其他信息(如大学名称、电子邮件地址等)一起出现在 excel 单元格中，则将非读者姓名与其他文本分开。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="fa51" class="mr lg iq mn b gy ms mt l mu mv">df_nonref['referent naam']=df_nonref['Naam'].str.split(',').str[0]<br/>df_nonref.head()<br/>First_Name=[]<br/>Last_Name=[]<br/>for person in df_nonref['referent naam']:<br/>    name = HumanName(person)<br/>    First_Name.append(name.first)<br/>    Last_Name.append(name.last)<br/>df_nonref['First Name'] = First_Name<br/>df_nonref['Last Name'] = Last_Name<br/>#pd.DataFrame({'First_Name':First_Name,'Last_Name':Last_Name})</span></pre><p id="cd17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些非评审者可能出现在专家查询和资助者数据库的评审者列表中。他们仍然可以留在列表中，但要有一个说明，明确表示不得联系他们来审查给定的应用程序。</p><p id="514f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提取电子邮件地址，以便我们可以使用这些地址从审阅者数据库中进行筛选:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8cb4" class="mr lg iq mn b gy ms mt l mu mv">email=[]<br/>for referenten in df_nonref['Naam']:<br/>    # \w matches any non-whitespace character<br/>    # @ for as in the Email<br/>    # + for Repeats a character one or more times<br/>    FindEmail = re.findall("([\w.-]+@[\w.-]+)", referenten)<br/>    # run for loop on the list variable<br/>    for l in FindEmail:<br/>    #set value in email variable<br/>        emaill=l<br/>    #declare local variables to store email addresses<br/>    email.append(emaill)<br/>df_nonref['Email']=email</span></pre><p id="86a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提取大学名称:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="599a" class="mr lg iq mn b gy ms mt l mu mv">df_uni = pd.DataFrame()<br/>for referenten in df_nonref['Naam']:<br/>    text=referenten<br/>    matchlist = ['Hospital','University','Universitäts','Universität','Università','Hogeschool','Labs', 'Laboratory', 'Zoo','Institute','Institut','School','Ecole','Academy', 'Universite','College','Universitaet,' '* University'] <br/>    # define all keywords that you need look up<br/>    p = re.compile('^(.*?),\s+(.*?),(.*?)\.')   # regex pattern to match<br/>    # We use a list comprehension using 'any' function to check if any of the item in the matchlist can be found in either group1 or group2 of the pattern match results<br/>    text_match = [m.group(1) if any(x in m.group(1) for x in matchlist) else m.group(2) for m in re.finditer(p,text)]<br/>    df_uni = df_uni.append(text_match, ignore_index=True)<br/>df_nonref['Inst']=df_uni.iloc[0:]</span></pre><p id="1573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">定义非审阅者数据框架</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4d82" class="mr lg iq mn b gy ms mt l mu mv">df_nRef=pd.DataFrame(columns=['Proposal Number','Grant No.','Last Name', 'First Name', 'Scopus Author ID', 'OrcId', 'Email', 'Affiliation', 'Country'])</span></pre><p id="61c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如有必要，从授权号中提取最后一位数字以填入提案号:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="735e" class="mr lg iq mn b gy ms mt l mu mv">#df_nRef['Proposal Number']=df_nonref['Project dossier'].str.split('.').str[-1]</span></pre><p id="ce55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为每列赋值</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8c6f" class="mr lg iq mn b gy ms mt l mu mv">df_nRef['Bron']='Aanvrager'<br/>df_nRef['Dossiernummer']=df_nonref['Dossiernr']<br/>df_nRef['Rangorde']=''<br/>df_nRef['Referent']=df_nonref['referent naam']<br/>df_nRef['Titel']=''<br/>df_nRef['Achternaam']=df_nonref['Last Name']<br/>df_nRef['Tuss']=''<br/>df_nRef['Voornaam']=df_nonref['First Name']   <br/>df_nRef['Email']=df_nonref['Email']<br/>df_nRef['Inst']=df_nonref['Inst']<br/>df_nRef['Land']=''<br/>df_nRef['m/v']=''<br/>df_nRef['Hoofdaanvrager']=df_nonref['Aanvrager']<br/>df_nRef['ProposalTitle']=''<br/>df_nRef['ScopusLink']=''<br/>df_nRef['WebSearchLink']=''<br/>df_nRef['URL']=''<br/>df_nRef['Applicants']=''<br/>df_nRef['Opmerking']='Nonreferent'<br/>df_nRef['ProposalLink']=''<br/>#changing the order of the columns  <br/>df_nRef = df_nRef[['Rangorde','Bron','Dossiernummer', 'Referent', 'Titel', 'Voornaam', 'Tuss', 'Achternaam',<br/>       'Inst', 'Land', 'Email', 'Opmerking','URL', 'm/v','ProposalTitle', 'ProposalLink','Applicants',  'Hoofdaanvrager',<br/>       'ScopusLink', 'WebSearchLink']]</span></pre><p id="5f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从资助者数据仓库数据库，从去年的重新申请人，从非审查者，从合作者附加数据帧</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5ed2" class="mr lg iq mn b gy ms mt l mu mv">df_RL3=pd.DataFrame().append([df_RL2,df_her1, df_her3, df_nRef])</span></pre><h1 id="d7f8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">正在处理审阅者的最终列表</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="806e" class="mr lg iq mn b gy ms mt l mu mv">df_RL3['Bron'] = df_RL3['Bron'].fillna('Expert Lookup')<br/><br/>df_RL3=df_RL3.reset_index(drop=True)<br/><br/>df_RL3 =df_RL3.replace(r'^\s*$', np.nan, regex=True)<br/><br/>df_RL3 = df_RL3.dropna(how='any',<br/>                    subset=['Achternaam'])<br/><br/>df_RL3["Opmerking"].replace({"-": "New"}, inplace=True)<br/>#https://www.kite.com/python/answers/how-to-replace-column-values-in-a-pandas-dataframe-in-python#:~:text=To%20replace%20values%20in%20the,old%20values%20to%20new%20values.<br/><br/>df_RL3=df_RL3.sort_values('Opmerking',ascending=True).drop_duplicates('Email',keep='last')<br/>#Source:https://kanoki.org/2019/10/25/how-to-remove-duplicate-data-from-python-dataframe/<br/><br/>df_RL3=df_RL3.sort_values('Applicants')<br/><br/>df_RL4 = df_RL3.reset_index(drop=True)</span></pre><h1 id="7c22" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Step 导出每个建议的审阅者列表</h1><p id="f26a" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">设置 openpyxl 模块</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="baad" class="mr lg iq mn b gy ms mt l mu mv">from openpyxl.utils.dataframe import dataframe_to_rows<br/>from openpyxl import Workbook<br/>from openpyxl.styles import Color, PatternFill, Font, Border, Alignment<br/>from openpyxl.styles.differential import DifferentialStyle<br/>from openpyxl.formatting.rule import ColorScaleRule, CellIsRule, FormulaRule<br/>from openpyxl.formatting import Rule<br/>import openpyxl<br/>from typing import NoReturn<br/>from openpyxl.worksheet.dimensions import ColumnDimension<br/>from openpyxl.utils import get_column_letter</span></pre><p id="a553" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置 excel 的首页</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8d5a" class="mr lg iq mn b gy ms mt l mu mv">nummer=df_RL_1['Dossiernummer'][0]<br/>df1=df_RL4[df_RL4['Dossiernummer']==nummer]<br/>df1=df1.reset_index(drop=True)<br/>a_list=df1['Applicants'][0]<br/>#Applicants = "|".join(a_list)<br/>titles=df1['ProposalTitle'].unique()<br/>titel=titles[0]<br/><br/>Expert_Lookup_links=df1['ProposalLink'].unique()<br/>Expert_Lookup_link=Expert_Lookup_links[0]<br/><br/><br/>wb = Workbook()<br/><br/>ws = wb.create_sheet("Instructions", 0)<br/>ws['A1']='file no'<br/>ws['A1'].font = Font(bold=True)<br/>ws['B1']= nummer<br/>ws['A2']='Applicants'<br/>ws['A2'].font = Font(bold=True)  <br/>ws['B2']=a_list<br/>ws['A3']='Title'<br/>ws['A3'].font = Font(bold=True)<br/>ws['B3']=titel<br/>#ws['A4']='Herindiening?'<br/>ws['A4'].font = Font(bold=True)<br/>#ws['B4']=herindiening<br/>ws['A5']='Instructions'<br/>ws['A5'].font = Font(bold=True)<br/>ws['B5']='The referees have been filtered automatically on points below. Very occasionally something slips through, so we ask you to check the suggestions.'<br/>ws['B6']='Sometimes the websearch link doesn not work or it grabs the wrong person. Please note that.'<br/>ws['B7']='Sometimes the sponsor does not belong to the application at all in terms of expertise. Please note that.'<br/>ws['B8']='If the first three or four referees do not match the application, it is better not to use the list.'<br/>ws['B9']=''<br/>ws['B10']='The automatically generated suggestions are based on a fingerprint that is generated in Expert Lookup based on the information in the application: the name of the applicant and any co-applicants, the summary and the keywords.'<br/>ws['B11']=''<br/>ws['B12']='The automatically generated suggestions are filtered in "Search and Select" by:'<br/>ws['B13']='a.appropriate expertise for the proposal (based on the above-mentioned fingerprint)'<br/>ws['B14']='b.no involvement in the proposal -&gt; if the sponsor is mentioned in the proposal (for example as a collaboration partner)'<br/>ws['B15']='c.no joint publications (in the last 3 years)'<br/>ws['B16']='d.sufficient seniority (Referees are at least an associate professor or equivalent. If there is an excellent match in expertise, a more junior referee can review.)'<br/>ws['B17']='e.resubmissions: we do not ask the same referees as for the previous submission'<br/>ws['B18']='f.has not worked as a reviewer in the past 6 months for another round'<br/>ws['B19']='g.has not worked as a reviewer in the past three years to assess an application from the same MAIN applicant'<br/>ws['B20']=''<br/>ws['B21']='For missing information (registration order, salutation, URL, sex), you can use the WebSearchLink or the scopus id link.'<br/>ws['B22']=''<br/>ws['B23']='To search for additional referees you can use the Expert lookup link below. Note: you must have an Expert Lookup account to open the link.'<br/>ws['B24']=Expert_Lookup_link<br/>ws['A24']='EL link'<br/>ws['A24'].font = Font(bold=True)<br/><br/>ws['B26'] = 'Work overview referees on the next worksheet (enter the final selection yourself in the data warehouse)'<br/>ws['B26'].font = Font(bold=True)</span></pre><p id="1df3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">函数来适应列单元格中的审阅者信息</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="b893" class="mr lg iq mn b gy ms mt l mu mv">def columns_best_fit(ws: openpyxl.worksheet.worksheet.Worksheet) -&gt; NoReturn:<br/>    """<br/>    Make all columns best fit<br/>    """<br/>    column_letters = tuple(openpyxl.utils.get_column_letter(col_number + 1) for col_number in range(ws.max_column))<br/>    for column_letter in column_letters:<br/>        ws.column_dimensions[column_letter].bestFit = True</span></pre><p id="0961" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将该功能应用于审阅者列表 excel 表</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4e49" class="mr lg iq mn b gy ms mt l mu mv">columns_best_fit(ws)</span></pre><p id="4631" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">格式化审阅者列表 excel 表格</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="6fb4" class="mr lg iq mn b gy ms mt l mu mv">df2=df1.drop(['Dossiernummer','Referent','Hoofdaanvrager','Applicants','ProposalTitle','ProposalLink'], axis=1)    <br/>df2=df2.reset_index(drop=True)<br/>df2=df2.sort_values('Email')<br/>ws1 = wb.create_sheet("Referentenlijst", 1) <br/>for r in dataframe_to_rows(df2, index=False, header=True):<br/>    ws1.append(r)<br/><br/>for cell in ws1['1'] :#+ ws[1]<br/>    cell.style = 'Pandas'</span></pre><p id="8776" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">格式化整行</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a05a" class="mr lg iq mn b gy ms mt l mu mv">red_fill = PatternFill(bgColor="FFC7CE")<br/>dxf = DifferentialStyle(fill=red_fill)<br/>r = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r.formula = [('$J1="Info is in data warehouse, has assessed another application or round this year (2021)"')]<br/>ws1.conditional_formatting.add("A1:O100", r)<br/>r1 = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r1.formula = [('$J1="has assessed an application from the main applicant in the past three years"')]<br/>ws1.conditional_formatting.add("A1:O100", r1)<br/>r2 = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r2.formula = [('$J1="Info is in data warehouse, reviewed application from same applicant last time (2018)"')]<br/>ws1.conditional_formatting.add("A1:O100", r2)<br/>r3 = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r3.formula = [('$J1="Info is in data warehouse, reviewed application from same applicant last time (2019)"')]<br/>ws1.conditional_formatting.add("A1:O100", r3)<br/>r4 = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r4.formula = [('$J1="Info is in data warehouse, reviewed application from same applicant last time (2020)"')]<br/>ws1.conditional_formatting.add("A1:O100", r4)<br/>r5 = Rule(type="expression", dxf=dxf, stopIfTrue=True)<br/>r5.formula = [('$J1="Nonreviewer"')]<br/>ws1.conditional_formatting.add("A1:O100", r5)<br/>column_widths = []<br/>for row in ws1:<br/>    for i, cell in enumerate(row):<br/>        if len(column_widths) &gt; i:<br/>            if len(str(cell.value)) &gt; column_widths[i]:<br/>                column_widths[i] = len(str(cell.value))<br/>        else:<br/>            column_widths += [len(str(cell.value))]<br/><br/>for i, column_width in enumerate(column_widths):<br/>    ws1.column_dimensions[get_column_letter(i+1)].width = column_width</span></pre><p id="551f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正在写入输出文件:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9eed" class="mr lg iq mn b gy ms mt l mu mv">output_file_name="Reviewers " + str(nummer)+" Output file"+".xlsx"<br/>#saving the excel workbook<br/>wb.save(output_file_name)</span></pre></div></div>    
</body>
</html>