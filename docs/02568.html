<html>
<head>
<title>Node.js Best Practices — Test and Arrow Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 最佳实践—测试和箭头函数</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-best-practices-test-and-arrow-functions-b7a8210fd3b2?source=collection_archive---------10-----------------------#2020-08-12">https://blog.devgenius.io/node-js-best-practices-test-and-arrow-functions-b7a8210fd3b2?source=collection_archive---------10-----------------------#2020-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0f936c432a9b2aa8d735797dc35566e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ONEn69cDNHgNetsm"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Gabriel Griego 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="bd7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="2055" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用箭头函数表达式</h1><p id="950b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">箭头函数是现代 JavaScript 的一大特色。</p><p id="33f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它允许我们编写回调函数，而无需绑定到回调函数中的新值<code class="fe me mf mg mh b">this</code>。</p><p id="bba7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而且，它更紧凑。</p><p id="f654" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该使用它来避免错误，让代码更容易阅读。</p><h1 id="3826" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">编写 API 测试</h1><p id="d422" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">API 测试让我们检查 API 的结果。</p><p id="4daf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们没有得到我们想要的，我们会马上从测试中知道。</p><p id="8a5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们速度很快，所以我们不用动一根手指就能测试。</p><p id="9d4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，它们非常适合记录如何调用我们的 API。</p><p id="94f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有其他种类的测试，如性能测试、数据库测试等。我们也能做到。</p><h1 id="3d1c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">每个测试名称包含 3 个部分</h1><p id="f911" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的测试应该一目了然。</p><p id="cde2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们应该在测试名称中说明测试的内容。</p><p id="7db2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们应该说明测试的环境以及预期的结果。</p><p id="36d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，没有人会对我们测试的内容感到困惑。</p><p id="da13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2148" class="mq lc iq mh b gy mr ms l mt mu">describe('Item Service', () =&gt; {<br/>  describe('Add new item', () =&gt; {<br/>    it('When no price is specified, then the item status rejected', () =&gt; {<br/>      const item = new ItemService().add(...);<br/>      expect(item.status).to.equal('rejected');<br/>    });<br/>  });<br/>});</span></pre><p id="3e1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">describe</code> s 标记我们正在测试的单元。</p><p id="4dbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传递给<code class="fe me mf mg mh b">it</code>的字符串包含我们正在测试的场景。</p><p id="d303" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">expect</code>的叫声和<code class="fe me mf mg mh b">it</code>的弦声有了期待。</p><h1 id="3af9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检测 Linter 的代码问题</h1><p id="797c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 linter 检测代码问题，这样我们就可以尽早检测到反模式。</p><p id="682a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使这变得简单，我们可以添加一个预提交钩子，它在提交之前运行来进行检查。</p><h1 id="8498" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免全局测试夹具和种子，并在每个测试中添加数据</h1><p id="a137" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">每次测试都应该添加测试夹具。</p><p id="bf96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且在每次测试后都应该清理数据。</p><p id="e706" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就不会有相互依赖的测试。</p><p id="8dc5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成这些后，每个测试都应该独立运行，这样我们就可以按任何顺序运行它们。</p><h1 id="aec8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查易受攻击的依赖项</h1><p id="d51a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查易受攻击的依赖项，以便更新它们。</p><p id="493f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以更新它们，并避免攻击者利用这些漏洞攻击我们的应用程序。</p><p id="79ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以运行<code class="fe me mf mg mh b">npm audit</code>或其他工具。</p><h1 id="56bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">标记我们的测试</h1><p id="44bd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以标记我们的测试，以便它们在提交之前运行。</p><p id="5c90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们运行必须运行的程序，以防止任何破坏代码的行为。</p><p id="c404" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们将一直运行所有测试，这对于提交之前的大多数应用程序来说可能太慢了。</p><h1 id="e4a3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查测试覆盖率</h1><p id="0e2b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">检查测试覆盖率可以让我们识别任何减少，并检查我们在测试中遗漏的东西。</p><p id="0c40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像伊斯坦布尔/纽约这样的工具可以检查我们代码中的测试覆盖率，这样我们就可以清楚地知道需要测试什么。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/bb76ec216bbc68f66884486868d5eb83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cpAF0qDF-SOolJXW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安德烈科·波迪尔尼克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="54c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="51e0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用箭头函数。</p><p id="9d7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该在代码中有良好的测试覆盖率。</p></div></div>    
</body>
</html>