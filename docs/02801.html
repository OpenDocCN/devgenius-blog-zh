<html>
<head>
<title>System Design Interview: Twitter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统设计面试:Twitter</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/system-design-interview-twitter-5e683498b5ad?source=collection_archive---------6-----------------------#2020-08-31">https://blog.devgenius.io/system-design-interview-twitter-5e683498b5ad?source=collection_archive---------6-----------------------#2020-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="165f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated"><span class="l km kn ko bm kp kq kr ks kt di">在</span>前注:<a class="ae ku" href="https://medium.com/dev-genius/system-design-interview-tips-e42936c44841" rel="noopener"> <strong class="jp ir">系统设计面试小技巧</strong> </a>中，我提到了如何从候选人的角度在一次系统设计面试中表现得更好。在本笔记中，我们将以“<strong class="jp ir"> Twitter </strong>”为例，带您完成一次完整的系统设计面试。</p><h1 id="8ac1" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">问题陈述</h1><p id="70a7" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">在一些介绍之后，面试官将从 Twitter 能够实现的一些关键功能的定义开始面试:</p><ul class=""><li id="a7a8" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated">发布少于 280 个 ASCII 字符的推文</li><li id="9f0f" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">关注/取消关注其他用户，无需批准</li><li id="8f5b" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">显示用户时间线(UT):一个用户可以看到另一个用户的所有推文。</li><li id="c38c" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">Show Home Timeline(HT):一个用户可以看到他/她关注的所有用户的推文。</li></ul><p id="b9b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，面试官会让候选人(TC)去<strong class="jp ir">推动</strong>整个设计讨论。</p><h1 id="1390" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">问题探索</h1><p id="9bc1" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">这个阶段经常被缺乏经验的候选人忽略。但是，在此阶段收集的信息通常会对体系结构产生重大影响。</p><p id="183a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了获得清晰的答案，候选人需要提醒自己围绕<strong class="jp ir">尺度&amp;用户行为</strong>提问。以 Twitter 为例:</p><ul class=""><li id="eb6a" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated"><strong class="jp ir">用户总数</strong>:约 1 亿</li><li id="8ee0" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir"> %的日活跃用户</strong> : ~10%</li><li id="fcf8" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir"> %的用户是只读的</strong> : 95%</li><li id="bae0" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir"> %</strong></li><li id="3ca4" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">关注者的平均数量</strong> : ~100</li><li id="b2bb" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">系统延迟容限</strong>:尽可能快</li><li id="cca8" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">系统一致性要求</strong>:最终一致</li></ul><p id="0531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些数据指向了一个明确的方向:<strong class="jp ir"> <em class="mm">读取延迟优化对用户体验的影响最大。</em>T29】</strong></p><h1 id="a295" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">处理数据</h1><p id="eb59" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">在大多数情况下，绘制 DB 表模式是解决方案的第一步。</p><p id="ead7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，TC 需要设计至少 3 个表:用户、Tweet 和 Home Timeline。用户和 Tweet 表显而易见，SQL 或者 NoSQL 都可以。</p><p id="9fc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，HT 表的设计区分了候选人的设计能力，并为整个解决方案奠定了基础。</p><p id="a558" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">理想情况下，在 10 米 DAU 的规模上最小化读取延迟。TC 提出的系统应包括:</p><ul class=""><li id="1d19" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated">HT 中为每个用户预先填充的推文</li><li id="4d79" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">提供最快读取速度的内存数据存储</li><li id="c4f8" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">不同机器上的多个副本(冗余)，以避免读取时出现单点故障</li></ul><p id="78e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们试图将这些需求与市场上现有的解决方案相匹配，那么像<a class="ae ku" href="https://redis.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Redis </strong> </a>这样的非 SQL 内存数据库就很突出。</p><h1 id="5ec1" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">组件责任</h1><p id="3711" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">完成数据库表设计后，TC 应继续勾画整个架构，并引导访问者完成读/写过程。</p><p id="4c17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设我们使用 Redis 存储 HT &amp; UT，候选路径应该是这样的:</p><h2 id="d2b3" class="mn kw iq bd kx mo mp dn lb mq mr dp lf jy ms mt lj kc mu mv ln kg mw mx lr my bi translated">写</h2><p id="65d8" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">客户端→负载均衡器→写入 permeant DB 中的 Tweet 表→扇出更新 HT &amp; UT Redis 表</p><h2 id="6756" class="mn kw iq bd kx mo mp dn lb mq mr dp lf jy ms mt lj kc mu mv ln kg mw mx lr my bi translated">阅读</h2><p id="b03b" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">客户端→负载平衡器→从相应的 Redis 表中读取</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/1a5debd6b7b28021173a2b26d3e15a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDz74HYHcFnvpDjpNGjhpg.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">图片来自<a class="ae ku" href="https://www.youtube.com/watch?v=KmAyPUv9gOY&amp;t=1393s" rel="noopener ugc nofollow" target="_blank">坐</a></figcaption></figure><h1 id="755b" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">权衡取舍</h1><p id="b7ac" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">上面提到的设计在表面上起作用。然而，一个有经验的候选人应该主动指出一个明显的缺点，并提供解决办法。</p><blockquote class="np nq nr"><p id="8eed" class="jn jo mm jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">当一个<strong class="jp ir">名人用户</strong>发微博时，会有大量的 Redis 写操作。</p></blockquote><p id="a419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了抵消这种副作用，一个典型的修复方法如下:</p><ol class=""><li id="297f" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk nv me mf mg bi translated">排除名人更新用户的 HT</li><li id="8d0d" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk nv me mf mg bi translated">在处理读取请求时，从 DB 查询名人的推文</li></ol><p id="e21b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，读取路径将更新为:</p><p id="b95e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">客户端→负载均衡器(并行)</strong></p><ul class=""><li id="77cb" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated"><strong class="jp ir">→检查是否关注名人→查询名人微博数据库</strong></li><li id="5f1f" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">→从 HT Redis 表中读取</strong></li></ul><p id="edbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">→插入响应</strong></p><p id="9e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这只是 TC 做出的众多取舍之一。在准备时，TC 应该练习如何清楚地表达每个决定的所有利弊。</p><h1 id="6827" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">深潜</h1><p id="c23c" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">如果还有时间，面试官会用其他问题来测试你对某个领域的理解程度:</p><ul class=""><li id="c81b" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated">如何处理多媒体内容？</li><li id="6df2" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">如何提高用户的感知性能？</li><li id="86c3" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">如何基于当前架构构建趋势#服务？</li><li id="af53" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">等等..</li></ul></div></div>    
</body>
</html>