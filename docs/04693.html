<html>
<head>
<title>How to create a Video Chat Application with a custom STUN and TURN server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个视频聊天应用程序与自定义眩晕和转向服务器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-a-video-chat-application-with-a-custom-stun-and-turn-server-8c6258542324?source=collection_archive---------0-----------------------#2021-04-21">https://blog.devgenius.io/how-to-create-a-video-chat-application-with-a-custom-stun-and-turn-server-8c6258542324?source=collection_archive---------0-----------------------#2021-04-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0119" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">构建我们自己的应用程序很酷。今天我们将开发我们自己的视频聊天应用程序。在这里，我们将开发一个只为2个用户的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3704d3478389e80a8c871e197f5234f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AgFecu8ar2yjTCES"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@visuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">视觉</a>的照片</figcaption></figure><h1 id="b7da" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">内容</h1><ol class=""><li id="1607" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh me mf mg mh bi translated">基础</li><li id="8255" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">使用的技术。</li><li id="ad8c" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">了解WebRTC。</li><li id="82cd" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">什么是信号？</li><li id="f81a" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">WebRTC是如何工作的(举例)？</li><li id="7ca4" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">我们面临的问题</li><li id="015b" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">设置TURN和STUNServer。</li><li id="4976" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">我们来编码吧。</li></ol><h1 id="9610" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">基础</h1><ul class=""><li id="775d" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh mn mf mg mh bi translated"><strong class="jm io"> IP </strong>:连接到互联网的每台设备都使用IP地址进行识别。</li><li id="9874" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated"><strong class="jm io">端口</strong>:系统中的每个进程都有一个端口号，使用该端口号可以将来自互联网的数据定向到设备中的正确位置。</li></ul><p id="8ee3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">知识</strong>:有65536个端口可用。</p><h1 id="e18b" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">使用的技术</strong></h1><ol class=""><li id="3a55" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh me mf mg mh bi translated">WebRTC</li><li id="be8c" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">NodeJS</li><li id="e09d" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">ExpressJs</li><li id="df80" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Socket.io(用于信令)</li><li id="264f" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">AWS &amp; Kurento(用于设置STUN和TURN服务器)</li></ol><h1 id="9e4d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">了解WebRTC </strong></h1><p id="fbdb" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">在这一部分中，我们将了解使用WebRTC开发应用程序所需的各种概念。</p><p id="e608" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在聊天网络应用中，当两个或更多的设备开始发送信息时，它们在到达接收者之前会通过服务器。但是在音频和视频通信之间有一个服务器会导致滞后。因此，我们需要实时数据传输来实现完美的通信。因此，我们使用WebRTC这种开源框架为应用程序提供实时通信。</p><p id="8301" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">WebRTC开发人员在开发易于使用的API方面做了出色的工作。</p><p id="bb24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">WebRTC代表Web实时通信。它支持点对点(设备到设备)通信，中间没有任何服务器，并允许在连接的设备之间交换数据。在WebRTC中，服务器的角色仅限于帮助两个或更多设备发现彼此并建立直接连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/b231de95063ac08c85eedec6e512eb71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOazsO-ysOPAt1B1hEsszg.jpeg"/></div></div></figure><h1 id="ae5d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">信令</strong></h1><p id="5292" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">在人们开始相互交流之前，他们的系统需要知道很多关于场景的信息，比如</p><ul class=""><li id="ba2a" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">如果有任何其他设备可用于通信。</li><li id="42ca" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">其他设备的网络数据，如IP和端口。</li><li id="c7ac" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">错误消息。</li><li id="6e81" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">会话控制消息。</li><li id="173e" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">关于将由另一设备发送的数据的媒体元数据。</li></ul><p id="4225" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">信令是一个术语，用于描述协调初始通信并实现设备间元数据发送的机制。一旦建立了直接连接，此后就没有信令的作用了。</p><p id="872a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，WebRTC不使用任何信号机制。我们使用socket.io进行信号传输。</p><p id="7c15" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">会话描述协议</strong></p><p id="a8c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">会话描述协议是一种格式，媒体元数据以这种格式传输，以便WebRTC发挥作用。</p><h1 id="ac4c" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">WebRTC如何工作(示例)</h1><p id="0281" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">让我们考虑Liks和karth决定进行视频聊天。Karth让liks打电话。让我们讨论一下后端是如何工作的</p><ol class=""><li id="7e24" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh me mf mg mh bi translated">Liks创建一个<code class="fe mv mw mx my b">RTCPeerConnection</code>对象。</li><li id="4aeb" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Liks使用<code class="fe mv mw mx my b">RTCPeerConnection</code> <code class="fe mv mw mx my b">createOffer()</code>方法创建报价(SDP会话描述)。</li><li id="1115" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Liks调用<code class="fe mv mw mx my b">setLocalDescription()</code>将创建的offer(会话描述)设置为将要创建的连接中的本地媒体的描述。</li><li id="56be" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Liks stringifies提供并使用信号机制发送给Karth。</li><li id="5b0f" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Karth打电话给<code class="fe mv mw mx my b">setRemoteDescription()</code>告诉他Liks的报价，这样他的<code class="fe mv mw mx my b">RTCPeerConnection</code>就知道Liks的设置了。</li><li id="aae7" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Karth调用<code class="fe mv mw mx my b">createAnswer()</code>,这个成功的回调函数被传递一个本地会话描述——Karth answer。</li><li id="06bc" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Karth通过调用<code class="fe mv mw mx my b">setLocalDescription()</code>将其答案设置为本地描述。</li><li id="0272" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">然后，Karth使用信号机制将他的字符串答案发送给Liks。</li><li id="427d" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">Liks使用<code class="fe mv mw mx my b">setRemoteDescription()</code>将Karth answer设置为远程会话描述。</li></ol><p id="a201" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在Liks和Karth也需要交换网络信息。“寻找候选者”是指使用ICE框架寻找网络接口和端口的过程。</p><ol class=""><li id="f87e" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh me mf mg mh bi translated">Liks用一个<code class="fe mv mw mx my b">onicecandidate</code>处理程序创建了一个<code class="fe mv mw mx my b">RTCPeerConnection</code>对象。</li><li id="638c" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">当网络候选变得可用时，调用该处理程序。</li><li id="c99f" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">在处理程序中，Liks通过它们的信令通道向Karth发送字符串化的候选数据。</li><li id="c6f1" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">当Karth <strong class="jm io"> </strong>从Liks获得候选消息时，他调用<code class="fe mv mw mx my b">addIceCandidate()</code>将候选消息添加到远程对等描述中。</li></ol><h1 id="7442" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">我们面临的问题</h1><p id="ca76" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">如果设备连接到同一个网络，我们就不会遇到NAT问题。</p><ul class=""><li id="5bf9" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">精灵</li><li id="f9f1" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">防火墙</li></ul><p id="079e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> NAT </strong></p><p id="e51b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">IP是标识连接到互联网的设备的地址。从逻辑上讲，您可能会认为每台连接到互联网的设备都必须有一个唯一的IP地址。但这并不完全正确。</p><p id="4b94" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">IPv4地址有32位长，这意味着大约有40亿个唯一的地址。截至2018年底，约有220亿台设备连接到互联网。哦，等等，这怎么可能，这个问题的答案是纳特。</p><p id="7bcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">维护互联网的人把整个IPv4地址范围分成两组</p><ul class=""><li id="3baf" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">公共IP地址</li><li id="7c8b" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">私有IP地址。</li></ul><p id="3555" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，每个公有IP地址只能分配给一台设备，而私有IP地址则不能。更多细节请看下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/aafc62400f0e0a1ad4cfa45bf5f7f779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG6nI4HpN-e4bjdUrkEyPw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">这就是NAT的工作方式</figcaption></figure><p id="b8c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，在某种程度上，我们可以说每台设备都有两个IP地址私有IP地址和公共IP地址。</p><p id="8b5d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这可能会给WebRTC带来问题，因为网络ICE候选包含设备的私有IP地址，而不是公共IP地址。因此，我们必须找到一种方法让浏览器知道公共IP地址，以便它可以创建包含公共IP地址的候选地址。解决方案是一个STUN服务器。当一个设备请求STUN服务器时，STUN服务器用一条包含该设备所连接的路由器的公共IP的消息来响应。</p><p id="3247" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">防火墙</strong></p><p id="4a35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">系统使用防火墙来阻止可疑和危险的端口和应用程序。由于WebRTC使用几个非标准端口，一些防火墙不允许在两个浏览器之间建立直接连接。</p><p id="3cbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，为了解决这个问题，我们需要一个TURN服务器。TURN服务器基本上充当中继服务器，即如果直接连接失败，则在两个对等体之间直接中继流量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/f373344992d0c2a82eba1a15f3e4c859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgMlbrOKOJ7uooRW_7B17A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">这就是转弯的原理</figcaption></figure><p id="67f3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要将TURN和STUN与WebRTC集成，我们只需将包含TURN和STUN服务器URL的对象作为参数传递给RTCPeerConnection()。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/5d9c82b21ff5d281fd0ce1392110f671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08mkUDljvtI1t4zTVzCOpA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">这是建筑的样子</figcaption></figure><h1 id="5ed4" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">设置回合和眩晕服务器</strong></h1><ol class=""><li id="69f1" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh me mf mg mh bi translated">设置您的AWS帐户。</li><li id="42ba" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">创建一个EC2实例(我更喜欢使用Ubuntu免费层)</li><li id="5ef8" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">打开安全组中的防火墙端口</strong></li></ol><p id="7cd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nb"> 3478 TCP &amp; UDP端口</em></p><p id="3cd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nb">49152–65535 UDP端口</em></p><p id="707f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.<strong class="jm io">旋转安装</strong></p><p id="6892" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nb"> sudo apt-get更新<br/> sudo apt-get安装返回</em></p><p id="b2a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.<strong class="jm io">在启动时启动Coturn守护进程</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="108f" class="ng la in my b gy nh ni l nj nk">sudo nano /etc/default/coturn</span></pre><p id="ec8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">找到下面一行，通过删除#来取消注释，以将Coturn作为自动系统服务守护程序运行。</p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="341d" class="ng la in my b gy nh ni l nj nk">#TURNSERVER_ENABLED=1</span></pre><p id="4c07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">保存并关闭文件。然后，您可以通过运行以下命令来启动Coturn服务</p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="2da0" class="ng la in my b gy nh ni l nj nk">$ systemctl start coturn</span></pre><p id="d798" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 6。创建一个用户转到下一步，编辑主配置文件。</strong></p><p id="ef97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后打开或创建/etc/turnserver.conf文件，粘贴以下内容。将<username>、<password>和<public_ip_address>值替换为各自的值。</public_ip_address></password></username></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="910f" class="ng la in my b gy nh ni l nj nk"># TURN fingerprints in messages.<br/>fingerprint<br/>#TURN static user account for long-term credential mechanism.<br/>user=&lt;USERNAME&gt;:&lt;PASSWORD&gt;<br/>#TURN long-term credential mechanism<br/>lt-cred-mech<br/>#TURN realm used for the long-term credential mechanism<br/>realm=&lt;YOUR_DOMAIN&gt;<br/>#Setting up log file<br/>log-file=/var/log/turnserver/turnserver.log<br/>#Disable log file rollover and use log file name as-is<br/>simple-log<br/>#The external IP address of this server.<br/>external-ip=&lt;AWS_PUBLIC_IP_ADDRESS&gt;</span></pre><p id="805d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">7。 <strong class="jm io">重启返回服务</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="b0e6" class="ng la in my b gy nh ni l nj nk">$ sudo service coturn restart</span></pre><p id="bf1f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">8。让我们测试我们的工作</p><p id="7c36" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">进入涓流冰页面，输入你自己的服务器详情。</p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="aa55" class="ng la in my b gy nh ni l nj nk">STUN or TURN URI: turn:&lt;PUBLIC_IP_ADDRESS&gt;:3478<br/>TURN username: &lt;USERNAME&gt;<br/>TURN password: &lt;PASSWORD&gt;</span></pre><p id="5686" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后单击添加服务器，然后单击“收集候选人”按钮。如果您已经正确配置了所有内容，那么您应该会看到“Done”作为最终结果。</p><h1 id="7077" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">让我们编码吧</h1><ol class=""><li id="9334" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh me mf mg mh bi translated"><strong class="jm io">下载节点。Js </strong></li><li id="5382" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><strong class="jm io">创建一个节点项目</strong></li></ol><ul class=""><li id="2cff" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">创建一个新文件夹。这个文件夹将是我们项目的根目录。</li><li id="71bf" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">打开该文件夹中的terminal/CMD并运行npm init命令。</li><li id="6543" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">输入提示的详细信息或跳过它们</li><li id="066f" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">这将在项目的根目录下创建一个package.json文件。这个文件将包含关于我们的项目的所有必要信息，如项目依赖性。</li></ul><p id="5da7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.<strong class="jm io">安装依赖项</strong></p><ul class=""><li id="4eea" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated"><code class="fe mv mw mx my b">npm install express socket.io --save</code></li></ul><p id="6a16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.<strong class="jm io">创建文件和文件夹</strong></p><ul class=""><li id="1f4c" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">在根文件夹中创建index.js文件</li><li id="770c" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">在根文件夹中创建公共和视图文件夹</li><li id="3a82" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">在视图文件夹中创建一个索引。ejs文件</li></ul><p id="2883" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.<strong class="jm io">index . js中的编码后端(在根文件夹中)</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="91c6" class="ng la in my b gy nh ni l nj nk">'use strict';<br/><br/>//Loading dependencies &amp; initializing express<br/>var os = require('os');<br/>var express = require('express');<br/>var app = express();<br/>var http = require('http');<br/>//For signalling in WebRTC<br/>var socketIO = require('socket.io');<br/><br/><br/>app.use(express.static('public'))<br/><br/>app.get("/", function(req, res){<br/>	res.render("index.ejs");<br/>});<br/><br/>var server = http.createServer(app);<br/><br/>server.listen(process.env.PORT || 8000);<br/><br/>var io = socketIO(server);<br/><br/>io.sockets.on('connection', function(socket) {<br/><br/>	// Convenience function to log server messages on the client.<br/>	// Arguments is an array like object which contains all the arguments of log(). <br/>	// To push all the arguments of log() in array, we have to use apply().<br/>	function log() {<br/>	  var array = ['Message from server:'];<br/>	  array.push.apply(array, arguments);<br/>	  socket.emit('log', array);<br/>	}<br/>  <br/>    <br/>    //Defining Socket Connections<br/>    socket.on('message', function(message, room) {<br/>	  log('Client said: ', message);<br/>	  // for a real app, would be room-only (not broadcast)<br/>	  socket.in(room).emit('message', message, room);<br/>	});<br/>  <br/>	socket.on('create or join', function(room) {<br/>	  log('Received request to create or join room ' + room);<br/>  <br/>	  var clientsInRoom = io.sockets.adapter.rooms[room];<br/>	  var numClients = clientsInRoom ? Object.keys(clientsInRoom.sockets).length : 0;<br/>	  log('Room ' + room + ' now has ' + numClients + ' client(s)');<br/>  <br/>	  if (numClients === 0) {<br/>		socket.join(room);<br/>		log('Client ID ' + socket.id + ' created room ' + room);<br/>		socket.emit('created', room, socket.id);<br/>  <br/>	  } else if (numClients === 1) {<br/>		log('Client ID ' + socket.id + ' joined room ' + room);<br/>		io.sockets.in(room).emit('join', room);<br/>		socket.join(room);<br/>		socket.emit('joined', room, socket.id);<br/>		io.sockets.in(room).emit('ready');<br/>	  } else { // max two clients<br/>		socket.emit('full', room);<br/>	  }<br/>	});<br/>  <br/>	socket.on('ipaddr', function() {<br/>	  var ifaces = os.networkInterfaces();<br/>	  for (var dev in ifaces) {<br/>		ifaces[dev].forEach(function(details) {<br/>		  if (details.family === 'IPv4' &amp;&amp; details.address !== '127.0.0.1') {<br/>			socket.emit('ipaddr', details.address);<br/>		  }<br/>		});<br/>	  }<br/>	});<br/>  <br/>	socket.on('bye', function(){<br/>	  console.log('received bye');<br/>	});<br/>  <br/>  });</span></pre><p id="8ea3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 6。在公共场所创建文件和文件夹</strong></p><ul class=""><li id="d97b" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">在public中创建CSS文件夹，并在其中创建styles.css文件。</li><li id="6d93" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">在public中创建Js文件夹，并在其中创建main.js和config.js文件。</li></ul><p id="6011" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 7。更新索引中的前端代码。视图文件夹中的ejs</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="b017" class="ng la in my b gy nh ni l nj nk">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/><br/>&lt;head&gt;<br/><br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>  <br/>  &lt;!-- Import Google Fonts --&gt;<br/>  &lt;link href="https://fonts.googleapis.com/css2?family=Baloo+Tamma+2:wght@400;500;600&amp;family=Josefin+Slab&amp;display=swap" rel="stylesheet"&gt;<br/>  <br/>  &lt;!-- Import CSS file --&gt;<br/>  &lt;link rel="stylesheet" href="/css/styles.css"&gt;<br/><br/>  &lt;!-- &lt;link rel="stylesheet" href="/css/main.css" /&gt; --&gt;<br/><br/>&lt;/head&gt;<br/><br/>&lt;body class="h-100"&gt;<br/>  &lt;div class="h-100" id="video_display"&gt;<br/>	&lt;div id ="video_container" class="align-items-center" style="margin-top: 10%;"&gt;<br/>      		&lt;div class="local_div" id="div1" style=""&gt;<br/>			&lt;!-- For playing local video --&gt;<br/>			&lt;video id="localVideo" class="" autoplay muted playsinline&gt;&lt;/video&gt;<br/>		&lt;/div&gt;<br/>		&lt;div class="remote_div" id="div2"&gt;<br/>			&lt;!-- For playing local audio --&gt;<br/>			&lt;video id="remoteVideo" class="" autoplay playsinline&gt;&lt;/video&gt;<br/>		&lt;/div&gt;<br/>    	&lt;/div&gt;<br/>  &lt;/div&gt;<br/><br/>  &lt;!-- Import SocketIO for signalling --&gt;<br/>  &lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br/><br/>  &lt;!-- Import WebRTC adapter for compatibility with all the browsers  --&gt;<br/>  &lt;script src="https://webrtc.github.io/adapter/adapter-latest.js"&gt;&lt;/script&gt;<br/>  <br/>  &lt;!-- Import TURN config --&gt;<br/>  &lt;script src="js\config.js"&gt;&lt;/script&gt;<br/><br/>  &lt;!-- Import script containing WebRTC related functions --&gt;<br/>  &lt;script src="js\main.js"&gt;&lt;/script&gt;<br/>  <br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="a9d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 8。styles.css代码</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="4098" class="ng la in my b gy nh ni l nj nk">*, ::after, ::before {<br/>    box-sizing: border-box;<br/>}<br/><br/><br/>html {<br/>	display: block;<br/>	line-height: 1.15;<br/>}<br/><br/>div {<br/>	display: block;<br/>}<br/><br/>body {<br/>	margin: 0;<br/>    line-height: 1.5;<br/>    color: #212529;<br/>    text-align: left;<br/>	display: block;<br/>	background-color: #0080AD;<br/>	font-family: 'Baloo Tamma 2', cursive;<br/>}<br/><br/>.h-100 {<br/>	height: 100%!important;<br/>}<br/><br/>.row {<br/>    display: -ms-flexbox;<br/>    display: flex;<br/>    -ms-flex-wrap: wrap;<br/>    flex-wrap: wrap;<br/><br/>}<br/><br/>.ml-auto, .mx-auto {<br/>    margin-left: auto!important;<br/>}<br/><br/>.mr-auto, .mx-auto {<br/>    margin-right: auto!important;<br/>}<br/><br/>.font-weight-bold {<br/>    font-weight: 600!important;<br/>}<br/><br/>.text-center {<br/>    text-align: center!important;<br/>}<br/><br/><br/>.jumbotron {<br/>    background-color: #e9ecef;<br/>}<br/><br/><br/><br/>.align-items-center {<br/>    -ms-flex-align: center!important;<br/>    align-items: center!important;<br/>}<br/><br/><br/>.container {<br/>    margin-right: auto;<br/>    margin-left: auto;<br/>}<br/><br/><br/><br/>/* For Desktop  */<br/>	.col-12 {<br/>		position: relative;<br/>		width: 40%;<br/>	}<br/><br/>	.jumbotron {<br/>		padding: 2rem 1rem;<br/>		margin-bottom: 2rem;<br/>		border-radius: .3rem;<br/>	}<br/><br/>	#h1 {<br/>		font-size: 1.5rem;<br/>		font-weight: 300;<br/>		line-height: 1.2;<br/>		margin-bottom: 1rem!important;<br/>		margin-top: 0px!important;<br/>	}<br/>	<br/>	<br/><br/>@media (orientation: landscape) {<br/>	.btn-danger {<br/>		display:block;<br/>		font-size : 15px;<br/>		margin:auto;<br/>		width: 15%;<br/>		height: 25px;<br/>		color: #fff;<br/>		background-color: #25274d;<br/>		border-color: #25274d;<br/>	}<br/>		<br/>	.btn {<br/>		display:block;<br/>		font-size : 15px;<br/>		margin:auto;<br/>		margin-right:0px;<br/>		width: 15%;<br/>		height: 25px;<br/>		color: #fff;<br/>		background-color: #25274d;<br/>		border-color: #25274d;<br/>	}<br/>	<br/>	.btn_option {<br/>		display:block;<br/>		font-size : 15px;<br/>		margin:auto;<br/>		width: 50%;<br/>		height: 25px;<br/>		color: #fff;<br/>		background-color: #25274d;<br/>		border-color: #25274d;<br/>	}<br/>	<br/>	<br/>	<br/>	#room_value {<br/>		margin-left: 20px;<br/>	}<br/>	<br/>	.local_div {<br/>		width:33%;<br/>		float:left<br/>	}<br/><br/>	.remote_div {<br/>		width:33%;<br/>		float:left<br/>	}<br/><br/>	.remote2_div {<br/>		width:33%;<br/>		float:left<br/>	}<br/><br/>	#video_container {<br/>		display: flex;<br/>		width: 85%;<br/>		margin: auto;<br/>		height: 80% <br/>	}<br/>	<br/>	video {<br/>		width:100%;<br/>	}<br/><br/>}<br/>/* For Mobile */<br/><br/>@media (orientation: portrait)<br/>{<br/>	.row {<br/>		margin-right: -15px;<br/>		margin-left: -15px;<br/>	}<br/><br/>	.col-12 {<br/>		padding-right: 15px;<br/>		padding-left: 15px;<br/>		position: relative;<br/>		width: 100%;<br/>	}<br/><br/>	.container {<br/>		max-width: 310px;<br/>		padding-right: 5px;<br/>		padding-left: 5px;<br/>	}<br/><br/>	.jumbotron {<br/>		/* padding: 0.02rem 2rem; */<br/>		padding: 2rem 1rem;<br/>		margin-bottom: 2rem;<br/>		border-radius: .3rem;<br/>	}<br/><br/>	#h1 {<br/>		font-size: 1.5rem;<br/>		font-weight: 300;<br/>		line-height: 1.2;<br/>		margin-bottom: 1rem!important;<br/>		margin-top: 0px!important;<br/>	}<br/><br/>	#label_name {<br/>		font-size: 17px;<br/>		width: 100%;<br/>	}<br/><br/>	.form-group {<br/>    margin-bottom: 1rem;<br/>	}<br/><br/>	.form-control {<br/>		height:35px;<br/>		font-size:20px;<br/>		display: block;<br/>		width: 100%;<br/>		padding: .375rem .75rem;<br/>		font-weight: 400;<br/>		line-height: 1.5;<br/>		color: #495057;<br/>		background-color: #fff;<br/>		background-clip: padding-box;<br/>		border: 1px solid #ced4da;<br/>		border-radius: .25rem;<br/>		transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;<br/>	}<br/><br/>	.btn {<br/>		font-size : 16px;<br/>		width: 100%;<br/>		height: 35px;<br/>		color: #fff;<br/>		background-color: #25274d;<br/>		border-color: #25274d;<br/>	}<br/><br/>	.local_div {<br/>		display: flex<br/>		;<br/>		width: 100%;<br/>		position:relative;<br/>    overflow:hidden;<br/>    z-index:-1;<br/>	}<br/><br/>	.remote_div {<br/>		width: 120px;<br/>		display: block;<br/>		position:absolute;<br/>		top:0px;<br/>		right:0px;<br/>		z-index:1;<br/>	}<br/><br/>	.remote2_div {<br/>		width: 120px;<br/>		display: block;<br/>		position:absolute;<br/>		top:95px;<br/>		right:0px;<br/>		z-index:1;<br/>	}<br/><br/>	#video_container {<br/>		height: 80%;<br/>		position:relative;<br/>		display:flex;<br/>		flex-wrap:wrap<br/>	}<br/>	<br/>	.remote_div video {<br/>		-ms-flex: 0 0 100%;<br/>		flex: 0 0 100%;<br/>		max-width: 100%;<br/>	}<br/><br/>	.remote2_div video {<br/>		-ms-flex: 0 0 100%;<br/>		flex: 0 0 100%;<br/>		max-width: 100%;<br/>	}<br/>	<br/>	.btn-danger {<br/>		font-size : 16px;<br/>		width: 100%;<br/>		height: 35px;<br/>		color: #fff;<br/>		background-color: #25274d;<br/>		border-color: #25274d;<br/>	}<br/>	<br/>}</span></pre><p id="cd20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 9。更新main.js文件</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="3729" class="ng la in my b gy nh ni l nj nk">'use strict';<br/><br/>//Defining some global utility variables<br/>var isChannelReady = false;<br/>var isInitiator = false;<br/>var isStarted = false;<br/>var localStream;<br/>var pc;<br/>var remoteStream;<br/>var turnReady;<br/><br/>//Initialize turn/stun server here<br/>//turnconfig will be defined in public/js/config.js<br/>var pcConfig = turnConfig;<br/><br/>//Set local stream constraints<br/>var localStreamConstraints = {<br/>    audio: true,<br/>    video: true<br/>  };<br/><br/><br/>// Prompting for room name:<br/>var room = prompt('Enter room name:');<br/><br/>//Initializing socket.io<br/>var socket = io.connect();<br/><br/>//Ask server to add in the room if room name is provided by the user<br/>if (room !== '') {<br/>  socket.emit('create or join', room);<br/>  console.log('Attempted to create or  join room', room);<br/>}<br/><br/>//Defining socket events<br/><br/>//Event - Client has created the room i.e. is the first member of the room<br/>socket.on('created', function(room) {<br/>  console.log('Created room ' + room);<br/>  isInitiator = true;<br/>});<br/><br/>//Event - Room is full<br/>socket.on('full', function(room) {<br/>  console.log('Room ' + room + ' is full');<br/>});<br/><br/>//Event - Another client tries to join room<br/>socket.on('join', function (room){<br/>  console.log('Another peer made a request to join room ' + room);<br/>  console.log('This peer is the initiator of room ' + room + '!');<br/>  isChannelReady = true;<br/>});<br/><br/>//Event - Client has joined the room<br/>socket.on('joined', function(room) {<br/>  console.log('joined: ' + room);<br/>  isChannelReady = true;<br/>});<br/><br/>//Event - server asks to log a message<br/>socket.on('log', function(array) {<br/>  console.log.apply(console, array);<br/>});<br/><br/><br/>//Event - for sending meta for establishing a direct connection using WebRTC<br/>//The Driver code<br/>socket.on('message', function(message, room) {<br/>    console.log('Client received message:', message,  room);<br/>    if (message === 'got user media') {<br/>      maybeStart();<br/>    } else if (message.type === 'offer') {<br/>      if (!isInitiator &amp;&amp; !isStarted) {<br/>        maybeStart();<br/>      }<br/>      pc.setRemoteDescription(new RTCSessionDescription(message));<br/>      doAnswer();<br/>    } else if (message.type === 'answer' &amp;&amp; isStarted) {<br/>      pc.setRemoteDescription(new RTCSessionDescription(message));<br/>    } else if (message.type === 'candidate' &amp;&amp; isStarted) {<br/>      var candidate = new RTCIceCandidate({<br/>        sdpMLineIndex: message.label,<br/>        candidate: message.candidate<br/>      });<br/>      pc.addIceCandidate(candidate);<br/>    } else if (message === 'bye' &amp;&amp; isStarted) {<br/>      handleRemoteHangup();<br/>    }<br/>});<br/>  <br/><br/><br/>//Function to send message in a room<br/>function sendMessage(message, room) {<br/>  console.log('Client sending message: ', message, room);<br/>  socket.emit('message', message, room);<br/>}<br/><br/><br/><br/>//Displaying Local Stream and Remote Stream on webpage<br/>var localVideo = document.querySelector('#localVideo');<br/>var remoteVideo = document.querySelector('#remoteVideo');<br/>console.log("Going to find Local media");<br/>navigator.mediaDevices.getUserMedia(localStreamConstraints)<br/>.then(gotStream)<br/>.catch(function(e) {<br/>  alert('getUserMedia() error: ' + e.name);<br/>});<br/><br/>//If found local stream<br/>function gotStream(stream) {<br/>  console.log('Adding local stream.');<br/>  localStream = stream;<br/>  localVideo.srcObject = stream;<br/>  sendMessage('got user media', room);<br/>  if (isInitiator) {<br/>    maybeStart();<br/>  }<br/>}<br/><br/><br/>console.log('Getting user media with constraints', localStreamConstraints);<br/><br/>//If initiator, create the peer connection<br/>function maybeStart() {<br/>  console.log('&gt;&gt;&gt;&gt;&gt;&gt;&gt; maybeStart() ', isStarted, localStream, isChannelReady);<br/>  if (!isStarted &amp;&amp; typeof localStream !== 'undefined' &amp;&amp; isChannelReady) {<br/>    console.log('&gt;&gt;&gt;&gt;&gt;&gt; creating peer connection');<br/>    createPeerConnection();<br/>    pc.addStream(localStream);<br/>    isStarted = true;<br/>    console.log('isInitiator', isInitiator);<br/>    if (isInitiator) {<br/>      doCall();<br/>    }<br/>  }<br/>}<br/><br/>//Sending bye if user closes the window<br/>window.onbeforeunload = function() {<br/>  sendMessage('bye', room);<br/>};<br/><br/><br/>//Creating peer connection<br/>function createPeerConnection() {<br/>  try {<br/>    pc = new RTCPeerConnection(pcConfig);<br/>    pc.onicecandidate = handleIceCandidate;<br/>    pc.onaddstream = handleRemoteStreamAdded;<br/>    pc.onremovestream = handleRemoteStreamRemoved;<br/>    console.log('Created RTCPeerConnnection');<br/>  } catch (e) {<br/>    console.log('Failed to create PeerConnection, exception: ' + e.message);<br/>    alert('Cannot create RTCPeerConnection object.');<br/>    return;<br/>  }<br/>}<br/><br/>//Function to handle Ice candidates generated by the browser<br/>function handleIceCandidate(event) {<br/>  console.log('icecandidate event: ', event);<br/>  if (event.candidate) {<br/>    sendMessage({<br/>      type: 'candidate',<br/>      label: event.candidate.sdpMLineIndex,<br/>      id: event.candidate.sdpMid,<br/>      candidate: event.candidate.candidate<br/>    }, room);<br/>  } else {<br/>    console.log('End of candidates.');<br/>  }<br/>}<br/><br/>function handleCreateOfferError(event) {<br/>  console.log('createOffer() error: ', event);<br/>}<br/><br/>//Function to create offer<br/>function doCall() {<br/>  console.log('Sending offer to peer');<br/>  pc.createOffer(setLocalAndSendMessage, handleCreateOfferError);<br/>}<br/><br/>//Function to create answer for the received offer<br/>function doAnswer() {<br/>  console.log('Sending answer to peer.');<br/>  pc.createAnswer().then(<br/>    setLocalAndSendMessage,<br/>    onCreateSessionDescriptionError<br/>  );<br/>}<br/><br/>//Function to set description of local media<br/>function setLocalAndSendMessage(sessionDescription) {<br/>  pc.setLocalDescription(sessionDescription);<br/>  console.log('setLocalAndSendMessage sending message', sessionDescription);<br/>  sendMessage(sessionDescription, room);<br/>}<br/><br/>function onCreateSessionDescriptionError(error) {<br/>  trace('Failed to create session description: ' + error.toString());<br/>}<br/><br/>//Function to play remote stream as soon as this client receives it<br/>function handleRemoteStreamAdded(event) {<br/>  console.log('Remote stream added.');<br/>  remoteStream = event.stream;<br/>  remoteVideo.srcObject = remoteStream;<br/>}<br/><br/>function handleRemoteStreamRemoved(event) {<br/>  console.log('Remote stream removed. Event: ', event);<br/>}<br/><br/>function hangup() {<br/>  console.log('Hanging up.');<br/>  stop();<br/>  sendMessage('bye',room);<br/>}<br/><br/>function handleRemoteHangup() {<br/>  console.log('Session terminated.');<br/>  stop();<br/>  isInitiator = false;<br/>}<br/><br/>function stop() {<br/>  isStarted = false;<br/>  pc.close();<br/>  pc = null;<br/>}</span></pre><p id="5678" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 10。更新config.js文件</strong></p><pre class="kj kk kl km gt nc my nd ne aw nf bi"><span id="d92b" class="ng la in my b gy nh ni l nj nk">turnConfig = {<br/>    iceServers: [<br/>    {   <br/>      urls: [ "stun:&lt;YOUR_URL&gt;" ]<br/>    }, <br/>    {   <br/>      username: "likhith",   <br/>      credential: "password",   <br/>      urls: [       <br/>        "turn:&lt;YOUR_URL&gt;:3478?transport=udp",       <br/>        "turn:&lt;YOUR_URL&gt;:3478?transport=tcp",       <br/>       ]<br/>     }<br/>   ]<br/>}</span></pre><h1 id="5778" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">恭喜你。！！！！！！！！！！</h1><p id="5876" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">我们做到了！！！！！！！！！！！！！🥵🥵🥵🥵🥵🥵🥵🥵🥵🥵🥵</p><ul class=""><li id="3763" class="lx ly in jm b jn jo jr js jv ms jz mt kd mu kh mn mf mg mh bi translated">在我们项目的根目录下打开一个终端。</li><li id="7880" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">运行以下命令— node <code class="fe mv mw mx my b">index.js</code>。</li><li id="7cf7" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">打开谷歌浏览器，访问<code class="fe mv mw mx my b">localhost:8000</code>。输入房间名称(比如foo)。你应该看看你的视频。</li><li id="a6cd" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh mn mf mg mh bi translated">打开一个新标签页并访问<code class="fe mv mw mx my b">localhost:8000</code>。输入相同的房间名称(foo)。您现在应该会看到两个视频元素。</li></ul></div></div>    
</body>
</html>