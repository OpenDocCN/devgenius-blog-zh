# 正确使用构造函数

> 原文：<https://blog.devgenius.io/how-to-use-constructors-509cd867010a?source=collection_archive---------3----------------------->

## 新手程序员创建对象时的五大通病。避免这些错误，像专家一样编码。

![](img/efea0946560421526cfe592a1d67e415.png)

图片由[安德里亚·皮亚卡迪奥](https://www.pexels.com/@olly/)拍摄

> 本出版物中的示例是用 PHP 编写的，但是代码对于任何程序员来说都应该很容易理解；另一方面，这些规则适用于任何编程语言(几乎是)。)

你写面向对象的代码吗？你可能听说过**建造者**。构造函数的目的是初始化新创建的对象。来自 [PHP 手册](https://www.php.net/manual/en/language.oop5.decon.php):

> 具有构造函数方法的类在每个新创建的对象上调用这个方法，因此它适用于对象在使用前可能需要的任何初始化。

构造者打算只参与**他行动所必需的逻辑；虽然我经常遇到构造函数被过度使用的代码。**

这里有一个精选的列表，列出了开发新手在面向对象编程中应该避免的最常见的错误。

# 避免过多的争论

对于大型构造函数，普遍接受的限制是七个参数。我相信这个限制无论如何都太高了。

拥有大量的参数是一种代码味道。代码做了太多的指示符。考虑把它分成更小的班级。

我在控制器中多次看到这种模式。一个控制器类有许多动作；每一个都可能需要一组不同的依赖关系:

**解决方案:**最好尽量**不要超过 3–4 个参数**。总是问自己是否需要所有的依赖。通过做得更少，代码会变得更干净，并且它的可维护性和可测试性会增加。

# 避免访问运行时对象

运行时对象是仅在代码运行期间可访问的对象。在 HTTP 上下文中，可能是`RequestStack`；否则，它可能是表示当前已通过身份验证的用户的对象。

这是一个在实例化过程中可能中断的简单代码示例。如果在 HTTP 上下文之外(即在 *CLI* 命令中)请求该类，而用户服务尚未初始化，则可能会出现这种情况:

构造函数中其他可能错误的用法包括:

*   远程 API 调用，
*   调用其他类方法，
*   调用服务(其中包括:数据库、缓存提供者)

**解决方案:**不依赖构造函数中的运行时对象。坚持对象分配，将逻辑转移到调用类的方法调用上。

# 避免做得太多

避免构造函数中不必要的代码，并且**坚持最少的**。除了分配依赖项之外，可接受的最低要求是对输入进行验证。例如:

> 一个类至少需要十个正整数才能正常工作。

让我们强调这个不变量的正确性:

# 避免繁重的计算

一个构造函数的执行时间应该是**快如闪电**！运行时间长的构造函数会降低应用程序及其单元测试的速度(这也应该非常快。)

如果您将自己局限于分配依赖项和可能的简单输入验证，您将避免犯这个错误。

我曾多次使用第三方库，它的构造函数非常慢。我不得不使用代理模式来解决对象初始化缓慢的问题。

# 根本不使用构造函数

一个常见的误用是在构造函数上使用 setters 依赖注入(请不要在这一点上击败我😊)

施工方是你的**保障**；**保证**代码**在被调用时将**包含所有必要的依赖项。

这个公式经常在 Java Spring 框架中使用，在这个框架中，应用程序服务被注入了`@Autowired`注释。

在 PHP 中，我在控制器中反复看到这种模式，依赖关系被直接注入到动作中。

我个人更喜欢清晰的契约，而不是框架魔法和捷径。最终，你会做你喜欢的事情。

![](img/d535786fc8a35de87b90d58a67e5e639.png)

Cheezburger.com[的好意](https://cheezburger.com)

你喜欢这个列表吗？你同意关键点吗？也许我们应该扩大名单？请在评论中给我留言。另外，请务必阅读我的其他出版物《如何成为更好的开发人员》:

![.com software](img/3f349f31fce5e546b0eb66af9066295d.png)

[。com 软件](https://medium.com/@dotcom.software?source=post_page-----509cd867010a--------------------------------)

## 编写异常代码

[View list](https://medium.com/@dotcom.software/list/writing-exceptional-code-b75471cea909?source=post_page-----509cd867010a--------------------------------)7 stories![](img/0f6a44e151e01241892fe88fed01e358.png)![](img/c5d74809eb34bc1c6ef81a45887d7ba0.png)![](img/b0d07f4cd028d6e569384bb5eb9e0e8d.png)