<html>
<head>
<title>Start using Airflow on Heroku (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始在 Heroku 上使用气流(第一部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/start-using-airflow-on-heroku-first-step-cc4d8fe3c921?source=collection_archive---------4-----------------------#2021-12-06">https://blog.devgenius.io/start-using-airflow-on-heroku-first-step-cc4d8fe3c921?source=collection_archive---------4-----------------------#2021-12-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/80caa492b213825dc58dd44baa2732c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dxx-Uo37RIi7q94tX77r6A.jpeg"/></div></div></figure><p id="122f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每当我们开始在数据工程领域开发新的东西时，我们都希望将我们的项目放在一个重现生产环境的环境中，从而能够理解我们架构的所有界限。</p><p id="2b22" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我将在三篇系列文章中介绍如何创建一个<code class="fe kt ku kv kw b">airflow </code>项目，将您的项目上传到<a class="ae kx" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>，最后教您如何创建<code class="fe kt ku kv kw b">dags</code>并运行一些示例操作符。</p><h1 id="5905" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">从环境开始</h1><p id="e67c" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">让我们从为开发做好准备的位置和 Heroku 环境开始。为此，我们需要一些要求，即:</p><ul class=""><li id="3ad4" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">Heroku CLI</li><li id="341b" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">虚拟</li><li id="7461" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">Python 3</li></ul><p id="fdab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mp">注:在本项目中，我们将使用气流 2.2.0 </em></p><h1 id="3e0f" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Heroku CLI</h1><p id="bdb8" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">下载和安装</p><ul class=""><li id="5a1a" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">马科斯</li></ul><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="0671" class="my kz in kw b gy mz na l nb nc">brew tap heroku/brew &amp;&amp; brew install heroku</span></pre><ul class=""><li id="63db" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">Ubuntu 16+</li></ul><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="2eb0" class="my kz in kw b gy mz na l nb nc">sudo snap install --classic heroku</span></pre><ul class=""><li id="b97b" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">Windows 操作系统</li></ul><p id="b445" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kx" href="https://cli-assets.heroku.com/heroku-x64.exe" rel="noopener ugc nofollow" target="_blank"> 64 位安装程序</a></p><p id="88d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kx" href="https://cli-assets.heroku.com/heroku-x86.exe" rel="noopener ugc nofollow" target="_blank"> 32 位安装程序</a></p><h1 id="f215" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">虚拟</h1><p id="0a06" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">下载和安装</p><ul class=""><li id="a371" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">马科斯</li></ul><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="f1aa" class="my kz in kw b gy mz na l nb nc">pip install virtualenv<br/>cd airflow-on-heroku/<br/>virtualenv -p python3 env</span></pre><ul class=""><li id="8c57" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">Ubuntu 16+</li></ul><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="7e47" class="my kz in kw b gy mz na l nb nc">sudo pip3 install virtualenv<br/>cd airflow-on-heroku/<br/>virtualenv -p python3 env</span></pre><ul class=""><li id="4417" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">Windows 操作系统</li></ul><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="a669" class="my kz in kw b gy mz na l nb nc">c:\\Python37\\Scripts\\pip.exe install virtualenv<br/>C:\\Users\\User&gt;mkdir virtualenv<br/>C:\\Users\\User&gt;c:\\Python37\\Scripts\\virtualenv.exe virtualenv\\virtual_1</span></pre><p id="3834" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经准备好了开始的基本要求，让我们继续最好的部分。</p><p id="a00c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，让我们创建一个虚拟环境来安装所有必需的依赖项:</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="4858" class="my kz in kw b gy mz na l nb nc">mkdir airflow-on-heroku<br/>cd airflow-on-heroku<br/>virtualenv -p python3 env</span></pre><p id="c67d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下一步将是安装依赖项，并将它们保存在<code class="fe kt ku kv kw b">requirements.txt</code>文件中，以便可以在 Heroku 中复制:</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="6c99" class="my kz in kw b gy mz na l nb nc">source env/bin/activate<br/>pip install "apache-airflow[postgres, password]"<br/>pip freeze &gt;&gt; requirements.txt</span></pre><p id="f5ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经开始了我们的项目，并安装了必要的库来开始开发我们的数据编排器。让我们使用<code class="fe kt ku kv kw b">airflow db init</code>命令来创建允许我们在本地运行环境的必要文件。我们需要导出<code class="fe kt ku kv kw b">AIRFLOW_HOME</code>变量，然后运行<code class="fe kt ku kv kw b">airflow db init</code>命令。</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="5764" class="my kz in kw b gy mz na l nb nc">export AIRFLOW_HOME=$PWD<br/>airflow db init</span></pre><p id="8bff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行此命令后，airflow 将创建一些文件和文件夹，如下所示:</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="9acb" class="my kz in kw b gy mz na l nb nc">.<br/>├── airflow.cfg<br/>├── airflow.db<br/>├── logs<br/>└── unittests.cfg</span></pre><p id="7392" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此时，可以在本地运行气流，只需运行以下命令:</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="615a" class="my kz in kw b gy mz na l nb nc">airflow standalone</span></pre><p id="f060" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的终端上，您将看到如下消息，其中包含为访问 airflow 图形界面而创建的用户名和密码:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/2b145ebeb2a441d92080e4f161f7c6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shYMV7mSdgchuVIaNuG2Eg.png"/></div></div></figure><p id="beee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是气流的图形界面:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/c36ba05bfd941bd3974ef23dba0ebe16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXofyc2OaXVEKPMNGaiyLA.png"/></div></div></figure><p id="4fc2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的终端上输入 airflow 提供的登录名和密码后，您将能够访问 airflow 预先加载的一些示例<code class="fe kt ku kv kw b">dags</code>:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/90829eec4a2f5fb4479cfedd6246c0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6PUF39H4msy9KYRrs1IonA.png"/></div></div></figure><p id="45ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">借此机会了解更多关于气流图形界面的信息，并看看一些示例<code class="fe kt ku kv kw b">dags</code>是如何工作的。</p><p id="f679" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们准备我们的项目存储库，并包括我们不想版本化的文件:</p><pre class="mq mr ms mt gt mu kw mv mw aw mx bi"><span id="ff26" class="my kz in kw b gy mz na l nb nc">git init<br/>cat &lt;&lt;EOF &gt;&gt; .gitignore<br/>*.pyc<br/>*.db<br/>.env/<br/>logs/<br/>EOF</span></pre><p id="3f6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第一篇文章中，我们介绍了如何配置 airflow，如何在本地运行，以及如何首次接触这个数据编排器，在下一篇文章中，我们将看到如何在 Heroku 中将您的项目放到网上。我希望你喜欢它，很快第二部分就会准备好。</p><p id="4c4a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">链接到<a class="ae kx" href="https://github.com/lucasfonmiranda/run-airflow-on-heroku" rel="noopener ugc nofollow" target="_blank">库</a>，别忘了给那个小星星。</p></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><p id="ce98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mp">更多内容尽在</em><a class="ae kx" href="http://blog.devgenius.io" rel="noopener ugc nofollow" target="_blank"><em class="mp">blog . dev genius . io</em></a><em class="mp">。</em></p></div></div>    
</body>
</html>