<html>
<head>
<title>How to Connect Database to a Flask App -Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将数据库连接到 Flask 应用程序——第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-connect-database-to-a-flask-app-part-1-60611deea17a?source=collection_archive---------5-----------------------#2022-05-12">https://blog.devgenius.io/how-to-connect-database-to-a-flask-app-part-1-60611deea17a?source=collection_archive---------5-----------------------#2022-05-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="891f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过 SQLAlchemy 将 SQLite 数据库连接到 Flask 应用程序</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0bab5fa2d5c5750a75295e7932093c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOoga42iuLkWxj_tKIzYYg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">照片由<a class="ae ks" href="https://unsplash.com/@jstrippa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">詹姆斯·哈里森</a>在<a class="ae ks" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="9e51" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">介绍</h1><p id="849e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在本教程中，我将解释如何使用 SQLAlchemy 将数据库连接到 Flask 应用程序。在我以前的一篇文章中，我描述了如何开始用 Flask 开发应用程序。所以，这篇文章可以被认为是它的扩展版本。因为，在本教程之后，您将能够向您的应用程序添加数据库。如果你错过了我之前的文章，请点击下面的链接。</p><div class="mh mi gp gr mj mk"><a href="https://medium.com/codex/getting-started-with-flask-development-4b52752e9545" rel="noopener follow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd io gy z fp mp fr fs mq fu fw im bi translated">烧瓶开发入门</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">烧瓶入门指南。</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">medium.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my km mk"/></div></div></a></div></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="e1a9" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">从一个基本的 Flask 应用程序开始</h1><p id="5765" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在本文中，我将在虚拟环境中安装必要的包。您可以使用下面的命令<em class="nl">轻松地为您的应用程序激活虚拟环境【我强烈建议您在为本教程设置开发环境之前参考上面的文章】</em>。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="0003" class="nr ku in nn b gy ns nt l nu nv">$ virtualenv env</span><span id="abfe" class="nr ku in nn b gy nw nt l nu nv">$ source env/bin/activate</span><span id="87c4" class="nr ku in nn b gy nw nt l nu nv">Once you activate the virtual environment, you can install flask in it.</span><span id="4a68" class="nr ku in nn b gy nw nt l nu nv">$ pip install flask</span></pre><p id="0179" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">然后我们可以用下面的基本配置文件来配置我们的 flask 应用程序。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure><div class="kd ke kf kg gt ab cb"><figure class="oe kh of og oh oi oj paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/4a7e95762dea18955f65598afae39b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*QhTumvLbEQQKgpYw6te-IQ.png"/></div></figure><figure class="oe kh of og oh oi oj paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/c541eda81583ec7ae5af64135bedd895.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*hW44DGwG7aZ_2a66N0Tdpw.png"/></div></figure><figure class="oe kh of og oh oi oj paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/a13e306b775c58afafe3e005296c228f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*4DCB14qVVSxQbrz1hsilRg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk ok di ol om translated">作者截图</figcaption></figure></div><p id="2b18" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">现在我们所有的配置文件都准备好了；然后，我们可以开始将数据库连接到我们的 flask 应用程序。</p></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="860f" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">数据库创建</h1><p id="068f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们使用下面的命令将 SQLAlchemy 安装到虚拟环境中。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="4050" class="nr ku in nn b gy ns nt l nu nv">$ pip install Flask-SQLAlchemy</span></pre><p id="9aef" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">然后我们可以将 SQLAlchemy 导入到我们的<code class="fe on oo op nn b">app.py</code>文件中，并开始创建数据库。对于本教程，我使用 SQLite3 数据库，配置如下。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="586d" class="nr ku in nn b gy ns nt l nu nv">from flask_sqlalchemy import SQLAlchemy</span><span id="8a90" class="nr ku in nn b gy nw nt l nu nv"><br/># database<br/>app.config[‘SQLALCHEMY_DATABASE_URI’] = ‘sqlite:///db.sqlite3’<br/>app.config[‘SQLALCHEMY_TRACK_MODIFICATIONS’] = False<br/>db = SQLAlchemy(app)</span></pre><p id="163a" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">接下来，我们需要为我们的数据库创建一个模型。因此，可以按如下方式进行配置。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="c0ac" class="nr ku in nn b gy ns nt l nu nv">class User(db.Model):<br/>  id = db.Column(db.Integer, primary_key=True)<br/>  username = db.Column(db.String(20), unique=True, nullable=False)<br/>  email = db.Column(db.String(120), unique=True, nullable=False)<br/>  password = db.Column(db.String(60), nullable=False)<br/>  date_registered = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)</span></pre></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="020a" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">配置注册和登录路由</h1><p id="7255" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">一旦我们完成了数据库创建，我们就可以开始配置注册和登录路由，如下所示。</p><p id="d869" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">在您配置这些路线之前，请确保将<code class="fe on oo op nn b">request, redirect, flash, url_for</code>包导入到您的<code class="fe on oo op nn b">app.py</code>中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oc od l"/></div></figure></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="6462" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">初始化数据库并在主页上显示注册用户</h1><p id="df84" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在 SQLAlchemy 中，我们可以使用以下命令初始化数据库。我们可以在 route 中配置这个命令，这样一旦我们登陆主页，它将自动初始化我们的数据库，并准备好存储记录。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="629f" class="nr ku in nn b gy ns nt l nu nv">db.create_all()</span></pre><p id="a0f7" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">此外，由于我们需要在主页上显示所有注册用户及其详细信息，我们可以使用下面的命令查询可用用户。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="a013" class="nr ku in nn b gy ns nt l nu nv">User.query.all()</span><span id="5a61" class="nr ku in nn b gy nw nt l nu nv"># here 'User' is our model name (eg: class User())</span></pre><p id="6ff9" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">然后我们可以将这个查询与 home route 一起传递，这样它将在页面上显示所有注册的用户。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="fa9e" class="nr ku in nn b gy ns nt l nu nv">@app.route('/')</span><span id="628f" class="nr ku in nn b gy nw nt l nu nv">def home():<br/>  db.create_all()<br/>  return render_template('home.html', title='Home', users=User.query.all())</span></pre><p id="ad00" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">之后，我们需要修改我们的<code class="fe on oo op nn b">home.html</code>配置文件来显示用户的信息。我使用如下的<code class="fe on oo op nn b">Jinja2</code>模板继承命令。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="c353" class="nr ku in nn b gy ns nt l nu nv">{% for user in users %}</span><span id="dea0" class="nr ku in nn b gy nw nt l nu nv">&lt;p&gt;<br/>  {{ user.id }}&lt;br /&gt;<br/>  {{ user.username}} &lt;br /&gt;<br/>  {{ user.email }}&lt;br /&gt;<br/>  {{ user.password }}&lt;br /&gt;<br/>  {{ user.date_registered }}<br/>&lt;/p&gt;</span><span id="d5ba" class="nr ku in nn b gy nw nt l nu nv">{% endfor %}</span></pre></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="b688" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">为成功的用户注册和登录添加消息</h1><p id="91a9" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我修改了<code class="fe on oo op nn b">home.html</code>和<code class="fe on oo op nn b">login.html</code>配置文件来显示用户注册和登录的消息，如下所示。我在两个配置文件中添加了下面相同的命令。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="39f1" class="nr ku in nn b gy ns nt l nu nv">{% with messages = get_flashed_messages(with_categories=true) %}</span><span id="693c" class="nr ku in nn b gy nw nt l nu nv">  {% if messages %}<br/>    {% for category, message in messages %}<br/>      &lt;div class="alert alert-{{ category }}"&gt; {{ message }}&lt;/div&gt;<br/>    {% endfor %}<br/>  {% endif %}</span><span id="9657" class="nr ku in nn b gy nw nt l nu nv">{% endwith %}</span></pre></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="35c1" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">确认</h1><p id="8f24" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在这个 flask 应用程序中，我们需要几个验证来确保在运行应用程序时不会出错。</p><p id="d806" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">因此，第一个验证是，当用户注册时，他/她必须为<code class="fe on oo op nn b">password</code>和<code class="fe on oo op nn b">confirm password</code>字段输入相同的<strong class="ln io">密码</strong>。</p><p id="099f" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">让我们将验证添加到我们的<code class="fe on oo op nn b">register.html</code>配置文件中。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="5309" class="nr ku in nn b gy ns nt l nu nv">&lt;script&gt;</span><span id="1706" class="nr ku in nn b gy nw nt l nu nv">var password = document.getElementById("password"), confirm_password = document.getElementById("confirm_password");</span><span id="7483" class="nr ku in nn b gy nw nt l nu nv"><br/>function validatePassword(){<br/>  if(password.value != confirm_password.value) {<br/>    confirm_password.setCustomValidity("Passwords Don't Match");<br/>  } else {<br/>    confirm_password.setCustomValidity('');<br/>  }<br/>}</span><span id="d610" class="nr ku in nn b gy nw nt l nu nv">password.onchange = validatePassword;<br/>confirm_password.onkeyup = validatePassword;</span><span id="4df1" class="nr ku in nn b gy nw nt l nu nv">&lt;/script&gt;</span></pre><p id="c5ac" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">在本系列的下一部分，我将对应用程序进行一点点更新，并配置<strong class="ln io"> Flask WTForms </strong>，添加单独的表单和模型以确保我们接下来的验证。</p><p id="64c7" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated">在下一个教程中，我将检查新用户是否试图用现有的用户名或电子邮件注册；如果是这样，我们需要避免注册，并通知用户选择其他用户名或电子邮件。使用<strong class="ln io"> WTForms </strong>进行这种验证非常容易，所以我们将在第 2 部分重点讨论这一点。</p><ul class=""><li id="8919" class="oq or in ln b lo nx lr ny lu os ly ot mc ou mg ov ow ox oy bi translated"><a class="ae ks" href="https://github.com/randiltennakoon/flask_DB" rel="noopener ugc nofollow" target="_blank"> GitHub 回购</a></li></ul></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><p id="4776" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated"><strong class="ln io">感谢您的阅读！</strong></p><p id="6d4b" class="pw-post-body-paragraph ll lm in ln b lo nx jo lq lr ny jr lt lu nz lw lx ly oa ma mb mc ob me mf mg ig bi translated"><strong class="ln io">快乐编码</strong>👨🏻‍💻</p></div></div>    
</body>
</html>