<html>
<head>
<title>Java String is immutable — What does it actually mean?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java字符串是不可变的——它实际上意味着什么？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/java-string-is-immutable-what-does-it-actually-mean-6c7e9194a007?source=collection_archive---------5-----------------------#2022-01-14">https://blog.devgenius.io/java-string-is-immutable-what-does-it-actually-mean-6c7e9194a007?source=collection_archive---------5-----------------------#2022-01-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7ef9ebce451220557daf2873988b02c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wP4DCPy7MxRbZGkCQ1y7tw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@merlenegoulet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Merlene Goulet </a>在<a class="ae jz" href="https://unsplash.com/s/photos/java?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4995" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">" Java字符串是不可变的."是Java世界中一个众所周知的流行说法。但是为什么会这样呢？我们来探索一下。</p><p id="cf6c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简单地说，字符串是不可变的意味着一旦我们创建了一个字符串变量，我们就不能修改它。Java中的对象是在堆内存中创建的。所以字符串对象也是在堆中创建的。但是事情是这样的，Java中有一个特殊的内存区域来存储字符串，称为<strong class="kc io">字符串常量池</strong>。</p><p id="c76e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设我们创建一个字符串变量，如下所示。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="aa20" class="lh li in ld b gy lj lk l ll lm">String str1 = "Java";</span></pre><p id="7f49" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是它在内存中的存储方式。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/cdfb875f3994131c3aa4a715a151fa31.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*9AMRyMItLVxud8seiLhdTA.png"/></div></figure><p id="7d4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">引用存储在一个叫做堆栈的内存区域。因此“<strong class="kc io">str”</strong>将被放入堆栈中，“<strong class="kc io"> Java </strong>”将被存储在字符串常量池中。而<strong class="kc io"> str1 </strong>指的是string对象<strong class="kc io"> Java </strong>。</p><p id="8735" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，如果我们添加具有相同值“<strong class="kc io"> Java </strong>”的<strong class="kc io"> str2 </strong>变量，会发生什么？会不会创建另一个对象为"<strong class="kc io"> Java" </strong>来引用<strong class="kc io"> str2 </strong>？</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="a100" class="lh li in ld b gy lj lk l ll lm">String str1 = "Java";<br/>String str2 = "Java";</span></pre><p id="c6ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">实际上没有。str2还将引用堆内存中的同一个字符串对象"<strong class="kc io"> Java" </strong>。无论使用已经包含在字符串常量池中的同一个字符串对象创建多少个变量，它都将始终引用同一个字符串对象。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/3d6ef6307c949c13b55476f573ccfc87.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*s2LScGmF7KOG1qvbPHPDeg.png"/></div></figure><p id="7948" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那么把变量<strong class="kc io"> str1 </strong>赋给一个新的字符串为“<strong class="kc io"> Python </strong>”怎么样？对象“<strong class="kc io"> Java </strong>”会被“<strong class="kc io"> Python </strong>”替换吗？</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="73b1" class="lh li in ld b gy lj lk l ll lm">String str1 = "Java";<br/>String str2 = "Java";<br/>Str1 = "Python";</span></pre><p id="7f78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将创建一个新的字符串对象“<strong class="kc io"> Python </strong>”，并引用<strong class="kc io"> str1 </strong>。<strong class="kc io"> str2 </strong>还在引用“<strong class="kc io"> Java </strong>”。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/08ba92d3c57449d6bf7ffa159a35f66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*nES2SF_ZD5LQCONuVR2f8Q.png"/></div></figure><p id="dcc0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">想想这个。字符串“<strong class="kc io"> Java </strong>”没有被新字符串“<strong class="kc io"> Python </strong>”替换。所以，这里改变的是引用，而不是实际的对象。这就是为什么字符串是不可变的。一旦我们创建了一个字符串对象，我们就不能改变它。</p><p id="18a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们也从不同的角度来看这个问题。</p><p id="2f49" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们有一个字符串作为“<strong class="kc io"> Java </strong>”。然后我们使用concat()方法将"<strong class="kc io"> Python </strong>"连接到它。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="ca93" class="lh li in ld b gy lj lk l ll lm">String str = "Java";<br/>str.concat(" Python")<br/>System.out.println(str);</span></pre><p id="5e4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你期望结果会是什么？是不是要打印“<strong class="kc io"> <em class="lo"> Java Python </em> </strong>”。</p><p id="66f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们来看看它是如何存储在内存中的。然后你会意识到将要发生什么。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/24062d08f7d41522dc967b60207a170a.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*li_Oti4-xc-W8ZQo_Y_5Nw.png"/></div></figure><p id="e03f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在字符串常量池中会创建一个新的字符串对象“<strong class="kc io"><em class="lo">”Java Python</em></strong>”。但是“Java”字符串对象没有发生任何变化，并且<strong class="kc io"> str </strong>仍然在引用它。所以输出会是“<strong class="kc io"> Java </strong>”而不是“<strong class="kc io"> Java Python </strong>”。</p><p id="9595" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，这意味着我们不能改变字符串对象。</p><h2 id="1982" class="lh li in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">Java字符串禁止可变性吗？</h2><p id="d6fd" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">实际上没有。借助Java中的StringBuffer和StringBuilder，我们可以拥有可变字符串。</p><h2 id="53ef" class="lh li in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">但是为什么Java字符串是不可变的呢？</h2><p id="b184" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">最大的好处是同一个字符串对象将被多个引用共享。这可以节省大量内存，从而有效利用内存。</p><p id="bbbe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。希望这对您有所帮助！</p></div></div>    
</body>
</html>