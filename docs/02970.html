<html>
<head>
<title>Best of Modern JavaScript — Symbols</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华——符号</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-of-modern-javascript-symbols-8817986894d8?source=collection_archive---------3-----------------------#2020-09-16">https://blog.devgenius.io/best-of-modern-javascript-symbols-8817986894d8?source=collection_archive---------3-----------------------#2020-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/738f3a66de58dabe9d708fe08b097949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NjxwsycjKvfuu6z2"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@waldemarbrandt67w?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">瓦尔德马尔·布兰特</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fe3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究JavaScript符号。</p><h1 id="0229" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用符号枚举自己的属性键</h1><p id="2778" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用符号作为属性键。</p><p id="c3ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样定义一个对象:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1191" class="mn lc iq mj b gy mo mp l mq mr">const FOO = Symbol();<br/>const obj = {<br/>  [FOO]: 123<br/>};</span></pre><p id="072a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe ms mt mu mj b">Reflect.ownKeys</code>的方法来列举它们:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6985" class="mn lc iq mj b gy mo mp l mq mr">Reflect.ownKeys(obj)</span></pre><p id="f797" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Object.keys(obj)</code>方法将跳过符号键。</p><p id="5394" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以它会返回<code class="fe ms mt mu mj b">[]</code>。</p><h1 id="87fc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">作为属性键的符号</h1><p id="4551" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">符号可以用作类实例属性。</p><p id="3a64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4f40" class="mn lc iq mj b gy mo mp l mq mr">const foo = Symbol('foo');<br/>class Bar {<br/>  constructor(foo) {<br/>    this[foo] = foo;<br/>  }<br/>}</span></pre><p id="9586" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是将符号传递到方括号中，将它们用作属性。</p><p id="7074" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们在其他地方引用这些键时，我们可以以同样的方式使用它们。</p><h1 id="26d9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">元级属性</h1><p id="988d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以使用特殊符号来定义元级属性。</p><p id="28ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c2be" class="mn lc iq mj b gy mo mp l mq mr">const obj = {<br/>  data: ['foo', 'bar'],<br/>  [Symbol.iterator]() {<br/>    //···<br/>  }<br/>};</span></pre><p id="a5e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建可迭代对象。</p><p id="aa72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下代码将它与for-of循环一起使用:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="093c" class="mn lc iq mj b gy mo mp l mq mr">for (const x of obj) {<br/>  console.log(x);<br/>}</span></pre><h1 id="704d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将符号转换为其他基本类型</h1><p id="01c0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将符号转换成其他原始类型。</p><p id="6620" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将符号转换成布尔值。</p><p id="761f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eadc" class="mn lc iq mj b gy mo mp l mq mr">Boolean(sym)</span></pre><p id="eaad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e2e7" class="mn lc iq mj b gy mo mp l mq mr">!sym</span></pre><p id="355b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将<code class="fe ms mt mu mj b">sym</code>符号转换成布尔值。</p><p id="6c5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，我们不能把它们转换成数字。</p><p id="9e0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ba58" class="mn lc iq mj b gy mo mp l mq mr">Number(sym)</span></pre><p id="9c17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="736c" class="mn lc iq mj b gy mo mp l mq mr">sym * 10</span></pre><p id="e077" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">会给我们类型错误。</p><p id="2336" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe ms mt mu mj b">String</code>函数或<code class="fe ms mt mu mj b">toString</code>方法将符号转换成字符串。</p><p id="8ed7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9ac9" class="mn lc iq mj b gy mo mp l mq mr">String(sym)</span></pre><p id="86d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bfb7" class="mn lc iq mj b gy mo mp l mq mr">sym.toString()</span></pre><p id="0225" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们不能把它强制转换成一个字符串:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f0ac" class="mn lc iq mj b gy mo mp l mq mr">'' + sym</span></pre><p id="bdda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7679" class="mn lc iq mj b gy mo mp l mq mr">`${sym}`</span></pre><p id="53f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后两个例子会给我们带来类型错误。</p><p id="6516" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">防止强制将防止我们意外地将它们转换为属性键。</p><p id="f1c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们不能意外地将它们用作数组索引，因为它们不能转换成数字。</p><h1 id="84a8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">符号的包装对象</h1><p id="2a00" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">符号没有包装对象。</p><p id="63a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不能将<code class="fe ms mt mu mj b">new</code>操作符与<code class="fe ms mt mu mj b">Symbol</code>一起使用。</p><p id="a24c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以写作:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="335c" class="mn lc iq mj b gy mo mp l mq mr">new Symbol()</span></pre><p id="c35f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将给出“TypeError: Symbol不是构造函数”错误。</p><p id="54f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们可以通过使用<code class="fe ms mt mu mj b">Object</code>函数将它转换成一个对象:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fb3c" class="mn lc iq mj b gy mo mp l mq mr">const sym = Symbol();<br/>const wrapper = Object(sym);</span></pre><p id="b1e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe ms mt mu mj b">wrapper</code>将是由<code class="fe ms mt mu mj b">typeof wrapper</code>返回的<code class="fe ms mt mu mj b">'object'</code>类型。</p><h1 id="179f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过<code class="fe ms mt mu mj b">[ ]</code>和包装密钥访问属性</h1><p id="b463" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="81a5" class="mn lc iq mj b gy mo mp l mq mr">const foo = Symbol('foo');<br/>const obj = {<br/>  [sym]: 'a',<br/>  str: 'b',<br/>};</span></pre><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将符号传递到括号中以将它们用作属性键。</p><p id="207d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也适用于包装符号。</p><p id="0b4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="887c" class="mn lc iq mj b gy mo mp l mq mr">const foo = Symbol('foo');<br/>const wrappedSymbol = Object(foo);<br/>const obj = {<br/>  [wrappedSymbol]: 'a',<br/>  str: 'b',<br/>};</span></pre><p id="1277" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">wrappedSymbol</code>将被展开成一个符号，因此我们可以将包装的符号传递到方括号中。</p><h1 id="44e3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">属性访问</h1><p id="1f75" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">使用内部操作<code class="fe ms mt mu mj b">ToPropertyKey</code>获取和设置属性。</p><p id="3efc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将操作数转换为原语，并将<code class="fe ms mt mu mj b">ToPrimitive</code>转换为字符串。</p><p id="757d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果操作数是一个对象，那么使用内部方法<code class="fe ms mt mu mj b">[@@toPrimitive]()</code>将其转换为原始值。</p><p id="8859" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，使用<code class="fe ms mt mu mj b">toString</code>将操作数转换为图元。</p><p id="2291" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe ms mt mu mj b">toString</code>不可用，则使用<code class="fe ms mt mu mj b">valueOf</code>。</p><p id="9b46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，将引发TypeError。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/11d36b30005bc7b0b15c90d5bf30f263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8q7_bpclbCC4e5zu"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@glencarrie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Glen Carrie </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="3c63" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e6ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">符号作为对象键和类属性键很有用。</p></div></div>    
</body>
</html>