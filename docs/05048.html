<html>
<head>
<title>Making HTTP Requests with React Query — Paginated and Infinite Scroll Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Query发出HTTP请求—分页和无限滚动查询</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-paginated-and-infinite-scroll-queries-9d1217dfcc13?source=collection_archive---------3-----------------------#2021-06-08">https://blog.devgenius.io/making-http-requests-with-react-query-paginated-and-infinite-scroll-queries-9d1217dfcc13?source=collection_archive---------3-----------------------#2021-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2aa9626825fbf0d9b128c1b9a3d7f721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5NjTmvtIbwYZapl2"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">托马斯·格里斯贝克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="ec8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React查询库让我们可以在React应用程序中轻松地发出HTTP请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query发出HTTP请求。</p><h1 id="23fb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分页查询</h1><p id="d3b8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">useQuery</code>钩子像处理任何其他查询一样进行分页查询。</p><p id="4142" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="9404" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d019" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="898b" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient();</span><span id="42db" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="da0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4013" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const [page, setPage] = React.useState(1);<br/>  const { data: { data: { data, totalPages } } = { data: [] } } = useQuery(<br/>    ["todo", page],<br/>    ({ queryKey: [, page] }) =&gt; {<br/>      return axios(<br/>        `https://api.instantwebtools.net/v1/passenger?page=${page}&amp;size=10`<br/>      );<br/>    }<br/>  );</span><span id="5231" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={(p) =&gt; setPage(Math.max(1, page - 1))}&gt;prev&lt;/button&gt;<br/>      &lt;button onClick={(p) =&gt; setPage(Math.min(totalPages, page + 1))}&gt;<br/>        next<br/>      &lt;/button&gt;<br/>      &lt;div&gt;<br/>        {Array.isArray(data) &amp;&amp;<br/>          data.map((d, i) =&gt; &lt;p key={`${i}-${d.name}`}&gt;{d.name}&lt;/p&gt;)}<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="3f70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只需创建<code class="fe me mf mg mh b">page</code>状态，并将其传递给请求以进行分页查询。</p><p id="2500" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将看到有很多闪烁，因为每个查询都将作为一个新的查询。</p><p id="003a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使查询没有额外的闪烁，我们将<code class="fe me mf mg mh b">keepPreviousData</code>选项设置为<code class="fe me mf mg mh b">true</code>:</p><p id="7454" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0de9" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const [page, setPage] = React.useState(1);<br/>  const { data: { data: { data, totalPages } } = { data: [] } } = useQuery(<br/>    ["todo", page],<br/>    ({ queryKey: [, page] }) =&gt; {<br/>      return axios(<br/>        `https://api.instantwebtools.net/v1/passenger?page=${page}&amp;size=10`<br/>      );<br/>    },<br/>    {<br/>      keepPreviousData: true<br/>    }<br/>  );</span><span id="7a26" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={(p) =&gt; setPage(Math.max(1, page - 1))}&gt;prev&lt;/button&gt;<br/>      &lt;button onClick={(p) =&gt; setPage(Math.min(totalPages, page + 1))}&gt;<br/>        next<br/>      &lt;/button&gt;<br/>      &lt;div&gt;<br/>        {Array.isArray(data) &amp;&amp;<br/>          data.map((d, i) =&gt; &lt;p key={`${i}-${d.name}`}&gt;{d.name}&lt;/p&gt;)}<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><h1 id="f9c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">无限查询</h1><p id="a0e3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以使用React Query来请求无限滚动。</p><p id="530f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们使用<code class="fe me mf mg mh b">useInfiniteQuery</code>钩子。</p><p id="5fab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我们可以显示到目前为止已经获取的所有项目。</p><p id="d449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e3ac" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useInfiniteQuery } from "react-query";<br/>export default function App() {<br/>  const [page, setPage] = React.useState(1);<br/>  const { data, fetchNextPage } = useInfiniteQuery(<br/>    "names",<br/>    ({ pageParam = 1 }) =&gt; {<br/>      return axios(<br/>        `https://api.instantwebtools.net/v1/passenger?page=${pageParam}&amp;size=10`<br/>      );<br/>    },<br/>    {<br/>      getNextPageParam: (lastPage) =&gt; {<br/>        const { totalPages } = lastPage.data;<br/>        return page &lt; totalPages ? page + 1 : totalPages;<br/>      }<br/>    }<br/>  );</span><span id="1c84" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;<br/>        {data &amp;&amp;<br/>          Array.isArray(data.pages) &amp;&amp;<br/>          data?.pages.map((group, i) =&gt; {<br/>            return group?.data?.data.map((d, i) =&gt; (<br/>              &lt;p key={`${i}-${d.name}`}&gt;{d.name}&lt;/p&gt;<br/>            ));<br/>          })}<br/>      &lt;/div&gt;<br/>      &lt;button<br/>        onClick={() =&gt; {<br/>          setPage(page + 1);<br/>          fetchNextPage();<br/>        }}<br/>      &gt;<br/>        load more<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="5848" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">useInfiniteQuery</code>钩子，将请求的标识符作为第一个参数。</p><p id="cb40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是查询函数。</p><p id="24ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将带有<code class="fe me mf mg mh b">pageParam</code>属性的对象作为参数。</p><p id="4c85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">pageParam</code>是<code class="fe me mf mg mh b">getNextPageParam</code>函数的返回值。</p><p id="b08b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">getNextPageParam</code>返回<code class="fe me mf mg mh b">pageParam</code>的下一个值。</p><p id="35f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在JSX中，我们用页面数组返回<code class="fe me mf mg mh b">data.pages</code>数组。</p><p id="e94b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且我们调用<code class="fe me mf mg mh b">map</code>用页面中的数据来呈现数据。</p><p id="e364" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">加载更多按钮调用<code class="fe me mf mg mh b">fetchNextPage</code>获取下一页。</p><h1 id="ac29" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d62e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用React Query创建分页和无限滚动请求。</p></div></div>    
</body>
</html>