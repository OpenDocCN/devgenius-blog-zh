# 让我们了解一下 Express.js 中的中间件

> 原文：<https://blog.devgenius.io/lets-learn-about-middleware-in-express-js-174e839ffffa?source=collection_archive---------4----------------------->

对 Express.js 中中间件概念的简单而有趣的介绍

![](img/468855653dc956bd2c23cbec3252ca84.png)

如果你已经在 Node.js 附近呆了足够长的时间，你可能听说过中间件，我不想撒谎，当我第一次遇到这个词本身时，我感到很困惑😂更不用说中间件的实现了，但是你必须亲自动手去学习，所以请允许我温和地教你你需要知道的关于中间件的知识，✨，越简单越好，✨

**建立我们的开发环境**

如果你在 Linux 或 Mac 上打开你的终端，如果你在 Windows 上打开命令提示符

`mkdir middleware && cd middleware`创建一个新目录并导航至其中

`npm init --y`使用默认设置初始化一个新的 npm 项目(稍后您可以使用 package.json，我将向您展示)

`npm i express && npm i --save-dev nodemon`这将首先安装 express，因为我们需要它来构建我们的后端，然后我们将安装 nodemon 并将其保存为一个开发依赖项，因为我们在真实的生产环境中并不真正需要它

**添加脚本到**

如果你打开你的`package.json`文件，你会发现一个名为`scripts`的部分，这个部分包含了在终端中运行命令的“快捷方式”,它非常有用，所以让我们添加一个小脚本来运行 nodemon，就像我们很酷一样😜

`"dev": "nodemon index.js"`将此添加到“测试”脚本之后

要触发这些脚本，我们只需键入终端`npm run`，后跟在`scripts`部分定义的脚本名称，因此在我们的例子中，我们键入`npm run dev`，但我们稍后再使用:)

**到底什么是中间件**🤔

中间件基本上是在路由处理器功能之前执行**的功能。这并不简单，所以让我们来看看一个非常基本的快速服务器😊**

好吧，所以没有什么太花哨的，对不对？我们有三条路线`/`、`/users`、`/articles`，并且我们为这些路线中的每一条都有*路线处理函数*

运行`npm run dev`,您应该会看到一条小消息，上面写着“启动并运行”

我们的中间件将在对这些路由的每个请求之前执行，或者在我们可以选择指定的特定路由之前执行

中间件基本上是一种访问请求和响应对象的功能，就像路由处理器一样，它可以用来记录对我们的服务器发出的每个请求，或者检查用户是否登录，验证和授权用户保护某些资源和许多其他目的

**中间件与路由处理器**

中间件和路由处理器**的最大区别是 next()函数**

函数是中间件的第三个参数，它基本上告诉后端“继续下一个中间件”,或者换句话说“给它开绿灯，继续下一个例程”,这样我们的页面就不会冻结，永远不会完成加载，所以如果我们忘记放入它，程序就不会继续，因为它卡在了中间件中

**中间件的类型**

如上所述，我们有两种类型的中间件，一种运行在应用程序的顶层，因此它像中间件一样应用于所有的路由处理器，以检查用户是否登录，我们可以将其应用于我们正在编写的一些社交媒体应用程序的所有帖子路由

默认的`express`中间件的一个例子是`express.json()`中间件，我们一直在顶部使用它来接受和解析 json

另一种类型是在特定路由之前运行的中间件，可能你需要保护一些路由，这些路由可以访问只有管理员才能访问的文章或你的应用程序的一些 VIP 内容

**编写我们的第一个中间件**

说得够多了，让我们来看看如何编写我们自己的中间件，它会给我们一个美味的饼干🍪

在我们的导入之后添加以下代码片段

```
const say_hi = (req, res, next) => {
  console.log("have a yummy cookie 🍪");
  next();
}
```

为了在应用程序级别“启用”中间件，我们使用了`express.use(say_hi);`，注意我们没有添加括号，因为我们没有调用函数

现在前往任何路线，检查你的终端🍪

你的`index.js`现在应该是这个样子

```
const express = require("express");                             const app = express(); 
const say_hi = (req, res, next) => {
  console.log("have a yummy cookie 🍪");
  next();
};
app.use(say_hi);                                                          app.get("", (req, res) => res.send("you've reached the home page"));                                                           app.get("/users", (req, res) => res.send("this is the users page"));                                                           app.get("/articles", (req, res) => res.send("this is the articles page"));                                                           app.get("*", (req, res) => res.status(404).send("Page not found"));                                                           app.listen(3000, () => console.log("up and running"));
```

**为特定路线编写中间件**

既然我们已经看到了如何编写一个运行在应用程序级别的中间件，也就是运行在每个路由之前，让我们再编写两个中间件，一个运行在用户路由之前，告诉我们“我爱我的用户💕还有一篇文章说“哇，看看这些文章😮“所以莱格 oooo

```
const users_middleware = (req, res, next) => {
  console.log("i love my users 💕");
  next();
};const articles_middleware = (req, res, next) => {
  console.log("wow look at all those articles 😮");
};
```

现在，为了让我们专门为我们的路由使用它们，我们需要分别将它们作为路由处理函数的参数进行传递，所以现在看起来像这样

**快速注释**

*   中间件只是一个在服务器收到请求之后、路由句柄响应请求之前执行的功能
*   他们可以访问三个参数，`req` `res`和第三个参数，该参数是一个方便地称为`next()`的函数，允许下一个中间件运行
*   它们可以位于应用程序级别，以便在每个端点的每个请求之前运行，也可以被指定到某个路由

**结论**

对于新手来说，中间件最初可能是一个复杂的概念，但一旦你发现了对它们的真正需求，它们就很容易实现，因为你理解了它们背后的基本思想，它们是调节你的服务器资源和访问控制以及许多其他需求的强大工具

非常感谢你能坚持到现在，感谢你花时间关注我的博客，希望你能享受你的♥️日/夜