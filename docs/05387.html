<html>
<head>
<title>How To Get the Response Headers with cURL in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 PHP 中用 cURL 获得响应头</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-get-the-response-headers-with-curl-in-php-2173b10d4fc5?source=collection_archive---------1-----------------------#2021-08-02">https://blog.devgenius.io/how-to-get-the-response-headers-with-curl-in-php-2173b10d4fc5?source=collection_archive---------1-----------------------#2021-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4ce2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对此没有内置的解决方案，但是我们可以轻松地创建自己的解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/62a5477efff0eb416f0bd0f4802ddc20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AlOwaAhTYIZ52W4_"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@benofthenorth?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">本</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ac37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多公共 API 使用自定义头来向用户传递一些额外的数据，如速率限制或访问限制。当在 JavaScript 中使用<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" rel="noopener ugc nofollow" target="_blank">XMLHttpRequests</a></code>时，你可以很容易地通过<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders" rel="noopener ugc nofollow" target="_blank">getAllResponseHeaders()</a></code>或<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getResponseHeader" rel="noopener ugc nofollow" target="_blank">getResponseHeader(headerName)</a></code>函数得到它们。几天前，我在 PHP 中使用了一个带有自定义头文件的新 API，我想应该会有一个简单的内置函数。</p><p id="439d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，快速搜索后，我意识到没有内置的解决方案。幸运的是，只要多做一点工作，还是有可能得到响应头的。</p><h1 id="a834" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">cURL 中的响应标头</h1><p id="5b86" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">如果您只对响应头感兴趣，而对正文内容不感兴趣，cURL 内置了一个简单的解决方案。通过将<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-setopt.php" rel="noopener ugc nofollow" target="_blank">CURLOPT_HEADER</a></code>和<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-setopt.php" rel="noopener ugc nofollow" target="_blank">CURLOPT_NOBODY</a></code>选项设置为真，<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-exec.php" rel="noopener ugc nofollow" target="_blank">curl_exec()</a></code>的结果将只包含标题。当您只需要消息头时，这很有用，但是大多数时候，我们也需要请求的内容。</p><p id="b9c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个问题的解决方案也存在于<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-setopt.php" rel="noopener ugc nofollow" target="_blank">CURLOPT_HEADER</a></code>选项中。将其设置为 true 将在<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-exec.php" rel="noopener ugc nofollow" target="_blank">curl_exec()</a></code>的输出中包含标题。然而，如果没有<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-setopt.php" rel="noopener ugc nofollow" target="_blank">CURLOPT_NOBODY</a></code>选项，我们现在有一个包含请求头和请求体的输出，我们需要将它们分开。这可以用<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-getinfo.php" rel="noopener ugc nofollow" target="_blank">curl_getinfo()</a></code>函数中的<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.php.net/manual/en/function.curl-getinfo.php" rel="noopener ugc nofollow" target="_blank">CURLINFO_HEADER_SIZE</a></code>参数来完成，它将告诉我们标题的长度，我们可以很容易地使用这个值来为标题和正文创建两个子字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3332" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，我们有一个很长的字符串，所有的标题都不是特别用户友好。因此，让我们实现一个函数来创建一个漂亮的关联数组，将标题名作为键，将它们的值作为值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="82a6" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">一个完整的例子</h1><p id="97fe" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">让我们首先创建一个快速示例 API，并设置一些自定义头:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8ee1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们对我们的测试 API 做一个 cURL 请求，并使用之前的函数同时获取自定义标题和正文内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3ade" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们查看脚本的输出，我们可以看到我们从自定义头中获取了值，并且仍然可以访问正文中的值:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="509f" class="mz lx iq lv b gy na nb l nc nd">CUSTOM_HEADER: Hello World<br/>API_REQUEST_COUNTER: 42<br/>API_REQUEST_LIMIT: 69<br/>Body: {"result":true,"someValue":420}</span></pre></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="49fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然 PHP 中没有内置的解决方案来检索 cURL 中的响应头值，但很容易为它创建我们自己的自定义函数。通过设置一个特殊的选项，头部被包含在输出中，我们可以将它们从请求的内容中分离出来。然后，我们可以将它们转换成用户友好的关联数组，并轻松访问它们的值。如果您在 PHP 中使用 cURL 来使用任何带有自定义头文件的 API，这是一个非常有用的工具。</p></div></div>    
</body>
</html>