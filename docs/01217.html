<html>
<head>
<title>Change picker value onScroll — React Native and Expo.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更改滚动上的选取器值—反应本机和 Expo。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/change-picker-value-onscroll-react-native-and-expo-df81b17e9a8d?source=collection_archive---------5-----------------------#2020-06-27">https://blog.devgenius.io/change-picker-value-onscroll-react-native-and-expo-df81b17e9a8d?source=collection_archive---------5-----------------------#2020-06-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/addac08ec4cd2d760f1d25c8c705cc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*FvX4K-qnvGm7Eif-p1DeKw.gif"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">默认 NPM 包示例</figcaption></figure><p id="e495" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是我为一家房地产开发公司做的第一个 React native 项目，任务是在滚轮选择器卷轴上突出显示选定的建筑楼层。(<em class="kt">顺便可以查一下这个 APP 的工作示例(</em> <a class="ae ku" href="https://apps.apple.com/ge/app/archi-ge/id1506595848" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> IOS </em> </a> <em class="kt">，</em><a class="ae ku" href="https://play.google.com/store/apps/details?id=com.archi" rel="noopener ugc nofollow" target="_blank"><em class="kt">Android</em></a><em class="kt">)，目前来看语言只有格鲁吉亚语。你也可以从 NPM 下载这个包。</em></p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/02e82e880cc5b84d0d342823590124ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*BKg5CUWjhEmmMjLofOsIew.gif"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">工作项目示例</figcaption></figure><p id="2fff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是没有希望找到任何反应原生包或 StackOverflow 帮助。所有的自定义拾取器和 IOS 本地拾取器也只在滚动结束时进行回调。我总是试着写自己的代码而不使用包，但是这次我认为这是一个困难的任务，需要很多时间。花在寻找上的时间和精力告诉我，我必须自己做所有的事情。幸运的是，许多 React 原生开发者正在寻找类似的功能，在他们的谷歌足迹中，我发现了<a class="ae ku" href="https://github.com/ninio/react-native-swipe-picker" rel="noopener ugc nofollow" target="_blank">React-Native-swipe-picker</a>包，其中 FlatList 或 ScrollView 被用作 picker，所以这是一个修复我的问题的机会。</p><p id="ab73" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我增加了滚动回调，修复了一些 bug，改进了功能，让开发者更加方便。</p><p id="269e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如何使用 DynamicallySelectedPicker 组件的简单示例</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="b4d5" class="le lf in la b gy lg lh l li lj">import React, {<em class="kt">useState</em>} from 'react';<br/>import {StyleSheet, View, Text} from 'react-native';<br/>import {Colors} from 'react-native/Libraries/NewAppScreen';<br/>import DynamicallySelectedPicker from './src/components/DynamicallySelectedPicker';</span><span id="6e8d" class="le lf in la b gy lk lh l li lj">const <em class="kt">App </em>= () =&gt; {<br/>  const [selectedValue, setSelectedValue] = <em class="kt">useState</em>(0);</span><span id="c91f" class="le lf in la b gy lk lh l li lj">  return (<br/>    &lt;View style={styles.body}&gt;<br/>      &lt;View style={{margin: 30}}&gt;<br/>        &lt;Text&gt;Item index {selectedValue}&lt;/Text&gt;<br/>      &lt;/View&gt;<br/>      &lt;DynamicallySelectedPicker<br/>        items={[<br/>          {<br/>            value: 1,<br/>            label: 'Item 1',<br/>          },<br/>          {<br/>            value: 2,<br/>            label: 'Item 2',<br/>          },<br/>          {<br/>            value: 3,<br/>            label: 'Item 3',<br/>          },<br/>          {<br/>            value: 4,<br/>            label: 'Item 4',<br/>          },<br/>          {<br/>            value: 5,<br/>            label: 'Item 5',<br/>          },<br/>        ]}<br/>        width={300}<br/>        height={300}<br/>        onScroll={(<em class="kt">selected</em>) =&gt; setSelectedValue(<em class="kt">selected</em>.index)}<br/>      /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};</span><span id="c2a7" class="le lf in la b gy lk lh l li lj">const styles = StyleSheet.create({<br/>  body: {<br/>    backgroundColor: Colors.white,<br/>    flex: 1,<br/>    alignItems: 'center',<br/>    justifyContent: 'center',<br/>  },<br/>});</span><span id="6042" class="le lf in la b gy lk lh l li lj">export default <em class="kt">App</em>;</span></pre><p id="a919" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个带有一个大组件的 React 本地示例(它可以被分成几个小的功能组件)。要经营世博会，你必须改变</p><p id="1c51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kt">反应-原生-线性-渐变</em> </strong>包到<a class="ae ku" href="https://docs.expo.io/versions/latest/sdk/linear-gradient/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kt">世博-线性-渐变</em> </strong> </a></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="68f0" class="le lf in la b gy lg lh l li lj">import React from 'react';<br/>import PropTypes from 'prop-types';<br/>import {StyleSheet, View, ScrollView, Platform, Text} from 'react-native';<br/>import LinearGradient from 'react-native-linear-gradient';<br/>import <em class="kt">PickerListItem </em>from './PickerListItem';</span><span id="707a" class="le lf in la b gy lk lh l li lj">export default class DynamicallySelectedPicker extends React.Component {<br/>  constructor(<em class="kt">props</em>) {<br/>    <em class="kt">super</em>(<em class="kt">props</em>);</span><span id="e0f6" class="le lf in la b gy lk lh l li lj">    <em class="kt">// set picker item height for android and ios<br/>    </em>const {height, transparentItemRows, initialSelectedIndex} = <em class="kt">props</em>;<br/>    let itemHeight = height / (transparentItemRows * 2 + 1);<br/>    <em class="kt">// In ios we have to manually ceil items height to eliminate distortion in the visualization, when we have big data.<br/>    </em>if (Platform.OS === 'ios') {<br/>      itemHeight = Math.ceil(itemHeight);<br/>    }</span><span id="482b" class="le lf in la b gy lk lh l li lj">    <em class="kt">this</em>.state = {<br/>      itemHeight: itemHeight,<br/>      itemIndex: initialSelectedIndex,<br/>    };<br/>  }</span><span id="1831" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   * Generate fake items for picker top and bottom.<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">n<br/>   * </em><strong class="la io"><em class="kt">@returns </em></strong><em class="kt">{[]}<br/>   */<br/>  </em>fakeItems(<em class="kt">n </em>= 3) {<br/>    const itemsArr = [];<br/>    for (let i = 0; i &lt; <em class="kt">n</em>; i++) {<br/>      itemsArr[i] = {<br/>        value: -1,<br/>        label: '',<br/>      };<br/>    }<br/>    return itemsArr;<br/>  }</span><span id="9da6" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   * Get extended picker items length.<br/>   * </em><strong class="la io"><em class="kt">@returns </em></strong><em class="kt">{number}<br/>   */<br/>  </em>allItemsLength() {<br/>    return <em class="kt">this</em>.extendedItems().length - <em class="kt">this</em>.props.transparentItemRows * 2;<br/>  }</span><span id="63aa" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   *<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">event<br/>   */<br/>  </em>onScroll(<em class="kt">event</em>) {<br/>    const {items, onScroll} = <em class="kt">this</em>.props;<br/>    const tempIndex = <em class="kt">this</em>.getItemTemporaryIndex(<em class="kt">event</em>);<br/>    if (<br/>      <em class="kt">this</em>.state.itemIndex !== tempIndex &amp;&amp;<br/>      tempIndex &gt;= 0 &amp;&amp;<br/>      tempIndex &lt; <em class="kt">this</em>.allItemsLength()<br/>    ) {<br/>      <em class="kt">this</em>.setItemIndex(tempIndex);<br/>      onScroll({index: tempIndex, item: items[tempIndex]});<br/>    }<br/>  }</span><span id="77da" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   *<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">event<br/>   * </em><strong class="la io"><em class="kt">@returns </em></strong><em class="kt">{number}<br/>   */<br/>  </em>getItemTemporaryIndex(<em class="kt">event</em>) {<br/>    return Math.round(<br/>      <em class="kt">event</em>.nativeEvent.contentOffset.y / <em class="kt">this</em>.state.itemHeight,<br/>    );<br/>  }</span><span id="d4f2" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   *<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">index<br/>   */<br/>  </em>setItemIndex(<em class="kt">index</em>) {<br/>    <em class="kt">this</em>.setState({<br/>      itemIndex: <em class="kt">index</em>,<br/>    });<br/>  }</span><span id="a3b5" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   * Add fake items to make picker almost like IOS native wheel picker.<br/>   * </em><strong class="la io"><em class="kt">@returns </em></strong><em class="kt">{*[]}<br/>   */<br/>  </em>extendedItems() {<br/>    const {transparentItemRows} = <em class="kt">this</em>.props;<br/>    return [<br/>      ...<em class="kt">this</em>.fakeItems(transparentItemRows),<br/>      ...<em class="kt">this</em>.props.items,<br/>      ...<em class="kt">this</em>.fakeItems(transparentItemRows),<br/>    ];<br/>  }</span><span id="d66b" class="le lf in la b gy lk lh l li lj">  <em class="kt">/**<br/>   *<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">item<br/>   * </em><strong class="la io"><em class="kt">@param </em></strong><em class="kt">index<br/>   * </em><strong class="la io"><em class="kt">@returns </em></strong><em class="kt">{*}<br/>   */<br/>  </em>renderPickerListItem(<em class="kt">item</em>, <em class="kt">index</em>) {<br/>    const {itemHeight} = <em class="kt">this</em>.state;<br/>    const {allItemsColor, itemColor} = <em class="kt">this</em>.props;</span><span id="03fd" class="le lf in la b gy lk lh l li lj">    return (<br/>      &lt;View<br/>        key={<em class="kt">index</em>}<br/>        style={[<br/>          styles.listItem,<br/>          {<br/>            height: itemHeight,<br/>          },<br/>        ]}&gt;<br/>        &lt;Text<br/>          style={{<br/>            color: itemColor ? itemColor : allItemsColor,<br/>          }}&gt;<br/>          {<em class="kt">item</em>.label}<br/>        &lt;/Text&gt;<br/>      &lt;/View&gt;<br/>    );<br/>  }</span><span id="fcb0" class="le lf in la b gy lk lh l li lj">  render() {<br/>    const {itemIndex, itemHeight} = <em class="kt">this</em>.state;<br/>    const {<br/>      width,<br/>      height,<br/>      topGradientColors,<br/>      bottomGradientColors,<br/>      selectedItemBorderColor,<br/>      transparentItemRows,<br/>    } = <em class="kt">this</em>.props;<br/>    return (<br/>      &lt;View style={{height: height, width: width}}&gt;<br/>        &lt;ScrollView<br/>          showsVerticalScrollIndicator={false}<br/>          showsHorizontalScrollIndicator={false}<br/>          onScroll={(<em class="kt">event</em>) =&gt; {<br/>            <em class="kt">this</em>.onScroll(<em class="kt">event</em>);<br/>          }}<br/>          scrollEventThrottle<br/>          initialScrollIndex={itemIndex}<br/>          snapToInterval={itemHeight}&gt;<br/>          {<em class="kt">this</em>.extendedItems().map((<em class="kt">item</em>, <em class="kt">index</em>) =&gt; {<br/>            return <em class="kt">this</em>.renderPickerListItem(<em class="kt">item</em>, <em class="kt">index</em>);<br/>          })}<br/>        &lt;/ScrollView&gt;<br/>        &lt;View<br/>          style={[<br/>            styles.gradientWrapper,<br/>            {<br/>              top: 0,<br/>              borderBottomWidth: 1,<br/>              borderBottomColor: selectedItemBorderColor,<br/>            },<br/>          ]}<br/>          pointerEvents="none"&gt;<br/>          &lt;LinearGradient<br/>            colors={topGradientColors}<br/>            style={[<br/>              styles.pickerGradient,<br/>              {<br/>                height: transparentItemRows * itemHeight,<br/>              },<br/>            ]}<br/>          /&gt;<br/>        &lt;/View&gt;<br/>        &lt;View<br/>          style={[<br/>            styles.gradientWrapper,<br/>            {<br/>              bottom: 0,<br/>              borderTopWidth: 1,<br/>              borderTopColor: selectedItemBorderColor,<br/>            },<br/>          ]}<br/>          pointerEvents="none"&gt;<br/>          &lt;LinearGradient<br/>            colors={bottomGradientColors}<br/>            style={[<br/>              styles.pickerGradient,<br/>              {height: transparentItemRows * itemHeight},<br/>            ]}<br/>          /&gt;<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    );<br/>  }<br/>}</span><span id="63a7" class="le lf in la b gy lk lh l li lj">DynamicallySelectedPicker.defaultProps = {<br/>  items: [{value: 0, label: 'No items', itemColor: 'red'}],<br/>  onScroll: () =&gt; {},<br/>  width: 300,<br/>  height: 300,<br/>  initialSelectedIndex: 0,<br/>  transparentItemRows: 3,<br/>  allItemsColor: '#000',<br/>  selectedItemBorderColor: '#cecece',<br/>  topGradientColors: [<br/>    'rgba( 255, 255, 255, 1 )',<br/>    'rgba( 255, 255, 255, 0.9 )',<br/>    'rgba( 255, 255, 255, 0.7 )',<br/>    'rgba( 255, 255, 255, 0.5 )',<br/>  ],<br/>  bottomGradientColors: [<br/>    'rgba( 255, 255, 255, 0.5 )',<br/>    'rgba( 255, 255, 255, 0.7 )',<br/>    'rgba( 255, 255, 255, 0.9 )',<br/>    'rgba( 255, 255, 255, 1 )',<br/>  ],<br/>};</span><span id="a9fb" class="le lf in la b gy lk lh l li lj">DynamicallySelectedPicker.propTypes = {<br/>  items: PropTypes.arrayOf(<br/>    PropTypes.shape({<br/>      value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),<br/>      label: PropTypes.string,<br/>      itemColor: PropTypes.string,<br/>    }),<br/>  ),<br/>  onScroll: PropTypes.func,<br/>  initialSelectedIndex: PropTypes.number,<br/>  height: PropTypes.number,<br/>  width: PropTypes.number,<br/>  allItemsColor: PropTypes.string,<br/>  selectedItemBorderColor: PropTypes.string,<br/>  topGradientColors: PropTypes.array,<br/>  bottomGradientColors: PropTypes.array,<br/>};</span><span id="4389" class="le lf in la b gy lk lh l li lj">const styles = StyleSheet.create({<br/>  listItem: {<br/>    alignItems: 'center',<br/>    justifyContent: 'center',<br/>  },<br/>  gradientWrapper: {<br/>    position: 'absolute',<br/>    width: '100%',<br/>  },<br/>  pickerGradient: {<br/>    width: '100%',<br/>  },<br/>});</span></pre><p id="c3b3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望有人会用，不会像我一样浪费时间。此外，如果您有任何问题或意见，请随时交流。</p><p id="1626" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ku" href="https://github.com/sosog/react-native-dynamically-selected-picker" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>中的投稿或问题报告(有一点点不同，有更多的道具和回调。)就太好了。</p><p id="e9d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">再次为我糟糕的英语道歉，谢谢你。</p></div></div>    
</body>
</html>