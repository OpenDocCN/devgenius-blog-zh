<html>
<head>
<title>Making HTTP Requests with React Query — Placeholder Data, Initial Data, and Prefetching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 React 查询发出 HTTP 请求—占位符数据、初始数据和预取</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-placeholder-data-initial-data-and-prefetching-d50f92de887b?source=collection_archive---------3-----------------------#2021-06-09">https://blog.devgenius.io/making-http-requests-with-react-query-placeholder-data-initial-data-and-prefetching-d50f92de887b?source=collection_archive---------3-----------------------#2021-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/424c2d53389df2b6050bd1aae1e6bb64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ukvRu__R5h8lwpXj"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">劳里·吉布森在 Unsplash 的照片</figcaption></figure><p id="40f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React 查询库让我们可以在 React 应用程序中轻松地发出 HTTP 请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用 React Query 发出 HTTP 请求。</p><h1 id="6d95" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">占位符数据</h1><p id="f366" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加在加载请求时设置的占位符数据。</p><p id="5a05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们通过编写以下代码来设置<code class="fe me mf mg mh b">placeholderData</code>属性:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8d1c" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"), {<br/>    placeholderData: {}<br/>  });</span><span id="ae1a" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="7fef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以从缓存中加载占位符数据。</p><p id="6fb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="babd" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery, useQueryClient } from "react-query";<br/>export default function App() {<br/>  const queryClient = useQueryClient();<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"), {<br/>    placeholderData: () =&gt; {<br/>      return queryClient.getQueryData("yesNo");<br/>    }<br/>  });</span><span id="85ce" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="8cca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用带有请求标识符的<code class="fe me mf mg mh b">queryClient.getQueryData</code>方法获取缓存的数据。</p><h1 id="91a4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">初始查询数据</h1><p id="a0c4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">此外，我们可以设置初始查询数据，这些数据是在第一次进行查询时设置的。</p><p id="3560" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e922" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"), {<br/>    initialData: {}<br/>  });</span><span id="9e03" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="befd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以用<code class="fe me mf mg mh b">staleTime</code>属性设置数据被认为是新的时间，以毫秒为单位。</p><p id="4c82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8d96" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"), {<br/>    initialData: {},<br/>    staleTime: 1000<br/>  });</span><span id="65f1" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="b313" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">stateTime</code>设置为 1000 毫秒，以使该时间之后的初始数据无效。</p><p id="496b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以将<code class="fe me mf mg mh b">initialData</code>设置为一个函数，只在第一次查询时设置初始数据:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b240" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"), {<br/>    initialData: () =&gt; {<br/>      return {};<br/>    }<br/>  });</span><span id="3cf4" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><h1 id="bfc0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">预取</h1><p id="7aae" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">React Query 允许我们预取数据。</p><p id="371f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1953" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React, { useEffect } from "react";<br/>import { useQuery, useQueryClient } from "react-query";<br/>export default function App() {<br/>  const queryClient = useQueryClient();<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"));</span><span id="c557" class="mq lc iq mh b gy mv ms l mt mu">  const prefetch = async () =&gt; {<br/>    await queryClient.prefetchQuery("yesNo", () =&gt; Promise.resolve({}));<br/>  };</span><span id="e48f" class="mq lc iq mh b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    prefetch();<br/>  }, []);</span><span id="8398" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="4990" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<code class="fe me mf mg mh b">queryClient.prefetchQuery</code>来预取对标识符为<code class="fe me mf mg mh b">'yesNo'</code>的请求的响应。</p><h1 id="a59f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="8c8f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 React Query 预取数据、设置占位符数据以及为请求设置初始数据。</p></div></div>    
</body>
</html>