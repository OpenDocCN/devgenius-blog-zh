<html>
<head>
<title>Keeping Your Data Pipelines Organized</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持数据管道井井有条</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/keeping-your-data-pipelines-organized-fa387247d59e?source=collection_archive---------2-----------------------#2021-12-08">https://blog.devgenius.io/keeping-your-data-pipelines-organized-fa387247d59e?source=collection_archive---------2-----------------------#2021-12-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ff03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">展示简单易用的数据工程师项目结构</em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b758d0801de8ac3959d1392c5253f1f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ObuBcO0cDg7NJKrB"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@gndclouds?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">威廉·费尔克</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="a938" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">介绍</h1><p id="87f4" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">数据工程师项目可能会在一眨眼的时间里变得一团糟。由于这种项目有几十个(甚至几百个或几千个)文件，包括依赖文件、作业、单元测试、shell 文件，有时甚至还有 Jupyter 笔记本，所以初学者很难构建一个简单且易于维护的项目结构。</p><p id="0edc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文的目的是帮助数据工程师领域的新手，提出一个易于维护的项目结构，以使他们的生活更轻松。这个示例项目的源代码可以在<a class="ae kz" href="https://github.com/flpn/data-engineering-project-structure" rel="noopener ugc nofollow" target="_blank"> this </a> GitHub 资源库中找到。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="9a13" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">管理您的依赖性</h1><p id="6d55" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">首先，我强烈推荐任何项目都要有一个像<a class="ae kz" href="https://python-poetry.org/docs/" rel="noopener ugc nofollow" target="_blank">诗</a>这样的依赖管理器(对于真正的家伙来说，太牛逼了！！！).所以，在你安装完诗歌并告诉他你应该在你的根目录下有一个依赖文件。</p><p id="2799" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是一个用诗歌创建的依赖文件(<em class="ki"> pyproject.toml </em>)的例子:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">pyproject.toml</figcaption></figure></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="f9e7" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">单元测试总是很重要</h1><p id="5316" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我们都应该知道，在我们的项目中实现测试可以让我们远离麻烦，并且大多数时候可以提高我们正在开发的软件的代码质量。在数据管道中，规则是一样的:总是实现单元测试！！！</p><p id="158f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，为了做到这一点，我们将创建一个名为 test ( <em class="ki">多么原始，嗯？</em>)并在其中放置一些测试。在这个例子中，我将使用 pytest 库来实现它们。这里有一个例子:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">测试 _ 清理 _ 列. py</figcaption></figure><p id="42e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你现在可能会问自己:</p><blockquote class="mr ms mt"><p id="60c5" class="jk jl ki jm b jn jo jp jq jr js jt ju mu jw jx jy mv ka kb kc mw ke kf kg kh ig bi translated">“等一下？？？那个<em class="in">转换</em>模块是哪里来的？他还没有实施其中任何一项……”</p></blockquote><p id="e373" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没错。我没有！首先，编写一个失败的测试，然后为了通过单元测试而实现这个测试！那就是我们所说的<a class="ae kz" href="http://www.jamesshore.com/v2/books/aoad1/test_driven_development" rel="noopener ugc nofollow" target="_blank"> TDD </a>！既然您已经理解了，让我们实现缺失的代码并通过测试吧！</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="1189" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">将所有数据转换保存在单独的模块中</h1><p id="a075" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我们将数据转换逻辑嵌入到工作中，这是一种非常常见的做法。有时我们这样做是因为一天的匆忙，但是相信我，随着更多的代码行开始进入你的主流程，你会发现你的代码将变成一场噩梦。</p><p id="ffb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，为了避免这种情况，我们将在项目的根目录下创建一个名为<em class="ki"> transformations </em>的新文件夹，并将每个数据转换(python 函数、pyspark 转换…诸如此类的东西)放入其中。</p><p id="aa32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是在我们的单元测试中丢失的函数的实现。通常，我不喜欢把<em class="ki">类型的提示</em>放在我的代码中，但是因为这个函数可以在我的项目中到处使用(并且考虑到在一个项目中你通常和很多人一起工作)，我认为让事情尽可能清晰是一个好的实践。另一个改进是给这个函数添加一个<em class="ki">文档字符串</em>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">clean_data.py</figcaption></figure></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="295d" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">实施您的工作</h1><p id="3b05" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">现在是时候实施我们的工作了！为了简化这里的事情，我不会向你们展示我添加的一些代码，但请记住，我创建了一个名为<em class="ki"> run </em>的方法，该方法包装了包含在<em class="ki"> clean_data </em>包中的所有转换。</p><p id="7ccf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">同样，如果你想看到完整的代码，你可以检查这个库。这就是我们的工作:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">保存 _ 清理 _ 数据. py</figcaption></figure></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="96f6" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">执行整个事情</h1><p id="b9be" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">因此，为了执行我们的测试和作业，我喜欢创建一些<em class="ki">。sh </em>保持事物有序的脚本(<em class="ki">毕竟这是本文的重点，对吗？</em>)。另外，我已经下载了<a class="ae kz" href="https://github.com/flpn/data-engineering-project-structure/tree/main/resources/inputs" rel="noopener ugc nofollow" target="_blank">这个</a> CSV 文件，只是为了在一个真实的数据集中应用我的转换。</p><p id="bfaa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，为了给你一个例子，我将在这里留下两个脚本，它们可以用来测试和执行你的代码。脚本放在一个名为<em class="ki">脚本</em>的文件夹中。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">运行测试. sh</figcaption></figure><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">run-save-cleaned-data.sh</figcaption></figure></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="d71b" class="la lb in bd lc ld mk lf lg lh ml lj lk ll mm ln lo lp mn lr ls lt mo lv lw lx bi translated">我们最终的结构</h1><p id="9470" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">在所有这些旅程之后，我们已经了解了如何构建一个包含依赖管理、单元测试和良好模块化的 Python 和 Shell 脚本的数据工程项目。最终的结构看起来像这样:</p><pre class="kk kl km kn gt mx my mz na aw nb bi"><span id="fc28" class="nc lb in my b gy nd ne l nf ng">data-engineering-project-structure<br/>├── pyproject.toml<br/>├── jobs<br/>│   └── save_cleaned_data.py<br/>├── resources<br/>│   ├── inputs<br/>│       └── top_movie_genres.csv<br/>├── scripts<br/>│   ├── run-save-cleaned-data.sh<br/>│   └── run-tests.sh<br/>├── tests<br/>│   └── test_clean_columns.py<br/>└── transformations<br/>    └── clean_data.py</span></pre></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="90ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就这样，伙计们！我希望这个指南能对那些在这个奇妙的数据工程世界中起步的人有用！如果有任何问题，请告诉我，再见！:)</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="2081" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">更多内容请看</em><a class="ae kz" href="http://blog.devgenius.io" rel="noopener ugc nofollow" target="_blank"><em class="ki">blog . dev genius . io</em></a><em class="ki">。</em></p></div></div>    
</body>
</html>