<html>
<head>
<title>A headless Raspberry Pi workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无头 Raspberry Pi 工作流</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-headless-raspberry-pi-workflow-90cd90596854?source=collection_archive---------10-----------------------#2022-01-18">https://blog.devgenius.io/a-headless-raspberry-pi-workflow-90cd90596854?source=collection_archive---------10-----------------------#2022-01-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4d9f09a6f0f22711dc5f99d7ed02ae0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*amGrpR0eygvBJ5ya.jpg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@0leil" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ka">昆汀·舒尔茨</strong>T3</a><a class="ae jz" href="https://unsplash.com/photos/51nYPDEafWc" rel="noopener ugc nofollow" target="_blank">上<strong class="bd ka">Unsplash</strong>T7】</a></figcaption></figure><p id="7c1f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">跟进一个很酷的爱好 IOT 实验总是很棒的，我已经收集了一些 Ardunios、小饰品和树莓 Pis，它们总是在等待一个免费的周末。Raspberry Pi 可以是一台非常多功能的小型计算机，它可以为外部控制器和传感器提供引脚，但它也可以是一台简单的 35 美元的家庭服务器，甚至是一台全功能的 Linux 桌面计算机。</p><p id="dfe3" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我和我的孩子已经建立了我们自己的《我的世界》服务器，我已经做了一个小天气时钟，并试验了服务器部署配置和家庭媒体流。我希望有一天能尝试一些更复杂的项目，包括<a class="ae jz" href="https://ubuntu.com/tutorials/how-to-kubernetes-cluster-on-raspberry-pi#1-overview" rel="noopener ugc nofollow" target="_blank">树莓派 Kubernetes cluster </a>或<a class="ae jz" href="https://www.gratefuldeadtimemachine.com/build-your-own" rel="noopener ugc nofollow" target="_blank">感恩而死时间机器</a>。由于整个操作系统都在一个微型 SD 卡上，所以很容易保存一些并刷新不同的操作系统，将它们交换出来用于不同的项目。事实上，由于我的工作需要学习所有复杂的 AWS 和 Azure，使用 Raspberry Pi 来测试配置一个基本服务器是一种很好的方式，当您通过一个简单的命令将您的工件发送到一些模糊的数据中心时，可以后退一步，了解实际发生了什么。</p><p id="142b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我发现自己一直在寻找和重复的一组步骤是创建一个无头的 Raspberry Pi——只需在 SD 卡上配置一个操作系统并打开它，没有键盘，没有显示器，只有机器。</p><p id="042c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">你当然可以用它的定制操作系统，一个名为 Raspbian 的 Linux Debian 端口来加载一个 Raspberry Pi，把它像台式电脑一样挂起来，然后做上面所有的事情。但对我来说，最方便的方式是在我的本地 WiFi 网络上设置它，并从我做其他事情的工作站连接到它，使用我的个人开发环境和代码编辑器也可以将程序加载到 Raspberry Pi 上。这就是无头、无图形用户界面的树莓派的理想之选。</p><p id="2801" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在本文中，我结合了我经常参考的教程中的步骤，这样每当我从头开始组装一个新的无头 Raspberry Pi 时，我都有一些快速、简单的步骤可以遵循。</p><h1 id="942b" class="kz la in bd ka lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h1><p id="83dc" class="pw-post-body-paragraph kb kc in kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky ig bi translated">对于本文，您唯一需要的是一个覆盆子 Pi，型号并不重要。事实上，这些步骤中的大部分与供应一个简单的 Linux 服务器更相关，因此它们也适用于其他一些硬件。你还需要在台式电脑上安装某种 SD 卡读卡器。</p><h1 id="ebfc" class="kz la in bd ka lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建您的 Raspberry Pi 图像</h1><p id="3884" class="pw-post-body-paragraph kb kc in kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky ig bi translated">第一种快速设置树莓 Pi 操作系统的方法是使用<a class="ae jz" href="https://www.raspberrypi.com/software/" rel="noopener ugc nofollow" target="_blank">树莓 Pi 成像仪</a>。</p><ul class=""><li id="4318" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated"><a class="ae jz" href="https://www.raspberrypi.com/software/" rel="noopener ugc nofollow" target="_blank">下载副本</a></li><li id="b025" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">与此同时，将 SD 卡插入你所有的 SD 卡读卡器。</li><li id="c4ef" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">您可能需要重新格式化 SD 卡，以便全新安装操作系统映像。在 Windows 电脑上，我通过在文件浏览器中的“这台电脑”下找到 SD 卡驱动器，并右键单击它以查看其格式化选项。选择“FAT”作为文件系统类型，其他都是默认选择。请注意，卡上已有的数据将被擦除。</li></ul><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/bf745b40e9c5ed56ec4515234dd5c1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*40GX5DZbIG_oua8n.png"/></div></div></figure><ul class=""><li id="ac21" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">树莓 Pi 成像仪下载完成后，打开它。您可能需要在您的计算机上授予它管理权限。</li><li id="4bca" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">你将有两个选择。选择 OS 和<strong class="kd io"> 2。选择存储</strong>。</li><li id="3351" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">点击“选择操作系统”，选择<code class="fe mu mv mw mx b">Raspberry Pi OS (Other)</code>，然后选择<code class="fe mu mv mw mx b">Raspberry Pi OS Lite (32-bit)</code>。这个版本的操作系统不包括桌面环境，所以只能从终端控制。</li><li id="5039" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">单击“选择存储”，其中一个选项应该是您之前格式化的 SD 卡的驱动器。</li><li id="0a15" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">最后，单击“写入”按钮，成像仪将开始工作，将可启动的操作系统加载到 SD 卡上。在我的机器上，这个过程大约需要 5 分钟。</li></ul><h1 id="15ed" class="kz la in bd ka lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">SSH 和网络配置</h1><p id="7f41" class="pw-post-body-paragraph kb kc in kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky ig bi translated">映像完成后，您可以弹出 SD 卡，用监视器启动 Raspberry Pi，然后看到 Linux 命令行界面。但由于这将是一个无头、无外设的设置，我们需要给操作系统一些额外的信息，使其能够连接到本地 WiFi 网络，并使我们能够从工作站连接到它。</p><p id="d0de" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果 SD 卡驱动器在映像写入后弹出，请将其插回并在文件资源管理器或 Finder 中打开:</p><ul class=""><li id="c4dc" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">在 SD 卡的顶层目录中添加一个名为<code class="fe mu mv mw mx b">ssh</code>的空文件。该文件不应该有扩展名，也不应该包含任何内容。这告诉操作系统在启动时接受 SSH 连接。</li><li id="0210" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">用文本编辑器创建一个名为<code class="fe mu mv mw mx b">wpa_supplicant.conf</code>的文件。您可以在这里添加信息，以便它可以在启动时连接到您的本地 WiFi 网络。粘贴以下文本，替换您自己的 Wifi 名称和密码:</li></ul><pre class="mq mr ms mt gt my mx mz na aw nb bi"><span id="3eae" class="nc la in mx b gy nd ne l nf ng">country=US<br/>ctrl_interface=DIR=/var/run/wpa_supplicat GROUP=netdev<br/>update_config=1<br/><br/>network={<br/>	ssid="&lt;YOUR WIFI NAME&gt;"<br/>	scan_ssid=1<br/>	psk="&lt;YOUR WIFI PASSWORD&gt;"<br/>	key_mgmt=WPA-PSK<br/>}</span></pre><ul class=""><li id="f232" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">同时将该文件保存在 SD 卡的根目录下。</li></ul><h1 id="662f" class="kz la in bd ka lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">首次登录</h1><p id="5607" class="pw-post-body-paragraph kb kc in kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky ig bi translated">你的树莓派操作系统应该可以用了。将卡插入树莓派并打开它。它应该只需要一两分钟启动。一旦完成，在您的工作站计算机上打开一个终端，并使用默认登录建立一个 SSH 连接:</p><pre class="mq mr ms mt gt my mx mz na aw nb bi"><span id="d07f" class="nc la in mx b gy nd ne l nf ng">$ ssh pi@raspberrypi.local</span></pre><p id="e796" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">密码将是<code class="fe mu mv mw mx b">raspberry</code>。如果成功，您将看到 Raspberry Pi 的命令行界面，并准备运行命令。</p><p id="08dd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">终端中的命令集如下所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="ab gu cl nh"><img src="../Images/b5a9604a94abd592d376968fe507e8ef.png" data-original-src="https://miro.medium.com/v2/format:webp/0*RkImKUSurrlUb3_K.png"/></div></figure><p id="bd94" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我做的第一件事是更改主机名。这样，如果我在同一个本地 Wifi 上运行多个 Raspberry Pis，就不会出现混淆。</p><ul class=""><li id="ec97" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">在 Raspberry Pi 终端中，键入<code class="fe mu mv mw mx b">$sudo raspi-config</code>。这将显示配置选项。</li></ul><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/beca11dcd6b281b56ade7c1d3c660a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hBu_j0CYMzJHEKPp.png"/></div></div></figure><ul class=""><li id="091b" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">选择<code class="fe mu mv mw mx b">1 System Options</code></li><li id="9ff8" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">选择<code class="fe mu mv mw mx b">S4 Hostname</code>，系统会提示您更改主机名。现在，当你 SSH 进入机器，它将是<code class="fe mu mv mw mx b">ssh pi@&lt;NEW HOSTNAME&gt;.local</code></li><li id="2149" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">退出配置屏幕，如果你愿意，你可以重新启动。</li></ul><p id="444b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">接下来最起码要修改<code class="fe mu mv mw mx b">pi</code>用户的密码。我喜欢用一个全新的管理员用户替换<code class="fe mu mv mw mx b">pi</code>用户。这些只是普通的 Linux 命令。</p><ul class=""><li id="553a" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">为了安全起见，请更改<code class="fe mu mv mw mx b">pi</code>的密码。键入<code class="fe mu mv mw mx b">$ passwd</code>并按照提示进行操作。</li><li id="ab6b" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">创建一个新用户:<code class="fe mu mv mw mx b">$ sudo add user &lt;USERNAME&gt;</code>。它会提示您输入密码，并询问一些用户配置文件信息。</li><li id="db84" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">然后将新用户添加到<code class="fe mu mv mw mx b">sudo</code>组，以便他们可以运行管理命令:</li></ul><pre class="mq mr ms mt gt my mx mz na aw nb bi"><span id="1be0" class="nc la in mx b gy nd ne l nf ng">$ sudo usermod -aG sudo &lt;USERNAME&gt;</span></pre><ul class=""><li id="44cd" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">您可以切换到您的新用户:<code class="fe mu mv mw mx b">$ su - &lt;USERNAME&gt;</code></li><li id="f53a" class="mb mc in kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">或者，您可以退出并与新用户重新连接:</li></ul><p id="dfa0" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><code class="fe mu mv mw mx b">$ sudo reboot<br/> $ ssh &lt;USERNAME&gt;@&lt;NEW HOSTNAME&gt;.local</code></p><ul class=""><li id="8a6c" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">重新连接后，您可以选择删除默认的<code class="fe mu mv mw mx b">pi</code>用户。</li></ul><pre class="mq mr ms mt gt my mx mz na aw nb bi"><span id="0665" class="nc la in mx b gy nd ne l nf ng">sudo deluser -remove-home pi</span></pre><ul class=""><li id="964a" class="mb mc in kd b ke kf ki kj km md kq me ku mf ky mg mh mi mj bi translated">为了安全地关闭树莓派:</li></ul><pre class="mq mr ms mt gt my mx mz na aw nb bi"><span id="4481" class="nc la in mx b gy nd ne l nf ng">$ sudo shutdown now</span></pre><p id="792e" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在你的 Raspberry Pi 已经设置好了，可以在上面运行，而且至少是最低限度的安全。</p><h1 id="b31c" class="kz la in bd ka lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">直接在 Pi 上编辑代码</h1><p id="5816" class="pw-post-body-paragraph kb kc in kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky ig bi translated">现在，您已经准备好了 Raspberry Pi，您可以让它做一些事情了。您需要添加一些代码来运行。默认情况下，它应该有一个工作的 Python 环境。但是你怎么把代码传给 Pi 呢？您可以启动一个基本的 vim 或 nano 编辑器，但是与您本地工作站上的配件齐全的代码编辑器相比，这可能会有点痛苦。</p><p id="7bcb" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">解决这个问题的一个方法是将您的 Raspberry Pi 代码设置为远程 Git 存储库，在本地存储库中编写文件，然后将它们推过来。我过去经常这样做，这并不太复杂，而且你有一个本地 repo 来存储你所有的代码和项目的优势，当你改变和重新配置多个 Raspberry Pi 设置时，它们会一直存在。<a class="ae jz" href="https://www.jeremywells.io/2022/01/10/headless-rpi.html" rel="noopener ugc nofollow" target="_blank">这篇文章</a>给出了一些关于如何着手建立你自己的远程 Git 仓库的很好的指导。</p><p id="2477" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果您是 VS 代码用户，一个更简单的解决方案是，使用一个新的插件，您可以通过 SSH 访问 Pi 上的目录，并在代码编辑器中直接在 Pi 上编辑文件。</p><p id="3a4a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在 VS 代码中，安装插件<a class="ae jz" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh" rel="noopener ugc nofollow" target="_blank"> Remote — SSH </a>。然后输入<code class="fe mu mv mw mx b">CTRL/CMD + SHIFT + P</code>和<code class="fe mu mv mw mx b">Remote - SSH Connect to Host</code>。它将要求一个 SSH url(完全如上所述)，提示您输入密码，然后一个新的 VS 代码编辑器将打开，可以访问 Raspberry Pi 文件系统。</p><p id="867b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">有了这些，你就有了一个无负担的 Raspberri Pi 来做你所有的家庭修补工作。</p></div></div>    
</body>
</html>