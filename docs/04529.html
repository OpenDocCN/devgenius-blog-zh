<html>
<head>
<title>Create a React Stacked Bar Chart with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Visx库创建一个反应堆积条形图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-a-react-stacked-bar-chart-with-the-visx-library-73daa764c0f5?source=collection_archive---------2-----------------------#2021-03-29">https://blog.devgenius.io/create-a-react-stacked-bar-chart-with-the-visx-library-73daa764c0f5?source=collection_archive---------2-----------------------#2021-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6076a84af43646a9d79ec748033b1f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KT0dGnZl_wwvn7zz"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@fan11?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">法·巴尔沃萨</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2b1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx是一个库，让我们可以轻松地将图形添加到React应用程序中。</p><p id="5429" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将堆积条形图添加到React应用程序中。</p><h1 id="3ecb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/axis @visx/grid @visx/group @visx/legend @visx/mock-data @visx/responsive @visx/scale @visx/shape @visx/tooltip</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="4761" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建图表</h1><p id="04ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加模块提供的项目来创建图表。</p><p id="7bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用来自<code class="fe ms mt mu mj b">@visx/mock-data</code>模块的数据。</p><p id="60c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要添加堆叠条形图，我们编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7f0a" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { BarStack } from "@visx/shape";<br/>import { Group } from "@visx/group";<br/>import { Grid } from "@visx/grid";<br/>import { AxisBottom } from "@visx/axis";<br/>import cityTemperature from "@visx/mock-data/lib/mocks/cityTemperature";<br/>import { scaleBand, scaleLinear, scaleOrdinal } from "@visx/scale";<br/>import { timeParse, timeFormat } from "d3-time-format";<br/>import { useTooltip, useTooltipInPortal, defaultStyles } from "@visx/tooltip";<br/>import { LegendOrdinal } from "@visx/legend";</span><span id="1084" class="mn lc iq mj b gy mv mp l mq mr">const purple1 = "#6c5efb";<br/>const purple2 = "#c998ff";<br/>export const purple3 = "#a44afe";<br/>export const background = "#eaedff";<br/>const defaultMargin = { top: 40, right: 0, bottom: 0, left: 0 };<br/>const tooltipStyles = {<br/>  ...defaultStyles,<br/>  minWidth: 60,<br/>  backgroundColor: "rgba(0,0,0,0.9)",<br/>  color: "white"<br/>};</span><span id="3339" class="mn lc iq mj b gy mv mp l mq mr">const data = cityTemperature.slice(0, 12);<br/>const keys = Object.keys(data[0]).filter((d) =&gt; d !== "date");</span><span id="2b71" class="mn lc iq mj b gy mv mp l mq mr">const temperatureTotals = data.reduce((allTotals, currentDate) =&gt; {<br/>  const totalTemperature = keys.reduce((dailyTotal, k) =&gt; {<br/>    dailyTotal += Number(currentDate[k]);<br/>    return dailyTotal;<br/>  }, 0);<br/>  if (Array.isArray(allTotals)) {<br/>    allTotals.push(totalTemperature);<br/>    return allTotals;<br/>  }<br/>  return [];<br/>});</span><span id="8d5c" class="mn lc iq mj b gy mv mp l mq mr">const parseDate = timeParse("%Y-%m-%d");<br/>const format = timeFormat("%b %d");<br/>const formatDate = (date) =&gt; format(parseDate(date));</span><span id="2369" class="mn lc iq mj b gy mv mp l mq mr">const getDate = (d) =&gt; d.date;</span><span id="4b49" class="mn lc iq mj b gy mv mp l mq mr">const dateScale = scaleBand({<br/>  domain: data.map(getDate),<br/>  padding: 0.2<br/>});<br/>const temperatureScale = scaleLinear({<br/>  domain: [0, Math.max(...temperatureTotals)],<br/>  nice: true<br/>});<br/>const colorScale = scaleOrdinal({<br/>  domain: keys,<br/>  range: [purple1, purple2, purple3]<br/>});</span><span id="b3a2" class="mn lc iq mj b gy mv mp l mq mr">let tooltipTimeout;</span><span id="e609" class="mn lc iq mj b gy mv mp l mq mr">function Example({ width, height, events = false, margin = defaultMargin }) {<br/>  const {<br/>    tooltipOpen,<br/>    tooltipLeft,<br/>    tooltipTop,<br/>    tooltipData,<br/>    hideTooltip,<br/>    showTooltip<br/>  } = useTooltip();</span><span id="0d5c" class="mn lc iq mj b gy mv mp l mq mr">  const { containerRef, TooltipInPortal } = useTooltipInPortal();</span><span id="c206" class="mn lc iq mj b gy mv mp l mq mr">  if (width &lt; 10) return null;<br/>  const xMax = width;<br/>  const yMax = height - margin.top - 100;</span><span id="2f59" class="mn lc iq mj b gy mv mp l mq mr">  dateScale.rangeRound([0, xMax]);<br/>  temperatureScale.range([yMax, 0]);</span><span id="c20a" class="mn lc iq mj b gy mv mp l mq mr">  return width &lt; 10 ? null : (<br/>    &lt;div style={{ position: "relative" }}&gt;<br/>      &lt;svg ref={containerRef} width={width} height={height}&gt;<br/>        &lt;rect<br/>          x={0}<br/>          y={0}<br/>          width={width}<br/>          height={height}<br/>          fill={background}<br/>          rx={14}<br/>        /&gt;<br/>        &lt;Grid<br/>          top={margin.top}<br/>          left={margin.left}<br/>          xScale={dateScale}<br/>          yScale={temperatureScale}<br/>          width={xMax}<br/>          height={yMax}<br/>          stroke="black"<br/>          strokeOpacity={0.1}<br/>          xOffset={dateScale.bandwidth() / 2}<br/>        /&gt;<br/>        &lt;Group top={margin.top}&gt;<br/>          &lt;BarStack<br/>            data={data}<br/>            keys={keys}<br/>            x={getDate}<br/>            xScale={dateScale}<br/>            yScale={temperatureScale}<br/>            color={colorScale}<br/>          &gt;<br/>            {(barStacks) =&gt;<br/>              barStacks.map((barStack) =&gt;<br/>                barStack.bars.map((bar) =&gt; (<br/>                  &lt;rect<br/>                    key={`bar-stack-${barStack.index}-${bar.index}`}<br/>                    x={bar.x}<br/>                    y={bar.y}<br/>                    height={bar.height}<br/>                    width={bar.width}<br/>                    fill={bar.color}<br/>                    onClick={() =&gt; {<br/>                      if (events) alert(`clicked: ${JSON.stringify(bar)}`);<br/>                    }}<br/>                    onMouseLeave={() =&gt; {<br/>                      tooltipTimeout = window.setTimeout(() =&gt; {<br/>                        hideTooltip();<br/>                      }, 300);<br/>                    }}<br/>                    onMouseMove={(event) =&gt; {<br/>                      if (tooltipTimeout) clearTimeout(tooltipTimeout);<br/>                      const top = event.clientY - margin.top - bar.height;<br/>                      const left = bar.x + bar.width / 2;<br/>                      showTooltip({<br/>                        tooltipData: bar,<br/>                        tooltipTop: top,<br/>                        tooltipLeft: left<br/>                      });<br/>                    }}<br/>                  /&gt;<br/>                ))<br/>              )<br/>            }<br/>          &lt;/BarStack&gt;<br/>        &lt;/Group&gt;<br/>        &lt;AxisBottom<br/>          top={yMax + margin.top}<br/>          scale={dateScale}<br/>          tickFormat={formatDate}<br/>          stroke={purple3}<br/>          tickStroke={purple3}<br/>          tickLabelProps={() =&gt; ({<br/>            fill: purple3,<br/>            fontSize: 11,<br/>            textAnchor: "middle"<br/>          })}<br/>        /&gt;<br/>      &lt;/svg&gt;<br/>      &lt;div<br/>        style={{<br/>          position: "absolute",<br/>          top: margin.top / 2 - 10,<br/>          width: "100%",<br/>          display: "flex",<br/>          justifyContent: "center",<br/>          fontSize: "14px"<br/>        }}<br/>      &gt;<br/>        &lt;LegendOrdinal<br/>          scale={colorScale}<br/>          direction="row"<br/>          labelMargin="0 15px 0 0"<br/>        /&gt;<br/>      &lt;/div&gt;</span><span id="4733" class="mn lc iq mj b gy mv mp l mq mr">      {tooltipOpen &amp;&amp; tooltipData &amp;&amp; (<br/>        &lt;TooltipInPortal<br/>          key={Math.random()} // update tooltip bounds each render<br/>          top={tooltipTop}<br/>          left={tooltipLeft}<br/>          style={tooltipStyles}<br/>        &gt;<br/>          &lt;div style={{ color: colorScale(tooltipData.key) }}&gt;<br/>            &lt;strong&gt;{tooltipData.key}&lt;/strong&gt;<br/>          &lt;/div&gt;<br/>          &lt;div&gt;{tooltipData.bar.data[tooltipData.key]}℉&lt;/div&gt;<br/>          &lt;div&gt;<br/>            &lt;small&gt;{formatDate(getDate(tooltipData.bar.data))}&lt;/small&gt;<br/>          &lt;/div&gt;<br/>        &lt;/TooltipInPortal&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="74eb" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ef10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为条形的颜色创建了<code class="fe ms mt mu mj b">purple</code>、<code class="fe ms mt mu mj b">purple2</code>、<code class="fe ms mt mu mj b">purple3</code>变量。</p><p id="0175" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">background</code>是图表的背景色。</p><p id="d7b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">tooltipStyles</code>拥有工具提示的样式。</p><p id="b85d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">条形数据被设置为<code class="fe ms mt mu mj b">data</code>变量的值。</p><p id="e3f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">keys</code>具有x轴刻度的值。</p><p id="bbdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过将每天的温度值相加来计算<code class="fe ms mt mu mj b">temnperatureTotals</code>。</p><p id="d81f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们为x轴刻度创建<code class="fe ms mt mu mj b">dateScale</code>。</p><p id="205a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe ms mt mu mj b">temperature</code>刻度是针对y轴刻度的。</p><p id="b3b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe ms mt mu mj b">temperatureScale</code>的最大值设置为<code class="fe ms mt mu mj b">temperatureTotals</code>的最大值，这是y轴的最高值。</p><p id="dbb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">colorScale</code>有颜色值。</p><p id="2a30" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe ms mt mu mj b">Example</code>组件来保存堆叠条形图。</p><p id="7bd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">useTooltip</code>钩子返回一个具有各种方法和状态的对象，用于创建和设置工具提示值。</p><p id="898d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们计算<code class="fe ms mt mu mj b">xMax</code>和<code class="fe ms mt mu mj b">yMax</code>值，以创建x轴和y轴刻度。</p><p id="87e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们添加<code class="fe ms mt mu mj b">svg</code>元素来将所有的图表部分组合在一起。</p><p id="16f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Grid</code>组件在背景中显示网格。</p><p id="eda6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Group</code>组件有<code class="fe ms mt mu mj b">BarStack</code>组件，该组件有堆叠的条。</p><p id="3b95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">堆叠条由<code class="fe ms mt mu mj b">rect</code>元素创建。</p><p id="efa6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe ms mt mu mj b">onMouseMove</code>处理程序来调用<code class="fe ms mt mu mj b">showTooltip</code>来显示带有条形值的工具提示。</p><p id="9189" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">onMouseLeave</code>处理程序让我们在离开工具条时关闭工具提示。</p><p id="8592" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">AxisBottom</code>组件使用样式和颜色呈现x轴。</p><h1 id="54fe" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2941" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Visx提供的模块将堆积条形图添加到React应用程序中。</p></div></div>    
</body>
</html>