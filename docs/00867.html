<html>
<head>
<title>Data Consistency in a Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务架构中的数据一致性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/data-consistency-in-a-microservice-architecture-e7d21b6ccdd1?source=collection_archive---------13-----------------------#2020-06-18">https://blog.devgenius.io/data-consistency-in-a-microservice-architecture-e7d21b6ccdd1?source=collection_archive---------13-----------------------#2020-06-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9aa4508e1190e971fe47c12c1c85dbbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*96VVHkTDrixvK-Tk"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">马文·迈耶在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3c1f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文涵盖了微服务架构的数据一致性问题，以及如何使用分布式事务处理数据一致性的早期方法之一。</p><p id="37f8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事务在每个应用程序中都是必不可少的，没有事务，就没有任何数据一致性的保证。事务需要是原子的、一致的、隔离的和持久的。<strong class="kc io">单片应用程序中的事务管理</strong>非常简单，因为它们保证具有数据库支持的ACID属性。然而，现代应用程序是可扩展的，并被分成一组称为<strong class="kc io">微服务</strong>的小服务。因此，一个事务可以跨越多个服务。</p><p id="5198" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看一个通过使用微服务架构的在线咖啡店订购咖啡的例子。该应用程序由订单服务(创建订单)、支付服务(负责授权订单的支付)、客户服务(确认客户的详细信息)和厨房服务(处理订单)组成。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/57c04ad1b52c033d3b3e90aeedba9e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7KD4xztCCi44BdXB"/></div></div></figure><p id="2706" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上图显示了订单处理流程的UML图。所有这些操作应该在一个事务中执行。这时我们需要对分布式事务的支持。然而，分布式事务是跨多个服务维护数据一致性的传统方法。分布式事务的主要标准是遵循使用<strong class="kc io">两阶段提交</strong>的<strong class="kc io">扩展架构(XA) </strong>合规性。这种方法的主要缺点是事务<strong class="kc io">期望在事务</strong>期间所有参与方都是可用的。换句话说，如果其中一个服务关闭，事务就会回滚。这可能会使事务变慢，因为在幕后它使事务同步。该协议依赖于全行级锁，导致<strong class="kc io">性能低下</strong>。简而言之，XA从未流行起来。</p><p id="8557" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当构建符合XA规范的系统时，系统应该使用数据库、消息代理、数据库驱动程序，它们都符合XA规范。大多数<strong class="kc io">现代消息代理和NoSQL数据库不支持XA兼容</strong>。因此，为了保持数据一致性，现代应用程序使用<a class="ae jz" href="https://microservices.io/patterns/data/saga.html" rel="noopener ugc nofollow" target="_blank"> Sagas </a>来实现。我会在下一篇<a class="ae jz" href="https://medium.com/dev-genius/solving-data-consistency-using-sagas-80c00b311e45" rel="noopener">帖子</a>中描述传奇故事。</p><p id="c123" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">参考文献</strong></p><p id="3fc4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://blog.yugabyte.com/6-signs-you-might-be-misunderstanding-acid-transactions-in-distributed-databases/" rel="noopener ugc nofollow" target="_blank">https://blog . yugabyte . com/6-signs-you-may-be-missing-acid-transactions-in-distributed-databases/</a></p></div></div>    
</body>
</html>