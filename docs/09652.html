<html>
<head>
<title>Write a simple Telegram Bot in Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Next.js 写一个简单的电报机器人</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/write-a-simple-telegram-bot-in-next-js-b49379e77163?source=collection_archive---------0-----------------------#2022-09-03">https://blog.devgenius.io/write-a-simple-telegram-bot-in-next-js-b49379e77163?source=collection_archive---------0-----------------------#2022-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/00a136f8a94de7feecc8d6d145f57b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tfuz8_q-8P2L0Y0qvMBCSA.jpeg"/></div></div></figure><p id="78b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">机器人是运行在 Telegram 内部的第三方应用程序。用户可以通过向机器人发送信息和命令来与它们互动。您可以通过使用 webhook 和 HTTPS 请求来读取和发送消息来控制您的 Bot-API。</p><h2 id="326f" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">我们将建造什么</h2><p id="6859" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">在本教程中，我们将编写一个基本的，但功能齐全的电报机器人，回复用户的互动。我们将从创建 Bot 本身开始，然后我们将实现 Next.js API 路由，并将它连接到 Telegram API，这样它将侦听用户消息并对它们做出反应。</p><h2 id="5fe9" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">先决条件</h2><p id="ce87" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">要跟进，您需要:</p><ul class=""><li id="9106" class="lu lv iq ka b kb kc kf kg kj lw kn lx kr ly kv lz ma mb mc bi translated">一个电报帐户(需要建立一个机器人并测试它)</li><li id="674d" class="lu lv iq ka b kb md kf me kj mf kn mg kr mh kv lz ma mb mc bi translated">Next.js API 路线的基本知识</li><li id="09a4" class="lu lv iq ka b kb md kf me kj mf kn mg kr mh kv lz ma mb mc bi translated">ngrok 需要一个“真正的”URL 地址，以便在本地开发时连接 Telegram API</li></ul><h1 id="a9bd" class="mi kx iq bd ky mj mk ml lb mm mn mo le mp mq mr lh ms mt mu lk mv mw mx ln my bi translated">创建机器人</h1><p id="2b75" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">首先，我们需要创建自己的 Bot: <br/>使用电报客户端(我在【https://web.telegram.org】T4 使用 web 客户端)，打开与用户的聊天<strong class="ka ir">Bot 父亲:</strong></p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/a6a3773729e24c3643a726428ae7e884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kF52pIllM7RT4BWfBhJGHw.png"/></div></div></figure><p id="787d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发送命令<code class="fe nf ng nh ni b"><strong class="ka ir">/newbot</strong></code>，通过选择名称和用户名开始创建过程(用户名应该是唯一的，因此您可能需要更多尝试):</p><div class="nb nc nd ne gt ab cb"><figure class="nj jr nk nl nm nn no paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/1714aa60b0e1ff5bf13c6a4275dff689.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*D-ZPrzcCgKw3bBTCfd-OwQ.png"/></div></figure><figure class="nj jr np nl nm nn no paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/de7fdcafcc4b96f6f51c398e5e21c09d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*VoCiq6VbHEMg8WhmIoBjfw.png"/></div></figure></div><p id="6dbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦成功，BotFather 将向您发送打开与 bot 聊天的链接和一个令牌，您将使用该令牌与 Telegram API 进行通信(保持该令牌的安全和隐藏)。<br/>此时，您可以选择添加更多信息、个人资料图片等，在我们的示例中，我们添加了描述和关于文本:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/5c3676c480bb78695e4a16449363081f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UpB4LGZE8NOqW6LyTUoFOw.png"/></div></div></figure><p id="c733" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你打开一个与你新创建的机器人的聊天，你会看到类似这样的东西</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/a215c876c608923e82d7de2cdc2e5565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SS-X6PEgbxJxT4fbFDDL6Q.png"/></div></div></figure><h1 id="c821" class="mi kx iq bd ky mj mk ml lb mm mn mo le mp mq mr lh ms mt mu lk mv mw mx ln my bi translated">创建网页挂钩</h1><p id="02e0" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">有几种方法可以让 Telegram 与你的应用程序交互，最基本的是通过一个 Webhook:你创建一个 API 并将它的 URL 连接到 Telegram</p><h2 id="a0c7" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">设置 Next.js 应用程序</h2><p id="7f86" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">使用以下内容创建新的 Next.js 应用程序:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="8efd" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">npx create-next-app telegram-bot</strong></span></pre><p id="e30d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后进入文件夹<code class="fe nf ng nh ni b">telegram-bot</code>并添加文件. env.local，如下所示:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="e5bf" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">NEXT_TELEGRAM_TOKEN=&lt;YOUR_TELEGRAM_TOKEN&gt;</strong></span></pre><p id="2697" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建文件<code class="fe nf ng nh ni b"><strong class="ka ir">/pages/api/tlg.js</strong></code>,并在其中添加以下基本结构:</p><figure class="nb nc nd ne gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="76c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用以下命令启动开发服务器:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="c8a0" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">npm run dev</strong></span></pre><h2 id="dff7" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">运行 ngrok</h2><p id="f0f8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">运行 ngrok 获取一个可以从 Internet 访问的地址，使用:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="3501" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">ngrok http 3000</strong></span></pre><p id="1aed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并记下 HTTPS 的转发地址:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/ed3ebf33da852a0b5dec5fd592630d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmM86iEXD6M0CKghGfxp1Q.png"/></div></div></figure><h2 id="4d0c" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">连接网钩</h2><p id="2302" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">在浏览器中添加以下 URL:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="5fe3" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">https://api.telegram.org/bot&lt;YOUR_TELEGRAM_TOKEN&gt;/setWebhook?url=&lt;YOUR_HTTPS_URL&gt;/api/tlg</strong></span></pre><p id="e991" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并点击<em class="od">回车</em>，您应该会得到一条类似如下的消息:</p><pre class="nb nc nd ne gt ns ni nt nu aw nv bi"><span id="ed79" class="kw kx iq ni b gy nw nx l ny nz"><strong class="ni ir">{</strong>“ok”: <strong class="ni ir">true</strong>,”result”: <strong class="ni ir">true</strong>,”description”: “Webhook was set”<strong class="ni ir">}</strong></span></pre><p id="ea69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着每次用户向您的 bot 发送消息时，该消息都会被转发到该 URL，以便调用您的 API。</p><h2 id="6463" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">测试消息</h2><p id="ae78" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">打开一个与你的机器人聊天并启动它(你将自动发送/start 命令)，然后发送一条消息(例如<em class="od"> hello </em>)并检查你的控制台，你将看到 API 收到这条消息以及其他信息:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/5324ddd3fc0f62cddb91b63f3357bd45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CDkvAcVoE4784VQW3oPzeg.jpeg"/></div></div></figure><h2 id="58f8" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">对命令做出反应</h2><p id="56a8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">要让 API 对命令做出反应(例如回复发送命令的用户),修改<code class="fe nf ng nh ni b"><strong class="ka ir">tlg.js</strong></code>文件如下:</p><figure class="nb nc nd ne gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1eb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，我们使用电报 API 的一个最基本的方法(<em class="od"> sendMessage </em>)，我们简单地用一个静态消息回复一个请求(当然不是很有用)</p><h1 id="d7f2" class="mi kx iq bd ky mj mk ml lb mm mn mo le mp mq mr lh ms mt mu lk mv mw mx ln my bi translated">下一步是什么</h1><p id="1755" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">使用机器人有无限的可能性；例如，你可以监听一个<code class="fe nf ng nh ni b">/subscribe</code>命令，当收到命令时，你可以将用户 id 存储在某个数据库中，然后每当你更新博客时，你可以自动向订阅用户发送通知。或者你可以让你的用户订阅单个主题(可以使用内嵌按钮【https://core.telegram.org/bots/api#inlinekeyboardmarkup】的<a class="ae mz" href="https://core.telegram.org/bots/api#inlinekeyboardmarkup" rel="noopener ugc nofollow" target="_blank">来选择)。你也可以接受付款(</a><a class="ae mz" href="https://core.telegram.org/bots/payments" rel="noopener ugc nofollow" target="_blank">https://core.telegram.org/bots/payments</a>)，创建游戏等等。</p></div></div>    
</body>
</html>