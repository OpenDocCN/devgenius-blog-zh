<html>
<head>
<title>Part #1 : How to read WASM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第一部分:如何阅读WASM</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/part-1-how-to-read-wasm-b29de01d39e7?source=collection_archive---------3-----------------------#2022-01-13">https://blog.devgenius.io/part-1-how-to-read-wasm-b29de01d39e7?source=collection_archive---------3-----------------------#2022-01-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="7767" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">也许还能写出来。</h2></div><p id="6f5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本系列的第一篇帖子中，我们回顾了创建WebAssembly背后的动机，并偷偷看了一眼一个简单的Hello，world程序在WASM会是什么样子。</p><p id="505e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="kz">注:如果你想亲自尝试一下，请前往</em><a class="ae ky" href="https://webassembly.studio/" rel="noopener ugc nofollow" target="_blank"><em class="kz">web assembly . studio</em></a><em class="kz">。在c中创建和构建一个Hello World项目。当您构建该项目时，将会生成一个. wat文件——其中的一个片段在上一篇文章中有所分享。</em></p><p id="7591" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">说实话，生成的<strong class="ke io">。由于熟悉汇编语言，wat文件</strong>(web assembly文本的缩写)对我来说并不可怕。然而，在涉足高级语言之后，我非常清楚地认识到，一门去除了所有舒适抽象的语言可能会令人望而生畏。因此，本系列接下来的两篇文章旨在让读者熟悉WASM的基本表示——二进制&amp;文本格式。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/90f7d398099297e6422dbb251299e78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wU4W3iEqr7etrg1_yfjDuQ.jpeg"/></div></div></figure><h1 id="fa5f" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">为什么有两种格式？</h1><p id="5f17" class="pw-post-body-paragraph kc kd in ke b kf me jo kh ki mf jr kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">让我们后退一步，理解拥有两种不同格式背后的动机。如上所述，生成的WASM码具有二进制和文本格式。它们并不是现存的对人类最友好的语言(当然，除非你熟悉汇编语言)。因此，</p><blockquote class="mj mk ml"><p id="f8f2" class="kc kd kz ke b kf kg jo kh ki kj jr kk mm km kn ko mn kq kr ks mo ku kv kw kx ig bi translated">为了使WebAssembly能够被人阅读和编辑，有一个wasm二进制格式的文本表示。这是一种中间形式，设计用于在文本编辑器、浏览器开发工具等中公开。</p></blockquote><p id="6205" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章旨在介绍。wasm文件简单介绍给感兴趣的人。</p><h1 id="5f3b" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak">模块</strong></h1><p id="3e0a" class="pw-post-body-paragraph kc kd in ke b kf me jo kh ki mf jr kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">听说过<a class="ae ky" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" rel="noopener ugc nofollow" target="_blank">抽象语法树</a>(缩写为AST)？S表达式可以非常宽泛地比喻为AST，因为它们对编程语言语法一无所知，但却是表示相同树形结构数据的一种方式。</p><p id="d2e9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是这有什么关系呢？二进制和文本格式的基本代码单元是模块，它是一个大的s表达式。让我们以一个非常简单的代码为例。比Hello World简单，因为WebAssembly没有返回字符串的<a class="ae ky" href="https://webassembly.github.io/spec/core/syntax/types.html" rel="noopener ugc nofollow" target="_blank">类型</a>、<strong class="ke io">和</strong>。我们在第一篇文章中是如何做到这一点的，这是一个高级的话题，我希望在接下来的两篇文章中讨论。但这意味着目前我们只有<a class="ae ky" href="https://webassembly.github.io/spec/core/syntax/values.html" rel="noopener ugc nofollow" target="_blank">数字类型</a>来编写简单的程序。因此，我们将编写一个简单的程序来返回一个数字，而不是标准的Hello World。</p><p id="553e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> <em class="kz">全面披露后再进行。我这里用过的例子来自网站:</em></strong><a class="ae ky" href="https://blog.ttulka.com/learning-webassembly-2-wasm-binary-format" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="kz">https://blog . TTU lka . com/learning-web assembly-2-wasm-binary-format</em></strong></a><strong class="ke io"><em class="kz">。</em> </strong></p><p id="6cad" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将下面的代码片段复制并粘贴到<a class="ae ky" href="https://webassembly.github.io/wabt/demo/wat2wasm/" rel="noopener ugc nofollow" target="_blank">该web实用程序</a> &amp;上，点击下载。</p><pre class="lb lc ld le gt mp mq mr ms aw mt bi"><span id="2aa0" class="mu ln in mq b gy mv mw l mx my">(module<br/>  (func (export "main") <br/>        (result i32)<br/>    i32.const 42<br/>    return))</span></pre><p id="a5c1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将在您的机器上得到一个. wasm文件，它不是人类可读的，并且充满了Unicode字符。你需要用十六进制浏览器来查看它。因此，我将。wasm文件使用Windows powershell 上的<a class="ae ky" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/format-hex?view=powershell-7.2" rel="noopener ugc nofollow" target="_blank"> format-hex实用程序。</a></p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/9e6e01b944c22a3b095b407b8e53564a.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*kzB7hwVknyZFzK0ic2-ZIg.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">format-hex命令</figcaption></figure><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8677a3d12b25e2099457ec2da111aee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*FdcNmhKneuXLdheKtf9Jkg.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">输出</figcaption></figure><p id="f91e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我知道上面的输出看起来有点奇怪，但是请继续关注我。</p><p id="f105" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你注意到第一行，前四个字节是<strong class="ke io"> 0061 736D。</strong>这对应于WASM二进制幻数。它翻译成<strong class="ke io"> <em class="kz"> \0asm </em> </strong>，并将二进制文件标识为WASM二进制文件。接下来的四个字节代表WASM版本，即<strong class="ke io"> 0100 0000 </strong>。是的，我们还在第1版！</p><p id="df1d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是，除了二进制格式的模块和那些尾随数字到底是什么以外，还有其他东西吗？</p><h1 id="2ee9" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak">第一节</strong></h1><p id="a843" class="pw-post-body-paragraph kc kd in ke b kf me jo kh ki mf jr kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">每个模块都被组织成<a class="ae ky" href="https://webassembly.github.io/spec/core/binary/index.html" rel="noopener ugc nofollow" target="_blank">二进制格式</a>的不同部分。每个部分由以下内容组成:</p><ul class=""><li id="7979" class="nf ng in ke b kf kg ki kj kl nh kp ni kt nj kx nk nl nm nn bi translated">一个字节的节ID</li><li id="87ed" class="nf ng in ke b kf no ki np kl nq kp nr kt ns kx nk nl nm nn bi translated">截面尺寸</li><li id="a1dc" class="nf ng in ke b kf no ki np kl nq kp nr kt ns kx nk nl nm nn bi translated">实际内容</li></ul><p id="728b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据区段的种类，使用以下区段id，</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi nt"><img src="../Images/8dd8368271ecf179ca4ecfecf2da679c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhDABWPmbS5tDBZoXy10CQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">credit:<a class="ae ky" href="https://webassembly.github.io/spec/core/binary/modules.html#sections" rel="noopener ugc nofollow" target="_blank">https://web assembly . github . io/spec/core/binary/modules . html # sections</a></figcaption></figure><p id="5913" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了更好地理解上述内容，让我们回到我们的例子。</p><p id="0148" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在第一行，我们看到除了幻数和版本之外的许多字节。亲爱的读者，这是一节的<em class="kz">开头</em>。第一个字节给出了ID，<strong class="ke io"> 01 </strong>，并将其标识为类型部分。下一个字节给出了前面提到的大小。在我们的例子中，大小是<strong class="ke io"> 05 </strong>对应于另外五个字节，在此之后，该部分结束。现在剩下的五个字节定义了函数中定义了多少类型的变量，我们的代码有多少个函数，它以什么作为参数，以及它返回什么。标准编程的东西，但在二进制格式。顺序详述如下。</p><pre class="lb lc ld le gt mp mq mr ms aw mt bi"><span id="1f91" class="mu ln in mq b gy mv mw l mx my"><strong class="mq io">Number of types of variables</strong><br/>Byte 0A: 01</span><span id="8545" class="mu ln in mq b gy nu mw l mx my"><strong class="mq io">Function Type</strong><br/>Byte 0B: 60</span><span id="39df" class="mu ln in mq b gy nu mw l mx my"><strong class="mq io">Number of input parameters</strong><br/>Byte 0C: 00</span><span id="f548" class="mu ln in mq b gy nu mw l mx my"><strong class="mq io">Number of output parameters</strong><br/>Byte 0D: 01</span><span id="1126" class="mu ln in mq b gy nu mw l mx my"><strong class="mq io">Result type(i32)<br/></strong>Byte 0E: 7F</span></pre><p id="b454" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的类型部分解码成一个<a class="ae ky" href="https://webassembly.github.io/spec/core/binary/types.html" rel="noopener ugc nofollow" target="_blank">函数类型的向量</a>，它本质上将参数向量映射到结果向量。形象就是它的本质。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e6d85371d009159cfae8d60236e74064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*0mBMLJCZxlBgML3XK-RHeA.png"/></div></figure><p id="5f8a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们看接下来的几个字节，它表示ID为<strong class="ke io"> 3 </strong>的新段的开始。根据上表，这是“函数”部分，其大小为两个字节。</p><pre class="lb lc ld le gt mp mq mr ms aw mt bi"><span id="5ce5" class="mu ln in mq b gy mv mw l mx my"><strong class="mq io">Beginning of "function" section (section ID: 3)</strong><br/>0F: 03<br/><br/><strong class="mq io">Section size</strong><br/>10: 02<br/><br/><strong class="mq io">Number of functions</strong><br/>11: 01 <br/><br/><strong class="mq io">Index of the function</strong><br/>12: 00</span></pre><p id="d665" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更多部分的细节已经在这个博客中简洁地描述过了，我想我不能再补充了。然而，我想给你留下一张博客上发布的伪代码的图片，看看我们简单的代码能翻译成什么。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi nw"><img src="../Images/0f70ddd1099e4a1db488bf60ca5a98e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CE2RSGQXORA-qzAWfreibA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">学分:<a class="ae ky" href="https://blog.ttulka.com/learning-webassembly-2-wasm-binary-format" rel="noopener ugc nofollow" target="_blank">https://blog . ttulka . com/learning-web assembly-2-wasm-binary-format</a></figcaption></figure><p id="f61c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是这篇文章的全部内容。希望这能让你对WebAssembly的二进制格式有一个简单的了解，而不会吓得你不知所措。在本系列的下一期，我们将研究WebAssembly的文本格式。</p><p id="002e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要了解我最新的科技恶作剧，请关注我的推特<a class="ae ky" href="https://twitter.com/Divya_Mohan02" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="kz"/></strong></a><strong class="ke io"><em class="kz"/></strong><em class="kz">和</em><a class="ae ky" href="https://www.linkedin.com/in/divya-mohan0209/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="kz">LinkedIn</em></strong></a><em class="kz">。我还写每周简讯，</em><strong class="ke io"><em class="kz"/></strong><a class="ae ky" href="https://www.getrevue.co/profile/divyamohan" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="kz">周五四</em> </strong> </a> <em class="kz">，在那里我把科技世界里发生的所有有趣的事情都作为一个亮点滔滔不绝地报道出来。如果你觉得这是你的拿手好戏，请考虑订阅</em></p></div></div>    
</body>
</html>