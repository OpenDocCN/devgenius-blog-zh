<html>
<head>
<title>Understanding Tensor Data Structure with Keras and TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Keras 和 TensorFlow 理解张量数据结构</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/understanding-tensors-for-image-classification-with-keras-and-tensorflow-c9710e22cbf?source=collection_archive---------3-----------------------#2021-12-01">https://blog.devgenius.io/understanding-tensors-for-image-classification-with-keras-and-tensorflow-c9710e22cbf?source=collection_archive---------3-----------------------#2021-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8ca7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模型 API 的数据预处理</p><p id="b627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对每个数据科学项目使用正确的数据结构是最基本的。在大多数简单的项目中，我们可以使用表格数据，有时如果我们足够幸运的话，表格数据将很容易清理，并且很容易处理丢失的值，我们的项目准备好了，因为我们导入了漂亮和干净的。csv 文件。</p><p id="a785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这不适用于使用 TensorFlow 和 Keras 的图像分类任务。顾名思义，Keras 和 TensorFlow 使用的数据结构是张量。</p><p id="766d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是张量到底是什么呢？</p><p id="852c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">张量数据结构是在内存中存储多维异构对象的一种简单而有效的方法。你可以把它想象成容器。一个张量可以用一个<strong class="jp ir">秩- </strong>和<strong class="jp ir">形- </strong>对来表示，其中秩表示张量拥有的维数，形表示每个维中元素的个数。等级和形状对存储在二维数组中。</p><p id="761d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在 Python 中操作张量，我们使用了<strong class="jp ir"> NumPy </strong>库。张量是多维 NumPy <strong class="jp ir">数组</strong>。</p><p id="8f56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一些例子:</p><p id="9d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标量或秩为 0 的张量:</strong></p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="552b" class="ku kv iq kq b gy kw kx l ky kz">x = np.array(34)<br/>x</span><span id="74a8" class="ku kv iq kq b gy la kx l ky kz">[OUT] array(34)</span></pre><p id="82bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们不确定我们可以检查维度的数量:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="2185" class="ku kv iq kq b gy kw kx l ky kz">x.ndim</span><span id="c0c0" class="ku kv iq kq b gy la kx l ky kz">[OUT] 0</span></pre><p id="2dea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">向量或秩 1 张量:</strong></p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="b1db" class="ku kv iq kq b gy kw kx l ky kz">y = np.array([34, 4, 7, 21, 8])<br/>y</span><span id="82b8" class="ku kv iq kq b gy la kx l ky kz">[OUT] array([34, 4, 7, 21, 8])</span><span id="6f78" class="ku kv iq kq b gy la kx l ky kz">y.ndim</span><span id="5dfb" class="ku kv iq kq b gy la kx l ky kz">[OUT] 1</span></pre><p id="1b83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">矩阵或秩为 2 的张量:</strong></p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="b3f5" class="ku kv iq kq b gy kw kx l ky kz">z = np.array([[5, 78, 2, 34, 0],<br/>              [6, 79, 3, 35, 1],<br/>              [7, 80, 4, 36, 2]])<br/>z</span><span id="1a9d" class="ku kv iq kq b gy la kx l ky kz">[OUT] array([[ 5, 78,  2, 34,  0],  <br/>             [ 6, 79,  3, 35,  1],      <br/>             [ 7, 80,  4, 36,  2]])</span><span id="d560" class="ku kv iq kq b gy la kx l ky kz">z.ndim</span><span id="808f" class="ku kv iq kq b gy la kx l ky kz">[OUT] 2</span></pre><p id="7243" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">立方或三阶张量:</strong></p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="aa3a" class="ku kv iq kq b gy kw kx l ky kz">w = np.array([[[5, 78, 2, 34, 0],<br/>               [6, 79, 3, 35, 1],<br/>               [7, 80, 4, 36, 2]],<br/>              [[5, 78, 2, 34, 0],<br/>               [6, 79, 3, 35, 1],<br/>               [7, 80, 4, 36, 2]],<br/>              [[5, 78, 2, 34, 0],<br/>               [6, 79, 3, 35, 1],<br/>               [7, 80, 4, 36, 2]]])<br/>w</span><span id="cfa1" class="ku kv iq kq b gy la kx l ky kz">[OUT] array([[[ 5, 78,  2, 34,  0],    <br/>              [ 6, 79,  3, 35,  1],      <br/>              [ 7, 80,  4, 36,  2]],    </span><span id="bfbe" class="ku kv iq kq b gy la kx l ky kz">             [[ 5, 78,  2, 34,  0],       <br/>              [ 6, 79,  3, 35,  1],     <br/>              [ 7, 80,  4, 36,  2]],        </span><span id="d814" class="ku kv iq kq b gy la kx l ky kz">             [[ 5, 78,  2, 34,  0],      <br/>              [ 6, 79,  3, 35,  1],    <br/>              [ 7, 80,  4, 36,  2]]])</span><span id="49cf" class="ku kv iq kq b gy la kx l ky kz">w.ndim</span><span id="eafb" class="ku kv iq kq b gy la kx l ky kz">[OUT] 3</span></pre><p id="d963" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以继续讨论 4 阶和 5 阶张量。把一个秩为 4 的张量想象成一个立方体的向量，把秩为 5 的张量想象成立方体的矩阵。</p><p id="945e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用这种秩格式表示的数据的例子包括标量(对于秩-0)、数字阵列(对于秩-1)、表格数据库(对于秩-2)，如果我们有也是表格的时间序列数据，则可以使用秩-3 张量。对于图像，我们有 4 级张量，对于视频，我们有 5 级张量。</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lb"><img src="../Images/842f6bd0af264f1892cb98be33d84f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkPJilRKyYZM77GJR835CQ.jpeg"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">图像(或者我应该称之为艺术品？)来自作者</figcaption></figure><p id="6695" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">秩为 4 的张量</strong></p><p id="33c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">秩为 4 的张量是我们将在 Keras 和 TensorFlow 的数据集中使用的张量。通常图像是秩为 3 的张量，在那里他存储了(宽度，高度，颜色 _ 深度)的数据。然而，在图像分类项目中，我们不是只处理一幅图像，而是处理一批图像(图像的数据集)。这一批的大小将是我们的第 4 个元素，这将使秩 4 张量。这样，如果我们有一个具有 1000 个图像的样本，大小为 255x255 的 RGB 格式，我们将有以下张量(样本，高度，宽度，颜色深度)= (1000，255，255，3)。</p><p id="59cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">将数据集作为秩 4 张量导入</strong></p><p id="9619" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Keras 拥有自己的图像数据预处理功能，允许我们以一种准备好“进入”模型的格式导入数据:<code class="fe ln lo lp kq b">image_dataset_from_directory</code>。我们可以看到这个函数的运行，但是首先我们需要导入一些库:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="007e" class="ku kv iq kq b gy kw kx l ky kz">import tensorflow as tf<br/>from tensorflow import keras<br/>from tensorflow.keras.preprocessing import image_dataset_from_directory</span></pre><p id="d650" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们将 Google Colab 连接到 Google Drive。我将使用先前从<a class="ae lq" href="https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载的 x 光数据集。</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/d35f4c2d677792b06fc3bf0ca34bb31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*Uc5lOjFM-vTPpxZ9qddoaQ.png"/></div></figure><p id="986b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后是函数:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="e66f" class="ku kv iq kq b gy kw kx l ky kz">my_train = tf.keras.preprocessing.image_dataset_from_directory(<br/>       directory="/content/drive/MyDrive/chest_xray/train",<br/>       labels="inferred",<br/>       label_mode="int",<br/>       class_names=None,<br/>       color_mode="rgb",<br/>       batch_size=32, <br/>       image_size=(256, 256),<br/>       shuffle=True,<br/>       seed=None, <br/>       validation_split=None,<br/>       subset=None,<br/>       interpolation="bilinear",<br/>       follow_links=False,<br/>       crop_to_aspect_ratio=False,<br/>       #**kwargs<br/>)</span></pre><p id="0b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们研究一下这个函数中的参数:</p><p id="a3c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.在<strong class="jp ir">目录</strong>参数中，您必须包含文件的路径。如果你正在使用 Google Colab，你可以简单地右击位于你的目录右边的三个点，选择“复制路径”,然后在你的目录参数中跳过它。</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/8566300fd1bbb18a13a3c5da47628ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*tzeQdOz_DB2rcA8N_i7TNw.png"/></div></figure><p id="0281" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.使用<strong class="jp ir"> labels= "推断"</strong>，如果我们的文件夹中有子目录，该功能将自动根据文件夹依次用 0、1、2 标记图像。我们也可以将它设置为<strong class="jp ir">“None”</strong>，这样就不会给我们的图像添加标签，或者我们可以将标签定义为一个整数列表，按照字母数字顺序分配给文件夹。</p><p id="b722" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.参数<strong class="jp ir"> label_mode </strong>只能取两个值<strong class="jp ir">“int”</strong>或<strong class="jp ir">“binary”</strong>。如果我们有两个以上类别的分类数据，我们应该将它设置为“int”。如果我们只有两个类别(二进制类)，那么我们设置“二进制”。如果设置了“二进制”,我们的标签将只有 0 和 1。</p><p id="6366" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.使用<strong class="jp ir"> class_names </strong>我们可以将标签<strong class="jp ir"> </strong>分配给我们的图片，它们是字符串而不是整数。注意，如果我们使用这个选项，<strong class="jp ir">标签</strong>参数应该被设置为<strong class="jp ir">【推断】</strong>并且类名应该与文件夹名相匹配。</p><p id="8fc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.<strong class="jp ir"> color_mode </strong>参数可以取三个选项中的一个:<strong class="jp ir">【灰度】</strong><strong class="jp ir">【RGB】</strong>或<strong class="jp ir">【rgba】</strong>。通常，彩色图像是“rgb”。</p><p id="ecf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.参数<strong class="jp ir"> batch_size </strong>指的是在一次迭代中使用的训练图像的数量。默认批量为<strong class="jp ir"> 32 </strong>，但也可以定义为<strong class="jp ir"> 64 </strong>、<strong class="jp ir"> 128 </strong>或更高。请记住，较高的批量，虽然增加了模型的速度，导致较低的渐近测试精度。</p><p id="3011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.在<strong class="jp ir"> image_size </strong>参数中，顾名思义，必须声明图片的大小。通常默认为<strong class="jp ir"> (256，256) </strong>。</p><p id="52a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.参数<strong class="jp ir"> shuffle </strong>应设置为<strong class="jp ir"> True </strong>，否则图像将按字母数字顺序排序。</p><p id="5e3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.使用<strong class="jp ir">种子</strong>，您可以定义一个先前的<strong class="jp ir"> </strong>估计起点，如果您从先前的模型中知道它的话。参数应该采用<em class="lt"> int </em>格式。</p><p id="2f3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">10.如果要在训练和验证数据集中拆分数据，可以使用<strong class="jp ir"> validation_split </strong>参数。您可以定义一个介于 0 和 1 之间的浮点数。通常是训练数据的 20%，这意味着<strong class="jp ir"> validation_split = 0.2 </strong></p><p id="6892" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">11.如果您设置了之前的参数，现在在<strong class="jp ir">子集</strong>中您必须选择<strong class="jp ir">训练</strong>或<strong class="jp ir">验证</strong>。如果之前的参数也是“无”，则应设置为“<strong class="jp ir">无</strong>”。</p><p id="6b45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">12.使用<strong class="jp ir">插值</strong>选择调整图像大小时使用的方法。默认的方法是“<strong class="jp ir">双线性</strong>”。</p><p id="153b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">13.参数<strong class="jp ir"> follow_links </strong>可用于通过<strong class="jp ir"> </strong>符号链接访问的<strong class="jp ir"> </strong>子目录。默认值为<strong class="jp ir">假</strong>。</p><p id="d7ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">14.一旦我们需要我们的图像符合模型接受的格式，最后一个参数<strong class="jp ir"> crop_to_aspect_ratio </strong>通常被定义为<strong class="jp ir"> False </strong>。如果我们从头开始构建一个模型，我们可以使用不同的格式，因此可以接受不同格式的图像，而不仅仅是正方形。</p><p id="cd68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以看到我们的数据被成功加载到变量<strong class="jp ir"> my_train </strong>中。</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lu"><img src="../Images/7dd963157c8658b9a375c0d25a077c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9sjDPiwUcp1hMjG9z8bng.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">张量 my_train。</figcaption></figure><p id="189e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们对验证数据集进行同样的操作:</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lv"><img src="../Images/90453a5673156238b2bf6ecdee6e0711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YZ0Gt9ghj13n6hNlb6hmw.png"/></div></div></figure><p id="967b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们已经准备好构建、编译和拟合模型(我将使用预先训练的例外):</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lw"><img src="../Images/919f9e90dc5d7664e3fb2a40a1897904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0IFcRNXzuuzxTXvMJcFfw.png"/></div></div></figure><p id="df88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，我希望这个小教程已经帮助你理解了什么是张量，以及如何在 Keras 的图像分类任务中使用它们。您可以在<a class="ae lq" href="https://keras.io/about/" rel="noopener ugc nofollow" target="_blank"> Keras 文档</a>中找到导入数据的函数，并了解关于其参数的更多信息。</p><p id="1861" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如果:</strong>你喜欢这篇文章，别忘了关注我，这样你就能收到关于新出版物的所有更新。</p><p id="5589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">其他如果:</strong>想了解更多，可以用<a class="ae lq" href="https://cdanielaam.medium.com/membership" rel="noopener">我的推荐链接</a>订阅 Medium 会员。它不会花你更多的钱，但会给我一杯咖啡。</p><p id="ee44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">其他:</strong>谢谢！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="fea4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">更多内容尽在</em><a class="ae lq" href="http://blog.devgenius.io" rel="noopener ugc nofollow" target="_blank"><em class="lt">blog . dev genius . io</em></a><em class="lt">。</em></p></div></div>    
</body>
</html>