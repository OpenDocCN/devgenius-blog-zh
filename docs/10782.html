<html>
<head>
<title>Working With Dates and Timestamps In PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 PostgreSQL 中使用日期和时间戳</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/working-with-dates-and-timestamps-in-postgresql-e9a4d489ea2?source=collection_archive---------12-----------------------#2022-11-28">https://blog.devgenius.io/working-with-dates-and-timestamps-in-postgresql-e9a4d489ea2?source=collection_archive---------12-----------------------#2022-11-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="7d2d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如何操作数据分析的日期和时间戳</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff4e2bb196093622da704373cfbf674d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtJeCka-IbI3z1HfoX8scg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·切瑟的照片</figcaption></figure><p id="7044" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">来自不同来源的数据通常具有不同的日期和时间戳格式。我们经常格式化日期和时间，以实现数据分析项目的目标。</p><p id="3328" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇博文中，我讨论了操纵日期和时间进行分析的各种方法。</p><p id="5191" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">时区转换</strong></p><p id="032d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">PostgreSQL 数据库有一个默认时区设置，即操作系统的时区。</p><p id="a152" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SQL 查询确认了本地 PostgreSQL 引擎的时区设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/317580912a8df5af169bf9924b88115e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RGOMh7v548ifWiseZvqiTg.png"/></div></div></figure><p id="ea72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于与不同时区的团队一起工作的数据分析师，建议将您正在使用的数据库的默认时区更改为协调世界时(UTC)。</p><p id="b73c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SQL 查询将时区转换为 UTC 时区:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/2789e91d3f1825356da8071c5810d2bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYiGMXCS3rvPf9vKrMuqiw.png"/></div></div></figure><p id="7a6d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要确认您已成功将时区更改为 UTC 时区，请执行以下操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi la"><img src="../Images/b67a429b3a1102db9a73e5df06d82f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lt2YITADXB-Odw2o6RxKKg.png"/></div></div></figure><p id="3448" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可以使用 AT TIME ZONE 命令在 SELECT 语句中将列更改为指定的时区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lb"><img src="../Images/7ff7c9cba59ce8d876faf34ad6b1d615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuzgGd6CLx1YOHE5MbYahQ.png"/></div></div></figure><p id="dfdb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以参考<a class="ae ky" href="https://www.postgresql.org/docs/7.2/timezones.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>文档，了解可识别的时区及其代码。</p><p id="2d46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">系统时间</strong></p><p id="a2da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在分析过程中生成当前日期和时间是很常见的。生成当前日期和时间的 SELECT 语句:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lc"><img src="../Images/59e0361d7461af6687ec2f2004801974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XsY3y0Uh5H0KwhgCF4K8A.png"/></div></div></figure><p id="c14d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用 CURRENT_DATE()函数来计算未结贷方余额的总天数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ld"><img src="../Images/cb981d1d49d9a9cddb091ec43b22eb05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZQ6A73Si6zaPvRn14ZpCCw.png"/></div></div></figure><p id="4de1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">日期 _TRUNC 函数</strong></p><p id="da69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">函数的作用是降低时间戳的粒度。数据粒度衡量数据结构的详细程度。在时序分析中，粒度可以是年、季度、月、周、天或小时。</p><p id="f4cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的 SELECT 语句中，DATE_TRUNC 函数将每个日期的精度降低到一个月，这样我们就可以很容易地计算出一个月的租赁总数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi le"><img src="../Images/6db32f919ff2cdf9901bd1ea4ffbe1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5VO3cPHqa8fLTgFuIaAcEA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lf"><img src="../Images/923fe7b7143f51c4499c38a7bb9539d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXWe_67TNOxwqRZUytxq4w.png"/></div></div></figure><p id="d7f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的 SELECT 语句中，DATE_TRUNC 函数将每个日期的精度降低到一年，这样我们就可以很容易地计算出每年记录的总销售额。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lg"><img src="../Images/51bb5e04952d4e29c1e25958fcdbad92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nV8En9TdfLi3322vpuubNQ.png"/></div></div></figure><p id="ad7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">日期 _ 零件功能</strong></p><p id="a0da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">函数的作用是:从日期或时间值中提取一个子字段。DATE_TRUNC 返回日期或时间戳，而 DATE_PART 返回日期或时间戳的子字段。</p><p id="8c62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SELECT 语句从租赁表的 date_renting 列中提取月份。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lh"><img src="../Images/b45be33af7075a26dbfb781709c479ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vwJUAzKrJLnBogGF3QXPxg.png"/></div></div></figure><p id="32d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SELECT 语句提取每个 date_renting 所在的季度，并合计每个季度的租赁总数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi li"><img src="../Images/7198a45de826f49cf8b951688ab3c11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5YFmHkXIRzOZH1P2TuK1w.png"/></div></div></figure><p id="0482" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> TO_CHAR 函数</strong></p><p id="c7f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TO_CHAR()函数将时间戳、时间间隔、整数、双精度或数值转换为字符串。<br/>就像 DATE_PART 一样，它提取时间戳的一部分，但作为一个字符串。</p><p id="c919" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">SELECT 语句从 date_renting 列中提取月份作为字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lj"><img src="../Images/374b99ebc8825c5ef02a4b6e6927cf3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vk6gWqebdys0vFCTKHIxLQ.png"/></div></div></figure><p id="91e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">SELECT 语句从 date_renting 列中以字符串形式提取日期。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi li"><img src="../Images/271661415ca5c1fecee9c1ebea162a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0WLOjfHCuy8GEg6vQUsvg.png"/></div></div></figure><p id="9f21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TO_CHAR 函数在报表中非常有用。根据函数中第二个参数的指定格式，可以将日期格式化为更容易显示的格式。</p><p id="61ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SELECT 语句将日期转换为字符串格式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lk"><img src="../Images/a3448d84c31b3a6a2090d4b5dc982088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXZjvF3RXHheI_KMY31oSg.png"/></div></div></figure><p id="6c04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ky" href="https://www.postgresql.org/docs/current/functions-formatting.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>文档提供了一个日期格式列表。</p><p id="b6e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">制作日期和截止日期功能</strong></p><p id="ec3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">MAKE_DATE 和 TO_DATE 函数从单独的年、月和日列中创建日期。</p><p id="cd54" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的 SELECT 语句创建日期列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lf"><img src="../Images/0b16f9129e528021a5e937d2826fa1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U99KGMxqv7EmbTkkErgSPg.png"/></div></div></figure><p id="1688" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">日期和时间运算</strong></p><p id="672a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在分析中，可能需要知道两天之间的时间间隔，或者通过添加时间间隔来计算未来的日期。SQL 日期和时间戳数据类型允许这样的计算。</p><p id="2aa8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的 SELECT 语句中，从 date_created 中减去 date_completed 以创建一个新列 time_interval。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ll"><img src="../Images/8399c3258450f4dbe5750402268385aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7EoYTxKb4Q-iO0iektm9w.png"/></div></div></figure><p id="0c1d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的 SELECT 语句中，我们使用购买日期来计算付款日期，使用一个月或三十天的贸易信用。<br/>请注意，关键字 INTERVAL 必须在您想要添加的时间范围之前。时间范围也应该是一个字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lm"><img src="../Images/6970db4a6f666caab6211f1f29ed5dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTeOZ8UlEhqbfXXCmHIWHA.png"/></div></div></figure><p id="57fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><p id="716c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博文解释了在数据分析过程中，出于不同的目的，可以操纵日期和时间戳的各种方式</p><p id="f447" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以从我的<a class="ae ky" href="https://github.com/amos-adewuni/working_with_dates_postgresql" rel="noopener ugc nofollow" target="_blank"> GitHub </a>资源库下载数据集和 SQL 脚本供您练习。</p><p id="e696" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">关注我的<a class="ae ky" href="https://twitter.com/acube_yinka" rel="noopener ugc nofollow" target="_blank"> Twitter </a>以获取更多数据相关信息。</p></div></div>    
</body>
</html>