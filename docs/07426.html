<html>
<head>
<title>Laravel, ReactJs, Soketi triumvirates: Step by step guide to building a real-time WebApp — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel，ReactJs，Soketi triumvirates:构建实时 WebApp 的逐步指南—第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-reactjs-soketi-triumvirates-step-by-step-guide-to-build-a-real-time-webapp-part-1-21fd0c5f01cf?source=collection_archive---------5-----------------------#2022-03-24">https://blog.devgenius.io/laravel-reactjs-soketi-triumvirates-step-by-step-guide-to-build-a-real-time-webapp-part-1-21fd0c5f01cf?source=collection_archive---------5-----------------------#2022-03-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9908" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">设置您的环境</h2></div><p id="645c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">WebSocket 是客户端和服务器之间进行全双工通信的协议。Soketi 是一个很棒的 socket 服务器实现，我们可以在 Laravel 第 9 版的官方文档中找到它。使用这些工具，您可以构建实时 web 应用程序。Laravel 提供广播不同事件的解决方案。本系列是关于如何使用 ReactJS 和 Soketi 制作一个简单的聊天 web 应用程序。在这一章中，我们将关注如何安装需求和设置环境。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/53f0536e7e6ca75c0dea8f9385e7b4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vctj1NqTlevzDVSs0GLszw.jpeg"/></div></div></figure><h1 id="43b5" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">这个想法</h1><p id="c2de" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">我们将构建一个简单的聊天应用程序，登录用户可以在其中相互发送消息。为了环保，我们将重新使用一个旧的项目，其中包括:</p><ul class=""><li id="622f" class="mi mj in ke b kf kg ki kj kl mk kp ml kt mm kx mn mo mp mq bi translated">带有 ReactJS 预置的 Laravel 项目</li><li id="5814" class="mi mj in ke b kf mr ki ms kl mt kp mu kt mv kx mn mo mp mq bi translated">证明</li><li id="f493" class="mi mj in ke b kf mr ki ms kl mt kp mu kt mv kx mn mo mp mq bi translated">登录页面</li></ul><p id="515d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是成为零浪费的一小步:)(或者我们只是懒)</p><h1 id="a8a2" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">设置项目</h1><p id="8390" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">如果你正在使用 docker(如果你没有，你应该这样做)，你可以使用 Sail 启动这个项目:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="878d" class="nb ll in mx b gy nc nd l ne nf">docker run --rm \<br/>-u "$(id -u):$(id -g)" \<br/>-v $(pwd):/opt \<br/>-w /opt \<br/>laravelsail/php80-composer:latest \<br/>composer install --ignore-platform-reqs</span></pre><h2 id="e43a" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">缺少服务要求</h2><p id="0a9c" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">注意，最初的项目没有默认的 Redis 服务，但是在后面的部分我们会需要它。不要担心，您可以很容易地将它添加到项目中。当你向上航行后，你应该进入壳牌:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="db9b" class="nb ll in mx b gy nc nd l ne nf">./vendor/bin/sail shell</span></pre><p id="d0d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nr">补充说明:当我们在 cli 中运行命令时，哪些命令取决于项目的环境(artisan 等…)我们总是假设在将来我们会进入 shell。</em></p><p id="b341" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，您可以运行以下命令</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="bdac" class="nb ll in mx b gy nc nd l ne nf">php artisan sail:install</span></pre><p id="d93a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令会给你列出一些安装选项，我们应该选择 mysql 和 redis:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="468c" class="nb ll in mx b gy nc nd l ne nf">/var/www/html$ php artisan sail:install</span><span id="29c8" class="nb ll in mx b gy ns nd l ne nf">Which services would you like to install? [mysql]:<br/>[0] mysql<br/>[1] pgsql<br/>[2] mariadb<br/>[3] redis<br/>[4] memcached<br/>[5] meilisearch<br/>[6] minio<br/>[7] mailhog<br/>[8] selenium<br/>&gt; 0,3</span></pre><p id="ef07" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如您所见，我们可以通过在选项编号之间添加“，”来安装多个服务。</p><p id="2cbe" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们应该停止并移除卷，然后再次启动 docker:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="3fb0" class="nb ll in mx b gy nc nd l ne nf">./vendor/bin/sail down -v &amp;&amp; ./vendor/bin/sail up</span></pre><h1 id="05fa" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">安装需求</h1><h2 id="4b61" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">索凯蒂</h2><p id="36eb" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">Soketi 是一个基于 Pusher 协议 v7 的 WebSocket 服务器。这个工具将帮助我们在客户端和服务器端之间传递消息。</p><p id="a737" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有多种方法来安装 Soketi -你可以在他们的文档中阅读更多的-但是我们将使用 Laravel Sail 来安装。在 docker-compose.yml 中，您应该添加下面一行</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="6798" class="nb ll in mx b gy nc nd l ne nf"># For more information: <a class="ae mh" href="https://laravel.com/docs/sail" rel="noopener ugc nofollow" target="_blank">https://laravel.com/docs/sail</a><br/>services:<br/>    # REST ...</span><span id="9c90" class="nb ll in mx b gy ns nd l ne nf">    soketi:<br/>        image: 'quay.io/soketi/soketi:latest-16-alpine'<br/>        environment:<br/>            DEBUG: '1'<br/>            METRICS_SERVER_PORT: '9601'<br/>        ports:<br/>            - '${SOKETI_PORT:-6001}:6001'<br/>            - '${SOKETI_METRICS_SERVER_PORT:-9601}:9601'<br/>        networks:<br/>            - sail</span></pre><p id="1e7c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为我们使用 Soketi 作为 pusher 的替代品，所以我们应该在项目中配置 Pusher 的变量。环境:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="21dd" class="nb ll in mx b gy nc nd l ne nf">PUSHER_HOST=soketi<br/>PUSHER_APP_ID=app-id<br/>PUSHER_APP_KEY=app-key<br/>PUSHER_APP_SECRET=app-secret<br/>PUSHER_APP_CLUSTER=mt1<br/>PUSHER_PORT=6001<br/><br/>MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"<br/>MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"<br/>MIX_PUSHER_HOST="localhost"<br/>MIX_PUSHER_PORT="${PUSHER_PORT}"</span></pre><p id="b6b5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">重启 sail 后，您的 Soketi 就可以使用了，您可以访问以下页面进行检查:<a class="ae mh" href="http://127.0.0.1:6001" rel="noopener ugc nofollow" target="_blank"> 127.0.0.1:6001 </a></p><p id="2b34" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，你在浏览器上只能看到一个“OK”消息，UI 非常简单，但是在终端上你可以看到更多信息:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nt"><img src="../Images/0bc1f37b50c99683fe8dc30fd266ac17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PnIFSpwTFN9CkkGNMXPDqw.png"/></div></div></figure><h2 id="6c99" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">安装推动器</h2><p id="b32f" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">正如我之前提到的，Soketi 基于 Pusher Potrocoll，这是一种“Pusher 替代”，这就是为什么我们应该安装 Pusher SDK:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="8564" class="nb ll in mx b gy nc nd l ne nf">composer require pusher/pusher-php-server</span></pre><p id="6d55" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保你的广播驱动程序正在推进。包封/包围（动词 envelop 的简写）</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="c0d1" class="nb ll in mx b gy nc nd l ne nf">BROADCAST_DRIVER=pusher</span></pre><h2 id="9059" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">拉勒韦尔回声报</h2><p id="c25f" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">我们将使用 Laravel Echo libary 来订阅频道，监听客户端的事件。它很容易使用，在 Laravel 的官方文档中有很好的指南。首先，我们应该安装它:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="0651" class="nb ll in mx b gy nc nd l ne nf">npm install --save-dev laravel-echo pusher-js</span></pre><p id="fb49" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装完成后，我们创建一个新的 Echo 实例，打开<em class="nr"> bootstrap.js </em>并添加以下代码:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="2784" class="nb ll in mx b gy nc nd l ne nf">import Echo from 'laravel-echo';<br/><br/><em class="nr">window</em>.Pusher = <em class="nr">require</em>('pusher-js');<br/><br/><em class="nr">window</em>.Echo = new Echo({<br/>    broadcaster: 'pusher',<br/>    key: <em class="nr">process</em>.env.MIX_PUSHER_APP_KEY,<br/>    wsHost: <em class="nr">process</em>.env.MIX_PUSHER_HOST,<br/>    wsPort: <em class="nr">process</em>.env.MIX_PUSHER_PORT,<br/>    wssPort: <em class="nr">process</em>.env.MIX_PUSHER_PORT,<br/>    forceTLS: false,<br/>    encrypted: true,<br/>    disableStats: true,<br/>    enabledTransports: ['ws', 'wss'],<br/>});</span></pre><p id="c03f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如你所见，我们将实例定义为<em class="nr">窗口。Echo </em>，这就是我们如何从代码中访问任何地方。</p><h2 id="ea96" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">添加提供者</h2><p id="a395" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">我们应该将 BrodcastServiceProvider 添加到我们的应用程序中，为此，打开<em class="nr"> config/app.php </em>，并将这一新行插入到<em class="nr"> providers </em>部分:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="a26f" class="nb ll in mx b gy nc nd l ne nf">'providers' =&gt; [<br/>    #THE REST OF THE CODE<br/>    App\Providers\BroadcastServiceProvider::<strong class="mx io">class</strong>,<br/>];</span></pre><p id="b7a7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不要惊讶，如果它是一个新安装的 Laravel 应用程序或者您使用了我之前提到的项目，您应该只注释掉那一行。</p><h2 id="4b1b" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">使用 Redis 的队列工作器</h2><p id="1e83" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">在这篇文章的前一部分，我们讨论了如何用 Laravel Sail 安装 Redis。为了避免阻塞正在运行的 PHP 代码，Laravel 使用队列来广播事件。在。以下项目的环境:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="3b94" class="nb ll in mx b gy nc nd l ne nf">QUEUE_CONNECTION=redis</span></pre><p id="ddd6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在转到 shell 中的项目，运行以下命令:</p><pre class="kz la lb lc gt mw mx my mz aw na bi"><span id="a0a7" class="nb ll in mx b gy nc nd l ne nf">php artisan queue:work --queue=high,default</span></pre><p id="9783" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从现在开始你就什么都看不到了，没事的:)</p><h2 id="1a52" class="nb ll in bd lm ng nh dn lq ni nj dp lu kl nk nl lw kp nm nn ly kt no np ma nq bi translated">…一切正常吗？</h2><p id="b496" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">如你所见，我们应该有一堆东西来实现这个魔法。这是一个需要仔细检查的列表:</p><p id="af91" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">应配置👷🏽</strong> <br/> -广播 _ 驱动正在推进中。env <br/> - QUEUE_CONNECTION 是 redis in。环境<br/> -推动器变量输入。env(用于 Soketi) <br/> -在<em class="nr"> config/app.php </em>中添加了 BroadcastServiceProvider</p><p id="c5b1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">应运行🏃🏼<br/> </strong> - Redis(乘帆)<br/> - Soketi(乘帆)<br/> -排队工(码头)</p><h1 id="8b9f" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">但是它是如何工作的呢？</h1><p id="8329" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">在我们深入研究编码之前，我想总结一下正在发生的事情，以便更好地理解。</p><p id="e913" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">WebSocket 是(正如我之前提到的)全双工通信协议，这意味着，我们始终与后端保持连接，这就是为什么我们不需要每次都提出新的请求来拉数据。利用这一点，我们可以制作实时网络应用程序。我们开始编写一个聊天应用程序，因为这是 WebSocket 基本概念的最好例子:每个用户(在浏览器中打开我们的网站)都加入客户端的一个频道。当后端发送消息(广播)时，频道中的每个人都会收到。</p><p id="d10a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是后面发生的流程图:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/cd0df51b2ce5bbc4918d1ac4c15f1dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MZG11hhIODsk-xEMiqBIQ.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">广播流</figcaption></figure><p id="d426" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是关于如何配置您的 Laravel 项目来启动广播通信的全部内容。在下一章中，我们将创建一个聊天应用程序来测试它！在这里阅读:</p><p id="9282" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Laravel、ReactJs、Soketi 三巨头:构建实时 WebApp 的逐步指南—第 2 部分⏭</p><p id="1c52" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">⭐️，你想支持我的工作吗？还是你只是一个了不起的人？嗯，如果你是，你可以 <a class="ae mh" href="https://www.buymeacoffee.com/tthdvd" rel="noopener ugc nofollow" target="_blank"> <em class="nr">请我喝杯咖啡</em> </a> <em class="nr">！</em></p><p id="0274" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nr">照片由</em> <a class="ae mh" href="https://unsplash.com/@vlado?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="nr">弗拉多</em> </a> <em class="nr">上</em><a class="ae mh" href="https://unsplash.com/s/photos/matrix?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="nr">Unsplash</em></a></p></div></div>    
</body>
</html>