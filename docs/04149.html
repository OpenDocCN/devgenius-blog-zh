<html>
<head>
<title>Testing Vue 3 Apps — Mock HTTP Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试 Vue 3 应用——模拟 HTTP 请求</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/testing-vue-3-apps-mock-http-requests-8b405b804a87?source=collection_archive---------2-----------------------#2021-02-01">https://blog.devgenius.io/testing-vue-3-apps-mock-http-requests-8b405b804a87?source=collection_archive---------2-----------------------#2021-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f92f672d456200d8535b54e7a7b696b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1zVtxxz4sIjEPJIq"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kc" href="https://unsplash.com/@mometrixtestprep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mometrix 测试准备</a>的照片</figcaption></figure><p id="5822" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着应用程序变得越来越复杂，自动测试它们变得非常重要。我们可以通过单元测试做到这一点，然后我们就不必手动测试所有的东西了。</p><p id="ca81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过编写一个简单的应用程序并测试它来看看如何测试 Vue 3 应用程序。</p><h1 id="1eac" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解决其他异步行为</h1><p id="17a3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们在组件外部的组件中有异步行为，那么我们就模仿它们。</p><p id="5816" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="c2c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Foo.vue</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="24b1" class="mq lc iq mh b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;p&gt;{{ answer }}&lt;/p&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="b6f2" class="mq lc iq mh b gy mv ms l mt mu">&lt;script&gt;<br/>import axios from "axios";</span><span id="69fd" class="mq lc iq mh b gy mv ms l mt mu">export default {<br/>  data() {<br/>    return {<br/>      answer: "",<br/>    };<br/>  },<br/>  beforeMount() {<br/>    this.load();<br/>  },<br/>  methods: {<br/>    async load() {<br/>      const {<br/>        data: { answer },<br/>      } = await axios.get("https://yesno.wtf/api");<br/>      this.answer = answer;<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="173b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">example.spec.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2267" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '<a class="ae kc" href="http://twitter.com/vue/test-utils" rel="noopener ugc nofollow" target="_blank">@vue/test-utils</a>'<br/>import flushPromises from 'flush-promises'<br/>import axios from 'axios'<br/>import Foo from './Foo'</span><span id="ea36" class="mq lc iq mh b gy mv ms l mt mu">jest.mock('axios', () =&gt; ({<br/>  get: jest.fn(() =&gt; Promise.resolve({ data: { answer: 'yes' } }))<br/>}))</span><span id="cad5" class="mq lc iq mh b gy mv ms l mt mu">test('uses a mocked axios HTTP client and flush-promises', async () =&gt; {<br/>  const wrapper = mount(Foo)<br/>  expect(axios.get).toHaveBeenCalledWith('https://yesno.wtf/api')<br/>  await flushPromises()<br/>  const div = wrapper.find('div')<br/>  expect(div.text()).toContain('yes')<br/>});</span></pre><p id="e9fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">Foo</code>组件，它从 API 获取一些数据并呈现出来。</p><p id="de0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">example.spec.js</code>中，我们用<code class="fe me mf mg mh b">jest.fn</code>方法模拟<code class="fe me mf mg mh b">axios.get</code>方法。</p><p id="f218" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们窥探函数是否被调用，以及用什么调用它。</p><p id="0fbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们从函数中返回数据。</p><p id="e183" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在测试中，我们安装组件。</p><p id="73d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">expect</code>来检查<code class="fe me mf mg mh b">axios.get</code>是否和<code class="fe me mf mg mh b">‘https://yesno.wtf/api'</code>一起被调用，就像我们在<code class="fe me mf mg mh b">Foo</code>中做的那样。</p><p id="c15c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">flushPromises</code>等待 DOM 更新。</p><p id="bdf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们使用<code class="fe me mf mg mh b">text</code>方法获取 div 并检查文本。</p><h1 id="468c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">断言加载状态</h1><p id="0310" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以通过测试来检查装载状态。</p><p id="d5b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="ec41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Foo.vue</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5222" class="mq lc iq mh b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;p v-if="loading" role="alert"&gt;Loading...&lt;/p&gt;<br/>    &lt;p v-else&gt;{{ answer }}&lt;/p&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="7078" class="mq lc iq mh b gy mv ms l mt mu">&lt;script&gt;<br/>import axios from "axios";</span><span id="57aa" class="mq lc iq mh b gy mv ms l mt mu">export default {<br/>  data() {<br/>    return {<br/>      loading: false,<br/>      answer: "",<br/>    };<br/>  },<br/>  beforeMount() {<br/>    this.load();<br/>  },<br/>  methods: {<br/>    async load() {<br/>      this.loading = true;<br/>      const {<br/>        data: { answer },<br/>      } = await axios.get("https://yesno.wtf/api");<br/>      this.answer = answer;<br/>      this.loading = false;<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="9d1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">example.spec.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b2f9" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '@vue/test-utils'<br/>import flushPromises from 'flush-promises'<br/>import axios from 'axios'<br/>import Foo from './Foo'</span><span id="71b4" class="mq lc iq mh b gy mv ms l mt mu">jest.mock('axios', () =&gt; ({<br/>  get: jest.fn(() =&gt; Promise.resolve({ data: { answer: 'yes' } }))<br/>}))</span><span id="23ca" class="mq lc iq mh b gy mv ms l mt mu">test('uses a mocked axios HTTP client and flush-promises', async () =&gt; {<br/>  const wrapper = mount(Foo)<br/>  expect(wrapper.find('[role="alert"]').exists()).toBe(true)<br/>  expect(wrapper.find('[role="alert"]').text()).toBe('Loading...')<br/>  expect(axios.get).toHaveBeenCalledWith('https://yesno.wtf/api')<br/>  await flushPromises()<br/>  const div = wrapper.find('div')<br/>  expect(div.text()).toContain('yes')<br/>  expect(wrapper.find('[role="alert"]').exists()).toBe(false)<br/>});</span></pre><p id="cddc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有包含加载消息的<code class="fe me mf mg mh b">Foo</code>组件。</p><p id="b87a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它由<code class="fe me mf mg mh b">loading</code>反应属性控制。</p><p id="1db4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在测试中，我们检查是否呈现了将<code class="fe me mf mg mh b">role</code>设置为<code class="fe me mf mg mh b">alert</code>的元素。</p><p id="7b65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">flushPromises</code>并检查将<code class="fe me mf mg mh b">role</code>设置为<code class="fe me mf mg mh b">alert</code>的元素是否不再被渲染。</p><p id="0a36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还检查是否得到了与上一个例子一样的响应。</p><h1 id="8dac" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="54ba" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们检查模拟 HTTP 请求，用 Vue 3 组件和 Vue 测试工具测试我们的组件。</p></div></div>    
</body>
</html>