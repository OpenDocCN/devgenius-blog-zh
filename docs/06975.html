<html>
<head>
<title>Android Huawei push notification with deep linking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有深度链接的 Android 华为推送通知</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/android-huawei-push-notification-with-deep-linking-b76cbe79354a?source=collection_archive---------10-----------------------#2022-02-15">https://blog.devgenius.io/android-huawei-push-notification-with-deep-linking-b76cbe79354a?source=collection_archive---------10-----------------------#2022-02-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cd0c3d3871712bfc0ff9dea1968792ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*faPiSyR0iW6Hd2mw4Quf9w.jpeg"/></div></div></figure><h1 id="b411" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">介绍</h1><p id="a6cd" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">大家好，</p><p id="8960" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">我们将查看来自华为设备的接收推送通知。我们将随着深度链接一起谈论<a class="ae lw" href="https://developer.huawei.com/consumer/en/doc/development/HMS-Plugin-Guides/introduction-0000001050176404" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lx">华为推套件</em> </strong> </a>。</p><p id="d7cb" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi ly translated"><span class="l lz ma mb bm mc md me mf mg di"> H </span> UAWEI Push Kit 是为您提供的一项消息服务，用于建立从云端到设备的消息通道。它具有与<strong class="kv io"><em class="lx">FCM(Firebase Cloud messaging)相似的功能。</em> </strong>您可以自定义自己的通知，并从<strong class="kv io"> <em class="lx"> HMS(华为消息服务)</em> </strong>控制台上传不同的设计。此外，您可以添加自定义按钮推送通知。很酷，不是吗？</p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="3a54" class="jv jw in bd jx jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks bi translated">设置</h1><p id="81cc" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">按照<a class="ae lw" href="https://developer.huawei.com/consumer/en/codelab/HMSPushKit/index.html#0" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">这个</strong> </a> <strong class="kv io"> </strong>链接进行服务的初始设置。</p><p id="02a8" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">所以让我们跳过这一部分，深入研究如何从服务器端发送推送通知。我们必须使用<strong class="kv io"> <em class="lx">华为推送 API 手动发送推送通知。</em> </strong>所以华为给了我们两个不同的发送推送通知的 API。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="2b55" class="nc jw in my b gy nd ne l nf ng">1) Oauth 2.0 access token,</span><span id="bbfe" class="nc jw in my b gy nh ne l nf ng">POST /oauth2/v3/token HTTP/1.1<br/>Host: oauth-login.cloud.huawei.com<br/>Content-Type: application/x-www-form-urlencoded</span><span id="a369" class="nc jw in my b gy nh ne l nf ng">**params**</span><span id="259d" class="nc jw in my b gy nh ne l nf ng">grant_type=client_credentials&amp; //default<br/>client_id=&lt;Client ID&gt;&amp; //Collect from app console<br/>client_secret=&lt;Client secret&gt; //Collect from app console</span></pre><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/f432897632c90e9b9de188fd056dc3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wockbMN4O8QZxiZv5xQHxA.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">邮递员视图</figcaption></figure><p id="3274" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">转到<a class="ae lw" href="https://developer.huawei.com/consumer/fr/doc/development/HMSCore-Guides/web-get-access-token-0000001050048946" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">此</strong> </a>链接，了解有关获取访问令牌的更多信息。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="55e8" class="nc jw in my b gy nd ne l nf ng">2) Push cloud API for Sending Downlink Messages</span><span id="ae94" class="nc jw in my b gy nh ne l nf ng">https://push-api.cloud.huawei.com/v1/<em class="lx">appid</em>/messages:send</span><span id="089c" class="nc jw in my b gy nh ne l nf ng">POST /v1/<strong class="my io"><em class="lx">appid</em></strong>/messages:send HTTP/1.1<br/>Host: <a class="ae lw" href="https://push-api.cloud.huawei.com" rel="noopener ugc nofollow" target="_blank">oauth-login.cloud.huawei.com</a></span><span id="267a" class="nc jw in my b gy nh ne l nf ng">**Header**</span><span id="d1af" class="nc jw in my b gy nh ne l nf ng">Authorization = Bearer <strong class="my io"><em class="lx">access_token</em></strong></span><span id="59d9" class="nc jw in my b gy nh ne l nf ng">**Data payload/Request Body**<br/>{<br/>    "message": {<br/>        "data": "{ 'score': '7', 'time': '16:42' }",<br/>        "notification": {<br/>            "title": "message title",<br/>            "body": "message body"<br/>        },<br/>        "android": {<br/>            "data": "{ 'androidData': '7', 'time': '16:42' }",<br/>            "notification": {<br/>                "click_action": {<br/>                    "type": 3<br/>                }<br/>            }<br/>        },<br/>        "token": [<br/>            "pushtoken1"<br/>        ]<br/>    }<br/>}<br/>** This is a sample notification message**</span></pre><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/d5808fdbed5b504ebf8928c2ae9a5d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m85E0zWT9pIea58Oo8aDVQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">云推送 API 邮差视图</figcaption></figure><p id="06ad" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">这就是通过华为推送云 API 从任何后端服务获得简单推送通知的全部内容。</p><h1 id="372e" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">深层链接</h1><p id="8663" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">有两种类型的消息可以通过 push kit 发送。<strong class="kv io"> <em class="lx">通知报文</em> </strong>和<strong class="kv io"> <em class="lx">数据报文。</em> </strong></p><h2 id="340e" class="nc jw in bd jx no np dn kb nq nr dp kf le ns nt kj li nu nv kn lm nw nx kr ny bi translated"><strong class="ak">通知消息</strong></h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="cd0e" class="nc jw in my b gy nd ne l nf ng">***Notification message body***<br/>{<br/>    "message": {<br/>        "notification": {<br/>            "title": "message title",<br/>            "body": "message body"<br/>        },<br/>        "android": {<br/>            "notification": {<br/>                "click_action": {<br/>                    "type": 1,<br/>                    "intent": "intent://com.huawei.xahmspushdemo/deeplink?#Intent;scheme=pushscheme;launchFlags=0x4000000;i.age=180;S.name=abc;end"<br/>                }<br/>            }<br/>        },<br/>        "token": [<br/>            "pushtoken1"<br/>        ]<br/>    }<br/>}</span></pre><p id="e99e" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">在<strong class="kv io"> <em class="lx">点击 _ 动作</em> </strong>部分<strong class="kv io">【类型】:1 </strong>表示你想打开一个自定义意向。<strong class="kv io">“意图”:“xxxx”</strong>表示名称和深度链接方案。要了解更多关于 click_action 的信息，请访问<a class="ae lw" href="https://developer.huawei.com/consumer/en/doc/development/HMSCore-References/https-send-api-0000001050986197#EN-US_TOPIC_0000001134031085__p431142991615" rel="noopener ugc nofollow" target="_blank">这个</a>链接。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="6935" class="nc jw in my b gy nd ne l nf ng">***A simple deeplink scheme attached to an activity***<br/>&lt;activity android:name=".DeeplinkActivity"&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="android.intent.action.VIEW" /&gt;<br/>        &lt;category android:name="android.intent.category.DEFAULT" /&gt;<br/>        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;<br/>        &lt;data<br/>            &lt;!-- Customize the following information:--&gt;<br/>            android:host="com.huawei.codelabpush"<br/>            android:path="/deeplink"<br/>            android:scheme="pushscheme" /&gt;<br/>    &lt;/intent-filter&gt;<br/>&lt;/activity&gt;</span></pre><p id="ddac" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">要了解更多关于深度链接方案的信息，请点击这里。</p><p id="6e1c" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">您可以向推送通知的按钮添加自定义动作和数据。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="c6e9" class="nc jw in my b gy nd ne l nf ng">*** Deep-link action to a specific button of a push***<br/>{<br/>    "validate_only": false,<br/>    "message": {<br/>        "android": {<br/>            "notification": {<br/>                "title":"message title",<br/>                "body":"message body",<br/>                "click_action": {<br/>                    "type": 3<br/>                },<br/>                "style": 0,<br/>                "buttons": [<br/>                    {<br/>                        "name": "DETAILS",<br/>                        "action_type": 1,<br/>                        "intent_type": 0,<br/>                        "intent": "intent://com.huawei.codelabpush/deeplink?#Intent;scheme=pushscheme;launchFlags=0x04000000;i.age=180;S.name=abc;end",<br/>                        "data": "{\"key1\":\"value1\"}"<br/>                    }<br/>                ]<br/>            }<br/>        },<br/>        "token": ["pushtoken1"]<br/>    }<br/>}</span></pre><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/616fd1bbf88660edb24379ba2395eaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rERFb5u1IYTYMAdkidH3gQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">按钮动作类型</figcaption></figure></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h2 id="8d4a" class="nc jw in bd jx no np dn kb nq nr dp kf le ns nt kj li nu nv kn lm nw nx kr ny bi translated">数据报文</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="e100" class="nc jw in my b gy nd ne l nf ng">***Data message body***<br/>{<br/>    "validate_only": false,<br/>    "message": {<br/>        "data": "{'param1':'value1','param2':'value2'}",<br/>        "token": ["pushtoken1"]<br/>    }<br/>}</span></pre><p id="339f" class="pw-post-body-paragraph kt ku in kv b kw lr ky kz la ls lc ld le lt lg lh li lu lk ll lm lv lo lp lq ig bi translated">接收数据消息类似于 FCM 数据消息。对于深度链接，您必须手动将方案 URL 传递给<strong class="kv io"> "data": </strong>参数。您将接收这个确切的数据到推送通知服务类的<strong class="kv io"><em class="lx">on message received</em></strong>override 方法。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">HmsPushService 类</figcaption></figure><h1 id="eb0c" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">注意</h1><blockquote class="oc od oe"><p id="8ae5" class="kt ku lx kv b kw lr ky kz la ls lc ld of lt lg lh og lu lk ll oh lv lo lp lq ig bi translated">每个 OAuth 令牌都有 3600 秒的过期时间。因此，每次到期后，您都必须创建一个新令牌。</p></blockquote><h1 id="4e69" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="561f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在这篇文章中，我试图解释如何使用带有深度链接方案的华为 Push Kit。我希望这篇文章对每个人都有用。感谢您抽出时间阅读。</p></div></div>    
</body>
</html>