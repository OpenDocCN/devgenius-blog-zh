<html>
<head>
<title>How to process and update XML payloads from the shell script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从 shell 脚本处理和更新 XML 有效负载</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-process-and-update-xml-payloads-from-the-shell-script-2631c60fefe4?source=collection_archive---------0-----------------------#2020-11-22">https://blog.devgenius.io/how-to-process-and-update-xml-payloads-from-the-shell-script-2631c60fefe4?source=collection_archive---------0-----------------------#2020-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="da22" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用 xmlstarlet 在脚本中有效地处理 XML 负载</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a595c2e72b74992285c7fcc10b996177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sqetc6L-P0mleXZW"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">沙哈达特·拉赫曼在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c5ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您从事 IT 工作，或者甚至将它视为您的主要爱好之一，那么您在某个时候已经被编写了一个 shell 脚本。如果你也从事业务运营方面的工作，这可以成为你的日常任务。创建、维护或升级现有流程。</p><p id="d77c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如今，与外部系统进行交互更加常见，这些外部系统使用 XML 文件中的有效负载，甚至使用这种格式编写的配置文件。</p><p id="208e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原生 shell 脚本并没有提供一种简单的方法来实现这一点，也没有像 Python、Java 或 Go 等现代编程语言那样支持库来处理这一点。因此，您可能已经发现自己正在编写代码来解析这种有效载荷。但这不是唯一的方法，我们可以(也应该！)利用现有的工具为我们完成这项工作。</p><h1 id="6bbe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">xmlstarlet</h1><p id="bfaa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我找不到更好的方法来解释 xmlstarlet 做了什么，所有者在他们的源代码库中做了定义:</p><blockquote class="mp mq mr"><p id="1088" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">XMLStarlet 是一个命令行 XML 工具包，可以使用一组简单的 shell <br/>命令来转换、<br/>查询、验证和编辑 XML 文档和文件，类似于使用 grep/sed/awk/ <br/> tr/diff/patch 对纯文本文件所做的那样。</p></blockquote><p id="a311" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，xmlstarlet 提供了处理 XML 的所有能力，因为这是纯文本文件。</p><div class="mw mx gp gr my mz"><a href="http://xmlstar.sourceforge.net/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">XMLStarlet 命令行 XML 工具包:新闻</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">亲爱的 XMLStarlet 用户，你可能已经注意到 xmlstarlet 的开发有些停滞了。得到…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">xmlstar.sourceforge.net</p></div></div></div></a></div><h2 id="74c9" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">装置</h2><p id="74f1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">该实用程序的安装过程非常简单，取决于您使用的操作系统。我假设大多数 shell 脚本都考虑了 Unix 机器目标。安装这个工具非常容易，因为大多数软件包仓库都有这个工具的版本。</p><p id="62ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果您使用基于 apt 的系统，您需要执行以下命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="48f0" class="ni lt iq nv b gy nz oa l ob oc">sudo apt-get install xmlstarlet </span></pre><p id="0194" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您使用的是另一个平台，请不要担心，因为他们有所有最常用的操作系统和平台的可用版本，您可以在下面的链接中看到:</p><div class="mw mx gp gr my mz"><a href="http://xmlstar.sourceforge.net/download.php" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">XMLStarlet 命令行 XML 工具包:下载</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">来源:可在 SourceForge Linux 上获得:与您最近的 Linux 发行版捆绑在一起:可在 SourceForge 上获得…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">xmlstar.sourceforge.net</p></div></div><div class="od l"><div class="oe l of og oh od oi kp mz"/></div></div></a></div><h2 id="61a7" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">使用</h2><p id="d6d0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一旦我们安装了这个软件，我们要做的第一件事就是启动它来查看可用的选项。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="8c24" class="ni lt iq nv b gy nz oa l ob oc">XMLStarlet Toolkit: Command line utilities for XML<br/>Usage: D:\Data\Downloads\xmlstarlet-1.6.1-win32\xmlstarlet-1.6.1\xmlstarlet.exe [&lt;options&gt;] &lt;command&gt; [&lt;cmd-options&gt;]<br/>where &lt;command&gt; is one of:<br/>  ed    (or edit)      - Edit/Update XML document(s)<br/>  sel   (or select)    - Select data or query XML document(s) (XPATH, etc)<br/>  tr    (or transform) - Transform XML document(s) using XSLT<br/>  val   (or validate)  - Validate XML document(s) (well-formed/DTD/XSD/RelaxNG)<br/>  fo    (or format)    - Format XML document(s)<br/>  el    (or elements)  - Display element structure of XML document<br/>  c14n  (or canonic)   - XML canonicalization<br/>  ls    (or list)      - List directory as XML<br/>  esc   (or escape)    - Escape special XML characters<br/>  unesc (or unescape)  - Unescape special XML characters<br/>  pyx   (or xmln)      - Convert XML into PYX format (based on ESIS - ISO 8879)<br/>  p2x   (or depyx)     - Convert PYX into XML<br/>&lt;options&gt; are:<br/>  -q or --quiet        - no error output<br/>  --doc-namespace      - extract namespace bindings from input doc (default)<br/>  --no-doc-namespace   - don't extract namespace bindings from input doc<br/>  --version            - show version<br/>  --help               - show help<br/>Wherever file name mentioned in command help it is assumed<br/>that URL can be used instead as well.<br/><br/>Type: xmlstarlet &lt;command&gt; --help &lt;ENTER&gt; for command help</span></pre><p id="1c33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们需要决定的第一件事是我们需要使用哪个命令，这些命令与我们想要执行的操作是一一对应的。在这篇文章中，我将集中讨论主要的命令，但是正如你所看到的，这包括从选择 XML 值，更新它，甚至验证它。</p><h2 id="c02a" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">用例 1:选择一个值。</h2><p id="24d6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将从最简单的用例开始，尝试从 XML (file.xml)中选择一个值，如下所示:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="1541" class="ni lt iq nv b gy nz oa l ob oc">&lt;root&gt;<br/>&lt;object1 name="attribute_name"&gt;value in XML&lt;/object1&gt;</span><span id="ac39" class="ni lt iq nv b gy oj oa l ob oc">&lt;/root&gt;</span></pre><p id="90dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将从最简单的命令开始:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="4a74" class="ni lt iq nv b gy nz oa l ob oc">./xmlstarlet  sel  -t -v "/root/object1"  ./file.xml</span><span id="7700" class="ni lt iq nv b gy oj oa l ob oc"><em class="ms"><br/>value in XML</em></span></pre><p id="72c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这提供了 object1 元素内部的值，使用-t 定义一个新模板，使用-v 指定句子的值。现在，如果我们想获得属性值，我们可以像前面的命令那样做:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="115f" class="ni lt iq nv b gy nz oa l ob oc"><strong class="nv ir">./xmlstarlet  sel  -t -v "/root/object1/@name"  ./file.xml</strong></span><span id="6611" class="ni lt iq nv b gy oj oa l ob oc"><em class="ms"><br/>attribute_name</em></span></pre><h2 id="3961" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">用例 2:更新值。</h2><p id="bc4d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，我们将遵循基于同一文件的另一种方法。我们将更新 object1 元素的值来设置文本“updated text”。</p><p id="0237" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们执行以下命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="b165" class="ni lt iq nv b gy nz oa l ob oc"><strong class="nv ir">./xmlstarlet ed -u "/root/object1" -v "updated text" ./file.xml</strong></span><span id="e3e9" class="ni lt iq nv b gy oj oa l ob oc"><em class="ms"><br/>&lt;?xml version="1.0"?&gt;<br/>&lt;root&gt;<br/>  &lt;object1 name="attribute_name"&gt;updated text&lt;/object1&gt;<br/>&lt;/root&gt;</em></span></pre><h1 id="6196" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摘要</h1><p id="af1e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">xmlstarlet 将为我们提供管理复杂事物的所有选项，因为有 XML，并且可以简单地完成您可以想象的所有任务，而不需要自己编写所有的解析逻辑。我希望从现在开始，当您需要在 shell 脚本中管理 XML 时，您是一个更快乐的开发人员。</p></div></div>    
</body>
</html>