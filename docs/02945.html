<html>
<head>
<title>How to connect Android App with Firebase Cloud Functions without installing Firebase SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在不安装 Firebase SDK 的情况下连接 Android App 与 Firebase 云功能</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-connect-android-app-with-firebase-cloud-functions-without-installing-firebase-sdk-68d5ce7f12d0?source=collection_archive---------9-----------------------#2020-09-14">https://blog.devgenius.io/how-to-connect-android-app-with-firebase-cloud-functions-without-installing-firebase-sdk-68d5ce7f12d0?source=collection_archive---------9-----------------------#2020-09-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/fec74aa023f1e31bee11d48311db1782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CRs7b-OhktkyCuvB4hl6Q.png"/></div></div></figure><div class=""/><p id="8ffa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我的上一篇文章中，我提到了如何使用 Firebase Cloud 函数创建和集成您的 AWS RDS 数据库。我将使用(FCF 简称为 Firebase 云函数)。FCF(在我们的例子中)充当服务器来提供来自数据库的数据。但我们需要使用这些数据，并通过手机应用程序或网站的形式呈现给用户。在本教程中，我们将使用 Android 应用程序通过 FCF 向 AWS RDS 发布数据。这里的重点是从 Android 应用程序调用 FCF。无论如何，如果你错过了前一篇文章，请点击下面的链接。</p><p id="f457" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看更多:<a class="ae kt" href="https://medium.com/dev-genius/firebase-cloud-functions-integration-with-aws-rds-database-947a383e2e0c" rel="noopener"> FCF 与 AWS RDS 数据库的集成</a></p><p id="1ac9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我将解释如何将你的云函数方法与你的 android 应用程序相结合。如果你在网上搜索，<a class="ae kt" href="https://firebase.google.com/docs/functions/callable#java" rel="noopener ugc nofollow" target="_blank">Firebase</a>的官方页面会告诉你添加依赖项安装 Firebase SDK 后才能调用 FCF。这是做这件事的一种方式，并没有什么不好(就我而言)。但在本教程中，我们将做一些更简单，更容易和通用的东西。</p><p id="9836" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们知道 FCF 充当 RESTful API，可以使用 postman 以类似的方式调用它。因此，我们将在本教程中使用类似的方法从 Android 应用程序调用 FCF，就像我们可以从 Android 应用程序调用任何 REST API 一样。</p><h1 id="eb94" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第一步:设置一个 android 应用程序，添加活动和布局页面。</h1><p id="04cb" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果你还没有 android 应用程序，那么使用 android Studio 创建一个新的 Android 应用程序。为样式编辑文本创建一个新的可绘制文件。通过编辑 manifest.xml 允许 internet 访问，并编辑您的布局文件，如下所示。</p><p id="8be8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lx"> edit_text_draw.xml: </em></p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="1322" class="mh kv iy md b gy mi mj l mk ml"><em class="lx">&lt;?</em><strong class="md iz">xml version="1.0" encoding="utf-8"</strong><em class="lx">?&gt;<br/></em>&lt;<strong class="md iz">shape xmlns:android="http://schemas.android.com/apk/res/android" </strong>&gt;<br/>    &lt;<strong class="md iz">solid android:color="#FDFDFD" </strong>/&gt;<br/>    &lt;<strong class="md iz">stroke<br/>        android:width="2dp"<br/>        android:color="@color/colorPrimary"<br/>        </strong>/&gt;<br/>    &lt;<strong class="md iz">corners<br/>        android:topLeftRadius="2dp"<br/>        android:topRightRadius="2dp"<br/>        android:bottomLeftRadius="2dp"<br/>        android:bottomRightRadius="2dp"<br/>        </strong>/&gt;<br/>&lt;/<strong class="md iz">shape</strong>&gt;</span></pre><p id="2ae7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lx"> AndroidManifest.xml: </em></p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="f922" class="mh kv iy md b gy mi mj l mk ml"><em class="lx">&lt;?</em>xml version="1.0" encoding="utf-8"<em class="lx">?&gt;<br/></em>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br/>    package="com.akaystravel.apitest"&gt;<br/>    <strong class="md iz">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</strong><br/>    &lt;application<br/>----------<br/>----------<br/>----------<br/>    &lt;/application&gt;<br/>&lt;/manifest&gt;</span></pre><p id="f345" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lx"> activity_main.xml: </em></p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="e217" class="mh kv iy md b gy mi mj l mk ml"><em class="lx">&lt;?</em><strong class="md iz">xml version="1.0" encoding="utf-8"</strong><em class="lx">?&gt;<br/></em>&lt;<strong class="md iz">LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"<br/>    android:orientation="vertical"<br/>    android:padding="20dp"<br/>    </strong>&gt;<br/>    &lt;<strong class="md iz">TextView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Employee Name"<br/>        </strong>/&gt;<br/>    &lt;<strong class="md iz">EditText<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:inputType="text"<br/>        android:layout_marginBottom="10dp"<br/>        android:id="@+id/employeeName"<br/>        android:background="@drawable/edit_text_draw"<br/>        android:padding="10dp"<br/>        </strong>/&gt;<br/><br/>    &lt;<strong class="md iz">TextView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Employee Salary"<br/>        </strong>/&gt;<br/>    &lt;<strong class="md iz">EditText<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:inputType="number"<br/>        android:layout_marginBottom="10dp"<br/>        android:id="@+id/employeeSalary"<br/>        android:background="@drawable/edit_text_draw"<br/>        android:padding="10dp"<br/>        </strong>/&gt;<br/><br/>    &lt;<strong class="md iz">TextView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Employee Age"<br/>        </strong>/&gt;<br/>    &lt;<strong class="md iz">EditText<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:inputType="number"<br/>        android:layout_marginBottom="20dp"<br/>        android:id="@+id/employeeAge"<br/>        android:background="@drawable/edit_text_draw"<br/>        android:padding="10dp"<br/>        </strong>/&gt;<br/><br/>    &lt;<strong class="md iz">Button<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Submit"<br/>        android:background="@color/colorPrimary"<br/>        android:textColor="#FFF"<br/>        android:id="@+id/submitId"<br/>        </strong>/&gt;<br/><br/>&lt;/<strong class="md iz">LinearLayout</strong>&gt;</span></pre><h1 id="5af7" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">步骤 2:编辑调用 Firebase 云函数的活动类。(使用邮寄方式提交表格)</h1><p id="7393" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">这是教程的主要部分。我们记得，FCF 是一个 RESTful API。因此，在本教程中，我们将使用 Java HttpURLConnection 方法来调用 FCF。在 Android 中，当我们进行这样的网络调用时，最好的做法是调用异步方法，以确保它不会影响 UI 线程。出于同样的原因，我们将扩展 AsyncTask 类来调用托管在 FCF 上的 REST API。</p><p id="4e21" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本例中使用的最重要的 java 库如下:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="25e3" class="mh kv iy md b gy mi mj l mk ml"><strong class="md iz">import </strong>java.net.HttpURLConnection;<br/><strong class="md iz">import </strong>java.net.URL;<br/><strong class="md iz">import </strong>com.google.gson.JsonObject;</span></pre><p id="4646" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要使用 gson 库，我们需要在 build gradle 文件中添加依赖项，如下所示。这个库将帮助我们操作 JSON 对象。java.net.*库是内置的 java 库:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="f8bc" class="mh kv iy md b gy mi mj l mk ml">implementation <strong class="md iz">'com.google.code.gson:gson:2.8.5'</strong></span></pre><p id="3d6f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lx">内部类 HTTPPostRequest: </em></p><p id="d130" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个定制的内部类，用作异步方法进行 API 调用，在我们的例子中是 POST 方法调用。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="a47c" class="mh kv iy md b gy mi mj l mk ml"><strong class="md iz">private class </strong>HTTPPostRequest <strong class="md iz">extends </strong>AsyncTask&lt;Void, Void, Void&gt; {<br/>    HttpURLConnection <strong class="md iz">urlConnection </strong>= <strong class="md iz">null</strong>;<br/><br/>    @Override<br/>    <strong class="md iz">protected </strong>Void doInBackground(Void... voids) {<br/>        <strong class="md iz">try </strong>{<br/>            JsonObject postData = <strong class="md iz">new </strong>JsonObject();<br/>            postData.addProperty(<strong class="md iz">"employeeName"</strong>, <strong class="md iz">employeeNameET</strong>.getText().toString());<br/>            postData.addProperty(<strong class="md iz">"employeeSalary"</strong>, <strong class="md iz">employeeSalaryET</strong>.getText().toString());<br/>            postData.addProperty(<strong class="md iz">"employeeAge"</strong>, <strong class="md iz">employeeAgeET</strong>.getText().toString());<br/><br/>            URL url = <strong class="md iz">new </strong>URL(<strong class="md iz">"[YOUR-HOSTNAME]/employee/"</strong>);<br/>            <strong class="md iz">urlConnection </strong>= (HttpURLConnection) url.openConnection();<br/>            <strong class="md iz">urlConnection</strong>.setRequestProperty(<strong class="md iz">"Content-Type"</strong>, <strong class="md iz">"application/json"</strong>);<br/>            <strong class="md iz">urlConnection</strong>.setRequestMethod(<strong class="md iz">"POST"</strong>);<br/>            <strong class="md iz">urlConnection</strong>.setDoOutput(<strong class="md iz">true</strong>);<br/>            <strong class="md iz">urlConnection</strong>.setDoInput(<strong class="md iz">true</strong>);<br/>            <strong class="md iz">urlConnection</strong>.setChunkedStreamingMode(0);<br/>            OutputStream out = <strong class="md iz">new </strong>BufferedOutputStream(<strong class="md iz">urlConnection</strong>.getOutputStream());<br/>            BufferedWriter writer = <strong class="md iz">new </strong>BufferedWriter(<strong class="md iz">new </strong>OutputStreamWriter(<br/>                    out, <strong class="md iz">"UTF-8"</strong>));<br/>            writer.write(postData.toString());<br/>            writer.flush();<br/><br/>            <strong class="md iz">int </strong>code = <strong class="md iz">urlConnection</strong>.getResponseCode();<br/>            <strong class="md iz">if </strong>(code !=  200) {<br/>                <strong class="md iz">throw new </strong>IOException(<strong class="md iz">"Invalid response from server: " </strong>+ code);<br/>            }<br/>            BufferedReader rd = <strong class="md iz">new </strong>BufferedReader(<strong class="md iz">new </strong>InputStreamReader(<strong class="md iz">urlConnection</strong>.getInputStream()));<br/>            String line;<br/>            <strong class="md iz">while </strong>((line = rd.readLine()) != <strong class="md iz">null</strong>) {<br/>                Log.<em class="lx">i</em>(<strong class="md iz">"data"</strong>, line);<br/>            }<br/>        } <strong class="md iz">catch </strong>(Exception e) {<br/>            e.printStackTrace();<br/>        } <strong class="md iz">finally </strong>{<br/>            <strong class="md iz">if </strong>(<strong class="md iz">urlConnection </strong>!= <strong class="md iz">null</strong>) {<br/>                <strong class="md iz">urlConnection</strong>.disconnect();<br/>            }<br/>        }<br/>        <strong class="md iz">return null</strong>;<br/>    }<br/>}</span></pre><p id="9d18" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lx">MainActivity.java</em>:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="aa61" class="mh kv iy md b gy mi mj l mk ml"><strong class="md iz">public class </strong>MainActivity <strong class="md iz">extends </strong>AppCompatActivity {<br/><br/>    EditText <strong class="md iz">employeeNameET</strong>, <strong class="md iz">employeeSalaryET</strong>, <strong class="md iz">employeeAgeET</strong>;<br/>    Button <strong class="md iz">submitButton </strong>;<br/>    @Override<br/>    <strong class="md iz">protected void </strong>onCreate(Bundle savedInstanceState) {<br/>        <strong class="md iz">super</strong>.onCreate(savedInstanceState);<br/>        setContentView(R.layout.<strong class="md iz"><em class="lx">activity_main</em></strong>);<br/>        <strong class="md iz">employeeNameET </strong>= (EditText) findViewById(R.id.<strong class="md iz"><em class="lx">employeeName</em></strong>);<br/>        <strong class="md iz">employeeSalaryET </strong>= (EditText) findViewById(R.id.<strong class="md iz"><em class="lx">employeeSalary</em></strong>);<br/>        <strong class="md iz">employeeAgeET </strong>= (EditText) findViewById(R.id.<strong class="md iz"><em class="lx">employeeAge</em></strong>);<br/>        <strong class="md iz">submitButton </strong>= (Button) findViewById(R.id.<strong class="md iz"><em class="lx">submitId</em></strong>);<br/>        <strong class="md iz">submitButton</strong>.setOnClickListener(<strong class="md iz">new </strong>View.OnClickListener() {<br/>            @Override<br/>            <strong class="md iz">public void </strong>onClick(View view) {<br/>                <strong class="md iz">new </strong>HTTPPostRequest().execute();<br/>                Intent i = <strong class="md iz">new </strong>Intent(MainActivity.<strong class="md iz">this</strong>, MainActivity.<strong class="md iz">class</strong>);<br/>                startActivity(i);<br/>                finish();<br/>            }<br/>        });<br/>    }<br/><br/>    <strong class="md iz">private class </strong>HTTPPostRequest <strong class="md iz">extends </strong>AsyncTask&lt;Void, Void, Void&gt; {<br/>--------------<br/>-------------- <strong class="md iz">[SEE ABOVE - <em class="lx">Inner class HTTPPostRequest</em>]</strong><br/>--------------<br/>    }<br/>}</span></pre><p id="ad42" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">解释:</strong>当用户点击提交按钮时，execute()函数将被调用，这是一个异步方法。活动将被重新加载，现有页面将被函数 finish()销毁。然而，将启动一个并行线程，该线程将调用 FCF API 来发布数据，如图所示。应用程序将记录从 API 返回的响应，否则将抛出一个 IOException，如图所示。应用程序的行为由您的业务规则以及您希望应用程序在出错和成功时的行为决定。你可以根据需要修改你的代码。</p><h1 id="29c4" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第 3 步:运行应用程序和测试。</h1><p id="51f2" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我们的应用程序将看起来像这样。一旦您点击提交按钮，您的详细信息将通过 FCF 推送到数据库。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mm"><img src="../Images/84d98925a9b95c45f1834207cb08c218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PHTrQUQ3fITFbGHuacxBQ.png"/></div></div></figure><p id="1cba" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在在浏览器中打开你的链接，它会显示你刚才输入的数据(如果它是这样显示的话。我的情况是)。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mn"><img src="../Images/c4ebd21280d0c84350902eda6ed172de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6nibQ_d-8oxpnttYraQ9w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">从 FCF 的 GET 方法返回值。</figcaption></figure><p id="1e9f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经集成了来自 Android 的 FCF，为了增强您的项目，您可以通过使用 Android 中的 ListView 或 RecyclerView 来使用 GET 方法，以在您的应用程序中显示员工列表。</p><p id="7071" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">FCF 项目的 Git 代码。</p><div class="im in gp gr io ms"><a href="https://github.com/ahmedkhan1991/firebaseFunctionsAwsRdsIntegration" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iz gy z fp mx fr fs my fu fw ix bi translated">Ahmed Khan 1991/firebasefunctionsawsrds integration</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">Firebase 云功能 AWS RDS 集成。对 ahmedkhan 1991/firebasefunctionsawsrdsdintegration 做出贡献…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng iu ms"/></div></div></a></div><p id="af75" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看更多:<a class="ae kt" href="https://medium.com/dev-genius/firebase-cloud-functions-integration-with-aws-rds-database-947a383e2e0c" rel="noopener"> FCF 与 AWS RDS 数据库的集成</a></p><p id="6cb2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本教程中描述的 Android 项目的 Git 代码:</p><div class="im in gp gr io ms"><a href="https://github.com/ahmedkhan1991/androidFirebaseFunctionsIntegration" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iz gy z fp mx fr fs my fu fw ix bi translated">Ahmed Khan 1991/androidfirebasefunctions 集成</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">这个项目解释了如何在不使用 Firebase SDK 的情况下将 FIrebase 功能与 Android 集成。GitHub 是……</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nh l nd ne nf nb ng iu ms"/></div></div></a></div><p id="3b3a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">更多这样的教程，请关注我的 Medium。</p><p id="60b2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">快乐学习。</p></div></div>    
</body>
</html>