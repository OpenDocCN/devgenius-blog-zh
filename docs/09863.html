<html>
<head>
<title>Packetbeat with local Elasticsearch and Kibana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有本地弹性搜索和 Kibana 的打包套餐</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/packetbeat-with-local-elasticsearch-and-kibana-a7b26448a7cf?source=collection_archive---------8-----------------------#2022-09-18">https://blog.devgenius.io/packetbeat-with-local-elasticsearch-and-kibana-a7b26448a7cf?source=collection_archive---------8-----------------------#2022-09-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d3a0d553eda348da69287aa270b2fa06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QpdBM516FvHCha1B67-Yw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/@alinnnaaaa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿丽娜·格鲁布尼亚</a>在<a class="ae jz" href="https://unsplash.com/s/photos/network?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="261b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">什么是好人？欢迎回来😁。今天我们通过介绍弹性拍子来继续我们的发现。</p><p id="e6cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> Packetbeat </strong>是一个轻量级的网络数据发送器，可以与 Elasticsearch 结合使用，提供一个监控和分析应用程序性能的系统。它收集应用服务器之间的网络流量，解码应用层使用的协议(如<em class="ky"> HTTP </em>、<em class="ky"> MySQL </em>、<em class="ky"> Redis </em>等)，匹配请求和响应，并记录每个事务的相关信息。如文档中所述，"<em class="ky">它可以运行在自己的服务器上，也可以运行在应用程序所在的服务器上"</em>。目前，这些协议由 Packetbeat 支持:</p><ul class=""><li id="9f7b" class="kz la in kc b kd ke kh ki kl lb kp lc kt ld kx le lf lg lh bi translated">域名服务器(Domain Name Server)</li><li id="5cbf" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">超文本传送协议</li><li id="e522" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">一种数据库系统</li><li id="c632" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">卡桑德拉</li><li id="56ad" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">MongoDB</li><li id="a14f" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">节俭-RPC</li><li id="71f5" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">AMQP</li><li id="a800" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">坦克激光瞄准镜（Tank Laser-Sight 的缩写）</li><li id="c0a0" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">Memcache</li><li id="9fd5" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">关系型数据库</li><li id="119c" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">ICMP (v4 和 v6)</li><li id="fdc1" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">雷迪斯</li><li id="bb2a" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">DHCP (v4)</li><li id="d3f5" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">高级督察/社会发展计划(测试版)</li><li id="4de8" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">网络文件系统</li></ul><p id="1e72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于 Packetbeat 使您能够监视机器的网络连接，因此了解更多有关源和目标 IP 地址以及发送和接收的数据可能会很有用。</p><p id="a69b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在安装 Packetbeat 之前，确保您有 Elasticsearch 和 Kibana 的本地部署。如果不是这样，我推荐阅读<a class="ae jz" href="https://medium.com/@mhdabdel151/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e" rel="noopener">这篇文章</a>你会发现整个过程。</p><h2 id="7eb3" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">安装和配置</h2><p id="7308" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">至于本系列中已经涉及的其他 beats，你必须首先进入<a class="ae jz" href="https://www.elastic.co/downloads/beats/packetbeat" rel="noopener ugc nofollow" target="_blank">官方下载页面</a>才能获得与你的操作系统兼容的最新版本。下载完存档文件后，提取其内容并打开生成的文件夹。您将找到<code class="fe ml mm mn mo b">packetbeat.yml</code>文件，我们将在其中进行一些配置。</p><p id="2cac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:根据你的操作系统，你可能需要安装<code class="fe ml mm mn mo b">libpcap</code>数据包捕获库。更多详情请参考官方文件的<a class="ae jz" href="https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-installation-configuration.html#_before_you_begin" rel="noopener ugc nofollow" target="_blank">这一节</a>。因为本教程是在 Windows 系统上完成的，所以这一步是不必要的。</p><p id="a3c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以与之前相同的方式:在输出部分填写您的 Elasticsearch 的 URL、您的用户名和密码(<em class="ky">如果您的部署是安全的</em>)，可能是这样的:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="6b44" class="ln lo in mo b gy mx my l mz na">output.elasticsearch:   <br/>  hosts: ["http://localhost:9200"]   <br/>  username: "elastic"   <br/>  password: "<em class="ky">TYPE_HERE</em>"  <br/>  <em class="ky"># If using Elasticsearch's default certificate<br/>  </em>ssl:<br/>      enabled: true<br/>      ca_trusted_fingerprint:  "your_fingerprint"</span></pre><p id="18ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">指纹</em>是第一次启动 Elasticsearch 时生成的 CA 证书的十六进制编码 SHA-256。如果您丢失了它，不要惊慌，您总是可以使用以下命令找回它:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="9d5c" class="ln lo in mo b gy mx my l mz na">openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt</span></pre><p id="ca54" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令无法在 Windows 终端上运行，您需要下载并安装<a class="ae jz" href="https://git-scm.com/download/win" rel="noopener ugc nofollow" target="_blank"> Git </a>，打开<em class="ky"> Git CMD </em>并从 Elasticsearch 根文件夹运行该命令。</p><p id="b02b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要添加或修改要监控的协议，请转到<code class="fe ml mm mn mo b">packetbeat.protocols </code>部分，输入要监控的协议类型和相关端口，或者首次使用默认配置。</p><p id="1c8c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Packetbeat 还附带了一组实用程序来检查配置或连接是否到位。保存配置文件，并从根文件夹中依次运行以下命令:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="d560" class="ln lo in mo b gy mx my l mz na">./packetbeat test config<br/>./packetbeat test output</span></pre><p id="eec6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，要设置<strong class="kc io">资产</strong>来解析、索引和可视化您的数据，您可以运行以下命令:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="12c2" class="ln lo in mo b gy mx my l mz na">./packetbeat setup</span></pre><p id="2a77" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要启动 Packetbeat，只需运行:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="6860" class="ln lo in mo b gy mx my l mz na">./packetbeat -e</span></pre><p id="7975" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 Kibana 中，您现在可以通过过滤<code class="fe ml mm mn mo b">packetbeat-*</code>来查看在<strong class="kc io"> Discover </strong>中上传的网络日志。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ad302f680e2d12c458afbccdbecca8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzujq1f5iCOKGsx53DOymQ.png"/></div></div></figure><p id="6a89" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您还可以在<strong class="kc io">仪表板</strong>部分找到仪表板。在这里，我们可以检查 http 仪表板，它给出了所有带有状态代码的事务。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/5921613e4ad999a8592e5b87e5011701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IcZ3VgDYlPI6lvGTmBgpmQ.png"/></div></div></figure><p id="8b1e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天就到这里，请随意查看关于这个主题的<a class="ae jz" href="https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-installation-configuration.html#packetbeat-installation-configuration" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多细节。感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="2614" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们下次再见，看更多的帖子🚀。</p><p id="a039" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>