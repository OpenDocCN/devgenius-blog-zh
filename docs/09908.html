<html>
<head>
<title>Firebase Authentication With Custom Node.js+Express Backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自定义 Node.js+Express 后端进行 Firebase 身份验证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/firebase-authentication-with-custom-node-js-express-backend-2ae9c04571b5?source=collection_archive---------0-----------------------#2022-09-22">https://blog.devgenius.io/firebase-authentication-with-custom-node-js-express-backend-2ae9c04571b5?source=collection_archive---------0-----------------------#2022-09-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a9e82b4ccd9f4631853430b7afc4c614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YekydbdIgu_Ob322xu8Dg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">使用自定义 Node.js+Express 后端进行 Firebase 身份验证</figcaption></figure><p id="d13a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我将解释如何将<strong class="kb io"> Firebase 认证</strong>集成到<strong class="kb io"> React </strong>、<strong class="kb io"> Node.js </strong>和<strong class="kb io"> Express </strong>应用程序中。我们在使用 firebase 认证的时候，一般会使用云 Firestore 作为数据库，不需要后端。另一方面，您应该对 firebase 安全规则有一个正确的认识，以保护您的数据。但是在本文中，我使用 node express 后端。因此，如果您试图将 firebase 身份验证与自定义后端集成，我敢肯定这篇文章会对您有很大帮助。你可以在这里使用<a class="ae kx" href="https://github.com/Wanuja97/firebase-authentication-with-react-node-express-article" rel="noopener ugc nofollow" target="_blank">的全部源代码。</a></p><p id="4430" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">主要我们可以把我们的过程分成三个步骤，</p><p id="9b87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 01:</strong>react 应用程序中的 Firebase 验证。身份验证后，firebase 将向您发送一个用户对象，扣留 JWT 令牌。</p><p id="2b7e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤 02: 然后我们可以使用 JWT 令牌向我们后端发送 API 请求。</p><p id="61fd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 03: </strong>然后后端可以使用 JWT 令牌从 firebase 验证用户，如果用户通过验证，我们可以向前端发送数据，否则我们可以忽略从前端接收的请求。</p><p id="f1a8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以，让我们深入内容。</p><p id="6bd5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">01)创建 ReactJS 应用程序。</p><p id="3767" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">02)在 Firebase 控制台中创建一个 firebase 项目并激活身份验证。</p><p id="7045" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">03)在 react app 中添加并初始化认证 SDK。</p><p id="f58c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">04)前端的 Google 认证。</p><p id="ce8a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">05)创建后端(节点+快速)应用程序。</p><p id="711f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">06)从前端检索数据。</p><p id="3251" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">07)后端的 Firebase Admin SDK 配置。</p><p id="5457" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">08)创建中间件来验证访问令牌。</p><h1 id="717c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">01)创建 ReactJS 应用程序</h1><p id="6f00" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">众所周知，我从"<strong class="kb io">npx create-react-app your _ app _ name "</strong>命令开始。然后通过运行“<strong class="kb io"> npm run start </strong>”命令，您可以看到我们的 react 应用程序正在 localhost:3000 上运行。</p><h1 id="4b73" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">02)在 Firebase 控制台中创建一个 Firebase 项目并激活身份验证</h1><ol class=""><li id="4c4c" class="mb mc in kb b kc lw kg lx kk md ko me ks mf kw mg mh mi mj bi translated">现在去<a class="ae kx" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/</a>和去火基地<strong class="kb io">控制台</strong>。如果您没有 firebase 帐户，请确保在进入下一步之前创建一个帐户。</li></ol><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/8b1d1875f7fb2bafa4772f7e5571c2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELE2eU9N6FRD0SV7owin9g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">开始使用 firebase</figcaption></figure><p id="f99b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.现在创建一个新项目，并给它起一个你想要的名字。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/63f7eb26aa393ed1078cead400b15135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N3ZwW6h-LF5yc0j4jcXetg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在 firebase 中创建新项目</figcaption></figure><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/4607c136a3721efd97a08ce154750e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3aS4_ZgPyiKdtp3g106Exw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">通过给定项目名称来创建新项目</figcaption></figure><p id="a1f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.接下来，他们会要求在你的 firebase 项目中启用 google analytics，在这里你可以<strong class="kb io">选择你想要的选项</strong>。之后，创建项目。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/4c66ad9bb77bb95f5efa6a80cfc8f5f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seCfDmgWNYp7ilahOpYHjw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在 firebase 项目中启用谷歌分析</figcaption></figure><p id="f6f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.然后，您将被重定向到项目仪表板，现在我们需要创建一个应用程序。在这里，您可以创建一个 IOS、Android 或 Web 应用程序，因为我们将使用 ReactJS 应用程序，我选择了一个<strong class="kb io"> web </strong>应用程序。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/5c7e2a7296eb6d550f8a2f753a896c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*kiR-lMoVoujJi6CNkT87Lw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">选择应用程序类型</figcaption></figure><p id="bf75" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">5.之后，通过命名来注册你的应用程序。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/d31c1747d94d037af58b14f3ce6f4de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTTGOYQmFEi0cl3W32BouQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">注册 firebase 应用程序</figcaption></figure><p id="43ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">6.之后你会收到一个 firebase SDK 的详细信息如下。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/22725265e31d70a2da15b126bfd08bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uq2O2aTmBiaL0vuUf0_y8Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Firebase SDK</figcaption></figure><p id="5337" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">7.现在我们需要安装 firebase npm 包来反应应用程序。打开您的终端并运行下面的命令。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="67f9" class="mz kz in mv b gy na nb l nc nd">npm install firebase</span></pre><p id="ac18" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">8.之后，从上面的步骤中复制 SDK firebase 配置细节，然后继续到控制台。</p><p id="6441" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">9.然后，您将再次重定向到控制面板，然后选择“Authentication”选项卡。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/759033a5f162d2368ed94fc53342fe75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13kW1GTfVvgbNxyazurRYQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">证明</figcaption></figure><p id="014d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">10.现在，我们需要选择并启用需要集成到应用程序中的登录方法。在这里，我选择<strong class="kb io">谷歌签名方法</strong>进行演示。<strong class="kb io">(您可以根据需要选择任意数量的签到方式。)</strong></p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/678e0a263374ffcd93da20269a99bcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8KhR9OnL257kZxbOaG6XZQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">选择 Google 登录方式</figcaption></figure><p id="b0d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">11.在下一步中，通过给出适当的“<strong class="kb io">项目公开名称</strong>”和“<strong class="kb io">项目支持电子邮件</strong>”来启用该登录方法。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/b0330ea2fe5f8537cea2218b22c12c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjGVFqDx5Nnh0Hkty_jkxg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Google 登录配置</figcaption></figure><p id="b25e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">酷，现在我们已经在 firebase 中设置好了一切，现在我们需要将 firebase auth 添加到 react 应用程序中。</p><h1 id="8a5a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">03)在 react app 中添加并初始化认证 SDK</h1><p id="450b" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">1.在<strong class="kb io"> "src" </strong>文件夹下创建一个名为"<strong class="kb io"> config </strong>的文件夹，并在该 config 文件夹中创建一个<strong class="kb io"> firebase-config.js </strong>文件来添加 firebase SDK 配置。下图显示了我到目前为止的文件夹结构。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/bc98015e81283c2e8d76d05436e93caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*aYRd_7P2dvmBvNnpRW4syw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">文件夹结构— 1</figcaption></figure><p id="44c3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.然后将 firebase 配置复制并粘贴到<strong class="kb io"> firebase-config.js </strong>文件中。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="26f7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您在上一步中忘记复制上面的代码段，您可以通过下面的步骤获得它。</p><p id="2352" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">选择项目设置- &gt;选择常规选项卡- &gt;然后向下滚动，直到获得 SDK 设置和配置。</strong></p><p id="ca59" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.现在将那个<strong class="kb io"> firebase-config.js </strong>文件导入到<strong class="kb io"> index.js </strong>中。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="f3a0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.从现在开始，我们需要一步一步地遵循 firebase 文档。我总是建议您遵循这些有用教程的官方文档。<a class="ae kx" href="https://firebase.google.com/docs/auth/web/google-signin" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/auth/web/google-signin</a></p><p id="2018" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在 app.js 文件中删除不必要的东西，并添加一个简单的按钮，如下图所示。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/9665044f9aa2355064eadf22bdb066a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrl4U3AXXPkSk3nlTntgHw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">app.js 中的第一步</figcaption></figure><h1 id="2241" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">04)前端谷歌认证</h1><p id="6b8e" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">现在按照下面的步骤，对 app.js 进行必要的修改</p><p id="45fe" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 01:创建 Google provider 对象的实例:</strong></p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="bf98" class="mz kz in mv b gy na nb l nc nd">import {GoogleAuthProvider} from ‘firebase/auth’</span><span id="a240" class="mz kz in mv b gy nl nb l nc nd">const provider = new GoogleAuthProvider();</span></pre><p id="bad0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 02:指定您希望从身份验证提供者请求的附加 OAuth 2.0 范围。</strong></p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="7a42" class="mz kz in mv b gy na nb l nc nd">provider.addScope(‘https://www.googleapis.com/auth/contacts.readonly');</span></pre><p id="842d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 03:创建一个 auth 实例</strong></p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="8b94" class="mz kz in mv b gy na nb l nc nd">import { getAuth } from "firebase/auth";<br/>const auth = getAuth();</span></pre><p id="7d88" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 04:现在将下面的代码复制到 app.js 中</strong></p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="f582" class="mz kz in mv b gy na nb l nc nd"><strong class="mv io">signInWithPopup(auth, provider)<br/>   .then((result) =&gt; {<br/>     // This gives you a Google Access Token. You can use it to access the Google API.<br/>     const credential = GoogleAuthProvider.credentialFromResult(result);<br/>     const token = credential.accessToken;<br/>     // The signed-in user info.<br/>     const user = result.user;<br/>     // ...<br/>   }).catch((error) =&gt; {<br/>     // Handle Errors here.<br/>     const errorCode = error.code;<br/>     const errorMessage = error.message;<br/>     // The email of the user's account used.<br/>     const email = error.customData.email;<br/>     // The AuthCredential type that was used.<br/>     const credential = GoogleAuthProvider.credentialFromError(error);<br/>     // ...<br/>   });</strong></span></pre><p id="e041" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">按照上面的步骤操作后，app.js 文件会是这样的。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="6a37" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注意:</strong>我已经创建了一个名为<strong class="kb io">signingwithggoogle</strong>的独立方法，当我单击登录按钮时调用这个方法。</p><p id="b50b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在浏览器中单击登录按钮，检查您是否可以登录。如果您无法登录，请检查<a class="ae kx" href="https://github.com/Wanuja97/firebase-authentication-with-react-node-express-article" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">源代码</strong> </a> <strong class="kb io"> </strong>并检查您的错误。</p><p id="4a81" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 04:现在将访问令牌存储在会话存储器中。</strong></p><p id="ae07" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">用户登录后，提取访问令牌，并将其设置在会话存储中。这里我还使用了一个 useState 来跟踪用户的身份验证状态。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="5fdb" class="mz kz in mv b gy na nb l nc nd">const [authorizedUser,setAuthorizedUser] = useState(false || sessionStorage.getItem("accessToken"));</span></pre><p id="3f20" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在<strong class="kb io">登录谷歌</strong>的方法里面</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="c423" class="mz kz in mv b gy na nb l nc nd">if(user){</span><span id="879e" class="mz kz in mv b gy nl nb l nc nd">user.getIdToken().then((<em class="nm">tkn</em>)=&gt;{</span><span id="a2c8" class="mz kz in mv b gy nl nb l nc nd"><em class="nm">// set access token in session storage</em></span><span id="8176" class="mz kz in mv b gy nl nb l nc nd">sessionStorage.setItem("accessToken", <em class="nm">tkn</em>);</span><span id="7c36" class="mz kz in mv b gy nl nb l nc nd">setAuthorizedUser(true);</span><span id="d0b8" class="mz kz in mv b gy nl nb l nc nd">})}</span></pre><p id="c356" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我要做的是，在授权用户之后，我要显示一个字符串(“授权用户”)。该字符串仅在用户登录时可见。</p><p id="41d5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在 render 方法内部，</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="bee3" class="mz kz in mv b gy na nb l nc nd">&lt;div <em class="nm">className</em>="App"&gt;</span><span id="cb88" class="mz kz in mv b gy nl nb l nc nd">{authorizedUser ? (</span><span id="bf65" class="mz kz in mv b gy nl nb l nc nd">&lt;&gt;&lt;p&gt;Authorized user&lt;/p&gt;&lt;/&gt;</span><span id="19f9" class="mz kz in mv b gy nl nb l nc nd">): (</span><span id="2d36" class="mz kz in mv b gy nl nb l nc nd">&lt;&gt;&lt;button <em class="nm">onClick</em>={signInwithGoogle}&gt;SignWithGoogle&lt;/button&gt;&lt;/&gt;)}</span><span id="992c" class="mz kz in mv b gy nl nb l nc nd">&lt;/div&gt;</span></pre><p id="235b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">按照上面的步骤，创建注销函数后，我们的 app.js 会是这样的。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1294" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们转到后端。</p><h1 id="8fc0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">05)创建后端(节点+快速)应用程序。</h1><p id="9d0f" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">在根文件夹中，我创建了一个名为“backend”的新文件夹，在该文件夹中，使用以下命令创建 package.json 文件。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="b083" class="mz kz in mv b gy na nb l nc nd">npm init</span></pre><p id="3ef1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，安装<strong class="kb io">通过使用以下命令表达</strong>、<strong class="kb io"> cors </strong>、<strong class="kb io"> nodemon、</strong>和<strong class="kb io"> firebase-admin </strong>依赖项。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="5f61" class="mz kz in mv b gy na nb l nc nd">npm i express firebase-admin cors nodemon</span></pre><p id="c468" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后，在根目录中，我创建了一个 index.js 文件，在该文件中，我创建了我们的基本 express 应用程序。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e88f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，将下面两个脚本命令添加到 package.json 文件中。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="8e4a" class="mz kz in mv b gy na nb l nc nd">"scripts": {</span><span id="d4d3" class="mz kz in mv b gy nl nb l nc nd">"dev": "nodemon index.js",</span><span id="5b44" class="mz kz in mv b gy nl nb l nc nd">"start": "node index.js"</span><span id="aa0b" class="mz kz in mv b gy nl nb l nc nd">},</span></pre><p id="f599" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，您可以使用下面的命令检查该应用程序是否正在运行，并且服务器将在端口 5000 上运行。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="787d" class="mz kz in mv b gy na nb l nc nd">npm run dev</span></pre><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/de3e4b7979ec96bc12838108f44333af.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*mJVxL0SYubEW3QGKfZbyDQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">本地主机:5000</figcaption></figure><p id="c99d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在 index.js 中，我创建了一个新的端点<strong class="kb io"> '/api/tasks' </strong>来发送一组任务(JSON 对象的数组)。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="2d49" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">06)从前端检索数据。</h1><p id="f38d" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">现在让我们回到 react 应用程序并检索那些数据(任务)。</p><p id="99aa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要向后端端点发送请求，我们需要安装 Axios npm 包。通过使用以下命令，在 react 应用程序中安装 Axios。</p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="494f" class="mz kz in mv b gy na nb l nc nd">npm install axios</span></pre><p id="7e72" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了提高可读性，我创建了一个单独的组件(Tasks.jsx)来显示这些任务，在 Tasks 组件中，我做了以下事情来从后端检索数据。</p><p id="8fe3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">01)首先导入 Axios。</p><p id="4524" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">02)通过 props 将访问令牌传递给任务组件。</p><p id="1b87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">03)创建一个方法，通过发送授权头从后端获取数据。</p><p id="9614" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">04)从 useEffect 钩子内部调用声明的方法。</p><p id="2685" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">05)将检索到的任务存储在使用状态中。</p><p id="19d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">06)最后使用地图功能，我们将显示任务。</p><p id="058f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">完成上述步骤后，我们的任务组件将如下所示。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="87f7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后将这个组件导入到 app.js 文件中，并将传递的访问令牌作为道具。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="73ac" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你回到 localhost:3000，你可能会看到我们从后端取回的任务。</p><p id="e290" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我们需要做的是，我们<strong class="kb io">需要保护我们的后端路由</strong>。如您所见，在最后一步中，我们能够直接访问<strong class="kb io"> '/api/tasks' </strong>路径。因此，我们需要在将数据发送到前端之前对用户进行授权。为此<strong class="kb io">我们需要创建一个中间件</strong>。正如我前面提到的，当客户端发送带有访问令牌的请求时，我们通过与 firebase 通信从后端授权令牌。</p><h1 id="f2e1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">07)后端的 Firebase Admin SDK 配置。</h1><p id="af9f" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">转到 firebase 控制台，单击项目设置。然后选择<strong class="kb io">服务账户</strong>选项卡。然后您将看到<strong class="kb io"> Admin SDK 配置</strong>片段。从那个<strong class="kb io">中选择 node.js </strong>和<strong class="kb io">复制片段</strong>。</p><p id="cabf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意:在下一步中，我们必须生成一个新的私钥，所以不要关闭选项卡。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/6d62cd05eccb35b7d1ce05ef34b50c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gq1B3RjQ1vX2X5eqSFqy0w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">后端的 Firebase Admin SDK 配置</figcaption></figure><p id="1005" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我们的 express 应用程序(后端)中，我正在创建一个<strong class="kb io"> firebase-config.js </strong>文件，如下所示。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/eea048ff4d5890583d994384b9707292.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*CcuHkAgEzeREwrKd0iaU9A.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">后端文件夹结构— 1</figcaption></figure><p id="da29" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后在那个<strong class="kb io">firebase-config . js fil</strong>e 里面，粘贴上一步复制的代码片段。然后像我们通常做那样导出该模块。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a1e7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在再次返回到 firebase 控制台并<strong class="kb io">生成一个新的私钥。然后将 JSON 文件下载到您后端。我已经把它下载到了<strong class="kb io"> Backend/src/config </strong>目录下，并重新命名为<strong class="kb io"> ServiceAccount.json. </strong></strong></p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/4f57b038653903c470ed15c9c3e81f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*adsh1uV0QbIlIyBrrkOS4g.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">后端文件夹结构— 2</figcaption></figure><p id="b28f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注意:</strong>这个 ServiceAccount.json 文件包含关于 firebase 项目的机密细节。所以，当你在部署或者推送 GitHub 的时候，别忘了把它添加到<strong class="kb io"> <em class="nm">里。gitignore </em> </strong>。</p><h1 id="9cba" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">08)创建中间件来验证访问令牌。</h1><p id="6fef" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">在后端的<strong class="kb io"> src </strong>文件夹中创建一个名为 middleware 的文件夹。在该文件夹中创建另一个名为<strong class="kb io"> index.js </strong>的文件。</p><p id="7692" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">将下面的代码复制并粘贴到该文件中。</p><figure class="ml mm mn mo gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e5de" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第 4 行的解释:</strong>如果我们观察我们从前端发送的授权头，它看起来像这样。</p><p id="f66c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">授权:“无记名 eyjhbgcioijsuzi 1 niissimtpzci 6…………”</strong></p><p id="643b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，我们需要从这个字符串中提取访问令牌。为了做到这一点，我们首先从空格(“”)中分离字符串，然后我们将收到一个类似这样的数组。</p><p id="7973" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> ['来人'，' eyjhbgcioijsuzi 1 niissimtpzci 6……….. '] </strong></p><p id="6b79" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">由此，我们需要获得第二个元素来获得令牌。</p><p id="41f3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第 4 行的解释:</strong>通过使用 firebase admin 验证令牌</p><p id="621a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第 7–10 行解释:</strong>如果解码值有效，将允许下一个过程。</p><p id="a428" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第 12 行解释</strong>:如果解码值无效，将终止下一个进程，并抛出错误。</p><p id="dd15" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">最后一步，我们需要在 index.js 文件中<strong class="kb io">调用这个中间件。在这里我把这个中间件称为全局中间件，这意味着当我们试图攻击任何端点时，这个中间件都会被触发，并检查前端发送的访问令牌是否有效。如果有效，将允许相关请求。</strong></p><pre class="ml mm mn mo gt mu mv mw mx aw my bi"><span id="7d73" class="mz kz in mv b gy na nb l nc nd">const middleware = require('./src/middleware/index');<br/>app.use(middleware.decodeToken);</span></pre><p id="7da5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Booom！！我们做到了。从后端接收数据后，您可以看到我们的 react 应用程序，如下所示。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/1c464a0623cf066503b7847489703713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*9S6u32ayfTZDMMQNhR3OmQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">授权用户视图</figcaption></figure><h1 id="e447" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="8e31" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">这就是如何将 firebase 身份验证集成到 react node express 应用程序中。希望它值得一读，如果是这样，请考虑在社交媒体上分享这篇文章，如果你有任何建议，请留下评论。我喜欢收到你的来信。</p><p id="c6d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢你阅读❤️.</p><p id="0462" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你喜欢这篇文章，你可以通过<a class="ae kx" href="https://www.buymeacoffee.com/wanuja18" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a>来支持我。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/wanuja18"><div class="gh gi ns"><img src="../Images/9acaec23525c99684c2aff97441d3091.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*Ao6zimYNe8zmoRex3w71VA.png"/></div></a><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">给我买杯咖啡</figcaption></figure><h1 id="0d18" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">源代码</h1><p id="954e" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated"><a class="ae kx" href="https://github.com/Wanuja97/firebase-authentication-with-react-node-express-article" rel="noopener ugc nofollow" target="_blank">https://github . com/wan uja 97/firebase-authentic ation-with-react-node-express-article</a></p><h1 id="9ad9" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">参考</h1><p id="0c82" class="pw-post-body-paragraph jz ka in kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ig bi translated">01)官方 Firebase 文档—<a class="ae kx" href="https://firebase.google.com/docs/auth/web/google-signin" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/auth/web/google-signin</a></p></div></div>    
</body>
</html>