<html>
<head>
<title>Cleanup a Search result file using Python and Adobe Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Adobe Analytics 清理搜索结果文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/cleanup-a-search-result-file-using-python-and-adobe-analytics-dc27153fa8c3?source=collection_archive---------11-----------------------#2022-10-21">https://blog.devgenius.io/cleanup-a-search-result-file-using-python-and-adobe-analytics-dc27153fa8c3?source=collection_archive---------11-----------------------#2022-10-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="77f6" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">从每周搜索数据集中删除所有非 ascii 字符</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/db2210fdee4744d01ee118cc79ff31c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*og2pNNjnlhadTdY7s-SxRA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">这是我们的文件现在的样子</figcaption></figure><h1 id="b0bc" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">索引</strong></h1><ol class=""><li id="bc5d" class="ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">为什么这是一个问题？<br/> 2。我从哪里得到数据？<br/> 3。为什么不 Excel？<br/> 4。如果不是 excel，那么是什么和如何？<br/> 5。如何使这个脚本易于跨设备执行？</li></ol><blockquote class="lm ln lo"><p id="c4ec" class="lp lq lr kw b kx ls lt lu kz lv lw lx ly lz ma mb mc md me mf mg mh mi mj lh ig bi translated">Y <!-- -->您可以在:<a class="ae mk" href="https://github.com/abhraliteyaars/search_cleanup.git" rel="noopener ugc nofollow" target="_blank">https://github.com/abhraliteyaars/search_cleanup.git</a>中找到搜索文件的样本副本以及代码和输出文件</p></blockquote><h1 id="dc7a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak"> 1。为什么这是一个问题？</strong></h1><p id="10ab" class="pw-post-body-paragraph lp lq in kw b kx ky lt lu kz la lw lx lb ml ma mb ld mm me mf lf mn mi mj lh ig bi translated"><strong class="kw io">背景:</strong>我所在组织的搜索团队每周都会对流行的搜索词进行分析。此分析的参数之一是了解一个搜索项在一周内被所有搜索项搜索的百分比。例如下面的快照。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/563805be84390b857e7d98dab6aa417b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*2HCWHOC1DdQYtFW7lQhDfw.png"/></div></figure><p id="203e" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">此外，该团队通过比较几周内的%列来监控该搜索词的健康状况。</p><p id="d92f" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated"><strong class="kw io">问题:</strong>团队注意到，我们的网站有时也允许奇怪的搜索，这些搜索与产品/优惠甚至页面都没有关系。例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/497e777cc0b5be97df7ced2857ed9556.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*06sjZOTro9EoXKKf_yEzHg.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">按作者</figcaption></figure><p id="466e" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">由于这些术语进入了我们的最终数据集，我们最终错误地计算了流行搜索术语的百分比。</p><p id="bdc5" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">此外，由于存在大量这样的垃圾条目，这不必要地消耗了我们的数据湖中的空间。</p><p id="a457" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">因此，任务是在将文件发送给搜索管理团队之前清除所有这样的值。</p><h1 id="e51d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">我从哪里获得数据？</h1><p id="93f5" class="pw-post-body-paragraph lp lq in kw b kx ky lt lu kz la lw lx lb ml ma mb ld mm me mf lf mn mi mj lh ig bi translated">数据将从 Adobe Analytics 数据仓库中提取。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/8c71c3dcdf73fee32db25279c3e531c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*b-8Y9P8hHjligr5Mk0ej5g.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">获取这些数据的数据仓库模板</figcaption></figure><blockquote class="lm ln lo"><p id="2d19" class="lp lq lr kw b kx ls lt lu kz lv lw lx ly lz ma mb mc md me mf mg mh mi mj lh ig bi translated">在我们的 Adobe analytics 设置中，我们在 evar 中捕获搜索词，搜索是一个事件。这个模板给出了搜索词 evar 在一个搜索事件中出现的次数，换句话说，就是一个搜索词被搜索了多少次。</p></blockquote><h1 id="b432" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">为什么不 Excel？</h1><p id="42ef" class="pw-post-body-paragraph lp lq in kw b kx ky lt lu kz la lw lx lb ml ma mb ld mm me mf lf mn mi mj lh ig bi translated">我们的搜索词报告的典型每周文件超过 4 GB，包含超过 300 万个行项目。Excel 无法处理这么大的量。</p><h1 id="b55b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">如果不是 excel，那么是什么和如何？</h1><p id="056a" class="pw-post-body-paragraph lp lq in kw b kx ky lt lu kz la lw lx lb ml ma mb ld mm me mf lf mn mi mj lh ig bi translated">我们将使用 Python 和 Pandas 库来处理数据帧中如此大的数据集，以便于转换和编码。</p><p id="6a1f" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">我们将从导入必要的 Numpy 和 Pandas 库开始。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="06dd" class="na jl in mw b gy nb nc l nd ne">import pandas as pd<br/>import numpy as np</span></pre><p id="d4e1" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">我们将阅读我们的搜索文件，目前是一个 csv 格式。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="3e58" class="na jl in mw b gy nb nc l nd ne">df=pd.read_csv('Search_report_10_10.csv')<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/db2210fdee4744d01ee118cc79ff31c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*og2pNNjnlhadTdY7s-SxRA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">这是我们的文件现在的样子</figcaption></figure><p id="bf72" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">或者，如果您希望输入的用户输入文件作为输入，请使用以下命令:</p><pre class="kj kk kl km gt mv mw nf bn ng nh bi"><span id="4da2" class="ni jl in mw b be nj nk l nl ne">data_source=input('File name ')<br/>df=pd.read_csv(data_source)</span></pre><p id="2cd6" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">如果你想知道我为什么要考虑这个，看看这个博客:</p><p id="b975" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">我们将重命名我们的搜索词列，因为搜索词(evar18)太大，不能在代码中使用</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="588b" class="na jl in mw b gy nb nc l nd ne">df.rename(columns = {'Search Term (evar18)':'Search Term'}, inplace = True)<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f9292bab8fad984fd35f8c52c186be64.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*NGU7I4kq9G9AHjYUxflDRA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">具有重命名列的新 df</figcaption></figure><p id="cf76" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">目前我的搜索词被解释为一个对象</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nn"><img src="../Images/02e00418155e1b3dd01991541314edef.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*feY2GggTv7aregJRYLdvvw.png"/></div></div></figure><p id="7ec2" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">需要将其更改为 string 以应用下一组逻辑。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="3e99" class="na jl in mw b gy nb nc l nd ne">df[‘Search Term’]=df[‘Search Term’].values.astype(‘str’)</span></pre><p id="4b4b" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">我们将创建一个新列，其目的是根据搜索项列中的条目是否包含任何非 ascii 字符来存储真/假值。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="bf27" class="na jl in mw b gy nb nc l nd ne">df["asc"]=np.nan<br/>df["asc"]=df["asc"].astype('boolean')</span></pre><p id="d5ff" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">第一行创建列，并将其初始化为一个<a class="ae mk" href="https://www.educba.com/numpy-nan/" rel="noopener ugc nofollow" target="_blank">占位符。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/66323ddb94fe47ca87a0fb58f943ee96.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*HXFKVwAG-jiU1dvWhXYZuw.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">这是 df 现在的样子</figcaption></figure><p id="10b5" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">接下来，我们将遍历数据集，检查每个搜索词是 ascii 还是非 ascii。结果(真/假)将存储在我们启动的“asc”栏中。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="ed31" class="na jl in mw b gy nb nc l nd ne">for i in df.index:<br/>    b=df['Search Term'].iloc[i].isascii()<br/>    df['asc'].iloc[i]=b</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/bd5e691714dac8fe9f2625b22be53c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*n6NKbx6SblEDWehP1jCwmw.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">这是 df 现在的样子</figcaption></figure><p id="358b" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">但这还不够。从现在开始我们需要三样东西:</p><ol class=""><li id="47e7" class="ku kv in kw b kx ls kz lv lb nq ld nr lf ns lh li lj lk ll bi translated">对真与假的计数，以估计每周有多少垃圾搜索发生。</li></ol><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="d79c" class="na jl in mw b gy nb nc l nd ne">display(df['asc'].value_counts())</span></pre><p id="a207" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">此样本文件的结果计数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/65c472433928fadd80a47c279a6f1fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*LDEEAgcXT58EK_d4YmS0zQ.png"/></div></figure><p id="c0b3" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">2.创建一个只包含垃圾搜索词的文件</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="54d1" class="na jl in mw b gy nb nc l nd ne">df1=df.loc[df['asc'] == False]<br/>df1.to_csv('Garbage file')</span></pre><p id="2e2c" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">垃圾文件快照. csv</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/f48f92271becae7292ad1048717b7f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*z-mmZwpKLJOFyfPVnQ_JeQ.png"/></div></figure><p id="bdde" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">3.创建一个只包含干净搜索词的文件</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5e36" class="na jl in mw b gy nb nc l nd ne">df2=df.loc[df['asc'] == True]<br/>df2.to_csv('Clean file')</span></pre><p id="c69a" class="pw-post-body-paragraph lp lq in kw b kx ls lt lu kz lv lw lx lb lz ma mb ld md me mf lf mh mi mj lh ig bi translated">clean file.csv 的快照</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/2a3e0c908b426ccd0c292f0bd9162a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*EBvpiw_lB7fl5uAqBrvEww.png"/></div></figure><h1 id="10f9" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">如何使这个脚本易于跨设备执行？</h1><p id="ce67" class="pw-post-body-paragraph lp lq in kw b kx ky lt lu kz la lw lx lb ml ma mb ld mm me mf lf mn mi mj lh ig bi translated">我会写一篇单独的文章来讨论这是怎么回事。ipynb 文件可以转换成. py 文件，然后转换成. exe 文件，这样任何没有 python 的人都可以运行它。在此之前，请订阅我的帖子，以便不断获得提醒！数据清理愉快:)</p><h1 id="319d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">参考资料:</h1><div class="nw nx gp gr ny nz"><a href="https://www.educba.com/numpy-nan/" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd io gy z fp oe fr fs of fu fw im bi translated">NumPy NaN |在 Python 中使用 NumPy NaN 的示例</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">在 Python 中，NumPy NAN 代表的不是数字，它被定义为声明数值的替代…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">www.educba.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ko nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://www.rapidtables.com/code/text/ascii-table.html" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd io gy z fp oe fr fs of fu fw im bi translated">ASCII 表</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">ASCII(美国信息交换标准码)字符代码图表，包括十进制、十六进制、二进制、HTML 和…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">www.rapidtables.com</p></div></div></div></a></div></div></div>    
</body>
</html>