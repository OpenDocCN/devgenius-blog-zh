<html>
<head>
<title>Hibernate Tutorial — 2. Context &amp; Entity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hibernate 教程— 2。上下文和实体</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/hibernate-tutorial-2-context-entity-593b828f4f28?source=collection_archive---------7-----------------------#2020-08-02">https://blog.devgenius.io/hibernate-tutorial-2-context-entity-593b828f4f28?source=collection_archive---------7-----------------------#2020-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/335838d55f666df948fdd357dbb82dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpuMLl-dPSakv4IK2wAUkA.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">卢博·米纳尔在<a class="ae ja" href="https://unsplash.com/s/photos/mountain-view?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><div class=""/><p id="9005" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇文章中，我将尝试解释在 Hibernate 的 ORM 技术中使用的上下文和实体术语。我还将尝试解释在 Hibernate 中管理实体的基础知识。</p><p id="3a34" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在软件开发中<strong class="kc je">持久性</strong>是一个术语，指的是即使在应用程序不再运行后信息仍然存在。<strong class="kc je">持久化</strong> <strong class="kc je">上下文</strong>在 Hibernate 中是与应用程序和数据库之间要管理的对象相关的信息。</p><p id="dd48" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Hibernate 通过了解对象的状态及其与持久性存储的关系来管理持久性上下文中对象的生命周期。持久性上下文充当应用程序和数据库之间的过渡层，一旦事务在应用程序中提交，更改就会应用到数据库。</p><p id="dd72" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上下文中的托管对象称为实体。在持久性上下文中有 4 种实体状态。</p><ul class=""><li id="9323" class="ky kz jd kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated"><strong class="kc je"> new </strong>或<strong class="kc je"> transient: </strong>这是对象的初始状态，数据库中还没有该对象的表示。</li><li id="2729" class="ky kz jd kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><strong class="kc je">托管</strong>或<strong class="kc je">持久:</strong>在这种状态下，实体与上下文相关联，实体代表一个数据库表行。</li><li id="30b7" class="ky kz jd kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><strong class="kc je">分离:</strong>在这种状态下，实体在数据库中仍然有一个表示，但是它不受任何上下文的管理。这通常发生在我们关闭会话或清除其缓存时。对数据所做的更改不会影响数据库，因为实体不受任何上下文的管理。</li><li id="e63b" class="ky kz jd kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><strong class="kc je">移除:</strong>在此状态下，<strong class="kc je"/><strong class="kc je"/>实体被管理上下文标记为从数据库中移除。</li></ul><p id="464d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们如何在 Hibernate 中创建实体？</p><p id="276d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将@Entity 注释添加到类中会将类指定为一个实体，并使类的实例可被持久性上下文发现和管理。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="9ec9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们向产品类添加一个 id、一个名称和一个价格属性。对于每个实体，我们必须定义一个惟一的标识符，这个标识符字段在我们的实体类中用@Id anotation 通知。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="d44a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要在数据库中创建相应的表(例如 MySQL ),其中包含 id、名称和价格字段。然后我们还需要将 id 定义为主键。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="4a9b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以创建我们的产品并将其添加到我们的数据库中。首先，我们创建 EntityManagerFactory 和 EntityManager。为了用 Hibernate 进行数据库操作，我们需要在数据库保存操作之前启动一个事务，在操作之后我们需要提交我们的更改。没有任何提交，更改将不会应用。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="4101" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">代码运行后，我们的产品成功添加到数据库中。<em class="ls"> persist() </em>方法将实体的状态从瞬态更改为持久，并将实体添加到要管理的持久上下文中。同样的操作也可以用<em class="ls"> save() </em>方法来完成，但是<em class="ls"> persist() </em>是来自 JPA (Java Persistence API)规范的方法，而<em class="ls"> save() </em>来自 Hibernate。它们之间有一些次要的实现细节，但主要区别是<em class="ls"> save() </em>方法不能用于其他 JPA 实现。</p><p id="21e1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我们可以选择我们的产品并展示其细节。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="dd29" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ls"> find() </em>方法将根据产品的主键从托管实体的上下文中检索产品。</p><p id="d83d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还可以通过从持久性上下文中获取产品，并通过更改所需的属性来更新我们的产品。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="cb89" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">提交后，更新查询将在数据库中执行，我们的产品将有新的价格。</p><p id="0595" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">数据的删除可以通过<em class="ls"> remove() </em>方法来处理。</p><figure class="lm ln lo lp gt ip"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="c587" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">提交后，从上下文中选择的产品将从数据库中删除。请注意，持久化、更新和删除操作必须在事务中处理，否则这些操作将不会被应用。</p></div></div>    
</body>
</html>