<html>
<head>
<title>Making HTTP Requests with React Query — Parallel and Dependent Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Query发出HTTP请求—并行和相关查询</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-parallel-and-dependent-queries-c98cea079c3?source=collection_archive---------4-----------------------#2021-06-05">https://blog.devgenius.io/making-http-requests-with-react-query-parallel-and-dependent-queries-c98cea079c3?source=collection_archive---------4-----------------------#2021-06-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e23954c662c5181bfd5d8f7a59873adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uMNsXeqpSFf8x9_d"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@paulius005?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Paulius Dragunas </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8abd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React查询库让我们可以在React应用程序中轻松地发出HTTP请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query发出HTTP请求。</p><h1 id="c836" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">并行查询</h1><p id="c649" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有时，我们可能希望同时发出多个GET请求。</p><p id="7376" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以添加多个<code class="fe me mf mg mh b">useQuery</code>挂钩:</p><p id="800f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5adb" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="12ae" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient();</span><span id="5405" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="1c48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d6e0" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery({<br/>    queryKey: ["todo", 1],<br/>    queryFn: ({ queryKey: [, id] }) =&gt; {<br/>      return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>    }<br/>  });<br/>  const { data: yesNoData } = useQuery("yesNo", () =&gt;<br/>    axios("https://yesno.wtf/api")<br/>  );</span><span id="d635" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>      &lt;div&gt;{JSON.stringify(yesNoData)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="44a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">useQuery</code>钩子来并行发出2个请求。</p><h1 id="ffc4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用<code class="fe me mf mg mh b">useQueries Hook</code>进行动态并行查询</h1><p id="2eee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">useQueries</code>钩子添加动态并行查询。</p><p id="faca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一组查询结果。</p><p id="a6c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="766c" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQueries } from "react-query";<br/>export default function App() {<br/>  const todos = useQueries(<br/>    Array(5)<br/>      .fill()<br/>      .map((_, i) =&gt; i + 1)<br/>      .map((id) =&gt; {<br/>        return {<br/>          queryKey: ["todo", id],<br/>          queryFn: ({ queryKey: [, id] }) =&gt; {<br/>            return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>          }<br/>        };<br/>      })<br/>  );</span><span id="f84a" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(todos)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="8767" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用一组查询对象调用<code class="fe me mf mg mh b">useQueries</code>。</p><p id="b3a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">map</code>来映射我们创建的数字数组:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e8d0" class="mq lc iq mh b gy mr ms l mt mu">Array(5)<br/>  .fill()<br/>  .map((_, i) =&gt; i + 1)</span></pre><p id="8f59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来查询对象。</p><p id="3c40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">todos</code>是查询对象的数组。</p><h1 id="039f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">相关查询</h1><p id="791c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以发出多个相互依赖的HTTP请求。</p><p id="fa10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f971" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data: id } = useQuery("id", () =&gt; Promise.resolve(1));</span><span id="1604" class="mq lc iq mh b gy mv ms l mt mu">  const { data } = useQuery(<br/>    ["todo", id],<br/>    ({ queryKey: [, id] }) =&gt; {<br/>      return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>    },<br/>    {<br/>      enabled: Boolean(id)<br/>    }<br/>  );</span><span id="3ace" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="44d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">进行一个接一个的查询。</p><p id="e53b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用第一个<code class="fe me mf mg mh b">useQuery</code>钩子来为我们的todo获取一个<code class="fe me mf mg mh b">id</code>。</p><p id="06d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们再次调用<code class="fe me mf mg mh b">useQuery</code>将<code class="fe me mf mg mh b">id</code>传递给回调函数。</p><p id="44f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">enabled</code>属性设置为一个布尔表达式，以指示我们希望查询何时运行。</p><p id="6ed7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将它设置为当<code class="fe me mf mg mh b">id</code>为真时运行第二个查询，这应该只发生在我们从第一个<code class="fe me mf mg mh b">useQuery</code>钩子得到<code class="fe me mf mg mh b">id</code>的时候。</p><h1 id="65a8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="7563" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用React Query轻松地进行并行或顺序查询。</p></div></div>    
</body>
</html>