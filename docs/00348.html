<html>
<head>
<title>Polyjuice! My First ML Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Polyjuice！我的第一个ML项目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/polyjuice-my-first-ml-project-76a72783a261?source=collection_archive---------8-----------------------#2020-06-03">https://blog.devgenius.io/polyjuice-my-first-ml-project-76a72783a261?source=collection_archive---------8-----------------------#2020-06-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="3683" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Faceswap应用程序。</p><p id="1fd9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">顾名思义，我的确是个陶工头。所以对于所有得到参考的人来说，无论你属于哪个宫位，都+5分。</p><p id="f723" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个项目的主要动机是在一家专注于机器学习的公司的实习应用程序中使用它。</p><p id="eff4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可惜我没有通过最后一关的筛选。你可能想知道为什么我仍然选择分享这个项目，如果它没有好的结果。嗯，即使这个项目没有得到100分；我学到的经验和技巧在未来的项目中仍然有用。<strong class="jm io">因为</strong>，<strong class="jm io">这条路并不止于此。</strong></p><p id="fb40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">那么，我的项目是做什么的？</strong></p><p id="2d14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个项目的目的是在一个持续大约10秒钟的视频中把我的脸和丹尼尔·雷德克里夫的脸互换。这就是为什么我选择把它命名为“Polyjuice”；有什么更好的名字能让我的脸和那个活着的男孩的脸互换呢？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/6f90b52cd6947bb0df5e9085ebc5c38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*sZdFe5jaNlHYqASkN2DUKQ.png"/></div></figure><p id="3fe7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">视频看起来怎么样？</strong></p><p id="72df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">给你！视频链接:<a class="ae kq" href="https://www.youtube.com/watch?v=ESai9lKWcl0" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=ESai9lKWcl0</a>尽情嘲笑我创造的怪物吧。我知道我做到了。</p><p id="98df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么…这篇文章的前言到此为止，现在让我们进入实质性的部分。</p><h1 id="3e88" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">数据收集</h1><p id="3576" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">在最初的测试没有产生足够好的结果之后，这个项目实际上经历了一个重大的改变。</p><p id="b8d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个项目的第一个版本试图把我的脸换成哈利波特的脸，当时我还戴着眼镜。我戴眼镜的脸和哈利波特戴眼镜的脸。</p><p id="2a4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，该模型不能很好地概括，观察到的结果很差。为了简单起见，我决定把我不戴眼镜的脸换成丹尼尔·雷德克里夫的脸。</p><p id="ac3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">我的脸:1318张图片</strong></p><p id="ab12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">收集我自己的面孔很容易。我只需要使用手机上的自拍相机，就可以轻松地收集到1318张照片。</p><p id="1a6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">丹尼尔·雷德克里夫的脸:1045张图片</strong></p><p id="a14a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于我的目标的脸，我收集了大约1045张丹尼尔·雷德克里夫的照片。我所做的是裁剪电影中他没有戴眼镜的场景的照片。我认为应该有更好的方法来收集照片，但这是我想到的。</p><p id="4736" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">后来，我将这些图片的尺寸调整为64x64，这样它们就能适合我选择的型号。</p><h1 id="affc" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">型号选择</h1><p id="615d" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">faceswap技术背后的一般原理是具有一个编码器和两个解码器A和b。编码器的目标是学习权重以产生输入图像的压缩版本(潜在矩阵);而解码器对于每个面部的目标是在给定潜在矩阵的情况下重建输入面部。</p><p id="ba75" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">换脸的时候，我想把我的脸(A面)换成丹尼尔·雷德克里夫的脸。为此，我将我的脸输入到公共编码器中，并使用解码器B来生成脸A(我的)和脸B(丹尼尔的)的组合。发生这种情况是因为解码器B太习惯于生成丹尼尔的。这就是为什么当它看到类似于一张脸的东西(潜在矩阵)时，它会试图重新生成同一张脸，但具有丹尼尔的特征。</p><p id="b630" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当谈到制作自己的模型来创建faceswap视频时，我不是太了解，所以我在互联网上查看了多个模型。我看到了这个帖子:</p><div class="lu lv gp gr lw lx"><a href="https://medium.com/gradientcrescent/deepfaking-nicolas-cage-into-the-mcu-using-autoencoders-an-implementation-in-keras-and-tensorflow-ab47792a042f" rel="noopener follow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd io gy z fp mc fr fs md fu fw im bi translated">进入Cageverse——用自动编码器进行深度伪造:在Keras和Tensorflow中的实现</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">把尼古拉斯·凯奇带到重案组</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">medium.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ko lx"/></div></div></a></div><p id="d2c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我必须选择一个能够在没有GPU的机器上很好地训练和运行的模型。这么说吧，我有这个项目的最低要求。后来，我震惊地发现数据集训练需要大约3~4个小时，而且在项目提交之前我没有多少时间了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/7bcd5b4e471693810304aa099067021d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbtJ34m5FcDSaB6zvRN5XA.png"/></div></div></figure><p id="1479" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在运行他的模型时，我遇到了一个名为PixelShuffler的函数的问题。谢天谢地，你可以在这个github repo里找到函数:<a class="ae kq" href="https://gist.github.com/t-ae/6e1016cc188104d123676ccef3264981" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/t-AE/6e 1016 cc 188104d 123676 ccef 3264981</a></p><p id="d1f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我运行这个模块时，实际上出现了一个错误。这和<em class="mr"> normalize_data_format </em>有关。在<em class="mr"> keras.utils，</em>中找不到该函数，因为它在<em class="mr"> keras.backend.common. </em>中</p><p id="8c05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">修好那部分后，模型运行良好。</p><h1 id="8bd5" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">培训和测试</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ms"><img src="../Images/816fd082a6ebafe3c7fe6dcbb8ca8333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJpdwtK5WNf-MEM31_7pIA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">forum.faceswap.dev/download/file.php?id = 141 &amp; sid = f 617 aa 20026 ad 3 fdba 1 afce 5b 2963 f 43</figcaption></figure><p id="2e74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要训练faceswap模型，您必须实例化1x编码器和2x解码器。如上图所示，为了训练，两面都使用一个编码器作为“公共编码器”</p><p id="6711" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">训练的目标如下:<br/>编码器应该能够在给定人脸A或人脸B的情况下，将输入图像编码成有意义的潜在矩阵(图像的压缩版本)。<br/>解码器A应该能够从潜在矩阵中重新生成一张脸A。<br/>解码器B应该能够从潜在矩阵中重新生成a面B。</p><p id="6140" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">训练过程如下:<br/> [1]用解码器A训练用于A面的编码器。<br/> [2]用解码器B训练用于B面的相同编码器(权重来自[1])</p><p id="f0cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用于训练的参数有:<br/>时期:100 <br/>批量:32 <br/>无序=真<br/>验证分割= 0.25<br/>Adam优化器(Ir=5e-5，beta_1=0.5，beta_2=0.999，loss="mean_absolute_error ")</p><p id="52ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以最初为了训练，我认为迭代次数应该在50左右。在Iryna Korshunova等人的论文中，我震惊地发现了使用卷积神经网络的快速面部交换。他们的迭代次数达到10，000次。我不得不妥协；由于时间有限，没有可用的GPU，我只能拥有100个纪元。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mx"><img src="../Images/f29af567f9896e677d4eb87125ee0e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJuaDR1elR0R_J-eS61pTw.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">左边是我的脸。右边是换脸的照片</figcaption></figure><h1 id="0cab" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">生成视频</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi my"><img src="../Images/10b44bf2a54f471c1f600fa6b2119ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YcaSSBrxoEt2R0Sve2rmQ.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">视频生成框图</figcaption></figure><p id="8046" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">预先录制视频:<br/> </strong>我实际上花了大约30分钟拍摄了大约10秒钟我看着镜头检查我换脸后的样子。</p><p id="9f26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> OpenCV VideoCapture切片:<br/> </strong>对视频进行切片，我用的是OpenCV的VideoCapture.read()。我实际上遇到了一个问题，因为我使用的iPhone嵌入了元数据，导致我的照片被旋转。幸运的是，由于笔记本电脑上安装了苹果的操作系统，解决这个问题不成问题。</p><p id="2557" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Model: <br/> </strong>由于我的模型的输入是一个64x64像素的图像，所以我必须将图像调整为64x64像素。只有这样，我才能将它输入到我的模型中。然而，我的模型，到目前为止，已经把我的脸变成了更邪恶的东西，而不是哈利波特的脸。</p><p id="259c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">QuickTime Player:<br/></strong>OS Catalina提供了一个名为QuickTime Player的应用程序，我用它将我的帧拼接成视频形式的成品。</p><h1 id="273c" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">Github回购</h1><p id="c381" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">为了运行代码，我使用了Python 3 . 7 . 6<a class="ae kq" href="https://github.com/tdchua/tim_potter_faceswap" rel="noopener ugc nofollow" target="_blank">https://github.com/tdchua/tim_potter_faceswap</a></p><h1 id="42c8" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">结束语</h1><p id="68cf" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">当我开始写这篇文章时，已经是3月31日凌晨2:09了。首先，我要感谢思维机器让我有机会申请他们的实习项目。我要感谢我的小妹妹和我的Chynna，她们在数据收集和视频编辑方面帮助了我。</p><p id="b6e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我自己完成的第一个机器学习项目，这的确是一次相当不错的经历。数据收集相当困难，也是流程中最耗时的部分。在这项任务中，我花了最多的时间收集我和哈利戴眼镜和不戴眼镜的照片。在项目的某个部分，我错误地处理了我的数据，最终删除了其中很大一部分；所以我不得不花费时间来恢复丢失的图像。我建议在处理数据时要格外小心。</p><p id="8410" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还了解到，如果你白天工作，晚上想放松一下，那就很难管理好你的时间。不过，完成这个项目也很有趣。它教会了我创建一个ML项目的许多方面，从数据收集，模型选择，当然，还有研究。我不认为代码在第一次尝试时会运行。我不得不花几分钟到几个小时的时间试着调试，并且不放弃。</p><p id="001f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">型号选择是我不太熟悉的地方。仅仅理解这个概念是不够的，因为您必须选择一个足够强大的模型来满足您的项目需求。您不能简单地将MNIST自动编码器用于Faceswapping之类的应用。即使你选择了合适的模型，如果你拥有的计算机不能足够快地训练它，它也没有任何意义。此外，在培训期间，在接受培训前仔细检查你的代码是非常重要的。由于数据路径不正确，您可能会浪费大量时间。</p><p id="fa7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">总而言之，我发现这个项目相当具有挑战性和吸引力。即使我的模型没有达到我的期望，我仍然认为这是我未来项目的一次很好的学习经历。我希望你能允许我进一步磨练我的技能，并参与思考机器的项目开发。谢谢您们。</p></div></div>    
</body>
</html>