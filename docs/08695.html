<html>
<head>
<title>DATES, How to Extract Dates from a GA4 table in BigQuery (beginner level)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">日期，如何在 BigQuery 中从 GA4 表中提取日期(初级水平)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/dates-how-to-extract-dates-from-a-ga4-table-in-bigquery-beginner-level-347c666cdc27?source=collection_archive---------5-----------------------#2022-07-04">https://blog.devgenius.io/dates-how-to-extract-dates-from-a-ga4-table-in-bigquery-beginner-level-347c666cdc27?source=collection_archive---------5-----------------------#2022-07-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8d32bee9ba4cbde02e1ac4b78825bd1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T2L8oTag03ZTTRwFgijr9Q.png"/></div></div></figure><p id="1f89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">目录</p><blockquote class="kt ku kv"><p id="7fad" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><a class="ae la" href="#40ae" rel="noopener ugc nofollow">简介</a> <br/> <a class="ae la" href="#c6ed" rel="noopener ugc nofollow"> GA4 表和模式</a><br/><a class="ae la" href="#5644" rel="noopener ugc nofollow">Event _ date</a><br/><a class="ae la" href="#afa5" rel="noopener ugc nofollow">Event _ timestamp</a><br/><a class="ae la" href="#be18" rel="noopener ugc nofollow">Time 事件示例</a> <br/> <a class="ae la" href="#fd51" rel="noopener ugc nofollow">时间段功能</a> <br/> <a class="ae la" href="#b919" rel="noopener ugc nofollow">最终文字</a></p></blockquote></div><div class="ab cl lb lc hr ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ig ih ii ij ik"><h1 id="40ae" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">简介</strong></h1><p id="c260" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">Google Analytics 中报告的每次点击都与自动收集的时间戳值相关联。在 BigQuery 中预览 GA4 表有两个维度与这些值相关:<strong class="jx io"> event_date </strong>和<strong class="jx io"> event_timestamp </strong>。</p><p id="3d2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是分析师的一个基本特性，因为日期允许我们为报告和仪表板创建过滤器。然而，当在 BigQuery 中使用这些数据时，我们很快就会发现值是原始格式的。所以，我们需要把它们转换成可理解的。</p><p id="fb8e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在今天的文章中，我们将看到不同的<code class="fe ml mm mn mo b">sql functions</code>将原始数据破译为可读数据，以供我们分析。</p><h1 id="c6ed" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated"><strong class="ak"> GA4 表和模式</strong></h1><p id="abfe" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">表中的每一行代表一个事件(事件名称)。每个事件都有<strong class="jx io"> event_date </strong>和<strong class="jx io"> event_timestamp </strong>值，以及许多嵌套的事件特定参数(event_params)及其相应的值。BigQuery 中的 GA4 表是这样的:</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/e9358c847e0349a1511e074ddd9956cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eeaPqFLPc4RcblyH"/></div></div></figure><ul class=""><li id="4630" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated">顾名思义，<strong class="jx io">事件日期</strong>表示事件发生的确切日期。默认情况下，它使用 YY/mm/dd 格式，其模式是一个字符串。</li><li id="48ca" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated">关于<strong class="jx io"> event_timestamp </strong>是指从<strong class="jx io">1970–01–01 00:00:00 UTC</strong>到事件被创建所经过的<strong class="jx io">毫秒数</strong>。它的模式是整数。</li></ul><blockquote class="kt ku kv"><p id="e730" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">注意:<a class="ae la" href="https://support.google.com/analytics/answer/7029846?hl=en" rel="noopener ugc nofollow" target="_blank">模式</a>很重要，因为它们决定了我们可以运行什么功能。有时我们可以使用<a class="ae la" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/conversion_rules" rel="noopener ugc nofollow" target="_blank">转换<strong class="jx io">和</strong>函数</a>来改变模式，比如<code class="fe ml mm mn mo b">CAST (exp)</code></p></blockquote><p id="1d8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">乍一看，我们可以看到<strong class="jx io"> event_date </strong>由于其简单的 YY/mm/dd 格式，相对容易破译。关于<strong class="jx io">事件时间戳</strong>，事情变得有点复杂。</p><p id="80e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，今天是 2022 年 7 月 2 日。<br/>我的 GA4 event_timestamp 值显示:1656729312056608 <br/>用这个<a class="ae la" href="https://www.epochconverter.com/" rel="noopener ugc nofollow" target="_blank">时间转换器</a>检查结果</p><p id="c1e7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在已经清楚了这些值是如何工作的，让我们从<code class="fe ml mm mn mo b">functions!</code>开始</p><h1 id="5644" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated">事件日期</h1><p id="d2b7" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">使用<code class="fe ml mm mn mo b">PARSE_DATE("%Y%m%d", event_date)</code>函数，我们将以可理解的格式获取日期。而且，如果我们愿意，我们也可以通过使用<code class="fe ml mm mn mo b">FORMAT_DATE('date-representation', PARSE_DATE('%Y%m%d', event_date))</code>将给定值转换成其他格式，如<em class="kw"> dd/mm/YY </em>或<em class="kw"> mm/dd/YY </em>。</p><p id="936d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用您最喜欢的格式，或者根据您的<a class="ae la" href="https://en.wikipedia.org/wiki/Date_format_by_country" rel="noopener ugc nofollow" target="_blank">国家日期和时间表示</a>选择格式。确保%Y 是大写的，而%m 和%d 是小写的。</p><p id="ae87" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">在 SELECT 语句中:</strong></p><figure class="mv mw mx my gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/a0e5eabd945baedd318dca3fad158542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_Ney6r4GINKhTp2u"/></div></div></figure><p id="ef9b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样。现在我们可以在查询中使用<code class="fe ml mm mn mo b">PARSE_DATE("%Y%m%d", event_date)</code>函数，并知道每个事件发生的日期。</p><p id="dd86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">在 WHERE 语句中:<br/> </strong>函数<code class="fe ml mm mn mo b">PARSE_DATE("%Y%m%d", event_date)</code>也可以在过滤器中使用<strong class="jx io">，以便查询返回那些在我们特别指定的日期之间压缩的值:</strong></p><pre class="mv mw mx my gt nq mo nr ns aw nt bi"><span id="b9d0" class="nu lj in mo b gy nv nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date) = “2022–06–29” (equal)</span><span id="494a" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date)&gt;=“2022–06–29”(equal or bigger)</span><span id="d11d" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date)&lt;=“2022–06–29” (equal or minor)</span><span id="2f0d" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date) &gt; “2022–06–29” (bigger than)</span><span id="9edc" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date) &lt; “2022–06–29” (minor than)</span><span id="c4c0" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date) != “2022–06–29” (is not that date)</span><span id="bae5" class="nu lj in mo b gy nz nw l nx ny">WHERE PARSE_DATE(“%Y%m%d”,event_date) BETWEEN “2022–06–29” AND “2022–01–29”</span></pre><h1 id="afa5" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated"><strong class="ak">事件 _ 时间戳</strong></h1><p id="76d8" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">由于<strong class="jx io"> event_timestamp </strong>的值显示自 1970–01–01 00:00:00 UTC 以来已经过去的<strong class="jx io">毫秒，因此可以应用不同的函数及其组合来将该原始值转换为特定的日期。因为这是一篇面向初学者的文章，所以我选择了 4 个我认为最容易应用的函数，它们返回足够全面的值来执行分析。</strong></p><h2 id="c73d" class="nu lj in bd lk oa ob dn lo oc od dp ls kg oe of lw kk og oh ma ko oi oj me ok bi translated"><strong class="ak">在 SELECT 语句中:</strong></h2><figure class="mv mw mx my gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ol"><img src="../Images/e3d7d4b26345d6b309ff22548c12196b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dEqoUZYZKnCN5A0f"/></div></div></figure><p id="4d53" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从左到右，该表将 event_timestamp 显示为一个原始数字，并且每个函数的结果:<strong class="jx io"> full_date、year_month_day、only_year、only_month、date_format 和 time。</strong>注意，它们也可以用在<code class="fe ml mm mn mo b">WHERE</code>语句中，与上一条相同。</p><h1 id="be18" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated"><strong class="ak">时间示例</strong></h1><p id="741f" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">我在查询中最喜欢使用的函数之一是这个:<code class="fe ml mm mn mo b">FOMAT_TIME('%T', TIME(TIMESTAMP_MICROS(event_timestamp)))</code>。使用此功能，您可以<strong class="jx io">根据事件发生的日期和确切时间进行分析。</strong></p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/54e812e060ab9fadfba766120f555683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*isyXPky9f1zNfJu4"/></div></div></figure><p id="63ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您甚至可以计算自用户第一次访问以完成特定事件(如 add_to_cart 或 purchase)以来所经过的时间。</p><blockquote class="kt ku kv"><p id="7697" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">注意:按照这个时间微分逻辑，我想到了另一个计算日期差异的函数。<code class="fe ml mm mn mo b">SELECT DATE_DIFF ("2021-06-28", "2021-06-18", DAY)</code>。如果我们运行这个查询，结果将是 10。</p></blockquote><h1 id="fd51" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated"><strong class="ak">最后一天、一周或一个月</strong></h1><p id="d31d" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">一旦我们对如何使用基本函数从 event_date 和 event_timestamp 中破译日期有了一个大致的概念，就到了进一步改进的时候了。</p><ul class=""><li id="40ff" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated">例如，创建一个返回最近一天、7 天或 30 天的值的查询。为此，我们将结合<code class="fe ml mm mn mo b">FORMAT_DATE</code>、<code class="fe ml mm mn mo b">DATE_SUB</code>和<code class="fe ml mm mn mo b">INTERVAL</code>使用<code class="fe ml mm mn mo b">_TABLE_SUFFIX</code>函数。一下子:)</li></ul><p id="6e2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">按昨天过滤</strong></p><p id="1ab8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe ml mm mn mo b">_TABLE_SUFFIX = FORMAT_DATE("%Y%m%d", DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY))</code></p><p id="b5f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">过去 7 天过滤</strong></p><p id="348f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe ml mm mn mo b">_TABLE_SUFFIX BETWEEN FORMAT_DATE("%Y%m%d", DATE_SUB(CURRENT_DATE(), INTERVAL 8 DAY)) AND FORMAT_DATE("%Y%m%d", DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY))</code></p><p id="9a34" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">按过去 30 天过滤</strong></p><p id="cbb9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe ml mm mn mo b">_TABLE_SUFFIX BETWEEN FORMAT_DATE("%Y%m%d", DATE_SUB(CURRENT_DATE(), INTERVAL 31 DAY)) AND FORMAT_DATE("%Y%m%d", DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY))</code></p><p id="ac2d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们来看看:</p><figure class="mv mw mx my gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e6ec55c6c919d5723c36827bdef6ed89.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*uVARCq517cItjWedWRbTkw.png"/></div></figure><p id="ff9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该表仅返回 7 天内压缩的值<strong class="jx io">。</strong> Tese 函数适用于 event_date 和 event_timestamp，并且对报告非常有用。</p><p id="c97b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一个好的实践(尽管这是更高级的 sql 级别)是自动执行查询，返回给定时间内完成的事件，而无需重写查询。例如，每 30 天购买事件的数量。</p><h1 id="b919" class="li lj in bd lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb mt md me mf bi translated"><strong class="ak">最后的话</strong></h1><p id="d38c" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">日期和时间戳被自动收集在 GA4 表中，并与一个唯一的事件相关联。因此，分析师可以创建报告，并在我们的报告中按特定日期进行筛选。</p><p id="8776" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用 BigQuery 时，event_date 和 event_timestamp 显示为原始数字。我们需要使用函数来破译它们，并将它们转换成人眼可以理解和阅读的值。在本文中，我们已经看到了像<code class="fe ml mm mn mo b">PARSE_DATE</code>、<code class="fe ml mm mn mo b">FORMAT_DATE</code>、<code class="fe ml mm mn mo b">EXTRACT</code>这样的基本函数，以及像<code class="fe ml mm mn mo b">_TABLE_SUFFIX</code>、<code class="fe ml mm mn mo b">DATE_SUB</code>和<code class="fe ml mm mn mo b">INTERVAL</code>这样更复杂的函数。</p><p id="1f09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当然，这些函数还有许多其他用途，我想更好的用途是返回一个类似的值(…)，尽管我试图让它对使用和熟悉 GA4 的入门级 SQL 分析师来说简单实用。</p></div></div>    
</body>
</html>