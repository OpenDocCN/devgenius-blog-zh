<html>
<head>
<title>Learning Go, A Journey: Creating Server with Net Package #8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习围棋之旅:用网络包#8 创建服务器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/learning-go-a-journey-creating-server-with-net-package-8-528d97e20882?source=collection_archive---------7-----------------------#2022-10-02">https://blog.devgenius.io/learning-go-a-journey-creating-server-with-net-package-8-528d97e20882?source=collection_archive---------7-----------------------#2022-10-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="93b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">服务器向另一台计算机(也称为客户端)提供服务。在客户机/服务器模型中，服务器满足来自客户机的请求(<a class="ae ki" href="https://www.techtarget.com/whatis/definition/server" rel="noopener ugc nofollow" target="_blank"> Brian Posey </a>)。Golang 提供了一个名为“net”的标准库包，我们可以在其中创建自己的服务器并为客户端请求提供服务。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/650cfe895066ddcb04cba9638f183df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUyXxummu6UaUlJtBihfXA.png"/></div></div></figure><h1 id="b12d" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是 TCP？</h1><p id="3013" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">TCP 代表传输控制协议(Transmission Control Protocol ),这是一种通信标准，使应用程序和计算设备能够通过网络交换消息。它旨在通过互联网发送数据包，并确保数据和消息在网络上的成功传递(<a class="ae ki" href="https://www.fortinet.com/resources/cyberglossary/tcp-ip" rel="noopener ugc nofollow" target="_blank"> Fortinet </a>)。在本文中，我将使用 TCP 连接来服务我们的服务器。</p><h1 id="558c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">创建一个监听器</h1><p id="74f0" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">要创建一个监听器，我们必须使用“Net”包中的函数“Listen”。“Listen”函数接收两个参数，一个网络(tcp、tcp4、tcp6、unix 或 unixpacket)和一个地址。它返回一个侦听器和一个错误。侦听器有 accept、close 和 addr 方法。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/dd7a888d37680363673e820f8f17c45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r8PD2WomISRB0bYs"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/2cc4e67e76ae24fc4ae3e15d59f50672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4ZBjtE6B3U71uYjf"/></div></div></figure><p id="583c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，我们从 net 包中调用 Listen 函数，然后检查错误。之后，我们推迟关闭函数，因为我们必须在程序结束时关闭连接。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/7758266bd5f941a30d13c26f18fb5978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MUv88kO2qPRLMirw"/></div></div></figure><h1 id="9e71" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">写入连接</h1><p id="ee2d" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">在上一节中，我们已经创建了自己的服务器。现在，我们可以接受一个连接来读取客户端请求或向客户端写响应。我们已经从 Listen 函数接收了一种类型的侦听器，然后我们可以调用 Accept 函数来开始接受连接。Accept 函数返回 Conn 类型和一个错误。Conn 是一个接口，它有几个方法，如下图所示。Conn 接口也是一个读取器或写入器，这意味着我们可以读取或写入连接。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/bf6dafdfaa5ae84f3cf54f97bdab4a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mGMfQ66EmzhmxfHR"/></div></div></figure><p id="ce59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，在我们创建了一个服务器之后，我们创建了一个无限循环，它将在程序启动时接收一个连接。要写入连接，我们可以使用“io。WriteString()，“fmt。Fprintf()"，或任何接收编写器作为其参数的函数。之后，不要忘记在我们完成请求后关闭连接。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/e6d4f6300d5f4e7a975c649ddc5b30b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-FHx60Rm0S2EJfFf"/></div></div></figure><p id="bc03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 bash 中运行程序，然后打开我们的命令行，使用 telnet 连接我们的服务器。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/89fa21a82416b5f266b5b51bbe467f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/0*7SrdbZ4z2Z3ClgJx"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ma"><img src="../Images/baeadbadafa481f3e2d3e6a7a438d77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NgQtXqFat41jetP0"/></div></div></figure><h1 id="b703" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">用 Bufio 扫描仪处理请求</h1><p id="f242" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">Bufio 包中的 type Scanner 提供了一个方便的接口来读取数据，比如一个换行符分隔的文本文件(Go doc)。</p><h2 id="fb09" class="mb kw in bd kx mc md dn lb me mf dp lf jv mg mh lj jz mi mj ln kd mk ml lr mm bi translated">阅读请求</h2><p id="b720" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">要读取到来的请求，我们可以将 Conn 传递给接收读取器的 NewScanner 函数。然后，我们在每次扫描器扫描任何输入文本时创建一个循环，并将文本打印到 bash。最后，我们必须在完成请求后关闭连接。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/647ab9a358f39f11ee6ffbb13c05865e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YVuzQtfA-cDwqj_9"/></div></div></figure><p id="a44e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行程序，然后在浏览器上打开地址。打开浏览器的地址后，我们将在 bash 上获得这些文本。这些文本表示来自客户端的请求，其中包含方法、URL、HTTP 版本、标题等。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mn"><img src="../Images/be19e5f5b50da5b85aeb737cfe25181c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kZAEkHfBAbNwOdmF"/></div></div></figure><h1 id="5149" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">通过 URL 处理不同的请求</h1><p id="aa3b" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">从上一节中，我们已经成功地用 bufio scanner 扫描了一个传入的请求。现在我们可以通过 URL 来处理请求。正如我们所看到的，传入的请求在第一行有 URL。例如，我们可以利用这些数据来处理不同的请求</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/5fdf21c583540613d2ede180f4b67d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rzam5VbXUMGnPLp6"/></div></div></figure><p id="f800" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从上图中，我们利用请求数据来处理不同的请求。如果我们在 bash 中运行程序并打开 URL。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b1ae28104aabf83ec5898c7799ff659a.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/0*IG3AGpd9yZpQ1Ygf"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">/</figcaption></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/58401d6a480179d0b9e6eaf189cf13e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/0*WOpgmzsAvYHypGIH"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">/罗纳尔多</figcaption></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/9bb677fe212adb93e15d33a51bdf29c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/0*6G4HKCn-gv2tnUZx"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">/达尔温努内斯</figcaption></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d63a67ee45b5d0f8028bef4fa4a2950f.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/0*z2mFiNJ3XCfjpBBF"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">以前没有定义过的任何 URL</figcaption></figure></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="cb06" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文到此为止，别忘了留下一个赞，分享给别人。如果您有任何反馈，请在下面留下您的评论。感谢你阅读这篇文章，祝你有美好的一天👋。</p><p id="de48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">资源</p><ul class=""><li id="bd0d" class="nd ne in jm b jn jo jr js jv nf jz ng kd nh kh ni nj nk nl bi translated"><a class="ae ki" href="https://www.udemy.com/course/learn-how-to-code/" rel="noopener ugc nofollow" target="_blank">学习如何编码:谷歌的 Go (golang)编程语言</a></li><li id="29ae" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated"><a class="ae ki" href="https://go.dev/ref/spec" rel="noopener ugc nofollow" target="_blank">围棋编程语言规范</a></li><li id="3195" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated"><a class="ae ki" href="https://www.techtarget.com/whatis/definition/server" rel="noopener ugc nofollow" target="_blank">什么是服务器？</a></li><li id="bd03" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated"><a class="ae ki" href="https://www.fortinet.com/resources/cyberglossary/tcp-ip" rel="noopener ugc nofollow" target="_blank">什么是 TCP？</a></li><li id="3732" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated"><a class="ae ki" href="https://pkg.go.dev/net" rel="noopener ugc nofollow" target="_blank">网包</a></li><li id="e141" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated"><a class="ae ki" href="https://pkg.go.dev/bufio" rel="noopener ugc nofollow" target="_blank"> Bufio 包</a></li></ul></div></div>    
</body>
</html>