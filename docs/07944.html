<html>
<head>
<title>Laravel create an account update page for admin users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel 为管理员用户创建一个帐户更新页面</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-create-an-account-update-page-for-admin-users-e123cd88f24b?source=collection_archive---------5-----------------------#2022-05-05">https://blog.devgenius.io/laravel-create-an-account-update-page-for-admin-users-e123cd88f24b?source=collection_archive---------5-----------------------#2022-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9d15" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Laravel 从头开始创建管理面板——第 9 部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/395232067bd6b0af00f14443b203e5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LFqQCnriBDipDpbvcnCzw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Laravel 管理面板帐户更新页面</figcaption></figure><p id="3c8f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们创建了管理面板用户、角色和权限管理。在这一部分，我们将为管理面板用户创建一个帐户更新页面。</p><h1 id="1555" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">帐户更新页面</h1><p id="719e" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">创建 Laravel 管理面板帐户更新页面包括以下步骤。</p><ul class=""><li id="3684" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq mt mu mv mw bi translated">1.添加路线</li><li id="7e8f" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">2.在控制器上添加功能</li><li id="7556" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">3.创建视图</li><li id="036c" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">4.保存帐户信息</li><li id="2c4e" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">5.保存密码</li><li id="7156" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">6.向导航添加链接</li></ul><h2 id="565a" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">1.添加路线</h2><p id="7f37" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们将为帐户更新创建一个新页面。将以下路线添加到我们的管理组</p><p id="aeb3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">routes/admin.php</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="f513" class="nt ls iq np b be nu nv l nw nx">Route::get('edit-account-info', 'UserController@accountInfo')-&gt;name('admin.account.info');<br/>Route::post('edit-account-info', 'UserController@accountInfoStore')-&gt;name('admin.account.info.store');<br/>Route::post('change-password', 'UserController@changePasswordStore')-&gt;name('admin.account.password.store');</span></pre><p id="11a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一个路径是帐户更新表单的“编辑-帐户-信息”。另外两种保存账户信息和密码的途径。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h2 id="1168" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">2.在控制器上添加功能</h2><p id="8ba8" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在 UserController 上添加以下功能</p><p id="1dad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">app/Http/Controllers/Admin/user controller . PHP</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="c2bc" class="nt ls iq np b be nu nv l nw nx">public function accountInfo()<br/>{<br/>    $user = \Auth::user();<br/>    return view('admin.user.account_info', compact('user'));<br/>}</span></pre></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h2 id="3619" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">3.创建视图</h2><p id="ccd2" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在 resources/views/admin/user/文件夹中创建 account_info.blade.php 文件。在视图中，我们添加了两个表单。一个用于基本帐户信息更新(姓名和电子邮件)。还有一个就是更新账号密码。</p><p id="f372" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">资源/视图/管理/用户/帐户信息. blade.php</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="864b" class="nt ls iq np b be nu nv l nw nx">&lt;x-app-layout&gt;<br/>    &lt;x-slot name="header"&gt;<br/>        &lt;h2 class="font-semibold text-xl text-gray-800 leading-tight"&gt;<br/>            {{ __('My Account') }}<br/>        &lt;/h2&gt;<br/>    &lt;/x-slot&gt;<br/>&lt;div class="py-12"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="px-6"&gt;<br/>                    &lt;h1 class="inline-block text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;{{ __('Account Info') }}&lt;/h1&gt;<br/>                    @if ($errors-&gt;account-&gt;any())<br/>                        &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>                            @foreach ($errors-&gt;account-&gt;all() as $error)<br/>                                &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>                            @endforeach<br/>                        &lt;/ul&gt;<br/>                    @endif<br/>                    @if(session()-&gt;has('account_message'))<br/>                        &lt;div class="mb-8 text-green-400 font-bold"&gt;<br/>                            {{ session()-&gt;get('account_message') }}<br/>                        &lt;/div&gt;<br/>                    @endif<br/>                &lt;/div&gt;<br/>                &lt;div class="w-full px-6 py-4 bg-white overflow-hidden"&gt;<br/>&lt;form method="POST" action="{{ route('admin.account.info.store') }}"&gt;<br/>                    @csrf<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="name" class="block font-medium text-sm text-gray-700{{$errors-&gt;account-&gt;has('name') ? ' text-red-400' : ''}}"&gt;{{ __('Name') }}&lt;/label&gt;<br/>&lt;input id="name" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;account-&gt;has('name') ? ' border-red-400' : ''}}"<br/>                                            type="text"<br/>                                            name="name"<br/>                                            value="{{ old('name', $user-&gt;name) }}"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="email" class="block font-medium text-sm text-gray-700{{$errors-&gt;account-&gt;has('email') ? ' text-red-400' : ''}}"&gt;{{ __('Email') }}&lt;/label&gt;<br/>&lt;input id="email" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;account-&gt;has('email') ? ' border-red-400' : ''}}"<br/>                                            type="email"<br/>                                            name="email"<br/>                                            value="{{ old('email', $user-&gt;email) }}"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="flex justify-end mt-4"&gt;<br/>                            &lt;button type="submit" class="inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150"&gt;<br/>                                {{ __('Update') }}<br/>                            &lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/form&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;div class="py-3"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="px-6"&gt;<br/>                    &lt;h1 class="inline-block text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;{{ __('Change Password') }}&lt;/h1&gt;<br/>                    @if ($errors-&gt;password-&gt;any())<br/>                        &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>                            @foreach ($errors-&gt;password-&gt;all() as $error)<br/>                                &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>                            @endforeach<br/>                        &lt;/ul&gt;<br/>                    @endif<br/>                    @if(session()-&gt;has('password_message'))<br/>                        &lt;div class="mb-8 text-green-400 font-bold"&gt;<br/>                            {{ session()-&gt;get('password_message') }}<br/>                        &lt;/div&gt;<br/>                    @endif<br/>                &lt;/div&gt;<br/>                &lt;div class="w-full px-6 py-4 bg-white overflow-hidden"&gt;<br/>&lt;form method="POST" action="{{ route('admin.account.password.store') }}"&gt;<br/>                    @csrf<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="old_password" class="block font-medium text-sm text-gray-700{{$errors-&gt;password-&gt;has('old_password') ? ' text-red-400' : ''}}"&gt;{{ __('Old Password') }}&lt;/label&gt;<br/>&lt;input id="old_password" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;password-&gt;has('old_password') ? ' border-red-400' : ''}}"<br/>                                            type="password"<br/>                                            name="old_password"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="new_password" class="block font-medium text-sm text-gray-700{{$errors-&gt;password-&gt;has('new_password') ? ' text-red-400' : ''}}"&gt;{{ __('New Password') }}&lt;/label&gt;<br/>&lt;input id="new_password" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;password-&gt;has('new_password') ? ' border-red-400' : ''}}"<br/>                                            type="password"<br/>                                            name="new_password"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="confirm_password" class="block font-medium text-sm text-gray-700{{$errors-&gt;password-&gt;has('confirm_password') ? ' text-red-400' : ''}}"&gt;{{ __('Confirm password') }}&lt;/label&gt;<br/>&lt;input id="confirm_password" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;password-&gt;has('confirm_password') ? ' border-red-400' : ''}}"<br/>                                            type="password"<br/>                                            name="confirm_password"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="flex justify-end mt-4"&gt;<br/>                            &lt;button type='submit' class='inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150'&gt;<br/>                                {{ __('Change Password') }}<br/>                            &lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/form&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/x-app-layout&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/86fcc5be51ae5044b6c45c305e026c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cokz01jmVWf8dwcuw7u3TA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">帐户更新表单</figcaption></figure></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h2 id="033c" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">4.保存帐户信息</h2><p id="e9a7" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">创建<code class="fe og oh oi np b">accountInfoStore</code>函数来存储用户帐户的详细信息。</p><p id="317f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">app/Http/Controllers/Admin/user controller . PHP</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="a696" class="nt ls iq np b be nu nv l nw nx">public function accountInfoStore(Request $request)<br/>{<br/>    $request-&gt;validateWithBag('account', [<br/>        'name' =&gt; ['required', 'string', 'max:255'],<br/>        'email' =&gt; ['required', 'string', 'email', 'max:255', 'unique:users,email,'.\Auth::user()-&gt;id],<br/>    ]);<br/>    $user = \Auth::user()-&gt;update($request-&gt;except(['_token']));<br/>    if ($user) {<br/>        $message = "Account updated successfully.";<br/>    } else {<br/>        $message = "Error while saving. Please try again.";<br/>    }<br/>    return redirect()-&gt;route('admin.account.info')-&gt;with('account_message', $message);<br/>}</span></pre><p id="64b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用<code class="fe og oh oi np b">validateWithBag</code>来分离视图中的错误消息。Laravel 被称为<a class="ae oj" href="https://laravel.com/docs/9.x/validation#named-error-bags" rel="noopener ugc nofollow" target="_blank">，被命名为错误包</a>。因为我们在同一页上使用了两种形式。</p><h2 id="febc" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">5.保存密码</h2><p id="bc0b" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated"><code class="fe og oh oi np b">changePasswordStore</code> a 功能用于保存用户修改后的密码。新增<code class="fe og oh oi np b">$validator-&gt;after</code>验证，验证规则后验证当前密码。</p><p id="4e28" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">app/Http/Controllers/Admin/user controller . PHP</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="731b" class="nt ls iq np b be nu nv l nw nx">public function changePasswordStore(Request $request)<br/>{<br/>    $validator = \Validator::make($request-&gt;all(), [<br/>        'old_password' =&gt; ['required'],<br/>        'new_password' =&gt; ['required', Rules\Password::defaults()],<br/>        'confirm_password' =&gt; ['required', 'same:new_password', Rules\Password::defaults()],<br/>    ]);<br/>    $validator-&gt;after(function ($validator) use ($request) {<br/>        if ($validator-&gt;failed()) return;<br/>        if (! Hash::check($request-&gt;input('old_password'), \Auth::user()-&gt;password)) {<br/>            $validator-&gt;errors()-&gt;add(<br/>                'old_password', 'Old password is incorrect.'<br/>            );<br/>        }<br/>    });<br/>    $validator-&gt;validateWithBag('password');<br/>    $user = \Auth::user()-&gt;update([<br/>        'password' =&gt; Hash::make($request-&gt;input('new_password')),<br/>    ]);<br/>    if ($user) {<br/>        $message = "Password updated successfully.";<br/>    } else {<br/>        $message = "Error while saving. Please try again.";<br/>    }<br/>    return redirect()-&gt;route('admin.account.info')-&gt;with('password_message', $message);<br/>}</span></pre></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h2 id="a75c" class="nc ls iq bd lt nd ne dn lx nf ng dp mb le nh ni md li nj nk mf lm nl nm mh nn bi translated">6.向导航添加链接</h2><p id="a4ed" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">最后一步在<code class="fe og oh oi np b">navigation.blade.php</code>上添加我的账户链接</p><p id="7977" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">资源/视图/布局/导航. blade.php</p><pre class="kg kh ki kj gt no np nq bn nr ns bi"><span id="b656" class="nt ls iq np b be nu nv l nw nx">&lt;x-slot name="content"&gt;<br/>                         &lt;!-- Authentication --&gt;<br/>+                        &lt;x-dropdown-link :href="route('admin.account.info')" :active="request()-&gt;routeIs('admin.account.info')"&gt;<br/>+                                {{ __('My Account') }}<br/>+                        &lt;/x-dropdown-link&gt;<br/>                         &lt;form method="POST" action="{{ route('logout') }}"&gt;<br/>                             @csrf<br/>@@ -94,6 +97,9 @@<br/>             &lt;/div&gt;<br/>&lt;div class="mt-3 space-y-1"&gt;<br/>+                &lt;x-responsive-nav-link :href="route('admin.account.info')" :active="request()-&gt;routeIs('admin.account.info')"&gt;<br/>+                        {{ __('My Account') }}<br/>+                &lt;/x-responsive-nav-link&gt;<br/>                 &lt;!-- Authentication --&gt;<br/>                 &lt;form method="POST" action="{{ route('logout') }}"&gt;<br/>                     @csrf</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/464acd3eb98839eadbc529aeb7ae454a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bm2I912pmitft-cqjoOxPQ.png"/></div></div></figure></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="7c31" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经成功地为我们的管理面板创建了一个帐户更新页面。</p><p id="5a38" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Laravel 管理面板可在<a class="ae oj" href="https://github.com/balajidharma/basic-laravel-admin-panel" rel="noopener ugc nofollow" target="_blank">https://github.com/balajidharma/basic-laravel-admin-panel</a>获得。安装管理面板并分享您的反馈。</p><p id="6da6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢您的阅读！</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="774b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上一部分—第 8 部分:<a class="ae oj" rel="noopener ugc nofollow" target="_blank" href="/basic-laravel-admin-panel-user-management-crud-45f694ef60cc">为用户管理创建 UI</a></p><p id="58a2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一部分—第 10 部分:<a class="ae oj" rel="noopener ugc nofollow" target="_blank" href="/restructuring-a-laravel-controller-using-form-request-validation-e546fe22c298">使用表单请求验证重构 Laravel 控制器</a></p></div></div>    
</body>
</html>