<html>
<head>
<title>Create UI for Role management to Laravel admin panel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为 Laravel 管理面板的角色管理创建 UI</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-ui-for-role-management-to-laravel-admin-panel-dce72b09d2ea?source=collection_archive---------0-----------------------#2022-04-27">https://blog.devgenius.io/create-ui-for-role-management-to-laravel-admin-panel-dce72b09d2ea?source=collection_archive---------0-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9ff1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Laravel 从头开始创建一个管理面板——第 7 部分</h2></div><p id="dd17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经为我们的管理面板<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/laravel-user-roles-and-permissions-6dbfd4abfcf8">角色和权限</a>配置了 Spatie<a class="ae lb" href="https://github.com/spatie/laravel-permission" rel="noopener ugc nofollow" target="_blank">Laravel-permission</a>包。在这一部分，我们将创建一个角色管理用户界面。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/0eb30a5e243a7038834499fdd06466a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1nbYjlUFI8MSjoC9"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@mpho_mojapelo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mpho Mojapelo </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="7172" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">角色管理</h1><p id="37fa" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">下面的步骤是为我们的 Laravel 管理面板创建一个角色 CRUD。</p><ul class=""><li id="a296" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated">1.创建模型</li><li id="1d3d" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">2.创建控制器</li><li id="7d3a" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">3.添加路线</li><li id="c08d" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">4.带有操作链接的索引页面</li><li id="db79" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">5.创建有权限的操作</li><li id="ca43" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">6.有权限的更新操作</li><li id="749b" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">7.查看页面</li><li id="0dcc" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">8.向导航添加链接</li></ul><h2 id="06f2" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">1.创建模型</h2><p id="4a35" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">使用下面的<code class="fe np nq nr ns b">make:model</code>创建你的模型</p><pre class="ld le lf lg gt nt ns nu nv aw nw bi"><span id="70be" class="nd lt iq ns b gy nx ny l nz oa">sail artisan make:model Role</span></pre><p id="2e9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<code class="fe np nq nr ns b">Spatie\Permission\Models\Role</code>扩展我们的角色模型，用下面的代码更新模型。</p><p id="91f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Models/Role.php</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="f23f" class="oe lt iq ns b be of og l oh oa">&lt;?php<br/>namespace App\Models;<br/>use Spatie\Permission\Models\Role as OriginalRole;<br/>class Role extends OriginalRole<br/>{<br/>    protected $fillable = [<br/>        'name',<br/>        'guard_name',<br/>        'updated_at',<br/>        'created_at'<br/>    ];<br/>}</span></pre></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="54ab" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">2.创建控制器</h2><p id="ed7e" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe np nq nr ns b">make:controller</code> Artisan 命令用于创建控制器。</p><pre class="ld le lf lg gt nt ns nu nv aw nw bi"><span id="4a7a" class="nd lt iq ns b gy nx ny l nz oa">sail artisan make:controller Admin/RoleController --model=Role --resource</span></pre><h2 id="49b6" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">3.添加路线</h2><p id="129a" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在 routes/admin.php 上添加角色路由</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="178d" class="oe lt iq ns b be of og l oh oa">&lt;?phpRoute::group([<br/>    'namespace'  =&gt; 'App\Http\Controllers\Admin',<br/>    'prefix'     =&gt; 'admin',<br/>    'middleware' =&gt; ['auth'],<br/>], function () {<br/>    Route::resource('permission', 'PermissionController');<br/>    Route::resource('role', 'RoleController');<br/>});</span></pre><p id="eb21" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在进入<code class="fe np nq nr ns b">/admin/role</code>页面，显示空白页。</p><h2 id="9010" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">4.带有操作链接的索引页面</h2><p id="d7ac" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在索引功能上添加带有搜索和排序的角色分页。在构造函数中，添加中间件来检查访问。</p><p id="659a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="7bf9" class="oe lt iq ns b be of og l oh oa">function __construct()<br/>{<br/>     $this-&gt;middleware('can:role list', ['only' =&gt; ['index','show']]);<br/>     $this-&gt;middleware('can:role create', ['only' =&gt; ['create','store']]);<br/>     $this-&gt;middleware('can:role edit', ['only' =&gt; ['edit','update']]);<br/>     $this-&gt;middleware('can:role delete', ['only' =&gt; ['destroy']]);<br/>}<br/>/**<br/> * Display a listing of the resource.<br/> *<br/> * @return \Illuminate\Http\Response<br/> */<br/>public function index()<br/>{<br/>    $roles = (new Role)-&gt;newQuery();<br/>    if (request()-&gt;has('search')) {<br/>        $roles-&gt;where('name', 'Like', '%' . request()-&gt;input('search') . '%');<br/>    }<br/>    if (request()-&gt;query('sort')) {<br/>        $attribute = request()-&gt;query('sort');<br/>        $sort_order = 'ASC';<br/>        if (strncmp($attribute, '-', 1) === 0) {<br/>            $sort_order = 'DESC';<br/>            $attribute = substr($attribute, 1);<br/>        }<br/>        $roles-&gt;orderBy($attribute, $sort_order);<br/>    } else {<br/>        $roles-&gt;latest();<br/>    }<br/>    $roles = $roles-&gt;paginate(5);<br/>    return view('admin.role.index',compact('roles'))<br/>        -&gt;with('i', (request()-&gt;input('page', 1) - 1) * 5);<br/>}</span></pre><p id="6956" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在管理员/角色文件夹中创建 index.blade.php 视图文件</p><p id="2869" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源/视图/管理/角色/索引. blade.php</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="1a4b" class="oe lt iq ns b be of og l oh oa">&lt;x-app-layout&gt;<br/>    &lt;x-slot name="header"&gt;<br/>        &lt;h2 class="font-semibold text-xl text-gray-800 leading-tight"&gt;<br/>            {{ __('Roles') }}<br/>        &lt;/h2&gt;<br/>    &lt;/x-slot&gt;<br/>    &lt;div class="py-12"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="p-6 bg-white border-b border-gray-200"&gt;<br/>                    &lt;div class="flex flex-col mt-8"&gt;<br/>                    @can('role create')<br/>                    &lt;div class="d-print-none with-border mb-8"&gt;<br/>                        &lt;a href="{{ route('role.create') }}" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"&gt;{{ __('Add Role') }}&lt;/a&gt;<br/>                    &lt;/div&gt;<br/>                    @endcan<br/>                        &lt;div class="py-2"&gt;<br/>                        @if(session()-&gt;has('message'))<br/>                            &lt;div class="mb-8 text-green-400 font-bold"&gt;<br/>                                {{ session()-&gt;get('message') }}<br/>                            &lt;/div&gt;<br/>                        @endif<br/>                            &lt;div class="min-w-full border-b border-gray-200 shadow"&gt;<br/>                                &lt;form method="GET" action="{{ route('role.index') }}"&gt;<br/>                                &lt;div class="py-2 flex"&gt;<br/>                                    &lt;div class="overflow-hidden flex pl-4"&gt;<br/>                                        &lt;input type="search" name="search" value="{{ request()-&gt;input('search') }}" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Search"&gt;<br/>                                        &lt;button type='submit' class='ml-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150'&gt;<br/>                                            {{ __('Search') }}<br/>                                        &lt;/button&gt;<br/>                                    &lt;/div&gt;<br/>                                &lt;/div&gt;<br/>                                &lt;/form&gt;<br/>                                &lt;table class="border-collapse table-auto w-full text-sm"&gt;<br/>                                    &lt;thead&gt;<br/>                                        &lt;tr&gt;<br/>                                            &lt;th class="py-4 px-6 bg-grey-lightest font-bold uppercase text-sm text-grey-dark border-b border-grey-light text-left"&gt;<br/>                                                @include('admin.includes.sort-link', ['label' =&gt; 'Name', 'attribute' =&gt; 'name'])<br/>                                            &lt;/th&gt;<br/>                                            @canany(['role edit', 'role delete'])<br/>                                            &lt;th class="py-4 px-6 bg-grey-lightest font-bold uppercase text-sm text-grey-dark border-b border-grey-light text-left"&gt;<br/>                                                {{ __('Actions') }}<br/>                                            &lt;/th&gt;<br/>                                            @endcanany<br/>                                        &lt;/tr&gt;<br/>                                    &lt;/thead&gt;<br/>&lt;tbody class="bg-white dark:bg-slate-800"&gt;<br/>                                        @foreach($roles as $role)<br/>                                        &lt;tr&gt;<br/>                                            &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400"&gt;<br/>                                                &lt;div class="text-sm text-gray-900"&gt;<br/>                                                    &lt;a href="{{route('role.show', $role-&gt;id)}}" class="no-underline hover:underline text-cyan-600 dark:text-cyan-400"&gt;{{ $role-&gt;name }}&lt;/a&gt;<br/>                                                &lt;/div&gt;<br/>                                            &lt;/td&gt;<br/>                                            @canany(['role edit', 'role delete'])<br/>                                            &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400"&gt;<br/>                                                &lt;form action="{{ route('role.destroy', $role-&gt;id) }}" method="POST"&gt;<br/>                                                    @can('role edit')<br/>                                                    &lt;a href="{{route('role.edit', $role-&gt;id)}}" class="px-4 py-2 text-white mr-4 bg-blue-600"&gt;<br/>                                                        {{ __('Edit') }}<br/>                                                    &lt;/a&gt;<br/>                                                    @endcan<br/>                                                    @can('role delete')<br/>                                                    @csrf<br/>                                                                                          @method('DELETE')<br/>                                                    &lt;button class="px-4 py-2 text-white bg-red-600"&gt;<br/>                                                        {{ __('Delete') }}<br/>                                                    &lt;/button&gt;<br/>                                                    @endcan<br/>                                                &lt;/form&gt;<br/>                                            &lt;/td&gt;<br/>                                            @endcanany<br/>                                        &lt;/tr&gt;<br/>                                        @endforeach<br/>                                    &lt;/tbody&gt;<br/>                                &lt;/table&gt;<br/>                            &lt;/div&gt;<br/>                            &lt;div class="py-8"&gt;<br/>                                {{ $roles-&gt;appends(request()-&gt;query())-&gt;links() }}<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/x-app-layout&gt;</span></pre><p id="9dc9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">别忘了跑<code class="fe np nq nr ns b">sail npm run dev</code>去重建 CSS</p><p id="cce0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用下面的代码更新销毁函数</p><p id="d6a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="f7cd" class="oe lt iq ns b be of og l oh oa">public function destroy(Role $role)<br/>{<br/>    $role-&gt;delete();<br/>    return redirect()-&gt;route('role.index')<br/>                    -&gt;with('message','Role deleted successfully');<br/>}</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi op"><img src="../Images/ede51d411b93dbb0ef2c765171ec70d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3eXlUx9DnzjgXX_1PJ_qWw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">Laravel 管理面板-角色索引页面</figcaption></figure></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="e79b" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">5.创建有权限的操作</h2><p id="e32b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">用下面的代码更新<code class="fe np nq nr ns b">create</code>函数并创建<code class="fe np nq nr ns b">create.blade.php</code>一个视图文件。<code class="fe np nq nr ns b">Permission::all()</code>用于列出创建页面的权限。</p><p id="4aa5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="3b39" class="oe lt iq ns b be of og l oh oa">public function create()<br/>{<br/>    $permissions = Permission::all();<br/>    return view('admin.role.create', compact('permissions'));<br/>}</span></pre><p id="36c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源/视图/管理/角色/创建. blade.php</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="990d" class="oe lt iq ns b be of og l oh oa">&lt;x-app-layout&gt;<br/>    &lt;x-slot name="header"&gt;<br/>        &lt;h2 class="font-semibold text-xl text-gray-800 leading-tight"&gt;<br/>            {{ __('Roles') }}<br/>        &lt;/h2&gt;<br/>    &lt;/x-slot&gt;<br/>&lt;div class="py-12"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="px-6"&gt;<br/>                    &lt;h1 class="inline-block text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;{{ __('Create role') }}&lt;/h1&gt;<br/>                    &lt;a href="{{route('role.index')}}" class="no-underline hover:underline text-cyan-600 dark:text-cyan-400"&gt;{{ __('&lt;&lt; Back to all role') }}&lt;/a&gt;<br/>                    @if ($errors-&gt;any())<br/>                        &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>                            @foreach ($errors-&gt;all() as $error)<br/>                                &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>                            @endforeach<br/>                        &lt;/ul&gt;<br/>                    @endif<br/>                &lt;/div&gt;<br/>                &lt;div class="w-full px-6 py-4 bg-white overflow-hidden"&gt;<br/>&lt;form method="POST" action="{{ route('role.store') }}"&gt;<br/>                    @csrf<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="name" class="block font-medium text-sm text-gray-700{{$errors-&gt;has('name') ? ' text-red-400' : ''}}"&gt;{{ __('Name') }}&lt;/label&gt;<br/>&lt;input id="name" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;has('name') ? ' border-red-400' : ''}}"<br/>                                            type="text"<br/>                                            name="name"<br/>                                            value="{{ old('name') }}"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="py-2"&gt;<br/>                            &lt;h3 class="inline-block text-xl sm:text-2xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;Permissions&lt;/h3&gt;<br/>                            &lt;div class="grid grid-cols-4 gap-4"&gt;<br/>                                @forelse ($permissions as $permission)<br/>                                    &lt;div class="col-span-4 sm:col-span-2 md:col-span-1"&gt;<br/>                                        &lt;label class="form-check-label"&gt;<br/>                                            &lt;input type="checkbox" name="permissions[]" value="{{ $permission-&gt;name }}" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"&gt;<br/>                                            {{ $permission-&gt;name }}<br/>                                        &lt;/label&gt;<br/>                                    &lt;/div&gt;<br/>                                @empty<br/>                                    ----<br/>                                @endforelse<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>&lt;div class="flex justify-end mt-4"&gt;<br/>                            &lt;button type='submit' class='inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150'&gt;<br/>                                {{ __('Create') }}<br/>                            &lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/form&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/x-app-layout&gt;</span></pre><p id="bc12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览器中导航<code class="fe np nq nr ns b">http://localhost/admin/role/create</code> URL。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi oq"><img src="../Images/b18d7862f5009351cb619de1ff626d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*valMUBirbknidvQ2WqqiKw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">角色创建页面</figcaption></figure><p id="f253" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以复制下面的代码<code class="fe np nq nr ns b">store</code>函数</p><p id="39be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="8466" class="oe lt iq ns b be of og l oh oa">public function store(Request $request)<br/>{<br/>    $request-&gt;validate([<br/>        'name' =&gt; 'required|string|max:255|unique:'.config('permission.table_names.roles', 'roles').',name',<br/>    ]);<br/>    $role = Role::create($request-&gt;all());<br/>    if(! empty($request-&gt;permissions)) {<br/>        $role-&gt;givePermissionTo($request-&gt;permissions);<br/>    }<br/>    return redirect()-&gt;route('role.index')<br/>                    -&gt;with('message','Role created successfully.');<br/>}</span></pre><p id="1656" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">$ role-&gt; givePermissionTo($ request-&gt; permissions)用于保存对所创建角色的所有权限。</p></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="60f0" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">6.有权限的更新操作</h2><p id="2ff2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">类似于创建两个用于更新的函数。显示表格的<code class="fe np nq nr ns b">edit</code>功能和保存表格的<code class="fe np nq nr ns b">update</code>功能。</p><p id="fc50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="c62f" class="oe lt iq ns b be of og l oh oa">public function edit(Role $role)<br/>{<br/>    $permissions = Permission::all();<br/>    $roleHasPermissions = array_column(json_decode($role-&gt;permissions, true), 'id');<br/>    return view('admin.role.edit',compact('role', 'permissions', 'roleHasPermissions'));<br/>}<br/>public function update(Request $request, Role $role)<br/>{<br/>    $request-&gt;validate([<br/>        'name' =&gt; 'required|string|max:255|unique:'.config('permission.table_names.roles', 'roles').',name,'.$role-&gt;id,<br/>    ]);<br/>    $role-&gt;update($request-&gt;all());<br/>    $permissions = $request-&gt;permissions ?? [];<br/>    $role-&gt;syncPermissions($permissions);<br/>    return redirect()-&gt;route('role.index')<br/>                    -&gt;with('message','Role updated successfully.');<br/>}</span></pre><p id="4186" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的<code class="fe np nq nr ns b">$role-&gt;syncPermissions($permissions);</code>用于更新角色映射的权限。</p><p id="640d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源/视图/管理/角色/编辑. blade.php</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="de64" class="oe lt iq ns b be of og l oh oa">&lt;x-app-layout&gt;<br/>    &lt;x-slot name="header"&gt;<br/>        &lt;h2 class="font-semibold text-xl text-gray-800 leading-tight"&gt;<br/>            {{ __('Roles') }}<br/>        &lt;/h2&gt;<br/>    &lt;/x-slot&gt;<br/>&lt;div class="py-12"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="px-6"&gt;<br/>                    &lt;h1 class="inline-block text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;{{ __('Update role') }}&lt;/h1&gt;<br/>                    &lt;a href="{{route('role.index')}}" class="no-underline hover:underline text-cyan-600 dark:text-cyan-400"&gt;{{ __('&lt;&lt; Back to all role') }}&lt;/a&gt;<br/>                    @if ($errors-&gt;any())<br/>                        &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>                            @foreach ($errors-&gt;all() as $error)<br/>                                &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>                            @endforeach<br/>                        &lt;/ul&gt;<br/>                    @endif<br/>                &lt;/div&gt;<br/>                &lt;div class="w-full px-6 py-4 bg-white overflow-hidden"&gt;<br/>&lt;form method="POST" action="{{ route('role.update', $role-&gt;id) }}"&gt;<br/>                    @csrf<br/>                    @method('PUT')<br/>&lt;div class="py-2"&gt;<br/>                            &lt;label for="name" class="block font-medium text-sm text-gray-700{{$errors-&gt;has('name') ? ' text-red-400' : ''}}"&gt;{{ __('Name') }}&lt;/label&gt;<br/>&lt;input id="name" class="rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 block mt-1 w-full{{$errors-&gt;has('name') ? ' border-red-400' : ''}}"<br/>                                            type="text"<br/>                                            name="name"<br/>                                            value="{{ old('name', $role-&gt;name) }}"<br/>                                            /&gt;<br/>                        &lt;/div&gt;<br/>                        @unless ($role-&gt;name == env('APP_SUPER_ADMIN', 'super-admin'))<br/>                        &lt;div class="py-2"&gt;<br/>                            &lt;h3 class="inline-block text-xl sm:text-2xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;Permissions&lt;/h3&gt;<br/>                            &lt;div class="grid grid-cols-4 gap-4"&gt;<br/>                                @forelse ($permissions as $permission)<br/>                                    &lt;div class="col-span-4 sm:col-span-2 md:col-span-1"&gt;<br/>                                        &lt;label class="form-check-label"&gt;<br/>                                            &lt;input type="checkbox" name="permissions[]" value="{{ $permission-&gt;name }}" {{ in_array($permission-&gt;id, $roleHasPermissions) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"&gt;<br/>                                            {{ $permission-&gt;name }}<br/>                                        &lt;/label&gt;<br/>                                    &lt;/div&gt;<br/>                                @empty<br/>                                    ----<br/>                                @endforelse<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>                        @endunless<br/>&lt;div class="flex justify-end mt-4"&gt;<br/>                            &lt;button type='submit' class='inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150'&gt;<br/>                                {{ __('Update') }}<br/>                            &lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/form&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/x-app-layout&gt;</span></pre><p id="9d42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">超级管理员不需要权限选择。所以增加了<code class="fe np nq nr ns b">@unless ($role-&gt;name == env(‘APP_SUPER_ADMIN’, ‘super-admin’))</code>一个权限选择部分的条件。还有“<code class="fe np nq nr ns b">APP_SUPER_ADMIN</code>”用于获取可配置的管理员名称。</p><p id="3b73" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 AuthServiceProvider 上更新相同的 env 值</p><p id="1d0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Providers/authserviceprovider . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="912c" class="oe lt iq ns b be of og l oh oa">// Implicitly grant "Super-Admin" role all permission checks using can()<br/> Gate::before(function ($user, $ability) {<br/>-            if ($user-&gt;hasRole('super-admin')) {<br/>+            if ($user-&gt;hasRole(env('APP_SUPER_ADMIN', 'super-admin'))) {<br/>         return true;<br/>     }<br/> });</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi or"><img src="../Images/25d390c7975ec8a07cdd8daea154df18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtzIchs6RP-leKp3nugdZw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">角色编辑页面</figcaption></figure></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="aed0" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">7.查看页面</h2><p id="bc13" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在控制器显示函数上添加以下代码</p><p id="5183" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">app/Http/Controllers/Admin/role controller . PHP</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="fb78" class="oe lt iq ns b be of og l oh oa">public function show(Role $role)<br/>{<br/>    $permissions = Permission::all();<br/>    $roleHasPermissions = array_column(json_decode($role-&gt;permissions, true), 'id');<br/>    return view('admin.role.show', compact('role', 'permissions', 'roleHasPermissions'));<br/>}</span></pre><p id="bf76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源/视图/管理/角色/显示. blade.php</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="4f6e" class="oe lt iq ns b be of og l oh oa">&lt;x-app-layout&gt;<br/>    &lt;x-slot name="header"&gt;<br/>        &lt;h2 class="font-semibold text-xl text-gray-800 leading-tight"&gt;<br/>            {{ __('Roles') }}<br/>        &lt;/h2&gt;<br/>    &lt;/x-slot&gt;<br/>&lt;div class="py-12"&gt;<br/>        &lt;div class="max-w-7xl mx-auto sm:px-6 lg:px-8"&gt;<br/>            &lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>                &lt;div class="px-6"&gt;<br/>                    &lt;h1 class="inline-block text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight dark:text-slate-200 py-4 block sm:inline-block flex"&gt;{{ __('View role') }}&lt;/h1&gt;<br/>                    &lt;a href="{{route('role.index')}}" class="no-underline hover:underline text-cyan-600 dark:text-cyan-400"&gt;{{ __('&lt;&lt; Back to all role') }}&lt;/a&gt;<br/>                    @if ($errors-&gt;any())<br/>                        &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>                            @foreach ($errors-&gt;all() as $error)<br/>                                &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>                            @endforeach<br/>                        &lt;/ul&gt;<br/>                    @endif<br/>                &lt;/div&gt;<br/>                &lt;div class="w-full px-6 py-4"&gt;<br/>                    &lt;div class="min-w-full border-b border-gray-200 shadow"&gt;<br/>                        &lt;table class="table-fixed w-full text-sm"&gt;<br/>                            &lt;tbody class="bg-white dark:bg-slate-800"&gt;<br/>                                &lt;tr&gt;<br/>                                    &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400"&gt;{{ __('Name') }}&lt;/td&gt;<br/>                                    &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 text-slate-500 dark:text-slate-400"&gt;{{$role-&gt;name}}&lt;/td&gt;<br/>                                &lt;/tr&gt;<br/>                                &lt;tr&gt;<br/>                                @unless ($role-&gt;name == env('APP_SUPER_ADMIN', 'super-admin'))<br/>                                &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400"&gt;{{ __('Permissions') }}&lt;/td&gt;<br/>                                    &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 text-slate-500 dark:text-slate-400"&gt;<br/>&lt;div class="py-2"&gt;<br/>                                        &lt;div class="grid grid-cols-4 gap-4"&gt;<br/>                                            @forelse ($permissions as $permission)<br/>                                                &lt;div class="col-span-4 sm:col-span-2 md:col-span-2"&gt;<br/>                                                    &lt;label class="form-check-label"&gt;<br/>                                                        &lt;input type="checkbox" name="permissions[]" value="{{ $permission-&gt;name }}" {{ in_array($permission-&gt;id, $roleHasPermissions) ? 'checked' : '' }} disabled="disabled" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"&gt;<br/>                                                        {{ $permission-&gt;name }}<br/>                                                    &lt;/label&gt;<br/>                                                &lt;/div&gt;<br/>                                            @empty<br/>                                                ----<br/>                                            @endforelse<br/>                                        &lt;/div&gt;<br/>                                    &lt;/div&gt;<br/>                                    &lt;/td&gt;<br/>                                &lt;/tr&gt;<br/>                                @endunless<br/>                                &lt;tr&gt;<br/>                                    &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400"&gt;{{ __('Created') }}&lt;/td&gt;<br/>                                    &lt;td class="border-b border-slate-100 dark:border-slate-700 p-4 text-slate-500 dark:text-slate-400"&gt;{{$role-&gt;created_at}}&lt;/td&gt;<br/>                                &lt;/tr&gt;<br/>                            &lt;/tbody&gt;<br/>                        &lt;/table&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/x-app-layout&gt;</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi or"><img src="../Images/4fa219edf11bbbc954797f2310ecd2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPe5VUsWR63vqEUTFXJDLQ.png"/></div></div></figure></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="f647" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">8.向导航添加链接</h2><p id="04b5" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在导航中添加了角色和用户链接。我们将在下一篇文章中添加用户的 CRUD。</p><pre class="ld le lf lg gt nt ns ob bn oc od bi"><span id="c781" class="oe lt iq ns b be of og l oh oa">+++ b/resources/views/layouts/navigation.blade.php<br/>@@ -16,7 +16,13 @@<br/>                         {{ __('Dashboard') }}<br/>                     &lt;/x-nav-link&gt;<br/>                     &lt;x-nav-link :href="route('permission.index')" :active="request()-&gt;routeIs('permission.index')"&gt;<br/>-                        {{ __('Permission') }}<br/>+                        {{ __('Permissions') }}<br/>+                    &lt;/x-nav-link&gt;<br/>+                    &lt;x-nav-link :href="route('role.index')" :active="request()-&gt;routeIs('role.index')"&gt;+                        {{ __('Roles') }}<br/>+                    &lt;/x-nav-link&gt;<br/>+                    &lt;x-nav-link :href="route('user.index')" :active="request()-&gt;routeIs('user.index')"&gt;+                        {{ __('Users') }}<br/>                     &lt;/x-nav-link&gt;<br/>                 &lt;/div&gt;<br/>             &lt;/div&gt;<br/>@@ -70,7 +76,13 @@<br/>                 {{ __('Dashboard') }}<br/>             &lt;/x-responsive-nav-link&gt;<br/>             &lt;x-responsive-nav-link :href="route('permission.index')" :active="request()-&gt;routeIs('permission.index')"&gt;<br/>-                {{ __('Permission') }}<br/>+                {{ __('Permissions') }}<br/>+            &lt;/x-responsive-nav-link&gt;<br/>+            &lt;x-responsive-nav-link :href="route('role.index')" :active="request()-&gt;routeIs('role.index')"&gt;<br/>+                {{ __('Roles') }}<br/>+            &lt;/x-responsive-nav-link&gt;<br/>+            &lt;x-responsive-nav-link :href="route('user.index')" :active="request()-&gt;routeIs('user.index')"&gt;<br/>+                {{ __('Users') }}<br/>             &lt;/x-responsive-nav-link&gt;<br/>         &lt;/div&gt;</span></pre></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h2 id="84be" class="nd lt iq bd lu ne nf dn ly ng nh dp mc ko ni nj me ks nk nl mg kw nm nn mi no bi translated">GitHub 知识库</h2><p id="8750" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">角色代码可在<a class="ae lb" href="https://github.com/balajidharma/basic-laravel-admin-panel/tree/archive/1.0.5" rel="noopener ugc nofollow" target="_blank"> 1.0.5 </a>分支上获得</p><p id="456a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上一部分—第 6 部分:<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/implements-a-basic-search-filter-and-column-sort-with-pagination-in-laravel-crud-5e3c70fb12ac">实现了一个基本的搜索过滤器和带有分页的列排序</a></p><p id="408c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一部分—第 8 部分:<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/basic-laravel-admin-panel-user-management-crud-45f694ef60cc"> Laravel 用户管理 CRUD </a></p></div></div>    
</body>
</html>