<html>
<head>
<title>Django and HTMX Part 2 (periodic refreshing)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 和 HTMX 第 2 部分(定期刷新)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/django-and-htmx-part-2-periodic-refreshing-768cc059a06d?source=collection_archive---------3-----------------------#2021-12-21">https://blog.devgenius.io/django-and-htmx-part-2-periodic-refreshing-768cc059a06d?source=collection_archive---------3-----------------------#2021-12-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6774b6ee1fc12ca47b3624b26c95e552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gBFHyGTbW0qSilp-"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@nick604?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尼克冲</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c6b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以在我的上一篇文章中，我演示了如何使用 HTMX 创建一个简单的<em class="ky">按钮，比如</em>按钮，而不需要刷新页面，从而避免使用任何 JavaScript。在这篇文章中，我想展示如何定期从 API 加载数据。这在可能显示实时变化数据(如货币变化)的网站上非常有用。HTMX 再次轻松帮助构建 Django 互动网站，无需前端 JavaScript 知识。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="bc17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过快速搜索，我发现 Coindesk 有一个不需要注册码的 API。</p><p id="07e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不会从头开始讲述如何构建 Django 应用程序。这已经在第 1 部分中完成了。相反，我只会提到…</p><ul class=""><li id="0821" class="lg lh in kc b kd ke kh ki kl li kp lj kt lk kx ll lm ln lo bi translated">我创建了一个名为 core 的 Django 项目</li><li id="58cb" class="lg lh in kc b kd lp kh lq kl lr kp ls kt lt kx ll lm ln lo bi translated">并创建了一个名为 post 的应用程序。(这款应用其实并不需要。我猜是习惯🤷🏽‍♂️ )</li></ul><p id="f8f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我实际上没有添加任何模型，因为我不需要任何模型来演示。</p><p id="ca3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以从我的<a class="ae jz" href="https://github.com/bitFez/htmx_guide_2-periodic_refreshing" rel="noopener ugc nofollow" target="_blank"> Github repo 这里</a>找到并克隆这个项目。</p><p id="cab7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我简单地指向了来自<em class="ky">核心</em> urls.py 的<em class="ky">帖子应用</em>中的 urls.py。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="b325" class="md me in lz b gy mf mg l mh mi"># core urls.py<br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', include('post.urls')),<br/>]</span></pre><p id="7e87" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<em class="ky">贴吧 app </em> urls.py 中，我只有一个网址路径。这只是指向主页。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2f6a" class="md me in lz b gy mf mg l mh mi"># post urls.py<br/>from . import views</span><span id="0baa" class="md me in lz b gy mj mg l mh mi">urlpatterns = [<br/>    path('', views.index, name='home'),<br/>]</span></pre><p id="1d72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在在<em class="ky">贴吧 app </em> views.py 文件中，真的只有一个功能。requirements.txt 文件中的一个依赖项是我已经从 PyPi 库安装了<a class="ae jz" href="https://pypi.org/project/django-htmx/" rel="noopener ugc nofollow" target="_blank"> Django-htmx 扩展，它允许从后端调用 htmx 扩展。您可以在第 17 行看到，检查函数调用是否是 htmx 请求。如果是这种情况，那么只有部分将被调用，以便简单地刷新 API 数据，而不需要重新加载整个页面。</a></p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7253" class="md me in lz b gy mf mg l mh mi">from django.shortcuts import render<br/>import requests # this is for making web requests for API<br/>import json # For parsing API json data</span><span id="4822" class="md me in lz b gy mj mg l mh mi">def index(request):<br/>  response = requests.get('<a class="ae jz" href="https://api.coindesk.com/v1/bpi/currentprice.json'" rel="noopener ugc nofollow" target="_blank">https://api.coindesk.com/v1/bpi/currentprice.json'</a>) # This is the coindesk REST API call<br/>  data = response.json()</span><span id="6940" class="md me in lz b gy mj mg l mh mi"># The following lines extract data from the API response.<br/>  time = data["time"]["updated"]<br/>  usd = data["bpi"]["USD"]["rate"]<br/>  gbp = data["bpi"]["GBP"]["rate"]<br/>  eur = data["bpi"]["EUR"]["rate"]</span><span id="08a2" class="md me in lz b gy mj mg l mh mi">context = {'usd':usd, 'gbp':gbp, 'eur':eur, 'time':time}</span><span id="8b46" class="md me in lz b gy mj mg l mh mi">if request.htmx:<br/>    return render(request, 'post/partials/bitcoin.html', context)<br/>  else:<br/>    return render(request, 'post/index.html', context)</span></pre><p id="eaf2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是“index.html”文件。这里有三个要点。</p><ul class=""><li id="d0ee" class="lg lh in kc b kd ke kh ki kl li kp lj kt lk kx ll lm ln lo bi translated">首先，div 标签包含 3 个 htmx 标签。<br/> - <code class="fe mk ml mm lz b">hx-get</code>调用索引视图函数，刷新页面。<br/> - <code class="fe mk ml mm lz b">hx-trigger</code>告诉 htmx 每隔 10 秒触发调用<em class="ky"><br/>-<code class="fe mk ml mm lz b">hx-swap</code>innerHTML 告诉 HTMX 只交换当前<code class="fe mk ml mm lz b">div</code>内的页面部分</em></li><li id="3a99" class="lg lh in kc b kd lp kh lq kl lr kp ls kt lt kx ll lm ln lo bi translated">结束<code class="fe mk ml mm lz b">body</code>标签下的<code class="fe mk ml mm lz b">script</code>标签需要调用 htmx <code class="fe mk ml mm lz b">hx</code>标签。没有这些页面刷新调用将不会进行。</li><li id="c8c2" class="lg lh in kc b kd lp kh lq kl lr kp ls kt lt kx ll lm ln lo bi translated">最后，<code class="fe mk ml mm lz b">{% include … %}</code> Django 标签加载部分节，这将保持每 10 秒重新加载一次<code class="fe mk ml mm lz b">hx-trigger</code></li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="946e" class="md me in lz b gy mf mg l mh mi">&lt;html&gt;<br/>  &lt;body&gt;</span><span id="5c3c" class="md me in lz b gy mj mg l mh mi">    &lt;h1&gt;Latest Bitcoin Price Updates&lt;/h1&gt;</span><span id="ddb5" class="md me in lz b gy mj mg l mh mi">    &lt;div id="btc" hx-get="{% url 'home' %}" hx-trigger="every 10s" hx-swap="innerHTML"&gt;     <br/>     {% include 'post/partials/bitcoin.html' %}<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;</span><span id="99ca" class="md me in lz b gy mj mg l mh mi">  &lt;script src="https://unpkg.com/htmx.org@1.6.1"&gt;&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="535c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里的最后一项是部分 HTML 部分，它将每 10 秒重新加载一次。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="755b" class="md me in lz b gy mf mg l mh mi">&lt;div&gt;<br/>  &lt;small&gt;(last updated {{time}})&lt;/small&gt;<br/>  &lt;p&gt;USD: {{usd}}&lt;/p&gt;<br/>  &lt;p&gt;GBP: {{gbp}}&lt;/p&gt;<br/>  &lt;p&gt;EUR: {{eur}}&lt;/p&gt;<br/>&lt;/div&gt;</span></pre><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6ea4ab5143da704b0c0e6e6eedab1566.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*Sso2xHbH9jARJ4XG81zICg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">这是网页的截图。它还直接从 API 更新上次更新时间</figcaption></figure><h2 id="6437" class="md me in bd mo mp mq dn mr ms mt dp mu kl mv mw mx kp my mz na kt nb nc nd ne bi translated">就是这样！</h2><p id="2ff3" class="pw-post-body-paragraph ka kb in kc b kd nf kf kg kh ng kj kk kl nh kn ko kp ni kr ks kt nj kv kw kx ig bi translated">如果你觉得这个有用，请给它一些👏&amp;考虑给我提供一些咖啡<a class="ae jz" href="https://ko-fi.com/bitfez" rel="noopener ugc nofollow" target="_blank">https://ko-fi.com/bitfez</a>。这让我有动力去写更多简单的帖子。</p></div></div>    
</body>
</html>