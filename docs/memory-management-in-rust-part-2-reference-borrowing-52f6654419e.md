# Rust ä¸­çš„å†…å­˜ç®¡ç†-ç¬¬ 2 éƒ¨åˆ†:å¼•ç”¨å€Ÿç”¨

> åŸæ–‡ï¼š<https://blog.devgenius.io/memory-management-in-rust-part-2-reference-borrowing-52f6654419e?source=collection_archive---------10----------------------->

![](img/a226a4a902d62e4250248ec17a49513d.png)

åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« [Rust ä¸­çš„å†…å­˜ç®¡ç†â€”â€”ç¬¬ 1 éƒ¨åˆ†:æ‰€æœ‰æƒå’Œç§»åŠ¨](https://anismousse.medium.com/ownership-and-moves-in-rust-4a9c6f02108d)ä¸­ï¼Œæˆ‘ä»¬è½»æ¾åœ°ç†è§£äº† Rust ä¸­çš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚

æˆ‘ä»¬å‘ç°äº†**æ‰€æœ‰æƒ**å’Œ**ç§»åŠ¨**çš„æ¦‚å¿µï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™å¥è¯æ¥æ¦‚æ‹¬:

> ***æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ‰€æœ‰è€…ï¼Œè¿™ä¸ªæ‰€æœ‰è€…å†³å®šäº†å®ƒçš„å¯¿å‘½ã€‚***

åœ¨è¿™ç¯‡æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä»‹ç»**å¼•ç”¨**å’Œ**å¼•ç”¨å€Ÿç”¨**çš„æ¦‚å¿µï¼›æˆ‘ä»¬å°±è¦åˆ°è¾¾ç»ˆç‚¹äº†â€¦æ‰€ä»¥è¯·åšæŒä½ğŸ¦¾.

# ä»€ä¹ˆæ˜¯å‚è€ƒï¼Ÿ

å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œ ***ä¸æ‹¥æœ‰å®ƒæ‰€æŒ‡å‘çš„*** å€¼ï¼›å®ƒæ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå®ƒæ‰€æŒ‡å‘çš„å€¼å°±æ˜¯åœ¨è¿™ä¸ªåœ°å€ä¸Šè¡¨ç¤ºçš„ã€‚

ä½¿ç”¨**ä¸ç¬¦å·** `**&**`åˆ›å»ºå¼•ç”¨ï¼Œä½¿ç”¨**æ˜Ÿå·(*)** è¿›è¡Œè§£å¼•ç”¨(è®¿é—®å…¶å¼•ç”¨çš„å€¼)ã€‚

å‡è®¾æˆ‘ä»¬æœ‰`let variable = 1;`ï¼Œæœ‰`let reference = &variable;`ï¼Œ`reference`æ˜¯æŒ‡å‘`value`çš„å¼•ç”¨ï¼Œ`*reference`ç›¸å½“äº`1`æ˜¯åœ¨`variable`å†…æ’åºçš„å€¼ã€‚

Rust ä¸­çš„å¼•ç”¨

å¼•ç”¨ä¸èƒ½æ¯”å®ƒæ‰€å¼•ç”¨çš„å€¼æ›´é•¿å¯¿ï¼Œè¿™å°±å¼•å…¥äº†**å€Ÿç”¨**çš„æ¦‚å¿µã€‚

å¼•ç”¨**ä»å®ƒçš„æ‰€æœ‰è€…é‚£é‡Œå€Ÿç”¨**å®ƒä»¬æ‰€æŒ‡å‘çš„å€¼ï¼Œå¹¶æœ€ç»ˆå°†å®ƒè¿”å›ã€‚

ä½ å¯èƒ½å·²ç»æ„è¯†åˆ°äº†**å¼•ç”¨å€Ÿç”¨**æ¦‚å¿µç»™**æ‰€æœ‰æƒ**å’Œ**ç§»åŠ¨**æ¦‚å¿µå¼•å…¥äº†ä¸€äº›çµæ´»æ€§(åœ¨è¿™é‡Œå¤ä¹ é‚£äº›æ¦‚å¿µ[)ã€‚](https://anismousse.medium.com/ownership-and-moves-in-rust-4a9c6f02108d)

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰“å°å˜é‡`missy_favorite_humans,`ä¸­çš„æ‰€æœ‰å€¼ï¼Œç„¶åæ‰“å°å®ƒçš„å¤§å°ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º`missy_favorite_humans`å°†å…¶å€¼çš„æ‰€æœ‰æƒä¼ é€’ç»™äº†`for`å¾ªç¯ï¼Œå› æ­¤å½“æˆ‘ä»¬è¯•å›¾å¯¹å˜é‡`missy_favorite_humans`è°ƒç”¨`len()`æ–¹æ³•æ—¶ï¼Œå˜é‡`missy_favorite_humans`æ˜¯æœªå®šä¹‰çš„ã€‚

Rust ç¼–è¯‘å™¨æ‹’ç»çš„ç¤ºä¾‹

ç°åœ¨è®©æˆ‘ä»¬åœ¨åŒä¸€ä¸ªç¤ºä¾‹ä¸­å¼•å…¥ä¸€ä¸ªå¼•ç”¨:

å‚è€ƒå€Ÿé˜…ç¤ºä¾‹

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`for`å¾ªç¯æ˜¯åœ¨å¯¹`missy_favorite_humans`çš„å¼•ç”¨ä¸Šå®Œæˆçš„ã€‚`for`å¾ªç¯å¯ä»¥é€šè¿‡`&missy_favorite_humans`è®¿é—®å€Ÿç”¨å€¼å¹¶æ‰“å°å‡ºæ¥ã€‚åœ¨å¾ªç¯çš„æœ€åï¼Œ`&missy_favorite_humans`æ­£åœ¨è„±ç¦»èŒƒå›´ï¼Œè€Œ`missy_favorite_humans`ä»ç„¶æ‹¥æœ‰å…¶é¡¹ç›®çš„æ‰€æœ‰æƒã€‚å› æ­¤ï¼Œå¯ä»¥å¤„ç†ç¬¬ 10 è¡Œä¸Šçš„æŒ‡ä»¤ã€‚

ä½†æ˜¯ Rust æ˜¯å¦‚ä½•ç¡®ä¿ä¸€ä¸ªå¼•ç”¨ä¸èƒ½æ¯”å®ƒæ‰€å¼•ç”¨çš„å€¼æ›´é•¿å¯¿çš„å‘¢ï¼Ÿæ•‘æ´æ¥äº†: ***ç”Ÿç”Ÿä¸–ä¸–*** ã€‚

# ä¸€ç”Ÿ

æ­£å¦‚åœ¨ [Rust by Examples](https://doc.rust-lang.org/rust-by-example/scope/lifetime.html) ä¸­æåˆ°çš„ï¼Œä¸€ä¸ª**ç”Ÿå­˜æœŸ**æ˜¯ç¼–è¯‘å™¨(å€Ÿä½æ£€æŸ¥å™¨)ç”¨æ¥ç¡®ä¿æ‰€æœ‰å€Ÿä½æœ‰æ•ˆçš„ä¸€ä¸ªæ„é€ ã€‚æ¢å¥è¯è¯´ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­å˜é‡æˆ–å¼•ç”¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ã€‚

ä¸ºäº†æ»¡è¶³ ***å¼•ç”¨ä¸èƒ½æ¯”å®ƒæ‰€å¼•ç”¨çš„*** çš„å€¼æ›´é•¿å¯¿çš„è§„åˆ™ï¼Œç¼–è¯‘å™¨æ£€æŸ¥å¼•ç”¨**çš„ç”Ÿå­˜æœŸæ˜¯å¦å¿…é¡»åŒ…å«åœ¨å®ƒæ‰€å¼•ç”¨çš„å˜é‡çš„ç”Ÿå­˜æœŸå†…**ã€‚(åœ¨è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œå†è¯»ä¸€éğŸ§).

ä¸‹é¢çš„ä»£ç ç¤ºä¾‹**è¢«ç¼–è¯‘å™¨æ‹’ç»**ï¼Œå› ä¸ºå˜é‡`reference`(ä¸€ä¸ªå€Ÿç”¨å¼•ç”¨)çš„ç”Ÿå­˜æœŸä¸åŒ…å«åœ¨`variable`çš„ç”Ÿå­˜æœŸå†…ï¼›å®ƒå¼•ç”¨çš„å€¼ã€‚

![](img/d45ebac9ab1a4d42d743fd1087b03e07.png)

ä¸åˆè§„çš„å‚è€ƒæ–‡çŒ®å€Ÿç”¨ç¤ºä¾‹

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¨åŠ ä¿®æ”¹çš„ç±»ä¼¼ä¾‹å­:

![](img/6dc87c8cf4241b0f417f6babaa85ac04.png)

ç¬¦åˆè§„èŒƒçš„å‚è€ƒæ–‡çŒ®å€Ÿé˜…ç¤ºä¾‹

æ­£å¦‚ä½ åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œå¼•ç”¨å€Ÿç”¨æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸè§„åˆ™å¾—åˆ°äº†å°Šé‡ã€‚

å½“åœ¨å‡½æ•°ç­¾åã€ç»“æ„ã€æšä¸¾ã€`impl`å—ä¸­ä½¿ç”¨å¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç²¾ç¡®å®ƒä»¬çš„ç”Ÿå­˜æœŸã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒRust ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­ç”Ÿå­˜æœŸï¼Œå¹¶å…è®¸æˆ‘ä»¬çœç•¥å®ƒ( [Lifetime Elision](https://doc.rust-lang.org/nomicon/lifetime-elision.html) )ã€‚

å¯¿å‘½ç”¨æ’‡å·`'`è¡¨ç¤ºã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå°å†™å­—æ¯ç”¨äºå‘½åã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­:

å…·æœ‰ç”Ÿå­˜æœŸçš„å‡½æ•°ã€ç»“æ„å’Œæšä¸¾çš„ç¤ºä¾‹

`'static`å¯¿å‘½æ³¨é‡Šæ˜¯**ä¿ç•™çš„**å¯¿å‘½æ³¨é‡Šã€‚è¿™äº›**å‚è€ƒå¯¹æ•´ä¸ªç¨‹åº**æœ‰æ•ˆã€‚å®ƒä»¬ä¿å­˜åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®æ®µä¸­ï¼Œå¼•ç”¨çš„æ•°æ®æ°¸è¿œä¸ä¼šè¶…å‡ºèŒƒå›´ã€‚

***éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRust æ²¡æœ‰ç©ºå¼•ç”¨ã€‚***

# ä¸åŒç±»å‹çš„å‚è€ƒ

å¼•ç”¨æœ‰ä¸¤ç§ç±»å‹ï¼Œ**å…±äº«å¼•ç”¨**å’Œ**å¯å˜å¼•ç”¨**ã€‚è®©æˆ‘ä»¬é€ä¸€æ¢ç©¶ã€‚

## å…±äº«å‚è€ƒ

å…±äº«å¼•ç”¨å…è®¸æ‚¨è¯»å–å®ƒä»¬æ‰€å¼•ç”¨çš„å€¼ï¼Œä½†ä¸å…è®¸æ‚¨æ›´æ”¹å®ƒä»¬ã€‚æ‚¨å¯ä»¥åŒæ—¶æ‹¥æœ‰å¯¹åŒä¸€å€¼çš„å¤šä¸ªå¼•ç”¨ã€‚

å½“å­˜åœ¨å…±äº«å¼•ç”¨æ—¶ï¼Œæ— è®ºæ˜¯å®ƒæ‰€å¼•ç”¨çš„é¡¹ç›®è¿˜æ˜¯é€šè¿‡è¯¥é¡¹ç›®çš„ä»»ä½•å…¶ä»–å†…å®¹éƒ½ä¸èƒ½è¢«ä»»ä½•å†…å®¹æ›´æ”¹ã€‚**æ‰€æœ‰æƒæ ‘**ä¸­æ‰€æœ‰æ¶‰åŠå…±äº«å¼•ç”¨çš„éƒ¨åˆ†**éƒ½æ˜¯ä¸å¯æ›´æ”¹çš„ã€‚**

![](img/6ebe9c5a6bfd0c5e08f3921ab52c15fc.png)

å€Ÿç”¨å…±äº«å¼•ç”¨æ—¶çš„å¯è®¿é—®æ€§

## å¯å˜å¼•ç”¨

å¯å˜å¼•ç”¨å…è®¸æ‚¨è¯»å–å’Œä¿®æ”¹å®ƒæ‰€å¼•ç”¨çš„å€¼ã€‚å…³é”®å­—:`&mut`å…è®¸ä½ åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ã€‚

å¯å˜å¼•ç”¨æ˜¯**æ’ä»–çš„**ï¼Œè¿™æ„å‘³ç€å½“ä¸€ä¸ªå€¼ä¸Šæœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨æ—¶ï¼Œé™¤äº†ç°æœ‰å¯å˜å¼•ç”¨ä¸Šçš„å¯å˜å¼•ç”¨ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¸èƒ½åŒæ—¶æ‹¥æœ‰è¯¥å€¼ä¸Šä»»ä½•ç±»å‹çš„ä»»ä½•å…¶ä»–å¼•ç”¨ã€‚

![](img/ecd9cad7ff71c1dfca66e4d744d3eb5c.png)

å€Ÿç”¨å¯å˜å¼•ç”¨æ—¶çš„å¯è®¿é—®æ€§

å…±äº«å¼•ç”¨å’Œå¯å˜å¼•ç”¨çš„åŒºåˆ«å¯ä»¥ç”¨ä¸‹é¢çš„è§„åˆ™æ¥æ¦‚æ‹¬: ***ä¸€ä¸ªå€¼å¯ä»¥æœ‰å¤šä¸ªè¯»å–è€…(å…±äº«å¼•ç”¨)æˆ–è€…ä¸€ä¸ªå†™å…¥è€…(å¯å˜å¼•ç”¨)*** ã€‚

## æœ€å

åœ¨å¯¹å†…å­˜ç®¡ç†çš„æ¦‚è¿°ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸ºäº†å®ç°å…¶ä¸‰è¿èƒœæ„¿æœ›çš„**å®‰å…¨**æ”¯æŸ±ï¼ŒRust å¯¹**æ‰€æœ‰æƒæœ‰ä¸€ä¸ªé™åˆ¶æ€§çš„è§„åˆ™**ã€‚ç”±äº**ç§»åŠ¨**æ¦‚å¿µã€**å¼•ç”¨**ã€**å¼•ç”¨å€Ÿç”¨**ä»¥åŠæ‰€æœ‰ä¿ƒè¿›æˆ‘ä»¬ä¸è®°å¿†äº’åŠ¨çš„è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™çš„ä¸€äº›çµæ´»æ€§æ˜¯å¯èƒ½çš„ã€‚

> Rust çš„ç¾å¦™ä¹‹å¤„åœ¨äºé‚£äº›åœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶æ‰§è¡Œçš„ä¸¥æ ¼è§„åˆ™ï¼Œè¿™äº›è§„åˆ™è¿«ä½¿æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±æ‹¥æœ‰ä¸€ä¸ªæ·±æ€ç†Ÿè™‘çš„ã€æ¶æ„æ­£ç¡®çš„ã€å®‰å…¨çš„ç¨‹åºã€‚

åœ¨ Rustï¼Œæ‰€æœ‰çš„æ”¯ç¥¨éƒ½æ˜¯é¢„å…ˆå…‘ç°çš„ï¼ï¼ï¼

![](img/23707582c0d171d05c2d3a5ea3759df1.png)

ç±³è¥¿ç­‰ç€æˆ‘é”€æ¯é—¨ä¸Šçš„å¯å˜å¼•ç”¨

# èµ„æº

[æ‰€æœ‰æƒ](https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html?highlight=ownership#what-is-ownership)ç« å‡ºè‡ªâ€˜T**ä½•é”ˆç¼–ç¨‹è¯­è¨€**â€™ã€‚

[ç¼–ç¨‹ç”Ÿé”ˆï¼Œç¬¬äºŒç‰ˆ](https://www.oreilly.com/library/view/programming-rust-2nd/9781492052586/)

[é”ˆç”±ä¾‹](https://doc.rust-lang.org/rust-by-example/index.html)