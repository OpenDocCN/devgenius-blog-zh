<html>
<head>
<title>How to Calculate the Daily Returns And Volatility of a Stock with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 计算一只股票的日收益和波动率</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-calculate-the-daily-returns-and-volatility-of-a-stock-with-python-d4e1de53e53b?source=collection_archive---------1-----------------------#2022-06-25">https://blog.devgenius.io/how-to-calculate-the-daily-returns-and-volatility-of-a-stock-with-python-d4e1de53e53b?source=collection_archive---------1-----------------------#2022-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0da5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来练习一下辉瑞和现代股票在疫情期间的表现。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e71ba58c6e218f32882703875092ee82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAp7bYis7-x3iL8-GudY7Q.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片来自 Unsplash 的 Wance Paleri</figcaption></figure><p id="3bc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“泡沫市场崩溃”、“加密裂缝”、“衰退”……如果你是一个股票投资者，你很有可能经常在最近几周检查你的投资组合。全球股市将在 2022 年下跌，原因有很多:乌克兰战争、通货膨胀、油价上涨和利率上升等。</p><p id="b096" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是开始用 Python 提升股票数据技能的绝佳机会。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="10ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="li">免责声明</em> </strong> <em class="li">:这篇博文的目的只是为了展示如何计算一只股票的日收益和波动率。没有任何股票的投资建议或推广。</em></p><h2 id="1bd0" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">内容:</h2><ol class=""><li id="2ce4" class="mc md iq jp b jq me ju mf jy mg kc mh kg mi kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#ac29" rel="noopener">用例</a></li><li id="ea7c" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#834e" rel="noopener">所需的 Python 库</a></li><li id="c227" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#5b45" rel="noopener">用 yfinance 检索股票数据</a></li><li id="6620" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#00b3" rel="noopener">计算并绘制每日回报</a></li><li id="b718" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#42e6" rel="noopener">计算股票每日、每月和每年的波动性</a></li><li id="1451" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk mj mk ml mm bi translated"><a class="ae mn" href="https://medium.com/p/d4e1de53e53b#fe4f" rel="noopener">结论</a></li></ol></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="ac29" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">1.使用案例</h2><p id="9b82" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">新冠肺炎疫情引发了世界的巨变。股票市场也不例外。多亏了 mRNA 疫苗，Moderna 和辉瑞已经成为家喻户晓的名字，他们的收入也有所增加。</p><p id="9ea6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这两家公司的股票在此期间的日回报率和波动性是多少？</strong></p><p id="a3c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将给我们一个他们的风险水平的指示。波动性越高，风险就越大。</p><h2 id="834e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">2.必需的 Python 库</h2><p id="49cc" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">首先，让我们导入我们需要的库。</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="9475" class="lj lk iq mx b gy nb nc l nd ne">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import yfinance as yf</span></pre><p id="c3a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">yfinance 是 Ran Aroussi 创建的免费开源 Python 库。你可以在这里找到更多关于它的信息。我推荐用它开始玩股票数据。</p><h2 id="5b45" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">3.用 yfinance 检索股票数据</h2><p id="db7c" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">很直白。</p><ul class=""><li id="d32f" class="mc md iq jp b jq jr ju jv jy nf kc ng kg nh kk ni mk ml mm bi translated">为了检索股票数据，我需要使用 Pfizer 和 Moderna 各自的股票代码:PFE，MRNA</li><li id="e20b" class="mc md iq jp b jq mo ju mp jy mq kc mr kg ms kk ni mk ml mm bi translated">然后我用下载的方法注明时期。</li></ul><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="4864" class="lj lk iq mx b gy nb nc l nd ne">Example with Pfizer stock<br/>ticker= "pfe"<br/>pfizer = yf.download(ticker, start="2020-01-01", end="2022-06-17")<br/>pfizer.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/c69a2bc02097b3f6108a30361b76591d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahes5TOKhs6O5JzHL_VShw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">用 yfinance 获得辉瑞股票数据的第一行</figcaption></figure><h2 id="00b3" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">4.计算和绘制每日回报</h2><p id="e108" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">股票日收益表明给定股票每天的收益或损失。我们通过从收盘价中减去开盘价得到它。</p><p id="819f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">方便的是，Pandas 有 pct_change 方法来计算每日回报中变化百分比。让我们使用它并将它存储在一个新列“daily_returns”中。</p><p id="e876" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从辉瑞开始:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="bb6c" class="lj lk iq mx b gy nb nc l nd ne">pfizer['daily_returns']=(pfizer['Close'].pct_change())*100</span></pre><p id="e080" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，我更喜欢绘制结果，这样更容易可视化。</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="4c59" class="lj lk iq mx b gy nb nc l nd ne">pfizer.dropna(inplace=True)</span><span id="e2e9" class="lj lk iq mx b gy nk nc l nd ne">fig,ax=plt.subplots(figsize=(12,6))<br/>ax.spines[['top','right','left','bottom']].set_visible(False)<br/>plt.plot(pfizer['daily_returns'], label = 'Daily Returns')<br/>plt.legend(loc='best')<br/>plt.title('Pfizer Stock Daily Returns Over Time')<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/478c1e0ed835bdea880fad45a77c026a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-iYCdqs9YjFvm88P9xpEg.png"/></div></div></figure><p id="2f79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于新冠肺炎，辉瑞的股票在 2020 年波动非常大，在 2021 年由于 Covid 疫苗而变得不那么明显。我们可以看到，在 2021 年底，与 Omicron 变体外观相关的每日正回报。该图有助于我们监控每日随时间变化的幅度。</p><p id="9980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们对 Moderna 做同样的操作，看看它在同一时期的日收益率曲线是什么样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/20bc1c1ac8b67c3b5562708dbfd40f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6B2lNRmvuqx63nzYUMFVQ.png"/></div></div></figure><p id="9347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">振荡在正侧具有更高的幅度。从 1 月到 22 日，我们观察到每日回报更多的是负面的。这对应于股票价格的下跌。</p><h2 id="42e6" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">5.计算股票的每日、每月和每年的波动性</h2><p id="9e91" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">股票的波动性是其价格在一段时间内的变化。</p><p id="8609" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">日波动率:</strong>为了得到它，我们计算日收益率的标准差。提醒一下，标准差有助于我们看到有多少数据分布在平均值周围。</p><p id="6193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">月波动率:</strong>我们假设一个月有 21 个交易日，所以我们用日波动率乘以 21 的平方根。</p><p id="51ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">年波动率</strong>:我们假设一个日历年有 252 个交易日，我们将日波动率乘以 252 的平方根。</p><p id="ee38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是代码:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="f16a" class="lj lk iq mx b gy nb nc l nd ne">import math<br/>daily_volatility_pfe = pfizer['daily_returns'].std()<br/>print('Daily volatility:')<br/>print('Pfizer: ', '{:.2f}%'.format(daily_volatility_pfe))<br/>daily_volatility_mrna = moderna['daily_returns'].std()<br/>print('Moderna: ', '{:.2f}% \n'.format(daily_volatility_mrna))</span><span id="3ac4" class="lj lk iq mx b gy nk nc l nd ne">monthly_volatility_pfe = math.sqrt(21) * daily_volatility_pfe<br/>print('Monthly volatility:')<br/>print ('Pfizer: ', '{:.2f}%'.format(monthly_volatility_pfe))<br/>monthly_volatility_mrna = math.sqrt(21) * daily_volatility_mrna<br/>print ('Moderna: ', '{:.2f}%\n '.format(monthly_volatility_mrna))</span><span id="76f8" class="lj lk iq mx b gy nk nc l nd ne">annual_volatility_pfe = math.sqrt(252) * daily_volatility_pfe<br/>print('Annual volatility:')<br/>print ('Pfizer: ', '{:.2f}%'.format(annual_volatility_pfe ))<br/>annual_volatility_mrna = math.sqrt(252) * daily_volatility_mrna<br/>print ('Moderna: ', '{:.2f}%'.format(annual_volatility_mrna ))</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/a8a4e7c4fbbf8d023e9d07a3f3ed051b.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*lc875EzP0TEnh80BKQOzMQ.png"/></div></figure><p id="c441" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Moderna 的股票有很高的波动性:每年 90%，每月 26%！这表明投资者很难衡量该公司，因为其收入目前是基于新冠肺炎疫苗。他们正等着看它的潜力是否会实现。</p><p id="8a19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">辉瑞公司的年增长率为 31%，低于 Moderna，但仍然很高。辉瑞是一家拥有悠久历史的大型制药公司。</p><h2 id="fe4f" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">6.结论</h2><p id="8e25" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">获取股票数据并做一些初步计算来评估风险是很容易和容易的。Moderna 和辉瑞股票的例子表明，我们在投资股票时需要多么小心。我将在以后的博文中讨论其他指标。</p><p id="3e51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢你阅读我！点击关注按钮来阅读我未来的帖子，如果你喜欢的话。</p><p id="f4c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你也可以在 LinkedIn <a class="ae mn" href="https://www.linkedin.com/in/lancaothai/" rel="noopener ugc nofollow" target="_blank">这里找到我。</a></p></div></div>    
</body>
</html>