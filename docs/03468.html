<html>
<head>
<title>Jasmine — Test Array, Strings, and Time-Dependent Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jasmine —测试数组、字符串和依赖于时间的代码</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/jasmine-test-array-strings-and-time-dependent-code-29397e7e04fd?source=collection_archive---------3-----------------------#2020-11-08">https://blog.devgenius.io/jasmine-test-array-strings-and-time-dependent-code-29397e7e04fd?source=collection_archive---------3-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b6a2ad020ac97f1c932d3ca599799b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DS2X5q42Iq_qlobx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Elena Mozhvilo 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8f80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试是 JavaScript 的一个重要部分。</p><p id="6eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Jasmine 创建更复杂的测试。</p><h1 id="5fa1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">数组检查</h1><p id="6f8c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">jasmine.arrayContaining</code>方法来检查数组的内容。</p><p id="15fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a5b4" class="mq lc iq mh b gy mr ms l mt mu">describe("jasmine.arrayContaining", function () {<br/>  let foo;</span><span id="6232" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(function () {<br/>    foo = [1, 2, 3];<br/>  });</span><span id="5043" class="mq lc iq mh b gy mv ms l mt mu">  it("matches arrays with some of the values", function () {<br/>    expect(foo).toEqual(jasmine.arrayContaining([3, 1]));<br/>    expect(foo).not.toEqual(jasmine.arrayContaining([6]));<br/>  });</span><span id="ddc9" class="mq lc iq mh b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful when comparing arguments", function () {<br/>      const callback = jasmine.createSpy('callback');<br/>      callback([1, 2, 3, 4]);<br/>      expect(callback)<br/>        .toHaveBeenCalledWith(<br/>          jasmine.arrayContaining([4, 2, 3])<br/>        );<br/>      expect(callback)<br/>        .not<br/>        .toHaveBeenCalledWith(<br/>          jasmine.arrayContaining([5, 2])<br/>        );<br/>    });<br/>  });<br/>});</span></pre><p id="4067" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">jasmine.arrayContaining</code>方法来检查数组中的数字。</p><p id="6418" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果被检查的数组包含了我们传递给<code class="fe me mf mg mh b">arrayContaining</code>的数组中的所有条目，它将返回<code class="fe me mf mg mh b">true</code>。</p><p id="0e62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以对函数参数做同样的事情。</p><h1 id="4b2a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">字符串匹配</h1><p id="9bd9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">jasmine.stringMatching</code>来检查一个字符串是否有给定的子串或模式。</p><p id="d960" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c197" class="mq lc iq mh b gy mr ms l mt mu">describe('jasmine.stringMatching', function () {<br/>  it("matches as a regex", function () {<br/>    expect({ foo: 'baz' })<br/>      .toEqual({<br/>        foo: jasmine.stringMatching(/^baz$/)<br/>      });<br/>    expect({ foo: 'foobarbaz' })<br/>      .toEqual({<br/>        foo: jasmine.stringMatching('bar')<br/>      });<br/>  });</span><span id="a87a" class="mq lc iq mh b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful for comparing arguments", function () {<br/>      const callback = jasmine.createSpy('callback');<br/>      callback('foobarbaz');<br/>      expect(callback)<br/>        .toHaveBeenCalledWith(<br/>          jasmine.stringMatching('baz')<br/>        );<br/>      expect(callback)<br/>        .not<br/>        .toHaveBeenCalledWith(<br/>          jasmine.stringMatching(/^baz$/)<br/>        );<br/>    });<br/>  });<br/>});</span></pre><p id="aa6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带正则表达式和字符串的<code class="fe me mf mg mh b">jasmine.stringMatching</code>方法。</p><p id="ca9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们检查正则表达式模式和子串。</p><h1 id="f431" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不对称等式测试器</h1><p id="39f6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以创建自己的等式测试器来进行检查。</p><p id="8800" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4f9a" class="mq lc iq mh b gy mr ms l mt mu">describe("custom asymmetry", function () {<br/>  const tester = {<br/>    asymmetricMatch(actual) {<br/>      return actual.includes('bar');<br/>    }<br/>  };</span><span id="ca8d" class="mq lc iq mh b gy mv ms l mt mu">  it("dives in deep", function () {<br/>    expect("foo,bar,baz,quux").toEqual(tester);<br/>  });</span><span id="301b" class="mq lc iq mh b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful for comparing arguments", function () {<br/>      const callback = jasmine.createSpy('callback');<br/>      callback('foo,bar,baz');<br/>      expect(callback).toHaveBeenCalledWith(tester);<br/>    });<br/>  });<br/>});</span></pre><p id="82fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">asymmericMatch</code>方法创建了自己的<code class="fe me mf mg mh b">tester</code>对象来检查我们想要的东西。</p><p id="b9d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是返回一个布尔表达式，其中包含我们想要检查的条件。</p><p id="c834" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以配合<code class="fe me mf mg mh b">toHaveBeenCalledWith</code>或者<code class="fe me mf mg mh b">toEqual</code>使用。</p><p id="6107" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们可以检查值和参数。</p><h1 id="4ba8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">茉莉花钟</h1><p id="c169" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">jasmine.clock</code>方法测试依赖于时间的代码。</p><p id="5e3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e948" class="mq lc iq mh b gy mr ms l mt mu">describe("custom asymmetry", function () {<br/>  let timerCallback;</span><span id="d0c9" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(function () {<br/>    timerCallback = jasmine.createSpy("timerCallback");<br/>    jasmine.clock().install();<br/>  });</span><span id="3082" class="mq lc iq mh b gy mv ms l mt mu">  afterEach(function () {<br/>    jasmine.clock().uninstall();<br/>  });</span><span id="ad35" class="mq lc iq mh b gy mv ms l mt mu">  it("causes a timeout to be called synchronously", function () {<br/>    setTimeout(function () {<br/>      timerCallback();<br/>    }, 100);<br/>    expect(timerCallback).not.toHaveBeenCalled();<br/>    jasmine.clock().tick(101);<br/>    expect(timerCallback).toHaveBeenCalled();<br/>  });<br/>});</span></pre><p id="b219" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">jasmine.clock().install()</code>让茉莉嘲笑时间。</p><p id="6eff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">jasmine.clock().uninstall()</code>来移除茉莉时钟。</p><p id="47ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的测试中，我们可以根据需要改变时间。</p><p id="8182" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在一段时间后进行检查。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/d8a861207471c4aa473e53623baa3912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*btpvX_4LDkTYuvqg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">西蒙·雷伊在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="4086" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b90e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Jasmine 的时钟方法测试依赖于时间的代码。</p><p id="b644" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用内置函数检查数组和字符串项。</p><p id="5269" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以自己做一些比赛来测试我们想要的。</p></div></div>    
</body>
</html>