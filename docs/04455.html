<html>
<head>
<title>Easy Setup Charles Proxy to Intercept HTTPS traffic of Android Emulator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">容易设置查尔斯代理拦截 Android 模拟器的 HTTPS 流量</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-charles-proxy-to-intercept-https-traffic-of-android-emulator-591baba5d7ec?source=collection_archive---------0-----------------------#2021-03-19">https://blog.devgenius.io/setup-charles-proxy-to-intercept-https-traffic-of-android-emulator-591baba5d7ec?source=collection_archive---------0-----------------------#2021-03-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="059e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于 Web 或应用程序开发，通常需要调试和查看应用程序的 HTTPS 流量。为了拦截流量，您必须使用中间人技术在您的应用程序和 API 端点之间进行解密和加密。</p><p id="be67" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们用 Android 模拟器详细演练一下…</p><h1 id="4e6b" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">A.设置 Android 模拟器(在 Android Studio 中)</h1><p id="4ded" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">您必须使用模拟器系统映像，而不使用播放存储</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/e4efcb2f1eb36ade26772ff3a82bcb25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyAzYPmog0RXQuZenmmVgw.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">选择没有播放商店图标的图像</figcaption></figure><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/b219e2f51c5d04319f5c767e63dc720c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnpSKy0Zhtlwyg09w58nQg.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">使用 Android Q</figcaption></figure><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/4430105fb1158f72d82f4a5fb27e949d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XaUgY-kBLkSUHFS1U1kew.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">(可选)显示高级设置→设置为“冷启动”</figcaption></figure><blockquote class="mb mc md"><p id="d63b" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated">存储模拟器的新文件夹将在<code class="fe mi mj mk ml b">%USERPROFILE%\.android\avd</code>创建</p></blockquote><h1 id="7a54" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">B.导出根证书</h1><p id="9778" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">保存查尔斯根证书</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi mm"><img src="../Images/57807e0675e3515c8d7c26c3b11c937d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOHW-g6iiqDP06gPQ5EC0A.png"/></div></div></figure><p id="6125" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将这个“pem”文件重命名为 android 特定格式的证书文件。</p><blockquote class="mb mc md"><p id="d7bd" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated">你可以在<strong class="jm io"> Git Bash </strong>中使用 openssl</p></blockquote><pre class="lm ln lo lp gt mn ml mo mp aw mq bi"><span id="ce1a" class="mr kj in ml b gy ms mt l mu mv">openssl x509 -inform PEM -subject_hash_old -in charles.pem | head -1</span></pre><blockquote class="mb mc md"><p id="c977" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated">名称格式为"<hash-value> " + ".0" <br/>(只需将" . 0 "作为一个字符串与哈希值字符串连接起来)</hash-value></p></blockquote><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5437b6b5827a9019a652b5c6b8855c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*1ivMLyL8lzwIRss4JJZxkA.png"/></div></figure><h1 id="2c43" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">C.启动模拟器</h1><blockquote class="mb mc md"><p id="5b2a" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated">Windows <br/>中的仿真器路径<code class="fe mi mj mk ml b">%LOCALAPPDATA%\Android\Sdk\emulator</code></p></blockquote><pre class="lm ln lo lp gt mn ml mo mp aw mq bi"><span id="9b41" class="mr kj in ml b gy ms mt l mu mv">cd %LOCALAPPDATA%\Android\Sdk\emulator emulator -avd Pixel_3a_XL_API_29 -writable-system -no-snapshot-load</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/c8bd8a600db508bfbee8667e3b4be74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*UvIQLiz3JjMxDO19AldorQ.png"/></div></figure><h1 id="29e2" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">D.根证书和推送根证书</h1><blockquote class="mb mc md"><p id="3eb0" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated">Windows 中的亚行路径<br/> <code class="fe mi mj mk ml b">%LOCALAPPDATA%\Android\Sdk\platform-tools</code></p></blockquote><p id="f983" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用<code class="fe mi mj mk ml b">adb</code>执行命令</p><ul class=""><li id="cf01" class="my mz in jm b jn jo jr js jv na jz nb kd nc kh nd ne nf ng bi translated">适用于 Android Q 及以上版本(API 等级≥ 29)</li></ul><pre class="lm ln lo lp gt mn ml mo mp aw mq bi"><span id="99d1" class="mr kj in ml b gy ms mt l mu mv">adb root <br/>adb shell avbctl disable-verification <br/>adb reboot </span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/8ebf1659ad3639c086ecd2d41259b597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OeeUBHWGPPogRL8u9TSB2Q.png"/></div></div></figure><pre class="lm ln lo lp gt mn ml mo mp aw mq bi"><span id="bcf4" class="mr kj in ml b gy ms mt l mu mv">adb root <br/>adb remount  <br/>adb push 4a40cad5.0 /system/etc/security/cacerts/ <br/>adb -e shell chmod 644 /system/etc/security/cacerts/4a40cad5.0 <br/>adb reboot</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/ff5cab71c1a0a093b6ad994ab91777e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BJFFAuVCAwhI01cQipotw.png"/></div></div></figure><ul class=""><li id="cde5" class="my mz in jm b jn jo jr js jv na jz nb kd nc kh nd ne nf ng bi translated">对于较旧的 Android (API 级别&lt; 29)</li></ul><pre class="lm ln lo lp gt mn ml mo mp aw mq bi"><span id="80fc" class="mr kj in ml b gy ms mt l mu mv">adb root <br/>adb remount <br/>adb push 4a40cad5.0 /system/etc/security/cacerts/ <br/>adb -e shell chmod 644 /system/etc/security/cacerts/4a40cad5.0 <br/>adb reboot</span></pre><h1 id="a167" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">E. Verify Trusted Cert &amp; Setting APN</h1><ol class=""><li id="fff1" class="my mz in jm b jn lg jr lh jv ni jz nj kd nk kh nl ne nf ng bi translated">Settings → Security → Encryption &amp; Credentials → Trusted credentials</li></ol><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/76f757775cd545c37f374d3beb2b65dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*f8Eh_K30idxDblDP4HXHhg.png"/></div></figure><p id="be43" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2. Disable Wi-Fi</p><p id="463a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3. Network &amp; Internet → Mobile network → Advanced → Access Point Names</p><blockquote class="mb mc md"><p id="7367" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated"><em class="in">集合名称，APN 具有任意值，代理&amp;端口应该跟随查尔斯代理</em></p></blockquote><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/a4628792f8e6e85879111941b78a3e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*pCftnGeyDxGsaIo_t883tA.png"/></div></figure><p id="d24f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.选择 APN</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5fbf473ecd3f646a8c1175848ef6a09e.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*odpRIvRwTVrlZagm4juFeg.png"/></div></figure><p id="4a35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.确认</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0813d76a60107d0267b4d9e905de7b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*ILWTFVAIumCUJsT1jVZNTA.png"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">如果代理配置不匹配，或者 Charles 没有启动</figcaption></figure><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/39e998d90cb701bcf83856c7dfcafa51.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*TZ9-tc3tixVQ2nGrBcUH3Q.png"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">如果一切正常</figcaption></figure><p id="6a34" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦你完成了上述所有步骤，你应该能够看到所有的加密流量从你的 Android 模拟器发送！</p></div></div>    
</body>
</html>