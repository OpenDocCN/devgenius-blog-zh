<html>
<head>
<title>MySpace From Scratch — Part 3: Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MySpace从头开始—第3部分:认证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/myspace-from-scratch-part-3-authentication-6a48eabef24?source=collection_archive---------3-----------------------#2021-03-15">https://blog.devgenius.io/myspace-from-scratch-part-3-authentication-6a48eabef24?source=collection_archive---------3-----------------------#2021-03-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/568449f6292e27a594da1cd192a7e7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKQdQ0Kv5GSrGZAkxoHJBA.png"/></div></div></figure><div class=""/><p id="a943" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇文章中，我们将介绍帐户创建和登录。</p><p id="e930" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是一些基础知识:<br/> -某人通过填写包含其电子邮件、姓名和密码的表单来创建用户<br/> -用户存储在Mongo的用户模型中<br/> -当登录API时，根据Mongo DB检查电子邮件/密码，如果找到用户，则将其返回给客户端。<br/> -出于安全原因，我们需要在存储密码之前对其进行哈希运算。</p><h2 id="1c3b" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">创建帐户创建表单</h2><p id="b8f2" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">在应用程序的客户端，我们需要创建一个登录页面。在登录页面上，我们包含了一个到帐户创建页面的链接。所以在Nuxt中，我创建了两个新页面。一个用于登录，一个用于创建帐户。</p><p id="1fe4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从来没有人指责我是一个设计师，但这里是我的登录和创建帐户页面。我只是用顺风建立了简单的布局。</p><figure class="ls lt lu lv gt ip gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/3113608c678682a9ebd2d6dc13500d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*i1ofB5eUtVxkMWzg0wRb1A.png"/></div></figure><figure class="ls lt lu lv gt ip gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/a7b99a022ade12323ebc099e2b0a1382.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*k3pSVFQpSMv21vJbq6EOtA.png"/></div></figure><p id="14af" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就像我说的，我不是设计师，但这很简单而且切中要害。让我们用一些Vue来完成这个前端工作，使这个表单真正发挥作用。</p><h1 id="e76a" class="lx ku iy bd kv ly lz ma ky mb mc md lb me mf mg le mh mi mj lh mk ml mm lk mn bi translated">创建帐户流程</h1><ol class=""><li id="2a21" class="mo mp iy jx b jy lm kc ln kg mq kk mr ko ms ks mt mu mv mw bi translated">用户填写表单</li><li id="59cd" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">Javascript验证所有字段都已填写</li><li id="1a8a" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">Javascript检查密码和重复密码是否相同</li><li id="94f5" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">向API发送请求</li><li id="3495" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">如果API返回成功，重定向到“主页”</li><li id="fbf7" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">如果API返回不成功，抛出一个错误</li></ol><h2 id="3b95" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">前端</h2><p id="4811" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">为了验证，我使用了一个循环来处理每个字段的键，并确保每个字段都有<code class="fe nc nd ne nf b">data</code>。</p><p id="c30d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后是if语句，以确保密码相同。</p><p id="32dc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用axios向API发出post请求以创建帐户。</p><p id="232d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<code class="fe nc nd ne nf b">toast</code>显示成功或失败的信息。<br/>我不得不<code class="fe nc nd ne nf b">npm install @nuxtjs/toast --save</code></p><p id="24c4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以上处理第1-3部分。以下是我创建帐号的代码:</p><figure class="ls lt lu lv gt ip"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="e25e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">现在我们需要创建API路径</strong></p><p id="37dc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我创建了一个新文件<code class="fe nc nd ne nf b">/app/routes.js</code>,暂时存放我所有的路线。我更新了我的<code class="fe nc nd ne nf b">server.js</code>文件来包含这个文件。</p><p id="e72f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在新的routes文件中，我将现有的route移动到那里，然后为用户创建的route添加了另一个route。我继续创建了两个新文件:<code class="fe nc nd ne nf b">/app/controllers/UserController.js</code>用于处理用户对象的请求。以及<code class="fe nc nd ne nf b">/app/models/UserModel.js</code>用于处理对数据库的访问。</p><p id="764e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我向UserController添加了一个<code class="fe nc nd ne nf b">create()</code>方法，它用<code class="fe nc nd ne nf b">bcrypt</code>散列密码，然后使用UserModel创建用户并返回该用户的响应。然后我创建UserModel，它定义模式并返回mongoose模型。我添加了一个<code class="fe nc nd ne nf b">Schema.pre()</code>功能来确保邮件不能重复。</p><p id="8d68" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还生成了一个令牌，这样我们就可以使用它来验证来自客户端的用户请求。为此我使用了<code class="fe nc nd ne nf b">jsonwebtoken</code></p><p id="1b9d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">需要了解的内容很多，但这里是用户控制器:</p><figure class="ls lt lu lv gt ip"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="f751" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用户模型:</p><figure class="ls lt lu lv gt ip"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="d311" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">我们的账户创建完成了！</strong></p><h1 id="e4db" class="lx ku iy bd kv ly lz ma ky mb mc md lb me mf mg le mh mi mj lh mk ml mm lk mn bi translated">让用户登录</h1><p id="cbb0" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">这篇文章已经有点长了，所以我要总结一下我所做的，然后给你看API和前端模板的代码</p><h2 id="bcc8" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">API端</h2><ol class=""><li id="df8c" class="mo mp iy jx b jy lm kc ln kg mq kk mr ko ms ks mt mu mv mw bi translated"><code class="fe nc nd ne nf b">/login</code>的新路线</li><li id="7f0b" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">用户控制器中的新方法<code class="fe nc nd ne nf b">login()</code></li><li id="947f" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">该方法对照电子邮件的密码(使用bcrypt)检查密码，如果成功，则返回带有用户令牌的用户对象。</li><li id="9c93" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">如果不成功，抛出一个错误</li></ol><figure class="ls lt lu lv gt ip"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="d141" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">客户端</h2><ol class=""><li id="aae1" class="mo mp iy jx b jy lm kc ln kg mq kk mr ko ms ks mt mu mv mw bi translated">点击登录按钮时，将用户名和密码传递给API</li><li id="431e" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">如果成功，重定向到主页</li><li id="601b" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">如果不成功，抛出一个toast错误消息</li></ol><figure class="ls lt lu lv gt ip"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="d618" class="lx ku iy bd kv ly lz ma ky mb mc md lb me mf mg le mh mi mj lh mk ml mm lk mn bi translated">认证完成</h1><p id="4e8d" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">迄今为止，我们取得了哪些成就:</p><ol class=""><li id="c2d6" class="mo mp iy jx b jy jz kc kd kg ni kk nj ko nk ks mt mu mv mw bi translated">我们有一个完整的工作环境</li><li id="9dbd" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">用户可以创建一个帐户</li><li id="43e1" class="mo mp iy jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">用户可以登录</li></ol><p id="5fb0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不是最令人兴奋的事情，但我们现在正准备开始构建一些有趣的东西！</p><h1 id="e253" class="lx ku iy bd kv ly lz ma ky mb mc md lb me mf mg le mh mi mj lh mk ml mm lk mn bi translated">在下一篇文章中</h1><p id="b358" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">我们将开始创建MySpace个人资料页面。一旦用户登录，他们将能够添加照片，并选择其中之一作为他们的个人资料照片。</p><p id="ae4b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你有什么特别想让我分享的，请在评论中告诉我！下次再见，谢谢你的关注！</p><p id="e159" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本系列往期文章:<br/> <a class="ae nl" href="https://andyhartnett.medium.com/myspace-from-scratch-with-node-vue-part-1-18a55931ddc6?source=your_stories_page-------------------------------------" rel="noopener">第一部分—简介</a> <br/> <a class="ae nl" href="https://andyhartnett.medium.com/myspace-from-scratch-part-2-setting-up-the-environment-127eb4a6e3ac?source=your_stories_page-------------------------------------" rel="noopener">第二部分—设置环境</a> <br/> <a class="ae nl" href="https://andyhartnett.medium.com/myspace-from-scratch-part-4-profile-photos-audio-6ce69871669b" rel="noopener">第四部分—照片上传</a></p><h2 id="0c21" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">既然你在这里，考虑一下在twitter上关注我吧！</h2></div></div>    
</body>
</html>