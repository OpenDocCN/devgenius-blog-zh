<html>
<head>
<title>How To Add Retry Logic To Your Code And Why It Is A Best Practice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在代码中添加重试逻辑，以及为什么这是最佳实践</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-add-retry-logic-to-your-code-and-why-it-is-a-best-practice-96f8c924dfce?source=collection_archive---------4-----------------------#2020-10-12">https://blog.devgenius.io/how-to-add-retry-logic-to-your-code-and-why-it-is-a-best-practice-96f8c924dfce?source=collection_archive---------4-----------------------#2020-10-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="720f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">重试服务呼叫的最佳实践</h2></div><h1 id="df47" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">重试是最佳实践</h1><p id="471f" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">你知道那句老话吗</p><blockquote class="lq"><p id="39e1" class="lr ls in bd lt lu lv lw lx ly lz lp dk translated">如果你从马上掉下来，掸掉身上的灰尘，重新骑上</p></blockquote><p id="f518" class="pw-post-body-paragraph ku kv in kw b kx ma jo kz la mb jr lc ld mc lf lg lh md lj lk ll me ln lo lp ig bi translated">它实际上在设计和编写软件时有很多应用。有时，有些流程或工作流会失败。在这些情况下你会怎么做？一些程序员会简单地说</p><blockquote class="mf mg mh"><p id="c62a" class="ku kv mi kw b kx mj jo kz la mk jr lc ml mm lf lg mn mo lj lk mp mq ln lo lp ig bi translated">“这不是我的错，我调用了此服务，但它让我失望了，所以我只是给用户一条错误消息，让他们重新启动工作流”</p></blockquote><p id="9ce9" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">这是不可取的，即使服务在99%的时间里都工作正常——当它失败时——对于您的客户或用户来说，这将是一个糟糕的用户体验。</p><p id="b0ec" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">对程序员来说，更好的答案是说</p><blockquote class="mf mg mh"><p id="8359" class="ku kv mi kw b kx mj jo kz la mk jr lc ml mm lf lg mn mo lj lk mp mq ln lo lp ig bi translated">我调用的服务失败，所以让我再重试几次，并尝试得到我需要的结果来充分服务我的用户</p></blockquote><p id="0218" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">这提供了一个更好的UX，体现了<em class="mi">“重新上马”</em>的心态。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/96eee32fc6f8dfe7e2523353415d0007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*p-97ezRLuof6kO6hMALaSw.jpeg"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">…嗯，我的意思是至少多尝试一两次(由<a class="ae nd" href="https://www.facebook.com/Snoopy/" rel="noopener ugc nofollow" target="_blank">史努比FB </a></figcaption></figure><h1 id="71a0" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">重试案例研究</h1><h2 id="8574" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated">问题陈述和解决方案</h2><p id="03dd" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">假设你需要一个不可靠的服务😬对于您的项目，失败率是75%😱。你可能会认为这太可怕了！我如何使用这样的服务？！？！我的申请对❌的失败多于对✅.的成功在这种情况下，我们希望从重试包装器♻️.中调用服务</p><h2 id="b584" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated">包括故障保护库</h2><p id="cc89" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">第一步是在你的项目中包含Failsafe(或者你喜欢的任何其他重试库)</p><pre class="ms mt mu mv gt nq nr ns nt aw nu bi"><span id="c9a5" class="ne kd in nr b gy nv nw l nx ny">&lt;dependency&gt;<br/>    &lt;groupId&gt;net.jodah&lt;/groupId&gt;<br/>    &lt;artifactId&gt;failsafe&lt;/artifactId&gt;<br/>    &lt;version&gt;2.4.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="7626" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">如果你想深入了解，这里有一个<a class="ae nd" href="https://jodah.net/failsafe/" rel="noopener ugc nofollow" target="_blank">故障保护文档</a>的链接。</p><h2 id="0626" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated">我们称之为不可靠的服务</h2><p id="c5e8" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">让我们创建我们蹩脚的服务💩它在75%的情况下会失败，并且当它不可避免地失败时会抛出异常。</p><figure class="ms mt mu mv gt mw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><figure class="ms mt mu mv gt mw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="deb7" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated">使用重试策略调用服务</h2><p id="1020" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">现在我们有了不可靠的服务，是时候创建我们的重试逻辑来对抗这个来自地狱的函数调用了！😈</p><figure class="ms mt mu mv gt mw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="9b96" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated">第7–11行创建重试策略</h2><ul class=""><li id="5986" class="ob oc in kw b kx ky la lb ld od lh oe ll of lp og oh oi oj bi translated">我们创建了一个重试策略，该策略期望我们使用的函数返回一个字符串</li><li id="99c1" class="ob oc in kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">我们处理<strong class="kw io"> BadServiceException </strong>意味着我们只在看到这个异常时重试</li><li id="d6b5" class="ob oc in kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">当我们为了记录而重试时，我们<strong class="kw io">打印出一条消息</strong></li><li id="0ffc" class="ob oc in kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">我们设置了一个<strong class="kw io"> 2秒的延迟</strong>,从我们得到异常到我们再次尝试</li><li id="de5b" class="ob oc in kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">在我们放弃之前，我们最多允许<strong class="kw io"> 2次重试</strong></li></ul><h2 id="ccca" class="ne kd in bd ke nf ng dn ki nh ni dp km ld nj nk ko lh nl nm kq ll nn no ks np bi translated"><strong class="ak">第12–14行使用重试策略调用服务</strong></h2><p id="a08f" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">最重要的(也可能是对你来说最陌生的)是第13行。在这一行中，我们使用我们创建的重试策略调用故障保护包装器中的crappyService.callService()方法。您可以将其视为将调用打包到一个盒子中，该盒子将处理失败并仅在从callService()获得成功返回后返回结果，否则我们将耗尽2次重试，在这种情况下，它将抛出BadServiceException。</p><p id="e461" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">当您运行它时，您会看到它正在重试…有时会返回“数据”,而其他时候会在重试2次后失败。</p><pre class="ms mt mu mv gt nq nr ns nt aw nu bi"><span id="b56b" class="ne kd in nr b gy nv nw l nx ny">retrying...<br/>retrying...<br/>data</span></pre><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi op"><img src="../Images/bb9e04f1b1ad335e8753d02efcffc53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*aWMaeMggYojwhUp3tVgXmA.jpeg"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">照片由<a class="ae nd" href="https://www.horsenation.com/" rel="noopener ugc nofollow" target="_blank">horsenation.com</a>拍摄</figcaption></figure><p id="4ff5" class="pw-post-body-paragraph ku kv in kw b kx mj jo kz la mk jr lc ld mm lf lg lh mo lj lk ll mq ln lo lp ig bi translated">现在，你可以教你的代码掸掉身上的灰尘，跳回马鞍上，而不是坐在地上哭泣。</p></div></div>    
</body>
</html>