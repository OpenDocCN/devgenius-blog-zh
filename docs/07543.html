<html>
<head>
<title>User Creation And Authentication in Golang Part 2— CRUD Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang 中的用户创建和验证第 2 部分— CRUD 操作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/user-creation-and-authentication-in-golang-part-2-crud-operations-cecb4e986655?source=collection_archive---------7-----------------------#2022-04-04">https://blog.devgenius.io/user-creation-and-authentication-in-golang-part-2-crud-operations-cecb4e986655?source=collection_archive---------7-----------------------#2022-04-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="f220" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">通过 HTTP 接口的 CRUD 操作</h1><p id="e238" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在之前的<a class="ae lg" href="https://medium.com/@elijahomolo/user-creation-and-authentication-in-golang-part-1-f6b6cc08d9fe" rel="noopener">文章</a>中，我们演示了使用 Go 建立到本地 Postgres 数据库的成功连接。在本文中，我们将继续使用数据库，并介绍 HTML 模板作为浏览器中的 HTTP 请求和针对数据库的 CRUD(创建、读取、更新和删除)操作之间的接口。</p><h1 id="8759" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">先决条件:</h1><ul class=""><li id="c573" class="lh li in kk b kl km kp kq kt lj kx lk lb ll lf lm ln lo lp bi translated"><strong class="kk io">一个围棋装置。</strong>安装说明见<a class="ae lg" href="https://go.dev/doc/install" rel="noopener ugc nofollow" target="_blank">安装 Go </a>。</li><li id="3d36" class="lh li in kk b kl lq kp lr kt ls kx lt lb lu lf lm ln lo lp bi translated">一个编辑你代码的工具。你有的任何文本编辑器都可以，我用的是 Goland。</li><li id="6262" class="lh li in kk b kl lq kp lr kt ls kx lt lb lu lf lm ln lo lp bi translated"><strong class="kk io">一个命令终端。使用 Linux 和 Mac 上的任何终端，以及 Windows 中的 PowerShell 或 cmd，Go 都可以很好地工作。</strong></li><li id="6d44" class="lh li in kk b kl lq kp lr kt ls kx lt lb lu lf lm ln lo lp bi translated">PostgreSQL 的本地<a class="ae lg" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">安装</a></li><li id="5e14" class="lh li in kk b kl lq kp lr kt ls kx lt lb lu lf lm ln lo lp bi translated">PSQL CLI 的安装</li></ul><h2 id="289d" class="lv jl in bd jm lw lx dn jq ly lz dp ju kt ma mb jy kx mc md kc lb me mf kg mg bi translated">1.从数据库中读取:</h2><p id="bd68" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">让我们从我认为最容易实现的操作开始，从数据库中读取数据。我们将使用 PSQL 手动运行 SQL 查询，然后通过浏览器在 HTML 模板中检索信息。</p><p id="bd23" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">首先，创建一个“users”表，其中包含以下行:user_id、用户名、密码、城市和电子邮件。然后我们将播种一些任意的数据进行测试。打开 PSQL shell 并对 myapp 数据库执行以下查询:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="8c51" class="lv jl in mr b gy mv mw l mx my">eomolo$ psql<br/>psql (14.2)<br/>Type "help" for help.</span><span id="9b61" class="lv jl in mr b gy mz mw l mx my">eomolo=# \c myapp</span><span id="ea63" class="lv jl in mr b gy mz mw l mx my">You are now connected to database "myapp" as user "eomolo".</span><span id="5656" class="lv jl in mr b gy mz mw l mx my">myapp=# CREATE TABLE users (<br/>  user_id serial PRIMARY KEY,<br/>  username VARCHAR ( 50 ) UNIQUE NOT NULL,<br/>  password VARCHAR ( 50 ) NOT NULL,<br/>  city VARCHAR ( 50 ) NOT NULL,<br/>  email VARCHAR ( 255 ) UNIQUE NOT NULL);</span><span id="203d" class="lv jl in mr b gy mz mw l mx my">CREATE TABLE</span><span id="2fea" class="lv jl in mr b gy mz mw l mx my">myapp=# \dt</span><span id="2cb2" class="lv jl in mr b gy mz mw l mx my">List of relations<br/>Schema | Name  | Type  | Owner<br/>--------+-------+-------+--------<br/>public | users | table | eomolo<br/>(1 row)</span><span id="4714" class="lv jl in mr b gy mz mw l mx my">myapp=# INSERT INTO users(username,password, city,email) VALUES ('user1',123456, 'Lanham', 'user1@user.com');</span><span id="78ca" class="lv jl in mr b gy mz mw l mx my">INSERT 0 1<br/>myapp=#</span></pre><p id="8076" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">接下来，在您的 myapp 项目目录中，创建一个目录“form ”, html 模板将存在于其中。在其中创建一个 Index.tmpl 文件:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2b2c" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">构建并添加页眉和页脚:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="8007" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">表单目录结构目前应该如下所示:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="817b" class="lv jl in mr b gy mv mw l mx my">ls myapp/form/<br/>Footer.tmpl     Header.tmpl     Index.tmpl    </span></pre><p id="41c7" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">在 main.go 文件中，我们将导入另外两个包:</p><ol class=""><li id="bb5a" class="lh li in kk b kl mh kp mi kt nd kx ne lb nf lf ng ln lo lp bi translated"><a class="ae lg" href="https://pkg.go.dev/text/template" rel="noopener ugc nofollow" target="_blank">文本/模板</a> —包模板实现数据驱动的模板，用于生成文本输出。</li><li id="2322" class="lh li in kk b kl lq kp lr kt ls kx lt lb lu lf ng ln lo lp bi translated"><a class="ae lg" href="https://pkg.go.dev/net/http" rel="noopener ugc nofollow" target="_blank"> net/http </a> —包 http 提供 http 客户端和服务器实现。</li></ol><p id="bdfc" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">我们需要创建一个定义用户模型的结构:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="fef9" class="lv jl in mr b gy mv mw l mx my">// define a user model<br/>type User struct {<br/>   Id    int<br/>   Username  string<br/>   City string<br/>   Email string<br/>   Password string<br/>}</span></pre><p id="ccd4" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">如下所示重构 main.go 文件，添加一个“Index”函数，该函数将查询用户表并返回其行的内容:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="fec3" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">现在可以通过向地址<a class="ae lg" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>发出请求来列出所有用户。</p><figure class="mm mn mo mp gt na gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/36b32acf6637cf02c2578e309f64b5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_o5oFkS9XyJcUhvcCLf3tw.jpeg"/></div></div></figure><h2 id="62d8" class="lv jl in bd jm lw lx dn jq ly lz dp ju kt ma mb jy kx mc md kc lb me mf kg mg bi translated">2.创建用户</h2><p id="5f21" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">创建一个用户需要能够输入信息，然后发出一个 post 请求，这个请求可以传递给一个函数，然后这个函数将数据插入数据库。一旦这样做了，它就应该重定向到现在显示新添加的信息的索引页面。</p><p id="a84d" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">为此，我们将创建一个“新建”和“显示”模板以及相应的插入和显示函数。“新”模板将包括一个表单动作，将数据发送到“插入”路径，该路径将用于向插入函数传递输入。</p><p id="627b" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">首先，使用 New.tmpl 表单获取创建新用户所需的输入:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ad17" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">表单操作会将插入的数据发送到“插入”路径，该路径会通过相应的插入功能在数据库中创建一个新行:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ef35" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">当数据库语句成功执行时，浏览器将重定向到显示添加用户的索引页面。</p><figure class="mm mn mo mp gt na gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi no"><img src="../Images/e632f0d2d18a015f77ec5d6883f603db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXFGHUFyX7xVGP-WvbifPw.png"/></div></div></figure><p id="c93e" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">通过构造以下内容，可以使用表中的“查看”按钮显示单个用户:</p><p id="398b" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">显示单个用户的显示模板:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="1b32" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">以及一个 show 函数，它返回数据库中的信息，这些信息由单击 View 按钮时传递的 Id 值过滤:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="b661" class="lv jl in bd jm lw lx dn jq ly lz dp ju kt ma mb jy kx mc md kc lb me mf kg mg bi translated">3.更新用户</h2><p id="48c8" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">既然我们已经实现了创建和显示用户的功能，现在我们可以启用编辑功能，更新数据库中的条目，然后重定向到显示新数据的索引页面。</p><p id="edbf" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">让我们创建一个重定向到“更新”动作的编辑表单。</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f634" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">然后，一个编辑功能将查询数据库中要更新的用户:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c8db" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">然后，用户将被传递到更新操作函数，该函数将使用传递的值执行一条语句:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="c487" class="lv jl in bd jm lw lx dn jq ly lz dp ju kt ma mb jy kx mc md kc lb me mf kg mg bi translated">4.删除用户</h2><p id="b474" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">配置的最后一个操作是删除用户。当用户 ID 通过/delete 路由传递时，应该执行相应的语句从数据库中删除条目。下面的函数应该可以实现这一点:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4245" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">您的 main.go 文件现在应该类似于以下内容:</p><figure class="mm mn mo mp gt na"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="9182" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">这将简化操作数据库所需的 CRUD 操作。在下一篇文章中，我们将添加一个身份验证层，根据用户身份来限制或启用访问和功能。</p><p id="3c33" class="pw-post-body-paragraph ki kj in kk b kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf ig bi translated">我欢迎任何可以改进演示的建议或更正，请在评论中告诉我。</p></div></div>    
</body>
</html>