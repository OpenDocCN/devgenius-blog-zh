<html>
<head>
<title>How To Use UserDefaults in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Swift中使用用户默认值</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-userdefaults-in-swift-297898443165?source=collection_archive---------1-----------------------#2019-12-20">https://blog.devgenius.io/how-to-use-userdefaults-in-swift-297898443165?source=collection_archive---------1-----------------------#2019-12-20</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="c7a3" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">用几行代码轻松保存用户设置</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/cf999a706861af5cac7cffc3e12efe6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C8e7fQ1dkZs-i8EV"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated"><a class="ae kw" href="https://unsplash.com/@grohsfabian?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">法比安·格罗斯</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="958c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">从iOS 2.0开始提供的<code class="fe lt lu lv lw b">UserDefaults</code>，只要安装了app，就提供了存储持久化值的接口。<code class="fe lt lu lv lw b">UserDefaults</code>类似于一个数据库。它可以作为一种方便的方式来保存少量的可用数据，即使你关闭应用程序并重新启动它。如果您需要存储大数据或通过复杂的查询访问它，您可能需要使用SQLite或核心数据。</p><p id="c0a8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">像所有在封闭沙盒中运行的iOS应用一样，一个应用不能从任何其他应用修改<code class="fe lt lu lv lw b">UserDefaults</code>——除非通过应用扩展。</p><p id="4c45" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你可以在<a class="ae kw" href="https://developer.apple.com/documentation/foundation/userdefaults" rel="noopener ugc nofollow" target="_blank">官方文件</a>中找到更多信息。</p></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="cde4" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">入门指南</h1><p id="6dda" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">首先打开<a class="ae kw" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode，</a>新建一个项目。选择单视图应用程序。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nb"><img src="../Images/133dbb1d3737bf8c7c569e84e0b54952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70OGn9sm1kfRKvR19JRBvg.png"/></div></div></figure><p id="ee06" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">转到<code class="fe lt lu lv lw b">Main.Storyboard</code>文件，创建两个不同的部分:<code class="fe lt lu lv lw b">Write</code>和<code class="fe lt lu lv lw b">Read</code>。这里，添加三个控件:一个<code class="fe lt lu lv lw b">textbox</code>、一个<code class="fe lt lu lv lw b">switch</code>和一个<code class="fe lt lu lv lw b">slider</code>。我们将使用这个接口来测试我们的<code class="fe lt lu lv lw b">UserDefaults</code>实现。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj nc"><img src="../Images/f5c49aa61f4dacd71aca88084bb4a16f.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*_prc8_d9tdLvBvEsxXuSHA.png"/></div></figure></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="30e2" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">履行</h1><p id="d6c5" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">首先，进入你的<code class="fe lt lu lv lw b">ViewController.swift</code>，为所有控件创建<code class="fe lt lu lv lw b">IBOutlet</code>。然后，添加以下代码:</p><pre class="kh ki kj kk gu nd lw ne nf aw ng bi"><span id="7cac" class="nh mf ir lw b gz ni nj l nk nl">class ViewController: UIViewController {<br/><br/>    @IBOutlet weak var writeTextView: UITextView!<br/>    @IBOutlet weak var writeSwitch: UISwitch!<br/>    @IBOutlet weak var writeSlider: UISlider!<br/>    <br/>    @IBOutlet weak var readTextView: UITextView!<br/>    @IBOutlet weak var readSwitch: UISwitch!<br/>    @IBOutlet weak var readSlider: UISlider!<br/>    <br/>    let defaults = UserDefaults.standard<br/>    <br/>    override func viewDidLoad() {<br/>        super.viewDidLoad()<br/>        // Do any additional setup after loading the view.<br/>    }<br/>    <br/>    func textFieldShouldReturn(_ textField: UITextField) -&gt; Bool {<br/>        self.view.endEditing(true)<br/>        return false<br/>    }<br/>    <br/>    override func touchesBegan(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) {<br/>        self.view.endEditing(true)<br/>    }<br/><br/>    @objc func keyboardWillShow(notification: NSNotification) {<br/>        if let keyboardSize = (notification.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] as? NSValue)?.cgRectValue {<br/>            <br/>            if self.view.frame.origin.y == 0 {<br/>                <br/>                self.view.frame.origin.y -= keyboardSize.height - 85<br/>                <br/>            }<br/>        }<br/>    }<br/>    <br/>    @objc func keyboardWillHide(notification: NSNotification) {<br/>        self.view.frame.origin.y = 0<br/>    }<br/>    <br/>    @IBAction func saveButtonTapped(_ sender: Any) {<br/>        defaults.set(writeTextView.text, forKey: "writeTextViewValue")<br/>        defaults.set(writeSwitch.isOn, forKey: "writeSwitchValue")<br/>        defaults.set(writeSlider.value, forKey: "writeSliderValue")<br/>    }<br/>    <br/>    @IBAction func readButtonTapped(_ sender: Any) {<br/>        readTextView.text = defaults.string(forKey: "writeTextViewValue")<br/>        readSwitch.isOn = defaults.bool(forKey: "writeSwitchValue")<br/>        readSlider.value = defaults.float(forKey: "writeSliderValue")<br/>    }<br/>    <br/>}</span></pre><p id="7960" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">当我们从<code class="fe lt lu lv lw b">UserDefaults</code>中读取数据时，我们可以使用不同的方法来获取为特定键存储的数据。这是因为如果找不到数据，返回值是。下面是支持的数据类型:</p><ul class=""><li id="b889" class="nm nn ir kz b la lb ld le lg no lk np lo nq ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">object(forKey:)</code>返回与指定键相关联的对象，如果找不到则返回nil</li><li id="a6eb" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">url(forKey:)</code>返回与指定键相关联的URL，如果找不到则返回nil</li><li id="3d82" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">array(forKey:)</code>返回与指定键相关的数组，如果找不到则返回nil</li><li id="f271" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">dictionary(forKey:)</code>返回与指定键相关联的字典；如果找不到或其值不是有效的字典，则为空</li><li id="ca23" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">string(forKey:)</code>返回与指定键相关的字符串；如果找不到或者不是有效的字符串或有效的数值，则为nil</li><li id="e9ec" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">stringArray(forKey:)</code>返回与指定键相关的字符串数组；如果找不到或数组不包含字符串，则为空</li><li id="01af" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">data(forKey:)</code>返回与指定键相关的数据对象；如果找不到或其值不是数据对象，则为空</li><li id="9360" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">bool(forKey:)</code>返回与指定键相关联的布尔值，如果未找到，则返回false。该方法将“是”、“1”和“真”等字符串强制转换为真值。对于假值也是如此。</li><li id="5136" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">integer(forKey:)</code>返回与指定键相关的整数，如果没有找到则返回0</li><li id="afed" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">float(forKey:)</code>返回与指定键相关的浮点数，如果没有找到则返回0</li><li id="96bc" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">double(forKey:)</code>返回与指定键相关的双精度值，如果没有找到则返回0</li><li id="ae35" class="nm nn ir kz b la nv ld nw lg nx lk ny lo nz ls nr ns nt nu bi translated"><code class="fe lt lu lv lw b">dictionaryRepresentation(forKey:)</code>返回包含与指定键关联的所有键-值对的并集的字典</li></ul></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="2587" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">试验</h1><p id="d6ef" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">最后，我们准备测试应用程序。</p><p id="0aeb" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">运行模拟器，在第一个<code class="fe lt lu lv lw b">text box</code>中写入一些文本，更改<code class="fe lt lu lv lw b">switch</code>状态，更改<code class="fe lt lu lv lw b">slider</code>值，然后点击“按下保存”按钮。</p><p id="1fcb" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，如果您点击屏幕底部的“Push to Read”按钮，您会看到之前保存的值将被加载到Read部分的三个控件中。</p><p id="3053" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你也可以尝试关闭应用程序，重新启动它，然后读取数据。您将看到先前保存的数据将被加载到读取部分。</p><div class="kh ki kj kk gu ab cb"><figure class="oa kl ob oc od oe of paragraph-image"><img src="../Images/30d64c1ddb772cd04a0d1cf0de077ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*e1-a8TcI3a0bwbS9GyMFvQ.png"/></figure><figure class="oa kl ob oc od oe of paragraph-image"><img src="../Images/6b5670d5c362f4487c6e414f69a80dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*THfb9ZzM11I9Ey_Q_hK5uA.png"/></figure></div></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj og"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><h1 id="c984" class="me mf ir bd mg mh oh mj mk ml oi mn mo jx oj jy mq ka ok kb ms kd ol ke mu mv bi translated">完整代码</h1><p id="e7dc" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">你可以在<a class="ae kw" href="https://github.com/domeniconicoli/UserDefaultsExample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的代码。</p><p id="8037" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>