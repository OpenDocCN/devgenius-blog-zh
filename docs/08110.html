<html>
<head>
<title>Image Classification with Tensorflow, Django, and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 Tensorflow、Django 和 Heroku 的影像分类</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/image-classification-using-tensorflow-and-heroku-for-django-daf8868cc88d?source=collection_archive---------9-----------------------#2022-05-17">https://blog.devgenius.io/image-classification-using-tensorflow-and-heroku-for-django-daf8868cc88d?source=collection_archive---------9-----------------------#2022-05-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/e8fa3a421ff0ed606fecc3da97b0b137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XOKikSFuPAs8bE2r"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">费萨尔在<a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><p id="3649" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本教程将向您介绍为 django 使用 tensorflow 和 heroku 的基础知识。我们将看到如何通过 django web 框架使用 tensorflow 库实现图像分类，然后在 heroku 上托管 django 网站。</p><p id="0ca8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本教程认为您已经将训练好的模型保存为. h5 文件。一旦你有了这个文件，你将能够在这篇文章的结尾建立一个图像分类网站。即使您没有模型，您也可以跟随学习，因为您将很容易理解如何在 django 中为图像分类项目集成 h5 模型，并且步骤将会简单易懂，因为它将显示成功部署您的图像分类网站所需遵循的每个步骤。</p><p id="cc27" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je">姜戈是什么？</strong></p><p id="6af5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Django 是一个高级 Python web 框架，它鼓励快速开发和干净、实用的设计。由经验丰富的开发人员构建，它解决了 web 开发的许多麻烦，因此您可以专注于编写应用程序，而无需重新发明轮子。它是免费和开源的。要了解更多信息，他们在这里有一个很棒的文档<a class="ae ja" href="https://docs.djangoproject.com/en/4.0/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="147f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je">什么是</strong><a class="ae ja" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kc je">tensor flow</strong></a><strong class="kc je">？</strong></p><p id="62d2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">TensorFlow 是一个机器学习的端到端开源平台。它有一个全面、灵活的工具、库和社区资源的生态系统，让研究人员推动 ML 的最新发展，让开发人员轻松构建和部署 ML 驱动的应用程序。</p><p id="fb6b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je">什么是</strong><a class="ae ja" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kc je">Heroku</strong></a>T22】？</p><p id="4904" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Heroku 是一个云平台即服务(PaaS ),支持多种编程语言。各种规模的开发人员、团队和企业都使用 Heroku 来部署、管理和扩展应用。</p><p id="7b93" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们开始构建项目:</p><p id="59c8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 1。创建虚拟环境</strong></p><p id="4fa2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一步是创建一个虚拟环境，这样我们就可以在一个独立于系统包的环境中下载和存储这个特定项目所需的包。要创建虚拟环境:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9838" class="lh li jd ld b gy lj lk l ll lm">$ py -3 -m venv env</span></pre><p id="f145" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">激活环境:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9a9a" class="lh li jd ld b gy lj lk l ll lm">$ .\env\Scripts\activate</span></pre><p id="58ef" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 2。安装 django </strong></p><p id="5aaf" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要 django，所以我们将使用 pip 安装 django:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="de35" class="lh li jd ld b gy lj lk l ll lm">$ pip install django</span></pre><p id="5c12" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 3。创建一个 django 项目</strong></p><p id="96a8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下载 django 后，我们将使用 django-admin 命令创建我们的 django 项目。在下文中，&gt;<em class="ln"> PotatoLeafDisease </em>是我们的项目名称，您可以给它取任何名称:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c838" class="lh li jd ld b gy lj lk l ll lm">$ django-admin startproject PotatoLeafDisease </span><span id="ec52" class="lh li jd ld b gy lo lk l ll lm">$ cd PotatoLeafDisease</span></pre><p id="5819" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 4。创建 django 应用程序</strong></p><p id="3ef2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下一步是在项目中创建我们的应用程序。&gt;<em class="ln"> classifierApp </em>是我们在下面的应用:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9103" class="lh li jd ld b gy lj lk l ll lm">$ python manage.py startapp classifierApp</span></pre><p id="1fa8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在&gt;<a class="ae ja" href="http://settings.py" rel="noopener ugc nofollow" target="_blank"> <em class="ln"> settings.py </em> </a>文件中，将我们刚刚创建的应用添加到&gt; INSTALLED_APPS 列表中</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="580d" class="lh li jd ld b gy lj lk l ll lm">INSTALLED_APPS = [ <br/>'django.contrib.admin', <br/>'django.contrib.auth', <br/>'django.contrib.contenttypes', <br/>'django.contrib.sessions', <br/>'django.contrib.messages', <br/>'django.contrib.staticfiles', <br/>'classifierApp', </span><span id="1f6f" class="lh li jd ld b gy lo lk l ll lm">]</span></pre><p id="94d0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 5。创建一个&gt;模型</strong>，它将在 django 后端存储我们的分类结果。转到&gt;型号。文件并编写以下代码</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2c4c" class="lh li jd ld b gy lj lk l ll lm">from django.db import models<br/>from django.utils import timezone<br/># Create your models here.<br/>class Result(models.Model):<br/>    imagepath = models.TextField()<br/>    image = models.ImageField(null=True, blank=True)<br/>    predicted = models.TextField()<br/>    confidence = models.IntegerField(default=0, null=True, blank=True)<br/>    saved = models.DateTimeField(default=timezone.now)<br/><br/>    class Meta:<br/>        ordering = ('-saved',)<br/><br/>    def __str__(self):<br/>        return self.imagepath</span></pre><p id="f075" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">模型结果将存储图像路径细节和预测类及其置信度百分比。现在，在对&gt; models.py 进行更改之后，我们需要进行迁移来更新数据库的配置:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="5c1b" class="lh li jd ld b gy lj lk l ll lm">$ python manage.py makemigrations </span><span id="0470" class="lh li jd ld b gy lo lk l ll lm">$ python manage.py migrate</span></pre><p id="6756" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在&gt; admin.py 文件中注册模型:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="3ce1" class="lh li jd ld b gy lj lk l ll lm">from django.contrib import admin </span><span id="4b49" class="lh li jd ld b gy lo lk l ll lm">from . import models </span><span id="bb9f" class="lh li jd ld b gy lo lk l ll lm">admin.site.register(models.Result)</span></pre><p id="209d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 6。创建*模型文件夹</strong></p><p id="15b3" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在存储<em class="ln"> classifierApp </em>的同一目录下的根目录下创建一个新文件夹，并将模型文件(. h5)和<em class="ln"> labels.json </em>文件放入。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/fe6f0d177973c3f9f4f54e464d39b762.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/0*4ZSmMvvNIc6a2Q8e"/></div></figure><p id="0465" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">&gt;<em class="ln"> labels.json </em>文件看起来类似于下图:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="8cc7" class="lh li jd ld b gy lj lk l ll lm">{<br/>    "0": "A",<br/>    "1": "B",<br/>    "2": "C",<br/>    "3": "U"<br/>}</span></pre><p id="8669" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">7。创建视图</p><p id="9752" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在将使用 keras 加载我们的模型，并使用该模型预测新图像的类别。为此，我们需要安装几个库:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="fd68" class="lh li jd ld b gy lj lk l ll lm">$ pip install keras </span><span id="2486" class="lh li jd ld b gy lo lk l ll lm">$ pip install tensorflow </span><span id="4a05" class="lh li jd ld b gy lo lk l ll lm">$ pip install Pillow</span></pre><p id="eaf4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在&gt; views.py 中，编写以下代码:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b96d" class="lh li jd ld b gy lj lk l ll lm">from django.shortcuts import render<br/><br/>from django.core.files.storage import FileSystemStorage<br/>from .models import Result<br/>from rest_framework.views import APIView<br/>from rest_framework.response import Response<br/>from .serializers import LeafDiseaseSerializer  <br/><br/>from keras.models import load_model<br/>from keras.preprocessing import image<br/>import json <br/>import tensorflow as tf<br/>import numpy as np<br/><br/>import os<br/>os.environ['TF_CPP_MIN_LOG_LEVEL'] = '3' <br/><br/><br/>img_height, img_width = 256, 256<br/>with open('./models/labels.json', 'r') as f:<br/>    labelInfo = f.read()<br/><br/>labelInfo = json.loads(labelInfo)<br/># print(labelInfo)<br/><br/>tf.compat.v1.disable_eager_execution()<br/>model_graph = tf.Graph()<br/>with model_graph.as_default():<br/>    tf_session = tf.compat.v1.Session()<br/><br/>    with tf_session.as_default():<br/>        model=load_model('./models/model.h5')<br/><br/># Create your views here.<br/>def index(request):<br/>    return render(request, 'index.html')<br/><br/>def predictImage(request):<br/>    # print(request)<br/>    # print(request.POST.dict())<br/><br/>    try:<br/><br/>        fileObj = request.FILES['filePath']<br/>        fs = FileSystemStorage()<br/><br/>        filePathName = fs.save(fileObj.name, fileObj)<br/>        filePathName = fs.url(filePathName)<br/>        testimage = '.'+filePathName<br/>        # print(testimage)<br/>        # print(filePathName)<br/><br/>        # print(type(testimage))<br/><br/>        # if '%20' in testimage:<br/>        #     testimage = fileObj.replace("%20", ' ')<br/>        #     print(testimage)<br/><br/>        img = image.load_img(testimage, target_size=(img_height, img_width))<br/>        test_image = image.img_to_array(img)<br/>        test_image = np.expand_dims(test_image, axis = 0)<br/><br/>        confidence = 0<br/>        with model_graph.as_default():<br/>            with tf_session.as_default():<br/>                pred = model.predict(test_image)<br/>                # print(pred)<br/>                confidence = round(np.max(pred) * 100, 2)<br/><br/>        predictedLabel = labelInfo[str(np.argmax(pred[0]))]<br/>        print('Predicted label: ', predictedLabel)  <br/>        print(f'Confidence : {confidence}%')    <br/><br/><br/><br/>        filename = filePathName.split('/')[-1]<br/>        print(filename)<br/><br/>        new_item = Result(imagepath = filePathName , image = filename, predicted = predictedLabel, confidence = confidence)<br/>        new_item.save()<br/><br/>        context = {'filePathName':filePathName, 'predictedLabel': predictedLabel, 'confidence': confidence, 'filename': filename}<br/>        return render(request, 'index.html', context)<br/><br/>    except:<br/>        return render(request, 'index.html')<br/><br/><br/>def viewDataBase(request):<br/>    all_results = Result.objects.all()<br/><br/>    for i in all_results:<br/>        print(i.imagepath)<br/>        break<br/><br/>    # listOfImages = os.listdir('./media/')<br/>    # listOfImagesPath = ['./media/' + i for i in listOfImages]<br/>    context = { 'all_results':all_results}  #  'listOfImagesPath': listOfImagesPath,<br/>    return render(request, 'viewDB.html', context)</span></pre><p id="a0e1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的代码中，我们首先导入库，然后加载&gt;<em class="ln"> labels.json </em>文件和模型&gt; <em class="ln"> .h5 </em>。为此，我们使用 keras 的 load _ model。models 使用 tensorflow 图加载它。</p><p id="51aa" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来是为我们的模板定义视图。我们总共有三个视图…索引、预测图像、视图数据库。</p><p id="29bb" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">I .索引视图是主页视图。</p><p id="70e5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">二。预测图像视图用于预测图像的类别，但它将渲染相同的 index.html，但具有预测的结果。</p><p id="6b26" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">三。最后，视图数据库视图将显示保存的结果。</p><p id="7d9a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以对于模板文件，你可以自己创建一个，但是在这篇文章中，我用的是从 github 下载的。</p><p id="b90f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我按照 youtube <a class="ae ja" href="https://youtu.be/mgX-2_ybqNk" rel="noopener ugc nofollow" target="_blank">链接</a>中的步骤，在这篇文章中使用了相同的前端静态文件和模板。</p><p id="d8de" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 8。创建模板文件</strong></p><p id="61e1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您已经准备好自己的模板文件和静态文件，或者从上面的链接下载，下一步是创建一个名为 template 的新文件夹，并在项目文件夹(根文件夹)中创建 static。将 html 文件放在模板文件夹中，然后将静态文件或文件夹(如 css、js 和图像文件)放在静态文件夹中。文件目录结构如下所示:</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/64804af1ea967e41fa3cca4cc09938bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/0*JGRdIaVUvlVX-IbX"/></div></figure><p id="45a6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面给出&gt;模板列表中&gt;<a class="ae ja" href="http://settings.py" rel="noopener ugc nofollow" target="_blank"> settings.py </a>文件内模板的路径:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="78b7" class="lh li jd ld b gy lj lk l ll lm">TEMPLATES = [<br/>    {<br/>        'BACKEND':'django.template.backends.django.DjangoTemplates',<br/>        'DIRS': [os.path.join(BASE_DIR, 'templates')],<br/>        'APP_DIRS': True,<br/>        'OPTIONS': {<br/>            'context_processors': [<br/>                'django.template.context_processors.debug',<br/>                'django.template.context_processors.request',<br/>                'django.contrib.auth.context_processors.auth',<br/>                'django.contrib.messages.context_processors.messages',<br/>            ],<br/>        },<br/>    },<br/>]</span></pre><p id="472a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还要添加以下路径:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="105b" class="lh li jd ld b gy lj lk l ll lm">STATIC_URL = 'static/' </span><span id="6c06" class="lh li jd ld b gy lo lk l ll lm">STATICFILES_DIRS = [ <br/>   os.path.join(BASE_DIR, 'static') <br/>] </span><span id="d8a2" class="lh li jd ld b gy lo lk l ll lm">MEDIA_URL = '/media/' </span><span id="9941" class="lh li jd ld b gy lo lk l ll lm">MEDIA_ROOT = os.path.join(BASE_DIR, 'media') </span><span id="9149" class="lh li jd ld b gy lo lk l ll lm">STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')</span></pre><p id="0461" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 9。创建网址</strong></p><p id="577b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先在 app 文件夹(classifierApp)中创建&gt; urls.py 文件，并为视图创建 urlpatterns</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="049b" class="lh li jd ld b gy lj lk l ll lm">from django.urls import path<br/>from . import views<br/>from django.conf.urls.static import static <br/>from django.conf import settings<br/><br/>app_name = 'classifierApp'<br/><br/>urlpatterns = [<br/>    path('', views.index, name='homepage'),<br/>    path('predict', views.predictImage, name='predict'),<br/>    path('viewdb', views.viewDataBase, name='view'),<br/><br/>]<br/><br/>urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)<br/>urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</span></pre><p id="2f91" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">转到项目文件夹的&gt; urls.py 文件，该文件夹与存储<a class="ae ja" href="http://settings.py" rel="noopener ugc nofollow" target="_blank"> <em class="ln"> settings.py </em> </a>文件的目录相同，并包含应用程序的 URL</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="5ad9" class="lh li jd ld b gy lj lk l ll lm">from django.contrib import admin<br/>from django.urls import path, include<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', include('classifierApp.urls', namespace='potatoleafdisease')),<br/>]</span></pre><p id="ac46" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行以下命令收集静态文件:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="ca5c" class="lh li jd ld b gy lj lk l ll lm">$ python manage.py collectstatic</span></pre><p id="4275" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行服务器并检查 django 是否运行良好；</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="451c" class="lh li jd ld b gy lj lk l ll lm">$ python manage.py runserver</span></pre><p id="59cb" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> 10。部署在 Heroku </strong></p><p id="021e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先安装以下模块</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b580" class="lh li jd ld b gy lj lk l ll lm">$ pip install gunicorn </span><span id="e20a" class="lh li jd ld b gy lo lk l ll lm">$ pip install whitenoise </span><span id="74f7" class="lh li jd ld b gy lo lk l ll lm">$ pip install dj-database-url </span><span id="8234" class="lh li jd ld b gy lo lk l ll lm">$ pip install psycopg2 </span><span id="4125" class="lh li jd ld b gy lo lk l ll lm">$ pip install dj-database-url</span></pre><p id="1de6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将 env 中安装的所有依赖项添加到&gt;<em class="ln"> requirements.txt，</em></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="1004" class="lh li jd ld b gy lj lk l ll lm">$ pip freeze &gt; requirements.txt</span></pre><p id="c092" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您使用的是 tensor flow 2 . x 版..在 heroku 上免费托管的情况下，您可能会遇到段塞大小的问题，一些解决方案包括使用&gt; tensorflow-cpu 而不是 tensorflow 2.x..因为 tensorflow 本身的大小加起来接近 500mb，而 tensorflow-cpu 占用的内存块相对较小。</p><p id="513f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">其他技术包括<a class="ae ja" href="https://devcenter.heroku.com/articles/slug-compiler" rel="noopener ugc nofollow" target="_blank">链接</a>:</p><ul class=""><li id="e551" class="lr ls jd kc b kd ke kh ki kl lt kp lu kt lv kx lw lx ly lz bi translated">将 pdf 或音频文件等大型资产移动到资产存储。</li><li id="f976" class="lr ls jd kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">通过. slugignore 删除不需要的依赖项并排除不需要的文件。</li><li id="342a" class="lr ls jd kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">清除生成缓存。</li></ul><p id="297f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je">创建过程文件</strong></p><p id="18d5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<em class="ln">过程文件</em>中:PotatoLeafDisease 是一个项目名</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="ae2c" class="lh li jd ld b gy lj lk l ll lm">web: gunicorn PotatoLeafDisease.wsgi -log-file -</span></pre><p id="854d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Make <em class="ln"> runtime.txt </em>，所有那些文件(requirements.txt、Procfile 和 runtime.txt)都应该在根目录内(项目目录内)</p><p id="8431" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ln"> runtime.txt </em>:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c051" class="lh li jd ld b gy lj lk l ll lm">python-3.10.3</span></pre><p id="b21d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<a class="ae ja" href="https://devcenter.heroku.com/" rel="noopener ugc nofollow" target="_blank">devcenter.heroku.com</a>中检查支持的版本</p><p id="8f47" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了在 heroku 上托管一个网站，我们需要在 heroku 上创建一个帐户，并下载和设置 heroku CLI</p><p id="ff61" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一、建立 heroku 账户</p><p id="d9e8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">二。下载 Heroku CLI</p><p id="98a6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">三。配置 Django Heroku:</p><p id="22c6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用 git 在 heroku 上添加文件</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2af2" class="lh li jd ld b gy lj lk l ll lm">$ git init </span><span id="9197" class="lh li jd ld b gy lo lk l ll lm">$ git add . </span><span id="3bcc" class="lh li jd ld b gy lo lk l ll lm">$ git commit -m "First commit"</span></pre><p id="9404" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过输入命令行登录 heroku</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="45ae" class="lh li jd ld b gy lj lk l ll lm">heroku login</span></pre><p id="54d6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建网站名称</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2c3f" class="lh li jd ld b gy lj lk l ll lm">$ heroku create potatoleafdisease</span></pre><p id="3d3f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">禁用 collectstatic:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9cf6" class="lh li jd ld b gy lj lk l ll lm">$ heroku config:set DISABLE_COLLECTSTATIC=1</span></pre><p id="f56e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<a class="ae ja" href="http://settings.py" rel="noopener ugc nofollow" target="_blank"> settings.py </a>中:</p><p id="26c2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将其添加到中间件列表中:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="94b2" class="lh li jd ld b gy lj lk l ll lm">DEBUG = False </span><span id="b9bd" class="lh li jd ld b gy lo lk l ll lm">ALLOWED_HOSTS = ['potatoleafdisease.herokuapp.com', 'localhost', '127.0.0.1'] </span><span id="2dcb" class="lh li jd ld b gy lo lk l ll lm">MIDDLEWARE = [ <br/>    'whitenoise.middleware.WhiteNoiseMiddleware', </span><span id="b903" class="lh li jd ld b gy lo lk l ll lm">]</span></pre><p id="4b78" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果要使用 heroku 中的数据库，在<a class="ae ja" href="http://settings.py" rel="noopener ugc nofollow" target="_blank"> <em class="ln"> settings.py </em> </a>中指定以下内容，表示您将使用默认的 heroku 数据库。</p><p id="08aa" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">heroku 的数据库更新</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="e91c" class="lh li jd ld b gy lj lk l ll lm">import dj_database_url<br/><br/>db_from_env = dj_database_url.config(conn_max_age=600)<br/>DATABASES['default'].update(db_from_env)</span></pre><p id="072e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用以下命令在 heroku 上进行迁移(如果我们不想在我们的网站上进行更改或使用数据库，这是不必要的)</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="3c59" class="lh li jd ld b gy lj lk l ll lm">$ heroku run python manage.py makemigrations </span><span id="84b5" class="lh li jd ld b gy lo lk l ll lm">$ heroku run python manage.py migrate</span></pre><p id="892e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在最后把文件推给 heroku:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="371b" class="lh li jd ld b gy lj lk l ll lm">$ git push heroku master</span></pre><p id="d092" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从终端打开网站如下，你也可以直接从你的 heroku 帐户仪表板打开。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="6bba" class="lh li jd ld b gy lj lk l ll lm">$ heroku open</span></pre><p id="1987" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们的图像分类项目与 django 和 heroku 集成完成。</p><p id="e2cc" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想更新你的网站或者改进你的模型，你可以先修改本地文件，然后再推送到 heroku。这将更新 heroku 上的文件，并显示更新的网站。</p><p id="58a2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，我们将再次使用 git 来推送我们编辑过的文件:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c2bd" class="lh li jd ld b gy lj lk l ll lm">$ git add . </span><span id="add0" class="lh li jd ld b gy lo lk l ll lm">$ git commit -m "edited " </span><span id="5532" class="lh li jd ld b gy lo lk l ll lm">$ git push heroku master</span></pre><p id="f743" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们连接上<a class="ae ja" href="https://github.com/Ugyenwangdi/BostonHousePredicton" rel="noopener ugc nofollow" target="_blank"> github </a></p></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="0814" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ln">原载于</em><a class="ae ja" href="https://wulfi.hashnode.dev/image-classification-using-tensorflow-and-heroku-for-django" rel="noopener ugc nofollow" target="_blank"><em class="ln">https://wulfi . hash node . dev</em></a><em class="ln">。</em></p></div></div>    
</body>
</html>