<html>
<head>
<title>Refactoring Using Cognitive Complexity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åˆ©ç”¨è®¤çŸ¥å¤æ‚æ€§è¿›è¡Œé‡æ„</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/refactoring-using-cognitive-complexity-7e55197335b6?source=collection_archive---------1-----------------------#2020-12-14">https://blog.devgenius.io/refactoring-using-cognitive-complexity-7e55197335b6?source=collection_archive---------1-----------------------#2020-12-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/456c3bc04483dc0414b1870dadfc3753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vwGDyhYiW1dN0ZIZ.jpg"/></div></div></figure><p id="8dc6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">é‡æ„ä»£ç æ˜¯è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„é‡è¦éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å¾ˆéš¾ç¡®å®šåº”è¯¥é‡æ„ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆè¦é‡æ„ã€‚åˆ¤æ–­ä»€ä¹ˆéœ€è¦é‡æ„çš„ä¸€ä¸ªæ ‡å‡†æ˜¯è®¤çŸ¥å¤æ‚æ€§ã€‚</p><p id="1548" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è®¤çŸ¥å¤æ‚æ€§æ˜¯SonarSourceå¼€å‘çš„ä¸€ç§åº¦é‡æ ‡å‡†ï¼Œsonar sourceæ˜¯æˆ‘ä»¬åœ¨AWHä½¿ç”¨çš„ä»£ç è´¨é‡å·¥å…·çš„å¼€å‘è€…ï¼Œè¯¥å·¥å…·åä¸º<a class="ae kt" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank"> SonarQube </a>ã€‚SonarQubeæŒ‚é’©åˆ°ä¸€ä¸ªé¡¹ç›®çš„CIç®¡é“ï¼Œå¹¶å¯¹å…¶æ‰§è¡Œä»£ç è´¨é‡åˆ†æã€‚SonarQubeèƒ½æ‰¾åˆ°çš„é—®é¢˜ç±»å‹ä»ç®€å•çš„äº‹æƒ…(è¿™ä¸ªå˜é‡ä»æ¥ä¸ç”¨ï¼ŒæŠŠå®ƒå»æ‰)åˆ°æ›´å¤æ‚çš„é‡æ„(è¿™ä¸ªæ–¹æ³•å¤ªå¤æ‚ï¼Œé‡æ„ä¸€ä¸‹)ã€‚ä¸ºäº†ç¡®å®šä¸€ä¸ªæ–¹æ³•æ˜¯å¦å¤ªå¤æ‚ï¼Œæ˜¯å¦åº”è¯¥é‡æ„ï¼Œéœ€è¦è®¡ç®—ä¸€ä¸ªè®¤çŸ¥å¤æ‚æ€§å¾—åˆ†ã€‚</p><h1 id="2ff8" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">å®šä¹‰å¤æ‚æ€§</h1><p id="6611" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">ç¼–ç¨‹å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„å¤æ‚æ€§æœ‰å‡ ç§å«ä¹‰ã€‚å¤§å¤šæ•°ç¨‹åºå‘˜å¯èƒ½éƒ½ç†Ÿæ‚‰åœˆå¤æ‚åº¦ï¼Œå®ƒè¯•å›¾å‘Šè¯‰æˆ‘ä»¬æµ‹è¯•æˆ–ç»´æŠ¤ä¸€ä¸ªæ–¹æ³•æœ‰å¤šå›°éš¾ã€‚å®ƒé€šè¿‡ä¸ºä¸€ä¸ªæ–¹æ³•ä¸­çš„æ¯ä¸ªåˆ†æ”¯åˆ›å»ºä¸€ä¸ªåˆ†æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åƒè¿™æ ·:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="a849" class="mg kv in mc b gy mh mi l mj mk">public static string HowMany(int n) // +1 (at least one path through each method)<br/>{<br/>    switch (n)<br/>    {<br/>        case 1: // +1<br/>            return "One";</span><span id="4254" class="mg kv in mc b gy ml mi l mj mk">        case 2: // +1<br/>            return "A couple";</span><span id="525f" class="mg kv in mc b gy ml mi l mj mk">        case 3: // +1<br/>            return "A few";</span><span id="981c" class="mg kv in mc b gy ml mi l mj mk">        case 4: // +1<br/>            return "Several";</span><span id="1845" class="mg kv in mc b gy ml mi l mj mk">        default:<br/>            return "Many";<br/>    }</span><span id="3846" class="mg kv in mc b gy ml mi l mj mk">    // Cyclomatic Complexity = 5<br/>}</span></pre><p id="2071" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è™½ç„¶åœˆå¤æ‚åº¦å¾ˆå¥½åœ°å‘Šè¯‰äº†æˆ‘ä»¬ä¸€ä¸ªæ–¹æ³•åœ¨æµ‹è¯•æ—¶æœ‰å¤šå¤æ‚(åˆ†æ•°é€šå¸¸æ˜¯è¦†ç›–ä¸€ä¸ªæ–¹æ³•æ‰€éœ€çš„æœ€å°æµ‹è¯•æ•°)ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å¾ˆå¥½åœ°å‘Šè¯‰æˆ‘ä»¬ä»£ç çš„<em class="mm">å¯ç»´æŠ¤æ€§</em>æˆ–<em class="mm">å¯ç†è§£æ€§</em>å¦‚ä½•ã€‚è®¤çŸ¥å¤æ‚æ€§å»ºç«‹åœ¨åœˆå¤æ‚æ€§çš„åŸºç¡€ä¸Šï¼Œå¹¶é€‚åº”åœˆå¤æ‚æ€§ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ªæ›´å¥½çš„åˆ†æ•°ï¼Œè¿™ä¸ªåˆ†æ•°æ›´å¤šåœ°ä¸ç†è§£å’Œå¯ç»´æŠ¤æ€§æœ‰å…³ï¼Œè€Œä¸æ˜¯æµ‹è¯•ã€‚</p><blockquote class="mn mo mp"><p id="12dc" class="jv jw mm jx b jy jz ka kb kc kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ks ig bi translated">è¯·æ³¨æ„ï¼Œè®¤çŸ¥å¤æ‚æ€§å¹¶ä¸ç‰¹å®šäºä»»ä½•ç¼–ç¨‹è¯­è¨€æˆ–é£æ ¼ã€‚è¿™ç¯‡æ–‡ç« ä¸­çš„æ‰€æœ‰ä¾‹å­éƒ½ä½¿ç”¨C#ã€‚</p></blockquote><h1 id="5942" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">è®¡ç®—å¤æ‚æ€§</h1><p id="25e5" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">å…³äºè®¡ç®—è®¤çŸ¥å¤æ‚æ€§ï¼Œä½ é¦–å…ˆåº”è¯¥çŸ¥é“çš„æ˜¯ï¼Œä½ ä¸éœ€è¦è‡ªå·±å»åšã€‚sonar cubeå°†ä½ çš„ä»£ç ä½œä¸ºCI/CDç®¡é“çš„ä¸€éƒ¨åˆ†è¿›è¡Œåˆ†æï¼Œå®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªè®¤çŸ¥å¤æ‚æ€§åˆ†æçš„å¥½å·¥å…·ã€‚ä½†æ˜¯å­¦ä¹ å¦‚ä½•è®¡ç®—åˆ†æ•°ä¼šæœ‰åŠ©äºä»¥æ›´æ˜“ç»´æŠ¤çš„æ–¹å¼æ„å»ºä½ çš„ä»£ç ã€‚</p><blockquote class="mn mo mp"><p id="aee6" class="jv jw mm jx b jy jz ka kb kc kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ks ig bi translated">è¿™ç¯‡æ–‡ç« åªç»™å‡ºè®¡ç®—è®¤çŸ¥å¤æ‚æ€§çš„åŸºç¡€çŸ¥è¯†ã€‚è¦äº†è§£å…¨éƒ¨ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹SonarSourceçš„ç™½çš®ä¹¦ã€‚</p></blockquote><p id="8104" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä»¥ä¸‹æ˜¯è®¡ç®—è®¤çŸ¥å¤æ‚æ€§å¾—åˆ†çš„åŸºæœ¬è§„åˆ™:</p><ol class=""><li id="e138" class="mt mu in jx b jy jz kc kd kg mv kk mw ko mx ks my mz na nb bi translated">ä»£ç æ§åˆ¶ç»“æ„ä¸­çš„æ¯ä¸€ä¸ªæ–­ç‚¹éƒ½å¢åŠ åˆ†æ•°ã€‚</li><li id="0b4b" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">å¯¹äºæ¯ä¸€çº§åµŒå¥—çš„æ§åˆ¶ç»“æ„æ–­ç‚¹ï¼Œå†æ¬¡å¢åŠ åˆ†æ•°ã€‚</li><li id="1122" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">å¿½ç•¥æœ‰åŠ©äºå¯è¯»æ€§çš„ç®€å†™ç»“æ„ã€‚</li></ol><p id="a3a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è®©æˆ‘ä»¬å†ç»†åˆ†ä¸€ä¸‹ã€‚</p><h2 id="e3c3" class="mg kv in bd kw nh ni dn la nj nk dp le kg nl nm li kk nn no lm ko np nq lq nr bi translated"><strong class="ak">æ§åˆ¶ç»“æ„ä¸­çš„ä¸­æ–­</strong></h2><p id="94ef" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">è¿™æ˜¯åœˆå¤æ‚åº¦æœ€åŸºæœ¬çš„è§„åˆ™ã€‚å¾ªç¯å’Œæ¡ä»¶ä¼šå¢åŠ æµç¨‹ä¸­æ¯ä¸ªæ–­ç‚¹çš„åˆ†æ•°ã€‚ä¸è¿‡ï¼Œæœ‰ä¸€äº›è­¦å‘Šã€‚</p><ul class=""><li id="c22d" class="mt mu in jx b jy jz kc kd kg mv kk mw ko mx ks ns mz na nb bi translated"><strong class="jx io"><em class="mm"/></strong><strong class="jx io"><em class="mm">æœ€å</em> </strong>å—è¢«å¿½ç•¥ï¼Œä½†æ˜¯<strong class="jx io"> <em class="mm"> catch </em> </strong>ä¼šé€’å¢åˆ†æ•°ï¼Œå°½ç®¡ä¸ç®¡æ•è·å¤šå°‘ç§ç±»å‹çš„å¼‚å¸¸éƒ½åªæœ‰ä¸€æ¬¡ã€‚</li><li id="eebc" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated">ä¸€ä¸ª<strong class="jx io"> <em class="mm">å¼€å…³</em> </strong> <em class="mm"> </em>åªä¼šæŠŠåˆ†æ•°åŠ 1ï¼Œä¸ç®¡å¤„ç†äº†å¤šå°‘ä¸ªæ¡ˆä»¶ã€‚è¿™ä¸åœˆå¤æ‚åº¦ä¸åŒï¼Œè¿™æ ·åšæ˜¯å› ä¸ºä¸€ä¸ªå¼€å…³é€šå¸¸æ¯”ä¸€ç»„ç­‰ä»·çš„<strong class="jx io"><em class="mm">if/else if/else</em></strong><em class="mm"/>è¯­å¥æ›´å®¹æ˜“æ‰«æå’Œè¯»å–ã€‚</li><li id="ccdc" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated">é€»è¾‘è¿ç®—ç¬¦åºåˆ—è¢«ç»„åˆåœ¨ä¸€èµ·ã€‚è€ƒè™‘ä¸€ä¸‹<strong class="jx io"><em class="mm">a&amp;&amp;b&amp;&amp;c&amp;&amp;d</em></strong>å’Œ<strong class="jx io"><em class="mm">a&amp;&amp;b | | c&amp;&amp;d</em></strong>çš„åŒºåˆ«ã€‚ç¬¬ä¸€ä¸ªå°†å¢åŠ 1ï¼Œè€Œç¬¬äºŒä¸ªå°†å¢åŠ 3ï¼Œå› ä¸ºå®ƒæ›´éš¾è¯»å–ã€‚</li><li id="2302" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated">é€’å½’è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¾ªç¯ï¼Œå¯ä»¥å¢åŠ åˆ†æ•°ã€‚</li><li id="be25" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated">è·³è½¬(<strong class="jx io"> <em class="mm">ä¸­æ–­ã€ç»§ç»­ã€</em> </strong>ç­‰)ä¼šå¢åŠ åˆ†æ•°ï¼Œä½†æå‰<strong class="jx io"> <em class="mm">è¿”å›</em> </strong>åˆ™ä¸ä¼šã€‚</li></ul><blockquote class="mn mo mp"><p id="0d9b" class="jv jw mm jx b jy jz ka kb kc kd ke kf mq kh ki kj mr kl km kn ms kp kq kr ks ig bi translated">å› ä¸ºå…³äº<strong class="jx io"> <em class="in">åˆ‡æ¢</em> </strong> <em class="in"> </em>è¯­å¥çš„è§„åˆ™ï¼Œä¸Šé¢çš„<strong class="jx io"><em class="in">how much</em></strong>æ–¹æ³•åªæœ‰ä¸€ä¸ªè®¤çŸ¥å¤æ‚åº¦å¾—åˆ†1ã€‚</p></blockquote><h2 id="bee3" class="mg kv in bd kw nh ni dn la nj nk dp le kg nl nm li kk nn no lm ko np nq lq nr bi translated"><strong class="ak">åµŒå¥—æ§åˆ¶ç»“æ„</strong></h2><p id="7d04" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">è¿‡åº¦åµŒå¥—æ˜¯éå¸¸è®¨åŒçš„<a class="ae kt" href="https://en.wikipedia.org/wiki/Code_smell" rel="noopener ugc nofollow" target="_blank">ä»£ç æ°”å‘³</a>ã€‚è®¤çŸ¥å¤æ‚æ€§é€šè¿‡åœ¨åµŒå¥—çš„æ¯ä¸€å±‚ä¸­å¢åŠ æ¯ä¸€ä¸ªæ§åˆ¶ç»“æ„æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¸è¿‡ï¼Œè·³è½¬ä¸å—åµŒå¥—é¢å¤–å¢é‡çš„å½±å“ã€‚</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="c79a" class="mg kv in mc b gy mh mi l mj mk">public string DoSomething(string str)<br/>{<br/>    var newStr = string.Empty;</span><span id="1c7f" class="mg kv in mc b gy ml mi l mj mk">    if (str == null) // +1<br/>    {<br/>        for (var i == 0; i &lt; str.Length; i++) // +1 (+1 for nesting)<br/>        {<br/>            if (str[i] == 'a') // +1 (+2 for nesting)<br/>                newStr += 'A';<br/>            else if (str[i] == 'x') // +1 (+2 for nesting)<br/>                continue; // +1<br/>            else<br/>                newStr = str[i];<br/>        }<br/>    }</span><span id="f552" class="mg kv in mc b gy ml mi l mj mk">    return newStr;<br/>}</span><span id="62f9" class="mg kv in mc b gy ml mi l mj mk">// Cognitive Complexity = 10</span></pre><h2 id="e381" class="mg kv in bd kw nh ni dn la nj nk dp le kg nl nm li kk nn no lm ko np nq lq nr bi translated"><strong class="ak">å¿½ç•¥é€Ÿè®°ç»“æ„</strong></h2><p id="0ecb" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">è®¤çŸ¥å¤æ‚æ€§åˆ†æ•°æ„åœ¨å¥–åŠ±è‰¯å¥½çš„ç¼–ç å®è·µï¼Œå› æ­¤é€Ÿè®°ç»“æ„å’Œè¯­å¥ä¸è®¡å…¥åˆ†æ•°ã€‚æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåƒé›¶åˆå¹¶æ“ä½œç¬¦è¿™æ ·çš„ä¸œè¥¿æ˜¯ä½¿ç”¨è¯­è¨€é™ä½å¤æ‚æ€§çš„å¥½æ–¹æ³•ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="2806" class="mg kv in mc b gy mh mi l mj mk">// Not good, increments the score<br/>var myString == string.Empty;<br/>if (someObj == null)<br/>    myString = someObj.StringProperty;</span><span id="b760" class="mg kv in mc b gy ml mi l mj mk">// Good, does not increment the score<br/>var myString = someObj?.StringProperty ?? string.Empty;</span></pre><h1 id="f2d2" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">ä¾‹å­</h1><p id="77d2" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">è®©æˆ‘ä»¬ä½¿ç”¨è¿™äº›è§„åˆ™å¹¶é‡æ„ä¸€äº›ä¸œè¥¿ã€‚åˆ©ç”¨æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸€äº›ç®€å•çš„æ–¹æ³•æ¥é™ä½å¤æ‚æ€§ï¼Œä½¿æ–¹æ³•æ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªå¤§çš„ã€è®¨åŒçš„æ–¹æ³•å¼€å§‹ï¼Œç¡®å®šæœ€å¤æ‚çš„åŒºåŸŸ:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="1ee8" class="mg kv in mc b gy mh mi l mj mk">public async Task ParseAsync(string startingUrl, bool recurse = false, bool verbose = false)<br/>{<br/>    startingUrl = CleanUrl(startingUrl);<br/>    _rootUrl = new Uri(startingUrl).GetLeftPart(UriPartial.Authority);</span><span id="bdb3" class="mg kv in mc b gy ml mi l mj mk">    var urls = new Dictionary&lt;string, int&gt;();<br/>    urls.Add(startingUrl, 0);</span><span id="5b05" class="mg kv in mc b gy ml mi l mj mk">    while (urls.Any(x =&gt; x.Value == 0))<br/>    {<br/>        // Grab any URLs from the dictionary that we have not checked. If we are recursing,<br/>        // new URLs will be added with a status code of 0 and we will pick them up on the<br/>        // next pass.<br/>        var urlsToProcess = urls.Where(x =&gt; x.Value == 0).Select(x =&gt; x.Key).ToList();</span><span id="6479" class="mg kv in mc b gy ml mi l mj mk">        foreach (var url in urlsToProcess)<br/>        {<br/>            var displayUrl = url.Length &gt; (Console.BufferWidth - 10)<br/>                ? $"{url.Substring(0, Console.BufferWidth - 10)}..."<br/>                : url;<br/>            Console.Write(displayUrl);</span><span id="c6e3" class="mg kv in mc b gy ml mi l mj mk">            HttpResponseMessage response;</span><span id="0088" class="mg kv in mc b gy ml mi l mj mk">            try<br/>            {<br/>                response = await _httpClient.GetAsync(url);<br/>            }<br/>            catch (HttpRequestException ex)<br/>            {<br/>                urls[url] = -1;</span><span id="53bc" class="mg kv in mc b gy ml mi l mj mk">                Console.ForegroundColor = ConsoleColor.Red;<br/>                Console.WriteLine($" [{ex.Message}]");<br/>                Console.ResetColor();<br/>                continue;<br/>            }</span><span id="dd99" class="mg kv in mc b gy ml mi l mj mk">            urls[url] = (int)response.StatusCode;</span><span id="6b67" class="mg kv in mc b gy ml mi l mj mk">            if (response.IsSuccessStatusCode)<br/>            {<br/>                if (verbose)<br/>                {<br/>                    Console.ForegroundColor = ConsoleColor.Green;<br/>                    Console.WriteLine($" [{(int)response.StatusCode}]");<br/>                    Console.ResetColor();<br/>                }<br/>                else<br/>                {<br/>                    // Clear the current line<br/>                    Console.SetCursorPosition(0, Console.CursorTop);<br/>                    Console.Write(new string(' ', Console.BufferWidth - 1));<br/>                    Console.SetCursorPosition(0, Console.CursorTop);<br/>                }<br/>            }<br/>            else<br/>            {<br/>                // Write the error code and exit the loop early<br/>                Console.ForegroundColor = ConsoleColor.Red;<br/>                Console.WriteLine($" [{(int)response.StatusCode}]");<br/>                Console.ResetColor();<br/>                continue;<br/>            }</span><span id="db31" class="mg kv in mc b gy ml mi l mj mk">            // Exit early if we are not recursing unless we are checking the starting URL<br/>            if (!recurse &amp;&amp; url != startingUrl)<br/>                continue;</span><span id="07be" class="mg kv in mc b gy ml mi l mj mk">            // Exit early if the URL is external or if the content is not HTML<br/>            if (!IsInternalUrl(url) || !response.Content.Headers.ContentType.MediaType.StartsWith("text/html"))<br/>                continue;</span><span id="5821" class="mg kv in mc b gy ml mi l mj mk">            try<br/>            {<br/>                // If we made it this far, we will parse the HTML for links<br/>                var html = await response.Content.ReadAsStringAsync();</span><span id="b0e9" class="mg kv in mc b gy ml mi l mj mk">                // We add each link to the dictionary with a status code of 0. Since<br/>                // we are using a dictionary, URLs that are already checked or slated<br/>                // to be checked will be ignored.<br/>                GetUrlsFromHtml(html).ForEach(x =&gt; urls.TryAdd(x, 0));<br/>            }<br/>            catch<br/>            {<br/>                Console.WriteLine(url);<br/>                Console.WriteLine($"\tUnable to parse HTML.");<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="5998" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä¸€äº›æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…çš„èƒŒæ™¯å°†æ˜¯å¾ˆå¥½çš„ï¼Œå¯¹ä¸å¯¹ï¼Ÿè¿™æ˜¯æˆ‘åšçš„ä¸€ä¸ªåä¸º<a class="ae kt" href="https://github.com/amoscardino/linky" rel="noopener ugc nofollow" target="_blank"> Linky </a>çš„å°é¡¹ç›®çš„ä¸»è¦æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œç”¨äºæ‰«æç½‘ç«™å¹¶å°è¯•è¯†åˆ«æ–­å¼€çš„é“¾æ¥ã€‚æˆ‘åœ¨è¿™é‡Œçœç•¥äº†ä¸€äº›åŠ©æ‰‹æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨éœ€è¦é‡æ„çš„å¤§æ–¹æ³•ä¸Šã€‚</p><p id="c4f4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬è¯•ç€ç¡®å®šä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œæœ€å¤šæœ‰4å±‚åµŒå¥—ã€‚è¿™å¾ˆç³Ÿç³•ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬çš„ä¸»è¦ç›®æ ‡ã€‚è¿˜æœ‰ä¸€äº›è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ¨¡æ¿ä»£ç å¯ä»¥è¢«æŠ½è±¡æ‰ã€‚è¿™ä¸ä¼šå¯¹æˆ‘ä»¬çš„å¤æ‚åº¦è¯„åˆ†æœ‰å¤ªå¤§å¸®åŠ©ï¼Œä½†æ˜¯ä¼šä½¿æ–¹æ³•æ›´å®¹æ˜“é˜…è¯»ã€‚</p><p id="f4aa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æˆ‘è®¡ç®—å‡ºè®¤çŸ¥å¤æ‚æ€§å¾—åˆ†ä¸º31ã€‚SonarQubeå»ºè®®æ–¹æ³•ä¸è¦è¶…è¿‡15ä¸ªã€‚</p><p id="bf8a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¯ä»¥åšå“ªäº›æ”¹å˜æ¥é™ä½è¿™ä¸ªåˆ†æ•°ï¼Ÿæˆ‘å°†é¦–å…ˆæå–<strong class="jx io"> <em class="mm">å¤§foreach </em> </strong>å¾ªç¯å†…å®¹ä½œä¸ºæ–°æ–¹æ³•ã€‚è¿™å°†å‡å°‘2ä¸ªå¾ªç¯ä¸­çš„åµŒå¥—ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ã€‚ç„¶åï¼Œæˆ‘ä¼šå°†å„ç§æ§åˆ¶å°è¾“å‡ºæå–åˆ°ä¸€äº›æ–°æ–¹æ³•ä¸­ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å¯ä»¥æå–ä¸€äº›æ§åˆ¶æµä¸­æ–­ï¼Œè¿›ä¸€æ­¥å‡å°‘åµŒå¥—ã€‚</p><p id="2637" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸€åˆ‡æ˜¯å¦‚ä½•å½¢æˆçš„:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="638a" class="mg kv in mc b gy mh mi l mj mk">public async Task ParseAsync(string startingUrl, bool recurse = false, bool verbose = false)<br/>{<br/>    _startingUrl = CleanUrl(startingUrl);<br/>    _rootUrl = new Uri(_startingUrl).GetLeftPart(UriPartial.Authority);<br/>    _recurse = recurse;<br/>    _verbose = verbose;</span><span id="37a1" class="mg kv in mc b gy ml mi l mj mk">    var urls = new Dictionary&lt;string, int&gt;();<br/>    urls.Add(_startingUrl, 0);</span><span id="d168" class="mg kv in mc b gy ml mi l mj mk">    while (urls.Any(x =&gt; x.Value == 0))<br/>    {<br/>        // Grab any URLs from the dictionary that we have not checked. If we are recursing,<br/>        // new URLs will be added with a status code of 0 and we will pick them up on the<br/>        // next pass.<br/>        var urlsToProcess = urls.Where(x =&gt; x.Value == 0).Select(x =&gt; x.Key).ToList();</span><span id="6ed7" class="mg kv in mc b gy ml mi l mj mk">        foreach (var url in urlsToProcess)<br/>            await ProcessUrlAsync(url, urls);<br/>    }<br/>}</span><span id="15e5" class="mg kv in mc b gy ml mi l mj mk">private async Task ProcessUrlAsync(string url, Dictionary&lt;string, int&gt; urls)<br/>{<br/>    DisplayUrl(url);</span><span id="76c6" class="mg kv in mc b gy ml mi l mj mk">    HttpResponseMessage response;</span><span id="1ce2" class="mg kv in mc b gy ml mi l mj mk">    try<br/>    {<br/>        response = await _httpClient.GetAsync(url);<br/>    }<br/>    catch (HttpRequestException ex)<br/>    {<br/>        urls[url] = -1;</span><span id="59b5" class="mg kv in mc b gy ml mi l mj mk">        DisplayErrorCode(ex.Message);<br/>        return;<br/>    }</span><span id="dfad" class="mg kv in mc b gy ml mi l mj mk">    urls[url] = (int)response.StatusCode;</span><span id="3de7" class="mg kv in mc b gy ml mi l mj mk">    if (response.IsSuccessStatusCode)<br/>        DisplaySuccessCode(urls[url]);<br/>    else<br/>    {<br/>        // Write the error code and exit the loop early<br/>        DisplayErrorCode(urls[url].ToString());<br/>        return;<br/>    }</span><span id="6e48" class="mg kv in mc b gy ml mi l mj mk">    // Exit early if we are not recursing unless we are checking the starting URL<br/>    if (!_recurse &amp;&amp; url != _startingUrl)<br/>        return;</span><span id="988b" class="mg kv in mc b gy ml mi l mj mk">    // Exit early if the URL is external or if the content is not HTML<br/>    if (!IsInternalUrl(url) || !response.Content.Headers.ContentType.MediaType.StartsWith("text/html"))<br/>        return;</span><span id="2cb2" class="mg kv in mc b gy ml mi l mj mk">    try<br/>    {<br/>        // If we made it this far, we will parse the HTML for links<br/>        var html = await response.Content.ReadAsStringAsync();</span><span id="0c49" class="mg kv in mc b gy ml mi l mj mk">        // We add each link to the dictionary with a status code of 0. Since<br/>        // we are using a dictionary, URLs that are already checked or slated<br/>        // to be checked will be ignored.<br/>        GetUrlsFromHtml(html).ForEach(x =&gt; urls.TryAdd(x, 0));<br/>    }<br/>    catch<br/>    {<br/>        Console.WriteLine(url);<br/>        Console.WriteLine($"\tUnable to parse HTML.");<br/>    }<br/>}</span><span id="306b" class="mg kv in mc b gy ml mi l mj mk">private void DisplayUrl(string url)<br/>{<br/>    var displayUrl = url.Length &gt; (Console.BufferWidth - 10)<br/>        ? $"{url.Substring(0, Console.BufferWidth - 10)}..."<br/>        : url;</span><span id="0ab1" class="mg kv in mc b gy ml mi l mj mk">    Console.Write(displayUrl);<br/>}</span><span id="86e0" class="mg kv in mc b gy ml mi l mj mk">private void DisplaySuccessCode(int statusCode)<br/>{<br/>    if (_verbose)<br/>    {<br/>        Console.ForegroundColor = ConsoleColor.Green;<br/>        Console.WriteLine($" [{statusCode}]");<br/>        Console.ResetColor();<br/>    }<br/>    else<br/>    {<br/>        // Clear the current line<br/>        Console.SetCursorPosition(0, Console.CursorTop);<br/>        Console.Write(new string(' ', Console.BufferWidth - 1));<br/>        Console.SetCursorPosition(0, Console.CursorTop);<br/>    }<br/>}</span><span id="d324" class="mg kv in mc b gy ml mi l mj mk">private void DisplayErrorCode(string errorCode)<br/>{<br/>    Console.ForegroundColor = ConsoleColor.Red;<br/>    Console.WriteLine($" [{errorCode}]");<br/>    Console.ResetColor();<br/>}</span></pre><h2 id="744a" class="mg kv in bd kw nh ni dn la nj nk dp le kg nl nm li kk nn no lm ko np nq lq nr bi translated">æˆ‘ä»¬è¡¨ç°å¦‚ä½•ï¼Ÿ</h2><ul class=""><li id="6fe5" class="mt mu in jx b jy ls kc lt kg nt kk nu ko nv ks ns mz na nb bi translated">ä¸»æ–¹æ³•ï¼Œ<strong class="jx io"> <em class="mm"> ParseAsync </em> </strong>ç°åœ¨çš„åˆ†å€¼æ˜¯3ã€‚ğŸ‰</li><li id="36c2" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated"><strong class="jx io"><em class="mm">processurlsync</em></strong>æ˜¯ç°åœ¨æœ€å¤§çš„æ–¹æ³•ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åµŒå¥—åœ¨ä¸¤ä¸ªå¾ªç¯ä¸­ï¼Œæ‰€ä»¥å¾—åˆ†åªæœ‰7ã€‚ğŸ‰ğŸ‰</li><li id="bdfd" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated"><strong class="jx io"> <em class="mm"> DisplayUrl </em> </strong>å’Œ<strong class="jx io"><em class="mm">display success code</em></strong>å„1åˆ†ã€‚<strong class="jx io"><em class="mm">display error code</em></strong>å¾—åˆ†ä¸º0ã€‚</li><li id="5944" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks ns mz na nb bi translated">ä¸€äº›å‚æ•°ç°åœ¨è¢«åˆ†é…ç»™ç§æœ‰å­—æ®µã€‚è¿™å¯¹åˆ†æ•°æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯ä¿æŒäº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦åˆ°å¤„ä¼ é€’å®ƒä»¬ã€‚</li></ul><p id="34c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä»åŠŸèƒ½ä¸Šè®²ï¼Œä»£ç çš„æ‰§è¡Œå’Œè¾“å‡ºä¸ä»¥å‰å®Œå…¨ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬å¦‚ä½•æ„å»ºæˆ‘ä»¬æ­£åœ¨åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬åˆ›å»ºäº†æ›´å°ã€æ›´é›†ä¸­çš„æ–¹æ³•ï¼Œæ›´å®¹æ˜“ç†è§£ï¼Œå› æ­¤ä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤ã€‚è®¤çŸ¥å¤æ‚æ€§å¸®åŠ©æˆ‘ä»¬ç¡®å®šæ–¹æ³•ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†åœ¨å“ªé‡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æœ€éœ€è¦çš„åœ°æ–¹è¿›è¡Œé‡æ„ã€‚</p></div></div>    
</body>
</html>