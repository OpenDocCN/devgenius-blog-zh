<html>
<head>
<title>How to ease your pain writing Unit tests in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何减轻在 Swift 中编写单元测试的痛苦</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-ease-your-pain-writing-unit-tests-in-swift-fcf84bab765b?source=collection_archive---------11-----------------------#2022-08-11">https://blog.devgenius.io/how-to-ease-your-pain-writing-unit-tests-in-swift-fcf84bab765b?source=collection_archive---------11-----------------------#2022-08-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9b00f9401b3dfbc26210bd0e897278e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjrbSz_iibK2ZslXYIKoKg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片由<a class="ae jz" href="https://www.freeimages.com/photo/busy-businessman-2-1237011" rel="noopener ugc nofollow" target="_blank">freeimages.com</a>提供</figcaption></figure><p id="35fd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我知道开发人员的一个假设，他们意识到编写单元测试对于中大型项目是至关重要的，尽管他们认为这是一个非常烦人和耗时的过程。在这里，我想谈谈一些技巧/工具，它们不仅能帮助你减少编写测试的时间，还能提高可读性和可伸缩性。</p><h1 id="84cd" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">自动生成模拟</h1><p id="4863" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">当您开始编写测试但不知道自动模拟生成时，最烦人的部分是手动编写它们。在最坏的情况下，您将陷入创建无限数量的类/方法/变量并按顺序支持它们的困境。对于我们的幸福，有一些美好的工具——资源。</p><p id="b2ea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">互联网上有很多不同的 sourcery 模板实现。你可以从 Sourcery Github 本身的自述中提到的<a class="ae jz" href="https://github.com/krzysztofzablocki/Sourcery#quick-mocking-intro--getting-started-video" rel="noopener ugc nofollow" target="_blank">这个</a>开始。主要思想是，您只需标记需要的协议和您想要模拟的类，每次触发应用程序构建或 bash 命令时，模拟都会自动创建和更新。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="630a" class="mk kz in mg b gy ml mm l mn mo">//sourcery: AutoMockable<br/>protocol MyServiceProtocol { <br/>    func fetchItems() <br/>}</span></pre><h1 id="3955" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用样本函数</h1><p id="44ee" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">另一个问题是模仿一些数据，尤其是你的类型的实例。对于像 dto 这样的类，你可以创建 JSONs 并使用<strong class="kc io"> <em class="mp"> JSONDecoder </em> </strong>解析它们:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="76c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，你可能不希望为你的所有类型做可解码的一致性。在这种情况下，有一些很好的方法——采样器。这个想法非常简单:您为想要创建的每个字段创建一些带有默认参数的静态函数。如果您只需要一个不同的字段值，您只需传递这个字段:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="55e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里有一个库，允许你自动创建这个采样器！</p><h1 id="7810" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">快速/灵活的用法</h1><p id="474f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在 swift 中有两个帮助你编写单元测试的顶级框架— <a class="ae jz" href="https://github.com/Quick/Quick" rel="noopener ugc nofollow" target="_blank"> Quick </a>和<a class="ae jz" href="https://github.com/Quick/Nimble" rel="noopener ugc nofollow" target="_blank"> Nimble </a>与默认的 XCTest 框架相比，它们有很多好处。我认为最重要的是:</p><ul class=""><li id="533a" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">声明性测试的结构—快速</li><li id="6233" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">清晰可读的断言函数——敏捷</li></ul><p id="2e60" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我会给你一些用 XCTest 和 Quick/Nimble 编写的简短例子，这样你就可以自己比较了。</p><h1 id="c47c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结构示例</h1><p id="5485" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">快速/敏捷:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="f744" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">XCTest:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="f76b" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">写入异步断言</h1><p id="ee4b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">快速/敏捷:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="a08e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">XCTest:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="8d32" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">快照测试</h1><p id="53d7" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在 iOS 项目中，我们通常根本不测试视图层，否则它看起来会很奇怪。最合理的情况是测试正确显示所有内容的视图。最好的方法是编写快照测试。它基本上是拍摄你的视图，并将其与你提供的完美参考的每个像素进行比较。有很多框架可以帮助你编写快照测试，我将只列出其中最流行的:</p><ul class=""><li id="6a3b" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">GitHub-point freeco/swift-snapshot-testing:📸令人愉快的快速快照测试。</li><li id="c639" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><a class="ae jz" href="https://github.com/uber/ios-snapshot-test-case" rel="noopener ugc nofollow" target="_blank">GitHub-Uber/iOS-Snapshot-test-case:iOS 的 Snapshot view 单元测试</a></li></ul><h1 id="c5f7" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">摘要</h1><p id="d6c8" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">尽管安装和学习上面提到的工具和方法肯定会花一些时间，但您最终会习惯它，编写更好的测试代码，并可能编写自己的助手来使这个过程变得更容易和有趣😎</p></div></div>    
</body>
</html>