<html>
<head>
<title>Slowly changing dimensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">尺寸缓慢变化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/slowly-changing-dimensions-55645ff716be?source=collection_archive---------5-----------------------#2022-10-02">https://blog.devgenius.io/slowly-changing-dimensions-55645ff716be?source=collection_archive---------5-----------------------#2022-10-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/818b465169666725b952ea43becec0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*20l_6RTgvsqnHiTvgQcuaQ.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">照片 1</figcaption></figure><p id="c3b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi kt translated"><span class="l ku kv kw bm kx ky kz la lb di">S</span>CD——缓变尺寸由<a class="ae lc" href="https://pl.wikipedia.org/wiki/Ralph_Kimball" rel="noopener ugc nofollow" target="_blank">T3】金博尔 T5<strong class="jx io">于 1995 年</strong>推出。理论上维度应该是静态的，但实际上它们往往不是。在我们构建数据仓库之前，我们应该仔细思考并与他人(<strong class="jx io"> IT 团队、业务用户</strong>)协商<strong class="jx io">可能会改变</strong>维度表<strong class="jx io">中的</strong>。</a></p><p id="ef6a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> SCD 有<strong class="jx io"> 4 </strong>种类型:</strong></p><h2 id="5d16" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated"><strong class="ak">类型 0:原始</strong></h2><p id="674e" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">该解决方案的特点:</p><ul class=""><li id="eb69" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">假设不会有任何变化(通常是日期表)</li><li id="8ec4" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">这些表中的值被称为“原始值”,您可以确定它们不会改变</li></ul><p id="716a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">带日期的示例表:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mp"><img src="../Images/f09dbb2d9fac1337afae224c3282dcb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWYCu4b6Hx97oyHf4lklag.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">日期表</figcaption></figure><h2 id="afcc" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">类型 1:覆盖</h2><p id="3459" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">该解决方案的特点:</p><ul class=""><li id="3438" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">新值会覆盖旧值</li><li id="2ccc" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">变更历史未知</li></ul><p id="5f4b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看下面的例子:</p><ol class=""><li id="a61e" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks my mh mi mj bi translated"><strong class="jx io">产品表</strong>初始状态</li></ol><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mz"><img src="../Images/ec42eb8bf12b64d4083f9d5229693ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC3a2CmzNwj5MsnG6KWySQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">产品表</figcaption></figure><p id="f4bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.新的要求来了——产品<strong class="jx io">巧克力奶 0.5 </strong>现在将有一个新的名字——<strong class="jx io">甜巧克力奶 0.5 升</strong>，类别也需要改变，它将不再是<strong class="jx io">乳制品</strong>而是<strong class="jx io">糖果。</strong></p><p id="dab2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.<strong class="jx io">应用更改后的产品表</strong>:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi na"><img src="../Images/5c7825784dc6ba0100cedb57116206bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgR3mz1Xbcp3Jqgo4iCt1w.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">变更后的产品表</figcaption></figure><p id="4838" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此解决方案的潜在问题:</p><ul class=""><li id="724d" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">如果我们在 BI  ( <strong class="jx io"> Tableau，Power BI 等中有一些<strong class="jx io">可视化。)</strong>汇总数据—(汇总每个类别的收入、每个类别的平均收入等。)他们会受到影响。乳制品的总价值将会降低，而糖果的总价值将会提高。</strong></li><li id="1d43" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">一些 SQL 查询可能会中断。假设您有一个 sql 视图，<strong class="jx io">在<strong class="jx io">product _ name = Chocolate Milk 0.5l</strong>上过滤</strong>一些值。但是名为<strong class="jx io">巧克力牛奶 0.5l </strong>的产品已经不存在了。这可能会在进一步的数据分析/数据处理中导致错误。</li></ul><h2 id="b64c" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">类型 2:新行</h2><p id="0866" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">该解决方案的特点:</p><ul class=""><li id="41d3" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">向维度表添加附加行</li><li id="33f4" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">保留表中的更改历史</li><li id="0004" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">给出了最大范围的可能性</li><li id="6e87" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">抵抗频繁和不可预测的变化</li></ul><p id="a3a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，产品表<strong class="jx io"> </strong>将保留两列<strong class="jx io">巧克力奶 0.5l </strong>和类别<strong class="jx io">乳制品</strong>以及新添加的列<strong class="jx io">甜巧克力奶 0.5l </strong>和类别<strong class="jx io">糖果</strong>。像这样:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nb"><img src="../Images/7257eda49a55cd488767de434e2e7755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KbpYWDDiT6qMXJ5Yj1Mpg.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">产品表</figcaption></figure><p id="ea90" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种方法的缺点是什么？让我们看看下面的<strong class="jx io">事实表。</strong></p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nc"><img src="../Images/51e0414417730b8ab2c18e22fa1a0559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hj-Ad3BrEvQCRxxy1wOz8g.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">事实表</figcaption></figure><p id="8f3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">id 为 2 的交易用于类别为<strong class="jx io">乳制品</strong>的<strong class="jx io">巧克力牛奶 0.5l </strong>，id 为<strong class="jx io"> 4 </strong>的交易用于新类别为<strong class="jx io">糖果的<strong class="jx io">甜巧克力牛奶 0.5l </strong>。</strong>像这样:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nd"><img src="../Images/65c68703553fb1455025c567475e6f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pE-jpkA4DKsPFkwglSQpGA.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">事实和产品</figcaption></figure><p id="b8d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，将维护两种状态下的产品信息。</p><p id="82cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是正如您可能注意到的，这种解决方案并不理想。让我们再来看看这张表:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nb"><img src="../Images/7257eda49a55cd488767de434e2e7755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KbpYWDDiT6qMXJ5Yj1Mpg.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">产品表</figcaption></figure><p id="1ac9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你觉得这里有什么问题吗？算独特产品呢？基本上，如果我们计算列<strong class="jx io"> product_name </strong>中的唯一值，我们将得到 4，但这不是真的，我们有<strong class="jx io"> 3 个唯一产品。</strong></p><p id="03ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了统计独特的产品，我们需要添加一个名为<strong class="jx io"> product_key </strong>的新列</p><p id="a1b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该列将为<strong class="jx io">自然关键字</strong>，<strong class="jx io">追加关键字</strong>为<strong class="jx io"> </strong>当然<strong class="jx io"> product_id </strong>已经存在于<strong class="jx io">表中。S </strong> QL 键类型超出了本文的范围，但是如果你想获得更多信息，这里有内容丰富的文章。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ne"><img src="../Images/ef22bb597f33de74f5ec8233b21253db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-d3rplyGZqV67soIUB8YPQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">带有产品密钥的产品表</figcaption></figure><p id="8d89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，为了获得列<strong class="jx io"> product_key </strong>中的唯一元素计数，我们将使用以下查询:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nf"><img src="../Images/30b66de7c4b554c616dc8f613b54e5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwsyrChy5zNcvKw3JOJsAg.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">示例查询</figcaption></figure><p id="6f18" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们能做得更好吗？我们当然可以。</p><p id="d35d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用我们现在的方法:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ne"><img src="../Images/ef22bb597f33de74f5ec8233b21253db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-d3rplyGZqV67soIUB8YPQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">产品表</figcaption></figure><p id="2ce3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们无法确定当前正在使用哪个 product_id。对此的解决方案可能是添加<strong class="jx io"> 2 个额外的列:</strong></p><ul class=""><li id="3978" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated"><em class="ng">添加日期</em> —添加产品的日期</li><li id="78a8" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated"><em class="ng"> exp_date </em> —删除/更改产品的日期</li></ul><p id="0206" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以这个表现在看起来像这样:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nh"><img src="../Images/d64b3b3b0349b1f451c2f45cf5c77790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_M7sguFpxfpIx2rB-sLYJw.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">产品表添加日期/到期日期</figcaption></figure><p id="61b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果产品目前正在使用中，添加过期日期(此处称为 exp_date)作为未来的某个<strong class="jx io">日期</strong>被认为是<strong class="jx io">最佳实践</strong>，此处为 2100–01–01。</p><p id="0f34" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除了使这个表更容易使用之外，我们还可以添加一个名为<strong class="jx io"> is_current </strong>的列，例如，它将存储布尔值 True/False，所以它看起来像这样:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ni"><img src="../Images/06f440c8e01dd7134d6a810e1b67ac19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCq-hR2iqzr2xOKIezIx0g.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">带有 is_current 的产品表</figcaption></figure><h2 id="21dd" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">类型 3:附加属性</h2><p id="9f08" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">该解决方案的特点:</p><ul class=""><li id="aa0c" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">我们添加了<strong class="jx io">额外的列</strong>，而不是像类型 2 那样添加额外的行</li><li id="9722" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">用于一次重大且可预测的变更</li><li id="7099" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">这种解决方案不适合频繁的或者不可预测的变化——在这种情况下是类型 2 规则。</li><li id="3d0f" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">最不频繁类型</li></ul><p id="71a8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3 型相当少见，但不代表不能用。让我们看一下这个例子。查看下面的地区表:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nj"><img src="../Images/5eae9434bd62494a0782821698af1ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYAnSHbRALZ5gVhl0bekTQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">初始状态的区域</figcaption></figure><p id="1c09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如你所见，有两个独特的区域——美国东部(俄亥俄州)和欧洲(华沙)。让我们想象一下，业务经理已经决定他们需要重组区域结构。欧洲的新区域将被创建——<strong class="jx io">欧洲(柏林)</strong>，它在此之前是<strong class="jx io">欧洲(华沙)</strong>的一部分。我们的区域表将如下所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nk"><img src="../Images/62fa362175266a650b4a2ecbebeae943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ks3GgIJdll70pHx-BUcvwg.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">欧洲地区(柏林)</figcaption></figure><p id="5c71" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，现在区域的历史得到了维护——如果我们想要在重组没有发生的情况下分析数据，我们可以很容易地使用列<strong class="jx io"> Prev_region </strong>中的值。</p><p id="b87f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ng">注意:</em>您还可以添加<strong class="jx io">多个属性</strong>(列)来维护历史记录——但是保留数百个属性并不是一个好主意，在这种情况下，您应该考虑不同的方法。</p><h2 id="b15d" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">总结:</h2><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nl"><img src="../Images/9c2d6813913a463a1ad73286996a9300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKclir_lD8DtaFGLFynkEQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">对比图表</figcaption></figure><p id="b57b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">对于大多数情况，类型 2 </strong>应该是我们的<strong class="jx io">默认方法</strong>，无论如何，您可以混合实例 1 和 2 的 SCD 类型。只是先和业务用户讨论一下，这样你就知道有哪些用例了。</p><h2 id="24ec" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">进一步阅读:</h2><p id="1993" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">以下是一些绝对值得一看的资料来源:</p><p id="8fa7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Ralph Kimball 的《数据仓库工具包:维度建模完全指南》</p><p id="3768" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae lc" href="https://www.udemy.com/course/data-warehouse-the-ultimate-guide/" rel="noopener ugc nofollow" target="_blank">数据仓库——尼古拉·舒勒的终极指南</a>伟大历程</p></div></div>    
</body>
</html>