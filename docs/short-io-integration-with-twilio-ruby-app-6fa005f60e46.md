# Short.io ä¸ Twilio â€” Ruby åº”ç”¨ç¨‹åºçš„é›†æˆ

> åŸæ–‡ï¼š<https://blog.devgenius.io/short-io-integration-with-twilio-ruby-app-6fa005f60e46?source=collection_archive---------15----------------------->

Twilio æ˜¯ä¸€ç§ç”¨äºå‘é€çŸ­ä¿¡çš„æµè¡ŒæœåŠ¡ã€‚æœ‰æ—¶éœ€è¦åœ¨è¿™äº›æ¶ˆæ¯ä¸­å‘é€ URL ç„¶è€Œï¼Œè¿™äº›ç½‘å€ä¼šå¾ˆå¿«å˜é•¿ï¼Œæ‰€ä»¥äººä»¬å–œæ¬¢åœ¨å‘é€çŸ­ä¿¡ä¹‹å‰ä½¿ç”¨ç½‘å€ç¼©å†™æœåŠ¡æ¥ç¼©çŸ­ç½‘å€ã€‚Short.io æ˜¯ä¸€ä¸ª**å“ç‰Œçš„**ç½‘å€ç¼©å†™æœåŠ¡ã€‚**æ— å“ç‰Œçš„** URL(å³ Bitlyã€TinyURL å’Œå…¶ä»–)æ˜¯æœ‰é£é™©çš„ï¼Œå› ä¸ºä¸€äº›ç§»åŠ¨è¿è¥å•†(å¨ç‘æ£®ğŸ‘€æˆ‘çœ‹ä½ )ä¼š**å±è”½åŒ…å«æ— å“ç‰ŒçŸ­é“¾æ¥çš„çŸ­ä¿¡**ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ç§æ–¹æ³•æ¥é›†æˆ short.io å’Œ Twilioï¼Œä»¥å‘é€å¸¦æœ‰çŸ­é“¾æ¥çš„ SMS æ¶ˆæ¯ã€‚ä»£ç ç¤ºä¾‹æ˜¯ä½¿ç”¨ vanilla Ruby å®Œæˆçš„ï¼›ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•ä¹Ÿå¯ä»¥è¢«å¸¦åˆ°ä¸€ä¸ª **Rails åº”ç”¨**ä¸­ã€‚

![](img/ce66c3e5dc45343d6be11e7b5e542c9a.png)

ç…§ç‰‡ç”±[Adem may](https://unsplash.com/@ademay?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

# **é«˜çº§æ¦‚è¿°**

è§£é‡Šç¨‹åºæ¶æ„çš„å›¾è¡¨ã€‚

![](img/cc7a417286d936e1dae10d2e8fff46ce.png)

Twilio â€” short.io ä¸ Ruby App çš„é›†æˆ

1.  æˆ‘ä»¬çš„æœåŠ¡å™¨å‘ short.io API å‘é€åŒ…å«åŸå§‹ URL çš„ **POST** è¯·æ±‚
2.  short.io å‘é€å›ä¸€ä¸ªåŒ…å«çŸ­ URL ç­‰ä¿¡æ¯çš„å“åº”
3.  æˆ‘ä»¬çš„æœåŠ¡å™¨å‘ Twilio å‘é€ä¸€ä¸ª **POST** è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«å‘é€æ–¹å·ç ã€æ¥æ”¶æ–¹å·ç å’Œ SMS æ¶ˆæ¯(å¸¦æœ‰çŸ­ url)ç­‰ä¿¡æ¯
4.  Twilio API æœåŠ¡å™¨å°†å°è¯•å‘æ¥æ”¶æ–¹çš„æ‰‹æœºå‘é€çŸ­ä¿¡
5.  Twilio å‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‘å›ä¸€ä¸ªå“åº”ï¼ŒæŒ‡ç¤ºæˆåŠŸæˆ–å¤±è´¥

# **ç¬¬ä¸‰æ–¹å®çŸ³â€œå¿…éœ€â€**

å®é™…ä¸Šï¼Œè¿™ä¸ªå®ç°å¹¶ä¸çœŸæ­£â€œéœ€è¦â€ç¬¬ä¸‰æ–¹ gemã€‚ä»¥ä¸‹è¿™äº›å®çŸ³å°†ä½¿å¼€å‘å˜å¾—æ›´ç®€å•ã€‚

1.  httparty:è®©ç½‘ç»œè¯·æ±‚å˜å¾—æ›´ç®€å•ã€æ›´å¹²å‡€ã€‚åƒå…¶ä»–è®¸å¤šå®çŸ³ä¸€æ ·ï¼Œè¿™ä¸ªå®çŸ³ä¸º Ruby ä¸­å†…ç½®çš„ **Net::HTTP** ç±»æä¾›äº†ä¸€ä¸ªåŒ…è£…ã€‚
2.  twilio-ruby:ç”± twilio åˆ›å»ºçš„å¸®åŠ©å‡½æ•°åº“ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“åœ°ä½¿ç”¨ Twilio çš„ API
3.  æˆ‘ä½¿ç”¨è¿™ä¸ª gem æ¥åˆ›å»ºä¸€ä¸ª. env æ¥å­˜å‚¨/è®¿é—® API å‡­è¯

# **æ„å»ºè¯·æ±‚**

ä¸ API é€šä¿¡æœ¬è´¨ä¸Šå°±æ˜¯å‘é€å¸¦æœ‰æ­£ç¡®æ ‡é¢˜çš„è¯·æ±‚å¹¶æœŸå¾…å“åº”ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†å¦‚ä½•æ„é€ å¯¹ short.io çš„è¯·æ±‚

![](img/7df6c8efaefce047f97476891229f7ce.png)

ç®€ç§° io çš„è¯·æ±‚ç»“æ„

ä»[è¿™é‡Œ](https://developers.short.io/docs/cre)è·å–ä½ çš„ short.io API å¯†åŒ™ã€‚å¯¹äºå‡ ä½•ä½“ï¼Œè¡¨ä¸­ä»…åˆ—å‡ºäº†æ‰€éœ€çš„å‚æ•°ã€‚ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ›´å¤š[é€‰é¡¹](https://developers.short.io/reference/linkspost)ã€‚

ä½¿ç”¨ twilio-ruby gem çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œå®ƒå…è®¸æˆ‘ä»¬ç»•è¿‡é…ç½®å’Œç›´æ¥ä¸ç½‘ç»œè¯·æ±‚åŠå…¶æŠ¥å¤´äº¤äº’çš„æŠ˜ç£¨ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºæ›´é‡è¦çš„äº‹æƒ…ï¼Œå¦‚è®¾ç½®èº«ä½“ã€‚ä¸è¿‡ï¼Œå¦‚æœä½ æƒ³æ‰‹åŠ¨åšäº‹ï¼Œæˆ‘ä¹Ÿæä¾›äº†ä¸‹é¢çš„è¡¨æ ¼ã€‚

![](img/698184c4759fb9d193ea941af3752d6a.png)

Twilio çš„è¯·æ±‚ç»“æ„

è¿™é‡Œçš„æˆæƒä½¿ç”¨[åŸºæœ¬æˆæƒ](https://en.wikipedia.org/wiki/Basic_access_authentication)ã€‚è¯·åŠ¡å¿…åœ¨æ­¤å¤„è·å¾—æ‚¨çš„ Twilio è¯ä¹¦[ã€‚æ³¨æ„:æˆ‘ä»¬ä½¿ç”¨é€‰é¡¹ 2 (API å¯†é’¥)ã€‚è¿™ä¸ªé€‰é¡¹æ¯”ä½¿ç”¨ä¸»å¯†é’¥çš„ç¬¬ä¸€ä¸ªé€‰é¡¹å®‰å…¨å¾—å¤šï¼Œå› ä¸ºæ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ª API å¯†é’¥ï¼Œå¦‚æœå®ƒä»¬è¢«ç ´åï¼Œæ‚¨å¯ä»¥æ’¤é”€å®ƒä»¬ã€‚](https://www.twilio.com/docs/usage/requests-to-twilio#credentials)

[è¿™é‡Œçš„](https://www.twilio.com/docs/sms/api/message-resource#create-a-message-resource)æ˜¯ä½ ä¹Ÿå¯ä»¥ä¼ é€’çš„å¯é€‰èº«ä½“å‚æ•°åˆ—è¡¨ã€‚

å¥½æˆå¼€å§‹äº†ã€‚æˆ‘ä»¬ç°åœ¨ä¼šçœ‹åˆ°å¾ˆå¤šä»£ç ï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒã€‚æˆ‘ä¼šè¾¹èµ°è¾¹è§£é‡Šã€‚æˆ‘ä½¿ç”¨ç±»æ˜¯å› ä¸ºå®ƒç»™äº†æˆ‘ä»¬åœ¨æœªæ¥é€šè¿‡æ·»åŠ æ›´å¤šæ–¹æ³•æ¥æ‰©å±• short.io å’Œ Twilio æœåŠ¡çš„çµæ´»æ€§(ä¹Ÿè®¸æˆ‘æƒ³å¤„ç†è¯­éŸ³å‘¼å«)ã€‚

# **Short.io ç±»**

![](img/a5d1a3139ae6f8f4f6b0923fbac3bc05.png)

short.io ç±»

```
require "json"
require "httparty"
```

éœ€è¦å®çŸ³ã€‚httparty ç”¨äºå¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œjson ç”¨äºè½¬æ¢/è§£æè¯·æ±‚ä½“å’Œå“åº”ã€‚(è¿˜è®°å¾— **Content-Type** å¤´è¢«è®¾ç½®ä¸º json å—ï¼Ÿï¼Ÿï¼Ÿ)

```
attr_reader :short_url
```

è®¾ç½®ä¸€ä¸ªåä¸º short_url çš„å®ä¾‹å˜é‡æ¥å­˜å‚¨æˆ‘ä»¬çš„çŸ­ urlï¼Œå¹¶å°†å…¶è®¾ä¸ºåªè¯»ã€‚

```
include HTTParty
base_uri "https://api.short.io/"
headers "Accept" => "application/json"
headers "Content-Type" => "application/json"
```

åŒ…æ‹¬ HTTParty æ¨¡å—å’Œ set å¤´ã€‚è¯¸å¦‚ base_uriã€headersâ€¦ç­‰æ–¹æ³•æ˜¯ HTTParty çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒåŒ…å«åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­ã€‚

```
def initialize(short_domain = nil, api_key = nil)
  @short_domain = short_domain
  @short_api_key = api_key
  @short_url = nil
end
```

è¿™æ˜¯æˆ‘ä»¬çš„æ„é€ å‡½æ•°ï¼Œå®ƒè®¾ç½®æˆ‘ä»¬çš„ç±»å®ä¾‹å˜é‡ã€‚æˆ‘ä»¬ä¼ å…¥æˆ‘ä»¬çš„ short.io åŸŸåå’Œ API å¯†é’¥ã€‚

```
def create_short_url(original_url = nil)
  .....  
  Code is too long to paste here ğŸ˜…
  .....
end
```

è¿™ä¸ªå®ä¾‹æ–¹æ³•å°†æˆ‘ä»¬çš„ä¸»ä½“å’Œæˆæƒå¤´åŒ…è£…åˆ°ä¸€ä¸ªåä¸º params çš„å˜é‡ä¸­ã€‚ä½¿ç”¨ httparty å‘å‡ºå¸¦æœ‰è·¯å¾„â€œ/linksâ€å’Œå‚æ•°çš„ POST è¯·æ±‚ã€‚JSON å“åº”è¿”å›ï¼Œæˆ‘ä»¬æå– shortURL å¹¶å°†å…¶å­˜å‚¨åœ¨åä¸º short_url çš„å®ä¾‹å˜é‡ä¸­

# **Twilio ç±»**

![](img/9138c960175d1f61d0fbbcaf2ce2e614.png)

Twilio çº§

```
require "twilio-ruby"
```

éœ€è¦å®çŸ³ã€‚twilio-ruby gem æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„æœ‰ç”¨æ–¹æ³•åº“ã€‚

```
attr_writer :api_key, :api_secret, :acc_sid
```

æˆ‘ä»¬åˆ›å»ºå®ä¾‹å˜é‡æ¥å­˜å‚¨å‡­è¯ï¼›ç„¶è€Œï¼Œä¸ºäº†é¢å¤–çš„å®‰å…¨ï¼Œå®ƒä»¬åªèƒ½è¢«è®¾ç½®è€Œä¸èƒ½è¢«è¯»å–ã€‚

```
def initialize(api_key = nil, api_secret = nil, acc_sid = nil)
  @api_key = api_key
  @api_secret = api_secret
  @acc_sid = acc_sid
  @client = Twilio::REST::Client.new(api_key, api_secret, acc_sid)
end
```

æˆ‘ä»¬çš„æ„é€ å‡½æ•°è®¾ç½®å®ä¾‹å˜é‡çš„åˆå§‹å€¼ã€‚è¿˜åˆ›å»ºäº†ä¸€ä¸ª **Twilio å®¢æˆ·ç«¯**å¯¹è±¡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºå®¢æˆ·ç«¯å®ä¾‹å˜é‡ã€‚Twilio å®¢æˆ·ç«¯å¯¹è±¡å°†å…è®¸æˆ‘ä»¬å»ºç«‹ä¸ Twilio çš„è¿æ¥ï¼Œå¹¶ä¸ä»–ä»¬çš„ API æœåŠ¡è¿›è¡Œäº¤äº’ã€‚

```
def send_sms(params = nil)
  from = params[:From]
  body = params.key?(:URL) ? params[:Body] + params[:URL] : params[:Body]
  to = params[:To]
  *# returns a twilio API message object
  # refer to docs:* [*https://www.twilio.com/docs/sms/api/message-  resource#message-properties*](https://www.twilio.com/docs/sms/api/message-resource#message-properties)@client.messages.create(
    from: from,
    body: body,
    to: to
  )
end
```

åŒ…å«å¿…éœ€çš„é”®/å€¼å¯¹(:Fromï¼Œ:Bodyï¼Œ:To)çš„ params æ•£åˆ—ä¸å¯é€‰é”®ä¸€èµ·ä¼ é€’ã€‚ä¸ºäº†å‘é€ SMSï¼ŒTwilio å®¢æˆ·ç«¯å¯¹è±¡ä¸­çš„ message ç±»çš„ä¸€ä¸ªåä¸º **create** çš„å®ä¾‹æ–¹æ³•è¢« params ä¸­çš„å†…å®¹è°ƒç”¨ã€‚

æœ€æ£’çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰è¯·æ±‚å¤´å’Œè®¾ç½®ä»»ä½• API ç«¯ç‚¹ï¼Œå› ä¸º twilio-ruby åŠ©æ‰‹ä¼šåœ¨æˆ‘ä»¬åˆ›å»ºæ–°å®¢æˆ·ç«¯æ—¶åœ¨å¹•åä¸ºæˆ‘ä»¬å®Œæˆè¿™äº›å·¥ä½œã€‚

# **æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼**

æ˜¯æ—¶å€™æŠŠæ‰€æœ‰ä¸œè¥¿æ”¾åœ¨ä¸€èµ·ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„åŠ³åŠ¨æˆæœäº†ğŸ‡ã€‚åœ¨ä¸€ä¸ªåä¸º **main** çš„å•ç‹¬æ–‡ä»¶ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä»¥ä¸‹ä»£ç ã€‚

![](img/c24728ee2b31b7b876d69020fb87576c.png)

main.rb

å› ä¸ºæˆ‘ä½¿ç”¨ gem **dotenv** å°†æˆ‘çš„ API å‡­è¯å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œæ‰€ä»¥æˆ‘éœ€è¦åŠ è½½å®ƒä»¬ã€‚æˆ‘è¿˜éœ€è¦æˆ‘ä»¬çš„ short.io å’Œ Twilio ç±»ã€‚

æ¥ä¸‹æ¥ï¼Œç”¨åŸŸå’Œ API é”®å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ short.io å¯¹è±¡ã€‚æˆ‘ä»¬è°ƒç”¨ **create_short_url** å®ä¾‹æ–¹æ³•ä¼ å…¥ä¸€ä¸ªé•¿ url(è¯·ç‚¹å‡»å®ƒğŸ˜‰).

ä¸€ä¸ªæ–°çš„ Twilio å¯¹è±¡æ˜¯ç”¨ä¼ å…¥çš„ Twilio å‡­è¯åˆ›å»ºçš„ã€‚æœ€åï¼Œè°ƒç”¨ **send_sms** å®ä¾‹æ–¹æ³•ä»¥åŠ params æ•£åˆ—æ¥å‘é€æˆ‘ä»¬çš„ smsï¼ğŸ¥³ğŸ¥³ğŸ¥³

![](img/1a2d96776f5ae7149e20520dc50ab474.png)

å¸¦æœ‰çŸ­ URL çš„çŸ­ä¿¡

# èµ„æº

æœ¬æ•™ç¨‹ä¹Ÿå¯ä»¥ä½œä¸º git repo [åœ¨è¿™é‡Œ](https://github.com/xihai01/twilio-short.io-integration-ruby)è·å¾—ã€‚ä½ å¯ä»¥éšæ„ä½¿ç”¨å®ƒï¼Œå…‹éš†å®ƒï¼Œç©å®ƒã€‚å¦‚æœä½ å–œæ¬¢æˆ–å‘ç°è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·å–œæ¬¢å¹¶åˆ†äº«å®ƒï¼æ­¤å¤–ï¼Œè¯·éšæ„ç•™ä¸‹æ‚¨å¯èƒ½æœ‰çš„ä»»ä½•å»ºè®®æˆ–æ„è§ã€‚æˆ‘ä¸€å®šä¼šå›å¤æ‰€æœ‰çš„è¯„è®ºï¼

[åˆ›å»ºé“¾æ¥çš„ short.io API å‚è€ƒ](https://developers.short.io/reference/linkspost)

[Twilio SMS API å‚è€ƒ](https://www.twilio.com/docs/sms/api/message-resource#message-properties)