# 最佳实践:数据加载状态

> 原文：<https://blog.devgenius.io/best-practice-data-loading-state-b9328e2718ac?source=collection_archive---------6----------------------->

你有没有想过在 Android 应用程序中分享数据状态的最佳实践是什么？是加载，成功，失败，还是以上都不是？
本文将讨论发布数据加载状态的不同方法，最后我将展示我认为的最佳架构实践。
我还建议熟悉由 [Manuel Vivo](https://medium.com/u/3b5622dd813c?source=post_page-----b9328e2718ac--------------------------------) 和他的团队编写的[应用架构指南](https://developer.android.com/topic/architecture)，在我看来，他们对编写该指南产生了巨大的影响。介绍完毕，让我们开始吧:

![](img/d895f8a2be79ed4a618150f48b5583aa.png)

照片由 [Kostiantyn Li](https://unsplash.com/@leekos?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

## 关于混凝土数据和荷载状态建模的思考

*   我们需要哪些状态？他们的目的是什么？
*   首选的建模方法是什么:包装器，组合的还是分离的？
*   加载状态应该与数据本身紧密耦合还是松散耦合？

我们将逐步回答每个问题。首先要明白的是我们的需求。下一个表填充了符合典型应用的一些基本状态:

## 为这些场景建模的常见方法:

我相信我们大多数人都熟悉以下部分或全部模型:

1.  松散耦合来自加载状态的具体数据，例如我们可以在我们的视图模型/存储库中声明以下成员:

*注:用* `*LiveData<> / Flow<>*` *作为最适合自己的。* 这是我最不喜欢的方法，因为它容易出错:
`MyError`和`MyConcreteData`有可能同时存在吗？`MyError`能包含数据和`isLoading=true`吗？
这种架构建模方法似乎支持不期望的情况，并且由于在需要时忘记清除其中一个而可能错误地发生。我试图想出这种方法的一些积极的好处，但什么也想不出来，请告诉我一些想法。

2.紧密耦合的信息:数据、误差和载荷；

这种建模方法帮助我们确保在创建`DataWithState`对象时，我们必须考虑🖼️.的全貌这有助于我们减少错误，这很好。关于它的一个大胆的事情是，开发者可以非常灵活地构造`DataWithState`，这是优点还是缺点？你会决定的。就我个人而言，我更希望避免促成一个毫无意义的国家的建立。

3.这就引出了我们的下一个方法，包装器状态:
接下来的代码将描述`LoadState<T>`类，而`T`是我们具体数据模型的类型。

看起来，第二种方法的大部分好处都在这里，不仅如此，它**通过使用包装器方法防止了任何不合理模型的构建**。例如，我们不能将加载状态与错误一起发布。这一次，在我看来，紧密耦合更符合我们的需求。我知道`Failure`模式使我们能够创建一个`ApiError`模式和`Exception`模式，所以我们建议也要阻止它。挑战自己这样做😉。

看起来不错，让我们用一个使用示例来增加它的趣味:

我希望上面的例子能让你更好地理解。
我们已经完成了本文的第一部分，了解了建模过程背后的思想。我还想和你分享一份奖金🎁，我们可以理解为`updateMyData()`的实现会对很多类似的加载操作重复自己。有没有可能抽象出`updateMyData()`的实现？
答案是肯定的，我已经用手指为你输入了下一篇文章，它将解释如何做到这一点。 [**订阅**](https://medium.com/subscribe/@itay.c14) 接收通知。

如果你觉得我的文章有任何帮助，请**分享**它，并为它**鼓掌**。但是如果你认为我可能会用更有价值的内容给你惊喜，你可以 [**订阅**](https://medium.com/subscribe/@itay.c14) 和**关注**我来获得新内容的通知。

> 有一个伟大的一天，更大的知识和可怕的技能！

[伊塔·科恩|领英](https://www.linkedin.com/in/itay-cohen-b717b1107/)