<html>
<head>
<title>Slack Clone with React | Semantic UI | GraphQL | PostgresSQL (PART 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 React |语义 UI | GraphQL | PostgresSQL 的松弛克隆(第 5 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/slack-clone-with-react-semantic-ui-graphql-postgressql-part-5-1ef5ccb967c1?source=collection_archive---------6-----------------------#2020-09-18">https://blog.devgenius.io/slack-clone-with-react-semantic-ui-graphql-postgressql-part-5-1ef5ccb967c1?source=collection_archive---------6-----------------------#2020-09-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="23f0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">之前，我们讨论了 GraphQL 的工作原理。你可以在这里找到那篇文章。</h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/6b5d4d98a21114a61cfb9c855728821a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0XqWgevqkG_oKj5P"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">沃洛季米尔·赫里先科在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="dcfc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天，我们将开始创建我们的 Graphql 查询和变异。</p><p id="cc95" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">打开<code class="fe lp lq lr ls b">typesDefs.js</code>文件。我们需要做的第一件事是规划出我们的数据将会是什么。我们知道我们需要一个<code class="fe lp lq lr ls b">User</code>对象来表示我们项目中的一个用户，所以让我们从这里开始。</p><h1 id="d907" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">类型</h1><p id="3ba7" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">删除我们的<code class="fe lp lq lr ls b">typeDefs.js</code>文件中之前的代码，并替换为 this = &gt;</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="d321" class="mu lu in ls b gy mv mw l mx my">const { gql } = require("apollo-server");<br/>module.exports = gql`<br/>  type User {<br/>    username: String!<br/>    email: String!<br/>    password: String!<br/>  }<br/>`</span></pre><p id="dde5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，当用户需要创建团队时，我们需要创建一个<code class="fe lp lq lr ls b">Team</code>对象</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="cbcc" class="mu lu in ls b gy mv mw l mx my">const { gql } = require("apollo-server");<br/>module.exports = gql`<br/>  type Team {<br/>    owner: User!<br/>    members: [User!]!<br/>    channels: [Channel!]!<br/>  }<br/>`</span></pre><p id="ed2f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们需要<code class="fe lp lq lr ls b">Channels</code>的加入</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="0715" class="mu lu in ls b gy mv mw l mx my">const { gql } = require("apollo-server");<br/>module.exports = gql`<br/>  type Channel {<br/>    id: Int!<br/>    name: String!<br/>    public: Boolean!<br/>    messages: [Message!]!<br/>    users: [User!]!<br/>  }<br/>`</span></pre><p id="9062" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们需要能够发送和接收<code class="fe lp lq lr ls b">Messages</code> = &gt;</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="5e58" class="mu lu in ls b gy mv mw l mx my">const { gql } = require("apollo-server");<br/>module.exports = gql`<br/>  type Message {<br/>    id: Int!<br/>    text: String!<br/>    user: User!<br/>    channel: Channel!<br/>  }<br/>`</span></pre><p id="92da" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们仔细看看这些类型。</p><ul class=""><li id="f205" class="mz na in kv b kw kx kz la lc nb lg nc lk nd lo ne nf ng nh bi translated">创造它的团队？(业主道具)，队伍里有谁？(members prop)，和这个团队有什么渠道关联？(频道道具)。</li><li id="518a" class="mz na in kv b kw ni kz nj lc nk lg nl lk nm lo ne nf ng nh bi translated">我们需要知道一个用户，哪个用户正在创建团队和渠道(电子邮件，用户名，密码道具)。</li><li id="5bfa" class="mz na in kv b kw ni kz nj lc nk lg nl lk nm lo ne nf ng nh bi translated">一个频道是哪个频道(id 道具)，频道叫什么名字？(名道具)，会是公的还是私的？(公共道具)，有哪些消息(消息道具)，并列出该频道的用户(用户道具)。</li><li id="26d2" class="mz na in kv b kw ni kz nj lc nk lg nl lk nm lo ne nf ng nh bi translated">一条信息哪条信息？(id 道具)，消息说什么？(文本属性)，哪个用户发送了该消息(用户属性)，最后该消息属于哪个频道(频道属性)</li></ul><p id="2091" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后你的<code class="fe lp lq lr ls b">typeDefs.js</code>应该是这样的= &gt;</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/decd8f06e2e7c0646976b42c6ece9bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/0*26vWNlV1FTCAPn7c"/></div></figure><p id="40e9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们定义我们的查询(获取端点)和突变(POST、PUT、DELETE 端点)</p><p id="bfd4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">不过，在<code class="fe lp lq lr ls b">typeDefs.js</code>文件中，让我们添加我们的查询</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="8ee7" class="mu lu in ls b gy mv mw l mx my">type Query {<br/>    getUsers: [User!]!<br/>    getMessages: [Message!]<br/>    getUser(id: Int!): User!<br/>  }</span></pre><p id="803c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这些是我目前掌握的情况。突变看起来像= &gt;</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="9f53" class="mu lu in ls b gy mv mw l mx my">type Mutation {<br/>    createUser(username: String!, email: String!, password: String!): User<br/>    createMessage(channel_id: Int!, text: String!): Boolean<br/>    createTeam(name: String!): Boolean<br/>    createChannel(teamId: Int!, name: String!, public: Boolean = false): Boolean<br/>  }</span></pre><p id="2dfe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">仅供参考，我们只需要传递我们需要使用的参数。正如你所看到的，我们所有的突变都涉及到为现在创造一些东西。</p><p id="f1c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们现在只是定义它，让我们用解析器返回一些真实的数据，从使用<code class="fe lp lq lr ls b">createUser</code>变异创建一个用户开始。</p><h1 id="d6dc" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">下决心者</h1><p id="f98f" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">转到<code class="fe lp lq lr ls b">resolvers.js</code>文件并创建一个<code class="fe lp lq lr ls b">createUser</code>变异<em class="no">记住，命名很重要，它需要与您定义的类型查询的名称相同</em></p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="22dc" class="mu lu in ls b gy mv mw l mx my">const bcrypt = require("bcrypt");<br/>const { User } = require("../models");<br/>module.exports = {<br/>  Mutation: {<br/>      createUser: async (_, args) =&gt; {<br/>        let { username, email, password } = args;<br/>        try {<br/>        // 1. Check if user exist in DB<br/>        const getUser = await User.findOne({ where: { email: email } });<br/>        if (!getUser) {<br/>          // 2. Hash user password<br/>          password = await bcrypt.hash(password, 12);<br/>          // 3. store user in DB<br/>          const user = await User.create({<br/>            username,<br/>            email,<br/>            password<br/>          });<br/>          return user;<br/>        } else {<br/>          throw Error("User already exist");<br/>        }<br/>      } catch (err) {<br/>        return err;<br/>      }<br/>    }<br/>};</span></pre><p id="ebd3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们正在做的是用通过 args(析构数据)传递给我们的数据创建一个用户。我们使用 Sequelize 中的用户模型在数据库中创建一个用户。我希望剩下的评论能帮助你理解发生了什么。</p><p id="b4b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们在操场上测试这个端点。让您的服务器运行并转到 localhost:4000。</p><p id="50fb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">调用<code class="fe lp lq lr ls b">createUser</code>突变应该是这样的= &gt;</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi np"><img src="../Images/35c167d4cbb68f504abdfc566b5c0c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ovD5YRTufNThf8M2"/></div></div></figure><p id="bc5d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以指定类型，查询或变异。然后你选择终点。如果成功，它应该返回一个用户并在数据库中创建一个用户= &gt;</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi np"><img src="../Images/9f262fd0d948a57c3117063743166b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OZT8S5NtSS-fTczI"/></div></div></figure><p id="94a1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在检查数据库。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi nq"><img src="../Images/b407bd85e0a1b370c818a1495c8250e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JgKUEfgBAgRFEuQt"/></div></div></figure><p id="2c54" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">仅供参考，忽略第一个用户，这是我之前做的测试。但是你可以看到 JamesB 是用散列密码创建的，这很棒。</p><p id="17cc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们创造其余的突变。创建团队、渠道和信息。</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="eca4" class="mu lu in ls b gy mv mw l mx my">const bcrypt = require("bcrypt");<br/>const { Channel, Message, Team } = require("../models");<br/>module.exports = {<br/>  Mutation: {<br/>    createChannel: async (_, args) =&gt; {<br/>      try {<br/>        await Channel.create(args);<br/>        return true;<br/>      } catch (err) {<br/>        console.log(err);<br/>        return false;<br/>      }<br/>    },<br/>    createMessage: async (_, args) =&gt; {<br/>      // const channel = Channel.findOne({where: {id: args.channel_ids}})<br/>      try {<br/>        await Message.create({<br/>          ...args,<br/>          userId: 1<br/>        });<br/>        return true;<br/>      } catch (error) {<br/>        console.log(error);<br/>        return false;<br/>      }<br/>    },<br/>    createTeam: async (_, args) =&gt; {<br/>      try {<br/>        await Team.create({<br/>          ...args,<br/>          owner: 1<br/>        });<br/>        return true;<br/>      } catch (error) {<br/>        console.log(error);<br/>        return false;<br/>      }<br/>    }<br/>  }<br/>};</span></pre><p id="a4c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们的查询= &gt;</p><pre class="ke kf kg kh gt mq ls mr ms aw mt bi"><span id="a229" class="mu lu in ls b gy mv mw l mx my">const bcrypt = require("bcrypt");<br/>const { User } = require("../models");<br/>module.exports = {<br/>  Query: {<br/>    getUsers: async () =&gt; {<br/>      try {<br/>        const users = await User.findAll();<br/>        return users;<br/>      } catch (err) {<br/>        console.log(err);<br/>      }<br/>    },<br/>    getUser: async (_, { id }) =&gt; {<br/>      try {<br/>        const user = await User.findOne({ where: { id } });<br/>        return user;<br/>      } catch (error) {<br/>        console.log(error);<br/>      }<br/>    }<br/>  },<br/>}</span></pre><p id="988d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们有了用户，让我们使用我们的<code class="fe lp lq lr ls b">getUsers</code>查询来获取用户。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi np"><img src="../Images/3914a83e8f941446faf94c0cca5af098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZxyTcGViBH_7MA0T"/></div></div></figure><p id="7670" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它返回的正是我们所说的，太好了。简而言之，这些是我们将从前端调用的端点。</p><p id="b5ed" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">总的来说，你的<code class="fe lp lq lr ls b">typeDefs.js</code>文件应该看起来像这样= &gt;</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi nr"><img src="../Images/5da051c8c5f5010433a4fc12930accce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gc47VuKiOJEpPrCV"/></div></div></figure><p id="daf7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">和<code class="fe lp lq lr ls b">resolvers.js</code>文件</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi ns"><img src="../Images/f1a1e6d628657dc2a83d2729dbae4868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*Z5nvi2Jo360IMNd7"/></div></div></figure><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/d1036772f969c0951855b28a2cf36ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/0*SP6LdUuhNmMiV_pA"/></div></figure><p id="56f0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是这一个，希望这不是太令人震惊。在这个系列文章达到我目前在这个项目中的位置之前，我还有几篇文章要写。所以在那之前，如果你有任何问题或者我错过了什么，请告诉我:)</p></div></div>    
</body>
</html>