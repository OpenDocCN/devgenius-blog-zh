<html>
<head>
<title>How to Create a Terraform Custom Module for an EC2 Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为 EC2 实例创建 Terraform 定制模块</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-a-terraform-custom-module-for-an-ec2-instance-ea30a1d4b1f8?source=collection_archive---------3-----------------------#2022-03-01">https://blog.devgenius.io/how-to-create-a-terraform-custom-module-for-an-ec2-instance-ea30a1d4b1f8?source=collection_archive---------3-----------------------#2022-03-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c3c6993c0470698663f0045fe5b59d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1LHtsV4H1HwxMjMxnWPHg.png"/></div></div></figure><p id="f2d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">什么是 Terraform？<br/> <strong class="jx io"> Terraform </strong>是一款开源的基础设施代码(IaC)工具，用于自动供应、配置和管理各种云提供商的基础设施。</p><p id="f3d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">什么是 Terraform 模块？<br/>一个<strong class="jx io">地形模块</strong>是<strong class="jx io">的集合。tf </strong>配置文件放在专用目录下。有两种类型的模块<br/> 1。根模块:配置的主模块。<br/> 2。子模块:被调用以包含其资源的模块。</p><p id="daea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本项目中，我们将… <br/> 1。以<strong class="jx io"> ec2.tf </strong>模板为起点，在本地派生并克隆这个 repo，在这里创建 EC2 <a class="ae kt" href="https://github.com/LevelUpInTech/terraformec2.git" rel="noopener ugc nofollow" target="_blank">。<br/> 2。从资源块中为 EC2 创建一个定制模块，您可以将它用作可重复的基础设施。<br/> 3。将新创建的模块和<strong class="jx io"> ec2.tf </strong>文件推送到您的 repo</a></p><blockquote class="ku kv kw"><p id="459d" class="jv jw kx jx b jy jz ka kb kc kd ke kf ky kh ki kj kz kl km kn la kp kq kr ks ig bi translated"><strong class="jx io"> <em class="in">先决条件:</em></strong><br/><a class="ae kt" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank">terra form</a>已安装<br/> <a class="ae kt" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank"> AWS 帐号</a> <br/> AWS CLI 已安装<br/> <a class="ae kt" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>帐号<br/>您首选的 IDE (Cloud9)</p></blockquote><h1 id="4ae4" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">步骤 1:派生和克隆存储库</h1><p id="9777" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">使用这个<a class="ae kt" href="https://github.com/LevelUpInTech/terraformec2.git" rel="noopener ugc nofollow" target="_blank"> <em class="kx">链接</em> </a> <em class="kx">来叉库。</em></p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi me"><img src="../Images/06246ca13186dfca674298e95afc79fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*HENCtQHkO_YAndn4ALSpwA.png"/></div></figure><p id="492d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过在 IDE 终端中输入以下命令来克隆存储库。我用的是云 9。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="d09f" class="mo lc in mk b gy mp mq l mr ms">git clone <strong class="mk io">&lt;your_repo_url&gt;</strong></span></pre><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c29ac75f2416e14b598a245fa92637a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*1aHzAeCTA4ixRRa87ADkEQ.png"/></div></figure><p id="e43a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">移动到名为 terraformec2 的新目录中。(O <em class="kx"> ur 根模块)</em></p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ba9a" class="mo lc in mk b gy mp mq l mr ms">cd terraformec2</span></pre><h1 id="2263" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">步骤 2:设置地形模块</h1><p id="0644" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">为您的模块创建一个新目录，并移入其中:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5c40" class="mo lc in mk b gy mp mq l mr ms">mkdir <strong class="mk io">&lt;name_of_newdirectory&gt;</strong></span><span id="2808" class="mo lc in mk b gy mu mq l mr ms">cd <strong class="mk io">&lt;name_of_newdirectory&gt;</strong></span></pre><p id="dfc0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我把我的新目录命名为<strong class="jx io"> ec2-module。</strong> (O <em class="kx"> ur 子模块)</em></p><p id="1cda" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在新目录中创建<strong class="jx io"> main.tf </strong>和<strong class="jx io"> providers.tf </strong>文件。它应该是这样的:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2a921ec69ee294c46d51fa7ac1f30fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*LvlSldCHmY5VHTfgD13Fwg.png"/></div></figure><p id="0755" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<em class="kx">提供程序块</em>复制并粘贴到<strong class="jx io"> providers.tf </strong>文件中。</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/edee178c2de666f7056bf5c6fbeaa163.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*a33bo_7Iau88WfeuU2sWpg.png"/></div></figure><p id="269f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<em class="kx">资源块</em>复制粘贴到<strong class="jx io"> main.tf </strong>文件中。</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/91ddff6eebaddc8985fd34aa2a8f35aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*FcI3BYVYVztiDD9Z8rnH0A.png"/></div></figure><p id="1078" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确保您修改了资源块的 AMI！在 AWS 控制台中，获取 EC2 下的 AMI ID。它应该是这样的:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/c207ce473b2e6c8ac09816c405adea37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y-CGLwz6gFbPVHR_yDxeng.png"/></div></div></figure><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d271ba2badfc08eda0b696135d3fc976.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*skRRjZPdcTpCOpcmpbJupA.png"/></div></figure><p id="b95a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">如果不替换 AMI ID，以后会得到这个错误信息！</strong></p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/7dbf8cacec727d00da07abf3eafb13ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEhmbZ2JUyfYMAAARtnHhA.png"/></div></div></figure><p id="05bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了引用我们的<strong class="jx io">ec2-模块</strong>，替换 <strong class="jx io"> ec2.tf </strong>文件中的<em class="kx">资源块</em>和<em class="kx">提供者块。使用下面的代码<em class="kx">。</em></em></p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2a1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">移动到 terraformec2 目录并验证您的配置:</p><ul class=""><li id="4b32" class="nd ne in jx b jy jz kc kd kg nf kk ng ko nh ks ni nj nk nl bi translated">运行<code class="fe nm nn no mk b">terraform init</code>初始化 Terraform。</li><li id="fc0c" class="nd ne in jx b jy np kc nq kg nr kk ns ko nt ks ni nj nk nl bi translated">运行<code class="fe nm nn no mk b">terraform fmt</code>来确保你的格式是正确的，它会修改代码让你匹配。</li><li id="9725" class="nd ne in jx b jy np kc nq kg nr kk ns ko nt ks ni nj nk nl bi translated">运行<code class="fe nm nn no mk b">terraform validate</code>以确保没有语法错误。</li><li id="0bdb" class="nd ne in jx b jy np kc nq kg nr kk ns ko nt ks ni nj nk nl bi translated">运行<code class="fe nm nn no mk b">terraform plan</code>查看将创建哪些资源。</li><li id="6e5c" class="nd ne in jx b jy np kc nq kg nr kk ns ko nt ks ni nj nk nl bi translated">运行<code class="fe nm nn no mk b"> terraform apply</code>来创建你的基础设施。出现提示时，键入<code class="fe nm nn no mk b">yes</code>。</li></ul><p id="7b22" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开 AWS 控制台，查看 EC2 实例是否启动并运行。<br/> <strong class="jx io"> <em class="kx">确保您所在的地区是美国-西俄勒冈州。</em> </strong></p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3a68cb6dcacc09c467d9f9d545de856b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*iR6iztVaiLPG6x4uctHB9Q.png"/></div></figure><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/9d8a240aee0b2b21667de2b3a9587f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwdRj0bw61-lfqzcZ-QCvA.png"/></div></div></figure><p id="b5a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">验证之后，运行一个<code class="fe nm nn no mk b">terraform destroy --auto-approve</code>来终止 EC2 实例。</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/95e051b2f5a72ab8b052ed4afd155393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkJI1gGwumnZd0vH9ktcxg.png"/></div></div></figure><h1 id="6980" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">步骤 3:将代码更改推送到 GitHub</h1><p id="d6b6" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我们将把代码推回 GitHub。在这样做之前，我们需要创建一个<a class="ae kt" href="https://www.freecodecamp.org/news/gitignore-what-is-it-and-how-to-add-to-repo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">。gitignore 根目录内的</strong> </a>文件。这个文件确保 Git 忽略所有我们不想推送的文件。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/9397e3e17c74ce264dc6c90bd495ed01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKINJPjJChRza2Uh-zqh5Q.png"/></div></div></figure><p id="3094" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们通过输入命令来推送我们的代码:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="448a" class="mo lc in mk b gy mp mq l mr ms">git add .<br/>git commit -m “<strong class="mk io">&lt;insert comment&gt;</strong>”<br/>git push -u origin</span></pre><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/168ed6aa4bb730da1abfec0b1aa6d837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*LPlz8D636vw83whsS_Hw_g.png"/></div></figure><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/63dcd9af33d8c9ebd64f4a3661e1c49d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mn7yU3aDvhWXWl8fPzbGrA.png"/></div></div></figure><p id="80d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你，你做到了！你分叉克隆了 repo 模板，创建了 EC2 的自定义模块，并将新建的模块和<strong class="jx io"> ec2.tf </strong>文件推送到 GitHub！</p></div></div>    
</body>
</html>