# 开始在 PHP 中使用“__invoke”

> 原文：<https://blog.devgenius.io/start-using-invoke-in-php-b815287e1182?source=collection_archive---------0----------------------->

## 使用这种简单而强大的自包含类技术来提高您的实心代码编程技能。

![](img/653946c55f906fe7d76be764f4bab357.png)

图片由[卡罗琳娜·格拉博斯卡](https://www.pexels.com/@karolina-grabowska/)

今天我想和你分享一个有用的编程技巧，我每天都在工作中使用它。

你听说过**可调用类**，也叫**可调用类**吗？当然，你们中的一些人已经见过它们，例如在你最喜欢的框架中所谓的“单一动作控制器”,比如 Laravel 或 Symfony。

PHP 中的可调用类已经存在一段时间了。很多年前我亲眼见过它们，但直到最近我才欣赏到它们的美丽。

## 什么是可调用类？

这只是一个定义了`__invoke`魔法方法的类:

我假设您使用的至少是 PHP 版本 7。运行这样一个类的首选方法很简单。如果一个类属性是一个*可调用的*，那么它必须用括号括起来，例如:

如果变量是可调用的，那么简单地说:

## 可调用类在 SOLID 中有多大用处？

今天节目的主角是字母“S ”,来自“SOLID”的首字母缩写，即“单一责任原则”。我想你已经迫不及待地想看看可调用类如何帮助你创建更好更漂亮的代码了。

规则很简单。可调用的类:

*   应该只有一个行为(例如，“将产品添加到购物篮中”，“从购物篮中取出产品”等)。)
*   必须只有“__invoke”方法，并且不能有任何其他公共方法
*   可以有任意多的私有方法来满足内部需求
*   它的名字应该反映它的行为。缺少明确命名的公共方法强化了这一规则(稍后将详细介绍)

## 可调用类的良好候选人

每个类都应该做一些特定的事情:

*   返回值的提供程序(TaxAmountProvider、ConfigurationProvider、SomeDataProvider 等)。)
*   验证器(EmailValidator、VatinValidator、AgeValidator 等。)
*   控制器(LoginAction、HomepageAction、RegistrationFormAction 等。)
*   规格(加拿大产品规格、发行人规格等。)
*   服务(CalculateTaxService、AddToBasketService 等。)

## 现实生活中的例子

我想展示一个真实的例子。让我们以一个常见的订单管理服务为例:

我很确定这个类会被一遍又一遍的修改。你如何定义这类人的单个责任限额？用新特性扩展这个类总是很诱人的。毕竟一切都与订单有关，所以这很酷，对吗？

你能看出这里的问题吗？这个班级将会很难维持。顺便说一下，从一个局外人的角度来看，你能说出一个通用名`OrderService`是做什么的吗？如果不浏览整堂课，你将无法完成，而这门课至少有 1000 行。祝你好运，玩得开心。

## *可调用的救援类*

如果我们使用可调用类的奇妙技术会怎么样？我们会达到这样的结果:

这不是已经很美了吗？

*   真正关心分离，
*   类不能有一个以上的责任(从“SOLID”到“S”)，因为只允许一个公共方法，
*   不通过代码，类的功能是显而易见的，
*   用单元测试来覆盖类**要容易得多**，
*   单元测试可以更加精确，
*   有序动作可以无限扩展，
*   订单操作可以单独修改，从而减少回归。

你已经喜欢可调用的类了吗？我爱上了他们，我希望你也能给他们一些爱。

只是不要急于重构。由您来决定这种技术是否对您的用例有帮助。

我目前正在做的一个出版物中广泛使用了可调用类。亲自看看我在实践中是如何使用它们的:

[](https://medium.com/@dotcom.software/serving-resized-s3-images-on-the-fly-2ed98e10bf3a) [## 即时提供调整大小的 S3 图像

### 我们将创建一个基于 Symfony 的应用程序，直接从 AWS S3 服务的动态调整图像

medium.com](https://medium.com/@dotcom.software/serving-resized-s3-images-on-the-fly-2ed98e10bf3a)