<html>
<head>
<title>Add Radial Line with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Visx库添加径向线</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-radial-line-with-the-visx-library-c932010020f8?source=collection_archive---------7-----------------------#2021-03-23">https://blog.devgenius.io/add-radial-line-with-the-visx-library-c932010020f8?source=collection_archive---------7-----------------------#2021-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3589809a803c3eaf6700be3d9b4a3db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YuhvaQYj21LE5jNd"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@jokerhoi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">陈海</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="84a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx是一个库，让我们可以轻松地将图形添加到React应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用它来添加辐射线到我们的反应应用程序。</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/curve @visx/gradient @visx/group @visx/mock-data @visx/responsive @visx/scale @visx/shape</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="4761" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建径向线</h1><p id="04ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加模块提供的项目来创建图表。</p><p id="7bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用来自<code class="fe ms mt mu mj b">@visx/mock-data</code>模块的数据。</p><p id="cd16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来创建径向线图:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4b81" class="mn lc iq mj b gy mo mp l mq mr">import React, { useRef, useState, useEffect } from "react";<br/>import { Group } from "@visx/group";<br/>import { LineRadial } from "@visx/shape";<br/>import { scaleTime, scaleLog } from "@visx/scale";<br/>import { curveBasisOpen } from "@visx/curve";<br/>import appleStock from "@visx/mock-data/lib/mocks/appleStock";<br/>import { LinearGradient } from "@visx/gradient";<br/>import { animated, useSpring } from "react-spring";</span><span id="03df" class="mn lc iq mj b gy mv mp l mq mr">const green = "#e5fd3d";<br/>export const blue = "#aeeef8";<br/>const darkgreen = "#dff84d";<br/>export const background = "#744cca";<br/>const darkbackground = "#603FA8";<br/>const springConfig = {<br/>  tension: 20<br/>};</span><span id="59d6" class="mn lc iq mj b gy mv mp l mq mr">// utils<br/>function extent(data, value) {<br/>  const values = data.map(value);<br/>  return [Math.min(...values), Math.max(...values)];<br/>}<br/>// accessors<br/>const date = (d) =&gt; new Date(d.date).valueOf();<br/>const close = (d) =&gt; d.close;</span><span id="5d51" class="mn lc iq mj b gy mv mp l mq mr">// scales<br/>const xScale = scaleTime({<br/>  range: [0, Math.PI * 2],<br/>  domain: extent(appleStock, date)<br/>});<br/>const yScale = scaleLog({<br/>  domain: extent(appleStock, close)<br/>});</span><span id="bbbb" class="mn lc iq mj b gy mv mp l mq mr">const angle = (d) =&gt; xScale(date(d)) ?? 0;<br/>const radius = (d) =&gt; yScale(close(d)) ?? 0;</span><span id="badc" class="mn lc iq mj b gy mv mp l mq mr">const firstPoint = appleStock[0];<br/>const lastPoint = appleStock[appleStock.length - 1];</span><span id="7a97" class="mn lc iq mj b gy mv mp l mq mr">const Example = ({ width, height, animate = true }) =&gt; {<br/>  const lineRef = useRef(null);<br/>  const [lineLength, setLineLength] = useState(0);<br/>  const [shouldAnimate, setShouldAnimate] = useState(false);</span><span id="9043" class="mn lc iq mj b gy mv mp l mq mr">  const spring = useSpring({<br/>    frame: shouldAnimate ? 0 : 1,<br/>    config: springConfig,<br/>    onRest: () =&gt; setShouldAnimate(false)<br/>  });</span><span id="b633" class="mn lc iq mj b gy mv mp l mq mr">  const effectDependency = lineRef.current;<br/>  useEffect(() =&gt; {<br/>    if (lineRef.current) {<br/>      setLineLength(lineRef.current.getTotalLength());<br/>    }<br/>  }, [effectDependency]);</span><span id="efc0" class="mn lc iq mj b gy mv mp l mq mr">if (width &lt; 10) return null;<br/>  yScale.range([0, height / 2 - 20]);</span><span id="5d53" class="mn lc iq mj b gy mv mp l mq mr">const yScaleTicks = yScale.ticks();<br/>  const handlePress = () =&gt; setShouldAnimate(true);</span><span id="d46b" class="mn lc iq mj b gy mv mp l mq mr">  return (<br/>    &lt;&gt;<br/>      {animate &amp;&amp; (<br/>        &lt;&gt;<br/>          &lt;button<br/>            type="button"<br/>            onClick={handlePress}<br/>            onTouchStart={handlePress}<br/>          &gt;<br/>            Animate<br/>          &lt;/button&gt;<br/>          &lt;br /&gt;<br/>        &lt;/&gt;<br/>      )}<br/>      &lt;svg<br/>        width={width}<br/>        height={height}<br/>        onClick={() =&gt; setShouldAnimate(!shouldAnimate)}<br/>      &gt;<br/>        &lt;LinearGradient from={green} to={blue} id="line-gradient" /&gt;<br/>        &lt;rect width={width} height={height} fill={background} rx={14} /&gt;<br/>        &lt;Group top={height / 2} left={width / 2}&gt;<br/>          {yScaleTicks.map((tick, i) =&gt; (<br/>            &lt;circle<br/>              key={`radial-grid-${i}`}<br/>              r={yScale(tick)}<br/>              stroke={blue}<br/>              strokeWidth={1}<br/>              fill={blue}<br/>              fillOpacity={1 / (i + 1) - (1 / i) * 0.2}<br/>              strokeOpacity={0.2}<br/>            /&gt;<br/>          ))}<br/>          {yScaleTicks.map((tick, i) =&gt; (<br/>            &lt;text<br/>              key={`radial-grid-${i}`}<br/>              y={-(yScale(tick) ?? 0)}<br/>              dy="-.33em"<br/>              fontSize={8}<br/>              fill={blue}<br/>              textAnchor="middle"<br/>            &gt;<br/>              {tick}<br/>            &lt;/text&gt;<br/>          ))}</span><span id="e80a" class="mn lc iq mj b gy mv mp l mq mr">          &lt;LineRadial angle={angle} radius={radius} curve={curveBasisOpen}&gt;<br/>            {({ path }) =&gt; {<br/>              const d = path(appleStock) || "";<br/>              return (<br/>                &lt;&gt;<br/>                  &lt;animated.path<br/>                    d={d}<br/>                    ref={lineRef}<br/>                    strokeWidth={2}<br/>                    strokeOpacity={0.8}<br/>                    strokeLinecap="round"<br/>                    fill="none"<br/>                    stroke={animate ? darkbackground : "url(#line-gradient)"}<br/>                  /&gt;<br/>                  {shouldAnimate &amp;&amp; (<br/>                    &lt;animated.path<br/>                      d={d}<br/>                      strokeWidth={2}<br/>                      strokeOpacity={0.8}<br/>                      strokeLinecap="round"<br/>                      fill="none"<br/>                      stroke="url(#line-gradient)"<br/>                      strokeDashoffset={spring.frame.interpolate(<br/>                        (v) =&gt; v * lineLength<br/>                      )}<br/>                      strokeDasharray={lineLength}<br/>                    /&gt;<br/>                  )}<br/>                &lt;/&gt;<br/>              );<br/>            }}<br/>          &lt;/LineRadial&gt;<br/>          {[firstPoint, lastPoint].map((d, i) =&gt; {<br/>            const cx = ((xScale(date(d)) ?? 0) * Math.PI) / 180;<br/>            const cy = -(yScale(close(d)) ?? 0);<br/>            return (<br/>              &lt;circle<br/>                key={`line-cap-${i}`}<br/>                cx={cx}<br/>                cy={cy}<br/>                fill={darkgreen}<br/>                r={3}<br/>              /&gt;<br/>            );<br/>          })}<br/>        &lt;/Group&gt;<br/>      &lt;/svg&gt;<br/>    &lt;/&gt;<br/>  );<br/>};</span><span id="bbfe" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="fd01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe ms mt mu mj b">green</code>、<code class="fe ms mt mu mj b">blue</code>和<code class="fe ms mt mu mj b">background</code>变量设置线条和背景颜色。</p><p id="45ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">darkBackground</code>用于深色背景。</p><p id="57a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">extent</code>函数返回一个包含数据最小值和最大值的数字数组。</p><p id="4274" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">date</code>和<code class="fe ms mt mu mj b">close</code>是数据访问器，分别返回时间和值的数据。</p><p id="7896" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<code class="fe ms mt mu mj b">domain</code>和<code class="fe ms mt mu mj b">range</code>创建<code class="fe ms mt mu mj b">xScale</code>和<code class="fe ms mt mu mj b">yScale</code>值。</p><p id="4b35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">xScale</code>既有域又有范围，这样可以创建径向线。</p><p id="9a5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要<code class="fe ms mt mu mj b">angle</code>和<code class="fe ms mt mu mj b">radius</code>函数来计算径向线的点。</p><p id="4132" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe ms mt mu mj b">shouldAnimate</code>状态来设置何时动画填充线条。</p><p id="2ae8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">Group</code>组件中，我们有<code class="fe ms mt mu mj b">circle</code>元素来创建同心圆。</p><p id="733f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">text</code>元素包含每个环值的文本。</p><p id="5692" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">LineRadial</code>组件根据从<code class="fe ms mt mu mj b">angle</code>和<code class="fe ms mt mu mj b">radius</code>函数返回的值呈现该行，我们将它们作为道具传入。</p><p id="a96d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">render prop返回从<code class="fe ms mt mu mj b">d</code>路径字符串创建的<code class="fe ms mt mu mj b">animated.path</code>组件。</p><p id="61c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个<code class="fe ms mt mu mj b">animated.path</code>组件具有通过动画制作<code class="fe ms mt mu mj b">stroke</code>和<code class="fe ms mt mu mj b">strokeDashOffset</code>生成的填充线。</p><p id="ea3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的<code class="fe ms mt mu mj b">circle</code>分别添加到线条的起点和终点，作为线条终点的标记。</p><h1 id="67b4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f6b3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过Visx库轻松地在React应用程序中添加一条径向线。</p></div></div>    
</body>
</html>