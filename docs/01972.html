<html>
<head>
<title>Node.js Tips — Making HTTP Requests, Sending Responses, and File Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 提示—发出 HTTP 请求、发送响应和文件操作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-tips-making-http-requests-express-packages-and-file-operations-f610500dd304?source=collection_archive---------23-----------------------#2020-07-15">https://blog.devgenius.io/node-js-tips-making-http-requests-express-packages-and-file-operations-f610500dd304?source=collection_archive---------23-----------------------#2020-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d88cbf8ff1d3a6334cdea4fad3e31627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OgnQtyCLWV_tWq9K"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">米切尔·霍兰德在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="508b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写节点应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些编写节点应用程序时常见问题的解决方案。</p><h1 id="daee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用 fs 定位父文件夹</h1><p id="11ab" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用这两个点去父文件夹。</p><p id="85b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5f47" class="mn lc iq mj b gy mo mp l mq mr">fs.readFile(path.join(__dirname, '/../../foo.txt'));</span></pre><p id="49f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须上一层楼。</p><p id="c3d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2 会上升两级。</p><p id="6818" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正斜杠也是必需的。</p><h1 id="309c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js 应用程序中如何解释“use strict”</h1><p id="c737" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Node 解释<code class="fe ms mt mu mj b">'use strict'</code>的方式与其他 JavaScript 应用程序相同。</p><p id="d0f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它允许检查未声明的变量，不允许设置常量值，如<code class="fe ms mt mu mj b">undefined</code>等等。</p><p id="7895" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有严格模式的静默非法操作被转换为错误。</p><p id="a47a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ES6 模块默认启用严格模式，因此我们不必显式启用它。</p><h1 id="e4f3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">快速 HTTP GET 请求</h1><p id="b486" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要在节点应用程序中发出 GET 请求，我们可以使用<code class="fe ms mt mu mj b">requestify</code> HTTP 客户端发出请求。</p><p id="c247" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9a2d" class="mn lc iq mj b gy mo mp l mq mr">var requestify = require('requestify');</span><span id="88d4" class="mn lc iq mj b gy mv mp l mq mr">requestify.get('http://example.com/')<br/>  .then((response) =&gt; {<br/>    response.getBody();<br/>  }<br/>);</span></pre><p id="8c3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在我们的快递应用程序中的任何地方提出我们的请求。</p><p id="0744" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，当客户端发出请求时，我们可以在路由处理器或中间件中加入请求。</p><h1 id="31b3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">同步和异步编程的区别</h1><p id="0563" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">同步程序是逐行运行的。</p><p id="e438" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">异步程序在不确定的时间内计算结果。</p><p id="2f9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果异步代码是一个承诺，我们可以在回调中得到结果，或者用<code class="fe ms mt mu mj b">await</code>赋值。</p><p id="49d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1731" class="mn lc iq mj b gy mo mp l mq mr">database.query("SELECT * FROM table", (result) =&gt; {<br/>  console.log(result);<br/>});</span></pre><p id="45ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是异步的。当这段代码运行时，它不会阻塞主线程。</p><p id="84fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当结果准备好时，回调被调用。</p><p id="5924" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同步代码通过编写以下代码来运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9e96" class="mn lc iq mj b gy mo mp l mq mr">const result = database.query("SELECT * FROM table");<br/>console.log(result);</span></pre><p id="d2c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">query</code>方法返回结果，我们可以在赋值后得到它。</p><p id="2094" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些任务，如文件系统操作，在不同的进程中运行。</p><h1 id="ba76" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用 socket.io 向特定客户端发送消息</h1><p id="069f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe ms mt mu mj b">clients</code>属性和<code class="fe ms mt mu mj b">send</code>方法向特定的客户端发送消息。</p><p id="923c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6655" class="mn lc iq mj b gy mo mp l mq mr">const io = io.listen(server);<br/>io.clients[clientId].send();</span></pre><p id="fb2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过 ID 获取客户端，然后对其调用<code class="fe ms mt mu mj b">send</code>。</p><h1 id="149e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用 Express 发送 404 响应</h1><p id="342e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要用 Express 发送 404 响应，我们可以调用<code class="fe ms mt mu mj b">res.status</code>来发送状态代码。</p><p id="92e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想添加一个消息，我们可以在它之后调用<code class="fe ms mt mu mj b">send</code>。</p><p id="8167" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="16da" class="mn lc iq mj b gy mo mp l mq mr">res.status(404).send('not found');</span></pre><p id="3a5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以使用<code class="fe ms mt mu mj b">sendtatus</code>方法:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="93e0" class="mn lc iq mj b gy mo mp l mq mr">res.sendStatus(404);</span></pre><h1 id="c8e1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建文件夹或使用现有文件夹(如果存在)</h1><p id="0211" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了让我们创建一个文件夹或者使用一个已经存在的文件夹，我们可以使用<code class="fe ms mt mu mj b">mkdirp</code>包。</p><p id="e170" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fd79" class="mn lc iq mj b gy mo mp l mq mr">npm install mkdirp</span></pre><p id="54b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="38de" class="mn lc iq mj b gy mo mp l mq mr">cpnst mkdirp = require('mkdirp');<br/>mkdirp('/foo', (err) =&gt; {<br/>  //...<br/>});</span></pre><p id="0bf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">err</code>遇到错误。</p><p id="fa5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">'/foo'</code>是目录路径。</p><p id="e66c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在创建目录或目录已经存在后，调用回调。</p><p id="3ae7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从节点 10 开始，我们也可以在没有库的情况下做同样的事情。</p><p id="a33b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="171b" class="mn lc iq mj b gy mo mp l mq mr">fs.mkdirSync('/foo', { recursive: true })</span></pre><p id="6f4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe ms mt mu mj b">recursive</code>选项同步使用或创建文件夹。</p><p id="9d06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e903" class="mn lc iq mj b gy mo mp l mq mr">await fs.promises.mkdir('/foo', { recursive: true })</span></pre><p id="cc20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">异步地做同样的事情。</p><p id="5f78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">'/foo'</code>是小路。</p><h1 id="f42d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何在 Express 中使用 NODE_ENV</h1><p id="0ff0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe ms mt mu mj b">export</code>命令设置<code class="fe ms mt mu mj b">NODE_ENV</code>环境变量。</p><p id="ff14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1224" class="mn lc iq mj b gy mo mp l mq mr">export NODE_ENV=production</span></pre><p id="f2f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在我们的 Express 应用程序中，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="941e" class="mn lc iq mj b gy mo mp l mq mr">app.get('env')</span></pre><p id="208e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获取环境名称。</p><h1 id="47ab" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">更新特定的节点包</h1><p id="8fee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要更新特定的节点包，我们可以使用<code class="fe ms mt mu mj b">npm update</code>命令。</p><p id="a19d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="906e" class="mn lc iq mj b gy mo mp l mq mr">npm update express</span></pre><p id="90b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b061" class="mn lc iq mj b gy mo mp l mq mr">npm install express@4.17.1</span></pre><p id="b7ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将 Express 更新到特定版本。</p><p id="dca9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过运行以下命令来更新到最新版本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fcb4" class="mn lc iq mj b gy mo mp l mq mr">npm install express@latest</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/0a3b90e6744cfa84b5834e100ffc2c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_CSq5GdWhSjBpHf"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@timothymuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Timothy Muza </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="0ffd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="aa5e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe ms mt mu mj b">npm update</code>更新包。</p><p id="441d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用异步代码来运行长期运行的操作。</p><p id="68a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以向特定的客户端发送消息。</p><p id="da70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有专为节点应用制作的 HTTP 客户端。</p></div></div>    
</body>
</html>