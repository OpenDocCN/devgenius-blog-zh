<html>
<head>
<title>Kafka Consumers with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的卡夫卡消费者</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kafka-consumers-with-python-76b495a053b4?source=collection_archive---------6-----------------------#2022-12-12">https://blog.devgenius.io/kafka-consumers-with-python-76b495a053b4?source=collection_archive---------6-----------------------#2022-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c09a0adea86bce22d9a4750acb3a6c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4xA1AmhrEbp6ooch.jpg"/></div></div></figure><h1 id="d495" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">使用 Python 的卡夫卡消费者</h1><p id="b3d7" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">这是一个如何将 Kafka 消费者与 Python 结合使用的简单示例。</p><h1 id="c85c" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">先决条件</h1><ol class=""><li id="7fa0" class="lr ls in kv b kw kx la lb le lt li lu lm lv lq lw lx ly lz bi translated">Kafka-installations-and-Kafka-topics:<a class="ae ma" href="https://medium.com/dev-genius/kafka-installtions-and-kafka-topics-f0b7c81754d8" rel="noopener">https://medium . com/dev-genius/Kafka-installations-and-Kafka-topics-f0b7c 81754 D8</a></li><li id="2a44" class="lr ls in kv b kw mb la mc le md li me lm mf lq lw lx ly lz bi translated">Kafka-with-python-fast-API:<a class="ae ma" href="https://medium.com/dev-genius/kafka-with-python-fast-api-b1622eb7f9d0" rel="noopener">https://medium . com/dev-genius/Kafka-with-python-fast-API-b 1622 EB 7 F9 d 0</a></li><li id="78cb" class="lr ls in kv b kw mb la mc le md li me lm mf lq lw lx ly lz bi translated">Kafka-with-python-Producer:<a class="ae ma" href="https://medium.com/dev-genius/producing-message-to-kafka-using-cli-6bd22fc51d5c" rel="noopener">https://medium . com/dev-genius/producing-message-to-Kafka-using-CLI-6bd 22 fc 51 D5 c</a></li></ol><p id="3bdb" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">让我们首先启动 Zookeeper 和 Kafka 服务器。您可以使用以下命令来启动 Zookeeper 和 Kafka 服务器。</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="3a30" class="mu jw in mq b be mv mw l mx my">docker-compose up -d</span></pre><h1 id="4a7d" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">查看主题列表</h1><p id="741d" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">使用以下命令查看主题列表。如果你没有主题，那么你必须创造一个。</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="a843" class="mu jw in mq b be mv mw l mx my">docker exec -it cli-tools kafka-topics --list --bootstrap-server broker0:29092,broker1:29093,broker2:29094</span></pre><h1 id="f1a9" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建一个主题</h1><p id="15e7" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">使用以下命令创建一个主题。</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="7b75" class="mu jw in mq b be mv mw l mx my">docker exec -it cli-tools kafka-topics --create --topic people --bootstrap-server broker0:29092 --partitions 2</span></pre><h1 id="4c71" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建 Python 生成器</h1><p id="8b67" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">使用以下命令创建 python 生成器。</p><p id="75be" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">Kafka-with-python-Producer:<a class="ae ma" href="https://medium.com/dev-genius/producing-message-to-kafka-using-cli-6bd22fc51d5c" rel="noopener">https://medium . com/dev-genius/producing-message-to-Kafka-using-CLI-6bd 22 fc 51 d5c</a></p><p id="0613" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">[或者]用这个饭桶让卡夫卡制作人<a class="ae ma" href="https://github.com/SohaibAnwaar/Produce-Messages-To-Kafka" rel="noopener ugc nofollow" target="_blank">https://github.com/SohaibAnwaar/Produce-Messages-To-Kafka</a></p><h1 id="6217" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建 Python 消费者</h1><p id="794b" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我们将编写一个 python 消费者来使用我们在上一步中创建的主题中的消息。</p><h1 id="d1ae" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创造。环境文件</h1><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="f258" class="mu jw in mq b be mv mw l mx my">BOOTSTRAP_SERVER="localhost:9092"<br/>TOPICS_PEOPLE_BASIC_NAME="people"<br/>CONSUMER_GROUP="people.grp-0"</span></pre><h1 id="0a68" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建一个 python 文件</h1><p id="ac01" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">创建文件<code class="fe mz na nb mq b">consumer.py</code></p><p id="d410" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">导入下列库</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="e068" class="mu jw in mq b be mv mw l mx my">import logging<br/>import os<br/>import json</span></pre><pre class="nc mp mq nd ne aw nf bi"><span id="520c" class="ng jw in mq b gy nh ni l nj my">from dotenv import load_dotenv<br/>from kafka.consumer import KafkaConsumer</span><span id="7f86" class="ng jw in mq b gy nk ni l nj my">load_dotenv(verbose=True)<br/>logging.basicConfig(level=logging.INFO)<br/>logger = logging.getLogger(__name__)</span></pre><p id="e13e" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">创造一个消费者阶层</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="c07f" class="mu jw in mq b be mv mw l mx my">def main():<br/>  print("Starting consumer", os.environ["BOOTSTRAP_SERVER"])<br/>  consumer = KafkaConsumer( <br/>    bootstrap_servers=[os.environ["BOOTSTRAP_SERVER"]],<br/>    auto_offset_reset="earliest",<br/>    enable_auto_commit=True,<br/>    group_id=os.environ["CONSUMER_GROUP"],<br/>    key_deserializer=lambda x: json.loads(x.decode("utf-8")),<br/>    value_deserializer=lambda x: json.loads(x.decode("utf-8"))<br/>  )</span></pre><pre class="nc mp mq nd ne aw nf bi"><span id="abb6" class="ng jw in mq b gy nh ni l nj my">  consumer.subscribe([os.environ["TOPICS_PEOPLE_BASIC_NAME"]])</span><span id="d64c" class="ng jw in mq b gy nk ni l nj my">  for message in consumer:<br/>    message = f"""<br/>    Message received: {message.value}<br/>    Message key: {message.key}<br/>    Message partition: {message.partition}<br/>    Message offset: {message.offset}</span><span id="f9d7" class="ng jw in mq b gy nk ni l nj my">    """<br/>    logger.info(message)</span><span id="95f1" class="ng jw in mq b gy nk ni l nj my">  pass</span><span id="176a" class="ng jw in mq b gy nk ni l nj my">if __name__ == "__main__":<br/>  main()</span></pre><p id="9992" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">现在让我们使用下面的命令运行消费者。</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="b78c" class="mu jw in mq b be mv mw l mx my">python consumer.py</span></pre><p id="71e9" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">现在，您可以从生产者发送消息，并在消费者中查看消息。</p><h1 id="ce75" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">从生成器生成消息</h1><p id="49f3" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">按照以下链接从生成器生成消息。<a class="ae ma" href="https://medium.com/dev-genius/producing-message-to-kafka-using-cli-6bd22fc51d5c" rel="noopener">https://medium . com/dev-genius/producing-message-to-Kafka-using-CLI-6bd 22 fc 51 d5c</a></p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/53d19bc962d37836005ab0e06dad140a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h9eSzdnvs6LY_DZx.png"/></div></div></figure><h1 id="6856" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">来自消费者的消费信息</h1><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/7461375abd1d36774880d7523cc07542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5pmeynCLiPdPf_yd.png"/></div></div></figure><h1 id="203e" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">查看 GitHub 上的代码:</h1><p id="1cd3" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><a class="ae ma" href="https://github.com/SohaibAnwaar/Kafka-Consumer-Python" rel="noopener ugc nofollow" target="_blank">https://github.com/SohaibAnwaar/Kafka-Consumer-Python</a></p><h1 id="81d5" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">作者</h1><ul class=""><li id="f032" class="lr ls in kv b kw kx la lb le lt li lu lm lv lq nn lx ly lz bi translated">索海卜·安瓦尔:<a class="ae ma" href="https://www.sohaibanwaar.com/" rel="noopener ugc nofollow" target="_blank">https://www.sohaibanwaar.com</a></li><li id="f6a6" class="lr ls in kv b kw mb la mc le md li me lm mf lq nn lx ly lz bi translated">Gmail:<a class="ae ma" href="mailto:sohaibanwaar36@gmail.com" rel="noopener ugc nofollow" target="_blank">sohaibanwaar36@gmail.com</a></li><li id="ad00" class="lr ls in kv b kw mb la mc le md li me lm mf lq nn lx ly lz bi translated">LinkedIn: <a class="ae ma" href="https://www.linkedin.com/in/sohaib-anwaar-4b7ba1187/" rel="noopener ugc nofollow" target="_blank">在这里进行一些专业的谈话</a></li><li id="a52e" class="lr ls in kv b kw mb la mc le md li me lm mf lq nn lx ly lz bi translated">堆栈溢出:<a class="ae ma" href="https://stackoverflow.com/users/7959545/sohaib-anwaar" rel="noopener ugc nofollow" target="_blank">来这里寻求我的帮助</a></li><li id="e194" class="lr ls in kv b kw mb la mc le md li me lm mf lq nn lx ly lz bi translated">卡格尔:<a class="ae ma" href="https://www.kaggle.com/sohaibanwaar1203" rel="noopener ugc nofollow" target="_blank">在这里查看我的杰作</a></li><li id="5fda" class="lr ls in kv b kw mb la mc le md li me lm mf lq nn lx ly lz bi translated">GitHub: <a class="ae ma" href="https://github.com/SohaibAnwaar" rel="noopener ugc nofollow" target="_blank">在这里查看我的代码</a></li></ul></div></div>    
</body>
</html>