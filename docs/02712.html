<html>
<head>
<title>Node.js Best Practices — Versioning and Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 最佳实践—版本控制和安全性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-best-practices-versioning-and-security-a0114dcff527?source=collection_archive---------3-----------------------#2020-08-22">https://blog.devgenius.io/node-js-best-practices-versioning-and-security-a0114dcff527?source=collection_archive---------3-----------------------#2020-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/50131c66581f8c137cca7f30fd727367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xNNXaJoxl7zGKVNF"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@icons8?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Icons8 团队</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="ae3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="57bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用语义版本控制</h1><p id="a67b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用语义版本对我们的应用程序进行版本化。</p><p id="9f9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是约定俗成的，所以很多人会理解。</p><p id="8e3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">版本应该有主要版本、次要版本和错误修复版本，并用点分隔。</p><p id="d86f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以格式是 major.minor.bugfix</p><h1 id="7633" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">保护我们的应用</h1><p id="4df3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该保护用户和客户的数据，这样我们就可以保护我们的应用程序免受任何攻击。</p><p id="a17f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该注意的事情包括安全 HTTP 头、暴力攻击等等。</p><p id="d3c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的 HTTP 响应中应该有一些头。</p><p id="9e74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括强制 HTTPS 连接到服务器的严格传输安全性。</p><p id="af1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Frame-Options 提供点击劫持保护。</p><p id="1da5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-XSS 保护启用最新 web 浏览器内置的跨站点脚本过滤器。</p><p id="fde3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Content-Type-Options 阻止浏览器从声明的内容类型中嗅探响应。</p><p id="5c81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">内容安全策略可防止各种攻击，如跨站点脚本和其他跨站点注入。</p><p id="6d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过头盔模块启用所有这些功能:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cae1" class="mn lc iq mj b gy mo mp l mq mr">const express = require('express');<br/>const helmet = require('helmet');<br/> <br/>const app = express();<br/> <br/>app.use(helmet());</span></pre><p id="b909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有 Koa 版本，就是 Koa-头盔模块。</p><p id="dda1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以在 Nginx seer 中使用它来添加标题。</p><p id="5660" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">nginx.conf</code>中，我们可以添加:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c7a7" class="mn lc iq mj b gy mo mp l mq mr">add_header X-Frame-Options SAMEORIGIN;<br/>add_header X-Content-Type-Options nosniff;<br/>add_header X-XSS-Protection "1; mode=block";<br/>add_header Content-Security-Policy "default-src 'self'";</span></pre><h1 id="3227" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">客户端的敏感数据</h1><p id="aa8e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该在源代码中暴露 API 的秘密和凭证，因为任何人都可以读取。</p><p id="d155" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在代码审查中检查它们。</p><h1 id="9d97" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">强力保护</h1><p id="f732" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的应用程序应该添加暴力保护，这样我们就可以防止这些攻击。</p><p id="dedf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们添加了一个限速库来限制可以发出的请求。</p><p id="43d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<a class="ae kc" href="https://www.npmjs.com/package/ratelimiter" rel="noopener ugc nofollow" target="_blank"> ratelimiter </a>包来限制函数被调用的次数:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ee9e" class="mn lc iq mj b gy mo mp l mq mr">const limit = new Limiter({ id, db });</span><span id="d228" class="mn lc iq mj b gy mv mp l mq mr">limit.get((err, limit) =&gt; {</span><span id="23f1" class="mn lc iq mj b gy mv mp l mq mr">});</span></pre><p id="078f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它来编写 Express 中间件。</p><p id="3e55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e36c" class="mn lc iq mj b gy mo mp l mq mr">const ratelimit = require('koa-ratelimit');<br/>const redis = require('redis');<br/>constkoa = require('koa');<br/>constapp = koa();</span><span id="7a88" class="mn lc iq mj b gy mv mp l mq mr">const emailBasedRatelimit = ratelimit({<br/>  db: redis.createClient(),<br/>  duration: 100000,<br/>  max: 10,<br/>  id(context) {<br/>    return context.body.email;<br/>  }<br/>});</span><span id="990a" class="mn lc iq mj b gy mv mp l mq mr">const ipBasedRatelimit = ratelimit({<br/>  db: redis.createClient(),<br/>  duration: 100000,<br/>  max: 10,<br/>  id(context) {<br/>    return context.ip;<br/>  }<br/>});</span><span id="6be1" class="mn lc iq mj b gy mv mp l mq mr">app.post('/login', ipBasedRatelimit, emailBasedRatelimit, handleLogin);</span></pre><p id="0bca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用速率限制中间件用<code class="fe ms mt mu mj b">id</code>方法检查 ID 和电子邮件。</p><p id="c2fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">duration</code>设置持续时间。</p><p id="47d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">db</code>是热地连接实例。</p><p id="1eda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">max</code>是请求的最大数量。</p><h1 id="60b9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">会话管理</h1><p id="11a5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了保护我们的 cookies，我们设置了几个标志。</p><p id="0101" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中之一就是<code class="fe ms mt mu mj b">secure</code>旗。这告诉浏览器只在请求通过 HTTPS 发送时才发送 cookie。</p><p id="fac0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">HttpOnly</code>用于帮助防止跨站点脚本等攻击，因为它不允许使用 JavaScript 访问 cookies。</p><p id="6bb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">域的范围也应该改变。</p><p id="a585" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">domain</code>与被请求 URL 的服务器的域进行比较。</p><p id="2bf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果域匹配，那么路径也必须匹配。</p><p id="780d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦<code class="fe ms mt mu mj b">path</code>被选中，cookie 将随请求一起发送。</p><p id="4dcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">expires</code>是用来设置持久 cookies 的属性。过期日期过后，它们就会过期。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/7f5c41e22e2b61e8980e7547982392ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mNQCQamD5UgUnzhx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@gcalebjones?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯勒·琼斯</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="6da9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ef76" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用语义版本，并采取一些措施来保护我们的应用程序。</p></div></div>    
</body>
</html>