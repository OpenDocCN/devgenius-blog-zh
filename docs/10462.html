<html>
<head>
<title>Salts and UUIDs for your MS SQL Server database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MS SQL Server 数据库的 Salts 和 UUIDs</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/salts-and-uuids-for-your-ms-sql-server-database-5f8d34b85265?source=collection_archive---------4-----------------------#2022-11-03">https://blog.devgenius.io/salts-and-uuids-for-your-ms-sql-server-database-5f8d34b85265?source=collection_archive---------4-----------------------#2022-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="285c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一篇简明的帖子，介绍了在使用 MS SQL Server 数据库时 UUIDs 和密码加盐散列的实际实现步骤。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/32e544a05629341d788ade6ab374f7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhU2IFcyTB29Ng303s5tvQ.png"/></div></div></figure><h1 id="bae9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="14af" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">本文是在使用 MS SQL Server 数据库时 UUIDs 和 Salts 的实际实现案例。将讨论的主题是:</p><ul class=""><li id="5d85" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated">使用数据库并创建 demousers 表</li><li id="693c" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">MS SQL Server UUIDs 使用内置的<strong class="jp ir"> uuid() </strong>函数作为列数据类型</li><li id="7d8c" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">使用<strong class="jp ir">触发器</strong></li><li id="a786" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">使用哈希验证存储的<strong class="jp ir">函数</strong></li></ul><h1 id="957e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="6a87" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">假设你理解基本的数据库概念，<a class="ae mo" href="https://en.wikipedia.org/wiki/Universally_unique_identifier" rel="noopener ugc nofollow" target="_blank"> UUID </a>和<a class="ae mo" href="https://www.okta.com/uk/blog/2019/03/what-are-salted-passwords-and-password-hashing/" rel="noopener ugc nofollow" target="_blank">密码加盐和散列</a>。我之前的这篇文章对这些主题有所了解。</p><div class="mp mq gp gr mr ms"><a href="https://medium.com/@zzpzaf.se/salts-and-uuids-for-your-databases-intro-41cc58fe100a" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">所有数据库的 Salts 和 UUIDs</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">这是一篇关于 Salts 和 UUIDs 的介绍性文章，也是我的其他文章中关于如何在…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">medium.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kv ms"/></div></div></a></div><p id="babd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，为了遵循本文的示例，您必须能够访问正在运行的 MS SQL Server 实例和<a class="ae mo" href="https://learn.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"> sqlcmd </a> CLI 工具[ <a class="ae mo" rel="noopener ugc nofollow" target="_blank" href="/the-database-command-line-tools-you-can-add-to-your-dev-environment-without-database-installation-9091dd0c0277?sk=50026b887181c062144e6fbb9130663e">在这里</a>您可以找到如何将它作为独立工具安装在您的系统中]。如果你愿意的话，你可以看看我下面关于如何创建和开始使用一个<a class="ae mo" href="https://medium.com/@zzpzaf.se/ms-sql-server-in-docker-b0397a55859c" rel="noopener"> MS SQL Server 容器</a>的帖子。</p><div class="mp mq gp gr mr ms"><a href="https://medium.com/@zzpzaf.se/ms-sql-server-in-docker-b0397a55859c" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">Docker 中的 MS SQL Server</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">4 分钟指南。轻松全面！</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">medium.com</p></div></div><div class="nb l"><div class="nh l nd ne nf nb ng kv ms"/></div></div></a></div><h1 id="6e9a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">开始使用 MS SQL Server，创建一个新用户和 demousers 表</h1><p id="69a4" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">使用正确的凭据(用户名和密码)，使用<strong class="jp ir"> sqlcnd </strong> CLI 实用程序连接到正在运行的 MS SQL Server 实例。</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="b5b0" class="nn ky iq nj b gy no np l nq nr">~ sqlcmd -S 192.168.0.84,1443 -U SA -P 'Rpassw!1'</span></pre><p id="409e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问正在运行的 MS SQL Server 实例后，可以使用 CLI 工作。我们开始吧。</p><p id="2347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以创建一个新的数据库，或者只连接到您喜欢的数据库。在这里，我们将创建并使用名为“票证管理”的数据库，例如:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="bcca" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> CREATE DATABASE <strong class="nj ir">[</strong>ticket-management<strong class="nj ir">]</strong>;<br/><strong class="nj ir">&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> USE <strong class="nj ir">[</strong>ticket-management<strong class="nj ir">]<br/>&gt;</strong> GO</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="0cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，创建一个新用户“user1 ”,密码为“Upassw！1”，然后为他分配票证管理数据库的所有权限。首先，对于 MS SQL Server，我们必须创建一个“登录”对象。“登录”对象授予对服务器的访问权限，然后“用户”授予对数据库的登录访问权限。首先，创建一个登录名:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="940f" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> CREATE LOGIN <strong class="nj ir">[</strong>user1<strong class="nj ir">]</strong> WITH PASSWORD 'Upassw!1'<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="739e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后你可以使用下面的脚本来检查登录对象是否已经被创建:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="a38e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是输出:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="abd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，切换到票证管理数据库，并为该数据库创建 user1:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="a7e0" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> USE <strong class="nj ir">[</strong>ticket-management<strong class="nj ir">]<br/>&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> CREATE USER user1 <strong class="nj ir">FOR</strong> LOGIN user1<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="0006" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以使用以下脚本来检查是否已经创建了 user1:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="0b2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6182" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步，我们必须向票证管理数据库的 user1 所有者添加'<strong class="jp ir"> db_owner </strong>'角色。请注意，具有 db_owner 角色的任何人都可以对数据库执行所有配置和维护活动。</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="b833" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> EXEC sp_addrolemember 'db_owner', 'user1';<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="cd46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，注销并重新登录，作为用户 1:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="3ca2" class="nn ky iq nj b gy no np l nq nr">~ sqlcmd -S 192.168.0.17,1443 -U user1 -P 'Upassw!1'</span></pre><p id="4143" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录后，切换到票证管理数据库，确保您以用户 1 的身份登录，并且正在使用票证管理数据库。这就是以下 SQL 脚本的作用:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="b92a" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> SELECT @@SPID AS 'ID', SYSTEM_USER AS 'Login Name', USER AS 'User Name', DB_name<strong class="nj ir">()</strong> AS 'database'</span></pre><p id="7dc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是输出:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，在票证管理数据库/模式中创建一个新表(名为 DEMOUSERS ):</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您也可以检查它:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="acf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。现在是时候看看如何在 MS SQL Server 中使用 UUIDs 了。</p><h1 id="aa5e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">MS SQL Server UUIDs</h1><p id="3038" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">MS SQL Server 为我们提供了一个<strong class="jp ir">内置的</strong> <a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/functions/newid-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> uuid() </strong> </a>函数，它符合 RFC4122，默认情况下返回一个 UUIDv4 字符串。简单地说，您可以执行 Select 语句:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="df81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们可以非常方便地将它用作表的 id 列的默认值。[注意，这种可能性与 PostgreSQL 非常相似]。因此，不需要使用 MS SQL Server 实现触发器来处理列的新 UUID。我们将这种类型用于我们希望的列，例如 id 列。</p><p id="8d0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建一个新表 demousers 表</strong></p><p id="5e8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，使用以下 SQL 脚本来创建我们的 demousers 表:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="f8d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以验证其模式:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6e9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们可以添加几个约束，这些约束在以后可能会非常有用。实际上，我们将为 username 列创建一个主键、一个索引和一个唯一约束:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="e882" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> ALTER TABLE demousers ADD CONSTRAINT <strong class="nj ir">[</strong>PK_demousers1<strong class="nj ir">]</strong> PRIMARY KEY CLUSTERED <strong class="nj ir">(</strong>id<strong class="nj ir">)<br/>&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> CREATE NONCLUSTERED INDEX index1 ON demousers <strong class="nj ir">(</strong>id ASC<strong class="nj ir">)<br/>&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> ALTER TABLE demousers ADD CONSTRAINT uniques1 UNIQUE NONCLUSTERED <strong class="nj ir">(</strong>username ASC<strong class="nj ir">)<br/>&gt;</strong> GO</span></pre><p id="dc24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，如果您愿意，您可以使用下面提供的任何 SQL 命令获得演示用户的相关信息:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="0902" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> EXEC sp_columns demousers<br/><strong class="nj ir">&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> EXEC sp_help demousers<br/><strong class="nj ir">&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> SELECT <strong class="nj ir">*</strong> FROM information_schema.columns WHERE table_name = 'demousers'<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="4bc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了！到目前为止，一切顺利！现在，通过向 demousers 表添加一个新用户，可以看到默认的 newid()函数对 id 列的影响了:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="afbb" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> INSERT INTO demousers <strong class="nj ir">(</strong>username, password<strong class="nj ir">)</strong> VALUES <strong class="nj ir">('</strong>panos', 'panospassw1'<strong class="nj ir">)<br/>&gt;</strong> GO</span></pre><p id="205e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！如您所见，自动创建的“9 baea 927–3234–421 e-B561–6e 948d 4 FBE 5 e”UUID 已作为值正确插入 ID 字段！</p><h1 id="0e98" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">MS SQL Server 哈希和加盐</h1><p id="4bd6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在是时候创建一个<strong class="jp ir">触发器</strong>来完成这项工作了。你可以在<a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">官方文档</a>中读到关于 MS SQL Server 触发器的内容。</p><p id="c610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">MS SQL Server 提供的用于散列和加盐的重要加密函数是，我们将在这里使用:</p><ul class=""><li id="2407" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated"><a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/functions/crypt-gen-random-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">CRYPT _ GEN _ RANDOM()</strong></a>—该函数基于加密 API (CAPI)，它返回一个随机生成的加密数。</li><li id="0cad" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated"><a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/functions/hashbytes-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">【HASHBYTES()</strong></a>—这是主哈希值生成器。它根据所提供的输入返回一个摘要(散列)。可以使用任何可用的算法(MD2、MD4、MD5、SHA、SHA1 或 SHA2)作为参数。</li><li id="73ef" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">我们将使用的其他函数有<a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"> CONVERT() </a>和<a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/functions/substring-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"> SUBSTRING() </a>。</li></ul><p id="755f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是创建触发器的 SQL 脚本:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="1f09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">逻辑类似于我们在其他数据库中使用的散列函数。首先我们随机生成一个盐。然后，我们添加纯文本密码，对于整个字符串，我们使用 SHA-256 算法计算哈希值。最后，我们在计算出的散列前面添加 salt，并将其存储为密码字段/列的值。</p><p id="cf8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建触发器后，可以通过查询 sys_triggers 表来检查它是否存在:</p><p id="7af0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是输出:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="9856" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> SELECT name, create_date FROM sys.triggers WHERE type = 'TR';</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="846d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以通过向票证管理表中插入一个新用户来测试触发器，然后查询表中的行:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="db1b" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> INSERT INTO demousers <strong class="nj ir">(</strong>username, password<strong class="nj ir">)</strong> VALUES <strong class="nj ir">('</strong>panos2', 'panospassw2'<strong class="nj ir">)<br/>&gt;</strong> GO<br/><strong class="nj ir">&gt;</strong> Select <strong class="nj ir">*</strong> FROM demousers;<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="54f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是输出:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="a6bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷！正如你在上面看到的，它像预期的那样工作。</p><p id="d751" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们继续创建<strong class="jp ir">验证</strong>函数。</p><h1 id="b6e8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用存储功能进行密码验证</h1><p id="02cc" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">类似于其他数据库，这里我们也可以通过使用<a class="ae mo" href="https://mariadb.com/kb/en/stored-function-overview/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">存储函数</strong> </a>来实现。(你可以在<a class="ae mo" href="https://learn.microsoft.com/en-us/sql/t-sql/statements/create-function-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">官方文档</a>中读到更多关于 MS SQL Server 存储函数的内容)。下面是一个例子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="aceb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你愿意，你可以使用下面的查询来检查存储函数是否已经被创建:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="6778" class="nn ky iq nj b gy no np l nq nr"><strong class="nj ir">&gt;</strong> SELECT name, definition, type_desc FROM sys.sql_modules m INNER JOIN sys.objects o ON m.object_id=o.object_id WHERE type_desc like ‘%function%’;<br/><strong class="nj ir">&gt;</strong> GO</span></pre><p id="e114" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是输出:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="25ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果匹配，则该函数返回 TRUE (1)，如果计算出的哈希不匹配，则返回 False (0)。为了检查给定的密码，我们可以使用下面的简单查询:</p><p id="cb31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> &gt; </strong>选择 ispassword valid<strong class="jp ir">(</strong>' panos 2 '，<strong class="jp ir">)</strong>；<br/> <strong class="jp ir"> &gt; </strong>走</p><p id="69a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从下面的输出可以看出，它返回 1 = TRUE，所以我们有一个匹配！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="404c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="5787" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上就是演示如何在 MS SQL Server 中开始处理 UUID、salts 和 hashes 的全部内容！</p><p id="8ecb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续阅读我的其他帖子，了解其他数据库的实现示例。</p><p id="b70b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">暂时就这样吧！我希望你喜欢它！感谢您的阅读👏敬请关注！</p></div></div>    
</body>
</html>