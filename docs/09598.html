<html>
<head>
<title>Elasticsearch and Kibana installation using Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Docker Compose 进行 Elasticsearch 和 Kibana 安装</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e?source=collection_archive---------1-----------------------#2022-08-31">https://blog.devgenius.io/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e?source=collection_archive---------1-----------------------#2022-08-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/334604aa846eaf67e0642e621bb3e2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFDTmaXjQATOpmBIcv_yXQ.png"/></div></div></figure><p id="9a75" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<a class="ae kt" href="https://medium.com/@mhdabdel151/run-elasticsearch-and-kibana-as-docker-containers-c5f5f5460afd" rel="noopener">上一篇文章</a>中，我们看到了如何将 Elasticsearch 和 Kibana 作为 Docker 容器运行。这个方法当然不是很复杂，但是需要很多命令。今天，我们将重点关注<strong class="jx io">编排</strong>，以便通过<strong class="jx io"> docker-compose </strong>将一切集中化。</p><p id="ae1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于那些不知道它是什么的人来说，<strong class="jx io"> Docker Compose </strong>是一个用 Python 编写的工具，它允许你在一个<em class="ku"> YAML </em>文件中描述几个容器作为一组服务。然后，它将允许您编排您的容器，从而简化您在不同环境中的部署。</p><p id="b319" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用的是 Mac 版<em class="ku">Docker</em>或 Windows 版<em class="ku">Docker</em>，那么您的系统中已经安装了最新版本的 Docker Compose。在 Linux 工作站上，您必须下载它，然后用以下命令行安装它:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="5890" class="le lf in la b gy lg lh l li lj">sudo curl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/bin/docker-compose &amp;&amp; sudo chmod +x /usr/bin/docker-compose</span></pre><p id="3adf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">安装后，您可以使用以下命令检查 Docker Compose 的版本:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ebf6" class="le lf in la b gy lg lh l li lj">docker-compose --version</span></pre><p id="a6a5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在这里 了解更多 docker-compose <a class="ae kt" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">。</em></a></p><p id="0fe5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，在一个空目录中，我们将创建一个<em class="ku">。env </em>文件来重组我们的环境变量。该文件的内容如下:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ebb9" class="le lf in la b gy lg lh l li lj"># Version of Elastic products<br/>STACK_VERSION=8.4.0</span><span id="48bc" class="le lf in la b gy lk lh l li lj"># Port to expose Elasticsearch HTTP API to the host<br/>ES_PORT=9200</span><span id="b70d" class="le lf in la b gy lk lh l li lj"># Port to expose Kibana to the host<br/>KIBANA_PORT=5601</span></pre><p id="a289" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我们一定要提到我们要使用的弹性产品的<em class="ku">版本</em>，以及 Elasticsearch 和 Kibana 将要暴露的<em class="ku">端口</em>。<br/>因为在第一个教程中<strong class="jx io">安全性没有被激活</strong>为了尽可能简化，我们不需要为我们的客户端指定密码。</p><p id="a650" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们转到<em class="ku"> docker-compose.yml </em>文件:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="f8cd" class="le lf in la b gy lg lh l li lj">version: '3.8'</span><span id="1278" class="le lf in la b gy lk lh l li lj">services:<br/>  elasticsearch:<br/>    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}<br/>    container_name: elasticsearch<br/>    volumes:<br/>      - elasticsearch-data:/usr/share/elasticsearch/data<br/>    ports:<br/>      - ${ES_PORT}:9200<br/>    restart: always<br/>    environment:<br/>      - xpack.security.enabled=false<br/>      - discovery.type=single-node<br/>    ulimits:<br/>      memlock:<br/>        soft: -1<br/>        hard: -1</span><span id="5364" class="le lf in la b gy lk lh l li lj">  kibana:<br/>    depends_on:<br/>      - elasticsearch<br/>    image: docker.elastic.co/kibana/kibana:${STACK_VERSION}<br/>    container_name: kibana<br/>    volumes:<br/>      - kibana-data:/usr/share/kibana/data<br/>    ports:<br/>     - ${KIBANA_PORT}:5601<br/>    restart: always<br/>    environment:<br/>      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span><span id="6358" class="le lf in la b gy lk lh l li lj">volumes:<br/>  elasticsearch-data:<br/>    driver: local<br/>  kibana-data:<br/>    driver: local</span></pre><p id="8663" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里，我们运行的是一个<em class="ku">单节点</em> Elasticsearch 版本<em class="ku"> 8.4.0 </em>集群，安全<em class="ku">被禁用</em>。我们的容器名为<em class="ku"> elasticsearch </em>，如果出现崩溃或任何问题，容器将<em class="ku">总是重启</em>。我们还需要指定一个卷来保存数据(您可以在<em class="ku">中修改端口)。env </em>文件)。</p><p id="4a47" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于 kibana 也是一样，我们为容器指定一个名称(<em class="ku"> kibana </em>)，我们填写<em class="ku"> ELASTICSEARCH_HOSTS </em>作为环境变量，以便将 Kibana 连接到 ELASTICSEARCH。指定<em class="ku"> depends_on </em>属性也很重要，以便仅在启动 Elasticsearch 容器时启动容器。</p><p id="66ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，通过运行以下命令，创建并启动 Kibana 实例和单节点 Elasticsearch 集群:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="51f9" class="le lf in la b gy lg lh l li lj">docker-compose up -d</span></pre><p id="69b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一次运行这个命令可能需要很长时间，这取决于您的互联网连接，因为它将从<a class="ae kt" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> docker hub </a>下载我们文件中指定的 Elasticsearch 和 Kibana 图像。您可以通过以下命令检查您的容器是否已经创建并正在运行:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="0991" class="le lf in la b gy lg lh l li lj">docker ps</span></pre><p id="2797" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当部署开始时，打开浏览器并通过访问<a class="ae kt" href="http://localhost:5601" rel="noopener ugc nofollow" target="_blank"> http://localhost:5601 </a>访问 Kibana，在这里您可以加载、测试数据并与您的集群通信。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ll"><img src="../Images/a16fd3321374e7ec5311fd5701dc5a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Trd3tr1jdRevDs7sTfwHHA.png"/></div></div></figure><p id="e646" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要停止集群，再简单不过了，运行以下命令:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="16c4" class="le lf in la b gy lg lh l li lj">docker-compose down</span></pre><p id="ef1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要删除容器和卷，您只需将<em class="ku"> -v </em>添加到前面的命令中。</p><p id="6748" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里还有很多事情我们可以讨论，比如如何在启用了<em class="ku">安全性的情况下重做同样的配置。不幸的是，我们无法在一篇文章中涵盖所有内容，但是不要担心，其他文章正在路上😁。</em></p><p id="7b75" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">今天到此为止，请随时查看关于该主题的<a class="ae kt" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file" rel="noopener ugc nofollow" target="_blank">官方文档</a>以了解更多细节和配置。感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="2f0a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们下次再见，看更多的帖子🚀。</p><p id="d1b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>