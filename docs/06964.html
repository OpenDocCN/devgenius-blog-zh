<html>
<head>
<title>Sensor data collection from STM32 and SHT85 using Bluetooth Low Energy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用蓝牙低功耗从 STM32 和 SHT85 收集传感器数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sensor-data-collection-from-stm32-and-sht85-using-bluetooth-low-energy-1af9073ccc9?source=collection_archive---------19-----------------------#2022-02-14">https://blog.devgenius.io/sensor-data-collection-from-stm32-and-sht85-using-bluetooth-low-energy-1af9073ccc9?source=collection_archive---------19-----------------------#2022-02-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/51e6eb45535d1e32949e1ad819000d57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r5mfbQSetJy5y9eq"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">罗宾·格劳泽在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4e8d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该项目展示了一种使用 BleuIO 加密狗来宣传 STM32 从连接到 STM32 Nucleo-144 的传感器读取的数据的简单方法。</p><h1 id="980d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">要求:</h1><ul class=""><li id="c82d" class="lw lx in kc b kd ly kh lz kl ma kp mb kt mc kx md me mf mg bi translated">https://www.bleuio.com/ Bluetooth 低能耗 usb 转换器(T4)</li><li id="1137" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">SHT85 传感器(https://sensirion.com/products/catalog/SHT85/)</li><li id="1856" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">带有带 USB 端口的 STM32 微控制器的电路板。(使用 Nucleo-144 开发板:NUCLEO-H743ZI2 来开发本示例。(https://www.st.com/en/evaluation-tools/nucleo-h743zi.html)</li><li id="b5cc" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">为了将加密狗连接到 Nucleo 板，我们使用了“USB A 到 Micro USB B”电缆和 USB A 母到母适配器。)</li><li id="7118" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">STM 32 库贝德语(https://www.st.com/en/development-tools/stm32cubeide.html)</li></ul><p id="c85a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当 BleuIO 加密狗连接到 Nucleo boards USB 端口时，STM32 将识别它，并开始公布它从 SHT85 读取的传感器值以及传感器序列号。它将每 10 秒更新一次这些值。</p><h1 id="007e" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置项目</h1><h2 id="d499" class="mm kz in bd la mn mo dn le mp mq dp li kl mr ms lm kp mt mu lq kt mv mw lu mx bi translated">第 1 部分:下载项目</h2><p id="b721" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated"><strong class="kc io">获取项目</strong> <a class="ae jz" href="https://github.com/smart-sensor-devices-ab/stm32_bleuio_SHT85_example" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">此处</strong> </a></p><p id="a999" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">https://github . com/smart-sensor-devices-ab/STM 32 _ bleu io _ sht 85 _ example</p><p id="f081" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要么克隆这个项目，要么将其下载为 zip 文件并解压缩到您的 STM32CubeIDE 工作空间中。</p><h2 id="babf" class="mm kz in bd la mn mo dn le mp mq dp li kl mr ms lm kp mt mu lq kt mv mw lu mx bi translated">第 2 部分:作为现有项目导入</h2><p id="6da1" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">从 STM32CubeIDE 中选择文件&gt;导入…</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/da331d05d96ebe984cb4da7b0cc9338b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/0*BZ0N_gAqjuNxO9ew.png"/></div></figure><p id="243f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后选择常规&gt;将现有项目放入工作区，然后单击“下一步&gt;”</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/9f722205193e602a965940fe2a0df344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/0*prKvEuEHKEAQJWaE.png"/></div></figure><p id="bd04" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保您已经在“选择根目录:”中选择了您的工作空间</p><p id="2b7a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该看到项目“stm32_bleuio_SHT85_example”，选中它并单击“Finish”。</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/857adc08a69bfce680746cf628da1474.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/0*mQ6oh2SeNvvM-x-b.png"/></div></figure><p id="58f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您将项目下载为 zip 文件，您需要将项目文件夹从“stm32_bleuio_SHT85_example-master”重命名为“STM 32 _ bleu io _ sht 85 _ example”</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8f538e5a3fd37c8c8ad4a8bd5ebee820.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/0*gQntPrO9J3d2_g2F.png"/></div></figure><p id="0210" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将 SDA 连接到 Nucleo 板上的 PF0，将 SCL 连接到 PF1。</p><p id="d627" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后像这样在 STM32Cube ioc 文件中设置 I2C2:</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/1ced11f67c00bbce4ddf847b10a8f87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/0*WVrRbDMQHpj6hMLK.png"/></div></figure><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/de9cbf83a3072058dd498b3082a9f818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/0*D_6j93nVrBOaHNs7.png"/></div></div></figure><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/02a44addea8b1a358d565560a18d32ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/0*ouBqhWSPnZd04wCz.png"/></div></figure><h1 id="409a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">运行示例</h1><p id="2f00" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">在 STMCubeIDE 中，单击锤子图标来构建项目。</p><ul class=""><li id="b0fb" class="lw lx in kc b kd ke kh ki kl nm kp nn kt no kx md me mf mg bi translated">使用 TeraTerm、Putty 或 CoolTerm 等串行终端仿真程序打开“STMicroelectronics STLink VI virtual COM 端口”。</li></ul><blockquote class="np nq nr"><p id="8106" class="ka kb ns kc b kd ke kf kg kh ki kj kk nt km kn ko nu kq kr ks nv ku kv kw kx ig bi translated"><em class="in">波特率:115200 </em></p><p id="b9e5" class="ka kb ns kc b kd ke kf kg kh ki kj kk nt km kn ko nu kq kr ks nv ku kv kw kx ig bi translated"><em class="in">数据位:8 个</em></p><p id="2ae8" class="ka kb ns kc b kd ke kf kg kh ki kj kk nt km kn ko nu kq kr ks nv ku kv kw kx ig bi translated"><em class="in">奇偶校验:无</em></p><p id="442d" class="ka kb ns kc b kd ke kf kg kh ki kj kk nt km kn ko nu kq kr ks nv ku kv kw kx ig bi translated"><em class="in">停止位:1 </em></p><p id="90ba" class="ka kb ns kc b kd ke kf kg kh ki kj kk nt km kn ko nu kq kr ks nv ku kv kw kx ig bi translated"><em class="in">流量控制:无</em></p></blockquote><ul class=""><li id="90aa" class="lw lx in kc b kd ke kh ki kl nm kp nn kt no kx md me mf mg bi translated">在 STMCubeIDE 中，单击绿色的 play 按钮，在您的板上刷新并运行它。第一次点击时，将出现“运行配置”窗口。您可以让它保持原样，然后单击运行。</li><li id="d80f" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">连接 BleuIO 加密狗。</li></ul><h1 id="74f0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">从 web 浏览器访问传感器数据</h1><p id="06e9" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">我们编写了一个简单的脚本，连接到 BleuIO 加密狗并从 STM32 读取广告数据。</p><p id="8fb4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了让这个脚本工作，我们需要</p><ul class=""><li id="6b04" class="lw lx in kc b kd ke kh ki kl nm kp nn kt no kx md me mf mg bi translated"><a class="ae jz" href="https://www.bleuio.com/" rel="noopener ugc nofollow" target="_blank"> BleuIO USB 加密狗</a>连接到电脑。</li><li id="58fc" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated"><a class="ae jz" href="https://www.npmjs.com/package/bleuio" rel="noopener ugc nofollow" target="_blank"> BleuIO javascript 库</a></li><li id="4436" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">Chrome 78 或更高版本，并且需要启用 chrome://flags 中的<strong class="kc io"># enable-experimental-we B- platform-features</strong>标志</li><li id="2445" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">卷筒纸捆扎机— ( <a class="ae jz" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank">包裹 js </a>)</li></ul><p id="821f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤</strong></p><p id="c635" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个名为 index.html 的简单 Html 文件，它将作为脚本的前端。这个 Html 文件包含一些按钮，帮助连接和读取来自连接到 stm32 的远程加密狗的广告数据。</p><pre class="nc nd ne nf gt nw nx ny nz aw oa bi"><span id="0b1a" class="mm kz in nx b gy ob oc l od oe">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;!-- Required meta tags --&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><span id="d824" class="mm kz in nx b gy of oc l od oe">    &lt;!-- Bootstrap CSS --&gt;<br/>    &lt;link<br/>      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"<br/>      rel="stylesheet"<br/>      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"<br/>      crossorigin="anonymous"<br/>    /&gt;</span><span id="6b2e" class="mm kz in nx b gy of oc l od oe">    &lt;title&gt;STM32 Read sensor value&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div class="container mt-5"&gt;<br/>      &lt;h1&gt;Sensor data collection from stm32 using Bluetooth Low Energy&lt;/h1&gt;<br/>      &lt;button id="connect" class="btn btn-primary"&gt;Connect&lt;/button&gt;<br/>      &lt;button id="getdata" class="btn btn-success"&gt;Get device data&lt;/button&gt;<br/>      &lt;div id="loader"&gt;&lt;/div&gt;<br/>      &lt;br /&gt;<br/>      &lt;div id="response" class="fw-bold"&gt;&lt;/div&gt;</span><span id="af8f" class="mm kz in nx b gy of oc l od oe">      &lt;script src="./index.js"&gt;&lt;/script&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="0137" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个名为 script.js 的 js 文件，并将其包含在 Html 文件的底部。这个 js 文件使用 BleuIO js 库来编写 AT 命令并与其他加密狗通信。</p><pre class="nc nd ne nf gt nw nx ny nz aw oa bi"><span id="60a8" class="mm kz in nx b gy ob oc l od oe">import * as my_dongle from 'bleuio'</span><span id="f267" class="mm kz in nx b gy of oc l od oe">//connect to BleuIO<br/>document.getElementById('connect').addEventListener('click', function(){<br/>  my_dongle.at_connect()<br/>})<br/>//get sensor data<br/>document.getElementById('getdata').addEventListener('click', function(){<br/>  document.getElementById('loader').innerHTML = 'Loading'<br/>  //set the BleuIO dongle into dual role<br/>    my_dongle.at_dual().then(()=&gt;{<br/>      // sensor id of the device that we are trying to get data from<br/>      let sensorID='05084FA3'</span><span id="4842" class="mm kz in nx b gy of oc l od oe">      //look for advertised data of with the sensor id<br/>        my_dongle.at_findscandata(sensorID,4).then(x=&gt;{        </span><span id="689c" class="mm kz in nx b gy of oc l od oe">          //split the advertised data from the respnse<br/>          let advdata= x[x.length-1].split(" ").pop()</span><span id="55ed" class="mm kz in nx b gy of oc l od oe">          //trim the advertised string to only get sensor response<br/>          const result = advdata.split(sensorID).slice(1).join(sensorID) </span><span id="72d0" class="mm kz in nx b gy of oc l od oe">          //get temperature and humidity value<br/>          let temp = result.substring(0, 4);<br/>          let hum = result.substring(4, 8);</span><span id="57ba" class="mm kz in nx b gy of oc l od oe">          //convert from hex to decimal and device by 100<br/>          temp = parseInt(temp, 16)/100<br/>          hum = (parseInt(hum, 16)/100).toFixed(1)  </span><span id="f4a3" class="mm kz in nx b gy of oc l od oe">          document.getElementById('loader').innerHTML = ''<br/>          document.getElementById('response').innerHTML = `Sensor ID : 05084FA3 &lt;br/&gt;<br/>          Temperature : ${temp} °C&lt;br/&gt;<br/>          Humidity : ${hum} %rH&lt;br/&gt;`              <br/>        })<br/>    })<br/>    <br/>  })</span></pre><p id="51fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">脚本 js 文件有两个按钮动作；连接并读取广告数据。</p><p id="bdd6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要更新脚本 js 第 13 行的传感器 ID。这个示例项目的传感器 ID 是 05084FA3，它是我们从 SHT85 获得的。</p><p id="78cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，该脚本查找包含传感器 ID 05084FA3 的广告数据。在获得广告数据后，我们将温度和湿度信息分离出来，并显示在我们的 index.html 页面上。</p><p id="602c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们需要一个网络捆扎机。我们可以使用<a class="ae jz" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank"> parcel.js </a></p><p id="5006" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦安装了包 js，让我们转到根目录并键入<strong class="kc io">“包索引. html”</strong>。这将启动我们的开发环境。</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/1ae611e4888480ca36860969e64e9443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cIMjdiCRHCgoUeY8.png"/></div></div></figure><p id="ce62" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们在浏览器上打开脚本，并选择加密狗连接的正确端口。</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/6d8934ee8014849fe5ebcbce718398c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*laXte6omwMhVQx6X.png"/></div></div></figure><p id="942b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该 web 脚本可以在 GitHub 资源库的 web script 文件夹中找到。</p></div></div>    
</body>
</html>