<html>
<head>
<title>Serving Embedded Static File Inside Subdirectory Using Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go在子目录中提供嵌入的静态文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/serving-embedded-static-file-inside-subdirectory-using-go-96e9d01a85dd?source=collection_archive---------11-----------------------#2021-12-30">https://blog.devgenius.io/serving-embedded-static-file-inside-subdirectory-using-go-96e9d01a85dd?source=collection_archive---------11-----------------------#2021-12-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c64be96a48533640ad8ffa194fbfead4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MheESJHj-kX1XQaR"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Unsplash上<a class="ae jz" href="https://unsplash.com/@iammrcup" rel="noopener ugc nofollow" target="_blank">@ iamrcup</a>的照片</figcaption></figure><h1 id="dd0a" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="9b93" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">正如Golang v1.16发布的包一样，现在你可以将你的任何文件包含到你的Golang二进制文件中。您还可以将嵌入的文件作为静态站点。但是当涉及到子目录时，您需要稍微不同地处理它。</p><p id="c20c" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">在本文中，您将了解如何将嵌入式文件作为存储在子目录中的静态站点。</p><h1 id="b306" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">目录结构</h1><pre class="mf mg mh mi gt mj lz mk ml aw mm bi"><span id="29da" class="mn kb in lz b gy mo mp l mq mr">$ tree .<br/>.<br/>├── frontend<br/>│   └── public<br/>│       ├── assets<br/>│       │   ├── css<br/>│       │   │   └── style.css<br/>│       │   └── js<br/>│       │       └── index.js<br/>│       └── index.html<br/>├── go.mod<br/>└── main.go</span></pre><h1 id="62da" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">HTML内容</h1><pre class="mf mg mh mi gt mj lz mk ml aw mm bi"><span id="d64d" class="mn kb in lz b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Document&lt;/title&gt;<br/>    &lt;link rel="stylesheet" href="assets/css/style.css"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    &lt;script src="/assets/js/index.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c765" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">为了测试是否可以使用<code class="fe lw lx ly lz b">absolute</code>和<code class="fe lw lx ly lz b">relative</code> URL导入<code class="fe lw lx ly lz b">assets</code>，可以像上面的代码片段一样编写<code class="fe lw lx ly lz b">link rel</code>和<code class="fe lw lx ly lz b">script src</code>。你可以在你的<code class="fe lw lx ly lz b">style.css</code>和<code class="fe lw lx ly lz b">index.js</code>里面放任何东西，只是为了确保它已经被加载。</p><h1 id="c924" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">问题是</h1><p id="8d08" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在<code class="fe lw lx ly lz b">embed</code>包发布之前，你曾经使用<code class="fe lw lx ly lz b">http.Dir</code>来服务一个静态站点，使用如下的Go:</p><pre class="mf mg mh mi gt mj lz mk ml aw mm bi"><span id="c655" class="mn kb in lz b gy mo mp l mq mr">package main</span><span id="954d" class="mn kb in lz b gy ms mp l mq mr">import (<br/>    "net/http"<br/>)</span><span id="a658" class="mn kb in lz b gy ms mp l mq mr">func dirHandler() http.Handler {<br/>    return http.FileServer(http.Dir("frontend/public"))<br/>}</span><span id="3859" class="mn kb in lz b gy ms mp l mq mr">func main() {<br/>    http.ListenAndServe(":8000", dirHandler())<br/>}</span></pre><p id="299c" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">是的，它非常有效。但是，说到<code class="fe lw lx ly lz b">embed</code>:</p><pre class="mf mg mh mi gt mj lz mk ml aw mm bi"><span id="a883" class="mn kb in lz b gy mo mp l mq mr">package main</span><span id="6296" class="mn kb in lz b gy ms mp l mq mr">import (<br/>    "embed"<br/>    "net/http"<br/>)</span><span id="7af8" class="mn kb in lz b gy ms mp l mq mr">//go:embed frontend/public<br/>var public embed.FS</span><span id="82e3" class="mn kb in lz b gy ms mp l mq mr">func fsHandler() http.Handler {<br/>    return http.FileServer(http.FS(public))<br/>}</span><span id="63bc" class="mn kb in lz b gy ms mp l mq mr">func main() {<br/>    http.ListenAndServe(":8000", fsHandler())<br/>}</span></pre><p id="b26e" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">它不起作用，因为你没有指定哪个子目录将被服务。<code class="fe lw lx ly lz b">http.FS</code>将提供来自<code class="fe lw lx ly lz b">root</code>的嵌入文件，这就是为什么你需要使用<code class="fe lw lx ly lz b"><a class="ae jz" href="http://localhost:8000/frontend/public/." rel="noopener ugc nofollow" target="_blank">http://localhost:8000/frontend/public/</a></code> <a class="ae jz" href="http://localhost:8000/frontend/public/." rel="noopener ugc nofollow" target="_blank">而不是<code class="fe lw lx ly lz b">http://localhost:8000/</code>来访问它。</a></p><p id="54ae" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">但另一个问题是，它使您的<code class="fe lw lx ly lz b">absolute</code>导入无法工作。<code class="fe lw lx ly lz b">/assets/js/index.js</code>将不工作，因为它从<code class="fe lw lx ly lz b">root</code>访问文件。</p><h1 id="00af" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">解决方案</h1><p id="ae75" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">为了解决这些问题，您可以使用<code class="fe lw lx ly lz b">fs.Sub</code>来获得<code class="fe lw lx ly lz b">embedded</code>文件的子树。所以您可以开始将<code class="fe lw lx ly lz b">frontend/public</code>目录作为根目录。</p><pre class="mf mg mh mi gt mj lz mk ml aw mm bi"><span id="7379" class="mn kb in lz b gy mo mp l mq mr">//go:embed frontend/public<br/>var public embed.FS</span><span id="f2f2" class="mn kb in lz b gy ms mp l mq mr">func fsHandler() http.Handler {<br/>    sub, err := fs.Sub(public, "frontend/public")<br/>    if err != nil {<br/>        panic(err)<br/>    }</span><span id="52c1" class="mn kb in lz b gy ms mp l mq mr">return http.FileServer(http.FS(sub))<br/>}</span></pre><p id="98d3" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">现在，您可以使用<code class="fe lw lx ly lz b">http://localhost:8000/</code>访问该站点，并且您的<code class="fe lw lx ly lz b">relative</code>和<code class="fe lw lx ly lz b">absolute</code>导入再次工作！</p><p id="2d49" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">感谢您的阅读！</p></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><p id="4a51" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated"><em class="na">最初发布于2021年12月30日</em><a class="ae jz" href="https://clavinjune.dev/en/blogs/serving-embedded-static-file-inside-subdirectory-using-go/" rel="noopener ugc nofollow" target="_blank"><em class="na">https://clavinjune . dev</em></a><em class="na">。</em></p></div></div>    
</body>
</html>