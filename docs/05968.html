<html>
<head>
<title>Using SQLite In Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Flutter 中使用 SQLite</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-sqlite-in-flutter-4b16e5ef36dc?source=collection_archive---------0-----------------------#2021-11-29">https://blog.devgenius.io/using-sqlite-in-flutter-4b16e5ef36dc?source=collection_archive---------0-----------------------#2021-11-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c93a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文将使用<strong class="jm io"> sqflite </strong>插件离线保存结构化数据，并在 Flutter 应用程序中创建数据库、存储、更新和删除数据(CRUD)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ea2fd104fc0c4c42988990f19338b705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*q7KGE3gFx20anUXljP7RVw.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 Flutter 鲁美数字中使用 SQLite(UI 的一部分由 Mitesh Chodvadiya 设计)</figcaption></figure><h1 id="d54e" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤第 1 部分:开始</h1><p id="6191" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated"><strong class="jm io"> Flutter </strong>是一款移动应用 SDK，用于为 iOS 和 Android 构建高性能、高保真的应用。Flutter 与现有代码一起工作，被世界各地的开发人员和组织使用，并且是免费和开源的。</p><p id="6aa8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文将向您展示如何在更短的时间内构建漂亮、高性能的应用程序，并使用一个小型的<strong class="jm io"> SQLite </strong>数据库在本地保存和操作数据。</p><p id="29c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">SQLite 数据库是一个轻量级的嵌入式数据库。它的数据库是一个文件。<strong class="jm io"> SQLite </strong>通常被移动设备、中小型流量网站用于版本转换系统、财务分析工具、媒体编目和编辑套件、CAD 软件包、记录保存程序等。使用<strong class="jm io"> SQLite </strong>的优点包括<strong class="jm io"> : </strong></p><p id="aee0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅It 可以用于任何编程语言和任何设备</p><p id="0d64" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">数据库的✅The 大小通常限制为 2GB</p><p id="d257" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅和更多关于 W3C 学校的信息</p><h1 id="9ae0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">目录</h1><ul class=""><li id="1193" class="mc md in jm b jn lw jr lx jv me jz mf kd mg kh mh mi mj mk bi translated">在颤振中启用<strong class="jm io"> Sqflite </strong></li><li id="cc83" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">在颤振中创建模型</li><li id="d0dc" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">使用 Flutter 中的模型创建表格</li><li id="82d2" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">在 SQLite 中插入/更新/删除(CRUD)数据</li><li id="4b2c" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">在 Flutter 中显示 SQLite 中的数据</li><li id="ac16" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">优化 SQLite 的颤振性能</li><li id="21da" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">下载 SQLite 文件</li><li id="c04b" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">升级 SQLite 中的表模式</li></ul><h1 id="cf50" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤第二部分:在颤振中启用<strong class="ak"> Sqflite </strong></h1><p id="2cc5" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated"><strong class="jm io"> <em class="mq"> SQLite </em> </strong>是一个开源的关系数据库，可以用来存储和操作数据，如添加、删除和移除数据。</p><p id="6abf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它不需要服务器或后端代码，所有数据都保存在设备上的文本文件中。请点击查看更多信息。</p><p id="f79f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">步骤 1️⃣:将<strong class="jm io"> sqflite </strong>包添加到 pubspec.yaml 中</p><p id="1df0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">访问<a class="ae mb" href="https://pub.dev/packages/sqflite/install" rel="noopener ugc nofollow" target="_blank"> pub.dev </a>并在文件<code class="fe mr ms mt mu b">pubspec.yaml</code>中添加<code class="fe mr ms mt mu b">sqflite:^2.0.0+4</code></p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="f53c" class="mz kz in mu b gy na nb l nc nd">environment:<br/>  sdk: "&gt;=2.12.0 &lt;3.0.0"</span><span id="29fa" class="mz kz in mu b gy ne nb l nc nd">dependencies:<br/>  flutter:<br/>    sdk: flutter<br/>  sqflite: ^2.0.0+4<br/>  path: ^1.8.0</span></pre><p id="daf6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 2️⃣:在 Flutter 中添加<code class="fe mr ms mt mu b">path:^1.8.0</code>插件</p><p id="aa2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">path 插件是 Dart 的跨平台路径操作库，它有助于指定包含数据库的文件的位置。</p><p id="49c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，如果要加入数据库的路径:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/23a14d9ceec34085ba346ccc1acba51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Cs8C6mwpOr4gck0Zcltbnw.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">将<strong class="bd la"> Sqflite </strong>包添加到 Flutter-鲁美数字</figcaption></figure><p id="bcd0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第一步</strong> 3️⃣:跑酒馆找人</p></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><h1 id="69f3" class="ky kz in bd la lb nn ld le lf no lh li lj np ll lm ln nq lp lq lr nr lt lu lv bi translated">你会支持 awesome❤️</h1><blockquote class="ns nt nu"><p id="d415" class="jk jl mq jm b jn jo jp jq jr js jt ju nv jw jx jy nw ka kb kc nx ke kf kg kh ig bi translated">请帮我获得 100 名追随者。</p></blockquote></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><h1 id="04da" class="ky kz in bd la lb nn ld le lf no lh li lj np ll lm ln nq lp lq lr nr lt lu lv bi translated">🟤在 SQLite 中创建了一个表</h1><p id="cf1d" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 1️⃣:在服务文件夹中创建一个<code class="fe mr ms mt mu b">sqlite_service.dart </code>文件。</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="2941" class="mz kz in mu b gy na nb l nc nd">import 'package:sqflite/sqflite.dart';<br/>import 'package:path/path.dart';</span><span id="1dee" class="mz kz in mu b gy ne nb l nc nd">class SqliteService {<br/>  Future&lt;Database&gt; initializeDB() async {<br/>    String path = await getDatabasesPath();<br/>    <br/>    return openDatabase(<br/>      join(path, 'database.db'),<br/>      onCreate: (database, version) async {<br/>         await database.execute( <br/>           "CREATE TABLE Notes(id INTEGER PRIMARY KEY AUTOINCREMENT,  <br/>           description TEXT NOT NULL)",<br/>      );<br/>     },<br/>     version: 1,<br/>    );<br/>  }<br/>}</span></pre><p id="e5ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 2️⃣:初始化数据库</p><p id="79fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">getDatabasePath()</code>:获取默认的数据库位置。</p><p id="08e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">openDatabase()</code>:接受一个强制的<code class="fe mr ms mt mu b">String</code>作为参数，它是数据库的路径。</p><p id="89a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅:我们使用包<code class="fe mr ms mt mu b">path</code>中的方法<code class="fe mr ms mt mu b">join()</code>把给定的路径连接成一个单一的路径，例如我们会得到<code class="fe mr ms mt mu b">databasepath/database.db</code>。</p><p id="61af" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">onCreate()</code>回调:第一次创建数据库时会调用它，它会执行上面的 SQL 查询来创建表<code class="fe mr ms mt mu b">notes</code>。这是创建表和初始填充表的地方。</p><h1 id="d6fd" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤第 3 部分:创建一个颤振模型</h1><p id="124f" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">我们的目标是将数据保存到数据库，例如，保存待办事项列表应用程序的注释列表，因此我们创建了一个类<code class="fe mr ms mt mu b">Note</code>，它将包含与注释相关的不同字段。</p><p id="4041" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本上，这个模型定义了可以从数据库的表中提取的字段。</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="c546" class="mz kz in mu b gy na nb l nc nd">class Note{ <br/>  final int id; <br/>  final String description;<br/>   <br/>  Note({this.id, this.description});<br/>  <br/>  Note.fromMap(Map&lt;String, dynamic&gt; item): <br/>    id=item["id"], description= item["description"];<br/>  <br/>  Map&lt;String, Object&gt; toMap(){<br/>    return {'id':id,'description': description};<br/>  }<br/>}</span></pre><p id="4711" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们创建了一个名为<code class="fe mr ms mt mu b">Note.fromMap()</code>的命名构造函数和一个名为<code class="fe mr ms mt mu b">toMap()</code>的方法，将数据转换成映射，反之亦然，以操作 SQLite 数据库中的数据。</p><h1 id="695f" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤在 SQLite 中将数据插入到一个表中</h1><p id="3a75" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">让我们开始在<code class="fe mr ms mt mu b">sqlite_service.dart </code>文件中创建 CRUD 方法</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="e9c0" class="mz kz in mu b gy na nb l nc nd">class SqliteService{<br/>  <br/>  Future&lt;int&gt; createItem(Note note) async {<br/>    int result = 0;<br/>    final Database db = await initializeDB();<br/>    final id = await db.insert(<br/>      'Notes', note.toMap(), <br/>      conflictAlgorithm: ConflictAlgorithm.replace);</span><span id="6583" class="mz kz in mu b gy ne nb l nc nd">   }<br/>}</span></pre><p id="1848" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">createItem()</code>会记下一张纸条，然后将纸条插入表格<code class="fe mr ms mt mu b">Notes</code>。</p><p id="c575" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">insert()</code>方法:它接受两个参数<code class="fe mr ms mt mu b">String table, Map&lt;String, Object?&gt; values</code>，这就是为什么我们在模型类中创建一个<code class="fe mr ms mt mu b">toMap()</code>方法。</p><h1 id="80b7" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤从 SQLite 的一个表中获取数据</h1><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="0dd8" class="mz kz in mu b gy na nb l nc nd">class SqliteService{ <br/>  Future&lt;List&lt;Note&gt;&gt; getItems() async {<br/>    final db = await SqliteService.initizateDb();<br/>    final List&lt;Map&lt;String, Object?&gt;&gt; queryResult = <br/>      await db.query('Notes', orderBy: NoteColumn.createdAt);<br/>    return queryResult.map((e) =&gt; Note.fromMap(e)).toList();<br/>  }<br/>}</span></pre><p id="d029" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅我们使用<code class="fe mr ms mt mu b">query()</code>这个方法接受一个字符串扩充<code class="fe mr ms mt mu b">Notes</code>，它是从表<code class="fe mr ms mt mu b">Notes</code>中检索所有列的表名。</p><p id="be88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅<code class="fe mr ms mt mu b">queryResult</code>返回一个<code class="fe mr ms mt mu b">List</code>，所以我们使用<code class="fe mr ms mt mu b">map()</code>方法将<code class="fe mr ms mt mu b">List&lt;Map&lt;String, Object?&gt;&gt;</code>转换为<code class="fe mr ms mt mu b">List&lt;Note&gt;</code>。</p><h1 id="338c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤第 4 部分:在 SQLite 中从表中删除数据</h1><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="a1f3" class="mz kz in mu b gy na nb l nc nd">class SqliteService{</span><span id="bf5b" class="mz kz in mu b gy ne nb l nc nd">  // Delete an note by id<br/>  Future&lt;void&gt; deleteItem(String id) async {<br/>   final db = await SqliteService.initizateDb();</span><span id="876b" class="mz kz in mu b gy ne nb l nc nd">    try {<br/>      await db.delete("Notes", where: "id = ?", whereArgs: [id]);<br/>    } catch (err) {<br/>      debugPrint("Something went wrong when deleting an item: $err");<br/>    }<br/>  }<br/>}</span></pre><p id="31e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅<code class="fe mr ms mt mu b">delete()</code>方法:我们传递表名并指定我们想要删除表中的行的列。</p><h1 id="0bd1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤显示来自 SQLite 的数据</h1><p id="4ae2" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">我们创建了一个表单，允许用户填写包括注释描述在内的数据。提交表单时，数据将存储在表格的相应列中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/59ca4fa8b0497721c87dfbcc6a5adf85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZoD3EdIf5rfBAkZCQdhHJQ.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 Flutter 鲁美数码中使用<strong class="bd la"> SQLite </strong></figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/0d47595eeba02bfdabcf72fef571048e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrF7rwqNoj9QPurZP0JKxA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 Flutter 中使用<strong class="bd la">SQLite</strong>——鲁美数码</figcaption></figure><p id="2ccc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将有两个屏幕。让我们从<strong class="jm io">主页</strong>屏幕开始:</p><p id="1c5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">步骤 1️⃣:初始化有状态小部件中的<code class="fe mr ms mt mu b">SqliteService </code>类。</p><p id="41c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mr ms mt mu b">_HomePageState</code>中，我们添加了下面的代码:</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="cf2b" class="mz kz in mu b gy na nb l nc nd"><strong class="mu io">class</strong> <strong class="mu io">_HomePageState</strong> <strong class="mu io">extends</strong> State<strong class="mu io">&lt;</strong>MyHomePage<strong class="mu io">&gt;</strong> <strong class="mu io">{</strong><br/><br/>  late SqliteService _sqliteService<strong class="mu io">;</strong><br/><br/>  @override<br/>  <strong class="mu io">void</strong> initState<strong class="mu io">()</strong> <strong class="mu io">{</strong><br/>    <strong class="mu io">super.</strong>initState<strong class="mu io">();</strong><br/>    <strong class="mu io">this.</strong>_sqliteService<strong class="mu io">=</strong> SqliteService<strong class="mu io">();</strong><br/>    <strong class="mu io">this.</strong>_sqliteService<strong class="mu io">.</strong>initializeDB<strong class="mu io">().</strong>whenComplete<strong class="mu io">(()</strong> async <strong class="mu io">{</strong><br/>      await _refreshNotes<strong class="mu io">();</strong><br/>      setState<strong class="mu io">(()</strong> <strong class="mu io">{});</strong><br/>    <strong class="mu io">});</strong><br/>  <strong class="mu io">}</strong></span></pre><p id="eae6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们创建一个类<code class="fe mr ms mt mu b">SqliteService()</code>的实例，然后调用<code class="fe mr ms mt mu b">initalizeDb()</code>来创建包含<code class="fe mr ms mt mu b">Notes</code>表的数据库。当<code class="fe mr ms mt mu b">Future</code>完成时，我们调用<code class="fe mr ms mt mu b">_refreshNotes()</code>来获取表中的属性列表。</p><p id="27e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mr ms mt mu b">_refreshNotes()</code>中，我们会有以下内容:</p><p id="b161" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">步骤 2️⃣:从主屏幕上的 SQLite 中获取数据</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="e778" class="mz kz in mu b gy na nb l nc nd">// All items<br/>List&lt;Note&gt; _notes = [];</span><span id="88e3" class="mz kz in mu b gy ne nb l nc nd">// This function is used to fetch all data from the database<br/>void _refreshNotes() async {</span><span id="03fd" class="mz kz in mu b gy ne nb l nc nd">  final data = await SqliteService.getItems();<br/>  setState(() {<br/>    _notes = data;<br/>  });<br/>}</span></pre><p id="f2c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅我们称之为<code class="fe mr ms mt mu b">getItems()</code>类中定义的<code class="fe mr ms mt mu b">SqliteService().</code>方法</p><p id="dac7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完成后，将调用<code class="fe mr ms mt mu b">setState(() {});</code>，这将重建小部件树。</p><h1 id="1b18" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤优化 SQLite 的颤振性能</h1><p id="00fe" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 1️⃣:将数据库添加到<code class="fe mr ms mt mu b">assets</code>文件夹中</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="8d1d" class="mz kz in mu b gy na nb l nc nd">assets/database.db</span></pre><p id="03c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 2️⃣:在文件中指定资产<code class="fe mr ms mt mu b">pubspec.yaml</code></p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="cfa2" class="mz kz in mu b gy na nb l nc nd">flutter:<br/>  assets:<br/>    - assets/<!-- -->database<!-- -->.db</span></pre><p id="41cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤</strong> 3️⃣:将数据库复制到你的文件系统中</p><p id="463a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您需要从资产中获得一个新的副本，还是总是复制资产，这取决于您。为了获得更好的性能，最好只复制资源一次，然后打开副本。</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="a584" class="mz kz in mu b gy na nb l nc nd">import 'package:path/path.dart';<br/>import 'dart:typed_data';<br/>import 'package:flutter/services.dart';</span><span id="3b54" class="mz kz in mu b gy ne nb l nc nd">var databasesPath = await getDatabasesPath();<br/>var path = join(databasesPath, "database.db");<br/><br/>// Check if the database exists<br/>var exists = await databaseExists(path);<br/><br/>if (!exists) {<br/>  // Should happen only the first time you launch your application<br/>  print("Creating new copy from asset");<br/><br/>  // Make sure the parent directory exists<br/>  try {<br/>    await Directory(dirname(path)).create(recursive: true);<br/>  } catch (_) {}<br/>    <br/>  // Copy from asset<br/>  ByteData data = await rootBundle.load(join("assets", "database.db"));<br/>  List&lt;int&gt; bytes =<br/>  data.buffer.asUint8List(data.offsetInBytes, data.lengthInBytes);<br/>  <br/>  // Write and flush the bytes written<br/>  await File(path).writeAsBytes(bytes, flush: true);<br/><br/>} else {<br/>  print("Opening existing database");<br/>}<br/>// open the database<br/>db = await openDatabase(path, readOnly: true);</span></pre><h1 id="23bf" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤下载了 SQLite 文件</h1><p id="f04b" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">默认情况下，数据库文件保存在 Android 设备上的文件夹<strong class="jm io">data/data/your package name/databases</strong>中，而在 iOS 和 macOS 上，它是 Documents 目录。</p><p id="7638" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想检查文件目录，下面的语句将显示路径:</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="37d1" class="mz kz in mu b gy na nb l nc nd">String path = await getDatabasesPath();</span></pre><p id="eba2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本教程中，包名为<strong class="jm io"> com.lumeidigital.v2 </strong>。如果我在 Android Studio 上打开设备文件浏览器，我可以通过访问<strong class="jm io">data/data/com . lumeidigital . v2/databases 来访问数据库文件。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/263fccd9f95ee30cae39da114fe3bbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zGDh-0kvW8zv0XKnqh5WQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">SQLite 在 Flutter 中的应用——鲁美数码</figcaption></figure><p id="ef14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，选择<strong class="jm io">数据库</strong>并下载扩展名为<strong class="jm io">的数据库。db，</strong>右击数据库名称，将文件保存在任何需要的位置，但记住位置，然后点击<strong class="jm io">另存为</strong>对话框中的<strong class="jm io">确定</strong>。</p><p id="f8d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了查看数据库，我们需要一个 SQLite 浏览器，你可以从 https://sqlitebrowser.org/dl/<a class="ae mb" href="https://sqlitebrowser.org/dl/" rel="noopener ugc nofollow" target="_blank">下载 SQLite 浏览器。从上面的链接为您的设备下载一个合适的 SQLite 浏览器并打开它。</a></p><p id="519d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果使用的是 VS 代码，可以下载一个名为<strong class="jm io"> SQLite </strong>的扩展，打开<strong class="jm io"> database.db. </strong></p><blockquote class="ns nt nu"><p id="00a8" class="jk jl mq jm b jn jo jp jq jr js jt ju nv jw jx jy nw ka kb kc nx ke kf kg kh ig bi translated"><strong class="jm io"> ctrl + shift + p </strong>打开数据库</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/fc6dd0b046d04a5c4cd0d0b0a90b1cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwCWRWzb-iYrBdvXHTjg1w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">SQLite 在 Flutter 中的应用——鲁美数码</figcaption></figure><h1 id="5aa2" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤升级 SQLite 中的表模式</h1><p id="1ca2" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">在 SQLite 中，当数据库打开时，<code class="fe mr ms mt mu b">onCreate()</code>和<code class="fe mr ms mt mu b">onUpgrade()</code>被调用。版本号是传递给构造函数的 int 参数，保存在 SQLite 数据库文件中。</p><p id="95c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">onCreate()</code>回调:当数据库文件不存在并且刚刚创建时调用。如果<code class="fe mr ms mt mu b">onCreate()</code>成功返回并且没有抛出异常，则认为数据库是用请求的版本号创建的。</p><p id="5978" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">✅ <code class="fe mr ms mt mu b">onUpgrade()</code>回调:当数据库文件存在但版本号低于构造函数中请求的版本号时调用。基本上，它是在数据库需要升级时使用的。实现应该使用这个方法来删除表、添加表或执行任何其他需要升级到新模式版本的操作。</p><p id="67ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mr ms mt mu b">onUpgrade()</code>应该将表模式更新到所请求的版本。</p><pre class="kj kk kl km gt mv mu mw mx aw my bi"><span id="168f" class="mz kz in mu b gy na nb l nc nd">Future&lt;Database&gt; initializeDB() async {<br/>    String path = await getDatabasesPath();</span><span id="63b0" class="mz kz in mu b gy ne nb l nc nd">    return openDatabase(<br/>      join(path, 'database.db'),<br/>      onCreate: (database, version) async {<br/>         await database.execute( "CREATE TABLE properties(id INTEGER PRIMARY KEY AUTOINCREMENT, address TEXT NOT NULL)",<br/>      );<br/>     },<br/>     version: 1,<br/>     on<!-- -->Upgrade<!-- -->: (database, oldVersion, newVersion){()=&gt; ....}<br/>    );<br/>  }</span></pre><p id="cc96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更改表模式的两种方法:</p><p id="7b3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">1️⃣:删除旧的数据库文件，因此再次运行<code class="fe mr ms mt mu b">onCreate()</code>回调。在开发期间，当您对已安装的版本有更多的控制并且数据丢失不是问题时，这是完美的。</p><p id="270f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2️⃣:增加版本号，这样就调用了<code class="fe mr ms mt mu b">onUpgrade()</code>回调。在开发期间，当数据丢失不成问题时，您可以执行类似于<code class="fe mr ms mt mu b">DROP TABLE IF EXIST &lt;table name&gt; </code>的 SQL 来删除现有的表，并调用<code class="fe mr ms mt mu b">onCreate()</code>来重新创建数据库。</p><p id="e75d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是，如果发布了应用程序，您需要在<code class="fe mr ms mt mu b">onUpgrade()</code>回调中实现数据迁移，这样您的用户就不会丢失他们的数据。</p><h1 id="35f0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">🟤其他数据库集成</h1><p id="7a43" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">总是需要存储数据。以下是一些可以与 Flutter 一起使用的数据库:</p><ul class=""><li id="791b" class="mc md in jm b jn jo jr js jv ob jz oc kd od kh mh mi mj mk bi translated"><a class="ae mb" href="https://firebase.flutter.dev/docs/overview/" rel="noopener ugc nofollow" target="_blank">燃烧基地</a></li><li id="0916" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated"><a class="ae mb" href="https://supabase.io/" rel="noopener ugc nofollow" target="_blank"> Supabase </a></li><li id="9625" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated"><a class="ae mb" href="https://pub.dev/packages/hive" rel="noopener ugc nofollow" target="_blank"> Hive </a>(本地数据库)</li><li id="7c53" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated"><a class="ae mb" href="https://pub.dev/packages/moor" rel="noopener ugc nofollow" target="_blank">摩尔</a>(本地数据库)</li></ul></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><h1 id="5d3e" class="ky kz in bd la lb nn ld le lf no lh li lj np ll lm ln nq lp lq lr nr lt lu lv bi translated">更多教程:</h1><ul class=""><li id="b1e3" class="mc md in jm b jn lw jr lx jv me jz mf kd mg kh mh mi mj mk bi translated"><a class="ae mb" href="https://medium.com/@lumeilin301/flutter-animation-tutorial-4eb560eace48" rel="noopener">颤振动画教程</a></li><li id="dae2" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated"><a class="ae mb" href="https://medium.com/@lumeilin301/flutter-firebase-app-tutorial-part-1-get-started-95cce84939c3" rel="noopener">飘起&amp; Firebase App 教程</a></li></ul><h1 id="6f05" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">你会支持 awesome❤️</h1><blockquote class="ns nt nu"><p id="950a" class="jk jl mq jm b jn jo jp jq jr js jt ju nv jw jx jy nw ka kb kc nx ke kf kg kh ig bi translated">请帮我获得 100 名追随者。</p></blockquote><p id="52d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">关键词:</strong> Flutter，SQLite，数据库，CRUD。</p><p id="d02b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">👉<em class="mq">源代码在</em> <a class="ae mb" href="https://github.com/lumei301/flutter-sqlite" rel="noopener ugc nofollow" target="_blank"> <em class="mq"> Github </em> </a>上更新</p></div></div>    
</body>
</html>