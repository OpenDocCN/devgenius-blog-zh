# 了解前端开发人员的环境变量

> 原文：<https://blog.devgenius.io/understand-env-variables-for-frontend-developers-229bafa252a8?source=collection_archive---------1----------------------->

现在有很多工具可以帮助快速创建单页面应用程序。
例如，要创建 React 应用程序，我们可以使用 Create React App，它为我们提供了一个现成的代码应用程序。
这很好，因为它节省了设置应用程序运行所需的配置和设置的时间。
此类应用程序的设置通常非常相似，这一步可以自动完成。坏的一面是有很多“奇迹”发生。许多代码开箱即用，很容易丢失，也不知道为什么会发生一些事情。当错误出现时，或者当我们必须准备应用程序投入生产时，这可以给我们一个思考的时间。
开发和生产环境不同，需要不同的设置。
这些“神奇的事情”之一是`.env`文件。
我见过许多开发人员在类似 [Heroku](https://www.heroku.com/) 、 [Netlify](https://www.netlify.com/) 或 [Vercel](https://vercel.com/) 的服务中使用`.env` 文件并设置`env` var，但仍然不清楚他们在做什么。
更好地理解什么是 env 变量，系统如何使用它们，以及像 React 这样的框架如何使用它们，极大地帮助了我更加自信地编码和部署。因此，这里是我尝试传递我获得的知识。

方便阅读的小字典:

*   **Shell** :处理命令并返回输出的程序。
*   **终端**(也叫命令行/命令提示符/Power Shell——基于使用的系统):接受命令的文本界面。是运行外壳的包装程序。
*   **Bundle** :取多个文件和资产，组合成一个大文件的过程。
*   **环境**:可以指系统环境(稍后会有更好的解释)或应用环境，可以是开发、生产、测试、试运行…
*   机器:可以是本地计算机，也可以是远程服务器。

# **外壳环境**

让我们从头开始，理解这些 env 变量是什么。
当我们在 shell 中编写一个命令时，它会被执行，我们会得到一个“答案”或者更好的调用输出。为了能够执行这些命令，shell 需要大量的信息。它需要知道这些命令的含义，以及在哪里可以找到命令所要求的信息。
外壳从系统设置文件(包含如何运行系统的信息的文件)和/或用户设置文件(保存特定用户信息的文件，即默认浏览器、终端字体大小等)中获取部分信息。
这些文件保存在机器上的某个地方，共同创建一个称为`environment`的地方。
由于环境的原因，shell 可以跟踪所有这些信息和配置。

在大多数系统中，配置存储在这些文件中:
-`/etc/environment`-用于保存所有系统的变量
-`/etc/profile`-用于保存特定于 shell 的变量。
-`~/.bashrc`-只有在使用 bash 的情况下才存在。这里保存了 bash 的特定于 shell 的变量。它将和`~/.profile`一起被阅读。如果找到其中一个文件，shell 将首先读取这些文件，然后读取`/etc/profile`。

您可以测试并查看哪些环境变量已经保存在您的计算机中，只需在终端中运行以下命令:

```
$ printenv
```

*(你也可以试着用* `*env.*` *如果这些都不起作用，请检查如何列出 env 变量以及你正在使用的操作系统和命令行。)*

输出应该是一长串以`KEY=value`形式编写的键-值对，如下所示:

```
CHROME_DESKTOP=Hyper.desktop
GJS_DEBUG_OUTPUT=stderr
LESSCLOSE=/usr/bin/lesspipe %s %s
XDG_SESSION_CLASS=user
TERM=xterm-256color
LC_IDENTIFICATION=de_DE.UTF-8
ZSH=/home/myuser/.oh-my-zsh
LESSOPEN=| /usr/bin/lesspipe %s
DISPLAY=:0
SHLVL=2
NVM_CD_FLAGS=
PAGER=less
LC_TELEPHONE=de_DE.UTF-8
QT_IM_MODULE=ibus
LC_MEASUREMENT=de_DE.UTF-8
SPACESHIP_VERSION=3.11.2
XDG_RUNTIME_DIR=/run/user/1000
```

如果您想查看单个变量的值，只需键入:

```
$ echo $CHROME_DESKTOP
```

其中一些文件是在 shell 登录时读取的(基本上是第一次打开终端提示符或通过 ssh 登录到远程服务器)，其他文件是在启动新的 bash 实例时加载的。
这意味着可能会发生这样的情况:定义一个变量，然后尝试在控制台上打印该值，或者使用该变量，但该变量仍未定义。
在大多数情况下，你可以通过简单地关闭你的终端然后再打开它来解决这个问题。
设置新变量时，最好关闭并再次打开终端程序，或者至少打开一个新窗口。如果你正处于这种情况，并且想了解更多，我建议你阅读“在 shell 中设置局部和全局 env 变量”和“什么是子 shell”。

**概括一下:** 每台机器都有一组配置文件，作为 shell 获取信息以执行命令、运行程序、传递信息、进行计算等等的环境。
借助环境变量，我们可以在配置文件中设置这些信息。
这些到目前为止，只存在于我们的机器中。

# 无法从客户端代码访问 Env 变量

我刚刚说过 env 变量存在于机器中，因此如果我们想要与它们交互，我们需要一种与系统通信的方式。
浏览器无法访问系统，因此无法访问本地或服务器环境变量。
这意味着普通的 Javascript 项目，只有 HTML/Css 网站、jQuery 或类似的项目不能开箱即用地访问环境变量。

我们如何访问它们以便在仅前端的应用程序中使用？
有两个层次可以使用:**基础设施**和**应用**。

*   基础设施是关于在系统中直接保存环境变量。如果你已经用 Heroku 或 Vercel 部署了一个应用，当你在应用配置管理界面中插入 env 变量时，就会发生这种情况。这里，像 Docker Compose 或 Kubernetes 这样的工具用于处理 env 变量。
*   **应用-** 级逻辑是当我们使用`.env`文件时。几乎每种编程语言都有一个包或库，可以用来从`.env`文件中读取环境变量。
    如果我们在 Nodejs 中工作，一个常见的包是`[dotenv](https://www.npmjs.com/package/dotenv).`
    重要的是要了解这样一个包是如何工作的，以了解我们如何在应用程序中使用 env 变量。
    `Dotenv`从`.env`文件中加载变量，并将其添加到`process.env.`
    Process.env 是一个 Nodejs 全局对象，用于存储系统变量。
    这样，它们在代码中很容易被访问。

# 什么是 Env 文件

`.env`文件只是一个文本文件。
该文本文件用于存储通常位于应用程序外部，但应用程序运行计算时需要的信息。请记住，环境变量是 config，所以我们应用程序的环境变量基本上就是应用程序配置。
一个应用的*配置*在不同的应用环境(开发、试运行、生产、测试、..).这就是我们通常想要保存在`.env`文件中的信息。

现代应用程序通常使用`.env`文件来存储数据库 url 或 API 键。
这些是必须保密的信息，因此我们将它们保存在应用程序之外。
在应用程序之外存储这些敏感信息的一种方法是将它们保存在系统中，然后告诉我们的应用程序从系统中获取它们。如果我们在本地工作，系统就是我们自己的计算机。
如果我们在线部署我们的应用程序，系统是由我们选择的托管解决方案提供的远程服务器。(可以是 Heroku，Vercel，也可以是其他任何解决方案。)

另一种方法是将它们存储在`.env`文件中。
这允许我们拥有特定于应用环境的 env 变量(开发、生产、暂存、..)，都是分组的，而且只是针对某个项目。如前所述，在这种情况下，我们可以使用一个像`dotenv`这样的包，它读取变量列表并将它们添加到某个可以从我们的应用程序访问的对象中。

# **为什么可以用。env 文件与我的 React 应用程序？**

当我们使用前端框架或像 React 这样的库时，我们没有后端环境，所以我们怎么可能访问 env 变量呢？
我们使用`dotenv`包访问它们，该包直接与 Nodejs 通信，但是我们的 React 应用程序中没有 Nodejs，这怎么可能呢？

*React 实际上使用 Node.js 来编译和优化 JavaScript 代码，并轻松创建 UI 测试用例。它是在一个构建工具 [Webpack](https://webpack.js.org/) 的帮助下完成的。*

## **什么是 webpack？**

简单来说，Webpack 是一个创建资产捆绑包的工具。它的主要重点是捆绑 Javascript 文件，以便能够在浏览器中使用它们，但它可以做得更多。
Webpack 可以用于任何资产，如 CSS 文件、图像或视频，可以转换、编译 es6/es7、优化我们的源代码，等等。
Webpack 有一个强大的插件和加载器生态系统，允许进行许多操作，这通常是 Webpack 变得混乱和复杂的时候。
Webpack 并不是唯一的构建工具， [Rollup](https://rollupjs.org/guide/en/) 或[package](https://parceljs.org/)也是众所周知的工具。
[React 没有自带的构建工具](https://reactjs.org/docs/code-splitting.html#bundling)，需要设置。
像 Create React App、 [Gatsbyjs](https://www.gatsbyjs.com/) 或者 [Nextjs](http://nextjs.org/) 这样的框架，自带的构建工具已经就位，大部分时间都是 Webpack。

# **我可以在非 react 应用程序中使用环境变量吗？**

像 Webpack 或 package 这样的内置工具并不局限于任何特定的生态系统或框架。它们可以用于任何类型的应用程序，甚至是由少量 html、css 和 js 文件组成的静态网站。在你的项目中使用这些构建工具之一将允许你使用像`dotenv`这样的包，并且能够访问 env 变量。Webpack 基于 nodejs 和 npm，它需要这两者才能工作。
如果你决定使用 Webpack，考虑将这些依赖项添加到你的项目中。像 Parcel 这样的构建工具具有更简单的设置，可能不需要任何依赖。

请注意，env 变量并不是在不同的应用程序环境中存储敏感信息的唯一解决方案。例如，可以在代码中添加检查，以便根据应用程序环境运行不同的配置文件。一如既往，最佳解决方案取决于你的具体项目、需求和目标。希望有了这些知识，你会更容易理解选择哪个工具以及如何解决与环境变量相关的问题。