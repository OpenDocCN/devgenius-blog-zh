<html>
<head>
<title>Permissions in Jetpack compose with Accompanist Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack ä¸­çš„æƒé™ä¸ä¼´å¥åº“ä¸€èµ·æ„æˆ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/permissions-in-jetpack-compose-with-accompanist-library-15c90404fe48?source=collection_archive---------6-----------------------#2022-09-26">https://blog.devgenius.io/permissions-in-jetpack-compose-with-accompanist-library-15c90404fe48?source=collection_archive---------6-----------------------#2022-09-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f733a9845216cde2d85158cd8184cb59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0kjEXZXng1Gfo4yMf0scw.png"/></div></div></figure><p id="73e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨ Jetpack Compose ä¸­è¯·æ±‚æƒé™ï¼Œä»¥åŠå¦‚ä½•ç›‘å¬å’Œæ›´æ–° UI ä¸­çš„æƒé™æ›´æ”¹ã€‚</p><h2 id="ced8" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">ä½œæ›²æ—¶ä»£ä¹‹å‰è®¸å¯æ˜¯æ€ä¹ˆåšçš„ï¼ŸğŸ§ğŸ¤”</h2><p id="e616" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">åœ¨ Compose ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨<a class="ae lr" href="https://developer.android.com/training/permissions/requesting#request-permission" rel="noopener ugc nofollow" target="_blank">registerForActivityResult</a>åœ¨è¿è¡Œæ—¶è¯·æ±‚æƒé™ï¼Œç„¶ååŸºäº lambda å›è°ƒæ›´æ–° UIã€‚ç„¶è€Œï¼Œéšç€ compose çš„å¼•å…¥ï¼Œæˆ‘ä»¬æ­£åœ¨è¿œç¦»æ´»åŠ¨å’Œç‰‡æ®µï¼Œè¦æ±‚ä¸€ç§æ›´ç²¾ç®€çš„ã€å£°æ˜æ€§çš„è¯·æ±‚è®¸å¯æ ¼å¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚</p><h2 id="a4a9" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">ä¼´å¥åº“ç®€ä»‹ğŸŠğŸŠ</h2><p id="9819" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated"><a class="ae lr" href="https://github.com/google/accompanist" rel="noopener ugc nofollow" target="_blank">ä¼´å¥åº“</a>åŒ…å«ä¸€ç³»åˆ—æ”¯æŒ compose å¼€å‘çš„æ‰©å±•ç‰¹æ€§ï¼Œè™½ç„¶è¿˜æ²¡æœ‰å®Œå…¨ç¨³å®šåˆ°å¯ä»¥ä¸æ ‡å‡† compose åº“é›†æˆï¼Œä½†æ˜¯ä»ç„¶éå¸¸æœ‰ç”¨ï¼Œgoogle ä¸ä»‹æ„å¼€å‘è€…ä½¿ç”¨å®ƒã€‚ä¼´å¥è€…æä¾›çš„ä¸€ä¸ªæ‰©å±•æ˜¯<a class="ae lr" href="https://github.com/google/accompanist/tree/main/permissions" rel="noopener ugc nofollow" target="_blank">æƒé™</a>åº“ï¼Œå®ƒä¸ºåœ¨ compose ä¸­è®¾ç½®æƒé™æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„ç°æˆå®ç°ã€‚</p><h2 id="be40" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">è®©æˆ‘ä»¬å¼€å§‹å»ºè®¾ğŸ› å§</h2><p id="413b" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">å°†æ­¤æ·»åŠ åˆ° build.gradle (app)ä¸­çš„ä¾èµ–é¡¹:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="e7ef" class="kt ku in lx b gy mb mc l md me">implementation "com.google.accompanist:accompanist-permissions:0.25.0"</span></pre><p id="fa0a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æ‚¨çš„æ¸…å•ä¸­è¯·æ±‚å¯¹<em class="mf">çŸ­ä¿¡</em>çš„æƒé™:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="9948" class="kt ku in lx b gy mb mc l md me">&lt;uses-permission android:name="android.permission.READ_SMS"/&gt;</span></pre><p id="160b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ç°åœ¨ä¿®æ”¹ MainActivity.ktï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="a2f4" class="kt ku in lx b gy mb mc l md me">class MainActivity : ComponentActivity() {<br/>    @OptIn(ExperimentalPermissionsApi::class)<br/>    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        <em class="mf">setContent </em><strong class="lx io">{<br/>            </strong>val permissionState = <em class="mf">rememberPermissionState</em>(permission = android.Manifest.permission.<em class="mf">READ_SMS</em>)<br/>            <em class="mf">PermissionScreen</em>(<br/>                permissionStatus = permissionState.status,<br/>                onRequestPermission = <strong class="lx io">{<br/>                    </strong>permissionState.launchPermissionRequest()<br/>                <strong class="lx io">}<br/>            </strong>)<br/>        <strong class="lx io">}<br/>    </strong>}<br/>}<br/><br/>@OptIn(ExperimentalPermissionsApi::class)<br/>@Composable<br/>fun PermissionScreen(<br/>    permissionStatus: PermissionStatus,<br/>    onRequestPermission: () -&gt; Unit<br/>) {<br/>    <em class="mf">Scaffold </em><strong class="lx io">{<br/>        </strong><em class="mf">Column</em>(modifier = Modifier.<em class="mf">padding</em>(<strong class="lx io">it</strong>).<em class="mf">padding</em>(16.<em class="mf">dp</em>)) <strong class="lx io">{<br/>            </strong><em class="mf">Text</em>(text = "Your Permission Status: ", style = MaterialTheme.typography.h6)<br/>            when(permissionStatus) {<br/>                is PermissionStatus.Denied -&gt; {<br/>                    if (permissionStatus.shouldShowRationale) {<br/>                        <em class="mf">Text</em>(text = "We need permission to continue this demo")<br/>                    } else {<br/>                        <em class="mf">Text</em>(text = "Looks like you permanently denied permission. Please provide in Settings")<br/>                    }<br/>                }<br/>                is PermissionStatus.Granted -&gt; {<br/>                    <em class="mf">Text</em>(text = "Nice!! permission set")<br/>                }<br/>            }<br/>            if (permissionStatus.<em class="mf">shouldShowRationale</em>) {<br/>                <em class="mf">Button</em>(onClick = onRequestPermission) <strong class="lx io">{<br/>                    </strong><em class="mf">Text</em>(text = "Click to request permission")<br/>                <strong class="lx io">}<br/>            </strong>}<br/>        <strong class="lx io">}<br/>    }<br/></strong>}</span></pre><h2 id="a37d" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">ç°åœ¨è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹æˆ‘ä»¬æ‰€å†™çš„å†…å®¹</h2><ul class=""><li id="c05e" class="mg mh in jx b jy lm kc ln kg mi kk mj ko mk ks ml mm mn mo bi translated"><strong class="jx io"> permissionState </strong>æ˜¯<strong class="jx io"> PermissionState </strong>çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒä¸»åŠ¨è·Ÿè¸ªç‰¹å®šæƒé™çš„å½“å‰æƒé™çŠ¶æ€ã€‚è¿™åœ¨ä½¿ç”¨<strong class="jx io"><em class="mf">rememberPermissionState</em></strong><em class="mf"/>å®ä¾‹åŒ–çš„åˆæˆä¸­è¢«è®°ä½ã€‚</li><li id="a156" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated"><strong class="jx io"> PermissionScreen() </strong>æ˜¯ä¸€ä¸ªå¯ç»„åˆçš„å‡½æ•°ï¼Œç”¨äºåœ¨ MainActivity ä¸­æ˜¾ç¤ºæˆ‘ä»¬çš„ UIã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°:<strong class="jx io"><em class="mf">permission status</em></strong>å’Œ<strong class="jx io"><em class="mf">onRequestPermission</em></strong>ã€‚</li><li id="50d6" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">åœ¨æˆ‘ä»¬çš„<strong class="jx io">permission screen</strong>composable ä¸­ï¼Œæˆ‘ä»¬è·Ÿè¸ª<strong class="jx io"> permissionStatus </strong>ä»¥åœ¨çŠ¶æ€æ”¹å˜æ—¶æ›´æ–°æˆ‘ä»¬çš„ UIã€‚</li><li id="4a78" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated"><strong class="jx io"> PermissionStatus </strong>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«ä¸€ä¸ªè¡¨ç¤ºæƒé™å·²è¢«æˆäºˆçš„<strong class="jx io"> Granted </strong>å¯¹è±¡å’Œä¸€ä¸ªè¡¨ç¤ºæƒé™å·²è¢«æ‹’ç»çš„<strong class="jx io"> Denied </strong>æ•°æ®ç±»ã€‚</li><li id="385a" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">å¦è®¤ç±»æœ‰ä¸€ä¸ªæˆå‘˜å«åš<strong class="jx io"><em class="mf"/></strong>ã€‚è¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœä¸º trueï¼Œåˆ™è¡¨æ˜ç”¨æˆ·ä»ç„¶è¦æ¥å—æƒé™ï¼Œå¹¶ä¸”æƒé™è¯·æ±‚å¯ä»¥ä»åº”ç”¨ç¨‹åºæœ¬èº«è°ƒç”¨ã€‚å¦‚æœä¸º falseï¼Œåˆ™è¡¨æ˜ç”¨æˆ·å·²ç»æ‹’ç»äº†ä¸¤æ¬¡æƒé™ï¼Œç°åœ¨åªèƒ½ç”±ç”¨æˆ·ç›´æ¥ä»è®¾ç½®å±å¹•æä¾›ã€‚</li><li id="a544" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">æ¯å½“æˆ‘ä»¬çš„ç”¨æˆ·ç‚¹å‡»è¯·æ±‚æƒé™æŒ‰é’®æ—¶ï¼Œå®ƒå°±è°ƒç”¨<strong class="jx io"><em class="mf">onRequestPermission</em></strong>å›è°ƒï¼Œè¯¥å›è°ƒè°ƒç”¨<strong class="jx io"><em class="mf">launchPermissionRequest()</em></strong>å‘ç”¨æˆ·æ˜¾ç¤ºæƒé™å¯¹è¯æ¡†ã€‚</li></ul><h2 id="8939" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ğŸ™‚</h2><p id="0deb" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">å¸Œæœ›ä½ èƒ½ä»ä¸Šé¢çš„ä»£ç ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®æˆ–æ„è§ï¼Œè¯·ç•™ä¸‹æ‚¨çš„è¯„è®ºğŸ™ŒğŸ¼ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œå¦‚æœä½ è§‰å¾—å†…å®¹æœ‰ç”¨ï¼Œå¯ä»¥ç•™ä¸‹æŒå£°æˆ–å…³æ³¨ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚<em class="mf">ä¸€è·¯å¹³å®‰ï¼ğŸ¦„</em></p></div></div>    
</body>
</html>