<html>
<head>
<title>Permissions in Jetpack compose with Accompanist Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack 中的权限与伴奏库一起构成</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/permissions-in-jetpack-compose-with-accompanist-library-15c90404fe48?source=collection_archive---------6-----------------------#2022-09-26">https://blog.devgenius.io/permissions-in-jetpack-compose-with-accompanist-library-15c90404fe48?source=collection_archive---------6-----------------------#2022-09-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f733a9845216cde2d85158cd8184cb59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0kjEXZXng1Gfo4yMf0scw.png"/></div></div></figure><p id="73e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将了解如何在 Jetpack Compose 中请求权限，以及如何监听和更新 UI 中的权限更改。</p><h2 id="ced8" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">作曲时代之前许可是怎么做的？🧐🤔</h2><p id="e616" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">在 Compose 之前，我们使用<a class="ae lr" href="https://developer.android.com/training/permissions/requesting#request-permission" rel="noopener ugc nofollow" target="_blank">registerForActivityResult</a>在运行时请求权限，然后基于 lambda 回调更新 UI。然而，随着 compose 的引入，我们正在远离活动和片段，要求一种更精简的、声明性的请求许可格式。让我们看看这是怎么做到的。</p><h2 id="a4a9" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">伴奏库简介🎊🎊</h2><p id="9819" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated"><a class="ae lr" href="https://github.com/google/accompanist" rel="noopener ugc nofollow" target="_blank">伴奏库</a>包含一系列支持 compose 开发的扩展特性，虽然还没有完全稳定到可以与标准 compose 库集成，但是仍然非常有用，google 不介意开发者使用它。伴奏者提供的一个扩展是<a class="ae lr" href="https://github.com/google/accompanist/tree/main/permissions" rel="noopener ugc nofollow" target="_blank">权限</a>库，它为在 compose 中设置权限提供了一些方便的现成实现。</p><h2 id="be40" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">让我们开始建设🛠吧</h2><p id="413b" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">将此添加到 build.gradle (app)中的依赖项:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="e7ef" class="kt ku in lx b gy mb mc l md me">implementation "com.google.accompanist:accompanist-permissions:0.25.0"</span></pre><p id="fa0a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的清单中请求对<em class="mf">短信</em>的权限:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="9948" class="kt ku in lx b gy mb mc l md me">&lt;uses-permission android:name="android.permission.READ_SMS"/&gt;</span></pre><p id="160b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在修改 MainActivity.kt，如下所示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="a2f4" class="kt ku in lx b gy mb mc l md me">class MainActivity : ComponentActivity() {<br/>    @OptIn(ExperimentalPermissionsApi::class)<br/>    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        <em class="mf">setContent </em><strong class="lx io">{<br/>            </strong>val permissionState = <em class="mf">rememberPermissionState</em>(permission = android.Manifest.permission.<em class="mf">READ_SMS</em>)<br/>            <em class="mf">PermissionScreen</em>(<br/>                permissionStatus = permissionState.status,<br/>                onRequestPermission = <strong class="lx io">{<br/>                    </strong>permissionState.launchPermissionRequest()<br/>                <strong class="lx io">}<br/>            </strong>)<br/>        <strong class="lx io">}<br/>    </strong>}<br/>}<br/><br/>@OptIn(ExperimentalPermissionsApi::class)<br/>@Composable<br/>fun PermissionScreen(<br/>    permissionStatus: PermissionStatus,<br/>    onRequestPermission: () -&gt; Unit<br/>) {<br/>    <em class="mf">Scaffold </em><strong class="lx io">{<br/>        </strong><em class="mf">Column</em>(modifier = Modifier.<em class="mf">padding</em>(<strong class="lx io">it</strong>).<em class="mf">padding</em>(16.<em class="mf">dp</em>)) <strong class="lx io">{<br/>            </strong><em class="mf">Text</em>(text = "Your Permission Status: ", style = MaterialTheme.typography.h6)<br/>            when(permissionStatus) {<br/>                is PermissionStatus.Denied -&gt; {<br/>                    if (permissionStatus.shouldShowRationale) {<br/>                        <em class="mf">Text</em>(text = "We need permission to continue this demo")<br/>                    } else {<br/>                        <em class="mf">Text</em>(text = "Looks like you permanently denied permission. Please provide in Settings")<br/>                    }<br/>                }<br/>                is PermissionStatus.Granted -&gt; {<br/>                    <em class="mf">Text</em>(text = "Nice!! permission set")<br/>                }<br/>            }<br/>            if (permissionStatus.<em class="mf">shouldShowRationale</em>) {<br/>                <em class="mf">Button</em>(onClick = onRequestPermission) <strong class="lx io">{<br/>                    </strong><em class="mf">Text</em>(text = "Click to request permission")<br/>                <strong class="lx io">}<br/>            </strong>}<br/>        <strong class="lx io">}<br/>    }<br/></strong>}</span></pre><h2 id="a37d" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">现在让我们分解一下我们所写的内容</h2><ul class=""><li id="c05e" class="mg mh in jx b jy lm kc ln kg mi kk mj ko mk ks ml mm mn mo bi translated"><strong class="jx io"> permissionState </strong>是<strong class="jx io"> PermissionState </strong>的一个实例，它主动跟踪特定权限的当前权限状态。这在使用<strong class="jx io"><em class="mf">rememberPermissionState</em></strong><em class="mf"/>实例化的合成中被记住。</li><li id="a156" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated"><strong class="jx io"> PermissionScreen() </strong>是一个可组合的函数，用于在 MainActivity 中显示我们的 UI。它接受两个参数:<strong class="jx io"><em class="mf">permission status</em></strong>和<strong class="jx io"><em class="mf">onRequestPermission</em></strong>。</li><li id="50d6" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">在我们的<strong class="jx io">permission screen</strong>composable 中，我们跟踪<strong class="jx io"> permissionStatus </strong>以在状态改变时更新我们的 UI。</li><li id="4a78" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated"><strong class="jx io"> PermissionStatus </strong>是一个接口，包含一个表示权限已被授予的<strong class="jx io"> Granted </strong>对象和一个表示权限已被拒绝的<strong class="jx io"> Denied </strong>数据类。</li><li id="385a" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">否认类有一个成员叫做<strong class="jx io"><em class="mf"/></strong>。这是一个布尔值，如果为 true，则表明用户仍然要接受权限，并且权限请求可以从应用程序本身调用。如果为 false，则表明用户已经拒绝了两次权限，现在只能由用户直接从设置屏幕提供。</li><li id="a544" class="mg mh in jx b jy mp kc mq kg mr kk ms ko mt ks ml mm mn mo bi translated">每当我们的用户点击请求权限按钮时，它就调用<strong class="jx io"><em class="mf">onRequestPermission</em></strong>回调，该回调调用<strong class="jx io"><em class="mf">launchPermissionRequest()</em></strong>向用户显示权限对话框。</li></ul><h2 id="8939" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">基本上就是这样🙂</h2><p id="0deb" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">希望你能从上面的代码中学到一些东西。如果您有任何疑问或意见，请留下您的评论🙌🏼。一如既往，如果你觉得内容有用，可以留下掌声或关注，那就太好了。<em class="mf">一路平安！🦄</em></p></div></div>    
</body>
</html>