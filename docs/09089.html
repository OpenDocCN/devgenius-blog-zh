<html>
<head>
<title>How to Enable Laravel Email Verification and Customize Email Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何启用 Laravel 电子邮件验证和自定义电子邮件模板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-enable-user-registration-email-verification-and-customize-email-templates-b994299ab27d?source=collection_archive---------1-----------------------#2022-07-29">https://blog.devgenius.io/laravel-enable-user-registration-email-verification-and-customize-email-templates-b994299ab27d?source=collection_archive---------1-----------------------#2022-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="16fa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Laravel 从头开始创建管理面板——第 15 部分</h2></div><p id="a146" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di">在</span>的<a class="ae lk" href="https://github.com/balajidharma/basic-laravel-admin-panel" rel="noopener ugc nofollow" target="_blank">基本 Laravel 管理面板</a>中，我们实现了大部分基本功能。在这篇文章中，我们将启用电子邮件验证和电子邮件模板定制。</p><p id="e0f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Laravel 提供用户注册后发送和验证邮件验证的内置服务。</p><ul class=""><li id="b211" class="ll lm iq kh b ki kj kl km ko ln ks lo kw lp la lq lr ls lt bi translated">1.配置邮件</li><li id="70f2" class="ll lm iq kh b ki lu kl lv ko lw ks lx kw ly la lq lr ls lt bi translated">2.在模型中启用电子邮件验证</li><li id="d54f" class="ll lm iq kh b ki lu kl lv ko lw ks lx kw ly la lq lr ls lt bi translated">3.添加<code class="fe lz ma mb mc b">verified</code>中间件</li><li id="d39c" class="ll lm iq kh b ki lu kl lv ko lw ks lx kw ly la lq lr ls lt bi translated">4.使用<strong class="kh ir"> MailHog </strong>进行电子邮件验证</li><li id="c4f7" class="ll lm iq kh b ki lu kl lv ko lw ks lx kw ly la lq lr ls lt bi translated">5.电子邮件内容定制</li><li id="c7ae" class="ll lm iq kh b ki lu kl lv ko lw ks lx kw ly la lq lr ls lt bi translated">6.自定义电子邮件模板</li></ul><h2 id="f97a" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">1.配置邮件</h2><p id="1ec2" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">Laravel 邮件配置在<code class="fe lz ma mb mc b">config/mail.php</code>路径中可用。Laravel 提供了一个干净、简单的电子邮件 API，由流行的 Symfony Mailer 组件提供支持。</p><p id="15cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通常，我们为每个环境使用不同的邮件服务。因此，在。环境文件</p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="2230" class="md me iq mc b gy nj nk l nl nm">MAIL_MAILER=smtp<br/>MAIL_HOST=mailhog<br/>MAIL_PORT=1025<br/>MAIL_USERNAME=null<br/>MAIL_PASSWORD=null<br/>MAIL_ENCRYPTION=null<br/>MAIL_FROM_ADDRESS=null<br/>MAIL_FROM_NAME="${APP_NAME}"</span></pre><p id="d1ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lk" href="https://laravel.com/docs/9.x/sail#previewing-emails" rel="noopener ugc nofollow" target="_blank">中，幼帆</a>配置有麦猪。我们将在电子邮件验证设置后看到邮件猪。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="0527" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">2.在模型中启用电子邮件验证</h2><p id="6e46" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">为了启用电子邮件验证，我们需要在我们的用户模型中实现<code class="fe lz ma mb mc b">Illuminate\Contracts\Auth\MustVerifyEmail</code></p><p id="4963" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">app/Models/User.php</code></p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="7e38" class="md me iq mc b gy nj nk l nl nm">&lt;?php</span><span id="75d2" class="md me iq mc b gy nu nk l nl nm">namespace App\Models;</span><span id="0e8f" class="md me iq mc b gy nu nk l nl nm">use Illuminate\Contracts\Auth\MustVerifyEmail;<br/>use Illuminate\Database\Eloquent\Factories\HasFactory;<br/>use Illuminate\Foundation\Auth\User as Authenticatable;<br/>use Illuminate\Notifications\Notifiable;<br/>use Laravel\Sanctum\HasApiTokens;<br/>use Spatie\Permission\Traits\HasRoles;</span><span id="ed11" class="md me iq mc b gy nu nk l nl nm">class User extends Authenticatable implements MustVerifyEmail<br/>{<br/>    use HasApiTokens, HasFactory, Notifiable, HasRoles;<br/> <br/>    // ...</span></pre><p id="fa6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在注册成为新用户</p><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/9673cd25232dfbfe026ce1e90eca56ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*K3KHDOO6wUTpAo75_wtxrw.png"/></div></figure><p id="d032" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注册后，我得到了以下错误</p><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/089cac2e84c50f76ae5a86ffd5112cbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71k2RcTrMuZhygCcs3OzKg.png"/></div></div></figure><p id="ca87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个问题是由于<code class="fe lz ma mb mc b">MAIL_FROM_ADDRESS</code>是空的。因为我们把我们的 Laravel 8 升级到了 Laravel 9。在 Laravel 9 中，这个<code class="fe lz ma mb mc b">MAIL_FROM_ADDRESS</code>不应该为空。所以在。包封/包围（动词 envelop 的简写）</p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="85a3" class="md me iq mc b gy nj nk l nl nm">MAIL_FROM_ADDRESS="hello@example.com"</span></pre><p id="cdd3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新后，我可以注册并重定向到仪表板。</p><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oe"><img src="../Images/38bf97667266b22276975e703b9f694a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3wp0DKXoyL2lgA-OXpzVWg.png"/></div></div></figure><p id="ab89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是用户没有被限制在没有电子邮件验证的情况下查看页面。下一步我们解决这个问题。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="1711" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">3.添加<code class="fe lz ma mb mc b">verified</code>中间件</h2><p id="9a67" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">现在，我们将向所有经过认证的路由添加<code class="fe lz ma mb mc b">verified</code>中间件</p><p id="4d9d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">routes/web.php</code></p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="cc06" class="md me iq mc b gy nj nk l nl nm">Route::get('/dashboard', function () {<br/>    return view('dashboard');<br/>})-&gt;middleware(['auth', 'verified'])-&gt;name('dashboard');</span></pre><p id="11bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">routes/admin.php</code></p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="cabe" class="md me iq mc b gy nj nk l nl nm">&lt;?php</span><span id="ccfb" class="md me iq mc b gy nu nk l nl nm">Route::group([<br/>    'namespace' =&gt; 'App\Http\Controllers\Admin',<br/>    'prefix' =&gt; 'admin',<br/>    'middleware' =&gt; ['auth', 'verified'],<br/>], function () {</span><span id="c5b8" class="md me iq mc b gy nu nk l nl nm">   //.....</span></pre><p id="9e69" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加中间件后，用户被重定向到电子邮件验证待定页面。此外，该页面还提供了重新发送验证电子邮件的选项。</p><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/6afff10ac0c926575aeee4a420a288b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*Xe40GlnIg_FOPcMrNZ9NFg.png"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="21f4" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">4.与<strong class="ak"> MailHog </strong>的邮件验证</h2><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi og"><img src="../Images/37391bb2b06be5babb76ec69fbd2d5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yJc6t9zeukOK3QZ_P5oVbw.png"/></div></div></figure><p id="19ce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当 Sail 运行时，在<a class="ae lk" href="http://localhost:8025/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8025/ </a>上访问您的 MailHog</p><p id="c54a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">T4 邮件猪是一款针对本地环境下的开发者的电子邮件测试工具。</p><p id="1c27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 MailHog 中检查收到的电子邮件。现在，单击电子邮件验证链接。验证后用户被允许进入<code class="fe lz ma mb mc b">verified</code>页面。</p><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oh"><img src="../Images/2b57c4f1a3e9bd8f7b43ca928f4a48b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yO8sz9qj01LsSrd49NtVPQ.png"/></div></div></figure><figure class="nb nc nd ne gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oi"><img src="../Images/29494a9a6fbfb7e054e3682862d02c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-kOQyvGKJGHAFdS04o4oA.png"/></div></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="7a55" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">5.电子邮件内容定制</h2><p id="c24a" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">Laravel 提供了修改<a class="ae lk" href="https://laravel.com/docs/9.x/verification#verification-email-customization" rel="noopener ugc nofollow" target="_blank">验证邮件内容</a>的选项。在<code class="fe lz ma mb mc b">App\Providers\AuthServiceProvider</code>中需要从 boot 方法中调用<code class="fe lz ma mb mc b">toMailUsing</code>方法。</p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="786b" class="md me iq mc b gy nj nk l nl nm">use Illuminate\Auth\Notifications\VerifyEmail;<br/>use Illuminate\Notifications\Messages\MailMessage;<br/> <br/>/**<br/> * Register any authentication / authorization services.<br/> *<br/> * @return void<br/> */<br/>public function boot()<br/>{<br/>    // ...<br/> <br/>    VerifyEmail::toMailUsing(function ($notifiable, $url) {<br/>        return (new MailMessage)<br/>            -&gt;subject('Verify Email Address')<br/>            -&gt;line('Click the button below to verify your email address.')<br/>            -&gt;action('Verify Email Address', $url);<br/>    });<br/>}</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="5301" class="md me iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">6.自定义电子邮件模板</h2><p id="976f" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">您可以通过发布通知包的资源来修改 HTML 和纯文本模板。运行以下命令将模板复制到您的视图中。</p><pre class="nb nc nd ne gt nf mc ng nh aw ni bi"><span id="6aa8" class="md me iq mc b gy nj nk l nl nm">php artisan vendor:publish --tag=laravel-notifications</span></pre><p id="2ee8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">邮件通知模板将被复制到<code class="fe lz ma mb mc b">resources/views/vendor/notifications</code>文件夹。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="f787" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Laravel 管理面板在<a class="ae lk" href="https://github.com/balajidharma/basic-laravel-admin-panel" rel="noopener ugc nofollow" target="_blank">https://github.com/balajidharma/basic-laravel-admin-panel</a>上可用。安装管理面板并分享您的反馈。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="4548" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读。</p><p id="f21c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">敬请关注更多内容！</p><p id="91a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="oj">跟我来</em><a class="ae lk" href="https://balajidharma.medium.com/" rel="noopener"><strong class="kh ir"><em class="oj">balajidharma.medium.com</em></strong></a>。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="914c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上一部分—第 14 部分:<a class="ae lk" href="https://balajidharma.medium.com/how-to-migrating-from-laravel-mix-to-vite-fbb912237844" rel="noopener">从 Laravel Mix 迁移到 Vite </a></p><p id="76cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一部分—第 16 部分:<a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/how-to-debug-laravel-app-using-laravel-debugbar-ec51a8587786">如何使用 Laravel Debugbar </a>调试 Laravel App</p></div></div>    
</body>
</html>