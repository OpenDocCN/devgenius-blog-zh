<html>
<head>
<title>Azure Cost Optimization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure成本优化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/azure-cost-optimization-4c9dfa502275?source=collection_archive---------6-----------------------#2020-10-27">https://blog.devgenius.io/azure-cost-optimization-4c9dfa502275?source=collection_archive---------6-----------------------#2020-10-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6003" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大规模使用Azure的企业组织可能会在成本方面赢得很多。特别是在开发运维团队变得越来越独立并且能够以自助服务模式管理其资源的组织中，了解总成本保持在预算范围内非常重要。</p><p id="55ba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一种方法是分析当前成本并优化它们。例如，当您只在工作时间使用昂贵的虚拟机时，您真的需要它们全天候运行吗？对于未来几年很有可能稳定运行的可预测工作负载，是否有必要支付现收现付的价格？虽然在你计划项目的时候问这些问题是最好的，但是在任何阶段批判性地审视你在Azure上花费的成本并寻找优化的机会都不会有什么坏处。</p><p id="976e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用本文中描述的不同成本优化方法，您可以节省大量资金，同时获得相同的资源价值。本文将描述三种不同的Azure成本优化方法，这些方法不需要重新设计您的工作负载，以及微软提供的开箱即用的工具，以找出您可以节省资金的确切位置。</p><p id="d1a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们更详细地了解一下成本优化选项。</p><h1 id="7518" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">1.调整规模或关闭未充分利用的资源</h1><p id="5741" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">监控Azure环境中运行的服务的利用率，是找到省钱机会的重要一步。有时，资源可以缩减到更便宜的层级，或者在工作时间之外关闭。当你想开始提高Azure环境的整体利用率时，一个简单的起点就是虚拟机。在内部架构中，过度配置服务器可能是一种标准做法，以确保它们高性能且经得起未来考验。然而，在云世界中，这是不需要的。让我们来看看一些简单的步骤，你可以采取这些步骤，通过合理配置资源来开始省钱。</p><h2 id="81b5" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">1a。Azure顾问</h2><p id="ecdc" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">Azure Advisor 是Azure中的一项免费服务，它提供如何优化Azure环境的建议。Azure Advisor推荐的类别之一是<em class="ly">成本</em>。这些建议都可以从Azure Advisor服务本身查看，但具体的成本建议也集成在成本管理+计费服务的Advisor选项卡中。您可以从顾问那里获得的潜在建议是:调整规模或关闭未充分利用的虚拟机。您还可以看到它建议调整到哪种虚拟机类型，以及您将实现的节省。这是开始优化您的环境的一种非常简单易行的方法，并且适当调整虚拟机的规模可以带来显著的节约。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/69a380474a5692476b13aec71c5797a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tahN3FjnZx7DemegCC6ifQ.jpeg"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">Azure Advisor中规模合适的建议示例。</figcaption></figure><h2 id="d689" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">1b。Azure监视器</h2><p id="5f7e" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">Azure Advisor不会详细显示这些建议所基于的数据或统计数据。当您单击建议的详细信息时，您将被重定向到该特定资源的详细信息页面。如果您想更进一步，您可以开始主动监控您的服务的利用率，以确定哪些服务可以优化。</p><p id="8510" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">监控指标可能有不同的方法，但一个简单的方法是从Azure Monitor工作簿模板开始，它在Azure中现成可用。如果我们特别关注我们已经确定为唾手可得的虚拟机示例，我们可以利用虚拟机关键指标模板。</p><p id="444b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以通过访问Azure Monitor的工作簿部分(<a class="ae lx" href="https://ms.portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/workbooks" rel="noopener ugc nofollow" target="_blank">单击此处</a>)并单击虚拟机部分中的关键指标模板来访问它。您将自动看到您有权访问的订阅中的数据。使用“概述和关键指标”选项卡中的视觉效果，您可以查找平均CPU利用率较低的虚拟机，因此可以缩小规模。</p><p id="c23e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">工作簿可以很容易地进行调整，以添加您感兴趣的具体指标。例如，您可以在现有的“平均CPU使用率”列旁边添加“最大CPU使用率”列。另一个有趣的建议是将Azure Advisor信息添加到工作簿中。Azure Advisor建议是Azure资源图数据的一部分。当您对您的工作簿感到满意时，您可以选择将它推广到您组织中的所有开发运维团队，让他们了解成本优化的机会。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mp"><img src="../Images/70e1eb7e3a06f2ef6a94a3260b9d7a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uOmh8k1DYdQzn-sdyFjYFw.jpeg"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">这是虚拟机关键指标模板的一个例子，当你进入Azure Monitor的工作簿部分时，可以在Azure门户中找到它。这个特定的例子包含一些修改，比如包括Azure Advisor推荐的操作和对资源组的过滤。这个版本的源代码可以在<a class="ae lx" href="https://github.com/harmke/AzureMonitorCommunity/blob/master/Azure%20Services/Virtual%20machines/Workbooks/Key%20metrics%20with%20Advisor%20recommendations.workbook" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</figcaption></figure><h1 id="c35a" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">2.购买保留的实例</h1><p id="efc6" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">对于可预测的生产工作负载，您知道您将拥有全天候运行的虚拟机，购买Azure Reserved Instance (RI)而不是按需付费是有意义的。当购买预订实例时，您承诺预先为特定服务付费，这可能会导致显著的折扣(比标准现收现付价格低72%)。可以在Azure计算器中计算单个资源类型的节省。预约可以买1年或3年，那些费用可以提前支付，也可以按月支付。</p><p id="5b32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">购买保留的实例可能是一项相当大的投资，也可能是有风险的，因为它们是建立在“使用它或失去它”的基础上的。当您的RI范围内的某个服务正在运行时，您会自动利用预订。然而，当没有类似的服务运行时，你仍然提前为你的预订付费，而没有使用它。</p><p id="8745" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">预订可以在不同的范围内购买:共享范围、订阅范围(也称为单个范围)或资源组范围。即使您更喜欢基于对单个资源组或订阅的建议来购买预订，您也可以选择在共享范围内购买它们，以便以最佳方式利用它们。</p><p id="09bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了帮助您发现购买预订的机会，Microsoft提供了国际扶轮推荐。这些建议是基于某个家庭类型内Azure服务的平均使用情况，基于某个回顾期。让我们来看看您可以使用哪些不同的工具来找到购买哪些保留实例的建议。</p><h2 id="80ff" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">2a。Azure顾问</h2><p id="dcb8" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">Azure Advisor显示关于购买哪些保留实例的建议。它提供单一订阅范围的建议，回顾期为30天。在适用的情况下，节省额是根据3年预订计算的。目前，Azure Advisor正在为越来越多类型的服务提供建议。</p><h2 id="8ebc" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">2b。预订建议API</h2><p id="4e1d" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">检索RI推荐的最灵活的方法是使用预订推荐API。当向API提交请求时，您可以应用过滤器来检索您需要的建议。可以应用的筛选器有范围、资源类型和回顾期。点击<a class="ae lx" href="https://docs.microsoft.com/en-us/rest/api/consumption/reservationrecommendations/list" rel="noopener ugc nofollow" target="_blank">此处</a>获取该API的文档。</p><h2 id="2e5d" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">2c。<a class="ae lx" href="https://appsource.microsoft.com/en-us/product/power-bi/costmanagement.azurecostmanagementapp" rel="noopener ugc nofollow" target="_blank">电力BI App </a>(或连接器)</h2><p id="5f9c" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">Azure成本管理Power BI应用程序(ACM Power BI应用程序)帮助您在Power BI中分析和管理Azure成本。目前，它仅适用于拥有企业协议的客户。作为用户，您需要一个企业管理员帐户来访问数据。您还需要Power BI Pro许可证来安装和使用该应用程序。关于如何安装它的说明，可以在这里找到<a class="ae lx" href="https://docs.microsoft.com/nl-nl/azure/cost-management-billing/costs/analyze-cost-data-azure-cost-management-power-bi-template-app" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5fb8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ACM Power BI应用程序提供了一个包含国际扶轮建议的视图。目前，它支持共享或订阅范围内的虚拟机建议，回顾期为7天。对于每个虚拟机系列，它显示了建议的数量，包括与虚拟机在同一实例灵活性组中的数量，以及标准化大小。</p><p id="61de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ACM Power BI应用程序还显示了一些有趣的虚拟机覆盖视图。这显示了您在按需使用和RI使用上花费了多少。</p><p id="2e31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在该应用程序旁边，还有一个连接器，您可以在Power BI Desktop中使用它来创建自己的成本管理报告。连接器中的数据与应用程序中的数据相同。要使用连接器，您需要为企业协议使用企业管理员帐户，或者为Microsoft客户协议使用帐单帐户所有者。点击阅读更多关于连接器<a class="ae lx" href="https://docs.microsoft.com/nl-nl/power-bi/connect-data/desktop-connect-azure-cost-management" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mq"><img src="../Images/452b20aada8581605732f8b476f54b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IfQi85ryzgO2m0CCIKjYA.jpeg"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">Azure Cost Management Power BI应用程序提供的单一范围RI建议示例。</figcaption></figure><h2 id="4648" class="ll kj in bd kk lm ln dn ko lo lp dp ks jv lq lr kw jz ls lt la kd lu lv le lw bi translated">2d。Azure门户中的预订和购买体验</h2><p id="3dee" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">购买体验中的Azure门户也显示了RI推荐。选择<em class="ly">查看详情</em>了解特定预订的推荐数量时，会显示大量有用信息。这种解决方案的一个主要优点是它保证是最新的。请注意，在门户的当前设置中，您需要购买RIs的访问权限才能看到这些统计数据。有关购买体验中显示的更多细节信息，请查看<a class="ae lx" href="https://docs.microsoft.com/nl-nl/azure/cost-management-billing/reservations/reserved-instance-purchase-recommendations?toc=/azure/cost-management-billing/reservations/toc.json" rel="noopener ugc nofollow" target="_blank">此</a>链接。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mr"><img src="../Images/d26fcb703e292743a1f488740fa9c9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccoX7Ks9SojHXJGq-COtsw.jpeg"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">预订购买体验提供了一段时间内服务平均利用率的统计数据，以明确推荐的依据。图片来源是<a class="ae lx" href="https://docs.microsoft.com/nl-nl/azure/cost-management-billing/reservations/reserved-instance-purchase-recommendations?toc=/azure/cost-management-billing/reservations/toc.json" rel="noopener ugc nofollow" target="_blank">这个</a>页面。</figcaption></figure><h1 id="72ee" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">3.Azure混合优势</h1><p id="33f3" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">Azure混合优势(AHB)意味着本地许可证可以在Azure中使用。这些好处存在于Windows Server许可证(用于Azure Windows虚拟机)和SQL许可证(用于Azure SQL数据库)中。AHB折扣可以给Azure虚拟机带来40%的折扣。这很难管理，因为必须一对一地选择资源来使用许可证。</p><p id="6002" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了最佳地利用Azure混合优势，您需要深入了解您的本地许可证。这是开始时的重要信息。当您知道您拥有多少个许可证时，您可以选择资源来使用它们。</p><p id="c528" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在Azure Cost Management Power BI应用程序中，有一个Azure混合优势视图，您可以在其中监控Windows Server AHB。在这个视图中，你可以看到你的Azure环境中使用了多少Windows Server许可证，以及哪些资源启用了它。</p></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><p id="e4f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望你发现这个概述有助于你找到一些机会来优化你的Azure环境以节省成本。如果您对如何在Azure上进行成本管理以及哪些工具可以帮助您有任何其他问题，请告诉我。</p></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><p id="dec3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ly">特别感谢我的同事</em> <a class="ae lx" href="https://www.linkedin.com/in/ronaldvanteeffelen/" rel="noopener ugc nofollow" target="_blank"> <em class="ly">罗纳德·范·提夫伦</em> </a> <em class="ly">与我一起研究这个话题并评论这篇博文。</em></p></div></div>    
</body>
</html>