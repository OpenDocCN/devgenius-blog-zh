<html>
<head>
<title>Security in Vuejs 3.0 with authentication and authorization by KeyCloak Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vuejs 3.0 中通过 KeyCloak 第 1 部分进行身份验证和授权的安全性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/security-in-vuejs-3-0-with-authentication-and-authorization-by-keycloak-part-1-ae884889fa0d?source=collection_archive---------0-----------------------#2022-11-19">https://blog.devgenius.io/security-in-vuejs-3-0-with-authentication-and-authorization-by-keycloak-part-1-ae884889fa0d?source=collection_archive---------0-----------------------#2022-11-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a9b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第 1 部分保护前端 Vuejs 3.0 应用</strong> <br/> <strong class="jm io">第 2 部分在登录组件</strong> <br/>中添加密钥锁查看如何使用访问令牌转到<a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/security-in-vuejs-3-0-with-authentication-and-authorization-by-keycloak-part-2-b660e709450f">第 2 部分在登录组件中添加密钥锁</a></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f9776d25b65d4e21295e9918e55c1071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VA3tWMrYYNeIn1tU.jpg"/></div></div></figure><h1 id="8c98" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">介绍</h1><p id="5dae" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">我已经写了一篇关于用 Keycloak 保护 react 应用程序的完整文章。</p><p id="125e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天我们将看到如何使用另一个前端框架:Vuejs 3.0 来实现这一点！</p><p id="098d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇文章只是一步一步的指导，如果你需要阅读一篇完整的文章，请点击<a class="ae ki" href="https://medium.com/dev-genius/security-in-react-and-webapi-in-asp-net-core-c-with-authentification-and-authorization-by-keycloak-89ba14be7e5a" rel="noopener">这里</a></p><p id="e175" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还可以看到下一部分:<a class="ae ki" href="https://medium.com/dev-genius/security-in-vuejs-3-0-with-authentication-and-authorization-by-keycloak-part-2-b660e709450f" rel="noopener">https://medium . com/dev-genius/security-in-vue js-3-0-with-authentic ation-and-authorization-by-key cloak-part-2-b660e 709450 f</a></p><h1 id="61c4" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">创建我们的 Vuejs 3.0 前端演示</h1><p id="0bc4" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">让我们转到我们的目录并创建一个新项目:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="618d" class="md kw in lz b be me mf l mg mh">C:\Tutorial\keycloak (main -&gt; origin)<br/>λ mkdir vuejs3webapikeycloak<br/><br/>C:\Tutorial\keycloak (main -&gt; origin)<br/>λ cd vuejs3webapikeycloak\<br/><br/>C:\Tutorial\keycloak\vuejs3webapikeycloak (main -&gt; origin)<br/>λ</span></pre><p id="0b63" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用 cli 工具，并通过以下 npm 命令将其作为全局工具与 npm 一起安装</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="5323" class="md kw in lz b be me mf l mg mh">npm install -g @vue/cli</span></pre><pre class="mi ly lz ma bn mb mc bi"><span id="1b54" class="md kw in lz b be me mf l mg mh">C:\Tutorial\keycloak\vuejs3webapikeycloak (main -&gt; origin)<br/>λ npm install -g @vue/cli<br/>[..................] / fetchMetadata: sill resolveWithNewModule yallist@4.0.0 checking installable status</span></pre><p id="d74c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这需要一点时间，所以喝杯咖啡或热饮:)</p><p id="26c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到以下结果:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="78c7" class="md kw in lz b be me mf l mg mh">C:\Tutorial\keycloak\vuejs3webapikeycloak (main -&gt; origin)<br/>λ npm install -g @vue/cli<br/>npm WARN deprecated subscriptions-transport-ws@0.11.0: The `subscriptions-transport-ws` package is no longer maintained. We recommend you use `graphql-ws` instead. For help migrating Apollo software to `graphql-ws`, see https://www.apollographql.com/docs/apollo-server/data/subscriptions/#switching-from-subscriptions-transport-ws    For general help using `graphql-ws`, see https://github.com/enisdenjo/graphql-ws/blob/master/README.md<br/>npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated<br/>npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated<br/>C:\Users\nbarlatier\AppData\Roaming\npm\vue -&gt; C:\Users\nbarlatier\AppData\Roaming\npm\node_modules\@vue\cli\bin\vue.js<br/><br/>&gt; @apollo/protobufjs@1.2.6 postinstall C:\Users\nbarlatier\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\@apollo\protobufjs<br/>&gt; node scripts/postinstall<br/><br/>+ @vue/cli@5.0.8<br/>added 833 packages from 492 contributors in 159.069s<br/><br/><br/>   ╭───────────────────────────────────────────────────────────────╮<br/>   │                                                               │<br/>   │      New major version of npm available! 6.14.4 -&gt; 9.1.1      │<br/>   │   Changelog: https://github.com/npm/cli/releases/tag/v9.1.1   │<br/>   │               Run npm install -g npm to update!               │<br/>   │                                                               │<br/>   ╰───────────────────────────────────────────────────────────────╯<br/><br/><br/>C:\Tutorial\keycloak\vuejs3webapikeycloak (main -&gt; origin)</span></pre><p id="445d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们通过获取以下版本来检查我们是否可以使用 CLI:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="b6e3" class="md kw in lz b be me mf l mg mh">λ vue -V<br/>@vue/cli 4.5.13</span></pre><p id="733b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们准备好创建我们的项目了！</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="de86" class="md kw in lz b be me mf l mg mh">C:\Tutorial\keycloak\vuejs3webapikeycloak (main -&gt; origin)<br/>λ vue create front-end</span></pre><p id="e362" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="eac9" class="md kw in lz b be me mf l mg mh">λ vue create front-end<br/><br/><br/>Vue CLI v4.5.13<br/>┌─────────────────────────────────────────────┐<br/>│                                             │<br/>│    New version available 4.5.13 → 5.0.8     │<br/>│   Run yarn global add @vue/cli to update!   │<br/>│                                             │<br/>└─────────────────────────────────────────────┘<br/><br/>? Please pick a preset: (Use arrow keys)<br/>&gt; Default ([Vue 2] babel, eslint)<br/>  Default (Vue 3) ([Vue 3] babel, eslint)<br/>  Manually select features</span></pre><p id="28ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将手动选择功能</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="14be" class="md kw in lz b be me mf l mg mh">Vue CLI v4.5.13<br/>┌─────────────────────────────────────────────┐<br/>│                                             │<br/>│    New version available 4.5.13 → 5.0.8     │<br/>│   Run yarn global add @vue/cli to update!   │<br/>│                                             │<br/>└─────────────────────────────────────────────┘<br/><br/>? Please pick a preset:<br/>  Default ([Vue 2] babel, eslint)<br/>  Default (Vue 3) ([Vue 3] babel, eslint)<br/>&gt; Manually select features</span></pre><p id="43c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">按向下箭头并输入</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="869d" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project:<br/> (*) Choose Vue version<br/> (*) Babel<br/>&gt;(*) TypeScript<br/> ( ) Progressive Web App (PWA) Support<br/> ( ) Router<br/> ( ) Vuex<br/> ( ) CSS Pre-processors<br/> (*) Linter / Formatter<br/> ( ) Unit Testing<br/> ( ) E2E Testing</span></pre><p id="0c45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我选择 TypeScript，我们可以添加其他功能，但对于我们的演示，我们不需要它们，请按 Enter。</p><p id="2349" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我选择 Vuejs 3.0 并按 enter 键:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="6bc2" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with (Use arrow keys)<br/>  2.x<br/>&gt; 3.x</span></pre><p id="de74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们对演示中的类样式组件说不。</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="b08f" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? (y/N)N</span></pre><p id="2fa6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们选择 Yes 来同时使用 Typescript 和 Babel</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="cf8a" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? (Y/n)</span></pre><p id="313f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们为 ESLint 选择默认选项:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="f5fe" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: (Use arrow keys)<br/>&gt; ESLint with error prevention only<br/>  ESLint + Airbnb config<br/>  ESLint + Standard config<br/>  ESLint + Prettier<br/>  TSLint (deprecated)</span></pre><p id="33c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们再次选择默认选项</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="772b" class="md kw in lz b be me mf l mg mh"><br/>? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: Basic<br/>? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)<br/>&gt;(*) Lint on save<br/> ( ) Lint and fix on commit</span></pre><p id="e50e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们选择 package.json 来获得 Babel、ESLint 等的配置</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="664b" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: Basic<br/>? Pick additional lint features: Lint on save<br/>? Where do you prefer placing config for Babel, ESLint, etc.?<br/>  In dedicated config files<br/>&gt; In package.json<br/><br/></span></pre><p id="c198" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们可以保存我们的设置，如果我们想要的，但这里让我们跳过它:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="49b1" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: Basic<br/>? Pick additional lint features: Lint on save<br/>? Where do you prefer placing config for Babel, ESLint, etc.? In package.json<br/>? Save this as a preset for future projects? (y/N)</span></pre><p id="2888" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="2155" class="md kw in lz b be me mf l mg mh">? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: Basic<br/>? Pick additional lint features: Lint on save<br/>? Where do you prefer placing config for Babel, ESLint, etc.? In package.json<br/>? Save this as a preset for future projects? No<br/><br/><br/>Vue CLI v4.5.13<br/>✨  Creating project in C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end.<br/>⚙️  Installing CLI plugins. This might take a while...<br/><br/>yarn install v1.22.4<br/>info No lockfile found.<br/>[1/4] Resolving packages...<br/>⠁ safe-buffer@^5.1.1</span></pre><p id="87b6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要等一会儿。</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="edf2" class="md kw in lz b be me mf l mg mh">Vue CLI v4.5.13<br/>┌─────────────────────────────────────────────┐<br/>│                                             │<br/>│    New version available 4.5.13 → 5.0.8     │<br/>│   Run yarn global add @vue/cli to update!   │<br/>│                                             │<br/>└─────────────────────────────────────────────┘<br/><br/>? Please pick a preset: Manually select features<br/>? Check the features needed for your project: Choose Vue version, Babel, TS, Linter<br/>? Choose a version of Vue.js that you want to start the project with 3.x<br/>? Use class-style component syntax? No<br/>? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes<br/>? Pick a linter / formatter config: Basic<br/>? Pick additional lint features: Lint on save<br/>? Where do you prefer placing config for Babel, ESLint, etc.? In package.json<br/>? Save this as a preset for future projects? No<br/><br/><br/>Vue CLI v4.5.13<br/>✨  Creating project in C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end.<br/>⚙️  Installing CLI plugins. This might take a while...<br/><br/>yarn install v1.22.4<br/>info No lockfile found.<br/>[1/4] Resolving packages...<br/>[2/4] Fetching packages...<br/>info fsevents@2.3.2: The platform "win32" is incompatible with this module.<br/>info "fsevents@2.3.2" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>info fsevents@1.2.13: The platform "win32" is incompatible with this module.<br/>info "fsevents@1.2.13" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>[#################################################################################################################################################################################################################################] 1152/1152[3/4] Linking dependencies...<br/>[########################################################################################################################################################-----------------------------------------------------------------------] 16410/[#####<br/><br/><br/>success Saved lockfile.<br/>info To upgrade, download the latest installer at "https://yarnpkg.com/latest.msi".<br/>Done in 171.56s.<br/>�  Invoking generators...<br/>�  Installing additional dependencies...<br/><br/>yarn install v1.22.4<br/>[1/4] Resolving packages...<br/>⠂ @typescript-eslint/eslint-plugin@^4.18.0</span></pre><p id="5a0f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我每次都对依赖前端框架的数量感到印象深刻和困惑！</p><p id="aa0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">差不多用了 3 分钟！</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="07a0" class="md kw in lz b be me mf l mg mh">Vue CLI v4.5.13<br/>✨  Creating project in C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end.<br/>⚙️  Installing CLI plugins. This might take a while...<br/><br/>yarn install v1.22.4<br/>info No lockfile found.<br/>[1/4] Resolving packages...<br/>[2/4] Fetching packages...<br/>info fsevents@2.3.2: The platform "win32" is incompatible with this module.<br/>info "fsevents@2.3.2" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>info fsevents@1.2.13: The platform "win32" is incompatible with this module.<br/>info "fsevents@1.2.13" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>[#################################################################################################################################################################################################################################] 1152/1152[3/4] Linking dependencies...<br/>[########################################################################################################################################################-----------------------------------------------------------------------] 16410/[#####<br/><br/><br/>success Saved lockfile.<br/>info To upgrade, download the latest installer at "https://yarnpkg.com/latest.msi".<br/>Done in 171.56s.<br/>�  Invoking generators...<br/>�  Installing additional dependencies...<br/><br/>yarn install v1.22.4<br/>[1/4] Resolving packages...<br/>[2/4] Fetching packages...<br/>info fsevents@2.3.2: The platform "win32" is incompatible with this module.<br/>info "fsevents@2.3.2" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>info fsevents@1.2.13: The platform "win32" is incompatible with this module.<br/>info "fsevents@1.2.13" is an optional dependency and failed compatibility check. Excluding it from installation.<br/>[3/4] Linking dependencies...<br/>[4/4] Building fresh packages...<br/><br/>success Saved lockfile.<br/>Done in 54.80s.<br/>⚓  Running completion hooks...<br/><br/>�  Generating README.md...<br/><br/>�  Successfully created project front-end.<br/>�  Get started with the following commands:<br/><br/> $ cd front-end<br/> $ yarn serve</span></pre><p id="0ac9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在运行之前，让我们先看看带有 VS 代码的项目！</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="ae44" class="md kw in lz b be me mf l mg mh">λ cd front-end\<br/><br/>C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end (main -&gt; origin)<br/>λ code .</span></pre><p id="fabb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们看到:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mj"><img src="../Images/9ca608b8e599b1f5fec537cc355b3231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxhkW3N4NvfAg9miVcExsg.png"/></div></div></figure><p id="6d20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们信任我们的代码，我们看到以下项目:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mj"><img src="../Images/7d22cf09c1723af4023116200f3f8462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ab3m9iVC2sZWWrdaT5mPyg.png"/></div></div></figure><p id="a625" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们不关注 Vuejs 3.0 的项目结构，我们只需要知道在哪里添加我们的 Keycloak 客户端，这样我们就可以为我们的 Vuejs 演示添加安全性！</p><p id="6847" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将打开 main.ts 文件:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="5603" class="md kw in lz b be me mf l mg mh">import { createApp } from 'vue'<br/>import App from './App.vue'<br/><br/>createApp(App).mount('#app')</span></pre><p id="c48e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将是我们可以添加键盘锁的地方！</p><p id="7ed9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是首先，我们需要确保我们的应用程序可以正常运行！</p><p id="1e73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们使用以下命令将我们的应用程序托管在开发服务器中:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="16be" class="md kw in lz b be me mf l mg mh">yyyy@xxx MINGW64 /c/Tutorial/keycloak/vuejs3webapikeycloak/front-end (main)<br/>$ yarn serve<br/>yarn run v1.22.4<br/>$ vue-cli-service serve<br/> INFO  Starting development server...<br/>98% after emitting CopyPlugin<br/><br/> DONE  Compiled successfully in 5569ms                                                                                   15:59:11<br/><br/><br/>  App running at:<br/>  - Local:   http://localhost:8080/<br/>  - Network: http://xxx:8080/<br/><br/>  Note that the development build is not optimized.<br/>  To create a production build, run yarn build.<br/><br/>No issues found.</span></pre><p id="0a30" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们运行调试会话，并选择 chrome 作为我们的浏览器</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/7657017ae8ed2025cf15cf119cff4c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*HI7OgHBHZHHB-XKhWFiVaw.png"/></div></figure><p id="cc02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/d3fe34a35af24f60bce30a17800f0722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*qeS9TjK3fjMl2lOq8lbcKA.png"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mm"><img src="../Images/2dad67895c8abb65ac44c6e46cbbbe5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8764uX8aYfcFug2MN-Vs7g.png"/></div></div></figure><p id="3e04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们创建了 launch.json 文件:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mn"><img src="../Images/c2c08211c9e467bdf615a42786a8f056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QcmV3V3iLooMXM7VNc4lDg.png"/></div></div></figure><p id="527e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们运行我们的调试:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/3e571543203cb328146fe2daa627052a.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*j6UhNLOzEdokfReHMt5LNQ.png"/></div></figure><p id="aa80" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们看到了我们的 chrome 和我们的应用！</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mp"><img src="../Images/4a65e5eabcb95216754357bd0c30be61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYwCEEg83ApqVYU7EKaTEQ.png"/></div></div></figure><p id="bd40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们需要将 Keycloak 添加到我们的 Vuejs 3.0 项目中！</p><p id="9f60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以看到之前启用的 3 个 CLI 插件:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/c072b7d846cff30437023f62b4f4aea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*nCCNm_WOLlYH6nZ-ZuSs-g.png"/></div></figure><p id="bdc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">及其各自的链接:</p><ul class=""><li id="4d6b" class="mr ms in jm b jn jo jr js jv mt jz mu kd mv kh mw mx my mz bi translated"><a class="ae ki" href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-babel" rel="noopener ugc nofollow" target="_blank">巴别塔插件</a></li><li id="60a7" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><a class="ae ki" href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-typescript" rel="noopener ugc nofollow" target="_blank">打字稿插件</a></li><li id="2ed9" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><a class="ae ki" href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-eslint" rel="noopener ugc nofollow" target="_blank"> eslint 插件</a></li></ul><p id="0954" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们用 npm 安装<strong class="jm io"> Keycloak-js </strong>:</p><p id="7ae5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以在以下链接中找到所有可用版本:</p><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/keycloak-js?activeTab=versions" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">keycloak-js</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">键盘锁适配器。最新版本:20.0.1，最后发布时间:6 天前。通过以下方式开始在您的项目中使用 key cloak-js…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kt ni"/></div></div></a></div><p id="7b77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用 Docker 运行最新的稳定版 Keycloak 19.0.3:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="0f8a" class="md kw in lz b be me mf l mg mh">λ docker run -p 8081:8080 -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:19.0.3 start-dev<br/>Updating the configuration and installing your custom providers, if any. Please wait.<br/>2022-11-19 14:15:11,742 INFO  [io.quarkus.deployment.QuarkusAugmentor] (main) Quarkus augmentation completed in 22124ms<br/>2022-11-19 14:15:15,287 INFO  [org.keycloak.quarkus.runtime.hostname.DefaultHostnameProvider] (main) Hostname settings: Base URL: &lt;unset&gt;, Hostname: &lt;request&gt;, Strict HTTPS: false, Path: &lt;request&gt;, Strict BackChannel: false, Admin URL: &lt;unset&gt;, Admin: &lt;request&gt;, Port: -1, Proxied: false<br/>2022-11-19 14:15:17,112 INFO  [org.keycloak.common.crypto.CryptoIntegration] (main) Detected crypto provider: org.keycloak.crypto.def.DefaultCryptoProvider<br/>2022-11-19 14:15:19,865 WARN  [org.infinispan.CONFIG] (keycloak-cache-init) ISPN000569: Unable to persist Infinispan internal caches as no global state enabled<br/>2022-11-19 14:15:19,988 WARN  [org.infinispan.PERSISTENCE] (keycloak-cache-init) ISPN000554: jboss-marshalling is deprecated and planned for removal<br/>2022-11-19 14:15:20,029 INFO  [org.infinispan.CONTAINER] (keycloak-cache-init) ISPN000556: Starting user marshaller 'org.infinispan.jboss.marshalling.core.JBossUserMarshaller'<br/>2022-11-19 14:15:20,550 INFO  [org.infinispan.CONTAINER] (keycloak-cache-init) ISPN000128: Infinispan version: Infinispan 'Triskaidekaphobia' 13.0.9.Final<br/>2022-11-19 14:15:21,011 INFO  [org.keycloak.connections.infinispan.DefaultInfinispanConnectionProviderFactory] (main) Node name: node_425607, Site name: null<br/>2022-11-19 14:15:22,808 INFO  [org.keycloak.quarkus.runtime.storage.legacy.liquibase.QuarkusJpaUpdaterProvider] (main) Initializing database schema. Using changelog META-INF/jpa-changelog-master.xml<br/>2022-11-19 14:15:26,821 INFO  [org.keycloak.services] (main) KC-SERVICES0050: Initializing master realm<br/>2022-11-19 14:15:30,627 INFO  [io.quarkus] (main) Keycloak 19.0.3 on JVM (powered by Quarkus 2.7.6.Final) started in 18.773s. Listening on: http://0.0.0.0:8080<br/>2022-11-19 14:15:30,627 INFO  [io.quarkus] (main) Profile dev activated.<br/>2022-11-19 14:15:30,627 INFO  [io.quarkus] (main) Installed features: [agroal, cdi, hibernate-orm, jdbc-h2, jdbc-mariadb, jdbc-mssql, jdbc-mysql, jdbc-oracle, jdbc-postgresql, keycloak, logging-gelf, narayana-jta, reactive-routes, resteasy, resteasy-jackson, smallrye-context-propagation, smallrye-health, smallrye-metrics, vault, vertx]<br/>2022-11-19 14:15:31,254 INFO  [org.keycloak.services] (main) KC-SERVICES0009: Added user 'admin' to realm 'master'<br/>2022-11-19 14:15:31,265 WARN  [org.keycloak.quarkus.runtime.KeycloakMain] (main) Running the server in development mode. DO NOT use this configuration in production.<br/>2022-11-19 14:21:35,079 WARN  [org.keycloak.events] (executor-thread-6) type=LOGIN_ERROR, realmId=cf173a2d-6041-4aaf-83fd-58fba4180d1d, clientId=vuejs, userId=null, ipAddress=172.17.0.1, error=invalid_redirect_uri, redirect_uri=http://localhost:8080/</span></pre><p id="919a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完成后，我们只需要更改配置选项，以便使用您企业的生产 Keycloak 实例。</p><p id="af6f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们在主机上使用端口 8081，因为 Vuejs 已经使用了端口 8080。</p><p id="8094" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/90ea766fd49d97d5eb6591bade82897e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Xa2lJrP1tD2Urf5GYrXEg.png"/></div></div></figure><p id="6857" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用管理员帐户登录:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/0879c24ce91f69663bd6daa72c921e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wxCCERvYAhLL6_7KhYaSHQ.png"/></div></div></figure><p id="f145" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加一个领域“vue”和一个客户端“vuejs”:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/ef0181b25277f00e71d9ea3177a78874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdyPKNKrBH4bSPslVP3Kvw.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/e383f970f5987be83f644f557d617315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dHTH4gdT8Gv1tHv8Ncj0Q.png"/></div></div></figure><p id="1570" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们有 OpenId 连接的配置:</p><ul class=""><li id="c263" class="mr ms in jm b jn jo jr js jv mt jz mu kd mv kh mw mx my mz bi translated">客户端身份验证关闭:这定义了 OIDC 客户端的类型。打开时，OIDC 类型设定为机密访问类型。关闭时，设置为<strong class="jm io">公共访问类型。我们把它留给公共访问类型。</strong></li><li id="53fd" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">授权是关闭的:启用/禁用对客户端的细粒度授权支持和禁用，我们在这里不需要它。仅当我们使用机密访问类型时，此选项才可用。由于我们的 vue 应用程序是一个带有 javascript 的前端应用程序，我们不能信任它使用带有秘密的机密访问类型，所以我们使用公共访问类型。</li><li id="21c9" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">在身份验证流程中，我们必须选中“标准流程”:这将启用带有授权代码的标准 OpenID Connect 基于重定向的身份验证。就 OpenID Connect 或 OAuth2 规范而言，这实现了对此客户端的“授权代码流”的支持。</li><li id="49e0" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">直接访问授权:我们必须禁用它，因为它提供了针对用户名/提供者的令牌。此选项支持直接访问授权，这意味着客户端可以访问用户的用户名/密码，并直接与 Keycloak 服务器交换访问令牌。就 OAuth2 规范而言，这支持该客户端的“资源所有者密码凭证授权”。</li></ul><p id="b9d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们单击“保存”。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/6495a47eed8960a87f4d3f673a0f639b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnxEmEzIECtjC5CUkpKJSA.png"/></div></div></figure><p id="12f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在将重点关注访问设置部分</p><h1 id="4525" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">访问设置</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/6c029c01a5cf81fc3649ba3af48f3e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GJp5MdZT5iQ7BjDtT9j6A.png"/></div></div></figure><p id="d8a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将重点关注:</p><ul class=""><li id="2344" class="mr ms in jm b jn jo jr js jv mt jz mu kd mv kh mw mx my mz bi translated">有效重定向 URIs:浏览器在成功登录后可以重定向到的有效 URI 模式。允许使用简单通配符，如“http://example.com/*”。也可以指定相对路径，例如/my/relative/path/*。相对路径是相对于客户端根 URL 的路径，如果没有指定，则使用身份验证服务器根 URL。对于 SAML，如果您依赖于登录请求中嵌入的消费者服务 URL，则必须设置有效的 URI 模式。在我们的例子中，我们将使用我们的 vuejs 开发 URL: http://localhost:8080/*</li><li id="53c1" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">有效的注销后重定向 URIs:浏览器在成功注销后可以重定向到的有效 URI 模式。值“+”将使用有效重定向 uri 的列表。允许使用简单通配符，如“http://example.com/*”。也可以指定相对路径，例如/my/relative/path/*。相对路径是相对于客户端根 URL 的路径，如果没有指定，则使用身份验证服务器根 URL。对于 SAML，如果您依赖于登录请求中嵌入的消费者服务 URL，则必须设置有效的 URI 模式。我们将只输入:<a class="ae ki" href="http://localhost:80" rel="noopener ugc nofollow" target="_blank"> http://xxx:80 </a> 80，其中 xxx 是我们的 ip</li><li id="89bc" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">网络起源:允许 CORS 起源。要允许有效重定向 URIs 的所有来源，请添加“+”。但是这不包括通配符' * '。若要允许所有来源，请显式添加“*”。我们将使用<a class="ae ki" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://xxx:8080 </a>和<a class="ae ki" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://xxx:8080 </a> /*</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/5db4bb2d39d70835aec4fe7a3fe6868d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKdLkClY7cIlYlJlvy2flA.png"/></div></div></figure><p id="a888" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们按下“保存”</p><p id="470e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们创建用户和角色。</p><h1 id="5802" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">用户</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi od"><img src="../Images/5e04f47c601fdafc6509a473c72d5d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-XOi7T7saUSIgCTml5rWg.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oe"><img src="../Images/54ec8740a08b407b6940676d750e12bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24BXGk6uLs0VK0ULUsxNoA.png"/></div></div></figure><p id="607f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们只添加用户名。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi of"><img src="../Images/75f1065d59050f556c323eefcaf70532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*obH8Pf34VjDE8ymjW_8qBA.png"/></div></figure><p id="d9f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击“创建”</p><p id="ff0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加一个密码:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/02652939606d3672a8102c69d6566a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEWB0OR5gSkJKe0jbkMR4A.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/75f49b57e223efc73b864e796466cfca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UcvgxUc4Bou5dzrufoQYA.png"/></div></div></figure><p id="c207" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们关闭“临时”</p><p id="648c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们创建应用程序的角色。</p><h1 id="530c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">应用程序的角色</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oh"><img src="../Images/15b0eb9c8c0ce8f730dc6965e4922c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G1rhb0J5GYvJkHeNtEshhQ.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ead8d0bb65be725b79c8bd9996ae95f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*Zu3bd-P_l9XkABkCQ2Tscw.png"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/9e31d6838796e40106aa19ce830c6e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ZJZx8Exo_aTycBYLIO4_g.png"/></div></div></figure><p id="4102" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们向我们的客户端“vuejs”添加了一个简单的角色“admin”。</p><p id="8342" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们将这个角色与我们的用户相关联:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mj"><img src="../Images/59f23e5a7832d82f8de13a7e4e49adea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtJSAuMHwJ3ORPFlJqKDng.png"/></div></div></figure><p id="b5fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击“分配角色”</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oe"><img src="../Images/48bb54e92b7dd90d0d1e7c2e31197d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XRHhmJJ0aJTMlKqZQd6Lg.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/04260d3f5364d25da51aea67f99d38b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N19rcnLrWMCtbZCKwTl9SA.png"/></div></div></figure><p id="487c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击“分配”</p><p id="712e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们检查我们拥有客户端“vuejs”的角色“admin”:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/92008d3cdfc99eaa279a62325dde5cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*mFDmM6Ia22z54u61Jb1pFA.png"/></div></figure><p id="2f03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们完成了 Keycloak 管理。</p><p id="c925" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们回到我们的 vuejs 应用程序，用 keycloak-js 包保护它。</p><p id="0d84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们先检查一下 keycloak 服务器版本:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/71954a927bcfdffe5e5ad1f235f5a325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbH0tgVWZZO7sTR2zH0jIw.png"/></div></div></figure><p id="a2be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用 19.0.3 版本。</p><p id="56b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以还是拿同版本的 keycloak-js npm 包吧。</p><h1 id="add9" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">Keycloak js npm</h1><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/keycloak-js" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">keycloak-js</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">键盘锁适配器。最新版本:20.0.1，最后发布时间:9 天前。通过以下方式开始在您的项目中使用 key cloak-js…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="on l nt nu nv nr nw kt ni"/></div></div></a></div><p id="c600" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些版本位于以下链接:</p><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/keycloak-js?activeTab=versions" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">keycloak-js</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">键盘锁适配器。最新版本:20.0.1，最后发布时间:9 天前。通过以下方式开始在您的项目中使用 key cloak-js…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="oo l nt nu nv nr nw kt ni"/></div></div></a></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi op"><img src="../Images/f373aac381cf1cf93ae8ff412259567b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z22YVp-cNLE1fhTSn1Igfw.png"/></div></div></figure><p id="804f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用主要版本<strong class="jm io"> 19.0.3 </strong>的最新次要版本</p><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/keycloak-js/v/19.0.3" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">keycloak-js</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">键盘锁适配器。最新版本:20.0.1，最后发布时间:10 天前。通过以下方式开始在您的项目中使用 key cloak-js…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="oq l nt nu nv nr nw kt ni"/></div></div></a></div><p id="a4ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它给了我们命令:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="3756" class="md kw in lz b be me mf l mg mh">npm i keycloak-js@19.0.3</span></pre><p id="861a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们在 VS 代码终端上完成它</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi od"><img src="../Images/012f7a482010e7fe2afa7d6b0e065c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FBC-fMtZUxOE3r6asYkzYQ.png"/></div></div></figure><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="70cd" class="md kw in lz b be me mf l mg mh">C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end&gt;npm i keycloak-js@19.0.3<br/>npm WARN deprecated @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained<br/>npm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained<br/>npm WARN deprecated @hapi/bourne@1.3.2: This version has been deprecated and is no longer supported or maintained<br/>npm WARN deprecated @hapi/address@2.1.4: Moved to 'npm install @sideway/address'<br/>npm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142<br/>npm WARN deprecated har-validator@5.1.5: this library is no longer supported<br/>npm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.<br/>npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated<br/>npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated<br/>npm WARN deprecated querystring@0.2.0: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.<br/>npm WARN deprecated chokidar@2.1.8: Chokidar 2 will break on node v14+. Upgrade to chokidar 3 with 15x less dependencies.        <br/>npm WARN deprecated fsevents@1.2.13: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.<br/>npm WARN deprecated eslint-loader@2.2.1: This loader has been deprecated. Please use eslint-webpack-plugin<br/>npm WARN deprecated html-webpack-plugin@3.2.0: 3.x is no longer supported<br/><br/>&gt; yorkie@2.0.0 uninstall C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\yorkie<br/>&gt; node bin/uninstall.js<br/><br/>husky<br/>uninstalling Git hooks<br/>done<br/><br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\rimraf.cmd as it wasn't installed <br/>by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\rimraf<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\rimraf as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\rimraf<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\uuid.cmd as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\uuid<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\uuid as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\uuid<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\semver.cmd as it wasn't installed <br/>by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\semver<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\semver as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\semver<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\json5.cmd as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\json5<br/>npm WARN rm not removing C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\.bin\json5 as it wasn't installed by C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\json5<br/><br/>&gt; yorkie@2.0.0 install C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\yorkie<br/>&gt; node bin/install.js<br/><br/>setting up Git hooks<br/>can't find .git directory, skipping Git hooks installation<br/><br/>&gt; core-js@3.26.1 postinstall C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\@vue\babel-preset-app\node_modules\core-js<br/>&gt; node -e "try{require('./postinstall')}catch(e){}"<br/><br/>Thank you for using core-js ( https://github.com/zloirock/core-js ) for polyfilling JavaScript standard library!<br/><br/>The project needs your help! Please consider supporting of core-js:<br/>&gt; https://opencollective.com/core-js <br/>&gt; https://patreon.com/zloirock <br/>&gt; bitcoin: bc1qlea7544qtsmj2rayg0lthvza9fau63ux0fstcz <br/><br/>Also, the author of core-js ( https://github.com/zloirock ) is looking for a good job -)<br/><br/><br/>&gt; ejs@2.7.4 postinstall C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end\node_modules\ejs<br/>&gt; node ./postinstall.js<br/><br/>Thank you for installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)<br/><br/>npm notice created a lockfile as package-lock.json. You should commit this file.<br/>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.3.2 (node_modules\watchpack\node_modules\chokidar\node_modules\fsevents):<br/>npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.3.2: wanted {"os":"darwin","arch":"any"} (current: {"os":"win32","arch":"x64"})<br/>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@^1.2.7 (node_modules\chokidar\node_modules\fsevents):<br/>npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.13: wanted {"os":"darwin","arch":"any"} (current: {"os":"win32","arch":"x64"})<br/>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fork-ts-checker-webpack-plugin-v5@npm:fork-ts-checker-webpack-plugin@^5.0.11 (node_modules\@vue\cli-plugin-typescript\node_modules\fork-ts-checker-webpack-plugin-v5):<br/>npm WARN notarget SKIPPING OPTIONAL DEPENDENCY: No matching version found for fork-ts-checker-webpack-plugin-v5@5.2.1.<br/>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: vue-loader-v16@npm:vue-loader@^16.1.0 (node_modules\@vue\cli-service\node_modules\vue-loader-v16):<br/>npm WARN notarget SKIPPING OPTIONAL DEPENDENCY: No matching version found for vue-loader-v16@16.8.3.<br/><br/>+ keycloak-js@19.0.3<br/>added 96 packages from 38 contributors, removed 76 packages, updated 1252 packages and audited 1362 packages in 112.25s<br/><br/>119 packages are looking for funding<br/>  run `npm fund` for details<br/><br/>found 13 vulnerabilities (2 low, 2 moderate, 7 high, 2 critical)<br/>  run `npm audit fix` to fix them, or `npm audit` for details<br/><br/><br/>   ╭───────────────────────────────────────────────────────────────╮<br/>   │                                                               │<br/>   │      New major version of npm available! 6.14.4 -&gt; 9.1.1      │<br/>   │   Changelog: https://github.com/npm/cli/releases/tag/v9.1.1   │<br/>   │               Run npm install -g npm to update!               │<br/>   │                                                               │<br/>   ╰───────────────────────────────────────────────────────────────╯<br/><br/><br/>C:\Tutorial\keycloak\vuejs3webapikeycloak\front-end&gt;</span></pre><p id="fed7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">相当重，有将近 100 个包裹！</p><p id="cb1a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们准备添加将使用 js 适配器的代码库。</p><h1 id="c6c6" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">添加钥匙锁</h1><p id="d3a4" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">当我们添加 keycloak-js 时，我们可以在依赖项中看到它:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="30c7" class="md kw in lz b be me mf l mg mh">{<br/>  "name": "front-end",<br/>  "version": "0.1.0",<br/>  "private": true,<br/>  "scripts": {<br/>    "serve": "vue-cli-service serve",<br/>    "build": "vue-cli-service build",<br/>    "lint": "vue-cli-service lint"<br/>  },<br/>  "dependencies": {<br/>    "core-js": "^3.6.5",<br/>    "keycloak-js": "^19.0.3",<br/>    "vue": "^3.0.0"<br/>  },<br/>  "devDependencies": {<br/>    "@typescript-eslint/eslint-plugin": "^4.18.0",<br/>    "@typescript-eslint/parser": "^4.18.0",<br/>    "@vue/cli-plugin-babel": "~4.5.13",<br/>    "@vue/cli-plugin-eslint": "~4.5.13",<br/>    "@vue/cli-plugin-typescript": "~4.5.13",<br/>    "@vue/cli-service": "~4.5.13",<br/>    "@vue/compiler-sfc": "^3.0.0",<br/>    "@vue/eslint-config-typescript": "^7.0.0",<br/>    "eslint": "^6.7.2",<br/>    "eslint-plugin-vue": "^7.0.0",<br/>    "typescript": "~4.1.5"<br/>  },<br/>  "eslintConfig": {<br/>    "root": true,<br/>    "env": {<br/>      "node": true<br/>    },<br/>    "extends": [<br/>      "plugin:vue/vue3-essential",<br/>      "eslint:recommended",<br/>      "@vue/typescript/recommended"<br/>    ],<br/>    "parserOptions": {<br/>      "ecmaVersion": 2020<br/>    },<br/>    "rules": {}<br/>  },<br/>  "browserslist": [<br/>    "&gt; 1%",<br/>    "last 2 versions",<br/>    "not dead"<br/>  ]<br/>}</span></pre><p id="69b4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以在应用程序中导入 keycloak js 适配器特性。为此，我们将通过创建带有接口的服务来享受 Typescript。</p><p id="5b92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它将使在任何地方使用它和改变它的实现变得更加容易。</p><p id="0b8d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们为我们的 keycloak 服务创建一个名为“security”的文件夹，这个服务实例将使我们在 React 项目中的任何地方使用它变得更加容易。</p><p id="acfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加名为“KeycloakService.ts”的 ts 文件</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi or"><img src="../Images/667dbec080f1bca24d066f222641f9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C1tdqMFJLiLeugzxgTcJTw.png"/></div></div></figure><p id="0153" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们添加以下代码:</p><ul class=""><li id="b11d" class="mr ms in jm b jn jo jr js jv mt jz mu kd mv kh mw mx my mz bi translated">首先，我们从 keycloak js 中导入 Keycloak 类</li><li id="3edd" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">我们创建一个<strong class="jm io">实例</strong> keycloakInstance</li><li id="2f1b" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">我们创建一个<strong class="jm io">函数</strong>登录，如果用户通过了身份验证，就调用这个函数。这里，该函数将显示 React 应用程序的主要组件。<br/>要理解这一部分，请查阅链接<br/><a class="ae ki" href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter" rel="noopener ugc nofollow" target="_blank">https://www . key cloak . org/docs/latest/securing _ apps/index . html # JavaScript _ adapter</a></li></ul><p id="dae5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">非常重要的是要记住，文档说在<a class="ae ki" href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_implicit_flow" rel="noopener ugc nofollow" target="_blank">https://www . key cloak . org/docs/latest/securing _ apps/index . html # _ JavaScript _ implicit _ flow</a></p><blockquote class="os ot ou"><p id="7b5a" class="jk jl ov jm b jn jo jp jq jr js jt ju ow jw jx jy ox ka kb kc oy ke kf kg kh ig bi translated"><em class="in">默认情况下，JavaScript 适配器使用</em> <a class="ae ki" href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth" rel="noopener ugc nofollow" target="_blank"> <em class="in">授权码</em> </a> <em class="in">流。</em></p></blockquote><p id="4132" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">因此，我们确保客户端可以通过使用授权代码流与服务器端通信，默认情况下，Keycloak Javascript 适配器使用我们在 Keycloak 服务器配置上为客户端“MyApp”启用的授权代码流</strong></p><p id="4e07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们不必对代码流做任何事情。</p><p id="b75e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经准备好确保它能够工作:)在我们的应用程序被呈现之前，我们的<strong class="jm io"> main.ts </strong>文件中</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="8dc0" class="md kw in lz b be me mf l mg mh">import Keycloak from "keycloak-js";<br/><br/>const keycloakInstance = new Keycloak();<br/><br/>interface CallbackOneParam&lt;T1 = void, T2 = void&gt; {<br/>  (param1: T1): T2;<br/>}<br/>/**<br/> * Initializes Keycloak instance and calls the provided callback function if successfully authenticated.<br/> *<br/> * @param onAuthenticatedCallback<br/> */<br/>const Login = (onAuthenticatedCallback: CallbackOneParam) =&gt; {<br/>  keycloakInstance<br/>    .init({ onLoad: "login-required" })<br/>    .then(function (authenticated) {<br/>      authenticated ? onAuthenticatedCallback() : alert("non authenticated");<br/>    })<br/>    .catch((e) =&gt; {<br/>      console.dir(e);<br/>      console.log(`keycloak init exception: ${e}`);<br/>    });<br/>};<br/><br/>const KeyCloakService = {<br/>  CallLogin: Login,<br/>};<br/><br/>export default KeyCloakService;</span></pre><p id="2f24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们使用<strong class="jm io"> main.ts </strong>中的服务密钥:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="7392" class="md kw in lz b be me mf l mg mh">import { createApp } from "vue";<br/>import App from "./App.vue";<br/>import KeyCloakService from "./security/KeycloakService";<br/><br/>const renderApp = () =&gt; {<br/>  createApp(App).mount("#app");<br/>};<br/><br/>KeyCloakService.CallLogin(renderApp);</span></pre><p id="de0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很简单吧？</p><p id="c409" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要添加的最后一件事是 keycloak 配置文件:keycloak.json，位于 public:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oz"><img src="../Images/257fcf9a845d0904def1312c9f259520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wApx6qm3fkxE30XgMyqwaQ.png"/></div></div></figure><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="1c43" class="md kw in lz b be me mf l mg mh">{<br/>  "realm": "vue",<br/>  "auth-server-url": "http://localhost:8081/",<br/>  "ssl-required": "external",<br/>  "resource": "vuejs",<br/>  "public-client": true,<br/>  "confidential-port": 0<br/>}</span></pre><p id="5ea4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们可以更改 keycloak 服务器的 URL，并给出客户机的领域和类型。</p><p id="67d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们转到我们的 Vue 应用程序。</p><h1 id="fd82" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">在 Keycloak 中登录</h1><p id="56c0" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">当我们从 VS.Code 打开浏览器时:</p><p id="eb01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="http://10.7.7.11:8080/" rel="noopener ugc nofollow" target="_blank"> http://xxx:8080/ </a></p><p id="d45c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用 xxx 你的 ip 地址</p><p id="4f4f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们回到 keycloak，而不是 vue 应用程序！</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/08482c5f5c99532ecc3fd7bef42ef98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L72olp1RqChQZxLzg0erSQ.png"/></div></div></figure><p id="dd0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们登录吧！</p><p id="81f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们回来了</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/3ad0cb6fb7108646a49182194da8bfd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7hA3P_O7rB_cs-ZQav4qQ.png"/></div></div></figure><p id="3b4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">恭喜你。我们设法使用 Keycloak 来保护我们与 JWT 的 vue 演示！</p><p id="97f1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以在 chrome 网络开发工具中看到 JWT:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pa"><img src="../Images/9be74478ee6ce9340a0b9622195da1be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y6p6kbOjBBfCxBwAl4t4Vg.png"/></div></div></figure><p id="3ce2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们看到两个标志:</p><ul class=""><li id="5d7f" class="mr ms in jm b jn jo jr js jv mt jz mu kd mv kh mw mx my mz bi translated">访问令牌</li><li id="d1a4" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">id 令牌</li></ul><p id="c38d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一个我们可以用来刷新令牌的令牌。</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="725e" class="md kw in lz b be me mf l mg mh">access_token<br/>: <br/>"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJZbUt1RjU4aGhtOE9xYWd0T2lqTThhQzlyY00yUmlOU091RWg2SVhSYUJrIn0.eyJleHAiOjE2Njg4NzU4NDYsImlhdCI6MTY2ODg3NTU0NiwiYXV0aF90aW1lIjoxNjY4ODc1NDM4LCJqdGkiOiI5NWEzY2NmYy0yMzIxLTRhMTItOTk4OC05NWZkZmQzNTk1OGIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODEvcmVhbG1zL3Z1ZSIsImF1ZCI6ImFjY291bnQiLCJzdWIiOiI0NGQ5MWU5OC00NWQ5LTQwZTItYWQxZC04NTc1NDUxYTZkYjAiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJ2dWVqcyIsIm5vbmNlIjoiZmZhMDMzNTEtODlhMC00YWVkLTgwNGQtZGM3OWVhYmIxYjVjIiwic2Vzc2lvbl9zdGF0ZSI6ImM2ODdkZmY5LTNiY2ItNGMzZi05MTY1LWNkMjcwMjI4MTkxMiIsImFjciI6IjAiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cDovLzEwLjcuNy4xMTo4MDgwLyoiLCJodHRwOi8vMTAuNy43LjExOjgwODAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtdnVlIiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7InZ1ZWpzIjp7InJvbGVzIjpbImFkbWluIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIiwic2lkIjoiYzY4N2RmZjktM2JjYi00YzNmLTkxNjUtY2QyNzAyMjgxOTEyIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ2dWV1c2VyIiwiZ2l2ZW5fbmFtZSI6IiIsImZhbWlseV9uYW1lIjoiIn0.FaIasGuW4k4scAJWaCiLveUXWVQDqktV_7Hz3d2PMMlvdgiRInWbXLgrK4zEU7kI6fQAspm8UdXxX3FEmab8SAIGRFlkhOWE4H3fb29dh5qd93p4e7FDSNqHncdwtas4uzqBRYwN23fX7DdiQTJ2Qxk3L6uDo3eMowXhQIjv3otTFs2lYSGk7AXUHqGy63w0fE2j5eBZm0DUOKW4BWWVIfNJamspw6A5lovqKc3ps9sUoPgojDzWLh3uHbZHfhEdLP1xi3HsbfBBUhdSLJbTSUCTwwKLwe-vnvqKpKiCx_ZgGDzcHoIoFynrlT4Snme1x9W7_ABmIn5WolWnxUw5Fw"<br/>expires_in<br/>: <br/>300<br/>id_token<br/>: <br/>"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJZbUt1RjU4aGhtOE9xYWd0T2lqTThhQzlyY00yUmlOU091RWg2SVhSYUJrIn0.eyJleHAiOjE2Njg4NzU4NDYsImlhdCI6MTY2ODg3NTU0NiwiYXV0aF90aW1lIjoxNjY4ODc1NDM4LCJqdGkiOiJhYmUyNGY0MS0wOGZlLTQwMTgtYWEyZi0wOTk0YmY4OWM5MDUiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODEvcmVhbG1zL3Z1ZSIsImF1ZCI6InZ1ZWpzIiwic3ViIjoiNDRkOTFlOTgtNDVkOS00MGUyLWFkMWQtODU3NTQ1MWE2ZGIwIiwidHlwIjoiSUQiLCJhenAiOiJ2dWVqcyIsIm5vbmNlIjoiZmZhMDMzNTEtODlhMC00YWVkLTgwNGQtZGM3OWVhYmIxYjVjIiwic2Vzc2lvbl9zdGF0ZSI6ImM2ODdkZmY5LTNiY2ItNGMzZi05MTY1LWNkMjcwMjI4MTkxMiIsImF0X2hhc2giOiI2LVZQNHFuU3NuOXNNRzhWbjNFZ2Z3IiwiYWNyIjoiMCIsInNpZCI6ImM2ODdkZmY5LTNiY2ItNGMzZi05MTY1LWNkMjcwMjI4MTkxMiIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwicHJlZmVycmVkX3VzZXJuYW1lIjoidnVldXNlciIsImdpdmVuX25hbWUiOiIiLCJmYW1pbHlfbmFtZSI6IiJ9.AmfzboyfYrNT916xW3iro0YbUkqH0Gx2wfRIvn2e9HuWA2oEIKG6Gqa-P-Obzk8aoxZ6QInqpCwNATYtH19zIjB5i86cJB0NFznDttacupDsI3EPWRJ4vG5kX6YUpQuJLq-vunWAkZxC2Swd6AyrTgAVnfvEh0y1UbdnfBF8GbDIglUlYBkwOC8B3PpRqbyfFRIksLfl-PTuRGIfbK5Dm3mVY99sQyl_mOFnL__6E7g3F1y_YcXluzGethHtVJ8hcoMR6xWzO2GY7Ny3ZoqewRr5-iwf-_vaCXW6iF67E-aX69JRBaZBXH8egrgAo5c9yyXDFU_2T9m6Ry6wq8ysXA"<br/>not-before-policy<br/>: <br/>0<br/>refresh_expires_in<br/>: <br/>1800<br/>refresh_token<br/>: <br/>"eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJlMWQ1ZWM0ZC0yZmQwLTQxNDAtYTIzZi05Mjg1YzBiZmIyY2QifQ.eyJleHAiOjE2Njg4NzczNDYsImlhdCI6MTY2ODg3NTU0NiwianRpIjoiZDgxMjM0MmEtNTgyZi00N2JjLTg1NzMtYjliZWZkNzI5ZmNlIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgxL3JlYWxtcy92dWUiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjgwODEvcmVhbG1zL3Z1ZSIsInN1YiI6IjQ0ZDkxZTk4LTQ1ZDktNDBlMi1hZDFkLTg1NzU0NTFhNmRiMCIsInR5cCI6IlJlZnJlc2giLCJhenAiOiJ2dWVqcyIsIm5vbmNlIjoiZmZhMDMzNTEtODlhMC00YWVkLTgwNGQtZGM3OWVhYmIxYjVjIiwic2Vzc2lvbl9zdGF0ZSI6ImM2ODdkZmY5LTNiY2ItNGMzZi05MTY1LWNkMjcwMjI4MTkxMiIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwiLCJzaWQiOiJjNjg3ZGZmOS0zYmNiLTRjM2YtOTE2NS1jZDI3MDIyODE5MTIifQ.bgIrYLbu1TiK5I1dV09YjXHJW3RUYTZMETYh6jf1Gr4"<br/>scope<br/>: <br/>"openid profile email"<br/>session_state<br/>: <br/>"c687dff9-3bcb-4c3f-9165-cd2702281912"<br/>token_type<br/>: <br/>"Bearer"</span></pre><h1 id="27ab" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">注意</h1><p id="df3e" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">如果您在运行 Vue 应用程序时遇到以下问题，并显示以下消息:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="719e" class="md kw in lz b be me mf l mg mh">ERROR in ./src/main.js 3:0-57<br/>Module not found: Error: Can't resolve './security/KeycloakService' in 'xxxx'.</span></pre><p id="143e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请从您的终端运行以下命令:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="d844" class="md kw in lz b be me mf l mg mh">npm i</span></pre><p id="eb21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确保所有依赖项都已正确安装。</p><p id="c38e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您甚至可以先删除文件夹 node_modules</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/352b63d652a32665402fd1c2bae3261a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*z8G4nWupqWYjqVx4Zv_ltA.png"/></div></figure><p id="65e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并运行以下命令:</p><pre class="kk kl km kn gt ly lz ma bn mb mc bi"><span id="d51a" class="md kw in lz b be me mf l mg mh">npm i</span></pre><h1 id="cc99" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="3439" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">第一部分到此结束。</p><p id="002a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们学习了如何在开发模式下使用 Keycloak，并将 keycloak js 适配器添加到我们的 vuejs 演示应用程序中。</p><p id="29dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将在第 2 部分中看到如何注销并使用我们的 JWT 令牌:id 令牌来获取用户名和访问令牌，以查看声明和角色。</p><p id="0faa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在第 3 部分中，我们将看到如何将 JWT 访问令牌发送到我们的安全 ASP.NET 核心 Web API，该 API 将使用我们的访问令牌并对其进行验证。</p><p id="5e01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您喜欢本教程，请订阅，不要犹豫鼓掌或提问。我会在 24 小时内回复。干杯！</p></div></div>    
</body>
</html>