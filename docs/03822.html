<html>
<head>
<title>Vue Router 4–Navigation Guards</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue路由器4–导航防护装置</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/vue-router-4-navigation-guards-7992fa57d220?source=collection_archive---------4-----------------------#2020-12-21">https://blog.devgenius.io/vue-router-4-navigation-guards-7992fa57d220?source=collection_archive---------4-----------------------#2020-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3dc2ee06dff15154d6a80aac9d681b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_8belFJev7gbgXyx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@lwitham?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">琳达·芬金</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a11e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue Router 4处于测试阶段，可能会有变化。</p><p id="637d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了轻松地构建一个单页面应用程序，我们需要添加路由，以便将URL映射到呈现的组件。</p><p id="0ba0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用Vue路由器4与Vue 3。</p><h1 id="348d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导航防护装置</h1><p id="7bd2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过重定向或取消导航来添加导航防护。</p><p id="99c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">守卫只有在我们导航到不同的路线时才会被触发。</p><p id="ea03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">URL参数和查询更改不会触发进入或离开导航卫士。</p><h1 id="1a78" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">警卫前的全局</h1><p id="6ce9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过向<code class="fe me mf mg mh b">router.beforeEach</code>方法传递一个回调来添加一个全局before guard。</p><p id="2855" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ffea" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vue-router@4.0.0-beta.7/dist/vue-router.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;<br/>        &lt;router-link to="/foo"&gt;foo&lt;/router-link&gt;<br/>        &lt;router-link to="/bar"&gt;bar&lt;/router-link&gt;<br/>      &lt;/p&gt;<br/>      &lt;router-view&gt;&lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const Foo = {<br/>        template: "&lt;div&gt;foo&lt;/div&gt;"<br/>      };<br/>      const Bar = {<br/>        template: "&lt;div&gt;bar&lt;/div&gt;",<br/>        props: ["id"]<br/>      };<br/>      const routes = [<br/>        {<br/>          path: "/foo",<br/>          component: Foo<br/>        },<br/>        {<br/>          path: "/bar",<br/>          component: Bar<br/>        }<br/>      ];<br/>      const router = VueRouter.createRouter({<br/>        history: VueRouter.createWebHistory(),<br/>        routes<br/>      });</span><span id="dcfd" class="mq lc iq mh b gy mv ms l mt mu">      router.beforeEach((to, from, next) =&gt; {<br/>        console.log(to, from);<br/>        next();<br/>      });<br/>      const app = Vue.createApp({});<br/>      app.use(router);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c676" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用回调来调用<code class="fe me mf mg mh b">router.beforeEach</code>方法。</p><p id="5d26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回调需要一个<code class="fe me mf mg mh b">to</code>、<code class="fe me mf mg mh b">from</code>和<code class="fe me mf mg mh b">next</code>参数。</p><p id="78f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">to</code>是导航到的路线对象。</p><p id="80cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">from</code>是被导航离开的路线对象。</p><p id="141c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">路由对象有<code class="fe me mf mg mh b">fullPath</code>、元数据、查询参数、URL参数等等。</p><p id="a538" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">next</code>是解析钩子必须调用的函数。</p><p id="f237" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要调用<code class="fe me mf mg mh b">next</code>来显示<code class="fe me mf mg mh b">to</code>路线。</p><p id="e132" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">next</code>函数可以接受一个参数。</p><p id="f11f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们进入<code class="fe me mf mg mh b">false</code>，则当前导航被中止。</p><p id="18a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果浏览器URL被更改，它将重置为<code class="fe me mf mg mh b">from</code>路线中的URL。</p><p id="6a40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以用路径字符串传入一个路径字符串或者一个带有<code class="fe me mf mg mh b">path</code>属性的对象。</p><p id="25b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不管怎样，我们都要去不同的地方。</p><p id="6a08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当前导航被中止，将开始新的导航。</p><p id="7463" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对象可以有额外的选项，如来自路线的<code class="fe me mf mg mh b">replace</code>和<code class="fe me mf mg mh b">name</code>属性。</p><p id="9184" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何被<code class="fe me mf mg mh b">router.push</code>接受的属性都被接受。</p><p id="3459" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有任何错误，我们也可以传入一个<code class="fe me mf mg mh b">Error</code>实例。</p><p id="548f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后导航将被中止，错误将被传递给用<code class="fe me mf mg mh b">router.onError()</code>注册的回调。</p><p id="0b33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该确保<code class="fe me mf mg mh b">next</code>在回调中只被调用一次。</p><p id="d91e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，导航可能永远无法解决，或者可能导致错误。</p><p id="0a24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以与其写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8187" class="mq lc iq mh b gy mr ms l mt mu">router.beforeEach((to, from, next) =&gt; {<br/>  if (to.name !== 'login' &amp;&amp; !isAuthenticated) {<br/>    next({ name: 'login' })<br/>  }<br/>  next()<br/>})</span></pre><p id="ddb0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1558" class="mq lc iq mh b gy mr ms l mt mu">router.beforeEach((to, from, next) =&gt; {<br/>  if (to.name !== 'login' &amp;&amp; !isAuthenticated) {<br/>    next({ name: 'login' });<br/>  }<br/>  else {<br/>    next();<br/>  }<br/>})</span></pre><h1 id="4806" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">全球解析卫士</h1><p id="0bd7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">router.beforteResolve</code>注册一个全局守卫。</p><p id="cf76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它类似于<code class="fe me mf mg mh b">router.beforeEach</code>，除了它将在导航被确认之前被调用。</p><h1 id="54b2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="3040" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加导航卫士，用Vue Router 4控制导航。</p></div></div>    
</body>
</html>