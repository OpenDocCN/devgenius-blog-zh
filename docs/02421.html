<html>
<head>
<title>Linux System and Troubleshooting Tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux系统和故障排除工具</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/linux-system-and-troubleshooting-tools-1a3385b53753?source=collection_archive---------3-----------------------#2020-08-03">https://blog.devgenius.io/linux-system-and-troubleshooting-tools-1a3385b53753?source=collection_archive---------3-----------------------#2020-08-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><blockquote class="jk jl jm"><p id="1dab" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated"><strong class="jq io">故障排除</strong>是<a class="ae km" href="https://en.wikipedia.org/wiki/Problem_solving" rel="noopener ugc nofollow" target="_blank">问题解决</a>的一种形式，常用于修复机器或系统上的故障产品或流程。这是一个合乎逻辑的、系统的寻找问题根源的过程，目的是解决问题，并使产品或过程再次运行——维基百科</p></blockquote><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/829f6e8877c289e125c145937a0a6b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDED9bvWBTpHj7QwZzNaSA.png"/></div></div></figure><p id="f95a" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">当出现重大中断和报告的错误时，很自然地要开始故障排除，并试图尽快找到根本原因。虽然确定根本原因是第一反应，但推荐的行动方针是<strong class="jq io"> <em class="jp">使系统在这种情况下尽可能好地工作。</em> </strong>类似于驾驶飞机，飞行员被教导在紧急情况下驾驶飞机；与让飞机安全着陆相比，排除故障是次要的。</p><p id="4d92" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">本文将介绍一种系统的故障排除方法和linux工具，以了解系统故障并有效地解决问题。(非常感谢我的导师教给我这些有用的linux系统工具！！)</p><h1 id="2ffa" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">&gt;&gt;日志</h1><p id="ff1b" class="pw-post-body-paragraph jn jo in jq b jr ma jt ju jv mb jx jy kz mc kb kc la md kf kg lb me kj kk kl ig bi translated">在任何开发人员的工具包中，日志记录都是一个方便的好工具，可以修复任何问题。日志文件允许您快速了解应用程序的行为。导出关于每个操作和系统状态的信息可以更容易地分析某个进程在给定时间点正在做什么。一些重要的Linux系统日志包括<code class="fe mf mg mh mi b">/var/log/syslog</code>、<code class="fe mf mg mh mi b">/var/log/auth.log</code>、<code class="fe mf mg mh mi b">/var/log/kern.log</code>和<code class="fe mf mg mh mi b">/var/log/dmesg</code>。</p><p id="a336" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">对于调试来说，Stacktraces也是您最好的朋友。从检查报告的错误开始，使用堆栈跟踪回溯程序的冻结状态，找出如何修复问题。在整个堆栈中跟踪请求提供了一种强大的方法来更好地了解分布式系统是如何工作的。</p><p id="3b34" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">对系统设计的透彻理解有助于提出关于哪里出错的假设。是时候深入挖掘有问题的主机以确定原因了。</p><h1 id="3df6" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">&gt;&gt;流程</h1><p id="ad28" class="pw-post-body-paragraph jn jo in jq b jr ma jt ju jv mb jx jy kz mc kb kc la md kf kg lb me kj kk kl ig bi translated">故障排除过程的下一步是调查主机，以检查延迟、CPU使用率或正在运行的进程数量是否增加。进程监控是最全面的工具之一，可以看到一个应用程序正在做什么。</p><blockquote class="jk jl jm"><p id="9027" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">我们是否最大化了系统资源？</p></blockquote><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="24e9" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">top<em class="jp"> </em></strong>- command that provides a dynamic real-time view of a running system</span><span id="d246" class="mn ld in mi b gy ms mp l mq mr"><strong class="mi io">htop</strong> - command to interactively monitor the system’s vital resources or server’s processes in real time</span></pre><p id="2995" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated"><strong class="jq io"><em class="jp">htop</em></strong><em class="jp"/>是一款更漂亮、更鲜艳的最新版本<strong class="jq io"> <em class="jp"> top </em> </strong>使得<strong class="jq io"><em class="jp">htop</em></strong><em class="jp"/>成为解决服务器性能问题的更好工具。</p><p id="dabc" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated"><strong class="jq io"> <em class="jp"> htop </em> </strong>显示服务器上正在发生的事情的实时概览。我们一眼就能看到以下内容:</p><ul class=""><li id="a8c6" class="mt mu in jq b jr js jv jw kz mv la mw lb mx kl my mz na nb bi translated">您的服务器上的单个CPU的数量及其资源分别细分</li><li id="3e1e" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">按进程细分的RAM使用情况</li><li id="4cae" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">交换用法</li><li id="2a51" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">任务总数、线程数和正在运行的任务数</li><li id="0284" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">1分钟、5分钟、10分钟平均负载</li><li id="76bc" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">系统正常运行时间和当前时间</li><li id="2702" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated">所有正在运行的进程—[PID | User | Priority | Niceness | Virtual Image | Resident Size | Shared Mem Size | CPU % | Memory % | Time | Command</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nh"><img src="../Images/0ea22ce26212ec846991a21cdceac7df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Znjj_FT6jyGAL7hAsL1CgQ.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">htop命令</figcaption></figure><p id="2ffd" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">一旦您确定了可疑的流程，那么您可能希望将重点放在该流程上。可以使用<strong class="jq io"><em class="jp">top</em></strong>/<strong class="jq io">/<em class="jp">htop</em></strong>命令:</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="2768" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">top -p $PID</strong></span></pre><p id="1d6a" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">如果进程看起来行为正常，但是系统的内存使用高于平均值，我们可以详细检查内存使用。</p><h1 id="d7a8" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">&gt;&gt;内存</h1><p id="dac1" class="pw-post-body-paragraph jn jo in jq b jr ma jt ju jv mb jx jy kz mc kb kc la md kf kg lb me kj kk kl ig bi translated">要找出服务器上内存消耗增加的原因，可以使用以下工具来识别内存密集型应用程序，并释放内存和优化性能:</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="436c" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">free </strong>- display amount of free and used memory in the system</span></pre><p id="90a2" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">使用<strong class="jq io"> top/htop </strong>命令，仅显示空闲和已用内存量。<strong class="jq io"> free </strong>命令显示:空闲和使用的物理内存总量，系统中的交换内存总量，内核使用的缓冲区和缓存。</p><p id="ece6" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">OOM黑仔是当系统内存严重不足时，linux内核使用的一个进程。这是因为服务器上的进程消耗了大量内存，系统需要将内存分配给其他进程。如果系统上没有启用交换，内核会给每个正在运行的进程一个名为<strong class="jq io"> <em class="jp"> ooo_score </em> </strong>的分数，该分数决定了在可用内存不足的情况下该进程被终止的可能性。</p><p id="32dd" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">如果启用交换，内存页面将被复制到硬盘上分配的<em class="jp">交换空间</em>中，以释放该页面的内存。检查<strong class="jq io">圆盘</strong>的截面</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="65f8" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">df </strong>- report file system disk space usage</span></pre><p id="f3f9" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated"><strong class="jq io"> df </strong>显示包含每个文件名参数的文件系统上的可用磁盘空间量。</p><h1 id="c707" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">&gt;&gt;磁盘</h1><p id="6200" class="pw-post-body-paragraph jn jo in jq b jr ma jt ju jv mb jx jy kz mc kb kc la md kf kg lb me kj kk kl ig bi translated">交换空间的主要功能是当实际RAM填满并且需要更多空间时，用磁盘空间代替RAM内存。内核使用内存管理程序来检测最近最少使用的内存块(或内存页),并将这些内存页交换到硬盘上的特殊分区。我们可以使用以下命令来监控磁盘I/O统计信息:</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="e141" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">iostat </strong>- report CPU statistics and I/O statistics for devices, partitions and NFS</span></pre><p id="b70e" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated"><strong class="jq io"> iostat </strong>命令用于监控系统I/O设备加载。它通过观察设备相对于其平均传输时间的活动时间来实现这一点。类似于<strong class="jq io"> iostat </strong>命令，<strong class="jq io"> vmstat </strong>命令报告虚拟内存统计数据和关于系统事件的信息，例如CPU负载、分页、系统调用等。<code class="fe mf mg mh mi b">vmstat -S</code>可用于显示<em class="jp">交换统计。</em></p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="c5c9" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">iotop </strong>- simple top-like I/O monitor</span></pre><p id="5ccd" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated"><strong class="jq io"> iotop </strong>是一个Linux上的交互式I/O监控工具，就像<strong class="jq io"> htop </strong>一样，可以轻松监控Linux上每个运行进程的磁盘读写带宽使用情况。对于系统管理来说，它是一个非常有用的工具，可以跟踪可能导致高磁盘I/O读/写的特定进程。它还显示线程或进程在换入和等待I/O时花费的时间百分比。</p><p id="1f53" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">其他命令包括<code class="fe mf mg mh mi b">iotop</code>、<code class="fe mf mg mh mi b">atop</code>和<code class="fe mf mg mh mi b">dstat</code></p><h1 id="412c" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">&gt;&gt;网络</h1><p id="db0c" class="pw-post-body-paragraph jn jo in jq b jr ma jt ju jv mb jx jy kz mc kb kc la md kf kg lb me kj kk kl ig bi translated">对于网络，我们最感兴趣的是吞吐量(每秒请求数—带宽)。我们想要检查<strong class="jq io">速率</strong>(每秒比特数的读写带宽)和<strong class="jq io">利用率</strong>(读写带宽除以网络的最大带宽)。一些有用的网络调试工具可以应对延迟高峰和失败的请求，包括:</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="9a71" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">netstat </strong>- prints network connections, routing tables, interface statistics, masquerade connections, and multicast memberships</span></pre><p id="9db6" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">netstat 告诉你哪些进程正在哪些端口上运行。它是一个重要的网络连接监控工具，可以显示进出连接、路由表、端口监听和使用统计；最近的一个命令是<code class="fe mf mg mh mi b">ss</code>。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nm"><img src="../Images/7da5dff042c96b9b65b91e381d87bf34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hl7fjsUMc12wxr0GNbe2gA.png"/></div></div></figure><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="06b3" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">tcpdump </strong>- dump traffic on a network</span></pre><p id="a524" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">tcpdump是一个数据网络包分析器。它允许用户显示通过网络传输或接收的TCP/IP和其他数据包。它可用于排除网络故障，也可用作安全工具。要打印出要查看的数据包，请使用<code class="fe mf mg mh mi b">tcpdump -A</code>。</p><pre class="ko kp kq kr gt mj mi mk ml aw mm bi"><span id="b931" class="mn ld in mi b gy mo mp l mq mr"><strong class="mi io">netcat </strong>- arbitary TCP and UDP connections and listens </span></pre><p id="bd3a" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">使用<strong class="jq io"> nectat，</strong>你可以打开TCP连接，发送UDP数据包，监听任意UDP和TCP端口，端口扫描等等。它充当后端工具，允许端口扫描和端口监听，此外还允许文件传输。</p></div><div class="ab cl nn no hr np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ig ih ii ij ik"><h2 id="0b6d" class="mn ld in bd le nu nv dn li nw nx dp lm kz ny nz lq la oa ob lu lb oc od ly oe bi translated">资源:</h2><ul class=""><li id="8a63" class="mt mu in jq b jr ma jv mb kz of la og lb oh kl my mz na nb bi translated"><a class="ae km" href="https://jvns.ca/debugging-zine.pdf" rel="noopener ugc nofollow" target="_blank">https://jvns.ca/debugging-zine.pdf</a></li><li id="3aed" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated"><a class="ae km" href="https://medium.com/@steve.mushero/linuxs-sre-golden-signals-af5aaa26ebae" rel="noopener">https://medium . com/@ Steve . mus hero/linuxs-sre-golden-signals-af 5a a26 ebae</a></li><li id="fe5d" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated"><a class="ae km" href="https://landing.google.com/sre/sre-book/chapters/effective-troubleshooting/" rel="noopener ugc nofollow" target="_blank">https://landing . Google . com/sre/sre-book/chapters/effective-trouble shooting/</a></li><li id="994a" class="mt mu in jq b jr nc jv nd kz ne la nf lb ng kl my mz na nb bi translated"><a class="ae km" href="https://www.eurovps.com/blog/important-linux-log-files-you-must-be-monitoring/" rel="noopener ugc nofollow" target="_blank">https://www . euro VPS . com/blog/important-Linux-log-files-you-must-be-monitoring/</a></li></ul></div><div class="ab cl nn no hr np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ig ih ii ij ik"><p id="5d49" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">故障排除永远不会像我们理想化的模型那样清晰，并且像任何其他技能一样需要实践。对于遇到系统问题的人和解决问题的人来说，这些步骤可以使故障诊断过程不那么痛苦，并且更有效率。采用系统的故障排除方法有助于减少影响时间和限制服务恢复时间，并为用户带来更好的体验。</p><p id="23ba" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy kz ka kb kc la ke kf kg lb ki kj kk kl ig bi translated">玩得开心，永远不要忘记检查日志！📝</p></div></div>    
</body>
</html>