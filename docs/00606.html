<html>
<head>
<title>A Test Runner for Broccolijs Plugins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Broccolijs 插件的测试运行程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/testing-broccolijs-plugins-89a500c8e83e?source=collection_archive---------41-----------------------#2020-06-11">https://blog.devgenius.io/testing-broccolijs-plugins-89a500c8e83e?source=collection_archive---------41-----------------------#2020-06-11</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><h2 id="43c4" class="ip iq ir bd b dl is it iu iv iw ix dk iy translated" aria-label="kicker paragraph">/工程/ javascript</h2><div class=""/><div class=""><h2 id="d6e5" class="pw-subtitle-paragraph jx ja ir bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">测试自动化的第一步</h2></div><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/0a561cdbe030ca89bd1e6b9e6e75b191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qWtq3DRUrHMzoU5T"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">由<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lf" href="https://unsplash.com/@louishansel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Louis Hansel @shotsoflouis </a>拍摄的照片</figcaption></figure><p id="3a26" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi mc translated"><span class="l md me mf bm mg mh mi mj mk di">我们</span>都知道维护可能是软件开发中最昂贵的部分。拥有一套可以在持续集成平台上自动执行的良好的单元和集成测试，可以减少维护成本和回归。</p><p id="6495" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">尽管我很真诚，但我没有在我的 BroccoliJS 插件中包含单元测试，而是在发布新版本之前手工测试了它们。没什么大不了的，因为我不需要经常发布它们，这只是私人时间。我想我们都经历过。有时候编写测试感觉像是一种负担。有时候你想把事情做好。</p><p id="b0e2" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">几周前，在更新我的 npm 包的依赖项时，我没有心情进行手工测试。我想是时候增加一些测试了。</p><p id="1455" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">所以，我们走吧。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj ml"><img src="../Images/b4449de9053a786c59b551621c8d46a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VG-SVc-biWy65N95"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴恩·托普金</a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="9e6f" class="mm mn ir bd mo mp mq mr ms mt mu mv mw kg mx kh my kj mz kk na km nb kn nc nd bi translated">要求</h1><p id="cf56" class="pw-post-body-paragraph lg lh ir li b lj ne kb ll lm nf ke lo lp ng lr ls lt nh lv lw lx ni lz ma mb ik bi translated">西兰花插件通常使用一个目录树和这个目录树的内容。插件可以操作给定树中的文件，然后必须将转换后的内容写入给定的输出目录。一个很好的例子就是<a class="ae lf" href="https://github.com/stfsy/broccoli-image-min" rel="noopener ugc nofollow" target="_blank">图像缩小</a>。</p><p id="b42e" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">西兰花提供了两个命令:<strong class="li jb">构建</strong>和<strong class="li jb">服务</strong>。<strong class="li jb"> build </strong>命令将运行所有插件一次，并将结果放入<strong class="li jb"> dist </strong>目录，而<strong class="li jb"> serve </strong>命令将从项目文件夹运行本地 web 服务器。插件配置和顺序在<a class="ae lf" href="https://broccoli.build/#example-pipeline" rel="noopener ugc nofollow" target="_blank">文件</a>中定义。</p><p id="9079" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">为了测试一个插件，我们需要(1)能够在测试中运行这两个命令，并且(2)能够断言我们的插件已经按照预期修改了项目文件。因为我们在 NodeJS 上运行，所以我们应该——按照惯例——异步运行 I/O。(4)为了支持不同的测试场景，我们需要使用具有不同插件配置的多个 Brocfiles。</p><h2 id="83c0" class="nj mn ir bd mo nk nl dn ms nm nn dp mw lp no np my lt nq nr na lx ns nt nc ix bi translated">总结:</h2><ul class=""><li id="372d" class="nu nv ir li b lj ne lm nf lp nw lt nx lx ny mb nz oa ob oc bi translated">支持测试和服务命令</li><li id="8ad9" class="nu nv ir li b lj od lm oe lp of lt og lx oh mb nz oa ob oc bi translated">基于承诺的 API 允许异步处理</li><li id="58a2" class="nu nv ir li b lj od lm oe lp of lt og lx oh mb nz oa ob oc bi translated">允许使用不同的 Brocfiles</li></ul><h1 id="340a" class="mm mn ir bd mo mp mq mr ms mt mu mv mw kg mx kh my kj mz kk na km nb kn nc nd bi translated">履行</h1><p id="81c0" class="pw-post-body-paragraph lg lh ir li b lj ne kb ll lm nf ke lo lp ng lr ls lt nh lv lw lx ni lz ma mb ik bi translated">定义了上面的需求后，我们知道我们必须在给定的目录中用上面提到的命令运行花椰菜。NodeJS 允许使用<a class="ae lf" href="https://nodejs.org/api/child_process.html" rel="noopener ugc nofollow" target="_blank">子流程模块</a>生成带有附加参数的流程。因此，我们可以将花椰菜作为一个子流程来运行，并捕获它的输出。我们可以使用承诺让调用实现现在了解进程的状态。已启动进程的所有输出都可以写入标准输出。要停止进程，我们可以使用 kill 命令并传递进程 id。</p><p id="712b" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">最终的实现如下所示:</p><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="d254" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">为了在 Windows 上正确地停止进程，我们必须使用<strong class="li jb"> broccoli.cmd </strong>作为目标命令，并使用<strong class="li jb"> taskkill </strong>来停止。</p><h1 id="27c8" class="mm mn ir bd mo mp mq mr ms mt mu mv mw kg mx kh my kj mz kk na km nb kn nc nd bi translated">介绍西兰花-试跑者</h1><p id="6a07" class="pw-post-body-paragraph lg lh ir li b lj ne kb ll lm nf ke lo lp ng lr ls lt nh lv lw lx ni lz ma mb ik bi translated">一个简化 BroccoliJS 插件测试的 npm 模块。</p><p id="caa3" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">测试运行程序将在后台给定的目录下运行一个花椰菜实例。它支持<strong class="li jb"> serve </strong>和<strong class="li jb"> build </strong>命令。</p><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oi oj l"/></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">提供来自测试/装置的内容</figcaption></figure><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oi oj l"/></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">测试/固定装置中的构建内容</figcaption></figure><p id="2e1e" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">看看这个:</p><pre class="kq kr ks kt gu ok ol om on aw oo bi"><span id="9463" class="nj mn ir ol b gz op oq l or os">npm install broccoli<strong class="ol jb">-</strong>test<strong class="ol jb">-</strong>runner <strong class="ol jb">--</strong>save<strong class="ol jb">-</strong>dev</span></pre></div><div class="ab cl ot ou hv ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="ik il im in io"><p id="6d1b" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">感谢来到这里，也感谢你的阅读，<br/> Stefan👋</p></div></div>    
</body>
</html>