<html>
<head>
<title>Ruby: How to make a Transpiler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby:如何制作一个Transpiler</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ruby-how-to-make-a-transpiler-1d6a47dcab4d?source=collection_archive---------5-----------------------#2020-10-27">https://blog.devgenius.io/ruby-how-to-make-a-transpiler-1d6a47dcab4d?source=collection_archive---------5-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f126" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">介绍性的故事。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5a63a40f22d4f673663bb2baf05c2336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKzNDNFaflgvcRCw_xm2lw.jpeg"/></div></div></figure><p id="5355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文的目的是用简单的术语解释transpiler是什么以及如何开始。我的目标受众是不知道这是什么的初级或中级程序员。</p><p id="37c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到本文结束时，您将知道从哪里开始开发自己的transpilers或编译器。除雾！</p><h1 id="91ed" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">这是一个源到源的翻译器。</h1><p id="afd5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">编译器获取一些源代码，并将其编译成某种低级语言。这种低级语言可能是源代码，也可能是比源代码更低级的东西。例如，C++向下编译成字节码。一些程序员可以乱搞字节码。大多数不能或不会。Typescript编译成Javascript，因为Typescript是Javascript的超集。</p><p id="93cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">transpiler非常类似，除了它将源代码转换成其他一些源代码。一般来说，这种翻译是人类可读代码之间的相互转换。</p><p id="3231" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">人们很容易把这些事情混淆起来，在某些情况下，两者之间的界限会非常模糊。有时程序的需求非常复杂，以至于对于一个程序是移植程序还是编译程序存在争议。</p><p id="b107" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一些编译工具可以转换代码，也可以编译代码。很乱。</p><p id="72ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为简单起见，只需将transpiler视为源代码到源代码的翻译器。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="aa8d" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">为什么我们需要运输工具？</h1><p id="cb78" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">想象一下，你正在做一个项目，你需要把所有的JS文件转换成ruby文件，或者把ruby文件转换成GO文件，或者把html文件转换成erb文件。原因有很多，但最常见的是，它对于向需要一点更新，甚至可能需要完全重构或迁移的旧项目交付更新非常有用。</p><p id="7307" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在实际工作中，对翻译的需求极为普遍。</p><p id="cdd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">过去，Javascript的创造者在各种语言更新中使用了transpiler，这是出了名的。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="fde5" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">怎么才能做到呢？</h1><p id="cf6c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">每个源代码文件都是一个文本文件。很多年前，你的源代码可能是这样的txt文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/8b1fe9ef7358a71647b4b86bf8528db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*7ARzj_f1SdSkLCDM-TTHUg.jpeg"/></div></figure><p id="c461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的几十年里，我们添加了各种各样的环保小玩意、简易爆炸装置和花哨的文本编辑器。那时候，在你编码的时候没有任何东西可以帮助你。你必须在没有任何警告的情况下编写一些东西，试着编译它，希望你的程序能正常运行。</p><p id="1f94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译器会把你的文件作为一个数组或者一个巨大的字符串来读取，并尝试编译它。这仍然是今天大多数编译器和传输器的工作方式。</p><p id="844c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了制作一个transpiler，我们只需要读取一个文件，写入另一个文件，并在这个过程中应用一些逻辑来保持语法的正确性。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="633e" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">让我们用ruby来做一个ruby到javascript的transpiler。</h2><p id="787b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">下面是一个简单的Javascript程序，它将两个数字相加。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="f068" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这个文件和一个ruby文件放在同一个存储库中，并使用内置的ruby方法打开和读取您的Javascript文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/981e5b121026d40f2b6e15917a43a721.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*1gPdyezck5pGGqLKQH-GwQ.jpeg"/></div></figure><p id="13ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将把javascript文件的内容放入终端。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/2d7b227cb16d214169e185f555644956.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*jg7UFByezjgpz5buJDupdQ.jpeg"/></div></figure><p id="cdea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个好的开始，但是puts方法会自动隐藏JS文件中存在的字符。在幕后，我们的ruby文件正在读取所有的内容，我们也想看到这些内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/f922532fa1abc6d82592b2b8845ea0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*tVaO9D3YXPOHfyoYpmtn2g.jpeg"/></div></figure><p id="2f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过使用p命令来告诉ruby停止对我们隐藏细节。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/9b2b3e6ff8bcbe25a82d25f73bd8891a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*FfdT9XzlrsvkOQTQWsuyOg.jpeg"/></div></figure><p id="a664" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们走吧。js文件的内容是一个大的ole字符串。我们可以清理我们的数据，并通过一些字符串操作使其更易于管理。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/3443fb8b5d45e938e42c87c2f54ea3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*FTU1hG78O9ywY25mrtFRJg.jpeg"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/28f1504ad3c9ad119a73475ba8254cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*vQtKk7YAKCxS5-GeFBXZeQ.jpeg"/></div></figure><p id="33be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经将JS文件逐行分离，并删除了空行。</p><p id="4d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，Ruby是一种语法上非常礼貌的语言，所以这个特殊的transpiler并不复杂。我们要做的就是删除不必要的javascript关键字，添加一些ruby关键字</p><p id="a093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不需要“let”关键字，不需要花括号，甚至不需要“return”关键字。我们将遍历数据，用有效的ruby语法替换所有的javascript语法。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/1f9920357b70f330599e3120a8c71021.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*PvngyjEXR6I6DyZhXlu9IA.jpeg"/></div></figure><h2 id="8352" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">这是指出这个transpiler速度不快或效率不高的好时机。把这当成一个开始的地方。</h2><p id="4a2f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果你不熟悉gsub！法才知道“！”告诉ruby就地改变字符串，gsub方法遍历字符串并用第二个参数替换第一个参数。</p><p id="6f61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我将为每一行插入新的行字符，并将数组连接回一个字符串。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/42032bc313e54f7d5f2665cf870a7f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*884kSJ1pW6EzdVwbABnccQ.jpeg"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a75cdf3c3d4acd98738095eac72c0f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*dZtG1G5hpg0fdV4wexm39A.jpeg"/></div></figure><p id="89b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了它，一个有效的字符串形式的ruby文件，从我们的javascript文件自动转换而来。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="458a" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">最后一步，把这个写到ruby文件中。</h1><p id="3e4b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">因为我们已经完成了所有的工作，所以编写文件很容易。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e6c7382b0cf860ff15cbd45c52b87394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*D8qkyHOzXdECvfRPhxh5wQ.jpeg"/></div></figure><p id="73a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一行告诉ruby打开一个名为“output.rb”的新文件，然后将数据写入其中。</p><p id="e3cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们的结果。一个有效的ruby文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/342999e423e9d89cb13480970cdb9355.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*f30Swfxt_QBJE9nEdapnmw.jpeg"/></div></figure><p id="648c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个transpiler，但是你可能已经猜到了，在这些语言中有很多我们没有考虑到的东西。目前，我的transpiler只能处理简单的函数。</p><p id="f507" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只要花一点时间和精力，就可以构建这些概念，最终您可以编写一个适用于大型项目或整个编程语言的transpiler。</p><p id="5ccf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个完整的要点。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mz na l"/></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="7313" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">直到下一次。</h2><p id="4109" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">坚强点，我的编码伙伴们。</p></div></div>    
</body>
</html>