<html>
<head>
<title>GCP Big Query — Writing my first Python Connector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP 大查询——编写我的第一个 Python 连接器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gcp-big-query-writing-my-first-python-connector-1140b022b88a?source=collection_archive---------10-----------------------#2022-01-20">https://blog.devgenius.io/gcp-big-query-writing-my-first-python-connector-1140b022b88a?source=collection_archive---------10-----------------------#2022-01-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="1351" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博客是我们从零开始讨论<strong class="jm io">云</strong>概念的系列文章的一部分，面向的是入门知识有限的读者。这篇文章属于<em class="ki">初级</em>系列，因为它涉及到理解<a class="ae kj" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">大型查询</strong> </a>数据库对于仓储和业务分析需求的工作。</p><p id="69f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">云系列中的一些早期博客如下。</p><p id="415a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/how-to-automate-cloud-governance-on-azure-f392bd971f2f"> <strong class="jm io">云上治理 Azure</strong></a><strong class="jm io"><br/></strong><a class="ae kj" href="https://medium.com/r?url=https%3A%2F%2Fblog.devgenius.io%2Fcustom-docker-bridge-networks-how-to-run-containers-b8d40c51bab2" rel="noopener"><strong class="jm io">AWS-安全-自动化</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/custom-docker-bridge-networks-how-to-run-containers-b8d40c51bab2"><strong class="jm io">自定义 Docker 桥接网络</strong> </a></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/4c48bf912d6e17e35b2b663c763b6678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqPXJ79WZTs5lz3HzQaCbg.png"/></div></div></figure><h1 id="59d3" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">什么是 GCP 大查询？</strong></h1><p id="e6aa" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">作为一个完全托管的无服务器企业数据库，Big Query 是满足客户数据仓库/分析需求的一站式解决方案。它既有云控制台，也有查询命令行工具接口，还提供大多数通用语言的 SDK，如 Java、Python 等，用于编程访问。</p><p id="91d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它具有标准的 SQL 支持，可以创建表并使用标准查询从表中查询数据。然而，这种可水平伸缩的数据库完全是 GCP 本地的，不属于具有原子事务支持的数据库。</p><h1 id="971f" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">项目、数据集、表格。</strong></h1><p id="7a90" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><strong class="jm io">项目</strong>是所有大型查询数据集/数据驻留的超级父容器。一个 GCP 帐户可以通过角色和权限控制多个项目的访问。</p><p id="fe44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">数据集</strong>是表的逻辑分组，类似于 RDMS 术语中的传统数据库。它根据初始化期间创建数据的区域来控制数据的物理位置。在大查询中，来自多个云位置的表不能连接在一起进行查询操作。</p><p id="ed3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">表</strong>是类似关系实体的数据容器，如<em class="ki">客户、产品等</em>。它以行和列的形式存储数据；列定义通过数据库模式来维护。可以在空表上创建数据库模式，也可以在表中加载示例数据后填充数据库模式。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi lz"><img src="../Images/0e4ca04a7b3cc9cd1b5b97e8daeecae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9x7hSBWA1MakhHvmSY1qVA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><strong class="bd ky">大查询云控制台视图</strong></figcaption></figure><p id="1a0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的例子中，</p><p id="1734" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki"> secure-proxy-308710 </em>为项目，<br/>T5】OPEX _ dashboard 为数据集，<br/> <em class="ki"> cost_table </em>为右侧字段为 schema 的表格。</p><h1 id="3e06" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">简单的大型查询操作</h1><h2 id="b245" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated"><strong class="ak">前置要求</strong></h2><p id="89cf" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><strong class="jm io"> Gcloud Cli </strong></p><p id="6ccd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从<a class="ae kj" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/docs/install</a>安装档案。<br/>运行以下命令</p><pre class="kl km kn ko gt mq mr ms mt aw mu bi"><span id="aeb0" class="me kx in mr b gy mv mw l mx my">./google-cloud-sdk/install.sh</span></pre><p id="69f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Python 库</strong></p><pre class="kl km kn ko gt mq mr ms mt aw mu bi"><span id="8ee6" class="me kx in mr b gy mv mw l mx my">pip install google-cloud-bigquery</span></pre><p id="0d46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从<em class="ki"> gcloud </em> cli 工具中，运行以下命令登录并设置父项目。</p><pre class="kl km kn ko gt mq mr ms mt aw mu bi"><span id="dc13" class="me kx in mr b gy mv mw l mx my"><strong class="mr io">Login<br/></strong>gcloud auth application-default login</span><span id="14f6" class="me kx in mr b gy mz mw l mx my"><strong class="mr io">Configuring a Project</strong><br/>gcloud config set project PROJECT_ID</span></pre><h2 id="5a54" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated"><strong class="ak">列出项目中的所有数据集。</strong></h2><p id="7130" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">以下代码片段用于遍历 GCP 帐户默认项目中的所有可用数据集。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="8b01" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated"><strong class="ak">创建数据集</strong></h2><p id="653a" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">为了从头开始创建一个新的数据集，在下面的模块中将<strong class="jm io">数据集</strong>的名称作为<em class="ki"> dataset_id </em>进行传递。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="85ea" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated"><strong class="ak">创建带有模式的表格</strong></h2><p id="24d8" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">要创建具有预定义模式的空表，需要两个属性，完整的表名(例如<strong class="jm io">secure-proxy-308710 . OPEX _ dashboard . cost _ table</strong>)作为<em class="ki"> table_id </em>，以及存储数据所需的列的模式。</p><p id="71a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的例子中，模式由<strong class="jm io">整数、字符串、数字、数据</strong>数据类型组成，将<em class="ki">多云支出</em>数据集中存储到一个大的查询表中。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="83f1" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated"><strong class="ak">向表格中添加行。</strong></h2><p id="c84f" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">使用大查询 SDK 中的<em class="ki"> client.insert_rows() </em>操作，可以使用上面定义的模式将行形式的数据插入到表中。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="1d65" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated">查询数据</h2><p id="9f65" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><strong class="jm io">使用云控制台</strong></p><p id="7c09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在查询编辑器中，键入选择查询以获取操作所需的数据。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nc"><img src="../Images/204319f9720647be5e3d707232f79928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vv1TwEF2l6h-f5AAxlyWAw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><strong class="bd ky">从云端控制台查询数据</strong></figcaption></figure><p id="7782" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用 Python SDK。</strong></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="c79c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">输出</strong></p><pre class="kl km kn ko gt mq mr ms mt aw mu bi"><span id="e66a" class="me kx in mr b gy mv mw l mx my">The query data:</span><span id="4a54" class="me kx in mr b gy mz mw l mx my">Row((datetime.datetime(2022, 1, 20, 7, 2, 36, tzinfo=datetime.timezone.utc), 1, 'Domain 1', Decimal('4000'), datetime.date(2022, 1, 20)), {'last_updated_time': 0, 'si_number': 1, 'domain_name': 2, 'cost_value': 3, 'cost_date': 4})</span></pre><h2 id="60bc" class="me kx in bd ky mf mg dn lc mh mi dp lg jv mj mk lk jz ml mm lo kd mn mo ls mp bi translated">额外资源</h2><div class="nd ne gp gr nf ng"><a href="https://github.com/amit894/copex-dashboards" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd io gy z fp nl fr fs nm fu fw im bi translated">GitHub-Amit 894/copex-Dashboards:跟踪 AWS/Azure/GCP 成本的仪表板</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ku ng"/></div></div></a></div><p id="fc9d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">如需反馈，请留言至</em><strong class="jm io"><em class="ki">Amit[dot]894[at]Gmail[dot]com</em></strong><em class="ki">或联系</em><a class="ae kj" href="https://about.me/amit_raj" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://about.me/amit_raj</em></a><em class="ki">的任何链接。</em></p></div></div>    
</body>
</html>