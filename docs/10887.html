<html>
<head>
<title>Operations on data.frame rows in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中 data.frame 行的操作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/operations-on-data-frame-rows-in-r-1510123bf6a4?source=collection_archive---------18-----------------------#2022-12-05">https://blog.devgenius.io/operations-on-data-frame-rows-in-r-1510123bf6a4?source=collection_archive---------18-----------------------#2022-12-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b4e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">考虑我们有一个下面的例子(<strong class="jm io"> losses_ru </strong>是一个代表俄罗斯军队在乌克兰每月损失的数据帧；原 csv 文件已从 http://uadata.net<a class="ae ki" href="https://uadata.net/" rel="noopener ugc nofollow" target="_blank">下载。任务是计算每种武器类型或部队的总损失。</a></p><pre class="kj kk kl km gt kn ko kp bn kq kr bi"><span id="9067" class="ks kt in ko b be ku kv l kw kx">&gt; losses_ru<br/>            item  Feb   Mar  Apr  May  Jun  Jul  Aug   Sep   Oct   Nov  Dec<br/>1         troops 5300 12200 5700 7300 5100 5230 7070 11180 12740 17060 2810<br/>2           cars  291   910  500  574  327  300  334   532   360   301   68<br/>3      artillery    0   311  125  213  141  126  175   300   337   174   12<br/>4     armored PC  816   919  710  857  424  278  308   620   553   387   28<br/>5            UAV    3    80  149  283  126   94  114   154   410   149   20<br/>6    helicopters   29   102   24   19   11    5   14    21    28     8    3<br/>7          ships    2     5    1    5    1    1    0     0     1     0    0<br/>8         planes   29   106   55   18    9    6   11    30    11     5    1<br/>9  anti-aircraft    5    49   23   16   11   13   35    24    21    13    1<br/>10          MLRS    0    96   55   56   39   13   26    48    50    12    0<br/>11         tanks  191   423  394  350  215  190  211   364   348   228   10</span></pre><p id="e9cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Base R 包提供了<strong class="jm io"> rowSums() </strong>函数来对一行中的值求和。(同样，函数<strong class="jm io"> rowMeans() </strong>将计算平均值)。从数据帧<strong class="jm io">loss _ ru</strong>中删除第一列("<strong class="jm io"> item </strong>")将有助于获得矢量形式的总和:</p><pre class="kj kk kl km gt kn ko kp bn kq kr bi"><span id="de5c" class="ks kt in ko b be ku kv l kw kx">&gt; rowSums(losses_ru[,-1])<br/> [1] 91690  4497  1914  5900  1582   264    16   281   211   395  2924</span></pre><p id="89d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该向量可通过<strong class="jm io"> cbind() </strong>或<strong class="jm io"> data.frame() </strong>函数添加到数据帧中，使其具有信息性:</p><pre class="kj kk kl km gt kn ko kp bn kq kr bi"><span id="64ca" class="ks kt in ko b be ku kv l kw kx">&gt; cbind(losses_ru, total=rowSums(losses_ru[,-1]))<br/>            item  Feb   Mar  Apr  May  Jun  Jul  Aug   Sep   Oct   Nov  Dec total<br/>1         troops 5300 12200 5700 7300 5100 5230 7070 11180 12740 17060 2810 91690<br/>2           cars  291   910  500  574  327  300  334   532   360   301   68  4497<br/>3      artillery    0   311  125  213  141  126  175   300   337   174   12  1914<br/>4     armored PC  816   919  710  857  424  278  308   620   553   387   28  5900<br/>5            UAV    3    80  149  283  126   94  114   154   410   149   20  1582<br/>6    helicopters   29   102   24   19   11    5   14    21    28     8    3   264<br/>7          ships    2     5    1    5    1    1    0     0     1     0    0    16<br/>8         planes   29   106   55   18    9    6   11    30    11     5    1   281<br/>9  anti-aircraft    5    49   23   16   11   13   35    24    21    13    1   211<br/>10          MLRS    0    96   55   56   39   13   26    48    50    12    0   395<br/>11         tanks  191   423  394  350  215  190  211   364   348   228   10  2924</span></pre><p id="350b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，<strong class="jm io"> dplyr </strong> package 擅长使用<strong class="jm io"> mutate </strong>动词创建新列。事实上，stackoverflow 甚至有一个<a class="ae ki" href="https://stackoverflow.com/questions/27354734/dplyr-mutate-rowsums-calculations-or-custom-functions" rel="noopener ugc nofollow" target="_blank">问题</a>来回答这个有 6 个答案的问题。</p><p id="cd0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一个简单的解决方法是从包<strong class="jm io">看门人</strong>中<strong class="jm io">点缀 _ 总计()</strong>:</p><pre class="kj kk kl km gt kn ko kp bn kq kr bi"><span id="70e8" class="ks kt in ko b be ku kv l kw kx">&gt; losses_ru %&gt;% adorn_totals("col")<br/>          item  Feb   Mar  Apr  May  Jun  Jul  Aug   Sep   Oct   Nov  Dec Total<br/>        troops 5300 12200 5700 7300 5100 5230 7070 11180 12740 17060 2810 91690<br/>          cars  291   910  500  574  327  300  334   532   360   301   68  4497<br/>     artillery    0   311  125  213  141  126  175   300   337   174   12  1914<br/>    armored PC  816   919  710  857  424  278  308   620   553   387   28  5900<br/>           UAV    3    80  149  283  126   94  114   154   410   149   20  1582<br/>   helicopters   29   102   24   19   11    5   14    21    28     8    3   264<br/>         ships    2     5    1    5    1    1    0     0     1     0    0    16<br/>        planes   29   106   55   18    9    6   11    30    11     5    1   281<br/> anti-aircraft    5    49   23   16   11   13   35    24    21    13    1   211<br/>          MLRS    0    96   55   56   39   13   26    48    50    12    0   395<br/>         tanks  191   423  394  350  215  190  211   364   348   228   10  2924</span></pre><p id="b91f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是如果我们需要比一行的总和或平均值更多的东西呢？实际上，<strong class="jm io"> dplyr </strong>处理群体的方式很奇妙。首先，让我们用<strong class="jm io"> pivot_longer() </strong>合并列，并用<strong class="jm io"> group_by() </strong>为每个项目分组。因此，我们可以用<strong class="jm io"> mutate( </strong>)动词对单个列(默认 pivot_longer 创建<strong class="jm io"> name </strong>和<strong class="jm io"> value </strong>列)进行操作。我们将创建所需的新列，取消分组并旋转回宽格式:</p><pre class="kj kk kl km gt kn ko kp bn kq kr bi"><span id="5b00" class="ks kt in ko b be ku kv l kw kx">&gt;   losses_ru %&gt;% <br/>+     group_by(item) %&gt;%<br/>+     pivot_longer(-item) %&gt;% <br/>+     mutate(mean = round(mean(value), 0),<br/>+            max = max(value),<br/>+            median = median(value)) %&gt;%<br/>+     ungroup() %&gt;% <br/>+     pivot_wider(names_from = "name", values_from = "value") %&gt;%<br/>as.data.frame()<br/>            item mean   max median  Feb   Mar  Apr  May  Jun  Jul  Aug   Sep   Oct   Nov  Dec<br/>1         troops 8335 17060   7070 5300 12200 5700 7300 5100 5230 7070 11180 12740 17060 2810<br/>2           cars  409   910    334  291   910  500  574  327  300  334   532   360   301   68<br/>3      artillery  174   337    174    0   311  125  213  141  126  175   300   337   174   12<br/>4     armored PC  536   919    553  816   919  710  857  424  278  308   620   553   387   28<br/>5            UAV  144   410    126    3    80  149  283  126   94  114   154   410   149   20<br/>6    helicopters   24   102     19   29   102   24   19   11    5   14    21    28     8    3<br/>7          ships    1     5      1    2     5    1    5    1    1    0     0     1     0    0<br/>8         planes   26   106     11   29   106   55   18    9    6   11    30    11     5    1<br/>9  anti-aircraft   19    49     16    5    49   23   16   11   13   35    24    21    13    1<br/>10          MLRS   36    96     39    0    96   55   56   39   13   26    48    50    12    0<br/>11         tanks  266   423    228  191   423  394  350  215  190  211   364   348   228   10</span></pre><p id="b215" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意，在没有唯一标识行的情况下，就像上面显示的那样，我们必须添加一个 rowid 列。</p></div></div>    
</body>
</html>