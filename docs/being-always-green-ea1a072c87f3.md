# 永远绿色

> 原文：<https://blog.devgenius.io/being-always-green-ea1a072c87f3?source=collection_archive---------9----------------------->

拥有 CI 服务器时，人们总是重复的一件事是不要破坏构建。这意味着避免将没有足够质量通过管道步骤的代码推到主线上。有时我们认为，为了避免这种情况，我们必须在提交之前设置很多官僚主义。但是如果我们试着不打破任何东西呢？

![](img/90717a6a51d272318dc14fe129ef5761.png)

图片由 [pixabay](https://pixabay.com/photos/heart-leaves-foliage-garden-bush-1192662/) 提供

发现 bug 的[成本越来越大，这取决于我们在将 bug 添加到代码中之后需要多少时间来发现它。
是的，因为](https://azevedorafaela.com/2018/04/27/what-is-the-cost-of-a-bug/)[bug 是我们创造的](/bugs-vs-features-189ebb9f0e26?sk=e825a55001d99913d0b6b4f9531803f8)。他们的存在是因为我们(不仅仅是 dev)。因此，如果我们在没有代码的时候发现错误，成本几乎为零，如果我们在编码更高的时候发现错误，当错误影响用户时，成本会增加很多。左移测试是指尽可能向左移动我们的测试，但是在这篇文章中我们将关注编码。

什么是 bug 是团队内部一个有趣的讨论。在我看来，bug 是不可取的行为，会给公司带来可衡量的成本，所以我们必须用一些紧急措施来修复它们。
在生产中存在足够长时间的不良行为会转化为特性，请考虑这一点。如果不良行为的后果是最小的，它将不会被解决，这将不是一个错误。bug 有一定的紧急程度，这就是为什么我认为我们必须定义什么是 bug，并遵循零 bug 政策。

那么如果我们是人类，我们总是可以引入 bug，有什么方法可以更快的检测出来呢？。快速反馈回路可以帮助我们。

## 快速失败

> 一些人建议通过自动解决问题来使你的软件健壮。这导致软件“缓慢失败”出现错误后，程序会继续运行，但随后会以奇怪的方式失败。一个快速失败的系统恰恰相反:当问题发生时，它会立即明显地失败。快速失败是一种非直觉的技术:“立即且明显地失败”听起来会让你的软件更加脆弱，但实际上它会让你的软件更加健壮。bug 更容易发现和修复，所以投入生产的更少。
> [废掉快马丁·福勒](https://www.martinfowler.com/ieeeSoftware/failFast.pdf)

## 小批量

软件中的规则很少，但有一条是小问题比大问题容易解决。所以我们能不能试着把问题分成更小的容易解决的问题(这不是一件容易的事情)，这样我们就可以专注于我们所知道的事情？。当我们对那些我们不知道的事情有了更多的了解时，我们还能指望未来吗？。这可能会帮助我们不要在我们还不确定的代码中引入行为。
小问题中出现 bug 的概率会更小，因为我们更容易理解它们，认知负荷更少，修复问题的时间更少。

## 试验

> "程序测试可以用来显示缺陷的存在，但永远不能显示缺陷的不存在！"
> ――埃德格·w·迪克斯特拉

因此，一旦我们发现了不良行为，解决方案就是创建一个测试来探测不良行为并修复它。
我们也可以通过测试来探究一个特定的重要行为。
如果我们的测试是自动测试(单元、集成等)而不是手动测试，我们能够快速获得回归反馈。

## 他人的反馈

最好的反馈来自用户，来自我们的客户。我们能利用我们的团队、我们的组织作为我们应用程序的客户来获得早期反馈吗？。我们是使用我们的预生产环境来实现这一点，还是分离角色并最大限度地减少反馈的可能性？。

现在让我们强调所有这些想法，我们试图做的基本上是与我们的发布候选人保持一种良好的状态。
我们已经定义了说我们处于**良好状态**(测试)的方式，我们已经说过小增量比大增量更安全，反馈是发现 bug 的关键。一个问题浮现在我的脑海，有没有可能一直处于那种“良好状态”，即使是在我成长的时候？。

## 向左移动质量

现在让我们转到开发，在做事情时，有一些过程或工具会把你推向一个或另一个方向。
假设我们想试着检查我们的代码在开发时是否总是绿色的，或者假设我们想尽可能长时间保持绿色。我们想避免在我们的计算机中处于糟糕的状态，在编码时使用我们的 IDE。我能在几个小时内不中断代码的情况下进行重构吗？。事实上，有一本很棒的书就是关于这个的[(马丁·福勒的重构)](https://martinfowler.com/books/refactoring.html)。

我能在不破坏代码的情况下添加新特性吗？。我会说你可以最小化你的代码被破坏的时间，一些工具:
- [TDD](/inverted-scientist-method-aka-tdd-e7848c3fd982?sk=b6234b6d1a4170a8939d9aebcea25157)
-小批量
- [TCR](https://medium.com/@kentbeck_7670/test-commit-revert-870bbd756864)

我能从用户、客户、队友那里得到早期反馈吗？:
- [持续集成](https://javi-kata.medium.com/ci-cd-for-dummies-b45ed917f9dc?sk=28eede1d5fec71121eea4954583130e9)
-持续交付
-持续部署

[想一想，在将代码合并到发布候选之前，你花了多少时间通过调试来了解你的代码是否处于良好状态。](/tdd-vs-debugging-85c8ab53bac8?sk=2151593ce7da303b4f74d4d37cf42b5e)你认为公关和分支机构在帮助你一直保持良好的状态吗？。拥有多个分支意味着同时拥有不同的代码解决方案，合并它们可能是一件困难的事情。

你在遵循这个模式吗？:
“我将打破我的分支中的一切，然后我将修复它，然后我将创建我的测试，然后我将做一个 PR，然后我将做更多的更改，在某个时候我将合并”。
这通常意味着:
-缓慢的反馈循环
-大批量
-脆弱的测试
通常使用这种方法会在更高的环境中发现错误，这些错误会给你的公司带来很大的损失。即使你被迫做分支和公关，你也可以从让你的机器永远保持绿色开始，创造一些小的增量，并向人们展示结果。这是开始学习如何以持续集成的方式工作的方法。

所以对我来说，能够以一种我的代码总是绿色的方式工作是令人向往的，因为我将减少引入错误的可能性，我也将减少发现这些错误的时间。这样做的唯一原因是能够快速、高质量地创造出正确的东西[，从而降低公司的成本。](/quality-vs-speed-9a46a6254a4e?sk=001e5f300ca6a77c86bfc03f923052d4)