<html>
<head>
<title>Django &amp; Markdown Part 2 (installing an editor)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django &amp; Markdown 第 2 部分(安装编辑器)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/django-markdown-part-2-installing-an-editor-ff32aadc49d2?source=collection_archive---------5-----------------------#2022-01-05">https://blog.devgenius.io/django-markdown-part-2-installing-an-editor-ff32aadc49d2?source=collection_archive---------5-----------------------#2022-01-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="eb5a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我重复一下我在第一部分说过的话。人们经常混淆在他们的网站上渲染 markdown 和安装编辑器。如果你想知道如何在 Django 网站上显示 markdown，请查看我的另一个指南。</p><p id="2288" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好吧，事后看来，我对顺序的选择肯定是错的。本指南应该是第 1 部分🤷‍♂️.我很快会把一个 YouTube 视频放在一起(我会把它粘贴在这里),它会把两个指南按照逻辑顺序结合起来。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f3cb11372f08490f8b4783feaf63ebee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqlM8EWxNjRqGjwAm0awRw.png"/></div></div></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="075a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个指南有几个步骤(所以我假设你已经建立了一个 Django 网站)。由于我使用的是 Django 4.0，而且 Markdownx 还没有更新，所以其中的一些步骤可能很快就无关紧要了。</p><p id="da0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完整的例子可以在我的 GitHub repo 上找到<a class="ae ki" href="https://github.com/bitFez/markdown_in_forms.git" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="f53e" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第 1 部分—设置:安装 Django-Markdownx</h1><ol class=""><li id="1934" class="ma mb in jm b jn mc jr md jv me jz mf kd mg kh mh mi mj mk bi translated">如果您已经安装了 Django，请使用 CLI / terminal 安装 Markdownx。在撰写本文时，Markdownx 的版本尚未更新，无法与 Django 4.0 一起使用。<a class="ae ki" href="https://pypi.org/project/django-markdownx/" rel="noopener ugc nofollow" target="_blank">在 PyPi 上。从 PyPi 安装之后，我对这个包做了一些修改，但幸运的是，在写这篇文章的时候，开发人员将一个建议的更新合并到了他们的 GitHub 库中。如果包已经被更新，使用它。如果没有，请使用下面的 CLI 命令直接从 GitHub 安装。变化很小(解决了 Django 4.0 中如何处理 URL 模式的问题)，我希望对未来的版本也适用🤲📿。</a></li></ol><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="45e0" class="mq ld in mm b gy mr ms l mt mu">pip install git+<a class="ae ki" href="https://github.com/neutronX/django-markdownx.git@master" rel="noopener ugc nofollow" target="_blank">https://github.com/neutronX/django-markdownx.git@master</a></span></pre><p id="e4c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.现在进入 Django 项目 settings.py 文件，将 Markdownx 应用程序添加到您的<code class="fe mv mw mx mm b">INSTALLED_APPS</code>列表下。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="a827" class="mq ld in mm b gy mr ms l mt mu">INSTALLED_APPS = [    <br/>    ...<br/>    'markdownx', # &lt;-- needed for adding markdown to forms<br/>    ...<br/>]</span></pre><p id="643d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在同一个文件(settings.py)中，确保设置了静态文件目录。在使用 MarkdownX 上传图像以及下载 MarkdownX 资产文件时，您将需要它。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="5b27" class="mq ld in mm b gy mr ms l mt mu">STATIC_URL = '/static/'<br/>MEDIA_URL = '/media/'<br/>STATICFILES_DIRS = [<br/>    os.path.join(BASE_DIR, 'static/'),<br/>]<br/>STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')<br/>MEDIA_ROOT = os.path.join(BASE_DIR, 'static/media')</span></pre><p id="7afd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 3 </strong>。确保您已经将 MarkdownX URL 模式添加到核心 url.ps 文件中。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="4a22" class="mq ld in mm b gy mr ms l mt mu">urlpatterns = [     <br/>    <em class="my">...</em>    <br/>    path('markdownx/', include('markdownx.urls')), <br/>]<br/>urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</span><span id="3161" class="mq ld in mm b gy mz ms l mt mu">urlpatterns += static(settings.MEDIA_URL, document_root = settings.MEDIA_ROOT)</span></pre><h1 id="deeb" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">更新模型</h1><p id="6a08" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated"><strong class="jm io"> 4 </strong>。我有一个帖子的基本模型，我会做一个简单的改变。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="7da1" class="mq ld in mm b gy mr ms l mt mu"><strong class="mm io">from</strong> markdownx.models <strong class="mm io">import</strong> MarkdownxField</span><span id="322d" class="mq ld in mm b gy mz ms l mt mu">class Post(models.Model):<br/>    title = models.CharField(max_length=250)<br/><strong class="mm io">    content = models.TextField()</strong><br/>    author = models.ForeignKey(User, on_delete=models.CASCADE)</span></pre><p id="59b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更改为:</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="1f0c" class="mq ld in mm b gy mr ms l mt mu">class Post(models.Model):<br/>    title = models.CharField(max_length=250)<br/>    <strong class="mm io">content = MarkdownxField()</strong><br/>    author = models.ForeignKey(User, on_delete=models.CASCADE)</span></pre><p id="a395" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.一旦您保存了这些内容，请确保进行迁移，以便反映数据库表中的更改，并收集静态数据以下载 MarkdownX 资产。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="ef7c" class="mq ld in mm b gy mr ms l mt mu">python manage.py makemigrations<br/>python manage.py migrate<br/>python manage.py collectstatic</span></pre><p id="afed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 6 </strong>。在 posts 应用程序中(嗯，对我来说它叫做<em class="my"> posts </em>，打开 admin.py 文件并为你的管理站点注册 MarkdownX。对于您来说，可能只是添加下面的第一行来导入 MarkdownX，然后使用 MarkdownX 包来注册模型，就像我在第 3 行所做的那样</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="0e14" class="mq ld in mm b gy mr ms l mt mu"><strong class="mm io">from</strong> markdownx.admin <strong class="mm io">import</strong> MarkdownxModelAdmin <br/><strong class="mm io">from</strong> .models <strong class="mm io">import</strong> Post  </span><span id="7499" class="mq ld in mm b gy mz ms l mt mu">admin.site.register(Post, <strong class="mm io">MarkdownxModelAdmin</strong>)</span></pre><p id="e368" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">目前，MarkdownX 已经开始在网站的管理部分工作。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nd"><img src="../Images/406121a80e41e9b4524c1197f049cdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XD_0oQfMsIhmHS0MJ0LP2g.png"/></div></div></figure><h1 id="adb3" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创建表单</h1><p id="3936" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated"><strong class="jm io"> 7 </strong>。你可能已经有一张表格了。我采取的步骤是:</p><p id="df45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">向我的帖子 views.py 文件添加视图。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="bf61" class="mq ld in mm b gy mr ms l mt mu">def submit_post(request):<br/>    form = PostForm(request.POST or None)<br/>    context = {'form':form}<br/>    if request.method == "POST":<br/>        if form.is_valid():<br/>            post = form.save(commit=False)<br/>            post.author = request.user<br/>            post.save()</span><span id="42da" class="mq ld in mm b gy mz ms l mt mu">        return redirect("posts:home") # should redirect to the homepage<br/>    else:<br/>        return render(request, "posts/partials/form.html", context)<br/>    return render(request, 'posts/post_form.html', context)</span></pre><p id="fd25" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 post app urls.py 中添加 URL 模式</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="a1b4" class="mq ld in mm b gy mr ms l mt mu">urlpatterns = [<br/>  ..<br/>  path('create_post/', views.submit_post, name='create_post'),<br/>]</span></pre><p id="a1b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过在 post app 目录中创建一个名为“forms.py”的文件来创建上面视图中引用的<code class="fe mv mw mx mm b">PostForm</code>:</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="1e37" class="mq ld in mm b gy mr ms l mt mu">from django import forms<br/>from .models import Post</span><span id="b07f" class="mq ld in mm b gy mz ms l mt mu">class PostForm(forms.ModelForm):<br/>  class Meta:<br/>    model = Post<br/>    fields = ['title','content']</span></pre><p id="fcf0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，在“templates/posts”下的 apps 目录中为视图创建一个模板</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="0e94" class="mq ld in mm b gy mr ms l mt mu">{% extends 'base.html' %}<br/>{% load static %}</span><span id="109a" class="mq ld in mm b gy mz ms l mt mu">&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;h3&gt;Post form&lt;/h3&gt;</span><span id="aac7" class="mq ld in mm b gy mz ms l mt mu">    &lt;form method="POST" action=""&gt;{% csrf_token %}<br/>      {{ form }}<br/>      &lt;button type='submit'&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>    {{ form.media }}</span><span id="f447" class="mq ld in mm b gy mz ms l mt mu">   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2e2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这应该会产生一个在<br/>正下方有预览区域的表单👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/701ea7374199eb2b112faa1337978966.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*CDgsvro4l9_82gzQ_IJ2yQ.png"/></div></figure><h2 id="433c" class="mq ld in bd le nf ng dn li nh ni dp lm jv nj nk lq jz nl nm lu kd nn no ly np bi translated">创建并排表单和预览视图，如下例所示:</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nq"><img src="../Images/12507a1b0275d1f60f0c8e66aa6acbd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cUOr4u7qLNNuFC8P"/></div></div></figure><p id="aa55" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这最后一部分应该非常简单，但是当前版本的 Markdownx 似乎有一个小错误。到时候我会指出解决办法。<br/>因此，您需要确保在项目的根目录中，您有一个 templates 文件夹，并且您已经注册了模板可以在您的根文件夹中的<code class="fe mv mw mx mm b">TEMPLATES</code>下的 settings.py 文件中找到。(参见下面的<strong class="jm io">粗体</strong>部分)</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="5cd4" class="mq ld in mm b gy mr ms l mt mu"><strong class="mm io"><em class="my">TEMPLATES</em></strong> = [<br/>  {'BACKEND': 'django.template.backends.django.DjangoTemplates',<br/>  <strong class="mm io">'DIRS': [<br/>     os.path.join(BASE_DIR, 'templates')<br/>   ],</strong><br/>  'APP_DIRS': True,<br/>  'OPTIONS': {<br/>    'context_processors': [<br/>      'django.template.context_processors.debug',<br/>      'django.template.context_processors.request',<br/>      'django.contrib.auth.context_processors.auth',<br/>      'django.contrib.messages.context_processors.messages',<br/>     ],<br/>    },<br/>  },<br/>]</span></pre><p id="cea0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">8.在另一个名为 markdownx 的文件夹内的 templates 文件夹中添加一个名为“<em class="my">widget.html</em>的新文件。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="b7b5" class="mq ld in mm b gy mr ms l mt mu">TEMPLATES<br/>+-- markdownx<br/>|   +-- widget.html</span></pre><p id="2670" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">文档中的例子包括一个带有引导格式的小部件，但是我没有把它包括在我的指南中，所以我的例子省略了它。</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="653e" class="mq ld in mm b gy mr ms l mt mu">&lt;div class="markdownx row" style="display:flex;"&gt;<br/>     &lt;div class="column" style="flex: 50%;"&gt;<br/>         {% include 'django/forms/widgets/textarea.html' %}<br/>     &lt;/div&gt;<br/>     &lt;div class="column" style="flex: 50%;"&gt;<br/>         &lt;div class="markdownx-preview"&gt;&lt;/div&gt;<br/>     &lt;/div&gt;<br/> &lt;/div&gt;</span></pre><h2 id="c518" class="mq ld in bd le nf ng dn li nh ni dp lm jv nj nk lq jz nl nm lu kd nn no ly np bi translated">小修修补补</h2><p id="9d6b" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">正如我所说的，在编写时有一个小错误，Markdownx 没有自动从根模板文件夹中获取上面创建的模板覆盖。<a class="ae ki" href="https://github.com/neutronX/django-markdownx/issues/76#issuecomment-315538157" rel="noopener ugc nofollow" target="_blank">GitHub 的一位用户在这里列出了一个快速解决方案。希望你不需要这个零件。</a></p><p id="3afe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">9.再次进入核心 app <em class="my"> settings.py </em>文件，在<code class="fe mv mw mx mm b">INSTALLED_APPS</code>下添加<code class="fe mv mw mx mm b">django.forms</code>为 app。</p><p id="5eb6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，在那下面，也加上下面的:<code class="fe mv mw mx mm b">FORM_RENDERER='django.forms.renderers.TemplatesSetting'</code>像下面这样:</p><pre class="kk kl km kn gt ml mm mn mo aw mp bi"><span id="f5c0" class="mq ld in mm b gy mr ms l mt mu">INSTALLED_APPS = [<br/>  ...<br/>  <strong class="mm io">'django.forms',</strong><br/>  ....<br/>]</span><span id="cdee" class="mq ld in mm b gy mz ms l mt mu">FORM_RENDERERFORM='django.forms.renderers.TemplatesSetting'<!-- --> </span></pre><h1 id="d708" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">最后的结果</h1><p id="397e" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">维奥拉。希望对你来说应该是这样的。毫无疑问，你会做得更好。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nr"><img src="../Images/a37f50ec1eada0af8d91c69a2f4b3be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGeOkkpPp3xlgWtOCooECw.png"/></div></div></figure><p id="542c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我再一次放下麦克风🎤 ⤵</p></div></div>    
</body>
</html>