<html>
<head>
<title>Play Video with ARKit and Image Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ARKit和图像跟踪播放视频</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/play-video-with-arkit-and-image-tracking-e8b52dc4ad76?source=collection_archive---------1-----------------------#2020-05-01">https://blog.devgenius.io/play-video-with-arkit-and-image-tracking-e8b52dc4ad76?source=collection_archive---------1-----------------------#2020-05-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><p id="01f7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://developer.apple.com/arkit/" rel="noopener ugc nofollow" target="_blank"> ARKit </a>是苹果的一个框架，负责处理为iOS设备构建的增强现实应用和游戏。这是一个高级API，提供了众多强大的功能，让一个神奇的世界变得栩栩如生。</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/ccf8849ae52ae6b3a8e148007c58267e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eV6UVOahOpqKTxUQ7sGO5Q.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:developer.apple.com</figcaption></figure><h1 id="ffe1" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">层层ARKit </strong></h1><p id="4b21" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">ARKit可以大致分为3层。它们如下:</p><h2 id="2498" class="mj lh in bd li mk ml dn lm mm mn dp lq kc mo mp lu kg mq mr ly kk ms mt mc mu bi translated">世界追踪</h2><p id="f80c" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated"><a class="ae kp" href="https://developer.apple.com/documentation/arkit/world_tracking" rel="noopener ugc nofollow" target="_blank">世界追踪</a>是ARKit最关键的功能。它允许我们跟踪表面、图像、物体、人，甚至我们的脸。</p><h2 id="b52f" class="mj lh in bd li mk ml dn lm mm mn dp lq kc mo mp lu kg mq mr ly kk ms mt mc mu bi translated">场景理解</h2><p id="b229" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">场景理解是指分析现实世界的场景、垂直和水平平面、物体和其他信息。有了这种理解，我们就可以将虚拟物体放入现实世界。ARKit提供了3种场景理解:平面检测，点击测试和光照估计。</p><h2 id="9e03" class="mj lh in bd li mk ml dn lm mm mn dp lq kc mo mp lu kg mq mr ly kk ms mt mc mu bi translated">翻译</h2><p id="5a7b" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">ARKit使用不同的技术来处理3D模型并将其呈现给场景，例如:</p><ul class=""><li id="ca9c" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated"><a class="ae kp" href="https://developer.apple.com/documentation/scenekit" rel="noopener ugc nofollow" target="_blank">T8】scene kitT10】</a></li><li id="8906" class="mv mw in jt b ju nf jy ng kc nh kg ni kk nj ko na nb nc nd bi translated"><a class="ae kp" href="https://developer.apple.com/documentation/realitykit" rel="noopener ugc nofollow" target="_blank"> <em class="ne">现实工具包</em> </a></li><li id="7bad" class="mv mw in jt b ju nf jy ng kc nh kg ni kk nj ko na nb nc nd bi translated"><a class="ae kp" href="https://developer.apple.com/metal/" rel="noopener ugc nofollow" target="_blank"> <em class="ne">金属</em> </a></li><li id="7fd0" class="mv mw in jt b ju nf jy ng kc nh kg ni kk nj ko na nb nc nd bi translated"><a class="ae kp" href="https://developer.apple.com/spritekit/" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> SpriteKit </em> </a></li></ul><h1 id="d80e" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">先决条件</h1><p id="0ee7" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">ARKit最低限度需要<strong class="jt io"> A9 </strong>处理器硬件和<strong class="jt io"> iOS 11 </strong>软件，另外还需要一个真实的摄像头。由于这个原因，我们不能用Xcode模拟器运行我们的项目。</p><p id="8e6d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在本教程中，我们将主要关注<a class="ae kp" href="https://developer.apple.com/documentation/arkit/arimagetrackingconfiguration" rel="noopener ugc nofollow" target="_blank">图像跟踪</a>，然后在图像上叠加一个要播放的视频。那么，我们开始吧。</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><h1 id="c921" class="lg lh in bd li lj nk ll lm ln nl lp lq lr nm lt lu lv nn lx ly lz no mb mc md bi translated">辅导的</h1><p id="1a67" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">在我们开始这个教程之前，我们应该知道<code class="fe np nq nr ns b"><a class="ae kp" href="https://developer.apple.com/documentation/arkit/arimagetrackingconfiguration" rel="noopener ugc nofollow" target="_blank">ARImageTrackingConfiguration</a></code>类的重要性。</p><h2 id="423f" class="mj lh in bd li mk ml dn lm mm mn dp lq kc mo mp lu kg mq mr ly kk ms mt mc mu bi translated"><strong class="ak">ARImageTrackingConfiguration</strong></h2><p id="1818" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">当我们只想使用设备的背面摄像头来跟踪已知图像时，我们会使用该配置。</p><p id="a7ac" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">通过<code class="fe np nq nr ns b">ARImageTrackingConfiguration</code>，ARKit不是通过跟踪设备相对于世界的运动，而是仅仅通过检测和跟踪相机视野中已知2D图像的运动来建立3D空间。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/4665429f390c8d167df11db107a4018b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hd7V4uGcKVDYgErIbF0SoQ.jpeg"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae kp" href="http://hongchaozhang.github.io/" rel="noopener ugc nofollow" target="_blank">http://hongchaozhang.github.io/</a></figcaption></figure><blockquote class="nu nv nw"><p id="490f" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">让我们为这个教程收集资源</strong></p></blockquote><p id="b3c2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">对于本教程，我们将使用下面的<strong class="jt io">图像和视频</strong>进行图像跟踪和叠加视频。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oa"><img src="../Images/9d199d00131ef510bb8e3c3a7211448b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RbNxOmqmWObvM_T0pzUwcg.jpeg"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae kp" href="https://foreignpolicy.com/" rel="noopener ugc nofollow" target="_blank">https://foreignpolicy.com/</a></figcaption></figure><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="nu nv nw"><p id="ff01" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">让我们创建一个新的增强现实应用</strong></p></blockquote><p id="4697" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">选择增强现实应用程序作为我们新项目的模板。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/e914250908dca8c5294f8bbd6295234d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNYTZESFv28AOXVasoKxqw.png"/></div></div></figure><p id="d581" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">根据您的方便，为您的项目命名。我把它命名为<strong class="jt io"><em class="ne">“ARDemo”。</em> </strong>选择语言为<strong class="jt io"><em class="ne">【Swift】</em></strong><em class="ne"/>内容技术为<strong class="jt io"><em class="ne">【scene kit】</em></strong>用户界面为<strong class="jt io"> <em class="ne">【故事板】</em> </strong>。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/c73fd802660226a8600f886c7be2c11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLkqKAuIOYX0uobop6IJ1w.png"/></div></div></figure><blockquote class="nu nv nw"><p id="ea85" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">让我们创建一个新的AR资源组</strong></p></blockquote><p id="a631" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">从项目文件夹结构中选择<em class="ne">“assets . xc assets”</em>创建一个新的<strong class="jt io"> AR资源组</strong>，然后选择底部的<em class="ne">“+”</em>图标，选择<em class="ne">“新建AR资源组”</em>选项，如下图所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/654c6810c0b12e7df3dbf3939156009d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifMe6Z0c0_CljvVd4b6nwQ.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oe"><img src="../Images/fef6bb894be833f11241e7acd3232c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTC0j7Yj-8Zi96CEOOFqnA.png"/></div></div></figure><p id="0dc6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后，我们需要将我们的参考图像添加到这个新的AR资源组中，如下所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/55d829d2602cc95cd8729a80711df597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFKTVWUmOnl-MNKOHIKxvA.png"/></div></div></figure><p id="0f4b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可能会收到一条警告，说明<strong class="jt io"> " <em class="ne"> AR参考图像"图像"必须具有非零的正宽度"。</em> </strong>为了消除这个警告，我们需要增加AR参考图像的尺寸，如下图所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/f705eb66842a93df20aab77d6c3c8011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AItwnzVns03GoSK37rkIkw.png"/></div></div></figure><blockquote class="nu nv nw"><p id="b42b" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">让我们将视频添加到我们的项目中</strong></p></blockquote><p id="042a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后，我们需要将视频添加到我们的项目中，该项目将在图像上叠加播放，如下所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi of"><img src="../Images/563130fcc563c4c16b333167691fad6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YD0zq6rlxS7DSTb3v2qug.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/42ad769ef3b0012388b1b409a9df26e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZZq9QcavT-iOkYLdSZVPg.png"/></div></div></figure><blockquote class="nu nv nw"><p id="b01e" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">让我们看看ship.scn文件</strong></p></blockquote><p id="2b78" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">起始项目将如下所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/aae29239e339025965aba15aa4247a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkgDXuZ9iR0o7_F9qx83SQ.png"/></div></div></figure><p id="73ec" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">从ship.scn文件中移除shipMesh，并将场景图形重命名为<em class="ne">“container”</em>，如下图所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/59de9579a8a6c275e45355ac7d575c85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFEQvDzVRpPwl3oJ56JdYw.png"/></div></div></figure><p id="e023" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后添加一个空节点<em class="ne"> </em>作为“container”节点的子节点，命名为“videoContainer”。完成后，添加一个平面并重命名为<em class="ne">“视频”</em>，如下图所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oe"><img src="../Images/0643c60e67bd06de5ec131ca8720fdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21LRKHU8KC6QzaiSL0Ng8A.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/e5fdbd33c5b67b2d672cf91bce7dbba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cimJITOevqnwsiavCNlbg.png"/></div></div></figure><p id="a910" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">此外，添加环境光和平行光作为容器节点的子节点，如下所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/b635ce3f393e1419d7742ae0511b014a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L3FsRWyRdxPnu8QUxg8skA.png"/></div></div></figure><p id="c3b5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后改变环境光的强度为200，平行光的强度为800，如下图所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/0edfe7998c4092b67c0bc705875fc31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLNTlodNc_WhDdvrdDuAkA.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/0fbe23f227ce80dfffca2be49712c3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xqhg6liboc0lsjifxIOfGw.png"/></div></div></figure><p id="3c96" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后更改视频平面的比例值和欧拉角，并使容器节点隐藏，如下所示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/698f4e2ec50a067d316b836e86a2da7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*turyRU4iMfSc-BlHK1xqyw.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/c88e583993a5c83ebe92a3960edee683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*48VxC2XHC2yiI6u3FW-D7g.png"/></div></div></figure><p id="df2f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们已经完成了ship.scn文件。</p><blockquote class="nu nv nw"><p id="2036" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">选择ViewController.swift文件</strong></p></blockquote><p id="50e3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们首先为videoNode和videoPlayer创建引用，如下所示。</p><pre class="kr ks kt ku gt og ns oh oi aw oj bi"><span id="9dd1" class="mj lh in ns b gy ok ol l om on"><strong class="ns io">@IBOutlet</strong> <strong class="ns io">var</strong> sceneView: ARSCNView!<br/><strong class="ns io">var</strong> videoNode: SKVideoNode!<br/><strong class="ns io">var</strong> videoPlayer: AVPlayer!</span></pre><p id="a12f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">用如下所示的代码替换<em class="ne"> "viewWillAppear" </em>方法。这里，首先创建一个<em class="ne">“ARImageTrackingConfiguration”</em>的实例，然后我们从<em class="ne">“AR资源”</em>中检索所有图像，并将其分配给配置的跟踪图像，然后运行配置。</p><pre class="kr ks kt ku gt og ns oh oi aw oj bi"><span id="6a96" class="mj lh in ns b gy ok ol l om on"><strong class="ns io">override</strong> <strong class="ns io">func</strong> viewWillAppear(<strong class="ns io">_</strong> animated: Bool) {<br/><strong class="ns io">super</strong>.viewWillAppear(animated)</span><span id="dc35" class="mj lh in ns b gy oo ol l om on">// Create a session configuration<br/><strong class="ns io">let</strong> configuration = ARImageTrackingConfiguration()</span><span id="5fda" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> arImages = ARReferenceImage.referenceImages(inGroupNamed: "AR Resources", bundle: <strong class="ns io">nil</strong>) <strong class="ns io">else</strong> { <strong class="ns io">return </strong>}</span><span id="2fa4" class="mj lh in ns b gy oo ol l om on">configuration.trackingImages = arImages</span><span id="bd77" class="mj lh in ns b gy oo ol l om on">// Run the view's session<br/>sceneView.session.run(configuration)<br/>}</span></pre><p id="198e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后用下面的代码添加下面的委托方法<em class="ne">" scnscenerender "</em>，如下所示。</p><pre class="kr ks kt ku gt og ns oh oi aw oj bi"><span id="04cd" class="mj lh in ns b gy ok ol l om on"><strong class="ns io">func</strong> renderer(<strong class="ns io">_</strong> renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor) {</span><span id="53ba" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> anchor <strong class="ns io">is</strong> ARImageAnchor <strong class="ns io">else</strong> { <strong class="ns io">return</strong> }</span><span id="0612" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> referenceImage = ((anchor <strong class="ns io">as</strong>? ARImageAnchor)?.referenceImage) <strong class="ns io">else</strong> { <strong class="ns io">return </strong>}</span><span id="e440" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> container = sceneView.scene.rootNode.childNode(withName: "container", recursively: <strong class="ns io">false</strong>) <strong class="ns io">else</strong> { <strong class="ns io">return</strong> }</span><span id="8f65" class="mj lh in ns b gy oo ol l om on">container.removeFromParentNode()<br/>node.addChildNode(container)<br/>container.isHidden = <strong class="ns io">false</strong></span><span id="cffa" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> videoURL = Bundle.main.url(forResource: "video", withExtension: ".mp4") <strong class="ns io">else</strong> { <strong class="ns io">return</strong> }<br/>videoPlayer = AVPlayer(url: videoURL)</span><span id="6d71" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">let</strong> videoScene = SKScene(size: CGSize(width: 720.0, height: 1280.0))<br/>videoNode = SKVideoNode(avPlayer: videoPlayer)<br/>videoNode.position = CGPoint(x: videoScene.size.width/2, y: videoScene.size.height/2)<br/>videoNode.size = videoScene.size<br/>videoNode.yScale = -1<br/>videoNode.play()<br/>videoScene.addChild(videoNode)</span><span id="167c" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> video = container.childNode(withName: "video", recursively: <strong class="ns io">true</strong>) <strong class="ns io">else</strong> { <strong class="ns io">return</strong> }video.geometry?.firstMaterial?.diffuse.contents = videoScene</span><span id="64cb" class="mj lh in ns b gy oo ol l om on">video.scale = SCNVector3(x: Float(referenceImage.physicalSize.width), y: Float(referenceImage.physicalSize.height), z: 1.0)</span><span id="4998" class="mj lh in ns b gy oo ol l om on">video.position = node.position</span><span id="629d" class="mj lh in ns b gy oo ol l om on">// For Animation<br/><strong class="ns io">guard</strong> <strong class="ns io">let</strong> videoContainer = container.childNode(withName: "videoContainer", recursively: <strong class="ns io">false</strong>) <strong class="ns io">else</strong> { <strong class="ns io">return</strong> }</span><span id="0f93" class="mj lh in ns b gy oo ol l om on">videoContainer.runAction(SCNAction.sequence([SCNAction.wait(duration: 1.0), SCNAction.scale(to: 1.0, duration: 0.5)]))<br/>}</span></pre><p id="4e3c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在在物理设备上运行应用程序。您应该能够看到视频在图像上方播放，如下所示。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="op oc l"/></div></figure><p id="a1b3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">此外，视频本身会随着锚定图像大小的变化而调整大小。</p><p id="c738" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">但是我们还没有完成。在结束之前，我们还需要思考一个问题。当我们将设备从锚定图像移开时，视频仍会继续播放。我们将如何解决这个问题？</p><blockquote class="nu nv nw"><p id="9d02" class="jr js ne jt b ju jv jw jx jy jz ka kb nx kd ke kf ny kh ki kj nz kl km kn ko ig bi translated"><strong class="jt io">实现暂停视频功能</strong></p></blockquote><p id="e47d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">只需将下面几行代码添加到<strong class="jt io">暂停或恢复</strong>视频中，它就会为我们变魔术。</p><pre class="kr ks kt ku gt og ns oh oi aw oj bi"><span id="aaa7" class="mj lh in ns b gy ok ol l om on"><strong class="ns io">func</strong> renderer(<strong class="ns io">_</strong> renderer: SCNSceneRenderer, didUpdate node: SCNNode, for anchor: ARAnchor) {</span><span id="235c" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">guard</strong> <strong class="ns io">let</strong> imageAnchor = (anchor <strong class="ns io">as</strong>? ARImageAnchor) <strong class="ns io">else</strong> { <strong class="ns io">return </strong>}</span><span id="70f2" class="mj lh in ns b gy oo ol l om on"><strong class="ns io">if</strong> imageAnchor.isTracked {<br/>   videoNode.play()<br/>} <strong class="ns io">else</strong> {<br/>   videoNode.pause()<br/>}<br/>}</span></pre></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><h1 id="176f" class="lg lh in bd li lj nk ll lm ln nl lp lq lr nm lt lu lv nn lx ly lz no mb mc md bi translated">结论</h1><p id="adcb" class="pw-post-body-paragraph jr js in jt b ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko ig bi translated">在本教程中，我们已经看到了如何将一个视频叠加在一个锚定图像上，它可以随着锚定图像的变化而动态地改变其大小。我们还看到了场景渲染器更新后如何暂停和恢复视频。</p><p id="e653" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">本教程的源代码可以在<a class="ae kp" href="https://github.com/paloamit/ARVideo.git" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">这里</strong> </a>找到。</p><p id="567d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果你觉得这些有用，请随意分享。感谢阅读！</p><p id="52fb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">希望你喜欢看《猫和老鼠》。</p></div></div>    
</body>
</html>