<html>
<head>
<title>A Point In Time Data Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间点数据仓库</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-point-in-time-data-warehouse-fa5c57fe6c18?source=collection_archive---------9-----------------------#2022-10-23">https://blog.devgenius.io/a-point-in-time-data-warehouse-fa5c57fe6c18?source=collection_archive---------9-----------------------#2022-10-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/891cad9d7f51f78f30372e5a288414a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8QAnL-fdROUJ44kX"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jz" href="https://unsplash.com/@towfiqu999999?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Towfiqu barb huya</a>拍摄的照片</figcaption></figure><p id="fce1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如何组织数据，以便在任意时间点或任意时间点之间轻松进行报告。</p><h1 id="e702" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">目的</h1><p id="4dcd" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通常，对于事务性数据，您需要能够跟踪数据随时间的变化，例如，一家度假公司可能向客户销售特定酒店的假期，但后来他们升级了房间、更改了酒店，或者他们可能在预订中添加了额外的乘客。任何这些都可能导致同时支付的金额发生变化。</p><p id="9170" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，您可能需要报告您的数据，因为它是上个月发生变化之前的数据，如营销部门的追加销售，以便与本月尚未进行任何追加销售的预订进行比较，因此您是在进行同类比较。</p><p id="7c0d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种方法使你能够简单地作为问题，如:</p><p id="2882" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mb">我今天的预订值是多少？</em></p><p id="7186" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">截至上周，我的预订价值是多少？</p><p id="e530" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mb">7 天前有什么变化？</em></p><p id="c3a4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mb">预订变更对各酒店有什么影响？</em></p><p id="4c30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mb">上个月我们向每家酒店出售或增加了多少乘客？</em></p><h1 id="b9c1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">它是如何工作的</h1><p id="5b85" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通常情况下，您会将记录独立地接收到您的数据仓库中，并将它们作为每次更改的快照存储起来，并加盖您接收它们的日期。但是，您可能希望运行报告，以便轻松地查看昨天所做的更改，或特定日期或特定时间段的所有更改。</p><p id="5015" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面的方法向您展示了如何构建一个中间层来实现可靠的快照存储，以及如何构建一个 datamart 表来跟踪更改，以便您可以灵活方便地跟踪维度和值的更改。尝试仅使用快照进行报告通常涉及更复杂的 SQL，使用相关的子查询来获取不同时间点或不同时间点之间的数据，因此下面的“contra”机制非常适合需要在不同时间点轻松报告数据的数据集市。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/c6d4d6b2b2fa59a2d762620a1ea7b45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69Va1YdIvNuu4MbA6te5Ng.png"/></div></div></figure><h2 id="f442" class="mh kz in bd la mi mj dn le mk ml dp li kl mm mn lm kp mo mp lq kt mq mr lu ms bi translated">应用程序或源数据</h2><p id="1265" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这显示了预订在源系统中是如何随时间变化的。每个版本可能保留在预订系统中，也可能不保留，这取决于应用程序是如何编写的，但这并不重要，因为它们都是作为加载到临时区域的一部分而被捕获的。</p><p id="1047" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">预订日期保持与最初创建时相同。示例记录将显示该方法如何适用于:</p><ul class=""><li id="c018" class="mt mu in kc b kd ke kh ki kl mv kp mw kt mx kx my mz na nb bi translated"><strong class="kc io">版本 1 </strong>中的原始预订</li><li id="3fa6" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated"><strong class="kc io">版本 2 </strong>中的数值变化</li><li id="dbc7" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated"><strong class="kc io">版本 3 </strong>中的尺寸变化</li><li id="e424" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">在<strong class="kc io">版本 4 </strong>中数值和尺寸同时变化</li></ul><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/d7e5fa74a2ee90a85ccd946d8fae3c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBssTYv-ja36rMroNwIzrA.png"/></div></div></figure><h2 id="b766" class="mh kz in bd la mi mj dn le mk ml dp li kl mm mn lm kp mo mp lq kt mq mr lu ms bi translated"><strong class="ak">注释</strong></h2><ul class=""><li id="b380" class="mt mu in kc b kd lw kh lx kl ni kp nj kt nk kx my mz na nb bi translated">为阿尔法酒店创建了 4 名乘客和 1000 英镑收入的 10 月预订</li><li id="69ad" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">14 月 3 日的预订被修改，收入增加了 200 英镑，仍然是阿尔法酒店</li><li id="d0f4" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">4 月 1 日改为布拉沃酒店，收入不变</li><li id="9d7e" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">05 年 5 月改为查理酒店，增加了一名乘客，收入增加到 1800 英镑</li></ul><h2 id="7f04" class="mh kz in bd la mi mj dn le mk ml dp li kl mm mn lm kp mo mp lq kt mq mr lu ms bi translated">暂存层</h2><p id="0866" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">应用程序数据被加载到暂存层中。此示例假设它是一个持久性临时层(未删除)。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/2810320d55ba23391845ea54142e1a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uiMTGooMBUnFKjAY0QHj-w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">暂存层</figcaption></figure><h1 id="fa9e" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">中间层</h1><p id="a40b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">中间层包含每个记录的快照以及:</p><ul class=""><li id="5af6" class="mt mu in kc b kd ke kh ki kl mv kp mw kt mx kx my mz na nb bi translated"><strong class="kc io">有效起始日期</strong> —源系统创建记录的日期(或相关的日期时间)</li><li id="b111" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated"><strong class="kc io">有效截止日期</strong> —在插入的下一条记录的有效起始日期之后 1 个增量(天、秒、毫秒等)的日期(或日期时间，如果相关的话)。插入下一条记录时，会更新前一条记录</li><li id="e06b" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated"><strong class="kc io">当前记录标志</strong> —对于当前记录设置为‘Y ’,对于所有先前记录设置为‘N’。插入下一条记录时，会更新前一条记录</li></ul><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/27c608ee154ba1ca84e800b0282cc9ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBM_8eZr6ulCPFmFJ-shxQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">中</figcaption></figure><p id="e85e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然本文关注的是数据集市的最终输出，但是中间层在任何时间点的查询都可以按如下方式实现:</p><p id="bb90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">(在本例中，假设您想要截至 2020 年 4 月 15 日的记录)</p><pre class="md me mf mg gt nn no np nq aw nr bi"><span id="1ba5" class="mh kz in no b gy ns nt l nu nv">SELECT *<br/>FROM middle_table<br/>WHERE '2020-04-15' BETWEEN valid_from_date AND valid_to_date</span></pre><h1 id="7276" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">数据集市层</h1><p id="1f3e" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">每个记录都被加载到 datamart 表中，但是随着每个新版本的添加，也会为以前的版本创建一个反向记录——这就是“contra”记录。</p><p id="05a0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“抵销”一词来自会计术语，即两个账户相互抵销，以减少整体的价值。在这种情况下，净值为零。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/be94b4a09f0fba57da7c2030682a29b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYOx1rq2aJzgjL081furZQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">数据集市层</figcaption></figure><h2 id="d123" class="mh kz in bd la mi mj dn le mk ml dp li kl mm mn lm kp mo mp lq kt mq mr lu ms bi translated"><strong class="ak">注意事项</strong></h2><ul class=""><li id="d8eb" class="mt mu in kc b kd lw kh lx kl ni kp nj kt nk kx my mz na nb bi translated">在 3 月 10 日，插入初始记录，更改日期与预订日期相同</li><li id="94ae" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">在 3 月 14 日，<strong class="kc io">版本 1 </strong>记录被撤销，更改日期为 3 月 14 日</li><li id="79a3" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">版本 2 的新记录<strong class="kc io">插入了 14 月变更日期。预订的累计价值现在是 1200 英镑，有 4 名乘客到阿尔法酒店</strong></li><li id="9c57" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">4 月 1 日，<strong class="kc io">版本 2 </strong>记录被撤销，更改日期为 4 月 1 日</li><li id="9c76" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">版本 3 的<strong class="kc io">新记录插入了 1-Apr 变更日期。预订的累计价值现在是 1200 英镑，有 4 名乘客，但现在是布拉沃酒店</strong></li><li id="4c18" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">5 月 5 日，<strong class="kc io">版本 3 </strong>记录被撤销，更改日期为 5 月 5 日</li><li id="b6cb" class="mt mu in kc b kd nc kh nd kl ne kp nf kt ng kx my mz na nb bi translated">版本 4 的<strong class="kc io">新记录插入了 1-Apr 变更日期。预订的累计价值现在是 1800，有 5 名乘客，但现在是查理酒店</strong></li></ul></div><div class="ab cl nx ny hr nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ig ih ii ij ik"><p id="d777" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种工作的关键是，对销记录添加了与插入的新记录相同的变更日期，因为这显示了在预订的给定日期发生的所有变更。</p><p id="5597" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">数据集市层中每个预订的记录数总是等于:</p><p id="a0cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">(变化次数 x 2 ) -1 </strong></p><h1 id="04fc" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">一个完全可行的例子</h1><p id="90e8" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这是一个完全工作的例子，已经在谷歌大查询中编写。它可以在大多数数据库中工作，只需稍微修改一下语法。</p><p id="9eae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它设置了表，将一些“源”数据加载到 e 阶段表中，加载中间的“快照”表，然后从那里开始数据集市表，包括合同，然后有一些示例查询。</p><p id="3c85" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">适当替换[您的数据库]和[您的模式]。</p><pre class="md me mf mg gt nn no np nq aw nr bi"><span id="8b95" class="mh kz in no b gy ns nt l nu nv">--Set up your schema and tables<br/>CREATE SCHEMA [YOUR_DATEBASE].[YOUR_SCHEMA];<br/>  <br/>CREATE TABLE [YOUR_DATEBASE].[YOUR_SCHEMA].stage_table<br/>(<br/>  booking_id numeric,<br/>  version numeric(15,0),<br/>  booking_date date,<br/>  change_date date,<br/>  hotel string,<br/>  number_of_passengers numeric(15,0),<br/>  revenue numeric(15,2)<br/>);<br/> <br/>CREATE TABLE [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table<br/>(<br/>  booking_id numeric,<br/>  version numeric(15,0),<br/>  booking_date date,<br/>  change_date date,<br/>  hotel string,<br/>  number_of_passengers numeric(15,0),<br/>  revenue numeric(15,2),<br/>  valid_from_date date,<br/>  valid_to_date date,<br/>  current_record_flag string<br/>);<br/> <br/>CREATE TABLE [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>(<br/>  booking_id numeric,<br/>  version numeric(15,0),<br/>  booking_date date,<br/>  change_date date,<br/>  hotel string,<br/>  number_of_passengers numeric(15,0),<br/>  revenue numeric(15,2),<br/>  record_type string<br/>);<br/>  <br/>--Insert some test data in the source table<br/>INSERT INTO [YOUR_DATEBASE].[YOUR_SCHEMA].stage_table<br/>VALUES<br/>(987654,1,'2021-03-10', '2021-03-10', 'Alpha', 4, 1000),<br/>(987654,2,'2021-03-10', '2021-03-14', 'Alpha', 4, 1200),<br/>(987654,3,'2021-03-10', '2021-04-01', 'Bravo', 4, 1200),<br/>(987654,4,'2021-03-10', '2021-05-05', 'Charlie', 5, 1800)<br/>;<br/>  <br/>--Check the data<br/>SELECT * FROM [YOUR_DATEBASE].[YOUR_SCHEMA].stage_table ORDER BY 1;</span><span id="cc2c" class="mh kz in no b gy oe nt l nu nv">------------------------------<br/>--Load into the middle table as snapshots<br/>INSERT INTO [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table<br/>SELECT<br/>booking_id,<br/>version,<br/>booking_date,<br/>change_date,<br/>hotel,<br/>number_of_passengers,<br/>revenue,<br/>change_date AS valid_from_date,<br/>COALESCE(DATE_ADD(LEAD(change_date) OVER (PARTITION BY booking_id ORDER BY change_date ASC), INTERVAL -1 DAY), '2099-12-31') AS valid_to_date,<br/>CASE<br/>  WHEN change_date = MAX(change_date) OVER (PARTITION BY booking_id) THEN 'Y'<br/>  ELSE 'N'<br/>END AS current_reecord_flag <br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].stage_table<br/>;</span><span id="01c6" class="mh kz in no b gy oe nt l nu nv">--Check the data<br/>SELECT * from [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table order by version;</span><span id="de13" class="mh kz in no b gy oe nt l nu nv">--Load into the datamart table including contras<br/>--Note the LEAD function to apply the date of the new insert record to the contra<br/>--of the previous insert<br/>INSERT INTO [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>SELECT<br/>booking_id,<br/>version,<br/>booking_date,<br/>CASE<br/>    WHEN record_type = 'INSERT' THEN change_date<br/>    ELSE LEAD(change_date) over (partition by booking_id order by change_date)<br/>END AS change_date,<br/>hotel,<br/>number_of_passengers,<br/>revenue,<br/>record_type<br/>FROM<br/>(<br/>  SELECT<br/>  booking_id,<br/>  version,<br/>  booking_date,<br/>  change_date,<br/>  hotel,<br/>  number_of_passengers,<br/>  revenue,<br/>  'INSERT' AS record_type<br/>  FROM [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table<br/>  UNION ALL<br/>  SELECT<br/>  t.booking_id,<br/>  t.version,<br/>  t.booking_date,<br/>  t.change_date,<br/>  t.hotel,<br/>  t.number_of_passengers * -1 AS number_of_passengers,<br/>  t.revenue * -1 AS revenue,<br/>  'CONTRA' AS record_type<br/>  FROM [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table t<br/>  WHERE t.change_date &lt; (SELECT MAX(t2.change_date)<br/>                                     FROM [YOUR_DATEBASE].[YOUR_SCHEMA].middle_table t2<br/>                                     WHERE t.booking_id = t2.booking_id)<br/>);<br/>  <br/>--Check the data<br/>SELECT * from [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table order by version,record_type DESC;<br/>  <br/>--Run some reports<br/>--Report 1: Cumulative for the booking:<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>GROUP BY 1;<br/>  <br/>--Report 2: Net movement on 14-Mar:<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-03-14'<br/>GROUP BY 1;<br/>  <br/>--Report 3: Net movement on 1-Apr<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-04-01'<br/>AND hotel = 'Alpha'<br/>GROUP BY 1;<br/>  <br/>--Report 4: Net movement on 1-Apr by hotel<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-04-01'<br/>AND hotel = 'Bravo'<br/>GROUP BY 1;<br/>  <br/>--Report 5: Net movement on 1-Apr all<br/>SELECT<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-04-01';<br/>  <br/>--Report 6: Net movement on 5-May hotel Bravo<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-05-05'<br/>AND hotel = 'Bravo'<br/>GROUP BY 1;<br/>  <br/>--Report 7: Net movement on 5-May hotel Charlie<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-05-05'<br/>AND hotel = 'Charlie'<br/>GROUP BY 1;<br/>  <br/>--Report 8: Net movement on 5-May all<br/>SELECT<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date = '2021-05-05';<br/>  <br/>--Report 9: Net movement between 12-Mar and 20-Apr all<br/>SELECT<br/>hotel,<br/>SUM(number_of_passengers),<br/>SUM(revenue)<br/>FROM [YOUR_DATEBASE].[YOUR_SCHEMA].datamart_table<br/>WHERE change_date BETWEEN '2021-03-12' AND '2021-04-20'<br/>GROUP BY 1;<br/>  <br/>--Clean up<br/>DROP SCHEMA [YOUR_DATEBASE].[YOUR_SCHEMA] CASCADE;</span></pre></div></div>    
</body>
</html>