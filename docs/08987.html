<html>
<head>
<title>Python — Pendulum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 钟摆</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/python-pendulum-edb58510ee87?source=collection_archive---------2-----------------------#2022-07-23">https://blog.devgenius.io/python-pendulum-edb58510ee87?source=collection_archive---------2-----------------------#2022-07-23</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="01e9" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">Python 中一个新的日期时间模块</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/0942a454bdfc05fb356938fca8b9df08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOSiJmg723xSAZYVd_T64g.png"/></div></div></figure><p id="d660" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">关于数据处理，Python 提供了很多库，比如标准库<code class="fe lo lp lq lr b">datetime</code>、第三方库<code class="fe lo lp lq lr b">dateutil</code>、<code class="fe lo lp lq lr b">arrow</code>等等。</p><p id="cf80" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">在这篇文章中，我想介绍一下我个人最喜欢的库<code class="fe lo lp lq lr b">pendulum</code>，它使用起来非常方便，可以满足对日期的任何操作。</p><h1 id="8b87" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">为什么是钟摆？</h1><p id="4b5a" class="pw-post-body-paragraph ks kt ir ku b kv mk js kx ky ml jv la lb mm ld le lf mn lh li lj mo ll lm ln ik bi translated">原生的<code class="fe lo lp lq lr b">datetime</code>实例对于基本的情况来说已经足够了，但是当你面对更复杂的用例时，它们通常会显示出局限性，并且不那么直观。<code class="fe lo lp lq lr b">Pendulum</code>提供了一个更干净、更易于使用的 API，同时仍然依赖于标准库。所以还是<code class="fe lo lp lq lr b">datetime</code>但是更好。</p><blockquote class="mp mq mr"><p id="4172" class="ks kt ms ku b kv kw js kx ky kz jv la mt lc ld le mu lg lh li mv lk ll lm ln ik bi translated">与 Python 的其他<code class="fe lo lp lq lr b">datetime</code>库不同，Pendulum 是标准<code class="fe lo lp lq lr b">datetime</code>类的替代物(它继承了它)，所以，基本上，你可以用代码中的<code class="fe lo lp lq lr b">DateTime</code>实例替换所有的<code class="fe lo lp lq lr b">datetime</code>实例(使用<code class="fe lo lp lq lr b">type</code>函数检查对象类型的库存在例外，例如<code class="fe lo lp lq lr b">sqlite3</code>或<code class="fe lo lp lq lr b">PyMySQL</code>)。</p></blockquote><p id="4e40" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">它还去除了简单的<code class="fe lo lp lq lr b">datetimes</code>的概念:每个<code class="fe lo lp lq lr b">Pendulum</code>实例都是时区敏感的，并且默认在<code class="fe lo lp lq lr b">UTC</code>中，以便于使用。</p><p id="fb95" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><code class="fe lo lp lq lr b">Pendulum</code>还通过提供更直观的方法和属性改进了标准的<code class="fe lo lp lq lr b">timedelta</code>类。</p><h1 id="5d8d" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">装置</h1><p id="d04d" class="pw-post-body-paragraph ks kt ir ku b kv mk js kx ky ml jv la lb mm ld le lf mn lh li lj mo ll lm ln ik bi translated">使用前需要安装，直接 pip 安装钟摆即可。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="63bb" class="na lt ir lr b gz nb nc l nd ne">$ pip install pendulum <br/>Looking in indexes: <a class="ae nf" href="https://pypi.python.org/simple" rel="noopener ugc nofollow" target="_blank">https://pypi.python.org/simple</a><br/>Collecting pendulum<br/>  Downloading pendulum-2.1.2.tar.gz (81 kB)<br/>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 81.2/81.2 kB 4.1 MB/s eta 0:00:00<br/>  Installing build dependencies ... done<br/>  Getting requirements to build wheel ... done<br/>  Preparing metadata (pyproject.toml) ... done<br/>...<br/>Successfully installed pendulum-2.1.2 pytzdata-2020.1</span></pre><h1 id="3e8d" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">基本用法</h1><p id="853a" class="pw-post-body-paragraph ks kt ir ku b kv mk js kx ky ml jv la lb mm ld le lf mn lh li lj mo ll lm ln ik bi translated">我们来看看用法，首先是 datetime，date，time 的创建。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="b532" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt = pendulum.datetime(<br/>    2022, 7, 21, 20, 10, 30)<br/>print(dt.__class__)<br/>print(dt)<br/>"""<br/>&lt;class 'pendulum.datetime.DateTime'&gt;<br/>2022-07-21T20:10:30+00:00<br/>"""</span><span id="0eac" class="na lt ir lr b gz ng nc l nd ne"><em class="ms"># Change timezone</em><br/>dt = pendulum.datetime(<br/>    2022, 7, 21, 20, 10, 30, tz="xxxx/xxxx")<br/>print(dt)<br/>"""<br/>2022-07-21T20:10:30+08:00<br/>"""<br/><br/><em class="ms"># Create date</em><br/>d = pendulum.date(2022, 7, 21)<br/>print(d.__class__)<br/>print(d)<br/>"""<br/>&lt;class 'pendulum.date.Date'&gt;<br/>2022-07-21<br/>"""<br/><br/><em class="ms"># Create time</em><br/>t = pendulum.time(20, 10, 30)<br/>print(t.__class__)<br/>print(t)<br/>"""<br/>&lt;class 'pendulum.time.Time'&gt;<br/>20:10:30<br/>"""</span></pre><p id="e4e8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">如果创建了<code class="fe lo lp lq lr b">datetime</code>，时区默认为 UTC。如果不希望时区，或者希望时区是当地时区，那么<code class="fe lo lp lq lr b">pendulum</code>也具体提供了两种方法。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="9dca" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/><em class="ms"># Create datetime use local timezone</em><br/>dt = pendulum.local(<br/>    2022, 7, 21, 20, 10, 30)<br/>print(dt)<br/>"""<br/>2022-07-21T20:10:30+08:00<br/>"""<br/>print(pendulum.local_timezone())<br/>"""<br/>Timezone('xxxx/xxxx')<br/>"""<br/><br/><em class="ms"># Create datetime with no timezon<br/># tz is None</em><br/>dt = pendulum.naive(2022, 7, 21, 20, 10, 30)<br/>print(dt)<br/>"""<br/>2022-07-21T20:10:30<br/>"""</span></pre><p id="f2ef" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">然后<code class="fe lo lp lq lr b">pendulum</code>还提供了几种方法，比如创建当前日期时间，日期等等。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="c3a2" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/><br/>dt = pendulum.today()<br/>print(dt)<br/>"""<br/>2022-07-21T00:00:00+08:00<br/>"""<br/><br/><em class="ms"># Get tomorrow's date</em><br/>dt = pendulum.tomorrow()<br/>print(dt)<br/>"""<br/>2022-07-22T00:00:00+08:00<br/>"""<br/><br/><em class="ms"># Get yesterday's date</em><br/>dt = pendulum.yesterday()<br/>print(dt)<br/>"""<br/>2022-07-20T00:00:00+08:00<br/>"""</span></pre><p id="fbb6" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们还可以从时间戳或字符串创建:</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="2b43" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/><em class="ms"># Based on given timestamp</em><br/>dt1 = pendulum.from_timestamp(1653828466)<br/>dt2 = pendulum.from_timestamp(1653828466,<br/>                              tz=pendulum.local_timezone())<br/>print(dt1)<br/>print(dt2)<br/>"""<br/>2022-05-29T12:47:46+00:00<br/>2022-05-29T20:47:46+08:00<br/>"""<br/><br/><em class="ms"># Based on time string</em><br/>dt1 = pendulum.parse("2020-05-03 12:11:33")<br/>dt2 = pendulum.parse("2020-05-03 12:11:33",<br/>                     tz=pendulum.local_timezone())<br/>print(dt1)<br/>print(dt2)<br/>"""<br/>2020-05-03T12:11:33+00:00<br/>2020-05-03T12:11:33+08:00<br/>"""</span></pre><h1 id="60cf" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated"><strong class="ak">日期时间相关操作</strong></h1><p id="0f9a" class="pw-post-body-paragraph ks kt ir ku b kv mk js kx ky ml jv la lb mm ld le lf mn lh li lj mo ll lm ln ik bi translated">还有很多操作，我们就一一介绍了。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="f08d" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt = pendulum.local(<br/>    2022, 3, 28, 20, 10, 30)<br/><br/><em class="ms"># Get date and time</em><br/>print(dt.date())<br/>print(dt.time())<br/>"""<br/>2022-07-21<br/>20:10:30<br/>"""<br/><br/><em class="ms"># Replace and return new datetime</em><br/>print(dt.replace(year=9999))<br/>"""<br/>9999-03-28T20:10:30+08:00<br/>"""<br/><br/><em class="ms"># Convert to timestamp</em><br/>print(dt.timestamp())<br/>"""<br/>1648469430.0<br/>"""<br/><br/><em class="ms"># Return year, month, day...</em><br/>print(dt.year, dt.month, dt.day)<br/>print(dt.hour, dt.minute, dt.second)<br/>print(dt.tz)<br/>"""<br/>2022 3 28<br/>20 10 30<br/>Timezone('xxx/xxxx')<br/>"""</span></pre><p id="5c14" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">然后生成字符串，<code class="fe lo lp lq lr b">pendulum.DateTime</code>对象可以转换成各种格式的日期字符串。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="e860" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt = pendulum.local(<br/>    2022, 3, 28, 20, 10, 30)<br/><br/><em class="ms"># Most frequent uses</em><br/>print("datetime:", dt.to_datetime_string())<br/>print("date:", dt.to_date_string())<br/>print("time:", dt.to_time_string())<br/>print("iso8601:", dt.to_iso8601_string())<br/>"""<br/>datetime: 2022-03-28 20:10:30<br/>date: 2022-03-28<br/>time: 20:10:30<br/>iso8601: 2022-03-28T20:10:30+08:00<br/>"""</span><span id="48a4" class="na lt ir lr b gz ng nc l nd ne">print("atom:", dt.to_atom_string())<br/>print("rss:", dt.to_rss_string())<br/>print("w3c:", dt.to_w3c_string())<br/>print("cookie:", dt.to_cookie_string())<br/>print("rfc822:", dt.to_rfc822_string())<br/>"""<br/>atom: 2022-03-28T20:10:30+08:00<br/>rss: Mon, 28 Mar 2022 20:10:30 +0800<br/>w3c: 2022-03-28T20:10:30+08:00<br/>rfc822: Mon, 28 Mar 22 20:10:30 +0800<br/>"""</span></pre><p id="e572" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">有时候我们还需要判断当前日期是星期几，当前年份是星期几等等，<code class="fe lo lp lq lr b">pendulum</code>也为我们打包了。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="d15c" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt = pendulum.local(<br/>    2022, 3, 28, 20, 10, 30)<br/><br/><em class="ms"># Return days of week</em><br/>print(dt.isoweekday())  <em class="ms"># 1</em><br/><br/><em class="ms"># Return days of year</em><br/>print(dt.day_of_year)  <em class="ms"># 87</em><br/><br/><em class="ms"># Return days of month</em><br/>print(dt.days_in_month)  <em class="ms"># 31</em><br/><br/><em class="ms"># Return week of month</em><br/>print(dt.week_of_month)  <em class="ms"># 5</em><br/><br/><em class="ms"># Return week of year</em><br/>print(dt.week_of_year)  <em class="ms"># 13</em><br/><br/><em class="ms"># Check leap year</em><br/>print(dt.is_leap_year())  <em class="ms"># False</em></span></pre><p id="a1ab" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">最后是日期的操作，这是<code class="fe lo lp lq lr b">pendulum</code>最厉害的部分。</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="f02a" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt = pendulum.local(<br/>    2022, 7, 21, 20, 10, 30)<br/><br/><em class="ms"># Return next month today</em><br/>print(dt.add(months=1))<br/>"""<br/>2022-08-21T20:10:30+08:00<br/>"""<br/><br/><em class="ms"># Return last month today</em><br/>print(dt.add(months=-1))<br/>"""<br/>2022-06-21T20:10:30+08:00<br/>"""<br/></span></pre><p id="9774" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">像 Python 的内置模块<code class="fe lo lp lq lr b">datetime</code>，在添加日期的时候，最多支持天，我们无法计算下一周、下一个月、下一年的日期。<code class="fe lo lp lq lr b">pendulum</code>很好操控，这是我最喜欢的一点。</p><p id="fd4b" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">当然，add 中的值是正的，相当于日期倒退；值为负数，相当于将日期向前推。</p><p id="f39f" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">那么也可以减去两个日期:</p><pre class="kh ki kj kk gu mw lr mx my aw mz bi"><span id="a312" class="na lt ir lr b gz nb nc l nd ne">import pendulum<br/><br/>dt1 = pendulum.local(<br/>    2021, 1, 20, 11, 22, 33)<br/><br/>dt2 = pendulum.local(<br/>    2022, 3, 30, 20, 10, 30)<br/><br/>period = dt2 - dt1<br/><em class="ms"># Return Period object</em><br/><em class="ms"># Similar to timedelta in datetime</em><br/>print(period.__class__)<br/>"""<br/>&lt;class 'pendulum.period.Period'&gt;<br/>"""<br/><br/><br/>print(period.in_years())  <em class="ms"># 1</em><br/><br/>print(period.in_months())  <em class="ms"># 14</em><br/><br/>print(period.in_weeks())  <em class="ms"># 62</em><br/><br/>print(period.in_days())  <em class="ms"># 434</em><br/><br/>print(period.in_hours())  <em class="ms"># 10424</em><br/><br/>print(period.in_minutes())  <em class="ms"># 625487</em><br/><br/>print(period.in_seconds())  <em class="ms"># 37529277</em></span></pre><p id="b4cf" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">功能非常强大。Python 的<code class="fe lo lp lq lr b">datetime</code>模块中的<code class="fe lo lp lq lr b">timedelta</code>最多只能算出两个日期相差多少天，这里可以用年、月、日、时、分、秒。</p><p id="c3b3" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">当然<code class="fe lo lp lq lr b">pendulum</code>的功能不仅仅是我们上面说的那些。有兴趣可以参考<a class="ae nf" href="https://github.com/sdispater/pendulum" rel="noopener ugc nofollow" target="_blank">官网</a>，不过这些都是常用的东西。</p></div></div>    
</body>
</html>