<html>
<head>
<title>Gimbal Lock Explanation And How To Work With It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">万向节锁说明以及如何使用它</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gimbal-lock-explanation-and-how-to-work-with-it-3b61c0bac024?source=collection_archive---------2-----------------------#2022-04-19">https://blog.devgenius.io/gimbal-lock-explanation-and-how-to-work-with-it-3b61c0bac024?source=collection_archive---------2-----------------------#2022-04-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="98bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在过去的两周里，我一直在用 JavaScript 开发一个增强现实项目，来制作一个手机上的 WebAR 应用程序。</p><p id="b4de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当谈到增强现实时，3D 模型的呈现和与它们的交互同样重要。想起最具标志性的 AR 游戏之一——pokémon GO 及其玩法。</p><p id="aa10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我将展示我如何将 3D 模型与从设备硬件中检索的传感器数据相结合，以及我遇到的障碍，并最终展示我是如何解决它们的。</p><p id="dd58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们开始吧，好吗？</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><h1 id="6589" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">先把工具磨好</strong></h1><p id="7b25" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">以下是我的工作工具:</p><ol class=""><li id="aa2b" class="ls lt in jm b jn jo jr js jv lu jz lv kd lw kh lx ly lz ma bi translated">iOS 版本 14.8.1 的 iPhone 12 Pro。</li><li id="21bb" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">在我的 iPhone 上安装最新版本的 Safari 和 Chrome 应用程序。</li><li id="ff51" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">THREE.js r139，这是撰写本文时 THREE.js 的最新版本。</li><li id="1d04" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">带有 HTTPS 的 Node.js 服务器。</li></ol><p id="d583" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第四点是必不可少的，我稍后会解释。如果您没有 SSL 服务器，您仍然可以在本地设置一个自签名服务器。</p><p id="d8cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">版本并不重要。让一切保持最新，在这样的环境中发展总是很棒的。</p><h1 id="a70a" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated"><strong class="ak">坚持计划</strong></h1><p id="4bb9" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">我不打算讨论我项目中的所有细节。假设我已经加载了一个 3D 模型，现在我想让它在我的设备移动时以某种方式移动。</p><p id="8303" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我想实现的一个交互是，例如，在纵向模式下，当我的 iPhone 向左旋转时，我应该能够看到我的模型的右侧，反之亦然。这是 AR 项目中的基本交互之一。</p><p id="18d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就像神奇宝贝 Go 一样。在 AR 模式下，当你遇到皮卡丘时，你可以通过旋转相机来查看它的全身。如下图 gif 所示。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a2a6214c6400d8a895b23e0d31824720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/1*b1L3XiUt8BY9V-kQMm_hNQ.gif"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">妮可·阮/ BuzzFeed 新闻</figcaption></figure><h1 id="67d5" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">设备方向数据</h1><p id="dcec" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">AR 交互的概念很简单:在我的设备上获取传感器数据，并用这些数据旋转/平移/缩放我的模型。问题中的传感器是— <strong class="jm io">陀螺仪。</strong></p><p id="c948" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有许多关于陀螺仪的信息资源。请记住,<strong class="jm io"> alpha、beta 和 gamma </strong>值正是我想要的。</p><p id="4fbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">至于现代 web APIs，我选择了<code class="fe my mz na nb b">window.DeviceOrientationEvent</code>来获取这些数据。</p><p id="11f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">记得我提到过 SSL 服务器是必要的吗？这是因为 Chrome 等浏览器出于安全考虑只通过 HTTPS 提供<code class="fe my mz na nb b">window.DeviceOrientationEvent</code>。</p><p id="90a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae nc" href="https://web.dev/native-hardware-device-orientation/" rel="noopener ugc nofollow" target="_blank">这里</a>是关于设备定向及其 Web API 的快速解释。有趣的一点是，在人像模式下，alpha，beta，gamma 分别默认为 0，90，0。</p><h1 id="46b0" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">万向节锁问题</h1><p id="a86f" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">在我们进入下一步之前，让我们先谈谈万向节锁。</p><p id="ddbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据维基百科:</p><blockquote class="nd"><p id="07d2" class="ne nf in bd ng nh ni nj nk nl nm kh dk translated">万向节锁是在三维空间中失去一个自由度，…</p></blockquote><p id="415e" class="pw-post-body-paragraph jk jl in jm b jn nn jp jq jr no jt ju jv np jx jy jz nq kb kc kd nr kf kg kh ig bi translated">简单地说，当某些轴发生旋转时，一个轴可能会与另一个轴重叠。因此导致一维损失。如下图所示。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/6c6f2e4bd508002c62cf04813f5fbb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oQoFLI2FRTkAx7DqyvVW7A.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">正常的三万向节组</figcaption></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nx"><img src="../Images/97d4e8891189548b04b37426c4d0dcdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2m-hfa1e5vzdaHoG8HWmZQ.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">当两个万向节在同一平面上时，就会发生万向节锁。因此，失去了一个维度</figcaption></figure><h1 id="d699" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">为什么万向节锁很重要？</h1><p id="19c5" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">为什么从陀螺仪中检索数据很重要？</p><p id="ea38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">答案是——陀螺仪的设计将通过改变一个可能与旋转框架重叠的框架上的值来防止框架锁定的发生。</p><p id="a348" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以上面的万向锁图示为例。绿色和蓝色平面重叠并导致锁定。实际上，当旋转绿色平面时，<strong class="jm io">陀螺仪会将蓝色平面偏移一个特定的值，或者将平面改变到相反的方向，</strong>例如立刻从 90 度到-90 度。</p><p id="5767" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以这很重要。第一种情况意味着当我从左向右旋转我的设备时，我的模型也可能从上到下旋转，即使我没有以这种方式旋转我的设备。</p><p id="9851" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">至于第二个，它表明我的模型将突然旋转到一个完全相反的方向。</p><p id="0567" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些都不是理想的情况。</p><h1 id="dcb8" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated"><strong class="ak">还有更多关于陀螺仪的数据</strong></h1><p id="ff7b" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">到目前为止，我们了解陀螺仪如何处理万向节锁。但是关于它的数据还有一件事。</p><p id="d8e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">阿尔法，贝塔，伽马值是<strong class="jm io">而不是我们沿着特定轴旋转的角度。相反，它是相对于任意角度的角度变化，取决于默认的方向。</strong></p><p id="f4fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下声明引自 W3C，完整链接在最后一节提供。</p><blockquote class="nd"><p id="40f3" class="ne nf in bd ng nh ni nj nk nl nm kh dk translated">deviceorientation 事件仅基于加速度计和陀螺仪，尝试提供三个角度的相对值(相对于某个任意方向)。</p></blockquote><p id="36b6" class="pw-post-body-paragraph jk jl in jm b jn nn jp jq jr no jt ju jv np jx jy jz nq kb kc kd nr kf kg kh ig bi translated">例如，我的 gamma 值默认为 0，因为我的设备处于纵向模式。当我沿着它的轴旋转时，gamma 值随着我旋转的角度而增加。然而，这样的<strong class="jm io"> delta 是相对于 0 度的，而不是我实际上沿着轴旋转了多少。</strong></p><p id="f8ba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的例子听起来晦涩难懂。让我们想到万向节锁。我提到过，为了防止这种情况发生，陀螺仪会相应地将一个轴改变到相反的方向。</p><p id="d242" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，当我旋转伽马轴时，为了防止万向锁定，β值可能会突然从 90°变到-90°，并且因为β值相对于开始方向是<strong class="jm io">，所以从 90°变到-90°被认为是一个完整的旋转，并且我的模型突然以顺时针运动旋转。</strong></p><p id="79ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">简单地说:当我从上到下旋转我的设备时，我的模型将同时从左向右旋转。当 gamma 值达到极限时，突然，我的模型从右向左旋转，并停在它开始旋转的位置。</p><h1 id="9921" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">我如何使用陀螺仪</h1><p id="f75d" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">我想分两部分讨论如何使用陀螺仪。</p><ol class=""><li id="3cbf" class="ls lt in jm b jn jo jr js jv lu jz lv kd lw kh lx ly lz ma bi translated">如何正确解读α、β、γ值？</li><li id="c424" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">如何抵消陀螺仪给静态平面带来的变化？</li></ol><h1 id="f90e" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">旋转矩阵</h1><p id="055f" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">第一部分需要一些基本的数学知识——我使用旋转矩阵来描述α、β和γ值。潜在的数学解释是最后一节的第四个环节。旋转矩阵如下所示:</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ny"><img src="../Images/5a04ebcc75682553dbac03d8985306ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qfmRFsWgfeCO74zpyxw3ZQ.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">来自维基百科的旋转矩阵图像</figcaption></figure><p id="c2df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">旋转矩阵描述了在给定的坐标系中旋转是如何沿着轴发生的。除此之外，借助三角函数，我们可以很容易地获得每个轴的角度。</p><p id="348d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第二部分需要从第一部分获得的角度。例如，假设旋转β角为 X，γ角为 y，现在我们知道陀螺仪会改变静态平面，导致意外的角度变化。</p><p id="dc24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，当我获得 Y 角度时，陀螺仪对β贡献了 X '角度。所以我必须根据方向，加上或减去 X 的值，以使β旋转正常。</p><h1 id="bd4c" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated">结论</h1><p id="4db2" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">我最初项目的目标是创建一个 WebAR 应用程序。但事实证明这比我想象的要复杂得多。</p><p id="a83d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从启用传感器许可、收集和分析来自传感器的数据到将这些数据与我的 3D 模型集成。这个想法很简单，但是这些步骤都不容易实现。</p><p id="80d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，我一开始使用 beta 值来模拟从左到右的旋转，但由于万向节锁防止机制和对设备定向事件的误解，我的模型变得疯狂。</p><p id="e1f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望这篇文章可以帮助那些想开发类似项目的人。</p><h1 id="2be4" class="kp kq in bd kr ks mg ku kv kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm bi translated"><strong class="ak">参考</strong></h1><ol class=""><li id="edf4" class="ls lt in jm b jn ln jr lo jv nz jz oa kd ob kh lx ly lz ma bi translated">https://web.dev/native-hardware-device-orientation/<a class="ae nc" href="https://web.dev/native-hardware-device-orientation/" rel="noopener ugc nofollow" target="_blank"/></li><li id="6773" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated">【https://en.wikipedia.org/wiki/Gimbal_lock T4】</li><li id="fdd0" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae nc" href="https://w3c.github.io/deviceorientation/#ref-for-dom-deviceorientationevent-beta%E2%91%A1" rel="noopener ugc nofollow" target="_blank">https://W3C . github . io/device orientation/# ref-for-DOM-deviceorientionevent-beta % E2 % 91% A1</a></li><li id="aad9" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae nc" href="https://stackoverflow.com/questions/36639182/html5-get-device-orientation-rotation-in-relative-coordinate" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/36639182/html 5-get-device-orientation-rotation-in-relative-coordinate</a></li><li id="abe5" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae nc" href="https://flaviocopes.com/express-https-self-signed-certificate/" rel="noopener ugc nofollow" target="_blank">https://flavio copes . com/express-https-自签名-证书/ </a></li></ol></div></div>    
</body>
</html>