<html>
<head>
<title>SwiftUI Tutorial: Create Child Views with ViewBuilder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI 教程:使用 ViewBuilder 创建子视图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/swiftui-tutorial-create-child-views-with-viewbuilder-e1ee5a312271?source=collection_archive---------3-----------------------#2022-12-21">https://blog.devgenius.io/swiftui-tutorial-create-child-views-with-viewbuilder-e1ee5a312271?source=collection_archive---------3-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8a0d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何用 ViewBuilder 在 SwiftUI 中构建可重用组件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a589761920bc2bd567144d033089f39c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aV4AeI-wfhPVFtnbF4SLlQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图一。</figcaption></figure><p id="241b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated"><span class="l ls lt lu bm lv lw lx ly lz di"> S </span> wiftUI ViewBuilder 是一款帮助你在用户界面中构建和组织视图或可视元素的工具。它允许您创建视图的层次结构，其中一个视图作为其他视图的父视图，称为子视图。ViewBuilder 通常用于在 SwiftUI 中创建可重用的组件，这些组件是可以在一个应用程序中多次使用的视图组。要使用 ViewBuilder，您需要定义一个返回一个或多个视图的函数或闭包，然后您可以使用该函数或闭包来构建您的用户界面，方法是调用它并将结果视图添加到您的布局中。ViewBuilder 允许您轻松定义和重用组件，从而简化了创建复杂布局和视图层次的过程。</p><p id="4904" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要声明一个 ViewBuilder，您必须用<code class="fe ma mb mc md b">@ViewBuilder</code>包装属性或函数，如下例所示:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="1afc" class="mi mj iq md b be mk ml l mm mn">// Property example<br/>@ViewBuilder var content: () -&gt; Content<br/><br/>// Function(method) example<br/>@ViewBuilder private func mainView() -&gt; some View {}<br/><br/>// Some prefer this format to be cleaner for function(method)<br/>@ViewBuilder <br/>private func mainView() -&gt; some View {}</span></pre><h1 id="a088" class="mo mj iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">在函数中使用 ViewBuilder</h1><p id="aee5" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">在 SwiftUI 中编写<a class="ae nk" rel="noopener ugc nofollow" target="_blank" href="/5-best-practices-for-writing-clean-code-be1a5095eae5">干净代码</a>的一个好习惯是将视图分成更小的函数。用 ViewBuilder 包装这些函数可以进一步提高代码的组织性和可读性。这里有一个例子:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="ccd4" class="mi mj iq md b be mk ml l mm mn">struct ContentView: View {<br/><br/>    var body: some View {<br/>        VStack(spacing: 25) {<br/>            sfSymbolWithLabel("person.fill")<br/>            sfSymbolWithLabel("house.fill")<br/>        }<br/>    }<br/>    <br/>    @ViewBuilder<br/>    private func sfSymbolWithLabel(_ name: String) -&gt; some View {<br/>        HStack {<br/>            Group {<br/>                Image(systemName: name)<br/>                Text(name)<br/>            }<br/>            .font(.system(size: 30))<br/>            .foregroundColor(.blue)<br/>        }<br/>    }<br/><br/>} // ContentView</span></pre><p id="98ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该示例演示了如何使用 ViewBuilder 创建一个返回视图协议的函数。</p><h1 id="6d04" class="mo mj iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">SwiftUI:在属性中存储视图</h1><p id="37a3" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">下面是如何在 struct 属性中存储 SwiftUI 视图。这一次，我们将利用 ViewBuilder 创建一个可重用的 SwiftUI 视图。这意味着我们将定义一个返回视图的结构，并使用 ViewBuilder 包装组成视图的各种组件。</p><p id="046d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，我们将创建一个可重用的 SwiftUI 视图，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/730e60010ed63bfb8aba6b511ee24f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*GtdsouMHlXnOmTkRCtPSzA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图二。可重用视图</figcaption></figure><p id="b264" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个例子中，矩形视图和右边的箭头图像是固定的元素。但是您可以在左侧包含任何类型的视图。</p><p id="388c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先创建一个这样的结构:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="f66f" class="mi mj iq md b be mk ml l mm mn">struct SelectionItem&lt;Content: View&gt;: View {<br/>    <br/>}</span></pre><p id="2883" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还必须使用一个<a class="ae nk" href="https://medium.com/dev-genius/swift-programming-tutorial-generics-d0ea4dd94574" rel="noopener">泛型</a>约束来告诉 struct 它接受任何符合视图协议的类型。</p><blockquote class="nm nn no"><p id="e276" class="kv kw np kx b ky kz jr la lb lc ju ld nq lf lg lh nr lj lk ll ns ln lo lp lq ij bi translated"><strong class="kx ir">注意:</strong>在定义符合视图协议的通用类型时，内容通常是一个标准的命名约定。但是它可以用任何其他有效的标识符来替换。</p></blockquote><p id="367b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在创建的结构中，添加一个我们声明的泛型数据类型的新属性，并用 ViewBuilder 包装它，如下所示:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="7502" class="mi mj iq md b be mk ml l mm mn">@ViewBuilder var content: () -&gt; Content</span></pre><p id="bc9f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将对视图的主体进行编码。我们将创建一个<a class="ae nk" href="https://medium.com/better-programming/swiftui-tutorial-working-with-stacks-vstack-hstack-and-zstack-2b0070be18d7" rel="noopener"> HStack </a>并设置任何必要的修饰符。代码如下:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="32f7" class="mi mj iq md b be mk ml l mm mn">var body: some View {<br/>    HStack {<br/><br/>    }<br/>    .frame(height: 60)<br/>    .frame(maxWidth: .infinity)<br/>    .background(Color.white)<br/>    .border(.black)<br/>    .shadow(radius: 5)<br/>    .padding()<br/>}</span></pre><p id="9a42" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们在这里创建的是一个带有边框和阴影效果的白色矩形。</p><p id="c880" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们在 HStack 中添加内容之前，我们将首先为箭头创建一个单独的函数。将此代码写在正文下面:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="a2f4" class="mi mj iq md b be mk ml l mm mn">@ViewBuilder<br/>private func arrowToRight() -&gt; some View {<br/>    Image(systemName: "arrow.right")<br/>        .font(.system(size: 25))<br/>        .foregroundColor(.black)<br/>        .padding()<br/>}</span></pre><p id="f3c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这只是一个简单的系统<a class="ae nk" href="https://medium.com/dev-genius/swiftui-tutorial-displaying-system-image-with-sf-symbols-75c01b5bf421" rel="noopener">图像</a>，我们将把它放在 HStack 里面。</p><p id="5e53" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将回到 HStack 内容的编码。从左到右，我们将首先放置 content 属性，随后是一个分隔符()以适当的对齐方式分隔两个视图，然后是 arrowToRight 函数。在 HStack 中编写以下代码:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="9c7f" class="mi mj iq md b be mk ml l mm mn">content().padding()<br/>Spacer()<br/>arrowToRight()</span></pre><p id="16c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你迷路了，这里有完整的源代码。</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="7577" class="mi mj iq md b be mk ml l mm mn">struct SelectionItem&lt;Content: View&gt;: View {<br/>    <br/>    @ViewBuilder var content: () -&gt; Content<br/>    <br/>    var body: some View {<br/>        HStack {<br/>            content().padding()<br/>            Spacer()<br/>            arrowToRight()<br/>        }<br/>        .frame(height: 60)<br/>        .frame(maxWidth: .infinity)<br/>        .background(Color.white)<br/>        .border(.black)<br/>        .shadow(radius: 5)<br/>        .padding()<br/>    }<br/>    <br/>    @ViewBuilder<br/>    private func arrowToRight() -&gt; some View {<br/>        Image(systemName: "arrow.right")<br/>            .font(.system(size: 25))<br/>            .foregroundColor(.black)<br/>            .padding()<br/>    }<br/>    <br/>}</span></pre><p id="dc15" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经创建了可重用的 SwiftUI 视图，我们可以在主视图中使用它。例如，如果您正在使用内容视图，您可以按如下方式编辑它:</p><pre class="kg kh ki kj gt me md mf bn mg mh bi"><span id="cf65" class="mi mj iq md b be mk ml l mm mn">struct ContentView: View {<br/><br/>    var body: some View {<br/>        VStack(spacing: 0) {<br/>            SelectionItem {<br/>                Text("You can place any View here.")<br/>            }<br/>            SelectionItem {<br/>                VStack {<br/>                    Text("You can place")<br/>                    Text("any View here.")<br/>                }<br/>            }<br/>            SelectionItem {<br/>                HStack {<br/>                    Group {<br/>                        Image(systemName: "sunrise")<br/>                        Image(systemName: "sun.max")<br/>                        Image(systemName: "sunset")<br/>                    }<br/>                    .font(.system(size: 25))<br/>                }<br/>            }<br/>        }<br/>    }<br/><br/>} // ContentView</span></pre><p id="1b1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是时候测试我们的代码了。当您运行它时，视图应该类似于图 3 所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/6b7713aee26012b7c871c0635e1dce84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*b9PP1xtiRiRe_w2wlGsd5A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图 3。重用选择项</figcaption></figure><p id="d73f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里是 GitHub <a class="ae nk" href="https://github.com/athurion/SwiftUI-Tutorial-Create-Child-Views-with-ViewBuilder/blob/main/ContentViewViewBuilder.swift" rel="noopener ugc nofollow" target="_blank">链接</a>这部分教程的源代码。</p><h1 id="e3b5" class="mo mj iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">不带 ViewBuilder</h1><p id="6571" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">您可能想知道不使用 ViewBuilder 是否也能达到同样的效果。理论上，这是可能的，但是这种方法有一些缺点。具体来说，如果不使用 ViewBuilder，您可能需要手动创建和组合函数中的各个视图。下面是一个简单的截图示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/42670e0ff0639eb4c2201e5272fed16f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGK2NISsbmVfAuG1-tyZxA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图 4。不使用 ViewBuilder</figcaption></figure><p id="a6ce" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然有多种方法可以解决这个错误，比如将代码嵌入到一个<a class="ae nk" href="https://medium.com/geekculture/swiftui-tutorial-working-with-group-58aace3addda" rel="noopener">组</a>视图中或者添加<code class="fe ma mb mc md b">return</code>。首先使用<code class="fe ma mb mc md b">ViewBuilder</code>可以防止这种错误发生。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="8642" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">愿法典与你同在，</p><p id="a199" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">-电弧</p></div></div>    
</body>
</html>