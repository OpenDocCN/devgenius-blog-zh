<html>
<head>
<title>Setting up a Private Subnet in your VPC and logging into it from your Bastion Host</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在您的VPC中设置一个专用子网，并从您的Bastion主机登录</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-up-a-private-subnet-in-your-vpc-and-logging-into-it-from-your-bastion-host-b64a8d2b290a?source=collection_archive---------3-----------------------#2021-03-14">https://blog.devgenius.io/setting-up-a-private-subnet-in-your-vpc-and-logging-into-it-from-your-bastion-host-b64a8d2b290a?source=collection_archive---------3-----------------------#2021-03-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eb257927ecf8b436cfef99933930292d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ewkrE29ICk0bcsjdHNkxA.png"/></div></div></figure><p id="6588" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完成本实验需要什么？如何配置的基本知识:</p><ol class=""><li id="ef05" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">免费的AWS帐户</li><li id="cfcc" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">VPC</li><li id="74b0" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">子网</li><li id="e536" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">EC2实例和这些实例的安全组</li><li id="42ff" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">以及对使用CLI的基本理解，在本实验中，CLI是MacOS上的终端，但您可以使用任何适合您的CLI</li></ol><p id="1cae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">提示-只使用AWS帐户中提供的免费服务，这样你就不必为学习AWS支付任何费用。从错误中学习(这将是整个实验的共同主题)。</p><p id="1c73" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">什么是VPC？简而言之，VPC(虚拟私有云)是一个专用网络，您设计它来托管您的资源。它基本上取代了您自己的数据中心所需的传统网络，同时还增加了AWS可扩展基础架构的优势。</p><p id="5e40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">什么是子网？子网是IP网络的一部分。将网络分成两个不同的部分(如私有部分和公有部分)的做法称为子网划分或简称子网划分。这样做的好处是让您的VPC更加安全。您可以允许互联网通过您的公共子网访问您的计算机，同时仍然不让互联网访问您的私有子网。</p><p id="dcc6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">什么是EC2实例？为什么安全组对本实验很重要？简而言之，EC2实例本质上是运行在AWS云中的专用虚拟机。创建这个服务器是为了在AWS基础设施中运行应用程序。EC2是很好的资源，因为它们在云中提供了安全的、可调整大小的计算能力。在这个实验室中，我们将坚持使用T2微处理器，这样我们就可以避免运行EC2时被收费。免费总是好的，对吗？就安全组而言，定义就在名称中。安全组本质上允许您以您希望的方式保护您的EC2。如果你愿意，你可以让它访问互联网，访问SSH，选择你想让它在哪个端口上访问等等。选择完全取决于你。对于本实验，您必须允许您的私有EC2和公共EC2位于同一个安全组中，以便能够访问它们。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/5292c49e698d5654c69c39e3429c0430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sY86rikM-eUZhVGeLLoIiw.png"/></div></div></figure><p id="2cde" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们要做的第一件事是使用搜索栏浏览AWS控制面板，并查找“VPC”。对于本实验的其余部分，我强烈建议您使用搜索栏来查找资源，以加快速度。选择橙色按钮“创建VPC”，你的下一个屏幕应该与我的下一个相匹配。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/7cd58de4256f59536d424e910dee349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CcGn2MOV0-jeewfolHODHQ.png"/></div></div></figure><p id="4aab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本实验中，我选择了带有一个公共子网的默认VPC，并选择了“Select”。回想起来，我本可以做些什么来缩短我的时间是选择“VPC与公共和私人子网”。你会从我的错误中吸取教训，希望能防止你犯同样的错误，花费更多不必要的时间。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/ae26b5fb63a45dbaf37413070b67fdde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXi61Bu0tBBTXdlVzBzKyQ.png"/></div></div></figure><p id="8691" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下一步是为您的VPC选择一个CIDR数据块IP范围。我选择了10.0.0.0/16来关注我的项目。下一步是为您的公共子网选择一个CIDR块IP范围。我选了10.0.1.0/24。我将其余的设置保留为默认选项。还有，别忘了给你的VPC起名。如果你有多种VPC症，这可以让你更容易确定你需要哪一种。一旦你完成了，返回并点击右下角的蓝色“创建VPC”来完全启动它。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/614f64340ba39a3d24687f895019867e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYtuNhhxmFS78eFxNNPUqw.png"/></div></div></figure><p id="905f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我做的下一件事是返回并创建我的私有子网。我不得不点击VPC仪表板左侧的“子网”链接。如果我一开始就选择创建一个既有私有子网又有公共子网的VPC，我就可以跳过这一步。从我的错误中吸取教训。对于这个项目，我选择了一个10.0.2.0/24的CIDR块，并选择在与我的VPC的其余部分相同的可用性区域中启动它，以便我可以将这个私有子网添加到它。此外，不要忘记命名这个子网，以便您能够轻松区分您的私有子网和公共子网。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/9b085577adf6460dadd77cecb1efcc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60upIH3NRVmZ4IGg-Brmsg.png"/></div></div></figure><p id="8136" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下一步是创建EC2实例的。确保将这些与您已经创建的VPC相关联。我选择推出免费层AMI，并使用T2微我的EC2。请记住，EC2是按秒收费的，所以使用免费层将阻止你打开钱包支付AWS只是为了学习它。再次，从我的错误中吸取教训。配置EC2时，请确保将其与您的专用子网相关联，并启用自动分配公共IP。其余设置保留为默认设置。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/69f9d45dbf468582110b4c5dec9fb994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8uDICkKcv_DfzEw9fesunA.png"/></div></div></figure><p id="6e32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下一步是配置您的安全组。我选择此时只提供对SSH的访问，因为我已经知道我必须使用CLI通过我的Bastion主机(公共子网)访问我的私有子网。稍后您将在实验中看到，我不得不回来重新配置我的安全组，以便它们能够相互交流。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/48df7165451289dc37c9c9a4142dea29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBBjJtn7a-8NKdkGIKokDQ.png"/></div></div></figure><p id="b2de" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这一步至关重要。请确保下载密钥对并将其存储在安全的地方。几周前，当配置EC2时，我得到了惨痛的教训，由于不知道密钥对存储在哪里，我不得不删除它并创建一个新的。随着我们在本实验中的进展，您将看到会有许多尝试和错误，但是还有什么更好的学习方法呢？现在，我在Mac上创建了一个单独的文件夹来存储密钥对，我可以通过CLI访问这些密钥对。稍后你会看到更多。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/106f72ebc50a66652be1b279bfe5ec86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBv7N7Qq3kbXZ5beUL0j6g.png"/></div></div></figure><p id="55a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建私有子网的实例后，我必须创建公共子网的实例，并在设置中将它与我的VPC和公共子网相关联。我还确保这个实例与我的前一个实例共享相同的密钥对。从现在开始，这个公共实例将被称为“堡垒主机”。堡垒主机是一种服务器，其目的是提供从外部网络(如互联网)到专用网络的访问。由于面临潜在的攻击，堡垒主机必须最大限度地减少被渗透的机会。现在我已经有了AWS的定义，用更简单的术语来说，Bastions只是让您从公共网络访问私有网络。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/d859cb4383c66dbb6b5387e2f7afb7e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hj6GCOenRNpzWfe6_R2DRg.png"/></div></div></figure><p id="2309" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我的两个EC2实例都是活动的，我返回到这两个实例的安全组，并将它们放在我为VPC创建的同一个安全组中，以便它们可以相互通信。同样，如果我在最初创建EC2实例时这样做，我可以跳过这一步。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/fd6c14ce1c05d2699415e29032dab342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O6coTggzJzqICxZi6nTpqQ.png"/></div></div></figure><p id="5c25" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在通过AWS控制台配置了VPC之后，EC2实例正在运行，并且一切都已正确配置，可以相互通信，现在可以通过CLI访问它们了。进入此页面需要执行的步骤如下:1)单击您想要访问的实例(2)单击显示“连接”的橙色按钮(3)在弹出窗口中，单击“SSH”并按照说明验证您是否可以通过CLI访问EC2实例。确保使用命令CD (Change Directory)将您在EC2实例的配置过程结束时下载的密钥对存储到任何文件夹中。一旦到达那里，您可以使用命令LS (list)来验证您的密钥对确实在该目录中。一旦您验证了这一点，您只需突出显示该示例，并将其放入您的CLI中。然后，它会询问您是否确定要继续连接，您将发送“是”,您的用户将更改为EC2的名称，让您知道您已成功连接。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lh"><img src="../Images/b972bcb670440e646810df16495e7c88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WDmmD4Ydjsn7Q0-3L6tDvw.png"/></div></div></figure><p id="3c3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我验证了我的EC2实例能够通过CLI访问之后，我重新启动了我的终端，准备使用SSH代理，这是通过Bastion主机访问您的私有子网时非常重要的一步。SSH代理是一个助手程序，它跟踪用户的身份密钥和密码。然后，代理可以使用这些密钥登录到其他服务器，而无需用户再次键入密码或口令。这一步对于进入你的私有子网至关重要。重新启动终端后，将CD放回存储密钥对的文件夹中。然后运行命令“ssh-agent bash ”,它将加载ssh代理，允许您在其中存储您的密钥对。然后运行命令“ssh-agent add”和您的密钥对的名称。代理应返回密钥已添加到您的代理中。然后，我运行“ssh-agent -l”来列出添加的密钥对，以验证它确实存储在代理中。当我还在SSH代理中时，我运行了命令“ssh -A ec2-user@ <insert your="" public="" ip="" address="" for="" bastion="" host="">”,它返回了图表，让我知道我已经成功地连接到了我的bastion主机。然后，我运行相同的命令，除了在“@”符号后使用我的私有IP地址连接到我的私有地址，也成功返回。至此，我已经通过我的Bastion主机成功连接到我的私有子网。</insert></p><p id="f019" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我的实验到此结束，感谢您花时间阅读。希望它很容易理解和遵循。我对你能给出的任何反馈都持开放态度。这个实验是一个反复试验的过程，但是就像我之前说的，这是最好的学习方式。</p></div></div>    
</body>
</html>