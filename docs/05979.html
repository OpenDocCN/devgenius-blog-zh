<html>
<head>
<title>Try-with-resources in Java can have more than one resource</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java中的Try-with-resources可以有多个资源</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/try-with-resources-in-java-can-have-more-than-one-resource-5f832de4e9a6?source=collection_archive---------3-----------------------#2021-11-30">https://blog.devgenius.io/try-with-resources-in-java-can-have-more-than-one-resource-5f832de4e9a6?source=collection_archive---------3-----------------------#2021-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c4e91c3e0b6408202ee4e0c57c887c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hpYWQlRxDaKyAKRr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@chris_chow?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">周隼</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="7e59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它就在名字里:resources，复数，不是单数。这种罕见的Java分号推理导致人们忘记或者没有意识到，Java中的Try-with-resources语句可以有多个资源。</p><p id="73ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们回顾一下更常用的单一资源语句，以及它现在已经基本上取代的旧用法。旧用法大致如下:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="7b68" class="lk ll iq lg b gy lm ln l lo lp">SomeResource resource;<br/>try {<br/>    resource = new SomeResource(param);<br/>    // TODO: Use the resource<br/>} catch (Exception e) {<br/>    // TODO: Replace with more specific exception<br/>} finally {<br/>    resource.close();<br/>}</span></pre><p id="7b83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以把它改写成</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3867" class="lk ll iq lg b gy lm ln l lo lp">try (SomeResource resource = new SomeResource(param)) {<br/>    // TODO: Use the resource<br/>} catch (Exception e) {<br/>    // TODO: Replace with more specific exception<br/>}</span></pre><p id="e516" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果实例化或使用资源会导致检查异常，那么Catch块可能仍然是必要的，否则您需要更早地放入Throws子句。如果最终只关闭了一个资源而没有做任何其他事情，那么它现在肯定是不必要的。</p><p id="a62f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，从控制台获取用户输入的<code class="fe lq lr ls lg b">Scanner</code>资源，正如它更常用的那样，不会抛出异常，不管是检查的还是未检查的。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="00be" class="lk ll iq lg b gy lm ln l lo lp">Scanner input = new Scanner(System.in);<br/>// TODO: Get user input on something or other<br/>input.close();</span></pre><p id="d265" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的集成开发环境(IDE)可能会为您提供改变资源的方法。如果您接受IDE的建议，IDE会将上述内容更改为以下内容:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="93a3" class="lk ll iq lg b gy lm ln l lo lp">try (Scanner input = new Scanner(System.in)) {<br/>    // TODO: Get user input on something or other<br/>}</span></pre><p id="f3e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不用写<code class="fe lq lr ls lg b">input.close()</code>。编译器会为你进行调用。最终，您可能会养成立即自己编写单一资源语句的习惯。</p><p id="d046" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感觉没什么大不了的。在这个<code class="fe lq lr ls lg b">Scanner</code>的用例中，它没有为我们节省任何行。在最好的情况下，它会使IDE少发出一个警告。</p><p id="5bf4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果您需要两个或更多相关的资源，并且这些资源会抛出异常，那么多资源语句可以帮助您用更少的行更清晰地完成相同的目标。</p><p id="c4f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我正在为一个文件选择器编写测试。我想在每次测试运行后看到测试文件的内容，我认为我需要一个<code class="fe lq lr ls lg b">FileReader</code>和一个<code class="fe lq lr ls lg b">Scanner</code>来完成这个任务。所以我在测试课上写了这个:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="5cdf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据Joost Visser等人在<em class="lv">构建可维护软件:Java版</em>中的指导方针，我们应该努力将<code class="fe lq lr ls lg b">printFile()</code>减少到15行或更少。我们应该通过真正的削减来做到这一点，而不是把我们通常放在多行上的东西放在一行上。</p><p id="03e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我最近才意识到一个<code class="fe lq lr ls lg b">Scanner</code>可以带一个<code class="fe lq lr ls lg b">File</code>。这意味着我可以将其重构为单资源语句，然后我可以删除<code class="fe lq lr ls lg b">IOException</code>的Catch子句，因为只有它的子类<code class="fe lq lr ls lg b">FileNotFoundException</code>被那个特定的<code class="fe lq lr ls lg b">Scanner</code>构造函数声明为抛出。</p><p id="625b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要那个特定的<code class="fe lq lr ls lg b">Scanner</code>构造函数能够定位指定的文件，<code class="fe lq lr ls lg b">Scanner</code>实例大概会吸收读取文件时出现的任何异常。那可能会让我们降到15线以下。</p><p id="fe0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是为了这个例子，让我们继续两个资源的陈述。如果您的IDE提供转换为Try-with-resources，请接受该提议，并让它为您完成。</p><p id="dcd8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能需要做两次，第一次是针对<code class="fe lq lr ls lg b">FileReader</code>，第二次是针对<code class="fe lq lr ls lg b">Scanner</code>。之后，你可能需要清理缩进，或者调用你的IDE的自动格式化清理。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="e364" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能在之前的版本中注意到了，我先写了<code class="fe lq lr ls lg b">scanner</code>的关闭，再写了<code class="fe lq lr ls lg b">reader</code>的关闭。我认为先进后出在这里是有意义的。而且除此之外，<code class="fe lq lr ls lg b">scanner</code>还要靠<code class="fe lq lr ls lg b">reader</code>。</p><p id="115f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">多资源语句的结束顺序也是这样吗？我不知道，但是我可以通过几个玩具示例资源轻松找到答案。</p><p id="dd01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了这个目的，一个类被认为是一个资源所需要的就是让它实现来自<code class="fe lq lr ls lg b">java.lang</code>的<code class="fe lq lr ls lg b">AutoCloseable</code>。所以，这个演示:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="0635" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行<code class="fe lq lr ls lg b">main()</code>，输出应该是这样的:</p><blockquote class="lw lx ly"><p id="9df9" class="kd ke lv kf b kg kh ki kj kk kl km kn lz kp kq kr ma kt ku kv mb kx ky kz la ij bi translated">运行:<br/>该资源现已打开<br/>该资源现已打开<br/>正在启动该资源<br/>正在启动该资源<br/>该com . example . resources demo＄inner resource @ 15db 9742现已关闭<br/>该com . example . resources demo＄outer resource @ 6d 06d 69 c现已关闭<br/>构建成功(总时间:0秒)</p></blockquote><p id="99e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">散列码可能不同，第一行和最后一行可能不同，这取决于您是使用NetBeans之类的IDE还是从命令行运行它。</p><p id="18af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重要的是，这表明资源关闭的顺序与它们打开的顺序相反。</p><h1 id="a938" class="mc ll iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">概括起来</h1><p id="66a6" class="pw-post-body-paragraph kd ke iq kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">尽管Try-with-resources几乎总是与单个资源一起使用，但是请记住，您可以将Try-with-resources与多个资源一起使用。这些资源用分号分隔，就像同一范围内的任何其他语句组一样。</p><p id="bd2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于多个资源，假设正常执行，第一个声明的资源将最后关闭，最后一个声明的资源将首先关闭。</p><p id="f74f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">顺便说一句，如果你愿意，可以在单资源语句中放一个分号，但你不必这样做，因为Java编译器会推断出来。</p><p id="172d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至少还有一种情况，Java编译器可以推断出分号。你知道这是什么吗？</p></div></div>    
</body>
</html>