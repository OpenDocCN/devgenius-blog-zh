<html>
<head>
<title>Getting started with Sequelize in NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeJS 中的 Sequelize 入门</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/getting-started-with-sequelize-in-nodejs-35aa874e2145?source=collection_archive---------4-----------------------#2022-03-30">https://blog.devgenius.io/getting-started-with-sequelize-in-nodejs-35aa874e2145?source=collection_archive---------4-----------------------#2022-03-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/9b1b2f452a3fbff3d767490e33d80d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/0*wGD24sfUTlkgXvD_.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">Pic Credit <a class="ae jv" href="https://medium.com/@zhhjoseph?source=post_page-----dd6045f366e6-----------------------------------" rel="noopener">胡祖六</a> |中</figcaption></figure><p id="c2c7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">什么是序列式？</strong></p><p id="b9d6" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这是 Sequelize 的官方定义</p><blockquote class="ku kv kw"><p id="13b6" class="jw jx kx jy b jz ka kb kc kd ke kf kg ky ki kj kk kz km kn ko la kq kr ks kt ig bi translated">Sequelize 是一个基于 promise 的<a class="ae jv" href="https://nodejs.org/en/about/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> <a class="ae jv" href="https://en.wikipedia.org/wiki/Object-relational_mapping" rel="noopener ugc nofollow" target="_blank"> ORM 工具</a>用于<a class="ae jv" href="https://en.wikipedia.org/wiki/PostgreSQL" rel="noopener ugc nofollow" target="_blank"> Postgres </a>、<a class="ae jv" href="https://en.wikipedia.org/wiki/MySQL" rel="noopener ugc nofollow" target="_blank"> MySQL </a>、<a class="ae jv" href="https://en.wikipedia.org/wiki/MariaDB" rel="noopener ugc nofollow" target="_blank"> MariaDB </a>、<a class="ae jv" href="https://en.wikipedia.org/wiki/SQLite" rel="noopener ugc nofollow" target="_blank"> SQLite </a>、<a class="ae jv" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server" rel="noopener ugc nofollow" target="_blank">微软 SQL Server </a>、<a class="ae jv" href="https://docs.aws.amazon.com/redshift/index.html" rel="noopener ugc nofollow" target="_blank">亚马逊红移</a>、<a class="ae jv" href="https://docs.snowflake.com/en/user-guide/intro-key-concepts.html" rel="noopener ugc nofollow" target="_blank">雪花的数据云</a>、<a class="ae jv" href="https://en.wikipedia.org/wiki/IBM_Db2_Family" rel="noopener ugc nofollow" target="_blank"> DB2 </a>和<a class="ae jv" href="https://www.ibm.com/support/pages/db2-ibm-i" rel="noopener ugc nofollow" target="_blank"> IBM 它具有可靠的事务支持、关系、急切加载和延迟加载、读取复制等特性。</a></p></blockquote><p id="4509" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我刚刚开始学习 NodeJS Sequelize，并有了一个在 Medium 上分享它的想法。所以我们开始吧</p><p id="078d" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">在这篇文章中，我将做以下一系列任务</p><ol class=""><li id="73fb" class="lb lc in jy b jz ka kd ke kh ld kl le kp lf kt lg lh li lj bi translated">连接 NodeJS 应用程序和 MySQL 数据库</li><li id="9f8a" class="lb lc in jy b jz lk kd ll kh lm kl ln kp lo kt lg lh li lj bi translated">创建模型</li><li id="813f" class="lb lc in jy b jz lk kd ll kh lm kl ln kp lo kt lg lh li lj bi translated">在模型(表)之间建立关系</li><li id="5073" class="lb lc in jy b jz lk kd ll kh lm kl ln kp lo kt lg lh li lj bi translated">添加虚拟数据</li><li id="1248" class="lb lc in jy b jz lk kd ll kh lm kl ln kp lo kt lg lh li lj bi translated">获取数据</li></ol><p id="f0af" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">那么让我们开始吧！</p><p id="2680" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这里我以电子商务应用程序中的客户和订单为例。一个客户可以有许多订单，这是我为 DB 表添加的一种关系。</p><p id="ecb9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">首先，在你当前的项目中安装 Sequelize。请注意，我们将使用 MySQL 作为 Sequelize 的方言，所以我们也必须安装 mysql2 包。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="8039" class="ly lz in lu b gy ma mb l mc md">npm install mysql2 sequelize  --save</span></pre><p id="8c87" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这是我的这个应用程序的项目结构</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="ca0b" class="ly lz in lu b gy ma mb l mc md">app.js<br/>db<br/>  -index.js</span><span id="ffd6" class="ly lz in lu b gy me mb l mc md">models<br/>  - index.js<br/>  - user.model.js<br/>  - order.model.js<br/>package.json</span></pre><ol class=""><li id="32bb" class="lb lc in jy b jz ka kd ke kh ld kl le kp lf kt lg lh li lj bi translated"><strong class="jy io">连接 NodeJS 应用程序和 MySQL 数据库</strong></li></ol><p id="b1fb" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在，在当前项目的<strong class="jy io"> db/index.js </strong>中创建一个文件</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="32b9" class="ly lz in lu b gy ma mb l mc md">const sequelize = require('sequelize');<br/><br/>const <strong class="lu io"><em class="kx">Sequelize </em></strong>= new sequelize.Sequelize(<br/>    "&lt;DB Name&gt;",<br/>    "&lt;DB User&gt;",<br/>    "&lt;DB Password&gt;",<br/>    {<br/>        host: '&lt;DB Host&gt;',<br/>        dialect: "mysql"<br/>    });<br/><br/>module.exports = <strong class="lu io"><em class="kx">Sequelize</em></strong>;</span></pre><p id="3ecf" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> 2。创建模型</strong></p><p id="2cea" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在创建模型。因此，首先我们将在<strong class="jy io"> models/user.model.js </strong>中为用户创建一个模型</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f6c7" class="ly lz in lu b gy ma mb l mc md">const <strong class="lu io"><em class="kx">sequelize </em></strong>= require('../db');<br/>const Sequelize = require('sequelize');<br/><br/>const <strong class="lu io"><em class="kx">User </em></strong>= <strong class="lu io"><em class="kx">sequelize</em></strong>.define('user', {<br/>    id: {<br/>        type: Sequelize.<strong class="lu io"><em class="kx">INTEGER</em></strong>,<br/>        primaryKey: true,<br/>        autoIncrement: true<br/>    },<br/>    name: {<br/>        type: Sequelize.<strong class="lu io"><em class="kx">STRING<br/>    </em></strong>}<br/>});<br/><br/>module.exports = <strong class="lu io"><em class="kx">User</em></strong>;</span></pre><p id="2f3a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">在这里，我们已经获得了一个 Sequelize connection 实例，并使用<strong class="jy io"> define </strong>方法在该实例上创建了一个表。define 方法有两个参数，<strong class="jy io">第一个参数是表名</strong>，第二个参数是<strong class="jy io">表实体</strong>。这里我们创建了两列 A. <strong class="jy io"> id </strong>:整型、主键、自动增量和 B. <strong class="jy io"> name </strong>:这将是用户的名字。您可以根据需要添加任意多的列，但我会使这个表变得简单</p><p id="0983" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在在<strong class="jy io"> models/order.model.js </strong>中为订单创建另一个模型</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="0768" class="ly lz in lu b gy ma mb l mc md">const <strong class="lu io"><em class="kx">sequelize </em></strong>= require('../db');<br/>const Sequelize = require('sequelize');<br/><br/>const <strong class="lu io"><em class="kx">Order </em></strong>= <strong class="lu io"><em class="kx">sequelize</em></strong>.define('order', {<br/>    order_id: {<br/>        type: Sequelize.<strong class="lu io"><em class="kx">INTEGER</em></strong>,<br/>        primaryKey: true,<br/>        autoIncrement: true<br/>    },<br/>    subtotal: {<br/>        type: Sequelize.<strong class="lu io"><em class="kx">INTEGER<br/>    </em></strong>}<br/>});<br/><br/>module.exports = <strong class="lu io"><em class="kx">Order</em></strong>;</span></pre><p id="0e89" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> 3。建立模型(表格)之间的关系&amp;用承诺链添加虚拟/提取数据</strong></p><p id="9516" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在是时候建立模型之间的关系了。因此，我们将在另一个文件<strong class="jy io"> models/index.js </strong>中执行该操作</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="aac6" class="ly lz in lu b gy ma mb l mc md">const <strong class="lu io"><em class="kx">sequelize </em></strong>= require('../db');<br/>const Sequelize = require('sequelize');<br/><br/>const <strong class="lu io"><em class="kx">User </em></strong>= require('../models/user.model');<br/>const <strong class="lu io"><em class="kx">Order </em></strong>= require('../models/order.model');<br/><br/><strong class="lu io"><em class="kx">User</em></strong>.<em class="kx">hasMany</em>(<strong class="lu io"><em class="kx">Order</em></strong>);<br/><br/><strong class="lu io"><em class="kx">sequelize<br/>    </em></strong>.sync({ force: true })<br/>    .then(conn =&gt; {<br/>        return <strong class="lu io"><em class="kx">User</em></strong>.<em class="kx">create</em>({name: "Ajay"})<br/>    })<br/>    .then(user =&gt; {<br/>        return <strong class="lu io"><em class="kx">Promise</em></strong>.all([<br/>            <strong class="lu io"><em class="kx">Order</em></strong>.<em class="kx">create</em>({subtotal: 500, userId: user.id}),<br/>            <strong class="lu io"><em class="kx">Order</em></strong>.<em class="kx">create</em>({subtotal: 600, userId: user.id}),<br/>            <strong class="lu io"><em class="kx">Order</em></strong>.<em class="kx">create</em>({subtotal: 700, userId: user.id})<br/>        ])<br/>    })<br/>    .then(order =&gt; {<br/>        return <strong class="lu io"><em class="kx">User</em></strong>.<em class="kx">findAll</em>();<br/>    })<br/>    .then(users =&gt; {<br/>        <strong class="lu io"><em class="kx">console</em></strong>.log(users)<br/>    })<br/>    .catch(err =&gt; {<br/>        <strong class="lu io"><em class="kx">console</em></strong>.log(err.toString())<br/>    })</span></pre><p id="7703" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我们首先采用我们创建的两个模型，并在用户&amp;订单表上构建<strong class="jy io">一对多关系</strong>。</p><p id="a284" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">之后，我们在 DB 实例上使用了<strong class="jy io">同步方法</strong>。它的工作是创建我们到目前为止定义的所有表。你也可以在同步方法中提供<strong class="jy io"> {force: true} </strong>，这将基本上在你每次运行你的应用程序时删除表格。请注意，在调用 sync 方法之前，我已经声明了所有的模型实例，这是必要的，所以告诉 Sequelize，这是我们的模型，请运行数据库查询。</p><p id="fba4" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">最后，我将添加 app.js 和 package.json，以确保运行这个应用程序时不会遗漏任何东西</p><p id="cb2a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> app.js </strong></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2fb2" class="ly lz in lu b gy ma mb l mc md">const <strong class="lu io"><em class="kx">express </em></strong>= require('express');<br/>const db = require('./models');<br/><br/>const app = <strong class="lu io"><em class="kx">express</em></strong>();<br/><br/><br/>app.listen(<strong class="lu io"><em class="kx">process</em></strong>.env.PORT || 3000, function () {<br/>    <strong class="lu io"><em class="kx">console</em></strong>.log('app is listing to port 3000')<br/>})</span></pre><p id="b295" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> package.json </strong></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9c23" class="ly lz in lu b gy ma mb l mc md">{<br/>  "name": "nodejs-<strong class="lu io"><em class="kx">sequelize</em></strong>",<br/>  "version": "1.0.0",<br/>  "dependencies": {<br/>    "express": "^4.17.3",<br/>    "sequelize": "latest",<br/>    "mysql2": "latest"<br/>  }<br/>}</span></pre><p id="ed4e" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在从项目的根目录使用<strong class="jy io"> node app.js </strong>命令运行您的应用程序，但是要确保您已经首先运行了<strong class="jy io"> npm install </strong>以确保安装了包依赖项。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="3dbe" class="ly lz in lu b gy ma mb l mc md">npm install &amp;&amp; node app.js</span></pre><p id="591c" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在检查您的数据库，它将有 2 个表，其中的列在<strong class="jy io"> <em class="kx">序列</em> </strong> <em class="kx">模型中定义。您将获得以下输出</em></p><figure class="lp lq lr ls gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/1b42c1b1333a76922497df8fc537b0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUqhbP04l4cR3_ugHrz_Ow.png"/></div></div></figure><p id="92cb" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在检查你的数据库</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d30d" class="ly lz in lu b gy ma mb l mc md"><br/>mysql&gt; show tables;<br/>+--------------------------+<br/>| Tables_in_test_sequelize |<br/>+--------------------------+<br/>| orders                   |<br/>| users                    |<br/>+--------------------------+<br/>2 rows in set (0.00 sec)</span></pre><p id="7b49" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">太好了！我们已经成功地创建了一个应用程序，使用<strong class="jy io"> <em class="kx">序列从数据库中创建/添加/获取数据。</em> </strong></p><p id="35f4" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">你喜欢这篇文章吗？如果是这样，通过<a class="ae jv" href="https://www.youtube.com/channel/UCvEB7wXUEXGFE9lCx0USR3Q" rel="noopener ugc nofollow" target="_blank"> <strong class="jy io">订阅解码获得更多类似内容，我们的 YouTube 频道</strong> </a> <strong class="jy io">！</strong></p><p id="6a8c" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">感谢阅读。</p></div></div>    
</body>
</html>