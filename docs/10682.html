<html>
<head>
<title>Parsing JSON in C with Vely framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 vly 框架解析 C 语言中的 JSON</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/parsing-json-in-c-with-vely-framework-e6cf5537392?source=collection_archive---------9-----------------------#2022-11-21">https://blog.devgenius.io/parsing-json-in-c-with-vely-framework-e6cf5537392?source=collection_archive---------9-----------------------#2022-11-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3d85b04c12f53232345d91e45205ad5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mf61Ow7CyUCnZJ6o.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">封面图片版权 Sergio Mijatovic 2022</figcaption></figure><h1 id="e384" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">以不同的方式解析 JSON</h1><p id="0e8c" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这个例子演示了在 c 语言中用<a class="ae lv" href="https://vely.dev/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank">vs</a>解析 JSON 文本。JSON 文档包含一组国家，其中包含一组州，每个州包含一组城市。JSON 数据也不是固定的——一些数组成员包含其他成员不包含的数据。所以这个例子相当复杂。</p><p id="f0e9" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">还显示了 UTF8 Unicode 数据的使用—一些城市的名称中有这样的字符。</p><p id="1e69" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">JSON 文本来自两种不同的客户端请求:来自 HTML 表单，也来自 Javascript/fetch()。第一个使用来自表单的 URL 查询 POST。第二个示例演示了一个内容类型为“application/json”的请求，并使用<a class="ae lv" href="https://vely.dev/request-body.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank">请求体</a>来获取 HTTP 请求体。</p><p id="03ea" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">每个 JSON 数据节点都使用内置的散列语句来检索(参见<a class="ae lv" href="https://vely.dev/new-json.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> new-json </a>)。</p><p id="77ee" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">JSON 解析演示了两种方法:</p><ul class=""><li id="089b" class="mb mc in kz b la lw le lx li md lm me lq mf lu mg mh mi mj bi translated">首先，通过搜索特定元素，在本例中是所有国家，然后是一个国家下的所有州，最后是一个州下的所有城市。这展示了如何处理一个结构已知但可以改变的通用 JSON 文档。</li><li id="40bd" class="mb mc in kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">第二，遍历所有的数据节点，并让每个节点进入一个循环。这对于获取所有数据非常有用，即使你不知道数据的结构，也可以一路搜索你感兴趣的内容。</li></ul><h1 id="51e6" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">应用程序截图</h1><p id="0bbe" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">您可以在该表单中输入要解析的 JSON 文本:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f197ef866e7d698b3e1367e6f8ec2aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*uI5G1yD6suoWjayB"/></div></figure><p id="e3cf" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">这是使用“提取所有数据”按钮提交的结果，其中显示了所有数据节点及其规范化名称(包括层次结构和数组)、值和类型:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/dc29de8296ac1408ced4ab8dedee31e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/0*6UnGiYdeM-YxHdw1"/></div></figure><p id="9438" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">以下是按下“提取特定数据”按钮的输出。考虑到数据的层次结构，找到特定的数据节点，并显示它们的名称和值:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ec0a3914d2747cbab06f05eaaeb50159.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/0*haREhhW4Yz4YyFkZ"/></div></figure><p id="10c5" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">您可以从 Javascript fetch()调用 Vely 代码—这是 post.html 的输出(参见 Access application…关于如何运行它):</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/f1b9835e317fad36df35ef7c15a6acf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZWdzF2mXT6I6RZn_"/></div></div></figure><h1 id="175f" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">设置先决条件</h1><p id="aa00" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><a class="ae lv" href="https://vely.dev/pkg/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank">安装 Vely</a>——可以使用标准的打包工具，如<a class="ae lv" href="https://www.debian.org/doc/manuals/debian-handbook/sect.apt-get.en.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> apt </a>、<a class="ae lv" href="https://dnf.readthedocs.io/en/latest/command_ref.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> dnf </a>、<a class="ae lv" href="https://archlinux.org/pacman/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> pacman </a>或<a class="ae lv" href="https://opensuse.github.io/openSUSE-docs-revamped-temp/zypper/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> zypper </a>。</p><p id="9e8c" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">因为在这个例子中使用了它，所以您需要安装<a class="ae lv" href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> Nginx </a>作为 web 服务器。</p><p id="01f6" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">安装完 vly 后，如果您正在使用 vim，请打开它的语法高亮显示功能:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="36fe" class="nc ka in my b be nd ne l nf ng">vv -m</span></pre><h1 id="1d91" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">获取源代码</h1><p id="d986" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">源代码是虚拟安装的一部分。为每个应用程序创建一个单独的源代码目录是一个好主意(您可以随意命名)。在这种情况下，解包源代码将为您做到这一点:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="f9f7" class="nc ka in my b be nd ne l nf ng">tar xvf $(vv -o)/examples/json.tar.gz<br/>cd json</span></pre><h1 id="3781" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">设置应用程序</h1><p id="d6d9" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">第一步是创建应用程序。该应用程序将被命名为“json”，但您可以将其命名为任何名称(如果您这样做，请在任何地方更改它)。用<a class="ae lv" href="https://vely.dev/vf.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> vf </a>做起来很简单:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="a66f" class="nc ka in my b be nd ne l nf ng">sudo vf -i -u $(whoami) json</span></pre><p id="8ee4" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">这将创建一个新的应用程序主页(即<code class="fe nh ni nj my b">/var/lib/vv/json</code>)并为您设置应用程序。这通常意味着在主文件夹中创建各种子目录，并为它们分配权限。在这种情况下，只有当前用户(或<code class="fe nh ni nj my b">whoami</code> Linux 命令的结果)将拥有那些具有 0700 特权的目录；这意味着一个安全的设置。</p><h1 id="1203" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">构建应用程序</h1><p id="cd4a" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">使用<a class="ae lv" href="https://vely.dev/vf.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> vv </a>实用程序进行应用:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="38d4" class="nc ka in my b be nd ne l nf ng">vv -q</span></pre><h1 id="f15b" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">启动您的应用服务器</h1><p id="cb64" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">要为您的 web 应用程序启动应用服务器，请使用<a class="ae lv" href="https://vely.dev/vf.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> vf </a> FastCGI 进程管理器。应用服务器将使用 Unix 套接字与 web 服务器通信(即反向代理):</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="f851" class="nc ka in my b be nd ne l nf ng">vf -w 3 json</span></pre><p id="7835" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">这将启动 3 个守护进程来处理传入的请求。您还可以启动一个 adaptive server，它将增加进程的数量以服务更多的请求，并在不需要进程时逐渐减少进程的数量:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="cea3" class="nc ka in my b be nd ne l nf ng">vf json</span></pre><p id="6fb8" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">参见<a class="ae lv" href="https://vely.dev/vf.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> vf </a>了解更多选项，帮助您实现最佳性能。</p><p id="2d6a" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">要停止应用程序服务器，请执行以下操作:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="89fc" class="nc ka in my b be nd ne l nf ng">vf -m quit json</span></pre><h1 id="77d9" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">安装 web 服务器</h1><p id="1f65" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这展示了如何将您的应用程序连接到 Nginx web 服务器，该应用程序监听 Unix 套接字(从<a class="ae lv" href="https://vely.dev/vf.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> vf </a>开始)。</p><p id="47d6" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated"><strong class="kz io">第一步</strong>:</p><p id="ffe5" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">您需要编辑 Nginx 配置文件。对于 Ubuntu 和类似的:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="d100" class="nc ka in my b be nd ne l nf ng">sudo vi /etc/nginx/sites-enabled/default</span></pre><p id="ed28" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">而在 Fedora 和其他系统上，它可能位于:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="10ad" class="nc ka in my b be nd ne l nf ng">sudo vi /etc/nginx/nginx.conf</span></pre><p id="d2b8" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">在“服务器{}”部分添加以下内容(“json”是您的应用程序名称，但一般可以是任何 URL 应用程序路径，参见<a class="ae lv" href="https://vely.dev/request_URL.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> request_URL </a>):</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="0239" class="nc ka in my b be nd ne l nf ng">location /json { include /etc/nginx/fastcgi_params; fastcgi_pass  unix:///var/lib/vv/json/sock/sock; }</span></pre><p id="5584" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated"><strong class="kz io">第二步</strong>:</p><p id="994d" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">最后，重启 Nginx:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="f6ea" class="nc ka in my b be nd ne l nf ng">sudo systemctl restart nginx</span></pre><h1 id="1396" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">从浏览器访问应用服务器</h1><p id="4bf9" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">使用以下 URL 从 web 客户端(如浏览器)访问您的应用服务器(如果不同，请使用实际 IP 地址，而不是 127.0.0.1):</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="e9c0" class="nc ka in my b be nd ne l nf ng">#Enter JSON and send for parsing :<br/>http://127.0.0.1/json?req=json_form</span></pre><p id="e396" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">将 cities.json 文件的内容复制到表单中的文本区域。</p><p id="4dc7" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated"><strong class="kz io">通过 fetch 方法从 Javascript 运行</strong></p><p id="0e1f" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">还可以通过 Javascript/fetch 机制测试 JSON 解析。首先，将文件复制到 web 服务器的单独目录中:</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="2624" class="nc ka in my b be nd ne l nf ng">sudo mkdir /var/www/html/velytest<br/>sudo cp post.html /var/www/html/velytest</span></pre><p id="e975" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">测试它(如果不在本地测试，请使用您的网址，而不是 127.0.0.1):</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="e5df" class="nc ka in my b be nd ne l nf ng">http://127.0.0.1/velytest/post.html</span></pre><p id="a9a6" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">注意:如果您的服务器在互联网上，并且有防火墙，您可能需要允许 HTTP 流量—参见<a class="ae lv" href="https://www.linux.com/training-tutorials/introduction-uncomplicated-firewall-ufw/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> ufw </a>、<a class="ae lv" href="https://www.thegeekdiary.com/5-useful-examples-of-firewall-cmd-command/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> firewall-cmd </a>等。</p><h1 id="b9e2" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">文件</h1><p id="a7fc" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">您现在已经完成了示例！以下是这个项目中的源文件，因此您可以检查它是如何工作的:</p><h1 id="b9f4" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">JSON 文档(cities.json)</h1><p id="4b6c" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这是您在表单中输入的用于解析的 JSON 文档。它包含国家、州和城市及其人口。</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="a6ec" class="nc ka in my b be nd ne l nf ng">{ "country": [<br/>    {<br/>        "name": "USA",<br/>        "state": [<br/>            {<br/>                "name": "Arizona",<br/>                "city": [<br/>                    {<br/>                        "name" : "Phoenix",<br/>                        "population": 5000000<br/>                    } ,<br/>                    {<br/>                        "name" : "Tuscon",<br/>                        "population": 1000000<br/>                    }<br/>                ]<br/>            } ,<br/>            {<br/>                "name": "California",<br/>                "city": [<br/>                    {<br/>                        "name" : "Los Angeles",<br/>                        "population": 19000000<br/>                    },<br/>                    {<br/>                        "name" : "Irvine"<br/>                    }<br/>                ]<br/>            }<br/>        ]<br/>    } ,<br/>    {<br/>        "name": "Mexico",<br/>        "state": [<br/>            {<br/>                "name": "Veracruz",<br/>                "city": [<br/>                    {<br/>                        "name" : "Xalapa-Enríquez",<br/>                        "population": 8000000<br/>                    },<br/>                    {<br/>                        "name" : "C\u00F3rdoba",<br/>                        "population": 220000<br/>                    }<br/>                ]<br/>            } ,<br/>            {<br/>                "name": "Sinaloa",<br/>                "city": [<br/>                    {<br/>                        "name" : "Culiac\u00E1n Rosales",<br/>                        "population": 3000000<br/>                    }<br/>                ]<br/>            }<br/>        ]<br/>    }<br/>    ]<br/>}</span></pre><h1 id="35aa" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">从 Javascript 调用(post.html)</h1><p id="ad8b" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">您可以通过 fetch()从 Javascript 调用您的 Vely 代码。这个 HTML 文件会在加载后立即执行(无需按键)，当然，您可以根据自己的需要进行修改。这也演示了使用 POST 方法和“application/json”的内容类型与您的服务器端 vly 代码进行对话。</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="fbbe" class="nc ka in my b be nd ne l nf ng">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;title&gt;Vely + JavaScript/Fetch + POST/PUT/PATCH + JSON&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    &lt;h1 class="align"&gt;Example: Vely + JavaScript/Fetch + POST/PUT/PATCH + JSON&lt;/h1&gt;<br/>    &lt;script&gt;<br/>        fetch('/json?req=json_process',{<br/>            method: 'POST',<br/>            headers: {'content-type': 'application/json'},<br/>            body:  '{ "country": [ \<br/>    {  \<br/>        "name": "USA", \<br/>        "state": [ \<br/>            {  \<br/>                "name": "Arizona", \<br/>                "city": [ \<br/>                    { \<br/>                        "name" : "Phoenix", \<br/>                        "population": "5000000" \<br/>                    } , \<br/>                    { \<br/>                        "name" : "Tuscon", \<br/>                        "population": "1000000" \<br/>                    }  \<br/> \<br/>                ] \<br/>            } , \<br/>            {  \<br/>                "name": "California", \<br/>                "city": [ \<br/>                    { \<br/>                        "name" : "Los Angeles", \<br/>                        "population": "4000000" \<br/>                    }, \<br/>                    { \<br/>                        "name" : "Irvine" \<br/>                    } \<br/>                ] \<br/>            }  \<br/>        ]  \<br/>    } , \<br/>    {  \<br/>        "name": "Mexico", \<br/>        "state": [ \<br/>            {  \<br/>                "name": "Veracruz", \<br/>                "city": [ \<br/>                    { \<br/>                        "name" : "Xalapa-Enríquez", \<br/>                        "population": "8000000" \<br/>                    }, \<br/>                    { \<br/>                        "name" : "C\u00F3rdoba", \<br/>                        "population": "220000" \<br/>                    } \<br/>                ] \<br/>            } , \<br/>            {  \<br/>                "name": "Sinaloa", \<br/>                "city": [ \<br/>                    { \<br/>                        "name" : "Culiac\u00E1n Rosales", \<br/>                        "population": "3000000" \<br/>                    } \<br/>                ] \<br/>            }  \<br/>        ]  \<br/>    } \<br/>    ] \<br/>}'<br/>        })<br/>        .then((result) =&gt; { return result.text(); })<br/>        .then((content) =&gt; { document.getElementById("json_output").innerHTML = content; });<br/>    &lt;/script&gt;<br/>    &lt;div id='json_output'&gt;&lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="e7cc" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">输入 JSON (json_form.vely)</h1><p id="4378" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这是一个简单的 HTML 表单，您可以在其中输入 JSON 文档。由于 json_process.vely 和 json_all.vely 中的代码解析了城市列表，所以要输入的文本在 cities.json 文件中给出。</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="a121" class="nc ka in my b be nd ne l nf ng">#include "vely.h"<br/><br/>void json_form () {<br/>    out-header default<br/>    @&lt;h2&gt;Enter JSON&lt;/h2&gt;<br/>    @&lt;form action="?req=json_process" method="POST"&gt;<br/>    @    &lt;label for="json_text"&gt;JSON text:&lt;/label&gt;&lt;br&gt;<br/>    @    &lt;textarea name="json_text" rows="8" columns="70"&gt;\<br/>           &lt;/textarea&gt;&lt;br/&gt;<br/>    @    &lt;button type="submit"&gt;Extract specific data&lt;/button&gt;<br/>    @    &lt;button type="submit" formaction="?req=json_all"&gt;\<br/>           Extract all data&lt;/button&gt;<br/>    @ &lt;/form&gt;<br/>}</span></pre><h1 id="0d18" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">在一个循环中解析所有 JSON 数据(json_all.vely)</h1><p id="ac88" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这将解析您可能不知道其结构的文档。获得每个数据节点后，您可以在代码中检查它。</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="a96a" class="nc ka in my b be nd ne l nf ng">#include "vely.h"<br/><br/>void json_all() {<br/>    out-header default<br/>    input-param json_text<br/>    // Parse json text and display any error and the position of it<br/>    new-json define json from json_text status define st \<br/>      error-text define etext error-position define epos<br/>    if (st != VV_OKAY) {<br/>        @Could not parse JSON! Error [&lt;&lt;p-out etext&gt;&gt;] at \<br/>          position &lt;&lt;p-num epos&gt;&gt;.<br/>        exit-request<br/>    }<br/>    // Traverse JSON document, node by node, display as a table of <br/>    // all data nodes<br/>    read-json json traverse begin<br/>    @&lt;table border='1'&gt;<br/>    while (1)<br/>    {<br/>        read-json json traverse key define k value define v \<br/>          type define t status define s<br/>        if (s != VV_OKAY) break;<br/>        // Display name, value and type (ignore boolean and type since<br/>        // we don't have them)<br/>        @&lt;tr&gt;<br/>            @&lt;td&gt;&lt;&lt;p-out k&gt;&gt;&lt;/td&gt; &lt;td&gt;&lt;&lt;p-out v&gt;&gt;&lt;/td&gt;<br/>            @&lt;td&gt;&lt;&lt;p-out t==VV_JSON_TYPE_NUMBER?"Number": \<br/>              (t==VV_JSON_TYPE_STRING?"String":"Other")&gt;&gt;&lt;/td&gt;<br/>        @&lt;/tr&gt;<br/>    }<br/>    @&lt;/table&gt;<br/>}</span></pre><h1 id="7e10" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">通过查找特定元素解析 JSON(JSON _ process . vely)</h1><p id="79a3" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">解析 JSON 文档。这显示了对文档的解析，您知道该文档的结构，但是没有固定的结构，因此每个元素都是基于其规范化名称进行检索的(参见<a class="ae lv" href="https://vely.dev/read-json.html?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> read-json </a>)。</p><pre class="mq mr ms mt gt mx my mz bn na nb bi"><span id="f8dd" class="nc ka in my b be nd ne l nf ng">#include "vely.h"<br/><br/>void json_process() {<br/>    out-header default<br/>    // If JSON data sent via URL-encoded GET or POST<br/>    input-param json_text<br/>    // If JSON data sent in the request body (application/json), <br/>    // use that JSON data <br/>    request-body json_body<br/>    get-req content-type to define ctype<br/>    if (!strcmp(ctype, "application/json")) json_text=json_body;<br/>    // Parse json text and display any error and the position of it<br/>    new-json define json from json_text status define st \<br/>      error-text define etext error-position define epos<br/>    if (st != VV_OKAY) {<br/>        @Could not parse JSON! Error [&lt;&lt;p-out etext&gt;&gt;] at \<br/>          position &lt;&lt;p-num epos&gt;&gt;.<br/>        exit-request<br/>    }<br/>    @Cities found&lt;hr/&gt;<br/>    num country_count;<br/>    num state_count;<br/>    num city_count;<br/>    // Start displaying a list<br/>    @&lt;ul&gt;<br/>    // Look for countries, states and then cities<br/>    // Data is organized in hashed arrays, for example<br/>    // country[0].state[1].city[0]<br/>    // and each can have sub-nodes, such as<br/>    // country[0].name<br/>    // etc.<br/>    for (country_count = 0; ; country_count++) {<br/>        // First, build key prefix for a country<br/>        (( define json_key_country<br/>        @"country"[&lt;&lt;p-num country_count&gt;&gt;]<br/>        ))<br/>        // Search for a country name<br/>        (( define json_key_country_name<br/>        @&lt;&lt;p-out json_key_country&gt;&gt;."name"<br/>        ))<br/>        // Search for a country name under index [country_count]<br/>        read-json json key json_key_country_name \<br/>          value define country_name  status st<br/>        if (st != VV_OKAY) break;<br/>        // Country found<br/>        @&lt;li&gt;Country: &lt;&lt;p-out country_name&gt;&gt;&lt;br/&gt;<br/>        @&lt;ul&gt;<br/>        // Look for states under this country<br/>        for (state_count = 0; ; state_count++) {<br/>            // Build key prefix for a state<br/>            (( define json_key_state<br/>            @&lt;&lt;p-out json_key_country&gt;&gt;."state"[&lt;&lt;p-num state_count&gt;&gt;]<br/>            ))<br/>            // Search for state name<br/>            (( define json_key_state_name<br/>            @&lt;&lt;p-out json_key_state&gt;&gt;."name"<br/>            ))<br/>            // Search for a state name as: <br/>            // country[countr_count].state[state_count]<br/>            read-json json key json_key_state_name \<br/>              value define state_name  status st<br/>            if (st != VV_OKAY) break;<br/>            // State found<br/>            @&lt;li&gt;State: &lt;&lt;p-out state_name&gt;&gt;&lt;br/&gt;<br/>            @&lt;ul&gt;<br/>            // Look for cities under state<br/>            for (city_count = 0; ; city_count++) {<br/>                // Build key prefix for city<br/>                (( define json_key_city<br/>                @&lt;&lt;p-out json_key_state&gt;&gt;."city"[&lt;&lt;p-num city_count&gt;&gt;]<br/>                ))<br/>                // Search for city name<br/>                (( define json_key_city_name<br/>                @&lt;&lt;p-out json_key_city&gt;&gt;."name"<br/>                ))<br/>                // Search for a city name as: <br/>                // country[countr_count].state[state_count].<br/>                // city[city_count]<br/>                read-json json key json_key_city_name \<br/>                  value define city_name  status st<br/>                if (st != VV_OKAY) break;<br/>                // Found city, get its population <br/>                // by building a key for it<br/>                (( define json_key_city_population<br/>                @&lt;&lt;p-out json_key_city&gt;&gt;."population"<br/>                ))<br/>                // Get city population<br/>                read-json json key json_key_city_population \<br/>                  value define city_population  status st<br/>                if (st != VV_OKAY) city_population="unknown";<br/>                // Display city name and its population<br/>                @&lt;li&gt;City:&lt;&lt;p-out city_name&gt;&gt; \<br/>                  (&lt;&lt;p-out city_population&gt;&gt;)&lt;/li&gt;<br/>            }<br/>            @&lt;/ul&gt;<br/>            @&lt;/li&gt;<br/>        }<br/>        @&lt;/ul&gt;<br/>        @&lt;/li&gt;<br/>    }<br/>    @&lt;/ul&gt;<br/>}</span></pre></div></div>    
</body>
</html>