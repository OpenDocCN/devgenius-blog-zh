<html>
<head>
<title>Getting Data from EMQX Cloud with InfluxDB Native Collector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 InfluxDB 本机收集器从 EMQX 云获取数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/getting-data-from-emqx-cloud-with-influxdb-native-collector-a6d795b31acc?source=collection_archive---------12-----------------------#2022-08-30">https://blog.devgenius.io/getting-data-from-emqx-cloud-with-influxdb-native-collector-a6d795b31acc?source=collection_archive---------12-----------------------#2022-08-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="06b0" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">介绍</h1><p id="9204" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">InfluxData 最近宣布了原生收集器的可用性，将原生数据收集带到了 InfluxDB 云中。这将为开发人员提供从第三方 MQTT 代理(如 EMQX Cloud)获取数据到 InfluxDB Cloud 的最快方式，而不需要额外的软件或新的代码。</p><p id="a1bd" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">虽然与私有 MQTT 代理集成总是可能的，但这是实现云到云集成的更简单的方法。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/d78dea74fe65c8b1e7b12e9dcea79471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rNxdbWFtgbsn5O8qtvXuxA.jpeg"/></div></figure><p id="d975" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在本教程中，我将一步步向您展示如何使用这个新的本机收集器将 InfluxDB 云与领先的 MQTT 服务提供商 EMQX 云集成。</p><h1 id="f6b2" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">四步整合</h1><p id="acdb" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">集成只需要 4 个步骤:</p><ol class=""><li id="5a52" class="lt lu in kk b kl lg kp lh kt lv kx lw lb lx lf ly lz ma mb bi translated">在 EMQX 云上创建 MQTT 代理— 3 分钟</li><li id="f45a" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">在 InfluxDB 云上创建一个存储桶— 3 分钟</li><li id="19d8" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">配置本机收集器— 2 分钟</li><li id="8233" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">验证— 1 分钟</li></ol><p id="0878" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">是啊！不到 10 分钟你就能把数据从 EMQX Cloud 拿到 InfluxDB Cloud！</p><p id="b89a" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在，让我们来看看。</p><h1 id="23b9" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 1:在 EMQX Cloud 上创建一个 MQTT 代理。</h1><p id="7065" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在 EMQX Cloud 上创建一个专门的 MQTT 代理就像点击几下鼠标一样简单。</p><h2 id="cf07" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">获得一个帐户</h2><p id="6f0d" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您是 EMQX Cloud 的新用户，请转到<a class="ae mt" href="https://www.emqx.com/en" rel="noopener ugc nofollow" target="_blank"> EMQX Cloud </a>并点击开始免费注册帐户。</p><h2 id="6fb9" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">创建一个 MQTT 集群</h2><p id="aa1c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">登录后，点击帐户菜单下的“云控制台”，您将能够看到绿色按钮来创建一个新的部署。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/162e5eccdd915d531d3b86760cc4d408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kbwduw6DrQ_qBEkrYPnESA.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">在 EMQX 云上创建一个 MQTT 实例</figcaption></figure><p id="7b01" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">EMQX Cloud 提供标准和专业计划的 14 天免费试用。虽然 Pro 计划提供了更多的功能，但标准计划对于本教程来说已经足够了。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nd"><img src="../Images/1b7dc66e0fa37a7d535ed805dc45517f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3QM81puV3RV7eW2M_QU_mw.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">本教程使用标准计划</figcaption></figure><p id="246f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">单击“立即创建”,并按照逐步演练完成部署。单击最后一个“部署”按钮后，您将看到实例创建如下:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ne"><img src="../Images/f24a9b33009e0292fae63ecd7d71955c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56z6Jnkqr3l9kjK_txtTyg.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">创建 MQTT 实例</figcaption></figure><p id="0a6c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">获取正在运行的实例需要几分钟时间。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nf"><img src="../Images/9d5d9160f1082b35fa2b0f9b052b9e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSo7VEQOjL-nM7XZVQwj8g.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">处于运行状态的实例</figcaption></figure><p id="023f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">一旦状态变为正在运行，单击该卡即可转至群集概述。</p><h2 id="7c22" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">获取连接地址和端口</h2><p id="7715" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在 overview 页面上，您将看到实例的详细信息。注意这里的连接地址和连接端口，这是我们在 InfluxDB Cloud 上配置集成时所需要的。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ng"><img src="../Images/2b2d1e1641eab33bf525c132d8f019bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiHmqVx3Ccm8WWYNtsGz_g.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">MQTT 代理连接详细信息</figcaption></figure><p id="d4fc" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">每个 EMQX 云实例为 MQTT 连接创建四个侦听器(MQTT、带有 TLS 的 MQTT、WebSocket 上的 MQTT 和带有 TLS 的 WebSocket 上的 MQTT)。但是 InfluxDB Cloud 目前只支持 MQTT 协议，所以你只需要记下第一个端口。</p><h2 id="98fd" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">为 MQTT 连接添加凭据</h2><p id="b82a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">EMQX Cloud 上的最后一件事是为 MQTT 连接创建凭证。点按左侧菜单中的“认证和 ACL”，然后点按子菜单中的“认证”。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nh"><img src="../Images/1cbb5cbfc987f5fc578d6c3a40857c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ecTvy7J-6Kc_p0ISLPXNUQ.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">认证页面</figcaption></figure><p id="6f92" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">单击右边的“Add”按钮，稍后提供 MQTT 连接的用户名和密码。这里我将使用“test”和“influxdb”作为用户名和密码。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ni"><img src="../Images/d78e84358270be787987903ce4e393d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wd4OOpFidZfq72MVeymH0w.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">添加凭据</figcaption></figure><p id="b991" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">点击“确认”,一切都在 EMQX 云端解决了。</p><p id="dfd6" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在你有了一个由 EMQX Cloud 提供的正在运行的 MQTT broker。让我们进入第二步。</p><h1 id="6364" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 2:在 InfluxDB Cloud 上创建一个 bucket</h1><h2 id="2c9c" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">创建 InfluxDB 云帐户</h2><p id="4d70" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您是第一次使用<a class="ae mt" href="https://www.influxdata.com/products/influxdb-cloud/" rel="noopener ugc nofollow" target="_blank"> InfluxDB Cloud </a>，您还需要创建一个帐户</p><h2 id="8eba" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">为数据持久性创建一个存储桶</h2><p id="b5ad" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">登录后，转到控制台页面并单击菜单中的“Buckets”按钮。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nj"><img src="../Images/647e43e5d60ff90ea0a8e5ecb6e49746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iX3L94-copfTQxS8FDkS2g.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">转到存储桶页面</figcaption></figure><p id="53e0" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">单击右侧的“创建存储桶”并填写表格。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nk"><img src="../Images/140c4bff6dbb476bb1ae9e5d660eeef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXs7VRwrWjNVYLcy9LzKvg.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">创建新的存储桶</figcaption></figure><p id="f4f8" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">这里我将使用“emqxcloud”作为 bucket 名称。点击“创建”。</p><p id="15ec" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">好了，现在你已经准备好水桶了。让我们试试新的本地收集器。</p><h1 id="4055" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 3:配置本机收集器</h1><h2 id="fbef" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">转到本地订阅页面</h2><p id="7977" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">单击存储桶页面上的“本地订阅”选项卡。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nl"><img src="../Images/863ede2409239baa53008a62377f779d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYhYIYegc5OrNwOvXahTSg.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">转到本地订阅页面</figcaption></figure><p id="cb2e" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><em class="nm">请注意，此功能仅适用于基于使用的计划。所以你需要通过链接信用卡来升级你的账户。幸运的是，InfluxDB Cloud 为新用户提供 250 美元的积分。</em></p><h2 id="27af" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">创建订阅</h2><p id="b8ae" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">继续并点击创建订阅。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nn"><img src="../Images/c5cc233caf3505620cf941552db2eb83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfY9tg7bw86ja6rYjS07LA.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">创建 MQTT 订阅</figcaption></figure><p id="cb3c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在“集成配置”页面上，有 5 个部分:</p><ul class=""><li id="e1fb" class="lt lu in kk b kl lg kp lh kt lv kx lw lb lx lf no lz ma mb bi translated">配置代理详细信息</li><li id="612b" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf no lz ma mb bi translated">配置安全性详细信息</li><li id="aa81" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf no lz ma mb bi translated">订阅一个主题</li><li id="d105" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf no lz ma mb bi translated">设置写入目标</li><li id="6689" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf no lz ma mb bi translated">定义数据解析规则。</li></ul><p id="93d9" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">别急，我们一个一个来。</p><h2 id="02ec" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">配置代理连接</h2><p id="30e5" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">要创建订阅，InfluxDB 首先需要连接到 EMQX Cloud 上的目标 MQTT 代理。</p><p id="dc99" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">这里我们将使用我们在 EMQX Cloud 上创建的连接细节。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi np"><img src="../Images/c27fb57201851d01be2d91ccc0b1c651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OoGEToKiNUf8ulP-AGtpYA.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">配置代理详细信息</figcaption></figure><p id="6b09" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">这部分有 4 个输入:</p><ol class=""><li id="f702" class="lt lu in kk b kl lg kp lh kt lv kx lw lb lx lf ly lz ma mb bi translated">订阅名称:根据需要命名您的订阅。我在这个例子中使用“EMQX”。</li><li id="50fb" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">描述:(可选)为该订阅提供简短描述。</li><li id="05fe" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">主机名或 IP 地址:您在步骤 1 中从 EMQX Cloud 获得的连接地址。</li><li id="076b" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">Port:您在步骤 1 中从 EMQX Cloud 获得的连接端口。</li></ol><h2 id="bcdf" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">配置安全性详细信息</h2><p id="c048" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在“安全详细信息”中选择“基本”，并设置您在 EMQX Cloud 中创建的用户名和密码。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nq"><img src="../Images/8d51313f455bffe49bb7c63fef21e474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Icm0Ms3LkLU7yy5E_m_xpg.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">为 MQTT 连接添加凭证</figcaption></figure><p id="4e1d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><strong class="kk io"> <em class="nm">双重检查地址、端口和用户名/密码。它们对于建立到 EMQX 云的成功 MQTT 连接是必不可少的。</em> </strong></p><h2 id="f858" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">订阅一个主题</h2><p id="67b3" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">一旦配置好连接，我们需要告诉 InfluxDB Cloud 它应该监听哪些主题。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nr"><img src="../Images/f47595330d1fac42293f85fbbd4d3622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VrFLRVeYtwPL_GqpY1NYPA.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">添加订阅主题</figcaption></figure><p id="d7e8" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在这里给出题目名称即可。我在这个演示中使用了“influxdb”。很好理解。发送到该主题的所有数据将被转发到 InfluxDB Cloud。</p><p id="d768" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">虽然我们在这里使用了显式的主题名称，但 InfluxDB Cloud Native Collector 确实支持通配符，如“+”和“#”。在真实的用例中，使用通配符更实用。查看<a class="ae mt" href="https://docs.influxdata.com/influxdb/cloud/write-data/no-code/native-subscriptions/#subscribe-to-an-mqtt-topic" rel="noopener ugc nofollow" target="_blank"> InfluxDB Cloud 的文档</a>了解更多信息。</p><h2 id="41d5" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">设置写入目标</h2><p id="59a2" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在“写入目标”部分，保留默认值，因为只有一个存储桶。但是，如果您有多个存储桶，请确保选择正确的存储桶。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nr"><img src="../Images/7e9175098af97e92ab33846419452623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1l6mNQr7W7g4Xts1uyAVw.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">选择写入目标存储桶</figcaption></figure><h2 id="f8ed" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">定义数据解析规则</h2><p id="6c59" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在，最后一部分:定义数据解析规则。</p><p id="bc4f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">InfluxDB 云原生收集器支持三种数据格式。在这个演示中，我们将使用 JSON 格式。在演示中更容易阅读。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ns"><img src="../Images/fb69d953ef2194ca2280149b113894a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MET7o6pv-Ghwk4GhAY2SmA.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">定义数据解析规则</figcaption></figure><p id="750c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在数据解析规则中，您需要提供关于如何将 JSON 数据转换成 InfluxDB 中的度量和字段的信息。</p><p id="2dfb" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在演示中，我将使用只有一个温度数据的非常简单的消息。</p><p id="e660" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">示例 JSON 负载:</p><p id="f613" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><code class="fe nt nu nv nw b">{ "temperature":25 }</code></p><p id="47fc" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">要将此 JSON 消息转换为 InfluxDB Cloud 中的指标，我们需要执行以下映射:</p><h2 id="e374" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">时间戳:</h2><p id="2781" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">时间戳是可选的。如果没有提供，它将在插入数据时使用服务器的时间戳作为默认值。</p><h2 id="32a0" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">测量:</h2><p id="18a7" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">度量可以从 JSON 或静态名称中解析。为了使这个演示尽可能简单，我在这个演示中使用了静态名称“room_temperature”。</p><h2 id="61b5" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">字段:</h2><p id="a6dd" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在这个演示中，我使用了一个只包含温度的 JSON 消息，所以我使用“temperature”作为名称，JSON 路径为“$”。温度”来从 JSON 体中获取数据。InfluxDB Cloud 使用 JSONPath 从 JSON 对象获取数据。检查<a class="ae mt" href="https://jsonpath.com/" rel="noopener ugc nofollow" target="_blank"> JSONPath 的</a>文档中的语法。</p><h2 id="6391" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">保存订阅</h2><p id="e72f" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">最后但同样重要的是，不要忘记保存订阅。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nx"><img src="../Images/713243a2f7f7a9d69f33259d02a4f2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9uBiWPQUkOdQnv2YhIdpQ.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">保存订阅</figcaption></figure><p id="a15b" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">点击“保存订阅”即可！</p><h2 id="9c99" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">验证订阅正在运行</h2><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ny"><img src="../Images/09b13e9c73352e0e8bc588992e589c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btjgabEsEt9mDXyoWOYBww.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">本机订阅正在运行</figcaption></figure><p id="f988" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">它应该在本地订阅列表中显示为正在运行。</p><h2 id="0c89" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">一切都解决了</h2><p id="a217" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">恭喜你！你应该已经成功集成了 InfluxDB 云和 EMQX 云。发送到 EMQX Cloud 的温度数据应该持续持久化到 InfluxDB Cloud 上的目标 bucket 中。</p><p id="7635" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在，让我们进入最后一步。看看它是否像预期的那样工作。</p><h1 id="875b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第四步:验证</h1><p id="6338" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如何知道整合是否成功？简单回答:我们给 EMQX Cloud 上的 MQTT broker 发个消息，看看它有没有出现在 InfluxDB cloud 的仪表盘上！</p><h2 id="ac2e" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">选择 MQTT 客户机</h2><p id="2326" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">您可以随意使用任何 MQTT 客户机。在本教程中，我将使用<a class="ae mt" href="https://mqttx.app/" rel="noopener ugc nofollow" target="_blank"> MQTTX </a>，这是一个用户友好的 MQTT 桌面应用程序，非常适合用于测试目的。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nz"><img src="../Images/3f5d1bca9caeb6c59e2e5e340b545804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWjP2mixYY_h85RIorfiOQ.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">创建新连接</figcaption></figure><h2 id="6691" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">连接到 EMQX 云</h2><p id="b805" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">单击 MQTTX 上的“新建连接”并填写连接表单:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nz"><img src="../Images/1f5936fbb3182e28de8fcc6393a89557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8Tm3c-sEdb3ybPzjUnd0g.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">设置连接详细信息</figcaption></figure><ol class=""><li id="0e60" class="lt lu in kk b kl lg kp lh kt lv kx lw lb lx lf ly lz ma mb bi translated">名称:连接名称。想用什么名字就用什么名字。</li><li id="9b0d" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">主机:MQTT 代理连接地址。与您在 InfluxDB 云设置中使用的相同。</li><li id="8262" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">端口:MQTT 代理连接端口。与您在 InfluxDB 云设置中使用的相同。</li><li id="5165" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">用户名/密码:在演示中，我使用与 InfluxDB 云配置中相同的凭证。如果需要，您可以在 EMQX Cloud 中添加新凭据。</li></ol><p id="3bc3" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">单击右上角的“Connect”按钮，连接应该已经建立。</p><h2 id="730b" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">向 EMQX 云发送消息</h2><p id="7320" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在您可以使用这个工具向 EMQX Cloud 上的 MQTT 代理发送消息。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oa"><img src="../Images/2ea6207ea894ea8d5ef34bec71f343b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3BUumoGJhugQm5PqFRltw.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">向 EMQX 云发送消息</figcaption></figure><p id="2ab9" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">输入:</p><ol class=""><li id="f089" class="lt lu in kk b kl lg kp lh kt lv kx lw lb lx lf ly lz ma mb bi translated">将有效负载格式设置为“JSON”。</li><li id="7962" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">设置主题:influxdb(我们刚刚设置的 InfluxDB 订阅的主题)</li><li id="1e58" class="lt lu in kk b kl mc kp md kt me kx mf lb mg lf ly lz ma mb bi translated">JSON 正文:<code class="fe nt nu nv nw b">{ "temperature": 25 }</code></li></ol><p id="bb08" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">单击右侧的发送图标。您可以更改温度值，并向 MQTT 代理发送更多数据。数据越多，图表在仪表板上显示的内容就越丰富。</p><h2 id="6b68" class="mh jl in bd jm mi mj dn jq mk ml dp ju kt mm mn jy kx mo mp kc lb mq mr kg ms bi translated">查看 InfluxDB Cloud 上的数据</h2><p id="6dac" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在，是时候查看 InfluxDB Cloud 上的数据了。理想情况下，您使用 MQTTX 发送的数据将进入 EMQX Cloud，然后被持久化到 InfluxDB Cloud 中的目标 bucket。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ob"><img src="../Images/5e0db99cb03d3ba0f914b91e7626e49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FN0nn1DAYhQEVAUrSOIhJQ.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">转到数据浏览器</figcaption></figure><p id="e468" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">让我们回到 InfluxDB Cloud，单击左侧菜单中的“数据浏览器”图标打开数据浏览器。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oc"><img src="../Images/798057d77abc56c44a682545417bbbaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp_gq_zrb3Tn2r0Oe32JDw.jpeg"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">进行查询以获取数据</figcaption></figure><p id="3081" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">通过设置 FROM，MEASUREMENT 在 UI 上创建一个查询，然后单击 submit 按钮，您应该能够看到数据图表。这证明你发送到 EMQX Cloud 的数据已经成功持久化到 InfluxDB Cloud。</p><h1 id="d45f" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">摘要</h1><p id="5729" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在，无需一行代码，您就可以使用 EMQX Cloud 从任何使用标准 MQTT 协议的设备或客户端获取数据，并专注于使用 InfluxDB Cloud 中持久存储的数据编写您的物联网应用程序。</p><p id="93b4" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在不到 10 分钟的时间内，您可以利用来自 EMQX Cloud 和 InfluxDB Cloud 的服务以及新的本机 MQTT 收集器，获得从接收到持久化的完整数据流。</p></div></div>    
</body>
</html>