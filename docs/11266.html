<html>
<head>
<title>How Does Ctyun Apply SeaTunnel to Their Data Integration Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ctyun 如何将 SeaTunnel 应用到他们的数据集成平台中</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-does-ctyun-apply-seatunnel-to-their-data-integration-platform-8729802dc9c3?source=collection_archive---------14-----------------------#2022-12-28">https://blog.devgenius.io/how-does-ctyun-apply-seatunnel-to-their-data-integration-platform-8729802dc9c3?source=collection_archive---------14-----------------------#2022-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/08d9eca1860efc16cc164fa4fc1139a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sUnAfzJd8nRlTKYDfIsvw.jpeg"/></div></div></figure><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi jv"><img src="../Images/37d57e215d2bfa81b076ff3455647797.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*d-EHsg_B4LIQO_gMjFcEnA.png"/></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated">演讲人:Ctyun 大数据开发工程师周厉王</figcaption></figure><p id="9bb1" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">11 月 26 日，在 Apache SeaTunnel 和 APISIX 的联席会议上，Ctyun 的大数据开发工程师周厉王分享了他在将 SeaTunnel 引入 Ctyun 数据集成平台过程中的实践。</p><p id="205b" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Ctyun 数据集成平台基于 Apache Nifi，但是 Apache Nifi 不能很好的满足一些特定的需求，需要引入第三方数据集成工具来补充能力。而 SeaTunnel 是一个很好的工具，可以补充 Nifi。在这里，我将从架构层面介绍将 SeaTunnel 集成到 Ctyun 数据平台的设计和思路。</p><p id="7091" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">本课题主要包括四个部分:</p><p id="634d" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">●阿帕奇海底隧道简介</p><p id="47a7" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Apache Nifi 简介</p><p id="30a9" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">●海底隧道和 Nifi 集成解决方案</p><p id="4ce3" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">● Ctyun 数据集成平台</p><p id="c8ed" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">●我参与开源的经历和思考</p><h1 id="8487" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">海底隧道简介</h1><p id="bc1a" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">Ctyun 平台主要面向政企客户。目前以 Apache Nifi 为核心，辅以原生 Flink 应用。在此基础上，对各种数据集成应用进行打包和二次开发，为不同行业提供解决方案。虽然目前 SeaTunnel 在我们公司还没有投产，但是我们已经在它上面做了很多探索，所以这个题目主要说一下我对 SeaTunnel 和 Nifi 结合使用的体会。因为两者各有利弊，所以在功能上可以互补，提供更多的功能，满足更多的客户需求。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/f25d386a0bb1af213e1338c94f3c5e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdN3O_MPWWprSJkHQm-9_Q.png"/></div></div></figure><p id="4fa8" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">SeaTunnel 本质上是一层 Spark 和 Flink 的封装。现在新版本增加了其自主开发的 SeaTunnel 发动机。用户可以通过编辑配置文件快速构建工作流。</p><p id="22c7" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">配置文件由四部分组成:</p><ul class=""><li id="d012" class="mg mh in kg b kh ki kl km kp mi kt mj kx mk lb ml mm mn mo bi translated">env 用于配置整体环境</li><li id="fa44" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">来源是配置数据源信息</li><li id="2127" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">转换与配置数据处理相关</li><li id="ae77" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">接收器配置数据的去向。</li></ul><p id="d0e3" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">与 kettle、Nifi 等重量级平台相比，SeaTunnel 更像是一个轻量级的数据传输工具。用户可以根据需要安装源、接收器和转换插件。</p><p id="d971" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">在数据源方面，SeaTunnel 支持关系数据库如 MySQL，和 Oracle，非关系数据库如 MongoDB，Redis 等。、文件类型，如 FTP、HDFS、ossFile、网络通信套接字、HTTP、消息队列、Kafka、Pulsar、数据湖等。，其中有许多类型。</p><p id="1691" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">转换插件支持大小写转换、替换、分段、SQL 和 uid 提取。用户也可以根据自己的需求定制插件。</p><p id="b09c" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">安装和启动 SeaTunnel 也非常方便。下载压缩包并解压后，根据要运行的任务类型运行相应的启动脚本。</p><p id="fb3e" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Spark 和 Flink 都有两个版本，v1 和 v2。现在他们也支持新的 SeaTunnel 引擎，启动方式也差不多。在这里，它支持向三种环境提交任务:local、yarn 和 k8s。</p><h1 id="87a7" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Nifi 简介</h1><p id="c790" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">Apache Nifi 是一个基于 web 的图形界面，它通过拖放、连接和配置来完成基于流程的编程。它可以在单个节点上运行，也可以以集群模式运行，集群的节点由 Zookeeper 协调。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/5c952181e6e1c63df8f1164ff32cf2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PtHvssAQ5jV4Y1VltHbkJg.png"/></div></div></figure><p id="cebb" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">图中显示了一个 Nifi 集群，每个矩形相当于一个 Nifi 节点。在其顶层，web 服务器接收这样的用户请求。每个节点的服务运行在一个 JVM 上，有一个处理器和流控制器支持业务逻辑的构建，而流文件是底层的数据结构，将存储在流文件存储库和内容存储库中。</p><p id="06a2" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Nifi 的常用组件主要包括五个部分</p><ul class=""><li id="9543" class="mg mh in kg b kh ki kl km kp mi kt mj kx mk lb ml mm mn mo bi translated">流文件</li><li id="ed3b" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">处理器</li><li id="119f" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">关系</li><li id="ba96" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">过程组</li><li id="8f21" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">控制器服务</li></ul><h2 id="e13d" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">流文件</h2><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/ffee0523b4e49ca7a666a9d2e86ec32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOS1YA7qeY53IK4RqXlnTg.png"/></div></div></figure><p id="4461" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">流文件是 Nifi 的底层数据结构。它由属性和内容组成。它的属性可以用来描述数据。例如，如果 putFile 组件向本地提供输出数据，则它输出的 FlowFile 的属性可以是文件名。这个 Flowfile 是一个抽象的概念，它可以通过配置放在内存或者硬盘上，用户可以通过查看队列(以可视化的形式)看到 Flowfile(其属性和相关内容)。</p><h2 id="813b" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">处理器</h2><p id="4b84" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">它是映射器的核心。处理者可以通过编排连接来构建工作流。常用的处理器还包括读取数据、转换数据和输入数据。</p><p id="adc9" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">处理器是 Nifi 的核心，它可以通过编排连接来构建工作流。常用的处理器包括读取数据、转换数据和输出数据。支持的组件总数约为三四百个。</p><p id="b5e9" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">每个组件都支持单独调度策略的配置，并支持定时调度和 cron 表达式调度。虽然 Nifi 有这么多组件，但是 CDC 组件相对较弱，只有 MySQL CDC，而且一些新的数据源读写组件是目前开源版本的 Nifi 所不支持的，比如数据湖胡迪、冰山等；</p><h2 id="223a" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">关系</h2><p id="3167" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">连接用于连接不同的处理器。它相当于一个队列。从上游传输的数据将进入该队列，直到数据被下游组件使用。该连接可以配置不同的优先级策略，以及数据到期时间和存储容量。等等；</p><h2 id="d0e7" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">处理器组</h2><p id="4e52" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">它用于将一组处理器组织在一起。外部数据可以通过 Nifi 端口组件输入和输出。远程处理器组是用户从远程进程(Nifi 实例)接收的数据。</p><h2 id="0b1f" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">控制器服务</h2><p id="609e" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">它相当于一个运行在后端的服务。它用于提取处理器使用的一些公共属性，比如用于连接数据库的 JDBC 连接池，以及用于达到重用目的的 Kerberos 身份验证服务。</p><h1 id="fc48" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">与 Nifi 的海底隧道集成</h1><h2 id="74d9" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">执行流程组件包隧道</h2><p id="6c98" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">第一种组合方法是用 Nifi 的 Execute Process 组件封装 SeaTunnel，利用 Nifi 的调度能力让它定期运行 SeaTunnel 任务。通常，如果您想首先调度 SeaTunnel 任务，您需要依赖 Apache DolphinScheduler 或其他调度工具。现在 SeaTunnel 有了 web 平台(UI 还在开发中)，将任务提交给 DolphinScheduler 进行调度。在这里使用 Nifi 提供了新的思路。</p><h2 id="ee05" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">构建 Nifi 工作流</h2><p id="39c6" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">在一个节点上部署 SeaTunnel 和 Nifi，可以通过 executeProcess 组件运行 SeaTunnel 启动脚本，SeaTunnel 运行日志会通过 head 节点传输到下游组件，head 节点可以通过这个推测节点，下游传播日志会包含一些任务相关的信息。</p><p id="dd15" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">如果任务启动成功，我们可以筛选出它的任务 id，得到任务 id 后，可以进一步控制任务，比如封装和停止任务，取消一些任务接口功能。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/2be4d34931db7e33d3d52d371cb37deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xsXF-sfJlANBks6IbDbaA.png"/></div></div></figure><p id="1dc9" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">上图显示了队列中的 SeaTunnel 运行日志。SeaTunnel 启动成功后，可以看到里面的任务 id，比如 Flink 作业 ID 和 applicationID，可以获取。</p><h2 id="848a" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">通过 Nifi 站点到站点协议构建 SeaTunnel -Nifi 连接器</h2><p id="151b" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">Nifi 实例之间的首选通信协议是 Nifi 站点到站点(S2S)协议。S2S 可以轻松、高效、安全地将数据从一个 Nifi 实例传输到另一个实例或其他应用程序或设备，通过 S2S 协议与 Nifi 进行通信。S2S 支持套接字协议和 HTTP(S)协议作为底层传输协议。</p><p id="8aef" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Nifi 可以基于站点到站点协议与外部 Nifi 节点或集群通信，也可以与外部应用程序通信。协议的底层是基于套接字和 HTTP 协议实现的。您可以使用 Nifi 的端口组件从外部接收数据或向外部系统发送数据。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/7e5523d7f28c564ba8572d69f2f5df68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dHAyOmZdJlPmoupe8y0GQ.png"/></div></div></figure><p id="5e9c" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">如图，左边的流程是外部数据通过输入口传输到 Nifi，右边的流程是 Nifi 数据通过端口传输到外部。</p><p id="4109" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">海底隧道 Nifi 连接器接收器</strong></p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/718a355b634bcc57fe45961505bc1e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o852QJW7pLaQzGyYaI3_Xw.png"/></div></div></figure><p id="0ebf" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">这是我做的海底隧道连接器水槽演示。它基于 SeaTunnel Flink v1 连接器，太幼稚了，无法提交到社区。以后完善了再提交。</p><p id="0625" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">因为 Nifi 的数据是流式的，所以首先我们实现了 FlinkStreamSink 接口，并重写了 outputStream 方法来将数据输出到 Nifi。我们需要在配置中指定 Nifi 的 URL 和目标端口，然后使用 Flink 内置的 Nifi Sink 组件输出数据。如果数据结构由内容和属性组成。此处的属性设置为空。我们可以根据需要在属性中添加一些附加信息。这里，Nifi 使用 Nifi 数据包数据结构。底层是基于站点到站点协议的实现。</p><p id="bf96" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">海底隧道 Nifi 连接器来源</strong></p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/8f3d887a3f77f7c2956fdb30bdaa6040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IivzqafDChcz6q6z_Xnpzw.png"/></div></div></figure><p id="839d" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">Nifi 连接器源的实现类似于接收器的实现。它基于 Flink 的 Nifi 源代码，通过 FlinkStreamSource 接口重写 getData 方法来实现。</p><p id="8968" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">类似的实现也可以用于基于火花发动机的连接器。</p><p id="f76b" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">通过 SeaTunnel 的 Nifi 连接器，可以方便地传输 Nifi 和 SeaTunnel 之间的数据，在某些场景下可以替代使用 Kafka 作为消息传输中间件的解决方案</p><h1 id="51c2" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Ctyun 数据集成平台</h1><h2 id="ade3" class="mu ld in bd le mv mw dn li mx my dp lm kp mz na lq kt nb nc lu kx nd ne ly nf bi translated">V1 海底隧道和 V2 API 工艺流程对比</h2><p id="3e66" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">核心连接器是基于 Apache Nifi 封装的。原生的 Nifi 对用户很不友好，对用户来说成本很高。</p><p id="9afb" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">虽然组件很多，非专业人士很难玩，但是它的能力还是很强大的，比如工作流安排、调度、统计监控、版本管理、血缘关系分析等。，甚至 mini Nifi 也支持从边缘收集物联网数据，所以我们在原生 Nifi 之上做了大量的包装，开发了很多常见的数据集成应用。</p><p id="08ac" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">对于我们的数据总线部分，底层使用的是 Flink。Flink 使用 Kafka 的数据写入 Hive 或其他目标。在上层应用中，将连接器向 Kafka 发送数据的任务进行封装，然后通过数据总线写入数据中心的数据仓库，接收 Kafka 数据并写入数据中心。</p><blockquote class="nh ni nj"><p id="7362" class="ke kf nk kg b kh ki kj kk kl km kn ko nl kq kr ks nm ku kv kw nn ky kz la lb ig bi translated">在探索过程中，我们也考虑过引进海底隧道。引入它有什么好处？首先，SeaTunnel 可以补充原有系统的一些 CDC 功能。</p><p id="cf54" class="ke kf nk kg b kh ki kj kk kl km kn ko nl kq kr ks nm ku kv kw nn ky kz la lb ig bi translated">1.因为 Nifi 的 CDC 组件只支持 MySQL 数据源，所以 Cloudera 官方并不推荐使用 Nifi 作为 CDC。即使 Nifi 提供了再开发能力，使用 Nifi 定制 CDC 组件也是成本高昂的。</p><p id="08c9" class="ke kf nk kg b kh ki kj kk kl km kn ko nl kq kr ks nm ku kv kw nn ky kz la lb ig bi translated">2.碰巧的是，SeaTunnel 是一个轻量级工具，支持丰富类型的组件，并依赖于 Flink 生态系统，使其适合 CDC 场景。另外，我们的数据总线部分本来是服务于中端产品内部数据仓库的，在新版本中 hive 也希望支持写更多的目标，也希望能够做一些简单的 ETL。</p><p id="e435" class="ke kf nk kg b kh ki kj kk kl km kn ko nl kq kr ks nm ku kv kw nn ky kz la lb ig bi translated">当然，我们可以通过自己开发更多的 Flink 程序来满足这一要求，但是我们发现，只要简单地修改解析配置，就可以将 SeaTunnel 集成到我们原来的系统中。</p></blockquote><p id="3a31" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">基于这两点，我来说说我们是怎么做的。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/c7b684bb6a1a70f3e5b779bb11dbb91b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S08J10gtkGHCBC9ryQrB0g.png"/></div></div></figure><p id="32a2" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">这是整个数据平台的<strong class="kg io">业务调用逻辑。用户在前端填写配置参数后，将参数发送给 web 服务，web 服务使用 Flink Yarn API 启动一个 Flink 应用程序。</strong></p><p id="7cbf" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">当然，在此之前，我们需要部署 Hadoop 等相关环境，Flink 需要依靠相关的包上传到 HDFS。</p><p id="11fe" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">那么我们如何将最初的 Flink 程序转换成 SeaTunnel 内核呢？</strong>一共 6 步！</p><p id="13c7" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">1.main 函数将 args 参数组织成一个映射；</p><p id="01a5" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">2.FlinkCommandArgs 添加一个 map 类型的成员变量；</p><p id="861f" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">3.FlinkApiTaskExecuteCommand 接收 FlinkCmmandArgs，在 execute()中，尝试将 map 传递给 ConfigBuilder</p><p id="48f7" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">4.修改 SeaTunnel-core-base 中的 ConfigBuilder，添加 loadByMap 方法；</p><p id="2158" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">5.loadByMap 方法在内部调用 ConfigFactory.parseMap 方法并返回 Config</p><p id="978a" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">6.重新包装 SeaTunnel-core-flink 模块；</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/98aa66f2408ba53ee21564def074c3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_2jQyYYEvVOlpOm7XSQrkw.png"/></div></div></figure><p id="a917" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">这张图是一个简单的演示。首先可以配置 SeaTunnel-core-flink.jar，放在 HDFS 上的一个路径下替换原来的 app，替换相关的 lib。使用的 SeaTunnel 插件也将放在 lib 目录中。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/694bb6c7949dc4ca2f973957a7ec8349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v3NCL7sZymgvluTNJidrsQ.png"/></div></div></figure><p id="8130" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">这里我要改的是程序运行的主类，<strong class="kg io">改成 org . Apache . sea tunnel . core . flink . seatunnellink，</strong>这样原来的数据总线部分就可以用 Flink 部分代替了。</p><p id="8beb" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">另一种形式是可以对 Nifi 进行二次开发，封装 SeaTunnel 组件，最后的结果是生成一个 nar 包(类似于 jar 包)，放在 Nifi 的 lib 目录下后生效。生成的组件可以与其他 Nifi 组件连接。该方法不同于前面提到的 executeProcess 组件启动 SeaTunnel，它可以实现更深层次的定制。比如重写 Nifi 处理器的 onStop 方法来控制 Spark 或 Flink 任务的停止，重写 OnTrigger 方法来处理数据，或者定义一个新的连接关系来处理异常数据。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/f28deafdc36b8df4e619914bdfb528a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XQpooBAZNfsmNMYAGt38MA.png"/></div></div></figure><p id="2094" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">该组件显示如图所示的效果。它可以将 SeaTunnel 需要的环境信息传递给组件，同时可以在自定义组件上定义 SeaTunnel 的参数，包括 env、source、transform、sink，还可以针对不同的数据源类型细分参数，这些参数很容易通过 Nifi API 从前端传递给 Nifi，所以这种形式可以很容易地将 SeaTunnel 放入 Nifi 系统中，将两者的能力结合起来。</p><h1 id="f073" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">我参与开源的经历和思考</h1><p id="994c" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">在我的工具研究和为 SeaTunnel 做贡献的过程中有一个很长的故事，感谢热心帮助我的社区成员。</p><p id="1fbf" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">在官网上获得更多关于 SeaTunnel 的信息后，我们团队发现 SeaTunnel 的引入可以为后续的平台开发节省大量的工作，于是我们开始制作 demos 进行验证，也尝试开发插件。正好社区发布了“连接器”开发者激励计划，我就试着把自己开发的插件提交给社区。</p><p id="043b" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">第一次提交 PR 有很多陷阱，因为如果你想为 SeaTunnel 社区提交代码，你不仅需要通过代码风格的测试，还要遵守相关的许可。代码检查过程花了我大约四天时间。</p><p id="4c76" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">在和社区的交流过程中，我发现运营助理很热心的帮我一起协调解决问题。我觉得这种氛围对用户和贡献者都很友好。非常棒的体验！</p><h1 id="1d30" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">关于海底隧道</h1><p id="2f94" class="pw-post-body-paragraph ke kf in kg b kh ma kj kk kl mb kn ko kp mc kr ks kt md kv kw kx me kz la lb ig bi translated">SeaTunnel(原 Waterdrop)是一个简单易用、超高性能的分布式数据集成平台，支持海量数据的实时同步，可以稳定高效地同步每天数千亿的数据。</p><p id="1eff" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">我们为什么需要海底隧道？</p><p id="442e" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">SeaTunnel 竭尽所能解决你在同步海量数据时可能遇到的问题。</p><ul class=""><li id="f34c" class="mg mh in kg b kh ki kl km kp mi kt mj kx mk lb ml mm mn mo bi translated">数据丢失和重复</li><li id="7ff4" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">任务构建和延迟</li><li id="bfc3" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">低吞吐量</li><li id="335c" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">从应用到生产周期长</li><li id="7334" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">缺乏应用程序状态监控</li></ul><p id="2f7a" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">海底隧道使用场景</strong></p><ul class=""><li id="79a9" class="mg mh in kg b kh ki kl km kp mi kt mj kx mk lb ml mm mn mo bi translated">海量数据同步</li><li id="aeb5" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">海量数据集成</li><li id="d184" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">大量数据的 ETL</li><li id="1189" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">海量数据聚合</li><li id="ec00" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">多源数据处理</li></ul><p id="2f49" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">海底隧道的特点</strong></p><ul class=""><li id="36a8" class="mg mh in kg b kh ki kl km kp mi kt mj kx mk lb ml mm mn mo bi translated">丰富的组件</li><li id="fb15" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">高可扩展性</li><li id="43c7" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">使用方便</li><li id="5fed" class="mg mh in kg b kh mp kl mq kp mr kt ms kx mt lb ml mm mn mo bi translated">成熟稳重</li></ul><p id="908e" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">如何快速上手 SeaTunnel？</strong></p><p id="7cbe" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">想快速体验海底隧道？SeaTunnel 2.1.0 只需 10 秒钟即可启动并运行。</p><p id="c4e9" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><a class="ae np" href="https://seatunnel.apache.org/docs/2.1.0/developement/setup" rel="noopener ugc nofollow" target="_blank">https://seatunnel.apache.org/docs/2.1.0/developement/setup</a></p><p id="f55e" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">我能做些什么？</strong></p><p id="77d4" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">我们邀请所有对本地开源全球化感兴趣的合作伙伴加入 SeaTunnel 贡献者大家庭，共同促进开源！</p><p id="b91e" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">提交问题:</p><p id="a844" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><a class="ae np" href="https://github.com/apache/incubator-seatunnel/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/incubator-seatunnel/issues</a></p><p id="e163" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">将代码贡献给:</p><p id="1ce1" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><a class="ae np" href="https://github.com/apache/incubator-seatunnel/pulls" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/incubator-seatunnel/pulls</a></p><p id="3200" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">订阅社区发展邮件列表:</p><p id="bb2a" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">dev-subscribe@seatunnel.apache.org</p><p id="2356" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">开发邮件列表:</p><p id="e392" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">dev@seatunnel.apache.org</p><p id="192b" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">加入时差:</p><p id="b915" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><a class="ae np" href="https://join.slack.com/t/apacheseatunnel/shared_invite/zt-1kcxzyrxz-lKcF3BAyzHEmpcc4OSaCjQ" rel="noopener ugc nofollow" target="_blank">https://join . slack . com/t/Apache seatunnel/shared _ invite/ZT-1 HSO 5 N2 TV-mkfkwxonc 70 heqgxtvi 34 w</a></p><p id="2423" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">关注 Twitter:</p><p id="58e1" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">https://twitter.com/ASFSeaTunnel<a class="ae np" href="https://twitter.com/ASFSeaTunnel" rel="noopener ugc nofollow" target="_blank"/></p><p id="50fd" class="pw-post-body-paragraph ke kf in kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">来加入我们吧！</p></div></div>    
</body>
</html>