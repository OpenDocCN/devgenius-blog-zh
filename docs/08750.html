<html>
<head>
<title>Azure Resource Manager Service Connection Using Azure DevOps CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Azure DevOps CLI 的 Azure 资源管理器服务连接</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/azure-resource-manager-service-connection-using-azure-devops-cli-ae6c6945f0b4?source=collection_archive---------4-----------------------#2022-07-07">https://blog.devgenius.io/azure-resource-manager-service-connection-using-azure-devops-cli-ae6c6945f0b4?source=collection_archive---------4-----------------------#2022-07-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/df1dc62d1b6d19d114ec146938550389.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*iA2FE5VREn-u4fe8a7JrLA.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">服务连接</figcaption></figure><p id="cdec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我将解释使用 azure devops cli 自动创建 azure devops 服务连接的过程。</p><p id="8448" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Azure DevOps 提供了为多个外部提供者创建服务连接的选项。然而，本文将关注 Azure 资源管理器的服务连接</p><p id="6a52" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">先决条件:</strong></p><ol class=""><li id="5406" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">你有一个 Azure DevOps 项目</li><li id="3048" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">您已经在本地计算机中配置了 Azure CLI</li></ol><p id="a83b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">安装 Azure CLI: </strong>按照<a class="ae lh" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" rel="noopener ugc nofollow" target="_blank">安装 Azure CLI </a>中提供的说明来设置您的 Azure CLI 环境。至少，您的 Azure CLI 版本必须是 2.10.1。</p><p id="76b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.您拥有有效的 Azure 订阅</p><h1 id="cbbd" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">步伐</h1><ol class=""><li id="bf97" class="kt ku in jx b jy mg kc mh kg mi kk mj ko mk ks ky kz la lb bi translated">使用以下命令创建服务主体并保存信息</li></ol><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="518a" class="mu lj in mq b gy mv mw l mx my">az ad sp create-for-rbac --name myServicePrincipalName --role Contributor --scopes /subscriptions/mySubscriptionID</span></pre><p id="1d06" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.添加 Azure DevOps 扩展:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="8da7" class="mu lj in mq b gy mv mw l mx my">az extension add --name azure-devops</span></pre><p id="eb90" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.配置默认 Azure DevOps 项目</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="83bd" class="mu lj in mq b gy mv mw l mx my">az devops configure --defaults organization=<a class="ae lh" href="https://dev.azure.com/contoso" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/contoso</a> project=ContosoWebApp</span></pre><blockquote class="mz na nb"><p id="28a3" class="jv jw nc jx b jy jz ka kb kc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ks ig bi translated">用您自己的价值观替换组织和项目的价值观</p></blockquote><p id="b1ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">4.创建服务连接</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d612" class="mu lj in mq b gy mv mw l mx my">az devops service-endpoint azurerm create --azure-rm-service-principal-id &lt;value&gt;--azure-rm-subscription-id &lt;value&gt; --azure-rm-subscription-name &lt;value&gt; --azure-rm-tenant-id &lt;value&gt; --name &lt;value&gt;</span></pre><blockquote class="mz na nb"><p id="1fa2" class="jv jw nc jx b jy jz ka kb kc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ks ig bi translated">用之前创建的服务连接替换这些值</p><p id="8183" class="jv jw nc jx b jy jz ka kb kc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ks ig bi translated">注意:<code class="fe ng nh ni mq b">az devops service-endpoint azurerm create</code>命令使用提示消息询问服务主体密码/秘密。</p><p id="a921" class="jv jw nc jx b jy jz ka kb kc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ks ig bi translated">出于自动化的目的，使用<code class="fe ng nh ni mq b">AZURE_DEVOPS_EXT_AZURE_RM_SERVICE_PRINCIPAL_KEY</code>环境变量设置服务主体密码/秘密。</p></blockquote><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="5be0" class="mu lj in mq b gy mv mw l mx my">Bash:<br/>export AZURE_DEVOPS_EXT_AZURE_RM_SERVICE_PRINCIPAL_KEY=&lt;your_secret_here&gt;</span><span id="be8d" class="mu lj in mq b gy nj mw l mx my">PowerShell:<br/>$env:AZURE_DEVOPS_EXT_AZURE_RM_SERVICE_PRINCIPAL_KEY=&lt;your_secret_here&gt;</span></pre></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><h1 id="cdb7" class="li lj in bd lk ll nr ln lo lp ns lr ls lt nt lv lw lx nu lz ma mb nv md me mf bi translated">更新服务连接权限</h1><ol class=""><li id="a430" class="kt ku in jx b jy mg kc mh kg mi kk mj ko mk ks ky kz la lb bi translated">使用以下命令获取服务连接的 id</li></ol><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="2e33" class="mu lj in mq b gy mv mw l mx my">az devops service-endpoint list --output table</span></pre><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nw"><img src="../Images/2759fdd1f404b3d65f880307e0edd3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb5QwIcIyXgOAkZtR_uuMg.jpeg"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">关系</figcaption></figure><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/873983d86a959d39e53cd8814560a0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*xN_VqlKUVqtmKb1W66HQKw.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">以前</figcaption></figure><p id="d9b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.更新所有管道的权限</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="f726" class="mu lj in mq b gy mv mw l mx my">az devops service-endpoint update --id ad3b65ba-dd6a-4b53-a907-fa88531a6d73 --enable-for-all</span></pre><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/084c24d5ee3cac955422e02a0ef813e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*AjOcd1Nc99gbi5p43Vomcg.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">在...之后</figcaption></figure><p id="9f6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">其他资源:</strong></p><div class="od oe gp gr of og"><a href="https://docs.microsoft.com/en-us/azure/devops/cli/service-endpoint?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">使用 Azure DevOps CLI 创建服务端点</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">使用 az devops service-endpoint 命令，您可以创建和管理不同类型的服务连接。一个…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">docs.microsoft.com</p></div></div><div class="op l"><div class="oq l or os ot op ou jp og"/></div></div></a></div><p id="deb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望你喜欢阅读这篇文章，随时添加你的评论、想法或反馈，不要忘记在 linkedin 上联系。</p></div></div>    
</body>
</html>