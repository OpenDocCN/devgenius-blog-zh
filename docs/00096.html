<html>
<head>
<title>How To Save Data To Apple Health in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Swift中将数据保存到Apple Health</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-save-data-to-apple-health-in-swift-1a5982a4e8f3?source=collection_archive---------0-----------------------#2019-12-04">https://blog.devgenius.io/how-to-save-data-to-apple-health-in-swift-1a5982a4e8f3?source=collection_archive---------0-----------------------#2019-12-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="c7e0" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">学习如何将健康信息存储到Apple Health的教程</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/c740a8862a79049f135e7e1417fa326c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ezWFqYYe9CChYosa"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/@williamtm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="057b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><a class="ae kw" href="https://www.apple.com/ios/health/" rel="noopener ugc nofollow" target="_blank">苹果健康</a>是2014年公布的健康信息学app，随iOS 8或更高版本提供。HealthKit是iOS SDK中包含的API，软件开发人员使用它来创建可以保存/读取iOS上的Apple Health应用程序的应用程序。</p><p id="b51b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在本教程中，我将用几行代码解释如何将数据和信息保存到Apple Health。</p></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><h1 id="4810" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">入门指南</h1><p id="2bc4" class="pw-post-body-paragraph kx ky ir kz b la ms js lc ld mt jv lf lg mu li lj lk mv lm ln lo mw lq lr ls ik bi translated">首先，打开Xcode 并创建一个新项目。选择<em class="mx">单视图应用</em>。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj my"><img src="../Images/a611ddb231ac53bf70fbb02e6079b88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RK1H7VgQevx_aDSJFNPX1w.png"/></div></div></figure><p id="ff15" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后创建一个新类，命名为<code class="fe mz na nb nc b">HealthKitAssistant</code>。在这里，我们把所有的方法，我们将使用保存苹果健康的数据。</p><p id="9720" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">进入<code class="fe mz na nb nc b">Main.Storyboard</code>文件，在顶部添加一个<code class="fe mz na nb nc b">DatePicker</code>，在中间添加一个<code class="fe mz na nb nc b">TextField</code>，在屏幕底部添加一个<code class="fe mz na nb nc b">Button</code>。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nd"><img src="../Images/f8b54d315f5f822d6d8498433de4d32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zL1wEm3VM6CApTCeV2bAsA.png"/></div></div></figure><p id="ac5d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">转到您的项目设置，选择<code class="fe mz na nb nc b">Signing &amp; Capabilities</code>和<code class="fe mz na nb nc b">Add HealthKit</code>以允许您的应用程序请求用户许可，然后存储/检索健康信息。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ne"><img src="../Images/48669c5aa14e3ec5d2f3bf0d9b7474db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQOOZKnJdiWLy6BqkmCE3w.png"/></div></div></figure><p id="4a6e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了访问用户信息，您需要做的最后一步是在<code class="fe mz na nb nc b">Info.plist</code>文件中添加以下键:</p><pre class="kh ki kj kk gu nf nc ng nh aw ni bi"><span id="3878" class="nj mb ir nc b gz nk nl l nm nn">&lt;key&gt;NSHealthShareUsageDescription&lt;/key&gt;<br/>&lt;string&gt;"Please give us the reading permission to allow the app to work."&lt;/string&gt;<br/>&lt;key&gt;NSHealthUpdateUsageDescription&lt;/key&gt;<br/>&lt;string&gt;"Please give us the update permission to add data into Apple Health."&lt;/string&gt;</span></pre></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><h1 id="ba45" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">履行</h1><p id="7106" class="pw-post-body-paragraph kx ky ir kz b la ms js lc ld mt jv lf lg mu li lj lk mv lm ln lo mw lq lr ls ik bi translated">首先，我们将第一个方法添加到<code class="fe mz na nb nc b">HealthKitAssistant</code>文件中。需要使用此方法向用户请求授权，以从设备读取和写入数据:</p><pre class="kh ki kj kk gu nf nc ng nh aw ni bi"><span id="2f6f" class="nj mb ir nc b gz nk nl l nm nn">public class func authorizeHealthKit(completion: @escaping (Bool, Error?) -&gt; Swift.Void) {<br/>        guard HKHealthStore.isHealthDataAvailable() else {<br/>            completion(false, HealthkitSetupError.notAvailableOnDevice)<br/>            return<br/>        }<br/> <br/>        guard let stepsCount = HKObjectType.quantityType(forIdentifier: .stepCount) else {<br/>                completion(false, HealthkitSetupError.dataTypeNotAvailable)<br/>                return<br/>        }<br/>        <br/>        let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [stepsCount,<br/>                                                        HKObjectType.workoutType()]<br/>        <br/>        let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [stepsCount,<br/>                                                       HKObjectType.workoutType()]<br/>        <br/>        HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite,<br/>                                             read: healthKitTypesToRead) { (success, error) in<br/>                                                completion(success, error)<br/>        }<br/>        <br/>    }</span></pre><p id="1147" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后我们添加一个方法来写关于Apple Health的步骤数据:</p><pre class="kh ki kj kk gu nf nc ng nh aw ni bi"><span id="9740" class="nj mb ir nc b gz nk nl l nm nn">public class func saveSteps(stepsCountValue: Int,<br/>                             date: Date,<br/>                             completion: @escaping (Error?) -&gt; Swift.Void) {<br/>        <br/>        guard let stepCountType = HKQuantityType.quantityType(forIdentifier: .stepCount) else {<br/>            fatalError("Step Count Type is no longer available in HealthKit")<br/>        }<br/>        <br/>        let stepsCountUnit:HKUnit = HKUnit.count()<br/>        let stepsCountQuantity = HKQuantity(unit: stepsCountUnit,<br/>                                           doubleValue: Double(stepsCountValue))<br/>        <br/>        let stepsCountSample = HKQuantitySample(type: stepCountType,<br/>                                               quantity: stepsCountQuantity,<br/>                                               start: date,<br/>                                               end: date)<br/>        <br/>        HKHealthStore().save(stepsCountSample) { (success, error) in<br/>            <br/>            if let error = error {<br/>                completion(error)<br/>                print("Error Saving Steps Count Sample: \(error.localizedDescription)")<br/>            } else {<br/>                completion(nil)<br/>                print("Successfully saved Steps Count Sample")<br/>            }<br/>        }<br/>        <br/>    }</span></pre><p id="5e5f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在在<code class="fe mz na nb nc b">ViewController</code>文件上，我们将调用<code class="fe mz na nb nc b">viewDidLoad</code>上的<code class="fe mz na nb nc b">authorizeHealthKit</code>方法。向用户显示一条提示消息，授予我们的应用对健康数据的读/写访问权限。</p><pre class="kh ki kj kk gu nf nc ng nh aw ni bi"><span id="3747" class="nj mb ir nc b gz nk nl l nm nn">HealthKitSetupAssistant.authorizeHealthKit { (result, error) in<br/>            if result {<br/>                print("Auth ok")<br/>            } else {<br/>                print("Auth denied")<br/>            }<br/>            <br/>        }</span></pre><p id="6008" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后在<code class="fe mz na nb nc b">saveButton</code>动作上添加以下代码:</p><pre class="kh ki kj kk gu nf nc ng nh aw ni bi"><span id="a6fd" class="nj mb ir nc b gz nk nl l nm nn">@IBAction func saveButton(_ sender: Any) {<br/>        guard let value = textFieldValue.text else {<br/>            return<br/>        }<br/>        <br/>        HealthKitSetupAssistant.saveSteps(stepsCountValue: Int(value)!, date: datePicker.date) { (error) in<br/>            print(error)<br/>        }<br/>        <br/>    }</span></pre></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><h1 id="b5d0" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">试验</h1><p id="1046" class="pw-post-body-paragraph kx ky ir kz b la ms js lc ld mt jv lf lg mu li lj lk mv lm ln lo mw lq lr ls ik bi translated">我们已经准备好测试应用程序了！</p><p id="ca02" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">运行模拟器并允许健康访问应用程序。然后，选择日期和时间。最后，在文本字段上写一个值，并点击<code class="fe mz na nb nc b">Save</code>按钮。</p><p id="af99" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果你现在打开苹果健康应用程序，你会看到一个新的步骤数据记录！</p><div class="kh ki kj kk gu ab cb"><figure class="no kl np nq nr ns nt paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/632ce0f79cc8a5e5e8954259a887b7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ccvoKB4jaKnwlOe-T0pUAw.png"/></div></figure><figure class="no kl np nq nr ns nt paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/f8efe98ecf288e5f8d5ea098c6e92bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*QlTkIvm4snq2q_UeFZw6sw.png"/></div></figure><figure class="no kl np nq nr ns nt paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/eba92733ddcce12156a308063f479755.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*PLlFjWGh4OfqQFV_ETx8SQ.png"/></div></figure></div></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj nu"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><h1 id="4b3f" class="ma mb ir bd mc md nv mf mg mh nw mj mk jx nx jy mm ka ny kb mo kd nz ke mq mr bi translated">完整代码</h1><p id="254f" class="pw-post-body-paragraph kx ky ir kz b la ms js lc ld mt jv lf lg mu li lj lk mv lm ln lo mw lq lr ls ik bi translated">你可以在<a class="ae kw" href="https://github.com/domeniconicoli/SaveAppleHealthDataExample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到更多数据类型的完整代码，一个读取数据的方法和一个删除数据的方法。</p><p id="168e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">感谢您的阅读。如果你有任何问题或建议，请在评论中告诉我。</p></div></div>    
</body>
</html>