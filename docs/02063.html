<html>
<head>
<title>All you need to know to get started with the Kube Scheduler (Kubernetes)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用Kube调度程序(Kubernetes)所需要知道的一切</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/all-you-need-to-know-to-get-started-with-the-kube-scheduler-kubernetes-8d9b18bc97fe?source=collection_archive---------7-----------------------#2020-07-18">https://blog.devgenius.io/all-you-need-to-know-to-get-started-with-the-kube-scheduler-kubernetes-8d9b18bc97fe?source=collection_archive---------7-----------------------#2020-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0475" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来谈谈Kubernetes中的Kube调度程序。</p><p id="52b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读完这篇文章后，你会有:</p><ul class=""><li id="2599" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">从高层次理解kube调度程序。</li><li id="0705" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">已安装kube调度程序。</li></ul><p id="db6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想重温kubernetes集群的整体架构，我建议您查看我以前的文章，因为它将帮助您从这篇文章中获得最大收益。<a class="ae kz" href="https://medium.com/dev-genius/the-kubernetes-cluster-architecture-simplified-3c4a5fb41449" rel="noopener">链接此处</a></p><p id="8dde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="la">kubernetes调度器负责调度节点</em> </strong> <em class="la">上的pod。</em></p><p id="332d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，为了清楚起见，调度器<strong class="jp ir">只负责决定哪个pod在哪个节点</strong>上。它实际上并没有把pod放在节点上，那是kubelet的责任。</p><p id="0450" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">船上的<strong class="jp ir"> kubelet </strong>或“船长”(节点)是在船上创建pod的人。调度程序只决定哪个舱去哪里。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/288b1a88188768c1ef1889d4c02fb212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gn2Wb2filIturn-41wbHbQ.jpeg"/></div></div></figure><h1 id="c6d9" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">为什么需要一个调度程序？</h1><p id="42b0" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">当有许多船和许多集装箱时，你要确保正确的集装箱最终到达正确的船上。</p><p id="efdf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用kubernetes的话来说:您希望确保正确的pod最终出现在适当的节点上。</p><p id="1747" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><ul class=""><li id="0516" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">可能有不同大小的船只和集装箱。</li><li id="27b9" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">你要确保船有足够的容量来容纳那些集装箱。</li><li id="df8d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">不同的船可能去不同的目的地。</li></ul><p id="a25b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你要确保你的集装箱被放在正确的船上，以便它们最终到达正确的目的地。</p><p id="e2cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，在kubernetes中，调度程序根据某些标准决定将pod放在哪个节点上:</p><ul class=""><li id="c13b" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">您可能有不同资源需求的pod，</li><li id="de6e" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">您可以让群集中的节点专用于某些应用程序。</li></ul><h1 id="d4b7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">调度程序如何分配这些单元？</h1><p id="f5e7" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">调度程序会查看每个单独的POD，并尝试找到托管它的最佳节点。</p><p id="e706" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一个例子来说明:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mq"><img src="../Images/69d660d7f6284b9ad504d8ec8de11bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-ldCTHsaTZyQhlTkJRQ1A.jpeg"/></div></div></figure><p id="a6ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">蓝色的大POD有一组上面描述的CPU和内存需求。</p><p id="f850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调度程序通过两个阶段来确定pod的最佳节点:</p><ol class=""><li id="541b" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mr kr ks kt bi translated">调度程序会尝试过滤掉不符合此pod配置文件的节点。</li><li id="d2ac" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mr kr ks kt bi translated">调度程序对节点进行排序，以确定最适合pod的节点。</li></ol><p id="84c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于第一步，不具有pod所请求的足够CPU和内存资源的节点将被丢弃。</p><p id="57a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以前三个小节点被过滤掉了。我们现在剩下两个可以放置POD的节点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ms"><img src="../Images/f7ab11f309f8d23e28400f6002f0a300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcunG-FqxtO6CkMXiYArSQ.jpeg"/></div></div></figure><p id="2d23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，调度程序如何从剩余的两个pod中选择一个呢？</p><p id="3fc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第二步中，使用优先级函数在0到10的范围内给节点分配分数。</p><p id="f28a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调度程序计算将pod放在节点上后节点上的空闲资源量。</p><p id="b280" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，如果将pod放在右边的设备上，右边的设备将有6个空闲CPU，比另一个设备多4个，因此它获得了更好的等级。</p><p id="b220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以它“赢”了。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mt"><img src="../Images/1f3c78888e3962a0b8a48d47fa27577f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*93Qc1Kax8nsKhhBIwstDDQ.jpeg"/></div></div></figure><p id="17c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是调度程序在高层次上的工作方式。</p><p id="3edd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，这些可以定制，您也可以编写自己的调度程序。</p><p id="024e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在排班方面还有很多话题需要讨论，例如:</p><ul class=""><li id="6d52" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">所需资源</li><li id="d522" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">限制</li><li id="baf8" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">污点和宽容</li><li id="4c52" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">节点选择器</li><li id="051d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">相似性规则</li></ul><p id="6f4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些将会在接下来的文章中更详细的讨论。</p><p id="0696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将继续关注高级调度程序。</p><h1 id="f373" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">你如何安装kube-scheduler？</h1><p id="3a0d" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">从kubernetes发布页面下载kube-scheduler。提取它并将其作为服务运行:</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="f605" class="mz lo iq mv b gy na nb l nc nd">wget <a class="ae kz" href="https://storage-googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-scheduler" rel="noopener ugc nofollow" target="_blank">https://storage-googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-scheduler</a><br/></span><span id="2a9b" class="mz lo iq mv b gy ne nb l nc nd">kube-scheduler.service</span></pre><h1 id="b388" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">如何看待kube-scheduler服务器选项？</h1><p id="782e" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">如果使用kubeadm工具进行设置，kubeadm会将kube-scheduler作为一个pod部署在主节点上的kube-system名称空间中。</p><p id="eca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在位于以下位置的pod定义文件中看到这些选项:</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="b86e" class="mz lo iq mv b gy na nb l nc nd">cat /etc/kubernetes/manifests/kube-scheduler.yaml</span></pre><p id="60c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，通过列出主节点上的流程并搜索kube-scheduler，您可以看到正在运行的流程和有效的选项。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="7bbe" class="mz lo iq mv b gy na nb l nc nd">ps -aux | grep kube-scheduler</span></pre></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="6544" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">原载于</em> <a class="ae kz" href="https://luispreciado.blog/posts/kubernetes/core-concepts/schedulers" rel="noopener ugc nofollow" target="_blank"> <em class="la">我的博客</em> </a> <em class="la">。</em></p></div></div>    
</body>
</html>