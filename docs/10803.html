<html>
<head>
<title>Implementing Pinterest-like layout using compositional layout</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨å¤åˆå¸ƒå±€å®ç°ç±»ä¼¼ Pinterest çš„å¸ƒå±€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/implementing-pinterest-like-layout-using-compositional-layout-a21d8ae49d18?source=collection_archive---------1-----------------------#2022-12-01">https://blog.devgenius.io/implementing-pinterest-like-layout-using-compositional-layout-a21d8ae49d18?source=collection_archive---------1-----------------------#2022-12-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/baa0ae1822c0a8d2e5f2b541ff8f5063.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*I0_MWAXElTHvDvECzvGlJg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">æˆªå›¾å–è‡ª Pinterest app</figcaption></figure><p id="eed9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ç±»ä¼¼ Pinterest çš„å¸ƒå±€å¹¶ä¸æ˜¯ä¸€ä¸ªå°šæœªè§£å†³æˆ–æœ‰äº‰è®®è§£å†³æ–¹æ¡ˆçš„æ–°é—®é¢˜ã€‚äº’è”ç½‘ä¸Šæœ‰å¾ˆå¤šåº“å…è®¸ä½ ä»¥é©¬èµ›å…‹çš„æ–¹å¼æ˜¾ç¤ºå•å…ƒæ ¼â€”â€”ä¾‹å¦‚<a class="ae kx" href="https://github.com/sgr-ksmt/WaterfallLayout" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>ã€‚</p><p id="cb2c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ç„¶è€Œï¼Œå¤§å¤šæ•°éƒ½ä¾èµ–äºå®ç°ä¸€ä¸ªå®šåˆ¶çš„<strong class="kb io"> UICollectionViewLayout </strong>å­ç±»ï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»æœ‰ä¸€æ®µæ—¶é—´æœ‰äº†ä¸€ä¸ªæ–°çš„ç»„åˆå¸ƒå±€ APIâ€”â€”<a class="ae kx" href="https://developer.apple.com/documentation/uikit/uicollectionviewcompositionallayout" rel="noopener ugc nofollow" target="_blank">uicollectionviewscompositionallayout</a></p><p id="a2b0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä½¿ç”¨è‡ªå®šä¹‰ UICollectionViewLayout ä¼šé™åˆ¶æ‚¨åœ¨æ”¶è—è§†å›¾ä¸­æ‹¥æœ‰ä¸åŒçš„å¸ƒå±€éƒ¨åˆ†ï¼Œå› ä¸ºæ‚¨åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ”¶è—è§†å›¾çš„å¸ƒå±€å®ä¾‹:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="87a5" class="lh li in ld b be lj lk l ll lm">let layout = WaterfallLayout() <br/>collectionView.collectionViewLayout = layout</span></pre><h1 id="3a47" class="ln li in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">é€šè¿‡ç»„åˆå¸ƒå±€æ„å»ºé©¬èµ›å…‹å¸ƒå±€çš„å¯èƒ½æ–¹å¼</h1><p id="f7e4" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">å½“æˆ‘åœ¨å¯»æ‰¾ä½¿ç”¨ç»„åˆæ–¹å¼å¼•å…¥ç€‘å¸ƒå¸ƒå±€çš„åº“æ—¶ï¼Œæˆ‘å‘ç°äº†åœ¨ä¸€ä¸ªå‚ç›´ç»„ä¸­ç»„åˆä¸åŒé«˜åº¦çš„é¡¹ç›®æ¥æ„å»º secion çš„è§£å†³æ–¹æ¡ˆã€‚</p><p id="3369" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">è®©æˆ‘ä»¬çœ‹çœ‹å®ç°è¿™ç§æ–¹æ³•çš„åº“ã€‚å®ƒæœ‰<strong class="kb io">ç€‘å¸ƒå¸ƒå±€</strong>ï¼Œå°†ä¸‰ä¸ªä¸åŒé«˜åº¦çš„é¡¹ç›®ç»„åˆåœ¨ä¸€ä¸ªå‚ç›´ç»„ä¸­ã€‚</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="09d0" class="lh li in ld b be lj lk l ll lm">let leadingItemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(0.5), heightDimension: .fractionalHeight(1.0)) <br/>let leadingItem = NSCollectionLayoutItem(layoutSize: leadingItemSize) <br/>leadingItem.contentInsets = NSDirectionalEdgeInsets(top: 8, leading: 8, bottom: 8, trailing: 8)<br/>let trailingItemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1.0), heightDimension: .fractionalHeight(0.3)) <br/>let trailingItem = NSCollectionLayoutItem(layoutSize: trailingItemSize) <br/>trailingItem.contentInsets = NSDirectionalEdgeInsets(top: 8, leading: 8, bottom: 8, trailing: 8) <br/>let trailingLeftGroup = NSCollectionLayoutGroup.vertical(<br/>  layoutSize: NSCollectionLayoutSize(<br/>    widthDimension: .fractionalWidth(0.25), <br/>    heightDimension: .fractionalHeight(1.0)<br/>  ), <br/>  subitem: trailingItem, <br/>  count: 2) <br/>let trailingRightGroup = NSCollectionLayoutGroup.vertical(<br/>  layoutSize: NSCollectionLayoutSize(<br/>    widthDimension: .fractionalWidth(0.25), <br/>    heightDimension: .fractionalHeight(1.0)<br/>  ), <br/>  subitem: trailingItem, <br/>  count: 2<br/>) <br/>...</span></pre><p id="f3a6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">åœ¨å±å¹•ä¸Šçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/30c4acca592bd608cedd96e29fb0cacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*ElFTE-nBrMzguiYRZcxV9g.jpeg"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">æ¥è‡ª cmpositional-layout-kit-repo çš„å±å¹•æˆªå›¾</figcaption></figure><p id="d81e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å®ƒæœ‰å‡ ä¸ªç¼ºç‚¹ï¼Œä¾‹å¦‚:</p><ul class=""><li id="684e" class="mp mq in kb b kc kd kg kh kk mr ko ms ks mt kw mu mv mw mx bi translated">è¿™ç§æ¨¡å¼æ˜¯é‡å¤çš„â€”â€”æ¯ä¸‰ä¸ªé¡¹ç›®éƒ½æœ‰ç›¸åŒçš„ç»“æ„é«˜åº¦</li><li id="28ac" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">å®ƒä½¿ç”¨åˆ†æ•°é«˜åº¦-ä¾èµ–äºé›†åˆè§†å›¾æ¡†æ¶é«˜åº¦ï¼Œè€Œä¸æ˜¯å•ç‹¬é¡¹ç›®æ‰€éœ€çš„é«˜åº¦</li></ul><p id="573e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘å¶ç„¶å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ API uicollectionview compositionallayout hasâ€”<a class="ae kx" href="https://developer.apple.com/documentation/uikit/nscollectionlayoutgroup/3213853-custom" rel="noopener ugc nofollow" target="_blank">è‡ªå®šä¹‰ç»„åˆ›å»º</a>ã€‚æˆ‘è¿˜å‘ç°<a class="ae kx" href="https://github.com/lucamegh/Niagara" rel="noopener ugc nofollow" target="_blank">æœ‰ä¸€ä¸ªåº“</a>å®ç°äº†è¿™ç§æ–¹æ³•ã€‚å¤§å®¶å¦¥å¦¥çš„çœ‹ä¸€ä¸‹ï¼Œè¯•ç€è‡ªå·±å»å®ç°ã€‚</p><h1 id="6f38" class="ln li in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">å±¥è¡Œ</h1><h2 id="657e" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">è‡ªå®šä¹‰ç»„ API</h2><p id="0bbf" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">åˆ›å»ºè‡ªå®šä¹‰ NSCollectionLayoutGroup å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="4a5f" class="lh li in ld b be lj lk l ll lm">public typealias NSCollectionLayoutGroupCustomItemProvider = (NSCollectionLayoutEnvironment) -&gt; [NSCollectionLayoutGroupCustomItem] <br/>class func custom(<br/>  layoutSize: NSCollectionLayoutSize, <br/>  itemProvider: @escaping NSCollectionLayoutGroupCustomItemProvider<br/>) -&gt; Self</span></pre><p id="7782" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å¯¹äºæ¯ä¸€ä¸ª<strong class="kb io">NSCollectionLayoutGroupCustomItem</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åœ¨é›†åˆè§†å›¾ä¸­è®¾ç½®å”¯ä¸€çš„æ¡†æ¶ã€‚</p><p id="4c54" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å¯¹é½å…ƒç´ â€”â€”ä»»æ„åˆ—æ•°ï¼Œä»»æ„é«˜åº¦ï¼Œä»»æ„é¡ºåºã€‚</p><h2 id="66ce" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">å¸ƒå±€å‚æ•°</h2><p id="7835" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">å‡è®¾æ‚¨å¸Œæœ›åˆ—æ•°ã€æ¯ä¸ªé¡¹ç›®çš„é«˜åº¦å’Œé¡¹ç›®é—´è·éƒ½å¯ä»¥é…ç½®ã€‚æˆ‘ä»¬å¸ƒå±€çš„é…ç½®ç»“æ„å¯ä»¥æ˜¯è¿™æ ·çš„:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="0ca2" class="lh li in ld b be lj lk l ll lm">typealias ItemHeightProvider = (_ index: Int, _ itemWidth: CGFloat) -&gt; CGFloat<br/>typealias ItemCountProvider = () -&gt; Int<br/><br/>struct Configuration {<br/>    public let columnCount: Int<br/>    public let interItemSpacing: CGFloat<br/>    public let contentInsetsReference: UIContentInsetsReference<br/>    public let itemHeightProvider: ItemHeightProvider<br/>    public let itemCountProvider: ItemCountProvider<br/>    <br/>    /// Initialization for configuration of waterfall compositional layout section<br/>    /// - Parameters:<br/>    ///   - columnCount: a number of columns<br/>    ///   - interItemSpacing: a spacing between columns and rows<br/>    ///   - contentInsetsReference: a reference point for content insets for a section<br/>    ///   - itemCountProvider: closure providing a number of items in a section<br/>    ///   - itemHeightProvider: closure for providing an item height at a specific index<br/>    public init(<br/>        columnCount: Int = 2,<br/>        interItemSpacing: CGFloat = 8,<br/>        contentInsetsReference: UIContentInsetsReference = .automatic,<br/>        itemCountProvider: @escaping ItemCountProvider,<br/>        itemHeightProvider: @escaping ItemHeightProvider<br/>    ) {<br/>        self.columnCount = columnCount<br/>        self.interItemSpacing = interItemSpacing<br/>        self.contentInsetsReference = contentInsetsReference<br/>        self.itemCountProvider = itemCountProvider<br/>        self.itemHeightProvider = itemHeightProvider<br/>    }<br/>}</span></pre><h2 id="2c35" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">æ€»ä½“æ­¥éª¤</h2><p id="a872" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">è¿™äº›å‚æ•°è¶³ä»¥æ„å»ºå¯å®šåˆ¶çš„ç€‘å¸ƒå¸ƒå±€ã€‚å®æ–½æ­¥éª¤å¦‚ä¸‹:</p><ul class=""><li id="e335" class="mp mq in kb b kc kd kg kh kk mr ko ms ks mt kw mu mv mw mx bi translated">è®¡ç®—åˆ—å®½</li><li id="4daf" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">åˆ›å»ºä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨åˆ—é«˜åº¦</li><li id="68c4" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">è®¡ç®—é¡¹ç›®æ¡†æ¶</li><li id="c1bf" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">ä¸ºé›†åˆè§†å›¾ä¸­çš„æ¯ä¸ªç´¢å¼•åˆ›å»º<strong class="kb io">NSCollectionLayoutGroupCustomItem</strong>å®ä¾‹</li><li id="21ef" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">è¿”å›<strong class="kb io">NSCollectionLayoutGroupCustomItemProvider</strong>ä¸­çš„è‡ªå®šä¹‰é¡¹æ•°ç»„</li><li id="7066" class="mp mq in kb b kc my kg mz kk na ko nb ks nc kw mu mv mw mx bi translated">è®¡ç®—ç»„é«˜åº¦</li></ul><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/f11e8ccfa1396ecf49e0c3cefdbc0170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5Kiibx82JDOY1fPi6wGpQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">å®ƒåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ä¸€ä¸ªæ–¹æ¡ˆ</figcaption></figure><h2 id="66cb" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">å¸ƒå±€ç”Ÿæˆå™¨</h2><p id="ec03" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">è®©æˆ‘ä»¬ç”¨ä¸ºç´¢å¼•åˆ›å»º<strong class="kb io">NSCollectionLayoutGroupCustomItem</strong>é¡¹çš„æ–¹æ³•æ¥åˆ›å»º<strong class="kb io"> LayoutBuilder </strong>:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="8429" class="lh li in ld b be lj lk l ll lm">func makeLayoutItem(for row: Int) -&gt; NSCollectionLayoutGroupCustomItem</span></pre><p id="0457" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä¸ºäº†è®©ç”Ÿæˆå™¨å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸Šé¢æè¿°çš„é…ç½®ä»¥åŠé›†åˆå®½åº¦:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="bafe" class="lh li in ld b be lj lk l ll lm">final class LayoutBuilder {<br/>private var columnHeights: [CGFloat]<br/>private let columnCount: CGFloat<br/>private let itemHeightProvider: ItemHeightProvider<br/>private let interItemSpacing: CGFloat<br/>private let collectionWidth: CGFloat<br/><br/>init(<br/>    configuration: Configuration,<br/>    collectionWidth: CGFloat<br/>) {<br/>    self.columnHeights = [CGFloat](repeating: 0, count: configuration.columnCount)<br/>    self.columnCount = CGFloat(configuration.columnCount)<br/>    self.itemHeightProvider = configuration.itemHeightProvider<br/>    self.interItemSpacing = configuration.interItemSpacing<br/>    self.collectionWidth = collectionWidth<br/>}<br/><br/>func makeLayoutItem(for row: Int) -&gt; NSCollectionLayoutGroupCustomItem {<br/>    // TODO:<br/>}</span></pre><h2 id="3fd9" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">è®¡ç®—åˆ—å®½</h2><p id="f0e3" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">æˆ‘ä»¬éœ€è¦ä»é›†åˆå®½åº¦ä¸­å‡å»é—´è·ï¼Œç„¶åé™¤ä»¥åˆ—æ•°:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="6268" class="lh li in ld b be lj lk l ll lm">private var columnWidth: CGFloat { let spacing = (columnCount - 1) * interItemSpacing return (collectionWidth - spacing) / columnCount }</span></pre><h2 id="65f2" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">åˆ—é«˜æ•°ç»„</h2><p id="2dce" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">å­˜å‚¨åˆ—é«˜åº¦ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å†³å®šæ¯ä¸ªé¡¹ç›®çš„æ­£ç¡®æ”¾ç½®ä½ç½®ï¼Œä¿å­˜é¡¹ç›®ä»å·¦åˆ°å³çš„é¡ºåº:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="3881" class="lh li in ld b be lj lk l ll lm">/// In init function:<br/>self.columnHeights = [CGFloat](repeating: 0, count: configuration.columnCount)</span></pre><h2 id="e7d2" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">è®¡ç®—é¡¹ç›®çš„æ¡†æ¶</h2><p id="c0ca" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ­£ç¡®çš„åŸç‚¹æ¥æ”¾ç½®ç‰©å“ã€‚å½“æˆ‘ä»¬ä¿å­˜æ¯ä¸€åˆ—çš„æ€»é«˜åº¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æœ€ä½çš„åˆ—å’Œå®ƒçš„æœ€å¤§ Y å€¼(æ‰€ä»¥å®ƒä¼šåˆ°å®ƒçš„åº•éƒ¨), X æ˜¯å®ƒçš„åˆ—çš„åç§»é‡ã€‚è®©æˆ‘ä»¬å¼€å§‹å§:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="fa24" class="lh li in ld b be lj lk l ll lm">private func itemOrigin(width: CGFloat) -&gt; CGPoint {<br/>    let y = columnHeights[columnIndex()].rounded()<br/>    let x = (width + interItemSpacing) * CGFloat(columnIndex())<br/>    return CGPoint(x: x, y: y)<br/>}<br/><br/>private func columnIndex() -&gt; Int {<br/>    columnHeights<br/>        .enumerated()<br/>        .min(by: { $0.element &lt; $1.element })?<br/>        .offset ?? 0<br/>}</span></pre><p id="4d47" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">æœ‰äº†é¡¹çš„åŸç‚¹ã€åˆ—å®½å’Œé—­åŒ…æ¥æ£€ç´¢ç‰¹å®šç´¢å¼•é¡¹çš„é«˜åº¦å’Œå®½åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸€ä¸ªæ¡†æ¶:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="60c0" class="lh li in ld b be lj lk l ll lm">func frame(for row: Int) -&gt; CGRect {<br/>    let width = columnWidth<br/>    let height = itemHeightProvider(row, width)<br/>    let size = CGSize(width: width, height: height)<br/>    let origin = itemOrigin(width: size.width)<br/>    return CGRect(origin: origin, size: size)<br/>}</span></pre><h2 id="9c72" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">åˆ›å»º NSCollectionLayoutGroupCustomItem æ•°ç»„</h2><p id="b3c6" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">å› ä¸ºæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªé¡¹ç›®çš„æ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥å®ç°æˆ‘ä»¬çš„æ–¹æ³•æ¥åˆ›å»º<strong class="kb io">NSCollectionLayoutGroupCustomItem</strong>å®ä¾‹ã€‚ä¹Ÿä¸åº”è¯¥å¿˜è®°åœ¨æ”¾ç½®é¡¹ç›®çš„åœ°æ–¹å¢åŠ ç›¸åº”çš„ columnHeight:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="722b" class="lh li in ld b be lj lk l ll lm">func makeLayoutItem(for row: Int) -&gt; NSCollectionLayoutGroupCustomItem {<br/>    let frame = frame(for: row)<br/>    columnHeights[columnIndex()] = frame.maxY + interItemSpacing<br/>    return NSCollectionLayoutGroupCustomItem(frame: frame)<br/>}</span></pre><p id="74e2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„éƒ¨åˆ†ä¸­çš„æ‰€æœ‰é¡¹ç›®åˆ›å»ºæ•°ç»„:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="10b2" class="lh li in ld b be lj lk l ll lm">var items = [NSCollectionLayoutGroupCustomItem]()<br/>let itemProvider = LayoutBuilder(<br/>    configuration: config,<br/>    collectionWidth: enviroment.container.contentSize.width<br/>)<br/><br/>for i in 0..&lt;config.itemCountProvider() {<br/>    let item = itemProvider.makeLayoutItem(for: i)<br/>    items.append(item)<br/>}</span></pre><p id="40ce" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">æˆ‘ä»¬åº”è¯¥å‘Šè¯‰å°ç»„åˆ›é€ æ–¹æ³•æˆ‘ä»¬æœ‰ä»€ä¹ˆé«˜åº¦ã€‚ä½¿ç”¨<strong class="kb io">NSCollectionLayoutDimension</strong>APIï¼Œæˆ‘ä»¬å¯ä»¥ä¼°ç®—<strong class="kb io">ã€‚estimated() </strong>å€¼ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ‰€æœ‰é¡¹ç›®æ¡†æ¶æ¥è®¡ç®—ï¼Œå¯¹å—ï¼Ÿå¯æƒœä¸æ˜¯ã€‚</p><p id="b291" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å½“æˆ‘å°è¯•ä¸Šé¢æåˆ°çš„ç€‘å¸ƒåº“<a class="ae kx" href="https://github.com/lucamegh/Niagara" rel="noopener ugc nofollow" target="_blank">æ—¶ï¼Œæ”¶é›†å•å…ƒæ ¼å…·æœ‰å‚ç›´çº¦æŸå¹¶è‡ªè¡Œç¡®å®šå…¶é«˜åº¦ï¼Œæˆ‘å‘ç°å¸ƒå±€å¼•æ“è¿›å…¥é€’å½’ï¼Œå› ä¸ºå†…åœ¨å‚ç›´çº¦æŸä¸æˆ‘ä»¬è®¾ç½®çš„æ¡†æ¶å†²çª:</a></p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/72c523732ad8851ef67873ee3cfde08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_5omDoEE6Ya3rqgXlbJVA.png"/></div></div></figure><p id="484c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ç„¶è€Œï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ä¸ªé€‰é¡¹æ¥è®¾ç½®ç»„çš„é«˜åº¦â€”â€”ç»å¯¹å€¼ã€‚å› æ­¤ï¼Œç”±äºæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰å¸§çš„è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»„çš„é«˜åº¦è®¾ç½®ä¸ºæœ€é«˜çš„<strong class="kb io"> columnHeight </strong>å±æ€§:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="771b" class="lh li in ld b be lj lk l ll lm">let groupLayoutSize = NSCollectionLayoutSize(<br/>    widthDimension: .fractionalWidth(1),<br/>    heightDimension: .absolute(itemProvider.maxColumnHeight())<br/>)</span></pre><h2 id="150e" class="nd li in bd lo ne nf dn ls ng nh dp lw kk ni nj ma ko nk nl me ks nm nn mi no bi translated">åˆ›å»º NSCollectionLayoutSection</h2><p id="d01e" class="pw-post-body-paragraph jz ka in kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ig bi translated">æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå®Œæ•´æè¿°çš„ NSCollectionLayoutSectionï¼Œç”¨äºæ˜¾ç¤ºç±»ä¼¼ pinterest(ç€‘å¸ƒï¼Œç­‰ç­‰)çš„å¸ƒå±€:</p><pre class="ky kz la lb gt lc ld le bn lf lg bi"><span id="4c22" class="lh li in ld b be lj lk l ll lm">let group = NSCollectionLayoutGroup.custom(layoutSize: groupLayoutSize) { _ in<br/>    return items<br/>}<br/><br/>let section = NSCollectionLayoutSection(group: group)<br/>section.contentInsetsReference = config.contentInsetsReference</span></pre><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/58aafdf5d09f887a2168d5a73a84dcaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*i30D3lZ-CV7ZHeZ8xQuuug.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">ä½¿ç”¨æˆ‘ä»¬çš„å¸ƒå±€çš„æ”¶è—è§†å›¾</figcaption></figure></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="0c7b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å°½ç®¡ç»„åˆå¸ƒå±€ API å¯¹äºè¿™æ ·çš„äº‹æƒ…æ¥è¯´ä¼¼ä¹æœ‰äº›ç¬¨æ‹™ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æœ‰ä¸€äº›ç©ºé—´æ¥åšæˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ï¼Œä¿æŒè¿™ç§å¸ƒå±€çš„æ‰€æœ‰ä¼˜ç‚¹ã€‚</p><p id="24be" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å¯¹äºæ‰€æè¿°çš„å¸ƒå±€ï¼Œæˆ‘åˆ›å»ºäº†<a class="ae kx" href="https://github.com/eeshishko/WaterfallTrueCompositionalLayout" rel="noopener ugc nofollow" target="_blank">å­˜å‚¨åº“</a>å’Œ NPM åŒ…ï¼Œè¿™æ ·æ¯ä¸ªäººéƒ½å¯ä»¥æ£€æŸ¥è¯¥æ–¹æ³•çš„å®Œæ•´å®ç°ï¼Œæˆ–è€…åªæ˜¯æ·»åŠ ä¸€ä¸ªé¡¹ç›®å¹¶ä½¿ç”¨å®ƒã€‚ä¹Ÿå¯ä»¥éšæ„æå‡ºä»»ä½•é—®é¢˜å’Œç›¸åº”çš„è¯·æ±‚ï¼ğŸ¤©</p></div></div>    
</body>
</html>