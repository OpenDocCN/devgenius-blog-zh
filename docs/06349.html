<html>
<head>
<title>Algorithmic Trading - Backtesting a strategy in python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">算法交易——回测 python 中的策略</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/algorithmic-trading-backtesting-a-strategy-in-python-3a136be16ece?source=collection_archive---------0-----------------------#2022-01-02">https://blog.devgenius.io/algorithmic-trading-backtesting-a-strategy-in-python-3a136be16ece?source=collection_archive---------0-----------------------#2022-01-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0019ed67383764effae594465fb36257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JvsArwZ7kC70YOuY"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">马克西姆·霍普曼在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8f69" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> Intro </strong> <br/>本文的目标是描述如何在 python 上回测基于技术指标的策略。我将特别使用基于布林线的策略来创建信号和位置。</p><p id="6659" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">策略描述</strong> <br/>在调整后的收盘价上创建 20 天(+/- 2 标准差)布林线。当价格从顶部穿过较低波段时买入，并持有直到价格下一次从下方穿过较高波段。当价格从下方穿过上带时卖出，并持有直到价格下一次从顶部穿过下带。</p><p id="8f47" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是创建你自己的回溯测试代码的步骤。</p><ol class=""><li id="a07f" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">导入必要的库</li><li id="52fa" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">下载 OHLCV 数据</li><li id="52e1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">计算每日回报</li><li id="0034" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">创建基于策略的数据列</li><li id="0cb8" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">创建战略指标</li><li id="976e" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">创建信号和位置</li><li id="1898" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">分析结果</li></ol><p id="55d7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤 1:导入必要的库</strong></p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="0e60" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第二步:下载 OHLCV:(开盘，高，低，收盘，成交量)数据</strong> <br/>我用雅虎财经 python API — yfinance 来获取数据。有很多资源可以获得历史数据，以便对你的策略进行回溯测试。</p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><pre class="lm ln lo lp gt ls lt lu lv aw lw bi"><span id="4274" class="lx ly in lt b gy lz ma l mb mc">[*********************100%***********************]  1 of 1 completed</span></pre><p id="5dc6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第三步:计算每日回报</strong> <br/>这一步计算每日回报，以便与买入并持有策略进行比较。买入并持有策略成为比较策略的基准。换句话说，它检验策略的表现是否优于简单地买入并持有股票。一个好的策略本质上会比买入并持有策略表现更好。</p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/2bbd71e31a94f24c7ac389978b58c251.png" data-original-src="https://miro.medium.com/v2/format:webp/1*yXPt-X0yMgMMAYjqqtEL0Q.png"/></div></figure><p id="5a8b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第四步:创建基于策略的数据列</strong> <br/>下一步是创建指标来生成策略的条件。对于布林线策略，涉及到 20 天均线，20 天均线的标准差，上波段，下波段的标准差。[ma20，标准，高频段，低频段]</p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/3a84c84a57f5a2ac0929c6335ca080cc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*RNdkIhxInHe5hDxOFPAvYA.png"/></div></figure><p id="a8b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第五步:创建战略指标</strong> <br/>以下是创建战略最关键的部分。它包括</p><ul class=""><li id="abe7" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx me le lf lg bi translated">生成策略中提到的多头和空头信号</li><li id="dfae" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx me le lf lg bi translated">用前向填充替换零，以生成多头和空头头寸</li><li id="36d3" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx me le lf lg bi translated">将位置移动 1，以表示从一天收盘到第二天收盘价格的回报计算</li></ul><p id="238c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">信号本质上是表示需要采取的行动的指示器(例如:买或卖)。头寸是你在买入或卖出(即做多或做空)后维持的头寸。</p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/c6c5005fc57aef2495c17224fe8913aa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*AXfYXwkmRa18IGEuST9RTQ.png"/></div></figure><p id="1976" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第六步:创建信号和头寸</strong> <br/>下一步是使用累积回报来比较策略表现。<br/>这涉及头寸与日收益的逐元素乘法。</p><figure class="lm ln lo lp gt jo"><div class="bz fp l di"><div class="lq lr l"/></div></figure><pre class="lm ln lo lp gt ls lt lu lv aw lw bi"><span id="725b" class="lx ly in lt b gy lz ma l mb mc">Buy and hold returns: 1.4441301364703079<br/>Strategy returns: 0.3712255745848457<br/><br/>&lt;AxesSubplot:xlabel='Date'&gt;</span></pre><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/2c2591914bc4141cddb3462df984be03.png" data-original-src="https://miro.medium.com/v2/format:webp/1*_kk7YIT413SyM5AtYMJ8Kg.png"/></div></figure><p id="caa2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第七步:分析结果</strong></p><p id="94e1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于这一步，我使用 pyfolio。Pyfolio 是一个 Python 库，用于金融投资组合的性能和风险分析</p><pre class="lm ln lo lp gt ls lt lu lv aw lw bi"><span id="e898" class="lx ly in lt b gy lz ma l mb mc">pf.create_simple_tear_sheet(df['strategy_returns'].diff())</span></pre><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/d2d2cff3b8ab62bc0582c079fd453005.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*7mF0dgmuicSeXK8TQQfDnA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">投资组合结果</figcaption></figure><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/fdc8df57225a68e29f1381a4fef11e05.png" data-original-src="https://miro.medium.com/v2/format:webp/1*M19vZx-2reBDlLRHbrYpfg.png"/></div></figure><p id="e41b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">来自 pyfolio 的结果是不言自明的。</p><p id="6c18" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">历史数据上的“布林线”策略并不比买入并持有策略表现更好。买入并持有的累计日收益占初始投资的 1.44 倍，布林带策略收益占初始投资的 0.37 倍。</p><p id="5767" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">出于显而易见的原因，人们不应该采取策略<strong class="kc io"> live </strong>，即使它在回溯测试中有很大的回报。这涉及各种风险，如不考虑交易成本和股价动量。</p><p id="0be0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还可以通过检查各种策略参数的回报来优化策略的性能。</p><p id="ac0d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">各种其他技术指标可以结合使用，以创建可以降低风险和提高性能的信号。实时策略应该执行止损和止损开关，以防策略失控。</p><p id="1e79" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个代码片段可以在以下位置找到:<a class="ae jz" href="https://github.com/karthikramx/Algorithmic-Trading-Backtesting-python-example" rel="noopener ugc nofollow" target="_blank">https://github . com/karthikramx/algorithm-Trading-back testing-python-example</a></p></div></div>    
</body>
</html>