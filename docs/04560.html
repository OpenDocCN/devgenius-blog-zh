<html>
<head>
<title>Add Tree Views into Our React App with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Visx 库将树视图添加到 React 应用程序中</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-tree-views-into-our-react-app-with-the-visx-library-b6c890a5d8ad?source=collection_archive---------1-----------------------#2021-04-03">https://blog.devgenius.io/add-tree-views-into-our-react-app-with-the-visx-library-b6c890a5d8ad?source=collection_archive---------1-----------------------#2021-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1d08a6f5e46e699308e68aeb347c4657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Aj_kNUO8dkU-Xa4S"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@gillystewart?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">吉利·斯图尔特</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c209" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx 是一个库，让我们可以轻松地将图形添加到 React 应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将树视图添加到 React 应用程序中。</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/gradient @visx/group @visx/hierarchy @visx/responsive @visx/shape</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="dd73" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建树视图</h1><p id="9a3a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下内容来创建具有不同链接类型、动画和布局的树视图:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6b87" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from "react";<br/>import { Group } from "@visx/group";<br/>import { hierarchy, Tree } from "@visx/hierarchy";<br/>import { LinearGradient } from "@visx/gradient";<br/>import { pointRadial } from "d3-shape";<br/>import {<br/>  LinkHorizontal,<br/>  LinkVertical,<br/>  LinkRadial,<br/>  LinkHorizontalStep,<br/>  LinkVerticalStep,<br/>  LinkRadialStep,<br/>  LinkHorizontalCurve,<br/>  LinkVerticalCurve,<br/>  LinkRadialCurve,<br/>  LinkHorizontalLine,<br/>  LinkVerticalLine,<br/>  LinkRadialLine<br/>} from "@visx/shape";</span><span id="49b9" class="mn lc iq mj b gy ms mp l mq mr">const data = {<br/>  name: "T",<br/>  children: [<br/>    {<br/>      name: "A",<br/>      children: [<br/>        { name: "A1" },<br/>        { name: "A2" },<br/>        {<br/>          name: "C",<br/>          children: [<br/>            {<br/>              name: "C1"<br/>            },<br/>            {<br/>              name: "D",<br/>              children: [<br/>                {<br/>                  name: "D1"<br/>                },<br/>                {<br/>                  name: "D2"<br/>                },<br/>                {<br/>                  name: "D3"<br/>                }<br/>              ]<br/>            }<br/>          ]<br/>        }<br/>      ]<br/>    },<br/>    { name: "Z" },<br/>    {<br/>      name: "B",<br/>      children: [{ name: "B1" }, { name: "B2" }]<br/>    }<br/>  ]<br/>};</span><span id="8c8c" class="mn lc iq mj b gy ms mp l mq mr">function useForceUpdate() {<br/>  const [, setValue] = useState(0);<br/>  return () =&gt; setValue((value) =&gt; value + 1);<br/>}</span><span id="2aa8" class="mn lc iq mj b gy ms mp l mq mr">const defaultMargin = { top: 30, left: 30, right: 30, bottom: 70 };</span><span id="6525" class="mn lc iq mj b gy ms mp l mq mr">function LinkControls({<br/>  layout,<br/>  orientation,<br/>  linkType,<br/>  stepPercent,<br/>  setLayout,<br/>  setOrientation,<br/>  setLinkType,<br/>  setStepPercent<br/>}) {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;label&gt;layout:&lt;/label&gt;&amp;nbsp;<br/>      &lt;select<br/>        onClick={(e) =&gt; e.stopPropagation()}<br/>        onChange={(e) =&gt; setLayout(e.target.value)}<br/>        value={layout}<br/>      &gt;<br/>        &lt;option value="cartesian"&gt;cartesian&lt;/option&gt;<br/>        &lt;option value="polar"&gt;polar&lt;/option&gt;<br/>      &lt;/select&gt;<br/>      &amp;nbsp;&amp;nbsp;<br/>      &lt;label&gt;orientation:&lt;/label&gt;&amp;nbsp;<br/>      &lt;select<br/>        onClick={(e) =&gt; e.stopPropagation()}<br/>        onChange={(e) =&gt; setOrientation(e.target.value)}<br/>        value={orientation}<br/>        disabled={layout === "polar"}<br/>      &gt;<br/>        &lt;option value="vertical"&gt;vertical&lt;/option&gt;<br/>        &lt;option value="horizontal"&gt;horizontal&lt;/option&gt;<br/>      &lt;/select&gt;<br/>      &amp;nbsp;&amp;nbsp;<br/>      &lt;label&gt;link:&lt;/label&gt;&amp;nbsp;<br/>      &lt;select<br/>        onClick={(e) =&gt; e.stopPropagation()}<br/>        onChange={(e) =&gt; setLinkType(e.target.value)}<br/>        value={linkType}<br/>      &gt;<br/>        &lt;option value="diagonal"&gt;diagonal&lt;/option&gt;<br/>        &lt;option value="step"&gt;step&lt;/option&gt;<br/>        &lt;option value="curve"&gt;curve&lt;/option&gt;<br/>        &lt;option value="line"&gt;line&lt;/option&gt;<br/>      &lt;/select&gt;<br/>      {linkType === "step" &amp;&amp; layout !== "polar" &amp;&amp; (<br/>        &lt;&gt;<br/>          &amp;nbsp;&amp;nbsp;<br/>          &lt;label&gt;step:&lt;/label&gt;&amp;nbsp;<br/>          &lt;input<br/>            onClick={(e) =&gt; e.stopPropagation()}<br/>            type="range"<br/>            min={0}<br/>            max={1}<br/>            step={0.1}<br/>            onChange={(e) =&gt; setStepPercent(Number(e.target.value))}<br/>            value={stepPercent}<br/>            disabled={linkType !== "step" || layout === "polar"}<br/>          /&gt;<br/>        &lt;/&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="5576" class="mn lc iq mj b gy ms mp l mq mr">function getLinkComponent({ layout, linkType, orientation }) {<br/>  let LinkComponent;</span><span id="c19f" class="mn lc iq mj b gy ms mp l mq mr">  if (layout === "polar") {<br/>    if (linkType === "step") {<br/>      LinkComponent = LinkRadialStep;<br/>    } else if (linkType === "curve") {<br/>      LinkComponent = LinkRadialCurve;<br/>    } else if (linkType === "line") {<br/>      LinkComponent = LinkRadialLine;<br/>    } else {<br/>      LinkComponent = LinkRadial;<br/>    }<br/>  } else if (orientation === "vertical") {<br/>    if (linkType === "step") {<br/>      LinkComponent = LinkVerticalStep;<br/>    } else if (linkType === "curve") {<br/>      LinkComponent = LinkVerticalCurve;<br/>    } else if (linkType === "line") {<br/>      LinkComponent = LinkVerticalLine;<br/>    } else {<br/>      LinkComponent = LinkVertical;<br/>    }<br/>  } else if (linkType === "step") {<br/>    LinkComponent = LinkHorizontalStep;<br/>  } else if (linkType === "curve") {<br/>    LinkComponent = LinkHorizontalCurve;<br/>  } else if (linkType === "line") {<br/>    LinkComponent = LinkHorizontalLine;<br/>  } else {<br/>    LinkComponent = LinkHorizontal;<br/>  }<br/>  return LinkComponent;<br/>}</span><span id="113a" class="mn lc iq mj b gy ms mp l mq mr">function Example({<br/>  width: totalWidth,<br/>  height: totalHeight,<br/>  margin = defaultMargin<br/>}) {<br/>  const [layout, setLayout] = useState("cartesian");<br/>  const [orientation, setOrientation] = useState("horizontal");<br/>  const [linkType, setLinkType] = useState("diagonal");<br/>  const [stepPercent, setStepPercent] = useState(0.5);<br/>  const forceUpdate = useForceUpdate();</span><span id="16e5" class="mn lc iq mj b gy ms mp l mq mr">  const innerWidth = totalWidth - margin.left - margin.right;<br/>  const innerHeight = totalHeight - margin.top - margin.bottom;</span><span id="8488" class="mn lc iq mj b gy ms mp l mq mr">  let origin;<br/>  let sizeWidth;<br/>  let sizeHeight;</span><span id="270c" class="mn lc iq mj b gy ms mp l mq mr">  if (layout === "polar") {<br/>    origin = {<br/>      x: innerWidth / 2,<br/>      y: innerHeight / 2<br/>    };<br/>    sizeWidth = 2 * Math.PI;<br/>    sizeHeight = Math.min(innerWidth, innerHeight) / 2;<br/>  } else {<br/>    origin = { x: 0, y: 0 };<br/>    if (orientation === "vertical") {<br/>      sizeWidth = innerWidth;<br/>      sizeHeight = innerHeight;<br/>    } else {<br/>      sizeWidth = innerHeight;<br/>      sizeHeight = innerWidth;<br/>    }<br/>  }</span><span id="944f" class="mn lc iq mj b gy ms mp l mq mr">  const LinkComponent = getLinkComponent({ layout, linkType, orientation });</span><span id="1884" class="mn lc iq mj b gy ms mp l mq mr">  return totalWidth &lt; 10 ? null : (<br/>    &lt;div&gt;<br/>      &lt;LinkControls<br/>        layout={layout}<br/>        orientation={orientation}<br/>        linkType={linkType}<br/>        stepPercent={stepPercent}<br/>        setLayout={setLayout}<br/>        setOrientation={setOrientation}<br/>        setLinkType={setLinkType}<br/>        setStepPercent={setStepPercent}<br/>      /&gt;<br/>      &lt;svg width={totalWidth} height={totalHeight}&gt;<br/>        &lt;LinearGradient id="links-gradient" from="#fd9b93" to="#fe6e9e" /&gt;<br/>        &lt;rect width={totalWidth} height={totalHeight} rx={14} fill="#272b4d" /&gt;<br/>        &lt;Group top={margin.top} left={margin.left}&gt;<br/>          &lt;Tree<br/>            root={hierarchy(data, (d) =&gt; (d.isExpanded ? null : d.children))}<br/>            size={[sizeWidth, sizeHeight]}<br/>            separation={(a, b) =&gt; (a.parent === b.parent ? 1 : 0.5) / a.depth}<br/>          &gt;<br/>            {(tree) =&gt; (<br/>              &lt;Group top={origin.y} left={origin.x}&gt;<br/>                {tree.links().map((link, i) =&gt; (<br/>                  &lt;LinkComponent<br/>                    key={i}<br/>                    data={link}<br/>                    percent={stepPercent}<br/>                    stroke="rgb(254,110,158,0.6)"<br/>                    strokeWidth="1"<br/>                    fill="none"<br/>                  /&gt;<br/>                ))}</span><span id="fda8" class="mn lc iq mj b gy ms mp l mq mr">{tree.descendants().map((node, key) =&gt; {<br/>                  const width = 40;<br/>                  const height = 20;</span><span id="67e0" class="mn lc iq mj b gy ms mp l mq mr">let top;<br/>                  let left;<br/>                  if (layout === "polar") {<br/>                    const [radialX, radialY] = pointRadial(node.x, node.y);<br/>                    top = radialY;<br/>                    left = radialX;<br/>                  } else if (orientation === "vertical") {<br/>                    top = node.y;<br/>                    left = node.x;<br/>                  } else {<br/>                    top = node.x;<br/>                    left = node.y;<br/>                  }</span><span id="e77f" class="mn lc iq mj b gy ms mp l mq mr">                  return (<br/>                    &lt;Group top={top} left={left} key={key}&gt;<br/>                      {node.depth === 0 &amp;&amp; (<br/>                        &lt;circle<br/>                          r={12}<br/>                          fill="url('#links-gradient')"<br/>                          onClick={() =&gt; {<br/>                            node.data.isExpanded = !node.data.isExpanded;<br/>                            console.log(node);<br/>                            forceUpdate();<br/>                          }}<br/>                        /&gt;<br/>                      )}<br/>                      {node.depth !== 0 &amp;&amp; (<br/>                        &lt;rect<br/>                          height={height}<br/>                          width={width}<br/>                          y={-height / 2}<br/>                          x={-width / 2}<br/>                          fill="#272b4d"<br/>                          stroke={node.data.children ? "#03c0dc" : "#26deb0"}<br/>                          strokeWidth={1}<br/>                          strokeDasharray={node.data.children ? "0" : "2,2"}<br/>                          strokeOpacity={node.data.children ? 1 : 0.6}<br/>                          rx={node.data.children ? 0 : 10}<br/>                          onClick={() =&gt; {<br/>                            node.data.isExpanded = !node.data.isExpanded;<br/>                            forceUpdate();<br/>                          }}<br/>                        /&gt;<br/>                      )}<br/>                      &lt;text<br/>                        dy=".33em"<br/>                        fontSize={9}<br/>                        fontFamily="Arial"<br/>                        textAnchor="middle"<br/>                        style={{ pointerEvents: "none" }}<br/>                        fill={<br/>                          node.depth === 0<br/>                            ? "#71248e"<br/>                            : node.children<br/>                            ? "white"<br/>                            : "#26deb0"<br/>                        }<br/>                      &gt;<br/>                        {node.data.name}<br/>                      &lt;/text&gt;<br/>                    &lt;/Group&gt;<br/>                  );<br/>                })}<br/>              &lt;/Group&gt;<br/>            )}<br/>          &lt;/Tree&gt;<br/>        &lt;/Group&gt;<br/>      &lt;/svg&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="a523" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="7c31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有了用来渲染树的<code class="fe mt mu mv mj b">data</code>对象。</p><p id="6933" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们改变布局、方向或链接类型时,<code class="fe mt mu mv mj b">useForceUpdate</code>钩子用于返回强制树更新的函数。</p><p id="ba19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们有了带有下拉菜单的<code class="fe mt mu mv mj b">LinkControls</code>组件，让我们设置布局、方向或链接类型。</p><p id="595a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们用<code class="fe mt mu mv mj b">getLinkComponent</code>函数返回给定<code class="fe mt mu mv mj b">layoyt</code>、<code class="fe mt mu mv mj b">linkType</code>或<code class="fe mt mu mv mj b">orientation</code>的组件。</p><p id="6ed0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">Example</code>组件中，我们得到了<code class="fe mt mu mv mj b">LinkControls</code>组件中的<code class="fe mt mu mv mj b">layout</code>、<code class="fe mt mu mv mj b">orientation</code>和<code class="fe mt mu mv mj b">linkType</code>集合。</p><p id="abe3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">Group</code>组件包含树的所有部分。</p><p id="aa1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们添加带有<code class="fe mt mu mv mj b">Tree</code>组件的树形视图。</p><p id="b29b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有一个带<code class="fe mt mu mv mj b">tree</code>参数的渲染属性，用<code class="fe mt mu mv mj b">tree.links()</code>方法获取父节点和子节点之间的链接，我们用<code class="fe mt mu mv mj b">LinkComponent</code>函数组件渲染这些链接。</p><p id="fe2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">tree.descendants()</code>返回后代。</p><p id="83f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<code class="fe mt mu mv mj b">tree.descendants().map()</code>回调中呈现节点。</p><p id="f9b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">if</code>语句设置节点的位置。</p><p id="e8c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们根据节点的深度级别为节点渲染<code class="fe mt mu mv mj b">circle</code> s 或<code class="fe mt mu mv mj b">rect</code> s。</p><p id="690d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论哪种情况，我们都在节点内部呈现<code class="fe mt mu mv mj b">text</code>，它要么在<code class="fe mt mu mv mj b">circle</code>内部，要么在<code class="fe mt mu mv mj b">rect</code>内部。</p><h1 id="5b07" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="effd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 Visx 库在 React 应用程序中渲染带有笛卡尔或极坐标的树视图。</p></div></div>    
</body>
</html>