# Git 中的撤销和重做提交:分步指南

> 原文：<https://blog.devgenius.io/undoing-and-redoing-commits-in-git-a-step-by-step-guide-48bc2ce4bd4f?source=collection_archive---------13----------------------->

![](img/16ca6e4c21652e76f2c87b18eb52b24a.png)

Git 中的撤销和重做提交:分步指南

Git 是一个强大的版本控制系统，允许开发人员跟踪和管理代码库的变更。然而，有时我们会犯错误，需要撤销或重做提交。在本文中，我们将解释如何使用 Git 的 reset 和 commit 命令撤销和重做提交。

首先，让我们理解在 Git 中提交时会发生什么。提交是我们代码库在特定时间点的快照。它捕获我们对代码所做的更改，以及描述提交目的的消息。当我们提交时，Git 将这个快照存储在它的历史中，如果需要，我们可以在以后引用它。

现在，假设我们提交了一个请求，然后意识到这是一个错误。我们可以使用 git reset 命令撤销提交，并将我们的代码库返回到提交前的状态。git reset 命令具有以下语法:

```
git reset HEAD~
```

`HEAD~`参数指定了我们想要撤销的提交。在这种情况下，这意味着最近的提交。如果我们想要撤销一个不同的提交，我们可以指定它的`SHA-1`散列而不是`HEAD~`。

在我们运行 git reset 命令之后，我们的代码库将返回到提交之前的状态，但是我们所做的更改仍然会出现在我们的工作树中(我们的文件在磁盘上的状态)。这意味着我们需要对代码进行任何必要的修正，并在再次提交之前再次添加更改。

完成必要的更改后，我们可以使用 git add 命令为下一次提交准备更改:

```
git add .
```

`.`参数指定我们希望在当前目录及其子目录中存放所有更改。或者，我们可以指定要转移的单个文件或目录。

既然更改已经暂存，我们可以使用 git commit 命令再次提交它们，

```
git commit -c ORIG_HEAD
```

`-c`选项指定我们想要重用旧的提交消息，但是我们也可以使用`-m`选项直接指定新的提交消息。

或者，如果我们只想更改前一次提交的提交消息，我们可以使用 git commit–amend 命令。这将把我们已经暂存的更改添加到以前的提交中，并允许我们在编辑器中编辑提交消息。

除了撤销和重做提交之外，有时我们可能需要删除已经推送到服务器的提交。这被称为重写历史，这可能是危险的，因为它更改了代码库的历史，并且可能会导致与其他也将更改推送到服务器的开发人员的冲突。

要删除已经推送到服务器的提交，我们可以使用带有`--force`或`--force-with-lease`选项的 git push 命令。例如:

```
git push origin main --force
```

`origin`参数指定了远程存储库，主参数指定了我们想要将变更推送到的分支。`--force`选项告诉 Git 用我们的本地分支覆盖远程分支，不管任何冲突或差异。

值得注意的是，使用`--force`选项可能是危险的，因为如果其他开发人员将变更推送到同一个分支，它可能会导致数据丢失。出于这个原因，通常最好使用`--force-with-lease`选项，它只会覆盖远程分支，如果它在我们最后一次从它拉出来之后没有被改变的话。

为了确定我们想要删除的提交的`SHA-1`散列，我们可以使用`git reflog`命令，该命令显示对本地存储库所做的所有更改的日志。一旦我们有了`SHA-1`散列，我们就可以如上所述在`git reset`和`git push`命令中使用它。

总之，Git 的 reset 和 push 命令允许我们撤销和重做提交，以及删除已经推送到服务器的提交。虽然这些命令可能很强大，但如果使用不当也会很危险，因此理解它们的含义并谨慎使用它们很重要。