<html>
<head>
<title>Make a grid-based game with Unity: dev-log day 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Unity制作一个基于网格的游戏:开发日志第6天</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/make-a-grid-based-game-with-unity-dev-log-day-6-77a0a455c076?source=collection_archive---------7-----------------------#2021-01-08">https://blog.devgenius.io/make-a-grid-based-game-with-unity-dev-log-day-6-77a0a455c076?source=collection_archive---------7-----------------------#2021-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4f5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从一个级别到下一个级别</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/126020e4faed3c6141df3c27f6c52d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqlDYWxXbIVA6fNJHDw5GA.jpeg"/></div></div></figure><h1 id="05c2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">目标</h1><p id="189c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">今天我想让我的角色可以进入一个入口，或者用DCSS的方式，“下楼”到下一个级别。同样，我希望我的角色能够回到楼梯上，这样他们就可以回到原来的高度，如果他们愿意的话。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="ecfb" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">我该怎么做？</h1><p id="cb33" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">关于DCSS，有一些关键的东西我想远离。例如，在DCSS，每层楼都有多个楼梯和“活板门”DCSS将此作为玩家的一种瓶颈机制。当附近有敌人时，玩家可以“爬楼梯”。游戏中的敌人只有在紧邻玩家的情况下才能跟随玩家上楼。</p><p id="b930" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为这种楼梯滥发的事情是一种蹩脚的技工，所以我要减少流行，使每个级别只有一套楼梯。玩家仍然会因为战利品而有动力去探索整个楼层，但那都是以后的事了。</p><p id="4b9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从技术上来说，我认为最好的方法是制作另一个精灵和预设，把它插入到我的模型中，就像其他的一样，然后在玩家按下按钮时运行某种检查。一旦按钮被按下，他们将被传送到一个新的水平。</p><p id="25e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在未来的某个时候，我想我会制作一个“互动”窗口，它会弹出一个列表，列出游戏中可以互动的所有选项，但我认为将它包括在今天的目标中会是一天中太多的工作。</p><p id="47f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简单起见，我想我会尝试在游戏开始时生成所有的关卡，并将所有的关卡保存在内存中的某个地方。即使在最后的游戏中，我也不认为玩家每次运行会处理超过40级的关卡，所以现在，我只是在某个对象中保留引用的关卡，当玩家进入一个新的关卡时，我会将新关卡的模型放入所有其他机制使用的模型引用中。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="64da" class="mm ky iq bd kz mn mo dn ld mp mq dp lh jy mr ms ll kc mt mu lp kg mv mw lt mx bi translated">首先，让我们做一些占位符精灵。</h2><p id="01f5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我将为楼梯选择比墙壁和地板更亮的颜色，因为它们可以相互影响。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/42e28825ac5aca23fa405c3b8a878d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MDDO5M7pddneqsRGgz_vQ.jpeg"/></div></div></figure><p id="61a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们开始吧。楼上是一样的东西，除了水平翻转。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="4b7f" class="mm ky iq bd kz mn mo dn ld mp mq dp lh jy mr ms ll kc mt mu lp kg mv mw lt mx bi translated">意识到目前为止我构建这个的方式违背了Unity惯例，我需要重构一些东西来使我的生活更容易。</h2><blockquote class="mz"><p id="2af1" class="na nb iq bd nc nd ne nf ng nh ni kk dk translated">如果你和框架对抗，框架通常会赢</p></blockquote><p id="1ea4" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">来说说我的系统设计吧。我画了一个图表，大致显示了我的游戏到目前为止是如何工作的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi no"><img src="../Images/e19338155d5bc8bb67851f15449c3547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVdJeBByGapDNkbSQ9XmiQ.jpeg"/></div></div></figure><p id="9581" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有4个管理器，它们在内存中保存某些东西，引用预置，实例化对象，调用其他模块中的方法，做各种各样的事情。</p><p id="431c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">照这样下去，我的游戏会很快变成一个混乱的参考网。</p><p id="af36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，在第一帧之前，我的网格管理器创建了所有的级别，并且将所有级别的所有图块都放入一个包中。这使得找到特定的瓦片来实现各种逻辑(比如上楼或下楼)变得更加困难</p><p id="89ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我重构了整个系统。现在比以后好，我觉得这些改变是必要的，以使等级转换更容易。</p><p id="2daa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如今，大多数渲染框架都陷入了一个惯例，对于任何给定的过程，通常更容易判断各个对象是否负责自己的属性和细节，并且它们将系统的事情报告给父控制器。</p><p id="2b14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经改变了我的整个系统，使之更符合这些原则。</p><p id="064e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我就不告诉你大部分细节了，给你看看我新系统的示意图。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi np"><img src="../Images/2206e1c78bcb2f457b63cd3795c2ed8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsZms_5Ls7uyFkweFh2aYQ.jpeg"/></div></div></figure><p id="ab78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总结一下；我的网格管理器现在正在实例化一个级别对象。对于它生成的每个图块，它都将其分配到自己的级别。每个级别对象都是其中所有对象的直接父对象。</p><p id="bc71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个对象都有一个props脚本，它只是记录一些我希望它记录的变量。我的大部分预设道具仅仅是跟踪它在模型中的位置，但是角色和关卡道具要厚一点。每一层都有自己的level_model和上下瓷砖(因为它们是特殊的)</p><p id="37e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个上下瓷砖都在记录它吐出的高度。</p><p id="f9b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我没有一个奇怪的角色管理器，而是把它拆开，给我的角色预设添加了脚本，来处理移动和相机移动之类的无聊的事情。</p><p id="b6c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我删除了我的战斗管理器和我的角色管理器，因为它们是不必要的复杂性。</p><p id="dd89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我的对象处于一个有组织的层次结构中，它们可以根据需要引用资源(预设)和它们的属性来执行我的逻辑。</p><p id="26da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个巨大的进步，也是需要做的事情。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="1e0d" class="mm ky iq bd kz mn mo dn ld mp mq dp lh jy mr ms ll kc mt mu lp kg mv mw lt mx bi translated">现在重构已经完成，回到转换的层面</h2><p id="4e82" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这是我刚刚做的重构的真正内容。等级转换现在变得轻而易举。</p><p id="8d55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每一关都记录着它自己重要的瓷砖，角色也记录着它在哪一关，所以当我与一些向下的楼梯互动时，我所要做的就是通过询问下一关向上的楼梯在哪里找到出口，然后把我的角色移到那里。</p><p id="ea4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在里面写了代码，现在它开始运行了:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="734d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我对设计和重构非常满意，因为这将允许我一次载入多个关卡，即使玩家不在这个关卡上(例如当怪物四处移动时)，它们的状态也会改变</p><p id="3886" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下次见。</p></div></div>    
</body>
</html>