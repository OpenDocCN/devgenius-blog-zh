<html>
<head>
<title>How to Build a Website Builder 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立一个网站建设者 101</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-a-website-builder-101-e681dd31ae7a?source=collection_archive---------9-----------------------#2022-03-22">https://blog.devgenius.io/how-to-build-a-website-builder-101-e681dd31ae7a?source=collection_archive---------9-----------------------#2022-03-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8537c04e9c837aa10399e84081387acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2v1XRwkXmO4DIjgw"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片来源:Unsplash 上的<a class="ae jz" href="http://twitter.com/kellysikkema" rel="noopener ugc nofollow" target="_blank"> @kellysikkema </a></figcaption></figure><p id="827a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你看过学习编程视频。其中很多都是关于克隆热门网站，比如网飞、Airbnb 等等。虽然这些视频对前端开发人员来说是很好的开始，但到目前为止，我最有价值的编程经验是在构建多租户网站构建器应用程序时学到的。</p><p id="7f95" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是创建功能多租户应用程序所需学习的各种功能的概述。</p><h1 id="a213" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak"> App 概述</strong></h1><ol class=""><li id="d4e3" class="lw lx in kc b kd ly kh lz kl ma kp mb kt mc kx md me mf mg bi translated">动态 CRUD 路线(将父组件嵌套在其自身内的能力等。)</li><li id="d032" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">桶存储 API S3/DO 等处理用户图像上传</li><li id="259c" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">根域、自定义域和子域路由</li><li id="26d4" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">设计组件的快捷用户界面。</li><li id="246c" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">通配符域和自定义域的后端服务器管理</li><li id="9e88" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">命令工作流(撤消和重做功能)</li><li id="b86d" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx md me mf mg bi translated">处理草稿/发布状态的后台作业</li></ol><p id="67ad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到目前为止，我只实现了这些指导方针的 5/7，完成了创建一个网站构建器所需的大量工作。</p><p id="22d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们开始讨论如何处理前 3~4 个问题，这样你就可以开始创建自己的多租户、网站构建应用了！</p><p id="6b3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我的应用程序是用 Ruby on Rails 编写的，但是无论你使用 React 还是其他框架，方法都是一样的。和往常一样，Rails 应用被分成 MVC 框架组件。</p><p id="25c8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从数据库建模开始。</p><h1 id="52c4" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">数据库建模</strong></h1><p id="a6b5" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">不像大多数应用程序有 1000 个关于如何编码的教程，这一个我只是凭直觉去做每件事。欢迎就如何改进代码库提出建议。我是这样做的:</p><p id="e724" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">用户</strong></p><ul class=""><li id="087e" class="lw lx in kc b kd ke kh ki kl mp kp mq kt mr kx ms me mf mg bi translated">有许多网站</li></ul><p id="bc60" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">网站</strong></p><ul class=""><li id="b4e1" class="lw lx in kc b kd ke kh ki kl mp kp mq kt mr kx ms me mf mg bi translated">有许多部分</li><li id="4394" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx ms me mf mg bi translated">属于用户</li></ul><p id="be02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">章节</strong></p><ul class=""><li id="96d2" class="lw lx in kc b kd ke kh ki kl mp kp mq kt mr kx ms me mf mg bi translated">有许多元素</li></ul><p id="483a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">元素</strong></p><ul class=""><li id="c5ba" class="lw lx in kc b kd ke kh ki kl mp kp mq kt mr kx ms me mf mg bi translated">有许多链接</li><li id="b927" class="lw lx in kc b kd mh kh mi kl mj kp mk kt ml kx ms me mf mg bi translated">属于部分</li></ul><p id="a222" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">链接</strong></p><ul class=""><li id="3044" class="lw lx in kc b kd ke kh ki kl mp kp mq kt mr kx ms me mf mg bi translated">属于元素</li></ul><p id="104d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">可能有更好的方法来为站点创建模板，比如纯粹的 JSON blocks api。但是对于我的简单的网站设计者来说，有 3 层嵌套就很好了。这将完成 MVP 的工作。我喜欢在编程时快速行动，快速原型化想法，而不是“诗意和完美的代码”。</p><p id="17ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不会详细讨论每个模型的属性，但它们都有点相似。他们每个人都有用户照片上传的照片关联，背景颜色，比例，类型，位置，所有你需要为用户定制他们的网站部分的基础。</p><h1 id="5da0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">控制器和路线</h1><p id="d9fc" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">接下来，让我们谈谈应用程序中的各种重要控制器。简单来说，我们可以把这个 app 分解成三个不同的部分。根域(网站建设者本身)，子域(用户获得免费托管的网站)，自定义域(用户指向他们刚刚建立的网站的 CNAME 记录)。</p><p id="209a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以我把我的控制器分成了几个不同的部分。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c665455022ded51a2698f8704788ac34.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/0*NK8E4j-G6bSDr7D2.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">这是几个控制器</figcaption></figure><p id="39f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">构建器(仅根域/构建器部件)、域(子域)和页面(自定义域)</p><p id="8471" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在开始使用这个应用程序之前，我认为我可以把所有的自定义域放在子域控制器上，但是我发现，简单地将用户的自定义域路由到根域，并让控制器读取主机名更容易设置 DNS。</p><p id="ea8a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我也在 routes.rb 中设置了如下的域约束。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/1b42346a1e994eb77bf50c5647d32a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OCgJqszlgYeH7giv.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">lvh。me 是本地主机的代理，对于多租户非常有用</figcaption></figure><p id="5681" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Rails 的厉害之处在于，我可以将这种约束直接插入到我现有的路由中，并且只为根域、子域等呈现特定的路由。</p><p id="aa93" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，用于确定请求是在根域、外部主机还是子域上的所有逻辑都位于页面控制器中。这里的关键是 is_host 确定我们是在本地主机上开发还是在我们的生产域上发出请求。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/1766e39413d1dd1f30ca0cd811c53e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*71pSxoBNLHBIygGX.png"/></div></div></figure><p id="5a74" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们有一个简单的 if 语句，说明如果我们不是根域，并且自定义域没有子域(自定义域不允许子域)，那么我们可以将它们转发给自定义域的处理程序。</p><p id="ed80" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，如果我们在我们的根域，而不是“www ”,我们将它们重定向到处理子域逻辑的站点控制器。变量 current_site_build 也将允许我们查看他们是否有站点。</p><p id="2044" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">显然这不是最漂亮的代码，但它完成了工作，而且只花了几分钟就开始工作了。我总是试图尽可能多的完成工作，而不是尽可能的完美。</p><h1 id="d7d4" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">有趣的东西:构建生成器</h1><p id="34d8" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">现在是有趣的部分:为构建器构建前端主要只是 html 模板和一些条件渲染逻辑。Rails 的伟大之处在于。erb 模板和在提供给客户端之前呈现 html 服务器端的能力。</p><p id="8d9e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于 MVP，我有大约 5 个基本的构建模块和一个自定义模块，用户可以在其中放置自己的东西。下面是它们的样子:</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/318e5ee0e5f3a7c58de553e547928d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/0*o3MvhfDmdS7q6pMg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">路线图和稀有部分</figcaption></figure><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/673792b903afd966fc74afee68ab997c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HEVQpwJRQLHt3Oq1.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">这是它们的大概样子</figcaption></figure><p id="82bb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，这是一个 NFT 铸造网站，但我们今天在这里谈论建设网站建设者！不同的模板通过 Ruby 的 switch-case 块来呈现。每个部分都有一个“模型”列，根据创建时对应的块来命名。我在这个应用中重复使用了同样的开关逻辑。也许有更好的方法有条件地呈现大量不同的模板。有兴趣了解更多信息！</p><p id="558c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最终，我需要将 erb 中现有的 if then 块重构为 helper 方法来进行清理。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/644fd4da147694570e19f92f6ee2f71e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DR-hTjch0bD_scj9XLg6rQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">将这些难看的块重构到 section_helper.rb 方法中</figcaption></figure><p id="baec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将有助于清理我们的观点，并以 Rails 方式’做事</p><h1 id="59bd" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">接下来:内嵌编辑</h1><p id="d7ed" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">有一些关于使用 Rails 和 turbo 帧进行内联编辑的内联编辑教程，但是我不想增加在其他 turbo 帧中嵌套 Turbo 帧的额外复杂性，所以我选择了优秀的普通 Javascript。</p><p id="ac1c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这比我想象的要简单得多，而且比其他人想象的要简单得多，您可以简单地用一个具有相同类名的表单字段替换您想要编辑的任何内容。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/a61a7dd6f04cfba7a2e3502a356fe0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KGw7JaF0IMKSRpG2.png"/></div></div></figure><p id="dc51" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在视图中，我有一个简单的 onclick 函数，它接受自己的部分 id、模型类型和元素，并用自己的输入字段进行替换。在尝试了这一点之后，它很容易工作，你所要做的就是确保在你想要编辑的部分呈现一个表单，这样就完成了！</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/b757be38cb081c1ce97a74f13115b95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZvI-KxMXp1xir23h26VeiA.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">迷你演示！</figcaption></figure><h1 id="16c8" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">活动存储:图像上传</h1><p id="f69f" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">我把这部分留到最后，因为我基本上没有为此做任何工作。您可以按照本教程使用带扶手的储物桶。无论您使用 AWS S3 还是 DO spaces，概念都是一样的。我确实发现来自 DO 的 CDN 使用非常慢，所以我停止了它，但是从那以后它一直运行得很平稳。强烈推荐！</p><div class="ne nf gp gr ng nh"><a href="https://www.digitalocean.com/community/tutorials/how-to-use-activestorage-in-rails-6-with-digitalocean-spaces" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd io gy z fp nm fr fs nn fu fw im bi translated">如何通过数字海洋空间|数字海洋在 Rails 6 中使用 ActiveStorage</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">作为“为捐赠而写”计划的一部分，作者选择了“技术多样性基金”来接受捐赠。当…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">www.digitalocean.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv jt nh"/></div></div></a></div><p id="759e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将提到的另一个警告是，当在控制器中查询您的记录时，请确保添加。使用 _attached_photo 或您指定的任何名称来调用您的活动存储上传。这将消除(N+1)查询问题，因为 Rails 将告诉服务器进行一个大的 SQL 查询，而不是顺序查询。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/75c5fe0088d616ec07922e623b095c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dm6ECkeGNOyLFkcs.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">还有！不要忘记预载</figcaption></figure><p id="f8b5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我还补充道。预加载以加速我的查询，因为我将总是查询属于一个节的元素。同样，您总是可以将元素作为 JSON 对象的一部分或其他内容，但这超出了本文的范围。</p><h1 id="74c1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">概观</h1><p id="1e1f" class="pw-post-body-paragraph ka kb in kc b kd ly kf kg kh lz kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">好吧，太多了！我们经历了三个独立域的路由(在一个应用程序中)，回顾了我们的数据库建模，并讨论了我们如何开始构建和干燥我们的视图。我们甚至讨论了如何开始将主动存储桶上传与云提供商集成。</p><p id="ae4d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">构建这个应用程序的下一个挑战部分是安装和配置 Caddy 2 服务器以在 droplet 上运行。设置一个 droplet 应该很容易，尤其是如果你之前已经安装了 Ruby on Rails 的话。单独安装 Ruby 有点麻烦。我在这里单独写了一个关于我的配置的教程:<a class="ae jz" href="https://medium.com/@austinw.035/how-to-use-caddy-server-2-beginner-a24747d175db" rel="noopener">https://medium . com/@ austinw . 035/how-to-use-caddy-server-2-初学者-a24747d175db </a></p><p id="fc1f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请记住，这对我很重要，因为我希望我的用户有一个*.websitebuilder.com 通配符域。如果你只想自定义域名，你绝对可以使用 Heroku 或其他 PaaS。不幸的是，大多数企业通配符域名解决方案相当昂贵。所以球童 2 号现在只能做这个了。</p><p id="8913" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了便于部署，我尝试使用 Hatchbox.io，它非常方便。尽管我禁用了所有部署脚本和随之而来的 nginx 特性。如果你在像 Digital Ocean 或 AWS 这样的云提供商上托管自己的东西，我绝对推荐 Hatchbox 这么做。就开始而言，这是一个巨大的时间节省。(在开始这个项目之前，我从未接触过云提供商)。</p><p id="8860" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">希望你从阅读这篇文章中获得了一些关于构建一个网站建设者的见解，我还没有找到任何关于这种特定类型的应用程序的好教程。祝你好运！下次见。</p></div></div>    
</body>
</html>