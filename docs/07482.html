<html>
<head>
<title>React wrappers with StencilJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 StencilJS 反应包装器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-wrappers-with-stenciljs-6b574500f6f6?source=collection_archive---------2-----------------------#2022-03-29">https://blog.devgenius.io/react-wrappers-with-stenciljs-6b574500f6f6?source=collection_archive---------2-----------------------#2022-03-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eca140f56d044e59a992309416fb3c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SzTv7RWFOz1txe6lC2kKQ.png"/></div></div></figure><p id="bbba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上一篇文章中，我们介绍了 StencilJS 如何让我们更容易地使用 web 组件。</p><div class="kt ku gp gr kv kw"><a href="https://medium.com/@kkakroo/working-with-stenciljs-a4d75f7b1131" rel="noopener follow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">使用模板 JS</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">StencilJS 如何简化 Web 组件的使用</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">medium.com</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk jt kw"/></div></div></a></div></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="6cc0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还学习了什么是 Web 组件以及如何开始使用它们。</p><div class="kt ku gp gr kv kw"><a href="https://medium.com/@kkakroo/what-are-web-components-cbfdf08c35a9" rel="noopener follow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">什么是 Web 组件</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">什么是 Web 组件以及如何开始使用它们。</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">medium.com</p></div></div><div class="lf l"><div class="ls l lh li lj lf lk jt kw"/></div></div></a></div><p id="a99e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们将看到如何从模板组件库中创建 react 包装器。</p><p id="7dac" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但在此之前，我们需要理解为什么我们需要这些。</p><p id="81f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上一篇文章中，我们使用了一个徽章来理解模板是如何工作的。虽然徽章可以很好地与 react 一起工作，但是当组件开始变得复杂时，我们会遇到一些问题。</p><ol class=""><li id="8b9d" class="lt lu in jx b jy jz kc kd kg lv kk lw ko lx ks ly lz ma mb bi translated">HTML 自定义元素不支持现成的复杂属性/特性。</li><li id="1f1d" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">智能感知——我们需要好东西。类型检查、props 元数据和自动完成。这是我们消费原生包时得到的东西。</li><li id="6e5a" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">自定义事件处理不正确。</li></ol><p id="5854" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了理解这些问题，我们创建了一个简单的模板组件，它接受一个列表并在浏览器中显示它。</p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="f588" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里<code class="fe mn mo mp mq b">kk-list</code>有一个属性<code class="fe mn mo mp mq b">items</code>,它是一个字符串数组，并从项目中呈现一个<code class="fe mn mo mp mq b">ul</code>。</p><p id="5c9e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们尝试从一个 HTML 页面中消费<code class="fe mn mo mp mq b">kk-list</code></p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="c199" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是当我们试图使用它时，它不起作用，工作示例<a class="ae mr" href="https://codesandbox.io/s/stencil-complex-object-issues-7nh4xp?file=/index.html" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="cd3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是因为不支持除了<code class="fe mn mo mp mq b">boolean</code>、<code class="fe mn mo mp mq b">number</code>和<code class="fe mn mo mp mq b">string</code>之外的任何道具。</p><p id="9dff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个问题的解决方案是使用 javascript 获取元素并将属性传递给它，这在下面实现。</p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="6e4b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里我们用 javascript 获取 HTML 定制元素(第 21 行),并传递 prop，这样就可以了。工作示例<a class="ae mr" href="https://codesandbox.io/s/stencil-complex-object-fix-1zp9hq?file=/index.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="4390" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">类似地，这可以通过使用<a class="ae mr" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank"> ref </a>在 React 中实现，这里的工作示例<a class="ae mr" href="https://codesandbox.io/s/stencil-complex-object-react-qxk508?file=/src/App.js" rel="noopener ugc nofollow" target="_blank">是</a></p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="d697" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种方法不太方便，在 React 中工作的人不会觉得这很直观。</p><p id="293e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，我们没有任何智能感知、类型检查，元数据也无法通过。在组件库的情况下，知道什么是道具、它们的描述以及要传递什么值是非常有帮助的。</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="b94d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了帮助我们解决这些问题并提供原生体验，stencil 为我们提供了为不同框架添加输出目标的插件。</p><p id="2670" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将发出一个包，其行为与在这些框架中创建的本地包相同。</p><p id="e329" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在只关注 React，因为其他框架的过程可能会有所不同。目前支持 Angular，Ember，React 和 Vue。</p><p id="6622" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦设置完成，您就可以在 stencil 中一次性创建组件，并在任何受支持的框架中生成本地组件库。</p><p id="8297" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Stencil 建议采用单一回购结构。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/008f5ba270c14e5a5df9c5c9cb18ef91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*UcbCbb9fHzmKzSgbts2Spg.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">用于模板反应包装材料的单报告结构</figcaption></figure><p id="fcb4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mn mo mp mq b">kk-component-library</code> —需要为其创建 react 包装器的模板 js 组件库(在前一篇文章中创建)</p><p id="e151" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mn mo mp mq b">kk-component-library-react</code> —帮助从模板组件库中创建 react 包的模板。从<a class="ae mr" href="https://github.com/ionic-team/stencil-ds-react-template" rel="noopener ugc nofollow" target="_blank">这里下载</a></p><p id="4d18" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mn mo mp mq b">kk-component-library-react-tester</code>(可选)—生成的 React 包的 React tester 应用程序。仅添加用于测试生成的包。</p><p id="ccfd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要将包<code class="fe mn mo mp mq b"><a class="ae mr" href="https://www.npmjs.com/package/@stencil/react-output-target" rel="noopener ugc nofollow" target="_blank">@stencil/react-output-target</a></code>添加到组件库中。这有助于配置我们的组件库来构建 React 包装的组件。</p><p id="e675" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们先安装它</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="68e8" class="nb nc in mq b gy nd ne l nf ng">cd kk-component-library<br/>npm install @stencil/react-output-target</span></pre><p id="92df" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">安装完成后，我们需要更新 stencil.config.ts 文件，如下所示</p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="d5eb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里，我们通过使用已安装的包为 React 添加了一个新的输出目标(第 7 行)。</p><p id="fdae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们为它提供了<code class="fe mn mo mp mq b">proxiesFile</code>的路径(定义文件需要在这里生成)。模板项目需要这个文件来生成 React 包装器。</p><p id="cdeb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当<code class="fe mn mo mp mq b">includeDefineCustomElements</code>为真时，React 组件将从<code class="fe mn mo mp mq b">dist-custom-elements</code>而不是<code class="fe mn mo mp mq b">dist</code>导入和定义元素，这是一种更优化的树抖动方式，也是 stencil 推荐的方式。如果一个库有多个组件，并且只使用了其中的一部分，那么所有的代码都不会被放到项目中。</p><p id="5a76" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦设置好了，我们就可以通过命令构建组件库</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="a6d5" class="nb nc in mq b gy nd ne l nf ng">npm run build</span></pre><p id="c0e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将在下面提到的路径上生成<code class="fe mn mo mp mq b">proxiesFile</code></p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1c7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦构建成功，我们就发布库(包装项目将需要这个发布的包)</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="d6b6" class="nb nc in mq b gy nd ne l nf ng">npm publish</span></pre><p id="1f6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们的模板组件库包已经发布到 npm <a class="ae mr" href="https://www.npmjs.com/package/kk-component-library" rel="noopener ugc nofollow" target="_blank">这里</a>，我们转到模板项目并安装新发布的库。</p><p id="fbca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还需要根据我们在<code class="fe mn mo mp mq b">package.json</code>文件中的要求更新包名和描述。</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="cd95" class="nb nc in mq b gy nd ne l nf ng">cd kk-component-library-react<br/>npm install kk-component-library</span></pre><p id="6a1a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦安装了库，我们就构建模板项目</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="de99" class="nb nc in mq b gy nd ne l nf ng">npm run build</span></pre><p id="e679" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦它构建成功，我们就可以发布它了</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="60c6" class="nb nc in mq b gy nd ne l nf ng">npm publish</span></pre><p id="22bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们的 react 包已经准备好并在这里发布<a class="ae mr" href="https://www.npmjs.com/package/kk-component-library-react" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="5c75" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们可以转移到 tester 项目，安装软件包并运行它</p><pre class="mh mi mj mk gt mx mq my mz aw na bi"><span id="4c62" class="nb nc in mq b gy nd ne l nf ng">cd kk-component-library-react-tester<br/>npm i kk-component-library-react</span></pre><p id="5f42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如下更新<code class="fe mn mo mp mq b">App.tsx</code></p><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="68a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以在第 23 行看到，我们能够将一个项目列表直接传递给<code class="fe mn mo mp mq b">KkList</code></p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/084ee793795b549fbf98effea5415ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50TZHl1TCbsjEOnHpo1xFA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">流经 react 包的 Intellisense 和属性元数据</figcaption></figure><p id="25bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，所有的智能感知和元数据也流过，工作示例<a class="ae mr" href="https://codesandbox.io/s/kk-component-library-react-tester-ut1swf" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><p id="a702" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所有代码都可以在<a class="ae mr" href="https://github.com/kkakroo/stencil-js" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="8cfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有一个<a class="ae mr" href="https://github.com/facebook/react/issues/11347" rel="noopener ugc nofollow" target="_blank">提议</a>来改进<a class="ae mr" href="https://custom-elements-everywhere.com" rel="noopener ugc nofollow" target="_blank">对 React 中自定义元素</a>的支持，这是一个实验版本，可能会在 React 的未来版本中结束。</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="7e39" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望你喜欢这篇文章。如有任何建议或问题，可在<a class="ae mr" href="https://www.linkedin.com/in/kkakroo/" rel="noopener ugc nofollow" target="_blank"><em class="ni">LinkedIn</em></a><em class="ni">与我联系或在下方评论。</em></p></div></div>    
</body>
</html>