<html>
<head>
<title>Validate Objects with Joi — Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Joi 方法验证对象</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/validate-objects-with-joi-methods-ad1fd5576999?source=collection_archive---------2-----------------------#2021-01-10">https://blog.devgenius.io/validate-objects-with-joi-methods-ad1fd5576999?source=collection_archive---------2-----------------------#2021-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/26d3064ebae3c4e50ff560ecea544896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QvuqVXlFGl4nsDc3"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ben White </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="fee9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Joi 是一个让我们轻松验证对象结构的库。</p><p id="71c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Joi 验证对象。</p><h1 id="e021" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">isError</code></h1><p id="499c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用<code class="fe lz ma mb mc b">isError</code>方法检查一个属性是否是一个<code class="fe lz ma mb mc b">Error</code>实例:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="89d0" class="mq lc iq mc b gy mr ms l mt mu">Joi.isError(new Error());</span></pre><h1 id="e2d2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">isExpression</code></h1><p id="3464" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">isExpressiuon</code>方法让我们检查参数是否是一个表达式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="cea4" class="mq lc iq mc b gy mr ms l mt mu">const expression = Joi.x('{a}');<br/>Joi.isExpression(expression);</span></pre><h1 id="9f87" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">isRef</code></h1><p id="1c34" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">isRef</code>让我们检查参数是否是对另一个模式的引用:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="6024" class="mq lc iq mc b gy mr ms l mt mu">const ref = Joi.ref('a');<br/>Joi.isRef(ref);</span></pre><h1 id="8726" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">isSchema</code></h1><p id="8c54" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">isSchema</code>让我们检查参数是否是一个模式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="6c2c" class="mq lc iq mc b gy mr ms l mt mu">const schema = Joi.any();<br/>Joi.isSchema(schema);</span></pre><h1 id="ccd5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">ref</code></h1><p id="9146" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">ref</code>生成对另一个模式的引用。</p><p id="aa5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="1292" class="mq lc iq mc b gy mr ms l mt mu">const Joi = require("joi");<br/>const schema = Joi.object({<br/>  a: Joi.ref("b.c"),<br/>  b: {<br/>    c: Joi.any()<br/>  }<br/>});</span></pre><p id="5187" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过引用<code class="fe lz ma mb mc b">b.c</code>属性的模式来应用<code class="fe lz ma mb mc b">Joi.any</code>模式。</p><p id="3f0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">引用是相对的，所以我们可以这样写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="be64" class="mq lc iq mc b gy mr ms l mt mu">const Joi = require("joi");<br/>const schema = Joi.object({<br/>  x: {<br/>    b: {<br/>      c: Joi.any(),<br/>      d: Joi.ref("c")<br/>    }<br/>  }<br/>});</span></pre><p id="5e2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">引用<code class="fe lz ma mb mc b">b</code>中的<code class="fe lz ma mb mc b">c</code>属性。</p><h1 id="92d1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">types</code></h1><p id="bc12" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">types</code>方法来获得可以用来创建模式的验证器。</p><p id="7431" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="15ba" class="mq lc iq mc b gy mr ms l mt mu">const Joi = require("joi");<br/>const { object, string } = Joi.types();</span><span id="7d28" class="mq lc iq mc b gy mv ms l mt mu">const schema = object.keys({<br/>  property: string.min(10)<br/>});</span></pre><p id="7b4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<code class="fe lz ma mb mc b">types</code>方法中获取<code class="fe lz ma mb mc b">string</code>模式。</p><h1 id="870d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">any</code></h1><p id="dab3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">any</code>创建匹配任何数据类型的模式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="36e9" class="mq lc iq mc b gy mr ms l mt mu">const any = Joi.any();<br/>await any.validateAsync('a');</span></pre><h2 id="dc3e" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">type</code></h2><p id="9e1a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">type</code>属性来获取模式的类型:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="50ea" class="mq lc iq mc b gy mr ms l mt mu">const schema = Joi.string();<br/>schema.type === 'string';</span></pre><h2 id="75bb" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">allow</code></h2><p id="76a2" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">allow</code>方法让我们设置模式中允许的值:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="3230" class="mq lc iq mc b gy mr ms l mt mu">const schema = {<br/>  a: Joi.any().allow("a")<br/>};</span></pre><p id="5eb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅允许<code class="fe lz ma mb mc b">'a'</code>作为属性<code class="fe lz ma mb mc b">a</code>的值。</p><p id="788e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过传入更多的参数来检查多个值。</p><h2 id="b842" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">artifact</code></h2><p id="f613" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">artifact</code>返回验证结果:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="cdf4" class="mq lc iq mc b gy mr ms l mt mu">const schema = {<br/>  a: [<br/>    Joi.number().max(10).artifact("under"),<br/>    Joi.number().min(11).artifact("over")<br/>  ]<br/>};</span></pre><h2 id="dd2d" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">custom</code></h2><p id="34fc" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用<code class="fe lz ma mb mc b">custom</code>方法创建自己的模式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="dd9f" class="mq lc iq mc b gy mr ms l mt mu">const Joi = require("joi");<br/>const method = (value, helpers) =&gt; {<br/>  if (value === "1") {<br/>    throw new Error("nope");<br/>  }</span><span id="04c7" class="mq lc iq mc b gy mv ms l mt mu">  if (value === "2") {<br/>    return "3";<br/>  }<br/>  return value;<br/>};</span><span id="f2d9" class="mq lc iq mc b gy mv ms l mt mu">const schema = Joi.string().custom(method, "custom validation");</span></pre><p id="8b20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查<code class="fe lz ma mb mc b">value</code>并返回我们想要的值。</p><p id="c55e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果值无效，我们也可以抛出错误。</p><p id="bc52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以抛出现有的错误:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="8dea" class="mq lc iq mc b gy mr ms l mt mu">const Joi = require("joi");<br/>const method = (value, helpers) =&gt; {<br/>  if (value === "1") {<br/>    return helpers.error("any.invalid");<br/>  }</span><span id="4fa6" class="mq lc iq mc b gy mv ms l mt mu">  if (value === "2") {<br/>    return "3";<br/>  }<br/>  return value;<br/>};</span><span id="57d1" class="mq lc iq mc b gy mv ms l mt mu">const schema = Joi.string().custom(method, "custom validation");</span></pre><p id="9f80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe lz ma mb mc b">helpers</code>对象得到错误。</p><h2 id="8f38" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">empty</code></h2><p id="4c3b" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">empty</code>匹配一个空模式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="afd3" class="mq lc iq mc b gy mr ms l mt mu">let schema = Joi.string().empty('');</span></pre><p id="b4a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将认为空字符串是有效的。</p><p id="9395" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="665d" class="mq lc iq mc b gy mr ms l mt mu">let schema = Joi.string().empty();</span></pre><p id="3301" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们配<code class="fe lz ma mb mc b">undefined</code>。</p><h2 id="63f6" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">error</code></h2><p id="cbab" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">error</code>让我们在验证失败时抛出一个错误:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="e178" class="mq lc iq mc b gy mr ms l mt mu">const schema = Joi.string().error(new Error('string required'));</span></pre><p id="6d1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果验证失败，我们将传递的错误抛出到<code class="fe lz ma mb mc b">error</code>方法中。</p><h2 id="d69c" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><code class="fe lz ma mb mc b">extract</code></h2><p id="46c5" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">extract</code>从另一个模式中提取一个模式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="38e7" class="mq lc iq mc b gy mr ms l mt mu">const schema = Joi.object({ foo: Joi.object({ bar: Joi.number() }) });<br/>const number = schema.extract('foo.bar');</span></pre><p id="a785" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将从<code class="fe lz ma mb mc b">foo.bar</code>中获取模式。</p><h1 id="53ee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">Conclusion</code></h1><p id="f412" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用各种 Joi 方法验证值。</p></div></div>    
</body>
</html>