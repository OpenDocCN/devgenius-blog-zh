<html>
<head>
<title>Build your First Production-Grade Data Science Project- a Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您的第一个生产级数据科学项目——教程</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/build-your-first-production-grade-data-science-project-a-tutorial-a596c74fadf8?source=collection_archive---------8-----------------------#2022-12-28">https://blog.devgenius.io/build-your-first-production-grade-data-science-project-a-tutorial-a596c74fadf8?source=collection_archive---------8-----------------------#2022-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/2948221fbbeee1f0dfc006da1bfa9cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/0*BSGyb9G4K6N5trj-.png"/></div></figure><h1 id="a12a" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">简介</strong></h1><p id="e0cb" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">数据科学现在是一个混乱的工作(特别是笔记本电脑环境)，许多数据科学家在建立数据科学项目时没有软件工程师的视角。</p><p id="3c7c" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我们需要我们的代码投入生产。</p><p id="e782" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">ML 产品:需要运行和维护代码。</p><p id="3852" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">创造机器学习产品的挑战</p><ul class=""><li id="a074" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated">数据科学必须学习许多工具来创建高质量的代码</li><li id="2966" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">每个人都以不同的方式工作</li><li id="8904" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">代码不能在其他人的机器上运行</li><li id="8acc" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">等等…</li></ul><p id="7e4b" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><strong class="kr io">凯卓是什么？</strong></p><p id="18f7" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">Kedro 是一个让你的脚本可复制、可维护和模块化的工具。它也是一个帮助你分离关注点和版本的工具；和一个帮助你交付真实世界的 ML 应用的工具；你的生活会更容易。</p><p id="bef4" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><strong class="kr io">为什么是凯卓？</strong></p><ul class=""><li id="0587" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated">当你需要一个团队合作时，jupyter notebook 是一个很好的选择。</li><li id="c4d4" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">就像 react 或者 django</li></ul><p id="fb29" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">凯卓给了你什么？</p><ul class=""><li id="32ea" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated">项目模板:团队中的每个人都有相同的视角</li><li id="0bbe" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">数据目录:声明如何输入和输出项目</li><li id="3f57" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">节点+管道:支持以数据为中心的工作流的构造</li><li id="5796" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">展开性</li></ul><h1 id="d23a" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">教程时间！！！</strong></h1><p id="a78e" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">凯德罗航天公司</p><p id="84b8" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">在本教程中，我们为价格预测模型构建节点和管道，以说明典型的 Kedro 工作流的步骤。</p><h1 id="6afb" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">方案</h1><p id="07a9" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated"><em class="mg">现在是 2160 年，太空旅游业正在蓬勃发展。在全球范围内，数以千计的航天飞机公司带游客往返月球。你已经能够获得列出每架航天飞机提供的便利设施、顾客评论和公司信息的数据。</em></p><p id="acfa" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><strong class="kr io"> <em class="mg">项目</em> </strong> : <em class="mg">你想构造一个模型，预测每次去月球旅行以及相应的返程航班的价格。</em></p><p id="58fa" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">安装 kedro 只需</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="78a6" class="mq js in mm b be mr ms l mt mu">$ kedro install</span></pre><h1 id="faf2" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak"> 1。设置 Kedro </strong></h1><p id="497d" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">首先要做的是创建一个 kedro 项目模板。我们可以使用$kedro new，然后输入项目标识。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="bca2" class="mq js in mm b be mr ms l mt mu">$ kedro new<br/>Project Name:<br/>=============<br/>Please enter a human readable name for your new project.<br/>Spaces and punctuation are allowed.<br/> [New Kedro Project]: spaceflight_kedro<br/>Repository Name:<br/>================<br/>Please enter a directory name for your new project repository.<br/>Alphanumeric characters, hyphens and underscores are allowed.<br/>Lowercase is recommended.<br/> [new-kedro-project]: spaceflight_tutorial<br/>Python Package Name:<br/>====================<br/>Please enter a valid Python package name for your project package.<br/>Alphanumeric characters and underscores are allowed.<br/>Lowercase is recommended. Package name must start with a letter or underscore.<br/> [new_kedro_project]: spaceflight_tutorial<br/>Generate Example Pipeline:<br/>==========================<br/>Do you want to generate an example pipeline in your project?<br/>Good for first-time users. (default=N)<br/> [y/N]: NChange directory to the project generated in /home/user/spaceflight_tutorial</span></pre><p id="8f43" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">这是 kedro 提供的布局。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="6777" class="mq js in mm b be mr ms l mt mu">{{ cookiecutter.repo_name }}     # Parent directory of the template<br/>├── conf                         # Project configuration files<br/>├── data                         # Local project data (not committed to version control)<br/>├── docs                         # Project documentation<br/>├── logs                         # Project output logs (not committed to version control)<br/>├── notebooks                    # Project related Jupyter notebooks (can be used for experimental code before moving the code to src)<br/>├── README.md                    # Project README<br/>├── setup.cfg                    # Configuration options for tools e.g. `pytest` or `flake8`<br/>└── src                          # Project source code<br/>    └── {{ cookiecutter.python_package }}<br/>       ├── __init.py__<br/>       ├── pipelines<br/>       ├── pipeline_registry.py<br/>       ├── __main__.py<br/>       └── settings.py<br/>    ├── requirements.txt<br/>    ├── setup.py<br/>    └── tests</span></pre><h1 id="6d87" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak"> 2。设置所有项目依赖关系</strong></h1><p id="7f38" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">您可以在 src/requirements.txt 中修改项目的所有依赖项。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="f759" class="mq js in mm b be mr ms l mt mu"># code quality packages<br/>black==22.1.0 # Used for formatting code with `kedro lint`<br/>flake8&gt;=3.7.9, &lt;5.0 # Used for linting code with `kedro lint`<br/>ipython==7.0 # Used for an IPython session with `kedro ipython`<br/>isort~=5.0 # Used for linting code with `kedro lint`<br/>nbstripout~=0.4 # Strips the output of a Jupyter Notebook and writes the outputless version to the original file<br/><br/># notebook tooling<br/>jupyter~=1.0 # Used to open a Kedro-session in Jupyter Notebook &amp; Lab<br/>jupyterlab~=3.0 # Used to open a Kedro-session in Jupyter Lab<br/><br/># Pytest + useful extensions<br/>pytest-cov~=3.0 # Produces test coverage reports<br/>pytest-mock&gt;=1.7.1, &lt;2.0 # Wrapper around the mock package for easier use with pytest<br/>pytest~=6.2 # Testing framework for Python code<br/><br/>kedro[pandas.CSVDataSet, pandas.ExcelDataSet, pandas.ParquetDataSet]==0.18.4   # Specify optional Kedro dependencies<br/>kedro-viz~=5.0                                                                 # Visualise your pipelines<br/>scikit-learn~=1.0                                                              # For modelling in the data science pipeline</span></pre><p id="ae02" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">之后，安装所有的项目依赖项。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="3ddd" class="mq js in mm b be mr ms l mt mu">pip install -r src/requirements.txt</span></pre><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/6a7e7d7ce939230e694029ea9009d4fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*HXFOcwaNorgUEBhQQDpYKw.png"/></div></div></figure><h1 id="355e" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak"> 3。设置数据</strong></h1><p id="ee86" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">要为 Kedro 项目设置数据，通常需要配置管理数据加载和保存的数据源注册表。</p><p id="67a3" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我们在本教程中使用了 3 个数据集。“companies.csv”、“shuttles.xlsx”和“reviews.csv”。你可以从下面的链接下载这个文件。</p><ul class=""><li id="ff8d" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated"><a class="ae na" href="https://kedro-org.github.io/kedro/companies.csv" rel="noopener ugc nofollow" target="_blank"> companies.csv </a></li><li id="9071" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><a class="ae na" href="https://kedro-org.github.io/kedro/reviews.csv" rel="noopener ugc nofollow" target="_blank">点评. csv </a></li><li id="0dd0" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><a class="ae na" href="https://kedro-org.github.io/kedro/shuttles.xlsx" rel="noopener ugc nofollow" target="_blank"> shuttles.xlsx </a></li></ul><p id="e577" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">都放在 data/01_raw 里。你可以把所有的原始数据放在这个文件夹里。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/c5a32284ec41fda983cad522cd02bfc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*DvlTIUnKXk7Xuf7gymumGw.png"/></div></figure><p id="cfe7" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">为了使用所提供的数据集，所有 Kedro 项目都有一个<em class="mg"> conf/base/catalog.yml </em>文件，它充当所使用数据集的注册表。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="ac10" class="mq js in mm b be mr ms l mt mu">companies:<br/>  type: pandas.CSVDataSet<br/>  filepath: data/01_raw/companies.csv<br/><br/><br/>reviews:<br/>  type: pandas.CSVDataSet<br/>  filepath: data/01_raw/reviews.csv<br/><br/>shuttles:<br/>  type: pandas.ExcelDataSet<br/>  filepath: data/01_raw/shuttles.xlsx<br/>  load_args:<br/>    engine: openpyxl # Use modern Excel engine (the default since Kedro 0.18.0)</span></pre><p id="04be" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">在 catalog.yml 中，您可以定义想要使用的所有输入(数据、模型)或想要加载想要使用的输入。</p><p id="fb8e" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">要检查 Kedro 是否正确加载了数据，并检查前五行数据，请打开一个终端窗口并使用<code class="fe nc nd ne mm b">kedro ipython. </code>启动一个 ipython 会话，这样您的终端将打开 IPython 会话，然后您可以在这里浏览您的数据集。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="5d5f" class="mq js in mm b be mr ms l mt mu">catalog.load("companies")</span></pre><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1cd1a8a0b21149533024dbb8a3c50d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*8y_GXSkI45yQtZ9cNdpBZQ.png"/></div></figure><h1 id="df5b" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">4.创建数据处理管道</h1><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ng"><img src="../Images/a762c582979a3225a1e2d0526eca9e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLur-soOInIIXhPFL-1lMg.png"/></div></div></figure><p id="eaa3" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">上图是我们数据预处理阶段的最终示意图。简而言之，我们首先对公司和班车数据集进行数据预处理。之后，我们将评论、公司和班车组合到一个模型输入表中，该表稍后将用于建模。</p><p id="f978" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">一旦我们的数据目录被适当地定义，我们就可以构建我们的管道。首先要理解两个关键概念:<a class="ae na" href="https://kedro.readthedocs.io/en/stable/06_nodes_and_pipelines/01_nodes.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kr io">节点</strong> </a> <strong class="kr io"> </strong>和<a class="ae na" href="https://kedro.readthedocs.io/en/stable/06_nodes_and_pipelines/02_pipeline_introduction.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kr io">管道</strong> </a>。</p><ul class=""><li id="56f1" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated"><strong class="kr io">节点</strong>是管道的积木。它们本质上是 Python 函数，表示要执行的数据转换，例如数据预处理、建模。</li><li id="8dd0" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><strong class="kr io">管道</strong>是连接在一起的节点序列，用于交付工作流。它组织节点的依赖关系和执行顺序，连接输入和输出，同时保持代码模块化。</li></ul><p id="9bea" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我们可以根据我们指定的名称，用下面的命令实例化这些模块化管道。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="b9a4" class="mq js in mm b be mr ms l mt mu">kedro pipeline create data_processing</span></pre><p id="25cf" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">该命令生成管道所需的所有文件:</p><ul class=""><li id="58be" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated"><code class="fe nc nd ne mm b">src/kedro_tutorial/pipelines/data_processing</code> <code class="fe nc nd ne mm b">nodes.py</code>(形成数据处理的节点函数)和<code class="fe nc nd ne mm b">pipeline.py</code>(构建管道)中的两个 python 文件</li></ul><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/45b5a28d2c13a50fbd8d1e8171a704e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:248/format:webp/1*jcQFUk-5bq62J5QekCJM7w.png"/></div></figure><ul class=""><li id="c240" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated">一个 yaml 文件:<code class="fe nc nd ne mm b">conf/base/parameters/data_processing.yml</code>定义运行管道时使用的参数。</li><li id="b840" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated">测试代码文件夹:<code class="fe nc nd ne mm b">src/tests/pipelines/data_processing</code></li><li id="de65" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><code class="fe nc nd ne mm b">__init__.py</code>所需文件夹中的文件，以确保 Python 可以导入管道</li></ul><p id="e473" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">打开<code class="fe nc nd ne mm b">src/kedro_tutorial/pipelines/data_processing/nodes.py</code>，添加下面的代码，它提供了两个函数(<code class="fe nc nd ne mm b"><strong class="kr io">preprocess_companies</strong></code>和<code class="fe nc nd ne mm b"><strong class="kr io">preprocess_shuttles. </strong></code>)，这两个函数将分别产生一个已经在预处理、预处理 _ 公司和预处理 _ 穿梭中完成的数据。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="9c98" class="mq js in mm b be mr ms l mt mu">import pandas as pd<br/><br/><br/>def _is_true(x: pd.Series) -&gt; pd.Series:<br/>    return x == "t"<br/><br/><br/>def _parse_percentage(x: pd.Series) -&gt; pd.Series:<br/>    x = x.str.replace("%", "")<br/>    x = x.astype(float) / 100<br/>    return x<br/><br/><br/>def _parse_money(x: pd.Series) -&gt; pd.Series:<br/>    x = x.str.replace("$", "").str.replace(",", "")<br/>    x = x.astype(float)<br/>    return x<br/><br/><br/>def preprocess_companies(companies: pd.DataFrame) -&gt; pd.DataFrame:<br/>    """Preprocesses the data for companies.<br/><br/>    Args:<br/>        companies: Raw data.<br/>    Returns:<br/>        Preprocessed data, with `company_rating` converted to a float and<br/>        `iata_approved` converted to boolean.<br/>    """<br/>    companies["iata_approved"] = _is_true(companies["iata_approved"])<br/>    companies["company_rating"] = _parse_percentage(companies["company_rating"])<br/>    return companies<br/><br/><br/>def preprocess_shuttles(shuttles: pd.DataFrame) -&gt; pd.DataFrame:<br/>    """Preprocesses the data for shuttles.<br/><br/>    Args:<br/>        shuttles: Raw data.<br/>    Returns:<br/>        Preprocessed data, with `price` converted to a float and `d_check_complete`,<br/>        `moon_clearance_complete` converted to boolean.<br/>    """<br/>    shuttles["d_check_complete"] = _is_true(shuttles["d_check_complete"])<br/>    shuttles["moon_clearance_complete"] = _is_true(shuttles["moon_clearance_complete"])<br/>    shuttles["price"] = _parse_money(shuttles["price"])<br/>    return shuttles</span></pre><p id="5bf0" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">在我们为每个功能创建一个节点之后，接下来我们为数据处理创建一个模块化管道。管道将制定执行顺序，并连接节点的输入和输出。</p><p id="4532" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">将下面的代码添加到数据预处理管道 src/ked ro _ tutorial/pipelines/data _ processing/pipeline . py 中的管道中</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="2992" class="mq js in mm b be mr ms l mt mu">"""<br/>This is a boilerplate pipeline 'data_processing'<br/>generated using Kedro 0.18.4<br/>"""<br/><br/>from kedro.pipeline import Pipeline, node, pipeline<br/><br/># import the function from .nodes<br/>from .nodes import preprocess_companies, preprocess_shuttles<br/><br/>def create_pipeline(**kwargs) -&gt; Pipeline:<br/>    return pipeline(<br/>        [<br/>            node(<br/>                func=preprocess_companies,<br/>                inputs="companies",<br/>                outputs="preprocessed_companies",<br/>                name="preprocess_companies_node",<br/>            ),<br/>            node(<br/>                func=preprocess_shuttles,<br/>                inputs="shuttles",<br/>                outputs="preprocessed_shuttles",<br/>                name="preprocess_shuttles_node",<br/>            ),<br/>        ]<br/>    )</span></pre><ul class=""><li id="cee7" class="ls lt in kr b ks ln kw lo la lu le lv li lw lm lx ly lz ma bi translated"><em class="mg">func</em>:node . py 中的函数，我们想用它将输入处理成想要的输出。</li><li id="5ccc" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><em class="mg">输入</em>:用作函数输入的变量的名称或名称列表。</li><li id="d4c9" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><em class="mg"> outputs </em>:用作函数输出的变量的名称或名称列表。这是我们作用的结果。</li><li id="e13c" class="ls lt in kr b ks mb kw mc la md le me li mf lm lx ly lz ma bi translated"><em class="mg">名称</em>:在日志或任何其他可视化中显示节点时使用的可选节点名称。</li></ul><p id="3652" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">这是我们预处理这两个数据集后的管道。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ni"><img src="../Images/05f369c9babf23ab585ce2afcc6e5eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BzZDgYbapVi8IlOLUpLsQ.png"/></div></div></figure><h1 id="1864" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">可选:保存预处理的数据</h1><p id="53e2" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">默认情况下，Kedro 使用<a class="ae na" href="https://kedro.readthedocs.io/en/stable/kedro.io.MemoryDataSet.html" rel="noopener ugc nofollow" target="_blank"> MemoryDataSet </a>类将输出数据作为临时数据集作为 Python 对象存储在内存中。并且当依赖于它的所有节点都已经超过时，它将被清除。</p><p id="bed2" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">如果您希望将预处理数据保存到文件中，请在<code class="fe nc nd ne mm b">conf/base/catalog.yml</code>的末尾添加以下内容</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="4261" class="mq js in mm b be mr ms l mt mu">preprocessed_companies:<br/>  type: pandas.ParquetDataSet<br/>  filepath: data/02_intermediate/preprocessed_companies.pq</span></pre><pre class="nj ml mm mn bn mo mp bi"><span id="c1b6" class="mq js in mm b be mr ms l mt mu">preprocessed_shuttles:<br/>  type: pandas.ParquetDataSet<br/>  filepath: data/02_intermediate/preprocessed_shuttles.pq</span></pre><h1 id="9130" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">将所有干净的数据合并到一个表中</h1><p id="a8f0" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">接下来，我们希望将三个数据集连接到一个模型输入表中。像以前一样，我们需要在数据预处理中的 node.py 和 pipeline.py 中添加代码。</p><p id="472d" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">将此代码添加到 src/ked ro _ tutorial/pipelines/data _ processing/nodes . py 中</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="db83" class="mq js in mm b be mr ms l mt mu">def create_model_input_table(<br/>    shuttles: pd.DataFrame, companies: pd.DataFrame, reviews: pd.DataFrame<br/>) -&gt; pd.DataFrame:<br/>    """Combines all data to create a model input table.</span></pre><pre class="nj ml mm mn bn mo mp bi"><span id="3d90" class="mq js in mm b be mr ms l mt mu">    Args:<br/>        shuttles: Preprocessed data for shuttles.<br/>        companies: Preprocessed data for companies.<br/>        reviews: Raw data for reviews.<br/>    Returns:<br/>        model input table.</span></pre><pre class="nj ml mm mn bn mo mp bi"><span id="c0d2" class="mq js in mm b be mr ms l mt mu">    """<br/>    rated_shuttles = shuttles.merge(reviews, left_on="id", right_on="shuttle_id")<br/>    model_input_table = rated_shuttles.merge(<br/>        companies, left_on="company_id", right_on="id"<br/>    )<br/>    model_input_table = model_input_table.dropna()<br/>    return model_input_table</span></pre><p id="a47b" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">将此代码添加到 src/ked ro _ tutorial/pipelines/data _ processing/pipeline . py 中</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="02ad" class="mq js in mm b be mr ms l mt mu">from .nodes import create_model_input_table, preprocess_companies, preprocess_shuttles</span></pre><pre class="nj ml mm mn bn mo mp bi"><span id="4e85" class="mq js in mm b be mr ms l mt mu">node(<br/>    func=create_model_input_table,<br/>    inputs=["preprocessed_shuttles", "preprocessed_companies", "reviews"],<br/>    outputs="model_input_table",<br/>    name="create_model_input_table_node",<br/>),</span></pre><p id="2675" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">在我们创建了所有的数据预处理管道之后，我们可以使用<code class="fe nc nd ne mm b">kedro run</code>命令来运行整个管道。</p><h1 id="1acf" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">5.创建数据科学管道</h1><p id="9bca" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">现在让我们看看用于价格预测的 data science pipeline，它使用了 scikit-learn 库中的 LinearRegression 实现。</p><p id="ce12" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">首先，让我们创建数据科学管道。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="b09a" class="mq js in mm b be mr ms l mt mu">kedro pipeline create data_science</span></pre><p id="6ade" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><strong class="kr io">数据科学节点</strong></p><p id="b281" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我们的数据科学节点由拆分、训练和评估组成。您将下面的代码放入 src/kedro _ tutorial/pipelines/data _ science/nodes . py 中</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="69be" class="mq js in mm b be mr ms l mt mu">import logging<br/>from typing import Dict, Tuple<br/><br/>import pandas as pd<br/>from sklearn.linear_model import LinearRegression<br/>from sklearn.metrics import r2_score<br/>from sklearn.model_selection import train_test_split<br/><br/><br/>def split_data(data: pd.DataFrame, parameters: Dict) -&gt; Tuple:<br/>    """Splits data into features and targets training and test sets.<br/><br/>    Args:<br/>        data: Data containing features and target.<br/>        parameters: Parameters defined in parameters/data_science.yml.<br/>    Returns:<br/>        Split data.<br/>    """<br/>    X = data[parameters["features"]]<br/>    y = data["price"]<br/>    X_train, X_test, y_train, y_test = train_test_split(<br/>        X, y, test_size=parameters["test_size"], random_state=parameters["random_state"]<br/>    )<br/>    return X_train, X_test, y_train, y_test<br/><br/><br/>def train_model(X_train: pd.DataFrame, y_train: pd.Series) -&gt; LinearRegression:<br/>    """Trains the linear regression model.<br/><br/>    Args:<br/>        X_train: Training data of independent features.<br/>        y_train: Training data for price.<br/><br/>    Returns:<br/>        Trained model.<br/>    """<br/>    regressor = LinearRegression()<br/>    regressor.fit(X_train, y_train)<br/>    return regressor<br/><br/><br/>def evaluate_model(<br/>    regressor: LinearRegression, X_test: pd.DataFrame, y_test: pd.Series<br/>):<br/>    """Calculates and logs the coefficient of determination.<br/><br/>    Args:<br/>        regressor: Trained model.<br/>        X_test: Testing data of independent features.<br/>        y_test: Testing data for price.<br/>    """<br/>    y_pred = regressor.predict(X_test)<br/>    score = r2_score(y_test, y_pred)<br/>    logger = logging.getLogger(__name__)<br/>    logger.info("Model has a coefficient R^2 of %.3f on test data.", score)</span></pre><p id="6415" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">如你所见，我们没有定义参数 her，Kedro 提供了另一个文件夹来放置你的模型参数<code class="fe nc nd ne mm b">conf/base/parameters/data_science.yml.</code>,在这里你可以修改你的参数和你想用于回归器/建模的特征。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="c5bf" class="mq js in mm b be mr ms l mt mu">model_options:<br/>  test_size: 0.2<br/>  random_state: 3<br/>  features:<br/>    - engines<br/>    - passenger_capacity<br/>    - crew<br/>    - d_check_complete<br/>    - moon_clearance_complete<br/>    - iata_approved<br/>    - company_rating<br/>    - review_scores_rating</span></pre><p id="4955" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><strong class="kr io">数据科学管道</strong></p><p id="a362" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">数据科学的模块化管道在<code class="fe nc nd ne mm b">src/kedro_tutorial/pipelines/data_science/pipeline.py</code>内创建:</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="c172" class="mq js in mm b be mr ms l mt mu">from kedro.pipeline import Pipeline, node, pipeline<br/><br/>from .nodes import evaluate_model, split_data, train_model<br/><br/><br/>def create_pipeline(**kwargs) -&gt; Pipeline:<br/>    return pipeline(<br/>        [<br/>            node(<br/>                func=split_data,<br/>                inputs=["model_input_table", "params:model_options"],<br/>                outputs=["X_train", "X_test", "y_train", "y_test"],<br/>                name="split_data_node",<br/>            ),<br/>            node(<br/>                func=train_model,<br/>                inputs=["X_train", "y_train"],<br/>                outputs="regressor",<br/>                name="train_model_node",<br/>            ),<br/>            node(<br/>                func=evaluate_model,<br/>                inputs=["regressor", "X_test", "y_test"],<br/>                outputs=None,<br/>                name="evaluate_model_node",<br/>            ),<br/>        ]<br/>    )</span></pre><h1 id="b402" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">注册数据集</h1><p id="e978" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">下一步是通过向<code class="fe nc nd ne mm b">conf/base/catalog.yml</code>添加以下定义来注册将保存训练模型的数据集:</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="25e6" class="mq js in mm b be mr ms l mt mu">regressor:<br/>  type: pickle.PickleDataSet<br/>  filepath: data/06_models/regressor.pickle<br/>  versioned: true</span></pre><h1 id="5c52" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">测试管道</h1><p id="4982" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">您现在可以指示 Kedro 运行默认管道，它自动依次执行数据处理和数据科学管道。</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="153d" class="mq js in mm b be mr ms l mt mu">kedro run</span></pre><pre class="nj ml mm mn bn mo mp bi"><span id="7d8d" class="mq js in mm b be mr ms l mt mu">PS C:\Users\luthf\spaceflight_kedro\spaceflight-tutorial&gt; kedro run<br/>[12/27/22 11:00:29] WARNING  c:\users\luthf\appdata\local\programs\python\python37\lib\site-packages\plotly\graph_objects\__init__. warnings.py:110<br/>                             py:288: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.   <br/>                               if LooseVersion(ipywidgets.__version__) &gt;= LooseVersion("7.0.0"):<br/><br/>[12/27/22 11:00:29] INFO     Kedro project spaceflight-tutorial                                                                      session.py:340[12/27/22 11:00:30] INFO     Loading data from 'companies' (CSVDataSet)...                                                      data_catalog.py:344                    INFO     Running node: preprocess_companies_node: preprocess_companies([companies]) -&gt; [preprocessed_companies]     node.py:327                    INFO     Saving data to 'preprocessed_companies' (ParquetDataSet)...                                        data_catalog.py:382                    INFO     Completed 1 out of 6 tasks                                                                     sequential_runner.py:86                    INFO     Loading data from 'shuttles' (ExcelDataSet)...<br/>      .<br/>      .<br/>      .<br/>INFO     Running node: evaluate_model_node: evaluate_model([regressor,X_test,y_test]) -&gt; None                       node.py:327<br/>INFO     Model has a coefficient R^2 of 0.462 on test data.                                                         nodes.py:56<br/>INFO     Pipeline execution completed successfully. </span></pre><h1 id="b559" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">可视化管道</h1><p id="6401" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">一旦所有的管道已经完成，这将是伟大的可视化我们所有的工作。为了做到这一点，kedro 有一个名为<code class="fe nc nd ne mm b">kedro-viz</code>的可视化工具</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="fb49" class="mq js in mm b be mr ms l mt mu">kedro viz</span></pre><p id="fb2f" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">您的默认 webbrowser 将会打开，您将会看到一个可爱的可视化管道！</p><p id="ad48" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">如果到目前为止您一直遵循本教程，那么您应该会得到类似这样的输出(此图不包括最终创建的管道)。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nk"><img src="../Images/6d0b202ee60fa3966b6ef3af9891161f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEjRft04HG1NC1NjT6QC0Q.png"/></div></div></figure><h1 id="292a" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">结论</h1><p id="5b78" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">恭喜你！您刚刚学习了如何使用 Kedro 创建可重复和可维护的数据科学项目。学习 Kedro 可能需要一点时间，但是一旦用 Kedro 建立了数据科学，您会发现维护和更新您的项目不再那么困难。</p><p id="788d" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我希望这篇文章能给你在现有或未来的数据科学项目中使用 Kedro 的动力。</p><p id="4eb6" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">本文中演示项目的源代码可以在这里找到:</p><p id="8b96" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated"><a class="ae na" href="https://github.com/luthfiraditya/kedro-tutorial-using-spaceflight-case" rel="noopener ugc nofollow" target="_blank">https://github . com/luthfiladitya/kedro-tutorial-using-space flight-case</a></p></div></div>    
</body>
</html>