<html>
<head>
<title>How to deploy Rest API application using MySQL on the Kubernetes cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Kubernetes 集群上使用 MySQL 部署 Rest API 应用程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-deploy-rest-api-application-using-mysql-on-the-kubernetes-cluster-4c806de1a48?source=collection_archive---------1-----------------------#2022-03-19">https://blog.devgenius.io/how-to-deploy-rest-api-application-using-mysql-on-the-kubernetes-cluster-4c806de1a48?source=collection_archive---------1-----------------------#2022-03-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/661e2ab2fa01c6b670ef48b007453910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cbzdB_ldDj7_ahCv"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">安特·汉默斯米特在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4a3a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们将 Kubernetes twist 添加到一个经典的软件任务中——使用 MySQL 的 API</p><p id="652f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">软件开发中的经典任务——用 MySQL 数据库编写一个 API 应用程序用于数据存储。可以找到大量关于它的出版物，我们不打算专注于这个特定的任务。</p><p id="7ca2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">加上一个小小的转折——它变成了一个具有挑战性和教育性的任务。这个小变化就是 Kubernetes 平台上的虚拟化。<br/>让我们回顾一下如何在 Kubernetes 集群上使用 MySQL 部署 Rest API 应用程序的分步教程。重点将放在部署方面，应用程序代码仅用于提供正确工作概念的证据。</p><p id="5ad0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此部署中有 3 个组件:</p><ul class=""><li id="2cab" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">库伯内特星团</li><li id="fdfa" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">运行在 Kubernetes 集群上的 MySQL</li><li id="0aea" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">运行在 Kubernetes 集群上的简单 Rest API 应用程序，能够使用运行在同一集群上的 MySQL</li></ul><blockquote class="lm ln lo"><p id="aea6" class="ka kb lp kc b kd ke kf kg kh ki kj kk lq km kn ko lr kq kr ks ls ku kv kw kx ig bi translated"><strong class="kc io">点击关注，不再错过我的文章。</strong></p></blockquote></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="da47" class="ma mb in bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><strong class="ak">先做第一件事——Kubernetes 集群</strong></h2><p id="2675" class="pw-post-body-paragraph ka kb in kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">K3s 是一款轻量级的 Kubernetes。</p><p id="3b99" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">k3d 是一个轻量级的包装器，可以在 docker 中运行<a class="ae jz" href="https://github.com/rancher/k3s" rel="noopener ugc nofollow" target="_blank"> k3s </a> (Rancher Lab 的最小 Kubernetes 发行版)。</p><p id="f8c2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还有什么比这更能提供最好的开发体验呢？这意味着能够在您的笔记本电脑或虚拟机上本地运行所有组件，以避免在运行应用程序时出现任何依赖性。</p><p id="2201" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装 Kubernetes 集群的步骤</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="da90" class="ma mb in nd b gy nh ni l nj nk">$ k3d cluster create --api-port 6550 -p "8081:80@loadbalancer"</span><span id="0a04" class="ma mb in nd b gy nl ni l nj nk">$ export KUBECONFIG="$(k3d kubeconfig write k3s-default)"</span><span id="ffdb" class="ma mb in nd b gy nl ni l nj nk">$ k3d cluster list</span></pre><p id="a6d1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简单优雅—只需一步，我们就可以运行 Kubernetes 集群。</p><p id="6983" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你从未使用过 k3d，你至少应该尝试用它来探索一个用最少的资源在本地运行集群的新世界。</p><p id="ea69" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您的 KUBECONFIG 的定义不是持久的，并且您在终端重新启动后丢失了它，而您的 K3d 集群仍在运行，请使用以下命令指向正确的集群。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="4d48" class="ma mb in nd b gy nh ni l nj nk">$ kubectl config get-contexts</span><span id="7ad7" class="ma mb in nd b gy nl ni l nj nk">$ kubectl config use-context &lt;your cluster name&gt;</span></pre></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><blockquote class="lm ln lo"><p id="a78b" class="ka kb lp kc b kd ke kf kg kh ki kj kk lq km kn ko lr kq kr ks ls ku kv kw kx ig bi translated"><strong class="kc io">一定要点击关注，千万不要错过另一篇关于技巧和提示、生活经验等的文章！</strong></p></blockquote><p id="dfc2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从这个 GitHub 库中克隆本教程的代码</p><div class="nm nn gp gr no np"><a href="https://github.com/LearnTechnoBios/rest-api-mysql-k3d" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">GitHub-LearnTechnoBios/rest-API-MySQL-k3d</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">github.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od jt np"/></div></div></a></div></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="d9ff" class="ma mb in bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><strong class="ak">运行在 Kubernetes 集群上的 MySQL】</strong></h2><p id="4af6" class="pw-post-body-paragraph ka kb in kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">我们将使用 Kubernetes secret 来存储 MySQL 数据库密码<br/>以获得<code class="fe oe of og nd b">base64</code>编码的密码运行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="e40f" class="ma mb in nd b gy nh ni l nj nk">$ echo -n 'admin' | base64</span></pre><p id="2c81" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 mysql-secret.yaml 中的输出</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="24fe" class="ma mb in nd b gy nh ni l nj nk">apiVersion: v1</span><span id="a93f" class="ma mb in nd b gy nl ni l nj nk">kind: Secret</span><span id="77e9" class="ma mb in nd b gy nl ni l nj nk">metadata:</span><span id="cdfe" class="ma mb in nd b gy nl ni l nj nk">name: mysql-pass</span><span id="54b4" class="ma mb in nd b gy nl ni l nj nk">type: Opaque</span><span id="36d9" class="ma mb in nd b gy nl ni l nj nk">data:</span><span id="a104" class="ma mb in nd b gy nl ni l nj nk">password: YWRtaW4=</span></pre><p id="cd84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个秘密运行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="417c" class="ma mb in nd b gy nh ni l nj nk">kubectl create -f mysql-secret.yaml</span></pre><p id="e4d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">验证创建</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="f769" class="ma mb in nd b gy nh ni l nj nk">kubectl get secrets</span></pre><p id="1148" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 mysql-pod.yaml 在集群上部署 mysql pod</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="4206" class="ma mb in nd b gy nh ni l nj nk">apiVersion: v1</span><span id="c010" class="ma mb in nd b gy nl ni l nj nk">kind: Pod</span><span id="4827" class="ma mb in nd b gy nl ni l nj nk">metadata:</span><span id="aa44" class="ma mb in nd b gy nl ni l nj nk">name: k8s-mysql</span><span id="7abf" class="ma mb in nd b gy nl ni l nj nk">labels:</span><span id="5279" class="ma mb in nd b gy nl ni l nj nk">name: lbl-k8s-mysql</span><span id="484d" class="ma mb in nd b gy nl ni l nj nk">spec:</span><span id="0d6e" class="ma mb in nd b gy nl ni l nj nk">containers:</span><span id="6335" class="ma mb in nd b gy nl ni l nj nk">- name: mysql</span><span id="e177" class="ma mb in nd b gy nl ni l nj nk">image: mysql:latest</span><span id="6c76" class="ma mb in nd b gy nl ni l nj nk">env:</span><span id="8bd0" class="ma mb in nd b gy nl ni l nj nk">- name: MYSQL_ROOT_PASSWORD</span><span id="db1b" class="ma mb in nd b gy nl ni l nj nk">valueFrom:</span><span id="4a1a" class="ma mb in nd b gy nl ni l nj nk">secretKeyRef:</span><span id="7647" class="ma mb in nd b gy nl ni l nj nk">name: mysql-pass</span><span id="4c9e" class="ma mb in nd b gy nl ni l nj nk">key: password</span><span id="d9d1" class="ma mb in nd b gy nl ni l nj nk">ports:</span><span id="c1b7" class="ma mb in nd b gy nl ni l nj nk">- name: mysql</span><span id="e454" class="ma mb in nd b gy nl ni l nj nk">containerPort: 3306</span><span id="ad63" class="ma mb in nd b gy nl ni l nj nk">protocol: TCP</span><span id="6d31" class="ma mb in nd b gy nl ni l nj nk">volumeMounts:</span><span id="3fee" class="ma mb in nd b gy nl ni l nj nk">- name: k8s-mysql-storage</span><span id="5f8d" class="ma mb in nd b gy nl ni l nj nk">mountPath: /var/lib/mysql</span><span id="2f0e" class="ma mb in nd b gy nl ni l nj nk">volumes:</span><span id="dd27" class="ma mb in nd b gy nl ni l nj nk">- name: k8s-mysql-storage</span><span id="d575" class="ma mb in nd b gy nl ni l nj nk">emptyDir: {}</span></pre><p id="e48e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建运行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="6592" class="ma mb in nd b gy nh ni l nj nk">kubectl create -f mysql-pod.yaml</span></pre><p id="a880" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">验证创建</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="b6be" class="ma mb in nd b gy nh ni l nj nk">kubectl get pod</span></pre><p id="b362" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">等待 pod 进入运行状态，这可能需要几分钟时间。</p><p id="629e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们有一个在集群<br/>上运行 MySQL 的 pod，让我们连接到 MySQL pod 并尝试使用它</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="b1d5" class="ma mb in nd b gy nh ni l nj nk">$ kubectl exec k8s-mysql -it -- bash<br/>echo $MYSQL_ROOT_PASSWORD<br/>mysql --user=root --password=$MYSQL_ROOT_PASSWORD<br/>show databases;</span></pre><p id="3b57" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从 Pod 上使用时，它工作正常。到目前为止，无法从另一个 pod 访问 MySQL pod。</p><p id="51fd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了允许来自其他 pod 和外部系统的访问，我们应该暴露一个端口。我们将为它使用一个服务。</p><p id="4c92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 mysql-service.yaml</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="d200" class="ma mb in nd b gy nh ni l nj nk">apiVersion: v1</span><span id="dbeb" class="ma mb in nd b gy nl ni l nj nk">kind: Service</span><span id="5060" class="ma mb in nd b gy nl ni l nj nk">metadata:</span><span id="e73e" class="ma mb in nd b gy nl ni l nj nk">name: mysql-service</span><span id="9594" class="ma mb in nd b gy nl ni l nj nk">labels:</span><span id="be85" class="ma mb in nd b gy nl ni l nj nk">name: lbl-k8s-mysql</span><span id="bbdf" class="ma mb in nd b gy nl ni l nj nk">spec:</span><span id="b1f9" class="ma mb in nd b gy nl ni l nj nk">ports:</span><span id="dc5a" class="ma mb in nd b gy nl ni l nj nk">- port: 3306</span><span id="a074" class="ma mb in nd b gy nl ni l nj nk">selector:</span><span id="3a56" class="ma mb in nd b gy nl ni l nj nk">name: lbl-k8s-mysql</span><span id="9c54" class="ma mb in nd b gy nl ni l nj nk">type: ClusterIP</span></pre><p id="37a1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建管路</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="1b21" class="ma mb in nd b gy nh ni l nj nk">kubectl create -f mysql-service.yaml</span></pre><p id="448f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了验证创作</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="7bcc" class="ma mb in nd b gy nh ni l nj nk">kubectl get svc</span></pre></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="e325" class="ma mb in bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><strong class="ak">部署 API 应用并使用 MySQL </strong></h2><p id="20a8" class="pw-post-body-paragraph ka kb in kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">对于非常简单的应用程序，请使用 app.py</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="3f7b" class="ma mb in nd b gy nh ni l nj nk">#!/usr/bin/python<br/> import os<br/> from flask import Flask<br/> from peewee import MySQLDatabase, IntegerField<br/> <br/> MYSQL_ROOT_USER = os.getenv('MYSQL_ROOT_USER', 'root')<br/> MYSQL_ROOT_PASSWORD = os.getenv('MYSQL_ROOT_PASSWORD', 'admin')<br/> MYSQL_ROOT_HOST = os.getenv('MYSQL_ROOT_HOST', 'localhost')<br/> MYSQL_ROOT_PORT = os.getenv('MYSQL_ROOT_PORT', '3306')<br/> MYSQL_ROOT_DB = os.getenv('MYSQL_ROOT_DB', 'mydb')<br/> FLASK_APP_PORT = os.getenv('FLASK_APP_PORT', '8282')<br/> <br/> db = MySQLDatabase(database=MYSQL_ROOT_DB, user=MYSQL_ROOT_USER, password=MYSQL_ROOT_PASSWORD,<br/>                    host=MYSQL_ROOT_HOST, port=int(MYSQL_ROOT_PORT))<br/> <br/> app = Flask(__name__)<br/> app.run(host='0.0.0.0', port=int(FLASK_APP_PORT))<br/> <br/> @app.route('/')<br/> def get_db_version():<br/>     cursor = db.cursor()<br/>     cursor.execute("SELECT VERSION()")<br/>     data = cursor.fetchone()<br/>     db.close()<br/>     return "Database version : %s " % data</span></pre><p id="a1b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加 requirements.txt 文件</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="1f85" class="ma mb in nd b gy nh ni l nj nk">Flask<br/><br/>pymysql<br/><br/>peewee<br/><br/>cryptography</span></pre><p id="32f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加 Dockerfile</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="f2ff" class="ma mb in nd b gy nh ni l nj nk">FROM python:3<br/><br/>WORKDIR /project<br/><br/>COPY . .<br/><br/>RUN pip install -r requirements.txt<br/><br/>CMD ["flask", "run", "--host=0.0.0.0", "--port=8282" ]</span></pre><p id="c4d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">构建图像</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="37bb" class="ma mb in nd b gy nh ni l nj nk">docker build -t &lt;image-name&gt;:&lt;image-tag&gt; .</span></pre><p id="b190" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">推送 docker 映像(在运行推送命令之前，不要忘记登录 docker hub)</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="f265" class="ma mb in nd b gy nh ni l nj nk">docker push   &lt;image-name&gt;:&lt;image-tag&gt;</span></pre><blockquote class="lm ln lo"><p id="f020" class="ka kb lp kc b kd ke kf kg kh ki kj kk lq km kn ko lr kq kr ks ls ku kv kw kx ig bi translated"><strong class="kc io">点击关注，不再错过我的文章。</strong></p></blockquote><p id="e41c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 config-map.yaml 定义将在 API 应用程序中使用的环境变量的值</p><p id="7629" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该使用以下命令的输出为 MYSQL_ROOT_HOST <br/>添加正确的值</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="fa2c" class="ma mb in nd b gy nh ni l nj nk">kubectl get pod k8s-mysql -o template --template={{.status.podIP}}</span></pre><p id="0970" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">配置图. yaml</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="10f0" class="ma mb in nd b gy nh ni l nj nk">apiVersion: v1<br/><br/>kind: ConfigMap<br/><br/>metadata:<br/><br/>  name: app-config<br/><br/>data:<br/><br/>  FLASK_APP: app.py<br/><br/>  MYSQL_ROOT_USER: root<br/><br/>  MYSQL_ROOT_PASSWORD: admin<br/><br/>  MYSQL_ROOT_HOST: "&lt;plase holder&gt;"<br/><br/>  MYSQL_ROOT_PORT: "3306"<br/><br/>  MYSQL_ROOT_DB: mydb<br/><br/>  FLASK_APP_PORT: "8282"</span></pre><p id="2995" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">kubectl apply -f config-map.yaml</p><p id="e66c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要部署应用程序，请使用 we b-application-deployment . YAML 添加您的 image-name:image-tag——docker build 命令中使用的值</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="3faf" class="ma mb in nd b gy nh ni l nj nk">---<br/><br/>apiVersion: apps/v1<br/><br/>kind: Deployment<br/><br/>metadata:<br/><br/>  labels:<br/><br/>    app: web-application <br/><br/>  name: web-application <br/><br/>spec:<br/><br/>  replicas: 1<br/><br/>  strategy:<br/><br/>    type: Recreate<br/><br/>  selector:<br/><br/>    matchLabels:<br/><br/>      app: web-application<br/><br/>  template:<br/><br/>    metadata:<br/><br/>      labels:<br/><br/>        app: web-application<br/><br/>    spec:<br/><br/>      containers:<br/><br/>      - image: &lt;image-name:image-tag &gt; <br/><br/>        name: web-application<br/><br/>        imagePullPolicy: Always        <br/><br/>        resources:<br/><br/>          limits:<br/><br/>            cpu: "0.3"<br/><br/>            memory: "512Mi"<br/><br/>          requests:<br/><br/>            cpu: "0.3"<br/><br/>            memory: "256Mi"<br/><br/>        env:<br/><br/>          - name: FLASK_APP<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: FLASK_APP<br/><br/>          - name: MYSQL_ROOT_USER<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: MYSQL_ROOT_USER<br/><br/>          - name: MYSQL_ROOT_PASSWORD<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: MYSQL_ROOT_PASSWORD<br/><br/>          - name: MYSQL_ROOT_HOST<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: MYSQL_ROOT_HOST<br/><br/>          - name: MYSQL_ROOT_PORT<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: MYSQL_ROOT_PORT<br/><br/>          - name: MYSQL_ROOT_DB<br/><br/>            valueFrom:<br/><br/>              configMapKeyRef:<br/><br/>                name: app-config<br/><br/>                key: MYSQL_ROOT_DB</span></pre><blockquote class="lm ln lo"><p id="ae0d" class="ka kb lp kc b kd ke kf kg kh ki kj kk lq km kn ko lr kq kr ks ls ku kv kw kx ig bi translated">点击关注，永远不要错过我的另一篇文章。</p></blockquote><p id="cc3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建部署</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="e9b7" class="ma mb in nd b gy nh ni l nj nk">kubectl apply -f web-application-deployment.yaml</span></pre><p id="be30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">验证创建</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="e823" class="ma mb in nd b gy nh ni l nj nk">kubectl get deployment</span></pre><p id="4040" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要为此部署运行创建服务</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="9dfa" class="ma mb in nd b gy nh ni l nj nk">kubectl create service clusterip web-application — tcp=80:8282</span></pre><p id="9e78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 web-application-ingress.yaml 为此应用程序创建入口规则</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="1c1c" class="ma mb in nd b gy nh ni l nj nk">apiVersion: networking.k8s.io/v1<br/><br/>kind: Ingress<br/><br/>metadata:<br/><br/>  name: web-application<br/><br/>  annotations:<br/><br/>    ingress.kubernetes.io/ssl-redirect: "false"<br/><br/>spec:<br/><br/>  rules:<br/><br/>  - http:<br/><br/>      paths:<br/><br/>      - path: /<br/><br/>        pathType: Prefix<br/><br/>        backend:<br/><br/>          service:<br/><br/>            name: web-application<br/><br/>            port:<br/><br/>              number: 80</span></pre><p id="9d4d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创造</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="c7fb" class="ma mb in nd b gy nh ni l nj nk">kubectl apply -f web-application-ingress.yaml</span></pre></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="cb86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">验证所有安装程序是否运行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="2e42" class="ma mb in nd b gy nh ni l nj nk">curl localhost:8081/</span></pre><p id="3e2e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该会收到以下输出(版本可能不同)</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="c138" class="ma mb in nd b gy nh ni l nj nk">Database version: 8.0.28 </span></pre><p id="6469" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望这篇循序渐进的工作教程能够帮助您在 Kubernetes 上进行部署。</p><blockquote class="lm ln lo"><p id="02ff" class="ka kb lp kc b kd ke kf kg kh ki kj kk lq km kn ko lr kq kr ks ls ku kv kw kx ig bi translated"><strong class="kc io">一定要点击关注，千万不要错过另一篇关于技巧和提示、生活经验等的文章！</strong></p></blockquote></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="4ef9" class="ma mb in bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated">摘要</h2><p id="33c4" class="pw-post-body-paragraph ka kb in kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">我们学习如何使用 MySQL <br/>将简单的 API 应用程序部署到 Kubernetes 集群。我们使用一个<a class="ae jz" href="https://k3d.io/" rel="noopener ugc nofollow" target="_blank"> k3d </a>包装器在 docker 中运行<a class="ae jz" href="https://github.com/rancher/k3s" rel="noopener ugc nofollow" target="_blank"> k3s </a> (Rancher Lab 的最小 Kubernetes 发行版)。<br/>我们审查了 Kubernetes 部署配置，以允许对 API 应用程序的外部请求</p><p id="2cb4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！！！</p></div></div>    
</body>
</html>