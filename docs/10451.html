<html>
<head>
<title>PHP — P86: MySQL Insert with Prepared Statements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP——P86:MySQL Insert 和准备好的语句</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p86-mysql-insert-with-prepared-statements-57f37daeb109?source=collection_archive---------7-----------------------#2022-11-02">https://blog.devgenius.io/php-p86-mysql-insert-with-prepared-statements-57f37daeb109?source=collection_archive---------7-----------------------#2022-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/061e62d55cdb840a7eb9fae36bc8140e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DvWa2xt7Ksh9uQ4CmHWYwQ.jpeg"/></div></div></figure><p id="a3b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们之前的 MySQL insert 语句有一个很大的缺陷:它容易受到 SQL 注入攻击。精心准备的声明几乎消除了这种担忧。你告诉 SQL 服务器你打算做什么，然后给它数据。例如，您可以告诉服务器您计划插入数据。如果你发送一个伪装在你的<code class="fe kw kx ky kz b">insert</code>语句中的<code class="fe kw kx ky kz b">delete</code>语句，那是没有意义的，也不会产生与没有准备好的语句相同的效果。</p><div class="la lb gp gr lc ld"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p85-mysql-insert-51a9e3bfedd3"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">PHP — P85: MySQL Insert</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">我们有自己的数据库连接、数据库和表。我们只需要开始添加一些数据。这是一个…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">blog.devgenius.io</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jw ld"/></div></div></a></div><div class="la lb gp gr lc ld"><a href="https://medium.com/geekculture/cybersecurity-p9-sql-injections-471de647e8d7" rel="noopener follow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">网络安全— P9: SQL 注入</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">当攻击者注入一段 SQL 脚本以便…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">medium.com</p></div></div><div class="lm l"><div class="ls l lo lp lq lm lr jw ld"/></div></div></a></div><h1 id="2dc0" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">概述</h1><p id="edf9" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">我们的<code class="fe kw kx ky kz b">Author</code>类有一个 insert 语句，它接受数据并将其插入到<code class="fe kw kx ky kz b">authors</code>表中。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="b0cf" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">准备的声明</h1><p id="de70" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">让我们来看一下准备好的 insert 语句的结构。</p><pre class="mw mx my mz gt nc kz nd ne aw nf bi"><span id="7f1a" class="ng lu iq kz b gy nh ni l nj nk">INSERT INTO authors (first_name, last_name, email) VALUES (?, ?, ?)</span></pre><p id="bd8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些问号不是偶然的。这是预准备语句的语法。据说我们有三个字段，<code class="fe kw kx ky kz b">first_name</code>、<code class="fe kw kx ky kz b">last_name</code>和<code class="fe kw kx ky kz b">email</code>，每个字段都将接收一些数据。用三个问号来表示将有数据绑定到这三个字段是很重要的。</p><p id="7892" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">步骤很简单:</p><ul class=""><li id="b237" class="nl nm iq ka b kb kc kf kg kj nn kn no kr np kv nq nr ns nt bi translated">连接到数据库</li><li id="f464" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">准备查询</li><li id="aa62" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">将变量(数据)绑定到查询</li><li id="7387" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">执行查询</li><li id="4e54" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">关闭连接</li></ul><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="fe5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们一次消化一行代码。</p><ul class=""><li id="3322" class="nl nm iq ka b kb kc kf kg kj nn kn no kr np kv nq nr ns nt bi translated"><code class="fe kw kx ky kz b">$data</code>数组作为参数传递。<code class="fe kw kx ky kz b">$data</code>数组有以下三个键:<code class="fe kw kx ky kz b">first_name</code>、<code class="fe kw kx ky kz b">$last_name</code>和<code class="fe kw kx ky kz b">$email</code>。</li><li id="6ac5" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">创建将被准备的<code class="fe kw kx ky kz b">$sql</code>语句。此时它只是一个字符串。这只是为了一些清晰和与下面的代码分离，这样它就不会变得太忙。</li><li id="1e6b" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">实例化<code class="fe kw kx ky kz b">DB</code>对象。<code class="fe kw kx ky kz b">DB</code>对象实例化<code class="fe kw kx ky kz b">mysqli</code>对象并将其存储在<code class="fe kw kx ky kz b">$_connection</code>属性中。我们将获取它并将其本地存储在我们的<code class="fe kw kx ky kz b">$mysqli</code>变量中。</li><li id="537f" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated"><code class="fe kw kx ky kz b">prepare</code>方法是<code class="fe kw kx ky kz b">mysqli</code>对象的一部分。我们将把<code class="fe kw kx ky kz b">SQL</code>字符串传递给它，这样它就可以准备它了。一旦准备好了，它就返回一个新对象，我们将把这个对象存储为一个<code class="fe kw kx ky kz b">statement</code>。</li><li id="e595" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">在这个<code class="fe kw kx ky kz b">statement</code>对象中，我们可以使用<code class="fe kw kx ky kz b">bind_param</code>方法。<code class="fe kw kx ky kz b">bind_param</code>方法不属于<code class="fe kw kx ky kz b">mysqli</code>对象。小心那个陷阱。</li><li id="291e" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated"><code class="fe kw kx ky kz b">bind_param</code>方法期望的第一个参数是将要绑定的变量的类型。因为我们绑定了 3 个变量，它需要知道它们的类型。<code class="fe kw kx ky kz b">sss</code>表示将有三个字符串被绑定。</li><li id="35b9" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">接下来的参数是将要绑定的变量。这是通过<code class="fe kw kx ky kz b">$data</code>数组发送的数据。</li><li id="6176" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">最后，我们调用属于<code class="fe kw kx ky kz b">statement</code>对象的<code class="fe kw kx ky kz b">execute</code>方法。</li><li id="1eda" class="nl nm iq ka b kb nu kf nv kj nw kn nx kr ny kv nq nr ns nt bi translated">我们现在有两个“打开”的对象我们需要关闭<code class="fe kw kx ky kz b">statement</code>对象和<code class="fe kw kx ky kz b">$db</code>对象。我们可以通过$db 对象来实现，因为我们有一个声明<code class="fe kw kx ky kz b">$db-&gt;_connection-&gt;close();</code>的<code class="fe kw kx ky kz b">close()</code>方法。</li></ul><h1 id="726d" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">完整的代码</h1><p id="1a84" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">下面你可以找到三个相互作用的文件。我们的<code class="fe kw kx ky kz b">DB</code>类中的<code class="fe kw kx ky kz b">insert</code>方法可以被移除，因为我们现在正在使用预准备语句。我会暂时保留它，但最终可能会删除它。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8848f28b31bf9b560c0aa35656ef7c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ITe_RvwnbBY66Hr4.jpeg"/></div></figure><p id="9e38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae oh" href="http://absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 负责人，该公司是<a class="ae oh" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae oh" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute 抗体</a>、<a class="ae oh" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae oh" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae oh" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae oh" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他拥有计算机科学学士学位，辅修生物学，并拥有十多年的软件工程经验。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="da29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae oh" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae oh" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae oh" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="eba1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T25】</p></div></div>    
</body>
</html>