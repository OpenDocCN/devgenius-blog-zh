<html>
<head>
<title>Connect Locally Hosted PostgreSQL From Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Docker 连接本地托管的 PostgreSQL</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connect-locally-hosted-postgresql-from-docker-daffea720af1?source=collection_archive---------2-----------------------#2020-06-09">https://blog.devgenius.io/connect-locally-hosted-postgresql-from-docker-daffea720af1?source=collection_archive---------2-----------------------#2020-06-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/040acae1708f53132b065af07adc20a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DJpRLcCl-BwlATUo"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@hishahadat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><blockquote class="ka kb kc"><p id="b9e3" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">先决条件</strong></p></blockquote><ul class=""><li id="0ecb" class="lc ld in kg b kh ki kl km le lf lg lh li lj lb lk ll lm ln bi translated">在系统中本地安装 PostgreSQL。</li><li id="6eed" class="lc ld in kg b kh lo kl lp le lq lg lr li ls lb lk ll lm ln bi translated">让 Docker 容器启动并运行。</li></ul><blockquote class="ka kb kc"><p id="83ba" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">从 docker 容器连接 PostgreSQL 的步骤</strong></p></blockquote><ul class=""><li id="95d6" class="lc ld in kg b kh ki kl km le lf lg lh li lj lb lk ll lm ln bi translated">获取本地 IP 地址，类似于<code class="fe lt lu lv lw b">192.168.1.111</code>(在基于 linux 的系统中使用 ipconfig)</li><li id="5b06" class="lc ld in kg b kh lo kl lp le lq lg lr li ls lb lk ll lm ln bi translated">使用<code class="fe lt lu lv lw b">docker exec -it &lt;containerid&gt; &lt;entrypoint&gt;</code>进入 docker</li><li id="c15d" class="lc ld in kg b kh lo kl lp le lq lg lr li ls lb lk ll lm ln bi translated">尝试 Ping 命令<code class="fe lt lu lv lw b">Ping 192.168.1.111</code>，它将验证 docker 容器可以到达本地机器。</li><li id="2bef" class="lc ld in kg b kh lo kl lp le lq lg lr li ls lb lk ll lm ln bi translated">尝试 Telnet 命令<code class="fe lt lu lv lw b">telnet 192.168.1.111 5432</code>，验证 docker 可以连接本地系统上的 db 实例。如果失败，请遵循以下步骤。</li></ul><blockquote class="ka kb kc"><p id="b91a" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">修复:万一连接失败</strong></p></blockquote><ul class=""><li id="b3d1" class="lc ld in kg b kh ki kl km le lf lg lh li lj lb lk ll lm ln bi translated">找到<strong class="kg io">PostgreSQL . conf</strong><br/><code class="fe lt lu lv lw b">$ find / -name "postgresql.conf"<br/>/var/lib/pgsql/9.4/data/postgresql.conf<br/></code>用<code class="fe lt lu lv lw b">listen_addresses = '*'</code> <br/>更新文件重启 PostgreSQL <code class="fe lt lu lv lw b">sudo systemctl restart postgresql</code> <br/>使用<code class="fe lt lu lv lw b">netstat -tnlp | grep 5432</code>命令验证 Postgres 正在监听<code class="fe lt lu lv lw b">0.0.0.0:5432</code>。</li><li id="27f3" class="lc ld in kg b kh lo kl lp le lq lg lr li ls lb lk ll lm ln bi translated">用值<strong class="kg io"> <br/> </strong> <code class="fe lt lu lv lw b">host all all 0.0.0.0/0 md5<br/> host all all ::/0 md5</code> <br/>配置<strong class="kg io"> pg_hba.conf，</strong>重启 PostgreSQL <code class="fe lt lu lv lw b">sudo systemctl restart postgresql</code></li></ul><p id="7105" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko le kq kr ks lg ku kv kw li ky kz la lb ig bi translated">现在，我们将能够连接到 PostgreSQL 服务器。</p><blockquote class="ka kb kc"><p id="845b" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="kg io">如果我的本地 IP 地址改变了怎么办？</strong></p></blockquote><p id="5b04" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko le kq kr ks lg ku kv kw li ky kz la lb ig bi translated">使用 docker bridge 命令并使用<code class="fe lt lu lv lw b">192.168.0.1</code>作为系统的静态本地 IP。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="19b9" class="mf mg in lw b gy mh mi l mj mk">docker network create <strong class="lw io">-d</strong> bridge <strong class="lw io">--subnet</strong> 192.168.0.0/24 <strong class="lw io">--gateway</strong> 192.168.0.1 mynet</span></pre><p id="aaa6" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko le kq kr ks lg ku kv kw li ky kz la lb ig bi translated">最后，我们准备好了设置:)</p></div></div>    
</body>
</html>