<html>
<head>
<title>How to Build an ETL Pipeline with Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 搭建一个 ETL 管道？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-an-etl-pipeline-with-python-1b78407c3875?source=collection_archive---------0-----------------------#2022-02-22">https://blog.devgenius.io/how-to-build-an-etl-pipeline-with-python-1b78407c3875?source=collection_archive---------0-----------------------#2022-02-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="611b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用 Python、Pandas、SQLAlchemy、SQL Server 和 PostgreSQL </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a756d68e437a4f4eb57c6bdca9a9da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*audZQV_S1dRMgtIs2QHfLg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ETL 过程概述</figcaption></figure><p id="f163" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ETL 代表提取、转换、加载。ETL 是一种数据集成，它从一个或多个源(API、数据库或文件)中提取数据，将其转换为符合目标系统的要求，然后将其加载到目标系统中。ETL 管道是数据工程中一种重要的工作流类型。我将使用 Python，尤其是 pandas 库来构建一个管道。熊猫让执行 ETL 操作变得超级容易。我想展示用 Python 简化 ETL 过程是多么容易。用于 ETL 的完整源代码可以在<a class="ae ky" href="https://github.com/hnawaz007/pythondataanalysis/tree/main/ETL%20Pipeline" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="81f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你是视觉学习者，那么我在<a class="ae ky" href="https://www.youtube.com/watch?v=dfouoh9QdUw&amp;t" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上有一个附带的视频，里面有完整代码的演示。</p><p id="ab0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">为什么选择 ETL 管道？</strong></p><p id="07a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">分析、决策支持系统和运营报告依赖于数据。这些对业务至关重要，尽管我们可以对源系统进行分析，但是源系统很少针对查询进行优化。额外的分析工作负载会降低面向业务的应用程序的速度。ETL 在这方面发挥了作用，它从源移动数据、转换数据并将其加载到优化的数据库/存储层以进行数据分析。我将重点介绍 ETL 的提取和加载组件。对于转换，我们可以利用<a class="ae ky" href="https://www.youtube.com/watch?v=-jerzfh2bS0" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">熊猫</strong> </a> <strong class="jm io"> </strong>库中所有可用的提示和技巧。我们希望展示使用 Python 自动提取和加载的简便性。</p><p id="97aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">建立 ETL 管道</strong></p><p id="8595" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用许多不同的工具和技术来构建 ETL 管道。具体需要什么取决于您的需求和技能。我们将使用<strong class="jm io"> Python </strong>，特别是<strong class="jm io"> Pandas </strong>和<strong class="jm io"> SQLAlchemy </strong>来提取和加载数据。</p><p id="e0c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">设置</strong></p><p id="23d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我准备了<a class="ae ky" href="https://www.youtube.com/watch?v=e5mvoKuV3xs" rel="noopener ugc nofollow" target="_blank"> SQL Server </a>和<a class="ae ky" href="https://www.youtube.com/watch?v=fjYiWXHI7Mo" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>环境，分别作为源环境和目的环境。我们将使用 SQL Server 的 AdventureWorks 数据库作为源，用 Python 加载 PostgreSQL 中的数据。如果你想跟进，一定要看看这两个视频。在编写 ETL 管道之前，我将在数据库端执行一些基本的设置。以下 SQL 脚本可在<a class="ae ky" href="https://github.com/hnawaz007/pythondataanalysis/tree/main/ETL%20Pipeline" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。我将在 pgAdmin4 中执行几个查询。</p><ul class=""><li id="5b5a" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">首先，我将创建一个数据库来存放传入的表和数据。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi li"><img src="../Images/9fc2861eb4ed3bf9867b31de779835b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*q3gSis4x4PDxbJemf33IaQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">创建数据库</figcaption></figure><ul class=""><li id="2af4" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">其次，我将创建一个用户，并授予其 connect 权限以及 select、insert、update 和 delete 权限。我将继续在 SQL Server 环境中创建同一个用户，以保持一致性。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lj"><img src="../Images/5122187ce1fa5ece0021e792cd779a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xH2ZgluTsix6w_30smdY6g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">创造用户</figcaption></figure><ul class=""><li id="6c7c" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">第三，我将把凭证保存在环境变量中。单独存储您的凭据是一个好习惯。目标是保护凭证不被暴露在 ETL 脚本中。您可以使用配置文件或系统环境变量。</li></ul><p id="8676" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">摘录</strong></p><p id="a98f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要一个策略来规划我们的 ETL 管道。通常，我们将每个表从源环境映射到目标环境。在两种环境中创建具有匹配数据类型的相似对象。我们连接到两个环境，为每个表执行映射，然后触发管道。听起来工作量很大！别担心，我们不会经历那么多麻烦的。我想展示一下<strong class="jm io"> Python </strong>和<strong class="jm io">熊猫</strong>的多功能性，以及它们可以让这个过程变得多么简单。我将获取我想从 SQL Server 的系统模式中提取数据的表。只需遍历表并查询它们。通过几行代码，我们查询了源代码并获得了作为 Pandas dataframe 的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ETL 提取功能</figcaption></figure><p id="9eaf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">负载</strong></p><p id="f988" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Pandas 使用 pandas 的“to_sql()”函数轻松地将数据加载到 SQL 数据库中。当我们遍历并查询提取中的每个表时，我们调用定义为 load 的下一个函数。我们将遵循 truncate and load 方法，因为它很简单，每次运行时都会替换表。这可以是您的分段环境，您可以在其中以给定的时间间隔获取新数据。从这里，您可以将数据转换并加载到表示层。下面的代码演示了如何使用<strong class="jm io"> Pandas </strong>连接和存储<strong class="jm io"> PostgreSQL </strong>数据库中的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ETL 加载功能</figcaption></figure><p id="c099" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><ul class=""><li id="fb01" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">我们描述了什么是 ETL，以及它在当今数据驱动的世界中有多重要。</li><li id="cc04" class="kz la in jm b jn lm jr ln jv lo jz lp kd lq kh le lf lg lh bi translated">我们展示了用 Pandas 创建 ETL 管道是多么容易。</li><li id="e0df" class="kz la in jm b jn lm jr ln jv lo jz lp kd lq kh le lf lg lh bi translated">我们使用 Python、Pandas 和 SQLAlchemy 实现了一个基本的 ETL 管道。</li><li id="963e" class="kz la in jm b jn lm jr ln jv lo jz lp kd lq kh le lf lg lh bi translated">完整的代码可以在<a class="ae ky" href="https://github.com/hnawaz007/pythondataanalysis/tree/main/ETL%20Pipeline" rel="noopener ugc nofollow" target="_blank">这里</a>找到</li><li id="1cdd" class="kz la in jm b jn lm jr ln jv lo jz lp kd lq kh le lf lg lh bi translated">跟进 ETL 增量数据加载技术<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/python-etl-pipeline-incremental-data-load-source-change-detection-28a7ceaa9840">源变更检测</a>和<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/python-etl-pipeline-the-incremental-data-load-techniques-20bdedaae8f">目的地变更比较</a></li></ul></div></div>    
</body>
</html>