# 面向 Web 开发的 Docker 简介

> 原文：<https://blog.devgenius.io/an-introduction-to-docker-for-web-development-e8967e46556a?source=collection_archive---------4----------------------->

## 这个系列将向您展示如何利用容器的灵活性构建一个强大的开发环境

![](img/f3672f663a2de9b85bcfe259c91d026a.png)

由[作者](https://twitter.com/osteel)剪辑，背景照片由 [Artem Labunsky](https://unsplash.com/photos/H9vQC7wfhTQ)

在开发人员中，接触 Docker 的范围从模糊地听说过该技术到每天使用它，后一类人对它大加赞赏，而前者有时仍在与容器的纯粹概念作斗争。

无论您在旅途中的什么地方，作为一名开发人员，您都有许多理由想要深入研究这项技术，包括但不限于:

> “我读过一些关于 Docker 的东西，现在我正在寻找一些更实用的东西”
> 
> “我使用了一种基于流浪者的解决方案，比如 Homestead，它开始显示出它的局限性”
> 
> “我已经使用了像 Laradock 这样的交钥匙解决方案，我想了解一下幕后的工作原理”
> 
> “我希望更好地控制我的开发环境”
> 
> “我想更好地理解应用程序架构”
> 
> “我当前的项目使用微服务”

无论你的动机是什么，你可能会注意到一个主题的出现，围绕着*理解*和*处于控制之中。*在我看来，Docker 是为了增强开发人员的能力，从提供一个安全的环境来方便地试验技术——而不会搞乱您的本地环境——到打开运营世界的大门。

本系列教程的目的是揭开这项有时令人望而生畏的技术的神秘面纱，同时提供开发人员使用 Docker 在本地构建 web 项目可能需要的大部分工具。**它严格关注开发环境，并不包括部署 Docker 应用程序**，尽管最终结果可以为可部署的设置提供基础。

不需要事先了解 Docker，但是熟悉终端以及熟悉 Git over SSH 会有所帮助。

我们将从一个基本的 LEMP 堆栈开始我们的旅程，并随着我们的发展逐渐增加环境的复杂性，一路上涵盖越来越多的用例。虽然重点主要放在服务器端的 PHP 上，但总体原则可以应用于任何语言。

以下是详细的内容:

*   如何构建一个基本的 LEMP 堆栈
*   如何使用 Alpine Linux 减小图像的大小
*   如何使用框架调整三层架构的设置
*   如何使用 Bash 使与环境的交互变得轻而易举
*   如何实现 HTTPS
*   如何向互联网公开本地容器
*   如何使用多阶段构建介绍员工
*   如何处理计划任务(cron 作业)

你可能会发现自己在某一点上停了下来，因为你所有的需求都已经被满足了，只是为了以后需要更多的时候再回来。无论在哪里，该系列的每个部分都有自己的 [Git 分支](https://github.com/osteel/docker-tutorial)，您可以派生或下载它，并将其作为您自己项目的起点。

电梯推介到此结束。但是在我们开始之前，让我们试着解决一些你可能还存在的疑问，从一点背景调查开始。

# “我为什么要听你的？”

我是一名拥有十多年经验的后端开发人员，与三个不同国家的各种类型的公司合作过。我见证了开发环境的演变，从早期使用 [WAMP](http://www.wampserver.com) 和[记事本++](https://notepad-plus-plus.org) 到迁移到成熟的 ide 和定制虚拟机，再到[流浪者](https://www.vagrantup.com)和最终的[家园](https://laravel.com/docs/homestead)。

早在 2015 年，我探索了在本地使用 Docker 作为开发环境的可能性，并且[在当时被](https://tech.osteel.me/posts/from-vagrant-to-docker-how-to-use-docker-for-local-web-development) [Docker 时事通讯](https://www.docker.com/newsletter-subscription)转载的两篇文章中写了关于它的内容，但是最终主要因为性能问题而远离了它。

然而，在 2018 年初，我被迫重新审视这个想法，因为在我当时从事的一个项目中，流浪者开始显示出它的局限性(下一节将详细介绍)。当我再次研究 Docker 时，我意识到在性能和采用方面都取得了进步。

经过几天的摸索，我想出了一个不错的开发环境，能够处理应用程序的复杂性，并且，正如我很快意识到的，极大地简化了新开发人员的入职。

从那以后，我在几家公司成功地实施并改进了类似的设置。

# “我已经使用流浪者/家园”

家园很棒。我用了 [Laravel](https://laravel.com) 的预打包虚拟机(VM)很多年，无论是个人项目还是客户项目。它提供了 PHP 应用程序所需的几乎所有功能，并允许您快速创建新网站。

那么，我为什么要改变呢？

简而言之就是*微服务*。

早在 2018 年初，我的任务是从一个遗留的 monolith 中公开一个 API，以服务于一个新的单页面应用程序，并通过将所有业务逻辑提取到微服务中来逐步淘汰 monolith。快乐的日子。

突然之间，我一方面要管理一些运行在 PHP 5.x 上的遗留代码，另一方面还要管理一些运行在 PHP 7.x 上的微服务。

我最初让这种语言的两个版本运行在同一个 VM 上，但是它包含了一些肮脏的变通方法，使得整体用户体验非常糟糕。此外，我最终需要添加其他具有不同堆栈的微服务，并且在同一个虚拟机下管理它们并不现实。

我试着为每个微服务运行单独的流浪者盒子，但是运行整个设置对我的机器来说太重了，而且管理像 VM 到 VM 通信这样的事情感觉非常麻烦。

我需要别的东西，那就是多克。但是这对情况有什么帮助呢？

Docker 的承诺之一是提供在单个虚拟机上运行的隔离环境( *containers* ),几秒钟内开始。对我来说，这意味着用一个具有 Docker 功能的超高速虚拟机来替换我所有的重型流浪虚拟机，并在其上运行我所有的微服务，每个微服务都在自己独立的容器中。

使用 Docker 自己的标志来说明这一点，就像从每个板条箱都需要自己的专用鲸鱼来搬运，到一只鲸鱼搬运所有的板条箱，如图所示。

![](img/b7b4333f899f17888ca184d4179ba520.png)

想象一下，如果标识中的每一个板条箱都需要自己的鲸鱼:除了所需的大量浮游生物之外，它看起来会有效率吗？

现在重温一下前面的句子，把“whale”换成“virtual machine”，把“crate”换成“microservice”——你应该明白了。

虽然这是一个过于简单的解释，但这正是它吸引我的地方。作为一名开发人员，这个用例非常有意义，并影响了我的日常工作方式，远远超过了试图理解虚拟化或共享操作系统如何工作。

这是否意味着只有当你的应用涉及微服务时，你才应该在本地使用 Docker？

答案是肯定的，也是否定的。应用程序越复杂——组成它的移动部件越多——就越有可能需要像 Docker 这样的解决方案。

但是，即使您的应用程序相当简单，启动和停止一些容器也比启动和停止虚拟机要快得多，并且万一您的应用程序以一些意想不到的方式发展(就像它们总是这样)，从一开始就采用 Docker 会让您确信您的设置是经得起未来考验的。

此外，不要使用像 Homestead 这样的预打包虚拟机，因为它的工具比任何给定的应用程序都多，按照我建议的方式使用 Docker 可以确保您只安装您实际需要的东西，以一种主动的方式。你重新控制了你的环境。

# "[插入最喜欢的基于 Docker 的解决方案]怎么样？"

已经有很多基于 Docker 的开发环境，而且似乎每隔一周就会出现一个新的。

Laradock 可以说是第一个获得一些关注的，它将 Docker Homestead 定义为流浪者:PHP 应用程序的预打包环境。虽然我没有亲自使用它，但我听说过很多好的东西，它可能足以满足您的需求。他们的座右铭是*先使用 Docker 然后再了解它*，在我看来这是一个很好的方法。

Laravel 在 2020 年底发布了 [Sail](https://laravel.com/docs/sail) (他们官方的基于 Docker 的环境)；还有[外卖](https://github.com/tighten/takeout)、 [DDEV](https://www.ddev.com/) ，我敢肯定还有很多其他人非常擅长他们的工作。

然而，本系列的目的是让您更深入地了解 Docker，以便您可以构建自己的设置，一个完全符合任何给定项目需求的设置。如果您目前只想使用一个基于 Docker 的环境，而没有自己设置的麻烦，那么无论如何都要尝试一下上述解决方案之一，如果您想创建自己的定制设置，随时都可以回来。

[](https://levelup.gitconnected.com/you-dont-need-laravel-sail-e66b2dd8cffa) [## 拉勒维尔帆船完全指南

### 它是什么，它是如何工作的，如何扩展它，以及为什么你可能根本不需要它

levelup.gitconnected.com](https://levelup.gitconnected.com/you-dont-need-laravel-sail-e66b2dd8cffa) 

总而言之，我认为基于 Docker 的环境的爆炸是一个好迹象——证明了这是一个适合工作的工具，一个在未来会被更广泛接受的工具。

# “无服务器是未来的发展方向”

[无服务器计算](https://en.wikipedia.org/wiki/Serverless_computing)正在兴起，坊间传言[即将迎来 Docker](https://read.acloud.guru/serverless-is-eating-the-stack-and-people-are-freaking-out-and-they-should-be-431a9e0db482) 。

同时，其他人认为这种比较毫无意义，因为这两种技术服务于完全不同的目的。

就本地开发而言，这种比较几乎是不相关的——无论是否是无服务器的，您都需要一个本地环境来构建您的项目，无论它们的规范是什么，Docker 都符合要求。

# “性能很差”

以前很可怕。现在基本可以了。

Linux 上的性能一直很好，自从发布了 [WSL 2](https://docs.docker.com/docker-for-windows/wsl/) 之后，它在 Windows 上也很好。

这就给我们留下了 macOS，在 MAC OS 中，由于底层文件共享实现(gRPC-FUSE)的性能不佳，速度仍然是一个棘手的问题。但是，有一些方法可以让它变得更好，这在本系列中都会提到。

虽然你不太可能获得和 Homestead 或类似[的代客](https://laravel.com/docs/valet)一样的速度，但这是可以接受的。

# “和码头工人打交道不是我的工作”

最后，一些开发人员干脆认为 Docker 不是他们的问题。这是一个公平的观点，因为 Docker 超越了纯应用程序开发的范畴。如果有的话，sysadmin 或 DevOps 工程师应该为您设置它，对吗？

虽然你有资格这样认为，但是 DevOps 不仅仅指对系统管理和编码都感兴趣的个人，有效地充当两者之间的桥梁，而且也可以被视为双方的人在中途相遇。

平心而论，你不需要*知道 Docker 是一个好的开发者。我的观点很简单，忽视它，你就错过了变得更好的机会。*

它不会改进你的语法，也不会教你新的设计模式，但是它会帮助你理解你写的代码如何适应更大的图景。

这有点像在没有学会看乐谱的情况下演奏乐器:你可能听起来不错，但你不太可能写出交响乐。退一步思考应用程序的架构，理解不同的部分是如何组合在一起的，这将为您提供宝贵的视角，从而影响您为应用程序做出的技术选择。

无论您的专业是什么——后端、前端还是全栈——无论您对 DevOps 运动的关注程度如何，我保证了解让您的应用程序正常运行的齿轮是值得的，并且您将成为一名更好的开发人员。

# 这都是关于旅程的

最终，您可能不会完全接受这个系列的最终结果。无论是因为前面提到的性能原因，还是因为您觉得设置的某些方面太复杂或不适合您，这个开发环境可能不会完全满足您的要求。

但这并不是这个系列的真正目的。虽然您可以从表面上接受我的方法，但我的主要目标是让您有足够的信心以您认为合适的任何方式将 Docker 集成到您的开发工作流中——提供足够的实践知识来使它适应您自己的用例。

我可以保证，在本系列结束时，您将会有很多关于如何使用 Docker 的想法。

现在。我们可以开始了吗？

*这个故事最初发表于*[*tech . osteel . me*](https://tech.osteel.me/posts/docker-for-local-web-development-introduction-why-should-you-care)*。*