<html>
<head>
<title>Best CI/CD in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native 最佳 CI/CD</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-ci-cd-in-react-native-1f653066d049?source=collection_archive---------1-----------------------#2022-06-15">https://blog.devgenius.io/best-ci-cd-in-react-native-1f653066d049?source=collection_archive---------1-----------------------#2022-06-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0603cb0c5a0f76022ed94b2eba8ed32c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*dHXNh6E8hEr9CnwzOg1PqA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">React Native 中的 CI/CD</figcaption></figure><p id="e46d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在软件工程中，CI/CD 或 CICD 是持续集成和持续交付或持续部署的结合实践。CI/CD 通过在应用程序的构建、测试和部署中实施自动化，填补了开发和操作活动以及团队之间的空白。</p><p id="a278" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">首先，创建一个 react 本地应用程序</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="807b" class="lg lh in lc b gy li lj l lk ll">npx react-native init demoApp</span></pre><p id="1a0b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">创建应用程序完成后，有各种选项可用于将应用程序交付到各个商店，即 AppStore 和 PlayStore。</p><p id="6544" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一些受欢迎的服务有:</p><ul class=""><li id="f696" class="lm ln in kb b kc kd kg kh kk lo ko lp ks lq kw lr ls lt lu bi translated">AppCenter: web config，存储在服务端</li><li id="4799" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">appcircle: web config，存储在服务端</li><li id="d0b4" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">azure devo PS:<a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/azure-pipelines-android.yml" rel="noopener ugc nofollow" target="_blank">azure-pipelines-Android . yml</a></li><li id="f809" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">比特桶管道:<a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/bitbucket-pipelines.yml" rel="noopener ugc nofollow" target="_blank">比特桶管道. yml </a></li><li id="f23a" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">Bitrise: <a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/bitrise.yml" rel="noopener ugc nofollow" target="_blank"> bitrise.yml </a></li><li id="e741" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">Buddy: <a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/buddy.yml" rel="noopener ugc nofollow" target="_blank"> buddy.yml </a></li><li id="73c3" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">圈词:<a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/.circleci/config.yml" rel="noopener ugc nofollow" target="_blank">。circleci/config.yml </a></li><li id="928f" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">code magic:<a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/codemagic.yaml" rel="noopener ugc nofollow" target="_blank">code magic . YAML</a></li><li id="6372" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">GitHub 动作:<a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/.github/workflows/" rel="noopener ugc nofollow" target="_blank">。github/workflows/*。yml </a></li><li id="5272" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">Gitlab CI: <a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/.gitlab-ci.yml" rel="noopener ugc nofollow" target="_blank">。gitlab-ci.yml </a></li><li id="247f" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">Travis CI: <a class="ae ma" href="https://github.com/retyui/react-native-ci-cd-compare/blob/main/.travis.yml" rel="noopener ugc nofollow" target="_blank"> .travis.yml </a></li></ul><p id="b258" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">根据这些列表，我将解释应用中心和 Circle CI。</p><ol class=""><li id="e76b" class="lm ln in kb b kc kd kg kh kk lo ko lp ks lq kw mb ls lt lu bi translated">Appcenter <br/>访问<a class="ae ma" href="https://appcenter.ms/" rel="noopener ugc nofollow" target="_blank">https://appcenter.ms/</a>并注册或登录门户以创建应用程序。</li></ol><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/3f22ab77a7927c8ef0fd68e450fbb4e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P04jmUkVuac-MWYMkNTpOw.png"/></div></div></figure><p id="a069" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">关于进一步的设置，你可以参考我以前的文档。下面是链接<a class="ae ma" href="https://medium.com/@rajibstha059/implementing-codepush-on-react-native-ios-1cdefa4640c7" rel="noopener">https://medium . com/@ rajibstha 059/implementing-code push-on-react-native-IOs-1c defa 4640 c 7</a>。</p><h1 id="8487" class="md lh in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated"><strong class="ak"> 2。圆 CI </strong></h1><p id="56c6" class="pw-post-body-paragraph jz ka in kb b kc na ke kf kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw ig bi translated">在本教程中，您将学习如何:</p><ul class=""><li id="212a" class="lm ln in kb b kc kd kg kh kk lo ko lp ks lq kw lr ls lt lu bi translated">为 React 本机应用程序编写并运行测试</li><li id="f4aa" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw lr ls lt lu bi translated">通过构建持续集成管道，自动化这些测试的运行方式</li></ul><h1 id="ca1f" class="md lh in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">先决条件</h1><p id="3613" class="pw-post-body-paragraph jz ka in kb b kc na ke kf kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw ig bi translated">要遵循本教程，需要做一些事情:</p><ol class=""><li id="3ed4" class="lm ln in kb b kc kd kg kh kk lo ko lp ks lq kw mb ls lt lu bi translated">Javascript 的基础知识</li><li id="7a76" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw mb ls lt lu bi translated">您系统上安装的<a class="ae ma" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>(版本&gt; = 10.13)</li><li id="4297" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw mb ls lt lu bi translated">一个圆形的账户</li><li id="860e" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw mb ls lt lu bi translated">一个<a class="ae ma" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>账户</li><li id="a13e" class="lm ln in kb b kc lv kg lw kk lx ko ly ks lz kw mb ls lt lu bi translated">为 React(Android 的本地开发)设置的环境<a class="ae ma" href="https://reactnative.dev/docs/environment-setup" rel="noopener ugc nofollow" target="_blank"/></li></ol><p id="4579" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注意:</strong><em class="nf">React 环境是有条件可选的。没有它，您将无法在模拟器中运行示例应用程序。您仍然能够运行教程中描述的测试。</em></p><p id="b4e6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">安装并设置好所有这些之后，是时候开始本教程了。</p><p id="7dfb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">转到<code class="fe ng nh ni lc b">App.js</code>文件(在根文件夹中),将其中的代码替换为:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8257" class="lg lh in lc b gy li lj l lk ll">import React from "react"; <br/>import { Button, Text, TextInput, View, StyleSheet } from "react-native";  </span><span id="eec4" class="lg lh in lc b gy nj lj l lk ll">const App = () =&gt; {   <br/>const [message, setMessage] = React.useState();    <br/>return (     <br/> &lt;View&gt;       <br/>  &lt;Button         <br/>   title="Hello to the tester"<br/>   onPress={() =&gt; {           <br/>   setTimeout(() =&gt; {             <br/>     setMessage("Hello Tester");           <br/>   },Math.floor(Math.random() * 200));         <br/>  }}       <br/> /&gt;          <br/> {message &amp;&amp; (         <br/>   &lt;Text <br/>    style={styles.messageText} <br/>    testID="printed-message"&gt;           <br/>    {message}         <br/>   &lt;/Text&gt;       <br/>  )}     <br/> &lt;/View&gt;   <br/> );<br/>}; <br/> <br/>const styles = StyleSheet.create({   <br/> messageText: {     <br/>   fontFamily: "Arial",     <br/>   fontSize: 38,     <br/>   textAlign: "center",     <br/>   marginTop: 10   <br/> }<br/>});  <br/>export default App;</span></pre><p id="d3da" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这段代码创建了一个简单的 UI，一个标记为<code class="fe ng nh ni lc b">Hello to the tester</code>的按钮在被点击时显示消息<code class="fe ng nh ni lc b">Hello Tester</code>。为了模拟异步操作，我们使用<code class="fe ng nh ni lc b">setTimeout</code>在点击按钮后将显示延迟几分之一秒。React Native <code class="fe ng nh ni lc b">Text</code>组件在按钮的底部显示消息。代码通过使用<code class="fe ng nh ni lc b">Stylesheet</code>组件向消息添加样式。</p><p id="5d42" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要运行该项目，请打开终端窗口，并使用以下命令启动 metro 服务器。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d22e" class="lg lh in lc b gy li lj l lk ll">npx react-native start</span></pre><p id="9596" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果应用程序无法通过上述命令运行，请使用:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="47d7" class="lg lh in lc b gy li lj l lk ll">npx react-native run-ios //for ios user<br/>  or<br/>npx react-native run-android //for android user</span></pre><p id="62cf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在设置和添加测试:</p><p id="90d2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">将 React 本机测试库作为开发依赖项安装:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="be2c" class="lg lh in lc b gy li lj l lk ll">npm install —-save-dev @testing-library/react-native</span></pre><p id="9358" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">安装该库后，用以下代码片段替换 __tests__App-test.js 文件中的代码:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2408" class="lg lh in lc b gy li lj l lk ll">import "react-native"; <br/>import React from "react"; <br/>import App from "../App";  <br/>import { fireEvent, render, waitFor } from "@testing-library/react-native";  </span><span id="2b12" class="lg lh in lc b gy nj lj l lk ll">it("Renders Message", async () =&gt; {   <br/> const { getByTestId, getByText, queryByTestId, toJSON }  =render(&lt;App /&gt;);    <br/>  const button = getByText("Say Hello");   <br/>  fireEvent.press(button);    <br/>  <br/>  await waitFor(() =&gt; expect(queryByTestId("printed-    message")).toBeTruthy());    </span><span id="ec05" class="lg lh in lc b gy nj lj l lk ll">  expect(getByTestId("printed-message").props.children).toBe("Hello Tester");   <br/>  expect(toJSON()).toMatchSnapshot(); <br/>});</span></pre><p id="271f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要运行测试套件，请转到项目的根目录并运行:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2633" class="lg lh in lc b gy li lj l lk ll">npm run test</span></pre><p id="32e1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在在 CircleCI <br/> 1 上设置项目。要开始测试自动化过程，第一步是<a class="ae ma" href="https://circleci.com/blog/pushing-a-project-to-github/" rel="noopener ugc nofollow" target="_blank">将您的项目推送到 GitHub </a>。确保您使用的 GitHub 帐户是与您的 CircleCI 帐户连接的帐户。</p><p id="8af5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，转到<a class="ae ma" href="https://app.circleci.com/projects" rel="noopener ugc nofollow" target="_blank"> CircleCI 仪表板</a>上的<strong class="kb io">项目</strong>页面。选择您在此项目中使用的 GitHub 帐户。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/186e22c90f5d7b5a64d64788c61ae00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTIUxBjme8w3ZSRMNNQcRw.png"/></div></div></figure><p id="d83e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">点击<strong class="kb io">设置项目</strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/2920351d296bf4673cf566302dc81bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8eVao27LBC-2nlLRbMuwlg.png"/></div></div></figure><p id="0bff" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在设置页面上，点击<strong class="kb io">使用现有配置</strong>。接下来，您会得到一个提示，要么为<a class="ae ma" href="https://circleci.com/blog/what-is-a-ci-cd-pipeline/" rel="noopener ugc nofollow" target="_blank"> CI 管道</a>下载一个配置文件，要么开始构建。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/09b1e2d3fac3825657faedc45c5c17d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CxwK1UkWfmzo7okjFYdGVA.png"/></div></div></figure><p id="3f65" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">点击<strong class="kb io">开始构建</strong>开始构建。此构建将失败，因为您尚未编写 CI 管道配置文件。写入该文件是我们的下一步。</p><h1 id="0c2f" class="md lh in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">编写 CI 管道</h1><p id="9378" class="pw-post-body-paragraph jz ka in kb b kc na ke kf kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw ig bi translated">持续集成管道确保每当更新被推送到 GitHub 存储库时测试都会运行。第一步是在项目的根目录下创建一个名为<code class="fe ng nh ni lc b">.circleci</code>的文件夹。添加一个名为<code class="fe ng nh ni lc b">config.yml</code>的配置文件。在该文件中，输入:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c13d" class="lg lh in lc b gy li lj l lk ll">version: 2.1 <br/>jobs:   <br/> build:     <br/>  working_directory: ~/repo     <br/>  docker:       <br/>    - image: circleci/node:10.16.3     <br/>  steps:       <br/>    - checkout       <br/>    - run:           <br/>      name: Update NPM           <br/>      command: "sudo npm install -g npm@5"       <br/>   - restore_cache:           <br/>      key: dependency-cache-{{ checksum "package-lock.json" }}                          - run:<br/>   name: Install Dependencies           <br/>   command: npm install       <br/>- save_cache:           <br/>   key: dependency-cache-{{ checksum "package-lock.json" }}                      paths:<br/>- ./node_modules       <br/>- run:           <br/>name: Run tests           <br/>command: npm run test</span></pre><p id="26e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这个管道配置中，Docker 映像首先用所需的 Node.js 版本导入。然后，<code class="fe ng nh ni lc b">npm</code>被更新，依赖项被安装，缓存它们以便后续的构建更快。</p><p id="24a2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">最后，<code class="fe ng nh ni lc b">npm run test</code>命令运行项目中包含的所有测试。</p><p id="752b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">保存该文件，并将所有更改提交到远程存储库。提交更改会触发管道成功运行。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/b4cb3fb18f09eef5a09505bc4073315f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqB2Rac8QDUdZ7d1Tt8mgA.png"/></div></div></figure><p id="a9ec" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">点击<strong class="kb io">构建</strong>显示管道构建步骤。如果您折叠<strong class="kb io">运行测试</strong>，您将看到测试的详细信息。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/abaf4a94d0023def8bc4ea06b927226e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-td8ZxLYg6NPUJ8aNHcCLA.png"/></div></div></figure><h1 id="b710" class="md lh in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">结论</h1><p id="5d85" class="pw-post-body-paragraph jz ka in kb b kc na ke kf kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw ig bi translated">适当的测试对移动应用来说可能比网络应用更重要。每次你修复一个 bug，都要求用户安装更新，这很容易惹恼他们。通过应用您在这里学到的知识来彻底测试您的 React 本机应用程序，让用户满意。更重要的是，自动化您的测试过程，并确保那些错误不会在第一时间被推到您的产品代码中。</p><p id="0daf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">编码快乐！</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="6031" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，这些是 React Native 的最佳 CI/CD。</p><p id="950d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">编码快乐！</p><p id="b916" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">玩得开心！干杯，</p></div></div>    
</body>
</html>