<html>
<head>
<title>Creating a Python Package | Poetry Quickstart Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建 Python 包|诗歌快速入门指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/creating-a-python-package-poetry-quickstart-guide-dea4ac685007?source=collection_archive---------1-----------------------#2022-08-01">https://blog.devgenius.io/creating-a-python-package-poetry-quickstart-guide-dea4ac685007?source=collection_archive---------1-----------------------#2022-08-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/db5ffbc060d46396d5d84c0c30f1a017.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JEcl_RnsMFDdin9UJIdCdw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源:<a class="ae jz" href="https://dotmethod.me/posts/poetry-python-package-manager/" rel="noopener ugc nofollow" target="_blank">https://dotmethod.me/posts/poetry-python-package-manager/</a></figcaption></figure><h1 id="aea1" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">什么是诗歌？</h1><p id="e6f2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated"><a class="ae jz" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">poems</a>是一个 Python 打包和依赖管理工具。它使管理依赖关系变得容易，并提供了一个<code class="fe lw lx ly lz b">poetry.lock</code>文件，确保用户环境的一致性和可再现性。</p><p id="d8f9" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">使用<code class="fe lw lx ly lz b">poetry</code>的一些额外好处:</p><ul class=""><li id="1088" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated"><code class="fe lw lx ly lz b">poetry</code>自动为你的项目生成和管理虚拟环境。只要运行<code class="fe lw lx ly lz b">poetry shell</code>就能进入一个隔离的环境。</li><li id="0722" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><code class="fe lw lx ly lz b">poetry</code>可以自动更新项目/包的依赖关系。<code class="fe lw lx ly lz b">poetry update</code>会将您的所有依赖项更新到最新版本。</li><li id="8328" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><code class="fe lw lx ly lz b">poetry</code>可以轻松构建 python 包并发布到 PyPI。</li><li id="4882" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><code class="fe lw lx ly lz b">poetry</code>也可以将它的依赖树导出为<code class="fe lw lx ly lz b">requirements.txt</code>，这样它就可以在没有其他包管理器的情况下兼容。</li></ul><p id="70b8" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">关于<code class="fe lw lx ly lz b">poetry</code>特性的完整列表，请查看官方<a class="ae jz" href="https://python-poetry.org/docs/cli/" rel="noopener ugc nofollow" target="_blank">诗歌文档</a>。</p><h1 id="9f72" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">装置诗歌</h1><p id="22b2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在 Linux/macOS/WSL 上</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="74ad" class="nb kb in lz b gy nc nd l ne nf">curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -</span></pre><p id="f7cc" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">在 Windows 上</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="7ee7" class="nb kb in lz b gy nc nd l ne nf">(Invoke-WebRequest -Uri https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py -UseBasicParsing).Content | python -</span></pre><p id="6e28" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">如果您在使用上述方法时遇到任何问题，请尝试</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="e263" class="nb kb in lz b gy nc nd l ne nf">pip install poetry</span></pre><p id="8852" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">它应该可以在大多数机器上工作。</p><p id="d3cb" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">要确认您的安装，请运行</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="5b1f" class="nb kb in lz b gy nc nd l ne nf">poetry --version</span></pre><p id="d35a" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">如果你看到类似<code class="fe lw lx ly lz b">Poetry version 1.1.x</code>的东西，我们就可以走了！</p><p id="eb74" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">如果你面临任何挑战，你可以参考<a class="ae jz" href="https://python-poetry.org/docs/#installation" rel="noopener ugc nofollow" target="_blank">安装指南</a>。</p><h1 id="25df" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">创建新的诗歌项目</h1><p id="1be8" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">要启动一个新的 Python 项目，运行</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="8d15" class="nb kb in lz b gy nc nd l ne nf">poetry new &lt;project_name&gt;</span></pre><p id="e3ad" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">这将创建一个具有以下结构的新项目:</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="6cf7" class="nb kb in lz b gy nc nd l ne nf">SERVUS<br/>│ pyproject.toml<br/>│ README.rst<br/>│<br/>├───servus<br/>│         __init__.py<br/>│<br/>└───tests<br/>        test_servus.py<br/>        __init__.py</span></pre><p id="3773" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">我使用<code class="fe lw lx ly lz b">servus</code>作为我的项目名称。我将在以后的文章中写更多关于这方面的内容。</p><blockquote class="ng nh ni"><p id="d699" class="ky kz nj la b lb ma ld le lf mb lh li nk mc ll lm nl md lp lq nm me lt lu lv ig bi translated"><em class="in">潜行峰:</em> <code class="fe lw lx ly lz b"><em class="in">servus</em></code> <em class="in">是一个对人友好的包装器，用于</em> <code class="fe lw lx ly lz b"><em class="in">aiohttp</em></code> <em class="in">库，用于发出异步 web 请求。</em></p></blockquote><p id="477d" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">每个文件是做什么的？</p><ul class=""><li id="9ff0" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated"><em class="nj"> pyproject.toml </em>:不是针对<code class="fe lw lx ly lz b">poetry</code>的。它的作用类似于<code class="fe lw lx ly lz b">setup.py</code>，指定包的依赖项和属性。你可以在这里阅读更多关于那个<a class="ae jz" href="https://rotadev.com/what-is-pyproject-toml-file-for-dev/" rel="noopener ugc nofollow" target="_blank">的内容</a></li><li id="1a7d" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><em class="nj"> README.rst </em>:重构包文档的文本。我更喜欢使用降价的方式，所以我会将其更改为<code class="fe lw lx ly lz b">README.md</code>，但这是基于偏好的。</li><li id="9faa" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><em class="nj"> servus </em>:包源文件夹。这是您为包放置所有代码和逻辑的地方。</li><li id="a187" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><em class="nj">检测</em>:保存我们包裹的所有检测。</li></ul><h1 id="dd88" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">安装依赖项</h1><p id="8ada" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated"><code class="fe lw lx ly lz b">servus</code>依赖于<code class="fe lw lx ly lz b"><a class="ae jz" href="https://docs.aiohttp.org/en/stable/" rel="noopener ugc nofollow" target="_blank">aiohttp</a></code>库，所以我将把它作为需求/依赖项安装在我的项目中。</p><p id="7383" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">在您的终端中，从与您的<code class="fe lw lx ly lz b">pyproject.toml</code>相同的目录运行</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="2e24" class="nb kb in lz b gy nc nd l ne nf">poetry add aiohttp</span></pre><p id="86d4" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">这将更新我们的<em class="nj"> pyproject.toml </em>和<em class="nj">诗歌。用新的依赖锁定</em>。</p><p id="fbde" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">如果一个合作者想建立我们的项目并为之做出贡献，他们只需要克隆我们的项目文件夹并运行</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="a964" class="nb kb in lz b gy nc nd l ne nf">poetry install</span></pre><h1 id="2a06" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">运行代码</h1><p id="d872" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">首先，我们需要创建一些要运行的代码。</p><p id="b037" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">在我们的包源文件夹(<code class="fe lw lx ly lz b"><em class="nj">servus</em></code>)中，创建一个新文件(<code class="fe lw lx ly lz b"><em class="nj">async_api.py</em></code>)。</p><pre class="mt mu mv mw gt mx lz my mz aw na bi"><span id="ac3b" class="nb kb in lz b gy nc nd l ne nf">import aiohttp<br/>import asyncio<br/>import pprint</span><span id="9a28" class="nb kb in lz b gy nn nd l ne nf">async def make_web_request(url):<br/>    async with aiohttp.ClientSession() as session:<br/>        response = await session.get(url)<br/>        data = await response.json()<br/>    return data</span><span id="47ed" class="nb kb in lz b gy nn nd l ne nf">async def main():<br/>    data = await make_web_request("https://restcountries.com/v3.1/name/nigeria")<br/>    pprint.pprint(data)</span><span id="fae5" class="nb kb in lz b gy nn nd l ne nf"># Uncomment for Windows :)<br/># asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())</span><span id="fe58" class="nb kb in lz b gy nn nd l ne nf">asyncio.run(main())</span></pre><p id="ba7d" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">这只是一些基本的代码，向 API 发出异步 web 请求并打印出一些数据。如果您不熟悉异步 Python 编程，您可以查看我之前的文章<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/creating-asynchronous-web-requests-with-python-asyncio-aiohttp-d5469d37cc23">用 Python 创建异步 Web 请求</a>。</p><p id="70f2" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">有很多方法可以运行我们的代码。</p><ol class=""><li id="b6de" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv no ml mm mn bi translated">使用<code class="fe lw lx ly lz b">poetry shell</code>:</li></ol><ul class=""><li id="9d52" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated">从与<em class="nj"> pyproject.toml </em>相同的目录运行<code class="fe lw lx ly lz b">poetry shell</code>。这将创建一个新的 shell 实例，并激活一个虚拟环境。如果没有立即点击，那没问题。您只需要记住，要离开这个孤立的环境，键入<code class="fe lw lx ly lz b">exit</code>而不是传统的<code class="fe lw lx ly lz b">deactivate</code>。这将“杀死”新的外壳过程。</li><li id="2ec0" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated">运行<code class="fe lw lx ly lz b">python servus/async_api.py</code>你会得到一些漂亮的输出(双关语)。</li></ul><p id="03e3" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">2.使用<code class="fe lw lx ly lz b">poetry run</code>:</p><ul class=""><li id="ff6b" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated">运行<code class="fe lw lx ly lz b">poetry run python servus/async_api.py</code>。就这样。简短、简洁、美观。<code class="fe lw lx ly lz b">poetry</code>处理激活我们的虚拟环境和运行过程。您也可以使用它与其他程序如<code class="fe lw lx ly lz b">poetry run black .</code>一起运行黑色格式化程序。</li></ul><p id="c600" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">3.激活已有<code class="fe lw lx ly lz b">poetry</code>虚拟环境:</p><ul class=""><li id="2c8f" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated">运行<code class="fe lw lx ly lz b">poetry env list --full-path</code>。您会得到一个为您的项目创建的虚拟环境列表<code class="fe lw lx ly lz b">poetry</code>。然后你可以像激活任何由<code class="fe lw lx ly lz b">venv</code>创造的传统虚拟环境一样激活它。</li><li id="bcc4" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated">我不建议你走这条路。您会遇到许多错误行为。</li></ul><h1 id="f766" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">共享您的项目</h1><p id="6571" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">当您在项目中运行<code class="fe lw lx ly lz b">poetry add</code>或<code class="fe lw lx ly lz b">poetry install</code>时，如果<code class="fe lw lx ly lz b">poetry.lock</code>文件尚不存在，则会生成该文件。<code class="fe lw lx ly lz b">poetry.lock</code>“锁定”了项目中使用的 Python 包的确切版本，因此很容易创建可再现的和确定性的 Python 环境。</p><p id="2ef0" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">建议您将其添加到版本控制中，就像在 JavaScript 中添加<code class="fe lw lx ly lz b">package-lock.json</code>一样。</p><p id="e96b" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated">合作者只需要运行<code class="fe lw lx ly lz b">poetry install</code>就可以跟上速度。</p><h1 id="8dd2" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">进一步阅读</h1><p id="5634" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">谢谢你的阅读！以下是一些您可能会发现有用的资源:</p><ul class=""><li id="54e6" class="mf mg in la b lb ma lf mb lj mh ln mi lr mj lv mk ml mm mn bi translated"><a class="ae jz" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">官方诗歌文献</a></li><li id="3dfb" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><a class="ae jz" href="https://ogirardot.wordpress.com/2013/01/05/state-of-the-pythonpypi-dependency-graph/" rel="noopener ugc nofollow" target="_blank">Python/PyPI 依赖关系图的状态</a></li><li id="65c3" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><a class="ae jz" href="https://opensource.com/article/19/4/managing-python-packages" rel="noopener ugc nofollow" target="_blank">以正确的方式管理 Python 包</a></li><li id="40b1" class="mf mg in la b lb mo lf mp lj mq ln mr lr ms lv mk ml mm mn bi translated"><a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/asyncio-101-writing-asynchronous-python-programs-61b732ca77b1?gi=cb45f23a5b48"> Asyncio 101 |编写异步 Python 程序</a></li></ul><blockquote class="ng nh ni"><p id="1170" class="ky kz nj la b lb ma ld le lf mb lh li nk mc ll lm nl md lp lq nm me lt lu lv ig bi translated"><strong class="la io"> <em class="in">有项目或需要建议吗？</em> </strong> <a class="ae jz" href="https://linkedin.com/in/emmanuel-katchy" rel="noopener ugc nofollow" target="_blank"> <strong class="la io"> <em class="in">领英</em> </strong> </a>上取得联系</p></blockquote><p id="92ee" class="pw-post-body-paragraph ky kz in la b lb ma ld le lf mb lh li lj mc ll lm ln md lp lq lr me lt lu lv ig bi translated"><em class="nj">最初发布于</em><a class="ae jz" href="https://tobetek.hashnode.dev/creating-a-python-package-poetry-quickstart-guide" rel="noopener ugc nofollow" target="_blank"><em class="nj">https://tobe tek . hashnode . dev/creating-a-python-package-诗词-quickstart-guide </em> </a></p></div></div>    
</body>
</html>