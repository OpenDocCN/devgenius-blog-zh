<html>
<head>
<title>A detailed explanation of pointers in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang 中指针的详细解释</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-detailed-explanation-of-pointers-in-golang-87e659d29095?source=collection_archive---------2-----------------------#2022-02-15">https://blog.devgenius.io/a-detailed-explanation-of-pointers-in-golang-87e659d29095?source=collection_archive---------2-----------------------#2022-02-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0a3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">golang 中的指针教程</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be348ed520b4d053aaa9e0c6d1e8b9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjuZnAsQiGFIuE_-X-wGPQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@marvelous?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Marvin Meyer </a>在<a class="ae ky" href="https://unsplash.com/s/photos/work?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c64f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">计算机有两个重要组成部分，CPU 和内存。CPU 主要负责计算，内存负责存储。在我们编写的代码中，定义的变量将在运行时放在内存中。不同的变量长度不同，在内存中占用的块和大小也不同。</p><p id="0c57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大概如下图所示，当然真实的样子不是这样的，这里只是举例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/d41803c85a306eed12d4c1750f8d28a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYqyl8ptpB3dzm1xP6OhRw.png"/></div></div></figure><p id="b8e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了方便 CPU 取数据，我们存储在内存中的任何数据都有一个地址，这个地址代表变量在内存中的位置，存储这个地址的变量就是指针。</p><p id="5335" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">记住:<strong class="jm io">每个变量都有地址，指针的值就是地址。</strong></p><p id="86e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 C 语言中，对指针抱怨最多的就是指针的操作和内存释放，这往往会导致一些<strong class="jm io">缓冲区溢出</strong>的问题。</p><p id="64a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Golang 中也保留了指针的概念，但是不能执行指针运算。</p><p id="ec95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Golang 中关于指针有三个核心概念:</p><ul class=""><li id="9b1f" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">指示字地址</li><li id="2b2e" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">指针类型</li><li id="4128" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">指针值</li></ul><p id="1615" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">指针地址和类型</strong></p><p id="f275" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">指针变量可以指向任意值的内存地址，指针变量占用的内存大小是一个固定值，与它所指向的值大小无关。在 32 位机器上，指针变量占用 4 个字节，在 64 位机器上，它占用 8 个字节。当定义了一个指针变量并且没有给任何变量赋值时，它的默认值是<code class="fe lo lp lq lr b">nil</code>。</p><p id="5472" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 Go 语言中，我们通过在变量前面加上<code class="fe lo lp lq lr b">&amp;</code>符号来获取变量的内存地址，这个操作也叫做<strong class="jm io">取地址</strong>。同样，使用<code class="fe lo lp lq lr b">*</code>来表示指针。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="fbd7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设变量<code class="fe lo lp lq lr b">p</code>的类型为<code class="fe lo lp lq lr b">T</code>，其中<code class="fe lo lp lq lr b">p</code>代表取地址的变量，结果由<code class="fe lo lp lq lr b">addr</code>接收，即变量<code class="fe lo lp lq lr b">p</code>的地址赋给变量<code class="fe lo lp lq lr b">addr</code>，变量<code class="fe lo lp lq lr b">addr</code>的类型为<code class="fe lo lp lq lr b">*t</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="bb99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果如下:</p><pre class="kj kk kl km gt lu lr lv lw aw lx bi"><span id="aeb9" class="ly lz in lr b gy ma mb l mc md">0xc00010c008 =&gt; *int</span></pre><p id="9f26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">指针值</strong></p><p id="4a7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们通过<code class="fe lo lp lq lr b">&amp;</code>操作符获得变量的指针后，我们可以使用<code class="fe lo lp lq lr b">*</code>操作符获得指针值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="1e23" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果如下:</p><pre class="kj kk kl km gt lu lr lv lw aw lx bi"><span id="851a" class="ly lz in lr b gy ma mb l mc md">addr type: *int</span><span id="90fd" class="ly lz in lr b gy me mb l mc md">the address of pointer: 0xc0000b2008</span><span id="56e5" class="ly lz in lr b gy me mb l mc md">value type: int</span><span id="2892" class="ly lz in lr b gy me mb l mc md">value: 1</span></pre><p id="36f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">地址运算符<code class="fe lo lp lq lr b">&amp;</code>和值运算符<code class="fe lo lp lq lr b">*</code>是一对互补运算符，<code class="fe lo lp lq lr b">&amp;</code>取地址，<code class="fe lo lp lq lr b">*</code>根据地址取地址所指向的值。</p><p id="32c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">变量、指针地址、指针变量、地址和值的关系和特征如下:</p><ul class=""><li id="115d" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">使用<code class="fe lo lp lq lr b">&amp;</code>运算符取一个变量的地址，就可以得到这个变量的指针变量。</li><li id="e694" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">指针变量的值是指针地址。</li><li id="b8a8" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">使用<code class="fe lo lp lq lr b">*</code>操作符获得指针变量所指向的原始变量的值。</li></ul><p id="6bbc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">空指针异常</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="f04f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">执行上述代码后，将会报告一个错误:</p><pre class="kj kk kl km gt lu lr lv lw aw lx bi"><span id="2936" class="ly lz in lr b gy ma mb l mc md">panic: runtime error: invalid memory address or nil pointer dereference</span><span id="af91" class="ly lz in lr b gy me mb l mc md">[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x1054ca2]</span></pre><p id="6172" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要操作指针变量，它必须是一个指向的地址。虽然我们在上面声明了变量<code class="fe lo lp lq lr b">foo</code>，但是没有给它分配内存地址，所以在执行过程中会报告一个空指针异常。通常我们会优化到<code class="fe lo lp lq lr b">foo := new(int)</code>。</p><p id="7462" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">空指针交换</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="c04b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码中，你认为变量<code class="fe lo lp lq lr b">foo</code>和<code class="fe lo lp lq lr b">bar</code>的值会交换吗？结果将是:</p><pre class="kj kk kl km gt lu lr lv lw aw lx bi"><span id="5419" class="ly lz in lr b gy ma mb l mc md">1 2</span></pre><p id="dd0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">意味着他们之间没有交换。执行<code class="fe lo lp lq lr b">swap</code>函数时，已经声明了 4 个变量，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/8553017bc2ecbb509dd74c211320a5c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYcMScUdy5G39TS_sqiGgw.png"/></div></div></figure><p id="28d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">需要注意的是，<code class="fe lo lp lq lr b">&amp;foo</code>和<code class="fe lo lp lq lr b">&amp;bar</code>在值传入<code class="fe lo lp lq lr b">swap</code>函数时会产生新的变量，并有新的内存地址，但它们存储在内存中的值是一个地址。</p><p id="1258" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">交换后，<code class="fe lo lp lq lr b">&amp;foo</code>指向内存块<code class="fe lo lp lq lr b">0x004</code>，对应的值是<code class="fe lo lp lq lr b">0x002</code>，<code class="fe lo lp lq lr b">&amp;bar</code>指向内存块<code class="fe lo lp lq lr b">0x003</code>，对应的值是<code class="fe lo lp lq lr b">0x001</code>，他们进行了交换，但是对于地址块<code class="fe lo lp lq lr b">0x001</code>和<code class="fe lo lp lq lr b">0x002</code>，他们没有改变，所以最终打印结果没有改变。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/5b5c359d048de7f5ab6a15fd9f052b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwgaRcpNHZ_eyaha6HYhAg.png"/></div></div></figure><p id="b273" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用指针的注意事项</strong></p><p id="28b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">指针的使用带来了对变量的有效访问。如果不使用指针，在传递值时只能使用复制方法，所以在传递复杂或大型数据时会消耗更多的性能。</p><p id="51f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是在使用它时，有一些事情要记住:</p><ul class=""><li id="e0da" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">尽量不要对<code class="fe lo lp lq lr b">channel</code>这样的引用类型使用指针。</li><li id="3a5a" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">像 int 和 bool 这样的简单数据不需要使用指针。</li><li id="7814" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">最好不要嵌套指针，不要一个指针指向另一个指针。</li><li id="951e" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">需要并发安全、无用指针</li></ul><p id="1fd7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢您阅读本文，如果您认为文章写得很好，请关注我。</p><p id="c3c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果发现本文有错误，欢迎留言讨论。</p><p id="4435" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">祝你愉快。</p></div></div>    
</body>
</html>