<html>
<head>
<title>2 scenarios React State shouldn’t be used for — Thinking in ReactJs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2情景反应状态不应用于—在反应中思考</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/avoid-storing-these-values-in-react-component-state-constructing-the-react-way-of-thinking-90df4d810a88?source=collection_archive---------4-----------------------#2021-08-02">https://blog.devgenius.io/avoid-storing-these-values-in-react-component-state-constructing-the-react-way-of-thinking-90df4d810a88?source=collection_archive---------4-----------------------#2021-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="456e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">每个数据类型都有反应状态吗？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4dbfe3afaf4433fb45c158cdb4523508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RZHma9lAsizWZJvq"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ks" href="https://unsplash.com/@krakenimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> krakenimages </a>拍摄的照片</figcaption></figure><h1 id="99b5" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">简而言之，什么是状态？</h1><p id="d14c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">React组件状态经常被用来存储组件级的数据——你一定在想<strong class="ln io"> <em class="mh">这是显而易见的</em> </strong>对吗？到本文结束时，这种情况可能会改变！让我们开始吧。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="c6bd" class="kt ku in bd kv kw mp ky kz la mq lc ld jt mr ju lf jw ms jx lh jz mt ka lj lk bi translated">当我开始学习如何使用反应状态时，我陷入了一个常见的错误</h1><p id="38c3" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">因为反应状态是通用的，它们可以存储任何东西，我想我可以在其中存储东西并依赖它们，这在大多数情况下会导致性能或行为方面的问题。</p><p id="7860" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">让我们看一些例子</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="34b1" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">A.存储DOM元素</h1><p id="eff1" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在这个代码片段中，<strong class="ln io">第4行中的useState </strong> —及其useEffect存储了一些DOM元素引用。信不信由你，我见过开发人员这样做，事实上我自己过去也这样做过。不要这样做的原因有很多，这里有两个:</p><p id="5ae4" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">1-这会占用太多的空间，特别是如果这个元素是一个容器，并且它能容纳一吨的孩子。</p><p id="09f6" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">2- State应该存储UI 使用的<strong class="ln io">数据，而不是UI本身，它这样设计是有原因的。DOM元素在某些变化时被呈现和重新呈现(作为用户交互或数据变化的结果)。如果您的状态持有一个被注入到DOM中的UI，跟踪DOM元素的变化不再是<em class="mh"> React的责任，</em>它将被视为存储在状态中的任何对象，这基本上取消了对该元素的<a class="ae ks" href="https://reactjs.org/docs/faq-internals.html" rel="noopener ugc nofollow" target="_blank"> React虚拟DOM </a>引用，因为它总是从状态中检索。</strong></p><h2 id="6737" class="nb ku in bd kv nc nd dn kz ne nf dp ld lu ng nh lf ly ni nj lh mc nk nl lj nm bi translated">使用反应参考</h2><p id="25fb" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">有一种处理DOM元素的React方式叫做<a class="ae ks" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> (React Ref) </strong> </a>，它是一个api，允许开发者引用DOM元素并将其注入到虚拟DOM中。这种方式react可以跟踪它们，并在发生变化时重新渲染。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="99f4" class="kt ku in bd kv kw mp ky kz la mq lc ld jt mr ju lf jw ms jx lh jz mt ka lj lk bi translated">B.在状态中存储道具并从状态中访问它们</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="702b" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated"><strong class="ln io">使用状态</strong>——第4行的使用效果是在状态中存储道具。你可能已经注意到在第14行中，我们用一些现有的道具<code class="fe nn no np nq b">…props</code>构造了一个新的对象，然后添加了一个名为<code class="fe nn no np nq b">sendMessage</code>的新键，然后我们将这个对象存储在一个状态变量<code class="fe nn no np nq b">componentProps</code>中。这是我曾经犯过的一个错误，我也见过很多开发者这样做。</p><p id="7f11" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">这样做的原因是合法的，我们在开发时几乎每天都会遇到这种情况，我们需要检查<code class="fe nn no np nq b">props</code>中的一些东西，然后采取一些行动——在这个例子中，它添加了一个新变量<code class="fe nn no np nq b">sendMessage</code>。</p><p id="fab7" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated"><em class="mh">但是</em>为什么我们要把所有其他的道具和这个新变量一起存储呢？。当您依赖存储在状态中的引用时，无论是在组件本身中使用它还是将它传递给其他组件，都会出现问题。正如您已经知道的，React会在组件的道具更新时重新渲染组件。在上面的例子中，我们将<code class="fe nn no np nq b">props</code>存储在一个状态中，任何使用该引用的组件将永远不会得到更新的<code class="fe nn no np nq b">props</code>,如果它们得到更新的话，因此它们不会重新呈现，任何预期的UI更新将永远不会出现！。</p><h2 id="a4ca" class="nb ku in bd kv nc nd dn kz ne nf dp ld lu ng nh lf ly ni nj lh mc nk nl lj nm bi translated">永远不要在州内存放道具！</h2><p id="646e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们来看看这个片段</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5ddd" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">现在我们有了来自上层作用域的道具，并且在这个组件中设置了<code class="fe nn no np nq b">sendMessage</code>,我们可以将它们都向下传递或者/并且在这个组件中使用它们，一旦<code class="fe nn no np nq b">props</code>被更新，任何可以访问<code class="fe nn no np nq b">props</code>的组件都会重新渲染。我们对<code class="fe nn no np nq b">sendMessage</code>也有完全的控制权，当我们在任何时候更新它的时候，我们都知道我们将只更新<code class="fe nn no np nq b">sendMessage</code>，这保持了一个真实的来源，因为我们不再手动更新<code class="fe nn no np nq b">props</code>，而是让React做它的工作并处理那部分。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="5f56" class="kt ku in bd kv kw mp ky kz la mq lc ld jt mr ju lf jw ms jx lh jz mt ka lj lk bi translated">结论</h1><p id="f99f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">React属性和状态是独立的，我们不应该在组件的状态<strong class="ln io"> <em class="mh">中存储属性，除非我们不依赖那些数据来呈现UI。</em> </strong>我们还应该了解React虚拟DOM如何整体工作，<strong class="ln io"> <em class="mh">并利用它们的API来增强我们的UI </em> </strong>。</p><p id="f0f3" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">如果你正在读这篇文章，我想让你知道，我想在我的instagram上与你保持联系，拥有志同道合的社区总是好的。跟我来</p><p id="9eb0" class="pw-post-body-paragraph ll lm in ln b lo mu jo lq lr mv jr lt lu mw lw lx ly mx ma mb mc my me mf mg ig bi translated">觉得这篇文章有帮助？你可以<strong class="ln io">和别人分享</strong>它。</p></div></div>    
</body>
</html>