<html>
<head>
<title>Making a Hack’n’slash #23: Adding some skills and powers! 1/2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作一个黑客斜线#23:增加一些技能和权力！1/2</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-a-hackn-slash-23-adding-some-skills-and-powers-1-2-4194deda4449?source=collection_archive---------11-----------------------#2022-09-01">https://blog.devgenius.io/making-a-hackn-slash-23-adding-some-skills-and-powers-1-2-4194deda4449?source=collection_archive---------11-----------------------#2022-09-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="02a8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们继续劈砍吧，给我们的英雄一些特殊技能！</h2></div><p id="6af7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://medium.com/codex/making-a-hackn-slash-22-improving-our-player-statistics-acd29fe1b9a5" rel="noopener"><em class="lc">【⬅️】教程#22:提升我们的球员统计</em></a><em class="lc">|</em><a class="ae lb" href="https://medium.com/c-sharp-progarmming/making-a-hackn-slash-game-in-unity-c-6ec315e75816" rel="noopener"><em class="lc">TOC</em></a><em class="lc">|</em><a class="ae lb" href="https://mina-pecheux.medium.com/making-a-hackn-slash-24-adding-some-skills-and-powers-2-2-4032ec4ac117" rel="noopener"><em class="lc">教程#24:增加一些技能和威能！2/2 ➡️ </em> </a></p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/0e73857ff8ae127ce74f6268637947f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*dnzkrfyTEu-35wmIkJtGLw.png"/></div></figure><p id="c434" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在前一集，我们研究了英雄的基数统计，以及如何从中得出一些有趣的变量。这是一个让我们的角色在整个冒险过程中增强力量的好方法，特别是在战利品方面，但是这通常不是黑客和斜线玩家可以使用的唯一工具…</p><p id="9452" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">…另一个关键因素是特殊技能和超能力！</p><p id="91f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些可以是非常多样的，从纯粹的攻击提升到即时治疗，或者区域混乱法术，或者一些传送机制。找到正确的技能取决于你自己，以及你在游戏中所处的宇宙类型。</p><p id="2ac5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，我们仍然可以讨论如何实现这样的系统，并通过一个简单的例子来进行实践:)</p><p id="4189" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，在这几集里，让我们深入了解特殊的法术和技能！</p><h1 id="8a8f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv jw lw jx lx jz ly ka lz kc ma kd mb mc bi translated">为我们的技能定义数据</h1><p id="c752" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">首先，让我们想想如何定义我们的技能。在本文中，我们将举一个基本的例子:“强力打击”，即对敌人造成额外伤害的特殊近战攻击。我们希望这个技能有一个唯一的引用，一个显示名称，一个值类型(例如可以是“伤害”或“治疗”)和一个实际计算这个值的方法。</p><p id="b54f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像往常一样，前三个参数可以很容易地打包到一个可脚本化的对象中:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/f237d5d27e04f4a2044b79decc60ae02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E4rUKW0zs54_vUNj.jpg"/></div></div></figure><p id="ad62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，对于值计算函数来说，它要复杂一些。由于我们不能在检查器中编辑 C#，我们必须把它写在某个地方，并把它链接到我们的其他数据。但是最好避免在我们的<code class="fe mp mq mr ms b">SkillData</code>类中有一个大的 if-else if 检查，那么我们如何从其他地方“提取”这些信息呢？</p><p id="2981" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里一个很酷的技巧是使用委托。基本上，<a class="ae lb" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/" rel="noopener ugc nofollow" target="_blank"> C#委托</a>是一种将函数的原型声明为类型的方式，这样你就可以将函数作为输入传递给另一个函数。</p><p id="01ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，假设我们创建了另一个名为<code class="fe mp mq mr ms b">SkillEffects</code>的脚本，它包含一个静态类。这是我希望最少使用所有实际技能计算函数的地方。嗯，我可以在我的<code class="fe mp mq mr ms b">Skills</code>名称空间中声明一些没有输入参数也不返回值的全局委托:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="b8c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在我的类中使用它来创建一个字典，将特定的技能代码映射到它的计算函数:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="6fd0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在这里所做的是告诉程序，任何技能计算函数都有一个类似于在<code class="fe mp mq mr ms b">SkillEffect</code>委托中定义的原型:没有输入参数，也没有返回值。</p><p id="7bc0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我只需要给<code class="fe mp mq mr ms b">SkillData</code>对象添加一些传递方法，让它自动选择正确的逻辑:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="47ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了彻底起见，我们可以通过保留一个允许技能代码的列表来使整个系统更加健壮:这将允许打字错误和其他愚蠢的错误破坏行为。为此，让我们再次用我们的技能代码定义一个 enum 让我们把它放在第三个名为<code class="fe mp mq mr ms b">SkillCodes</code>的文件中，因为在一个成熟的项目中，这个列表可能会很长:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="23cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在我们的<code class="fe mp mq mr ms b">SkillData</code>中，我们将把<code class="fe mp mq mr ms b">code</code>字段的类型改为这个枚举类型:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="945c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们只需要替换我们的<code class="fe mp mq mr ms b">SkillEffects</code>类中的类型，我们就完成了！</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="3fd9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着，现在，在检查器中，我们有一个可能值的下拉列表，这使得它更容易得到正确的；)</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/656082975d1a852e1f28712420169988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UcEE1drjzfY7zJv8.jpg"/></div></div></figure><p id="e3a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，有了这个快速设置，让我们开始有趣的部分，实际上开始使用这个技能！</p><h1 id="5031" class="ll lm iq bd ln lo lp lq lr ls lt lu lv jw lw jx lx jz ly ka lz kc ma kd mb mc bi translated">利用我们的技能一击制敌！</h1><h2 id="9c2a" class="mt lm iq bd ln mu mv dn lr mw mx dp lv ko my mz lx ks na nb lz kw nc nd mb ne bi translated">触发特定的动画</h2><p id="d10d" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在这里，我们将保持事情的简单性，假设我们的强力打击会立刻在我们的角色面前打出一拳，并造成疯狂的伤害。这样，如果我们面对的是前几集的野蛮敌人，我们应该可以一拳干掉它。</p><p id="274f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们想要的是让我们的技能计算值触发所有这一连串的事件。换句话说，它应该得到一个对玩家控制器的引用，并让它启动一个特定的动作，反过来，它将使用一个类似于我们正常攻击动作的事件来攻击敌人。</p><p id="7634" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，为了简单起见，我将重用我的第一个攻击动画——但是我将把它复制到我的动画制作工具中的另一个状态“强力打击”。这样，我可以将它链接到“任何状态”工具:这意味着无论动画师当前处于哪个状态，我们都能够直接转换到“强力打击”状态。</p><p id="cb34" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了完成这个转换，我将使用一个名为“PowerStrike”的新触发变量；然后，为了最终转换回“空闲”状态，我将把它留空，只是等待动画结束。</p><p id="119a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我更新的动画师的所有这些补充:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nf"><img src="../Images/f5ee59c51e203d60a641b94d22986074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LUOT9m4swBabWLGo.jpg"/></div></div></figure><p id="8802" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让技能强制触发这个触发器，让我们给我们的<code class="fe mp mq mr ms b">PlayerController</code>添加一个新函数，名为<code class="fe mp mq mr ms b">TriggerState()</code>:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="12f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，这个逻辑假设你的技能状态和触发状态的名称是相同的。</p><p id="68af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在<code class="fe mp mq mr ms b">SkillEffects</code>脚本中，让我们更新我们的<code class="fe mp mq mr ms b">PowerStrike()</code>函数，让它找到玩家，获取它的<code class="fe mp mq mr ms b">PlayerController</code>脚本组件并调用该函数。我也会重置攻击组合，因为技能应该可以打断任何一系列的攻击。我们还需要一种方法来告诉玩家它应该造成额外的伤害，但是我们马上就会看到:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="3273" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在这里调用的<code class="fe mp mq mr ms b">ResetAttackCombo()</code>很容易在我们的<code class="fe mp mq mr ms b">PlayerController</code>中编码:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="82f2" class="mt lm iq bd ln mu mv dn lr mw mx dp lv ko my mz lx ks na nb lz kw nc nd mb ne bi translated">测试一下！</h2><p id="d776" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">现在，假设我们在<code class="fe mp mq mr ms b">PlayerManager</code>脚本中添加了一些测试 GUI 按钮来测试这个工作流。我将使用 Unity 的 IMGUI 来快速完成它——重点是在屏幕上有一个按钮，我可以点击它来调用我的强力打击技能，就像这样:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="03a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中我的<code class="fe mp mq mr ms b">_skills</code>数组是在检查器中手动填充的(最终，当然应该有一个解锁/学习新技能的逻辑，这将逐渐填充该数组):</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/cfa3f01e9651fd426a2434ee9bf98333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZFXV07s-nHb-tvcp.jpg"/></div></div></figure><p id="ed50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我点击游戏中的按钮，我会看到角色确实出拳了，正如我所料:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ng"><img src="../Images/6976e8bceb2a042ec6de9b27fe90c753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WlkM1GwqnF_y17ZL5vhPQg.gif"/></div></div></figure><h2 id="eb9c" class="mt lm iq bd ln mu mv dn lr mw mx dp lv ko my mz lx ks na nb lz kw nc nd mb ne bi translated">造成额外伤害！</h2><p id="e90a" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">但是，就目前而言，这一击与普通攻击没有区别。我们将在下一个教程中看到如何添加一些视觉效果来展示这种一击即中的神奇和异想天开的力量——不过现在，我们将专注于数据和逻辑。</p><p id="983d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要告诉玩家这一拳是特殊的，有特定的伤害。让我们在我们的<code class="fe mp mq mr ms b">PowerStrike()</code>函数中这样做:我们将在我们的<code class="fe mp mq mr ms b">PlayerController</code>上设置一些静态变量(没有污染生态系统的风险，因为我们在整个游戏中只有这个脚本的一个副本)，并定义一些“覆盖损害”:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="b7f5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在我们的<code class="fe mp mq mr ms b">PlayerAttackManager</code>中，我们将检查这个值是否被设置。如果是，我们使用它；否则，我们像以前一样计算损害:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="f909" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你重新运行游戏，你瞧！你会发现你的强力打击真的很强大:)</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ng"><img src="../Images/9292707ecad855bde75443ec10918916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lWWr4-wCE79MDajTpMiLwA.gif"/></div></div></figure><h2 id="f9d6" class="mt lm iq bd ln mu mv dn lr mw mx dp lv ko my mz lx ks na nb lz kw nc nd mb ne bi translated">重置损坏覆盖</h2><p id="22d7" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">当然，我们也需要重置这个伤害覆盖，这样接下来的普通拳就不会突然受到这个覆盖伤害。要做到这一点，我们可以重用之前的回调系统，并在动画结束时重置该值，此时技能已经施放:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="fd0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你试着将强力打击从敌人身上移开，然后对野兽进行正常的重击，你会发现它确实恢复到正常的伤害量；)</p><h1 id="1d53" class="ll lm iq bd ln lo lp lq lr ls lt lu lv jw lw jx lx jz ly ka lz kc ma kd mb mc bi translated">结论</h1><p id="b6c3" class="pw-post-body-paragraph kf kg iq kh b ki md jr kk kl me ju kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在第一部分中，我们实现了我们的基本技能数据结构，并且我们看到了如何定义一个角色转换时要执行的逻辑的快速示例。</p><p id="eeac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一次，我们将继续致力于这个系统，并增加几个功能，如冷却，一些用户界面显示和尼斯 VFX！</p><p id="8600" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lc">阅读更多我的内容，以及许多其他伟大作家的自媒体文章，</em> <strong class="kh ir"> <em class="lc">考虑成为会员吧！</em> </strong> <em class="lc">你的会员费直接支持你阅读的作家。</em></p><div class="nh ni gp gr nj nk"><a href="https://mina-pecheux.medium.com/membership" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">通过我的推荐链接加入媒体</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">阅读 Mina Pêcheux(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">mina-pecheux.medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny lj nk"/></div></div></a></div><p id="d3a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://medium.com/codex/making-a-hackn-slash-22-improving-our-player-statistics-acd29fe1b9a5" rel="noopener"> <em class="lc"> ⬅️教程#22:提升我们的球员统计</em></a><em class="lc">|</em><a class="ae lb" href="https://medium.com/c-sharp-progarmming/making-a-hackn-slash-game-in-unity-c-6ec315e75816" rel="noopener"><em class="lc">TOC</em></a></p></div></div>    
</body>
</html>