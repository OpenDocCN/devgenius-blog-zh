<html>
<head>
<title>Static and Dynamic libraries — C programming language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">静态和动态库— C编程语言</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/static-and-dynamic-libraries-c-programming-language-ae570b75038e?source=collection_archive---------7-----------------------#2022-01-10">https://blog.devgenius.io/static-and-dynamic-libraries-c-programming-language-ae570b75038e?source=collection_archive---------7-----------------------#2022-01-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cea532018ddc9d7248775204feee3c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LyFo-ncGtb_nSqHLms1m5Q.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源:https://time.com/5812697/bird-library-livestream/<a class="ae jz" href="https://time.com/5812697/bird-library-livestream/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="956a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个<strong class="kc io">库</strong>是一个行为实现的集合，用一种语言编写，有一个定义良好的接口，通过这个接口调用行为。例如，想要编写高级程序的人可以使用库来进行系统调用，而不是一次又一次地实现这些系统调用。此外，该行为还提供给多个独立的程序重用。程序通过语言的机制调用库提供的行为。例如，在简单的命令式语言(如C)中，通过使用C的普通函数调用来调用库中的行为。区别库函数调用和同一个程序中另一个函数调用的是代码在系统中的组织方式。[1]</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="cbc0" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用图书馆的重要性:</h1><p id="d2fc" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">像C语言这样的编程语言提供了所需的基本特性。这种提到的语言甚至不包含从键盘读取和打印到屏幕上的输入输出(I/O)功能。在60年代和70年代，开发人员应该实现他们自己的库，这些库执行常见的例程——处理字符串、打印消息、执行数学运算、处理数据结构、时间操作等等。但是在1989年，ANSI开发了一个C的标准规范，命名为<strong class="kc io"> C89 </strong>，其中一步就是创建一个<strong class="kc io">标准库。</strong>1999年，使用<strong class="kc io"> C99标准</strong>向该库中添加了一些特性。</p><p id="16d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用C语言的开发随着标准库的实现而增加，原因如下[2]:</p><ul class=""><li id="3399" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx mn mo mp mq bi translated">它的功能(例如<code class="fe mr ms mt mu b">printf</code>和<code class="fe mr ms mt mu b">atoi</code>)工作正常，因为它们经过严格测试，并且它们的代码是以最有效的方式编写的，以便产生可能的最佳性能。</li><li id="405f" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">它节省了开发时间，避免了编写通用的基本例程。</li><li id="2cc5" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">它的功能是可移植的，这意味着它可以在任何运行开发的程序的计算机上实现。</li></ul><p id="cc90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然标准库非常有用，但是在大多数情况下，它是不够的。随着软件项目的进展，代码行也会增加。将程序分成模块并创建一个库是一个很好的实践，它允许<strong class="kc io">以更简单的方式</strong>实现未来的例程，以及<strong class="kc io">读取、测试和调试</strong>代码。通过库，在另一个项目中实现任何这些功能都是可行的，并且使用另一个开发人员编写的功能也很容易——库是一种协作工具。</p><h1 id="1cfd" class="lf lg in bd lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly ne ma mb mc bi translated">图书馆是如何工作的？</h1><h2 id="8085" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">静态库</h2><p id="d50f" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">它们是在源代码被静态链接器编译之前加入源代码的目标文件的集合，使源代码完全独立。为了深入了解关于静态库的信息，<a class="ae jz" href="https://medium.com/@iheb.yah/static-libraries-c-programming-language-2dc70b3dfbdb" rel="noopener">有一个博客</a>是我几个月前写的。</p><h2 id="1e44" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">动态库</h2><blockquote class="nr ns nt"><p id="fb88" class="ka kb nu kc b kd ke kf kg kh ki kj kk nv km kn ko nw kq kr ks nx ku kv kw kx ig bi translated">简单地说，共享库/动态库是在运行时为每个需要它的应用程序动态加载的库。动态链接不需要复制代码，只需将库名放入二进制文件中即可。实际的链接发生在程序运行时，此时二进制文件和库都在内存中。</p></blockquote><h2 id="bbf2" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">如何创建它们？</h2><p id="8efe" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">创建静态库的过程在<a class="ae jz" href="https://medium.com/@iheb.yah/static-libraries-c-programming-language-2dc70b3dfbdb" rel="noopener">以前的博客中有描述。</a>另一方面，创建动态库有两个步骤:</p><ol class=""><li id="9527" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx ny mo mp mq bi translated">创建目标代码。</li><li id="ea9a" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx ny mo mp mq bi translated">创建库。</li></ol><p id="6a39" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设在名为<code class="fe mr ms mt mu b">main.c</code>的文件中有一个调用<code class="fe mr ms mt mu b">calculator</code>函数的入口点:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="05d4" class="nf lg in mu b gy oh oi l oj ok">#include "header.h"<br/>#include &lt;stdio.h&gt;/**<br/> * main - Entry Point<br/> *<br/> * Return: Always 0.<br/> */<br/>int main(void)<br/>{<br/>    printf("4 + 2 = %d\n", calculator('+', 4, 2));<br/>    printf("4 - 2 = %d\n", calculator('-', 4, 2));<br/>    printf("4 * 2 = %d\n", calculator('*', 4, 2));<br/>    printf("4 / 2 = %d\n", calculator('/', 4, 2));<br/>    return (0);<br/>}</span></pre><p id="09b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mr ms mt mu b">calculator</code>函数根据传递的char变量的值返回数学运算的结果:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="fb49" class="nf lg in mu b gy oh oi l oj ok">#include "header.h"/**<br/> * calculator - Executes basic math operations<br/> *<br/> * @op: char that indicates math operation executed.<br/> * @num1: number one.<br/> * @num2: number two.<br/> * Return: addition if op is '+'<br/> *         subtraction if op is '-'<br/> *         multiplication if op is '*'<br/> *         division if op is '/'<br/> *         otherwise, 0.<br/> */<br/>int calculator(char op, int num1, int num2)<br/>{<br/>    if (op == '+')<br/>        return (num1 + num2);<br/>    if (op == '-')<br/>        return (num1 - num2);<br/>    if (op == '*')<br/>        return (num1 * num2);<br/>    if (op == '/')<br/>        return (num1 /num2);<br/>    return (0);<br/>}</span></pre><p id="148b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mr ms mt mu b">header.h</code>文件包含<code class="fe mr ms mt mu b">calculator</code>的原型函数，以便向编译器指示其数据类型和参数:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="0766" class="nf lg in mu b gy oh oi l oj ok">#ifndef __HEADER__<br/>#define __HEADER__int calculator(char op, int num1, int num2);#endif</span></pre><p id="4a54" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，创建的文件如下:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="4575" class="nf lg in mu b gy oh oi l oj ok">$ ls<br/>calculator.c  header.h  main.c$</span></pre><p id="9072" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要创建<code class="fe mr ms mt mu b">calculator.c</code>的目标文件，需要使用编译器GCC:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="0b74" class="nf lg in mu b gy oh oi l oj ok">$ gcc -Wall -fPIC -c calculator.c$ ls<br/>calculator.c  calculator.o  header.h  main.c$</span></pre><p id="280f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用的标志是<code class="fe mr ms mt mu b">-Wall</code>，它打印所有警告信息，以及<code class="fe mr ms mt mu b">-c</code>，它创建目标文件<code class="fe mr ms mt mu b">.o</code>。<code class="fe mr ms mt mu b">-fPIC</code> flag生成与位置无关的代码，该代码访问全局偏移表(GOT)中存储的所有常量地址。这个表被可执行程序用来在运行时查找函数的地址——在这个例子中是<code class="fe mr ms mt mu b">calculator</code>——以及编译时未知的全局变量。<em class="nu">动态加载器— </em>是操作系统的一部分—在程序启动时解析得到的条目[4]。</p><p id="0965" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦创建了目标文件，在本例中为<code class="fe mr ms mt mu b">calculator.o</code>，就创建了库。可以使用以下命令行:</p><pre class="nz oa ob oc gt od mu oe of aw og bi"><span id="51ac" class="nf lg in mu b gy oh oi l oj ok">$ gcc -shared -Wl,-soname,libcalc.so -o libcalc.so *.o$ ls<br/>calculator.c  calculator.o  header.h  <strong class="mu io">libcalc.so   </strong>main.c$</span></pre><p id="2b21" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">标志生成一个共享对象，在与另一个对象文件编译时，它可以被链接成一个可执行文件。<code class="fe mr ms mt mu b">-Wl,options</code>将选项传递给链接器:在本例中为<code class="fe mr ms mt mu b">-soname</code>，以指示库的二进制api兼容性(默认为0)。<code class="fe mr ms mt mu b">-o</code> flag将输出库保存在一个给定名称为<code class="fe mr ms mt mu b">libcalc.so</code>的文件中。</p><h1 id="a685" class="lf lg in bd lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly ne ma mb mc bi translated">静态库和动态库的区别</h1><h1 id="130c" class="lf lg in bd lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly ne ma mb mc bi translated">静态库</h1><ul class=""><li id="868a" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">是建筑环境的一部分。</li><li id="d807" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">目标文件被添加到可执行文件中</li><li id="4e56" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">拥有。延期</li></ul><h2 id="3c17" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">优势:</h2><ul class=""><li id="4fe8" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">它们更快，因为所有模块都在同一个文件中。</li><li id="31b6" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">它们的分布和安装更容易。</li><li id="0d74" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">避免依赖问题。</li></ul><h2 id="e1e8" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">缺点:</h2><ul class=""><li id="039e" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">使用更多内存空间为每个可执行文件创建一个副本</li><li id="6a8a" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">较慢的编译过程所有的源代码都要重新编译。</li></ul><h1 id="a468" class="lf lg in bd lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly ne ma mb mc bi translated">动态库:</h1><ul class=""><li id="ed95" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">是运行时环境的一部分</li><li id="547d" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">目标文件的地址被添加到执行文件中</li><li id="9726" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">有。所以扩展</li></ul><h2 id="efb4" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">优势:</h2><ul class=""><li id="95ad" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">无用的内存空间:只有在复制时才能多次使用</li><li id="fc8d" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">源代码不会被重新编译</li><li id="985b" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">更快的编译过程</li></ul><h2 id="3750" class="nf lg in bd lh ng nh dn ll ni nj dp lp kl nk nl lt kp nm nn lx kt no np mb nq bi translated">缺点:</h2><ul class=""><li id="2545" class="mi mj in kc b kd md kh me kl ol kp om kt on kx mn mo mp mq bi translated">可能导致应用程序中的依赖性问题</li><li id="b73e" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx mn mo mp mq bi translated">如果移除库，会出现兼容性问题</li></ul></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><ol class=""><li id="2c89" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx ny mo mp mq bi translated">普拉萨德德什潘德。<a class="ae jz" href="https://dx.doi.org/10.31979/etd.t9xm-ahsc" rel="noopener ugc nofollow" target="_blank"> <em class="nu">变形检测利用函数调用图分析</em> </a>(论文)。圣何塞州立大学图书馆。<a class="ae jz" href="https://en.wikipedia.org/wiki/Doi_(identifier)" rel="noopener ugc nofollow" target="_blank">doi</a>:<a class="ae jz" href="https://doi.org/10.31979%2Fetd.t9xm-ahsc" rel="noopener ugc nofollow" target="_blank">10.31979/etd . t9xm-ahsc</a>。</li><li id="2556" class="mi mj in kc b kd mv kh mw kl mx kp my kt mz kx ny mo mp mq bi translated">编程。c标准库函数。链接:<a class="ae jz" href="https://www.programiz.com/c-programming/library-function" rel="noopener ugc nofollow" target="_blank">https://www.programiz.com/c-programming/library-function</a></li></ol></div></div>    
</body>
</html>