<html>
<head>
<title>Working with Providers: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与提供者合作:第1部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/working-with-providers-part-1-8edb5aa0e169?source=collection_archive---------0-----------------------#2020-11-14">https://blog.devgenius.io/working-with-providers-part-1-8edb5aa0e169?source=collection_archive---------0-----------------------#2020-11-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e855" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Flutter中的供应商介绍。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/61e132c41b28173cb1bcc8bec864a360.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dfDNqIWCCa5w0i49"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">路</a>上<a class="ae ks" href="https://unsplash.com/@headwayio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">车头</a>拍摄</figcaption></figure><blockquote class="kt ku kv"><p id="eca6" class="kw kx ky kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">注意:我们将在我之前的文章中创建的联系人应用程序项目的基础上进行构建:</p></blockquote><div class="lt lu gp gr lv lw"><a href="https://medium.com/dev-genius/understanding-futurebuilder-in-flutter-491501526373" rel="noopener follow" target="_blank"><div class="lx ab fo"><div class="ly ab lz cl cj ma"><h2 class="bd io gy z fp mb fr fs mc fu fw im bi translated">了解颤振中的未来建筑</h2><div class="md l"><h3 class="bd b gy z fp mb fr fs mc fu fw dk translated">因为您的构建方法不能是异步的</h3></div><div class="me l"><p class="bd b dl z fp mb fr fs mc fu fw dk translated">medium.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk km lw"/></div></div></a></div></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><p id="7109" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">在本文中，我们将讨论Flutter中的提供者和状态管理。</p><p id="a03f" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated"><a class="ae ks" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank">提供者</a>包是用于状态管理的InheritedWIdget的包装器。使用provider，我们可以在小部件树中放置一个状态对象，并使它可以从任何其他后代小部件中访问。<a class="ae ks" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank"> Provider </a>也帮助管理状态对象的生命周期，方法是用数据初始化它们，并在它们从widget树中删除后进行清理。<a class="ae ks" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank"> Provider </a>甚至可以用来实现BLoC组件，或者作为<a class="ae ks" href="https://flutter.dev/docs/development/data-and-backend/state-mgmt/options" rel="noopener ugc nofollow" target="_blank">其他</a>状态管理解决方案的基础！或者它可以简单地用于<a class="ae ks" href="https://en.wikipedia.org/wiki/Dependency_injection" rel="noopener ugc nofollow" target="_blank">依赖注入</a>，这是一个将数据传递到小部件的时髦术语。</p><h2 id="5098" class="mv mw in bd mx my mz dn na nb nc dp nd ms ne nf ng mt nh ni nj mu nk nl nm nn bi translated">添加插件</h2><p id="7300" class="pw-post-body-paragraph kw kx in kz b la no jo lc ld np jr lf ms nq li lj mt nr lm ln mu ns lq lr ls ig bi translated">让我们从添加<a class="ae ks" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank">提供者</a>插件到我们的flutter项目开始。</p><p id="48fe" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">转到您的pubspec.yaml文件并查找<em class="ky"> cupertino_icons </em>插件。在此之下，你可以添加你的应用程序需要的任何插件。因此，让我们继续在这里添加提供者包。</p><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="68f4" class="mv mw in nu b gy ny nz l oa ob">cupertino_icons: ^1.0.0<br/>provider: ^4.3.2+2</span></pre><p id="f748" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">完成后，运行pub get命令。如果你使用Android Studio，你会在右上角看到Pub get选项。如果您使用VS代码，那么如果您保存文件，该命令会自动运行。</p><h2 id="d664" class="mv mw in bd mx my mz dn na nb nc dp nd ms ne nf ng mt nh ni nj mu nk nl nm nn bi translated">添加更改通知程序</h2><p id="eb7a" class="pw-post-body-paragraph kw kx in kz b la no jo lc ld np jr lf ms nq li lj mt nr lm ln mu ns lq lr ls ig bi translated">既然我们已经将提供者包添加到我们的项目中，让我们继续使用它。在我们开始消费数据之前，我们需要实现一个ChangeNotifier。当我们的联系人列表中添加、更新或删除了某些内容时，它会告诉所有使用这些数据的小部件。</p><p id="362b" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">我们在lib中创建一个名为provider的新文件夹，并在其中创建一个名为contact-provider.dart的文件。</p><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="7c35" class="mv mw in nu b gy ny nz l oa ob"><em class="ky">import </em>'../model/contact.dart';<br/><em class="ky">import </em>'package:flutter/material.dart';<br/><br/><em class="ky">class </em>ContactProvider <em class="ky">extends </em>ChangeNotifier {<br/>  List&lt;Contact&gt; _contactList = [];<br/>  <br/>  List&lt;Contact&gt; <em class="ky">get </em>contacts {<br/>    <em class="ky">return </em>[..._contactList];<br/>  }<br/>  <br/>  <em class="ky">set </em>contacts(List&lt;Contact&gt; newContacts) {<br/>    _contactList = newContacts;<br/>    notifyListeners();<br/>  }<br/>  <br/>  <em class="ky">void </em>addContact(Contact newContact) {<br/>    _contactList.add(newContact);<br/>    notifyListeners();<br/>  }<br/>  <br/>  <em class="ky">void </em>removeContact(int index) {<br/>    _contactList.removeAt(index);<br/>    notifyListeners();<br/>  }<br/>}</span></pre><p id="572f" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">让我们了解一下这里发生了什么。</p><p id="73d8" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">首先，我们创建我们的<em class="ky"> ContactProvider </em>类，并让它扩展<em class="ky"> ChangeNotifier。</em>这使我们能够访问<em class="ky"> notifyListeners() </em>方法，我们将使用该方法来更新应用程序中的数据。</p><p id="3888" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">我们有一个私有的联系人列表，可以使用getter和setter来访问。除此之外，我们还有<em class="ky"> addContact() </em>和<em class="ky"> removeContact() </em>方法，这些方法非常简单明了。在这些方法中，您将看到我们使用了<em class="ky"> notifyListeners() </em>方法，每当添加或删除联系人时，该方法都会更新小部件。</p><p id="de8b" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">完成后，我们转到main.dart文件，将MaterialApp包装在一个<em class="ky"> MultiProvider() </em>小部件中。在<em class="ky"> MultiProvider </em>中，我们声明了我们希望在应用程序中使用的所有提供者的列表。</p><p id="8144" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">我们的main.dart文件应该是这样的:</p><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="7d5a" class="mv mw in nu b gy ny nz l oa ob"><em class="ky">import </em>'package:contacts_app/provider/contact-provider.dart';<br/><em class="ky">import </em>'package:flutter/material.dart';<br/><em class="ky">import </em>'package:provider/provider.dart';<br/><em class="ky">import </em>'contacts-page.dart';<br/><br/><em class="ky">void </em>main() {<br/>  runApp(MyApp());<br/>}<br/><br/><em class="ky">class </em>MyApp <em class="ky">extends </em>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <em class="ky">return </em>MultiProvider(<br/>      providers: [<br/>        ChangeNotifierProvider.value(value: ContactProvider()),<br/>      ],<br/>      child: MaterialApp(<br/>        title: 'Flutter Demo',<br/>        theme: ThemeData(<br/>          primarySwatch: Colors.<em class="ky">purple</em>,<br/>          visualDensity: VisualDensity.<em class="ky">adaptivePlatformDensity</em>,<br/>        ),<br/>        home: ContactsPage(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><h2 id="2654" class="mv mw in bd mx my mz dn na nb nc dp nd ms ne nf ng mt nh ni nj mu nk nl nm nn bi translated">使用提供程序</h2><p id="b66e" class="pw-post-body-paragraph kw kx in kz b la no jo lc ld np jr lf ms nq li lj mt nr lm ln mu ns lq lr ls ig bi translated">现在我们已经设置好了更改监听器，让我们回到contact-page.dart文件。我们修改了<em class="ky"> _getContacts() </em>方法，以便在获取联系人列表时更新提供者。</p><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="54cf" class="mv mw in nu b gy ny nz l oa ob"><em class="ky">void </em>_getContacts() <em class="ky">async </em>{<br/>  <em class="ky">await </em>Future.delayed(Duration(milliseconds: 200));<br/>  ContactProvider contactProvider = Provider.<em class="ky">of</em>&lt;ContactProvider&gt;(context, listen: <em class="ky">false</em>);<br/>  contactProvider.contacts = dummyData;<br/>}</span></pre><p id="1a7c" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">我们初始化提供者并更新提供者中的联系人。请记住，在初始化提供程序时，请将listen参数设置为false。您只是使用提供程序来访问您的数据，而不是监听更改。</p><p id="c6fc" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">现在我们已经获得了数据，剩下的下一件事就是在我们的ListView中使用这些数据。我们在<em class="ky"> _buildListView() </em>方法中实现了这一点。</p><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="574e" class="mv mw in nu b gy ny nz l oa ob">Widget _buildListView() {<br/>  <em class="ky">return </em>Consumer&lt;ContactProvider&gt;(<br/>    builder: (__, model, _) {<br/>      <em class="ky">return </em>ListView.builder(<br/>        itemBuilder: (_, index) {<br/>          <em class="ky">return </em>ContactCard(model.contacts[index]);<br/>        },<br/>        itemCount: model.contacts.length,<br/>      );<br/>    },<br/>  );<br/>}</span></pre><p id="4838" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">我们将ListView包装在一个<em class="ky"> Consumer &lt; T &gt; () </em>小部件中，其中的类型是ContactProvider。消费者构建器函数为我们提供了上下文、模型和子变量。因为我们不需要上下文或子变量，所以我们将它们初始化为丢弃变量。我们关注的主要领域是模型。这为我们提供了用来填充ListView的联系人。您可以在下面看到我们联系人列表的用户界面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oc"><img src="../Images/5930f35b7ecdf67d399eab5cbf37deaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lO3k55vxOLs63mlP2Fh_xw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">联系人列表用户界面</figcaption></figure><h2 id="4d72" class="mv mw in bd mx my mz dn na nb nc dp nd ms ne nf ng mt nh ni nj mu nk nl nm nn bi translated">包裹</h2><p id="b093" class="pw-post-body-paragraph kw kx in kz b la no jo lc ld np jr lf ms nq li lj mt nr lm ln mu ns lq lr ls ig bi translated">在这篇文章中，我们了解了如何使用提供者、消费者和一些关于变更通知者的信息。我们用它来创建我们的conacts应用程序。在下一篇文章中，我们将看看如何添加一个新的联系人，更新一个现有的联系人，以及从我们的联系人列表中删除联系人。</p><p id="f40c" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">一如既往，如果你喜欢这个，请通过鼓掌和评论让我知道。此外，请随意评论您希望我在下一篇文章中涵盖的主题。在那之前，编码快乐！</p><p id="cd23" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">你可以在这里查看完整的代码:</p><div class="lt lu gp gr lv lw"><a href="https://github.com/stef0296/contacts_app" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab fo"><div class="ly ab lz cl cj ma"><h2 class="bd io gy z fp mb fr fs mc fu fw im bi translated">stef 0296/联系人_应用程序</h2><div class="md l"><h3 class="bd b gy z fp mb fr fs mc fu fw dk translated">这个项目是一个Flutter应用程序的起点。一些帮助您入门的资源…</h3></div><div class="me l"><p class="bd b dl z fp mb fr fs mc fu fw dk translated">github.com</p></div></div><div class="mf l"><div class="od l mh mi mj mf mk km lw"/></div></div></a></div><p id="58e8" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf ms lh li lj mt ll lm ln mu lp lq lr ls ig bi translated">资源:</p><ol class=""><li id="b591" class="oe of in kz b la lb ld le ms og mt oh mu oi ls oj ok ol om bi translated"><a class="ae ks" href="https://flutter.dev/docs/development/data-and-backend/state-mgmt/simple" rel="noopener ugc nofollow" target="_blank">简单的app状态管理</a></li><li id="7d06" class="oe of in kz b la on ld oo ms op mt oq mu or ls oj ok ol om bi translated"><a class="ae ks" href="https://medium.com/flutter-nyc/a-closer-look-at-the-provider-package-993922d3a5a5" rel="noopener">仔细查看提供商产品包</a></li><li id="48ff" class="oe of in kz b la on ld oo ms op mt oq mu or ls oj ok ol om bi translated"><a class="ae ks" href="https://medium.com/flutter-community/making-sense-all-of-those-flutter-providers-e842e18f45dd" rel="noopener">了解所有这些颤振供应商</a></li></ol></div></div>    
</body>
</html>