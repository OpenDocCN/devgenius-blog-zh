<html>
<head>
<title>Step by Step Guide for iOS Subscription Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 订阅测试分步指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/step-by-step-guide-for-ios-subscription-testing-50851cea8953?source=collection_archive---------0-----------------------#2020-08-14">https://blog.devgenius.io/step-by-step-guide-for-ios-subscription-testing-50851cea8953?source=collection_archive---------0-----------------------#2020-08-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b478c3ce6c18d2326a20c1d93e754b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-UJqWHsqI_wNT8gbBN8UQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/s/photos/swift-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae jz" href="https://unsplash.com/@altumcode?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍摄的照片</figcaption></figure><p id="f133" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">测试订阅和开发订阅一样具有挑战性。在本文中，我们将回顾订阅测试的完整过程。</p><p id="f628" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，要进行任何类型的订阅测试，您需要创建一个沙盒测试帐户:</p><ol class=""><li id="ac5b" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">登录到您的<a class="ae jz" href="https://appstoreconnect.apple.com/access/testers" rel="noopener ugc nofollow" target="_blank"> iTunes Connect 帐户- &gt;用户并访问- &gt;沙盒- &gt;测试员</a>来创建新的测试员。</li><li id="6540" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在您的设备中，进入设置-&gt; iTunes &amp; App Store -&gt;注销当前帐户，不要在此处登录沙盒测试器帐户</li></ol><p id="7f44" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">注意</strong>:不要使用您的测试用户帐户登录生产环境。如果您这样做，沙盒帐户将变得无效，并且不能再使用。</p><h1 id="d880" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">订阅测试的类型</h1><h1 id="2a3b" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">1.沙盒测试</h1><p id="8571" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">沙盒测试可以分为两种，一种是<strong class="kc io"> <em class="mp">开发者沙盒</em> </strong>另一种是<strong class="kc io"> <em class="mp">生产沙盒</em> </strong> <em class="mp">。</em>如果你从 Xcode 运行你的应用，那么订阅测试在开发者沙箱上运行。然而，如果你已经通过<em class="mp"> testflight </em>发布了你的应用，那么订阅测试将在生产沙箱上运行。</p><p id="f43f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">登录 iTunes &amp; App Store 下的沙盒帐户，如下图所示:</p><figure class="mr ms mt mu gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/22b0914cbc82332832e0879bf1986769.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/0*DCxL-bYK6VVH3YhN.jpeg"/></div></figure><p id="b532" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">登录沙盒帐户后，您就可以测试您的订阅了。</p><p id="2093" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">沙盒测试内的订阅持续时间:</strong></p><p id="0a61" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">订阅期限已缩短，以方便测试，允许开发人员测试多次购买、续订和到期。</p><figure class="mr ms mt mu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/e2e5ea776f4e0d17dd63408a8a7d8148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jXFg8iITZ_i-5Qj2.png"/></div></div></figure><p id="cde6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">自动续订套餐最多可自动续订 6 次，之后过期。</p><h1 id="77c6" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">测试步骤:</h1><p id="ef85" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated"><strong class="kc io">测试购买、自动续费和到期</strong>:</p><p id="1566" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设您的订阅是 1 年期自动续订订阅:</p><ol class=""><li id="17ed" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">订阅您的应用内订阅。</li><li id="b671" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">关闭应用程序并在 1 小时后打开它，以确保您的应用程序仍处于活动订阅状态。</li><li id="924e" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">关闭应用程序并在大约 6 小时后再次打开，您的应用程序应重置为退订状态。发生这种情况是因为沙盒环境自动更新订阅多达 6 次。</li></ol><p id="1a28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">测试有效订阅的恢复购买:</strong></p><p id="7ad8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">沙盒环境中的一个主要缺点是，在购买订阅之前，设备上没有收据文件，而在生产环境中，一旦应用程序安装在设备上，就会形成收据文件。</p><ol class=""><li id="2350" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">订阅您的自动续费套餐。</li><li id="3a7b" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">删除设备上的应用程序。</li><li id="e644" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">重新安装 app，按下<strong class="kc io"> <em class="mp">恢复购买</em> </strong> <em class="mp"> </em>按钮。</li><li id="c5e1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">如果在订阅测试持续时间内完成了所有这些步骤，那么应该恢复活动订阅，否则，应该向用户显示一条关于没有找到活动订阅的消息。</li></ol><p id="b96e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">在多个设备上测试恢复购买:</strong></p><ol class=""><li id="1e51" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">使用相同的沙盒帐户登录设备 A 和 B。</li><li id="04db" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在设备 a 上订阅您的订阅。</li><li id="ea5f" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在设备 b 上安装应用程序。</li><li id="e915" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">启动设备 B 上的应用程序，并按下<strong class="kc io"> <em class="mp">恢复购买</em> </strong>按钮。</li></ol><h1 id="79c9" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">试飞测试</h1><p id="7f3c" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">由 TestFlight 发布的应用程序将自动使用<strong class="kc io"> <em class="mp">生产沙箱</em> </strong>环境。所有测试步骤将与开发沙盒环境保持一致。</p><p id="7920" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">生产试验</p><p id="c6da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于一个尚未在 App Store 上发布的应用程序，获得该应用程序的早期版本是测试订阅的一个很好的方式。</p><h1 id="e858" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">投产前生产测试</h1><ol class=""><li id="9e99" class="ky kz in kc b kd mk kh ml kl mw kp mx kt my kx ld le lf lg bi translated">为此，你需要将该应用的测试版提交给苹果审查。不要忘记将<em class="mp">版本发布</em>设置为<em class="mp">手动发布。</em></li><li id="8968" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">从 iTunesConnect 生成应用程序的促销代码。</li><li id="0896" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用促销代码，从 App Store 下载应用程序。</li><li id="7473" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">订阅您的订阅。由于该应用程序得到了苹果公司的批准(尽管尚未发布)，它仍将与 live 应用程序一样运行。</li></ol><h1 id="0f06" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">沙盒可靠性</h1><p id="3a95" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">众所周知，开发者沙盒是不可靠的。出于某种原因，苹果从未修复它，或者它可能不知道不一致。无论哪种方式，如果不是一直有效，不要有压力。</p><h1 id="576d" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">重要提示</h1><ul class=""><li id="fb7a" class="ky kz in kc b kd mk kh ml kl mw kp mx kt my kx mz le lf lg bi translated">套餐最多可自动续订 6 次，到期后自动失效。用户无法更改此行为。</li><li id="5a8b" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mz le lf lg bi translated">在进行购买之前，沙盒环境中没有可用的购买收据。</li><li id="2d32" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mz le lf lg bi translated">测试人员在开发或生产沙盒环境中完成的购买不会被收费</li></ul><h1 id="4508" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考资料:</h1><p id="ae64" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated"><a class="ae jz" href="https://help.apple.com/app-store-connect/#/dev7e89e149d" rel="noopener ugc nofollow" target="_blank">测试订阅购买量</a></p><p id="b57b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://developer.apple.com/documentation/storekit/in-app_purchase/testing_at_all_stages_of_development_with_xcode_and_sandbox" rel="noopener ugc nofollow" target="_blank">使用 Xcode 和沙盒测试订阅</a></p></div></div>    
</body>
</html>