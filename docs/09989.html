<html>
<head>
<title>Build a Slack App with Serverless in a Few Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用无服务器在几分钟内构建一个 Slack 应用程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/build-a-slack-app-with-serverless-in-a-few-minutes-9f0ca44d9a80?source=collection_archive---------8-----------------------#2022-09-27">https://blog.devgenius.io/build-a-slack-app-with-serverless-in-a-few-minutes-9f0ca44d9a80?source=collection_archive---------8-----------------------#2022-09-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0f27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Slack 是学习如何使用事件驱动的后端“无服务器”应用程序的好方法。当您使用无服务器时，您只需通过应用程序为每秒需要处理的事件数量付费，而不是启动服务器并等待这些事件。</p><p id="962e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然 Lolo 的工作方式有点不同，但她遵循这个概念，所以在你必须每秒处理几千个以上的事件之前，你不会付出任何代价。这是非常划算的。</p><p id="2109" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将构建一个 HTTP 回调函数，作为我们的 Webhook，由 Slack 通过它们的 Slash 命令触发。这个想法是让你做一些更复杂的事情，但这让你知道它有多简单。我们将打乒乓球。请看下面我们的工作流程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a32d1aa4d70254e549fd121694a99ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1ood5-rwfUCFPE6G-bDWw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">这些节点中的代码仅仅是自定义的 Node.js，除了 Lolo 为其用户预先构建的 HTTP 触发器。</figcaption></figure><p id="c0fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">简单解释一下我们的 Lolo 工作流程。</p><ol class=""><li id="8a5b" class="ky kz in jm b jn jo jr js jv la jz lb kd lc kh ld le lf lg bi translated">我们首先在菜单面板中添加一个 HTTP 触发器，它将作为我们的 Webhook。</li><li id="8582" class="ky kz in jm b jn lh jr li jv lj jz lk kd ll kh ld le lf lg bi translated">然后，我们将在响应节点中发回一个状态代码为 200 的响应。这是为了确保我们迅速向 Slack 发回确认。</li><li id="b6b0" class="ky kz in jm b jn lh jr li jv lj jz lk kd ll kh ld le lf lg bi translated">最后，我们将发送一个 HTTP post 请求，其中包含从收到的有效负载中提取的 response_url。</li></ol><p id="3a69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果将是 Slack 中的一个<strong class="jm io"> /ping </strong>斜线命令将以<strong class="jm io"> pong 响应。</strong></p><p id="ce7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你需要一个 Slack 工作空间的管理员权限来设置你的 Slack 应用，然后是一个免费的 Lolo <a class="ae lm" href="https://developer.lolo.company/" rel="noopener ugc nofollow" target="_blank">账户。</a></p><h1 id="a719" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">设置您的 Lolo 应用程序和 Webhook</h1><p id="938d" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们需要 Slack 的请求 URL，这样当有人使用命令/ping 时，Slack 可以向我们发送一个事件。因此，我们将首先设置我们的<a class="ae lm" href="https://developer.lolo.company/" rel="noopener ugc nofollow" target="_blank"> Lolo 应用</a>。</p><p id="5a0c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 Lolo 中创建新的应用程序，并在菜单面板中添加 HTTP 触发器。一旦它出现在您的图表中，请双击它，以便您可以配置它。</p><p id="1772" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将通过<strong class="jm io">参数</strong>选项卡将其设置为 POST 请求，并将端点设置为<strong class="jm io"> /slack </strong>。您也可以将该节点重命名为 Slack Webhook，但这是可选的。设置路径后，复制为您设置的外部 URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/1bac068c5eb38faf83db6d27c50ca24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6h_Dbmer_YVQxZAgKZcUzA.gif"/></div></div></figure><p id="2c81" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在已经设置了触发这个应用程序的触发器。您可以保存您的应用程序，但还不需要运行它。</p><h1 id="3f59" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">设置你的 Slack 应用</h1><p id="d60e" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">通过<a class="ae lm" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank">api.slack.com</a>设置新应用。你想怎么叫都行。您将需要对要安装它的 Slack 工作区的管理员访问权限。</p><p id="b7e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建应用程序后，进入<strong class="jm io">斜杠命令</strong>，在那里你将设置一个新命令。使用你刚刚从 Lolo 应用程序中复制的 URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/5382523204bab9062e1a39bf3b30f9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xBLErCbXS7YRMW9FkWntOQ.gif"/></div></div></figure><p id="e338" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">记住也要将应用程序安装到您的工作区。导航到<strong class="jm io">基本设置</strong>让你的 Slack 应用程序这样做。每当您添加斜杠命令时，您都需要将应用程序重新安装到您的工作区。</p><h1 id="7c8c" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">响应 HTTP 调用</h1><p id="8377" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">Slack 命令期望在 3 秒内得到响应，所以当对您的 URL 进行 HTTP 调用时，要做的第一件事是在 Lolo 应用程序中发出一个带有 200 状态代码的响应。</p><p id="aa4e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Slack 将向我们发送带有有效负载对象的数据，我们可以用它来响应。也就是说，我们不直接响应斜杠命令，我们只提取 response_url，以便稍后可以通过 POST 请求发送回对消息的响应。这也允许你在回答之前做更多的处理。</p><p id="4b00" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，在 Lolo 应用程序中创建一个新函数，并将下面的代码添加到它的处理程序中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="3e48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过像处理 route(ev.body)一样将 Slack 有效负载数据路由到下一个函数，我们可以在下一个节点/函数中提取 response_url。这个 Slack 应用程序只做两件事，所以我们不需要从有效负载中提取太多，但是当你构建更丰富的 Slack 应用程序时，你会想要提取更多关于命令的信息，而不仅仅是 response_url，因此我们将路由整个有效负载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/bc39f14315b347357f620510d396de4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_x2ZrxsrxHughr_gFuJtzA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">创建一个新函数，更改它的代码，将它连接到 Slack Webhook HTTP 触发器。</figcaption></figure><p id="0751" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">记住还要将 HTTP 触发器与您创建的新函数连接起来。需要连接到这些节点，以使代码能够在 exports.handler 中运行。</p><p id="364a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">保存</strong>和<strong class="jm io">运行</strong>你的应用程序。</p><p id="b3d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你已经将应用程序安装到你的 Slack 工作区，你现在可以测试你在 Slack 中设置的命令。它不会给你任何反馈，但只要它没有给你一个错误，你就知道它在工作。</p><h1 id="3618" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">向时差发送回复</h1><p id="1326" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们需要做的最后一件事是使用 response_url 向 Slack 发回一个 HTTP POST 请求，并附上我们对命令的回答。因此，我们可以看到对/ping 命令的 pong 响应。</p><p id="21d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 Lolo 图中创建另一个新函数，并添加下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="5cda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要添加<strong class="jm io"> node-fetch@2.0 </strong>作为依赖项，以便能够在我们的代码中使用它。在 Lolo 中导航到应用程序的<strong class="jm io">设置</strong>中的<strong class="jm io">模块</strong>，并简单地将其添加到那里。它将在您保存并运行应用程序时安装。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/17d42c2c2b849e960eed30c4a88e190f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nV15zDgXBs0AOxf9AaFYdA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">创建一个新函数，更改它的代码，重命名它，添加 node-fetch@2.0 作为依赖项，连接节点，然后保存并运行您的应用程序。</figcaption></figure><p id="ee5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">总而言之，如果您已经添加了新的函数，在它的处理程序中添加了上面的代码，在您的模块中添加了<strong class="jm io"> node-fetch@2.0 </strong>并连接了所有的节点，您就可以<strong class="jm io">保存</strong>并<strong class="jm io">再次运行</strong>您的应用程序。</p><p id="8bf4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，现在部署可能需要一分钟，因为我们已经安装了依赖项。在日志中查找<strong class="jm io">监听端口 4000 </strong>以查看它是否已成功部署。你可以来回换标签，我们都这样。</p><h1 id="cc8a" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">测试你的 Slack 应用</h1><p id="0d21" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">打开你的松弛，然后再次尝试你的斜线命令。我已经设置了/ping，我的响应将是 pong。看看下面这个是什么样子的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/f5fe1e4cff2d21cb1bb4db7bfe7b9832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Knmg-L0LFUCuGIT0QkqayQ.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 Lolo 中查找 listen port 4000 以查看您的应用程序是否已成功部署。然后在 Slack 中测试你的 slash 命令。</figcaption></figure><p id="f009" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里，您可以在消息中使用 Slack 操作，然后在用户与有效负载事件交互时从有效负载事件中提取值，从而向它添加内容。请参阅 slack 的块套件生成器，以获取有关创建 Slack 消息的帮助。</p><h1 id="a1d2" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">Youtube 视频教程</h1><p id="b3b0" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">如果你想通过视频教程学习，请查看下面的视频。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt ms l"/></div></figure><p id="af38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">❤️·洛洛</p></div></div>    
</body>
</html>