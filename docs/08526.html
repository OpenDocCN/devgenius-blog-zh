<html>
<head>
<title>Unlock the Power of mDNS: Understanding and Implementing the Technology for DevOps, Robotics, and IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放 mDNS 的力量:理解和实施开发运维、机器人和物联网技术</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mdns-and-why-should-you-care-c8c947403322?source=collection_archive---------5-----------------------#2022-06-22">https://blog.devgenius.io/mdns-and-why-should-you-care-c8c947403322?source=collection_archive---------5-----------------------#2022-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="47da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论你是 DevOps 工程师，从事机器人工作，还是管理物联网设备，mDNS 都是游戏规则的改变者。它已经存在了一段时间，但许多专业人士仍然不了解它的全部潜力。在这篇文章中，我将向你展示它是多么容易设置，以及它如何能把你的网络技能提高到一个新的水平。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2c3c12d3f753bb5d1bb9875dc61bdcaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-09iuNgeeQ3FYzVfTc4cKQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由来自<a class="ae lb" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的 Brett Sayles 拍摄</figcaption></figure><h1 id="4bd9" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">多播域名系统== mDNS</h1><p id="2b7d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们首先打破神话——<strong class="jp ir"/>代表<a class="ae lb" href="https://en.wikipedia.org/wiki/Multicast_DNS" rel="noopener ugc nofollow" target="_blank">多播 DNS </a>(域名系统)，它是一种<strong class="jp ir">协议，在不包括本地名称服务器的小型网络内将主机名解析为 IP 地址。</strong>在<strong class="jp ir">一群</strong>技术娴熟的人群中，你会经常听到这是一种<a class="ae lb" href="https://en.wikipedia.org/wiki/Zero-configuration_networking#Name_service_discovery" rel="noopener ugc nofollow" target="_blank">零配置</a>服务。因此，如果你以前使用过 DNS，这可能会让你大吃一惊，但是你实际上并不需要一个 DNS 来解析本地网络上的主机名。但是怎么做呢？</p><p id="8dbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于新手来说，我还是想强调一下<strong class="jp ir">为什么一开始就要费心在 IP 和主机名之间进行转换呢？</strong>基本上，我不知道有谁喜欢记住一个 32 位的数字(IPv4)或 128 位的数字(IPv6 ),而不是一个像<em class="mf"> myserver 这样简单的名字。</em>也许有一个，他可以跳过这篇文章:)换句话说，当你 SSH 或 ping 你的本地服务器时，你会喜欢做这样的事情吗:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="99ee" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ping leonardo.local</strong></span></pre><p id="8f31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="971a" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ssh ubuntu@leonardo.local</strong></span></pre><p id="37be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而不是:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="875a" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ping 192.168.1.12</strong></span></pre><p id="3c74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="0077" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ssh ubuntu@192.168.1.12</strong></span></pre><p id="c117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有一个静态 IP 的设备，记住它可能不是这样一个问题，但是想象一下你正在你的房子周围运行一群 Raspberry Pis 或物联网设备——你真的能够记住它们吗？</p><p id="3a88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，对于你们中已经了解 SSH 的一些人来说，是的，有一个简单的解决方案，只需简单地配置<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">~/.ssh/config</em></strong></code>，但这只是客户端配置，而 mDNS 也可以作为服务器端配置，我们将在后面看到。</p><p id="e0f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Linux 中，有几种方法可以配置主机名解析，但是让我来告诉您为什么以及何时最好的选择是使用 mDNS。</p><h1 id="aef9" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">/etc/hosts 文件</h1><p id="06bc" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">配置您的分辨率的最明显和最简单的方法是将网络上每个主机的条目添加到<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">/etc/hosts</em></strong></code>文件中。给你一个例子——你可以为这篇文章这样配置它，一切都会工作:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="cea9" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">127.0.0.1 localhost</strong><br/><strong class="mh ir">127.0.1.1 mypchostname</strong></span><span id="84e4" class="ml ld iq mh b gy mt mn l mo mp"><strong class="mh ir">192.168.1.10 leonardo</strong><br/><strong class="mh ir">192.168.1.11 mickey</strong><br/><strong class="mh ir">192.168.1.12 donatello</strong><br/><strong class="mh ir">192.168.1.13 rafael</strong></span></pre><p id="27e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以当我使用<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">leonardo</em></strong></code>关键字时，在这个文件中的查找会将它翻译成<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">192.168.1.10</em></strong></code>。很简单，但是这种方法有什么问题吗？</p><p id="11f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这只是一个<strong class="jp ir">客户端配置</strong>，所以解析只能在这个<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">/etc/hosts</em></strong></code>文件所在的设备上工作，而不能在<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">leonardo</em></strong></code>上工作。除此之外，我个人不喜欢它，因为你必须<strong class="jp ir">手动更新文件</strong>并且在有许多设备加入和离开的网络上——那个任务只是乏味的。此外，由于 DHCP，每台设备的 IP 会随着时间的推移而改变，但确实可以通过在服务器上设置静态 IP 来缓解这种情况，这也是一种静态配置。</p><h1 id="65de" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在路由器上配置 DNS 表</h1><p id="6bb3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">其他选择是在路由器本身上配置 DNS 表，但是<strong class="jp ir">不是所有用户都可以访问路由器配置</strong>，尤其是当你在总部或研究实验室中做这件事的时候。如果每个人都可以自由访问路由器，您可能需要与您的网络管理员沟通，因为任何人都可以更改其配置并影响整个本地网络。</p><p id="35d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人难过的是，大多数人仍然不会费心去配置<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">/etc/hosts</em></strong></code>，但我对自己说:<em class="mf">“好吧，肯定有更好的方法来做这件事”。</em>还有就是！</p><h1 id="10ee" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">mDNS 的优雅解决方案</strong></h1><p id="3768" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">它是如何工作的？一位智者曾经说过:<em class="mf">“一图胜千言”</em>。从<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">mypchostname</em></strong></code> <em class="mf"> </em>开始，向本地网络上的所有设备广播查询(红线)。然后<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">leonardo</em></strong></code>做出响应(绿线)并将其广播给网络的其他部分。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/8ac0829edece9de9be47a841391e1473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2TNGlZNt9w10-jKaj1vqnw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">mDNS 程序</figcaption></figure><p id="93cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，<strong class="jp ir">红线</strong>表示一个<strong class="jp ir"> </strong> <a class="ae lb" href="https://en.wikipedia.org/wiki/IP_multicast" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> IP 多播</strong> </a> <strong class="jp ir">查询</strong>消息，该消息要求具有该名称的主机识别其自身。<strong class="jp ir">绿线</strong>代表<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">leonardo</em></strong></code><strong class="jp ir"/><strong class="jp ir">响应</strong><strong class="jp ir"/>组播包含其 IP 地址的消息，因此，该子网中的其他机器可以使用该信息更新其 mDNS 缓存(并且不需要后续调用<em class="mf"/><code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">leonardo</em></strong></code><em class="mf">是谁】</em>)。因此，当机器需要解析名称时，它会检查其 mDNS 缓存，如果主机名的 IP 不可用，它会在映像上执行该过程。</p><p id="147a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，<strong class="jp ir">没有必要使用路由器或交换机来连接设备，只要两台设备之间有网络连接，mDNS 也可以使用接入点(AP) </strong>。我提到 AP 是因为我曾经很好地利用了它。</p><p id="f5d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">长话短说，我在用户连接到其 AP 的机器人上设置了一个 mDNS。因此，用户可以使用以下方式<em class="mf">开箱即用</em>连接到我的机器人:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="f1a0" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ssh ubuntu@mybestrobotintheworld.local</strong></span></pre><p id="1dbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而不是:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="0096" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ssh ubuntu@10.42.0.1</strong></span></pre><p id="050e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">听起来更酷，对吧？</p><p id="4e78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">说得够多了，我们怎样才能做到呢？这就像安装和运行服务一样简单。首先，安装:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="254d" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">sudo apt install libnss-mdns avahi-daemon avahi-utils</strong></span></pre><p id="92e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后确保以下两项服务都处于活动状态:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="c10c" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">sudo service systemd-resolved status</strong><br/><strong class="mh ir">sudo service avahi-daemon status</strong></span></pre><p id="1e55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。您可以继续尝试 ping 您的机器。就我而言:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="782e" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">ping mickey.local</strong></span></pre><h1 id="29bf" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">网络管理器配置</h1><p id="4e67" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我必须提到，如果你正在使用<a class="ae lb" href="https://ubuntu.com/core/docs/networkmanager" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">网络管理器</strong> </a>网络服务，有一些额外的配置，以使 mDNS 工作。您需要通过取消注释并更改为以下内容来启用 mDNS:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="9d69" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">MulticastDNS=yes</strong></span></pre><p id="2174" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">/etc/systemd/resolved.conf</em></strong></code>T35。同样，你需要追加到<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">/etc/NetworkManager/conf.d/mdns.conf</em></strong></code>:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="2cd6" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">[connection]</strong><br/><strong class="mh ir">connection.mdns=2</strong></span></pre><p id="09e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到更多关于这个配置<a class="ae lb" href="https://developer-old.gnome.org/NetworkManager/stable/settings-connection.html" rel="noopener ugc nofollow" target="_blank">(搜索<code class="fe mq mr ms mh b"><strong class="jp ir"><em class="mf">mdns</em></strong></code>)。为了应用配置，请重新启动服务:</a></p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="ee6a" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">sudo service NetworkManager restart</strong><br/><strong class="mh ir">sudo service systemd-resolved restart</strong></span></pre><h1 id="db04" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="11f2" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">告别 mDNS 管理 IP 和主机名转换的头痛问题。只需几个简单的步骤，您就可以毫不费力地将主机名解析为本地网络中的 IP 地址。不再为本地域名服务器或复杂的配置而烦恼。就这么简单！最棒的是。您终于可以告别管理 IP 和主机名转换的繁琐任务了。</p><blockquote class="mv"><p id="eb90" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">感谢阅读！😎如果你喜欢这篇文章，点击下面的按钮👏</p><p id="0f39" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">对我来说意义重大，也有助于其他人了解这个故事。在<a class="ae lb" href="https://www.linkedin.com/in/teodor-janez-podobnik/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a> | <a class="ae lb" href="https://twitter.com/TeodorJanez" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上打招呼</p><p id="fd50" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">要不要开始读 Medium 上的独家故事？使用此<a class="ae lb" href="https://medium.com/@tp4348/membership" rel="noopener">推荐链接</a>🔗</p><p id="8807" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">如果你喜欢我的帖子，你可以<a class="ae lb" href="https://www.buymeacoffee.com/tp4348" rel="noopener ugc nofollow" target="_blank">给我买一个热狗</a>🌭</p><p id="d389" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">你是一个热情的工程师，但缺乏能力来编写引人注目和鼓舞人心的技术内容吗？雇用我做🛠️的升级工作</p><p id="72f7" class="mw mx iq bd my mz na nb nc nd ne kk dk translated">在 Teodor J. Podobnik，@dorkamotorka 上查看我的其他内容，并关注我的更多内容，干杯！</p></blockquote></div></div>    
</body>
</html>