<html>
<head>
<title>Linux — ss command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux — ss 命令</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/linux-ss-command-5b510c1bf58e?source=collection_archive---------4-----------------------#2022-09-04">https://blog.devgenius.io/linux-ss-command-5b510c1bf58e?source=collection_archive---------4-----------------------#2022-09-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="ef35" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">为什么你应该开始学习党卫军命令</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/e3ed7a058b400f421757b7056bd790f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6_cn69NanAWu9l0jSEl5g.png"/></div></div></figure><h1 id="1caf" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">ss 简介</h1><p id="bd21" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated"><code class="fe mg mh mi mj b">ss</code> commands 代表 socket statistics，是一个用来调查网络套接字的工具。<code class="fe mg mh mi mj b">ss</code>包含在<code class="fe mg mh mi mj b">iproute2</code>包中，是<code class="fe mg mh mi mj b">netstat</code>命令的替代品。</p><p id="eb34" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated"><code class="fe mg mh mi mj b">ss</code>命令行实用程序可以显示数据包、TCP、UDP、DCCP、原始和 Unix 域套接字的统计数据。使用<code class="fe mg mh mi mj b">ss</code>，您可以获得关于您的 Linux 服务器如何与其他机器、网络和服务通信的非常详细的信息；关于网络连接、网络协议统计和 Linux 套接字连接的详细信息。有了这些信息，您可以更容易地解决各种网络问题。</p><p id="93f3" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated">与通常的<code class="fe mg mh mi mj b">netstat</code>命令相比，<code class="fe mg mh mi mj b">ss</code>比<code class="fe mg mh mi mj b">netstat</code>更快更有效。你可能会问为什么？让我们从他们从哪里得到信息开始。</p><h1 id="2f55" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">netstat 和 procfs</h1><p id="304b" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated"><code class="fe mg mh mi mj b">procfs</code>是一种特殊的文件系统，Linux 以一种类似文件的分层结构呈现进程、网络和其他系统信息，提供了一种比传统的跟踪方法或直接访问内核内存更方便和标准化的方法来动态访问内核中保存的进程数据。</p><p id="e3cd" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated"><code class="fe mg mh mi mj b">procfs</code>位于<code class="fe mg mh mi mj b">/proc</code>中，它在<code class="fe mg mh mi mj b">/proc/net/tcp</code>和<code class="fe mg mh mi mj b">/proc/net/udp</code>处公开 TCP 和 UDP 套接字的信息。</p><p id="5911" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated"><code class="fe mg mh mi mj b">netstat</code>直接从<code class="fe mg mh mi mj b">/proc/net</code>获取信息。它分析文件并根据它打印出信息。</p><h1 id="7bb8" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">Netlink 和 ss</h1><p id="fca7" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated"><code class="fe mg mh mi mj b">Netlink</code>是一个 Linux 内核接口，用于内核和用户空间进程之间以及不同用户空间进程之间的进程间通信(IPC ),其方式类似于 Unix 域套接字。</p><p id="9fe7" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated"><code class="fe mg mh mi mj b">ss</code>是最近编写的，以使用<code class="fe mg mh mi mj b">Netlink</code> API(如果 netlink 不可用，则返回到<code class="fe mg mh mi mj b">/proc/net</code>)。</p><h1 id="30a8" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">netstat vs ss</h1><p id="e5a2" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated">所以如果你把<code class="fe mg mh mi mj b">netstat</code>和<code class="fe mg mh mi mj b">ss</code>比较一下:</p><ul class=""><li id="5485" class="mp mq ir lm b ln mk lq ml lt mr lx ms mb mt mf mu mv mw mx bi translated"><code class="fe mg mh mi mj b">ss</code>更快，因为它直接从内核获取数据，但是，我没有发现<code class="fe mg mh mi mj b">netstat</code>明显更慢。</li><li id="2671" class="mp mq ir lm b ln my lq mz lt na lx nb mb nc mf mu mv mw mx bi translated">Netlink 暴露了更多的 TCP 状态，所以<code class="fe mg mh mi mj b">ss</code>命令可以让你得到更多的信息</li><li id="dc4e" class="mp mq ir lm b ln my lq mz lt na lx nb mb nc mf mu mv mw mx bi translated">它有更好的默认参数</li></ul><p id="6e2e" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated">同样，这些都不是一个巨大的全垒打，但因为<code class="fe mg mh mi mj b">ss</code>是新一代，可以提供<code class="fe mg mh mi mj b">netstat</code>所做的信息(并且打字更少！)，开始使用<code class="fe mg mh mi mj b">ss</code>是个好主意。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj nd"><img src="../Images/79b812e982232cef59523f6bdb69667d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2Phpm_-jJxHYxNXoRPJa-A.png"/></div><figcaption class="ne nf gk gi gj ng nh bd b be z dk translated">图片来自<a class="ae ni" href="https://docs.google.com/spreadsheets/d/1_iZPZv6j2LqDA2TynvhKPGlRNBuaVcb6_hXfNhdPRzE/edit#gid=136146772" rel="noopener ugc nofollow" target="_blank"> netstat vs ss </a></figcaption></figure><h1 id="1842" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated"><strong class="ak">常用 ss 命令</strong></h1><h2 id="c62f" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated"><strong class="ak">显示插座的简要信息</strong></h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="bddc" class="nj kt ir mj b gz nz oa l ob oc"># ss -s<br/>Total: 122 (kernel 139)<br/>TCP:   4 (estab 2, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 3</span><span id="c8c6" class="nj kt ir mj b gz od oa l ob oc">Transport Total     IP        IPv6<br/>*         139       -         -        <br/>RAW       0         0         0        <br/>UDP       6         6         0        <br/>TCP       4         4         0        <br/>INET      10        10        0        <br/>FRAG      0         0         0  </span></pre><h2 id="d34f" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated"><strong class="ak">列出当前监听端口</strong></h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="ac08" class="nj kt ir mj b gz nz oa l ob oc"># ss -l<br/>State      Recv-Q Send-Q                                           Local Address:Port                                               Peer Address:Port   <br/>LISTEN     0      128                                                          *:ssh                                                           *:*       <br/>LISTEN     0      100                                                  127.0.0.1:smtp </span></pre><h2 id="dd32" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated"><strong class="ak">列出监听端口和相应的进程</strong></h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="56f0" class="nj kt ir mj b gz nz oa l ob oc"># ss -pl<br/>State      Recv-Q Send-Q                                     Local Address:Port                                         Peer Address:Port   <br/>LISTEN     0      128                                                    *:ssh                                                     *:*        users:(("sshd",1821,3))<br/>LISTEN     0      100                                            127.0.0.1:smtp </span></pre><h2 id="6cfb" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated"><strong class="ak">列出所有 tcp 套接字</strong></h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="f507" class="nj kt ir mj b gz nz oa l ob oc"># ss -at<br/>State      Recv-Q Send-Q                                     Local Address:Port                                         Peer Address:Port   <br/>LISTEN     0      128                                                    *:ssh                                                     *:*       <br/>LISTEN     0      100                                            127.0.0.1:smtp                                                    *:*       <br/>ESTAB      0      196                                         172.16.2.106:ssh                                        124.65.173.246:50809   <br/>ESTAB      0      0                                           172.16.2.106:60382    </span></pre><h2 id="037d" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">列出所有 udp 套接字</h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="3957" class="nj kt ir mj b gz nz oa l ob oc">$ ss -au<br/>State      Recv-Q Send-Q                                     Local Address:Port                                         Peer Address:Port   <br/>UNCONN     0      0                                                      *:bootpc                                                  *:*       <br/>UNCONN     0      0                                                      *:bootpc                                                  *:*       <br/>UNCONN     0      0                                           172.16.2.107:ntp                                                     *:*       <br/>UNCONN     0      0                                           172.16.2.106:ntp                                                     *:*       <br/>UNCONN     0      0                                              127.0.0.1:ntp                                                     *:*       <br/>UNCONN     0      0                                                      *:ntp </span></pre><h2 id="4dc3" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">列出所有 http 连接</h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="284b" class="nj kt ir mj b gz nz oa l ob oc"># ss -o state established '( dport = :http or sport = :http )'</span></pre><h2 id="5821" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated"><code class="fe mg mh mi mj b">ss</code>的常用状态</h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="c484" class="nj kt ir mj b gz nz oa l ob oc">1. established<br/>2. syn-sent<br/>3. syn-recv<br/>4. fin-wait-1<br/>5. fin-wait-2<br/>6. time-wait<br/>7. closed<br/>8. close-wait<br/>9. last-ack<br/>10. listen<br/>11. closing<br/>12. all : All of the above states<br/>13. connected : All the states except for listen and closed<br/>14. synchronized : All the connected states except for syn-sent<br/>15. bucket : Show states, which are maintained as minisockets, i.e. time-wait and syn-recv.<br/>16. big : Opposite to bucket state.</span></pre><h2 id="2e72" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">IP 地址过滤</h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="b811" class="nj kt ir mj b gz nz oa l ob oc"># ss src ADDRESS_PATTERN<br/># ss src 120.33.131.1 ==&gt; List connections from 120.33.131.1</span><span id="2237" class="nj kt ir mj b gz od oa l ob oc"># ss src 120.33.131.1:http ==&gt; List http connections from IP<br/># ss src 120.33.131.1:80</span></pre><h2 id="6d20" class="nj kt ir bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">端口过滤</h2><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="9586" class="nj kt ir mj b gz nz oa l ob oc"># ss dport OP PORT<br/>OP: Operator<br/>dport: Destination port</span><span id="d700" class="nj kt ir mj b gz od oa l ob oc">Operators are:<br/>1. &lt;= or le : Less than or equal to port<br/>2. &gt;= or ge : Greater than or equal to port<br/>3. == or eq : Equal to port<br/>4. != or ne : Not equal to port<br/>5. &lt; or gt : Less than to port<br/>6. &gt; or lt : Greater than to port<br/>7. Note: le, gt, eq, ne etc. are use in unix shell and are accepted as well.</span></pre><p id="2f8f" class="pw-post-body-paragraph lk ll ir lm b ln mk js lp lq ml jv ls lt mm lv lw lx mn lz ma mb mo md me mf ik bi translated">示例:</p><pre class="kh ki kj kk gu nv mj nw nx aw ny bi"><span id="aa23" class="nj kt ir mj b gz nz oa l ob oc"># ss sport = :http 也可以是 ss sport = :80<br/># ss dport = :http<br/># ss dport \&gt; :1024<br/># ss sport \&gt; :1024<br/># ss sport \&lt; :32000<br/># ss sport eq :22<br/># ss dport != :22<br/># ss state connected sport = :http<br/># ss \( sport = :http or sport = :https \)<br/># ss -o state fin-wait-1 \( sport = :http or sport = :https \) dst 192.168.1/24</span></pre></div></div>    
</body>
</html>