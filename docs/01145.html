<html>
<head>
<title>Java Stream API — int, long and double operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java 流 API — int、long 和 double 操作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/java-stream-api-int-double-and-long-operations-e1743ce2d77a?source=collection_archive---------7-----------------------#2020-06-25">https://blog.devgenius.io/java-stream-api-int-double-and-long-operations-e1743ce2d77a?source=collection_archive---------7-----------------------#2020-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2c821e35cf19d5d499f4a638b088d227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*esfEJ9dwHOyCf7l2j6OpWg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://www.pexels.com/@nick-bondarev?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">艺术工作室</a>从<a class="ae kc" href="https://www.pexels.com/photo/rocky-shore-of-mountain-river-in-fog-4337894/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>拍摄</figcaption></figure><p id="faf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您必须对一个对象流中的整数值求和，您会考虑一些选项，比如利用<code class="fe lb lc ld le b">reduce</code>流函数。或者…最广为人知的一个:遍历所有对象，用值的运行总和保存一个变量</p><p id="f409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">Stream</code> API 提供了一种非常简单的方法来计算总和，寻找最小值或最大值，并计算对象流的平均值。</p><p id="e6f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据您的数字数据类型(<code class="fe lb lc ld le b">int</code>、<code class="fe lb lc ld le b">double</code>或<code class="fe lb lc ld le b">long</code>)，您可能需要使用<code class="fe lb lc ld le b">IntStream</code>、<code class="fe lb lc ld le b">DoubleStream</code>或<code class="fe lb lc ld le b">LongStream</code>。鉴于三种不同数据类型的一切都非常相似，我将只关注<code class="fe lb lc ld le b">IntStream</code>类。</p><p id="53e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据 Java 的文档，一个<code class="fe lb lc ld le b">IntStream</code>被定义为</p><blockquote class="lf lg lh"><p id="0a94" class="kd ke li kf b kg kh ki kj kk kl km kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">支持顺序和并行聚合操作的原始整数值元素序列。这是 Stream 的 int 原语专门化。</p></blockquote><h2 id="723d" class="lm ln iq bd lo lp lq dn lr ls lt dp lu ko lv lw lx ks ly lz ma kw mb mc md me bi translated">如何构建 IntStream？</h2><p id="dfda" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">你有两种方法来构建一个<code class="fe lb lc ld le b">IntStream</code>。您可以使用 IntStream 中的 builder 方法构建一个<code class="fe lb lc ld le b">IntStream</code></p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="1f9e" class="lm ln iq le b gy ms mt l mu mv">IntStream<br/>    .builder()<br/>    .add(1)<br/>    .add(3)<br/>    .build();</span></pre><p id="2b14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还可以通过使用一个现有的流来构建一个新的<code class="fe lb lc ld le b">IntStream</code>，并将其映射到一个<code class="fe lb lc ld le b">IntStream</code>。您可以通过调用<code class="fe lb lc ld le b">mapToInt</code>函数来实现这一点。</p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="1dbe" class="lm ln iq le b gy ms mt l mu mv">IntStream intStream = cars<br/>  .stream()<br/>  .mapToInt(car -&gt; car.getNumberOfSeats());</span></pre><p id="0de8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您要使用<code class="fe lb lc ld le b">DoubleStream</code>或<code class="fe lb lc ld le b">LongStream</code>，方法将是<code class="fe lb lc ld le b">mapToDouble</code>和<code class="fe lb lc ld le b">mapToLong</code>。</p><h2 id="ea72" class="lm ln iq bd lo lp lq dn lr ls lt dp lu ko lv lw lx ks ly lz ma kw mb mc md me bi translated">我能用 IntStream 做什么？</h2><p id="a406" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">一旦你构建了一个<code class="fe lb lc ld le b">IntStream</code>，你可以选择调用这些方法中的一个:<br/>1-sum<br/>2-min<br/>3-max<br/>4-average<br/>5-count</p><p id="956c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些名字不言自明。这些方法允许您添加、获取最小值、获取最大值、计算平均值或计算流中元素的数量。</p><p id="a5f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您需要获得一个流中所有整数的平均值，您可以很容易地这样做:</p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="82a4" class="lm ln iq le b gy ms mt l mu mv">cars<br/>    .stream()<br/>    .mapToInt(car -&gt; car.getNumberOfSeats())<br/>    .average();</span></pre><p id="df90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样做的一个很大的好处是，它现在简化了您执行此操作的编码，并且在幕后，它处理了您很容易忽略的一些小事，例如在计算空流的平均值时处理被零除的情况。</p><p id="117a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要指出的是，<code class="fe lb lc ld le b">average</code>方法不会返回一个<code class="fe lb lc ld le b">double</code>，它会返回一个<code class="fe lb lc ld le b">OptionalDouble</code>类型的对象。<code class="fe lb lc ld le b">OptionalDouble</code>类提供了一个类似于<code class="fe lb lc ld le b">Optional</code>类的接口。</p><p id="a118" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果要提取平均值结果的值，需要调用<code class="fe lb lc ld le b">getAsDouble()</code>方法。唯一的问题是，如果数据流是空的，没有平均值，会发生什么？您的代码可能会抛出异常。</p><p id="1d1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个简单的替代方法可能是在可选对象上调用<code class="fe lb lc ld le b">isPresent()</code>方法，如果返回 true，则调用<code class="fe lb lc ld le b">getAsDouble()</code>。</p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="19eb" class="lm ln iq le b gy ms mt l mu mv">OptionalDouble optionalAverage = Stream<br/>        .<em class="li">of</em>(1, 2, 3)<br/>        .mapToInt(car -&gt; car)<br/>        .average();</span><span id="82b3" class="lm ln iq le b gy mw mt l mu mv">if (optionalAverage.isPresent()) {<br/>    double average = optionalAverage.getAsDouble();<br/>}</span></pre><p id="0949" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在您可能已经发现，并不是所有的其他方法都会返回一个<code class="fe lb lc ld le b">int</code>。让我们快速回顾一下他们所有的返回类型</p><p id="63f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1 - sum —返回一个<code class="fe lb lc ld le b">int</code>。如果没有元素将返回零。<br/> 2 分钟—返回一个<code class="fe lb lc ld le b">OptionalInt</code>。首先使用<code class="fe lb lc ld le b">isPresent()</code>验证，然后调用<code class="fe lb lc ld le b">getAsInt()</code>。<br/> 3 分钟—返回一个<code class="fe lb lc ld le b">OptionalInt</code>。首先使用<code class="fe lb lc ld le b">isPresent()</code>验证，然后调用<code class="fe lb lc ld le b">getAsInt()</code>。<br/> 4 -平均值—返回一个<code class="fe lb lc ld le b">OptionalDouble</code>。首先使用<code class="fe lb lc ld le b">isPresent()</code>验证，然后调用<code class="fe lb lc ld le b">getAsDouble()</code>。<br/> 5 -计数—返回一个<code class="fe lb lc ld le b">long</code>。</p><h2 id="f068" class="lm ln iq bd lo lp lq dn lr ls lt dp lu ko lv lw lx ks ly lz ma kw mb mc md me bi translated">汇总统计数据</h2><p id="d21a" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">一旦你构建了一个<code class="fe lb lc ld le b">IntStream</code>，你现在可以获取一个<code class="fe lb lc ld le b">IntSummaryStatistics</code>类型的对象。这个对象可以让你访问总和、最小值、最大值、计数和平均值。</p><p id="a966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能会问，当您可以通过<code class="fe lb lc ld le b">IntStream</code>类直接获取所有这些信息时，这样做有什么好处。当将<code class="fe lb lc ld le b">IntSummaryStatistics</code>类与其他数据的汇总统计数据相结合时，它的一个好处就体现出来了。</p><p id="cb35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过这个例子来评估一下，我们最初有两个列表，一个叫做<code class="fe lb lc ld le b">suvs</code>，另一个叫做<code class="fe lb lc ld le b">sedans</code>。我们将基于这些对象的属性<code class="fe lb lc ld le b">numberOfSeats</code>的值将二者映射到一个<code class="fe lb lc ld le b">IntStream</code>。</p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="1daf" class="lm ln iq le b gy ms mt l mu mv">IntSummaryStatistics statisticsForSUVs = suvs.stream()<br/>    .mapToInt(x -&gt; x.getNumberOfSeats())<br/>    .summaryStatistics();</span><span id="331e" class="lm ln iq le b gy mw mt l mu mv">IntSummaryStatistics statisticsForSedans = sedans.stream()<br/>    .mapToInt(x -&gt; x.getNumberOfSeats())<br/>    .summaryStatistics();</span></pre><p id="996b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们完成这些之后，你现在可以用最少的努力组合这两个<code class="fe lb lc ld le b">IntSummaryStatistics</code>的结果，并得到这些结果的组合统计数据。</p><p id="c7c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过现在调用<code class="fe lb lc ld le b">combine</code>方法，它会将两个统计数据合并成一个，并自动为您计算所有这些统计数据。您现在的平均值是综合统计值，最小值、最大值、总和以及计数也是如此。</p><pre class="mk ml mm mn gt mo le mp mq aw mr bi"><span id="151b" class="lm ln iq le b gy ms mt l mu mv">statisticsForSedans.combine(statisticsForSUVs);</span></pre><p id="0f36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望在阅读完这篇文章之后，您能够更好地理解如何利用 Stream API 对数字流执行数学运算。</p><p id="d925" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p></div></div>    
</body>
</html>