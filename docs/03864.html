<html>
<head>
<title>Vuex 4 — Dynamic Module Registration and Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vuex 4 —动态模块注册和记录</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/vuex-4-dynamic-module-registration-and-logging-60db113a5bb3?source=collection_archive---------2-----------------------#2020-12-27">https://blog.devgenius.io/vuex-4-dynamic-module-registration-and-logging-60db113a5bb3?source=collection_archive---------2-----------------------#2020-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/353ce08a51f5efa5eefa767bfc0caa95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9ezTzDJekgIp7Gkt"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@angro?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Antonio Grosz </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a611" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vuex 4 处于测试阶段，可能会有变化。</p><p id="15d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vuex 是一个流行的 Vue 状态管理库。</p><p id="a15e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vuex 4 是专为 Vue 3 设计的版本。</p><p id="5bb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何将 Vuex 4 与 Vue 3 配合使用。</p><h1 id="456c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">动态模块注册</h1><p id="3559" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在用<code class="fe me mf mg mh b">store.registerModule</code>方法创建存储之后注册模块。</p><p id="6fba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3219" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vuex@4.0.0-beta.4/dist/vuex.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button @click="increment"&gt;increment&lt;/button&gt;<br/>      &lt;p&gt;{{doubleCount}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const moduleA = {<br/>        state: () =&gt; ({<br/>          count: 0<br/>        }),<br/>        mutations: {<br/>          increment(state) {<br/>            state.count++;<br/>          }<br/>        },<br/>        getters: {<br/>          doubleCount(state) {<br/>            return state.count * 2;<br/>          }<br/>        }<br/>      };</span><span id="e765" class="mq lc iq mh b gy mv ms l mt mu">      const store = new Vuex.Store({});</span><span id="5980" class="mq lc iq mh b gy mv ms l mt mu">      store.registerModule("moduleA", moduleA);<br/>      const app = Vue.createApp({<br/>        methods: {<br/>          ...Vuex.mapMutations(["increment"])<br/>        },<br/>        computed: {<br/>          ...Vuex.mapGetters(["doubleCount"])<br/>        }<br/>      });<br/>      app.use(store);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="4f45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用我们的模块名和对象调用了<code class="fe me mf mg mh b">store.registerModule</code>方法来注册模块。</p><p id="b54b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以像其他模块一样在我们的组件中使用它。</p><h1 id="1303" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">插件</h1><p id="1534" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在商店里创建和使用插件。</p><p id="6bcb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们只需创建一个接受<code class="fe me mf mg mh b">store</code>参数的函数，并在函数中对其进行处理</p><p id="1320" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5a62" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vuex@4.0.0-beta.4/dist/vuex.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button @click="increment"&gt;increment&lt;/button&gt;<br/>      &lt;p&gt;{{doubleCount}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const myPlugin = (store) =&gt; {<br/>        store.subscribe((mutation, state) =&gt; {<br/>          console.log(state);<br/>        });<br/>      };</span><span id="258c" class="mq lc iq mh b gy mv ms l mt mu">      const store = new Vuex.Store({<br/>        state: () =&gt; ({<br/>          count: 0<br/>        }),<br/>        mutations: {<br/>          increment(state) {<br/>            state.count++;<br/>          }<br/>        },<br/>        getters: {<br/>          doubleCount(state) {<br/>            return state.count * 2;<br/>          }<br/>        },<br/>        plugins: [myPlugin]<br/>      });</span><span id="1472" class="mq lc iq mh b gy mv ms l mt mu">      const app = Vue.createApp({<br/>        methods: {<br/>          ...Vuex.mapMutations(["increment"])<br/>        },<br/>        computed: {<br/>          ...Vuex.mapGetters(["doubleCount"])<br/>        }<br/>      });<br/>      app.use(store);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="1186" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用带有<code class="fe me mf mg mh b">mutation</code>和<code class="fe me mf mg mh b">state</code>参数的回调函数调用了<code class="fe me mf mg mh b">subscribe</code>。</p><p id="c966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">mutation</code>有正在提交的变异数据。</p><p id="db93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">state</code>有商店的当前状态。</p><h1 id="7f0a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">内置记录器插件</h1><p id="a9e3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Vuex 4 提供了一个日志插件。</p><p id="5518" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，我们调用<code class="fe me mf mg mh b">createLogger</code>函数。</p><p id="73eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f661" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vuex@4.0.0-beta.4/dist/vuex.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button @click="increment"&gt;increment&lt;/button&gt;<br/>      &lt;p&gt;{{doubleCount}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const store = new Vuex.Store({<br/>        state: () =&gt; ({<br/>          count: 0<br/>        }),<br/>        mutations: {<br/>          increment(state) {<br/>            state.count++;<br/>          }<br/>        },<br/>        getters: {<br/>          doubleCount(state) {<br/>            return state.count * 2;<br/>          }<br/>        },<br/>        plugins: [Vuex.createLogger()]<br/>      });</span><span id="66b4" class="mq lc iq mh b gy mv ms l mt mu">      const app = Vue.createApp({<br/>        methods: {<br/>          ...Vuex.mapMutations(["increment"])<br/>        },<br/>        computed: {<br/>          ...Vuex.mapGetters(["doubleCount"])<br/>        }<br/>      });<br/>      app.use(store);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5fdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">去使用它。</p><p id="64d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用了<code class="fe me mf mg mh b">Vuex.createLogger</code>方法来返回登录的插件，并将其传递给<code class="fe me mf mg mh b">plugins</code>数组。</p><p id="0e0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该方法接受一个具有一些属性的对象，我们可以将这些属性用作选项。</p><p id="0991" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们是各种过滤器。</p><p id="ed82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cda0" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/vuex@4.0.0-beta.4/dist/vuex.global.js"&gt;&lt;/script&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button @click="increment"&gt;increment&lt;/button&gt;<br/>      &lt;p&gt;{{doubleCount}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const store = new Vuex.Store({<br/>        state: () =&gt; ({<br/>          count: 0<br/>        }),<br/>        mutations: {<br/>          increment(state) {<br/>            state.count++;<br/>          }<br/>        },<br/>        getters: {<br/>          doubleCount(state) {<br/>            return state.count * 2;<br/>          }<br/>        },<br/>        plugins: [<br/>          Vuex.createLogger({<br/>            collapsed: false,<br/>            filter(mutation, stateBefore, stateAfter) {<br/>              return mutation.type !== "foo";<br/>            },<br/>            actionFilter(action, state) {<br/>              return action.type !== "foo";<br/>            },<br/>            transformer(state) {<br/>              return state.subTree;<br/>            },<br/>            mutationTransformer(mutation) {<br/>              return mutation.type;<br/>            },<br/>            actionTransformer(action) {<br/>              return action.type;<br/>            },<br/>            logActions: true,<br/>            logMutations: true,<br/>            logger: console<br/>          })<br/>        ]<br/>      });</span><span id="7009" class="mq lc iq mh b gy mv ms l mt mu">      const app = Vue.createApp({<br/>        methods: {<br/>          ...Vuex.mapMutations(["increment"])<br/>        },<br/>        computed: {<br/>          ...Vuex.mapGetters(["doubleCount"])<br/>        }<br/>      });<br/>      app.use(store);<br/>      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="f5bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来设定动作。</p><p id="24e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">filter</code>让我们过滤要记录的突变或状态。</p><p id="da44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">actionFilter</code>让我们根据动作或状态属性过滤动作。</p><p id="c87f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">transformer</code>让我们转换日志输出。</p><p id="9ddc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">mutationTransformer</code>让我们转换突变日志输出。</p><p id="21c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">actionTransformer</code>让我们转换我们的操作日志输出。</p><p id="8199" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">logActions</code>是一个布尔值，如果它是<code class="fe me mf mg mh b">true</code>的话，让我们记录动作。</p><p id="ab9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">logMutations</code>如果是<code class="fe me mf mg mh b">true</code>，让我们记录突变。</p><p id="4f91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">logger</code>让我们设置想要用来记录日志的记录器。</p><h1 id="5c2d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="896c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以动态注册 Vuex 4 商店模块。</p><p id="a58f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，Vuex 4 自带记录器。</p></div></div>    
</body>
</html>