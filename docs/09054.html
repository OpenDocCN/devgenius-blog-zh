<html>
<head>
<title>Hedging long only portfolios using Structural Entropy.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用结构熵对冲只做多投资组合。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/hedging-long-only-portfolios-using-structural-entropy-e53d71330370?source=collection_archive---------1-----------------------#2022-07-27">https://blog.devgenius.io/hedging-long-only-portfolios-using-structural-entropy-e53d71330370?source=collection_archive---------1-----------------------#2022-07-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><h1 id="ed33" class="jr js in bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">简介</strong></h1><p id="235c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">本文旨在使用扩展版本的结构熵指标，评估/证明在 Russell 2000(我使用 IWM 交易所交易基金，因为我没有滚动的未来价格)中使用空头头寸对冲仅做多的美国股票投资组合的有效性。</p><p id="3a82" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我第一次读到结构熵是在这篇<a class="ae ls" href="https://www.nature.com/articles/s41598-019-47210-8" rel="noopener ugc nofollow" target="_blank">文章</a>中。作者将金融市场视为一个复杂的相互关联的网络(以资产为节点、相关性为边的图形)，并定义/描述了一种称为“结构熵”的新度量。这使他们能够识别金融市场中的传染时刻(当风险在资产间传播时)，并显示他们采用这一措施的不同结果。</p><p id="d526" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">这个想法是，当市场在压力事件中下跌时(比如 2008 年或 2020 年的 COVID)，资产之间的相关性会增加。</p><p id="58e0" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">一篇解释结构熵并简化 Python 实现的中型文章是<a class="ae ls" href="https://towardsdatascience.com/entropy-application-in-the-stock-market-b211914ed1f3" rel="noopener" target="_blank">这里</a>。</p><p id="b8e8" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">我们能否识别这些下跌趋势或风险时期，以有效对冲仅做多的投资组合？我们能预测市场的传染吗？</p><p id="cafe" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">为了进行评估，本文使用 S&amp;P500 的买入并持有(或多头头寸)(使用 SPY ETF)，计算 S&amp;P500 成份股的结构熵，并使用该结构熵度量来决定何时用 Russell 2000 (IWM ETF)的空头头寸对冲 SPY ETF 的多头头寸。</p><h1 id="8c21" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">获取历史价格</h1><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="d711" class="mh js in md b gy mi mj l mk ml">import pandas as pd<br/>import numpy as np<br/>import yfinance as yf<br/>import matplotlib.pyplot as plt<br/>from tqdm import tqdm</span></pre><p id="dbc9" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">在这个实验中有幸存者偏差，因为我们使用最新的 SP500 组件。理想情况下，我们应该使用 SP500 不断变化的成分，但金融数据何时可以免费获得？</p><p id="5f8b" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">为了避免下载所有 S&amp;P500 成份股的数据，我们使用一个本地 zip 文件(之前创建的),其中包含所有这些股票的历史价格。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="e6a3" class="mh js in md b gy mi mj l mk ml">data = pd.read_csv("spy_component_prices.zip", index_col=0,<br/>                    parse_dates=True, infer_datetime_format=True, <br/>                    header=0).sort_index()</span></pre><p id="aaab" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">由于我们在退货空间工作，价格被转换成对数退货。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="0880" class="mh js in md b gy mi mj l mk ml">returns = data.pct_change().fillna(0).apply(np.log1p)</span></pre><p id="a8c1" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">然后我们下载 22 年的间谍和 IWM 价格，并将它们转换成回报(不是对数回报，因为我们用它来进行回溯测试)。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="cf41" class="mh js in md b gy mi mj l mk ml">spy = yf.download(“SPY”, start=”2000–01–01", <br/>                   end=”2022–06–10")[‘Adj Close’]<br/>spy.name = “SPY”<br/>spy_returns = spy.pct_change().dropna()</span><span id="33aa" class="mh js in md b gy mm mj l mk ml">iwm = yf.download("IWM", start="2000-01-01", <br/>                    end="2022-05-20")['Adj Close']<br/>iwm_returns = iwm.pct_change().dropna()</span></pre><h1 id="d959" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">结构熵</h1><p id="19dd" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">在这里，我们每天使用历史数据在滚动窗口的基础上计算结构熵。它使用 0.6 的相关性阈值来确定两只股票之间是否存在优势，并使用该阈值来计算结构熵。使用随机矩阵理论来避免这种阈值的更好的技术目前不在范围之内。</p><p id="54ac" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">结构熵指标被归一化为范围(0，1)。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="9260" class="mh js in md b gy mi mj l mk ml">def cov2corr( A ):<br/> d = np.sqrt(A.diagonal())<br/> A = ((A.T/d).T)/d<br/> return A</span><span id="b34e" class="mh js in md b gy mm mj l mk ml">from scipy.sparse.csgraph import connected_components<br/>import scipy as sp<br/>from sklearn.covariance import EmpiricalCovariance as EC</span><span id="566f" class="mh js in md b gy mm mj l mk ml">def structural_entropy(df, lags):<br/> entropy_df = pd.DataFrame(index=df.index)<br/>     for i in tqdm(range(max(lags), df.shape[0])):<br/>         for lag in lags:<br/>             X = df.iloc[i-lag:i+1] # i+1 because it is exclusive<br/>             C = cov2corr(EC().fit(X.loc[:, <br/>                   (X != 0).any(axis=0)].values).covariance_)<br/>             C = (np.abs(C)&gt;0.6).astype(int)<br/>             _, labels = connected_components(C)<br/>             counts = np.unique(labels, return_counts=True)[1]<br/>             probs = counts / np.sum(counts)<br/>             if len(counts) &gt; 1:<br/>                 e = sp.stats.entropy(probs) / np.log(len(counts))<br/>             else:<br/>                 e = 0.0<br/> <br/> entropy_df.loc[df.index[i], str(lag)] = e<br/> return entropy_df</span></pre><p id="c2be" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">由于相关性是对定义的窗口长度的依赖性的静态测量，我们试图计算范围从 120 天到 60 天的不同窗口大小的结构熵。</p><p id="e4a9" class="pw-post-body-paragraph kp kq in kr b ks ln ku kv kw lo ky kz la lp lc ld le lq lg lh li lr lk ll lm ig bi translated">下面一行被注释掉，因为它需要一些时间来计算所有窗口大小在 22 年中每天的滚动结构熵度量。相反，我们使用一个预先计算的文件，其中包含每天和窗口大小的度量。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="1d7a" class="mh js in md b gy mi mj l mk ml">#entropy_df = structural_entropy(data, lags=[120, 110, 105, 100, 95,<br/>                                        90, 85, 80, 75, 70, 65, 60])<br/>entropy_df = pd.read_csv('entropy.zip', header=0, <br/>                         index_col=0, parse_dates=True).dropna()</span></pre><h2 id="e725" class="mh js in bd jt mn mo dn jx mp mq dp kb la mr ms kf le mt mu kj li mv mw kn mx bi translated">下面我们绘制了窗口长度为 120 和窗口长度为 60 的归一化结构熵，用于比较。</h2><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi my"><img src="../Images/de91bbcbeaca6e81f59d10aa625524e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nj_suFtZtBXPHw5-8Pr9cw.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">熵 120 天窗口</figcaption></figure><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi my"><img src="../Images/016f525fcee637ae13ff32a5a3c8e49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amgJirurkNhDHEuDo_rAmw.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">熵 60 天窗口</figcaption></figure><h1 id="bc72" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">熵截面</h1><p id="f25c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">观察到窗口长度 120 上的熵比窗口 60 上的熵移动得慢。因此，我们相信我们可以尝试捕捉熵的趋势，从而获得不同窗口长度的差异，并计算该横截面差异的平均值及其标准偏差。请记住，这是一个横截面差异，即在给定的一天，每个窗口大小的熵的差异。</p><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nk"><img src="../Images/2f199f97d24cc5c062e9ffe1d5a3353f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8EE-nnKDuZJDmUw2oi3LYw.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">截面熵一阶差均值</figcaption></figure><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nl"><img src="../Images/ceb65ff71a89f8b9dd056e77e03a2aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckuviDjqTs2rhtpZH8DxJg.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">截面熵一阶差分标准差</figcaption></figure><h1 id="7e11" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">小波去噪信号</h1><p id="f6fc" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">上面的图显示信号噪声很大，我们希望对这些信号进行降噪处理。在各种平滑技术中，本文选择了小波技术对这些信号进行去噪处理。</p><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nk"><img src="../Images/006d0145650d1f72364ea61107884944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpwScNimcYQui3JQ9YlYyg.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">去噪横截面平均值</figcaption></figure><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nl"><img src="../Images/ab12c6d3fa3b7a785b7e57d08a8fff53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbP5RfGpjKZayzdiDJ4jSw.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">去噪横截面标准偏差</figcaption></figure><h1 id="e204" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">交易策略</h1><p id="6998" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">我们将上述去噪信号转换成 z 分数，它们是我们第二天的交易信号。去噪后的均值用于识别进场信号或何时开始对冲，去噪后的标准差是出场信号(何时停止对冲)。</p><h1 id="eb38" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">朗·S&amp;P500(间谍)——与拉塞尔·赫奇(IWM)</h1><p id="860c" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">在下一节中，我们复制一个长期只买并持有的间谍位置。然后，我们使用上述信号来确定我们可以用短 IWM 对冲的时期，并绘制长间谍头寸和基于熵的间谍与 IWM 头寸对冲的损益曲线。</p><figure class="ly lz ma mb gt mz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/72d9cb23edf22c04d4243b0fdf671090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*ieBSRzmER7KuvxQZhgPkcA.png"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">多头 SPY 和对冲 SPY 损益的比较</figcaption></figure><h1 id="9a5b" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">结论</h1><p id="63c3" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">这种方法似乎有一些优点。进一步的实验可以尝试:</p><ol class=""><li id="dce6" class="nn no in kr b ks ln kw lo la np le nq li nr lm ns nt nu nv bi translated">选择不同的投资组合，而不是间谍。</li><li id="a0ea" class="nn no in kr b ks nw kw nx la ny le nz li oa lm ns nt nu nv bi translated">选择不同的对冲工具，而不是罗素 2000。</li><li id="d2a1" class="nn no in kr b ks nw kw nx la ny le nz li oa lm ns nt nu nv bi translated">按行业将投资组合分解成子投资组合，并尝试按行业 ETF 对冲每个子投资组合。</li><li id="90ac" class="nn no in kr b ks nw kw nx la ny le nz li oa lm ns nt nu nv bi translated">使用随机矩阵理论计算结构熵，而不是相关临界值(例如 0.6)。</li><li id="062b" class="nn no in kr b ks nw kw nx la ny le nz li oa lm ns nt nu nv bi translated">探索其他去噪技术。</li></ol><h1 id="a8a6" class="jr js in bd jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko bi translated">源代码和数据</h1><p id="effd" class="pw-post-body-paragraph kp kq in kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ig bi translated">github:<a class="ae ls" href="https://github.com/satyapravin/StructuralEntropy" rel="noopener ugc nofollow" target="_blank">https://github.com/satyapravin/StructuralEntropy</a></p></div></div>    
</body>
</html>