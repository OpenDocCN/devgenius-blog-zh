<html>
<head>
<title>Advanced Router Configuration In Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular中的高级路由器配置</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/advanced-router-configuration-in-angular-d22c6dc420be?source=collection_archive---------1-----------------------#2020-10-19">https://blog.devgenius.io/advanced-router-configuration-in-angular-d22c6dc420be?source=collection_archive---------1-----------------------#2020-10-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c139cca154ec0fbad90000e7165dcc15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6Ncuw6vkV6zHasYp"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><strong class="bd jz">由</strong> <a class="ae ka" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank"> <strong class="bd jz">马库斯·斯皮斯克</strong> </a>从Unsplash中编码图像</figcaption></figure><p id="040d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们所有人都将路由作为一个或另一个应用程序的一部分，以允许用户通过路由从一个页面导航到另一个页面。Angular附带了一个默认的解决方案，称为<strong class="kd io"> RouterModule </strong>，用于在应用中实现路由。</p><p id="5b09" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> RouterModule </strong>使用和添加到您的应用程序中非常简单。在最简单的方法中，它只是在应用程序的模块中导入您想要的路线及其各自的组件。例如:-</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="acb8" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">因此，我们在应用程序模块导入中使用了路由器模块，并给了它一个路由数组，现在，考虑到您在应用程序组件模板中有路由器出口标签，您的路由可用于到达这些组件。但是我们也看到了使用<strong class="kd io">作为根</strong>方法，所以让我们通过<strong class="kd io"> RouterModule </strong>的接口来看看<strong class="kd io"> RouterModule </strong>可用的不同方法。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="c660" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">所以只有两种方法可用，即Root和forChild。从定义中我们可以看到，forRoot接受两个参数，即routes和一个可选的配置对象，而forChild只接受routes。</p><blockquote class="lf lg lh"><p id="13cf" class="kb kc li kd b ke kf kg kh ki kj kk kl lj kn ko kp lk kr ks kt ll kv kw kx ky ig bi translated">forRoot通常用在应用程序的根模块中，因为它注册了提供者/指令/路由器服务等。RouterModule需要。</p><p id="8b37" class="kb kc li kd b ke kf kg kh ki kj kk kl lj kn ko kp lk kr ks kt ll kv kw kx ky ig bi translated">forChild用于为其他模块(如惰性加载模块)定义路由。唯一的区别是它没有重新注册路由器服务。</p></blockquote><p id="f18c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我们这里要讨论的是forRoot方法中的第二个config对象。因为它允许我们通过我们可能想要使用的路线实现各种事情。所以让我们先看看它的接口，即ExtraOptions。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="8d3b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这些我们一个一个来讨论吧。</p><ol class=""><li id="54ba" class="lm ln in kd b ke kf ki kj km lo kq lp ku lq ky lr ls lt lu bi translated"><strong class="kd io">启用跟踪</strong></li></ol><p id="56aa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">当此标志为真时，angular会将所有内部导航事件记录到控制台，如路由器何时激活、导航何时开始、导航何时结束等。当面临路由配置问题时，这对于调试非常有用。</p><p id="2f35" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 2。使用哈希</strong></p><p id="6239" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这个标志在非常特殊的情况下会有所帮助。让我们来看一个场景，您在tomcat服务器上部署了一个angular应用程序。您的角度应用程序中有一条路线，即/仪表盘。现在你在浏览器中点击<strong class="kd io">www.abc.com/dashboard</strong>。在这种情况下，浏览器转到服务器，服务器开始检查此URL并返回404(未找到),因为此URL在服务器上不存在，因为这是一条角度路由。因此有两种方法来解决这个问题，即:-配置您的服务器在这些情况下返回index.html或使用<strong class="kd io"> useHash </strong>策略。</p><p id="1449" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">www.abc.com/#/dashboard<strong class="kd io">使用哈希</strong>做的是你的网址现在会变成<strong class="kd io"/>。现在，当你点击URL时，浏览器不会发送散列后的URL，现在你会得到<strong class="kd io">index.html</strong>的服务，angular会处理仪表板路线。但是在这种情况下，配置服务器是更好的方法。因为#也用于<strong class="kd io">定位滚动</strong>，我们将在下一点中讨论。</p><p id="3d82" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 3。锚点滚动</strong></p><p id="918d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">当设置为“启用”时，当URL有片段时，滚动到定位元素。默认情况下，锁定滚动是禁用的。也就是说，当你点击仪表板路径时，页面将被移动以聚焦这个锚定标签，无论它在页面上的位置在哪里。你一定遇到过这样的网页，所有的内容都在同一个页面上，但是通过URL它们会把你带到特定的部分。通过这种技术，你可以达到同样的角度。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="cb10" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 4。初始导航</strong></p><p id="f5ba" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">当设置为<code class="fe lv lw lx ly b">enabled</code>时，初始导航在根组件创建之前开始。在初始导航完成之前，引导会被阻止。该值是服务器端呈现工作所必需的。当设置为<code class="fe lv lw lx ly b">disabled</code>时，不执行初始导航。位置侦听器是在创建根组件之前设置的。</p><p id="2b5a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在大多数应用程序中，这是不需要的，除非由于复杂的情况，需要对导航进行更多的控制。</p><p id="6966" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 5。错误处理器</strong></p><p id="8a68" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">ErrorHandler是我们在应用程序中实现的一个类，用于全局处理错误。一种方法是使用一个处理程序并检查其中的错误类型，然后用您想要实现的任何行为来相应地处理它。但是，假设您希望路由器有一个单独的错误处理程序，只处理特定于路由器的错误，这样您就可以有一个错误处理程序的实现类，并将其传递给error handler属性，如下所示。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="42cc" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 6。预加载策略</strong></p><p id="0470" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果您想在用户导航到route之前预加载惰性加载的模块，预加载策略基本上有助于配置策略。角度提供器内置两种策略，即<strong class="kd io">预加载所有模块</strong>或<strong class="kd io">不预加载</strong>(默认)。您可以找到用于制定自定义预加载策略的文章数量，并将其传递给该属性。</p><p id="8720" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">7。onsameurlnaviation</p><p id="b0aa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">尝试一件事，尝试通过router.navigate导航到当前激活angular应用程序中相同url。您将看到angular忽略了这一点，并且没有重新激活该路由。这是因为这个属性的默认值为<strong class="kd io">忽略</strong>，如果你把它的值作为<strong class="kd io">重载</strong>传递，那么这个行为将会改变，你的路线将被重新激活。</p><p id="58bf" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 8。滚动位置恢复</strong></p><p id="b85f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">假设用户在某个页面上时处于某个滚动位置，然后他导航到其他页面。现在，他按下浏览器中的后退按钮，您希望滚动位置与他离开的位置相同。一种方法是自己写代码。但是angular给了我们这个属性来配置它。它接受以下值。</p><ul class=""><li id="b5f3" class="lm ln in kd b ke kf ki kj km lo kq lp ku lq ky lz ls lt lu bi translated">' disabled'-(默认值)不执行任何操作。导航时保持滚动位置。</li><li id="1ddb" class="lm ln in kd b ke ma ki mb km mc kq md ku me ky lz ls lt lu bi translated">' top'-在所有导航中将滚动位置设置为x = 0，y = 0。</li><li id="e88a" class="lm ln in kd b ke ma ki mb km mc kq md ku me ky lz ls lt lu bi translated">' enabled'-在向后导航时恢复上一个滚动位置，否则将位置设置为锚点(如果提供了锚点)，或者将滚动位置设置为[0，0](向前导航)。该选项将成为未来的默认选项。</li></ul><p id="cd18" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">您还可以自定义滚动恢复行为，这可以在官方文档中找到。</p><p id="cd9a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 9。scrollOffset </strong></p><p id="7574" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">配置滚动到元素时路由器将使用的滚动偏移量。</p><p id="e008" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">当给定一个具有x和y位置值的元组时，路由器每次滚动时都使用该偏移量。当给定一个函数时，路由器每次恢复滚动位置时都会调用该函数。</p><p id="2060" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 10。paramsInheritanceStrategy </strong></p><p id="73a0" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">定义路由器如何将参数、数据和解析的数据从父路由合并到子路由。默认情况下(' emptyOnly ')，仅继承无路径或无元件布线的父参数。设置为“始终”以启用父参数的无条件继承。</p><p id="9819" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 11。malformedUriErrorHandler </strong></p><p id="da21" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">比方说，如果用户在url中输入了无效的字符序列，导致encodeURI失败，那么您希望实现特定的行为。Angular有一个默认行为，即路由到根URL并释放所有参数。您可以将函数传递给此属性，以实现覆盖默认行为的自定义行为。该函数将接收三个参数，即</p><ul class=""><li id="dffb" class="lm ln in kd b ke kf ki kj km lo kq lp ku lq ky lz ls lt lu bi translated">URIError -解析错误的URL时引发的错误。</li><li id="eaab" class="lm ln in kd b ke ma ki mb km mc kq md ku me ky lz ls lt lu bi translated">UrlSerializer -使用路由器配置的UrlSerializer。</li><li id="751a" class="lm ln in kd b ke ma ki mb km mc kq md ku me ky lz ls lt lu bi translated">url -导致URIError的格式错误的url</li></ul><p id="3f4c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在你的功能的基础上，这三个参数你可以执行各种活动，以达到预期的行为。</p><p id="c9b7" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> 12。urlUpdateStrategy </strong></p><p id="d1e6" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">定义路由器何时更新浏览器URL。默认情况下(“延迟”)，导航成功后更新。如果希望在导航开始时更新URL，请设置为“急切”。尽早更新URL允许您通过显示包含失败URL的错误消息来处理导航失败。</p><p id="eb2d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">13。相对分辨率</p><p id="323f" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">启用一个错误修复程序，该程序更正了路径为空的组件中的相对链接解析。示例:</p><p id="6d6d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">假设您有这样的路由配置:-</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="e920" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在在你的<strong class="kd io"> HomeComponent </strong>模板中，你有了下面的锚标签</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="4daa" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这将不起作用，因为此字段的默认值是支持向后兼容性的传统值。在legacy中，要使它工作，你必须使用如下所示的锚标记。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="8c62" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">启用修复并像<strong class="kd io">一样使用它。/ </strong>而不是<strong class="kd io">../ </strong>您可以将此选项的值设为“已更正”来启用修复。</p><blockquote class="lf lg lh"><p id="989f" class="kb kc li kd b ke kf kg kh ki kj kk kl lj kn ko kp lk kr ks kt ll kv kw kx ky ig bi translated">这些选项允许我们处理任何web应用程序中可能遇到的大多数常见场景。如果我们不了解它们，我们可能最终会编写一个自定义的实现，这就像重新发明轮子一样。因此，了解它们是非常重要的，并为你在Angular方面的专业知识再添一根羽毛。</p></blockquote><p id="a236" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">希望这对您有所帮助，并希望您在使用这些选项的应用中取得更大的成就。</p></div></div>    
</body>
</html>