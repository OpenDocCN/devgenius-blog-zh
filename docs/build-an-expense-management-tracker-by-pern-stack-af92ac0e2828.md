# é€šè¿‡ PERN stack å»ºç«‹ä¸€ä¸ªè´¹ç”¨ç®¡ç†è·Ÿè¸ªå™¨

> åŸæ–‡ï¼š<https://blog.devgenius.io/build-an-expense-management-tracker-by-pern-stack-af92ac0e2828?source=collection_archive---------6----------------------->

![](img/80d6f9ec70023a99a49c0dad759e0b21.png)

æœ¬æ–‡ç»™å‡ºäº†ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ PERN (PostgreSQLï¼ŒExpressï¼ŒReactï¼ŒNode)æ ˆæ„å»º web åº”ç”¨ç¨‹åºçš„ä¾‹å­ã€‚å®ƒä½¿ç”¨è´¹ç”¨ç®¡ç†è·Ÿè¸ªå™¨æ¥è§£é‡Šæ¯ä¸€æ­¥ã€‚Postman å¯ä»¥ç”¨æ¥æµ‹è¯• Restful APIsã€‚CSS æ–‡ä»¶ç•™ç»™æ‚¨æ¥å®ç°ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚æ·»åŠ ç±»åˆ«ï¼Œæ˜¾ç¤ºä¸åŒç±»åˆ«çš„è´¹ç”¨å›¾è¡¨ï¼Œæ˜¾ç¤ºä¸åŒæ—¶æœŸçš„è´¹ç”¨ç­‰ã€‚

# è®¡ç®—æœºç½‘ç»œæœåŠ¡å™¨

åˆ›å»ºä¸€ä¸ªåŒ…å«å‰ç«¯å’Œåç«¯æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚æˆ‘åªæ˜¯ç»™å®ƒèµ·äº†ä¸ªåå­—å«â€œæŒ¥é‡‘å¦‚åœŸâ€ã€‚åœ¨â€œspendbookâ€æ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºåç«¯éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªåä¸ºâ€œserverâ€çš„æ–°æ–‡ä»¶å¤¹ã€‚æ‰“å¼€ç»ˆç«¯å¹¶æŒ‡å‘â€œæœåŠ¡å™¨â€æ–‡ä»¶å¤¹ã€‚ç„¶åä½¿ç”¨é»˜è®¤è®¾ç½®è¿è¡Œ`npm init -y`ã€‚

æˆ‘åªæ˜¯å‡è®¾æ‚¨å·²ç»å®‰è£…äº† PostgreSQLï¼Œå¹¶ä¸”è®°å¾—æ‚¨çš„å¯†ç ã€‚å¦‚æœä½ é—®æˆ‘å¯†ç å¿˜è®°äº†æ€ä¹ˆåŠï¼Œå¥½å§ï¼Œç½‘ä¸Šæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘åªæ˜¯é‡æ–°å®‰è£…äº†å®ƒã€‚ğŸ¤£

è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª PostgreSQL æ•°æ®åº“å’Œä¸€ä¸ªè¡¨ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ`psql -U postgres`ï¼Œè¾“å…¥å¯†ç ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªåä¸º pern_transactions çš„æ•°æ®åº“ç”±`CREATE DATABASE pern_transactions;`ä¹Ÿï¼Œæˆ‘æƒ³ä¸ºå¼€å‘åˆ›å»ºä¸€ä¸ªç”¨æˆ·æµ‹è¯•ã€‚æ‰€ä»¥è¿è¡Œ`CREATE USER test WITH PASSWORD â€˜passwordâ€™;`æˆäºˆç”¨æˆ·æµ‹è¯•æƒé™å¾ˆé‡è¦ã€‚`GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO test; GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO test;`å¦‚æœä½ åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæ¨¡å¼ä¼šæ›´å¥½ï¼Œä½†æˆ‘åªæ˜¯ä¸ºè¿™ä¸ªæ¼”ç¤ºæ‡’æƒ°ã€‚ğŸ˜ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸º transactions çš„è¡¨

```
CREATE TABLE transactions(trans_id SERIAL PRIMARY KEY,item VARCHAR,price DOUBLE PRECISION,record_time DATE);
```

è¿˜éœ€è¦ä¸€äº› npm åº“ï¼Œæ‰€ä»¥è¿è¡Œ`npm i express pg cors`ã€‚"`Express`æ˜¯ä¸€ä¸ªæœ€å°ä¸”çµæ´»çš„ Node.js web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œä¸º web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ç»„å¥å£®çš„ç‰¹æ€§"[1]ã€‚å½“æˆ‘ç”¨ Node.js ç¼–å†™åç«¯ä»£ç æ—¶ï¼Œå®ƒæ˜¯æˆ‘çš„æ•‘å‘½ç¨»è‰ã€‚`[pg](https://node-postgres.com/)`åº“ç”± [Brian C](https://github.com/brianc) ç»´æŠ¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå°† Node.js è¿æ¥åˆ° PostgreSQLã€‚`Cors`ä¸€ä¸ª node.js åŒ…ï¼Œç”¨äºæä¾›ä¸€ä¸ª[Connect](http://www.senchalabs.org/connect/)/[Express](http://expressjs.com/)ä¸­é—´ä»¶ï¼Œè¯¥ä¸­é—´ä»¶å¯ç”¨äºä½¿ [CORS](http://en.wikipedia.org/wiki/Cross-origin_resource_sharing) å…·æœ‰å„ç§é€‰é¡¹ã€2ã€‘ã€‚ä¸è·¨æ¥æºèµ„æºå…±äº«ç›¸å…³çš„é—®é¢˜åœ¨å‰ç«¯å·¥ä½œé¢è¯•ä¸­å¾ˆå¸¸è§ã€‚ä½ å¯ä»¥æŸ¥çœ‹[è¿™é‡Œçš„](https://www.toptal.com/web/interview-questions)è·å¾—ä¸€ä¸ªç®€è¦çš„æƒ³æ³•ã€‚å¯¹äºå¼€å‘ï¼Œæˆ‘è¿˜ä½¿ç”¨`nodemon`æ¥â€œå½“æ£€æµ‹åˆ°ç›®å½•ä¸­çš„æ–‡ä»¶æ›´æ”¹æ—¶ï¼Œè‡ªåŠ¨é‡å¯èŠ‚ç‚¹åº”ç”¨ç¨‹åºâ€[3]ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹ç¼–å†™ Node.js ä»£ç äº†ã€‚ğŸˆ

é¦–å…ˆï¼Œåœ¨â€œæœåŠ¡å™¨â€æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªâ€œdb.jsâ€æ–‡ä»¶ã€‚è¿™é‡Œå°†ä½¿ç”¨æ•°æ®åº“å’Œè¡¨ä¿¡æ¯ã€‚

åˆ›å»ºä¸€ä¸ªâ€œindex.jsâ€æ–‡ä»¶ã€‚â€œrequireâ€åŒ…å«è¿™äº›åŒ…ï¼Œæˆ‘ä»¬ç”¨`const app = express()`å®ä¾‹åŒ– Expressã€‚å…³äºè¿™ä¸ªå‘½ä»¤çš„ä¸€äº›æœ‰è¶£çš„è®¨è®ºå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[ã€‚ç„¶åé€šè¿‡è°ƒç”¨`app.use(cors())`å¯ç”¨ CORSã€‚`app.use(express.json())`è¢«è°ƒç”¨æ¥è¯†åˆ« JSON æ ¼å¼çš„ä¼ å…¥è¯·æ±‚ã€‚ç¨åæˆ‘ä»¬å°†åœ¨æ³¨é‡Šè·¯å¾„ä¸‹å®ç°ä»£ç ã€‚](https://stackoverflow.com/questions/27599614/var-express-requireexpress-var-app-express-what-is-express-is-it#:~:text=%3D%3E%20Requires%20the%20Express%20module%20just,an%20object%20of%20a%20class.)

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ`nodemon index.js`åœ¨ç«¯å£ 5000 ä¸Šå¯åŠ¨æœåŠ¡å™¨ã€‚ç»ˆç«¯åº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„å†…å®¹ã€‚

![](img/985745d0fb4040c73a6b10efd151eca9.png)

åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘æƒ³ä¸¾ä¾‹è¯´æ˜å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œè·å–æ‰€æœ‰äº‹åŠ¡å’Œåˆ é™¤ä¸€ä¸ªäº‹åŠ¡ã€‚ä½ å¯ä»¥å°è¯•å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå·±æ›´æ–°ä¸€ä¸ªäº‹åŠ¡ã€‚

Post ç”¨äºå‘æ•°æ®åº“ä¸­æ·»åŠ æ–°æ•°æ®ã€‚æ³¨æ„`async`å’Œ`await`å…³é”®å­—ï¼Œå› ä¸º node.js æ­£åœ¨ä¸å¤–éƒ¨ PostgreSQL æ•°æ®åº“äº¤äº’ã€‚è§£æ„è¯·æ±‚ä½“ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨ SQL å‘½ä»¤é€šè¿‡`pool.query()`ä¸æ•°æ®åº“äº¤äº’ï¼Œå…¶ä¸­$1ã€$2 å’Œ$3 å¯¹åº”äº`[item, price, record_time]`ä¸­çš„å‚æ•°ã€‚`RETURNING *`ç”¨äºè·å–å…³äºç»“æœçš„æœ‰ç”¨ä¿¡æ¯ï¼Œç»“æœå¯ä»¥é€šè¿‡`res.json()`æ˜¾ç¤ºã€‚

ä½¿ç”¨ Postman æµ‹è¯• Restful API å¾ˆæ–¹ä¾¿ã€‚è¦åœ¨ Postman ä¸­å°†å½“å‰æ—¶é—´ä¼ é€’åˆ°è¯·æ±‚æ­£æ–‡ä¸­ï¼Œå¯ä»¥åœ¨â€œé¢„è¯·æ±‚è„šæœ¬â€ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :`**var** time = **new** Date(); postman.setEnvironmentVariable(â€œtimeâ€, time.toISOString());`

![](img/90a7b2537035f6c7203f286c687ce258.png)

è·å¾—æ‰€æœ‰äº¤æ˜“å¾ˆå®¹æ˜“ã€‚

è¦åˆ é™¤äº¤æ˜“ï¼Œéœ€è¦ç›¸åº”çš„ idã€‚æ‰€ä»¥åœ¨è·¯ç”±ä¸­ï¼Œå†™`:id`ï¼Œé€šè¿‡è§£æ„`req.params`å¾—åˆ° idã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å®Œæˆäº†åç«¯éƒ¨åˆ†ã€‚ğŸˆ

# å®¢æˆ·

é‡å®šå‘è‡³â€œspendbookâ€æ–‡ä»¶å¤¹å¹¶è¿è¡Œ`npx create-reate-app client`ã€‚ç›´æ¥è¿›å…¥å®¢æˆ·ç«¯æ–‡ä»¶å¤¹å¹¶è¿è¡Œ`npm i axios`ã€‚æˆ‘ä»¬ä¼šç”¨ axios å†™ Promiseã€‚åœ¨ src æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ é™¤ä¸€äº›æ–‡ä»¶å’Œç›¸å…³çš„å¯¼å…¥è¯­å¥ã€‚src æ–‡ä»¶å¤¹ä¸­åªä¼šç”¨åˆ°å››ä¸ªæ–‡ä»¶:index.cssï¼Œindex.jsï¼ŒApp.cssï¼ŒApp.jsã€‚

æ¸…ç† App.js æ–‡ä»¶ï¼Œå¯¼å…¥å¿…è¦çš„åŒ…ã€‚ç”¨`useState`åˆå§‹åŒ–`allTransactions`ã€`item` å’Œ`price` å‚æ•°åŠå…¶æ–¹æ³•ã€‚`item` å’Œ`price`ç”¨äºå¢åŠ æ–°äº¤æ˜“ã€‚ä½¿ç”¨ useEffect åœ¨ç¬¬ä¸€å±‚åŠ è½½é¡µé¢æ—¶æ¸²æŸ“é¡µé¢ï¼Œå¹¶é€šè¿‡æ£€æµ‹`allTransactions`çš„ä¾èµ–å…³ç³»çš„å˜åŒ–æ¥é‡æ–°æ¸²æŸ“é¡µé¢ã€‚

è®©æˆ‘ä»¬æ¥å®ç°`getAllTrans()`ã€‚æ¼”ç¤ºç°åœ¨æ˜¯æœ¬åœ°å¼€å‘çš„ï¼Œæ‰€ä»¥åŸºè·¯å¾„æ˜¯â€œhttp://localhostâ€ï¼Œåç«¯è¿è¡Œåœ¨ç«¯å£ 5000 ä¸Šã€‚é€šè¿‡è°ƒç”¨`setAllTransactions(res.data)`é‡æ–°åˆ†é…æ‰€æœ‰äº‹åŠ¡çš„å€¼ã€‚

æˆ‘ä»¬ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ˜¾ç¤ºæ‰€æœ‰çš„äº¤æ˜“ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦æ£€æŸ¥`allTransactions` æ˜¯å¦ä¸ä¸ºç©ºï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé‚£ä¸ªå‚æ•°åé¢æœ‰ä¸€ä¸ªé—®å·ã€‚å¦‚æœå®ƒä¸ä¸ºç©ºå¹¶ä¸”å…¶ä¸­åŒ…å«æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆç”¨`map()`è¿­ä»£å®ƒã€‚æˆ‘ä»¬åªå¯¹æ—¥æœŸæ„Ÿå…´è¶£ï¼Œä¸ºäº†ä½¿å®ƒå¯è¯»ï¼Œ`record_time` å­—ç¬¦ä¸²è¢«æ‹†åˆ†ã€‚åœ¨æ¯ä¸ªäº‹åŠ¡çš„æ—è¾¹ï¼Œæœ‰ä¸€ä¸ªåˆ é™¤æŒ‰é’®ï¼Œtrans_id è¢«ä¼ é€’ç»™`handleDelete()`ã€‚

ç„¶åæˆ‘ä»¬å¯ä»¥å®ç°`handleDelete()`åŠŸèƒ½ã€‚æŒ‰ç…§ Restful API çš„è®¾è®¡ï¼Œ`id`åœ¨`req.params`ä¸­ä¼ è¾“ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡æ·»åŠ æ–°äº¤æ˜“çš„åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨å•ã€‚å®ƒåŒ…å«ä¸¤ä¸ªè¾“å…¥å’Œä¸€ä¸ªæŒ‰é’®ã€‚é€šè¿‡æ£€æµ‹è¾“å…¥çš„å˜åŒ–æ¥è®¾ç½®é¡¹ç›®å’Œä»·æ ¼çš„å€¼ï¼Œå³`onChange={(e) => SetItem/SetPrice(e.target.value)}`ã€‚

åŒæ ·ï¼Œè¡¨å•ç›‘å¬`onSubmit`äº‹ä»¶ã€‚`handleSubmit`åŠŸèƒ½å®ç°å¦‚ä¸‹ã€‚ç”±äºé¡¹ç›®å’Œä»·æ ¼åœ¨è¡¨ç‰¹æ€§ä¸­å…·æœ‰ç›¸åŒçš„åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†`item=item`ç®€åŒ–ä¸º`item`ã€‚

æ— è®ºæ·»åŠ æ–°äº‹åŠ¡æˆåŠŸä¸å¦ï¼Œéƒ½åº”è¯¥æ¸…é™¤è¾“å…¥ã€‚æ‚¨ä¹Ÿå¯ä»¥ä»…åœ¨æäº¤æˆåŠŸæ—¶æ¸…é™¤å®ƒä»¬ã€‚

ç°åœ¨å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å®ç°äº†ã€‚æˆ‘æ·»åŠ äº†ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—æ‰€æœ‰äº‹åŠ¡çš„æ€»å’Œï¼Œå¹¶å°†å…¶æ˜¾ç¤ºåœ¨äº‹åŠ¡è¡¨ä¸‹ã€‚

æ‚¨å¯ä»¥ç¼–å†™ CSS æ–‡ä»¶å¹¶ä¸ºè´¹ç”¨è·Ÿè¸ªå™¨è®¾è®¡è‡ªå·±çš„æ ·å¼ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œæˆ‘ä»¬å®Œæˆäº†ï¼ğŸ‰ğŸ‰ ğŸ‰

# å‚è€ƒ

[1][https://expressjs.com/](https://expressjs.com/)

[https://www.npmjs.com/package/cors](https://www.npmjs.com/package/cors)

[3][https://www.npmjs.com/package/nodemon](https://www.npmjs.com/package/nodemon)

[https://www.npmjs.com/package/axios](https://www.npmjs.com/package/axios)