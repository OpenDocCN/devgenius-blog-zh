<html>
<head>
<title>Image Classification &amp; Machine Learning Tutorial | Qt &amp; TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像分类和机器学习教程| Qt &amp; TensorFlow</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/image-classification-machine-learning-tutorial-qt-tensorflow-b8c3ae56679c?source=collection_archive---------29-----------------------#2020-06-29">https://blog.devgenius.io/image-classification-machine-learning-tutorial-qt-tensorflow-b8c3ae56679c?source=collection_archive---------29-----------------------#2020-06-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1f5f41f1b3d22d2e1af846c9fad03a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sjx7e7jeXJMPgzWG"/></div></div></figure><p id="f9aa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">人工智能和智能应用正稳步变得越来越受欢迎。公司强烈依赖人工智能系统和机器学习，根据他们的数据做出更快、更准确的决策。</p><p id="38fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本指南提供了一个使用 Google 的 TensorFlow 框架进行图像分类和对象检测的示例。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="82a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过阅读这篇文章，你将学会如何:</p><ul class=""><li id="66fc" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated">为 Android、iOS 和桌面 Linux 构建 TensorFlow。</li><li id="a665" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">将 TensorFlow 集成到基于 Qt 的<a class="ae ln" href="https://felgo.com/" rel="noopener ugc nofollow" target="_blank"> Felgo </a>项目中。</li><li id="9793" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">使用 TensorFlow API 运行图像分类和对象检测模型。</li></ul><h1 id="f147" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为什么要在手机应用中加入人工智能</h1><p id="3496" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">截至 2017 年，四分之一的组织已经将超过 15%的 IT 预算投资于机器学习<a class="ae ln" href="https://www.statista.com/statistics/695582/worldwide-machine-learning-share-of-budget/" rel="noopener ugc nofollow" target="_blank">。随着超过 75%的企业在</a><a class="ae ln" href="https://www.gartner.com/newsroom/id/3130817" rel="noopener ugc nofollow" target="_blank">大数据</a>上投入资金和精力，机器学习在未来将变得更加重要。</p><h1 id="3b0f" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">机器学习的真实例子</h1><p id="d02d" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">人工智能正在成为一项业务关键技术，其目标是通过更加数据驱动的方法来改善决策。不管是哪个行业，机器学习都有助于<strong class="jx io">让计算过程更高效、更划算、更可靠</strong>。例如，它用于:</p><ul class=""><li id="5203" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated"><strong class="jx io">金融服务:</strong>跟踪客户和客户满意度，对市场趋势做出反应或计算风险。例如，PayPal 使用机器学习来检测和打击欺诈。</li><li id="e26d" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">医疗保健:</strong>用于个性化健康监测系统，使医疗保健专业人员能够及早发现潜在异常。看看<a class="ae ln" href="https://sombrainc.com/ai-in-healthcare-2019-can-intelligent-machines-make-humans-healthier" rel="noopener ugc nofollow" target="_blank">人工智能在医疗保健领域的最新例子</a>。</li><li id="fd5b" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">零售:</strong>根据你之前的购买或活动提供个性化推荐。例如，网飞或 Spotify 上的推荐。</li><li id="e7dc" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">语音识别系统</strong>，比如 Siri 或者 Cortana。</li><li id="6046" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">人脸识别系统</strong>，比如脸书的 DeepLink。</li><li id="0ffc" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">垃圾邮件检测和</strong>过滤。</li></ul><h1 id="4be1" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">图像分类和对象检测示例</h1><p id="d693" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated"><strong class="jx io"> TensorFlow </strong>是 Google 开放的机器学习框架。其灵活的架构允许跨各种平台(CPU、GPU、TPU)和架构(桌面、服务器集群、移动和边缘设备)轻松部署计算。它支持 Linux、macOS、Windows、Android 和 iOS 等。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/a7371af07daa2f4e5a7069d00c8e6013.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*JNFkHV9mWiXF314WIanfaw.jpeg"/></div></figure><h2 id="d569" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">关于张量流</h2><p id="cf00" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">TensorFlow 有不同的味道。主要的是<em class="ne">张量流</em>。另一个是<em class="ne"> TensorFlow Lite </em>，这是 TensorFlow 针对移动和嵌入式设备的轻量级解决方案。然而，TensorFlow Lite 目前处于技术预览状态。这意味着目前并不支持所有 TensorFlow 特性，尽管在不久的将来它将成为移动和嵌入式设备的参考。</p><p id="009a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于如何使用 Tensorflow 构建应用程序，有大量的在线资料。首先，我们强烈推荐 TensorFlow 移动/嵌入式团队负责人 Pete Warden 的免费电子书<a class="ae ln" href="https://www.oreilly.com/data/free/building-mobile-applications-with-tensorflow.csp" rel="noopener ugc nofollow" target="_blank">使用 TensorFlow 构建移动应用</a>。</p><p id="eaf7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本指南的示例使用了最初的 TensorFow 风格。它展示了如何将 TensorFlow 与 Qt 和<a class="ae ln" href="https://felgo.com/" rel="noopener ugc nofollow" target="_blank"> Felgo </a> to 集成，以创建一个简单的多平台应用程序，其中包括两个预训练的神经网络，一个用于图像分类，另一个用于对象检测。这个例子的代码托管在<a class="ae ln" href="https://github.com/FelgoSDK/TensorFlowQtVPlay" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p><h2 id="8562" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">克隆存储库</h2><p id="8ae3" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">要克隆此存储库，请执行以下命令，递归克隆它，因为 TensorFlow 存储库位于其中。包含的 Tensorflow 版本是 1.8。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=d70a3a95" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="2d8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">非常感谢项目开发人员分享此示例并准备本指南:</p><ul class=""><li id="346b" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated"><em class="ne">贾维尔·博尼拉，计算机科学博士，在欧洲最大的聚光太阳能技术研发和测试中心之一的 CIEMAT-Plataforma Solar de almería(PSA)</em><em class="ne">从事聚光太阳能热设施和发电厂的建模、优化和自动控制研究。</em></li><li id="3bed" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><em class="ne">何塞·安东尼奥·卡巴略，机械工程师，博士生，来自</em> <a class="ae ln" href="http://cms.ual.es/UAL/en/" rel="noopener ugc nofollow" target="_blank"> <em class="ne">阿尔梅里亚大学</em> </a> <em class="ne">，在</em><a class="ae ln" href="http://www.psa.es/en/index.php" rel="noopener ugc nofollow" target="_blank"><em class="ne">CIEMAT-Plataforma Solar de almería(PSA)</em></a><em class="ne">从事关于聚光太阳能热设施和发电厂中有效利用水和能源的建模、优化和自动控制的博士论文。</em></li></ul><h1 id="3099" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">将 Felgo 和 Qt 与 TensorFlow 配合使用的优势</h1><p id="a820" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">Felgo 和 Qt 是多平台应用程序的优秀工具。Qt 拥有一套丰富的现成可用的<a class="ae ln" href="https://felgo.com/doc/apps-api/" rel="noopener ugc nofollow" target="_blank">多平台组件</a>用于不同的领域，如<strong class="jx io">多媒体、网络和连接、图形、输入法、传感器、数据存储和更多</strong>。Felgo 进一步有助于简化移动和嵌入式设备的部署，并添加了一些不错的功能，如<strong class="jx io">分辨率和纵横比独立性以及额外的组件和控件</strong>。Felgo 还提供了更容易访问的原生特性，以及货币化、分析、云服务等插件。</p><p id="9010" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Felgo 的一个很好的特性是，它不局限于移动设备，所以您可以在您的开发计算机上测试和原型化您的应用程序，这肯定比编译和部署您的应用程序到模拟器要快。你甚至可以使用 Felgo live reloading 来查看代码的变化。Android 和 iOS 设备也支持实时重装，非常适合在移动设备上微调更改或测试代码片段。</p><p id="bed4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此 Tensorflow 提供了机器学习框架，而<a class="ae ln" href="https://felgo.com/" rel="noopener ugc nofollow" target="_blank"> Felgo </a>和 Qt 促进了应用程序在多个平台上的部署:桌面和移动。</p><p id="0c92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您需要帮助，请获得<a class="ae ln" href="https://felgo.com/qt-training-consulting-services/" rel="noopener ugc nofollow" target="_blank"> Qt 培训和咨询服务</a>。</p><h1 id="46fa" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">如何为 Qt 构建 TensorFlow</h1><p id="3e69" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">我们需要为每个平台和架构构建 TensorFlow。推荐的方式是使用<code class="fe nk nl nm nn b">bazel</code>构建系统。但是，我们将在这个例子中探索如何使用<code class="fe nk nl nm nn b">make</code>来构建适用于 Linux、Android 和 iOS 的 TensorFlow。检查是否安装了所有必需的库和工具，TensorFlow Makefile 自述文件。</p><p id="1d4f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您对构建用于 macOS 的 Tensorflow 感兴趣，请查看 Makefile 自述文件中支持的系统部分。对于 Windows，选中 TensorFlow CMake build。</p><p id="cda8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您在编译过程中遇到问题，请查看 open Tensorflow <a class="ae ln" href="https://github.com/tensorflow/tensorflow/issues" rel="noopener ugc nofollow" target="_blank"> issues </a>或在那里发布您的问题以获得帮助。</p><p id="a6bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦你建立了 Tensorflow，你的应用程序就可以链接这三个库:<code class="fe nk nl nm nn b">libtensorflow-core.a</code>、<code class="fe nk nl nm nn b">libprotobuf.a</code>和<code class="fe nk nl nm nn b">libnsync.a</code>。</p><p id="7c98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">注意:</strong>当你为不同平台和架构构建时，在同一个 Tensorflow 源代码文件夹中，Tensorflow 可能会删除之前编译的库，所以一定要备份。这些是您可以找到这些库的路径，带有<code class="fe nk nl nm nn b">MAKEFILE_DIR=./tensorflow/tensorflow/contrib/makefile</code>:</p><ul class=""><li id="1bb4" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated">Linux<br/>-libtensor flow-core:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/lib<br/></code>-libprotobuf:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf/lib64<br/></code>-libsync:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/downloads/nsync/builds/default.linux.c++11/</code></li><li id="6fa4" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">Android ARM V7<br/>-libtensor flow-core:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/lib/android_armeabi-v7a<br/></code>-libprotobuf:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf_android/armeabi-v7a/lib/<br/></code>-libsync:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/downloads/nsync/builds/armeabi-v7a.android.c++11/</code></li><li id="fde7" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">Android x86<br/>-libtensor flow-core:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/lib/android_x86<br/></code>-libprotobuf:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf_android/x86/lib/<br/></code>-libsync:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/downloads/nsync/builds/x86.android.c++11/</code></li><li id="7151" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">iOS<br/>-libtensor flow-core:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/lib<br/></code>-libprotobuf:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf_ios/lib/<br/></code>-libsync:<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/downloads/nsync/builds/arm64.ios.c++11/</code></li></ul><p id="39ed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下部分中的 shell 命令仅在 Tensorflow 主文件夹中执行时才有效。</p><h1 id="60e1" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为 Linux 构建</h1><p id="7ad1" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">我们只需要执行下面的 Linux 编译脚本。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=40206c954" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="71b3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您正在为 64 位版本进行编译，可能会遇到以下编译错误:</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码,并实时重新加载代码</figcaption></figure><p id="4764" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，将<code class="fe nk nl nm nn b">tensorflow/tensorflow/contrib/makefile/Makefile</code>文件中的<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf-host/lib</code>引用更改为<code class="fe nk nl nm nn b">$(MAKEFILE_DIR)/gen/protobuf-host/lib64</code>。</p><p id="7517" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于某些 GCC 8 编译器版本，可能会出现以下错误。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=23a4447e" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>,并实时重新加载代码</figcaption></figure><p id="7fa1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了避免这种情况，请在<code class="fe nk nl nm nn b">tensorflow/tensorflow/contrib/makefile/compile_nsync.sh</code>文件中的用于 Linux 的<code class="fe nk nl nm nn b">PLATFORM_CFLAGS</code>变量(<code class="fe nk nl nm nn b">case "$target_platform" in linux</code>)中包含<code class="fe nk nl nm nn b">-Wno-error=class-memaccess</code>标志。</p><h1 id="72c0" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为 Android 构建(在 Linux 上)</h1><p id="5996" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">首先，您需要设置<code class="fe nk nl nm nn b">NDK_ROOT</code>环境变量指向您的 NDK 根路径。你可以从这个链接下载。第二，你需要在 NDK 编译 cpu 特性库。这个例子是用安卓 NDK r14e 测试的。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=9dd42897" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并重新加载实时代码</figcaption></figure><p id="9cde" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，执行下面的脚本，为<code class="fe nk nl nm nn b">ARM v7</code>指令编译 Tensorflow。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=85aa29d5" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>,并实时重新加载代码</figcaption></figure><p id="38e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果要针对<code class="fe nk nl nm nn b">x86</code>平台编译。例如，为了在 Android 模拟器中进行调试，使用以下参数执行相同的命令。</p><p id="cb18" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">注意:</strong>如果您在使用 Android NDK r14 编译 Android x86 时遇到问题，请使用 Android NDK r10e，并根据其路径设置<code class="fe nk nl nm nn b">NDK_ROOT</code>。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=acbffee6" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="84e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Tensorflow Android 支持的架构如下。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=3d97d7ba" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><h1 id="a8c8" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为 iOS 构建(在 macOS 上)</h1><p id="31fc" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">以下脚本可用于在 macOS 上为 iOS 构建 Tensorflow。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码,并实时重新加载代码</figcaption></figure><p id="0230" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果在为 iOS 构建 Tensorflow 时出现以下错误。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=98cd5c30" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="2388" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以避免它执行<a class="ae ln" href="https://github.com/tensorflow/tensorflow/issues/18356" rel="noopener ugc nofollow" target="_blank">这个评论</a>中给出的改变。也就是在<code class="fe nk nl nm nn b">Makefile</code>中将<code class="fe nk nl nm nn b">-D__thread=thread_local \</code>改为<code class="fe nk nl nm nn b">-D__thread= \</code>(仅针对<code class="fe nk nl nm nn b">i386</code>架构)。</p><h1 id="846a" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">如何在您的 Qt 手机应用程序中使用 TensorFlow</h1><p id="2b3f" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">这个应用的源代码在一个 GitHub 仓库里。本节将介绍应用程序代码。</p><h1 id="3503" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">在项目中链接 TensorFlow</h1><p id="0658" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">以下代码显示了添加到我们的<code class="fe nk nl nm nn b">qmake</code>项目文件中的行，以便根据目标平台包含 TensorFlow 头文件和 TensorFlow 库的链接。</p><p id="72c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于 Android，在 Qt Creator 中<code class="fe nk nl nm nn b">ANDROID_NDK_ROOT</code>被设置为 Android NDK r14e 的路径<code class="fe nk nl nm nn b">ANDROID_NDK_PLATFORM</code>被设置为<code class="fe nk nl nm nn b">android-21</code>(项目- &gt;构建环境)。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=e96c7c3a" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><h1 id="d28e" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">用 QML 创建 GUI</h1><p id="2f21" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">GUI 非常简单，只有两个页面。</p><ul class=""><li id="6408" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated"><strong class="jx io">现场视频输出页面</strong>:用户可以在前后摄像头之间切换。</li><li id="13c9" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><strong class="jx io">设置页面</strong>:设置最小置信度和选择模型的页面:一个用于图像分类，另一个用于物体检测。</li></ul><h2 id="4ace" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">Main.qml</h2><p id="734b" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">在<code class="fe nk nl nm nn b">main.qml</code>中，有一个<a class="ae ln" href="https://felgo.com/doc/vplay-storage/" rel="noopener ugc nofollow" target="_blank">存储</a>组件，用于加载/保存最小置信水平、所选模型以及是否显示推断时间。推理时间是 Tensorflow 神经网络模型处理图像所用的时间。存储键为<code class="fe nk nl nm nn b">kMinConfidence</code>、<code class="fe nk nl nm nn b">kModel</code>和<code class="fe nk nl nm nn b">kShowTime</code>。它们的默认值由<code class="fe nk nl nm nn b">defMinConfidence</code>、<code class="fe nk nl nm nn b">defModel</code>和<code class="fe nk nl nm nn b">defShowTime</code>给出。实际值存储在<code class="fe nk nl nm nn b">minConfidence</code>、<code class="fe nk nl nm nn b">model</code>和<code class="fe nk nl nm nn b">showTime</code>中。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=4376528a" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="684c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有一个<a class="ae ln" href="https://felgo.com/doc/vplayapps-navigation/" rel="noopener ugc nofollow" target="_blank">导航</a>组件，有两个<a class="ae ln" href="https://felgo.com/doc/vplayapps-navigationitem/" rel="noopener ugc nofollow" target="_blank">导航项</a>，每个都是一个<a class="ae ln" href="https://felgo.com/doc/vplayapps-page/" rel="noopener ugc nofollow" target="_blank">页面</a>。<code class="fe nk nl nm nn b">VideoPage</code>显示现场摄像机输出。它读取<code class="fe nk nl nm nn b">minConfidence</code>、<code class="fe nk nl nm nn b">model</code>和<code class="fe nk nl nm nn b">showTime</code>属性。<code class="fe nk nl nm nn b">AppSettingsPage</code>也读取这些属性，并在<code class="fe nk nl nm nn b">onMinConfidenceChanged</code>、<code class="fe nk nl nm nn b">onModelChanged</code>和<code class="fe nk nl nm nn b">onShowTimeChanged</code>事件中设置它们的新值。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=c802fc7b" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><h2 id="72d9" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">视频页面. qml</h2><p id="7a56" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">下面是 iOS 上物体检测的视频页面截图。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/da4561c5d4f9b93cea32a7baa350ba77.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*FlfJDsc6RNxTup1dcRcnZQ.png"/></div></figure><p id="7c7d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe nk nl nm nn b">QtMultimedia</code>模块加载在该页面上。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=b424882e" rel="noopener ugc nofollow" target="_blank">现在在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="741e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe nk nl nm nn b">VideoPage</code>具有<code class="fe nk nl nm nn b">minConfidence</code>、<code class="fe nk nl nm nn b">model</code>和<code class="fe nk nl nm nn b">showTime</code>属性。它还有另一个属性来存储摄像机索引，<code class="fe nk nl nm nn b">cameraIndex</code>。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码,并实时重新加载代码</figcaption></figure><p id="ce8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当页面显示或隐藏时，有一个启动和停止的照相机组件。它有两个布尔属性。如果至少有一台摄像机，则第一个为真，如果至少有两台摄像机，则第二个为真。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码,并实时重新加载代码</figcaption></figure><p id="cb28" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">导航栏中还有一个按钮，用于切换相机。仅当有多台摄像机可用时，此按钮才可见。由于<a class="ae ln" href="https://bugreports.qt.io/browse/QTBUG-37955" rel="noopener ugc nofollow" target="_blank"> Qt 错误 37955 </a>，需要<code class="fe nk nl nm nn b">initialRotation()</code>功能，该错误会错误地旋转 iOS 上的前置摄像头视频输出。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=ae0fdd9f" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码,并实时重新加载代码</figcaption></figure><p id="b226" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当没有检测到摄像机时，会向用户显示一个图标和一条消息。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=92bc751e" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>,并实时重新加载代码</figcaption></figure><p id="3dcc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当相机加载时，一个带有酷动画的图标和一条消息也会显示给用户。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=001c66f3" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="4dba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">摄像机视频输出占据了整个页面。仅当至少<br/>一台摄像机被检测到并处于活动状态时才可见。我们定义了一个在 C++类中实现的过滤器<code class="fe nk nl nm nn b">objectsRecognitionFilter</code>。该过滤器获取每个视频帧，将其作为输入数据转换到 TensorFlow，调用 TensorFlow 并在视频帧上绘制结果。这个 C++类后面会介绍。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=96f16a21" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>,并实时重新加载代码</figcaption></figure><h2 id="c326" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">AppSettingsPage.qml</h2><p id="e46c" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">下面是 iOS 上的这个页面的截图。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/f1c13b9116b447f25b14fb7aba335b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*03yiGES7Qlx481-60EstOQ.png"/></div></figure><p id="6850" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe nk nl nm nn b">AppSettingsPage</code>允许用户使用滑块选择检测的最低置信水平。滑块值存储在<code class="fe nk nl nm nn b">minConfidence</code>中。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=b510de43" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><p id="8bbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">推理时间，Tensorflow 处理图像所花费的时间也可以显示在屏幕上。它可以通过开关启用或禁用。布尔值存储在<code class="fe nk nl nm nn b">showTime</code>中。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">现在，在你的 iOS 或 Android 设备上运行这段代码，并重新加载代码</figcaption></figure><p id="86b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有两个专用的复选框来选择模型:一个用于图像分类，另一个用于对象检测。所选模型存储在“模型”属性中。如果当前选定的模型未被选中，则另一个模型会被自动选中，因为它们中的一个应该总是被选中。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="nf ky l"/></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ln" href="https://felgo.com/web-editor?snippet=d0b6077f" rel="noopener ugc nofollow" target="_blank">现在就在你的 iOS 或 Android 设备上运行这段代码</a>，并实时重新加载代码</figcaption></figure><h1 id="204d" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">C++ TensorFlow 接口和视频帧过滤器</h1><p id="553b" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">用 C++编写了两个主要任务。</p><ul class=""><li id="bd18" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated">与 TensorFow 接口</li><li id="4ab0" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">管理视频帧</li></ul><p id="0034" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里没有详细介绍 C++类的源代码，相反，对过程进行了概述和解释，并给出了进一步细节的链接。不过，你可以看看托管在<a class="ae ln" href="https://github.com/FelgoSDK/TensorFlowQtVPlay" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的源代码。</p><h2 id="4e29" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">与 Tensorflow 接口</h2><p id="9e81" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">C++类与 TensorFlow 库接口，查看代码以获得该类的详细描述。这个类是一个包装器，查看<a class="ae ln" href="https://www.tensorflow.org/api_guides/cc/guide" rel="noopener ugc nofollow" target="_blank"> Tensorflow C++ API </a>文档了解更多信息。</p><h2 id="08df" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">管理视频帧</h2><p id="2958" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">下一个流程图显示了管理视频帧的工作流程。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/ee30a9fd5753b1637b5d071416ee898d.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*JlPGudeqk7WrCTN9fTXhHQ.png"/></div></figure><p id="20cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对象过滤器<code class="fe nk nl nm nn b">ObjectsRecognizer</code>被应用到<code class="fe nk nl nm nn b">VideoOutput</code>来处理帧。这个过滤器是通过 C++类实现的:<code class="fe nk nl nm nn b">ObjectsRecogFilter</code>和<code class="fe nk nl nm nn b">ObjectsRecogFilterRunable</code>，有关如何应用过滤器的更多信息，请查看<a class="ae ln" href="http://blog.qt.io/blog/2015/03/20/introducing-video-filters-in-qt-multimedia/" rel="noopener ugc nofollow" target="_blank">Qt 多媒体中的视频过滤器介绍</a>。</p><p id="3f7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">过滤器在<code class="fe nk nl nm nn b">ObjectsRecogFilter</code>类的“运行”方法中进行处理。一般步骤如下。</p><ol class=""><li id="a0bd" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks np lf lg lh bi translated">我们需要将我们的<code class="fe nk nl nm nn b">QVideoFrame</code>转换成<code class="fe nk nl nm nn b">QImage</code>，这样我们就可以操纵它。</li><li id="053f" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks np lf lg lh bi translated">我们检查 Tensorflow 是否正在运行。由于 Tensorflow 在另一个线程中执行，我们使用了<code class="fe nk nl nm nn b">QMutex</code>和<code class="fe nk nl nm nn b">QMutexLocker</code>类来检查它是否正在运行。一个很好的例子在<a class="ae ln" href="http://doc.qt.io/qt-5/qmutexlocker.html" rel="noopener ugc nofollow" target="_blank"> QMutexLocker 类文档</a>中给出。<br/> -如果 Tensorflow 正在运行—什么都不做<br/> -如果 Tensorflow 没有运行—我们通过 C++类在另一个线程中执行它:<code class="fe nk nl nm nn b">TensorflowThread</code>和<code class="fe nk nl nm nn b">WorkerTF</code>，信号和插槽用于与主线程和这些类通信，查看【QThreads 通用用法】(https://wiki . Qt . io/QThreads _ general _ usage)了解更多详细信息。我们提供视频帧图像作为输入。当 Tensorflow 完成时，我们也通过信号和槽来存储所选模型给出的结果。</li><li id="ddab" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks np lf lg lh bi translated">我们获得存储的结果(如果有的话)并将它们应用于当前的视频帧图像。如果我们的模型是图像分类，如果分数高于最小置信度值，我们只需绘制顶级图像类的名称和分数。如果我们的模型是对象检测，我们迭代所有的检测并画出边界框、对象的名称和置信度值，如果它们高于最小置信度水平的话。有一个辅助的 C++类，<code class="fe nk nl nm nn b">AuxUtils</code>，提供了在框架上绘图的函数，比如<code class="fe nk nl nm nn b">drawText</code>和<code class="fe nk nl nm nn b">drawBoxes</code>。</li><li id="4447" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks np lf lg lh bi translated">最后一步是将我们的<code class="fe nk nl nm nn b">QImage</code>转换回由 QML <code class="fe nk nl nm nn b">VideoOutput</code>组件处理的<code class="fe nk nl nm nn b">QVideoFrame</code>，然后我们返回去处理一个新的视频帧。</li></ol><h1 id="7f0d" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">用于图像分类和目标检测的神经网络模型</h1><p id="43f6" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">我们需要神经网络模型来执行图像分类和对象检测任务。谷歌提供了一套预先训练好的模型来做到这一点。Tensorflow 冻结神经网络模型的文件扩展名为<code class="fe nk nl nm nn b">.pb</code>。Github 上的例子已经包括<a class="ae ln" href="https://ai.googleblog.com/2017/06/mobilenets-open-source-models-for.html" rel="noopener ugc nofollow" target="_blank"> MobileNet </a>型号:<a class="ae ln" href="https://storage.googleapis.com/mobilenet_v2/checkpoints/mobilenet_v2_1.0_224.tgz" rel="noopener ugc nofollow" target="_blank"> MobileNet V2 1.0_224 </a>用于图像分类，<a class="ae ln" href="http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_coco_2018_01_28.tar.gz" rel="noopener ugc nofollow" target="_blank"> SSD MobileNet V1 coco </a>用于物体检测。MobileNets 是一类用于移动和嵌入式视觉应用的高效神经网络模型。</p><h2 id="28f1" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">图像分类模型</h2><p id="8196" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">图像分类模型可以从<a class="ae ln" href="https://github.com/tensorflow/models/tree/master/research/slim" rel="noopener ugc nofollow" target="_blank"> TensorFlow-Slim 图像分类模型库</a>下载。我们的示例代码是为<code class="fe nk nl nm nn b">MobileNet</code>神经网络设计的。比如下载 mobilenet_v2_1.0_224.tgz，解压后将<code class="fe nk nl nm nn b">mobilenet_v2_1.0_224_frozen.pb</code>文件复制到我们的<code class="fe nk nl nm nn b">assets</code>文件夹中作为<code class="fe nk nl nm nn b">image_classification.pb</code>。这种情况下的图像大小，<code class="fe nk nl nm nn b">224 x 224</code>像素，是在我们的<code class="fe nk nl nm nn b">Tensorflow</code> C++类中定义的常量<code class="fe nk nl nm nn b">fixed_width</code>和<code class="fe nk nl nm nn b">fixed_height</code>中设置的。本例中的输出层<code class="fe nk nl nm nn b">MobilenetV2/Predictions/Reshape_1</code>也在<code class="fe nk nl nm nn b">Tensorflow</code>类的常量列表变量<code class="fe nk nl nm nn b">listOutputsImgCla</code>中指定。这些型号的标签已经设置在<code class="fe nk nl nm nn b">image_classification_labels.txt</code>文件中。标签属于 ImageNet 类。</p><h2 id="dea7" class="ms lp in bd lq mt mu dn lu mv mw dp ly kg mx my mc kk mz na mg ko nb nc mk nd bi translated">目标检测模型</h2><p id="54ac" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">查看<a class="ae ln" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank"> Tensorflow 检测模型动物园</a>获取物体检测模型的完整列表。可以使用任何<code class="fe nk nl nm nn b">SSD MobileNet</code>型号。这种模型为每个被检测对象提供<em class="ne">标题</em>、<em class="ne">置信度</em>和<em class="ne">包围盒</em>输出。例如，下载<code class="fe nk nl nm nn b">ssd_mobilenet_v1_coco_2018_01_28.tar.gz</code>并解压缩，将<code class="fe nk nl nm nn b">frozen_inference_graph.pb</code>复制到我们的<code class="fe nk nl nm nn b">assets</code>文件夹中作为<code class="fe nk nl nm nn b">object_detection.pb</code>。这种型号的标签已经由<code class="fe nk nl nm nn b">object_detection_labels.txt</code>文件给出。标签属于<a class="ae ln" href="https://github.com/nightrome/cocostuff/blob/master/labels.md" rel="noopener ugc nofollow" target="_blank"> COCO 标签</a>。</p><h1 id="cf38" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">已知问题</h1><p id="d447" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">尽管给出的例子是可行的，但仍有改进的余地。特别是在 C++代码中，天真的解决方案被认为是简单的。</p><p id="bb68" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有一些问题需要解决，下面的列表总结了这些问题。</p><ul class=""><li id="0eb6" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated">即使对于高端移动设备，iOS 上的应用程序性能也比 Android 上的高得多。找到这种情况的根本原因需要进一步的调查。</li><li id="9824" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><code class="fe nk nl nm nn b">AuxUtils</code> C++类的<code class="fe nk nl nm nn b">sp</code>方法旨在提供独立于屏幕大小和分辨率的字体像素大小，尽管它并不适用于所有设备。因此，应该考虑由<a class="ae ln" href="https://felgo.com/doc/vplayapps-app/#sp-method" rel="noopener ugc nofollow" target="_blank">费尔戈 QML </a> <code class="fe nk nl nm nn b"><a class="ae ln" href="https://felgo.com/doc/vplayapps-app/#sp-method" rel="noopener ugc nofollow" target="_blank">sp</a></code>函数提供的相同实现。</li><li id="b498" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">从 QML 和 Qt 类可以很容易地访问资产文件。例如，<code class="fe nk nl nm nn b">assets:/assets/model.pbit </code>提供了一个名为<code class="fe nk nl nm nn b">model.pb</code>的文件的访问权限，该文件存储在 Android 的 assets 文件夹中。然而，从一般的 C++类中访问资产并不容易，因为这些类不能解析<code class="fe nk nl nm nn b">assets:/</code>。Tensorflow C++类就是这种情况。当前的解决方案是将文件复制到一个众所周知的路径，例如复制到<code class="fe nk nl nm nn b">QStandardPaths::writableLocation(QStandardPaths::AppLocalDataLocation)</code>，但是这涉及到检查目标文件夹是否存在(或者创建它)，检查资产文件是否存在并且没有改变(或者复制它)。</li><li id="2b42" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><code class="fe nk nl nm nn b">QVideoFrame</code>转换为<code class="fe nk nl nm nn b">QImage</code>是为了在<code class="fe nk nl nm nn b">ObjectsRecogFilterRunable</code> C++类的<code class="fe nk nl nm nn b">run</code>方法中利用它。目前，这是使用 Qt 私有模块<code class="fe nk nl nm nn b">multimedia-private</code>中的<code class="fe nk nl nm nn b">qt_imageFromVideoFrame</code>函数来完成的。因此，应用程序被绑定到这个特定的 Qt 模块构建版本，针对其他版本的 Qt 模块运行应用程序可能会在任何时候崩溃。此外，<code class="fe nk nl nm nn b">qt_imageFromVideoFrame</code>功能无法正确管理 BGR 视频帧的转换。因此，它们在不使用该功能的情况下被转换成图像。</li><li id="2631" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated">当前实现在处理视频帧的独立线程中连续执行 Tensorflow。也就是 Tensorflow 线程结束时，会用最新的帧再次执行。这种方法提供了流畅的用户体验，但另一方面，它使设备变得相当热，并快速耗尽电池。</li></ul><p id="0ea5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您有将 TensorFlow 集成到您的 Felgo 应用程序的业务请求，请不要犹豫，欢迎致电<a class="ae ln" href="mailto:support@felgo.com" rel="noopener ugc nofollow" target="_blank">support@felgo.com</a>或<a class="ae ln" href="https://felgo.com/contact/" rel="noopener ugc nofollow" target="_blank">联系我们这里</a>。Felgo SDK 是免费使用的，所以一定要去看看！</p><p id="2b8a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你喜欢这篇文章，请随意在脸书或推特上分享。</p><h1 id="cd98" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">更多相关应用开发资源</h1><ul class=""><li id="d0d7" class="kz la in jx b jy mm kc mn kg nq kk nr ko ns ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/cross-platform-app-development/qt-ar-why-and-how-to-add-augmented-reality-to-your-mobile-app" rel="noopener ugc nofollow" target="_blank"> Qt AR:为什么以及如何给你的手机应用添加增强现实</a></li><li id="f44c" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/cross-platform-app-development/notch-developer-guide-ios-android" rel="noopener ugc nofollow" target="_blank">处理安全区域插页，切口&amp;iPhone X、iPad X 和 Android P 的显示屏切口</a></li></ul><h1 id="8eb7" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">最佳应用程序开发教程和免费应用程序模板</h1><p id="3a44" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated">所有这些教程都附有移动应用程序的完整源代码！你可以免费复制代码来制作你自己的应用程序！</p><ul class=""><li id="4fc2" class="kz la in jx b jy jz kc kd kg lb kk lc ko ld ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-getting-started/" rel="noopener ugc nofollow" target="_blank">如何用单一代码库为 iOS &amp; Android 创建移动应用</a></li><li id="d98a" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/howto-multi-language/" rel="noopener ugc nofollow" target="_blank">如何在您的手机应用中支持多语言和国际化</a></li><li id="02e8" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-common-widgets-and-controls/" rel="noopener ugc nofollow" target="_blank">跨平台应用中的常用 Widgets &amp;控件</a></li><li id="1646" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-supporting-multiple-screens-and-screen-densities/" rel="noopener ugc nofollow" target="_blank">如何支持多种屏幕尺寸&amp;屏幕密度—响应式应用指南</a></li><li id="4cfe" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-layout-and-positioning/" rel="noopener ugc nofollow" target="_blank">应用布局指南</a></li><li id="24c1" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-use-app-navigation/" rel="noopener ugc nofollow" target="_blank">应用导航指南</a></li><li id="92ae" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-app-logic/" rel="noopener ugc nofollow" target="_blank">如何给你的手机 App 添加原生代码</a></li><li id="8cfb" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-style-your-app-with-themes/" rel="noopener ugc nofollow" target="_blank">如何用主题轻松设计你的应用</a></li><li id="56d4" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/apps-howto-make-animations/" rel="noopener ugc nofollow" target="_blank">如何为你的应用添加动画</a></li><li id="ac05" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/cross-platform-app-development/how-to-add-chat-service-and-cross-platform-leaderboard-with-user-profiles-to-your-ios-or-android-app" rel="noopener ugc nofollow" target="_blank">如何在手机应用程序中添加聊天内容</a></li><li id="3920" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/cross-platform-app-development/access-rest-services-qt-v-play-weather-service-example-app-open-source" rel="noopener ugc nofollow" target="_blank">如何让天气 App 接入休息天气服务</a></li><li id="2853" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/events/qt-world-summit-open-source-conference-app" rel="noopener ugc nofollow" target="_blank">会议 App 模板</a></li><li id="3bb6" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/v-play-appdemos-showcase-example/" rel="noopener ugc nofollow" target="_blank"> Widget Gallery 应用模板</a></li><li id="8b83" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/v-play-appdemos-twitter-example/" rel="noopener ugc nofollow" target="_blank">推特应用模板</a></li><li id="d1d8" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/v-play-appdemos-messaging-example/" rel="noopener ugc nofollow" target="_blank"> Messenger 应用模板</a></li><li id="9406" class="kz la in jx b jy li kc lj kg lk kk ll ko lm ks le lf lg lh bi translated"><a class="ae ln" href="https://felgo.com/doc/v-play-appdemos-propertycross-example/" rel="noopener ugc nofollow" target="_blank">房产查询器应用模板</a></li></ul><h1 id="1270" class="lo lp in bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">应用开发视频教程</h1><p id="a239" class="pw-post-body-paragraph jv jw in jx b jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks ig bi translated"><a class="ae ln" href="https://www.youtube.com/watch?v=KQgqTYCfJjM" rel="noopener ugc nofollow" target="_blank">用 Qt: Felgo Apps 制作跨平台应用</a></p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="7759" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ln" href="https://www.youtube.com/watch?v=oQfvbnf_Gm0" rel="noopener ugc nofollow" target="_blank">如何为您的手机应用添加应用内聊天或游戏化功能</a></p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="82e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ln" href="https://www.youtube.com/watch?v=hB4r-lL2H2k" rel="noopener ugc nofollow" target="_blank">如何用 Qt 快速设计器(QML 设计器)制作手机 App&amp;Felgo</a></p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="kx ky l"/></div></figure></div><div class="ab cl nt nu hr nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ig ih ii ij ik"><p id="6855" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ne">原载于【https://blog.felgo.com】<a class="ae ln" href="https://blog.felgo.com/cross-platform-development/machine-learning-add-image-classification-for-ios-and-android-with-qt-and-tensorflow" rel="noopener ugc nofollow" target="_blank"><em class="ne"/></a><em class="ne">。</em></em></p></div></div>    
</body>
</html>