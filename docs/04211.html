<html>
<head>
<title>Gatsby.js — Render Data from WordPress and REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —从 WordPress 和 REST API 呈现数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-render-data-from-wordpress-and-rest-api-70297e267caa?source=collection_archive---------2-----------------------#2021-02-10">https://blog.devgenius.io/gatsby-js-render-data-from-wordpress-and-rest-api-70297e267caa?source=collection_archive---------2-----------------------#2021-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e289d9e9928f4e30c5a8cae1e116578c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F6S5UK2DlACXCOLt"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@alexabero?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alexander Abero </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="db3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby 是一个基于 React 的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Gatsby 创建一个站点。</p><h1 id="f5a3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从 WordPress 呈现内容</h1><p id="6456" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在 Gatsby 站点上呈现 WordPress 的内容。</p><p id="65bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们通过运行以下命令来安装<code class="fe me mf mg mh b">gatsby-source-wordpress</code>插件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0e42" class="mq lc iq mh b gy mr ms l mt mu">npm install gatsby-source-wordpress</span></pre><p id="3245" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将以下代码添加到 Gatsby 项目中:</p><p id="a64b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6542" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [<br/>    {<br/>      resolve: `gatsby-source-wordpress`,<br/>      options: {<br/>        baseUrl: `wpexample.com`,<br/>        protocol: `https`,<br/>        hostingWPCOM: false,<br/>        useACF: false<br/>      }<br/>    },<br/>  ]<br/>}</span></pre><p id="d88f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">baseUrl</code>应该被设置为 WordPress 站点的 URL。</p><p id="5b5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">hostingWPCOM</code>设置网站是由 wordpress.com 托管还是自托管。</p><p id="058b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">useACF</code>设置网站是否使用高级自定义字段插件。</p><p id="ce20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="15b5" class="mq lc iq mh b gy mr ms l mt mu">const path = require(`path`)<br/>const { slash } = require(`gatsby-core-utils`)<br/>exports.createPages = async ({ graphql, actions }) =&gt; {<br/>  const { createPage } = actions<br/>  const result = await graphql(`<br/>    query {<br/>      allWordpressPost {<br/>        edges {<br/>          node {<br/>            id<br/>            slug<br/>          }<br/>        }<br/>      }<br/>    }<br/>  `)<br/>  const postTemplate = path.resolve(`./src/templates/post.js`)<br/>  result.data.allWordpressPost.edges.forEach(edge =&gt; {<br/>    createPage({<br/>      path: edge.node.slug,<br/>      component: slash(postTemplate),<br/>      context: {<br/>        id: edge.node.id,<br/>      },<br/>    })<br/>  })<br/>}</span></pre><p id="667f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过 GraphQL 查询从 WordPress API 获取数据。</p><p id="dd4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">createPage</code>来创建页面。</p><p id="5466" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">path</code>设置为 slug。</p><p id="7d90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">component</code>道具设置为模板路径，即<code class="fe me mf mg mh b">src/templates/post.js</code></p><p id="5228" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">context</code>有多余的数据。</p><p id="ffc1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/template/post.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="dc2c" class="mq lc iq mh b gy mr ms l mt mu">import React, { Component } from "react"<br/>import { graphql } from "gatsby"<br/>import PropTypes from "prop-types"<br/>class Post extends Component {<br/>  render() {<br/>    const post = this.props.data.wordpressPost<br/>    return (<br/>      &lt;&gt;<br/>        &lt;h1&gt;{post.title}&lt;/h1&gt;<br/>        &lt;div dangerouslySetInnerHTML={{ __html: post.content }} /&gt;<br/>      &lt;/&gt;<br/>    )<br/>  }<br/>}<br/>Post.propTypes = {<br/>  data: PropTypes.object.isRequired,<br/>  edges: PropTypes.array,<br/>}<br/>export default Post<br/>export const pageQuery = graphql`<br/>  query($id: String!) {<br/>    wordpressPost(id: { eq: $id }) {<br/>      title<br/>      content<br/>    }<br/>  }<br/>`</span></pre><p id="58f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">post.js</code>有模板组件。</p><p id="340b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">post.content</code>渲染内容。</p><p id="3fae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">post.title</code>有标题。</p><h1 id="7993" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从外部来源提取数据并创建没有 GraphQL 的页面</h1><p id="1631" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以直接从 API 获取数据，并根据数据创建页面。</p><p id="e91d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="f28e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="295b" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: []<br/>}</span></pre><p id="1d94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e82b" class="mq lc iq mh b gy mr ms l mt mu">const axios = require("axios")<br/>const get = endpoint =&gt; axios.get(`https://pokeapi.co/api/v2${endpoint}`)<br/>const getPokemonData = names =&gt;<br/>  Promise.all(<br/>    names.map(async name =&gt; {<br/>      const { data: pokemon } = await get(`/pokemon/${name}`)<br/>      return { ...pokemon }<br/>    })<br/>  )<br/>exports.createPages = async ({ actions: { createPage } }) =&gt; {<br/>  const allPokemon = await getPokemonData(["mew", "ditto", "squirtle"])<br/>  createPage({<br/>    path: `/pokemon`,<br/>    component: require.resolve("./src/templates/all-pokemon.js"),<br/>    context: { allPokemon },<br/>  })<br/>}</span></pre><p id="3570" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">all-pokemon.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9fd5" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>export default function AllPokemon({ pageContext: { allPokemon } }) {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;ul&gt;<br/>        {allPokemon.map(pokemon =&gt; (<br/>          &lt;li key={pokemon.id}&gt;<br/>            &lt;img src={pokemon.sprites.front_default} alt={pokemon.name} /&gt;<br/>            &lt;p&gt;{pokemon.name}&lt;/p&gt;<br/>          &lt;/li&gt;<br/>        ))}<br/>      &lt;/ul&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="1629" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">gatsby-node.js</code>中，我们从口袋妖怪 API 中获取数据。</p><p id="29f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过从 API 获取数据来创建<code class="fe me mf mg mh b">createPages</code>函数。</p><p id="4728" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们对<code class="fe me mf mg mh b">getPokemonData</code>返回的承诺的解析值调用<code class="fe me mf mg mh b">createPage</code>。</p><p id="b9ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为页面设置了<code class="fe me mf mg mh b">path </code>,设置了用于呈现数据的<code class="fe me mf mg mh b">component</code>,设置了用于呈现数据的<code class="fe me mf mg mh b">context</code>。</p><p id="7b79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">src/templates/all-pokemon.js</code>中，我们呈现从 API 获得的数据。</p><h1 id="7f1a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="405b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以直接用 Gatsby 从 WordPress 或 REST API 呈现数据。</p></div></div>    
</body>
</html>