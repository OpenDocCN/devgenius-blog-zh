<html>
<head>
<title>Laravel validation for multiple forms on the same page</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对同一页面上的多个表单进行验证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-validation-for-multiple-forms-on-the-same-page-74ad420a5e6?source=collection_archive---------3-----------------------#2022-05-08">https://blog.devgenius.io/laravel-validation-for-multiple-forms-on-the-same-page-74ad420a5e6?source=collection_archive---------3-----------------------#2022-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0acf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在同一页面上显示多个表单的验证错误</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c6302ea17242cc39df1f7f9971048baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VayejMEMt8acxB1B"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@maxchen2k?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Chen </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="7437" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我必须在同一个页面上实现两个表单，以便在<a class="ae kv" href="https://github.com/balajidharma/basic-laravel-admin-panel" rel="noopener ugc nofollow" target="_blank"> Laravel 基本管理面板</a>上更新配置文件。</p><p id="a708" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个表单用于基本信息，另一个用于密码更新。为了验证，在控制器中使用了<code class="fe ls lt lu lv b">$request-&gt;validate()</code>方法</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="9615" class="ma mb iq lv b gy mc md l me mf">$request-&gt;validate([<br/>    'name' =&gt; ['required', 'string', 'max:255'],<br/>    'email' =&gt; ['required', 'string', 'email', 'max:255', 'unique:users,email,'.\Auth::user()-&gt;id],<br/>]);</span></pre><p id="1610" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在视图中使用下面的代码来显示错误。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="a2ad" class="ma mb iq lv b gy mc md l me mf">@if ($errors-&gt;any())<br/>    &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>        @foreach ($errors-&gt;all() as $error)<br/>            &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>        @endforeach<br/>    &lt;/ul&gt;<br/>@endif</span></pre><p id="1e4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是它在两个表单上都显示了错误，因为使用了相同的<code class="fe ls lt lu lv b">$errors</code>变量来显示错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/5d4b614ff10c3fe405b9ff54097cb36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TnGI6f40MMhxHeUKkOrvw.png"/></div></div></figure><p id="3b2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">变量<code class="fe ls lt lu lv b">$errors</code>将是<code class="fe ls lt lu lv b">Illuminate\Support\MessageBag</code>的一个实例。为了解决这个问题，Laravel 采用了内置解决方案。我们可以将名字添加到 MessageBag 中。Laravel 是<a class="ae kv" href="https://laravel.com/docs/9.x/validation#named-error-bags" rel="noopener ugc nofollow" target="_blank">命名的错误包</a></p><h1 id="3f64" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">命名错误包</h1><p id="b822" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">我们可以用多种方式添加命名错误。</p><ul class=""><li id="5dc6" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">1.重定向<code class="fe ls lt lu lv b">withErrors</code></li><li id="4f91" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">2.<code class="fe ls lt lu lv b">validateWithBag</code>方法</li></ul><h2 id="6df2" class="ma mb iq bd mi nr ns dn mm nt nu dp mq lf nv nw ms lj nx ny mu ln nz oa mw ob bi translated">1.使用错误重定向</h2><p id="f00c" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">要向错误包添加名称，只需将名称作为第二个参数传递给<code class="fe ls lt lu lv b">withErrors</code></p><p id="9fa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为帐户添加了“帐户”作为命名错误，并为密码更新表单添加了“密码”。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="2dee" class="ma mb iq lv b gy mc md l me mf">$validator = Validator::make($request-&gt;all(), [<br/>    'name' =&gt; ['required', 'string', 'max:255'],<br/>    'email' =&gt; ['required', 'string', 'email', 'max:255', 'unique:users,email,'.\Auth::user()-&gt;id],<br/>]);</span><span id="301c" class="ma mb iq lv b gy oc md l me mf">if ($validator-&gt;fails()) {<br/>    return redirect('admin.account.info')<br/>                -&gt;withErrors($validator, 'account')<br/>                -&gt;withInput();<br/>}</span></pre><p id="85f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新视图错误显示的以下代码</p><h2 id="6580" class="ma mb iq bd mi nr ns dn mm nt nu dp mq lf nv nw ms lj nx ny mu ln nz oa mw ob bi translated">如何在视图上显示命名的错误包</h2><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="39b5" class="ma mb iq lv b gy mc md l me mf">@if ($errors-&gt;account-&gt;any())<br/>    &lt;ul class="mt-3 list-none list-inside text-sm text-red-400"&gt;<br/>        @foreach ($errors-&gt;account-&gt;all() as $error)<br/>            &lt;li&gt;{{ $error }}&lt;/li&gt;<br/>        @endforeach<br/>    &lt;/ul&gt;<br/>@endif</span></pre></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><h2 id="c968" class="ma mb iq bd mi nr ns dn mm nt nu dp mq lf nv nw ms lj nx ny mu ln nz oa mw ob bi translated">2.validateWithBag 方法</h2><p id="2bda" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">如果验证失败，我们可以使用<code class="fe ls lt lu lv b">validateWithBag</code>方法将错误消息存储在一个名为<a class="ae kv" href="https://laravel.com/docs/9.x/validation#named-error-bags" rel="noopener ugc nofollow" target="_blank">的错误包</a>中:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="46e6" class="ma mb iq lv b gy mc md l me mf">\Validator::make($request-&gt;all(), [<br/>    'name' =&gt; ['required', 'string', 'max:255'],<br/>    'email' =&gt; ['required', 'string', 'email', 'max:255', 'unique:users,email,'.\Auth::user()-&gt;id],<br/>])-&gt;validateWithBag('account');</span></pre><p id="9fd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，我们可以使用<code class="fe ls lt lu lv b">$request-&gt;validateWithBag</code></p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="1fbc" class="ma mb iq lv b gy mc md l me mf">$request-&gt;validateWithBag('account', [<br/>    'name' =&gt; ['required', 'string', 'max:255'],<br/>    'email' =&gt; ['required', 'string', 'email', 'max:255', 'unique:users,email,'.\Auth::user()-&gt;id],<br/>]);</span></pre><p id="ef90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加以下代码以验证密码</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="7e01" class="ma mb iq lv b gy mc md l me mf">$validator = \Validator::make($request-&gt;all(), [<br/>    'old_password' =&gt; ['required'],<br/>    'new_password' =&gt; ['required', Rules\Password::defaults()],<br/>    'confirm_password' =&gt; ['required', 'same:new_password', Rules\Password::defaults()],<br/>]);</span><span id="327e" class="ma mb iq lv b gy oc md l me mf">$validator-&gt;after(function ($validator) use ($request) {<br/>    if ($validator-&gt;failed()) return;<br/>    if (! Hash::check($request-&gt;input('old_password'), \Auth::user()-&gt;password)) {<br/>        $validator-&gt;errors()-&gt;add(<br/>            'old_password', 'Old password is incorrect.'<br/>        );<br/>    }<br/>});</span><span id="be57" class="ma mb iq lv b gy oc md l me mf">$validator-&gt;validateWithBag('password');</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/821794377129aa3f69447f2df0f7f949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0RYqzUNe0gjTh5bMfqU7w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">对同一页面上的多个表单进行验证</figcaption></figure></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="bae5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！</p><p id="c18e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果错过了任何其他方法来显示多个表单的错误消息，请添加您的反馈和注释。</p></div></div>    
</body>
</html>