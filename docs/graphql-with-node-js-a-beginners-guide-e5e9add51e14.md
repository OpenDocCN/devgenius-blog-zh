# å¸¦æœ‰ Node.js çš„ GraphQL:åˆå­¦è€…æŒ‡å—

> åŸæ–‡ï¼š<https://blog.devgenius.io/graphql-with-node-js-a-beginners-guide-e5e9add51e14?source=collection_archive---------7----------------------->

![](img/34aae13d1a4a6190396a49c4f6f33c62.png)

å¸¦æœ‰ Node.js çš„ GraphQL

*å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘åœ¨ GraphQL ä¸Šå·¥ä½œï¼Œä½†æ˜¯æ˜¯åœ¨ DotNet é‡Œã€‚æˆ‘æ‰“ç®—ä½¿ç”¨ Node.js ä¸ GraphQL ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥æˆ‘åšäº†ä¸€äº›ç ”ç©¶ï¼Œè¯»äº†ä¸€äº›æ–‡ç« ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå®ƒå·¥ä½œäº†ã€‚å› æ­¤ï¼Œæˆ‘å†³å®šä¸ºåƒæˆ‘ä¸€æ ·æƒ³ç”¨ node.js å­¦ä¹  GraphQL çš„äººåšä¸€ä¸ªå¾ªåºæ¸è¿›çš„æŒ‡å—*

# è¦æ±‚ä½ æ‰€éœ€è¦çš„ï¼Œå¾—åˆ°å®ƒï¼

å‘æ‚¨çš„ API å‘é€ä¸€ä¸ª GraphQL æŸ¥è¯¢ï¼Œå¾—åˆ°æ‚¨æ‰€éœ€è¦çš„ï¼Œä¸å¤šä¹Ÿä¸å°‘ã€‚GraphQL æŸ¥è¯¢æ€»æ˜¯è¿”å›å¯é¢„æµ‹çš„ç»“æœã€‚ä½¿ç”¨ GraphQL çš„åº”ç”¨ç¨‹åºå¿«é€Ÿè€Œç¨³å®šï¼Œå› ä¸ºå®ƒä»¬æ§åˆ¶ç€è‡ªå·±è·å¾—çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨ã€‚

# å…¥é—¨æŒ‡å—

å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œ[ä¸‹è½½å¹¶å®‰è£… Node.js](https://nodejs.org/en/download/) ã€‚å®‰è£…åï¼Œè®©æˆ‘ä»¬ä»ç›®å½•ç»“æ„å¼€å§‹ã€‚

è¯¥é¡¹ç›®åˆ†ä¸ºä¸¤ä¸ªç›®å½•ï¼Œä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯ï¼Œä¸€ä¸ªç”¨äºæœåŠ¡å™¨ã€‚æˆ‘é€‰æ‹©å°†è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œä½†æ˜¯å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥å°†å®ƒåˆ†æˆä¸¤ä¸ªä¸åŒçš„é¡¹ç›®ã€‚

ğŸ“é¡¹ç›®
â”œâ”€â”€ğŸ“å®¢æˆ·
â””â”€â”€ğŸ“è®¡ç®—æœºç½‘ç»œæœåŠ¡å™¨

æˆ‘ä»¬ç°åœ¨å°†åœ¨æœåŠ¡å™¨ç›®å½•ä¸­å¯åŠ¨é¡¹ç›®ã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œå¯¼èˆªåˆ°æœåŠ¡å™¨æ–‡ä»¶å¤¹å¹¶æ‰§è¡Œ npm init æ¥å¡«å……é¡¹ç›®ä¿¡æ¯å¹¶ç”Ÿæˆ package.json æ–‡ä»¶ã€‚

æˆ‘ä»¬çš„æœåŠ¡å™¨å°†é…ç½®æœ‰ [GraphQL.js](https://github.com/graphql/graphql-js) å’Œ [Apollo æœåŠ¡å™¨](https://github.com/apollographql/apollo-server)ã€‚GraphQL.js å°†æä¾›ä¸¤ä¸ªå…³é”®ç‰¹æ€§:

*1ã€‚åˆ›å»ºä¸€ä¸ªç±»å‹æ¨¡å¼ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„æ­¥éª¤ä¸­å®Œæˆã€‚
2ã€‚ä½¿ç”¨è¿™ç§æ¨¡å¼æ¥å¤„ç†æŸ¥è¯¢ã€‚*

# ***å¦‚ä½•å®šä¹‰æ¨¡å¼:***

ä»»ä½• GraphQL æœåŠ¡å™¨å®ç°éƒ½ä¾èµ–äº GraphQL æ¨¡å¼ã€‚å®ƒä½¿ç”¨ç”±æ•°æ®æºç”Ÿæˆçš„ç±»å‹å’Œå­—æ®µçš„å±‚æ¬¡ç»“æ„æ¥å®šä¹‰æ•°æ®çš„å½¢å¼ã€‚å®ƒè¿˜æŒ‡å®šäº†å“ªäº›æŸ¥è¯¢å’Œå˜åŒ–æ˜¯å¯ç”¨çš„ï¼Œå…è®¸å®¢æˆ·æœºçŸ¥é“å¯ä»¥è¯·æ±‚æˆ–æä¾›ä»€ä¹ˆæ•°æ®ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ¶ä½œä¸€ä¸ªè‰å›¾åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬æœ€åŸºæœ¬çš„æ¨¡å¼(é€šå¸¸åœ¨ schema.graphql æ–‡ä»¶ä¸­å®šä¹‰)å°†åŒ…æ‹¬ä¸¤ç§å¯¹è±¡ç±»å‹:è‰å›¾å’Œè‰ºæœ¯å®¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
type Sketch
{ 
title: String
artist: [Artist]
}type Artist
{
name: String
sketch: [Sketch]
}
```

ç„¶åï¼Œå¯ç”¨çš„æŸ¥è¯¢å°†ç”±æŸ¥è¯¢ç±»å‹å®šä¹‰:getSketches å’Œ getArtistsï¼Œæ¯ä¸ªæŸ¥è¯¢è¿”å›åŒ¹é…ç±»å‹çš„åˆ—è¡¨ã€‚

```
getSketches: [Sketch] type Querytype Query 
{
getSketches: [Sketch]
getArtists: [Artist]
}
```

æˆ‘ä»¬çš„æ¨¡å¼å°†åªæœ‰ä¸€ç§æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥ä½¿äº‹æƒ…å°½å¯èƒ½ç®€å•ã€‚

çŠ¶æ€:å­—ç¬¦ä¸²:ç±»å‹æŸ¥è¯¢

ä¸ºäº†è®¾è®¡ä¸€ä¸ª GraphQL æ¨¡å¼å¹¶å›´ç»•å®ƒæ„å»ºä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ Apollo æœåŠ¡å™¨æ¥æ‰§è¡Œ GraphQL æŸ¥è¯¢ã€‚

å› æ­¤ï¼Œåœ¨æœåŠ¡å™¨ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ server.js æ–‡ä»¶æ¥æè¿°æ¨¡å¼ã€‚

ğŸ“é¡¹ç›®
â”œâ”€â”€ğŸ“å®¢æˆ·
â””â”€â”€ğŸ“æœåŠ¡å™¨
â””â”€â”€ğŸ“„server.js

ç°åœ¨è¿è¡Œ npm install apollo-server æ¥å®‰è£… apollo-serverã€‚

ä¸ºäº†è§£ææ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦ä» apollo-server å¯¼å…¥æ ‡è®°å‡½æ•° gql:ç„¶ååˆ›å»ºä¸€ä¸ª typeDefs å¸¸é‡ï¼Œè¿™æ˜¯ Graphql ä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘ã€‚var gql = require(' Apollo-server ')ï¼›

å­—ç¬¦ä¸²æ˜¯ GraphQL æœåŠ¡å™¨æ¥æ”¶æŸ¥è¯¢è¿›è¡Œå¤„ç†æ—¶æœ€å¸¸è§çš„æ ¼å¼ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¿…é¡»è¢«æ ‡è®°åŒ–å¹¶å¤„ç†æˆæœºå™¨å¯è¯»çš„è¡¨ç¤ºå½¢å¼ã€‚æŠ½è±¡è¯­æ³•æ ‘æ˜¯è¿™ç§ç»“æ„çš„åç§°ã€‚

AST Explorer æ˜¯ä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºæŠ½è±¡è¯­æ³•æ ‘çš„çŸ¥è¯†ï¼Œå®ƒå¯ä»¥è®©æ‚¨ä½œä¸ºè§£æå™¨æ£€æŸ¥ç”±æ‰€é€‰è¯­è¨€å½¢æˆçš„è¯­æ³•æ ‘ã€‚

server.js æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:

```
const { gql } = require(â€˜apollo-serverâ€™);
const typeDefs = gql
type Query {
status: String
};
```

# **å¦‚ä½•åœ¨ä½ çš„ä»£ç ä¸­åŒ…å«è§£æå‡½æ•°**

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®šä¹‰äº†æ¨¡å¼ï¼Œæˆ‘ä»¬å°†éœ€è¦è§£æå™¨æ¥å“åº”å®¢æˆ·ç«¯å¯¹è¯¥æ•°æ®çš„è¯·æ±‚ã€‚

è§£æå™¨æ˜¯ç®¡ç†æ¯ä¸ªæ¨¡å¼å­—æ®µçš„æ•°æ®çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»åç«¯æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹ API æ£€ç´¢æ•°æ®æ¥å°†æ•°æ®äº¤ä»˜ç»™å®¢æˆ·ç«¯ã€‚

å®ƒä»¬å¿…é¡»ä¸æ¨¡å¼çš„ç±»å‹å®šä¹‰ç›¸åŒ¹é…ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªç±»å‹å®šä¹‰ Queryï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸º status å­—æ®µæ„é€ ä¸€ä¸ªè§£æå™¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
const resolvers = {
Query: {
status: () => â€˜Hello GQL Server!ğŸ‘‹â€™,
},
};
```

# **å¦‚ä½•å®‰è£…å’Œé…ç½®æœåŠ¡å™¨:**

æˆ‘ä»¬åœ¨åŒä¸€ä¸ª server.js æ–‡ä»¶ä¸­å®šä¹‰å¹¶æ„å»ºä¸€ä¸ªæ–°çš„ ApolloServer å¯¹è±¡ï¼Œå°†æ¨¡å¼(typeDefs)å’Œè§£æå™¨ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

```
const { ApolloServer, gql } = require(â€˜apollo-serverâ€™);
const server = new ApolloServer({ typeDefs, resolvers });
```

ç„¶åï¼Œä½¿ç”¨ listen æ–¹æ³•åœ¨ params ä¸­æŒ‡å®šçš„ç«¯å£ä¸Šå¯åŠ¨æœåŠ¡å™¨ã€‚

```
server.listen({ port: 3000 }).then(serverInfo => 
console.log(`Server running at ${serverInfo.url}`));
```

æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ç™»å½•æ—¶**ææ„**server info URLã€‚

```
server.listen({ port: 3000 }).then(({ url }) => 
console.log(`Server running at ${url}`));
```

server.js æ–‡ä»¶ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
const { ApolloServer, gql } = require(â€˜apollo-serverâ€™);
const typeDefs = gql.type Query 
{
status: String
};
const resolvers = {
Query: {
status: () => â€˜GQL Server!ğŸ‘‹â€™,
},
};
const server = new ApolloServer({ typeDefs, resolvers });
server.listen({ port: 3000 }).then(({ url }) => 
console.log(`Server running at ${url}`));
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ node server/server.jsï¼Œæˆ‘ä»¬å°†æœ€ç»ˆå¯åŠ¨å¹¶è¿è¡Œæˆ‘ä»¬çš„ GraphQL æœåŠ¡å™¨ï¼ğŸ‰

```
You can go and check it out on [http://localhost:3000/](http://localhost:9000/)
~/graphql-server
> node server/server.js
Server running at [http://localhost:3000/](http://localhost:9000/)
```

å¦‚æœæ‚¨æ›¾ç»å¤„ç†è¿‡ RESTful è¯·æ±‚ï¼Œæ‚¨ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼é‚®é€’å‘˜çš„æ¥å£ã€‚åªæ˜¯ä½ ä¸éœ€è¦ä¸‹è½½æˆ–é…ç½®ä»»ä½•ä¸œè¥¿ï¼Œå› ä¸ºå®ƒå·²ç»åŒ…å«åœ¨ Apollo ä¸­äº†ï¼

# å¦‚ä½•è®¾ç½®å®¢æˆ·ç«¯ï¼Ÿ

æ—¢ç„¶æˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»å¯åŠ¨å¹¶è¿è¡Œï¼Œè®©æˆ‘ä»¬æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å®¢æˆ·æœºä¸Šã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨å®¢æˆ·ç«¯å­ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª client.html æ–‡ä»¶ã€‚

index.html æ–‡ä»¶å°†æœ‰æ ‡å‡†çš„ HTML å…ƒç´ ä»¥åŠä¸€ä¸ªåŠ è½½å¤´(h1 >)ã€‚

```
h1>Loadingâ€¦/h1> to display something to the user while we request data from the server<!DOCTYPE html>
<html lang=â€enâ€>
<head><meta charset=â€UTF-8" />
<meta name=â€viewportâ€ content=â€width=device-width, initial-scale=1.0" />
<title>GQL Server</title>
</head>
<body>
<h1>Loadingâ€¦</h1>
<script src=â€app.jsâ€></script>
</body>
</html>
```

**å¦‚ä½•ä»æœåŠ¡å™¨è®¿é—®æ•°æ®ï¼Ÿ**

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨åŒä¸€ä¸ªå®¢æˆ·æœºæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª app.js æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ç¼–å†™ä»æœåŠ¡å™¨è·å–æ•°æ®çš„å®¢æˆ·æœºé€»è¾‘ã€‚

ğŸ“é¡¹ç›®
â”œâ”€â”€ğŸ“å®¢æˆ·
| â””â”€â”€ğŸ“„client.html
|â””â”€â”€ğŸ“„â””â”€â”€ğŸ“æœåŠ¡å™¨
â””â”€â”€ğŸ“„server.js

æˆ‘ä»¬å°†æœåŠ¡å™¨ URL è®¾ç½®ä¸ºå‘å‡ºè¯·æ±‚çš„ URLã€‚

```
const GRAPHQL_URL = â€˜http://localhost:3000/';
```

ç„¶åï¼Œä¸ºäº†ä»æœåŠ¡å™¨è·å–çŠ¶æ€ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¼‚æ­¥å‡½æ•° fetchStatus()ã€‚ä¸ºäº†å‘å‡º HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ fetch APIï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ‰¿è¯ºï¼Œæˆ‘ä»¬å¯ä»¥å¼‚æ­¥è®¢é˜…å’Œæ£€ç´¢å“åº”ã€‚

```
async function fetchStatus() 
{
const response = await fetch(GRAPHQL_URL, {
method: â€˜POSTâ€™,
headers: 
{
â€˜content-typeâ€™: â€˜application/jsonâ€™,
},
body: JSON.stringify({
query: `query 
{
status
}
`,
}),
});
const responseBody = await response.json();
console.log(responseBody);
}
```

è¯·æ±‚çš„æ–¹æ³•æ˜¯ POSTï¼Œè¿™ä¸€ç‚¹éœ€è¦è®°ä½ã€‚å¦‚æœæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨ RESTfulï¼Œè¿™å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œå› ä¸º RESTful çš„ä¸€ä¸ªç±»ä¼¼è¯·æ±‚(æˆ‘ä»¬åªæƒ³ä»æœåŠ¡å™¨è·å–ä¿¡æ¯)é€šå¸¸æ˜¯ç”¨ get æ–¹æ³•å‘å‡ºçš„ã€‚

é—®é¢˜æ˜¯åœ¨ä½¿ç”¨ GraphQL æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä»¥æŸ¥è¯¢ä½œä¸ºæœ‰æ•ˆè´Ÿè½½(ä¸»ä½“)æ¥å‘é€ POST è¯·æ±‚ã€‚

æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ fetchStatus()æ–¹æ³•ã€‚

```
const GRAPHQL_URL = â€˜http://localhost:3000/';
async function fetchStatus() 
{
const response = await fetch(GRAPHQL_URL, {
method: â€˜POSTâ€™,
headers: 
{
â€˜content-typeâ€™: â€˜application/jsonâ€™,
},
body: JSON.stringify({
query: `query 
{
status
}
`,
}),
});
const responseBody = await response.json();
console.log(responseBody);
}
fetchStatus();
```

å¦‚æœæ‚¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥æ–‡ä»¶å¹¶æŸ¥çœ‹å¼€å‘äººå‘˜å·¥å…·ä¸­çš„æ§åˆ¶å°ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä»æŸ¥è¯¢ä¸­è·å¾—äº†çŠ¶æ€æ•°æ®ã€‚å¸Œæœ›æœ‰å¸®åŠ©ã€‚

**å‚è€ƒèµ„æ–™:**
https://graphql.org/
https://reindex.io/

æ­¤å¤–ï¼Œæˆ‘å¾ˆæƒ³çŸ¥é“ä½ å¯¹æˆ‘èƒ½åšäº›ä»€ä¹ˆåœ¨è¿™æ–¹é¢äº§ç”Ÿæ›´å¥½çš„å½±å“çš„æƒ³æ³•ï¼Ÿ