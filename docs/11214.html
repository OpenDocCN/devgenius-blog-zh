<html>
<head>
<title>Basic Data Preparation with Python (Stock Price Data)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 基础数据准备(股票价格数据)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/basic-data-preparation-with-python-stock-price-data-1c3984ccb375?source=collection_archive---------9-----------------------#2022-12-25">https://blog.devgenius.io/basic-data-preparation-with-python-stock-price-data-1c3984ccb375?source=collection_archive---------9-----------------------#2022-12-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0593" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Python 股票价格分析 03:学习股票价格数据的典型数据准备过程</p><h1 id="a3a7" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">Python 股票价格数据分析系列</h1><ol class=""><li id="d0fd" class="lg lh in jm b jn li jr lj jv lk jz ll kd lm kh ln lo lp lq bi translated"><a class="ae lr" href="https://medium.com/dev-genius/extract-stock-price-data-with-python-fa53300120e0" rel="noopener">用 Python 提取股票价格</a></li><li id="22fa" class="lg lh in jm b jn ls jr lt jv lu jz lv kd lw kh ln lo lp lq bi translated"><a class="ae lr" href="https://medium.com/dev-genius/extract-stock-prices-with-python-multiple-stocks-fe2209261cfd" rel="noopener">用 Python 提取股票价格列表</a></li></ol><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi lx"><img src="../Images/110e9fa8fa9a1f2a7ca4919486db69e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQz4SGm4198bKYiRApzdOg.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">Canva 提供的模板——Tetiana SHYSHKINA 在<a class="ae lr" href="https://unsplash.com/photos/trv87p_LMUw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="25bb" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">目录</h1><blockquote class="mn mo mp"><p id="42df" class="jk jl mq jm b jn jo jp jq jr js jt ju mr jw jx jy ms ka kb kc mt ke kf kg kh ig bi translated"><a class="ae lr" href="#7ae2" rel="noopener ugc nofollow">简介</a> <br/> <a class="ae lr" href="#3486" rel="noopener ugc nofollow">数据&amp;资源</a> <br/> <a class="ae lr" href="#a985" rel="noopener ugc nofollow">读取文件</a> <br/> <a class="ae lr" href="#547a" rel="noopener ugc nofollow">转换成熊猫数据帧</a> <br/> <a class="ae lr" href="#8e64" rel="noopener ugc nofollow">标注上各自的跑马灯符号</a> <br/> <a class="ae lr" href="#59d8" rel="noopener ugc nofollow">追加多个表格</a> <br/> <a class="ae lr" href="#346a" rel="noopener ugc nofollow">输出数据</a> <br/> <a class="ae lr" href="#66be" rel="noopener ugc nofollow">视频教程</a> <br/> <a class="ae lr" href="#142a" rel="noopener ugc nofollow">结论</a> <br/> <a class="ae lr" href="#fed3" rel="noopener ugc nofollow">关于我</a></p></blockquote><h1 id="7ae2" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">介绍</h1><p id="8b26" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">在我之前的<a class="ae lr" href="https://medium.com/dev-genius/extract-stock-prices-with-python-multiple-stocks-fe2209261cfd" rel="noopener">文章</a>中，我谈到了使用 Python 在线提取股票价格列表。在本教程的最后，我将数据存储在多个 JSON 文件中。</p><p id="fe8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一名数据科学家或数据工程师，您可能会被要求在将文件推入数据库之前，将数百个(如果不是数千个)文件转换到一个表中。这些文件可以是 CSV、JSON、.xlsb 等。</p><p id="ea02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本教程中，我们将把在前面的教程中得到的这些 JSON 文件合并成一个文件。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="3486" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">数据和资源</h1><p id="c010" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">数据:<a class="ae lr" href="https://drive.google.com/drive/folders/179VLS1bWyAmXZJMBy2rMd1OegtNEXGUC?usp=share_link" rel="noopener ugc nofollow" target="_blank">g 驱动链接</a></p><p id="0924" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">中等:<a class="ae lr" href="https://medium.com/@foocheechuan" rel="noopener">medium.com/@foocheechuan</a></p><p id="217a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Youtube: <a class="ae lr" href="https://www.youtube.com/channel/UC73tyElpkCE_6cbZxMLKnkw" rel="noopener ugc nofollow" target="_blank">车志川</a></p><p id="fc53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您没有遵循我上一篇文章中的教程，请下载上面的数据。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="a985" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">阅读文件</h1><p id="4fb6" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">我使用相对路径导航到我上一篇文章中使用的文件夹。在您的情况下，您可以只使用 path = '您的文件夹路径'。</p><p id="d821" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们使用 os.listdir 列出该文件夹中的所有文件。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="d57f" class="no kj in nk b be np nq l nr ns">import os<br/>path = os.path.abspath(f"../04 Extract Stock Prices in Bulk/JSON")<br/>json_folder = os.listdir(path)<br/>json_folder</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/2d1d3732248e9f2d5227b17f1af878e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*0YhECWDpMrvq7F9XdF3kog.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">json_folder 中的文件列表</figcaption></figure><p id="5729" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于文件夹中有多个文件，我们需要遍历这些文件并逐个读取。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="58e7" class="no kj in nk b be np nq l nr ns">import json<br/><br/>for files in json_folder:<br/>    # Reading from json file<br/>    with open(f'{path}\\{files}', 'r') as openfile:<br/>        json_object = json.load(openfile)</span></pre><p id="3cca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我们只是在每次读取文件时不断替换数据，那也没什么。因此，在继续下一个元素之前，让我们将 json_object 转换成 pandas 数据帧。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="547a" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">转换成熊猫数据框</h1><p id="98d7" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">在每个循环中将 json_object 转换为 pandas 数据框。我将复制我在<a class="ae lr" href="https://medium.com/dev-genius/extract-stock-price-data-with-python-fa53300120e0" rel="noopener">上一篇关于在线提取股票价格的文章</a>中使用的代码。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="5d04" class="no kj in nk b be np nq l nr ns">import pandas as pd<br/>import json<br/><br/>for files in json_folder:<br/>    # Reading from json file<br/>    with open(f'{path}\\{files}', 'r') as openfile:<br/>        json_object = json.load(openfile)<br/>    data = json_object['Time Series (Daily)']<br/><br/>    # Convert into data frame<br/>    df = pd.DataFrame.from_dict({(i): data[i] <br/>                           for i in data.keys()},<br/>                       orient='index')<br/>    df_date = df.rename_axis('Date').reset_index()</span></pre><p id="7efb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将有助于将我们的每个 JSON 文件转换成以下格式。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nu"><img src="../Images/58f33d153e88aa989762f6fb2ea0fd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LedmpcaCoDBy4Z-b.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">熊猫数据框</figcaption></figure></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="8e64" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">标有各自的股票代号</h1><p id="2e54" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">数据框有一个问题。当我们遍历所有股票数据时，在将它们追加到一个表中后，我们不知道这些数据属于哪只股票。也就是说，我们需要在数据帧中创建一个列来标记其各自的股票代码。</p><p id="8fba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 python 中，一个字符串变量可以被视为一个可迭代的数组，因此我们可以使用 substring 方法来检索文件名的前 4 个字母</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="1bd8" class="no kj in nk b be np nq l nr ns"># Extract first 4 letters of the file names<br/>for files in json_folder:<br/>    print(files[:4])</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nv"><img src="../Images/1048e17db1adc6fc58dfcaa921aab296.png" data-original-src="https://miro.medium.com/v2/resize:fit:204/format:webp/1*XCc_VRAwEc9XnCv4DP989Q.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">文件名的前 4 个字母</figcaption></figure><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/eb600034a36aacac10cd7e7b255b9de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*rs5XEM6js0GGEgB6JnLiNA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">原始文件名</figcaption></figure><p id="afcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将代码添加到循环中。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="fc20" class="no kj in nk b be np nq l nr ns">import pandas as pd<br/>import json<br/><br/>for files in json_folder:<br/>    # Reading from json file<br/>    with open(f'{path}\\{files}', 'r') as openfile:<br/>        json_object = json.load(openfile)<br/>    data = json_object['Time Series (Daily)']<br/>    <br/>    # Convert into data frame<br/>    df = pd.DataFrame.from_dict({(i): data[i] <br/>                           for i in data.keys()},<br/>                       orient='index')<br/>    df_date = df.rename_axis('Date').reset_index()<br/>    <br/>    # Add a column for the stock's ticker<br/>    df_date['Ticker'] = files[:4]</span></pre><p id="973c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们可以将数据表追加到一个表中。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="59d8" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">追加多个表格</h1><p id="e7e6" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">我们需要首先创建一个名为 df_all 的空数据框，然后才能将所有股票价格表追加到这个空表中。注意，这个声明是在 for 循环之前完成的。</p><p id="7133" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这样，我们将在每个循环中替换 df 和 df_date，但是 df_all 不会被替换，它将存储前一个循环中的所有表。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="5d9a" class="no kj in nk b be np nq l nr ns">import pandas as pd<br/>import json<br/><br/>df_all = pd.DataFrame()<br/><br/>for files in json_folder:<br/>    # Reading from json file<br/>    with open(f'{path}\\{files}', 'r') as openfile:<br/>        json_object = json.load(openfile)<br/>    data = json_object['Time Series (Daily)']<br/>    <br/>    # Convert into data frame<br/>    df = pd.DataFrame.from_dict({(i): data[i] <br/>                           for i in data.keys()},<br/>                       orient='index')<br/>    df_date = df.rename_axis('Date').reset_index()<br/>    <br/>    # Add a column for the stock's ticker<br/>    df_date['Ticker'] = files[:4]<br/>    df_all = pd.concat([df_all,df_date])<br/>else:<br/>    display(df_all)</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nx"><img src="../Images/4c8819c9294a2a6cb990e54596178656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ke0dVhDIyIYxWLDvC_RfKA.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">组合数据表</figcaption></figure><p id="e834" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">检查 df_all 是否有我们需要的所有库存。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="3080" class="no kj in nk b be np nq l nr ns">df_all['Ticker'].unique()</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ny"><img src="../Images/b8b52c180ad8088aee47d686f7ae209e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6kYHzZFlaxO1F1ViyUh6g.png"/></div></div></figure><p id="4475" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">复位指数</strong></p><p id="f1ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，有 30653 行数据，但最后一个索引是 3142。发生这种情况是因为当我们将表追加到一起时，每个表的索引没有被重置，并且该索引仍然作为它在原始表中的索引。所以我们需要重置组合表中的索引。</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="c0ee" class="no kj in nk b be np nq l nr ns">df_out = df_all.reset_index(drop=True)</span></pre></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="346a" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">输出数据</h1><p id="6cc9" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">将数据输出到同一个文件夹(创建了一个名为 Output 的文件夹来存储最终数据)</p><pre class="ly lz ma mb gt nj nk nl bn nm nn bi"><span id="9126" class="no kj in nk b be np nq l nr ns">output_path = os.path.abspath(f".\\Output")<br/>df_out.to_csv(f'{output_path}\\FAANG-MT Combined Data.csv',index=False)</span></pre></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="66be" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">视频教程</h1><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="142a" class="ki kj in bd kk kl ne kn ko kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf bi translated">结论</h1><p id="fca8" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">今天的文章到此为止。感谢您阅读今天的文章。下一篇文章再见。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ob"><img src="../Images/001d28bd795e719429e19a17dd562d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-TFJMlpZCQWAL8k9Y1VOQ.jpeg"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">照片由<a class="ae lr" href="https://unsplash.com/@jexo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Jexo </a>在<a class="ae lr" href="https://unsplash.com/s/photos/preparation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="fed3" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">关于我</h1><p id="45eb" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv mu jx jy jz mv kb kc kd mw kf kg kh ig bi translated">目前担任数据科学家。我为世界各地的客户提供数据分析问题的咨询、培训和专业服务。我很乐意分享我作为顾问的经验，这样每个人都可以从中学到一些东西。</p><p id="1aaa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">领英:<a class="ae lr" href="https://www.linkedin.com/in/foocheechuan/?source=about_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/foocheechuan/</a></p><p id="68ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">中:【medium.com/@foocheechuan】T2</p><p id="14e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Youtube: <a class="ae lr" href="https://www.youtube.com/channel/UC73tyElpkCE_6cbZxMLKnkw" rel="noopener ugc nofollow" target="_blank">车志川</a></p></div></div>    
</body>
</html>