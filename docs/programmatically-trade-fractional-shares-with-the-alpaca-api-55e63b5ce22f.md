# 用 Alpaca API 以编程方式交易分数份额

> 原文：<https://blog.devgenius.io/programmatically-trade-fractional-shares-with-the-alpaca-api-55e63b5ce22f?source=collection_archive---------0----------------------->

免佣金，零股，全部通过 API。了解如何开始使用 Python，适用的示例，以及像 Postman 这样的新工具。

![](img/23522c26fd095af999f7b848e49a9880.png)

雨果·艾特肯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 介绍

过去五年，散户投资者市场发生了越来越多的变化，其中许多变化都集中在消除进入壁垒上。零佣金是这些变化中最大的一项，始于 Robinhood 应用程序，然后在 Charles Schawb 于 2019 年跟进时得到巩固。然而，零股最近被许多人宣传为任何人投资股票市场的一种方式，并且变得非常受欢迎。

零股投资的一些主要好处是，它解锁了股票和 ETF，否则，如果没有大量资本，你就无法购买，你可以通过用少量资本分散投资组合来降低风险。从算法交易的角度来看，有许多策略依赖于某些部门或股票，通常，股票的价格和没有足够的资金会阻碍伟大的交易策略。

本文的目的是强调如何利用 Alpaca API 通过算法购买零股。我们将参考已经存在的文件，同时，把事情分解得更直观一些，并探索如何在你的下一个交易策略中使用这些令人兴奋的想法。

# 工具包

*   [巨蟒](https://www.python.org/downloads/)
*   [羊驼帐](https://alpaca.markets/)
*   [邮递员](https://medium.com/r?url=https%3A%2F%2Fwww.postman.com%2Fdownloads%2F)
*   羊驼关于部分股份订单的文件

[正式文件](https://alpaca.markets/docs/trading-on-alpaca/fractional-trading/)

[操作指南文档](https://alpaca.markets/learn/fractional-shares-api/)

# 步骤 1:理解 API 原始请求和 Python SDK 之间的区别

如果你熟悉羊驼 API，它非常容易使用，与其他替代产品相比，它们的文档也非常好。对于任何 API 来说，理解基础和如何使用它都是很重要的。通常，使用 API 有两种方式调用 API，直接 API 原始请求或通过 SDK 或“包装器”。如果你有兴趣了解更多，这里有一篇萨沙·安德列耶夫——[写的很棒的文章，API 和 SDK 有什么区别？|作者萨沙·安德烈耶夫|媒](https://jelvix.medium.com/whats-the-difference-between-an-api-vs-an-sdk-fa4c886d78c8)

我之所以强调这一点，是因为目前只有一种方法可以使用 Alpaca API 进行部分份额订购，那就是直接向 API 发出原始请求。该功能尚未添加到 SDK 中。我相信羊驼的路线图上有将这一点添加到包装中，所以请留意这一点。

如果这是您第一次向 API 发送原始请求，请兴奋起来，并准备好学习，因为这是一件很值得学习的事情。

# 步骤 2:理解分数股 API 的约束

在我们开始进行分数份额订单之前，理解限制和约束是很重要的。有三个非常重要的原因:

*   不是所有的股票都可以用零股交易
*   只接受市价订单
*   生效时间必须是一天

## 不是所有的股票都可以用零股交易

想象一下，你有一个投资组合，你想有计划地重新平衡，你想利用零股来做到这一点。基于这一限制，确定你投资组合中的所有股票是否都可以用零股交易是非常重要的。羊驼让这变得相对容易。SDK 中的 get_asset 对象输出一个布尔值，它告诉我们一个资产是否可以被分割交易。

![](img/86342f27514c1046d5a31adf2a9ba206.png)

## 只接受市价订单

是的，很臭。有多种不同的订单类型可以通过羊驼 API 下单。此处见列表[。零股订单只接受市价订单。](https://alpaca.markets/docs/trading-on-alpaca/orders/)

## 生效时间必须是一天

这也是令人失望的，因为任何买卖订单都会在一天结束时被取消，并且必须在第二天再次下单。我也相信羊驼队已经为未来做好了准备。

以下是 AAPL 可接受的部分股份订单。这符合三个要求。这将购买价值 150 美元的 AAPL。

```
{
“symbol”: “AAPL”,
“notional”: “150”,
“side”: “buy”,
“type”: “market”,
“time_in_force”: “day”
}
```

如果你想买一小部分，比如 1.5 股 AAPL。你可以用数量代替名义数量。见下文。

```
{
“symbol”: “AAPL”,
“qty”: “1.5”,
“side”: “buy”,
“type”: “market”,
“time_in_force”: “day”
}
```

# 步骤 3:使用 Postman 测试 API 原始请求

如果你发现自己经常使用 API，你可以跳过这一节。我们将使用 Postman 来测试我们的身份验证，并用一个原始请求访问 API。Postman 确实有助于可视化流程，并且非常适合测试目的。

要开始，在这里下载邮递员。

继续创建新的集合和新的 GET 请求。

![](img/83fe9b3aff4312b1c6ee7bd2650f505a.png)

接下来，点击授权并选择不记名

![](img/d94167f6591d442db6c4ea48212ab2b9.png)

接下来，选择标题并输入您的羊驼 API 密钥和密码

![](img/a897560b1ce03696e107b20cb671aa61.png)

现在，添加 API URL 来测试我们的身份验证。以下示例使用了帐户 API。https://paper-api.alpaca.markets/v2/account

![](img/36bfa3c323084f9fb5ef97d0fb66718b.png)

太棒了。有用！现在，让我们继续尝试下单购买部分股票。我们买一万美元的间谍。首先，将请求更改为 POST，然后向请求添加正文。

![](img/bb142ad58e9eaee18e94d2c4057c27bc.png)

现在，去查查羊驼的订单。

![](img/660a1aa24578cfa63b6e77ea50e5147a.png)

太棒了。现在，让我们用 python 写这个。

# 第 4 步:编写 Python 来下零股订单

用 python 提交原始请求的过程相当简单。首先，从导入请求开始。这就是我们如何告诉 api 我们是在尝试获取数据还是发送数据。有些 API 不需要认证，但大多数都需要。我们将使用头部，并通过请求将它们传递给 API。所以，本质上我们传递三个变量给 API。

*   端点:这是 API URL，在本例中，我们使用的是 paper API。
*   数据:有些人称之为数据或主体，但我们传递的是一个包含订单指令的 json 对象。
*   头:这是我们认证的方式。我们传递 API 密钥和 API 秘密

这将返回一个包含订单信息的 json 块。

![](img/8a7bd531770dff9c8d4a43b054a5c20d.png)

现在去检查羊驼前端，看看情况如何。

![](img/4581e4069eeee1d41a7575f279867e53.png)

太好了！现在，我们可以通过无数的算法策略来利用这一点。如果我们为分数份额编写自己的包装器或函数，将会很有帮助。

# 步骤 5:为分数股 API 编写 Python 函数

这最后一步是，如果你想更容易地在你已经写的或将来要写的一些策略中应用分数共享 API 功能。为了使这变得简单一点，让我们写一个函数或者我们自己的包装器。该函数调用以下参数。

*   符号:str，必需
*   side: str，“买入”或“卖出”
*   名义值:布尔值，如果为真=名义值，如果为假=数量的一部分
*   amount: str，如果名义值为真，则为美元金额。如果名义值为假，则为数量的一部分
*   api_key: str，alpaca_api_key
*   api_secret: str，羊驼 _api_secret
*   端点:str，alpaca_endpoint_url，纸质与实时 url

现在，让我们来看看这个函数的应用。假设我们想以编程方式购买每股 20 美元的 FAANG 股票。

我们需要首先创建一个可以循环的符号列表。然后，在我们下零股订单之前，我们需要首先核实我们打算购买的股票可以用零股购买。这是通过使用 Alpaca API 包装器和 get_asset 对象来完成的。一旦检查完成，我们就可以将它输入到我们的 fractional shares 函数中，并在交易日下单，名义金额为 20 美元。

看那个。

![](img/50d15797b594652d876849d502ebc7a2.png)

现在，你可以将它与任何类型的编程或算法策略结合起来。

# 结论

过去几年，零售投资领域一直在快速变化。零股允许每个人投资股价高的公司。结合零佣金交易，你可以从几美元开始。像羊驼市场这样的整洁公司正在让对金融感兴趣的程序员和开发人员编写程序或算法进行交易变得容易。能够用原始 API 请求购买部分份额，然后能够定制一个函数，这是非常强大和令人兴奋的。

我希望这篇文章能帮助你开始下一个项目，并为你提供新的工具和想法。

一如既往，幸福楼！

*如果您喜欢这类内容，请不要忘记订阅我的个人资料，当有新文章发表时，您会收到通知！:)