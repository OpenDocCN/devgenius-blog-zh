<html>
<head>
<title>Metricbeat with local Elasticsearch and Kibana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Metricbeat 带有本地弹性搜索和 Kibana</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/metricbeat-with-local-elasticsearch-and-kibana-c330c902e473?source=collection_archive---------14-----------------------#2022-08-29">https://blog.devgenius.io/metricbeat-with-local-elasticsearch-and-kibana-c330c902e473?source=collection_archive---------14-----------------------#2022-08-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="8c3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">什么是好人？很高兴在这个系列中再次见到你😁！</p><p id="a2f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<a class="ae ki" href="https://medium.com/@mhdabdel151/discovering-kibana-685bc6cefc1" rel="noopener">的上一篇文章</a>中，我们看到我们可以使用 Kibana 进行数据可视化，也可以使用<strong class="jm io">进行监控</strong>，而无需深入细节。当您刚刚安装了 Elasticsearch 和 Kibana 后，如果您打开监控页面，您可能会看到以下屏幕:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/d3a3dff4c577e317a4c4ae493f5e8c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LzHaGoQA1d8zBhQ7z_pOw.png"/></div></div></figure><p id="e783" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Kibana 通知我们，我们还没有在集群上配置监控。这就是我们今天要做的事情，遵循以下步骤:</p><ul class=""><li id="14f4" class="kv kw in jm b jn jo jr js jv kx jz ky kd kz kh la lb lc ld bi translated">在要监控的系统上安装 Metricbeat</li><li id="8933" class="kv kw in jm b jn le jr lf jv lg jz lh kd li kh la lb lc ld bi translated">将指标发送至 Elasticsearch</li><li id="a78f" class="kv kw in jm b jn le jr lf jv lg jz lh kd li kh la lb lc ld bi translated">在 Kibana 上查看这些指标</li></ul><p id="65b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在开始之前，确保已经部署了 Elasticsearch 和 Kibana。如果不是这样，我邀请你读一读关于<a class="ae ki" href="https://medium.com/@mhdabdel151/elasticsearch-and-kibana-on-windows-lets-get-started-ff005f1fe2fc" rel="noopener">在 Windows </a>上安装 Elasticsearch 和 Kibana 的文章，或者读一读关于<a class="ae ki" href="https://medium.com/@mhdabdel151/run-elasticsearch-and-kibana-as-docker-containers-c5f5f5460afd" rel="noopener"> Docker 容器</a>的文章。</p><p id="60d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们安装 Metricbeat。为此，请访问<a class="ae ki" href="https://www.elastic.co/fr/downloads/beats/metricbeat" rel="noopener ugc nofollow" target="_blank">官方网站</a>，在那里您将找到不同的 Metricbeat 安装方法，具体取决于您的发行版。本教程是在 Elasticsearch 和 Kibana 的 Windows 部署上完成的。因此，我们必须下载<em class="lj">。zip </em>存档并解压。</p><p id="5f89" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完成后，打开配置文件<em class="lj"> metricbeat.yml </em>，它位于文件夹的根目录。需要定义一些参数。转到 O <strong class="jm io">输出部分</strong>并添加该配置以连接 Elasticsearch。</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="d957" class="lp lq in ll b gy lr ls l lt lu">output.elasticsearch:</span><span id="fa88" class="lp lq in ll b gy lv ls l lt lu">hosts: ["localhost:9200"]<br/>protocol: "https"<br/>username: "elastic"<br/>password: "your-password"</span><span id="8b6f" class="lp lq in ll b gy lv ls l lt lu">ssl:<br/>  enabled: true<br/>  ca_trusted_fingerprint: "your_fingerprint"</span></pre><p id="4e5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">自然地将这些值替换为您环境中的值。不建议在这里填写敏感信息，相反，您应该将敏感值存储在<a class="ae ki" href="https://www.elastic.co/guide/en/beats/metricbeat/8.4/keystore.html" rel="noopener ugc nofollow" target="_blank">机密密钥库中</a>。</p><p id="f321" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lj">指纹</em>是第一次启动 Elasticsearch 时生成的 CA 证书的十六进制编码 SHA-256。如果您丢失了它，不要惊慌，您总是可以使用以下命令找回它:</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="6003" class="lp lq in ll b gy lr ls l lt lu">openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt</span></pre><p id="6d38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，该命令不能在 Windows 终端上运行，您需要下载并安装<a class="ae ki" href="https://git-scm.com/download/win" rel="noopener ugc nofollow" target="_blank"> Git </a>，打开<em class="lj"> Git CMD </em>并从 Elasticsearch 根文件夹运行该命令。</p><p id="34e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">获取指纹的一个更简单的方法是打开位于 kibana 的 configs 文件夹中的<em class="lj"> kibana.yml </em>文件，在最底部你会找到你要找的东西，只需复制粘贴即可。</p><p id="f008" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Metricbeat 附带了一组实用程序来检查配置或连接是否就绪。从根文件夹中，依次运行以下命令:</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="f6bb" class="lp lq in ll b gy lr ls l lt lu">./metricbeat test config<br/>./metricbeat test output</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lw"><img src="../Images/82fedb3d8459b67bef0d2162783a7b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFy0pO3GRAUYrj7LvXN75g.png"/></div></div></figure><p id="ec36" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在一切似乎都正常了，让我们在 Metricbeat 中启用并配置<strong class="jm io"> Elasticsearch x-pack 模块</strong>。从 Metricbeat 根文件夹运行以下命令:</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="bc39" class="lp lq in ll b gy lr ls l lt lu">./metricbeat modules enable elasticsearch-xpack</span></pre><p id="56cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您应该得到如下回报:<em class="lj">启用 elasticsearch-xpack。</em></p><p id="1cb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为启用了安全性，所以需要额外的配置。所以让我们打开文件:<em class="lj">modules . d/elastic search-xpack . yml</em>并添加这些信息:</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="687f" class="lp lq in ll b gy lr ls l lt lu">- module: elasticsearch<br/>    xpack.enabled: true<br/>    period: 10s<br/>    hosts: ["https://localhost:9200"]<br/>    username: "remote_monitoring_user"<br/>    password: "your_password"<br/>    ssl:<br/>      enabled: true<br/>      ca_trusted_fingerprint:  "your_fingerprint"</span></pre><p id="4811" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里使用的是内置用户<em class="lj"> remote_monitoring_user </em>。您可以在 Kibana 的<em class="lj">堆栈管理用户</em>部分更改其默认密码。现在只要启动 Metricbeat 就大功告成了。</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="808a" class="lp lq in ll b gy lr ls l lt lu">./metricbeat -e</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lx"><img src="../Images/2d54a2adeef14b450902bc0bfabd72b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Zc-IgCBrjV0wwauIxC_kw.png"/></div></div></figure><p id="7758" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，首次安装 Metricbeat 时，名为<em class="lj"> system </em>的模块被激活。因此，您可以在<em class="lj"> modules.d/system.yml </em>文件中管理收集的指标。此外，要设置<strong class="jm io">资产</strong>来解析、索引和可视化您的数据，您可以运行以下命令:</p><pre class="kk kl km kn gt lk ll lm ln aw lo bi"><span id="b680" class="lp lq in ll b gy lr ls l lt lu">./metricbeat setup</span></pre><p id="7b29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:<code class="fe ly lz ma ll b">-e</code>是可选的，将输出发送到标准错误，而不是配置的日志输出。</p><p id="66bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦执行，您的仪表板将生成，重启 Metricbeat，欣赏 Kibana🪄.的魔力</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mb"><img src="../Images/8e1e044c1b93e9b1e3e0f50708baa9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pw4doiwRLXe-pf7E-A7VZw.png"/></div></div></figure><p id="0dcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里有太多的东西要讨论，不幸的是我们不能涵盖一切，但不要担心，其他文章很快就会出现。</p><p id="fc86" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天就到这里，请随意查看关于这个主题的<a class="ae ki" href="https://www.elastic.co/guide/en/beats/metricbeat/8.4/metricbeat-installation-configuration.html#metricbeat-installation-configuration" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多细节。感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="ebd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们下次再见，看更多的帖子🚀。</p><p id="2f7e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>