<html>
<head>
<title>Debugging with Dashbird: API Gateway Encoding not Enabled</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dashbird进行调试:API网关编码未启用</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/debugging-with-dashbird-api-gateway-encoding-not-enabled-2ad818fc29ca?source=collection_archive---------3-----------------------#2021-03-08">https://blog.devgenius.io/debugging-with-dashbird-api-gateway-encoding-not-enabled-2ad818fc29ca?source=collection_archive---------3-----------------------#2021-03-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/be004d20076e7a874ecf1098623ec640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21bVHlUbvoSnTIkPFFvqBA.png"/></div></div></figure><p id="d70f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当使用其他人创建的服务时，他们的意思往往不明显，更不用说如何修复它们了。在使用<a class="ae kt" href="https://dashbird.io/knowledge-base/api-gateway/what-is-aws-api-gateway/" rel="noopener ugc nofollow" target="_blank">亚马逊API网关</a>时，你可能会看到的<a class="ae kt" href="https://dashbird.io/event-library/" rel="noopener ugc nofollow" target="_blank">错误消息</a>之一是“<strong class="jx io">编码未启用</strong>”。</p><p id="e531" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里的第一个问题是，<strong class="jx io">这个错误信息指的是什么样的编码</strong>？第一个想法可能会进入视频或音频编码方向，并导致一个死胡同，因为你可能没有发送任何音频或视频文件。错误消息令人困惑，因为它的目的是压缩您的响应负载。</p><h1 id="7cc4" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">“API网关编码未启用”是什么意思？</h1><p id="19e4" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">当您创建一个新的API时，默认情况下内容编码将被禁用。因此，很可能您已经有一个或多个不使用该特性的API在运行。</p><p id="f650" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">根据API响应的大小，<strong class="jx io">禁用内容编码可能会导致不必要的高流量</strong>。AWS的出站流量可能会很快变得昂贵。</p><h1 id="a6f9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">如何启用API网关内容编码？</h1><p id="8517" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果您正在使用API网关控制台，您可以<strong class="jx io">简单地在您的API设置</strong>中启用内容编码。</p><p id="2723" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意，有两个“设置”菜单项。首先，你需要<strong class="jx io">选择你的API </strong>，然后你<strong class="jx io">选择那个API </strong>的设置，而不是底部API网关服务的一般设置。</p><p id="a7d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面，您可以看到一个名为“端点”的网关的突出显示的“设置”菜单项</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/7bba20d78b874635348890f5925e1f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/0*WOAvglx_c5SSM1Qs"/></div></figure><p id="67e9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用的是<a class="ae kt" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>，下面的命令将更新您的API。</p><p id="9cce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">$ aws apigateway更新-rest-api \</p><p id="9acf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">— rest-api-id <your_api_id> \</your_api_id></p><p id="7f0e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">—修补操作op=replace，path=/minimumCompressionSize，value=0</p><p id="2f5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用您想要启用内容编码的API的ID替换<your_api_id>。如果选择大于0的压缩值，低于该值的所有响应<strong class="jx io">将不会被压缩</strong>。</your_api_id></p><p id="a25c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于CloudFormation，您必须设置AWS::ApiGateway::RestApi资源的MinimumCompressionSize属性。</p><h1 id="1175" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么应该禁用内容编码？</h1><p id="b25e" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在大多数情况下，内容编码不会带来任何问题。如今压缩算法得到了优化，<strong class="jx io">几乎所有的HTTP客户端都可以使用压缩响应负载</strong>。</p><p id="9e80" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">保持禁用的一个原因是<strong class="jx io">性能</strong>。压缩你的回答不是免费的。最小响应或二进制响应通常<strong class="jx io">不会压缩得很好</strong>，所以你最好不要压缩就发送它们，通过取消压缩步骤来节省延迟。</p><p id="9b01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一个原因是<strong class="jx io">调试</strong>。如果你出于某种原因需要用WireShark之类的工具扫描一些网络帧，<strong class="jx io">禁用内容编码会给你更多的洞察力</strong>。</p><p id="5e31" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后一个原因是对<strong class="jx io">遗留浏览器</strong>的支持。如果你在一家发展缓慢的公司工作，你很可能会有一些旧版本的Internet Explorer。这可能导致压缩响应的问题，特别是当它们的<strong class="jx io">内容是已经压缩的文件</strong>时。</p><h1 id="4bd3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">摘要</h1><p id="7b51" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">内容编码是关于你的API响应的压缩，你应该考虑启用它来<strong class="jx io">节省外发AWS流量的钱</strong>。</p><p id="d3ed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您有特定的需求，比如发送难以压缩的二进制文件或者只有最小的响应负载，您可以<strong class="jx io">选择退出以挤出最后几毫秒的延迟</strong>。</p><p id="e994" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还可以使用<a class="ae kt" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>检查是否为API Gateway stages启用了内容编码功能，以压缩API有效负载。<a class="ae kt" href="https://dashbird.io/blog/introducing-well-architected-insights/" rel="noopener ugc nofollow" target="_blank">架构良好的洞察特性</a>将让您快速、轻松地了解当前设置对整个系统的影响，具体影响的是什么，以及如何应对:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/8453d8482b7b99ee92d0b74710435ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dwXz4Ox-EOuOFhrz.png"/></div></div></figure></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="500a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">延伸阅读:</p><p id="6a5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://dashbird.io/blog/malformed-lambda-proxy-response/" rel="noopener ugc nofollow" target="_blank">使用Dashbird调试:格式错误的Lambda代理响应</a></p><p id="7001" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://dashbird.io/blog/building-complex-well-architected-serverless-architectures/" rel="noopener ugc nofollow" target="_blank">构建复杂的架构良好的基础设施</a></p><p id="2e30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://dashbird.io/blog/well-architected-framework-security/" rel="noopener ugc nofollow" target="_blank"> AWS架构良好的无服务器框架:安全支柱</a></p></div></div>    
</body>
</html>