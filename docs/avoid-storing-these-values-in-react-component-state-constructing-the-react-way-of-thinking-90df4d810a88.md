# 2 情景反应状态不应用于—在反应中思考

> 原文：<https://blog.devgenius.io/avoid-storing-these-values-in-react-component-state-constructing-the-react-way-of-thinking-90df4d810a88?source=collection_archive---------4----------------------->

## 每个数据类型都有反应状态吗？

![](img/4dbfe3afaf4433fb45c158cdb4523508.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [krakenimages](https://unsplash.com/@krakenimages?utm_source=medium&utm_medium=referral) 拍摄的照片

# 简而言之，什么是状态？

React 组件状态经常被用来存储组件级的数据——你一定在想 ***这是显而易见的*** 对吗？到本文结束时，这种情况可能会改变！让我们开始吧。

# 当我开始学习如何使用反应状态时，我陷入了一个常见的错误

因为反应状态是通用的，它们可以存储任何东西，我想我可以在其中存储东西并依赖它们，这在大多数情况下会导致性能或行为方面的问题。

让我们看一些例子

# A.存储 DOM 元素

在这个代码片段中，**第 4 行中的 useState** —及其 useEffect 存储了一些 DOM 元素引用。信不信由你，我见过开发人员这样做，事实上我自己过去也这样做过。不要这样做的原因有很多，这里有两个:

1-这会占用太多的空间，特别是如果这个元素是一个容器，并且它能容纳一吨的孩子。

2- State 应该存储 UI 使用的**数据，而不是 UI 本身，它这样设计是有原因的。DOM 元素在某些变化时被呈现和重新呈现(作为用户交互或数据变化的结果)。如果您的状态持有一个被注入到 DOM 中的 UI，跟踪 DOM 元素的变化不再是 *React 的责任，*它将被视为存储在状态中的任何对象，这基本上取消了对该元素的 [React 虚拟 DOM](https://reactjs.org/docs/faq-internals.html) 引用，因为它总是从状态中检索。**

## 使用反应参考

有一种处理 DOM 元素的 React 方式叫做 [**(React Ref)**](https://reactjs.org/docs/hooks-reference.html#useref) ，它是一个 api，允许开发者引用 DOM 元素并将其注入到虚拟 DOM 中。这种方式 react 可以跟踪它们，并在发生变化时重新渲染。

# B.在状态中存储道具并从状态中访问它们

**使用状态**——第 4 行的使用效果是在状态中存储道具。你可能已经注意到在第 14 行中，我们用一些现有的道具`…props`构造了一个新的对象，然后添加了一个名为`sendMessage`的新键，然后我们将这个对象存储在一个状态变量`componentProps`中。这是我曾经犯过的一个错误，我也见过很多开发者这样做。

这样做的原因是合法的，我们在开发时几乎每天都会遇到这种情况，我们需要检查`props`中的一些东西，然后采取一些行动——在这个例子中，它添加了一个新变量`sendMessage`。

*但是*为什么我们要把所有其他的道具和这个新变量一起存储呢？。当您依赖存储在状态中的引用时，无论是在组件本身中使用它还是将它传递给其他组件，都会出现问题。正如您已经知道的，React 会在组件的道具更新时重新渲染组件。在上面的例子中，我们将`props`存储在一个状态中，任何使用该引用的组件将永远不会得到更新的`props`,如果它们得到更新的话，因此它们不会重新呈现，任何预期的 UI 更新将永远不会出现！。

## 永远不要在州内存放道具！

让我们来看看这个片段

现在我们有了来自上层作用域的道具，并且在这个组件中设置了`sendMessage`,我们可以将它们都向下传递或者/并且在这个组件中使用它们，一旦`props`被更新，任何可以访问`props`的组件都会重新渲染。我们对`sendMessage`也有完全的控制权，当我们在任何时候更新它的时候，我们都知道我们将只更新`sendMessage`，这保持了一个真实的来源，因为我们不再手动更新`props`，而是让 React 做它的工作并处理那部分。

# 结论

React 属性和状态是独立的，我们不应该在组件的状态 ***中存储属性，除非我们不依赖那些数据来呈现 UI。*** 我们还应该了解 React 虚拟 DOM 如何整体工作， ***并利用它们的 API 来增强我们的 UI*** 。

如果你正在读这篇文章，我想让你知道，我想在我的 instagram 上与你保持联系，拥有志同道合的社区总是好的。跟我来

觉得这篇文章有帮助？你可以**和别人分享**它。