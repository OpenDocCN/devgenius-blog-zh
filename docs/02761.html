<html>
<head>
<title>JavaScript Unit Test Best Practices — Edge Cases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 单元测试最佳实践—边缘案例</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/javascript-unit-test-best-practices-edge-cases-15e9f904eb87?source=collection_archive---------8-----------------------#2020-08-27">https://blog.devgenius.io/javascript-unit-test-best-practices-edge-cases-15e9f904eb87?source=collection_archive---------8-----------------------#2020-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/601ce46f076a754be6e3c4329ad8f4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dh-JAnMJJXG9Ixrx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安德鲁·休斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7b87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写 JavaScript 单元测试时应该遵循的一些最佳实践。</p><h1 id="25e4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用真实的输入数据</h1><p id="f6ea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在测试中使用真实的输入数据，这样我们才能知道我们在测试什么。</p><p id="8dcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使生成假数据变得容易，我们可以使用 Faker 包。</p><p id="a168" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它可以生成姓名、用户名、公司名称、信用卡号等等。</p><p id="45a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7309" class="mn lc iq mj b gy mo mp l mq mr">it("should add product", async () =&gt; {<br/>  const addProductResult = addProduct(faker.commerce.productName(), faker.random.number());<br/>  expect(addProductResult).to.be.true;<br/>});</span></pre><p id="2214" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个测试来添加一个具有真实名称和 ID 号的产品，以便我们可以了解结果。</p><h1 id="202f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试许多输入组合</h1><p id="96c0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该测试许多输入组合。</p><p id="ff01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们不会只选择那些我们知道会通过测试的案例。</p><p id="783a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使值随机。</p><p id="7b54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以在测试中对一些数据进行多种排列。</p><p id="7487" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，使用快速检查库，我们可以为我们的测试创建随机的数据组合:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ad70" class="mn lc iq mj b gy mo mp l mq mr">import fc from "fast-check";</span><span id="d6f3" class="mn lc iq mj b gy ms mp l mq mr">describe("Product service", () =&gt; {<br/>  describe("add new product", () =&gt; {<br/>    it("add product with various combinations successfully", () =&gt;<br/>      fc.assert(<br/>        fc.property(fc.integer(), fc.string(), (id, name) =&gt; {<br/>          expect(addNewProduct(id, name).status).toEqual("success");<br/>        })<br/>      ));<br/>  });<br/>});</span></pre><p id="2f2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用随机值<code class="fe mt mu mv mj b">id</code>和<code class="fe mt mu mv mj b">name</code>调用<code class="fe mt mu mv mj b">addnewProduct</code>，并检查返回的状态是否为<code class="fe mt mu mv mj b">'success'</code>。</p><p id="a431" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就不能操纵我们的测试只通过一些值。</p><h1 id="b5da" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">仅使用短的内联快照</h1><p id="82b0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在 or 测试中使用短的内联快照，这样我们就可以创建运行速度很快的 UI 测试。</p><p id="8d0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它们可以内联添加，那么我们知道它们会很小。</p><p id="5ced" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它太大了，以至于只能存储在一个外部文件中，那么它可能会大大降低我们测试的速度。</p><p id="f655" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="100a" class="mn lc iq mj b gy mo mp l mq mr">it("when we go to example.com, a menu is displayed", () =&gt; {<br/>  const receivedPage = renderer<br/>    .create(&lt;DisplayPage page="http://www.example.com"&gt;Example&lt;/DisplayPage&gt;)<br/>    .toJSON();</span><span id="bd05" class="mn lc iq mj b gy ms mp l mq mr">  const menu = receivedPage.content.menu;<br/>  expect(menu).toMatchInlineSnapshot(`&lt;ul&gt;<br/>    &lt;li&gt;Home&lt;/li&gt;<br/>    &lt;li&gt;Profile&lt;/li&gt;<br/>    &lt;li&gt;Logout&lt;/li&gt;<br/>  &lt;/ul&gt;`);<br/>});</span></pre><p id="bac2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们呈现<code class="fe mt mu mv mj b">DisplayPage</code>组件，然后检查我们内联创建的快照。</p><h1 id="b426" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免全局测试夹具和种子</h1><p id="8598" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该为每次测试创建数据，并在每次测试后清除它们。</p><p id="503e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们总是可以得到一个干净的测试环境。</p><p id="20c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试也不会互相依赖。</p><p id="0169" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很重要，因为当测试相互依赖时，我们会遇到问题。</p><p id="9cb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果性能成为为每个测试创建数据的一个问题，那么我们必须简化数据。</p><p id="8103" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们测试数据库交互，我们必须在每次测试后删除所有数据。</p><h1 id="49e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">预期错误</h1><p id="7845" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们预期会出现错误，那么我们会记录下应用程序中出现的错误。</p><p id="edfd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大多数 JavaScript 测试框架中，我们有这样的东西:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6ae2" class="mn lc iq mj b gy mo mp l mq mr">expect(method).toThrow())</span></pre><p id="1d98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查<code class="fe mt mu mv mj b">method</code>是否在我们做了某件事之后抛出了某个东西。</p><p id="f68b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">掩盖错误只会让错误难以被发现。</p><p id="5bf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但它仍然没有达到我们的预期。</p><p id="46a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以这样写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="db5f" class="mn lc iq mj b gy mo mp l mq mr">it("when no data provided, it throws error 400", async () =&gt; {<br/>  await expect(addUser({}))<br/>    .to.eventually.throw(AppError)<br/>    .with.property("code", "invalid input");<br/>});</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/689d2c461965ac9f5ab34da2bfffe75d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qtcwDB2SnoDQGlHG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kc" href="https://unsplash.com/@sleepmusic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">睡眠音乐</a>拍摄</figcaption></figure><h1 id="4f43" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b8bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用真实的数据进行测试。</p><p id="e33f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们使用内联快照来加快测试速度。</p><p id="ff7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还应该用多种输入进行测试。</p></div></div>    
</body>
</html>