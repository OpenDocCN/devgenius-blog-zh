<html>
<head>
<title>How to convert XML List to JSON Array in IIB (App Connect Enterprise toolkit) using ESQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用ESQL在IIB(App Connect Enterprise toolkit)将XML列表转换为JSON数组</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-convert-xml-list-to-json-array-in-iib-app-connect-enterprise-toolkit-using-esql-b495673fe838?source=collection_archive---------2-----------------------#2020-10-22">https://blog.devgenius.io/how-to-convert-xml-list-to-json-array-in-iib-app-connect-enterprise-toolkit-using-esql-b495673fe838?source=collection_archive---------2-----------------------#2020-10-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/8ecdb67cf231aea2efc0a90aca3ecd53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOunuL6yjoT9PcnVS8hQRw.png"/></div></div></figure><div class=""/><p id="2744" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以前我写过一篇关于如何在SOAP XML和REST JSON对象之间进行转换的文章，反之亦然。简而言之，它使用了如下所示的简单逻辑:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="99b8" class="lc ld iy ky b gy le lf l lg lh">— If XML is valid then will be converted to JSON </span><span id="0f0d" class="lc ld iy ky b gy li lf l lg lh">if XMLInput &lt;&gt; ‘’ then <br/>    SET OutputRoot.JSON.Data = InputRoot.XMLNSC; <br/>end if; </span><span id="2601" class="lc ld iy ky b gy li lf l lg lh">— If JSON is valid then will be converted to XML <br/>if JSONInput &lt;&gt; ‘’ then <br/>    SET OutputRoot.XMLNSC.Root = InputRoot.JSON.Data; <br/>end if;</span></pre><div class="im in gp gr io lj"><a href="https://medium.com/dev-genius/how-to-convert-between-json-and-xml-in-ibm-integration-bus-2754a837aec9" rel="noopener follow" target="_blank"><div class="lk ab fo"><div class="ll ab lm cl cj ln"><h2 class="bd iz gy z fp lo fr fs lp fu fw ix bi translated">IBM集成总线中JSON和XML之间如何转换</h2><div class="lq l"><h3 class="bd b gy z fp lo fr fs lp fu fw dk translated">消息格式之间的转换是集成软件的主要特性之一。需要这样做是因为…</h3></div><div class="lr l"><p class="bd b dl z fp lo fr fs lp fu fw dk translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx iu lj"/></div></div></a></div><p id="60f6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种转换的问题是，如果我传递一个xml列表作为输入，它将返回一个JSON对象，其中有多个同名的键值对。它不等于JSON数组，返回的JSON字符串甚至不是有效的JSON对象。因此，在本教程中，我将创建一个包装器函数，从XML列表中创建一个JSON数组。</p><h2 id="5200" class="lc ld iy bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">邮递员请求输入:</h2><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mp"><img src="../Images/8ad23d1e6a0d1eb293c93c7cc738c92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlNQhCxDVdMih8T15pkDLQ.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">图1:邮递员请求</figcaption></figure><h2 id="0a42" class="lc ld iy bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">邮递员响应输出:</h2><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/20b7f51e77a5b8852bfb22dc26ff3b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*4ZSOaKnwGzNvZ9Ouy2P-yw.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">图2:邮递员回复</figcaption></figure><p id="6c57" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这不是有效的JSON对象。实际转换应等于:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4c13ceb81cce53f3fb519912a15ba9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*dVD7RHksB6C5-rzWWpt3zg.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">图3:预期响应</figcaption></figure><p id="3400" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了实现这种转换，我们现在将相应地操作我们的代码。这是我在互联网上做了大量研究，并将两到三个不同的教程整合到我自己的解决方案中之后学到的东西。您可以根据自己的数据结构调整自己的解决方案。</p><p id="5d28" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们假设我期待我的数据结构如上所示，我想把它转换成正确的JSON对象。下面的函数将在我的场景中工作:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mw"><img src="../Images/79518993ae843c110eefe1a937d37f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2oHDrvVzEpS1qXgyGKMdA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">图4:添加JSON数组的函数</figcaption></figure><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mx"><img src="../Images/2704bdf1cf1a15f644f6a15bbb221e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zATmrw-6mmid0db6RnSOQ.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">图5:现在调用这里的新函数</figcaption></figure><h2 id="55df" class="lc ld iy bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">代码功能:</h2><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="599b" class="lc ld iy ky b gy le lf l lg lh">CREATE PROCEDURE populateSubjectsArray() BEGIN</span><span id="2000" class="lc ld iy ky b gy li lf l lg lh">-- Delete the JSON Object with multiple key-value pair with same name</span><span id="fda3" class="lc ld iy ky b gy li lf l lg lh">DELETE FIELD OutputRoot.JSON.Data.Root.Subjects;</span><span id="e9b3" class="lc ld iy ky b gy li lf l lg lh">-- Create JSON Array</span><span id="27be" class="lc ld iy ky b gy li lf l lg lh">CREATE FIELD OutputRoot.JSON.Data.Root.Subjects IDENTITY (JSON.Array)Subjects;</span><span id="4c6c" class="lc ld iy ky b gy li lf l lg lh">DECLARE X INTEGER 1;</span><span id="9445" class="lc ld iy ky b gy li lf l lg lh">DECLARE Y INTEGER;</span><span id="01f0" class="lc ld iy ky b gy li lf l lg lh">SET Y = CARDINALITY(InputRoot.XMLNSC.Root.Subjects.Subject[]);</span><span id="6150" class="lc ld iy ky b gy li lf l lg lh">WHILE X &lt;= Y DO</span><span id="6c53" class="lc ld iy ky b gy li lf l lg lh">CREATE FIELD OutputRoot.JSON.Data.Root.Subjects.Item[X] ;</span><span id="3d8a" class="lc ld iy ky b gy li lf l lg lh">-- Copy COntent</span><span id="b8e2" class="lc ld iy ky b gy li lf l lg lh">SET OutputRoot.JSON.Data.Root.Subjects.Item[X] = InputRoot.XMLNSC.Root.Subjects.Item[X];</span><span id="e18a" class="lc ld iy ky b gy li lf l lg lh">SET X = X + 1;</span><span id="3b9d" class="lc ld iy ky b gy li lf l lg lh">END WHILE;</span><span id="d12d" class="lc ld iy ky b gy li lf l lg lh">END;</span></pre><h2 id="9318" class="lc ld iy bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">让我们从Postman运行这个函数:</h2><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi my"><img src="../Images/8024923d8d1439c2df3bc60944d31ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IUJ8M0PP8JR2CZCpbpWPRg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">邮递员请求</figcaption></figure><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1f7ff175072b3357eb110adc7b05bc3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*JagrkO5sEAHmtx_puaxljQ.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">新功能实现后的邮递员响应</figcaption></figure><h1 id="a90d" class="na ld iy bd ly nb nc nd mb ne nf ng me nh ni nj mh nk nl nm mk nn no np mn nq bi translated">结论:</h1><p id="7c72" class="pw-post-body-paragraph jv jw iy jx b jy nr ka kb kc ns ke kf kg nt ki kj kk nu km kn ko nv kq kr ks ig bi translated">在本教程中，我们解释了如何使用IBM Integration Bus(App Connect/Ace Toolkit)中的ESQL将XML对象转换为JSON数组。</p><p id="7a6e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">更多关于最新技术的教程和文章，请在medium上关注我。</p><p id="1c0b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">快乐学习！！！！</p></div></div>    
</body>
</html>