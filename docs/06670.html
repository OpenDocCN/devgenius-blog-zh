<html>
<head>
<title>Calling Terraform Modules for Azure Active Directory (azuread)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为 Azure Active Directory (azuread)调用 Terraform 模块</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/calling-terraform-modules-for-azure-active-directory-azuread-3f89e4404d22?source=collection_archive---------11-----------------------#2022-01-24">https://blog.devgenius.io/calling-terraform-modules-for-azure-active-directory-azuread-3f89e4404d22?source=collection_archive---------11-----------------------#2022-01-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/686813623f14bb28f21805fff74bf9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/0*4KovVSPXQNzR_Skb.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">Terraform Azure 提供商</figcaption></figure><p id="2643" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Terraform 是最受欢迎的开源“基础设施即代码”工具之一，支持许多云提供商，如 AWS、Azure、Google Cloud 等。有了 terraform 模块，我们可以轻松地创建可重用的基础设施。</p><p id="307a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Azure AD Terraform 提供程序可以将用户、组、服务主体和应用程序作为代码进行管理。</p><p id="24a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:本文假设你非常熟悉 Terraform 和 Azure AD。</p><p id="4f5b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我为以下 azure ad 资源创建了模块，以管理 Azure Active directory 中的应用程序和服务主体:</p><p id="af20" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> azuread_application </strong> —管理 Azure Active Directory 内的应用程序注册。</p><p id="b77a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">以上模块链接:</strong></p><p id="fc76" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread-app-registration/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry . terraform . io/modules/puja go/azuread-app-registration/azure RM/latest？tab =输入</a></p><p id="8788" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">azuread _ application _ password</strong>—管理与 Azure Active Directory 中的应用程序相关联的密码凭据。在身份验证过程中，这些也称为客户端机密。</p><p id="c3ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">上述模块的链接:</strong></p><p id="3399" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread_application_password/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry . terraform . io/modules/puja go/azuread _ application _ password/azure RM/latest？tab =输入</a></p><p id="8410" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">azuread _ application _ pre _ authorized</strong>—管理预先授权了指定权限的客户端应用程序，无需用户同意即可访问应用程序的 API。</p><p id="a0dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">上述模块的链接:</strong></p><p id="cfb7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azure_ad_application_preauthorized/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry . terraform . io/modules/puja go/azure _ ad _ application _ pre authorized/azure RM/latest？tab =输入</a></p><p id="ec6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">azuread _ service _ principal—管理与 Azure Active Directory 内的应用程序相关联的服务主体。</p><p id="974c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">上述模块的链接:</strong></p><p id="7a41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread_service_principal/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry . terraform . io/modules/puja go/azuread _ service _ principal/azure RM/latest？tab =输入</a></p><p id="6e1d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我已经创建了 Terraform 代码库来使用上面的模块来创建应用程序(在最后提供了 GitHub 的链接)、范围、应用程序角色、重定向 URIs、服务主体、密码凭证、预授权客户端应用程序和 API 权限。</p><p id="4a87" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该代码创建了以下场景:</p><h1 id="747c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建授权者应用程序(web API /受众应用程序)</h1><p id="5dc1" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">授权人应用程序将创建:</p><ol class=""><li id="3d74" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated"><strong class="jx io">应用程序角色</strong>为“查询-01”。阅读`和`查询-01。写`字</li><li id="ed15" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><strong class="jx io">oauth 2 _ permission _ scope</strong>` test scope _ 01 '</li><li id="3c14" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">Microsoft Graph“user . read”权限</li><li id="61fb" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">标识符 uri(#将应用程序 uri 设置为 api// <app_id>，需要通过脚本更新，这在 terraform 中是不可能的)</app_id></li></ol><p id="864e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的代码片段使用 terraform 模块创建观众应用程序:</p><p id="4060" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread-app-registration/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/Pujago<strong class="jx io">/azuread-app-registration</strong>/azurerm/latest？tab =输入</a></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/90d11ea7ef15784fac29d45e873ce22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/0*EObo0Ht7DMFDJ6XR.png"/></div></figure><h1 id="106f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建授权的应用程序(客户端应用程序)</h1><p id="1fb8" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">客户端应用程序将创建:</p><ol class=""><li id="ea35" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">授予客户端应用程序访问上面创建的 web API 的应用程序权限</li><li id="4571" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">Microsoft Graph 用户。读取委托权限</li><li id="ac71" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">重定向 URIs 或回复 URIs，授权服务器在应用程序成功授权并获得授权码或访问令牌后发送给用户。授权服务器将代码或令牌发送到重定向 URI，因此在应用程序注册过程中注册正确的位置非常重要。</li></ol><p id="fe6d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的代码片段使用相同的 terraform 模块创建客户端应用程序:</p><p id="7757" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread-app-registration/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/Pujago/<strong class="jx io">azuread-app-registration</strong>/azure RM/latest？tab =输入</a></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/be05a5713abae38f2f4a190d571b5f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/0*xNh-XEkJsaPIoc8m.png"/></div></figure><h1 id="a0c8" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为授权者和授权应用程序创建服务主体</h1><p id="ad7f" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">受众和客户端应用程序的服务主体是使用模块创建的:</p><p id="b074" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread_service_principal/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/Pujago/<strong class="jx io">azuread _ service _ principal</strong>/azure RM/latest？tab =输入</a></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/c0deac6a34395db6c9bacbf1840b8990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*Kj1BMOXh8Z6r3gSr.png"/></div></figure><h1 id="ef69" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为客户端(授权)应用程序创建密码凭据</h1><p id="df8a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated"><strong class="jx io">为客户端应用程序创建密码凭证并存储在现有的密钥库中</strong></p><p id="0460" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">数据源用于访问有关现有密钥库的信息，代码片段用于创建密码凭据并将密码存储在密钥库中。使用模块创建密码凭据:</p><p id="fa4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azuread_application_password/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/Pujago/<strong class="jx io">azuread _ application _ password</strong>/azure RM/最新？tab =输入</a></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/92f16f87c578d4db319c6ac5d9156211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*4LrjCbNltcWSjb7M.png"/></div></figure><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/50b03afc7995c6d765a70823831e134a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*C02hGFuFphUt5rjm.png"/></div></figure><h1 id="4c9d" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">预授权客户端(授权)应用程序</h1><p id="0df9" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">客户端应用程序可以进行预授权，下面的代码片段完成了必要的使用模块:</p><p id="6200" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://registry.terraform.io/modules/Pujago/azure_ad_application_preauthorized/azurerm/latest?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/Pujago/<strong class="jx io">azure _ ad _ application _ 预授权/</strong>azure RM/最新？tab =输入</a></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/96ed756cf97d20076f19bb9deef0daec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ubVspYOKMrqdPHGK.png"/></div></figure><p id="eab4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请随意从我的 GitHub 库下载代码，网址是:</p><p id="7f9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">【https://github.com/Pujago/Terraform_Calling_module_azuread T4】</p></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><p id="6727" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mz">原载于</em><a class="ae kt" href="https://www.leogether.com/2022/01/terraform-modules-azuread-app.html" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://www.leogether.com</em></a><em class="mz">。</em></p></div></div>    
</body>
</html>