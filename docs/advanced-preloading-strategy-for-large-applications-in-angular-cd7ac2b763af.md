# 先进的预加载策略，适用于大角度应用

> 原文：<https://blog.devgenius.io/advanced-preloading-strategy-for-large-applications-in-angular-cd7ac2b763af?source=collection_archive---------1----------------------->

![](img/4dfd0b7b1fa576d2e4d210c99bf83774.png)

**城市形象由**[**Marc-Olivier Jodoin**](https://unsplash.com/@marcojodoin)**在 Unsplash 上**

在大多数应用程序中，我们需要在用户导航到特定页面之前预加载模块，以减少加载时间。在本文中，我们不会讨论 Angular 提供的内置预加载支持，或者使用预加载策略的支持。相反，我们将讨论实现一些更适合大规模应用程序的东西，以及一些渐进的和可伸缩的东西。

但是，在继续之前，让我们讨论一下通过实施预加载策略已经可用的方法的问题

angular 的 PreloadingStrategy 接口要求我们实现一个预加载方法，在自定义策略中，我们可以根据我们的路线是否有特定的布尔标志来决定，该标志要求如下所示的内容。

**问题**

1.  如果模块太多，我们必须在应用程序引导中定义我们想要预加载的内容。这将阻止网络预加载，阻止我们可能想要加载的其他资源。
2.  它将尝试使用预加载标志预加载全部，即使用户可能甚至没有访问他们的父路由。
3.  随着应用程序规模的增加，应用程序启动时会发生过多的预加载。
4.  开始时预加载这么多可能会占用太多的网络/数据，这可能不太适合移动设备用户。

让我们来看一个场景，我们有嵌套的路由，其中一些惰性加载的路由在父级，一些惰性加载的路由在惰性加载模块的子路由中，如下所示。

现在，如果我们只想在用户访问管理路由时预加载仪表板，以便仪表板模块在用户访问仪表板之前准备好，这不是预加载策略可以控制的。

因此，一般来说，我们的期望是，只有当用户访问父路由时，才在子路由上应用预加载，因为这种嵌套可以是任何级别的，并且只有在大的应用程序的情况下才有意义，无论这些应用程序在接近可能的用户旅程中是否真的需要，而不是在一开始就预加载所有决定。

因此，通过预加载策略是不可能的，我们可以通过在 AppComponent 中处理它来实现，如下所示。

因此，我们在这里做的是监听路由器的 NavigationEnd 事件，然后检查当前激活的路由的子路由。因为现在一个路由的 loadChildren 属性接受一个回调来加载一个特定的模块，如果它存在，我们可以直接调用它。

一旦父模块被激活，这将帮助我们加载所有子模块，但是只有那些没有激活保护的子模块可以被激活，但是这可以根据应用程序的要求进行更改和修改。

但是，现在假设我们只想预加载 5 个子路由中的 3 个子路由，这也可以通过调整我们的代码和路由来实现。让我们改变我们的路线如下。

如果我们仔细观察，会发现我们在数据属性中为仪表板路由添加了一个预加载标志，而这在管理路由中是没有的。因此，现在我们所期望的只是在管理路由被访问时预加载仪表板路由，并从预加载中跳过管理路由。让我们看看如何通过调整 AppComponent 中的代码来实现这一点。

我们刚刚在 if 条件中添加了对 preload 属性的检查，现在它将只预加载子路由中 preload 为 true 的子模块。

完成以上工作后，我们就两全其美了。因为现在我们只预加载不久的将来可能需要的东西，而且是渐进的和可扩展的。此外，我们不会在一开始就预加载任何东西来阻塞网络。

这个策略是定制之一，通过 PreloadStrategy 是不可能的，可以根据你的需要进行调整。

希望它有助于更好地预加载您即将到来的应用程序。