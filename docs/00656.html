<html>
<head>
<title>Communication Patterns in Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务中的通信模式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/communication-patterns-in-microservices-2de316d213cd?source=collection_archive---------20-----------------------#2020-06-13">https://blog.devgenius.io/communication-patterns-in-microservices-2de316d213cd?source=collection_archive---------20-----------------------#2020-06-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/63e42868a1eb402c17d88a4ed0005bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rppcqUb_KO9HmQxQ"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">约翰·施诺布里奇在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3aef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">微服务是一种在过去十年中流行起来的模式。有许多文章/书籍/博客/教程/视频/学习课程描述了它。在本文中，我想回顾一下行业中遵循的服务之间流行的通信实践。</p><p id="fd60" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在高层次上，微服务之间有两种主要的交互方式。</p><ol class=""><li id="cfde" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated"><strong class="kc io">同步通讯。</strong></li></ol><p id="719d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这种交互风格中，两个服务之间将进行一对一的通信，并且客户机服务期望来自服务器服务的及时响应。这可以通过使用 REST 或消息传递来实现。</p><p id="78d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">REST 是一种使用 HTTP 的进程间机制。REST 中的主要概念是，它包含一个或一组表示为资源的业务对象。使用 REST，我们可以操作(POST、PUT、DELETE)或获取(GET)资源。在开发基于 REST 的 API 时，理解 Martin Fowler 解释的<a class="ae jz" href="https://martinfowler.com/articles/richardsonMaturityModel.html." rel="noopener ugc nofollow" target="_blank"> Richardson 成熟度模型</a>非常重要。</p><p id="d7cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用基于 REST 的模型的主要好处是简单和熟悉，它不需要中间代理，这简化了系统的架构。使用基于 REST 的方法的主要缺点是它不支持发布-订阅模型。这种方法可能会降低可用性，因为在交换请求和响应期间，客户端和服务器服务都应该是可用的。在这种方法中，客户机必须知道服务器服务实例的 URL。REST APIs 应该处理网络超时和<a class="ae jz" href="https://dzone.com/articles/circuit-breaker-design-pattern-using-netflix-hystr" rel="noopener ugc nofollow" target="_blank">电路中断模式</a>。</p><p id="633b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">消息代理</strong>可用于基于同步的通信。这属于异步风格的通信，以实现服务之间的同步交互。像<a class="ae jz" href="https://eventuate.io/abouteventuatetram.html" rel="noopener ugc nofollow" target="_blank"> eventuate tram </a>这样的框架有助于以异步方式使用消息代理实现同步通信。下图显示了使用消息代理的两个服务之间的通信。</p><figure class="li lj lk ll gt jo gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/2ac4e8881447e45380ec1da00e6ab984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*7vNp-EO7qW2zZNbaTINC-g.png"/></div></figure><p id="f7be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如上图所示，客户端服务(服务 A)向消息代理中配置的通道(通道 2)发送一个带有 messageId、返回地址和有效负载的请求。该服务订阅该通道(通道 1)并接收请求。该请求包含关于需要发送响应的返回通道的信息。服务器服务(服务 B)处理请求并创建一个响应，使用该响应发送到返回通道(通道 2 ),请求中的 messageId 与 correlationId 相同。correlationId 帮助客户端服务映射其请求并相应地采取行动。</p><p id="a84e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这种方法中，即使服务器服务暂时关闭，它也会收到客户端发送的请求，客户端也会收到响应。客户端服务可以通过阻塞调用来等待服务的响应。同步通信的一个主要缺点是它在服务之间引入了紧密耦合。</p><p id="67e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果情况需要，我们应该使用它。</p><p id="5d62" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.<strong class="kc io">异步通信</strong></p><p id="9a18" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这种交互风格中，可以有两个或更多的服务作为通信的一部分。当这种通信中只涉及两个服务时，它就变成了一对一的通信，客户机服务向服务器服务发送请求，服务器服务异步回复响应。服务器服务向客户端发回响应的时间可能比平时长。在这种交互中，客户端不等待响应。这非常类似于我们上面讨论的异步风格的同步通信。这里唯一的区别是客户端不进行阻塞调用，从而使通信异步。</p><p id="ac84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">客户端可以向更多服务发布可由 0 使用的消息。</p><p id="9c27" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种类型的服务间通信是使用消息代理实现的。流行的消息代理包括 Kafka，Rabbitmq，ActiveMQ，AWS Kinesis。所有这些都支持点对点和发布-订阅通道。使用基于代理的消息传递的主要好处是松耦合、消息缓冲、灵活的通信方式。</p><p id="968a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过松散耦合，客户端服务不需要知道其他服务托管在哪里。接收服务可以在同一个网络中，也可以在完全不同的 pod 中。这有助于开发人员开发可伸缩的应用程序，而无需过多考虑依赖性。</p><p id="3ddf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基于代理的消息传递支持消息缓冲，直到消息被服务处理。</p><p id="2738" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种单点故障的一个主要缺点是。消息代理应该是高度可用的。</p><p id="4a0c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总之，两种风格都有其优点和缺点。因此，当我们设计和架构各种应用程序时，比较和对比所有可用选项并选择适合应用程序的通信方式总是好的。有可能在同一个应用程序中使用两种交互风格来解决不同的用例。</p><p id="d171" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">确认</strong></p><p id="b098" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我借用了<a class="lm ln ep" href="https://medium.com/u/f66695cce1a8?source=post_page-----2de316d213cd--------------------------------" rel="noopener" target="_blank">克里斯·理查森</a>的书《微服务模式》中的概念</p><p id="156a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在<a class="ae jz" href="https://www.linkedin.com/pulse/communication-patterns-microservices-anand-nair" rel="noopener ugc nofollow" target="_blank">https://www . LinkedIn . com/pulse/communication-patterns-micro services-Anand-Nair</a>找到同样的文章。</p></div></div>    
</body>
</html>