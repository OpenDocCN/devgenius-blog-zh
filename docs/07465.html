<html>
<head>
<title>Create an Elastic Material with Three.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Three.js 创建一个弹性材质</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-an-elastic-material-with-three-js-ea8d0a394bcf?source=collection_archive---------6-----------------------#2022-03-27">https://blog.devgenius.io/create-an-elastic-material-with-three-js-ea8d0a394bcf?source=collection_archive---------6-----------------------#2022-03-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/fdcd92fca5be180a79353acb5c63602f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*KbuSClV9bToRVEoyO57_jA.gif"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">演示，以波加曼和卡比兽为特色🐧</figcaption></figure></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><p id="3ced" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">我受到启发，想创造一种弹性材料，并想分享如何复制它。Javascript、Three.js 的知识和一些关于着色器的概念将有助于理解！</p><p id="d2af" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">上面的 snorlax/piplup 演示可以在<a class="ae la" href="https://elastic-material.vercel.app/" rel="noopener ugc nofollow" target="_blank"> <em class="lb">这里</em> </a>查看，源代码可以在<a class="ae la" href="https://github.com/arcaneCheco" rel="noopener ugc nofollow" target="_blank"> <em class="lb">这里</em> </a>获取。好吧…</p><h2 id="86ba" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">创造我们的场景</h2><p id="8256" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">这是我们的起点。一个基本的 Three.js 场景，带有一个摄像机、渲染器和一个红色平面。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="me mf l"/></div></figure></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><h2 id="76df" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">设置着色器材质</h2><p id="ce18" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">让我们用 Three.js <strong class="ke io"> ShaderMaterial 替换场景中的材质。这个类为我们提供了大部分必要的常量和属性(位置、uv、modelViewProjectionMatrices 等)。</strong></p><p id="62d3" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">创建两个新文件，<em class="lb"> fragment.glsl </em>和<em class="lb"> vertex.glsl. </em></p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="b65b" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">将文件导入到我们的脚本中，并实例化材质。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="6775" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">我们应该能再次看到我们的红色飞机。🥳</p></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><h2 id="20ed" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">使用射线投射器</h2><p id="7075" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">接下来，让我们解决交互性问题。</p><p id="a0ab" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">我们将添加一个 Three.js <strong class="ke io"> Raycaster </strong>来确定用户是否试图拖动红色平面。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="f410" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">在事件监听器的回调中，我们调用了<em class="lb"> setFromCamera </em>方法，该方法从摄像机的位置向屏幕上的指定点发射光线。该方法期望点位置被格式化为<em class="lb">标准化设备坐标</em> (NDC)，即我们的视口尺寸，映射到 range -1 = &gt; 1。</p><figure class="ma mb mc md gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/5f5a0548c21399e8d0166404b36817fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fSY0uNl4yECObBAG7gdXw.png"/></div></div></figure><p id="9f19" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">intersectObject 方法检查光线和一个对象之间的交集，我们将它作为参数传递。如果我们找到了，它将返回一个数组中的 Javascript 对象，该数组包含交叉点的位置，它的 uv 位置，到相机的距离和其他信息。我们稍后将通过制服把这个信息传递给我们的着色器。</p></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><h2 id="e1e6" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">实现拖动控件</h2><p id="4181" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">我们需要三个事件监听器来设置我们的控件，<em class="lb"> mousedown </em>、<em class="lb"> mousemove </em>和<em class="lb"> mouseup </em>。</p><p id="0bff" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">onMouseDown:</p><ul class=""><li id="8bbd" class="mm mn in ke b kf kg kj kk kn mo kr mp kv mq kz mr ms mt mu bi translated">使用光线投射器来检查用户是否点击了我们的平面。</li><li id="5540" class="mm mn in ke b kf mv kj mw kn mx kr my kv mz kz mr ms mt mu bi translated">如果是，将位置作为一个制服传递给我们的材质，并设置布尔值来显示用户当前正在拖动。</li></ul><p id="4f4e" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">onMouseMove:</p><ul class=""><li id="032e" class="mm mn in ke b kf kg kj kk kn mo kr mp kv mq kz mr ms mt mu bi translated">如果用户在拖动，使用光线投射器得到一个交点，并将其位置传递给我们的材质。因为我们的平面没有覆盖屏幕的整个视口，所以我们需要创建一个虚拟平面来覆盖屏幕的整个视口。</li></ul><p id="2747" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">onMouseUp:</p><ul class=""><li id="364c" class="mm mn in ke b kf kg kj kk kn mo kr mp kv mq kz mr ms mt mu bi translated">如果用户在拖动飞机，重置我们的布尔值来显示用户已经释放了飞机。</li></ul><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><h2 id="92cb" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">扭曲我们的飞机</h2><p id="b783" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">回到着色器。我们将修改我们的顶点着色器来扭曲我们的平面。首先，增加几何图形中高度和宽度部分的数量。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="dabb" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">使用拖动控件中的起始位置和目标位置，我们将创建一个影响范围来确定我们需要在什么位置应用多少扭曲。这应该 a)以起始位置为中心，b)在其中心最强，c)向其边缘逐渐减弱，以及 d)随着起始位置和目标位置之间的距离而增大。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="b68d" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">我们可以将扭曲传递给我们的片段着色器来可视化它。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/73888d45b9b23751e22c25b05aff829e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*4NpjgHjy4MxE83Xt_1vv3w.gif"/></div></figure><p id="3493" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">最后，使用变形创建一个偏移向量，并将其添加到我们的位置属性中:</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d9aa5cfb9ede4178e30aa76c459b14a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*5n2q3poC8mtI4VKKgSjKuw.gif"/></div></figure><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">目前为止的代码..</figcaption></figure><h2 id="2ffb" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">放</h2><p id="60ab" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">让我们添加一个动画来恢复用户释放平面时的形状。我们需要两个额外的制服，一个告诉我们控件已经被释放的变量，<em class="lb"> uDragRelease </em>，以及自释放以来的时间<em class="lb"> uDragReleaseTime。</em>我们还需要一个全局时间的制服，我们将在渲染循环中更新。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="ff13" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">修改顶点着色器以抑制扭曲。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c92ebffa71b693f56cf42bc0923bafa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*hAbe0hoJ4JufAgD-ij24Qw.gif"/></div></figure><p id="c834" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">添加一个变形，使它看起来更“有弹性”。正弦函数工作良好。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="d7b7" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">瞧..</p><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/03eca78916f32e8fba7e794add19bd24.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/1*QHeesoJyR-67nz0lpzTakw.gif"/></div></figure><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">最终沙盒</figcaption></figure></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><h2 id="c83d" class="lc ld in bd le lf lg dn lh li lj dp lk kn ll lm ln kr lo lp lq kv lr ls lt lu bi translated">更进一步</h2><p id="23d3" class="pw-post-body-paragraph kc kd in ke b kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv lz kx ky kz ig bi translated">尝试不同的释放动画，修改我们用来创建影响区域的规则，或者改变扭曲的形状。</p></div><div class="ab cl jv jw hr jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ig ih ii ij ik"><p id="71ec" class="pw-post-body-paragraph kc kd in ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ig bi translated">感谢阅读。如果你也是 WebGL 和创造性编码的粉丝，请在<a class="ae la" href="https://twitter.com/checo272" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。祝你今天开心！玩的开心！</p></div></div>    
</body>
</html>