<html>
<head>
<title>Use AWS CloudFormation to create ShardingSphere HA clusters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS CloudFormation 创建 ShardingSphere HA 集群</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/use-aws-cloudformation-to-create-shardingsphere-ha-clusters-ba0e23f234bf?source=collection_archive---------12-----------------------#2022-12-13">https://blog.devgenius.io/use-aws-cloudformation-to-create-shardingsphere-ha-clusters-ba0e23f234bf?source=collection_archive---------12-----------------------#2022-12-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="01b5" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么是 AWS CloudFormation？</h1><p id="bbf8" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae lg" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation </a>是一种基础设施即代码(IaC)服务，允许您通过自定义模板轻松建模、供应和管理<a class="ae lg" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>提供的所有云服务。</p><p id="f016" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">传统上，当我们创建一个新的架构时，我们需要在 AWS 中一步一步地手动配置它，这可能会导致一些错误，例如忘记一些步骤。</p><p id="e149" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">现在有了 CloudFormation，我们可以使用声明性配置来定义资源，然后创建和管理它们，而不用担心资源的依赖顺序。</p><p id="ec66" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">在现实世界的场景中，我们经常需要创建重复的架构。例如，我们可以在其架构和生产环境一致的预发布环境中构建一组 MQ 集群，并在每个可用性区域(AZ)中创建一个具有相同配置的<code class="fe lm ln lo lp b">AutoScalingGroup</code>。</p><p id="57e8" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">通过 CloudFormation，这些重复的架构可以以代码的形式表达，并存储在代码库中进行管理。这样，它们可以很容易地集成到现有的 CI/CD 管道中，以根据当前的 DevOps 流程实现基础架构的更改。因此，基础架构变更更加透明、可重复、可测试和可审计，简化了云系统的管理。</p><h1 id="f0a7" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么是 Apache ShardingSphere？</h1><p id="9a5b" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae lg" href="https://shardingsphere.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache ShardingSphere </a>是一个分布式数据库生态系统，它可以将任何数据库转换为分布式数据库系统，并通过分片、弹性伸缩、加密等特性增强它&amp;。</p><p id="9419" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">Apache ShardingSphere 遵循<a class="ae lg" href="https://medium.com/faun/whats-the-database-plus-concepand-what-challenges-can-it-solve-715920ba65aa?source=your_stories_page-------------------------------------" rel="noopener">数据库加</a>的概念，旨在碎片化的异构数据库之上构建一个生态系统。它侧重于如何充分利用数据库的计算和存储能力，而不是创建一个全新的数据库。</p><p id="5d80" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated"><a class="ae lg" href="https://shardingsphere.apache.org/document/current/en/overview/" rel="noopener ugc nofollow" target="_blank"> ShardingSphere-Proxy </a>是一个透明的数据库代理，支持任何使用<a class="ae lg" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>、<a class="ae lg" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>和<a class="ae lg" href="https://opengauss.org/en/" rel="noopener ugc nofollow" target="_blank"> openGauss </a>的客户端。</p><h1 id="c4aa" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">利用云编队进行部署</h1><p id="1e60" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">作为数据基础设施的重要组成部分，ShardingSphere 代理集群对于高可用性非常重要。出于这些原因，我们的社区希望您可以通过 IaC 来管理它，以享受 IaC 带来的好处。</p><p id="05ef" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">在下面几节中，我们将使用 CloudFormation 在 multi-AZ 中创建一个 ShardingSphere-Proxy 集群。在创建 CloudFormation 模板之前，我们必须理解一个 ShardingSphere-Proxy 集群的架构图。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/350d27c6894069232829ca1ebf21dc1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6fdhlwzrdxyy099vF0YAQ.png"/></div></div></figure><p id="e567" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">请注意，我们使用<a class="ae lg" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank">动物园管理员</a>作为治理中心。</p><p id="8a2c" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">如您所见，ShardingSphere-Proxy 本身是一个无状态的应用程序。在生产场景中，它只需要提供一个负载均衡器，可以在实例之间灵活地分配流量。</p><p id="8ac3" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">为了确保 ZooKeeper 集群和 ShardingSphere-Proxy 集群的 HA，我们使用以下架构。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mc"><img src="../Images/609d2cdbf5e0374fa6b72ad46c7039d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dWtypW3DAYyaaSulmhkGA.jpeg"/></div></div></figure><h1 id="0c8d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">定义云形成参数</h1><p id="ad4c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae lg" href="https://aws.amazon.com/cloudformation/resources/templates/?nc1=h_ls" rel="noopener ugc nofollow" target="_blank">cloud formation 模板</a>是一个 yaml 或 json 文件，你可以在其中定义所有的基础设施。<a class="ae lg" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html" rel="noopener ugc nofollow" target="_blank">cloud formation 参数</a>允许你将自定义值注入模板。然后，在定义资源时，您可以<a class="ae lg" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html" rel="noopener ugc nofollow" target="_blank">引用</a>这些参数。当然，我们也提供默认值，如果需要的话可以覆盖它。</p><p id="8e6e" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">我们使用<a class="ae lg" href="https://github.com/cfndsl/cfndsl" rel="noopener ugc nofollow" target="_blank"> cfndsl </a>编写 CloudFormation 模板:cfndsl 是用<a class="ae lg" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank"> ruby </a>编写的工具，允许你通过 dsl 配置生成 CloudFormation 模板。</p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="7958" class="mh jl in lp b be mi mj l mk ml">Parameter("ZookeeperInstanceType") {<br/>  String<br/>  Default "t2.nano"<br/>}<br/><br/>Parameter("ShardingSphereInstanceType") {<br/>  String<br/>  Default "t2.micro"<br/>}<br/><br/>Parameter("KeyName") {<br/>  String<br/>  Default "test-tf"<br/>  Description "The ssh keypair for remote connetcion"<br/>}<br/><br/>Parameter("ImageId") {<br/>  Type "AWS::EC2::Image::Id"<br/>  Default "ami-094bbd9e922dc515d"<br/>}<br/><br/>Parameter("VpcId") {<br/>  String<br/>  Default "vpc-0ef2b7440d3ade8d5"<br/>  Description "The id of your VPC"<br/>}<br/><br/>....</span></pre><p id="c91a" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">更多参数请参考此<a class="ae lg" href="https://github.com/apache/shardingsphere-on-cloud/blob/main/cloudformation/multi-az/cf.rb#L21" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><h1 id="6492" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">定义云形成资源</h1><p id="b94b" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">注意，AWS 的区域通常包括两个以上的 az，所以我们创建了三个实例。</p><h1 id="4c90" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">动物园管理员集群</h1><p id="2b89" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">首先，我们在每个 AZ 中部署一个 Zookeeper EC2 实例，以确保 Zookeeper 集群的 HA。</p><p id="f9bf" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">然后我们为每个 Zookeeper 实例创建一个内部域名，ShardingSphere-Proxy 使用这些域名。</p><p id="85f6" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">当 ZooKeeer 实例启动时，cloud-init 用于自动部署 Zookeeper 服务。你可以在这里查看云初始化配置<a class="ae lg" href="https://github.com/apache/shardingsphere-on-cloud/blob/main/cloudformation/multi-az/zookeeper-cloud-init.yml" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="b6c8" class="mh jl in lp b be mi mj l mk ml">(0..2).each do |i| <br/>    name = "ZK#{i+1}"<br/>    EC2_Instance(name) {<br/>      AvailabilityZone FnSelect(i, FnGetAZs(Ref("AWS::Region")))<br/>      InstanceType Ref("ZookeeperInstanceType")<br/>      ImageId Ref("ImageId")<br/>      KeyName Ref("KeyName")<br/>      SubnetId FnSelect(i, Ref("Subnets"))<br/>      SecurityGroupIds Ref("SecurityGroupIds")<br/>      Tags [ <br/>        Tag do <br/>          Key "Name"<br/>          Value "ZK-#{i+1}"<br/>        end<br/>      ]<br/><br/>      server = "server.%{idx}=zk-%{idx}.${HostedZoneName}:2888:3888"<br/>      UserData FnBase64(<br/>        FnSub(<br/>          IO.read("./zookeeper-cloud-init.yml"), <br/>          :SERVERS =&gt; FnSub((0..2).map{|i| i == 0 ? server %{:idx =&gt; i+1} : ("#{server}" %{:idx =&gt; i+1}).insert(0, " " * 4)}.join("\n")), <br/>          :VERSION =&gt; Ref("ZookeeperVersion"),<br/>          :ZK_HEAP =&gt; Ref("ZookeeperHeap"),<br/>          :INDEX =&gt; i+1,<br/>        )<br/>      )<br/>    }<br/><br/>    domain = "zone#{name}"<br/>    Route53_RecordSet(domain) {<br/>      HostedZoneId Ref("HostedZoneId")<br/>      Name FnSub("zk-#{i+1}.${HostedZoneName}")<br/>      Type "A"<br/>      ResourceRecords [FnGetAtt(name, "PrivateIp")]<br/>      TTL "60"<br/>    }<br/>  end</span></pre><h1 id="dff5" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">sharding sphere-代理集群</h1><h2 id="921f" class="mm jl in bd jm mn mo dn jq mp mq dp ju kt mr ms jy kx mt mu kc lb mv mw kg mx bi translated">启动模板</h2><p id="420a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">接下来，我们在每个 AZ 中部署一个 AutoScalingGroup，以确保 sharing sphere-Proxy 集群的 HA。</p><p id="e007" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">在创建 AutoScalingGroup 之前，我们需要在每个 AZ 中为 ShardingSphere-Proxy 实例创建一个 LaunchTemplate。</p><p id="cbca" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">类似地，当实例启动时，cloud-init 用于自动部署 ShardingSphere-Proxy 服务。你可以在这里查看云初始化配置<a class="ae lg" href="https://github.com/apache/shardingsphere-on-cloud/blob/main/cloudformation/multi-az/shardingsphere-cloud-init.yml" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="6722" class="mh jl in lp b be mi mj l mk ml">(0..2).each do |i| <br/>    name = "launchtemplate#{i}"<br/>    EC2_LaunchTemplate(name) {<br/>      LaunchTemplateName FnSub("shardingsphere-${TMPL_NAME}", :TMPL_NAME =&gt; FnSelect(i, FnGetAZs(Ref('AWS::Region'))))<br/>      LaunchTemplateData do <br/>        ImageId Ref("ImageId")<br/>        InstanceType Ref("ShardingSphereInstanceType")<br/>        KeyName Ref("KeyName")<br/><br/>        MetadataOptions do<br/>          HttpEndpoint "enabled"<br/>          HttpTokens   "required"<br/>          InstanceMetadataTags "enabled"<br/>        end<br/><br/>        Monitoring do<br/>          Enabled  true<br/>        end<br/><br/>        NetworkInterfaces [<br/>          {<br/>            :DeleteOnTermination =&gt; false,<br/>            :DeviceIndex =&gt; 0,<br/>            :NetworkInterfaceId =&gt; FnGetAtt("networkiface#{i}", "Id")<br/>          }<br/>        ]<br/>        <br/>        TagSpecifications [<br/>          {<br/>            :ResourceType =&gt; "instance",<br/>            :Tags =&gt; [<br/>              {<br/>                :Key =&gt; "Name",<br/>                :Value =&gt; "shardingsphere-#{i+1}"<br/>              }<br/>            ]<br/>          }<br/>        ]<br/><br/>        UserData FnBase64(<br/>          FnSub(<br/>            IO.read("./shardingsphere-cloud-init.yml"), <br/>            :ZK_SERVERS =&gt; FnSub((0..2).map{|i| "zk-#{i+1}.${HostedZoneName}:2181" }.join(",")), <br/>            :VERSION =&gt; Ref("ShardingSphereVersion"),<br/>            :JAVA_MEM_OPTS =&gt; Ref("ShardingSphereJavaMemOpts")<br/>          )<br/>        )<br/>      end<br/>    }<br/>  end</span></pre><h2 id="234f" class="mm jl in bd jm mn mo dn jq mp mq dp ju kt mr ms jy kx mt mu kc lb mv mw kg mx bi translated">目标组</h2><p id="dd9d" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">当我们使用<a class="ae lg" href="https://aws.amazon.com/elasticloadbalancing/" rel="noopener ugc nofollow" target="_blank"> ELB </a>来加载每个 sharing sphere-Proxy 之间的流量时，ELB 应该与<a class="ae lg" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html" rel="noopener ugc nofollow" target="_blank"> TargetGroup </a>结合使用。</p><p id="e555" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">AutoScalingGroup 创建的实例自动注册到 TargetGroup。然后，ELB 会将流量转发到目标组。</p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="cad2" class="mh jl in lp b be mi mj l mk ml">ElasticLoadBalancingV2_TargetGroup("sslbtg") {<br/>    Name "shardingsphere-lb-tg"<br/>    Port Ref("ShardingSpherePort")<br/>    Protocol "TCP"<br/>    VpcId Ref("VpcId")<br/>    TargetGroupAttributes [<br/>      TargetGroupAttribute do<br/>        Key "preserve_client_ip.enabled"<br/>        Value "false"<br/>      end<br/>    ]<br/>    Tags [<br/>      Tag do<br/>        Key "Name"<br/>        Value "shardingsphere"<br/>      end<br/>    ]<br/>  }</span></pre><h2 id="7ef9" class="mm jl in bd jm mn mo dn jq mp mq dp ju kt mr ms jy kx mt mu kc lb mv mw kg mx bi translated">自动缩放组</h2><p id="ff5b" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">创建了上述资源之后，现在我们可以创建一个 AutoScalingGroup。</p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="8d4b" class="mh jl in lp b be mi mj l mk ml">(0..2).each do |i| <br/>    name = "autoscaling#{i}"<br/>    AutoScaling_AutoScalingGroup(name) {<br/>      AutoScalingGroupName "shardingsphere-#{i}" <br/>      AvailabilityZones [FnSelect(i, FnGetAZs(Ref("AWS::Region")))]<br/>      DesiredCapacity "1"<br/>      MaxSize "1"<br/>      MinSize "1"<br/>      HealthCheckGracePeriod  60<br/>      HealthCheckType "EC2"<br/><br/>      TargetGroupARNs [ Ref("sslbtg")]<br/><br/>      LaunchTemplate do<br/>        LaunchTemplateName  FnSub("shardingsphere-${TMPL_NAME}", :TMPL_NAME =&gt; FnSelect(i, FnGetAZs(Ref('AWS::Region'))))<br/>        Version FnGetAtt("launchtemplate#{i}", "LatestVersionNumber")<br/>      end<br/>    }<br/>  end</span></pre><h2 id="0c2f" class="mm jl in bd jm mn mo dn jq mp mq dp ju kt mr ms jy kx mt mu kc lb mv mw kg mx bi translated">负载平衡器和监听器</h2><p id="b129" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">为 ShardingSphere-Proxy 集群的外部服务创建一个内部负载平衡器和监听器。</p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="bc82" class="mh jl in lp b be mi mj l mk ml">ElasticLoadBalancingV2_LoadBalancer("ssinternallb") {<br/>    Name "shardingsphere-internal-lb"<br/>    Scheme "internal"<br/>    Type "network"<br/>    <br/>    mappings = (0..2).map { |x| <br/>        SubnetMapping do<br/>          SubnetId FnSelect(x, Ref("Subnets"))<br/>        end<br/>    }<br/>    SubnetMappings mappings<br/>    Tags [<br/>      Tag do<br/>        Key "Name"<br/>        Value "shardingsphere"<br/>      end<br/>    ]<br/>  }<br/>  <br/>  ElasticLoadBalancingV2_Listener("sslblistener") {<br/>    Port Ref("ShardingSpherePort")<br/>    LoadBalancerArn Ref("ssinternallb")<br/>    Protocol "TCP"<br/>    DefaultActions [<br/>      {<br/>        :Type =&gt; "forward",<br/>        :TargetGroupArn =&gt; Ref("sslbtg")<br/>      }<br/>    ]<br/>  }</span></pre><h2 id="7976" class="mm jl in bd jm mn mo dn jq mp mq dp ju kt mr ms jy kx mt mu kc lb mv mw kg mx bi translated">内部域名</h2><p id="43b2" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">最后，我们为 ShardingSphere-Prxoy 集群的外部服务创建内部域名。这些域名指向内部负载平衡器。</p><pre class="lr ls lt lu gt md lp me bn mf mg bi"><span id="b323" class="mh jl in lp b be mi mj l mk ml">Route53_RecordSet("ssinternaldomain") {<br/>    HostedZoneId Ref("HostedZoneId")<br/>    Name FnSub("proxy.${HostedZoneName}")<br/>    Type "A"<br/>    AliasTarget do <br/>      HostedZoneId FnGetAtt("ssinternallb", "CanonicalHostedZoneID")<br/>      DNSName FnGetAtt("ssinternallb", "DNSName")<br/>      EvaluateTargetHealth true<br/>    end<br/>  }</span></pre><h1 id="5787" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">部署</h1><p id="0f72" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">使用命令<code class="fe lm ln lo lp b">cfndsl cf.rb -o cf.json --pretty</code>生成最终的<a class="ae lg" href="https://github.com/apache/shardingsphere-on-cloud/blob/main/cloudformation/multi-az/cf.json" rel="noopener ugc nofollow" target="_blank">配置</a>。</p><p id="fdc0" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">在 UI 页面上创建堆栈，并选择我们生成的配置文件。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi my"><img src="../Images/134a24528001d54494e355dde4039727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KggJabgZQA7ZaSh28aYoEA.png"/></div></div></figure><p id="7491" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">几分钟后，你会发现所有的资源都创建好了。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi my"><img src="../Images/386a0d531ed09fcbcfb3de19e0787f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47j575qZOCVqdFnZJfyyqw.png"/></div></div></figure><p id="5b5f" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">你可以在这里找到完整的代码<a class="ae lg" href="https://github.com/apache/shardingsphere-on-cloud/tree/main/cloudformation/multi-az" rel="noopener ugc nofollow" target="_blank">，或者访问我们的</a><a class="ae lg" href="https://shardingsphere.apache.org/oncloud/current/en/operation-guide/cloudformation-multi-az/" rel="noopener ugc nofollow" target="_blank">网站</a>了解更多信息。</p><h1 id="3a95" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">试验</h1><p id="a95c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">该测试旨在确保我们创建的集群是可行的。下面是一个简单的例子。</p><p id="213b" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">使用 DistSQL(分布式 SQL)添加两个数据源并创建一个简单的分片规则，然后插入数据。我们可以看到查询返回了正确的结果。</p><p id="f49c" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated">默认情况下，当我们使用 CloudFormation 时，会创建一个内部域名<code class="fe lm ln lo lp b">proxy.shardingsphere.org</code>。ShardingSphere-Proxy 集群的用户名和密码都是<code class="fe lm ln lo lp b">root</code>。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi my"><img src="../Images/6e67bee669817e11c1025eae892d0a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHv2aaSFV1ip93qWzWKW_w.png"/></div></div></figure><p id="c8ab" class="pw-post-body-paragraph ki kj in kk b kl lh kn ko kp li kr ks kt lj kv kw kx lk kz la lb ll ld le lf ig bi translated"><strong class="kk io">注:</strong> <a class="ae lg" href="https://shardingsphere.apache.org/document/current/en/user-manual/shardingsphere-proxy/distsql/" rel="noopener ugc nofollow" target="_blank"> DistSQL(分布式 SQL) </a>是 ShardingSphere 的类 SQL 操作语言。它的使用方式与标准 SQL 相同，旨在提供增量 SQL 操作功能。</p><h1 id="9f5a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="550a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">AWS CloudFormation 是一个非常强大的服务，对于 sharing sphere-Proxy 集群的迭代非常有帮助。有了这个新功能，现在开始使用 Apache ShardingSphere 比以往任何时候都容易。</p></div></div>    
</body>
</html>