<html>
<head>
<title>Implementing React Router v6 with code splitting in a React Typescript project.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Typescript项目中使用代码拆分实现React Router v6。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/implementing-react-router-v6-with-code-splitting-in-a-react-typescript-project-14d98e2cab79?source=collection_archive---------0-----------------------#2022-01-14">https://blog.devgenius.io/implementing-react-router-v6-with-code-splitting-in-a-react-typescript-project-14d98e2cab79?source=collection_archive---------0-----------------------#2022-01-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ae74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> React路由器</strong>是React中路由的标准库。它支持React应用程序中各种组件视图之间的导航，允许更改浏览器URL，并使UI与URL保持同步。</p><p id="ff46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> React路由器v5 vs v6 </strong> <br/> React路由器第6版在第5版的基础上引入了一些突破性的变化。React Router v6大量使用了<a class="ae ki" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React挂钩</a>，所以在尝试升级到React Router v6之前，您需要安装React 16.8或更高版本。</p><p id="9127" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还有一些变化像<strong class="jm io">开关</strong>，<strong class="jm io">确切的说是</strong>，<strong class="jm io">元件</strong>关键字都被去掉了。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="af36" class="ks kt in ko b gy ku kv l kw kx">//v5<br/>&lt;Switch&gt;<br/>      &lt;Route exact path="/" component={Home} /&gt;<br/>      &lt;Route path="/about" component={About} /&gt;<br/>&lt;/Switch&gt;</span><span id="5f24" class="ks kt in ko b gy ky kv l kw kx">//v6<br/>&lt;Routes&gt;<br/>      &lt;Route path="/" element={&lt;Home /&gt;} /&gt;<br/>      &lt;Route path="/about" element={&lt;About /&gt;} /&gt;<br/>&lt;/Routes&gt;</span></pre><p id="0d03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们深入研究代码。</p><ol class=""><li id="fec6" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">使用typescript模板创建react项目</li></ol><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="45d2" class="ks kt in ko b gy ku kv l kw kx">$ npx create-react-app react-router-typescript --template typescript</span></pre><p id="3f7e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.安装反应路由器dom依赖项</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="056e" class="ks kt in ko b gy ku kv l kw kx">$ cd react-router-typescript<br/>$ npm install react-router-dom</span></pre><p id="5b72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.编辑index.tsx文件。用BrowserRouter封装App组件</p><blockquote class="li lj lk"><p id="b5e9" class="jk jl ll jm b jn jo jp jq jr js jt ju lm jw jx jy ln ka kb kc lo ke kf kg kh ig bi translated">BrowserRouter是一个路由器实现，它使用HTML5历史API(pushState、replaceState和popstate事件)来保持您的UI与URL同步。它是用于存储所有其他组件的父组件。</p></blockquote><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="e9f4" class="ks kt in ko b gy ku kv l kw kx">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import App from './App';<br/>import reportWebVitals from './reportWebVitals';<br/>import { BrowserRouter } from "react-router-dom";</span><span id="9750" class="ks kt in ko b gy ky kv l kw kx">ReactDOM.render(<br/>  &lt;React.StrictMode&gt;<br/><strong class="ko io">   &lt;BrowserRouter&gt;<br/>    &lt;App /&gt;<br/>  &lt;/BrowserRouter&gt;</strong><br/>  &lt;/React.StrictMode&gt;,<br/>  document.getElementById('root')<br/>);</span><span id="8166" class="ks kt in ko b gy ky kv l kw kx">// If you want to start measuring performance in your app, pass a function<br/>// to log results (for example: reportWebVitals(console.log))<br/>// or send to an analytics endpoint. Learn more: <a class="ae ki" href="https://bit.ly/CRA-vitals" rel="noopener ugc nofollow" target="_blank">https://bit.ly/CRA-vitals</a><br/>reportWebVitals();</span></pre><p id="5ab9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.创建三个组件，Home、Topics、Settings，这三个组件将映射到我们的三个路由/、/topics和/settings。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="7e01" class="ks kt in ko b gy ku kv l kw kx"><strong class="ko io">// src/components/Home.tsx</strong><br/>const Home = () =&gt; {<br/>    return &lt;p&gt;Home&lt;/p&gt;;<br/>}<br/>export default Home;</span><span id="46c8" class="ks kt in ko b gy ky kv l kw kx"><strong class="ko io">// src/components/Settings.tsx<br/></strong>const Settings = () =&gt; {<br/>    return &lt;p&gt;Settings&lt;/p&gt;;<br/>}<br/>export default Settings;</span><span id="3d4e" class="ks kt in ko b gy ky kv l kw kx"><strong class="ko io">// src/components/Topics.tsx</strong><br/>const Topics = () =&gt; {<br/>    return &lt;p&gt;Topics&lt;/p&gt;;<br/>}<br/>export default Topics;</span></pre><p id="0a87" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.创建一个组件Main.tsx，其中包含组件的路由路径。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="83bd" class="ks kt in ko b gy ku kv l kw kx">import { Routes, Route } from 'react-router-dom';</span><span id="5e38" class="ks kt in ko b gy ky kv l kw kx">import Home from './components/Home';<br/>import Topics from './components/Topics';<br/>import Settings from './components/Settings';</span><span id="c60f" class="ks kt in ko b gy ky kv l kw kx">const Main = () =&gt; {<br/>return (         <br/>    &lt;Routes&gt;<br/>    &lt;Route path='/' element={&lt;Home/&gt;} /&gt;<br/>    &lt;Route path='/topics' element={&lt;Topics/&gt;} /&gt;<br/>    &lt;Route path='/settings' element={&lt;Settings/&gt;} /&gt;<br/>  &lt;/Routes&gt;<br/>);<br/>}<br/>export default Main;</span></pre><p id="2cdb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.编辑App.tsx</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="9da9" class="ks kt in ko b gy ku kv l kw kx">import * as React from 'react';<br/>import { Link} from 'react-router-dom';<br/>import Main from './Main';</span><span id="32d3" class="ks kt in ko b gy ky kv l kw kx">export default function App() {<br/>  return (<br/>    &lt;&gt;  <br/>      &lt;div&gt;<br/>        &lt;ul&gt;<br/>          &lt;li&gt;&lt;Link to='/'&gt;Home&lt;/Link&gt;&lt;/li&gt;<br/>          &lt;li&gt;&lt;Link to='/topics'&gt;Topics&lt;/Link&gt;&lt;/li&gt;<br/>          &lt;li&gt;&lt;Link to='/settings'&gt;Settings&lt;/Link&gt;&lt;/li&gt;<br/>        &lt;/ul&gt;<br/>        &lt;hr /&gt;<br/>        &lt;Main /&gt;       <br/>      &lt;/div&gt;   <br/>    &lt;/&gt;<br/>  )<br/>}</span></pre><p id="d082" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是react-router v6的简单实现。运行应用程序。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="c101" class="ks kt in ko b gy ku kv l kw kx">$ npm start</span></pre><p id="387d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">代码分割</strong>是webpack最引人注目的特性之一。这个特性允许您将代码分割成不同的包，然后按需或并行加载。它可以用来实现更小的包并控制资源负载优先级，如果使用正确，可以对加载时间产生重大影响。</p><p id="aa7d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，构建上面创建的代码以查看生成的代码。我们将比较构建js文件和实现代码分割后的构建文件。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="6911" class="ks kt in ko b gy ku kv l kw kx">$ npm run build<br/>$ ls build/static/js</span><span id="08a1" class="ks kt in ko b gy ky kv l kw kx">//output <br/><strong class="ko io">main.1faed537.js<br/>787.672c193d.chunk.js</strong><br/>main.1faed537.js.map<br/>787.672c193d.chunk.js.map<br/>main.1faed537.js.LICENSE.txt</span></pre><p id="cffa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了实现代码分割，我们将使用React.lazy和React。悬疑成分。</p><p id="2704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> React.lazy </strong>接受一个参数，一个调用动态导入的函数，并返回一个常规的React组件。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="1747" class="ks kt in ko b gy ku kv l kw kx">const LazyHomeComponent = React.lazy(() =&gt; import(‘./Home’));</span></pre><p id="2421" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">LazyHomeComponent的特别之处在于，React不会在需要时加载它，直到它被渲染。这意味着，如果我们将React.lazy与React Router结合起来，我们可以推迟加载任何组件，直到用户访问某个路径。</p><p id="fc8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">做出反应。悬疑<br/> </strong>由于动态导入是异步的，在组件被加载、渲染和UI显示之前，用户需要等待一段不确定的时间。要告诉React显示什么，可以使用<strong class="jm io"> React。悬念</strong>组件传递给它一个回退元素。React的好处是。悬念是悬念可以接受多个延迟加载的组件，同时仍然只呈现一个后备元素。</p><p id="f5ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">7.创建一个组件Main2.tsx，它包含我们的组件的路由路径，这些组件带有延迟加载的组件</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="4cb7" class="ks kt in ko b gy ku kv l kw kx">import * as React from 'react';<br/>import {Routes,Route } from 'react-router-dom'</span><span id="aed3" class="ks kt in ko b gy ky kv l kw kx">const Home = React.lazy(() =&gt; import('./components/Home'));<br/>const Topics = React.lazy(() =&gt; import('./components/Topics'));<br/>const Settings = React.lazy(() =&gt; import('./components/Settings'));</span><span id="8cdd" class="ks kt in ko b gy ky kv l kw kx">const Loading = () =&gt; &lt;p&gt;Loading ...&lt;/p&gt;;</span><span id="eff3" class="ks kt in ko b gy ky kv l kw kx">const Main2 = () =&gt; {<br/>return (<br/>    &lt;React.Suspense fallback={&lt;Loading /&gt;}&gt;<br/>    &lt;Routes&gt;<br/>      &lt;Route path='/' element={&lt;Home/&gt;} /&gt;<br/>      &lt;Route path='/topics' element={&lt;Topics/&gt;} /&gt;<br/>      &lt;Route path='/settings' element={&lt;Settings/&gt;} /&gt;<br/>    &lt;/Routes&gt;<br/>  &lt;/React.Suspense&gt;<br/>);<br/>}<br/>export default Main2;</span></pre><p id="8960" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">8.编辑App.tsx。用Main2组件替换主组件。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="760c" class="ks kt in ko b gy ku kv l kw kx">import * as React from 'react';<br/>import { Link} from 'react-router-dom';<br/>import Main2 from './Main2';</span><span id="1114" class="ks kt in ko b gy ky kv l kw kx">export default function App() {<br/>  return (<br/>    &lt;&gt;  <br/>      &lt;div&gt;<br/>        &lt;ul&gt;<br/>          &lt;li&gt;&lt;Link to='/'&gt;Home&lt;/Link&gt;&lt;/li&gt;<br/>          &lt;li&gt;&lt;Link to='/topics'&gt;Topics&lt;/Link&gt;&lt;/li&gt;<br/>          &lt;li&gt;&lt;Link to='/settings'&gt;Settings&lt;/Link&gt;&lt;/li&gt;<br/>        &lt;/ul&gt;<br/>        &lt;hr /&gt;<br/>        &lt;Main2 /&gt;       <br/>      &lt;/div&gt;   <br/>    &lt;/&gt;<br/>  )<br/>}</span></pre><p id="4691" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样。您可以运行该应用程序。</p><p id="79d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尝试构建应用程序来比较最终构建的js文件。</p><pre class="kj kk kl km gt kn ko kp kq aw kr bi"><span id="cf46" class="ks kt in ko b gy ku kv l kw kx">$ npm run build<br/>$ ls build/static/js</span><span id="5fe8" class="ks kt in ko b gy ky kv l kw kx">//output</span><span id="0432" class="ks kt in ko b gy ky kv l kw kx">main.9d908c9c.js<br/>787.672c193d.chunk.js<br/><strong class="ko io">444.07cb29fe.chunk.js<br/>428.54364591.chunk.js<br/>419.fac5c1c4.chunk.js</strong><br/>main.9d908c9c.js.map<br/>main.9d908c9c.js.LICENSE.txt<br/>787.672c193d.chunk.js.map<br/>444.07cb29fe.chunk.js.map<br/>428.54364591.chunk.js.map<br/>419.fac5c1c4.chunk.js.map</span></pre><p id="2e49" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">资源:</p><p id="8514" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://ui.dev/react-router-code-splitting/" rel="noopener ugc nofollow" target="_blank">https://ui.dev/react-router-code-splitting/</a>T7<a class="ae ki" href="https://webpack.js.org/guides/code-splitting/" rel="noopener ugc nofollow" target="_blank">https://webpack.js.org/guides/code-splitting/</a></p></div></div>    
</body>
</html>