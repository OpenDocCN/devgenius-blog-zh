<html>
<head>
<title>What I learned from self-hosting a Supabase Svelte project: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从自主主持 Supabase 苗条项目中学到了什么:第 2 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/what-i-learned-from-self-hosting-a-supabase-svelte-project-part-2-6fe68c15e2d?source=collection_archive---------9-----------------------#2022-12-15">https://blog.devgenius.io/what-i-learned-from-self-hosting-a-supabase-svelte-project-part-2-6fe68c15e2d?source=collection_archive---------9-----------------------#2022-12-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/60f6bc198f4a07fb29e60ffa9bc4258f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*j1fYl3rUDbtM2GIOImX4eg.png"/></div></figure><p id="6503" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在<a class="ae kp" href="https://blog.cpbprojects.me/what-i-learned-from-self-hosting-a-supabase-svelte-project-part-1" rel="noopener ugc nofollow" target="_blank">第 1 部分</a>中，我们讨论了自托管 supabase、设置 Svelte、启用第三方认证和电子邮件发送。在这篇博文中，我将谈谈我对路由、SSL、域名、本地存储以及使用 GitHub 页面托管 svelte 的了解。</p><h1 id="d417" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">使用 Nginx 路由</h1><p id="e797" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">目前，有很多程序运行在我的 VPS 的各个端口上。Supabase studio 运行在 3000 上，Svelte 运行在 5173 上，PostgreSQL 运行在 5432 端口上，Kong 运行在 8000 和 8443 上分别用于 HTTP 和。我如何将想要连接到我的前端(苗条)的用户带到端口 5173，并保护我的 Supabase studio？</p><p id="6415" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">答案是路由，我们可以设置一个路由器或反向代理，接收从 HTTP 和 HTTPS 连接的用户，即端口 80 和端口 443，并将他们路由到端口 5173，我的苗条前端。为此，我将使用 Nginx，因为这是最流行的一种。在下文中，我将总结一下我是如何让它工作的，如果你想要更详细的解释或代码示例，我推荐你看看来自 Linode 的这篇文章，我发现它很有帮助。</p><p id="371e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在 Nginx 中，我们创建一个<code class="fe lt lu lv lw b">server</code>来监听单个端口，然后我们告诉它如何基于<code class="fe lt lu lv lw b">location</code>进行重定向。位置是域名后的 URL 路径，<code class="fe lt lu lv lw b">example.com</code>的位置是<code class="fe lt lu lv lw b">/</code>,<code class="fe lt lu lv lw b">example.com/terms/</code>是<code class="fe lt lu lv lw b">^terms/(.*)$</code>。然后在这个位置，我们可以要求它重定向到某个端口，比如<code class="fe lt lu lv lw b">proxy_pass http://localhost:5173</code>，这将把从这个位置的这个端口连接的用户重定向到这个地址。</p><p id="d871" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">对于 Nginx 来说，一件重要的事情是我们必须配置哪些规则是活动的。有一个目录叫<code class="fe lt lu lv lw b">sites-available</code>，还有一个叫<code class="fe lt lu lv lw b">sites-enabled</code>。我们要做的是在<code class="fe lt lu lv lw b">sites-available</code>中配置设置，然后创建一个指向<code class="fe lt lu lv lw b">sites-enabled</code>目录的符号链接。然后我们必须重启 Nginx 服务来应用更改。要做的一件重要的事情是取消你不使用的网站的链接，我曾经忘记取消默认规则的链接，并且想知道默认规则是如何应用这么久的。</p><h1 id="55db" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取 SSL</h1><p id="49aa" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">之后，我们可以重定向 HTTP 流量，但如果我们想要 HTTPS 流量，我们需要一个 SSL 证书。它们提供可信度并加密流量。有 3 种方法可以获得证书:</p><ol class=""><li id="c7a6" class="lx ly in jt b ju jv jy jz kc lz kg ma kk mb ko mc md me mf bi translated">从可信的证书颁发机构(CA)购买，费用从每年 5 英镑到谁知道多少不等</li><li id="b9e4" class="lx ly in jt b ju mg jy mh kc mi kg mj kk mk ko mc md me mf bi translated">让一个像<a class="ae kp" href="https://www.cloudflare.com/ssl/" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>这样的代理为你做这件事，用户将使用证书连接到 Cloudflare，然后 Cloudflare 将流量重定向到你的站点，用户看到来自 Cloudflare 的证书。这是免费的个人或爱好项目。</li><li id="f7ef" class="lx ly in jt b ju mg jy mh kc mi kg mj kk mk ko mc md me mf bi translated">使用像<a class="ae kp" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank"> Certbot </a>这样的服务来生成你自己的证书，它会为你生成证书，你不需要支付一分钱。但是缺点是你必须自己配置。</li></ol><p id="dd24" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我选择了 Certbot，因为它是免费的。<a class="ae kp" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank">网站</a>包含非常详细的安装说明。拿到之后，我需要配置 Nginx 使用证书，将 HTTPS 流量重定向到我的前端，要求 HTTP 流量升级到 HTTPS 流量。</p><h1 id="456c" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">域名</h1><p id="bf6b" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">然后，我需要一个域名为我的网站，你可以认为域名基本上是一个网站的链接。我查看了提供免费 1 年 Github 学生包的三家提供商，即<em class="ml"> Namecheap </em>和<em class="ml">。技术</em>。我分析了他们提供的服务，以及 1 年免费试用后域名的价格。Namecheap 有免费试用后最便宜的域名，所以我决定用它。</p><p id="d207" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，我必须将其配置为将流量从域名重定向到我的 VPS 的 IP 地址。有不同类型的记录，你最可能使用的是 A 记录或 CNAME 记录。<em class="ml"> A 记录</em>允许您将域名或子域与 IP 地址相关联，<em class="ml"> CNAME </em>记录允许您将域名或子域指向主机名。</p><p id="3aaf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我将我想要的子域指向我的 VPS 的 IP 地址，然后将该域的 www 版本指向没有 www 部分的域。</p><h1 id="6d7f" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">存储数据</h1><p id="0ec5" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">对于网站的加密功能，我希望人们能够在本地生成一个加密密钥，并将其存储在本地。所以他们上传到服务器的数据会被加密。这使得即使网站遭到黑客攻击，黑客也无法读取加密内容。</p><p id="144f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">用户不想每次访问网站时都输入密钥，我需要一种在本地存储加密密钥的方法。我本来想用 cookies 来完成这个任务，但是后来我发现，对于每个请求，cookies 都会被发送回 web 服务器，这一点也不安全。于是我搜索了一下，现在的浏览器都有本地存储，那里的信息不会发送到 web 服务器，所以我决定用。</p><p id="b5ae" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它非常容易使用，向本地存储器写东西，你做<code class="fe lt lu lv lw b">localStorage.setItem("name", "Chris");</code>，读东西，你做<code class="fe lt lu lv lw b">let myName = localStorage.getItem("name");</code>。</p><h1 id="418e" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">苗条可以静态托管</h1><p id="9cbc" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">我不知道我怎么不知道这一点，我一直认为 Svelte 必须在 VPS 上托管，可能是因为我以前开发过 Django 应用程序，它们需要一个专用的主机。我发现这一点是因为我和一个朋友谈论我如何购买 VPS 来托管网站，他问我为什么不使用 Github 页面。我说网站需要托管，但他说不需要。我调查了一下，发现他是对的！苗条不一定要动态托管。当我们运行<code class="fe lt lu lv lw b">npm run dev</code>时，它运行开发者版本，这是动态托管的，因为它对变化做出反应。但是如果我们做了<code class="fe lt lu lv lw b">npm run build</code>，页面就建立了，并且有了<code class="fe lt lu lv lw b">dist</code>目录。然后我们可以通过任何静态站点主机进行部署，包括 Github 页面。</p><p id="2219" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">GitHub 页面可用于免费帐户的公共存储库和专业帐户的私有存储库，这是我从 GitHub 学生包中获得的。此外，GitHub 是一个大网站，所以我相信加载前端非常快，因为他们会有很好的内容交付。安全性也不是一个大问题，因为只有前端托管在那里，重要的数据保存在后端。因此，我将使用 GitHub 页面来托管我的网站。</p><h1 id="3752" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">在 GitHub 页面上托管</h1><p id="b525" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">要在 GitHub 页面上托管，如果我们想使用用户 Github 页面(<code class="fe lt lu lv lw b">username.github.io</code>)，而不是<code class="fe lt lu lv lw b">username.github.io/reponame</code>，我们需要在存储库中拥有名为<code class="fe lt lu lv lw b">username.github.io</code>的网站。然后我们可以控制部署什么，我们可以建立一个 GitHub 工作流，这是 GitHub 自动为你做一些事情，或者只是从一个分支部署。</p><p id="8e0e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了自动化这个过程，有一个名为<a class="ae kp" href="https://www.npmjs.com/package/gh-pages" rel="noopener ugc nofollow" target="_blank"> gh-pages </a>的 npm 包。它使您能够将构建的新版本部署到一个新的分支，该版本位于用于苗条项目的<code class="fe lt lu lv lw b">dist</code>文件夹中。然后，如果您配置您的 GitHub 页面来部署这个分支，它将会被自动部署。</p><p id="786c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">有一些重要的事情要设置。我们必须在<code class="fe lt lu lv lw b">package.json</code>中配置 GitHub 页面网站的主页，以及设置一个名为<code class="fe lt lu lv lw b">deploy</code>的新运行配置，它运行<code class="fe lt lu lv lw b">gh-pages -d dist</code>。如果我们使用自定义域名，我们还需要在<code class="fe lt lu lv lw b">public/</code>目录下创建一个<code class="fe lt lu lv lw b">CNAME</code>文件，内容是自定义域名。然后当我们运行<code class="fe lt lu lv lw b">npm run build</code>然后<code class="fe lt lu lv lw b">npm run deploy</code>时，我们的 GitHub 页面将被部署。</p><h1 id="b650" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结论</h1><p id="2db2" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">在这篇博文中，我讨论了自己主持 Supabase 苗条项目的经历。我介绍了用 Nginx 设置路由、用 Certbot 获得 SSL 证书、用 name price 保护域名以及在 GitHub 页面上托管项目。总的来说，我发现自己主持我的项目是一次宝贵的学习经历，它让我对虚拟主机和相关工具有了更深入的了解。</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><p id="b361" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="ml">原发布于</em><a class="ae kp" href="https://blog.cpbprojects.me/what-i-learned-from-self-hosting-a-supabase-svelte-project-part-2" rel="noopener ugc nofollow" target="_blank"><em class="ml">https://blog . CPB projects . me</em></a><em class="ml">。</em></p></div></div>    
</body>
</html>