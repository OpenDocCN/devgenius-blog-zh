<html>
<head>
<title>How to produce beautiful, well formatted Excel reports using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 生成美观、格式良好的 Excel 报表</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-produce-beautiful-well-formatted-excel-reports-using-python-fd87146a1e0e?source=collection_archive---------1-----------------------#2022-07-20">https://blog.devgenius.io/how-to-produce-beautiful-well-formatted-excel-reports-using-python-fd87146a1e0e?source=collection_archive---------1-----------------------#2022-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="1578" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用 Python、XlsxWriter、Excel </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0494cad4377f1f9c59a190d0b0f57926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AE6wzPb8nZb065oiPu74QQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Python 格式化 Excel 报表</figcaption></figure><p id="cea2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设我们收到一个从系统中提取数据的请求。我们开发一个查询，为给定的请求生成一个有效的结果集。我们将数据导出到 Excel 中，并准备好与最终用户共享。我们的任务完成了，对吧？不完全是。任何有经验的数据分析师都会告诉你，演示很重要。当创建和共享报告时，基础知识是不够的。我们希望在专业且格式良好的报告中分享我们的发现。</p><p id="f3ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Pandas 库使从数据框架生成 Excel 输出变得轻而易举。但是，当将数据导出到 Excel 时，保留格式时，它确实有一些缺点。假设我们对数字进行格式化，并对数据帧应用条件格式。当它被导出到 Excel 输出时，并非所有的格式都会被保留。我们可以利用 Python 中的<em class="ky"> XlsxWriter </em>模块来设计格式良好的 Excel 报表。</p><p id="5777" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将关注以下主题。</p><ul class=""><li id="e457" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">如何将条件格式应用于 Pandas dataframe？</li><li id="42a0" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">如何使用<em class="ky"> XlsxWriter </em>生成格式良好的 Excel 输出</li><li id="2f4c" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">比较两个输出</li></ul><p id="559b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">视频教程可以在 YouTube 上找到。</p><p id="ce1b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将介绍两种方法，首先，我们将对数据帧应用条件格式，并将其输出到 excel。在第二种方法中，我们将利用<em class="ky"> XlsxWriter </em>模块。<a class="ae ln" href="https://www.youtube.com/watch?v=uCqqGsEsIL4" rel="noopener ugc nofollow" target="_blank">这里的</a>是一个介绍<em class="ky"> XlsxWriter 的教程。</em>我们将利用本教程中的脚本，并在此基础上使用 Python 编写 Excel 中的条件格式。</p><pre class="kj kk kl km gt lo lp lq lr aw ls bi"><span id="22b7" class="lt lu in lp b gy lv lw l lx ly">import pandas as pd<br/>import xlsxwriter<br/>#<br/>url = "<a class="ae ln" href="https://github.com/hnawaz007/pythondataanalysis/blob/main/AutomateExcelReports/AdvWorksData.xlsx?raw=true" rel="noopener ugc nofollow" target="_blank">https://github.com/hnawaz007/pythondataanalysis/blob/main/AutomateExcelReports/AdvWorksData.xlsx?raw=true</a>"<br/># read from url<br/>df=pd.read_excel(url, sheet_name='Sheet1')<br/>category_sales = df.groupby(['productsubcategory','OrderDate'])[['StandardCost','UnitPriceDiscount','UnitPrice','ListPrice','OrderQuantity','Sales']].sum().sort_values(by='Sales', ascending = False).reset_index()<br/>dsf= category_sales[(category_sales['OrderDate'] == '2014-05-01')]<br/>dsf.head()</span></pre><p id="b01c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">方法一</strong></p><p id="f8bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们定义了一个基于条件突出显示数据帧行的函数。我们检查该值是否小于 1000，然后定义红色，对于大于 10000 的值定义绿色，对于所有其他值定义灰色。我们返回每一行的背景。我们将这个函数应用于我们的数据框架，并将其导出到 excel。</p><pre class="kj kk kl km gt lo lp lq lr aw ls bi"><span id="a2a7" class="lt lu in lp b gy lv lw l lx ly"><strong class="lp io">def</strong> highlight_rows(row):<br/>    value <strong class="lp io">=</strong> row<strong class="lp io">.</strong>loc['Sales']<br/>    <strong class="lp io">if</strong> value <strong class="lp io">&lt;</strong> 1000:<br/>        color <strong class="lp io">=</strong> '#FFB3BA' <em class="ky"># Red</em><br/>    <strong class="lp io">elif</strong> value <strong class="lp io">&gt;</strong> 100000:<br/>        color <strong class="lp io">=</strong> '#BAFFC9' <em class="ky"># Green</em><br/>    <strong class="lp io">else</strong>:<br/>        color <strong class="lp io">=</strong> '#FCFCFA' <em class="ky"># Grey</em><br/>    <strong class="lp io">return</strong> ['background-color: {}'<strong class="lp io">.</strong>format(color) <strong class="lp io">for</strong> r <strong class="lp io">in</strong> row]<br/># apply the function to dataframe<br/>dt <strong class="lp io">=</strong> dsf<strong class="lp io">.</strong>style<strong class="lp io">.</strong>apply(highlight_rows, axis<strong class="lp io">=</strong>1)<br/># export to excel<br/>dt<strong class="lp io">.</strong>to_excel("report.xlsx", index<strong class="lp io">=False</strong>)</span></pre><p id="79e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这会产生如下所示的 Excel 输出。我们的数据是导出的，但是，它看起来并不吸引人，需要一些调整才能使用。报告应该吸引人，平易近人。它应该提供上下文，并且应该让用户很容易使用其中提供的信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/5b3191aca702f080afa42b84798bb743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*blF3mvizYFjAE22B5R4YEg.png"/></div></figure><p id="7d05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了设计出吸引人的高质量输出，我们使用了<em class="ky"> XlsxWriter </em>。我们创建一个新闻 Excel 工作簿和工作表。通过访问工作表对象，我们可以设置输出的样式。</p><pre class="kj kk kl km gt lo lp lq lr aw ls bi"><span id="584b" class="lt lu in lp b gy lv lw l lx ly">writer <strong class="lp io">=</strong> pd<strong class="lp io">.</strong>ExcelWriter(r'G:\\test\\enhancedoutput.xlsx', engine<strong class="lp io">=</strong>'xlsxwriter')<br/>dsf<strong class="lp io">.</strong>to_excel(writer, index<strong class="lp io">=False</strong>, sheet_name<strong class="lp io">=</strong>'report')<br/><em class="ky">#</em><br/>workbook <strong class="lp io">=</strong> writer<strong class="lp io">.</strong>book<br/>worksheet <strong class="lp io">=</strong> writer<strong class="lp io">.</strong>sheets['report']<br/><em class="ky">#Now we have the worksheet object. We can manipulate it </em><br/>worksheet<strong class="lp io">.</strong>set_zoom(90)</span></pre><p id="f015" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<em class="ky"> XlsxWriter </em>我们为我们的报告设置一个标题和副标题。这为读者提供了上下文。我们格式化单元格、标题并应用条件格式来吸引用户的注意。</p><pre class="kj kk kl km gt lo lp lq lr aw ls bi"><span id="0111" class="lt lu in lp b gy lv lw l lx ly">header_format <strong class="lp io">=</strong> workbook<strong class="lp io">.</strong>add_format({<br/>        "valign": "vcenter",<br/>        "align": "center",<br/>        "bg_color": "#951F06",<br/>         "bold": <strong class="lp io">True</strong>,<br/>        'font_color': '#FFFFFF',<br/>         'border' : 1, <br/>         'border_color': ''<em class="ky">#D3D3D3'</em><br/>    })</span><span id="57fd" class="lt lu in lp b gy ma lw l lx ly"><em class="ky">#add title</em><br/>title <strong class="lp io">=</strong> "Monthly Sales Report "<br/><em class="ky">#merge cells</em><br/>format <strong class="lp io">=</strong> workbook<strong class="lp io">.</strong>add_format()<br/>format<strong class="lp io">.</strong>set_font_size(20)<br/>format<strong class="lp io">.</strong>set_font_color("#333333")<br/><em class="ky">#</em><br/>subheader <strong class="lp io">=</strong> "Sales report for May"<br/>worksheet<strong class="lp io">.</strong>merge_range('A1:AS1', title, format)<br/>worksheet<strong class="lp io">.</strong>merge_range('A2:AS2', subheader)<br/>worksheet<strong class="lp io">.</strong>set_row(2, 15) <em class="ky"># Set the header row height to 15</em><br/><em class="ky"># puting it all together</em><br/><em class="ky"># Write the column headers with the defined format.</em><br/><strong class="lp io">for</strong> col_num, value <strong class="lp io">in</strong> enumerate(dsf<strong class="lp io">.</strong>columns<strong class="lp io">.</strong>values):<br/>    <em class="ky">#print(col_num, value)</em><br/>    worksheet<strong class="lp io">.</strong>write(2, col_num, value, header_format)</span></pre><p id="2057" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们利用数字格式使其易于阅读和理解。</p><pre class="kj kk kl km gt lo lp lq lr aw ls bi"><span id="5eb5" class="lt lu in lp b gy lv lw l lx ly"><em class="ky"># Add a number format for cells with money.</em><br/>currency_format <strong class="lp io">=</strong> workbook<strong class="lp io">.</strong>add_format({'num_format': '$#,##0.00'})<br/>percent_fmt <strong class="lp io">=</strong> workbook<strong class="lp io">.</strong>add_format({'num_format': '0.0%'})<br/><em class="ky"># Numbers formatting</em><br/>worksheet<strong class="lp io">.</strong>set_column('C:C', 12, currency_format)<br/>worksheet<strong class="lp io">.</strong>set_column('E:E', 12, currency_format)<br/>worksheet<strong class="lp io">.</strong>set_column('F:F', 12, currency_format)<br/>worksheet<strong class="lp io">.</strong>set_column('H:H', 12, currency_format)<br/><em class="ky"># Percent formatting</em><br/>worksheet<strong class="lp io">.</strong>set_column('D:D', 20, percent_fmt)</span><span id="131b" class="lt lu in lp b gy ma lw l lx ly"><em class="ky"># Light red fill with dark red text.</em><br/>lessthanthousand <strong class="lp io">=</strong> workbook<strong class="lp io">.</strong>add_format({'bg_color':   '#FFC7CE','font_color': '#9C0006'})<br/>worksheet<strong class="lp io">.</strong>conditional_format('A4:H27', {'type':     'formula','criteria': '=$H4&lt;1000','format':   lessthanthousand})<br/><em class="ky"># add borders</em><br/>worksheet<strong class="lp io">.</strong>conditional_format('A4:H27', {'type':  'formula','criteria': '=$H4&lt;1000','format':   full_border})</span></pre><p id="0c72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将生成一个易于阅读和理解的格式良好的报告。它为读者提供上下文，并以专业和精心设计的方式传达信息。一份好的报告需要准确的信息和优秀的设计。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0494cad4377f1f9c59a190d0b0f57926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AE6wzPb8nZb065oiPu74QQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">XlsxWriter 输出</figcaption></figure><p id="6e4d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><ul class=""><li id="fed7" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">我们已经使用带有条件格式的 Pandas 创建了 Excel 报表输出。</li><li id="4624" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">我们已经使用 Python 和<em class="ky"> XlsxWriter </em>成功应用了条件格式。</li><li id="6bec" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">我们使用<em class="ky"> XlsxWriter </em>制作了一个格式良好的 Excel 输出</li><li id="8374" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">完整的代码可以在<a class="ae ln" href="https://github.com/hnawaz007/pythondataanalysis/blob/main/AutomateExcelReports/Excel%20Conditional%20Formatting.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到</li></ul></div></div>    
</body>
</html>