<html>
<head>
<title>Persistent State in React.js using useEffect hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React.js中使用useEffect钩子的持久状态</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/persistent-state-in-react-js-using-useeffect-hook-d6e3e7ae65f2?source=collection_archive---------1-----------------------#2020-05-21">https://blog.devgenius.io/persistent-state-in-react-js-using-useeffect-hook-d6e3e7ae65f2?source=collection_archive---------1-----------------------#2020-05-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jm jn jo jp gh gi paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gh gi jl"><img src="../Images/4115592231310731ccc31b510cb44893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rVXbF3JP7gYKhsVs"/></div></div><figcaption class="jw jx gj gh gi jy jz bd b be z dk translated"><em class="jk">照片由</em> <a class="ae ka" href="https://unsplash.com/@seanlimm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> <em class="jk">肖恩·林</em> </a> <em class="jk">上</em> <a class="ae ka" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> <em class="jk">下</em> </a></figcaption></figure><p id="a718" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我们开始之前，我知道有些人不知道持续状态的含义，这没关系，因为我会给你一个例子。你有没有开发过react应用，使用过redux、context API之类的状态管理工具，在成功管理用户状态之后，你点击了刷新？如果你以前尝试过这个，那么你知道接下来会发生什么(这里有一个小博览会；您会丢失您所在州的所有数据)。太可怕了。如果你想知道如何克服这一点，那么我劝你继续读下去。</p><h2 id="99e0" class="la lb in bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><em class="jk">先决条件</em></h2><ol class=""><li id="22bc" class="lt lu in kd b ke lv ki lw km lx kq ly ku lz ky ma mb mc md bi translated"><strong class="kd io"> <em class="kz"> React </em> </strong> <em class="kz">:我假设你已经知道React的基本知识。</em></li><li id="cbdb" class="lt lu in kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated"><strong class="kd io"><em class="kz">use effect hook</em></strong><em class="kz">:这是react hooks的一个特性，相当简单。如果你熟悉React类的生命周期方法，你可以把</em> <code class="fe mj mk ml mm b"><em class="kz">useEffect</em></code> <em class="kz">钩子想象成</em><code class="fe mj mk ml mm b"><em class="kz">componentDidMount</em></code><em class="kz"/><code class="fe mj mk ml mm b"><em class="kz">componentDidUpdate</em></code><em class="kz">和</em> <code class="fe mj mk ml mm b"><em class="kz">componentWillUnmount</em></code> <em class="kz">的组合。</em></li></ol><p id="fea7" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我们开始编码之前，让我带你看一下整个过程，因为这样的话，你会很快掌握发生了什么。</p><p id="3dfd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">首先，我们将从localStorage中检索存储的数据，并更新我们的state值。</em></p><p id="6b84" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">最后，我们将在组件更新时获取我们状态中的内容，并将其保存在我们的localStorage中。</em></p><p id="fb52" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">很简单吧？现在让我们把手弄脏。你可以在我的github</em><a class="ae ka" href="https://github.com/HarcourtHamsa/react-persisting-state" rel="noopener ugc nofollow" target="_blank"><em class="kz">repo</em></a><em class="kz">上找到源代码。</em></p><figure class="mo mp mq mr gt jp gh gi paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gh gi mn"><img src="../Images/fbcc8f0e1814ad461598338ec1863e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*heApfQWy38GD9avMLYcwtg.jpeg"/></div></div></figure><p id="1be2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在上面的代码中，我们首先使用useState钩子创建了一个名为isLoggedIn的状态。</p><blockquote class="ms mt mu"><p id="6171" class="kb kc kz kd b ke kf kg kh ki kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ky ig bi translated"><em class="in">如果你熟悉React类的生命周期方法，你可以把</em> <code class="fe mj mk ml mm b"><em class="in">useEffect</em></code> <em class="in">钩子看作是</em> <code class="fe mj mk ml mm b"><em class="in">componentDidMount</em></code> <em class="in">、</em> <code class="fe mj mk ml mm b"><em class="in">componentDidUpdate</em></code> <em class="in">和</em> <code class="fe mj mk ml mm b"><em class="in">componentWillUnmount</em></code> <em class="in">的组合。</em></p></blockquote><p id="11fd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">然后，我们检查localStorage中任何名为“is-log-in”的条目。该名称可以有所不同，并且基于我们在创建它时提供的内容。如果它存在，那么我们设置状态。</em></p><p id="bab9" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kd io"> <em class="kz">注意:localStorage只接受字符串并返回相同的值。因此我们使用JSON.stringify()和JSON.parse() </em> </strong></p><p id="f1dd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">最后，我们在组件更新时设置“is-log-in”的值。传递给localStorage.setItem()的第一个值是变量名，第二个值是变量值。</em></p><p id="4f13" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我希望你对这篇文章感兴趣，如果你觉得值得，就分享这篇文章。</p><p id="638b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><em class="kz">快乐编码:)</em></p></div></div>    
</body>
</html>