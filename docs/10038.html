<html>
<head>
<title>Laravel-Excel — P2: Importing Multiple Sheets Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">P2:导入多张工作表基础知识</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-excel-p2-importing-multiple-sheets-basics-2d20994770b?source=collection_archive---------4-----------------------#2022-10-02">https://blog.devgenius.io/laravel-excel-p2-importing-multiple-sheets-basics-2d20994770b?source=collection_archive---------4-----------------------#2022-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/afb8f4c636d8cd164aa3bb6ee87bdfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruPjJQkuiBe21t4ESl8jmg.jpeg"/></div></div></figure><p id="c89e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Excel 表将自动用 Laravel-Excel 导入。板材<code class="fe kw kx ky kz b">1</code>至<code class="fe kw kx ky kz b">N</code>的处理方式与板材<code class="fe kw kx ky kz b">0</code>完全相同。我们可以指定如何处理多个工作表，我们将在本文中这样做。</p><div class="la lb gp gr lc ld"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-excel-p1-setup-and-basic-import-1b3ddf9d9b8c"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">laravel-Excel-P1:设置和基本导入</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">在本文中，我们将讨论 laravel-excel.com 上的 laravel-excel 包。这是一项任务…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">blog.devgenius.io</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jw ld"/></div></div></a></div><h1 id="0cf9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">导入多张格式相同的表单</h1><p id="b213" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">我们将使用上一篇文章中的用户模拟数据，并创建几个 excel 表来存储用户数据。我们现在有<code class="fe kw kx ky kz b">user_data_1</code>和<code class="fe kw kx ky kz b">user_data_2</code>床单。每个工作表都存储完全相同类型的数据，都有标题(<code class="fe kw kx ky kz b">first_name</code>、<code class="fe kw kx ky kz b">last_name</code>、<code class="fe kw kx ky kz b">email</code>、<code class="fe kw kx ky kz b">password</code>)和 19 行用户数据。<code class="fe kw kx ky kz b">MOCK_DATA.xlsx</code>文件放在我们的<code class="fe kw kx ky kz b">public</code>目录中。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/160b756bb620318fa55295d4dbad5292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*kpPZn_m8hlbB_VCW85AR9Q.png"/></div></div></figure><p id="2f4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用 laravel-excel 命令创建导入程序:</p><pre class="mw mx my mz gt na kz nb nc aw nd bi"><span id="44c3" class="ne lt iq kz b gy nf ng l nh ni">php artisan make:import MultiSheetSingleFormatImport --model=User</span></pre><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="fc78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在需要我们的控制器。我们在上一篇文章中制作了控制器，所以我们将继续使用我们的<code class="fe kw kx ky kz b">UserController</code>并添加我们的方法，以便它可以调用我们的<code class="fe kw kx ky kz b">MultiSheetSingleFormatImport</code>导入器。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="40cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在只需要我们的路线，我们就可以开始测试了。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="048a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开浏览器，输入路线，让我们看看结果。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4cde" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了我们期待的结果。Laravel-Excel 从第一个工作表中读取数据并导入 19 行。自从我们添加了<code class="fe kw kx ky kz b">WithHeadingRow</code>关注点后，它跳过了第一行。一旦完成导入，它就转到下一个工作表。它再次假设第一行是标题，并从 sheet 2 中读取 19 行。</p><h1 id="b729" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">导入多张不同格式的表单</h1><p id="c736" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">如果每个工作表都有不同的格式会怎样？例如，假设工作表 1 有以下标题:</p><pre class="mw mx my mz gt na kz nb nc aw nd bi"><span id="51d9" class="ne lt iq kz b gy nf ng l nh ni">first_name | last_name | email | password</span></pre><p id="8608" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">表 2 的格式略有不同</p><pre class="mw mx my mz gt na kz nb nc aw nd bi"><span id="dc2b" class="ne lt iq kz b gy nf ng l nh ni">email | password | first_name | last_name | phone_number | dob</span></pre><p id="9deb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的进口商还能工作吗？答案是……是的！我们的导入器正在使用<code class="fe kw kx ky kz b">WithHeadingRow</code>关注点，所以它知道从哪一列选择数据。</p><p id="e38c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果工作表 2 在标题中有不同的名称会怎样？</p><pre class="mw mx my mz gt na kz nb nc aw nd bi"><span id="7f6d" class="ne lt iq kz b gy nf ng l nh ni">email_address | pass | name_first | name_last</span></pre><p id="d64f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尝试运行导入，您会看到您得到一个错误。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/84edb15645f3a20149ea7e03c72c72d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EqdYGmoFeqOkUlwbgO09oQ.png"/></div></div></figure><p id="6d46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于标题行的命名不同，我们需要指定如何处理每张工作表。我们需要创建三个不同的导入。第一个导入只是在两个表之间进行选择并调用适当的导入器，另外两个导入器将处理每一个表。让我们现在就创建这三个。</p><pre class="mw mx my mz gt na kz nb nc aw nd bi"><span id="cefa" class="ne lt iq kz b gy nf ng l nh ni">php artisan make:import MultiSheetSelector<br/>php artisan make:import FirstSheetImporter --model=User<br/>php artisan make:import SecondSheetImporter --model=User</span></pre><p id="204c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们先配置我们的<code class="fe kw kx ky kz b">FirstSheetImporter</code>和<code class="fe kw kx ky kz b">SecondSheetImporter</code>。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="0e20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我们为<code class="fe kw kx ky kz b">$row</code>指定了不同的键来匹配每张表的标题。</p><p id="2c79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要实现我们的多表选择器。Laravel-Excel 要求<code class="fe kw kx ky kz b">WithMultipleSheets</code>关注点与<code class="fe kw kx ky kz b">sheets()</code>方法一起实现。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c765" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">sheets()</code>方法返回一个导入器数组。顺序很重要。我们知道<code class="fe kw kx ky kz b">FirstSheetImporter</code>链接到第一个 Excel 表，而<code class="fe kw kx ky kz b">SecondSheetImporter</code>链接到第二个 Excel 表。</p><p id="e885" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们也可以删除<code class="fe kw kx ky kz b">collection()</code>方法和<code class="fe kw kx ky kz b">ToCollection</code>关注点，因为我们不会用这个类处理任何东西。它只是在两种进口商品中进行选择。</p><p id="9812" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只需要向我们的<code class="fe kw kx ky kz b">UserController</code>添加一个方法，并创建一个调用该方法的路由，我们就可以开始测试了。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="2d8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考验和成功的时刻到了。我们能够导入具有不同标题的两个工作表。您可以想象，如果工作表 2 需要一些额外的清理，这可以在<code class="fe kw kx ky kz b">SecondSheetImporter</code>中完成。</p><h1 id="4861" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">明确说明要导入哪些工作表</h1><p id="ee5e" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">有各种各样的可能性，其中之一是，有几个表，你想导入，但其他人，你不想导入。假设我们的 Excel 文档中有 5 张工作表。</p><ul class=""><li id="a28c" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><code class="fe kw kx ky kz b">user_data_1</code></li><li id="9de6" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><code class="fe kw kx ky kz b">user_data_1_salary</code></li><li id="fda4" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><code class="fe kw kx ky kz b">user_data_2</code></li><li id="d866" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><code class="fe kw kx ky kz b">user_data_2_salary</code></li><li id="7908" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><code class="fe kw kx ky kz b">salary_totals</code></li></ul><p id="5a1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只想从<code class="fe kw kx ky kz b">user_data_1</code>和<code class="fe kw kx ky kz b">user_data_2</code>工作表中提取数据。但是，如果我们使用现有的导入器，它将尝试从<code class="fe kw kx ky kz b">user_data_1</code>和<code class="fe kw kx ky kz b">user_data_1_salary</code>导入数据。</p><p id="9f6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要指定的唯一修改是使用哪些工作表。这可以通过纸张编号或纸张名称来完成。编号系统从<code class="fe kw kx ky kz b">0</code>开始。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="bb32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要，我们也可以使用工作表名称，用工作表名称替换索引。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><div class="la lb gp gr lc ld"><a href="https://github.com/dinocajic/package-laravel-excel" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">GitHub-dinocajic/package-Laravel-Excel:显示了 Laravel Excel 的示例功能</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">Laravel 是一个 web 应用程序框架，具有丰富、优雅的语法。我们相信发展必须是令人愉快的…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">github.com</p></div></div><div class="lm l"><div class="oa l lo lp lq lm lr jw ld"/></div></div></a></div></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/93a3abba16d47e49e379d5cfa1cb88fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V_bpQfHPnKLDJblJ.jpeg"/></div></figure><p id="33f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡伊奇目前是<a class="ae oj" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(生命周期生物科学公司)</a>、<a class="ae oj" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae oj" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae oj" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物</a>、<a class="ae oj" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae oj" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="cd55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae oj" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae oj" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae oj" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="7a81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae oj" href="https://dinocajic.medium.com/membership" rel="noopener"> <em class="ok">阅读迪诺·卡吉克(以及媒体上成千上万其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。</em> </a></p></div></div>    
</body>
</html>