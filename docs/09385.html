<html>
<head>
<title>Firebase Push Notification &amp; In-App Messaging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase 推送通知和应用内消息</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/firebase-push-notification-in-app-messaging-2782e0c19504?source=collection_archive---------3-----------------------#2022-08-18">https://blog.devgenius.io/firebase-push-notification-in-app-messaging-2782e0c19504?source=collection_archive---------3-----------------------#2022-08-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="63a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Android | Kotlin | Firebase</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/8bb975d1f2880205af177b86db34b9a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8akdFBjy5Jthar3vLnTSfA.png"/></div></div></figure><h1 id="5322" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">介绍</h1><p id="c0f4" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh ig bi translated">Firebase 云消息传递(FCM)是一个跨平台的消息传递解决方案，让您能够可靠地发送消息。使用 FCM，您可以通知客户端应用程序有新的电子邮件或其他数据可供同步。您可以发送通知消息来推动用户的再次参与和保留。</p><p id="79b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们看看如何设置 Firebase 云消息传递！..</p><h2 id="54a7" class="me lc in bd ld mf mg dn lh mh mi dp ll jv mj mk lp jz ml mm lt kd mn mo lx mp bi translated">1.设置 FCM</h2><p id="c552" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh ig bi translated"><strong class="jm io"> a .创建 firebase 帐户- </strong>要设置 firebase，我们需要首先在 firebase 控制台中创建一个帐户，创建 Firebase 帐户的链接在这里给出【https://firebase.google.com/<a class="ae mq" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"/>。在重定向到给定的链接时，您会发现一个名为“创建项目”的按钮，单击该按钮并输入项目名称。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mr"><img src="../Images/923e003f5eff925abdd1bfac11667be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KswthLGqeEmwqlQ58miFw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">Firebase 项目创建</figcaption></figure><p id="ee4d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">输入项目名称后，我们需要单击继续按钮。稍后将出现一个配置屏幕，只需接受条款和条件，然后单击继续。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mw"><img src="../Images/41c09107d3ee391e20e10a8d13abda5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6lue5lx8RwqTACyFGlEPA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">配置屏幕</figcaption></figure><p id="bdde" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> b .添加一个 android 项目- </strong>项目成功创建后，你会看到一个页面，询问你想为 Android、iOS 或 web 添加哪个应用。在我的例子中，我正在为推送通知创建一个 android 应用程序，所以我在这里选择 android。选择后，您需要添加您的应用捆绑 id 和 SHA-1 密钥，以便在 firebase 中注册您的应用。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mx"><img src="../Images/17e1a8c624c3a55a1eb38952e95a7e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9L3T16HEKSVc6Z8ylDWaPw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">选择 android 来注册应用程序</figcaption></figure><p id="aeef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">成功创建 android 项目后，您会发现一个 google-services.json 文件。下一步是下载 json 文件，并将其粘贴到 android studio 项目的以下文件夹中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi my"><img src="../Images/2b31a42c309898c6759a6daf70323247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qt9orkVJblkF3EHEqzhQSw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">Firebase json 下载路径</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/994fda7284810700037a96a3188ddd19.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*Iu6x14FIfUru0vQ9QePFGg.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">粘贴 google-service.json 的路径</figcaption></figure><h2 id="cec0" class="me lc in bd ld mf mg dn lh mh mi dp ll jv mj mk lp jz ml mm lt kd mn mo lx mp bi translated">2.在 Android Studio 中实现 FCM</h2><p id="2d0a" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh ig bi translated">在 android studio 中打开 build.gradle 文件，并添加以下依赖项，这将添加 Firebase 云消息(FCM)和应用内消息。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="311f" class="me lc in nb b gy nf ng l nh ni">implementation platform('com.google.firebase:firebase-bom:30.3.1')<br/><br/>implementation 'com.google.firebase:firebase-core'<br/>implementation 'com.google.firebase:firebase-database'<br/>// In-App Messaging<br/>implementation 'com.google.firebase:firebase-inappmessaging-display'<br/>implementation 'com.google.firebase:firebase-analytics'implementation 'com.google.guava:guava:27.0.1-android'</span><span id="68dc" class="me lc in nb b gy nj ng l nh ni">implementation 'com.google.firebase:firebase-messaging'</span></pre><p id="2038" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，创建一个名为 MessagingServices 的 kotlin 文件，并在其中实现 FirebaseMessagingService()。现在，您必须导入两个名为 onMessageReceived 和 onNewToken 的函数。</p><p id="51b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我解释一下这两个函数的功能。</p><p id="c0d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">On message received-</strong>On message received 函数传递一个名为 RemoteMessage 的参数，该参数保存了关于通知的所有信息。当通知发送到设备时，将调用此方法。当这个方法被触发时，我们需要使用 NotificationCompat 创建一个通知，并在设备上向用户显示通知。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="8ae7" class="me lc in nb b gy nf ng l nh ni">val builder = NotificationCompat.Builder(this, channelId)<br/>    .setSmallIcon(R.mipmap.<em class="nk">ic_launcher</em>)<br/>    .setContentTitle(remoteMessage.<em class="nk">data</em>["title"])<br/>    .setContentText(remoteMessage.<em class="nk">data</em>["body"])<br/>    .setLargeIcon(bmp)<br/>    .setStyle(NotificationCompat.BigPictureStyle().bigPicture(bmp))<br/>    .setAutoCancel(true)<br/>    .setContentIntent(pendingIntent)</span></pre><p id="cc80" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我正在自定义数据，并在名为标题和正文的自定义参数中发送它，这些参数将在数据对象中发送，数据将出现在 remoteMessage 对象中。下面是如何从 remoteMessage 获取数据对象</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="86d1" class="me lc in nb b gy nf ng l nh ni">remoteMessage.<em class="nk">data</em>["title"]<br/>remoteMessage.<em class="nk">data</em>["body"]</span></pre><p id="a198" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> onNewToken- </strong>当设备中的令牌被刷新时，该方法传递新令牌。大多数情况下，在第一次安装应用程序时，会有一个新的令牌。令牌将通过此功能发送给用户，因此我们可以使用令牌向用户发送推送通知。</p><p id="be35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是 MessagingService 类的完整代码。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="79e1" class="me lc in nb b gy nf ng l nh ni">class MessagingServices : FirebaseMessagingService() {<br/>    var intent: Intent? = null<br/><br/>    override fun onMessageReceived(remoteMessage: RemoteMessage) {<br/>        super.onMessageReceived(remoteMessage)<br/>            intent = Intent(<em class="nk">applicationContext</em>, MainActivity::class.<em class="nk">java</em>)<br/>            intent!!.addFlags(Intent.<em class="nk">FLAG_ACTIVITY_CLEAR_TOP</em>)<br/><br/>            var bmp: Bitmap? = null<br/>            try {<br/>                val `in` =<br/>                    URL("https://selectra.in/sites/selectra.in/files/2021-04/mobile-recharge-plans.png").openStream()<br/>                bmp = BitmapFactory.decodeStream(`in`)<br/>            } catch (e: Exception) {<br/>                e.printStackTrace()<br/>            }<br/>            val pendingIntent: PendingIntent<br/>            pendingIntent = if (Build.VERSION.<em class="nk">SDK_INT </em>&gt;= Build.VERSION_CODES.<em class="nk">S</em>) {<br/>                PendingIntent.getActivity(this, 0, intent, PendingIntent.<em class="nk">FLAG_MUTABLE</em>)<br/>            } else {<br/>                PendingIntent.getActivity(this, 0, intent, PendingIntent.<em class="nk">FLAG_UPDATE_CURRENT</em>)<br/>            }<br/>            val channelId = "Default"<br/>            val builder = NotificationCompat.Builder(this, channelId)<br/>                .setSmallIcon(R.mipmap.<em class="nk">ic_launcher</em>)<br/>                .setContentTitle(remoteMessage.<em class="nk">data</em>["title"])<br/>                .setContentText(remoteMessage.<em class="nk">data</em>["body"])<br/>                .setLargeIcon(bmp)<br/>                .setStyle(NotificationCompat.BigPictureStyle().bigPicture(bmp))<br/>                .setAutoCancel(true)<br/>                .setContentIntent(pendingIntent)<br/>            val manager = getSystemService(<em class="nk">NOTIFICATION_SERVICE</em>) as NotificationManager<br/>            if (Build.VERSION.<em class="nk">SDK_INT </em>&gt;= Build.VERSION_CODES.<em class="nk">O</em>) {<br/>                val channel = NotificationChannel(<br/>                    channelId,<br/>                    "Default channel",<br/>                    NotificationManager.<em class="nk">IMPORTANCE_DEFAULT<br/>                </em>)<br/>                manager?.createNotificationChannel(channel)<br/>            }<br/>            manager?.notify(0, builder.build())<br/>    }<br/><br/>    override fun onNewToken(token: String) {<br/>        sendRegistrationToServer(token)<br/>    }<br/><br/>    fun sendRegistrationToServer(token: String?) {<em class="nk"><br/>        </em>Log.e("FCM TOKEN", token!!);<br/>    }<br/>}</span></pre><p id="3cff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">在清单文件中声明 MessagingService 类服务- </strong></p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="1f5e" class="me lc in nb b gy nf ng l nh ni">&lt;service<br/>    android:name=".fcm.MessagingServices"<br/>    android:enabled="true"<br/>    android:exported="true"&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="com.google.firebase.MESSAGING_EVENT"/&gt;<br/><br/>    &lt;/intent-filter&gt;<br/>&lt;/service&gt;</span><span id="5438" class="me lc in nb b gy nj ng l nh ni">&lt;receiver<br/>    android:name="com.google.firebase.iid.FirebaseInstanceIdReceiver"<br/>    android:enabled="true"<br/>    android:exported="true"<br/>    android:permission="com.google.android.c2dm.permission.SEND" &gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="com.google.android.c2dm.intent.RECEIVE" /&gt;<br/>    &lt;/intent-filter&gt;<br/>&lt;/receiver&gt;</span></pre><p id="d410" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您可以从 Firebase messaging 或通过任何其他来源发送推送通知，您将在设备中接收通知。我已经使用 PendingIntent 将通知重定向到 MainActivity。您可以将通知重定向到任何所需的活动，也可以选择不重定向。</p><h2 id="f491" class="me lc in bd ld mf mg dn lh mh mi dp ll jv mj mk lp jz ml mm lt kd mn mo lx mp bi translated">3.应用内消息</h2><p id="3164" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh ig bi translated">Firebase 还提供了一个称为应用内消息的功能，可以帮助用户与应用进行交互。当用户使用应用时，会向他们发送一个定制的对话框，它会显示在应用中任何屏幕的顶部。该通知将从 Firebase 控制台或任何其他方式发送，它可以包含图像，标题和描述，并可以按照用户的要求定制。</p><p id="08c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">集成应用内消息传递非常简单，我们只需要在 app.gradle 文件中添加依赖项，其他工作将由 FCM 负责。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="aa83" class="me lc in nb b gy nf ng l nh ni">implementation 'com.google.firebase:firebase-inappmessaging-display'</span></pre><p id="a34e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">在 firebase 控制台上发送应用内通知-</strong>-&gt;云消息屏幕。点击新的活动，你可能会发现两个选项命名为通知和应用内消息。选择应用内消息，它将被重定向到如下所示的屏幕。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/39cb24984080e51df15dcebe1bc7d1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*uZThAx3_KlT6nnZQxE9GuA.png"/></div></figure><p id="cfd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">填写适当的细节，如选择你想在应用程序上显示的模型或布局，标题，描述，图像链接，按钮文本和颜色。您也可以只显示图像或只显示标题和描述。这完全取决于你想如何让你的客户保持活跃。</p><p id="84be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">稍后，选择目标设备，这基本上是选择您的目标应用捆绑包，并安排您希望显示通知的时间，可以是特定的日期和时间，也可以现在安排。现在通知已准备好发布，当应用程序打开时，您将在应用程序上找到通知，因为它是前台通知。</p><p id="ae19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是推送通知和应用内消息的全部内容。</p><p id="397e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编码快乐！..</p></div></div>    
</body>
</html>