<html>
<head>
<title>Deploy application on Azure Kubernetes Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Azure Kubernetes 服务上部署应用程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploy-application-on-azure-kubernetes-service-fb51070f4f51?source=collection_archive---------5-----------------------#2022-11-21">https://blog.devgenius.io/deploy-application-on-azure-kubernetes-service-fb51070f4f51?source=collection_archive---------5-----------------------#2022-11-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d77d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将演示如何在 AKS (Azure Kubernetes 服务)中部署 web 应用程序。</p><p id="b702" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Azure Kubernetes 服务</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fa493021fbe08bfa852f4088b5da6af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRd_vLThUJ3kcEp49CID4w.png"/></div></div></figure><p id="a24d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Azure Kubernetes 服务是一种基于开源 Kubernetes 系统的托管容器编排服务，可在微软 Azure 公共云上获得。组织可以使用 AKS 来处理关键功能，例如部署、扩展和管理 Docker 容器和基于容器的应用程序。</p><p id="3dde" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">蔚蓝集装箱注册处</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/b95205a0d79606d092a12fca4c80964a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_ypMqRLb6CkDCZQrX4dxwg.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Azure 容器注册表</figcaption></figure><p id="d224" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Azure Container Registry 是一个私有的注册服务，用于构建、存储和管理容器图像和相关工件。在这个快速入门中，您将使用 Azure 门户创建一个 Azure 容器注册实例。</p><p id="d03c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们将把我们的图像放入容器注册表:</p><pre class="kj kk kl km gt kz la lb bn lc ld bi"><span id="7e2e" class="le lf in la b be lg lh l li lj">docker push myprivaterepo.azurecr.io/client<br/>docker push myprivaterepo.azurecr.io/server</span></pre><p id="f1e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们可以看到我们的映像被成功地推送到远程注册表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lk"><img src="../Images/55c4f5cfdadcc1d4ca2fb7f4f7c07fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3gsQkAqSTO7tNnndDxijg.png"/></div></div></figure><p id="a475" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">创建我们的 Kubernetes 集群</strong></p><p id="541f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在要创建我们的集群，我们连接到 azure 门户，然后我们搜索 kubernetes 服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ll"><img src="../Images/83d41c6d54e7adf2f87a5ba852f85993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t0te_-NCq7yO7CnD_i84Pg.png"/></div></div></figure><p id="7503" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于主页面，我们设置资源组和集群名称。对于节点代理，我们将其设置为 Standard_B2s，这是可用的最便宜的代理:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lm"><img src="../Images/51805b906d8551faf382a3cc0118db3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHNPlRjV8zm8bfMXHviw5w.png"/></div></div></figure><p id="3e9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于集群内部的联网，我们使用默认的 Kubenete 网络配置和 Calico 来实现 pod 和服务之间的连接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ln"><img src="../Images/7c10e8641392b0d710c870770ac9cb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLHuVdqWC_Oq8VCXNNDitg.png"/></div></div></figure><p id="5e93" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们将 docker 注册表连接到集群，以便我们可以提取图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lo"><img src="../Images/4ea88b6332977acca1c772436584a5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*59giraSf_RJLX_lIH6JGPQ.png"/></div></div></figure><p id="e520" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们点击创建。</p><p id="bc31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">部署应用</strong></p><p id="c4fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们需要连接到集群</p><pre class="kj kk kl km gt kz la lb bn lc ld bi"><span id="d8e1" class="le lf in la b be lg lh l li lj">az account set --subscription ####################<br/>az aks get-credentials --resource-group aks-rg1 --name mk-aks</span></pre><p id="1750" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用以下方式部署我们的部署和服务:</p><pre class="kj kk kl km gt kz la lb bn lc ld bi"><span id="eaf5" class="le lf in la b be lg lh l li lj"> kubectl apply -f .\client-deploy.yaml<br/> kubectl apply -f .\server-deploy.yaml<br/> kubectl apply -f .\client-svc.yaml<br/> kubectl apply -f .\server-svc.yaml</span></pre><blockquote class="lp lq lr"><p id="95c1" class="jk jl ls jm b jn jo jp jq jr js jt ju lt jw jx jy lu ka kb kc lv ke kf kg kh ig bi translated">注意:我们将使用公共云负载均衡器来实现我们的前端服务于互联网。</p></blockquote><h2 id="9c14" class="lw lf in bd lx ly lz dn ma mb mc dp md jv me mf mg jz mh mi mj kd mk ml mm mn bi translated">Nginx 反向代理:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/940fb3eccb184325667653b0d578c271.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*QHrIz-Zm8TU_INJyJOmbbw.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">nginx</figcaption></figure><p id="efad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了将 API 请求转发到我们的 ClusterIP 后端，我们将使用一个 nginx 服务器作为反向代理。</p><p id="9ace" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">反向代理</strong>是位于后端应用程序前面的应用程序，它将客户端(例如浏览器)请求转发给这些应用程序。反向代理有助于提高可扩展性、性能、弹性和安全性。返回给客户端的资源看起来好像是来自 web 服务器本身。</p><p id="c137" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的 nginx.conf:</p><pre class="kj kk kl km gt kz la lb bn lc ld bi"><span id="9cc2" class="le lf in la b be lg lh l li lj">server {<br/>    listen 80;<br/><br/>    location /api {<br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection "upgrade";<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>        proxy_pass http://${API}:${PORT}/api; <br/>    }<br/><br/>    location / {<br/>        root /usr/share/nginx/html;<br/>        index index.html index.htm;<br/>        try_files $uri $uri/ /index.html;<br/>    }<br/><br/>    error_page 500 502 503 504 /50x.html;<br/><br/>    location = 50x.html {<br/>        root /usr/share/nginx/html;<br/>    }<br/>}</span></pre><p id="b638" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个配置中，每个对“/api”的请求都会被转发到“<a class="ae mp" href="http://${API}:${PORT}/api" rel="noopener ugc nofollow" target="_blank">http://$ { API }:$ { PORT }/API</a>”。例如，请求 a /api/user 将被转发到<a class="ae mp" href="http://${API}:${PORT}/api" rel="noopener ugc nofollow" target="_blank">http://$ { API }:$ { PORT }/API</a>/user。</p><h2 id="3cba" class="lw lf in bd lx ly lz dn ma mb mc dp md jv me mf mg jz mh mi mj kd mk ml mm mn bi translated">测试事物:</h2><p id="0547" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">因此，我们的服务现在可用，我们可以看到为我们的前端应用程序提供服务的负载平衡器的公共 IP:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/8b4549841ce3f3aefb4d0d4e18cfac59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoqxkyODcaKDbJMRFMS50g.png"/></div></div></figure><p id="4a57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们访问它，我们的应用程序成功运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/1e54bff82aee5552922b7be9fffc4dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BppHDjvoUoDmWZQ8xBd-bw.png"/></div></div></figure><p id="551e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们尝试创建帐户并登录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/ff2d3c9cdb284f87dab425f05c95e508.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*IHeBFrl1hv9kD3VaTGnelg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/815f53fd9eb544f86ff65603b6f3c879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nUumO_8ZYF2gykK30tn_Q.png"/></div></div></figure><p id="4e63" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们创建一个新用户来测试我们的 API:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/3b418b4853d6ceb7009af5501ced1d34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1ntuz-a919lrOqXolwm7A.png"/></div></div></figure><p id="c0da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的应用编程接口成功地:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/4454ce601c13e259d458dc432a5228cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo4e7XRxZ2wZy7gSrMHREA.png"/></div></div></figure><p id="f1d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望您喜欢阅读这篇文章，并且您已经学习了如何使用 Azure Kubernetes 服务部署完整的堆栈 web 应用程序。</p></div></div>    
</body>
</html>