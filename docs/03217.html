<html>
<head>
<title>Utilize configuration XML and variables scope</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用配置XML和变量范围</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/utilize-configuration-xml-and-variables-scope-e74011371c0d?source=collection_archive---------2-----------------------#2020-10-13">https://blog.devgenius.io/utilize-configuration-xml-and-variables-scope-e74011371c0d?source=collection_archive---------2-----------------------#2020-10-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d15ed734db9d1c87e78cf7508f9efc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhUaNFsYJMVV2d9m6wd2Qw.png"/></div></div></figure><h1 id="adc0" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">介绍</h1><p id="414d" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">Magento 2中的大部分配置是由xml文件完成的，并放在<em class="lr"> [Module_Root]/etc/ </em>目录中。根据您配置的<strong class="kv io">作用域</strong>，将它们放在<em class="lr"> etc/adminhtml </em>、<em class="lr"> etc/frontend </em>或者<em class="lr"> etc/ </em>下的<strong class="kv io">全局作用域</strong>下。当您将它们放入adminhtml或frontend时，这会覆盖全局范围。</p><h1 id="000c" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">XML配置文件列表。</h1><ul class=""><li id="b5ee" class="ls lt in kv b kw kx la lb le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> acl.xml </em> </strong> —资源标题，排序</li><li id="156d" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">adminhtml/rules/payment _ { country }。xml </em> </strong> — paypal</li><li id="8a3a" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">address _ formats . XML</em></strong></li><li id="80e3" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">address _ types . XML</em></strong>—仅格式编码和标题</li><li id="eb9d" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> cache.xml </em> </strong> —名称、实例—例如full _ page =页面缓存</li><li id="75cc" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">catalog _ attributes . XML</em></strong>—catalog _ category，catalog_product，不可分配，used_in_autogeneration，quote_item *</li><li id="950f" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io">T37】communication . XMLT39】</strong></li><li id="d77f" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> config.xml </em> </strong> —默认值</li><li id="eecb" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">crontab . XML</em></strong>—组[]，作业实例，方法，调度*</li><li id="0d87" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">cron _ groups . XML</em></strong>*</li><li id="ae3b" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> di.xml </em> </strong> —首选项、插件、虚拟类型*</li><li id="4776" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">eav _ attributes . XML</em></strong>—锁定的实体属性(全局、唯一等。)</li><li id="f607" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">email _ templates . XML</em></strong>—id标签文件类型模块— view/frontend/email/name.html</li><li id="5dec" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> events.xml </em> </strong> —观察者，共享，禁用*</li><li id="c7b1" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> export.xml </em> </strong></li><li id="c888" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">extension _ attributes . XML</em></strong>—for，属性编码，属性类型</li><li id="c634" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> fieldset.xml </em> </strong></li><li id="b353" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> import.xml </em> </strong></li><li id="fef9" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">indexer . XML</em></strong>—类，视图id，标题，描述</li><li id="667f" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">integration . XML</em></strong></li><li id="04fb" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr">集成/api.xml </em> </strong></li><li id="f80f" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io">T97】integration/config . XMLT99】</strong></li><li id="4b3a" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">menu . XML</em></strong>—管理菜单</li><li id="66a6" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">module . XML</em></strong>—版本，顺序</li><li id="eaed" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">mview . XML</em></strong>—计划更新、订阅表更改、索引器模型</li><li id="5eed" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io">T113】page _ types . XMLT115】</strong></li><li id="b019" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">payment . XML</em></strong>—组，方法允许_多个_地址</li><li id="d9a9" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> pdf.xml </em> </strong> —按类型(发票、发货、信用备忘录)和产品类型呈现</li><li id="5056" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">product _ types . XML</em></strong>—标签、模型实例、索引优先级、(？)自定义属性，(！)可组合类型</li><li id="97a2" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">product _ options . XML</em></strong></li><li id="6dd4" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">resources . XML</em></strong></li><li id="1200" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> routes.xml </em> </strong></li><li id="cbac" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> sales.xml </em> </strong> —收款人(报价、订单、发票、贷项通知单)</li><li id="45f2" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">search _ engine . XML</em></strong></li><li id="5477" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">search _ request . XML</em></strong>—索引、维度、查询、过滤器、聚合、存储桶</li><li id="31e9" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">sections . XML</em></strong>—行动路线占位符- &gt;使客户部分无效</li><li id="183a" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">system . XML</em></strong>—adminhtml config</li><li id="6d9c" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">validation . XML</em></strong>—实体、规则、约束—&gt;类</li><li id="59c2" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> view.xml </em> </strong> —按模块变量</li><li id="2e55" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> webapi.xml </em> </strong> —路由、方法、服务类和方法、资源</li><li id="b6ea" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"> <em class="lr"> widget.xml </em> </strong> —类，邮件兼容，图片，ttl(？)、标签、描述、参数</li><li id="9cca" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kv io"><em class="lr">ZIP _ codes . XML</em></strong>—<a class="ae mg" href="https://devdocs.magento.com/guides/v2.3/howdoi/checkout/checkout_zip.html" rel="noopener ugc nofollow" target="_blank">为邮政编码添加自定义输入掩码</a></li></ul><h1 id="0e6a" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">配置加载顺序</h1><p id="6da0" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">配置文件的加载顺序从<em class="lr"> app/etc/di.xml </em>开始。首先收集<em class="lr"> [Module_Root]etc/*下的配置文件。xml </em>，然后在<em class="lr"> [Module_Root]/etc/[Area]/*下。xml </em>，最后将它们合并在一起。</p><p id="a0ec" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在合并配置文件时，检查xml节点的id属性是否唯一，否则它将被所有底层内容(子节点)覆盖。</p><p id="d5dd" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">当同一个xml文档(配置文件)包含多个具有相同id的节点时，它会给出一个错误。— <a class="ae mg" href="https://devdocs.magento.com/guides/v2.2/config-guide/config/config-files.html" rel="noopener ugc nofollow" target="_blank"> Magento DevDocs —模块配置文件</a></p><p id="053f" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><strong class="kv io">配置合并类</strong></p><ul class=""><li id="b3bb" class="ls lt in kv b kw mh la mi le mm li mn lm mo lq lx ly lz ma bi translated">\Magento\Framework\Config\Dom</li></ul><p id="1a73" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><strong class="kv io">合并每个文件时</strong></p><ul class=""><li id="9d9c" class="ls lt in kv b kw mh la mi le mm li mn lm mo lq lx ly lz ma bi translated">创建配置合并|合并</li><li id="a51f" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated">\ Magento \ Framework \ Config \ Dom::_ initDom(Dom，perFileSchema)</li><li id="8332" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated">\ Magento \ Framework \ Config \ Dom::validateDomDocument</li><li id="6e86" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated">$dom-&gt;schemaValidate</li></ul><p id="a441" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><strong class="kv io">一切合并后</strong></p><ul class=""><li id="6781" class="ls lt in kv b kw mh la mi le mm li mn lm mo lq lx ly lz ma bi translated">\ Magento \ Framework \ Config \ Dom::validate(merged schema)</li><li id="8cf1" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated">\ Magento \ Framework \ Config \ Dom::validateDomDocument</li></ul><h1 id="24c3" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">环境设置</h1><p id="1d97" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">Magento 2附带了一个配置文件<em class="lr"> app/etc/env.php </em>，您可以在其中存储特定于系统的敏感文件，这些文件可以是API密钥、密码和个人信息，例如电子邮件或电话号码。导出过程中不包括敏感数据。</p><p id="fbda" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">该文件还包含您的数据库数据、用于保护您的密码和其他敏感信息的crypt密钥(在Magento安装期间创建)、用于管理url和缓存类型的后端frontName。</p><p id="6c61" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">要创建一个配置，你可以用<em class="lr"> bin/magento </em>做如下操作。</p><blockquote class="mp mq mr"><p id="68f7" class="kt ku lr kv b kw mh ky kz la mi lc ld ms mj lg lh mt mk lk ll mu ml lo lp lq ig bi translated"><em class="in">要查看更多选项运行</em> bin/magento config <em class="in">，选项对于</em> <strong class="kv io"> <em class="in"> Magento 2.2.4或更高版本</em> </strong> <em class="in">可能会有所不同。</em></p></blockquote><p id="424f" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">设置非敏感配置</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="3328" class="ne jw in na b gy nf ng l nh ni">bin/magento config:set [--scope] [--scope-code] path value</span></pre><p id="ba0f" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">设置敏感配置(写入app/etc/env.php)</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="44d8" class="ne jw in na b gy nf ng l nh ni">bin/magento config:sensitive:set [--scope] [--scope-code] path value</span></pre><p id="8b3e" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">显示保存的配置</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="32cb" class="ne jw in na b gy nf ng l nh ni">bin/magento config:show</span></pre><p id="3cea" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">导出配置，注意:不包括敏感数据！</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="4384" class="ne jw in na b gy nf ng l nh ni">bin/magento app:config:dump</span></pre><p id="e1f7" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">示例:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="16ea" class="ne jw in na b gy nf ng l nh ni">bin/magento config:set --scope=websites --scope-code=base web/unsecure/base_url http://example.com/</span></pre><p id="b1db" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">要找到正确的范围，您可以在数据库中运行以下sql查询:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="0cd3" class="ne jw in na b gy nf ng l nh ni">SELECT * FROM store;<br/>SELECT * FROM store_website;</span></pre><p id="8407" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">使用magerun:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="012b" class="ne jw in na b gy nf ng l nh ni">n98-magerun.phar db:query "SELECT * FROM store;"<br/>n98-magerun.phar db:query "SELECT * FROM store_website;"</span></pre><p id="2c30" class="pw-post-body-paragraph kt ku in kv b kw mh ky kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">有关更多信息，您可以参考以下Magento文档</p><ul class=""><li id="4263" class="ls lt in kv b kw mh la mi le mm li mn lm mo lq lx ly lz ma bi translated"><a class="ae mg" href="https://devdocs.magento.com/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-set.html" rel="noopener ugc nofollow" target="_blank">设置配置值</a></li><li id="4f88" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><a class="ae mg" href="https://devdocs.magento.com/guides/v2.2/config-guide/prod/config-reference-sens.html" rel="noopener ugc nofollow" target="_blank">敏感且特定于系统</a></li><li id="54c6" class="ls lt in kv b kw mb la mc le md li me lm mf lq lx ly lz ma bi translated"><a class="ae mg" href="https://devdocs.magento.com/guides/v2.2/config-guide/prod/config-reference-most.html" rel="noopener ugc nofollow" target="_blank">其他配置路径参考</a></li></ul><h1 id="9ff7" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">觉得这个帖子有用吗？请点击👏下面的按钮！:)</h1></div></div>    
</body>
</html>