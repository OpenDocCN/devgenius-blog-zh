<html>
<head>
<title>An Easy Way to Access Bitcoin Block Data Using BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 BigQuery 访问比特币块数据的简单方法</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/an-easy-way-to-access-bitcoin-block-data-using-bigquery-2f5d9be6ae63?source=collection_archive---------7-----------------------#2022-12-30">https://blog.devgenius.io/an-easy-way-to-access-bitcoin-block-data-using-bigquery-2f5d9be6ae63?source=collection_archive---------7-----------------------#2022-12-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">比特币区块链包括一个不断增长的记录列表，称为包含交易的块。块按反向顺序链接，每个块都引用链中的前一个块。在采矿发生或比特币交易发生后，会创建新的区块。</p><p id="1b0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">区块链的第一个区块叫做创世区块，创建于 2009 年 1 月 3 日。它是所有块都可以追溯到的共同祖先。数据块存储在节点上。所有节点都相互连接，并且每个节点从一开始就有一个完整的区块链副本。随着新块的确认和添加，区块链的本地副本被更新。</p><p id="2e3b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将使用 Google BigQuery 查询比特币区块链的块高、挖掘的块、总块大小和平均块间隔。查询结果可以在<a class="ae ki" href="https://trigolabs.io/bitcoin/" rel="noopener ugc nofollow" target="_blank">比特币仪表盘</a>上查看。确保选择“选择类别”作为网络，并选择“网络”作为区块高度、开采的区块、区块大小或区块间隔。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/e3cb00b0dc10bf2a3d03648b2db406f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cymcE11_vcwpZknK8mYMbQ.jpeg"/></div></div></figure><h1 id="f2c1" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">开始前的假设</h1><ul class=""><li id="f6ca" class="lt lu in jm b jn lv jr lw jv lx jz ly kd lz kh ma mb mc md bi translated">你需要有一个谷歌云帐户。遵循<a class="ae ki" href="https://medium.com/dev-genius/getting-started-with-google-bigquery-5e076e77d43c" rel="noopener">big query</a>入门中的步骤，熟悉该平台。</li><li id="ede5" class="lt lu in jm b jn me jr mf jv mg jz mh kd mi kh ma mb mc md bi translated">此外，您可以使用 BigQuery 平台<a class="ae ki" href="https://medium.com/@vivbellavita/explore-cryptocurrency-public-datasets-with-bigquery-1d9562691580" rel="noopener">在这里</a>探索加密货币公共数据集。</li></ul><h1 id="e26c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">区块高度</h1><p id="176d" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">区块高度是指区块链已开采的区块数量。</p><p id="9e16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该查询创建了一个表<code class="fe mm mn mo mp b">miner_block_height</code>,以检索每天开采的最高区块的日期和区块高度</p><ul class=""><li id="f9e6" class="lt lu in jm b jn jo jr js jv mq jz mr kd ms kh ma mb mc md bi translated"><code class="fe mm mn mo mp b">MAX(number)</code> —返回每天的最大块数。</li></ul><p id="6fa0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终输出将显示块高度，按日期升序排序。</p><pre class="kk kl km kn gt mt mp mu bn mv mw bi"><span id="d37a" class="mx kw in mp b be my mz l na nb">WITH miner_block_height AS (<br/>    SELECT DATE(timestamp) AS date,  MAX(number) AS block_height <br/>    FROM `bigquery-public-data.crypto_bitcoin.blocks`<br/>    WHERE DATE(timestamp) &lt;= DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY) <br/>    GROUP BY date<br/>)<br/><br/>SELECT * FROM miner_block_height<br/>ORDER BY date</span></pre><h1 id="d2ce" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">开采的区块</h1><p id="355c" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">开采的区块数是指一天内区块链中开采和包括的区块数。</p><p id="ce68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该查询创建了一个表<code class="fe mm mn mo mp b">miner_blocks</code>,用于提取每天开采的区块的日期和数量</p><ul class=""><li id="342e" class="lt lu in jm b jn jo jr js jv mq jz mr kd ms kh ma mb mc md bi translated"><code class="fe mm mn mo mp b">COUNT(DISTNCT number)</code> <strong class="jm io"> </strong> —统计每天不同的块数</li></ul><p id="6fe0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终输出将显示每天开采的区块数量，按日期升序排序。</p><pre class="kk kl km kn gt mt mp mu bn mv mw bi"><span id="7e2b" class="mx kw in mp b be my mz l na nb">WITH miner_blocks AS (<br/>    SELECT DATE(timestamp) AS date,  COUNT (DISTINCT number) AS blocks_mined <br/>    FROM `bigquery-public-data.crypto_bitcoin.blocks`<br/>    WHERE DATE(timestamp) &lt;= DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)<br/>    GROUP BY date<br/>)<br/><br/>SELECT * FROM miner_blocks<br/>ORDER BY date</span></pre><h1 id="d1ae" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">块大小</h1><p id="1249" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">块大小是指一天内创建的所有块的总大小(以字节为单位)。</p><p id="cf94" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个查询创建了一个表<code class="fe mm mn mo mp b">miner_block_size</code>，它使用<code class="fe mm mn mo mp b">SUM</code>函数汇总了每个日期所有块的大小。</p><p id="fc72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终输出将显示每天的总块大小，按日期升序排序。</p><pre class="kk kl km kn gt mt mp mu bn mv mw bi"><span id="4493" class="mx kw in mp b be my mz l na nb">WITH miner_block_size AS (<br/>    SELECT DATE(timestamp) AS date, SUM(size)<br/>    FROM `bigquery-public-data.crypto_bitcoin.blocks`<br/>    WHERE DATE(timestamp) &lt;= DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY) <br/>    GROUP BY date<br/>)<br/><br/>SELECT * FROM miner_block_size<br/>ORDER BY date</span></pre><h1 id="b886" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">闭塞区间</h1><p id="7159" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">区块间隔是指开采区块之间的平均时间(秒)。</p><p id="c7e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们创建一个公共表表达式(CTE) <code class="fe mm mn mo mp b">block_rows</code>，它根据字段<code class="fe mm mn mo mp b">timestamp</code>对块进行排序，并根据顺序为每个块分配一个<code class="fe mm mn mo mp b">row_num</code>。</p><p id="689b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们创建一个 CTE <code class="fe mm mn mo mp b">miner_block_interval</code>，基于<code class="fe mm mn mo mp b">row_num</code>字段将<code class="fe mm mn mo mp b">block_rows</code>表与其自身连接，并计算每个块的<code class="fe mm mn mo mp b">timestamp</code>字段与前一个块的<code class="fe mm mn mo mp b">timestamp</code>字段之间的时间差。这个时间差就是开采区块之间的时间间隔。结果按<code class="fe mm mn mo mp b">timestamp</code>字段以升序排序。</p><p id="451a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第三个 CTE <code class="fe mm mn mo mp b">block_interval_by_date</code>使用<code class="fe mm mn mo mp b">AVG(delta_block_time)</code>函数计算每天的平均块间隔。</p><p id="7ac1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终输出将显示每天的平均块间隔，按日期升序排序。</p><p id="ee70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完整的查询如下所示。</p><pre class="kk kl km kn gt mt mp mu bn mv mw bi"><span id="59b3" class="mx kw in mp b be my mz l na nb">WITH block_rows AS (<br/>  SELECT *, ROW_NUMBER() OVER (ORDER BY timestamp) AS row_num<br/>  FROM `bigquery-public-data.crypto_bitcoin.blocks` <br/>), <br/><br/>miner_block_interval AS (<br/>    SELECT row_a.timestamp AS block_time, row_a.number AS block_number,<br/>    TIMESTAMP_DIFF(row_a.timestamp,row_b.timestamp, SECOND) AS delta_block_time<br/>    FROM block_rows row_b<br/>    JOIN block_rows row_a<br/>    ON row_b.row_num = row_a.row_num-1<br/>    ORDER BY row_a.timestamp<br/>),<br/><br/>block_interval_by_date AS (<br/>  SELECT DATE(block_time) AS date, AVG(delta_block_time) AS mean_block_interval<br/>  FROM miner_block_interval<br/>  WHERE block_number &gt; 1<br/>  GROUP BY date<br/>)<br/><br/>SELECT * FROM block_interval_by_date<br/>ORDER BY date</span></pre><h1 id="2f52" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="d42f" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">我们已经看到，使用 Google BigQuery 来检索比特币区块链上的块数据相对容易。通过利用谷歌云强大的数据仓库和查询工具，用户可以对比特币网络进行有价值的洞察，即块高度、挖掘的块、总块大小和平均块间隔，如此处所示。总体而言，使用 BigQuery 轻松访问比特币块数据的能力是一项重大发展，有可能推动加密货币领域的创新和增长。</p><p id="ccc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">也读作:</strong></p><ul class=""><li id="a526" class="lt lu in jm b jn jo jr js jv mq jz mr kd ms kh ma mb mc md bi translated"><a class="ae ki" href="https://medium.com/dev-genius/query-bitcoin-blockchain-for-active-addresses-in-bigquery-be440f362dd9" rel="noopener">在 BigQuery 中查询比特币区块链活跃地址</a></li><li id="d53a" class="lt lu in jm b jn me jr mf jv mg jz mh kd mi kh ma mb mc md bi translated"><a class="ae ki" href="https://medium.com/coinmonks/guide-to-query-wallet-balances-of-bitcoin-in-bigquery-a4b52ec2466a" rel="noopener">使用 BigQuery 查询比特币余额指南</a></li><li id="568f" class="lt lu in jm b jn me jr mf jv mg jz mh kd mi kh ma mb mc md bi translated"><a class="ae ki" href="https://medium.com/coinmonks/proof-of-reserves-for-bitcoin-holdings-how-to-compute-in-bigquery-6f6c5bc8648d" rel="noopener">持有比特币的储备证明——如何在 BigQuery 中计算</a></li></ul></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="7cd0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="nj">感谢阅读！</em> </strong></p><p id="a5ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你喜欢这篇文章，并想了解更多，请关注我。我定期发布与链上分析、机器学习和 BigQuery 相关的主题。我尽量让我的文章简单而精确，尽可能提供代码、例子和模拟。</p></div></div>    
</body>
</html>