<html>
<head>
<title>How to Use the Axios HTTP Client in React useEffect Hook?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 React useEffect Hook 中使用 Axios HTTP 客户端？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-the-axios-http-client-in-react-useeffect-hook-804680a9a3a9?source=collection_archive---------0-----------------------#2021-09-06">https://blog.devgenius.io/how-to-use-the-axios-http-client-in-react-useeffect-hook-804680a9a3a9?source=collection_archive---------0-----------------------#2021-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ce03bca8cde0a1c5b532e4a8c835f0f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q0F82UiBS4oZabOd"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@_louisreed?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">路易斯·里德</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="219e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在许多情况下，我们需要在代码中发出 HTTP 请求，以获取或提交 React 组件中的数据。</p><p id="88f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Axios 是一个流行的 HTTP 客户端库，我们可以使用它轻松地发出 HTTP 请求。</p><p id="c05a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用带有<code class="fe lb lc ld le b">useEffect</code>钩子的 Axios HTTP 客户端来发出 HTTP 请求。</p><h1 id="8edf" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用带有 React useEffect 挂钩的 Axios HTTP 客户端</h1><p id="ab4c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">当组件挂载时，我们可以通过在第二个参数中使用空数组调用<code class="fe lb lc ld le b">useEffect</code>钩子来发出 HTTP 请求。</p><p id="e725" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="73a4" class="mq lg iq le b gy mr ms l mt mu">import React, { useEffect, useState } from "react";<br/>import axios from "axios";</span><span id="5653" class="mq lg iq le b gy mv ms l mt mu">export default function App() {<br/>  const [data, setData] = useState([]);</span><span id="402a" class="mq lg iq le b gy mv ms l mt mu">  const getData = async () =&gt; {<br/>    const { data } = await axios.get(`https://yesno.wtf/api`);<br/>    setData(data);<br/>  };</span><span id="163e" class="mq lg iq le b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    getData();<br/>  }, []);</span><span id="b5a0" class="mq lg iq le b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="489b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们定义了<code class="fe lb lc ld le b">getData</code>函数，用<code class="fe lb lc ld le b">axios.get</code>方法发出 GET 请求。</p><p id="ccc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该函数是异步的，因为<code class="fe lb lc ld le b">axios</code>方法返回一个承诺。</p><p id="1ef2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是传入一个 URL 来发出 GET 请求。</p><p id="7e54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须在<code class="fe lb lc ld le b">useEffect</code>钩子之外定义<code class="fe lb lc ld le b">getData</code>函数，因为<code class="fe lb lc ld le b">useEffect</code>回调应该是同步函数。</p><p id="9d14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数中的空数组意味着我们只在组件挂载时发出请求。</p><p id="41d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe lb lc ld le b">setData</code>来设置<code class="fe lb lc ld le b">data</code>状态，并在 JSX 代码中呈现数据。</p><p id="e306" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想在状态或属性改变时发出 HTTP 请求，那么我们应该将这些请求传递给第二个参数中的数组。</p><h1 id="ce09" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用 axios-hooks 库</h1><p id="0d86" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们还可以使用 axios-hooks 库，让我们通过使用 axios 库的定制钩子发出请求。</p><p id="71ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，我们通过编写以下内容来安装它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="76ee" class="mq lg iq le b gy mr ms l mt mu">npm install axios axios-hooks</span></pre><p id="cfe5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们写道:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="22a9" class="mq lg iq le b gy mr ms l mt mu">import React from "react";<br/>import useAxios from "axios-hooks";</span><span id="21fb" class="mq lg iq le b gy mv ms l mt mu">export default function App() {<br/>  const [{ data, loading, error }, refetch] = useAxios("https://yesno.wtf/api");</span><span id="8c98" class="mq lg iq le b gy mv ms l mt mu">  if (loading) return &lt;p&gt;Loading...&lt;/p&gt;;<br/>  if (error) return &lt;p&gt;Error!&lt;/p&gt;;</span><span id="e2d0" class="mq lg iq le b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="5408" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe lb lc ld le b">useAxios</code>来返回一个包含具有<code class="fe lb lc ld le b">data</code>、<code class="fe lb lc ld le b">loading</code>和<code class="fe lb lc ld le b">error</code>属性的对象的数组。</p><p id="35f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">data</code>有响应数据。</p><p id="05eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">loading</code>已加载状态。如果请求正在加载，则为<code class="fe lb lc ld le b">true</code>。</p><p id="4fef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">error</code>有错误状态。如果请求导致错误，则为<code class="fe lb lc ld le b">true</code>。</p><p id="d60b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以调用<code class="fe lb lc ld le b">refetch</code>函数再次发出请求。</p><h1 id="b961" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="b7b5" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">要将 Axios 与<code class="fe lb lc ld le b">useEffect</code>挂钩一起使用，我们只需定义一个异步函数，并在<code class="fe lb lc ld le b">useEffect</code>回调中调用它。</p><p id="6344" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，我们可以使用 axios-hooks 库提供的<code class="fe lb lc ld le b">useAxios</code>钩子。</p></div></div>    
</body>
</html>