<html>
<head>
<title>Setting up a responsive B2B project with Grommet, PropelAuth, and Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Grommet、PropelAuth 和 Next.js 建立响应式 B2B 项目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-up-a-responsive-b2b-project-with-grommet-propelauth-and-next-js-2e67d0b0b79b?source=collection_archive---------8-----------------------#2022-05-25">https://blog.devgenius.io/setting-up-a-responsive-b2b-project-with-grommet-propelauth-and-next-js-2e67d0b0b79b?source=collection_archive---------8-----------------------#2022-05-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/765688ab9f599bb324fe3f4027e1054d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tW8zFTdU80FL7Gg2cm1ywQ.gif"/></div></div></figure><p id="512e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://v2.grommet.io/" rel="noopener ugc nofollow" target="_blank"> Grommet </a>是一个基于 React 的框架，为您提供快速构建响应迅速且可访问的应用程序的工具。它有一些最直观的组件来设置你的产品结构(例如，页眉、页脚、响应侧栏等)。</p><p id="7ad2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将使用 Grommet、PropelAuth 和 Next.js 建立一个新的响应前端。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ku"><img src="../Images/82c63bf682eb9a81ad5f75baa6964372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KoSe_T5Uybki6DYYLaeiEQ.gif"/></div></div></figure><p id="e864" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们将使侧边栏具有响应性，因此它在较小的设备上显示不同:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/28d5c13c43082a8df3b3191d1574e109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*h5TMrhh0eYOUmivdMnvV3A.gif"/></div></figure><p id="d0d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们将添加 B2B 支持，以便我们的用户可以创建/加入组织，并在侧栏中显示信息:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/988e081235da3b2df9e75829eac3b6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*RPg8lK8t58J5fcblU9VPOg.gif"/></div></figure><h1 id="de42" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用 Grommet 和 Next.js 创建 AppBar</h1><p id="d157" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">让我们从创建一个新的 Next.js 应用程序开始。</p><pre class="kv kw kx ky gt md me mf mg aw mh bi"><span id="573c" class="mi lb in me b gy mj mk l ml mm">$ npx create-next-app</span></pre><p id="56e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<a class="ae kt" href="https://v2.grommet.io/grommet" rel="noopener ugc nofollow" target="_blank">索环顶层容器</a>添加到您的<code class="fe mn mo mp me b">_app.js</code>中</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="839e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们可以创建一个新文件<code class="fe mn mo mp me b">components/AppBar.jsx</code>，其中包含我们的头。这个例子取自 React 的<a class="ae kt" href="https://github.com/grommet/grommet-starter-new-app" rel="noopener ugc nofollow" target="_blank">索环入门指南</a>，稍作修改。</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="4d09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们转到我们的<code class="fe mn mo mp me b">index.js</code>文件并更新它以使用 AppBar:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="5b49" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们得到:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/9d216d9077ace5f9adb6855c5f3b05d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*74hzNj6veGqvO12NJVnONQ.png"/></div></div></figure><h1 id="2c4a" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用 Gromment 和 Next.js 创建侧边栏</h1><p id="cc6f" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">接下来，让我们使用 Grommet 的<a class="ae kt" href="https://v2.grommet.io/sidebar" rel="noopener ugc nofollow" target="_blank">侧栏</a>组件创建侧栏:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="2fe2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以看到我们创建了两个页面<strong class="jx io"> / </strong>和<strong class="jx io"> /secret </strong>，我们将它们渲染为<a class="ae kt" href="https://nextjs.org/docs/api-reference/next/link" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">链接</strong> </a>以获得不同页面之间的平滑过渡。</p><p id="86e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们只需要在<code class="fe mn mo mp me b">pages/index.js</code>接上它</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/951e033fcd5a69297c5a97ffe6b72405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bouu33ilp7KsYeO-nFUVhQ.png"/></div></div></figure><p id="5297" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你点击<strong class="jx io"> Secret </strong>，你会得到一个 404，因为我们还没有创建<strong class="jx io"> pages/secret.js </strong>。在我们这样做之前，由于许多逻辑将被重复，让我们花一点时间来创建一个新的有用的组件<strong class="jx io">components/page wrapper . js</strong></p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="c7fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们的<strong class="jx io"> pages/secret.js </strong>看起来就像:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="5131" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">应用程序主题化</h1><p id="f939" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">紫色不适合你？我们可以通过向<strong class="jx io"> src/_app.js </strong>中的<strong class="jx io">索环</strong>组件传递一个<strong class="jx io">主题</strong>来为整个应用程序设置主题</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/2c81573beda60588eda8fef7f6f0cdb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwPGQrs6_xy-rulr1mGRPQ.png"/></div></div></figure><h1 id="d26d" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">向我们的 AppBar 添加用户验证</h1><p id="49cd" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">我们现在的登录按钮只是为了展示，我们的秘密页面…不是很秘密。PropelAuth 是一个提供托管用户认证的服务。它提供完全托管的用户界面，包括注册、登录和帐户管理。对于 B2B/多租户应用程序，它还提供组织管理/RBAC。</p><p id="d3c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以按照<a class="ae kt" href="https://docs.propelauth.com/getting-started/" rel="noopener ugc nofollow" target="_blank">入门指南</a>来配置你的页面，我们的是这样的:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2c70caf683f012c98ee84109c5b7b683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*-MWMiRXHCfA8t3DLL1FNhQ.png"/></div></figure><p id="4ff6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">自从我们打开谷歌登录和神奇链接/无密码登录。</p><p id="6dcf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回到我们的 Next.js 文件，让我们把它们连接起来。我们从安装<code class="fe mn mo mp me b">@propelauth/react</code>库开始:</p><pre class="kv kw kx ky gt md me mf mg aw mh bi"><span id="7aec" class="mi lb in me b gy mj mk l ml mm">$ yarn add @propelauth/react</span></pre><p id="62c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并将一个<a class="ae kt" href="https://docs.propelauth.com/reference/frontend-apis/nextjs/#set-up-authprovider" rel="noopener ugc nofollow" target="_blank"> AuthProvider </a>添加到我们的<code class="fe mn mo mp me b">_app.js</code>中</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8c19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以从您的仪表板获取您的 authUrl。如果你像上面那样使用 env 变量，确保在设置好<code class="fe mn mo mp me b">.env</code>文件后重启服务器。</p><p id="d669" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">AuthProvider 负责从 PropelAuth 获取当前用户的用户和组织信息。提供者确保获取只发生一次，不管有多少组件/页面需要该信息。</p><p id="600e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来我们将更新我们的<strong class="jx io">组件/AppBar.jsx </strong>。我们希望<strong class="jx io">登录</strong>按钮重定向到一个登录页面，并在他们登录后显示一些关于用户的信息。</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8192" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们新的 AuthButtons 有三种状态:</p><ol class=""><li id="f195" class="mw mx in jx b jy jz kc kd kg my kk mz ko na ks nb nc nd ne bi translated">加载当前用户的信息。这仅在初始页面加载时发生一次。</li><li id="4c99" class="mw mx in jx b jy nf kc ng kg nh kk ni ko nj ks nb nc nd ne bi translated">如果他们登录，我们会显示他们的个人资料图片。点击它将会重定向到一个由 PropelAuth 为我们托管的账户页面。</li><li id="134a" class="mw mx in jx b jy nf kc ng kg nh kk ni ko nj ks nb nc nd ne bi translated">如果他们没有登录，他们可以单击登录按钮重定向到我们的托管登录页面。</li></ol><p id="386b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您登录，您将看到:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/c48d49dd549d8fd232be6275a210c060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KnuKXXydw0jceMtlxC-jA.png"/></div></div></figure><p id="6b6d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者……不管你用的是不是狗的头像。</p><h1 id="f162" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">保护我们的“秘密”页面</h1><p id="7d01" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">我们刚刚从 AppBar 中学到的原则同样适用于我们的页面。我们可以使用<strong class="jx io"> useAuthInfo </strong>来确定用户是否登录。</p><p id="5056" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有一个函数<strong class="jx io">带有 RequiredAuthInfo </strong>，您可以使用它来处理大量的加载样板代码:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="a5a0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">组件<strong class="jx io"> SecretBodyInner </strong>只需要处理用户登录的情况。</p><h1 id="81ea" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使我们的侧边栏可折叠</h1><p id="d655" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">为了让我们的用户打开/关闭侧边栏，我们首先需要一些他们可以点击的东西。在<code class="fe mn mo mp me b"><a class="ae kt" href="https://hamburger-react.netlify.app/" rel="noopener ugc nofollow" target="_blank">hamburger-react</a></code>的帮助下，让我们在 AppBar 中添加一个汉堡图标</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ea7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你需要能够从任意组件控制侧边栏，你会想要使用一个<a class="ae kt" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React context </a>来管理它，但是因为我们只需要在 AppBar 和侧边栏中访问它，我们可以从我们的<strong class="jx io"> PageWrapper </strong>来管理它:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/16b7926085e8c9a84e63e89f51bdcdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*CrvpN2RF2N7G6dEJLWVI_A.gif"/></div></figure><p id="aaf1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">太好了！现在我们只需要让侧边栏在汉堡包被点击时出现并消失。我将现有的组件<strong class="jx io"> MySidebar </strong>重命名为<strong class="jx io"> MySidebarInner: </strong></p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="3c39" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们打开/关闭侧边栏时，可折叠允许平滑过渡，就像这样:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/4ce36b1b164bff525955fc77222ab51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*pr3sufp5I1IGmlNHjjM1Bw.gif"/></div></figure><h1 id="d9a2" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">让我们的侧边栏反应灵敏</h1><p id="624f" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">在手机上，我们的侧边栏会占据很大的空间。我们可以让侧边栏占据整个屏幕，而不是从屏幕的一侧跳进去。当我们完成时，它将看起来像这样:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/28d5c13c43082a8df3b3191d1574e109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*h5TMrhh0eYOUmivdMnvV3A.gif"/></div></figure><p id="8403" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Grommet 为我们提供了<strong class="jx io"> ResponsiveContext </strong>，它允许我们根据屏幕大小来改变我们渲染的内容。我们将在<a class="ae kt" href="https://v2.grommet.io/layer" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">层</strong> </a>覆盖组件旁边使用它来显示所有内容上面的侧边栏。</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="c222" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意，我们还需要添加一个新按钮，这样我们的用户就可以关闭全屏侧边栏。</p><h1 id="6286" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">将组织添加到我们的边栏</h1><p id="aa95" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated"><a class="ae kt" href="https://docs.propelauth.com/overview/organizations/" rel="noopener ugc nofollow" target="_blank">组织</a>是将一起使用你的产品的用户组。这可能是一个两个人的创业公司，一个大型企业，或者某个人的副业，他们希望有一天成为一家公司。</p><p id="3306" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">PropelAuth 使我们的用户能够管理他们自己的组织(邀请同事、设置角色等。)所以我们所要做的就是在我们的侧边栏中显示它们:</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="9c92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> getSelectedOrg </strong>和<strong class="jx io"> selectOrg </strong>由<a class="ae kt" href="https://docs.propelauth.com/reference/frontend-apis/nextjs/#the-orghelper" rel="noopener ugc nofollow" target="_blank"> orgHelper </a>提供，以便更容易在我们的产品中引用单个组织。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/988e081235da3b2df9e75829eac3b6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*RPg8lK8t58J5fcblU9VPOg.gif"/></div></figure><p id="2ab2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">仅此而已！我们现在有了一个非常强大的项目框架，可以开始构建 B2B 或多租户应用程序的其余部分了。</p></div></div>    
</body>
</html>