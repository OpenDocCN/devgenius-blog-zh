<html>
<head>
<title>Reverse proxy using Netflix’s Zuul in Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Spring Boot 使用网飞 Zuul 的反向代理</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/reverse-proxy-using-netflixs-zuul-in-spring-boot-7be8b6a5451d?source=collection_archive---------0-----------------------#2022-02-21">https://blog.devgenius.io/reverse-proxy-using-netflixs-zuul-in-spring-boot-7be8b6a5451d?source=collection_archive---------0-----------------------#2022-02-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ec0c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将发现什么是反向代理，以及我们如何使用网飞的 Zuul 在 Spring boot 中为一个推荐网站实现反向代理。</p><h1 id="9ac6" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">定义</h1><p id="4b0b" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated"><code class="fe ll lm ln lo b">define: reverse proxy</code></p><blockquote class="lp lq lr"><p id="388a" class="jk jl ls jm b jn jo jp jq jr js jt ju lt jw jx jy lu ka kb kc lv ke kf kg kh ig bi translated">在计算机网络中，<strong class="jm io">反向代理</strong>是位于后端应用程序前面的应用程序，它将客户端请求转发给这些应用程序。反向代理有助于提高可扩展性、性能、弹性和安全性。返回给客户端的资源看起来好像是来自反向代理本身</p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/5fd6585407df4c8b8348d5b6217b716a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*HDzu2Jgmw-E_vtNK61E1TA.jpeg"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">反向代理图</figcaption></figure><h1 id="ba10" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">反向代理的使用</h1><ul class=""><li id="abe0" class="mi mj in jm b jn lg jr lh jv mk jz ml kd mm kh mn mo mp mq bi translated"><strong class="jm io">负载均衡:</strong>它可以将来自传入请求的负载分配给几个服务器，每个服务器支持自己的应用领域。</li><li id="1aaf" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">安全性:</strong>它可以通过消除对后端服务器的直接互联网访问来隐藏后端服务器的拓扑结构和特征。</li><li id="01df" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">认证:</strong>它可以用来为所有 HTTP 请求提供单点认证。</li><li id="bbc7" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io"> SSL 终端:</strong>它可以处理传入的 HTTPS 连接，解密请求并将未加密的请求传递到服务器上。</li><li id="2ec0" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">提供静态内容:</strong>它还可以<strong class="jm io"> </strong>充当提供静态内容的 web 服务器。</li><li id="d5ca" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">缓存:</strong>可以充当缓存。</li><li id="6281" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">压缩:</strong>为了减少单个请求所需的带宽，它可以对传入的请求进行解压缩，对传出的请求进行压缩。</li><li id="f504" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">集中式日志记录和审计:</strong>由于所有的 HTTP 请求都通过反向代理路由，这为日志记录和审计提供了一个很好的切入点。</li><li id="bd60" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io"> URL 重写:</strong> It <strong class="jm io"> </strong>可以在将 URL 传递给后端服务器之前重写它们。</li><li id="02e5" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><strong class="jm io">将多个网站聚合到同一个 URL 空间:</strong>它可以将单个 URL 地址空间的不同分支路由到不同的内部 web 服务器</li></ul><p id="5809" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">看看这篇关于反向代理的不同用例的博客。</p><h1 id="9aa2" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">履行</h1><p id="ec9a" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在这一节中，我们将使用 Spring Boot 的 Spring Cloud Starter 网飞祖尔来为我们的推荐网站创建一个反向代理。</p><p id="6db5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设我们有不同的电影推荐、电视剧推荐、书籍推荐和音乐推荐应用。但是我们希望在同一个父 URL 下托管所有这些应用程序，比如说<code class="fe ll lm ln lo b">/recommendation/**</code>。</p><h2 id="6db2" class="mx kj in bd kk my mz dn ko na nb dp ks jv nc nd kw jz ne nf la kd ng nh le ni bi translated">属国</h2><pre class="lx ly lz ma gt nj lo nk nl aw nm bi"><span id="5af3" class="mx kj in lo b gy nn no l np nq">&lt;!--<a class="ae mw" href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-zuul" rel="noopener ugc nofollow" target="_blank">https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-zuul</a> <br/>--&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;<br/>    &lt;version&gt;2.2.10.RELEASE&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><h2 id="9b50" class="mx kj in bd kk my mz dn ko na nb dp ks jv nc nd kw jz ne nf la kd ng nh le ni bi translated">密码</h2><p id="171c" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">首先，我们将在我们的<code class="fe ll lm ln lo b">Application.java</code>中启用 Zuul 反向代理。</p><pre class="lx ly lz ma gt nj lo nk nl aw nm bi"><span id="efbb" class="mx kj in lo b gy nn no l np nq">@EnableZuulProxy<br/>@SpringBootApplication<br/>public class RoutingAndFilteringGatewayApplication {<br/><br/>  public static void main(String[] args) {<br/>      SpringApplication.run(<br/>         RoutingAndFilteringGatewayApplication.class, args<br/>      );<br/>  }<br/>}</span></pre><p id="a466" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，在我们的控制器中，我们将有业务逻辑来找出应该将请求转发给哪个应用程序，并将它转发给那个应用程序。</p><pre class="lx ly lz ma gt nj lo nk nl aw nm bi"><span id="8f0c" class="mx kj in lo b gy nn no l np nq">@Slf4j<br/>@Controller<br/>public class RecommendationController {</span><span id="85f1" class="mx kj in lo b gy nr no l np nq">    /**<br/>     * Main handler<br/>     * @param type              Type of recommendation<br/>     * @param name              Name<br/>     * @return {String}         forwarded URL<br/>     */<br/>    @GetMapping(value = { "/recommendation/{type}/{name}"})<br/>    public String main( <br/>        @PathVariable("type") String type,<br/>        @PathVariable("name") String name<br/>    ){<br/>         // Here type can be <br/>         // 1. movie<br/>         // 2. tv<br/>         // 3. book<br/>         // 4. music<br/>        type = type.toLowerCase();<br/>        log.info("type: " + type);<br/>        return "forward:/" + type + "/" + name;<br/>    }<br/>}</span></pre><p id="cbe1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，进入主要部分，我们将在<code class="fe ll lm ln lo b">application.yml</code>中定义 Zuul 属性</p><pre class="lx ly lz ma gt nj lo nk nl aw nm bi"><span id="947d" class="mx kj in lo b gy nn no l np nq">zuul:<br/>  routes:<br/>    movie:<br/>      path: /movie/**<br/>      url: <a class="ae mw" href="http://localhost:3001/movie/" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/movie/</a><br/>    tv:<br/>      path: /tv/**<br/>      url: <a class="ae mw" href="http://localhost:3002/tv/" rel="noopener ugc nofollow" target="_blank">http://localhost:3002/tv/</a><br/>    book:<br/>      path: /book/**<br/>      url: <a class="ae mw" href="http://localhost:3003/book/" rel="noopener ugc nofollow" target="_blank">http://localhost:3003/book/</a><br/>    music:<br/>      path: /music/**<br/>      url: <a class="ae mw" href="http://localhost:3001/music/" rel="noopener ugc nofollow" target="_blank">http://localhost:3004/music/</a></span></pre><p id="a776" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这样，所有以<code class="fe ll lm ln lo b">/movie/**</code>开头的请求都将被路由到<code class="fe ll lm ln lo b">http://localhost:3001/movie</code>，对于电视、书籍等等也是如此。</p><p id="4b95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们基于 path 变量的推荐控制器中，我们将请求转发给这些应用程序之一。</p><h2 id="a2ea" class="mx kj in bd kk my mz dn ko na nb dp ks jv nc nd kw jz ne nf la kd ng nh le ni bi translated">奖金代码</h2><p id="0a54" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">这不是我们的用例所需要的。但是，假设您必须拦截请求，并添加一些请求头，添加一些日志记录等。你甚至可以通过添加 Zuul 滤镜来做这些事情。有各种类型过滤器，如前置过滤器、路由过滤器、后置过滤器和错误过滤器。</p><p id="f1fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一节中，我将向您展示如何使用“pre”过滤器在请求中添加定制的请求头。</p><pre class="lx ly lz ma gt nj lo nk nl aw nm bi"><span id="e344" class="mx kj in lo b gy nn no l np nq">@Component<br/>public class SimpleFilter extends ZuulFilter {<br/>    <br/>    @Override<br/>    public String filterType() {<br/>        return "pre";<br/>    }<br/> <br/>    @Override<br/>    public int filterOrder() {<br/>        return 1;<br/>    }<br/> <br/>    @Override<br/>    public boolean shouldFilter() {<br/>        return true;<br/>    }<br/> <br/>    @Override<br/>    public Object run() {<br/>        RequestContext ctx = RequestContext.getCurrentContext();<br/>        HttpServletRequest request = ctx.getRequest();<br/>        String requestURL = request.getRequestURL().toString();<br/>        <br/>        // Here we are adding a request header "audio-visual: yes"<br/>        // If the request URL contains /movie/ or /tv/<br/>        if (requestURL.contains("/movie/") ||<br/>            requestURL.contains("/tv/")<br/>        ) {<br/>            ctx.addZuulRequestHeader("audio-visual", "yes");<br/>        }<br/> <br/>        return null;<br/>    }</span><span id="7dc3" class="mx kj in lo b gy nr no l np nq">}</span></pre></div><div class="ab cl ns nt hr nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ig ih ii ij ik"><p id="0074" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想了解更多。请检查这些文件。</p><ol class=""><li id="4dcb" class="mi mj in jm b jn jo jr js jv nz jz oa kd ob kh oc mo mp mq bi translated">【https://en.wikipedia.org/wiki/Reverse_proxy T4】</li><li id="53fa" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh oc mo mp mq bi translated"><a class="ae mw" href="https://dzone.com/articles/benefits-reverse-proxy" rel="noopener ugc nofollow" target="_blank">https://dzone.com/articles/benefits-reverse-proxy</a></li><li id="17a1" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh oc mo mp mq bi translated"><a class="ae mw" href="https://www.baeldung.com/spring-rest-with-zuul-proxy" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/spring-rest-with-zuul-proxy</a></li><li id="894a" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh oc mo mp mq bi translated"><a class="ae mw" href="https://cloud.spring.io/spring-cloud-netflix/multi/multi__router_and_filter_zuul.html" rel="noopener ugc nofollow" target="_blank">https://cloud . spring . io/spring-cloud-网飞/multi/multi _ _ router _ and _ filter _ zuul . html</a></li><li id="0c56" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh oc mo mp mq bi translated"><a class="ae mw" href="https://github.com/Netflix/zuul" rel="noopener ugc nofollow" target="_blank">https://github.com/Netflix/zuul</a></li></ol></div></div>    
</body>
</html>