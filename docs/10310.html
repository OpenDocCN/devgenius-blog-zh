<html>
<head>
<title>The Benchmarking — PostgreSQL on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基准测试 Google Cloud 上的 PostgreSQL</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/the-benchmarking-postgresql-on-google-cloud-5c67b3cfc567?source=collection_archive---------3-----------------------#2022-10-23">https://blog.devgenius.io/the-benchmarking-postgresql-on-google-cloud-5c67b3cfc567?source=collection_archive---------3-----------------------#2022-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ebd09e42b28de737753f2d0f9c750a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kjSHIJA3CrvRoSWH3bmytA.png"/></div></div></figure><blockquote class="jy jz ka"><p id="d78d" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是我对谷歌云产品分析的第二部分——将 AlloyDB 的预览版与云 SQL 进行比较。详情见第一部分<a class="ae la" href="https://weiyuan-liu.medium.com/postgresql-on-google-cloud-alloydb-cloud-sql-or-cloud-spanner-b03c391bd853" rel="noopener"> <strong class="ke ir">此处</strong> </a> <strong class="ke ir">。</strong></p></blockquote></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="4f74" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1.介绍</h1><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/a98950e1d00031dacefc8a81d3738f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPG5hzdtOb3VdxaNRLriUQ.png"/></div></div></figure><p id="954f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">如果你已经阅读了 AlloyDB 的文档或在线博客文章，你可能会注意到以上是 AlloyDB 谈论最多的一点。<em class="kd">事务性工作负载速度提高 4 倍</em>。太神奇了！</p><p id="50c8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">然而，另一种解释这种说法的方式是，它是托管工具(AlloyDB)与自托管 PostgreSQL 实例(运行在本地或云中的虚拟机上)的基准比较。像 Google Cloud 这样的云提供商已经对托管工具的性能进行了优化，使得采用托管数据库比我们自己更值得。</p><p id="88b8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">鉴于这种思路……我想让<strong class="ke ir">更好地了解 AlloyDB 的事务性能，与其他托管 PostgreSQL 工具 Cloud SQL 和 Cloud Spanner </strong>相比。除了进行我们自己的基准测试，还有什么更好的方法来实现这种理解呢？</p><h2 id="d990" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">1.1.介绍基准测试工具</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c6475f65206ced2905cf02f44d357262.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*ZzrVTOeYjkg7IJVO88aMPA.png"/></div></figure><p id="0792" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">对于本练习，我们将首先使用<a class="ae la" href="https://www.postgresql.org/docs/current/pgbench.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> Pgbench </strong> </a>来执行基准测试。如 Pgbench 文档中所述:</p><pre class="mh mi mj mk gt nb nc nd ne aw nf bi"><span id="d6fd" class="mo lj iq nc b gy ng nh l ni nj">By default, pgbench tests a scenario that is loosely based on TPC-B, involving five <!-- -->SELECT<!-- -->, <!-- -->UPDATE<!-- -->, and <!-- -->INSERT<!-- --> commands per transaction</span></pre><p id="83ae" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">我们将跨多种配置运行基准测试工具，看看 AlloyDB 与其他工具相比表现如何。使用 Pgbench 的默认初始化过程，以便添加所需的表、系统初始数据和主索引，从而建立读写事务的基本要求。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e313edf76478993620524780ebcc3997.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*qIXED0rs7uv82Fr9.jpg"/></div></figure><p id="9e00" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">我还使用了另一个基准测试工具<a class="ae la" href="https://www.hammerdb.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> HammerDB </strong> </a>来运行与上面类似的配置，但是将基准配置文件设置为<a class="ae la" href="https://en.wikipedia.org/wiki/TPC-C" rel="noopener ugc nofollow" target="_blank"> TPC-C </a>。这将为我们提供另一个关于基准测试的视角。</p><blockquote class="jy jz ka"><p id="1997" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该基准测试不是 OLTP，因为它不需要任何终端、网络或思考时间<br/> — <a class="ae la" href="https://www.tpc.org/tpcb/spec/tpcb_current.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> TPC-B 规范</strong> </a></p></blockquote><p id="159d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">还应注意的是，与<a class="ae la" href="https://www.tpc.org/tpcb/" rel="noopener ugc nofollow" target="_blank"> TPC-B </a>相比，<a class="ae la" href="https://www.tpc.org/tpcc/" rel="noopener ugc nofollow" target="_blank"> TPC-C </a>在我们的 OLTP 基准测试中更具相关性。TPC-B 可以被视为更多的数据库压力测试，但我们仍然可以在稍后检查它时考虑结果。</p><h2 id="353c" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">1.2.假设</h2><p id="b149" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">使用上述基准工具，我们将做出以下假设:</p><ul class=""><li id="c2f0" class="nq nr iq ke b kf kg kj kk ml ns mm nt mn nu kz nv nw nx ny bi translated">所有工具和实例都将在新加坡的<code class="fe nz oa ob nc b"><strong class="ke ir">asia-southeast1</strong></code>区域和<code class="fe nz oa ob nc b"><strong class="ke ir">asia-southeast1-a</strong></code>区域使用</li><li id="a86f" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated">所有三个数据库都将被分配一个基本存储量<code class="fe nz oa ob nc b"><strong class="ke ir">100GB</strong></code> <strong class="ke ir">，并尽可能选择 SSD </strong></li><li id="4e65" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated"><strong class="ke ir">备份存储不会计入成本</strong>，因为基准测试是针对数据库选项的性能进行的，而不是可靠性方面</li><li id="cae7" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated"><strong class="ke ir">基准测试将通过扩展客户端</strong>来完成，以模拟客户端连接到数据库的应用程序的水平可伸缩性</li><li id="d983" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated">所有基准测试都将使用<strong class="ke ir"> PostgreSQL 14 </strong>完成</li><li id="4eae" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated"><strong class="ke ir">私有 IP </strong>将用于所有基准测试</li><li id="b342" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated">用于执行基准测试的计算实例是<strong class="ke ir">E2-medium(</strong>pg bench<strong class="ke ir">)</strong>和<strong class="ke ir">E2-standard-4(</strong>HammerDB<strong class="ke ir">)，在同一地区和区域</strong>。因为用 HammerDB 播种数据总是会超出 CPU 的利用率，所以我决定使用一个 vCPU 值更高的实例。</li><li id="daa0" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated">所有比较成本均为<strong class="ke ir">月估算金额</strong></li></ul><p id="2d44" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">最后但同样重要的是，我发现 Cloud Spanner 的 PostgreSQL 接口与 Pgbench 和 HammerDB 并不完全兼容，即使在使用<a class="ae la" href="https://github.com/GoogleCloudPlatform/pgadapter#google-cloud-spanner-pgadapter" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">pg adapter</strong></a><strong class="ke ir"/>时也是如此——详细信息将添加到本文末尾，以供将来参考，并提供使用 Cloud Spanner 进行测试的建议。<strong class="ke ir">由于这种复杂性，我们将不使用 PostgreSQL 的这些主流基准测试工具来比较 Cloud Spanner。</strong></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="d080" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2.基准兴趣领域</h1><p id="994b" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">我们将在以下三个方面对谷歌云的托管数据库进行基准测试:</p><ul class=""><li id="fc58" class="nq nr iq ke b kf kg kj kk ml ns mm nt mn nu kz nv nw nx ny bi translated"><strong class="ke ir">“价格相同”的实例基准测试</strong>——以几乎相同的成本跨实例进行性能测试，以了解哪种工具更能实现物有所值</li></ul><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/1b8a19ce440f95044f6845248065eae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*dZFf8LVNtzbWEmkmpLMMbw.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">“同等定价”实例基准测试，来源:<a class="ae la" href="https://cloud.google.com/products/calculator/#id=4f539b4b-fd7e-4bc7-96ba-fc2915b9ff2c" rel="noopener ugc nofollow" target="_blank">谷歌云定价计算器— #1 </a></figcaption></figure><ul class=""><li id="0f2a" class="nq nr iq ke b kf kg kj kk ml ns mm nt mn nu kz nv nw nx ny bi translated"><strong class="ke ir">“等效资源”实例基准测试</strong> —相同资源级别的实例间的性能</li></ul><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/9896e3130db09c1a18aeded6d0d2ec56.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*eLrBl-2VFCao_dv_5FeVVw.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">“等效资源”实例基准测试，来源:<a class="ae la" href="https://cloud.google.com/products/calculator/#id=eb2008ec-9d32-4d7b-b7c6-6dc0f9dc0410" rel="noopener ugc nofollow" target="_blank">谷歌云定价计算器— #2 </a></figcaption></figure><ul class=""><li id="9876" class="nq nr iq ke b kf kg kj kk ml ns mm nt mn nu kz nv nw nx ny bi translated"><strong class="ke ir">“最便宜的/实验性的”实例基准测试(可选)</strong> —不完全是比较性能的最佳方法，但如果在实验或试用 Google Cloud PostgreSQL 数据库时，将成本保持在最低是主要考虑因素，则有助于了解您可能想要使用哪种托管工具。使用它来比较每个托管工具的最便宜实例的性能。<strong class="ke ir"> (Pgbench 仅用于提供一个简单的视角)</strong></li></ul><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/5127dd6b360c4a7cbec384a1a24a57dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*IbG3O58YcvzZhomxo_TY5Q.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">“最便宜/实验性”实例基准测试，来源:<a class="ae la" href="https://cloud.google.com/products/calculator/#id=a36907bb-9869-415e-b17d-7c212567db73" rel="noopener ugc nofollow" target="_blank">谷歌云定价计算器— #3 </a></figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="93e4" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3.Pgbench 结果</h1><p id="6e65" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">让我们从使用 Pgbench 的基准测试结果开始——如前所述，最好将其视为数据库压力测试。</p><h2 id="e11c" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">3.1.<strong class="ak">“同等定价”实例基准测试</strong></h2><div class="mh mi mj mk gt ab cb"><figure class="oo jr op oq or os ot paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/43e8ffc1953495616165ba4647c5f332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*MCAa_3mWSGLcktnPO6U0Bg.png"/></div></figure><figure class="oo jr ou oq or os ot paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/f4d7f2b6c886deb4c4ae7b764c9cb466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*RfAWc5Yz4UrvPLpDc86oXA.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk ov di ow ox translated">来源:<a class="ae la" href="https://docs.google.com/spreadsheets/d/1j4_UVD5IyBjsZy25BjO4cn42yFeDVhFcGi33OmcAgA8/edit#gid=2104739530" rel="noopener ugc nofollow" target="_blank"> #1 —“同等定价”TPS </a>和<a class="ae la" href="https://docs.google.com/spreadsheets/d/1j4_UVD5IyBjsZy25BjO4cn42yFeDVhFcGi33OmcAgA8/edit#gid=0" rel="noopener ugc nofollow" target="_blank"> #1 —“同等定价”延迟平均值</a></figcaption></figure></div><p id="f724" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">有趣的是，<strong class="ke ir"> AlloyDB 在每秒事务处理量(TPS)和延迟方面始终比云 SQL 做得更好</strong>，即使它是一个与云 SQL 成本相同的较低层实例。</p><p id="72b4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">正如预期的那样，AlloyDB 和 Cloud SQL 的 TPS 数量在连接数较低时达到峰值，并随着客户端连接的扩展而开始下降。在峰值时，AlloyDB 在 TPS 方面比云 SQL 领先 3–10%。</p><p id="6afc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">在 50 到 250 个客户端连接中，AlloyDB 在 TPS 方面领先 8–15%。当从 300 个客户端连接进一步扩展时，AlloyDB 的 TPS 可以比 Cloud SQL 高出 50%以上，即使 TPS 在两项指标上都有所下降。</p><p id="f05b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><strong class="ke ir">在 Pgbench 的 TPC-B 基准测试中，AlloyDB 的整体性能始终比云 SQL 的客户端连接&lt; 300 高出约 10%,并且当客户端连接开始扩大时，与云 SQL 相比，性能下降速度也较慢。</strong></p><h2 id="a44f" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">3.2.<strong class="ak">“等效资源”实例基准测试</strong></h2><div class="mh mi mj mk gt ab cb"><figure class="oo jr oy oq or os ot paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/40529d5c64e734db0f7312ec08ed7561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*zvGnTjEKXYiZe_6WJl4Yrw.png"/></div></figure><figure class="oo jr oz oq or os ot paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/878c1ed2a99a5bad11f142a3f7da4514.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*9XM3rCljSfIhDV9iq3CBXA.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk pa di pb ox translated">来源:<a class="ae la" href="https://docs.google.com/spreadsheets/d/1j4_UVD5IyBjsZy25BjO4cn42yFeDVhFcGi33OmcAgA8/edit#gid=1335226202" rel="noopener ugc nofollow" target="_blank"> #2 —“等效资源”TPS </a>和<a class="ae la" href="https://docs.google.com/spreadsheets/d/1j4_UVD5IyBjsZy25BjO4cn42yFeDVhFcGi33OmcAgA8/edit#gid=1843628093" rel="noopener ugc nofollow" target="_blank"> #2 —“等效资源”平均延迟</a></figcaption></figure></div><p id="75b5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">对于 CloudSQL 与 AlloyDB 的同等资源，总体趋势与上次比较相似——alloy db 与 Cloud SQL 相比享有更好的 TPS 性能，尤其是现在分配的资源与上次测试相比更加接近。</p><p id="ba31" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">当客户端连接较少时，AlloyDB 和 Cloud SQL 的 TPS 数量再次达到峰值，并随着客户端连接的扩展而开始下降。</p><p id="d392" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><strong class="ke ir">然而，随着客户端连接从&gt; 100 扩展，AlloyDB 的 TPS 性能与 CloudSQL 相比下降得更慢，性能差异为&gt; 10%，在 500 个客户端连接时差异高达 100%。这使它能够以更一致的性能为更多的客户端连接提供服务。</strong></p><h2 id="f21b" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">3.3.<strong class="ak">“最便宜/实验性”实例基准测试</strong></h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pc"><img src="../Images/0e0b3c86b31beca729bcb25b3d92f3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9V91HHxyCDW0Is5ZD09LMw.png"/></div></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">来源:<a class="ae la" href="https://docs.google.com/spreadsheets/d/1j4_UVD5IyBjsZy25BjO4cn42yFeDVhFcGi33OmcAgA8/edit#gid=794307959" rel="noopener ugc nofollow" target="_blank"> #3 —“最便宜的/实验性的”TPS </a></figcaption></figure><p id="25f7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">当检查最便宜的实例时，云 SQL 受到较小实例的低连接限制的高度限制，因此数据点较少。由于 Cloud SQL 端没有太多的数据点来显示趋势，所以让我们看看原始数据。</p><p id="9882" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">当查看较低的客户端连接数时，总体 TPS 性能接近，AlloyDB 仅略微领先。<strong class="ke ir">考虑到云 SQL 的“db-f1-micro”实例的成本约为 AlloyDB 最便宜实例的 11%——如果您打算保持低成本(例如开发或实验实例)，云 SQL 可能是这里更有吸引力的选择。</strong>您可以通过手动修改 PostgreSQL 的 Cloud SQL 中的<a class="ae la" href="https://cloud.google.com/sql/docs/quotas#postgresql" rel="noopener ugc nofollow" target="_blank"> max_connections </a>标志来绕过连接限制。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="af74" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">4.HammerDB 结果</h1><p id="481e" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">现在我们已经查看了 Pgbench 的结果，让我们转到 HammerDB，在这里我们使用 TPC-C 概要文件作为 OLTP 基准。请注意，我们将使用每分钟事务数(TPM ),这是基准测试给出的一个指标，而不是 TPS。</p><h2 id="dbc7" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">4.1.“同等定价”实例基准测试</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/8c7c8fb7f659c04dd1c6f07f974d2a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*fxop6SD7rlculNVDF-pnYQ.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">来源:<a class="ae la" href="https://docs.google.com/spreadsheets/d/1GxoQANqYG2r0DEVqOZRzhn7srmcnnL-jypXtun8QIsM/edit#gid=2104739530" rel="noopener ugc nofollow" target="_blank"> #1 —“同等定价”TPM </a></figcaption></figure><p id="c7f5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">在比较这两个数据库的 TPM 趋势时，我们看到虽然结果最初波动很大，但<strong class="ke ir"> Cloud SQL 能够在较低的客户端连接上提供较高的 TPM，而 AlloyDB 的 TPM 在 50 到 150 个连接的中等水平上更好</strong>。随着连接数的增加，两个数据库显示出类似的 TPM 趋势。</p><p id="0fef" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><strong class="ke ir">在这种“同等定价”的配置中，两个数据库的性能似乎处于相似的水平</strong>，这似乎是由于 TPC-C 基准测试的性质，它侧重于模拟 OLTP 操作，而不是压力测试。</p><h2 id="60a8" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">4.2.“等效资源”实例基准测试</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/7efbc6aa8b8beab96b5b2c40a738a246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*Y8uhfdWrhvnSds_ArxRgaQ.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">来源:#2 — <a class="ae la" href="https://docs.google.com/spreadsheets/d/1GxoQANqYG2r0DEVqOZRzhn7srmcnnL-jypXtun8QIsM/edit#gid=1335226202" rel="noopener ugc nofollow" target="_blank">“等效资源”TPM </a></figcaption></figure><p id="dffe" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">与 Hammer DB 的第一次测试结果不同,“等效资源”配置显示了更明显的有利于 AlloyDB 的趋势。</p><p id="f684" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">在中等数量的连接(≥ 25)情况下，AlloyDB 在 TPM 中的表现始终优于云 SQL。从 100 个连接开始，<strong class="ke ir">与云 SQL 相比，AlloyDB 能够处理 300%到 500%的事务数量，</strong>尽管 AlloyDB 的成本仅比云 SQL 高 57.4%。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="e6ed" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">总结——理解结果</h1><p id="4901" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">在比较<strong class="ke ir"/><strong class="ke ir"/>AlloyDB <strong class="ke ir">工具时，alloy db<strong class="ke ir">在对其执行的原始事务中比云 SQL 做得更好</strong>——差异在<strong class="ke ir">3%–50%</strong>之间变化，但当我们考虑 OLTP 性能时<strong class="ke ir">表现相似 OLTP 性能模拟了使用数据库(如网络)的其他延迟方面以及人的方面(如响应时间)。</strong></strong></p><p id="fcb4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">然而，当我们比较在<strong class="ke ir">“等效资源”</strong>配置下运行的实例时，我们看到 AlloyDB 始终表现更好。AlloyDB 在原始事务中比云 SQL 多提供了 10%到 100%的 T21。<strong class="ke ir">在比较 OLTP 性能时，AlloyDB 的性能比云 SQL 高 3-5 倍。</strong></p><h2 id="34dd" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">校准我们的期望以更好地解释结果</h2><p id="e993" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">我们必须明白，在 AlloyDB 和 Cloud SQL 之间比较<strong class="ke ir">【同等价格】</strong>的配置，就像比较苹果和橙子一样。这同样适用于<strong class="ke ir">“等效资源”</strong>配置。</p><p id="aa3e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><a class="ae la" href="https://weiyuan-liu.medium.com/postgresql-on-google-cloud-alloydb-cloud-sql-or-cloud-spanner-b03c391bd853" rel="noopener">正如上一次</a>所讨论的，AlloyDB 具有云 SQL 中没有的用例和可靠性方面，因为 AlloyDB 是一个“被管理”而不是“自我管理”的工具。因此，AlloyDB 的较高成本的一部分应该归因于使用云 SQL 时的其他方面，如开发和维护成本。</p><p id="8eed" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">使用<strong class="ke ir">【同等定价】</strong>和<strong class="ke ir">【同等资源】</strong>配置作为基础，如果您或您的公司将 AlloyDB 在云 SQL 上的功能视为当前甚至未来使用的净正增值，使用 AlloyDB 将是有益的。如果使用<strong class="ke ir">“同等价格”</strong>配置运行，唯一的成本是迁移，但是您将获得很小的性能提升。如果使用<strong class="ke ir">“等效资源”</strong>配置运行，与成本相比，应用程序的性能和可伸缩性会有更大的提升。</p><p id="74b2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">但是，如果你想把成本作为主要因素(开发实例、实验等)。)，坚持使用云 SQL 可能是明智的。其最便宜的选项几乎比 AlloyDB 今天最便宜的选项便宜 10 倍。</p><h2 id="790e" class="mo lj iq bd lk mp mq dn lo mr ms dp ls ml mt mu lw mm mv mw ma mn mx my me mz bi translated">最终注释</h2><p id="dfec" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">尽管已经讨论过了，并且暗示了提供 AlloyDB 作为竞争选择的场景，但是必须注意 AlloyDB 仍然处于<a class="ae la" href="https://cloud.google.com/products#product-launch-stages" rel="noopener ugc nofollow" target="_blank">预览</a>状态。它也不提供承诺使用折扣，造成了更大的价格差距。我建议在这里采取谨慎的态度，例如在正式发布之前，是否使用它来替换您今天的生产实例。</p><p id="3c02" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">另一方面，需要注意的是，我们只测试了 2-3 种不同的配置，如果实例值发生变化，则“同等定价”或“同等资源”的结果可能不会直接适用。如果您打算将不同配置的云 SQL 实例迁移到 AlloyDB，请执行您自己的基准测试。</p><p id="c24a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><strong class="ke ir">也就是说，如果这些性能基准与 AlloyDB 的最终 GA 版本保持一致，它将描绘出一幅充满希望的使用图，并有可能在未来超过 Cloud SQL 的 PostgreSQL。</strong></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="6176" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">旁注#1 —值得注意的问题</h1><p id="664f" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">1.<strong class="ke ir"> AlloyDB </strong> —面临的附带问题—运行 HammerDB 基准测试一段时间后 AlloyDB 的事务速度变慢—必须重新启动 AlloyDB 数据库实例来解决该问题</p><p id="f589" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">2.<strong class="ke ir"> AlloyDB </strong> —确保使用<a class="ae la" href="https://cloud.google.com/alloydb/docs/backup/delete#procedure" rel="noopener ugc nofollow" target="_blank"> CLI </a>删除 AlloyDB 创建的任何备份，因为它目前在云控制台(云 UI)中不可用</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pf"><img src="../Images/d71ec9c4907f85911bfba63a65c8b0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNedl8I-a_mjk4nFv5-7PQ.png"/></div></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">用户界面有恢复按钮，但没有删除按钮</figcaption></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/62b5839c7b9c913df78c0e2de61b97b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*Fw1TrS4nqBNL2yJaPi-vrA.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">隐性成本—如果测试时间超过一天并且创建了备份，可能会让人措手不及</figcaption></figure><p id="3cbf" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated"><strong class="ke ir"> 3。云扳手</strong> —不幸的是，我们这次无法测试云扳手。<strong class="ke ir">然而，使用</strong> <a class="ae la" href="https://cloud.google.com/spanner/docs/jdbc-drivers" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> JDBC 驱动程序</strong> </a> <strong class="ke ir">作为未来的简单数据库压力测试基准还是有希望的</strong>:</p><ul class=""><li id="1e21" class="nq nr iq ke b kf kg kj kk ml ns mm nt mn nu kz nv nw nx ny bi translated">使用 PostgreSQL 接口的 Cloud Spanner 对 JDBC 驱动程序的使用目前还没有文档记录——在提交基准测试之前，最好定期检查更新<a class="ae la" href="https://cloud.google.com/spanner/docs/use-oss-jdbc" rel="noopener ugc nofollow" target="_blank">这里</a></li><li id="1863" class="nq nr iq ke b kf oc kj od ml oe mm of mn og kz nv nw nx ny bi translated">查看关于<a class="ae la" href="https://cloud.google.com/community/tutorials/jmeter-spanner-performance-test" rel="noopener ugc nofollow" target="_blank">使用 JMeter </a>测量云扳手性能的更多信息，该工具可用于使用 PostgreSQL 和 AlloyDB 对云 SQL 进行基准测试，只是不需要连接到云扳手的额外驱动程序。</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="691c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">旁注#2 —云扳手与基准工具的兼容性</h1><p id="8170" class="pw-post-body-paragraph kb kc iq ke b kf nl kh ki kj nm kl km ml nn kp kq mm no kt ku mn np kx ky kz ij bi translated">Pgbench —不适用于云扳手</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ph"><img src="../Images/01aa4d84bcd104003c545b363cce4005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyEg2rAQinBxiQgAmsmk5g.png"/></div></div></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/b51d8f4c6870f9678c37d5142511d747.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*kaRTZ4vU7NGB9y-uNAQdOg.png"/></div></figure><p id="121a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz ij bi translated">HammerDB —不适用于云扳手</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pj"><img src="../Images/f564c4bd62787684e4808b9eb0001b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_B9BGxEgeGjYjh1GztBrQ.png"/></div></div></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/51fe195ed46cc30fe6d09fada004f955.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*bcqdLQ3v_1cMUuBgqGrRLg.png"/></div></figure></div></div>    
</body>
</html>