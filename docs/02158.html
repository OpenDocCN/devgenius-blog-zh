<html>
<head>
<title>React Tips — Copy to Clipboard, Comparing Old and New Values with Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应提示—复制到剪贴板，用钩子比较新旧值</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-tips-copy-to-clipboard-comparing-old-and-new-values-with-hooks-a5f22a258a09?source=collection_archive---------4-----------------------#2020-07-21">https://blog.devgenius.io/react-tips-copy-to-clipboard-comparing-old-and-new-values-with-hooks-a5f22a258a09?source=collection_archive---------4-----------------------#2020-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c5961092d20bc6371a5419f854619d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gv6yjzSoI92Fd01h"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Ramiz deda kovi在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1bf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="0f6b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何将文本复制到剪贴板</h1><p id="d0f5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过使用<code class="fe me mf mg mh b">navigator.ckipboard.writeText</code>方法将文本复制到剪贴板。</p><p id="e26c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="690a" class="mq lc iq mh b gy mr ms l mt mu">&lt;button <br/>  onClick={() =&gt;  navigator.clipboard.writeText('copy this to clipboard')}<br/>&gt;<br/>  copy to clipboard<br/>&lt;/button&gt;</span></pre><p id="dd63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将参数中字符串的文本复制到剪贴板。</p><p id="4859" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用react-copy-to-clipboard包来简化我们的工作。</p><p id="f448" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="086a" class="mq lc iq mh b gy mr ms l mt mu">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import {CopyToClipboard} from 'react-copy-to-clipboard';<br/> <br/>class App extends React.Component {<br/>  state = {<br/>    value: '',<br/>    copied: false,<br/>  };</span><span id="b5dc" class="mq lc iq mh b gy mv ms l mt mu">  onChange({target: {value}}) {<br/>    this.setState({value, copied: false});<br/>  },<br/> <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;input value={this.state.value} onChange={this.onChange} /&gt;<br/> <br/>        &lt;CopyToClipboard text={this.state.value}<br/>          onCopy={() =&gt; this.setState({copied: true})}&gt;<br/>          &lt;span&gt;Copy to clipboard with span&lt;/span&gt;<br/>        &lt;/CopyToClipboard&gt;<br/><br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="8832" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该包带有<code class="fe me mf mg mh b">CopyToClipboard</code>组件。</p><p id="86f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它使用了带有我们想要复制到剪贴板的文本的<code class="fe me mf mg mh b">text</code>道具。</p><p id="c19e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">复制文本时运行<code class="fe me mf mg mh b">onCopy</code>道具。</p><p id="a788" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在组件内部，我们有可以点击进行复制的内容。</p><p id="d65e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦元素被点击，<code class="fe me mf mg mh b">text</code>道具中的内容将被复制到剪贴板。</p><p id="dab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用<code class="fe me mf mg mh b">execCommand</code>方法将选中的DOM元素的内容复制到剪贴板。</p><p id="ade1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="16df" class="mq lc iq mh b gy mr ms l mt mu">import React, { useRef, useState } from 'react';</span><span id="c875" class="mq lc iq mh b gy mv ms l mt mu">export default function CopyExample() {</span><span id="e3e2" class="mq lc iq mh b gy mv ms l mt mu">const [copySuccess, setCopySuccess] = useState('');<br/>  const textAreaRef = useRef(null);</span><span id="d3bd" class="mq lc iq mh b gy mv ms l mt mu">  function copyToClipboard(e) {<br/>    textAreaRef.current.select();<br/>    document.execCommand('copy');<br/>  };</span><span id="892a" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      {<br/>       document.queryCommandSupported('copy') &amp;&amp;<br/>        &lt;div&gt;<br/>          &lt;button onClick={copyToClipboard}&gt;Copy&lt;/button&gt; <br/>          {copySuccess}<br/>        &lt;/div&gt;<br/>      }<br/>      &lt;form&gt;<br/>        &lt;textarea<br/>          ref={textAreaRef}<br/>          value='text to copy'<br/>        /&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="c708" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个带有<code class="fe me mf mg mh b">copyToClipboard</code>的功能组件，用于从我们的文本区域选择文本。</p><p id="dba3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选择通过以下方式完成:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f68a" class="mq lc iq mh b gy mr ms l mt mu">textAreaRef.current.select();</span></pre><p id="8c88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">textAreaRef</code>是我们分配给文本区域的引用。</p><p id="d90c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用带有<code class="fe me mf mg mh b">'copy'</code>参数的<code class="fe me mf mg mh b">execCommand</code>，将选中的文本复制到剪贴板。</p><p id="b433" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们返回的JSX中，我们检查复制命令是否支持:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="25a4" class="mq lc iq mh b gy mr ms l mt mu">document.queryCommandSupported('copy')</span></pre><p id="1906" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并显示一个按钮让我们复制数据。</p><p id="c5af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还有文本区，里面有要复制的内容。</p><h1 id="afb5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用一个onChange处理程序识别不同的输入</h1><p id="25cd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以对多个输入使用一个事件处理程序。</p><p id="2c1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以创建一个事件处理函数，它接受一个参数来标识我们已经更改的输入。</p><p id="d607" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a09b" class="mq lc iq mh b gy mr ms l mt mu">class App extends React.Component {<br/>  constructor() {<br/>    super();<br/>    this.state = { input1: 0, input2: 0 };<br/>    this.handleChange = this.handleChange.bind(this);<br/>  }</span><span id="afdf" class="mq lc iq mh b gy mv ms l mt mu">  handleChange(input, value) {<br/>    this.setState({<br/>      [input]: value<br/>    })<br/>  }</span><span id="f991" class="mq lc iq mh b gy mv ms l mt mu">  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;input type="text" onChange={e =&gt; this.handleChange('input1', e.target.value)} /&gt;<br/>        &lt;input type="text" onChange={e =&gt; this.handleChange('input2', e.target.value)} /&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="97a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传入一个回调函数，该函数用输入文本时想要改变的状态的键调用<code class="fe me mf mg mh b">handleChange</code>方法。</p><p id="0105" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以改变我们想要的输入。</p><p id="2f07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">handleChange</code>中的<code class="fe me mf mg mh b">setState</code>有一个计算属性名，而不是固定属性。</p><h1 id="141e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用useEffect钩子比较旧值和新值</h1><p id="26dc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">useRef</code>钩子来获取之前的值。</p><p id="43b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从组件本身获得最新的值。</p><p id="caf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="57c9" class="mq lc iq mh b gy mr ms l mt mu">const usePrevious = (value) =&gt; {<br/>  const ref = useRef();<br/>  useEffect(() =&gt; {<br/>    ref.current = value;<br/>  });<br/>  return ref.current;<br/>}</span><span id="fd2f" class="mq lc iq mh b gy mv ms l mt mu">const App = (props) =&gt; {<br/>  const { amount, balance } = props<br/>  const prevAmount = usePrevious({ amount, balance });<br/>  useEffect(() =&gt; {<br/>    if (prevAmount.amount !== amount) {<br/>      //...<br/>    }<br/>    <br/>    if (prevAmount.balance !== balance) {<br/>      //...<br/>    }<br/>  }, [amount, balance])  </span><span id="ea47" class="mq lc iq mh b gy mv ms l mt mu">  //...<br/>}</span></pre><p id="d8bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了一个<code class="fe me mf mg mh b">usePrevious</code>钩子来用<code class="fe me mf mg mh b">useRef</code>获取之前的值。</p><p id="54ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过将值设置为<code class="fe me mf mg mh b">ref.current</code>属性，我们将传递给钩子函数的旧值设置为。</p><p id="40ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后从钩子返回先前的值。</p><p id="e87f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">App</code>组件中，我们从道具中获取最新的值。</p><p id="3f7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">usePrevious</code>钩子中得到旧的值。</p><p id="8923" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在<code class="fe me mf mg mh b">useEffect</code>回调的时候对比一下。</p><p id="e787" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传入的数组中有我们想要监视其变化的值。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/178a256dcbcb17f4a9733f375668bbd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fYVXVbOQd2gLmYdr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@anyadiary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Waranya Mooldee </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="3b47" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="cb7f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">useRef</code>钩子设置以前的值。</p><p id="5a64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有多种方法可以将文本从组件复制到剪贴板。</p><p id="0fb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过创建自己的事件处理程序来识别组件中的不同输入。</p></div></div>    
</body>
</html>