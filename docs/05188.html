<html>
<head>
<title>Formatting Strings using Templates in C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在C#中使用模板格式化字符串</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/formatting-strings-using-templates-in-c-ba74ca53c07f?source=collection_archive---------1-----------------------#2021-06-29">https://blog.devgenius.io/formatting-strings-using-templates-in-c-ba74ca53c07f?source=collection_archive---------1-----------------------#2021-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4098" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在C#中呈现字符串模板</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/31dc82cc4281e42fd2734ec0cb781bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*El8NceTSw1JBVi713J9xlw.png"/></div></div></figure><p id="6185" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">C#有一个特性，字符串插值，以灵活和可读的方式格式化字符串。下面的例子演示了当我们事先有数据时，我们通常如何输出一个字符串，然后将数据传递给模板字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated"><a class="ae lt" href="https://gist.github.com/changhuixu/29b616dd54b4ac7b966ec841817af6f2" rel="noopener ugc nofollow" target="_blank">要诀链接</a></figcaption></figure><p id="b390" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一方面，当我们希望按照预定义的模板格式化某些字符串时，字符串插值在某些情况下不起作用。例如，该字符串可以是日志消息、警报、电子邮件模板等。</p><p id="e479" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了解决这个问题，我们可以使用一些NuGet包(例如，<a class="ae lt" href="https://github.com/jdiamond/Nustache/" rel="noopener ugc nofollow" target="_blank"> Nustache </a>，<a class="ae lt" href="https://github.com/StubbleOrg/Stubble" rel="noopener ugc nofollow" target="_blank">胡茬</a>，<a class="ae lt" href="https://github.com/jehugaleahsa/mustache-sharp" rel="noopener ugc nofollow" target="_blank"> mustache# </a>)通过用期望值替换特定语法中包装的参数来呈现模板。这些库像视图引擎一样工作，能够用复杂的逻辑编译模板。</p><p id="59d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我将向您展示用字符串模板中的值替换参数的两种简单方法，而不是使用这些库。完整的解决方案可以在<a class="ae lt" href="https://github.com/dotnet-labs/StringTemplates" rel="noopener ugc nofollow" target="_blank">我的GitHub库</a>中找到。</p><h1 id="5c88" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">字符串。格式()</h1><p id="c56f" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">格式化字符串最常见的方法是使用<code class="fe mr ms mt mu b">string.Format()</code>方法。该方法采用一个包含索引作为占位符的模板，并采用一个对象列表来剔除索引参数。让我们看看下面的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated"><a class="ae lt" href="https://gist.github.com/changhuixu/a34d690f73aace67719ff3c7c5787a43" rel="noopener ugc nofollow" target="_blank">要点链接</a></figcaption></figure><p id="dac8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，第1行定义了字符串模板，它是一个常量，包含两个索引:0和1。除了索引，我们还可以为每个对象添加格式化程序。第2行基于两个对象生成一个字符串，第3行将该字符串写入控制台。类似地，第4行将一个字符串直接写入控制台。</p><p id="e301" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用<code class="fe mr ms mt mu b">string.Format()</code>方法，我们可以很容易地用所需的值替换占位符。唯一的问题是，当我们阅读代码时，索引并没有传达太多的意义。因此，当参数数量较少时，这种方式效果最好。</p><h1 id="9b39" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">模板建模</h1><p id="1796" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">如果一个字符串模板包含许多参数，我们可能希望使用命名参数而不是索引来提高可读性。然后，我们需要利用某种模板语法，如小胡子或车把。我们可以自己快速实现一些东西，而不是安装第三方库。我将这种方式命名为“模板建模”，因为我们将把目标字符串建模为一个类。</p><p id="4fb2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们看看下面的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">要点链接</figcaption></figure><p id="78fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码片段中，我们定义了一个类<code class="fe mr ms mt mu b">MyString</code>来建模预定义字符串模板的构造和呈现。在<code class="fe mr ms mt mu b">MyString</code>类中，私有字典<code class="fe mr ms mt mu b">_parameters</code>用于存储字符串占位符及其值。命名占位符可以用一些不同于模板中其他内容的转义字符包装。</p><p id="f6e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第9行到第16行的构造函数可以用作参数的验证器，以确保它们是正确的或者有一些后备值，并且可以用作值转换器，以使每个模板段可以根据业务逻辑用转换后的值替换。</p><p id="eb4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，public <code class="fe mr ms mt mu b">ToString()</code>方法只是根据静态模板和输入参数返回格式化后的字符串。在<code class="fe mr ms mt mu b">ToString()</code>方法中，第20行使用了一个LINQ表达式，它用存储的值优雅地替换了所有模板段。</p><p id="38c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种方式允许我们轻松地用不同的参数编写单元测试。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="1422" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要注意的是，您可能想要清理对象，以便它们不会与您的模板混淆。例如，净化HTML电子邮件模板的输入以避免注入是一个好主意。另外，不要使用这些方法来生成SQL查询或语句。实体框架已经有了<a class="ae lt" href="https://docs.microsoft.com/en-us/ef/core/querying/raw-sql" rel="noopener ugc nofollow" target="_blank">一个生成原始SQL </a>的方法。</p><p id="c888" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天到此为止。同样，代码在<a class="ae lt" href="https://github.com/dotnet-labs/StringTemplates" rel="noopener ugc nofollow" target="_blank">我的GitHub库</a>中。感谢阅读。</p></div></div>    
</body>
</html>