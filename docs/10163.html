<html>
<head>
<title>Ansible troubleshooting — failed to connect to the host via ssh host localhost port 22</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可行的故障排除—无法通过 ssh 主机本地主机端口 22 连接到主机</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ansible-troubleshooting-failed-to-connect-to-the-host-via-ssh-host-localhost-port-22-6fe34278ab67?source=collection_archive---------0-----------------------#2022-10-12">https://blog.devgenius.io/ansible-troubleshooting-failed-to-connect-to-the-host-via-ssh-host-localhost-port-22-6fe34278ab67?source=collection_archive---------0-----------------------#2022-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="35d5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何解决使用 ansible_connection 本地参数在本地机器上测试代码时，通过 ssh 主机 localhost 端口 22 连接时出现连接失败致命错误的错误？</h2></div><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div></figure><p id="92cd" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">今天我们将讨论 Ansible 故障排除，特别是关于通过 ssh 连接到主机失败的本地主机错误。我是卢卡·伯尔顿，欢迎来到今天的《神秘飞行员》节目。</p><h1 id="3314" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">链接</h1><ul class=""><li id="5d5b" class="ma mb iq ko b kp mc ks md kv me kz mf ld mg lh mh mi mj mk bi translated"><a class="ae ml" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_delegation.html" rel="noopener ugc nofollow" target="_blank">https://docs . ansi ble . com/ansi ble/latest/user _ guide/playbooks _ delegation . html</a></li></ul><h1 id="3e30" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">演示</h1><p id="775f" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv mm kx ky kz mn lb lc ld mo lf lg lh ij bi translated">Ansible 连接失败问题的现场演示，并在<strong class="ko ir">库存</strong>文件中修复。</p><p id="6c0c" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">终端上的确切错误是:</p><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="8e40" class="mu lj iq mq b gy mv mw l mx my">fatal: [localhost]: UNREACHABLE! =&gt; {"changed": false, "msg": "Failed to connect to the host via ssh: ssh: connect to host localhost port 22: Connection refused", "unreachable": true}</span></pre><h2 id="03fe" class="mu lj iq bd lk mz na dn lo nb nc dp ls kv nd ne lu kz nf ng lw ld nh ni ly nj bi translated">错误代码</h2><ul class=""><li id="d64e" class="ma mb iq ko b kp mc ks md kv me kz mf ld mg lh mh mi mj mk bi translated">ping.yml</li></ul><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="3718" class="mu lj iq mq b gy mv mw l mx my">---<br/>- name: ping module demo<br/>  hosts: all<br/>  tasks:<br/>    - name: test connection<br/>      ansible.builtin.ping:</span></pre><ul class=""><li id="b40b" class="ma mb iq ko b kp kq ks kt kv nk kz nl ld nm lh mh mi mj mk bi translated">存货</li></ul><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="4ed6" class="mu lj iq mq b gy mv mw l mx my">localhost</span></pre><h2 id="03db" class="mu lj iq bd lk mz na dn lo nb nc dp ls kv nd ne lu kz nf ng lw ld nh ni ly nj bi translated">错误执行</h2><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="98a7" class="mu lj iq mq b gy mv mw l mx my">ansible-playbook -i inventory ping.yml</span><span id="515b" class="mu lj iq mq b gy nn mw l mx my">PLAY [ping module demo] *****************************************************************</span><span id="04aa" class="mu lj iq mq b gy nn mw l mx my">TASK [Gathering Facts] ******************************************************************<br/>fatal: [localhost]: UNREACHABLE! =&gt; {"changed": false, "msg": "Failed to connect to the host via ssh: ssh: connect to host localhost port 22: Connection refused", "unreachable": true}</span><span id="f371" class="mu lj iq mq b gy nn mw l mx my">PLAY RECAP ******************************************************************************<br/>localhost                  : ok=0    changed=0    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0</span></pre><h2 id="e29d" class="mu lj iq bd lk mz na dn lo nb nc dp ls kv nd ne lu kz nf ng lw ld nh ni ly nj bi translated">修复代码</h2><ul class=""><li id="bd42" class="ma mb iq ko b kp mc ks md kv me kz mf ld mg lh mh mi mj mk bi translated">ping.yml</li></ul><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="1818" class="mu lj iq mq b gy mv mw l mx my">---<br/>- name: ping module demo<br/>  hosts: all<br/>  tasks:<br/>    - name: test connection<br/>      ansible.builtin.ping:</span></pre><ul class=""><li id="814d" class="ma mb iq ko b kp kq ks kt kv nk kz nl ld nm lh mh mi mj mk bi translated">存货</li></ul><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="2bac" class="mu lj iq mq b gy mv mw l mx my">localhost ansible_connection=local</span></pre><h2 id="3d9a" class="mu lj iq bd lk mz na dn lo nb nc dp ls kv nd ne lu kz nf ng lw ld nh ni ly nj bi translated">修复执行</h2><pre class="kf kg kh ki gt mp mq mr ms aw mt bi"><span id="f934" class="mu lj iq mq b gy mv mw l mx my">$ ansible-playbook -i inventory ping.yml</span><span id="d181" class="mu lj iq mq b gy nn mw l mx my">PLAY [ping module demo] *****************************************************************</span><span id="17e7" class="mu lj iq mq b gy nn mw l mx my">TASK [Gathering Facts] ******************************************************************<br/>[WARNING]: Platform darwin on host localhost is using the discovered Python interpreter<br/>at /opt/homebrew/bin/python3.10, but future installation of another Python interpreter<br/>could change the meaning of that path. See <a class="ae ml" href="https://docs.ansible.com/ansible-" rel="noopener ugc nofollow" target="_blank">https://docs.ansible.com/ansible-</a><br/>core/2.13/reference_appendices/interpreter_discovery.html for more information.<br/>ok: [localhost]</span><span id="2334" class="mu lj iq mq b gy nn mw l mx my">TASK [test connection] ******************************************************************<br/>ok: [localhost]</span><span id="7c76" class="mu lj iq mq b gy nn mw l mx my">PLAY RECAP ******************************************************************************<br/>localhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span></pre><h1 id="e0a3" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">概述</h1><p id="bdfc" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv mm kx ky kz mn lb lc ld mo lf lg lh ij bi translated">现在，您更好地了解了如何排除最常见的关于无法通过 ssh 主机 localhost 端口 22 连接到主机的错误。</p><p id="3567" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，可以考虑注册<a class="ae ml" href="https://ansiblepilot.medium.com/membership" rel="noopener">成为一名媒体成员</a>。每月只需 5 美元，你就可以无限制地使用 Medium。</p><p id="f150" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">订阅<a class="ae ml" href="https://www.youtube.com/channel/UC5MNbTYRHSCu9vAki3z9SmA" rel="noopener ugc nofollow" target="_blank"> YouTube 频道</a>、<a class="ae ml" href="https://ansiblepilot.medium.com/" rel="noopener"> Medium </a>和<a class="ae ml" href="https://www.ansiblepilot.com/" rel="noopener ugc nofollow" target="_blank">网站</a>，不要错过 Ansible 试播的下一集。</p><h1 id="86f3" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">Ansible 的最佳资源</h1><h1 id="e167" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">视频课程</h1><ul class=""><li id="db6d" class="ma mb iq ko b kp mc ks md kv me kz mf ld mg lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.udemy.com/course/ansible-by-examples-devops/?referralCode=8E065F6D6F8622A3DEC8" rel="noopener ugc nofollow" target="_blank">在 200 多个示例中学习 Ansible Automation&amp;实践课程:通过一些关于如何使用最常见模块的真实示例和 ansi ble 行动手册来学习 ansi ble</a></li></ul><h1 id="6f4a" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">书</h1><ul class=""><li id="a719" class="ma mb iq ko b kp mc ks md kv me kz mf ld mg lh mh mi mj mk bi translated"><a class="ae ml" href="https://leanpub.com/ansiblebyexamples" rel="noopener ugc nofollow" target="_blank">可通过示例回答:针对 Linux 和 Windows 系统管理员和开发人员的 200 多个自动化示例</a></li><li id="833b" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09VCTP1L4" rel="noopener ugc nofollow" target="_blank">适用于 Windows 的示例:针对 Windows 系统管理员和开发人员的 30 多个自动化示例</a></li><li id="7676" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09VCX4CVD" rel="noopener ugc nofollow" target="_blank"> Ansible For Linux by Examples:针对 Linux 系统管理员和开发人员的 100 多个自动化示例</a></li><li id="0fda" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09X4TF8P8" rel="noopener ugc nofollow" target="_blank"> Ansible Linux 文件系统示例:30 多个针对现代 IT 基础设施的 Linux 文件和目录操作自动化示例</a></li><li id="6fc4" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09XVDWD4W" rel="noopener ugc nofollow" target="_blank">通过示例负责容器和 Kubernetes:10 多个自动化示例来自动化容器、Kubernetes 和 OpenShift </a></li><li id="89f2" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09VHFLSPP" rel="noopener ugc nofollow" target="_blank">负责安全示例:100 多个自动化示例，用于自动化安全和验证 IT 现代化基础设施的合规性</a></li><li id="36bc" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09ZJ4GYM2" rel="noopener ugc nofollow" target="_blank">可行的技巧和诀窍:10 多个可行的例子来节省时间和自动化更多的任务</a></li><li id="4197" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B09X6BYY8W" rel="noopener ugc nofollow" target="_blank"> Ansible Linux 用户&amp;按示例分组:20 多个关于现代 IT 基础设施的 Linux 用户和分组操作的自动化示例</a></li><li id="6fc6" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B0B18QG44S" rel="noopener ugc nofollow" target="_blank">ansi ble For VMware by Examples:10 多个自动化您的 VMware 基础架构的示例(Ansible by Examples) </a></li><li id="b194" class="ma mb iq ko b kp no ks np kv nq kz nr ld ns lh mh mi mj mk bi translated"><a class="ae ml" href="https://www.amazon.com/dp/B0B3RZZQVG" rel="noopener ugc nofollow" target="_blank">Ansible For PostgreSQL by Examples:10 多个自动化 PostgreSQL 数据库的示例</a></li></ul><h1 id="6ac1" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">捐赠</h1><div class="nt nu gp gr nv nw"><a href="https://patreon.com/lucaberton" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">卢卡·伯尔顿正在为 Ansible | Patreon 创建软件开源</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">今天就成为卢卡·伯尔顿的赞助人:获得世界上最大会员的独家内容和体验…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">patreon.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ol nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://github.com/sponsors/lucab85" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">GitHub 赞助商上的赞助商@lucab85</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">我是一个活跃的开源贡献者，参与到了 Ansible 社区中，尽管我到处都是。1 个赞助商有…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="om l oh oi oj of ok ol nw"/></div></div></a></div><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi on"><img src="../Images/c519456ff1c2019c45035dbf8195f84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYcyayI7AJUEOPgLnGnoMw.png"/></div></div></figure></div></div>    
</body>
</html>