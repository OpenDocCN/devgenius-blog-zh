# è¶…è¶Šæ‹¥æŠ±è„¸çš„è§†è§‰å˜å½¢é‡‘åˆš(ViT)|ç¬¬ 3 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://blog.devgenius.io/scale-vision-transformers-vit-beyond-hugging-face-part-3-5b8c13ef6477?source=collection_archive---------22----------------------->

## åŠ å¿«æ‹¥æŠ±è„¸æœ€å…ˆè¿›çš„ç»´ç”Ÿç´  t æ¨¡å‹ğŸ¤—å€ŸåŠ© Databricksã€Nvidia å’Œ Spark NLPï¼Œé€Ÿåº¦æå‡é«˜è¾¾ 2300%(25 å€)ğŸš€

![](img/c7572592ba711def70ee3e626385d598.png)

**é€šè¿‡ä½¿ç”¨**æ•°æ®æ¨¡å—**ã€**è‹±ä¼Ÿè¾¾**å’Œ **Spark NLP** æ‰©å±•**åŸºäº**å˜å‹å™¨**çš„å‹å·

ã€Šè¶…è¶Šæ‹¥æŠ±è„¸|ç¬¬äºŒéƒ¨ ã€‹å‰æƒ…æè¦:

> **Databricks å•èŠ‚ç‚¹: *Spark NLP*** *æ¯”* ***ä¸Šçš„æŠ±è„¸å™¨å¿« 15%****CPU**åœ¨å¸¦æœ‰ 3K å›¾åƒçš„æ ·æœ¬æ•°æ®é›†ä¸Šé¢„æµ‹å›¾åƒç±»ï¼Œåœ¨å¸¦æœ‰ 34K å›¾åƒçš„è¾ƒå¤§æ•°æ®é›†ä¸Šå¿« 34%****ã€‚****Spark NLP****ä¹Ÿæ¯”***å¿« 51%****GPU****å¯¹äºæ‹¥æœ‰ 34K å›¾åƒçš„æ›´å¤§æ•°æ®é›†ï¼Œé€Ÿåº¦å¯è¾¾******å¿« 36%********

> ****æœ¬æ–‡çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•ä» Hugging Face å‘å¤–æ‰©å±• Vision Transformer (ViT)æ¨¡å‹ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§å°±ç»ªç¯å¢ƒä¸­ï¼Œä»¥å®ç°åŠ é€Ÿå’Œé«˜æ€§èƒ½çš„æ¨ç†ã€‚æœ€åï¼Œæˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨ Databricksã€Nvidia å’Œ Spark NLPï¼Œå°†æ‹¥æŠ±è„¸çš„ ViT æ¨¡å‹æ‰©å±• 25 å€(2300%)ã€‚****

## ****åœ¨æœ¬æ–‡çš„ç¬¬ 3 éƒ¨åˆ†ï¼Œæˆ‘å°†:****

*   ****æ•°æ®å—å†…éƒ¨çš„åŸºå‡† Spark NLP é€šè¿‡ CPU å’Œ GPU æ‰©å±•åˆ° 10 å€èŠ‚ç‚¹****
*   ****æ€»ç»“ä¸€åˆ‡ï¼****

> *****æœ¬ç€å®Œå…¨é€æ˜çš„ç²¾ç¥ï¼ŒGitHub* ä¸Šçš„[](https://github.com/JohnSnowLabs/spark-nlp-workshop/tree/master/tutorials/blogposts/medium/scale-vision-transformers-vit-beyond-hugging-face?ref=hackernoon.com)****

******[](/scale-vision-transformers-vit-beyond-hugging-face-part-1-e09318cab588) [## è¶…è¶Šæ‹¥æŠ±è„¸çš„è§†è§‰å˜å½¢é‡‘åˆš(ViT)|ç¬¬ 1 éƒ¨åˆ†

### åŠ å¿«æ‹¥æŠ±è„¸æœ€å…ˆè¿›çš„ç»´ç”Ÿç´  t æ¨¡å‹ğŸ¤—ä½¿ç”¨ Databricksã€Nvidia å’Œâ€¦â€¦æœ€é«˜å¯è¾¾ 2300%(å¿« 25 å€)

blog.devgenius.io](/scale-vision-transformers-vit-beyond-hugging-face-part-1-e09318cab588) [](/scale-vision-transformers-vit-beyond-hugging-face-part-2-b7b296d548b7) [## è¶…è¶Šæ‹¥æŠ±è„¸çš„è§†è§‰å˜å½¢é‡‘åˆš(ViT)|ç¬¬ 2 éƒ¨åˆ†

### åŠ å¿«æ‹¥æŠ±è„¸æœ€å…ˆè¿›çš„ç»´ç”Ÿç´  t æ¨¡å‹ğŸ¤—ä½¿ç”¨ Databricksã€Nvidia å’Œâ€¦â€¦æœ€é«˜å¯è¾¾ 2300%(å¿« 25 å€)

blog.devgenius.io](/scale-vision-transformers-vit-beyond-hugging-face-part-2-b7b296d548b7) [](/scale-vision-transformers-vit-beyond-hugging-face-part-3-5b8c13ef6477) [## è¶…è¶Šæ‹¥æŠ±é¢éƒ¨çš„ç”µå­ç§¤è§†è§‰å˜å½¢é‡‘åˆš(ViT)|ç¬¬ 3 éƒ¨åˆ†

### åœ¨æ‹¥æŠ±è„¸ä¸­åŠ é€Ÿæœ€å…ˆè¿›çš„ ViT æ¨¡å‹ğŸ¤—ä½¿ç”¨ Databricksã€Nvidia å’Œâ€¦å¯å®ç°é«˜è¾¾ 2300%çš„æ€§èƒ½æå‡(é€Ÿåº¦æå‡ 25 å€)

blog.devgenius.io](/scale-vision-transformers-vit-beyond-hugging-face-part-3-5b8c13ef6477) 

# è¶…è¶Šå•å°æœºå™¨

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šåœ¨è£¸æœºæœåŠ¡å™¨å’Œ Databricks å•èŠ‚ç‚¹ä¸Šï¼Œ **GPU** ä¸Šçš„**æ‹¥æŠ±è„¸**æ¯”**CPU**ä¸Šçš„**æ‹¥æŠ±è„¸**æ›´å¿«ã€‚å½“æ‚¨ç”¨è¿™äº›æ–°çš„åŸºäºå˜å‹å™¨çš„æ¨¡å‹æ¯”è¾ƒ GPU å’Œ CPU æ—¶ï¼Œè¿™å°±æ˜¯æ‚¨æ‰€æœŸæœ›çš„ã€‚

åœ¨ç›¸åŒçš„æ•°æ®é›†ä¸Šï¼Œåœ¨è£¸æœºæœåŠ¡å™¨å’Œ Databricks å•èŠ‚ç‚¹é›†ç¾¤ä¸­ï¼Œå¯¹äºç›¸åŒçš„ç®¡é“(ViT æ¨¡å‹)ï¼Œæˆ‘ä»¬å·²ç»ç¡®å®š **Spark NLP** ä¼˜äº**æ‹¥æŠ±è„¸**ï¼Œå¹¶ä¸”åœ¨ CPU å’Œ GPU è®¾å¤‡ä¸Šéƒ½è¡¨ç°æ›´å¥½ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘æ‰€æœŸæœ›çš„ã€‚å½“æˆ‘å‡†å¤‡è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘æœŸæœ› Spark NLP ä¸­çš„ TensorFlow æ¨ç†æ¯”ä½¿ç”¨ PyTorch çš„æ‹¥æŠ±è„¸æ¨ç†ç¨å¾®æ…¢ä¸€ç‚¹ï¼Œæˆ–è€…è‡³å°‘æ˜¯ä¸ç›¸ä¸Šä¸‹ã€‚æˆ‘çš„ç›®æ ‡æ˜¯è¿™ä¸€éƒ¨åˆ†ï¼Œè¶…è¶Šå•å°æœºå™¨**æ‰©å±•ç®¡é“ã€‚ä½†æ˜¯ Spark NLP ä¼¼ä¹æ¯”æ‹¥æŠ±è„¸æ›´å¿«ï¼Œå³ä½¿æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œåœ¨ä¸¤ä¸ª **CPU** å’Œ **GPU** ä¸Šï¼Œåœ¨ä¸¤ä¸ª**å°çš„**å’Œ**å¤§çš„**æ•°æ®é›†ä¸Šã€‚**

**é—®é¢˜:**å¦‚æœæ‚¨æƒ³åŠ å¿« ViT ç®¡é“çš„é€Ÿåº¦ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœæ‚¨æœ‰æ›´å¤§çš„æ•°æ®é›†ï¼Œå´æ— æ³•å°†å®ƒä»¬æ”¾åœ¨ä¸€å°æœºå™¨ä¸­ï¼Œæˆ–è€…åªéœ€è¦å¤ªé•¿æ—¶é—´æ‰èƒ½å¾—åˆ°ç»“æœï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

**å›ç­”:**å‘å¤–æ‰©å±•ï¼è¿™æ„å‘³ç€ä¸è¦è°ƒæ•´åŒä¸€å°æœºå™¨çš„å¤§å°ï¼Œè€Œæ˜¯å‘é›†ç¾¤ä¸­æ·»åŠ æ›´å¤šçš„æœºå™¨ã€‚æ‚¨éœ€è¦ä¸€äº›ä¸œè¥¿æ¥ç®¡ç†æ‰€æœ‰è¿™äº›ä½œä¸š/ä»»åŠ¡/è°ƒåº¦ DAGs ç®¡ç†å¤±è´¥çš„ä»»åŠ¡/ç­‰ç­‰ã€‚è¿™äº›éƒ½æœ‰å®ƒä»¬çš„å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦æ›´å¿«æˆ–è€…å¯èƒ½çš„ä¸œè¥¿(åœ¨ä¸€å°æœºå™¨ä¹‹å¤–),ä½ å¿…é¡»ä½¿ç”¨æŸç§åˆ†å¸ƒå¼ç³»ç»Ÿã€‚

> **æŒ‰æ¯”ä¾‹æ”¾å¤§=** ä½¿æœºå™¨æ›´å¤§æˆ–æ›´å¿«ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¤„ç†æ›´å¤šè´Ÿè½½ã€‚
> 
> **æ¨ªå‘æ‰©å±•=** å¹¶è¡Œæ·»åŠ æ›´å¤šæœºå™¨ä»¥åˆ†æ•£è´Ÿè½½ã€‚

## ç¼©å°æ‹¥æŠ±è„¸:

æŸ¥çœ‹æ‹¥æŠ±è„¸å®˜ç½‘çš„é¡µé¢è¡¨æ˜ï¼Œåªæœ‰ä½¿ç”¨å¤š GPU æ‰èƒ½è¿›è¡Œç¼©æ”¾æ¨æ–­ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€æè¿°çš„æ¨ªå‘æ‰©å±•ï¼Œå®ƒä»ç„¶åœç•™åœ¨ä¸€å°æœºå™¨ä¸Š:

![](img/a9b448ecfa2399e169931ade829d99ab.png)

[https://huggingface.co/docs/transformers/performance](https://huggingface.co/docs/transformers/performance)

> å¦å¤–ï¼Œæ›´ä¸ç”¨è¯´ç›®å‰è¿˜ä¸å­˜åœ¨æ‹¥æŠ±è„¸ä¸­**æ¨ç†**çš„**å¤šå¤„ç†å™¨**è§£å†³æ–¹æ¡ˆ:

![](img/b8bd9bab0fdc85f032cb102b3ba4c848.png)

[https://hugging face . co/docs/transformers/perf _ infer _ GPU _ many](https://huggingface.co/docs/transformers/perf_infer_gpu_many)

å› æ­¤ï¼Œä¼¼ä¹æ²¡æœ‰æœ¬åœ°/å®˜æ–¹çš„æ–¹å¼æ¥**æ‰©å±•**æ‹¥æŠ±è„¸ç®¡é“ã€‚æ‚¨å¯ä»¥å®ç°ç”±ä¸€äº›å¾®æœåŠ¡ç»„æˆçš„æ¶æ„ï¼Œä¾‹å¦‚ä½œä¸šé˜Ÿåˆ—ã€æ¶ˆæ¯ä¼ é€’åè®®ã€RESTful APIs åç«¯å’Œä¸€äº›å…¶ä»–å¿…éœ€çš„ç»„ä»¶ï¼Œä»¥å°†æ¯ä¸ªè¯·æ±‚åˆ†å¸ƒåˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œä½†è¿™æ˜¯æŒ‰å•ä¸ªç”¨æˆ·æ‰©å±•è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ‰©å±•å®é™…çš„ç³»ç»Ÿæœ¬èº«ã€‚

æ­¤å¤–ï¼Œæ­¤ç±»ç³»ç»Ÿçš„å»¶è¿Ÿä¸ Apache Spark ç­‰æœ¬åœ°åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯åŒæ—¥è€Œè¯­(gRPC å¯èƒ½ä¼šé™ä½å»¶è¿Ÿï¼Œä½†ä»ç„¶æ²¡æœ‰ç«äº‰åŠ›)ã€‚æ›´ä¸ç”¨è¯´å•ç‚¹æ•…éšœé—®é¢˜ï¼Œç®¡ç†å¤±è´¥çš„ä½œä¸š/ä»»åŠ¡/è¾“å…¥ï¼Œä»¥åŠ Apache Spark æä¾›çš„æ•°ç™¾ä¸ªå…¶ä»–ç‰¹æ€§ï¼Œç°åœ¨æ‚¨å¿…é¡»è‡ªå·±å®ç°/ç»´æŠ¤è¿™äº›ç‰¹æ€§ã€‚

åœ¨æ‹¥æŠ±è„¸ç½‘ç«™ä¸Šæœ‰ä¸€ç¯‡åšæ–‡æè¿°äº†é€šè¿‡æ‰©å±• REST ç«¯ç‚¹æ¥æœåŠ¡æ›´å¤šç”¨æˆ·çš„å®Œå…¨ç›¸åŒçš„æ¶æ„:â€œ[éƒ¨ç½²ğŸ¤—ViT on Kubernetes with TF Serving](https://huggingface.co/blog/deploy-tfserving-kubernetes)â€œæˆ‘ç›¸ä¿¡å…¶ä»–å…¬å¸ä¹Ÿåœ¨ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•æ¥æ‰©å±•æ‹¥æŠ±è„¸ï¼Œä½†æ˜¯ï¼Œä»–ä»¬éƒ½åœ¨æ‰©å±•è§¦åŠæ¨ç† REST ç«¯ç‚¹çš„ç”¨æˆ·/è¯·æ±‚çš„æ•°é‡ã€‚æ­¤å¤–ï¼Œæ‚¨ä¸èƒ½åœ¨**æ•°æ®å—ä¸Šä»¥è¿™ç§æ–¹å¼ç¼©æ”¾æ‹¥æŠ±è„¸ã€‚**

> ä¾‹å¦‚ï¼ŒfastAPI å†…éƒ¨çš„æ¨ç†æ¯”æœ¬åœ°æ¨ç†æ…¢ 10 å€:[https://towards data science . com/hugging-face-transformer-inference-under-1 æ¯«ç§’-latency-e1be0057a51c](https://towardsdatascience.com/hugging-face-transformer-inference-under-1-millisecond-latency-e1be0057a51c)

ä¸€æ—¦æ‹¥æŠ±è„¸æä¾›äº†ä¸€äº›æœ¬åœ°è§£å†³æ–¹æ¡ˆï¼Œæˆ‘å°†å†æ¬¡è¿è¡ŒåŸºå‡†ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå½“æ‚¨å¿…é¡»åœ¨å¾ªç¯ç®—æ³•ä¸­ä»å•å°æœºå™¨éå†æ•°æ®é›†ä»¥åˆ°è¾¾ REST ç«¯ç‚¹æ—¶ï¼Œæ²¡æœ‰å‘å¤–æ‰©å±•ã€‚(å†æƒ³æƒ³æˆ‘ä»¬ä¸€æ¬¡å°†è¡Œ/åºåˆ—/å›¾åƒåˆ†æ‰¹é€å…¥ GPU çš„éƒ¨åˆ†ï¼Œä½ å°±æ˜ç™½äº†)

## æ‰©å±• Spark NLP:

Spark NLP æ˜¯ Spark ML çš„æ‰©å±•ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨ Apache Spark æ”¯æŒçš„æ‰€æœ‰å¹³å°ä¸Šè¿›è¡Œæœ¬æœºæ— ç¼æ‰©å±•ï¼Œä¾‹å¦‚(ä½†ä¸é™äº)Databricksã€AWS EMRã€Azure Insightã€GCP Dataprocã€Clouderaã€SageMakerã€Kubernetes ç­‰ç­‰ã€‚

> é›¶ä»£ç å˜åŒ–æ˜¯å¿…è¦çš„ï¼Spark NLP å¯ä»¥åœ¨ä¸æ”¹å˜ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹ä»å•å°æœºå™¨æ‰©å±•åˆ°æ— é™å¤šå°æœºå™¨ï¼

æ‚¨ä¹Ÿä¸éœ€è¦ä» Spark NLP ä¸­å¯¼å‡ºä»»ä½•æ¨¡å‹ï¼Œå°±å¯ä»¥åœ¨ä¸€ä¸ªå®Œå…¨ä¸åŒçš„åº“ä¸­ä½¿ç”¨å®ƒæ¥åŠ é€Ÿæˆ–æ‰©å±•æ¨ç†ã€‚

![](img/9b1bad07da23d8b0c50be3108e6d5360.png)

Spark NLP ç”Ÿæ€ç³»ç»Ÿ:ç»è¿‡ä¼˜åŒ–ã€æµ‹è¯•å’Œæ”¯æŒçš„é›†æˆ

# AWS ä¸Šå¸¦ CPU çš„ Databricks å¤šèŠ‚ç‚¹

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼Œè¿™æ¬¡æˆ‘ä»¬é€‰æ‹©**æ ‡å‡†**å†…éƒ¨**é›†ç¾¤æ¨¡å¼**ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„é›†ç¾¤ä¸­å¯ä»¥æœ‰ä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨ Apache Spark æœ¯è¯­ä¸­ï¼Œè¿™æ„å‘³ç€ 1 ä¸ªé©±åŠ¨ç¨‹åºå’Œ N ä¸ªå·¥ä½œå™¨(æ‰§è¡Œå™¨)ã€‚

![](img/da07268fe0bda4ee36742edbd9368fa7.png)

æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡`Libraries`é€‰é¡¹å¡åœ¨è¿™ä¸ªæ–°é›†ç¾¤ä¸­å®‰è£… Spark NLPã€‚å¯¹äºå¸¦ CPU çš„å•èŠ‚ç‚¹æ•°æ®å—ï¼Œæ‚¨å¯ä»¥éµå¾ªæˆ‘åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„æ­¥éª¤ã€‚å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘é€‰æ‹©äº†æˆ‘ç”¨æ¥æµ‹è¯• Hugging Face å’Œ Spark NLP çš„åŸºäº CPU çš„ AWS å®ä¾‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬æ·»åŠ æ›´å¤šèŠ‚ç‚¹æ—¶å®ƒæ˜¯å¦‚ä½•æ‰©å±•çš„ã€‚

è¿™æ˜¯æˆ‘ä»¬çš„é›†ç¾¤é…ç½®çš„æ ·å­:

![](img/80faa32b85c6e0d184e812928ec5a2bd.png)

åªæœ‰ CPU çš„ Databricks å¤šèŠ‚ç‚¹(æ ‡å‡†)é›†ç¾¤

æˆ‘å°†é‡ç”¨æˆ‘åœ¨ä»¥å‰çš„åŸºå‡†æµ‹è¯•ä¸­ä½¿ç”¨çš„ç›¸åŒçš„ Spark NLP ç®¡é“**(ä¸éœ€è¦æ›´æ”¹ä»»ä½•ä»£ç )**ï¼Œå¹¶ä¸”æˆ‘å°†åªä½¿ç”¨å…·æœ‰ 34K å›¾åƒçš„è¾ƒå¤§æ•°æ®é›†ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼

## åœ¨å…·æœ‰ 2 ä¸ªèŠ‚ç‚¹çš„ CPU ä¸Šæ‰©å±• Spark NLP

![](img/7b71b564be70f221bda01f394ab04eca.png)

å…·æœ‰ 2 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”ä»…é™ CPU

æˆ‘ä»¬åªéœ€å†æ·»åŠ  1 ä¸ªèŠ‚ç‚¹ï¼Œå°†è¿›è¡Œå¤„ç†çš„æœºå™¨æ€»æ•°ä» 1 å°å¢åŠ åˆ° 2 å°ã€‚å½“æ‚¨ä»å•æœºè®¾ç½®(æ‚¨çš„ Colabã€Kaggleã€Databricks å•èŠ‚ç‚¹ï¼Œç”šè‡³æ‚¨çš„æœ¬åœ° Jupyter ç¬”è®°æœ¬)è¿‡æ¸¡åˆ°å¤šèŠ‚ç‚¹é›†ç¾¤è®¾ç½®(Databricksã€EMRã€GCPã€Azureã€Clouderaã€YARNã€Kubernetes ç­‰)æ—¶ï¼Œæˆ‘ä»¬ä¸è¦å¿˜è®° Spark NLP çš„é­…åŠ›ã€‚)ï¼Œéœ€è¦é›¶ä»£ç ä¿®æ”¹ï¼æˆ‘æ˜¯è¯´é›¶ï¼è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å°†åœ¨è¿™ä¸ªæ–°é›†ç¾¤ä¸­å¯¹åŒ…å« 34K å›¾åƒçš„è¾ƒå¤§æ•°æ®é›†è¿è¡Œç›¸åŒçš„åŸºå‡†æµ‹è¯•:

![](img/50d3018d6008f5aa06d07ff8e8b62e64.png)

Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿åœ¨å¸¦ CPU çš„ 2x èŠ‚ç‚¹ä¸Šé¢„æµ‹ 34742 å¹…å›¾åƒ

èŠ±äº†å¤§çº¦ **9 åˆ†é’Ÿ** ( **550 ç§’**)å®Œæˆäº†å¯¹ 34K å›¾åƒçš„åˆ†ç±»é¢„æµ‹ã€‚è®©æˆ‘ä»¬å°†åœ¨ **2x èŠ‚ç‚¹**ä¸Šçš„ç»“æœä¸ Spark NLP å’Œåœ¨ Databricks å•èŠ‚ç‚¹ä¸Šçš„æ‹¥æŠ±é¢ç»“æœè¿›è¡Œæ¯”è¾ƒ(æˆ‘å°†åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šé‡å¤æ‹¥æŠ±é¢ç»“æœä½œä¸ºå‚è€ƒï¼Œå› ä¸ºæ‹¥æŠ±é¢ä¸èƒ½åœ¨å¤šå°æœºå™¨ä¸Šæ‰©å±•ï¼Œå°¤å…¶æ˜¯åœ¨ Databricks ä¸Š):

![](img/bbea6b011556cd6f29678d8b8049d203.png)

**Spark NLP** æ¯”æ‹¥æœ‰ **2x èŠ‚ç‚¹**çš„æ‹¥æŠ±è„¸**å¿« 124%**

ä¹‹å‰ï¼ŒSpark NLP åœ¨å•èŠ‚ç‚¹ Databricks é›†ç¾¤ä¸Šä»…ä½¿ç”¨ CPU å°±å‡»è´¥äº† Hugging Face**15%**ã€‚

> è¿™ä¸€æ¬¡ï¼ŒSpark NLP é€šè¿‡ä»…ä½¿ç”¨ 2x ä¸ªèŠ‚ç‚¹è€Œä¸æ˜¯ 1 ä¸ªèŠ‚ç‚¹ï¼Œå®Œæˆäº†è¶…è¿‡ 34K å¼ å›¾åƒçš„å¤„ç†ï¼Œæ¯”æ‹¥æŠ±è„¸å¿«äº† 124%ã€‚

## åœ¨å…·æœ‰ 4 ä¸ªèŠ‚ç‚¹çš„ CPU ä¸Šæ‰©å±• Spark NLP

è®©æˆ‘ä»¬åƒä»¥å‰ä¸€æ ·å°†é›†ç¾¤çš„è§„æ¨¡æ‰©å¤§ä¸€å€ï¼Œä» **2x èŠ‚ç‚¹**å¢åŠ åˆ° **4x èŠ‚ç‚¹ã€‚**è¿™æ˜¯å¸¦æœ‰ 4 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤çš„å¤–è§‚:

![](img/74e2c48ad59f2a7057dc58e508d66345.png)

å¸¦ 4 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”ä»…é™ CPU

æˆ‘å°†åœ¨å…·æœ‰ 34K å›¾åƒçš„è¾ƒå¤§æ•°æ®é›†ä¸Šå¯¹è¿™ä¸ªæ–°é›†ç¾¤è¿è¡Œç›¸åŒçš„åŸºå‡†æµ‹è¯•:

![](img/4cc7302a36d02c20f4a47608cef824be.png)

Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿åœ¨å¸¦ CPU çš„ 4x èŠ‚ç‚¹ä¸Šé¢„æµ‹ 34742 å¹…å›¾åƒ

ç”¨äº†å¤§çº¦ **5 åˆ†é’Ÿ** ( **289 ç§’**)å®Œæˆäº† 34K å›¾åƒçš„é¢„æµ‹åˆ†ç±»ã€‚è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹åœ¨å¸¦æœ‰ Spark NLP çš„ **4x èŠ‚ç‚¹**ä¸Šçš„ç»“æœå’Œåœ¨ Databricks ä¸Šçš„ CPU ä¸Šçš„æ‹¥æŠ±è„¸:

![](img/73e9f4deec683448139a6fcdcdedffaf.png)

**Spark NLP** æ¯”æ‹¥æœ‰ **4x èŠ‚ç‚¹**çš„æ‹¥æŠ±è„¸**å¿« 327%**

> å¯ä»¥çœ‹å‡ºï¼ŒSpark NLP ç°åœ¨æ¯” CPU ä¸Šçš„ Hugging Face å¿«**327%**,è€Œåœ¨æ•°æ®å—ä¸­åªä½¿ç”¨äº† **4x ä¸ªèŠ‚ç‚¹**ã€‚

## åœ¨å…·æœ‰ 8 ä¸ªèŠ‚ç‚¹çš„ CPU ä¸Šæ‰©å±• Spark NLP

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡å†æ·»åŠ  4x ä¸ªèŠ‚ç‚¹æ¥ä½¿ä¹‹å‰çš„é›†ç¾¤ç¿»å€ï¼Œæ€»å…±æœ‰ **8x ä¸ªèŠ‚ç‚¹**ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè°ƒæ•´é›†ç¾¤çš„å¤§å°éå¸¸ç®€å•ï¼Œåªéœ€å¢åŠ é›†ç¾¤é…ç½®ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°é‡:

![](img/9ec2a3ae2cafb7767545052c98748d7c.png)

è°ƒæ•´æ•°æ®å—ä¸­ç«èŠ±ç°‡çš„å¤§å°

![](img/74f359e098fb9c3ab35239089543007c.png)

å…·æœ‰ 8 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”ä»…é™ CPU

è®©æˆ‘ä»¬è¿™æ¬¡åœ¨ **8x èŠ‚ç‚¹ä¸Šè¿è¡Œç›¸åŒçš„åŸºå‡†:**

![](img/0205fb6a8d8a05e5fc15799519b0a63a.png)

å¸¦ CPU çš„ **8x èŠ‚ç‚¹**ä¸Šçš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿(oneDNN) â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

ç”¨äº† 2 åˆ†åŠå¤šé’Ÿ( **161 ç§’**)å®Œæˆäº† 34K å›¾åƒçš„é¢„æµ‹åˆ†ç±»ã€‚è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹åœ¨ **8x èŠ‚ç‚¹**ä¸Š Spark NLP çš„ç»“æœä¸åœ¨ Databricks ä¸Š CPU ä¸Šæ‹¥æŠ±è„¸çš„ç»“æœ:

![](img/e7cee4124a4d99bdb00dff8380b29305.png)

**Spark NLP** æ¯” **666%å¿«**ç”¨ **8x èŠ‚ç‚¹æŠ±è„¸**

> å¯ä»¥çœ‹å‡ºï¼ŒSpark NLP ç°åœ¨æ¯” CPU ä¸Šçš„ Hugging Face å¿«**666%**,è€Œåœ¨æ•°æ®å—ä¸­ä»…ä½¿ç”¨ **8x èŠ‚ç‚¹**ã€‚

è®©æˆ‘ä»¬å¿½ç•¥è¿™é‡Œçš„æ•°å­— 6ï¼(å¦‚æœèƒ½è®©ä½ æ„Ÿè§‰å¥½ç‚¹çš„è¯ï¼Œæ˜¯ 665.8%)

## åœ¨å…·æœ‰ 10 å€èŠ‚ç‚¹çš„ CPU ä¸Šæ‰©å±• Spark NLP

ä¸ºäº†ä½¿ç”¨ Spark NLP å®Œæˆæˆ‘ä»¬å¯¹æ•°æ®å—ä¸­ CPU çš„ ViT æ¨¡å‹é¢„æµ‹ï¼Œæˆ‘å°†å†æ¬¡è°ƒæ•´é›†ç¾¤çš„å¤§å°ï¼Œå¹¶å°†å…¶å¢åŠ åˆ° **10x èŠ‚ç‚¹:**

![](img/35387bb342509bc440368bb3dc510524.png)

å…·æœ‰ 10 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”ä»…é™ CPU

è®©æˆ‘ä»¬è¿™æ¬¡åœ¨ **10x èŠ‚ç‚¹ä¸Šè¿è¡Œç›¸åŒçš„åŸºå‡†:**

![](img/7369d45a6cca5bb693ce4c50a00f49bf.png)

åœ¨ **10x èŠ‚ç‚¹**ä¸Šä½¿ç”¨ CPU(oneDNN)çš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

ç”¨äº†ä¸åˆ° **2 åˆ†é’Ÿ** ( **112 ç§’**)å®Œæˆäº†å¯¹ 34K å›¾åƒçš„é¢„æµ‹åˆ†ç±»ã€‚è®©æˆ‘ä»¬å°† **10x èŠ‚ç‚¹**ä¸Šçš„ç»“æœä¸ä¹‹å‰åœ¨ Databricks ä¸Š Spark NLP ä¸ CPU ä¸Š Hugging Face çš„æ‰€æœ‰ç»“æœè¿›è¡Œæ¯”è¾ƒ:

![](img/8e74ba0d57267ff42567a718599860a0.png)

**ç«èŠ± NLP** æ¯” **10x èŠ‚ç‚¹**æŠ±è„¸**å¿« 1000%**

> è¿™å°±æ˜¯ä½ å¦‚ä½•é€šè¿‡ä½¿ç”¨ Databricks ä¸­çš„ **Spark NLP** åœ¨ **10x èŠ‚ç‚¹**ä¸Šæ‰©å±•æ¥è‡ªæ‹¥æŠ±è„¸çš„è§†è§‰è½¬æ¢å™¨æ¨¡å‹ï¼æˆ‘ä»¬çš„æµæ°´çº¿ç°åœ¨æ¯” CPU ä¸Šçš„æ‹¥æŠ±è„¸å¿« 1000%ã€‚

æˆ‘ä»¬è®¾æ³•é€šè¿‡ç®€å•åœ°ä½¿ç”¨ Spark NLP ä½¿æˆ‘ä»¬çš„ **ViT** æµæ°´çº¿**æ¯”å¡åœ¨ 1 ä¸ªå•èŠ‚ç‚¹ä¸­çš„ Hugging Face**å¿« 1000%,ä½†æ˜¯æˆ‘ä»¬åªä½¿ç”¨äº†**CPU**ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥é€šè¿‡åœ¨ **GPU é›†ç¾¤**ä¸Šæ‰©å±•æˆ‘ä»¬çš„æµæ°´çº¿æ¥è·å¾—åŒæ ·çš„æ”¹è¿›ã€‚

## AWS ä¸Šå¸¦æœ‰ GPU çš„ Databricks å¤šèŠ‚ç‚¹

åŸºäº GPU çš„å¤šèŠ‚ç‚¹ Databricks é›†ç¾¤ä¸å•èŠ‚ç‚¹é›†ç¾¤éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯é€‰æ‹©**æ ‡å‡†**å¹¶ä¿æŒç›¸åŒçš„ ML/GPU è¿è¡Œæ—¶å’Œæˆ‘ä»¬åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šçš„ GPU åŸºå‡†ä¸­é€‰æ‹©çš„ç›¸åŒ AWS å®ä¾‹è§„æ ¼ã€‚

æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡**åº“**é€‰é¡¹å¡åœ¨è¿™ä¸ªæ–°é›†ç¾¤ä¸­å®‰è£… Spark NLPã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§æˆ‘åœ¨ä½¿ç”¨ GPU çš„å•èŠ‚ç‚¹æ•°æ®å—ä¸­æåˆ°çš„æ­¥éª¤è¿›è¡Œæ“ä½œã€‚

![](img/0d86b68b6b6eddaa73e08146c8f5c168.png)

å¸¦æœ‰ GPU çš„ Databricks å¤šèŠ‚ç‚¹(æ ‡å‡†)é›†ç¾¤

## åœ¨å…·æœ‰ 2 ä¸ªèŠ‚ç‚¹çš„ GPU ä¸Šæ‰©å±• Spark NLP

æˆ‘ä»¬çš„å¤šèŠ‚ç‚¹ Databricks GPU é›†ç¾¤ä½¿ç”¨ç›¸åŒçš„ AWS GPU å®ä¾‹ **g4dn.8xlarge** ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¯¥å®ä¾‹åœ¨å•èŠ‚ç‚¹ Databricks é›†ç¾¤ä¸Šè¿è¡Œæˆ‘ä»¬çš„åŸºå‡†æ¥æ¯”è¾ƒ Spark NLP ä¸ Hugging Faceã€‚

è¿™æ˜¯å¯¹è¿™ä¸€æ¬¡ä¸¤ä¸ªèŠ‚ç‚¹æƒ…å†µçš„æ€»ç»“:

![](img/21cf05b03121602371cde7a1a808075b.png)

å…·æœ‰ 2 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”æ¯ä¸ªèŠ‚ç‚¹ 1 ä¸ª GPU

æˆ‘å°†åœ¨è¿™ä¸ªå¸¦æœ‰ **2x èŠ‚ç‚¹çš„ GPU é›†ç¾¤ä¸­è¿è¡Œç›¸åŒçš„ç®¡é“:**

![](img/57ce3be7d7954c3e897497039184242c.png)

å¸¦ GPU çš„ **2x èŠ‚ç‚¹**ä¸Šçš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

ç”¨äº† 4 åˆ†é’Ÿ( **231 ç§’**)å®Œæˆäº†å¯¹ **34K å›¾åƒ**çš„é¢„æµ‹åˆ†ç±»ã€‚è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ä½¿ç”¨ Spark NLP åœ¨ **2x èŠ‚ç‚¹**ä¸Šçš„ç»“æœä¸åœ¨ Databricks ä¸­ GPU ä¸Šçš„æ‹¥æŠ±è„¸çš„ç»“æœ:

![](img/cbe3d6fcab53d8b68930bf493818d813.png)

**Spark NLP** æ¯” **2x èŠ‚ç‚¹**æ‹¥æŠ±è„¸**å¿« 185%**

> åœ¨ä½¿ç”¨ **GPU çš„æƒ…å†µä¸‹ï¼Œ **2x èŠ‚ç‚¹**çš„ Spark NLP æ¯” 1 ä¸ªå•èŠ‚ç‚¹ä¸Šçš„æ‹¥æŠ±è„¸å‡ ä¹å¿«äº†**3 å€** ( **185%** ) ã€‚**

## åœ¨å…·æœ‰ 4 ä¸ªèŠ‚ç‚¹çš„ GPU ä¸Šæ‰©å±• Spark NLP

è®©æˆ‘ä»¬å°† GPU é›†ç¾¤çš„è§„æ¨¡ä» 2x èŠ‚ç‚¹è°ƒæ•´ä¸º **4x èŠ‚ç‚¹ã€‚**è¿™æ˜¯è¿™æ¬¡ä½¿ç”¨ GPU çš„ **4x èŠ‚ç‚¹**çš„æ€»ç»“:

![](img/3fb66ac3aa15c2829efc587b34e4a3ce.png)

å…·æœ‰ 4 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”æ¯ä¸ªèŠ‚ç‚¹ 1 ä¸ª GPU

è®©æˆ‘ä»¬åœ¨ 4x èŠ‚ç‚¹ä¸Šè¿è¡Œç›¸åŒçš„åŸºå‡†æµ‹è¯•ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:

![](img/3ebca941790ba586c406baad903d3082.png)

å¸¦ GPU çš„ **4x èŠ‚ç‚¹**ä¸Šçš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

è¿™ä¸€æ¬¡èŠ±äº†å°†è¿‘ 2 åˆ†é’Ÿ( **118 ç§’**)æ¥å®Œæˆå¯¹æˆ‘ä»¬æ•°æ®é›†ä¸­æ‰€æœ‰ **34K å›¾åƒ**çš„åˆ†ç±»ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å•èŠ‚ç‚¹ä¸­çš„æ‹¥æŠ±è„¸ä¸å¤šèŠ‚ç‚¹é›†ç¾¤ä¸­çš„ Spark NLP ç›¸æ¯”æ„å‘³ç€ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬å°†è¿™ä¸€ç‚¹å½¢è±¡åŒ–:

![](img/84891134ecfeaf980b7232373e1ba02f.png)

**Spark NLP** æ¯” **4x èŠ‚ç‚¹**æŠ±è„¸**å¿« 458%**

> ä¸æ‹¥æŠ±è„¸ç›¸æ¯”ï¼Œæ€§èƒ½æå‡äº† 458%ã€‚æˆ‘ä»¬åˆšåˆšé€šè¿‡ä½¿ç”¨å¸¦æœ‰ 4 ä¸ªèŠ‚ç‚¹çš„ Spark NLP ä½¿æˆ‘ä»¬çš„æµæ°´çº¿é€Ÿåº¦æé«˜äº† 5.6 å€ã€‚

## åœ¨å…·æœ‰ 8 ä¸ªèŠ‚ç‚¹çš„ GPU ä¸Šæ‰©å±• Spark NLP

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†è°ƒæ•´é›†ç¾¤çš„å¤§å°ï¼Œä½¿æˆ‘çš„æ•°æ®å—ä¸­æœ‰ **8x ä¸ªèŠ‚ç‚¹**ï¼Œæ€»ç»“å¦‚ä¸‹:

![](img/77521154e009d3705a5db3dc39bbc607.png)

8 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”æ¯ä¸ªèŠ‚ç‚¹ 1 ä¸ª GPU

æé†’ä¸€ä¸‹ï¼Œæ¯ä¸ª AWS å®ä¾‹( **g4dn.8xlarge** )æœ‰ 1 ä¸ª**è‹±ä¼Ÿè¾¾ T4 GPU 16GB** (15GB å¯ç”¨å†…å­˜)ã€‚è®©æˆ‘ä»¬é‡æ–°è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œçœ‹çœ‹æˆ‘ä»¬èƒ½å¦å‘ç°ä»»ä½•æ”¹è¿›ï¼Œå› ä¸ºä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¨ªå‘æ‰©å±•éƒ½æœ‰å¼€é”€ï¼Œè€Œä¸”æ‚¨ä¸èƒ½åªæ˜¯ä¸æ–­æ·»åŠ æœºå™¨:

![](img/aeb6607ac9fb397733291825b4f2f964.png)

å¸¦ GPU çš„ **8x èŠ‚ç‚¹**ä¸Šçš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

åœ¨æˆ‘ä»¬çš„ Databricks é›†ç¾¤ä¸­ï¼Œä½¿ç”¨ **8x èŠ‚ç‚¹**å®Œæˆå¯¹ **34K å›¾åƒ**çš„åˆ†ç±»å‡ ä¹èŠ±äº†ä¸€åˆ†é’Ÿ( **61 ç§’**)ã€‚çœ‹æ¥æˆ‘ä»¬è¿˜æ˜¯è®¾æ³•æé«˜äº†æ€§èƒ½ã€‚è®©æˆ‘ä»¬å°†æ­¤ç»“æœä¸ä¹‹å‰å•èŠ‚ç‚¹ä¸­çš„æ‹¥æŠ±è„¸ä¸å¤šèŠ‚ç‚¹é›†ç¾¤ä¸­çš„ Spark NLP çš„ç»“æœè¿›è¡Œæ¯”è¾ƒ:

![](img/e64eb088cf338667db3046f90d824965.png)

**Spark NLP** æ¯” **8x èŠ‚ç‚¹**æŠ±è„¸**å¿« 980%**

> å¸¦ **8x èŠ‚ç‚¹**çš„ Spark NLP åœ¨ GPU ä¸Šå‡ ä¹æ¯”æŠ±è„¸å¿«**11 å€(980%)** ã€‚

## åœ¨ 10 å€èŠ‚ç‚¹çš„ GPU ä¸Šæ‰©å±• Spark NLP

ç±»ä¼¼äºæˆ‘ä»¬åœ¨ CPU ä¸Šçš„å¤šèŠ‚ç‚¹åŸºå‡†æµ‹è¯•ï¼Œæˆ‘æƒ³å†æ¬¡è°ƒæ•´ GPU é›†ç¾¤çš„å¤§å°ï¼Œä½¿å…¶æ‹¥æœ‰ **10x ä¸ªèŠ‚ç‚¹**ï¼Œå¹¶åœ¨æœ€ç»ˆèŠ‚ç‚¹æ•°é‡æ–¹é¢ä¸å®ƒä»¬ç›¸åŒ¹é…ã€‚è¯¥ç»„çš„æœ€ç»ˆæ€»ç»“å¦‚ä¸‹:

![](img/6ad166e9d533ea5b3c5401004be95ff0.png)

å…·æœ‰ 10 ä¸ªèŠ‚ç‚¹çš„æ•°æ®å—â€”æ¯ä¸ªèŠ‚ç‚¹ 1 ä¸ª GPU

è®©æˆ‘ä»¬åœ¨è¿™ä¸ªç‰¹å®šçš„ GPU é›†ç¾¤ä¸­è¿è¡Œæœ€åä¸€ä¸ªåŸºå‡†æµ‹è¯•(é›¶ä»£ç æ›´æ”¹):

![](img/0d5d896cb9e02b9dc726f572a43c9c92.png)

ä½¿ç”¨ GPU åœ¨ **10x èŠ‚ç‚¹**ä¸Šçš„ Spark NLP å›¾åƒåˆ†ç±»æµæ°´çº¿â€”é¢„æµ‹ 34742 å¹…å›¾åƒ

ä¸åˆ°ä¸€åˆ†é’Ÿ( **51 ç§’**)å°±å®Œæˆäº†å¯¹è¶…è¿‡ **34743 å¼ å›¾ç‰‡**çš„é¢„æµ‹åˆ†ç±»ã€‚è®©æˆ‘ä»¬å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œçœ‹çœ‹æˆ‘ä»¬å¦‚ä½•åœ¨ Databricks çš„ Spark NLP ç®¡é“ä¸­æ‰©å±•æ¥è‡ª Hugging Face çš„è§†è§‰è½¬æ¢å™¨æ¨¡å‹:

![](img/c5c46c078177659e1dfd73ba14c72020.png)

**Spark NLP** æ¯” **10x èŠ‚ç‚¹**æŠ±è„¸**å¿« 1200%**

> æˆ‘ä»¬å®Œäº†ã€‚

> æˆ‘ä»¬è®¾æ³•é€šè¿‡ä½¿ç”¨æ•°æ®å—ä¸­çš„ **Spark NLP** åœ¨ **10x èŠ‚ç‚¹**ä¸Šæ‰©å±•æˆ‘ä»¬çš„**è§†è§‰è½¬æ¢å™¨**æ¨¡å‹ã€‚ä¸ GPU ä¸Šçš„æ‹¥æŠ±è„¸ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æµæ°´çº¿ç°åœ¨å¿«äº† 13 å€ï¼Œæ€§èƒ½æé«˜äº† 1200%ã€‚

è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ‰€æœ‰è¿™äº›åŸºå‡†æµ‹è¯•ï¼Œé¦–å…ˆæ¯”è¾ƒ CPU å’Œ GPU ä¹‹é—´çš„æ”¹è¿›ï¼Œç„¶åé€šè¿‡åœ¨ GPU ä¸Šä½¿ç”¨ Spark NLPï¼Œæˆ‘ä»¬çš„æµæ°´çº¿å¯ä»¥ä»æ‹¥æŠ± Face CPUs åˆ° Databricks ä¸Šçš„ 10 å€èŠ‚ç‚¹å¿«å¤šå°‘ã€‚

# å°†æ‰€æœ‰è¿™äº›æ•´åˆåœ¨ä¸€èµ·:

## æ•°æ®å—:å•èŠ‚ç‚¹å’Œå¤šèŠ‚ç‚¹

![](img/022eb831e0a0981de02648e83c123ea2.png)![](img/e8b8f4f578efe14305eaeb13849f9973.png)

Spark NLP æ¯” CPU ä¸Šçš„æ‹¥æŠ±è„¸å¿« 11 å€(1000%)

> **ç«èŠ± NLP** ğŸš€åœ¨ **10x èŠ‚ç‚¹ä¸Š**å¸¦ CPU**æ¯”æŠ±è„¸**å¿« 1000% (11x å€)ğŸ¤—å¡åœ¨å¸¦æœ‰ CPU çš„å•ä¸ªèŠ‚ç‚¹ä¸­

![](img/005af23f850808c5c6b767af93e47b21.png)![](img/1986dbddc6d6544efe434616129a185e.png)

Spark NLP æ¯” GPU ä¸Šçš„æ‹¥æŠ±è„¸å¿« 13 å€(1192%)

> **ç«èŠ± NLP** ğŸš€åœ¨ **10x èŠ‚ç‚¹ä¸Š**ç”¨ GPU**æ¯”æŠ±è„¸**å¿« 1192% (13x å€)ğŸ¤—ç”¨ GPU å¡åœ¨å•ä¸ªèŠ‚ç‚¹

æˆ‘ä»¬çš„ AWS CPU å®ä¾‹å’Œ AWS GPU å®ä¾‹çš„ä»·æ ¼å·®å¼‚å‘¢ï¼Ÿ(æˆ‘çš„æ„æ€æ˜¯ï¼Œå¤šä»˜å‡ºå°±å¤šæ”¶è·ï¼Œå¯¹å§ï¼Ÿ)

![](img/5bb02d507a090493858999d011459a83.png)

**å¸¦ CPU çš„ AWS m5d.8xlarge** ä¸å¸¦ 1 ä¸ª GPU å’Œç±»ä¼¼è§„æ ¼çš„**AWS****g4dn . 8x large**

å¥½çš„ï¼Œæ‰€ä»¥ä»·æ ¼çœ‹èµ·æ¥å·®ä¸å¤šï¼è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæ‚¨ä»å¡åœ¨å•å°æœºå™¨ä¸Šçš„**CPU**ä¸Šçš„**æ‹¥æŠ±é¢**ç§»åŠ¨åˆ°å¸¦æœ‰**10x GPU**çš„ **10x èŠ‚ç‚¹**ä¸Šçš„ **Spark NLP** ï¼Œæ‚¨ä¼šè·å¾—å“ªäº›æ”¹è¿›ï¼Ÿ

![](img/1670eec0bbfbfa9cf845c2dcdd3e9082.png)

**GPU ä¸Šçš„ Spark NLP** æ¯” CPU ä¸Šçš„æ‹¥æŠ±è„¸å¿« 25 å€(2366%)

> ç«èŠ± NLPğŸš€åœ¨ 10 å€äº GPU çš„èŠ‚ç‚¹ä¸Šï¼Œæ¯”æ‹¥æŠ±è„¸å¿« 2366%(25 å€)ğŸ¤—åœ¨å…·æœ‰ CPU çš„å•ä¸ªèŠ‚ç‚¹ä¸­

## æœ€åçš„è¯

*   æœ¬ç€å®Œå…¨é€æ˜çš„ç²¾ç¥ï¼ŒGitHub ä¸Šçš„ [**æä¾›äº†æ‰€æœ‰ç¬”è®°æœ¬åŠå…¶æ—¥å¿—ã€æˆªå›¾ï¼Œç”šè‡³æ˜¯å¸¦æœ‰æ•°å­—çš„ excel è¡¨æ ¼**](https://github.com/JohnSnowLabs/spark-nlp-workshop/tree/master/tutorials/blogposts/medium/scale-vision-transformers-vit-beyond-hugging-face)
*   ç¼©æ”¾ Spark NLP éœ€è¦é›¶ä»£ç æ›´æ”¹ã€‚ä»å•ä¸ªèŠ‚ç‚¹æ•°æ®å—åˆ° 10 ä¸ªèŠ‚ç‚¹è¿è¡ŒåŸºå‡†æµ‹è¯•æ„å‘³ç€åªéœ€åœ¨åŒä¸€ä¸ªç¬”è®°æœ¬ä¸­é‡æ–°è¿è¡Œç›¸åŒçš„ä»£ç å—
*   è¯·è®°ä½ï¼Œè¿™ä¸¤ä¸ªåº“æä¾›äº†è®¸å¤šæœ€ä½³å®è·µï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨ä¾‹åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä¼˜åŒ–å®ƒä»¬çš„é€Ÿåº¦å’Œæ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ Apache Spark ä¸­ï¼Œæˆ‘æ²¡æœ‰è°ˆåˆ°åˆ†åŒºåŠå…¶ä¸å¹¶è¡Œæ€§å’Œåˆ†å¸ƒçš„å…³ç³»ã€‚æœ‰è®¸å¤š Spark é…ç½®å¯ä»¥å¾®è°ƒé›†ç¾¤ï¼Œå°¤å…¶æ˜¯å¹³è¡¡ CPU å’Œ GPU ä¹‹é—´çš„ä»»åŠ¡æ•°é‡ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åœ¨æˆ‘ä»¬ç”¨äºåŸºå‡†æµ‹è¯•çš„ç›¸åŒç¯å¢ƒä¸­æé«˜å®ƒä»¬çš„é€Ÿåº¦ï¼Ÿç­”æ¡ˆæ˜¯ç™¾åˆ†ä¹‹ç™¾ï¼æˆ‘è¯•å›¾ä¸ºä¸¤ä¸ªåº“ä¿ç•™é»˜è®¤å€¼å’Œç°æˆçš„ç‰¹æ€§ï¼Œä»¥åˆ©äºå¤§å¤šæ•°ç”¨æˆ·çš„ç®€å•æ€§ã€‚
*   ä½ å¯èƒ½æƒ³æŠŠæ‹¥æŠ±è„¸å’Œå…¶ä»–åŸºäº DL çš„ Pythonish åº“æ‰“åŒ…åˆ° Spark UDF ä¸­æ¥ç¼©æ”¾å®ƒä»¬ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºæˆ‘è‡ªå·±æ›¾ç»è¿™æ ·åšè¿‡ï¼Œç°åœ¨ä»ç„¶è¿™æ ·åš(å½“æ²¡æœ‰æœ¬åœ°è§£å†³æ–¹æ¡ˆæ—¶)ã€‚åœ¨ UDF ä¸­åŒ…è£…è¿™ç§åŸºäº transformer çš„æ¨¡å‹æ—¶ï¼Œæˆ‘ä¸ä¼šè¯¦ç»†è®¨è®ºå†…å­˜è¿‡åº¦ä½¿ç”¨ã€å¯èƒ½çš„åºåˆ—åŒ–é—®é¢˜ã€æ›´é«˜çš„å»¶è¿Ÿå’Œå…¶ä»–é—®é¢˜ã€‚æˆ‘åªæƒ³è¯´ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Apache Sparkï¼Œè¯·ä½¿ç”¨åœ¨ Apache Spark ä¸Šæœ¬åœ°æ‰©å±•æ‰€éœ€ç‰¹æ€§çš„åº“ã€‚
*   åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç‰¹æ„æåˆ°äº† PyTorch ä¸Šçš„æ‹¥æŠ±è„¸å’Œ TensorFlow ä¸Šçš„ Spark NLPã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å·®å¼‚ï¼Œå› ä¸ºåœ¨ PyTorch å’Œ TensorFlow ä¹‹é—´é€šè¿‡æ‹¥æŠ±é¢å­”è¿›è¡Œçš„æ¯ä¸ªåŸºå‡†æµ‹è¯•ä¸­ï¼ŒPyTorch è¿‡å»æ˜¯ï¼Œç°åœ¨ä»ç„¶æ˜¯æ¨ç†çš„è·èƒœè€…ã€‚åœ¨æ‹¥æŠ±è„¸ä¸­ï¼ŒPyTorch çš„å»¶è¿Ÿè¦ä½å¾—å¤šï¼Œè€Œä¸”ä¼¼ä¹æ¯”å˜å½¢é‡‘åˆšä¸­çš„ TensorFlow å¿«å¾—å¤šã€‚äº‹å®ä¸Šï¼ŒSpark NLP ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ TensorFlowï¼Œå¹¶ä¸”åœ¨æ‹¥æŠ±è„¸æ–¹é¢åœ¨æ¯ä¸ªåŸºå‡†æµ‹è¯•ä¸­éƒ½é¢†å…ˆäº PyTorchï¼Œè¿™æ˜¯ä¸€ä»¶å¤§äº‹ã€‚è¦ä¹ˆæ˜¯æ‹¥æŠ±è„¸çš„å¼ é‡æµè¢«å¿½ç•¥äº†ï¼Œè¦ä¹ˆæ˜¯ PyTorch åªæ˜¯åœ¨æ¨ç†ä¸Šæ¯”å¼ é‡æµå¿«ã€‚ä¸ç®¡æ˜¯å“ªç§æƒ…å†µï¼Œæˆ‘éƒ½è¿«ä¸åŠå¾…åœ°æƒ³çœ‹çœ‹å½“ Spark NLP é™¤äº† TensorFlow ä¹‹å¤–ï¼Œè¿˜å¼€å§‹æ”¯æŒ TorchScript å’Œ ONNX è¿è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚
*   ML å’Œ ML GPU Databricks è¿è¡Œæ—¶å®‰è£…äº†æ‹¥æŠ±è„¸ï¼Œéå¸¸å¥½ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€æ‹¥æŠ±è„¸åœ¨æ•°æ®ç –å—ä¸­å¾ˆå®¹æ˜“ä½¿ç”¨ã€‚æ‹¥æŠ±è„¸çš„ Transformer åº“ä¸æ”¯æŒ DBFS(Databricks çš„åŸç”Ÿåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)æˆ–äºšé©¬é€Š S3ã€‚æ­£å¦‚æ‚¨åœ¨ç¬”è®°æœ¬ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘å¿…é¡»ä¸‹è½½æ•°æ®é›†çš„å‹ç¼©ç‰ˆæœ¬ï¼Œå¹¶æå–å®ƒä»¬ä»¥ä¾›ä½¿ç”¨ã€‚è¿™å¹¶ä¸æ˜¯ Databricks å’Œå…¶ä»–ç”Ÿäº§å¹³å°ä¸­çš„ç”¨æˆ·çœŸæ­£çš„åšäº‹æ–¹å¼ã€‚æˆ‘ä»¬å°†æ•°æ®ä¿å­˜åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¹¶å®æ–½äº†å®‰å…¨æªæ–½ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½è¶³å¤Ÿå¤§ï¼Œæ— æ³•é€šè¿‡ä¸ªäººè®¡ç®—æœºä¸‹è½½ã€‚æˆ‘å¿…é¡»ä¸‹è½½æˆ‘åœ¨ DBFS å·²ç»æœ‰çš„æ•°æ®é›†ï¼Œå‹ç¼©å®ƒä»¬ï¼Œä¸Šä¼ åˆ° S3ï¼Œå…¬å¼€å®ƒä»¬ï¼Œç„¶ååœ¨ç¬”è®°æœ¬ä¸Šé‡æ–°ä¸‹è½½ã€‚å¦‚æœæ‹¥æŠ±è„¸å¯ä»¥æ”¯æŒ DBFS/S3ï¼Œè¿™ä¸ªç›¸å½“ä¹å‘³çš„è¿‡ç¨‹å°±å¯ä»¥é¿å…äº†ã€‚æˆ‘è®¤ä¸º Databricks é¢„è£…æ‹¥æŠ±è„¸å¾ˆæœ‰å¸å¼•åŠ›ï¼Œä½†è¿™ä¸ä»…ä»…æ˜¯ç®€å•åœ°åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ`pip install transformers`è€Œä¸æ˜¯ 100%å…¼å®¹ã€‚

# å‚è€ƒ

**ç»´ç‰¹**

*   [https://arxiv.org/pdf/2010.11929.pdf](https://arxiv.org/pdf/2010.11929.pdf)
*   [https://github.com/google-research/vision_transformer](https://github.com/google-research/vision_transformer)
*   [å›¾åƒè¯†åˆ«ä¸­çš„è§†è§‰å˜å‹å™¨(ViT)â€”â€”2022 æŒ‡å—](https://viso.ai/deep-learning/vision-transformer-vit/)
*   [https://github.com/lucidrains/vit-pytorch](https://github.com/lucidrains/vit-pytorch)
*   [https://medium . com/mlearning-ai/an-image-is-worth-16x 16-words-transformers-for-image-recognition-at-scale-51f 3561 a9f 96](https://medium.com/mlearning-ai/an-image-is-worth-16x16-words-transformers-for-image-recognition-at-scale-51f3561a9f96)
*   [https://medium . com/nerd-for-tech/an-image-worth-16x 16-words-transformers-for-image-recognition-at-scale-paper-summary-3a 387 e 71880 a](https://medium.com/nerd-for-tech/an-image-is-worth-16x16-words-transformers-for-image-recognition-at-scale-paper-summary-3a387e71880a)
*   [https://gareemadhingra 11 . medium . com/summary-of-paper-an-image-worth-16x 16-words-3f 7 F3 ACA 941](https://gareemadhingra11.medium.com/summary-of-paper-an-image-is-worth-16x16-words-3f7f3aca941)
*   [https://medium . com/analytics-vid hya/vision-transformers-bye-bye-convolutions-e 929d 022 E4 ab](https://medium.com/analytics-vidhya/vision-transformers-bye-bye-convolutions-e929d022e4ab)
*   [https://medium . com/synced review/Google-brain-uncovers-re presentation-structure-differences-between-CNN-and-vision-transformers-83b 6835 db BAC](https://medium.com/syncedreview/google-brain-uncovers-representation-structure-differences-between-cnns-and-vision-transformers-83b6835dbbac)

**æŠ±ç´§è„¸**

*   [https://hugging face . co/docs/transformers/main _ classes/pipelines](https://huggingface.co/docs/transformers/main_classes/pipelines)
*   [https://huggingface.co/blog/fine-tune-vit](https://huggingface.co/blog/fine-tune-vit)
*   [https://huggingface.co/blog/vision-transformers](https://huggingface.co/blog/vision-transformers)
*   [https://huggingface.co/blog/tf-serving-vision](https://huggingface.co/blog/tf-serving-vision)
*   [https://huggingface.co/blog/deploy-tfserving-kubernetes](https://huggingface.co/blog/deploy-tfserving-kubernetes)
*   [https://huggingface.co/google/vit-base-patch16-224](https://huggingface.co/google/vit-base-patch16-224)
*   [https://huggingface.co/blog/deploy-vertex-ai](https://huggingface.co/blog/deploy-vertex-ai)
*   [https://huggingface.co/models?other=vit](https://huggingface.co/models?other=vit)

æ•°æ®å—

*   [https://www . data bricks . com/spark/getting-started-with-Apache-spark](https://www.databricks.com/spark/getting-started-with-apache-spark)
*   [https://docs.databricks.com/getting-started/index.html](https://docs.databricks.com/getting-started/index.html)
*   [https://docs . data bricks . com/getting-started/quick-start . html](https://docs.databricks.com/getting-started/quick-start.html)
*   çœ‹æœ€å¥½çš„[æ•°æ®+AI å³°ä¼š 2022](https://www.databricks.com/dataaisummit/)
*   [https://www . data bricks . com/blog/2020/05/15/shrink-training-time-and-cost-using-NVIDIA-GPU-accelerated-xgboost-and-Apache-spark-on-data bricks . html](https://www.databricks.com/blog/2020/05/15/shrink-training-time-and-cost-using-nvidia-gpu-accelerated-xgboost-and-apache-spark-on-databricks.html)

**ç«èŠ± NLP**

*   [Spark NLP GitHub](https://github.com/JohnSnowLabs/spark-nlp)
*   [Spark NLP ç ”è®¨ä¼š](https://github.com/JohnSnowLabs/spark-nlp-workshop) (Spark NLP ç¤ºä¾‹)
*   [ç«èŠ± NLP å˜å‹å™¨](https://nlp.johnsnowlabs.com/docs/en/transformers)
*   [Spark NLP è½¦å‹è½®æ¯‚](https://nlp.johnsnowlabs.com/models?edition=Spark+NLP)
*   [Spark NLP 3 ä¸­çš„é€Ÿåº¦ä¼˜åŒ–&åŸºå‡†æµ‹è¯•:å……åˆ†åˆ©ç”¨ç°ä»£ç¡¬ä»¶](https://www.johnsnowlabs.com/watch-webinar-speed-optimization-benchmarks-in-spark-nlp-3-making-the-most-of-modern-hardware/)
*   [Spark NLP ä¸­çš„ç¡¬ä»¶åŠ é€Ÿ](https://nlp.johnsnowlabs.com/docs/en/hardware_acceleration)
*   [é€šè¿‡ API æœåŠ¡ Spark NLP:Spring å’Œ LightPipelines](https://medium.com/spark-nlp/serving-spark-nlp-via-api-spring-and-lightpipelines-64d2e6413327)
*   [é€šè¿‡ API æœåŠ¡ Spark NLP(1/3):å¾®è½¯çš„ Synapse ML](https://medium.com/spark-nlp/serving-spark-nlp-via-api-1-3-microsoft-synapse-ml-2c77a3f61f9d)
*   [é€šè¿‡ API (2/3)æœåŠ¡ Spark NLP:FastAPI å’Œ LightPipelines](https://medium.com/spark-nlp/serving-spark-nlp-via-api-2-3-fastapi-and-lightpipelines-218d1980c9fc)
*   [é€šè¿‡ API æœåŠ¡ Spark NLP(3/3):æ•°æ®å—ä½œä¸šå’Œ MLFlow æœåŠ¡ API](https://medium.com/spark-nlp/serving-spark-nlp-via-api-3-3-databricks-and-mlflow-serve-apis-4ef113e7fac4)
*   [Spark 3.0 ä¸Šçš„ GPU åˆ©ç”¨ Scala ä¸­çš„æ·±åº¦å­¦ä¹ ](https://aws.amazon.com/blogs/opensource/leverage-deep-learning-in-scala-with-gpu-on-spark-3-0/)
*   [å¼€å§‹ä½¿ç”¨ GPU åŠ é€Ÿçš„ Apache Spark 3](https://www.nvidia.com/en-us/ai-data-science/spark-ebook/getting-started-spark-3/)
*   [é˜¿å¸•å¥‡ Spark æ€§èƒ½è°ƒä¼˜](https://spark.apache.org/docs/latest/sql-performance-tuning.html)
*   GPU ä¸Šå¯èƒ½çš„é¢å¤–ä¼˜åŒ–:[Apache Spark é…ç½®çš„ RAPIDS åŠ é€Ÿå™¨](https://nvidia.github.io/spark-rapids/docs/configs.html)******