<html>
<head>
<title>What is JWT?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是JWT？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/what-is-jwt-8968f3eb4752?source=collection_archive---------5-----------------------#2021-12-11">https://blog.devgenius.io/what-is-jwt-8968f3eb4752?source=collection_archive---------5-----------------------#2021-12-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8ddd12b7e1c74cbcc7a677fffd1911c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulCspc56K_swYE1uuel_TA.png"/></div></div></figure><p id="42d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JWT代表JSON网络令牌。它定义了一种机制，我们可以在各方之间安全地传输信息。JWT相对较小，这使我们能够通过HTTP头或post参数等发送它。</p><p id="d70b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是JWT的一个例子。它是一个编码字符串(未加密)。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="7a26" class="lc ld in ky b gy le lf l lg lh">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span></pre><p id="543d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JWT最常见的使用案例之一是授权。授权是一种机制，用于验证向服务器发送请求的用户是否是经过身份验证的同一用户。只有当用户通过身份验证后，才允许他访问系统。</p><p id="1c14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以前，这是通过在服务器中保留一个会话来完成的。用户登录到系统后，服务器会生成一个会话Id，并将其发送到浏览器，保存在浏览器cookie中。每次客户端向服务器发出请求时，它都会向服务器发送一个会话Id，服务器会验证用户是否被授权。但是，如果我们使用相同的服务器来提供本地移动应用程序，他们就没有cookies。这就是JWT出现的原因。</p><p id="39d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">JWT如何在授权中工作？</strong></p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/e01612c02e385d411a78b175d2743b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*fmS71CD8bW7ZuNhzSG4bJg.jpeg"/></div></figure><p id="aeb6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦用户登录到系统，它将创建一个JWT并将其发送回浏览器。例如，如果它是一个web应用程序，我们可以将其存储在本地存储中。当每个请求发送到服务器时，它将验证令牌，并确保用户被授权执行特定的操作。重要的是，这里我们不像基于会话的授权那样在服务器端保留任何东西。JWT包含用户的所有信息，可以用来验证用户。如果令牌被篡改，服务器将使其无效。</p><p id="78b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">JWT有什么？</strong></p><p id="909c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JSON Web令牌有3个部分。</p><ol class=""><li id="8c36" class="lj lk in jx b jy jz kc kd kg ll kk lm ko ln ks lo lp lq lr bi translated">页眉</li><li id="9b54" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks lo lp lq lr bi translated">有效载荷</li><li id="eac3" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks lo lp lq lr bi translated">签名</li></ol><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/ee566c6c684c64bcd0f28e74729eed85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvyi055VBfX7f5NIQZiODg.png"/></div></div></figure><p id="c64b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JWT在左手边。在解码版本中，我们可以看到报头、有效载荷和签名。</p><h2 id="4506" class="lc ld in bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">标题:</h2><ul class=""><li id="06c3" class="lj lk in jx b jy mp kc mq kg mr kk ms ko mt ks mu lp lq lr bi translated">alg是生成签名的哈希算法。typ表示令牌类型，这里是JWT。</li></ul><h2 id="b9fc" class="lc ld in bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">有效载荷</h2><ul class=""><li id="15a6" class="lj lk in jx b jy mp kc mq kg mr kk ms ko mt ks mu lp lq lr bi translated">有效负载是我们需要存储在令牌中的实际数据。sub很可能是您想要授权的用户的id。除此之外，它还有一些共同的领域，如iss，iat和exp。</li><li id="90d8" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks mu lp lq lr bi translated">iss:(发行人)发行JWT的机构。</li><li id="dc17" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks mu lp lq lr bi translated">iat:(发行时间)令牌的发行时间。</li><li id="f5f3" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks mu lp lq lr bi translated">(到期时间)当JWT到期时。</li><li id="27fa" class="lj lk in jx b jy ls kc lt kg lu kk lv ko lw ks mu lp lq lr bi translated">最佳做法是让令牌过期，否则如果有人获得了您的令牌，他们就可以通过授权自己为您来永远使用它来访问系统。</li></ul><h2 id="e72f" class="lc ld in bd ly lz ma dn mb mc md dp me kg mf mg mh kk mi mj mk ko ml mm mn mo bi translated">签名</h2><ul class=""><li id="969f" class="lj lk in jx b jy mp kc mq kg mr kk ms ko mt ks mu lp lq lr bi translated">实际上，这是验证用户没有篡改令牌的部分。它将包含报头部分和有效载荷部分。然后，它使用我们提供的密钥，使用标题中提到的算法对它们进行编码，并将它们组合在一起。我们来看看是怎么做到的。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="67b5" class="lc ld in ky b gy le lf l lg lh"><strong class="ky io">const</strong> encodedHeader = base64urlEncode(header);<br/><strong class="ky io">const</strong> encodedPayload = base64urlEncode(payload);<br/><strong class="ky io">const</strong> data = encodedHeader + "." + encodedPayload; <br/><strong class="ky io">const</strong> hashedData = HS256(data, &lt;secret_key&gt;);<br/><strong class="ky io">const</strong> signature = base64urlEncode(hashedData);</span><span id="1dc2" class="lc ld in ky b gy mv lf l lg lh"><strong class="ky io">const</strong> JWT = encodedHeader + "." + encodedPayload + "." + signature;</span></pre><p id="4014" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，对报头和有效载荷进行编码。然后，使用某种秘密密钥，使用散列算法(这里是HS256)对组合的编码报头和有效载荷进行散列。然后散列数据将被编码(签名)。</p><p id="b44e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们有3个独立的编码部分编码头，编码有效载荷和签名。把这三个用点分开的组合起来就是一个JWT。</p><p id="0dd2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有一个平台我们可以用<a class="ae mw" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">这个</a>去玩。让我们试试那个。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/f9b2424a145eb123fed8864f5c0b8a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QX_GoQv67bKKUtbPRwRfDA.png"/></div></div></figure><p id="094b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在有效载荷中，用户名为“佛罗多·巴金斯”。密钥是“嘘”。如果有人改变了JWT会发生什么？这是当字母“e”被删除，然后是令牌的第一个句点时发生的情况。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/d79fc779cc9d7bd759fc625a2db47273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POvV2bPI42CDSDMa49YBig.png"/></div></div></figure><p id="3c8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">由于令牌的有效负载部分已更改，签名也将更改。因为签名是报头和有效载荷的散列数据，不再类似于JWT的最后蓝色部分。那么它将被识别为无效签名。因此，如果它无效，我们知道令牌已被篡改。这就是为什么我们可以将用户信息存储在客户端。无论如何，如果一个用户有你的密钥，那么他将能够创建一个有效的令牌。因此，在实际情况下，密钥必须难以猜测，并安全地存储在您的服务器中，以使其他人无法访问。</p></div></div>    
</body>
</html>