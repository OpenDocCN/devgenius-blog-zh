# å¡å¤«å¡åœ¨è¡ŒåŠ¨:å¡å¤«å¡å…¥é—¨å®ç”¨æŒ‡å—

> åŸæ–‡ï¼š<https://blog.devgenius.io/kafka-in-action-a-practical-guide-to-getting-started-with-kafka-7be5074a30c2?source=collection_archive---------1----------------------->

å¡å¤«å¡åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è¿‡å»çš„ä¸€å‘¨é‡Œï¼Œè¿™ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°ç€æˆ‘ï¼Œæˆ‘æƒ³æˆ‘ç°åœ¨å·²ç»æœ‰è¶³å¤Ÿçš„çŸ¥è¯†æ¥å†™è¿™ä¸ªç¥å¥‡çš„æŠ€æœ¯äº†ã€‚å› æ­¤ï¼Œåœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†åˆ†åˆ«è®¨è®ºä¸åŒçš„ **Kafka ç»„ä»¶**ï¼Œå¸¦é¢†æˆ‘ä»¬è¿›å…¥ ***ä»£ç æ¼”ç»ƒ*** ï¼Œæœ€åæ˜¯å®ƒçš„åˆ©å¼Š&ã€‚åˆ†å¼€ç†è§£æ¯ä¸€ä¸ªç»„ä»¶æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºæˆ‘è¯•å›¾æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ç†è§£ï¼Œä½†åæ¥å˜å¾—æ··ä¹±äº†ã€‚

è¦ç†è§£ä»»ä½•æŠ€æœ¯ï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£å®ƒä¸ºä»€ä¹ˆè¢«åˆ›é€ /å‘æ˜ã€‚Apache Kafka æœ€åˆæ˜¯åœ¨ 2010 å¹´ç”± LinkedIn å¼€å‘çš„ï¼Œä½œä¸ºå¤„ç†å¤§å®¹é‡ã€é«˜ååé‡ã€å®æ—¶æ•°æ®é¦ˆé€çš„ä¸€ç§æ–¹å¼ã€‚LinkedIn æ­£åœ¨å¯»æ‰¾ä¸€ç§æ–¹æ³•æ¥å¤„ç†å…¶å¹³å°ä¸Šçš„å¤§é‡æ´»åŠ¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ›´æ–°ã€å…³ç³»æ›´æ–°å’Œå…¶ä»–éœ€è¦å®æ—¶å¤„ç†çš„æ•°æ®ã€‚è¿™äº›æ´»åŠ¨å¯ä»¥å½’ç±»ä¸ºäº‹ä»¶ï¼Œå¯¹å—ï¼Ÿä¸€ä¸ªäº‹ä»¶å¯ä»¥è¢«ç§°ä¸ºæŸä»¶äº‹æƒ…å‘ç”Ÿçš„æ—¶é—´æŒ‡ç¤ºã€‚å°†äº‹ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­æœ‰ç‚¹éº»çƒ¦ï¼Œå› ä¸ºæ•°æ®åº“ä¸èƒ½å¾ˆå¥½åœ°é€‚åº”æ—¥å¿—ã€‚Kafka æ˜¯ç®¡ç†è¿™äº›æ—¥å¿—çš„ä¸€ç§æ–¹å¼ã€‚åœ¨å…¶ä¸­ï¼Œè¿™äº›äº‹ä»¶è¢«ç§°ä¸ºä¸»é¢˜ï¼Œå®ƒä»¬å¯ä»¥å­˜å‚¨å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´ã€‚ä¸»é¢˜åªæ˜¯æŒä¹…å­˜å‚¨çš„äº‹ä»¶çš„æœ‰åºé›†åˆã€‚æ—©æœŸçš„è¶‹åŠ¿æ˜¯ä½¿ç”¨å•ä¸€æ¶æ„æ¥æ„å»ºæœåŠ¡ï¼Œä½†ç°åœ¨å¼€å‘äººå‘˜æ›´å–œæ¬¢**å¾®æœåŠ¡**æ¶æ„ï¼Œå› æ­¤å½“è¿™äº›ç‹¬ç«‹çš„æœåŠ¡éœ€è¦é€šä¿¡æ—¶ï¼ŒKafka éå¸¸æ–¹ä¾¿ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä»£ç†ï¼Œå…è®¸ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸­å¤®æœåŠ¡å™¨ï¼Œä»¥é«˜åº¦åˆ†å¸ƒå¼å’Œå®¹é”™çš„æ–¹å¼å­˜å‚¨å®ƒä»¬ã€‚ç„¶åï¼Œæ¶ˆè´¹è€…å¯ä»¥æ£€ç´¢æ¶ˆæ¯å¹¶å®æ—¶å¤„ç†å®ƒä»¬ã€‚
ä¸‹é¢æˆ‘ä»¬ä¼šè¯¦ç»†äº†è§£è¿™ä¸€ç‚¹ã€‚

## KAFKA ç»„ä»¶

a)**Kafka Broker:**Kafka Broker æ˜¯ç”¨æˆ·ä¸ä¹‹äº¤äº’çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥å®ƒæœ‰ä¸€ä¸ªæš´éœ²çš„ç«¯å£(é»˜è®¤ä¸º 9092)å¹¶æ¥å— TCP è¿æ¥ã€‚å¡å¤«å¡ä¸­æœ¬è´¨ä¸Šæœ‰ä¸¤ç»„æŠ½è±¡ï¼Œä¸€ç»„æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç¬¬äºŒç»„æ˜¯ TCP è¿æ¥ã€‚ç”Ÿäº§è€…æ˜¯ç”Ÿäº§å’Œå‘å¸ƒå†…å®¹ç»™ä»£ç†å’Œæ¶ˆè´¹å®ƒçš„æ¶ˆè´¹è€…çš„äººã€‚è°ˆåˆ°è¿æ¥ï¼Œå®ƒä»¬æ˜¯åŒå‘ TCP è¿æ¥ï¼Œå› ä¸ºç”Ÿäº§è€…å¯ä»¥å‘ä»£ç†å‘é€å†…å®¹ï¼Œä¹Ÿå¯ä»¥ä»ä»£ç†æ¥æ”¶å†…å®¹ã€‚

![](img/3d68e4479750264794f75b342954383b.png)

å¡å¤«å¡

b) **Kafka Topic:** é¡¾åæ€ä¹‰ï¼ŒTopic å°±æ˜¯ Kafka æµä¸­æ¶ˆæ¯(æ•°æ®)çš„é€»è¾‘åˆ’åˆ†ï¼Œæ•°æ®ç›¸åŒã€‚å½“ç”Ÿäº§è€…å†™æ—¶ï¼Œå®ƒéœ€è¦æŒ‡å®šå®ƒæƒ³è¦å†™åˆ°å“ªä¸ªä¸»é¢˜ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹æ—¶ï¼Œå®ƒéœ€è¦æŒ‡å®šå®ƒæƒ³è¦ä»å“ªä¸ªä¸»é¢˜æ¥æ”¶/æ¶ˆè´¹ã€‚

c) **åˆ†åŒº:**æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¾å¤§çœ‹ä¸€ä¸ªé¢˜ç›®å†…éƒ¨ã€‚ç”Ÿäº§è€…åœ¨ä¸€ä¸ªä¸»é¢˜å†…æ¨é€æ•°æ®ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå¯¹å—ï¼Ÿè¿™æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªç±»ä¼¼åœºæ™¯ï¼›æˆ‘ä»¬å¯¹å•å°æœåŠ¡å™¨å¯ä»¥å®¹çº³çš„æ•°æ®é‡æœ‰é™åˆ¶ã€‚æˆ‘ä»¬æœ€åˆé€šè¿‡å‚ç›´æ‰©å±•æˆ–æ·»åŠ å­˜å‚¨æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚ç„¶è€Œï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå‚ç›´æ‰©å±•æ˜¯æœ‰é™åˆ¶çš„ã€‚ä¸€æ—¦è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œæ°´å¹³æ‰©å±•ï¼Œè¿™éœ€è¦æ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹ä¹‹é—´åˆ’åˆ†æ•°æ®ã€‚å¡å¤«å¡ä¸­è¿™ç§ç±»ä¼¼çš„æ¦‚å¿µå«åšåˆ†åŒºã€‚

![](img/9fe570a6d8e0ded9fb87d5a40c2bbfc5.png)

æˆªå›¾æ¥è‡ªä¾¯èµ›å› Â·çº³èµ›å°”çš„åšå®¢

æ‰€ä»¥åœ¨å¼•å…¥åˆ†åŒºçš„æ—¶å€™ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåˆ¶ä½œè€…éœ€è¦å¾—åˆ°è¦å†™åˆ°å“ªä¸ªä¸»é¢˜ï¼Œå†™åˆ°å“ªä¸ªåˆ†åŒºã€‚æ¶ˆè´¹è€…ä¹Ÿæ˜¯å¦‚æ­¤ï¼›å®ƒè¿˜éœ€è¦çŸ¥é“ä»å“ªä¸ªåˆ†åŒºè¯»å–ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå¦‚æœç”Ÿäº§è€…æƒ³è¦å°†â€œNaderâ€æ·»åŠ åˆ°ä¸»é¢˜â€œUsersâ€ä¸­ï¼Œå®ƒéœ€è¦ä½¿ç”¨ä»»ä½•ç”¨äºåˆ›å»ºåˆ†åŒºçš„ç®—æ³•(é€šå¸¸æ˜¯[ä¸€è‡´æ•£åˆ—](https://www.toptal.com/big-data/consistent-hashing#:~:text=according%20to%20Wikipedia).-,Consistent%20Hashing%20is%20a%20distributed%20hashing%20scheme%20that%20operates%20independently,without%20affecting%20the%20overall%20system.))å¹¶æ‰¾åˆ°æ­£ç¡®çš„åˆ†åŒºã€‚å› ä¸ºå®ƒæ‰¾åˆ°äº†æ­£ç¡®çš„â€œä¸»é¢˜â€ï¼Œæ‰€ä»¥å®ƒè¿”å›å®ƒè¢«æ·»åŠ åˆ°ç”Ÿæˆå™¨çš„ä½ç½®ã€‚
ä¸€ä¸ªå®¢æˆ·è®¢è´­ä»–ä»¬ä»åˆ†åŒºè¯»å–çš„æ¶ˆæ¯ã€‚å› æ­¤ï¼Œå¦‚æœå°†æ•°å­— 1ã€2ã€3 å’Œ 4 æ·»åŠ åˆ°ä¸»é¢˜ä¸­ï¼Œæ¶ˆè´¹è€…ä»ç„¶ä¼šè¿™æ ·ç†è§£ã€‚æ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªåç§»é‡ï¼Œå› æ­¤ä¸€æ—¦æ¶ˆè´¹è€…é˜…è¯»äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå®ƒä¼šå°†åç§»é‡æ”¾åœ¨ Kafka ä¸Šï¼Œä»¥è¡¨æ˜è¿™æ˜¯æ¶ˆè´¹è€…é˜…è¯»çš„æœ€æ–°æ¶ˆæ¯ã€‚å› æ­¤ï¼Œå¦‚æœæ¶ˆè´¹è€…èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå®ƒå¯ä»¥ä»ä¸Šæ¬¡è¯»å–ååœæ­¢çš„åœ°æ–¹é‡æ–°å¯åŠ¨ã€‚æ­¤å¤–ï¼Œå¦‚æœæ¶ˆè´¹è€…ä»¥åéœ€è¦æŸ¥çœ‹æ›´æ—©çš„æ¶ˆæ¯ï¼Œä»–ä»¬å¯ä»¥æ€»æ˜¯æ”¹å˜åç§»ä½ç½®ã€‚

d) **æ¶ˆè´¹ç¾¤:**æ¶ˆè´¹ç¾¤æ˜¯ä¸ºäº†ä»ä¸åŒåˆ†åŒºæ¶ˆè´¹ï¼Œå®ç°å¹¶è¡Œè€Œå‘æ˜çš„ã€‚è¿™å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç†è§£è¿™æ ·åšçš„å¿…è¦æ€§ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£æ¶ˆæ¯é˜Ÿåˆ—å’Œå‘å¸ƒ-è®¢é˜…(pub-sub)ç³»ç»Ÿçš„æ¦‚å¿µã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæˆ‘è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ¶ˆæ¯è¢«å‘å¸ƒä¸€æ¬¡å¹¶è¢«æ¶ˆè´¹ä¸€æ¬¡çš„é˜Ÿåˆ—ã€‚è¿™æ ·åšï¼Œæˆ‘ä»¬å¸Œæœ›ç¡®ä¿å·¥ä½œåªæ‰§è¡Œä¸€æ¬¡ã€‚åœ¨å‘å¸ƒ/è®¢é˜…çš„æƒ…å†µä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯å¯ä»¥å‘å¸ƒä¸€æ¬¡ï¼Œä½†ä¼šè¢«å¤šæ¬¡ä½¿ç”¨ã€‚**ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬æ‰€æœ‰çš„æ¶ˆè´¹(è®¢é˜…)åº”ç”¨ç¨‹åºéƒ½èƒ½å¾—åˆ°*è‡³å°‘ä¸€ä»½*æˆ‘ä»¬çš„å‘å¸ƒè€…å‘å¸ƒåˆ°äº¤æ˜“æ‰€çš„æ¶ˆæ¯çš„å‰¯æœ¬ã€‚**è¦äº†è§£æ¶ˆæ¯é˜Ÿåˆ—å’Œ pub/subï¼Œè¯·é˜…è¯»æœ¬åšå®¢:[**é“¾æ¥**](https://www.baeldung.com/pub-sub-vs-message-queues) **ã€‚å›æ¥åï¼Œå¡å¤«å¡è¯•å›¾è§£å†³åŒæ—¶è·å¾—æ¶ˆæ¯é˜Ÿåˆ—å’Œå‘å¸ƒ/è®¢é˜…çš„é—®é¢˜ã€‚æ¶ˆè´¹ç¾¤ä½“çš„æ¦‚å¿µå›ç­”äº†è¿™ä¸ªè¯é¢˜çš„ç­”æ¡ˆã€‚**

è¿™é‡Œæœ‰å‡ ä¸ªæœ‰è¶£çš„æ¦‚å¿µ:

1.  **æ‰‡å‡ºäº¤æ¢**:è¿™äº›äº¤æ¢æä¾›äº†å…¸å‹çš„å‘å¸ƒ-è®¢é˜…æ‹“æ‰‘ã€‚å‘é€åˆ°æ‰‡å‡ºäº¤æ¢æœºçš„æ¶ˆæ¯å°†è¢«å¹¿æ’­åˆ°ç»‘å®šåˆ°è¯¥äº¤æ¢æœºçš„æ‰€æœ‰é˜Ÿåˆ—å’Œäº¤æ¢æœºã€‚
    å‡è®¾æ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ª OTP æœåŠ¡ã€‚æ‚¨ç°åœ¨å¿…é¡»é€šè¿‡ç”µå­é‚®ä»¶å’ŒçŸ­ä¿¡å‘é€åŠ¨æ€å£ä»¤ã€‚å› æ­¤ï¼Œæ‚¨çš„åŠ¨æ€å£ä»¤æœåŠ¡å¯èƒ½ä¼šå°†åŠ¨æ€å£ä»¤å­˜å‚¨åœ¨ Kafka ä¸­ï¼Œä¹‹åï¼Œæ‚¨çš„çŸ­ä¿¡æœåŠ¡å’Œç”µå­é‚®ä»¶æœåŠ¡ç”¨æˆ·å¯ä»¥æ¥æ”¶æ¶ˆæ¯å¹¶æ ¹æ®éœ€è¦å‘é€çŸ­ä¿¡å’Œç”µå­é‚®ä»¶ã€‚

![](img/2cf16ce204acbd528b00c25fd52e068c.png)

2.**é¡ºåºä¿è¯:**æ—¢ç„¶ä¸€ä¸ªä¸»é¢˜å¯ä»¥è¢«åˆ†å‰²ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥ä»åŒä¸€ä¸ªä¸»é¢˜æ¶ˆè´¹ï¼Œé‚£ä¹ˆä½ å¦‚ä½•åœ¨æ¶ˆè´¹è€…ç«¯ç»´æŠ¤æ¶ˆæ¯çš„é¡ºåºå‘¢ï¼Œæœ‰äººå¯èƒ½ä¼šé—®ã€‚å¥½é—®é¢˜ã€‚å¤šä¸ªä½¿ç”¨è€…ä¸èƒ½è¯»å–åŒä¸€ä¸ªä½¿ç”¨è€…ç»„ä¸­çš„ä¸€ä¸ªåˆ†åŒºã€‚æ¶ˆè´¹è€…ç¾¤ä½“ä½¿è¿™æˆä¸ºå¯èƒ½ï¼›åªæœ‰ä¸€ä¸ªä½¿ç”¨è€…å¯ä»¥ä»ä¸€ä¸ªåˆ†åŒºä¸­è¯»å–æ•°æ®ã€‚æˆ‘ä»ä¸€ç¯‡ [hackernoon](https://hackernoon.com/) æ–‡ç« ä¸­å¾—åˆ°ä»¥ä¸‹è§£é‡Šï¼Œæˆ‘å°†åœ¨ä¸‹é¢åˆ—å‡ºã€‚

![](img/3af67f28740eefab6789a67a638897fc.png)

[https://miro . medium . com/max/1400/1 * qt5 _ 0 yd9 tsmld 3 rywhivra . webp](https://miro.medium.com/max/1400/1*qt5_0YD9TSMLd3RywhivrA.webp)

> æ‰€ä»¥ä½ çš„åˆ¶ä½œäººåˆ¶ä½œäº† 6 æ¡ä¿¡æ¯ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªé”®-å€¼å¯¹ï¼Œå¯¹äºé”®â€œAâ€çš„å€¼æ˜¯â€œ1â€ï¼Œå¯¹äºâ€œCâ€çš„å€¼æ˜¯â€œ1â€ï¼Œå¯¹äºâ€œBâ€çš„å€¼æ˜¯â€œ1â€ï¼Œå¯¹äºâ€œCâ€çš„å€¼æ˜¯â€œ2â€â€¦..â€œBâ€å€¼ä¸ºâ€œ2â€ã€‚(è¯·æ³¨æ„ï¼Œæˆ‘æ‰€è¯´çš„é”®æ˜¯æŒ‡æˆ‘ä»¬å‰é¢è®¨è®ºè¿‡çš„æ¶ˆæ¯é”®ï¼Œè€Œä¸æ˜¯ JSON æˆ– Map é”®)ã€‚æˆ‘ä»¬çš„ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼Œå¹¶ä¸”ç”±äºå…·æœ‰ç›¸åŒå¯†é’¥çš„ä¸€è‡´æ•£åˆ—æ¶ˆæ¯æ€»æ˜¯åˆ°è¾¾ç›¸åŒçš„åˆ†åŒºï¼Œæ‰€ä»¥æ‰€æœ‰å…·æœ‰â€œAâ€ä½œä¸ºå¯†é’¥çš„æ¶ˆæ¯å°†è¢«åˆ†ç»„ï¼Œå¹¶ä¸”å¯¹äº B å’Œ c ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç°åœ¨ï¼Œç”±äºæ¯ä¸ªåˆ†åŒºåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å®ƒä»¬åªæŒ‰é¡ºåºè·å¾—æ¶ˆæ¯ã€‚å› æ­¤ï¼Œæ¶ˆè´¹è€…å°†åœ¨ A2 ä¹‹å‰æ”¶åˆ° A1ï¼Œåœ¨ B2 ä¹‹å‰æ”¶åˆ° B1ï¼Œå› æ­¤è®¢å•å¾—ä»¥ç»´æŒï¼ŒtadağŸ‰ã€‚å›åˆ°æˆ‘ä»¬çš„æ—¥å¿—è®°å½•ç³»ç»Ÿç¤ºä¾‹ï¼Œå…³é”®å­—æ˜¯æºèŠ‚ç‚¹ IDï¼Œé‚£ä¹ˆ node1 çš„æ‰€æœ‰æ—¥å¿—å°†æ€»æ˜¯è¿›å…¥åŒä¸€ä¸ªåˆ†åŒºã€‚ç”±äºæ¶ˆæ¯æ€»æ˜¯è¿›å…¥åŒä¸€ä¸ªåˆ†åŒºï¼Œæˆ‘ä»¬å°†ä¿æŒæ¶ˆæ¯çš„é¡ºåºã€‚
> 
> å¦‚æœåŒä¸€ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªç»„ä¸­æœ‰å¤šä¸ªç”¨æˆ·ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœæ‚¨åœ¨ä¸åŒç»„ä¸­çš„ä¸åŒæ¶ˆè´¹è€…ä¸­è¯»å–ç›¸åŒçš„åˆ†åŒºï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªæ¶ˆè´¹è€…ç»„æ¥è¯´ï¼Œæ¶ˆæ¯ä¹Ÿå°†ä»¥ ***æ’åº*** ã€‚
> 
> å› æ­¤ï¼Œå¯¹äº 3 ä¸ªåˆ†åŒºï¼Œæ‚¨æœ€å¤šå¯ä»¥æœ‰ 3 ä¸ªæ¶ˆè´¹è€…ï¼Œå¦‚æœæ‚¨æœ‰ 4 ä¸ªæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å°†å¤„äºé—²ç½®çŠ¶æ€ã€‚ä½†æ˜¯å¯¹äº 3 ä¸ªåˆ†åŒºï¼Œæ‚¨å¯ä»¥æœ‰ 2 ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€ä¸ªæ¶ˆè´¹è€…å°†ä»ä¸€ä¸ªåˆ†åŒºè¯»å–ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…å°†ä»ä¸¤ä¸ªåˆ†åŒºè¯»å–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªä½¿ç”¨è€…åœæ­¢å·¥ä½œï¼Œæœ€åä¸€ä¸ªå¹¸å­˜çš„ä½¿ç”¨è€…å°†ä»æ‰€æœ‰ä¸‰ä¸ªåˆ†åŒºä¸­è¯»å–æ•°æ®ï¼Œå½“æ–°çš„ä½¿ç”¨è€…è¢«æ·»åŠ å›æ¥æ—¶ï¼Œåˆ†åŒºå°†å†æ¬¡åœ¨ä½¿ç”¨è€…ä¹‹é—´æ‹†åˆ†ï¼Œè¿™ç§°ä¸ºé‡æ–°å¹³è¡¡ã€‚

![](img/48c08e6be58351bfb3a8b77843140cba.png)

> æ­¤å›¾æè¿°äº†åˆ†åŒºçš„æ¦‚å¿µï¼Œå…¶ä¸­ä¸€ä¸ªä¸»é¢˜æœ‰ 4 ä¸ªåˆ†åŒºï¼Œæ‰€æœ‰åˆ†åŒºä¿å­˜ä¸åŒçš„æ•°æ®é›†ã€‚æ‚¨åœ¨è¿™é‡Œçœ‹åˆ°çš„å—æ˜¯è¯¥åˆ†åŒºä¸­çš„ä¸åŒæ¶ˆæ¯ã€‚è®©æˆ‘ä»¬å‡è®¾ä¸»é¢˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç°åœ¨ç”±äºå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬å°†å•ä¸ªæ•°ç»„åˆ†æˆ 4 ä¸ªä¸åŒçš„æ›´å°çš„æ•°ç»„ã€‚å½“æˆ‘ä»¬å‘ä¸€ä¸ªä¸»é¢˜å†™å…¥ä¸€æ¡æ–°æ¶ˆæ¯æ—¶ï¼Œç›¸å…³çš„åˆ†åŒºè¢«é€‰ä¸­ï¼Œç„¶åè¯¥æ¶ˆæ¯è¢«æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ã€‚
> 
> æ¶ˆæ¯çš„åç§»é‡æ˜¯è¯¥æ¶ˆæ¯åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚è¯¥å›¾ä¸­å—ä¸Šçš„æ•°å­—è¡¨ç¤º**åç§»é‡ï¼Œ**ç¬¬ä¸€å—åœ¨ç¬¬ 0 åç§»é‡ï¼Œæœ€åä¸€å—åœ¨ç¬¬(n-1)åç§»é‡ã€‚ç³»ç»Ÿçš„æ€§èƒ½è¿˜å–å†³äºæ‚¨è®¾ç½®åˆ†åŒºçš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„åé¢å¯¹æ­¤è¿›è¡Œæ¢è®¨ã€‚(è¯·æ³¨æ„ï¼Œåœ¨ Kafka ä¸Šï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªç¬¦å·æ•°ç»„)

å› æ­¤ï¼Œå¡å¤«å¡æ»¡è¶³äº†æˆ‘ä»¬ä¸¤ä¸ªé‡è¦çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å®ƒåƒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸€æ ·ï¼Œå°†æ‰€æœ‰çš„æ¶ˆè´¹è€…æ”¾åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œä»–ä»¬å°†æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯å¹¶ç»§ç»­å‰è¿›ã€‚å¦‚æœéœ€æ±‚æ˜¯ä¸€ä¸ªå‘å¸ƒ/è®¢é˜…ç³»ç»Ÿï¼Œé‚£ä¹ˆå°†æ‰€æœ‰æƒ³è¦ä»åŒä¸€åˆ†åŒºæ¶ˆè´¹çš„æ¶ˆè´¹è€…æ”¾åœ¨ä¸åŒçš„ç»„ä¸­ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœä¸¤ä¸ªæ¶ˆè´¹è€…æ˜¯ä¸åŒçš„ç»„ï¼Œä»–ä»¬å¯ä»¥ä»åŒä¸€ä¸ªåˆ†åŒºä½¿ç”¨ã€‚å› æ­¤ï¼Œåˆ†åŒºæ˜¯ç»„ç›¸å…³çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆç»“æœå‘¢ï¼Ÿæˆ‘ä»¬å¾—åˆ°å¹¶è¡Œå¤„ç†ã€‚

**åˆ†å¸ƒå¼ç³»ç»Ÿ(Kafka cluster)** å¥½äº†ï¼Œè¿™æ˜¯æœ€åä¸€ä»¶äº‹ï¼ŒKafka æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®ƒéµå¾ªæŸç§æ¶æ„(å¦‚ä¸»ä»å¼æˆ–ä¸»ä»å¼)æ¥æä¾›é«˜å¯ç”¨æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚å®ƒä¹Ÿè¢«ç§°ä¸º**é›†ç¾¤ï¼Œå³**ä¸€ç¾¤åœ¨ä¸€èµ·å·¥ä½œçš„ç»çºªäººã€‚é›†ç¾¤ä¸­çš„ä¸€ä¸ªä»£ç†å……å½“æ§åˆ¶å™¨ï¼Œå®ƒåŸºæœ¬ä¸Šä¸ºä»£ç†åˆ†é…åˆ†åŒºï¼Œå¹¶ç›‘è§†ä»£ç†æ˜¯å¦æœªèƒ½å®ŒæˆæŸäº›ç®¡ç†å·¥ä½œã€‚åœ¨å¡å¤«å¡é‚£é‡Œï¼Œæœ‰ä¸€ä¸ªé¢†å¯¼è€…ï¼Œå®ƒæœ‰è¿½éšè€…ï¼Œè¿™äº›è¿½éšè€…æ‹¥æœ‰ä¸é¢†å¯¼è€…åŸºæœ¬ç›¸åŒçš„æ•°æ®ã€‚æ‰€æœ‰çš„æ•°æ®å†™å…¥éƒ½ç”±é¢†å¯¼è€…å®Œæˆï¼Œå¹¶ä¼ æ’­ç»™è¿½éšè€…ä»¥ä¿æŒä¸€è‡´æ€§ã€‚åœ¨å¡å¤«å¡é‚£é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªå¤šé‡é¢†å¯¼è€…çš„æ¦‚å¿µï¼Œå¯¹äºä¸€ä¸ªä¸»é¢˜ä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªç»çºªäººæ˜¯é¢†å¯¼è€…ï¼Œè€Œå¯¹äºå¦ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªç»çºªäººæ˜¯é¢†å¯¼è€…ã€‚è¿™å¾ˆå¥½ï¼Œå› ä¸ºèƒ½å¤Ÿåœ¨åˆ†åŒºçº§åˆ«è¿›è¡Œåˆ†å‘ã€‚

> æ‰€ä»¥ä¸»è¦é—®é¢˜æ˜¯ç”Ÿäº§è€…å¦‚ä½•çŸ¥é“å“ªä¸€ä¸ªæ˜¯é¢†å¯¼è€…ã€‚åŠ¨ç‰©å›­ç®¡ç†å‘˜æ¥äº†ã€‚å³ä½¿æˆ‘ä»¬æƒ³ä¸ç»çºªäººåˆä½œï¼Œæ²¡æœ‰åŠ¨ç‰©å›­ç®¡ç†å‘˜ï¼Œå¡å¤«å¡ä¹Ÿæ— æ³•å‘æŒ¥ä½œç”¨ã€‚Zookeeper æ˜¯ Kafka çš„æ ¸å¿ƒé…ç½®å’Œå…±è¯†ç®¡ç†ç³»ç»Ÿã€‚å®ƒè·Ÿè¸ªä»£ç†ã€ä¸»é¢˜ã€åˆ†åŒºåˆ†é…ã€é¢†å¯¼è€…é€‰ä¸¾ï¼ŒåŸºæœ¬ä¸Šæ˜¯å…³äºé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚

ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å°†è¦åšçš„:
a)å¯åŠ¨ä¸€ä¸ª zookeeper
b)å¯åŠ¨ä¸€ä¸ª Kafka é›†ç¾¤(æ¥è‡ª docker)
c)åœ¨ nodejs (Kafkajs åº“)ä¸­åˆ›å»ºä¸€ä¸ªä¸»é¢˜
d)åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…(nodejs)å’Œæ¶ˆè´¹è€…(nodejs)

> å¦‚æœä»¥ä¸‹å†…å®¹å¯¹æ‚¨ä¸é€‚ç”¨ï¼Œå…³äºä½¿ç”¨ docker-compose æ–‡ä»¶çš„å¦ä¸€ä¸ªå·¥ä½œç¤ºä¾‹ï¼Œè¯·è®¿é—® Kafkajs çš„å®˜æ–¹æ–‡æ¡£:[https://kafka.js.org/docs/running-kafka-in-development](https://kafka.js.org/docs/running-kafka-in-development)
> 
> å¼€å§‹å‰ä½ éœ€è¦æœ‰ä¸€ä¸ªç å¤´å·¥äººã€‚[å®‰è£…](https://docs.docker.com/get-docker/)ä»¥é˜²ä½ æ²¡æœ‰ã€‚

a)å¯åŠ¨ zookeeper:åœ¨ç»ˆç«¯ä¸­ç¼–å†™ä»¥ä¸‹å‘½ä»¤ï¼Œå®ƒå°†å®‰è£…å¹¶è¿è¡Œ Zookeeperã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†æˆ‘çš„ç«¯å£ 2181 æ˜ å°„åˆ° zookeeper çš„é»˜è®¤ç«¯å£ã€‚

![](img/c9d40064b72e190930941783cf8b51fc.png)

b)æ„å»ºä¸€ä¸ª Kafka é›†ç¾¤:æˆ‘ä¸ä¼šå‡ºäºæ¼”ç¤ºç›®çš„ä½¿ç”¨å¤šä¸ª Kafka ä»£ç†ã€‚æ‰€ä»¥ä¸‹é¢æ˜¯è¿è¡Œ Kafka é›†ç¾¤çš„å‘½ä»¤ï¼›å¾ˆå¯æ€•ï¼Œä¸æ˜¯å—ï¼Ÿè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹å®ƒä»¬å„è‡ªçš„å«ä¹‰ã€‚

```
docker run -p 9092:9092 --name kafka -e
 KAFKA_ZOOKEEPER_CONNECT=manavgarg:2181 -e
 KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://manavgarg:9092 -e
 KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 -d confluentinc/cp-kafka
```

**ç¬¬ 1 è¡Œ**ï¼Œæˆ‘ä»¬æ˜ç™½ï¼›å®ƒåªæ˜¯å°†æˆ‘çš„ç«¯å£ 9092 æ˜ å°„åˆ° Kafka çš„é»˜è®¤ç«¯å£ 9092ã€‚ä»ç¬¬ 2 è¡Œå¼€å§‹ï¼Œæˆ‘ä»¬ä»ç¯å¢ƒå˜é‡(-e)å¼€å§‹ã€‚
**ç¬¬äºŒè¡Œ**:å®ƒéœ€è¦ä¸€ä¸ª zookeeper å®ä¾‹ï¼Œæ‰€ä»¥å‘½ä»¤å¿…é¡»æŒ‡å®šå®ƒè¿è¡Œçš„ç«¯å£ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒåœ¨åŒä¸€å°æœºå™¨ä¸Šï¼›å› æ­¤æä¾›äº†ç³»ç»Ÿçš„åç§°ã€‚
**ç¬¬ 3 è¡Œ:**æˆ‘ä»¬éœ€è¦æŒ‡å®šç›‘å¬å™¨ï¼Œå› ä¸ºå¯ä»¥æœ‰å¤šä¸ªã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šè¿æ¥å™¨å°†ä½¿ç”¨çš„åè®®ã€‚æˆ‘ä»¬æœ‰æ˜æ–‡å’Œ SSLï¼Œç”¨äºåŠ å¯†é€šä¿¡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ˜æ–‡ï¼Œå¹¶åªæŒ‡å®šä¸€ä¸ªç›‘å¬ç«¯å£ã€‚ **ç¬¬ 4 è¡Œ:** Zookeeperï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªå®ä¾‹ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªä»£ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒ‡å®šã€‚ **ç¬¬ 5 è¡Œ:**æœ€åï¼Œæˆ‘ä»¬æä¾›å›¾åƒåç§°ã€‚

c)è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¸»é¢˜:
é¦–å…ˆï¼Œåœ¨ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ nodejs é¡¹ç›®ã€‚è¿è¡Œâ€œnpm init -yâ€å¹¶å®‰è£… kafkajs (npm install kafkajs)åï¼Œåˆ›å»ºä¸€ä¸ªåä¸º topic.js çš„æ–°æ–‡ä»¶ã€‚

```
// https://kafka.js.org/
// In topic.js file
const Kafka = require("kafkajs").Kafka;

async function run() {
  const kafka = new Kafka({
    clientId: "myapp",
    brokers: ["manavgarg:9092"], //array since can have multiple brokers
  });
  try {
    const admin = kafka.admin(); //need admin interface to create topics
    console.log("Connecting to kafka");
    await admin.connect(); //to connect
    console.log("Connected!");

    //create topics, it takes a name and number of partitions in each topic

    await admin.createTopics({
      topics: [  //Any number of topics can be created
        {
          topic: "Users",
          numPartitions: 2,
        },
        {
            topic: "Codes",
            numPartitions:3
        }
      ],
    });
    console.log("topic creation done!");
    await admin.disconnect();
  } catch (ex) {
    console.error(`Error occured: ${ex}`);
  } finally {
    process.exit(0);
  }
}
run();
```

d)ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”Ÿäº§è€…æ¥ç”Ÿäº§ä¿¡æ¯ã€‚æˆ‘å°†å±•ç¤ºä¸€ä¸ªæ ·æœ¬ä»£ç ã€‚ä»£ç ä¸­çš„æ³¨é‡Šå°†æœ‰åŠ©äºç†è§£ã€‚
è¦è¿è¡Œï¼Œä½¿ç”¨â€œnode producer.js <æ¶ˆæ¯>

```
// https://kafka.js.org/
//in producer.js file
const Kafka = require("kafkajs").Kafka

const msg = process.argv[2];
run();
async function run(){
    try
    {
         const kafka = new Kafka({
              "clientId": "myapp",
              "brokers" :["manavgarg:9092"]
         })

        const producer = kafka.producer(); //kafka producer
        await producer.connect()
        console.log("Connected!")

        const partition = msg.length>10 ? 0: 1 //algo to divide it msg to partitions
        const result =  await producer.send({ //send command will publish message to the provided topic
            "topic": "Users",
            "messages": [
                {
                    "value": msg,
                    "partition": partition
                }
            ]
        })

        console.log(`Send Successfully! ${JSON.stringify(result)}`)
        await producer.disconnect();
    }
    catch(ex)
    {
        console.error(`Something bad happened ${ex}`)
    }
    finally{
        process.exit(0);
    }

}
```

e)ç„¶åï¼Œæœ€ç»ˆæ¶ˆè´¹è€…å¦‚å›¾æ‰€ç¤ºã€‚è¯·ä¿æŒè¿è¡Œï¼Œå¹¶å¼€å§‹ä»ç”Ÿæˆå™¨ç”Ÿæˆæ¶ˆæ¯ï¼›å®ƒä»¬å°†åœ¨ç»ˆç«¯ä¸Šå¯è§ã€‚è¦åœ¨æ–°çš„ç»ˆç«¯ä¸­è¿è¡Œå®ƒ:ç¼–å†™ node consumer.jsã€‚

```
// https://kafka.js.org/
// kafkajs provides long polling behind the scenes
// in consumer.js file

const { Kafka } = require("kafkajs");

run();
async function run() {
  try {
    const kafka = new Kafka({
      clientId: "yourchoice",
      brokers: ["manavgarg:9092"],
    });

    const consumer = kafka.consumer({ groupId: "Users" }); //consume
    await consumer.connect();
    console.log("Connected!");

    await consumer.subscribe({ //There subscribe to the topics
      topic: "Users",
      fromBeginning: true,
    });

    await consumer.run({
      eachMessage: async (result) => {
        console.log(
          `Message received ${result.message.value} on partition ${result.partition}`
        );
      },
    });
    //It will never end like producers and hence will always be connected and consume messages
  } catch (ex) {
    console.error(`error: ${ex}`);
  } finally {
  }
}
```

**ä¼˜ç‚¹/ CONS** a) **åªé™„åŠ æäº¤æ—¥å¿—**:åªé™„åŠ æ—¥å¿—æ–‡ä»¶é€šè¿‡å°†æ¯ä¸ªæ›´æ”¹å†™åˆ°æ–‡ä»¶æœ«å°¾æ¥è®°å½•å‘ç”Ÿçš„æ•°æ®æ›´æ”¹ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬çŸ¥é“ç»ˆç‚¹åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«åˆ°è¾¾ç»ˆç‚¹ã€‚
b) **æ€§èƒ½**:å› ä¸ºæ—¥å¿—æ˜¯åªè¿½åŠ çš„ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ã€‚é˜…è¯»å’Œå†™ä½œå‘ç”Ÿå¾—éå¸¸å¿«ã€‚
c) [**é•¿è½®è¯¢**](https://ably.com/topic/long-polling#:~:text=Rather%20than%20having%20to%20repeat,available%20or%20a%20timeout%20threshold)
d) **åˆ†å¸ƒå¼
e)äº‹ä»¶é©±åŠ¨æ¶æ„:**å¯ä»¥åŒæ—¶å®ç°é˜Ÿåˆ—å’Œå‘å¸ƒ/è®¢é˜…
f) **å¹¶è¡Œå¤„ç†**

**CONS:** a)æ²¡æœ‰åŠ¨ç‰©å›­ç®¡ç†å‘˜å°±ä¸èƒ½ä½¿ç”¨å¡å¤«å¡ã€‚
b)å®‰è£…ã€é…ç½®å’Œç®¡ç†å¤æ‚:æˆ‘èŠ±äº†æ•´æ•´ä¸€ä¸ªå‘¨æœ«æ¥è®¾ç½®å’Œè¿æ¥ zookeeperï¼Œå¹¶ç¼–å†™ä¸Šé¢çš„ä»£ç ã€‚æˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆå®ƒå’ŒåŠ¨ç‰©å›­ç®¡ç†å‘˜æ²¡æœ‰è”ç³»ã€‚

**ç»“è®º:** Kafka æä¾›äº†è®¸å¤šç‰¹æ€§ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›ç‰¹æ€§ï¼Œå¯¹äºè®¸å¤šä½¿ç”¨å¾®æœåŠ¡æ¶æ„çš„å…¬å¸æ¥è¯´ï¼Œå®ç°è¿™äº›ç‰¹æ€§å°†æ˜¯ä¸€åœºå™©æ¢¦ã€‚

å‚è€ƒèµ„æ–™:
a) [æ±‡æµåšå®¢](https://www.confluent.io/blog/apache-kafka-intro-how-kafka-works/?ref=hackernoon.com) b)[Youtube](https://www.youtube.com/watch?v=TGKUYoegrDY&list=PLxv3SnR5bZE82Cv4wozg2uZvaOlDEbO67)
c)[Pub/sub vs queue](https://www.baeldung.com/pub-sub-vs-message-queues)

æ„Ÿè°¢é˜…è¯»ï¼›æˆ‘å¸Œæœ›å®ƒæœ‰å¸®åŠ©ã€‚å¦‚æœä½ æƒ³è®¨è®ºæ›´å¤šçš„è¯é¢˜ï¼Œè¯·è¿æ¥è¶…è¿‡[*LinkedIn*](https://www.linkedin.com/in/manav-garg-b00963182/)/[*insta gram*](https://www.instagram.com/manav_706/)ã€‚