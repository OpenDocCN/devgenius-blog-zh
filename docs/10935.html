<html>
<head>
<title>Extract stock price data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 提取股票价格数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/extract-stock-price-data-with-python-fa53300120e0?source=collection_archive---------4-----------------------#2022-12-08">https://blog.devgenius.io/extract-stock-price-data-with-python-fa53300120e0?source=collection_archive---------4-----------------------#2022-12-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="f7ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Python 股价分析 01:在线获取股价数据</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/79821329365f9ccaf50c5a197a51087d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrBg_jTqyrmrI6g2Sz-iTg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">坎瓦公司<a class="ae ky" href="https://unsplash.com/s/photos/stock-price?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>模板上<a class="ae ky" href="https://unsplash.com/@behy_studio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">贝南·诺鲁齐</a>的照片</figcaption></figure><h1 id="7417" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">目录</h1><blockquote class="lx ly lz"><p id="950e" class="jk jl ma jm b jn jo jp jq jr js jt ju mb jw jx jy mc ka kb kc md ke kf kg kh ig bi translated"><a class="ae ky" href="#206a" rel="noopener ugc nofollow">简介</a> <br/> <a class="ae ky" href="#395a" rel="noopener ugc nofollow">股价 API </a> <br/> <a class="ae ky" href="#9a6f" rel="noopener ugc nofollow">运行 Jupyter 笔记本中的代码</a> <br/> <a class="ae ky" href="#6fef" rel="noopener ugc nofollow">导出为 JSON 文件</a> <br/> <a class="ae ky" href="#0904" rel="noopener ugc nofollow">数据理解</a> <br/> <a class="ae ky" href="#cbc0" rel="noopener ugc nofollow">转换成数据帧</a> <br/> <a class="ae ky" href="#a0b8" rel="noopener ugc nofollow">导出数据到文件</a> <br/> <a class="ae ky" href="#1a99" rel="noopener ugc nofollow">结论</a> <br/> <a class="ae ky" href="#42c2" rel="noopener ugc nofollow">视频教程</a></p></blockquote><h1 id="206a" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">介绍</h1><p id="85e7" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">世界各地的股市每天都会产生大量的数据。股票市场的波动性以及复杂的交易和投资规则使其成为数据分析的好去处。但是在我们能够分析股市中的任何数据之前，我们需要一种简单高效的方法来提取每天产生的海量数据。</p><p id="4fa8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在今天的教程中，我将教你如何提取你想要的股票的每日股价。</p><h1 id="395a" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">股票价格 API</h1><p id="0cdd" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">我们需要首先连接到 API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/d569bf65e55b41a2e577b41a29614dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyIHQEN6I_fR62IkgO95vw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="a49e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们知道我们需要从网上的某个地方获取数据，但必须有人在那里提供这种服务。<a class="ae ky" href="https://rapidapi.com/" rel="noopener ugc nofollow" target="_blank"> RapidAPI </a>就是其中之一。我不知道它是否足以告诉你它是做什么的，但我用它来提取股票价格数据。请随意在它的网站上探索更多，因为它提供的不仅仅是股票价格 API。</p><p id="ab12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">无论如何，一旦你了解到我们正在连接到某人的服务器，该服务器为我们开放这些数据，你就可以点击<a class="ae ky" href="https://rapidapi.com/alphavantage/api/alpha-vantage/" rel="noopener ugc nofollow" target="_blank">这个链接</a>到达我们可以提取数据的地方。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><p id="4d3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">选择一个端点</strong></p><p id="e234" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将提取时间序列每日调整数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/c1b42c84f949f4c0949fc432140c9d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*s0suNaqTjL1IM6rQjxrgzQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><p id="321c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">选择您的代码</strong></p><p id="a0d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为我们使用的是 python，所以我们将在代码片段部分选择 python 代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/b12f3cd86a6eb9a11f88114419d084d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*faJpxPLjL9GFoMHxTltA3g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><p id="d3bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，我们可以输入我们选择的股票代码。但我现在会坚持使用默认的 MSFT 股票。稍后我会解释。</p><p id="5ef7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是我们将把 outputsize 参数改为“full”。默认值“compact”将只返回最新的 100 个数据点。当您希望每 100 个交易日更新一次数据时，这很有用，但当我们需要完整的数据时，这就不太有用了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/812b8bb6554a5d972b3fa155412772dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyHsQkjspdZU-s_8P3IbBg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><p id="1251" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后点击测试端点。在您运行代码之后，这应该会自动显示一个示例结果。确保检查时间序列选项卡中的键数是否超过 100 个键。</p><p id="6da8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">1 键应该属于 1 日股价。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/f4f73dd9fbf742e4694a41261d9f97c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3Pr3Jkla1B8rYkFH2K-YQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><p id="9e2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以将代码复制到我们的 python 代码中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/91d357541079a7405ae31c130c1629a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*QWS-BNCYF3YnIs4SDaDCCA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><h1 id="9a6f" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">运行 Jupyter 笔记本中的代码</h1><p id="a23f" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">在 python IDE 中运行代码应该会得到一个 JSON 输出文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/c837e7ef32664b43a5c76e3482d5f334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aO4C-3dc1Df73jpKtLm-hw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><h1 id="6fef" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">导出为 JSON 文件</h1><p id="e1ef" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">我们要做的第一件事是导出为 JSON 文件，以防我们在这个过程中弄乱了数据。</p><p id="c575" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">定义存储 JSON 文件的路径。记得在 python 代码所在的目录中创建一个名为“JSON”的文件夹。</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="6866" class="nc la in my b be nd ne l nf ng">import os<br/>filepath = f"{os.getcwd()}/JSON"<br/>path = os.path.abspath(f"{filepath}").replace("\\","/")<br/>path</span></pre><p id="265c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后将提取的数据写入 JSON 文件。</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="e6f5" class="nc la in my b be nd ne l nf ng">import json<br/><br/>with open(f"{path}/MSFT_Stock_Price.json", "w") as outfile:<br/>    json.dump(response.json(), outfile)</span></pre><p id="0ab2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尝试读取 JSON 文件。</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="aaf2" class="nc la in my b be nd ne l nf ng">with open(f'{path}/MSFT_Stock_Price.json', 'r') as openfile:<br/>    # Reading from json file<br/>    json_object = json.load(openfile)<br/>json_object</span></pre><p id="9009" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">输出:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/156dd95b6919bfddac5df3e41cbb1331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IH_pF1CeCCKKQ0Pp7JGCyQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><h1 id="0904" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">数据理解</h1><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="5425" class="nc la in my b be nd ne l nf ng"># Now json_object is a dictionary<br/>type(json_object)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b6b49c15ebdc407d220bd08b5b92266a.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*46j7ub94lUAA4F7C5QI0zA.png"/></div></figure><p id="1491" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">json_object 是一个字典，包含不同级别的股票价格信息。</p><p id="8906" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">检查 json_object 字典中的唯一键。</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="1da6" class="nc la in my b be nd ne l nf ng">for key,values in json_object.items():<br/>    print(key)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/789bbdea46217ab0b08e7979e36bea46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*3mMYmid-xie0SJsbevD3KQ.png"/></div></figure><p id="6d62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个结果告诉我们，我们得到的数据是一个多级字典，有两个主键“元数据”和“时间序列(每日)”。“时间序列(每日)”是存储我们每日股票价格数据的地方，也是以字典的形式。</p><p id="1e28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">打印我们的数据</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="bf12" class="nc la in my b be nd ne l nf ng">for i in json_object["Time Series (Daily)"].items():<br/>    print(i)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/f090946790ecdaee55533448dbb0531b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZHVKS9XQknh71lk-HuWpQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">截图图像</figcaption></figure><p id="469b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">检查日期范围</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="c86d" class="nc la in my b be nd ne l nf ng">for key,values in json_object["Time Series (Daily)"].items():<br/>    print(key)</span></pre><h1 id="cbc0" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">转换成数据框</h1><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="aa0d" class="nc la in my b be nd ne l nf ng">import pandas as pd<br/>stock_price = json_object["Time Series (Daily)"]<br/>df = pd.DataFrame.from_dict({(i): stock_price[i] <br/>                           for i in stock_price.keys()},<br/>                       orient='index')<br/>df_date = df.rename_axis('Date').reset_index()<br/>df_date</span></pre><p id="41e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">记住 json_object 是一个多级字典，其中“时间序列(每日)”本身就是一个字典。我们可以用 pd。DataFrame 将字典转换为数据帧，但对于多级字典，我们需要使用列表理解来循环第一级中的每个键，然后将后续级转换为数据帧。</p><p id="35d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，第一层中的日期被用作每一行的索引。要将索引更改为列，我们使用 reset_index()。这将把表索引变成一个数字序列，原始索引(日期)将被推送到一个列。</p><p id="b87e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">输出:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/355166b8cb90947034e3f16fe2b3b6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FImQ3i_nPIqNFuOCO6pX7w.png"/></div></div></figure><h1 id="a0b8" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">将数据导出到文件</h1><p id="254f" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">记住将这些数据导出到一个文件中供您使用</p><pre class="kj kk kl km gt mx my mz bn na nb bi"><span id="d19b" class="nc la in my b be nd ne l nf ng">filepath = f"{os.getcwd()}/Output"<br/>path = os.path.abspath(f"{filepath}").replace("\\","/")<br/>df_date.to_csv(f'{path}/MSFT_Output.csv')</span></pre><h1 id="1a99" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="2d27" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">今天的文章到此为止。我想把这篇教程分成几个部分，这样每篇文章都不会太长而难以阅读，并且容易集中在每篇文章的一个主题上。在我的下一篇文章中，我将讲述如何修改 API，以便指定想要提取的股票价格数据。</p><h1 id="42c2" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">视频教程</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="bfa5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，如果你有兴趣了解更多关于这个话题的信息，请继续关注。再见！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/42b690d9302b85eeaa0e6338dffbfee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2k1Mh4GBfywKILH0tCS0yQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@itfeelslikefilm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">🇸🇮·扬科·菲利</a>在<a class="ae ky" href="https://unsplash.com/s/photos/learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="a8c3" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">关于我</h1><p id="3ba5" class="pw-post-body-paragraph jk jl in jm b jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh ig bi translated">目前担任数据科学家。我为世界各地的客户提供数据分析问题的咨询、培训和专业服务。我很乐意分享我作为顾问的经验，这样每个人都可以从中学到一些东西。</p><p id="a1b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">领英:【https://www.linkedin.com/in/foocheechuan/ T4】</p><p id="40fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">中:<a class="ae ky" href="https://medium.com/@foocheechuan" rel="noopener">medium.com/@foocheechuan</a></p><p id="332a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Youtube: <a class="ae ky" href="https://www.youtube.com/channel/UC73tyElpkCE_6cbZxMLKnkw" rel="noopener ugc nofollow" target="_blank">车志川</a></p></div></div>    
</body>
</html>