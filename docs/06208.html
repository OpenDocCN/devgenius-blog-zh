<html>
<head>
<title>Importing csv data with Haskell and the World’s dependency on fossil fuels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Haskell导入csv数据以及世界对化石燃料的依赖</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/importing-csv-data-with-haskell-and-the-worlds-dependency-on-fossil-fuels-7070e7796b4a?source=collection_archive---------9-----------------------#2021-12-21">https://blog.devgenius.io/importing-csv-data-with-haskell-and-the-worlds-dependency-on-fossil-fuels-7070e7796b4a?source=collection_archive---------9-----------------------#2021-12-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7d8deab14b2d518b671202650899f4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTj9tGpZhxsPjcjaVhFZTA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://ourworldindata.org/fossil-fuels" rel="noopener ugc nofollow" target="_blank">2019年化石燃料占一次能源的比重</a></figcaption></figure><p id="edfe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你读了我在<a class="ae jz" href="https://medium.com/@fabiomolinar/my-first-77-hours-with-haskell-188222314040?source=friends_link&amp;sk=9a364747ddd811db7a86cfbb35416ed3" rel="noopener">的上一篇文章</a>，关于我对Haskell的爱恨情仇，你会发现在我使用这种语言的最初几个小时里，用Haskell编程就像坐过山车一样。</p><p id="e0d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是正如我在最后提到的，【Haskell的某些东西一直让我想起它。随着我写得越来越多，我开始意识到两个相反的事实可能在很大程度上解释了为什么会这样。这些是:</p><ol class=""><li id="0de2" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">我不会撒谎，用Haskell编程对我来说还是很难。我喜欢挑战。</li><li id="e0f1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">一段时间后，我最终写出的代码是如此的干净、简洁和漂亮。</li></ol><p id="9a9f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我能够想象出我想要编码的解决方案之前，它需要一些时间在我的头脑中“点击”。但是当它出现时，代码流动得很快，最终的结果是，正如我所说的，干净、简洁和漂亮。这实际上是我上面提到的两个事实背后的东西，它不断将我带回Haskell:</p><blockquote class="lm"><p id="e7e0" class="ln lo in bd lp lq lr ls lt lu lv kx dk translated">不同于命令式语言，函数式语言如Haskell让我花更多的时间思考，花更少的时间编码。</p></blockquote><p id="b11f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在Python或JavaScript中，我通常从输入代码开始，当它们出现在我脑海中时，按顺序输入一组指令。就像我在前述文章中描述的例子一样，要绘制一个充满正方形的图像，在函数式编程语言中，我会这样处理它:</p><ol class=""><li id="4e2a" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">绘制背景画布。</li><li id="c1de" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">循环遍历行数和列数，并在每个点上画一个正方形。</li></ol><blockquote class="mb mc md"><p id="f945" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">这种方法几乎总是会导致重构，因为频繁地翻译思维步骤并不是编程时解决问题的最佳方法。</p></blockquote><p id="4cce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在函数式编程语言中，我创建了一个函数，它知道在画布空间中给定一个点需要画什么。就是这样。每个像素只运行一次的过程。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="9888" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们进入代码。</p><p id="ef12" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，我想再次创建一个正方形阵列的图像。然而，现在我希望正方形颜色是外部数据的函数(在本例中，是一个csv文件)。我想利用我在<a class="ae jz" href="https://medium.com/@fabiomolinar/my-first-77-hours-with-haskell-188222314040?source=friends_link&amp;sk=9a364747ddd811db7a86cfbb35416ed3" rel="noopener">我的上一个故事</a>中创建和讨论的模块，所以这个新的模块范围应该只专注于绘制正确的正方形颜色，而不是构建正方形本身。</p><p id="5a2d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">像上次一样，现在<strong class="kc io">我用我需要的数据类型的基本定义开始每个模块</strong>。这使得我的函数的签名更清晰，整个代码更容易理解，同时也是很好的文档。</p><p id="da72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在第一次迭代中，我的新模块有一个负责读取数据的函数，一个负责从中构建数据结构，另一个负责根据数据定义颜色。第一次尝试中困扰我的一件事是:<strong class="kc io">事实上我的函数并不都是纯的</strong>。第一个负责读取数据，使用IO函数。</p><blockquote class="mb mc md"><p id="b18e" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated"><strong class="kc io">那时我决定将与IO相关的函数移到我所有IO所在的</strong> <code class="fe mp mq mr ms b"><strong class="kc io">Main.hs</strong></code> <strong class="kc io">入口点文件中，保持我的新模块完全纯净</strong>。</p></blockquote><p id="a5d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就导入csv数据而言，<code class="fe mp mq mr ms b">cassava</code>包使这个过程变得轻而易举，代码运行速度很快，包文档也很好地满足了我的需求。出于我的目的，因为我已经定义了我需要的数据类型，我所要做的就是实现我的<code class="fe mp mq mr ms b">Entry</code>数据类型的<code class="fe mp mq mr ms b">FromNamedRecord</code>和<code class="fe mp mq mr ms b">DefaultOrdered</code>类。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3a75" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我只需要在我的入口点模块上使用样板代码来运行IO操作来加载数据。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e2e6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是基于数据绘制颜色的函数的样子(<code class="fe mp mq mr ms b">fossilColor</code>包含逻辑的“核心”)。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="78ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不知道你怎么看，但是<code class="fe mp mq mr ms b">fossilColor</code>功能对我来说就是这么简单和优雅。这就是为什么我越来越了解哈斯克尔。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="c4cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在去广场！</p><p id="39cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如本故事开头的特色图片所示，结果不言自明。我们的世界仍然严重依赖化石燃料。这是一张(几乎)相同的数据(我去掉了在整个时期没有数据的国家)的图片，以彩色方块的阵列显示。</p><p id="b9cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">红色代表高度依赖化石燃料的国家；否则为绿色。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/5c8eafea95ae5e08894b93b9fb90bc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RodniK4-SOfk_cKO8jaMrA.png"/></div></div></figure><p id="226e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想知道哪些国家显示绿色结果，这些是(括号中是2018年的结果):</p><ul class=""><li id="6001" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx na le lf lg bi translated">冰岛(22%)</li><li id="7172" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx na le lf lg bi translated">挪威(31%)</li><li id="8f97" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx na le lf lg bi translated">瑞典(31%)</li></ul></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="ae7b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在使用Haskell几个小时后，我终于开始对这种语言及其一些核心概念感到舒服了。我对创建图像的速度也很满意。创建图像只花了不到一秒钟。与我第一次尝试创建正方形图像相比，这要好得多！</p><p id="b656" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一件让我震惊的事情是，我现在能够以多快的速度理解和修复基于编译器错误消息的代码。举个例子(也是迄今为止让我感到非常兴奋的一个例子)，与一元和应用IO操作相关的错误消息几乎立刻就让我明白了<em class="me"/>。现在我更清楚了，运算符涉及和返回的数据类型是什么，如<code class="fe mp mq mr ms b">&lt;$&gt;</code>、<code class="fe mp mq mr ms b">&lt;*&gt;</code>、<code class="fe mp mq mr ms b">&gt;&gt;</code>、<code class="fe mp mq mr ms b">&gt;&gt;=</code>、<code class="fe mp mq mr ms b">return</code>等。</p><p id="1e9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我觉得我和哈斯克尔的旅程才刚刚开始。让我们看看接下来的步骤会带来什么。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="1634" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">[1]:汉娜·里奇和马克斯·罗瑟(2020)《能量》。OurWorldInData.org在线出版。检索自:“https://ourworldindata . org/energy”[在线资源]</p></div></div>    
</body>
</html>