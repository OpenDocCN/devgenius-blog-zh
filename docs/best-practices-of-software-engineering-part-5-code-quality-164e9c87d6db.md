# 软件工程最佳实践。第五部分。代码质量。

> 原文：<https://blog.devgenius.io/best-practices-of-software-engineering-part-5-code-quality-164e9c87d6db?source=collection_archive---------37----------------------->

![](img/115c14016b42c1985fbf302c2c17bc8f.png)

在本文中，我无法涵盖所有与代码质量相关的问题或解决方案。这个主题非常广泛，主要与开发人员的资格有关，因为如果您的开发人员没有看到并理解他们的错误，任何技巧、技术或工具都不会有帮助。

为什么代码质量如此重要？只要你有一个小项目，所有的业务逻辑都存储在一个程序员的脑袋里，低质量的代码就不会有巨大的问题。但在所有其他情况下，代码的复杂性在不断增长，错综复杂的情况在我们眼前成倍增加。因此，当开发新功能时，您会立即在其他几个地方中断另一个功能。我确信你已经看到了在项目的初始阶段，团队工作得非常快速和高效，但是随着时间的推移，发布变得越来越慢。必须记住的是，发布不仅在时间上延迟，而且对公司来说成本也更高，并且在某些时候，这种开发的价格可能会超过公司准备支付的价格。可能有数百个例子，但在我看来，这在罗伯特·c·马丁(Robert C. Martin)的《干净代码:敏捷软件工艺手册》(Clean Code:A Handbook of Agile Software craftness)一书中写得最为清楚。我强烈推荐阅读这本书。

我们都希望在项目中使用高质量的代码。但实际上，我们通常要在完全不同的条件下工作。通常，大型代码迟早会遭遇代码质量下降的问题。我想谈谈我们处理这个问题的经验。

首先，我们的团队自己决定:我们为自己设定什么样的代码质量标准？

*   可以看一遍就明白了
*   它包含最少的错误和潜在的安全漏洞
*   它符合语言标准和构建应用程序的基本原则
*   它完全符合客户或顾客的要求

下一步是选择实现这些标准的工具和技术，这里有一些我认为是必要的东西。

# 单元和功能测试

在我关于自动测试的文章中，我已经写了关于测试的内容，但是更多的是强调系统测试。但是在这里，我会告诉你为什么写单元和功能测试很重要。

首先，这是代码正确性的一个证明。自动化测试让您确信您的程序正在按预期运行。测试的成功执行将向开发人员表明，他的更改没有破坏任何它不想破坏的东西。在测试失败的情况下，您可以快速研究错误，并将预期结果与实际结果进行比较。这将提供一个机会来理解错误发生在哪里，是在代码中还是在业务需求中。

其次，在本文的上下文中同样重要的是，正确编写的测试有助于消除代码中不必要的依赖，并保持高粒度。最终，这将降低程序员理解代码的复杂性。此外，在某些情况下，测试可以作为代码的文档。涵盖可能的用途、限制和潜在错误的一组合格的测试不会比专门编写的文档差。

# 代码审查

在我看来，这是发展过程中最重要的一步。它不仅允许团队在开发的早期发现错误，还增加了开发人员对项目和架构的知识和理解水平。

下面是进行代码评审时要遵循的一些最重要的规则。

*   你需要知道要寻找什么。如果您已经在使用自动代码 Linter 和静态代码分析，那么您需要专注于这些工具没有涵盖的内容，例如:解决方案的结构和设计、工作逻辑和代码的可读性，以及性能和功能。问你自己这些问题:我理解这些代码做什么吗？代码是否按预期工作？
*   **构建和测试。**代码评审应该在项目被组装、构建并通过各种测试、代码分析等之后进行。此外，如果代码审查需要，来自自动化工具和测试的所有报告都必须链接到一个拉请求，或者链接到这个拉请求所解决的问题。一般来说，通过代码评审时可能需要的所有东西都必须放在一个有用的地方。
*   **限制复习时间。不要一次复习超过一个小时。你的大脑会变得疲劳，甚至开始忽略明显的错误。休息一下，让你的大脑休息一下。出于同样的原因，不要试图一次覆盖超过 500 行的代码。**
*   **“正确”的评论。对代码留下建设性的评论，但是不要忘记你的评论可能会冒犯到别人。请记住，团队中的许多冲突恰恰出现在代码审查阶段。在评论中，你不仅需要留下建设性的评论，还需要表扬。此外，除了直接陈述，您还可以写一些问题，指出代码中让您困惑的地方。**
*   **培养积极的文化。**所有代码都必须通过代码评审，包括高级开发人员的代码，每个开发人员，无论级别高低，都要参与代码评审。例如:如果一个初级开发人员正在审查一个高级开发人员的代码，他们可能不会发现任何错误，但是他们会看到问题应该如何解决。这将有助于在团队中发展健康的环境，同时提高开发人员的技能。

# 静态代码分析

这类工具(如 [Klocwork](https://www.perforce.com/products/klocwork) 、 [pylint](https://pylint.org) 、 [phpmd](https://phpmd.org) )检查程序的文本，以识别任何已知的漏洞、错误、不准确、无效动作等模式。代码分析器不能代替测试或代码审查，但却是这些工具的很好的补充。静态分析器发现不同类型的问题，例如:复制粘贴、变量/方法/类的名称、没有使用的代码、过大的类/方法等。也有可能发现安全问题或不正确的架构。

将这些工具集成到 CI 流程中可能会充满困难。例如:代码分析器可能会出现误报情况，或者分析器发现的问题可能有争议，在这种情况下，最好不要在此时解决它。这意味着当检测到缺陷时，我们不能停止 CI 流程。在我们的 CI 流中，我们使用 autotests 运行代码分析器，它生成一个错误报告，并将其附加到一个 Pull 请求中。这允许我们在代码审查期间审查分析器的结果，并决定如何处理发现的问题。

# 编码标准

写代码的时候要记住的主要一点是，你会写一遍，但是要读几百遍。如果项目中有不止一个开发人员，这个问题会变得特别尖锐。因此，代码遵循将通过降低阅读代码的复杂性来帮助您的团队更有效地工作。一般来说，编码标准是良好项目可维护性的关键。

在我们的开发中，我们使用普遍接受的标准，比如 PHP 的 [PSR1/2](https://en.wikipedia.org/wiki/PHP_Standard_Recommendation) 或者 Python 的 [PEP8](https://www.python.org/dev/peps/pep-0008/) 。您使用哪种编码标准并不重要，重要的是整个团队都遵守这些标准。为了实现这个目标，我们不仅要说服并教导我们的开发人员，还要标准化开发环境。我们所有的开发者都有相同的 IDE，相同的设置，linter，git-hooks 等等。

我们还建立了符合编码标准的 CI 流程验证。如果违反了标准，代码集成过程就会停止，开发人员可以在报告中看到到底哪里出了问题，并纠正代码风格。当然，这一步可以修改，所有错误都可以自动纠正，但这并不总是正确的决定。

# 重构

如果，在你的项目中，业务需求在不断变化，功能在不断重写，也就是说，同样的代码在不断修改，那么迟早会变成持续的混乱。通常，这段代码中有很多部分不再使用，或者没有被正确使用。这种冗余和混乱的代码大大增加了项目的复杂性，降低了开发速度，也增加了出现缺陷的可能性。

为了纠正这个问题，我们应用了童子军的一个原则:“总是让露营地比你发现它的时候更干净”。换句话说，在任务的执行过程中，我们也以这样或那样的方式重构与该任务相关的代码。程序员选择重构的数量，这取决于他们完成任务的时间。此外，我们有时会创建任务来在系统的某些部分执行重构，但是实践告诉我们，这些任务很少被实现。造成这种情况的原因很多，值得单列一篇。但是，这是最重要的两个:首先，企业不想把钱花在没有价值的工作上，其次，“战术总是战胜战略”，这意味着:你可以做一个任务，你可以立即看到它的效果，或者进行重构，它的效果可能很难立即看到或者根本不可能看到。

所有以上的方法和工具在我上一个项目中确实发挥了魔力。我们能够减少回归缺陷的数量并提高开发速度，从而减少上市时间指标。

这是我的软件工程最佳实践系列的最后一篇文章，我希望这些文章能帮助你在工作中取得成功。祝你好运！

## 软件工程的最佳实践

1.  [目标](https://medium.com/@kirillmedvednykov/best-practices-of-software-engineering-part-1-goals-4457a907e756)
2.  [速度指标](https://medium.com/@kirillmedvednykov/best-practices-of-software-engineering-part-2-velocity-metrics-692c401acb4b)
3.  [自动测试](https://medium.com/@kirillmedvednykov/best-practices-of-software-engineering-part-3-autotests-d74c13086742)
4.  [自动化](https://medium.com/@kirillmedvednykov/best-practices-of-software-engineering-part-4-automation-eaf795b9a8d8)
5.  [代码质量](https://medium.com/dev-genius/best-practices-of-software-engineering-part-5-code-quality-164e9c87d6db)