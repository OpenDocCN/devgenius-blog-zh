<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://blog.devgenius.io/js-events-deep-dive-221921376986?source=collection_archive---------7-----------------------#2022-04-18">https://blog.devgenius.io/js-events-deep-dive-221921376986?source=collection_archive---------7-----------------------#2022-04-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/5e5661399685dd28cbfef7a206819d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36WnswG2RPrWe_RIYJbO6Q.png"/></div></div></figure><p id="6bef" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">JS 事件深潜。</p><p id="c2da" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">我们来了解一下 JS 事件处理。<strong class="iz jv">停止传播</strong>和<strong class="iz jv">立即停止传播</strong>和<strong class="iz jv">防止故障</strong>。</p><p id="439c" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">JS 事件看起来很简单，但是当像 div 中的 div 这样的嵌套元素在元素中传播时就有点棘手了。这就是我们试图使用 stopPropagation()和/或 preventDefault()来解决问题的地方。下面我们就来详细说说每一种，以及什么时候使用这一种。</p><p id="176a" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">在进入细节之前，让我们先了解一下当今所有现代浏览器都支持的事件样式。</p><blockquote class="jw jx jy"><p id="b4c9" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"> <em class="iy">事件样式(捕捉和冒泡)</em> </strong></p></blockquote><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="baed" class="km kn iy ki b gy ko kp l kq kr">someElement.addEventListener('click', clickHandler, { capture: true | false });</span></pre><p id="3c25" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated"><strong class="iz jv">选项</strong>对象是第三个允许事件捕捉为真或假的参数。</p><blockquote class="jw jx jy"><p id="f499" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"> <em class="iy">事件捕捉</em> </strong></p></blockquote><p id="9dcc" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">先说“在捕获阶段监听”的事件处理程序？为了理解这一点，我们需要了解事件是如何起源的，以及它们是如何传播的。</p><p id="159e" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">所有事件都从窗口开始，并首先经历捕获阶段。当调度一个事件时，它从窗口开始，向下移动到第一个目标元素。即使你在“冒泡”阶段听，这种情况也会发生。</p><p id="4cf6" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">考虑下面的 HTML 标记和 JS。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="b6eb" class="km kn iy ki b gy ko kp l kq kr">&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="A"&gt;<br/>      &lt;div id="B"&gt;<br/>        &lt;div id="C"&gt;&lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9f17" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">我们将在 id 为“C”的 div 元素上添加一个事件侦听器。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="b7f7" class="km kn iy ki b gy ko kp l kq kr">document.getElementById('C').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('#C was clicked');<br/>  },<br/>  true,<br/>);</span></pre><p id="dfe3" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">甚至，如果试图点击任何一个元素，它会控制台的“#C 被点击”。</p><p id="d971" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">原因是事件流如下。</p><p id="51d3" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">窗口→文档→ Html →正文→ …直到到达目标元素。然后，点击事件将直接传播，直到检测到其目标元素。</p><p id="c837" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">在捕获阶段，是否有任何东西在侦听 body 元素上的点击事件？如果是，那么将触发适当的事件处理程序。</p><p id="a001" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">因此，在上述示例中，事件侦听器被附加到元素 id“C”，但它将从窗口对象开始，然后是文档、Html、正文、<code class="fe ks kt ku ki b">#A</code>、<code class="fe ks kt ku ki b">#B</code>、<code class="fe ks kt ku ki b">#C</code>，因为我们正在注册捕获阶段。</p><p id="4efc" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">简而言之，事件捕获流程是从<strong class="iz jv">顶部→底部。</strong></p><p id="0806" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">现在，你可能认为这是“事件的结束”。所以，现在反过来，事件又回到顶部，这个阶段叫做事件冒泡。</p><blockquote class="jw jx jy"><p id="338b" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"> <em class="iy">事件冒泡</em> </strong></p></blockquote><p id="180a" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">现在，浏览器将询问“在冒泡阶段，是否有任何东西在监听<code class="fe ks kt ku ki b">#C</code>上的点击事件？”</p><p id="2ce0" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">在<em class="jz">和</em>捕获<em class="jz">和</em>冒泡阶段，完全有可能听到咔哒声(或任何事件类型)。如果你在两个阶段都连接了事件处理程序(比如通过调用<code class="fe ks kt ku ki b">.addEventListener()</code>两次，一次用<code class="fe ks kt ku ki b">capture = true</code>一次用<code class="fe ks kt ku ki b">capture = false</code>，那么是的，两个事件处理程序绝对会为同一个元素触发。</p><p id="2a70" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">但是同样重要的是要注意火处于不同的阶段(一个在捕获阶段，一个在冒泡阶段)。</p><p id="4e41" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">因此，在上述示例中，事件监听器被附加到元素 id“C”，但它将从<code class="fe ks kt ku ki b">#B</code>、<code class="fe ks kt ku ki b">#A</code>开始，主体、Html、文档和窗口正在注册冒泡阶段。</p><p id="f49e" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">简而言之，事件捕获流程是从<strong class="iz jv">底部→顶部。</strong></p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="ff3c" class="km kn iy ki b gy ko kp l kq kr">&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="A"&gt;<br/>      &lt;div id="B"&gt;<br/>        &lt;div id="C"&gt;&lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="0c78" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">让我们看看这两个阶段的实际情况。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="432c" class="km kn iy ki b gy ko kp l kq kr">document.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on document in capturing phase');<br/>  },<br/>  true,<br/>);<br/>// document.documentElement == &lt;html&gt;<br/>document.documentElement.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on &lt;html&gt; in capturing phase');<br/>  },<br/>  true,<br/>);<br/>document.body.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on &lt;body&gt; in capturing phase');<br/>  },<br/>  true,<br/>);<br/>document.getElementById('A').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #A in capturing phase');<br/>  },<br/>  true,<br/>);<br/>document.getElementById('B').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #B in capturing phase');<br/>  },<br/>  true,<br/>);<br/>document.getElementById('C').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #C in capturing phase');<br/>  },<br/>  true,<br/>);<br/><br/>document.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on document in bubbling phase');<br/>  },<br/>  false,<br/>);<br/>// document.documentElement == &lt;html&gt;<br/>document.documentElement.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on &lt;html&gt; in bubbling phase');<br/>  },<br/>  false,<br/>);<br/>document.body.addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on &lt;body&gt; in bubbling phase');<br/>  },<br/>  false,<br/>);<br/>document.getElementById('A').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #A in bubbling phase');<br/>  },<br/>  false,<br/>);<br/>document.getElementById('B').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #B in bubbling phase');<br/>  },<br/>  false,<br/>);<br/>document.getElementById('C').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('click on #C in bubbling phase');<br/>  },<br/>  false,<br/>);</span></pre><p id="316f" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">如果您看到控制台语句，它将记录如下。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="752e" class="km kn iy ki b gy ko kp l kq kr">"click on document in capturing phase"<br/>"click on &lt;html&gt; in capturing phase"<br/>"click on &lt;body&gt; in capturing phase"<br/>"click on #A in capturing phase"<br/>"click on #B in capturing phase"<br/>"click on #C in capturing phase"<br/>"click on #C in bubbling phase"<br/>"click on #B in bubbling phase"<br/>"click on #A in bubbling phase"<br/>"click on &lt;body&gt; in bubbling phase"<br/>"click on &lt;html&gt; in bubbling phase"<br/>"click on document in bubbling phase"</span></pre><p id="c534" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">此外，您还会摆弄代码。</p><p id="1b69" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">现在让我们深入研究一下 JS 事件。</p><blockquote class="jw jx jy"><p id="5082" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"><em class="iy"/></strong></p></blockquote><p id="e69e" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">这个方法可以在(大多数)本地 DOM 事件上被调用。像<code class="fe ks kt ku ki b">focus</code>、<code class="fe ks kt ku ki b">blur</code>、<code class="fe ks kt ku ki b">load</code>、<code class="fe ks kt ku ki b">scroll</code>等事件都属于这一类。</p><p id="ff91" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">因此，如果在捕获阶段的任何地方调用 stopPropagation()，事件将永远不会进入目标阶段或冒泡阶段。</p><p id="a59d" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">如果你在冒泡阶段调用它，它将已经经历了捕获阶段，但是它将从你调用它的地方停止冒泡。</p><p id="2fd3" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">因此，假设您在元素#B 上调用 stopPropagation，它将记录如下。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="2db4" class="km kn iy ki b gy ko kp l kq kr">"click on document in capturing phase"<br/>"click on &lt;html&gt; in capturing phase"<br/>"click on &lt;body&gt; in capturing phase"<br/>"click on #A in capturing phase"<br/>"click on #B in capturing phase"</span></pre><blockquote class="jw jx jy"><p id="8207" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"><em class="iy">event . stopmimmediatepropagation()</em></strong></p></blockquote><p id="0051" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">当一个元素上连接了多个事件时，可以使用这种方法。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="d5b9" class="km kn iy ki b gy ko kp l kq kr">&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="B"&gt;I am the #B element&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="4a44" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">在#B 上添加事件侦听器。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="a122" class="km kn iy ki b gy ko kp l kq kr">document.getElementById('B').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('When #B is clicked, I shall run first!');<br/>  },<br/>  false,<br/>);<br/><br/>document.getElementById('B').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('When #B is clicked, I shall run second!');<br/>    e.stopImmediatePropagation();<br/>  },<br/>  false,<br/>);<br/><br/>document.getElementById('B').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    console.log('When #B is clicked, I would have run third, if not for stopImmediatePropagation');<br/>  },<br/>  false,<br/>);</span></pre><p id="a27a" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">这将如下所示的控制台日志。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="246d" class="km kn iy ki b gy ko kp l kq kr">"When #A is clicked, I shall run first!"<br/>"When #A is clicked, I shall run second!"</span></pre><blockquote class="jw jx jy"><p id="cf0c" class="iw ix jz iz b ja jb jc jd je jf jg jh ka jj jk jl kb jn jo jp kc jr js jt ju ig bi translated"><strong class="iz jv"><em class="iy">event . prevent default()</em></strong></p></blockquote><p id="a485" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">把它想象成“阻止默认动作”</p><p id="ce6a" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">让我们从一个非常简单的例子开始理解。</p><p id="2517" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">当你点击网页上的链接时，你希望会发生什么？显然，您希望浏览器导航到该链接指定的 URL。</p><p id="c05a" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">在这种情况下，元素是锚标记，事件是单击事件。该组合(<code class="fe ks kt ku ki b">&lt;a&gt;</code> + <code class="fe ks kt ku ki b">click</code>)有一个导航到链接的 href 的“默认动作”。</p><p id="0897" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">如果你想<em class="jz">阻止</em>浏览器执行那个默认动作呢？也就是说，假设您想要阻止浏览器导航到由<code class="fe ks kt ku ki b">&lt;a&gt;</code>元素的<code class="fe ks kt ku ki b">href</code>属性指定的 URL？</p><p id="1906" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">这就是<code class="fe ks kt ku ki b">preventDefault()</code>将为你做的。</p><pre class="kd ke kf kg gt kh ki kj kk aw kl bi"><span id="dc3e" class="km kn iy ki b gy ko kp l kq kr">&lt;a id="avett" href="https://www.theavettbrothers.com/welcome"&gt;The Avett Brothers&lt;/a&gt;</span><span id="1738" class="km kn iy ki b gy kv kp l kq kr">document.getElementById('avett').addEventListener(<br/>  'click',<br/>  function (e) {<br/>    e.preventDefault();<br/>    console.log('Maybe we should just play some of their music right here instead?');<br/>  },<br/>  false,<br/>);</span></pre><p id="d4c5" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">因此，很少有使用 preventDefault 的用例。</p><ol class=""><li id="28c1" class="kw kx iy iz b ja jb je jf ji ky jm kz jq la ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">&lt;form&gt;</code>元素+“提交”事件</li><li id="352c" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">&lt;a&gt;</code>元素+“点击”事件</li><li id="3fec" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">document</code> +“鼠标滚轮”事件</li><li id="a151" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">document</code>+“keydown”事件</li><li id="793f" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">document</code>+“mousedown”事件</li><li id="0780" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">&lt;input&gt;</code>元素+“按键”事件</li><li id="e1ec" class="kw kx iy iz b ja lf je lg ji lh jm li jq lj ju lb lc ld le bi translated"><code class="fe ks kt ku ki b">document</code> +“上下文菜单”事件</li></ol><p id="f438" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">尽管这不是完整的列表，但它将提供一个在何处使用 preventDefault 事件方法的好主意。</p><p id="ad09" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">希望这篇文章能给你一些何时何地使用事件方法的想法。</p><p id="a044" class="pw-post-body-paragraph iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ig bi translated">快乐编码。不断学习。继续探索。</p></div></div>    
</body>
</html>