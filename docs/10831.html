<html>
<head>
<title>Ceph — Next Gen Cloud Storage System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ceph —下一代云存储系统</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ceph-next-gen-cloud-storage-system-1ee91fbbeca4?source=collection_archive---------3-----------------------#2022-12-03">https://blog.devgenius.io/ceph-next-gen-cloud-storage-system-1ee91fbbeca4?source=collection_archive---------3-----------------------#2022-12-03</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="4ddd" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">Ceph 简介</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj kg"><img src="../Images/a03e57924f1e3e0d0f524c5ad90b6cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*Vaut_OBsJAQhUhycjjnm2Q.png"/></div></figure><h1 id="6f35" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">什么是 Ceph</h1><p id="db88" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Ceph 是什么？Ceph 是一个开源、分布式、横向扩展、软件定义的存储系统，可以提供块、对象和文件存储。Ceph 的集群被设计为在一种叫做<strong class="li is"> CRUSH </strong>(可伸缩散列下的受控复制)的算法的帮助下运行在任何硬件上。</p><p id="34b7" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated"><strong class="li is"> CRUSH </strong>算法使客户端能够独立计算数据应该写入或读取的位置。通过动态派生这些元数据，就不需要管理一个集中的表。</p><p id="cb60" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">服务器可以非常快速地执行 CRUSH 查找；此外，更小的计算负载可以跨集群节点分布，从而利用分布式存储的能力。这使得 Ceph 可以快速扩展到数百 Pb，而没有瓶颈和相关单点故障的风险。</p><p id="fdb4" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">Ceph 是一个真正的统一存储解决方案，它从一个统一的软件定义的后端提供数据块、文件和对象服务。Ceph 提供了三种主要的存储类型:</p><ul class=""><li id="69f7" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">通过 RADOS 块设备进行块存储(RBD)</li><li id="4441" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">通过 CephFS 进行文件存储</li><li id="54eb" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">通过 RADOS Gateway 进行对象存储，提供 S3 和 Swift 兼容的存储。</li></ul><p id="17b2" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">如下图所示:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj mv"><img src="../Images/d7fd7728017276385e73501f80cc2b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5rWMbsaDdUjK5MUBve6jQ.png"/></div></div><figcaption class="na nb gk gi gj nc nd bd b be z dk translated">图片来自<a class="ae ne" href="https://docs.ceph.com/en/quincy/" rel="noopener ugc nofollow" target="_blank"> Ceph </a></figcaption></figure><p id="69eb" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">您可以在任何符合 Ceph 要求的硬件上自由运行 Ceph。这是存储行业的一项重大发展，该行业通常会受到严格的供应商限制。此外，根据 CAP 定理，Ceph 更倾向于<strong class="li is">一致性</strong>,并会不惜一切代价使保护您的数据在发生分区时比可用性更优先。</p><h1 id="c732" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 的历史</h1><ul class=""><li id="2537" class="mh mi ir li b lj lk lm ln lp nf lt ng lx nh mb mm mn mo mp bi translated">2003–2007:Ceph 是由 Sage Weil 于 2003 年在加州大学开发的，作为他博士项目的一部分。然后在 2006 年，它在一个 LGPL 下被开源，作为一个参考实现和研究平台。劳伦斯利弗莫尔国家实验室从 2003 年到 2007 年支持 Sage 的早期跟踪工作。</li><li id="5be7" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated"><strong class="li is">2007–2011</strong>:DreamHost 从 2007 年到 2011 年支持 Ceph 开发。在此期间，Ceph 的核心组件获得了稳定性和可靠性，实现了新功能，并绘制了未来的路线图。</li><li id="79d6" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated"><strong class="li is"> 2012 年—当前</strong>:2012 年，Sage Weil 创立了 Inktank，以推动 Ceph 的广泛应用。2014 年，红帽同意收购 Inktank。</li></ul><p id="340c" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">Ceph 的活动版本如下所示:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj ni"><img src="../Images/c9bbdb942de4549bfd5a9b9c16189f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZBotVcqN15nuTwmF41qn3A.png"/></div></div><figcaption class="na nb gk gi gj nc nd bd b be z dk translated">来自<a class="ae ne" href="https://docs.ceph.com/en/quincy/releases/index.html" rel="noopener ugc nofollow" target="_blank"> Ceph </a>的图片</figcaption></figure><h1 id="2cd7" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 的好处</h1><p id="60a4" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Ceph 具有以下优势:</p><ul class=""><li id="744d" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated"><strong class="li is">可扩展性</strong>:支持使用 CRUSH 算法快速缩放。Ceph 克服了所有可扩展性挑战，并提供真正灵活、弹性的大规模存储。</li><li id="4ee5" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated"><strong class="li is">可靠性</strong> : Ceph 具有自我管理和自我修复功能，它可以监控和管理守护进程，从而提高整个系统的可靠性和数据可用性。</li><li id="fc02" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated"><strong class="li is">性能</strong>:作为纯 SDS(软件定义的存储系统)，它旨在最大限度地提高效率和性能，而不考虑底层基础架构。</li></ul><h1 id="e724" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 核心组件</h1><h2 id="daa0" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">RADOS 和 OSD</h2><p id="e119" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">在 Ceph 中，核心存储层被称为 RADOS(可靠的自治分布式对象存储)，它提供了一个对象存储，在此基础上构建更高级别的存储协议。拉多斯是:</p><ul class=""><li id="e3dd" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">无单点故障的高可用性(SPoF)</li><li id="e45c" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">可靠且有弹性</li><li id="10a1" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">自我修复和自我管理</li><li id="4e15" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">适应的</li><li id="d3ed" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">可攀登的</li></ul><p id="5852" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">RADOS 层由许多对象存储守护进程(OSD)组成，每个 OSD 都是完全独立的，并在整个集群中形成对等关系。然后，每个 OSD 通常被映射到单个磁盘，这与通过 RAID 控制器将多个磁盘组合成单个设备呈现给操作系统的传统方法形成对比。</p><h2 id="ed7f" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">隆起</h2><p id="163b" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">另一个关键组件是 MONs(监视器)。这里的名称很容易让人误解，因为 MONs 不仅进行集群监控，还充当整个集群的仲裁者、交通警察和医生。</p><p id="eac5" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">监视器负责通过使用 Paxos 形成集群仲裁。监视器使用集群映射来提供集群状态，Ceph 集群组件和客户端都使用这些集群映射来描述集群拓扑，并使数据能够安全地存储在正确的位置。</p><h2 id="5ec5" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">经理</h2><p id="a033" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">管理器负责 Ceph 集群配置和统计。为了跟踪集群中每个对象的状态，Ceph 对底层对象名进行哈希运算，将对象放入多个放置组中。</p><p id="5bf5" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">然后使用 CRUSH 算法将放置组放置到 OSD 上。这大大降低了跟踪数百万个对象所需的计算能力，只需跟踪更易于管理的放置组数量，通常以千计。It 职责包括:</p><ul class=""><li id="d107" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">驱动器和机箱状态/定位器指示灯的管理</li><li id="358e" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">创建和管理客户端映射，如 rbd-mirror 和 RADOS Gateway，</li><li id="cb39" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Ceph 手术服的整体管理</li><li id="ce0a" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">更丰富的重新加权和重新平衡操作管理。</li><li id="deab" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">与 RackTables、NetBox、HP SIM 和 Cisco UCS Manager 等外部库存系统集成</li><li id="93da" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Nagios、Icinga、Graphite 和 Prometheus 等监控/度量系统的接口</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj nv"><img src="../Images/045e7a77a8af59847c99cc697decb24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvBvWEJg7WI-1lElXie6ag.png"/></div></div><figcaption class="na nb gk gi gj nc nd bd b be z dk translated">图片来自<a class="ae ne" href="https://canonical.com/blog/ceph-storage-on-ubuntu-an-overview" rel="noopener ugc nofollow" target="_blank">规范</a></figcaption></figure><h1 id="10c6" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 核心服务</h1><p id="aa8c" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Ceph 核心服务架构图如下:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj nw"><img src="../Images/53c45894e5a6249118b9b38ebf1f8d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p6-WYO3I9pMkBofazaB9xA.png"/></div></div><figcaption class="na nb gk gi gj nc nd bd b be z dk translated">来自<a class="ae ne" href="https://docs.ceph.com/en/quincy/architecture/" rel="noopener ugc nofollow" target="_blank"> Ceph </a>的图片</figcaption></figure><h2 id="7d8a" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">RADOS 闭塞设备(RBD)</h2><p id="e3d6" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">RBD 服务以一种方式呈现块(也称为卷)存储，传统的 HDD/SDD 应用程序只需很少或不需要调整即可使用。它将基于块的应用程序数据分解成小块，这些小块作为对象存储在 RADOS 中。RBD 协调虚拟块设备中对象的存储</p><h2 id="2c63" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">雷达网关(RGW)</h2><p id="3fd9" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Ceph 对象网关是一个构建在 librados 之上的对象存储接口，为应用程序提供了一个通向 Ceph 存储集群的 RESTful 网关。Ceph 对象存储支持两种接口:</p><ul class=""><li id="8618" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">S3 兼容:提供对象存储功能，其接口与 Amazon S3 RESTful API 的大部分子集兼容。</li><li id="d7bd" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Swift 兼容:通过与 OpenStack Swift API 的大部分子集兼容的接口提供对象存储功能。</li></ul><p id="0cbc" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">在幕后，Ceph 对象网关使用 RGW(一个 HTTP 服务器)与下划线存储交互。</p><h2 id="c849" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">CephFS</h2><p id="9df9" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Ceph 文件系统是构建在 RADOS 之上的 POSIX 兼容文件系统。CephFS 致力于为各种应用程序提供一流的、多用途、高可用性和高性能的文件存储，包括共享主目录、HPC 暂存空间和分布式工作流共享存储等传统用例。</p><p id="8428" class="pw-post-body-paragraph lg lh ir li b lj mc js ll lm md jv lo lp me lr ls lt mf lv lw lx mg lz ma mb ik bi translated">在 CephFS 中，文件元数据存储在与文件数据分开的 RADOS 池中，并通过 MDS(元数据服务器)提供服务。对数据的访问通过 MDS 集群来协调，该集群充当由客户端和 MDS 合作维护的分布式元数据缓存的状态的权威。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj nx"><img src="../Images/74a89c99dca7fd5304245b61438213f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*urBErRKJCJ3IbQCQz4Nkaw.png"/></div></div><figcaption class="na nb gk gi gj nc nd bd b be z dk translated">图片来自<a class="ae ne" href="https://docs.ceph.com/en/quincy/cephfs/" rel="noopener ugc nofollow" target="_blank"> Ceph </a></figcaption></figure><h2 id="9b3c" class="nj kp ir bd kq nk nl dn ku nm nn dp ky lp no np la lt nq nr lc lx ns nt le nu bi translated">利布拉多斯</h2><p id="b607" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">基于 RADOS，librados API 允许您创建自己的 Ceph 存储集群接口。使用 librados，您可以与两种类型的 Ceph 守护进程进行交互:</p><ul class=""><li id="19ac" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">Ceph Monitor，它维护集群映射的主副本。</li><li id="3c61" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Ceph OSD 守护进程(OSD ),它将数据作为对象存储在存储节点上。</li></ul><h1 id="7347" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 用例</h1><ul class=""><li id="af80" class="mh mi ir li b lj lk lm ln lp nf lt ng lx nh mb mm mn mo mp bi translated">OpenStack/KVM: Ceph 是向 OpenStack 环境或 KVM 虚拟化提供存储的完美匹配。</li><li id="832c" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">K8s</li><li id="b455" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">大型块存储</li><li id="a9c0" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">对象存储:Ceph 目前拥有匹配 S3 API 的最佳兼容性记录之一</li><li id="fa1f" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Web 场服务器</li><li id="ffdc" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">美国国家科学院（National Academy of Sciences）</li><li id="cadb" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">大数据</li></ul><h1 id="4aaa" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">Ceph 实施建议</h1><p id="84d6" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">以下是部署成功的 Ceph 集群的一些通用规则:</p><ul class=""><li id="fd7d" class="mh mi ir li b lj mc lm md lp mj lt mk lx ml mb mm mn mo mp bi translated">最低 10G 网络</li><li id="7d6c" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">不要对 filestore 使用无障碍装载选项</li><li id="c708" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">不要配置大小为 2 或最小大小为 1 的池</li><li id="0102" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">不要使用消费级固态硬盘</li><li id="058e" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">在没有电池保护的情况下，不要在回写模式下使用 raid 控制器</li><li id="0290" class="mh mi ir li b lj mq lm mr lp ms lt mt lx mu mb mm mn mo mp bi translated">一定要有一个商定的备份和恢复计划</li></ul></div></div>    
</body>
</html>