<html>
<head>
<title>Write data to DynamoDB using awswrangler and boto3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 awswrangler 和 boto3 将数据写入 DynamoDB</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/write-data-to-dynamodb-using-awswrangler-and-boto3-d6aad2622389?source=collection_archive---------7-----------------------#2022-12-27">https://blog.devgenius.io/write-data-to-dynamodb-using-awswrangler-and-boto3-d6aad2622389?source=collection_archive---------7-----------------------#2022-12-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ad1223378b9b07a6fb06374b584a54f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhGCepxOnYxmQpyV9x9chw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">文章照片</figcaption></figure><p id="fe63" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">DynamoDB 是快速、灵活的<strong class="kb io"> NoSQL </strong>数据库服务，可实现个位数毫秒级性能。它是完全托管的，无需服务器，可以在任何规模下运行<strong class="kb io">高性能应用</strong>。</p><p id="ac38" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">最常见的使用案例:</p><ul class=""><li id="b3e6" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">软件应用</li><li id="b392" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">创建媒体元数据存储</li><li id="58cf" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">提供无缝零售体验</li><li id="f286" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">规模游戏平台</li></ul><p id="66df" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这篇文章中，我将向你展示如何使用 Python 库<strong class="kb io">向 DynamoDB </strong>写数据。其中之一<a class="ae ll" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> boto3 </a> —是众所周知的 AWS SDK (SDK 代表软件开发工具包)，它使<strong class="kb io">能够创建、配置和管理 AWS 服务</strong>。我将使用它来创建 DynamoDB 表。</p><p id="1d45" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第二个库叫做<strong class="kb io">AWS rangler</strong>—<strong class="kb io">AWS 熊猫 SDK。</strong>它可以将<strong class="kb io"> pandas DataFrame、csv、json 或 parquet </strong>文件直接写入<strong class="kb io"> DynamoDB 表或 S3 桶</strong>等等，查看<a class="ae ll" href="https://aws-sdk-pandas.readthedocs.io/en/stable/api.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><h2 id="6e49" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated">使用 boto3 创建表格</h2><p id="58ab" class="pw-post-body-paragraph jz ka in kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ig bi translated">让我们看看下面的 python 代码:</p><figure class="mk ml mm mn gt jo"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">创建 DynamoDB 表</figcaption></figure><p id="733d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">函数<strong class="kb io"> create_albums_table </strong>有一些奇特的地方值得一提和说明:</p><ol class=""><li id="46be" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw mq ld le lf bi translated">第 4–8 行:函数采用一个参数— <em class="mr"> dyn_resource </em> s，默认设置为 None。如果第 7 行和第 8 行的语句检查参数<em class="mr"> dyn_resources </em>是否为 None，如果是，则使用 boto3 包来<strong class="kb io">创建 DynamoDB 客户端(DynamoDB 客户端是一个 Python 类，</strong> <a class="ae ll" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodb.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">这里的</strong> </a> <strong class="kb io">是属于这个类的方法)</strong></li><li id="c6b7" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw mq ld le lf bi translated">第 12–29 行:<strong class="kb io">模式是 python 字典</strong>，它包含创建表所需的数据</li><li id="a377" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw mq ld le lf bi translated">第 31 行:表的创建(注意字典被<strong class="kb io">双星号语法</strong>解包)</li><li id="c5ae" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw mq ld le lf bi translated">第 33 行:方法<strong class="kb io">。wait _ until _ exists()</strong>简单等待，直到表被创建</li><li id="28a5" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw mq ld le lf bi translated">最后，函数<strong class="kb io">在第 35 行返回表</strong></li></ol><p id="5b3a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">执行函数<strong class="kb io">后，create_albums_table </strong>表在 DynamoDB 中创建。为了检查它，你可以去你的<strong class="kb io"> AWS 管理控制台</strong>并搜索<strong class="kb io"> DynamoDB </strong>服务。接下来点击<strong class="kb io">表格选项卡。</strong>您应该会看到<strong class="kb io">相册</strong>表格，如下图所示:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/c0df9ddac3ee1f95d4a7e1d2974ddfc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMzmy_RVnjydgVCxj4Q9MA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">DynamoDB 中列出的表格相册</figcaption></figure><h2 id="3427" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated">使用 awswrangler 写入数据</h2><p id="78d4" class="pw-post-body-paragraph jz ka in kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ig bi translated">让我们看看带有相册的示例数据集:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/3f93208b75bcdd47bb3e4a83d94a328c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZjMhkKYTz7koMEkpwBTwUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">带有相册的数据集示例</figcaption></figure><p id="665b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们可以看到上面的数据集包含两列:</p><ul class=""><li id="03fa" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">相册 id —类型:整数</li><li id="87d5" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">相册名称—类型:字符串</li></ul><p id="a52a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">数据以<strong class="kb io"> csv 格式</strong>存储。让我们使用 awswrangler 库，以便直接从 csv 文件将其写入<strong class="kb io"> DynamoDB。以下 Python 代码支持这样做:</strong></p><figure class="mk ml mm mn gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="bfe7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">上面代码中值得一提的是<strong class="kb io">第 10–13 行:</strong>这里库 awswrangler 用于<strong class="kb io">将数据从 csv 文件</strong>写入 DynamoDB。</p><p id="80ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当函数<strong class="kb io">write _ data _ to _ Albums _ table</strong>被执行时，我们可以验证数据是否已经被写入<strong class="kb io">相册表</strong>。为此，请遵循以下步骤。</p><p id="44d9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">1.进入<strong class="kb io"> AWS 管理控制台，</strong>再次导航到<strong class="kb io"> DynamoDB </strong>服务，点击<strong class="kb io">表格。</strong></p><p id="b078" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.点击表格名称<strong class="kb io">相册。下面的截屏突出显示了这一点:</strong></p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/690b156f7b2401624b6d7c7790330f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQKH5bknnDpfIifH9-4Jdw.png"/></div></div></figure><p id="8ba7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.您应该会看到<strong class="kb io">相册</strong>表格的导航仪表板，现在为了浏览表格项目，请单击下面屏幕截图上突出显示的按钮:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/54c82fd340545180374fb86df4b97397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*Muwe_IaWOCM8Wl1H-5cacg.png"/></div></figure><p id="53f1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.点击此按钮后，您应该能够在页面的<strong class="kb io">底部看到下表:</strong></p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/da1503dc2b4886168c1cdc09ead95f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2do9xA9nbv9dFb3rdtl7iw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">DynamoDB 中的相册表</figcaption></figure><h2 id="023e" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated">附加信息</h2><p id="7661" class="pw-post-body-paragraph jz ka in kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ig bi translated">DynamoDB 允许写数据的方法还有<strong class="kb io">。</strong></p><p id="0dad" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我写这篇文章的那天——2022 . 12 . 27 awswrangler 包为 DynamoDB 提供了<strong class="kb io"> 6 个方法:</strong></p><p id="1c5b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> delete_items </strong> —删除指定 DynamoDB 表中的所有项目。</p><p id="0059" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> get_table </strong> —获取指定表名的 DynamoDB 表对象。</p><p id="99ee" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> put_csv </strong> —将 csv 文件中的所有项目写入 DynamoDB。</p><p id="b4d1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> put_df </strong> —将数据帧中的所有项目写入 DynamoDB</p><p id="5af6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> put_items </strong> -将所有项目插入指定的 DynamoDB 表格。本例中的条目是字典列表。</p><p id="219e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">put _ json</strong>-将 JSON 文件中的所有项目写入 DynamoDB。</p><p id="9e01" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这篇文章的代码在这个<a class="ae ll" href="https://github.com/Cloudy17g35/write_data_to_dynamodb" rel="noopener ugc nofollow" target="_blank">报告里</a>。</p></div></div>    
</body>
</html>