<html>
<head>
<title>10 things to know before building ETL pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建 ETL 管道之前要知道的 10 件事</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/10-things-to-know-before-building-etl-pipelines-169e267861f9?source=collection_archive---------7-----------------------#2022-07-28">https://blog.devgenius.io/10-things-to-know-before-building-etl-pipelines-169e267861f9?source=collection_archive---------7-----------------------#2022-07-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6f4db32ef633cb76072b61dfafab333b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOABBEhU3zS20YIjE9FSKg.png"/></div></div></figure><p id="928c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">想象你正在建造一座建筑，如果不了解布局、可用材料和计划/进度，你就无法完成这项工作。构建 ETL 管道也不例外。理解基本原理被低估了，但在构建任何东西时都是至关重要的。</p><p id="5cf2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为 ETL 管道开发人员，理解您正在工作的 ETL 框架的组件是很重要的。有时，您会有机会从头开始设计框架或增强现有的框架。</p><p id="8a95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:除了 ETL 之外，数据还可以以 ELT 的方式进行处理，在这种方式下，数据被提取并直接加载到目标系统中，然后进行转换。云数据仓库正在涌现出支持大数据的 ELT 特性和扩展功能。本文将探索 ETL 过程，其中大部分也可以应用于 ELT 管道。</p><h1 id="722e" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">1.体系结构</h1><p id="5b37" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">下面是所有 ETL 管道的高级架构。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/c3d6595f724b3e49b481157cf95ffd3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ST9jWBYXlkSOawQNNtRnXA.png"/></div></div></figure><p id="4c11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">数据源</strong>是数据的生产者。您从中提取数据的所有系统都是您的数据源。在现实世界中，数据源是不同的。它们可能因数据类型、技术、可用性等而异。</p><p id="5345" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">数据源通常被称为 sor。(记录的来源)但是请记住，您的数据源可能是也可能不是记录的实际来源。它们可以在 SORs 之上一层。</em></p><p id="8ac9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">管道</strong>是 ETL 架构的关键。这是举重发生的地方。您需要的转换取决于您的项目需求。数据转换的简单例子有，</p><ul class=""><li id="8cd3" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated">转换数据类型。示例:日期存储为字符串，Date _ str = " 2022–07–16 "转换为日期时间格式 formatted _ Date = 2022–07–16 11:51:4。日期差异和其他日期函数不能在 date_str 上执行。</li><li id="5778" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">更改属性名称。</li><li id="00b2" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">合并或拆分列。</li><li id="fbfe" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">根据需要创建新列。示例:从出生日期列计算和创建年龄。</li><li id="cac9" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">数据混淆:如果你在一个处理安全数据的行业工作，你可能必须为了安全的目的混淆/掩盖数据。</li></ul><p id="7e54" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:有时术语“属性”和“列”可以互换使用。</p><p id="94d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">接收或目标系统</strong>是你发送数据的地方。这些系统是转换数据的消费者。您必须以这样一种方式转换数据，即数据可以很容易地被接收系统使用。例如:如果源系统中的数据是行列格式的，而目标系统是 NoSQL 数据库，那么您必须在管道中将数据转换成 JSON 格式。</p><h1 id="1d91" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">2.数据格式和技术</h1><p id="f451" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">数据源和目标系统中的数据可以以各种格式和系统存储。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/cf3fb819faeb8ead34181d52fae4105f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7TXpKYICNajm6h1j3mf1w.png"/></div></div></figure><p id="6ef0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有太多的工具和技术可以用来建造管道。一些跨行业使用的通用技术有 Spark、Databricks、Azure Data Factory、DBT、Informatica、AWS Glue 等..开发人员可能还需要熟悉 Python、Scala、SQL、Shell 脚本等。来开发管道。</p><h1 id="aac9" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">3.数据管道的类型</h1><p id="6ee8" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">管道根据其处理技术分为实时(流)和批处理。</p><ul class=""><li id="0d31" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated">批处理管道根据定义的节奏(如每小时/每天等)处理大量数据。当需要处理大数据和执行复杂转换时，以及当数据新鲜度不重要时，开发这些类型的管道。</li><li id="8bc7" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">实时管道被设计成在数据产生并被传递到目标系统时立即处理数据，因此，它能够处理的数据量是最小的，但是数据应该被即时处理。建立这些管道的能力取决于 sor 是否能够发送实时流。</li></ul><p id="360d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有时，这些管道中使用的技术不同。实时管道通常需要一个发布-订阅消息系统，如<a class="ae mr" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank">卡夫卡</a>、<a class="ae mr" href="https://azure.microsoft.com/en-us/services/event-hubs/" rel="noopener ugc nofollow" target="_blank">事件中心</a>等。像<a class="ae mr" href="https://databricks.com/" rel="noopener ugc nofollow" target="_blank"> Databricks </a>这样的技术可以用来处理实时和批量数据。</p><h1 id="bde5" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">4.数据加载的类型</h1><p id="8b97" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">管道的最终目标是从源系统获取数据，并将数据传送到目标系统。有多种方法可以实现这一点。首先，我们必须确定用例所需的数据元素/属性，并以下列方式之一加载这些数据属性，</p><ul class=""><li id="f981" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated"><em class="mb">初始加载</em> <br/>当开发一个管道时，管道的第一次运行将总是针对历史数据，直到 CURRENT_DATE。数据的第一次加载通常被称为“初始加载”。</li><li id="fe03" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated"><em class="mb">增量加载</em> <br/>如果您的数据源维护哪些元素发生了变化的元数据(如日期)，我们可以开发一个管道来提取增量/增量数据，将其转换并加载到目标系统中。增量流水线应该考虑，<br/> <em class="mb"> *插入</em> —如果数据元素是新的，即不存在于目标系统中<br/> * <em class="mb">更新</em> —如果数据元素存在于目标系统中并且在中有变化。一个或多个属性)<br/> * <em class="mb">删除/关闭</em> <em class="mb">记录</em> —如果数据元素过期或不再需要<br/>您必须根据需求审查和实施 SCDs(渐变维度)。这是一篇很棒的<a class="ae mr" href="https://towardsdatascience.com/data-analysts-primer-to-slowly-changing-dimensions-d087c8327e08" rel="noopener" target="_blank">文章</a>，解释了所有类型以及何时使用它们。</li><li id="4f5a" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated"><em class="mb">满载</em> <br/>有时，您必须构建一个管道来提取 SOR 中的全部数据。在这些情况下，数据通常会在目标系统中被覆盖。如果识别数据源中已更改的记录非常昂贵或不可能，或者为了减少增量数据上载或 SCD 带来的实现或数据维护工作，则首选全加载。</li></ul><h1 id="e86a" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">5.数据区和层</h1><p id="c41b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">可以根据转换的级别将数据分为多个组，</p><ol class=""><li id="a4f4" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks ms mi mj mk bi translated"><em class="mb">原始区域:</em>这是第一层数据。从数据源提取的数据可以标记为原始数据。这些数据应该原样保留，不做任何修改。这通常被称为“暂存数据/区域”。</li><li id="84fc" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks ms mi mj mk bi translated"><em class="mb">细化/精选区域</em>:这是通常在清理原始数据并根据需要应用多种转换后得到的数据层。</li><li id="98de" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks ms mi mj mk bi translated"><em class="mb">富集区</em>:该层应该以可消费的格式存储数据。这是目标系统可以直接使用的已准备好并经过处理的数据。</li></ol><p id="e27e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些层/区域及其术语因组织需求和使用案例而异。有些人把这些区域称为银、铜和金。</p><h1 id="d9b9" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">6.参数化管道</h1><p id="e916" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">创建全局参数并独立于管道维护这些参数将提供灵活性，并将变量从管道代码中分离出来。我们可以在需要时更新参数，而无需修改管道代码。</p><p id="f485" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例子，</p><p id="782d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">1.实施数据提取管道时，创建日期参数(即 2022 年 1 月 1 日至 2022 年 1 月 4 日之间)是一个好主意。因此可以对多个时间帧执行相同的提取流水线。这种参数化可以在用于从数据库提取数据的 SQL 查询中实现。<br/>样本查询:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="6f61" class="my ku in mu b gy mz na l nb nc">SELECT attr_1,attr_2,attr_3<br/>FROM table 1<br/>WHERE date between {@start_datetime} and {@end_datetime}</span></pre><p id="e56f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里 start_datetime 和 end_datetime 是参数。</p><p id="d499" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.如果您的管道使用规则来提取数据，并且如果这些过滤规则经常变化，那么最好将这些规则定义为参数。</p><h1 id="4321" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">7.管道编排</h1><p id="1708" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">大多数时候，管道是相互依赖的。流水线 10 可以依赖于流水线 8 和流水线 9，而流水线 9 可以依赖于流水线 5、6 和 7。这些依赖关系可能会变得复杂，如果管理不当，将会导致失败。这就是编排发挥作用的地方。为了实现无缝的端到端管道执行，以正确的顺序触发工作流非常重要。应该仔细考虑等待时间、依赖性、触发器、调度程序和故障。</p><p id="405d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">方法 1:一个主触发管道触发所有管道</em></p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/35685870b7c0a38331b81060f9dc08b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUqcGVetjR-8fPZryd_ErQ.png"/></div></div></figure><p id="3e5b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">方法 2:在管道内实现触发器</em></p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/a050b14439f09770e7fad754a7f7907e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRRfwX9bmyPtiFlGHGoMMg.png"/></div></div></figure><p id="197e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些图表涵盖了高层次的管道编排方法。触发依赖管道应该基于前一个管道的成功。如果触发管道失败，流程应该停止，并且应该实现适当的错误处理功能。</p><p id="1e98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编排可以完全在内部构建，或者市场上有大量工具提供编排功能，如<a class="ae mr" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">气流</a>、<a class="ae mr" href="https://dagster.io/" rel="noopener ugc nofollow" target="_blank"> Dagster </a>、<a class="ae mr" href="https://aws.amazon.com/step-functions/" rel="noopener ugc nofollow" target="_blank"> AWS 步骤功能</a>等。</p><p id="89e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:有时术语“管道”、“作业”和“工作流”可以互换使用。</p><h1 id="7721" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">8.流水线执行</h1><p id="9007" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">可以使用触发器来执行管道。触发器基于一个事件。事件可以是 SOR 中的数据变化、在跟踪 SFTP 服务器中上传的新文件等。还可以将管道计划为每天/每小时/每月运行一次，或者在有任何特别请求时手动触发。</p><h1 id="9add" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">9.管道和数据验证指标</h1><ul class=""><li id="17b2" class="mc md in jx b jy lr kc ls kg nf kk ng ko nh ks mh mi mj mk bi translated">存储管道运行细节总是一个好主意。例如流水线 ID、流水线上次运行的日期和时间、运行状态、流水线执行的总时间等。</li><li id="76cf" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">实施数据验证指标，如从源系统提取的记录数、转换后的记录数以及加载到目标系统的记录总数，对于分析数据量和识别任何数据差异至关重要。</li><li id="db21" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">当出现管道故障时，建立通知机制(如电子邮件)将有助于在问题出现时迅速采取行动。</li><li id="cb5e" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">存储日志还有助于调试错误。</li></ul><p id="fb22" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些指标越精细，在系统出现故障时就越容易调试或追溯。</p><h1 id="63af" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">10.数据管道的使用</h1><ol class=""><li id="d857" class="mc md in jx b jy lr kc ls kg nf kk ng ko nh ks ms mi mj mk bi translated">数据科学和 ML 模型:如果数据是分布式的，并且需要清理、转换和用于特征工程和模型训练，则需要 ETL 管道。</li><li id="5ce6" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks ms mi mj mk bi translated">分析:数据可以加载到商业智能系统，如 Tableau，Power BI，Looker 等。使用数据管道。这些数据管道提取原始数据，并将其转换成可消费的格式。</li><li id="1209" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks ms mi mj mk bi translated">应用程序:组织拥有大量由数据驱动的内部应用程序。ETL 数据管道负责为这些应用程序提供可靠且随时可用的数据。</li><li id="cba7" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks ms mi mj mk bi translated">个性化和推荐:向用户显示个性化内容并向他们推荐相关内容是通过数据驱动的流程和模块实现的。数据管道在这里扮演着重要的角色，它收集关于用户的相关信息，并从数据中创建针对特定受众群体的细分市场。</li></ol><p id="7e06" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">大数据工程和管道开发的价值正呈指数级增长，公司正在投资于产品、人员和技术，以利用数据和推动决策。</p></div></div>    
</body>
</html>