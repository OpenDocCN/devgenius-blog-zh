<html>
<head>
<title>Exchange Rate Ticker for iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 的汇率报价机</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/exchange-rate-ticker-for-ios-b7e279b35c8f?source=collection_archive---------10-----------------------#2020-07-15">https://blog.devgenius.io/exchange-rate-ticker-for-ios-b7e279b35c8f?source=collection_archive---------10-----------------------#2020-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e7f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设计和开发一个简单的 iOS 汇率报价器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d7768e76a9b0d57f1ca0bd6e2be35207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RlcMQdAcWPt2QOOjc1QaCQ.gif"/></div></div></figure><p id="cb6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我之前的<a class="ae kx" href="https://medium.com/dev-genius/how-to-create-an-apple-card-payment-dial-bdbae4017c21" rel="noopener">文章</a>中，我提到我的项目文件夹中有一些代码积满了灰尘。这就是一个这样的项目，我现在想和你们分享一下。</p><p id="3afb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我每天都使用 iOS 的股票应用。我真的很喜欢顶部的股票代码。它启发我做了一个汇率报价器。</p><p id="48fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文将分为两部分:</p><ul class=""><li id="69b0" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">第 1 部分—股票行情</li><li id="f367" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">第 2 部分—使滚动条具有可访问性</li></ul><p id="fe7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">滚动条是一组货币视图。如果货币视图的宽度之和超过了滚动条的宽度，滚动条将显示视图，以便用户可以看到所有的货币。</p><p id="e18f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们从货币的角度开始。</p><h1 id="3ae6" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">货币视图</h1><p id="f2dc" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">使用<strong class="jp ir">单视图应用</strong>模板创建一个新的 Xcode 项目。称之为<em class="mp">跑马灯</em>，设置<em class="mp">用户界面</em>为<em class="mp">故事板</em>。</p><p id="b110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">项目导航器</strong>中，选择<em class="mp">股票行情</em>组，添加一个新组，命名为<strong class="jp ir">货币视图</strong>。我们将添加两个新文件。第一个是<strong class="jp ir"> Cocoa Touch 类</strong>，将其命名为<strong class="jp ir"> CurrencyView.swift </strong>，并使其成为<code class="fe mq mr ms mt b">UIView</code>的子类。第二，一个<strong class="jp ir">视图</strong>用户界面文件。称之为<strong class="jp ir"> CurrencyView </strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/411b7430257177b4905c82a35b24fd4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hb8fw-XQC210QCruj9VYQ.jpeg"/></div></div></figure><p id="4041" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<strong class="jp ir"> CurrencyView.xib </strong>文件。在左侧的<strong class="jp ir">文档轮廓</strong>窗格中，选择<strong class="jp ir">文件的所有者</strong>。</p><blockquote class="mv mw mx"><p id="60a5" class="jn jo mp jp b jq jr js jt ju jv jw jx my jz ka kb mz kd ke kf na kh ki kj kk ij bi translated">如果看不到<strong class="jp ir">文档轮廓</strong>，在 Xcode 中打开<em class="iq">编辑器</em>菜单，选择<em class="iq">文档轮廓</em>。</p></blockquote><p id="3234" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开右侧<strong class="jp ir">检查器</strong>窗格中的<strong class="jp ir">身份检查器</strong>。在<strong class="jp ir">自定义类别</strong>部分，将<em class="mp">类别</em>更改为<code class="fe mq mr ms mt b">CurrencyView</code>。</p><blockquote class="mv mw mx"><p id="b7a1" class="jn jo mp jp b jq jr js jt ju jv jw jx my jz ka kb mz kd ke kf na kh ki kj kk ij bi translated">如果看不到<strong class="jp ir">检查员</strong> <em class="iq">窗格，打开</em> <em class="iq">查看</em>菜单，然后转到<em class="iq">检查员</em>子菜单，选择<em class="iq">显示检查员</em>。</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/4b3dc9055f3d9a3b661ebb70e43b30ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PcoqTtEDTI4YlSZhZp72qA.jpeg"/></div></div></figure><p id="481d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在右侧的<strong class="jp ir">检查器</strong>窗格中，选择<strong class="jp ir">视图</strong>并打开<strong class="jp ir">属性检查器</strong>。在<strong class="jp ir">模拟矩阵</strong>部分，将<em class="mp">尺寸</em>更改为<em class="mp">自由形式</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/12e4c5a9e6d1b00d1d147248982d4932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tjeYAZYdHPgcOfCPfQ6Mg.jpeg"/></div></div></figure><p id="86a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在右侧的<strong class="jp ir">检查器</strong>窗格中选择<strong class="jp ir">尺寸检查器</strong>，将视图的宽度更改为 64，高度更改为 90。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/970f392a6a082fe405432dd872151cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gmF2Dm6LPMdSiGQhx30RQ.jpeg"/></div></div></figure><p id="909f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">检查器</strong>窗格中选择<strong class="jp ir">文件检查器</strong>，取消勾选<em class="mp">使用安全区域布局指南。</em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/140fd33ef20f944dc64e5311c2212313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFlVtPDiwWAckiSFxFeRdA.jpeg"/></div></div></figure><p id="b207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">给视图添加一个图像视图，将其命名为<em class="mp">标志图像视图</em>，在<strong class="jp ir">尺寸检查器</strong>中将其宽度和高度设置为 30。我们正在手动设置大小，以便长宽比将是一。添加一个前导和尾随约束 17，一个顶部约束 8，并勾选<em class="mp">纵横比</em>复选框。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/1b2c91b723335caa66a4511ee2f4d0d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkAiy9j5yQ3t5kI2yxUBnA.jpeg"/></div></div></figure><p id="97c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的货币视图需要两个标签，一个用于货币代码，另一个用于汇率。让我们从货币代码开始。<br/>在<em class="mp">旗帜图像视图</em>下给我们的视图添加一个文本标签，命名为<em class="mp">货币代码</em>。在右侧的<strong class="jp ir">检查器</strong>窗格的<strong class="jp ir">属性检查器</strong>中，设置字体的<strong class="jp ir">样式</strong>为<strong class="jp ir">粗</strong>，大小为 16。将文本对齐设置为<strong class="jp ir">居中</strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/f65d18a0e2fc4bb4d1382b80952a7c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OjoUDDepf0f7t2kLV3MTQ.jpeg"/></div></div></figure><p id="df09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<em class="mp">货币代码</em>标签的顶部固定到<em class="mp">标志图像视图</em>的底部，并将值设置为 4。添加值为 8 的前导和尾随约束。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/0dd781f70555126ab9f8af9a7ab9a66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkF3TXbbboixbsEARMqZIg.jpeg"/></div></div></figure><p id="c97c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们的货币代码标签。让我们来看看价格标签。在<em class="mp">货币代码</em>标签下添加另一个标签，命名为<em class="mp">汇率</em>。将字体大小设置为 14。将文本对齐设置为<strong class="jp ir">居中</strong>。将<em class="mp">汇率</em>的顶部固定到<em class="mp">货币代码</em>的底部，并将其值设置为 8。针对其值为 8 的超级视图设置前导和尾随约束。最后将底部固定到其超级视图的底部。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/c73b0cddc15da0ef65cb0b433fc77986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZbTjHw5ALJEkXXDifAtWg.jpeg"/></div></div></figure><p id="190f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir"> CurrencyView.swift </strong>中创建以下三个插座，并在<em class="mp">界面构建器</em>中连接它们:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ffb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在类被实例化时加载 nib，创建一个公共初始化器<code class="fe mq mr ms mt b">commonInit()</code>，每当调用<code class="fe mq mr ms mt b">UIView</code>的一个初始化器时，就会调用这个初始化器。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="39b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的<code class="fe mq mr ms mt b">CurrencyView</code>现在已经完成，让我们继续关注股票本身。</p><h1 id="320d" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">滚动条视图控制器</h1><p id="d519" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">在 Xcode 中创建一个新的视图控制器，将其命名为<strong class="jp ir"> TickerViewController </strong>，并确保选择<em class="mp">同时创建 XIB 文件</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/e815ef288942dd38c2833cb392a97310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PoAmv0IMiNvNtKGKUbhl9w.jpeg"/></div></div></figure><p id="f12c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<strong class="jp ir">tickerviewcontroller . xib</strong>文件。选择左侧<strong class="jp ir">文档轮廓</strong>窗格中的<strong class="jp ir">视图</strong>，然后打开右侧<strong class="jp ir">检查器</strong>窗格中的<strong class="jp ir">属性检查器</strong>。在<strong class="jp ir">模拟度量</strong>部分，将<em class="mp">尺寸</em>更改为<em class="mp">自由形式</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/d93c01f891162971e02330e4fca35e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-z9rTncRITO4WFIoQyGGYQ.jpeg"/></div></div></figure><p id="42cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们设置滚动条的大小，转到右边<strong class="jp ir">检查器</strong>窗格中的<strong class="jp ir">大小检查器</strong>。将视图的宽度设为 414，高度设为 90。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/339f60cdac14c542fb52fcf44b5c81ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkmEXrg9GI8E546biGjfoA.jpeg"/></div></div></figure><p id="0048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">给我们的视图添加一个滚动视图，设置它的宽度为 414，高度为 90。注意<strong class="jp ir">尺寸检查器</strong>中的<strong class="jp ir">自动调整尺寸</strong>部分。我们将让操作系统将我们的自动调整大小遮罩转换为自动布局约束。如果我们自己在滚动视图上设置约束，<em class="mp">界面构建器</em>将显示一个警告<em class="mp">滚动内容大小对于“滚动视图”</em>不明确。因为我们的滚动视图的内容将通过编程来设置，所以模糊性将会保留。使用自动调整大小屏蔽防止错误出现在<em class="mp">界面生成器</em>中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/f79b12c828882decd43a84ef4c2f569e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0IfkE1gF1mywEwcRouazg.jpeg"/></div></div></figure><p id="dd10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在在<strong class="jp ir">tickerviewcontroller . swift</strong>中，为滚动视图创建一个<em class="mp"> IBOutlet </em>并连接它。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0601" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将 TickerViewController.swift 设为滚动视图的代表，我们稍后会用到它。在文件的底部，为<strong class="jp ir">ticker viewcontroller . swift</strong>添加一个扩展名。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="3edf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到<em class="mp">界面构建器</em>中，或者控制从滚动视图拖动到<em class="mp">文件的所有者</em>，或者右键单击滚动视图并将<strong class="jp ir">代理</strong>出口连接到<em class="mp">文件的所有者</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/dba50dcc7e64e37d1300b313985937c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwMq2bZ8_O6RGN0c644YPg.jpeg"/></div></div></figure><p id="6e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们让<code class="fe mq mr ms mt b">tickerViewController</code>在启动时加载笔尖。转到<strong class="jp ir">ticker viewcontroller . swift</strong>并添加以下内容:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ef04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上允许视图控制器加载它的 nib 文件，或者使用<em class="mp">接口生成器</em>或者用代码编程。</p><p id="f6b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行项目将导致一个空视图。为了让我们的 ticker“滴答”作响，首先，我们需要将它作为子视图控制器添加到假设的主视图控制器中，其次，我们需要用数据填充它。</p><p id="c62c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将我们的 ticker 视图控制器作为子视图控制器添加到由项目模板创建的主视图控制器中。转到<strong class="jp ir"> Main.storyboard </strong>应该只有一个<strong class="jp ir">视图控制器场景</strong>，打开<strong class="jp ir">库</strong>并添加一个<strong class="jp ir">容器视图</strong>到视图中。将视图居中，并将其前导和尾随约束固定到其超级视图的前导和尾随约束，将其高度约束设置为 90。打开<em class="mp">对齐</em>约束面板，在容器中水平选择<strong class="jp ir">，在</strong>容器中垂直选择<strong class="jp ir">。</strong></p><p id="0e7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">界面生成器</em>将在<strong class="jp ir">文档轮廓</strong>面板中添加一个新的视图控制器场景。将视图控制器自定义类更改为<code class="fe mq mr ms mt b">TickerViewController</code>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/da21609199e548821662b30f8a89d91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErxCwgYZvybLK4gwNL7alw.jpeg"/></div></div></figure><h1 id="5764" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">数据</h1><p id="0675" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">关于用数据填充它，我希望找到一个免费的开放外汇 API，每秒或每分钟更新它的价格，但失败了。相反，我找到了 openexchangerates.org。他们提供了一个免费的计划，每小时更新一次货币对美元的价格。这将不得不做这个教程。<br/>我们将添加一个简单的服务对象，它从 API 中获取最新的价格，解析并准备数据供我们的 ticker 使用。<br/>创建一个名为<strong class="jp ir">foreservice . swift</strong>的新 swift 文件和一个名为<code class="fe mq mr ms mt b">ForexService</code>的类。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4126" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mq mr ms mt b">appid</code>由<a class="ae kx" href="https://docs.openexchangerates.org/docs/authentication" rel="noopener ugc nofollow" target="_blank">openexchangerates.org</a>提供。这里唯一的公共方法是<code class="fe mq mr ms mt b">latestPrices()</code>。它使用一个<code class="fe mq mr ms mt b">URLSession</code>获取最新价格，将响应传递给一个名为<code class="fe mq mr ms mt b">parse()</code>的函数。从它的名字来看，<code class="fe mq mr ms mt b">parse()</code>解析我们的 json 响应并返回一个<code class="fe mq mr ms mt b">Currency</code>类型的数组，这是我们的数据模型。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c22d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mq mr ms mt b">TickerViewController</code>中添加一个<code class="fe mq mr ms mt b">viewDidLoad()</code>方法，该方法将在视图加载时获取最新价格。这个方法的完成块传入的数据被分配给一个名为<code class="fe mq mr ms mt b">currencies</code>的实例变量。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="3759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当<code class="fe mq mr ms mt b">currencies</code>被设置时，属性的观察者调用<code class="fe mq mr ms mt b">configureCurrencyViews()</code>。openexchangerates.org 的<a class="ae kx" href="http://openexchangerates.org" rel="noopener ugc nofollow" target="_blank">API 返回了超过 170 种货币。出于本教程的目的，我从 countryflags.com 下载了 10 张圆形旗帜图片，并且只展示了有图片的货币。这里是<code class="fe mq mr ms mt b">configureCurrencyViews()</code>。</a></p><blockquote class="mv mw mx"><p id="304f" class="jn jo mp jp b jq jr js jt ju jv jw jx my jz ka kb mz kd ke kf na kh ki kj kk ij bi translated">我们可以尝试找到另一个提供国旗的 API，但是我会把它作为一个练习留给你。</p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="12cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们循环遍历货币，只添加那些有匹配图像的货币。使用自动布局将视图添加到滚动视图中。我们将视图的顶部和底部约束分别固定到滚动视图的顶部和底部，然后根据滚动视图是否已经有货币视图，我们将视图的前导约束固定到滚动视图的前导约束或最后一个视图的尾随约束。</p><p id="3931" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们将添加到滚动视图的尾部约束的最后一个视图的尾部约束固定。因此，我们创建了一个连续的约束线，连接滚动视图的前导和尾随，允许滚动视图计算其内容大小并启用滚动。</p><p id="7626" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果所有货币视图的总宽度超过了滚动视图的宽度，我们就激活滚动视图。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="caa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了动画化滚动视图，我们设置了一个<code class="fe mq mr ms mt b">CADisplayLink</code>计时器，它调用一个叫做<code class="fe mq mr ms mt b">update()</code>的方法。所有<code class="fe mq mr ms mt b">update()</code>做的就是增加滚动视图的内容偏移量。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4271" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，上面的内容不会让滚动视图在货币间循环！之前我们将<code class="fe mq mr ms mt b">tickerViewController</code>设置为滚动视图的代表。只有当我们实现了委托方法<code class="fe mq mr ms mt b">func scrollViewDidScroll(_:)</code>时，委托才会在滚动视图已经滚动时通知我们。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="218b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不知道滚动的方向，为了找出原因，我们存储了最后的水平内容偏移位置，并将其与当前的水平内容偏移进行比较，并相应地重新排列视图。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a96d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的方法中，如果最左边的视图已经滚出屏幕，我们将其从滚动视图中移除，并更新新的最左边视图的约束，然后我们将移除的视图添加到滚动视图的末尾，并相应地更新其约束。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7ba0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，如果用户向右拖动，最后一个视图已经滚动到屏幕之外，我们从滚动视图中删除它，并更新位于它之前的视图的约束。然后，我们将删除的视图添加到滚动视图的开头，并向其添加新的约束。</p><p id="aa19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应该能够与滚动视图进行交互，所以当用户开始在滚动视图上拖动时，我们将停止计时器，一旦拖动停止，我们将重新启动计时器。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6d01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以很容易地改变<code class="fe mq mr ms mt b">tickerViewController</code>的用途，这样它就可以通过使用协议而不是像<code class="fe mq mr ms mt b">currencyView</code>这样的具体类型来显示任何类型的内容。我亲爱的读者，我将把它作为你的一篇摘抄。</p><p id="740c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，你可以从<a class="ae kx" href="https://github.com/h4yder/ExchangeRateTicker" rel="noopener ugc nofollow" target="_blank"> github </a>下载代码。</p><p id="6ef1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你身上看到<a class="ae kx" href="https://medium.com/@hayder_41070/making-an-accessible-exchange-rate-ticker-1645a9671ece" rel="noopener">第 2 部分</a>我们将使我们的 ticker 可访问。</p></div></div>    
</body>
</html>