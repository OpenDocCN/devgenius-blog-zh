<html>
<head>
<title>Incident Bot on Azure Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 函数上的事件 Bot</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/incident-bot-on-azure-functions-ed20da8af478?source=collection_archive---------7-----------------------#2021-12-29">https://blog.devgenius.io/incident-bot-on-azure-functions-ed20da8af478?source=collection_archive---------7-----------------------#2021-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6af2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博客是我们从零开始讨论<strong class="jm io"> DevOps </strong>概念的系列文章的一部分，面向的是入门知识有限的读者。这篇文章属于<em class="ki">中级</em>系列，因为它涉及到理解无服务器应用程序的工作原理，也就是<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Azure 函数</strong> </a>。</p><p id="c4f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">云系列中的一些早期博客如下。</p><p id="f350" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kj" href="https://awstip.com/aws-lambda-simple-tweetbot-2f2f83fbe161" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">TweetBot</strong></a><strong class="jm io"><br/></strong><a class="ae kj" href="https://towardsdev.com/deploying-on-azure-functions-github-actions-a8f2a98acc0f" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">Azure Functions-GitHub Actions</strong></a><strong class="jm io"><br/></strong><a class="ae kj" rel="noopener ugc nofollow" target="_blank" href="/nodejs-nginx-on-azure-vm-cf23d05a9b9b"><strong class="jm io">NodeJs+Nginx</strong></a></p><h1 id="3b10" class="kk kl in bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">什么是 Azure 函数？</h1><p id="e11c" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">Functions 是 Azure 的旗舰产品，是 FAAS(功能即服务)/无服务器类别的一部分，应用团队不必考虑管理基础设施的额外复杂性。一般用于部署 Python、Java、C#等语言的无状态微服务；功能有三种方案——<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-functions/consumption-plan" rel="noopener ugc nofollow" target="_blank">消费</a>、<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-premium-plan?tabs=portal" rel="noopener ugc nofollow" target="_blank">溢价</a>和<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-functions/dedicated-plan" rel="noopener ugc nofollow" target="_blank">专用</a>方案。可以根据工作负载的类型(开发、阶段和生产)来使用这些计划。消耗是随使用付费的模式，建议用于运行概念验证和实验。</p><h1 id="af55" class="kk kl in bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">自动化事件管理</h1><p id="cf43" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">对于运行任何大规模操作，端到端事故管理系统应具备这三个关键要素- <em class="ki">监控、检测、警报</em>而无需任何人工参与。自动化系统的性质应该独立于在<em class="ki">业务、系统和应用</em>异常之间收集的指标。理想情况下，将警报源与通知系统(如<a class="ae kj" href="https://www.pagerduty.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ki">【传呼机职责】</em></a><em class="ki"/><a class="ae kj" href="https://www.servicenow.com/" rel="noopener ugc nofollow" target="_blank"><em class="ki">service now</em></a><em class="ki"/><a class="ae kj" href="https://www.atlassian.com/software/jira" rel="noopener ugc nofollow" target="_blank"><em class="ki">【JIRA</em></a><em class="ki"/>)连接起来的指挥者对于生产中的规模化运营至关重要。此外，该系统应满足-减少噪音，驾驶行为和改善端到端<a class="ae kj" href="https://www.sentinelone.com/blog/mttd-mean-time-to-detect-detailed-explanation/#:~:text=Mean%20time%20to%20detect%20(MTTD,about%20a%20problem%2C%20the%20better." rel="noopener ugc nofollow" target="_blank"> MTTD </a>和<a class="ae kj" href="https://www.fiixsoftware.com/mean-time-to-repair-maintenance/" rel="noopener ugc nofollow" target="_blank"> MTTR </a>指标。</p><p id="049e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的例子是 orchestrator 使用<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/action-groups" rel="noopener ugc nofollow" target="_blank">Azure Monitor Action Groups</a>和<a class="ae kj" href="https://azure.microsoft.com/en-in/services/functions/" rel="noopener ugc nofollow" target="_blank"> Azure Functions </a>将 Azure Alerts 与 JIRA 连接起来的一个用例。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/11f966360c6bc712acf6ac9716f4597f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5E52HW4T1JIHSNgEkLtug.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd km">事故管理工作流程</strong></figcaption></figure><h2 id="a3c7" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">创建功能应用程序</h2><p id="bc27" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">Azure Function 应用程序可以从以下任一选项创建-</p><p id="edd1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">I)从 Azure 门户-<a class="ae kj" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-function-app-portal" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/Azure-functions/functions-create-function-app-Portal</a></p><p id="afdb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ii)从通用 Terraform 模块-<a class="ae kj" href="https://github.com/innovationnorway/terraform-azurerm-function-app" rel="noopener ugc nofollow" target="_blank">https://github . com/innovation Norway/terra form-azurem-function-app</a>。</p><p id="2638" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦创建了 Function-app，以下资源将会出现在 Azure 门户中。调试和日志记录需要应用洞察资源。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mp"><img src="../Images/57724807d1ee0d4ab6ed451b3452f127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnWlDnDjlKPTeM4eWN5xZA.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd km"> Azure 功能-资源</strong></figcaption></figure><h2 id="a728" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">创建 Java 模块</h2><p id="23fa" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">为了创建一个 Java 模块，我们需要将整个事故管理功能分成三个部分</p><p id="b01e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">i) <strong class="jm io"> HTTP 触发器类- </strong>当实际的 web 钩子被触发时被调用的类。</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="e306" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ii) <strong class="jm io"> JIRA 服务类别— </strong>服务类别，负责向 JIRA 提供商认证和创建问题。</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8519" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">iii) <strong class="jm io"> JIRA 模型— </strong>维护创建<em class="ki"> JIRA 任务/问题/史诗</em> <strong class="jm io">所需数据元素的模型类。</strong></p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h2 id="ad89" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">部署 Azure 功能</h2><p id="d5b9" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">以下中型博客可用于使用 GitHub 操作将代码部署到 Azure 函数。</p><div class="ms mt gp gr mu mv"><a href="https://towardsdev.com/deploying-on-azure-functions-github-actions-a8f2a98acc0f" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd io gy z fp na fr fs nb fu fw im bi translated">在 Azure 功能上部署- GitHub 操作</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">本博客是我们从零开始讨论 DevOps 概念的系列文章的一部分，面向的读者有限…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdev.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj lx mv"/></div></div></a></div><p id="9df1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">发布 Azure 函数部署后，可以通过对给定端点使用 GET 操作来触发端点-<a class="ae kj" href="https://medium-blog.azurewebsites.net/api/IncidentBot" rel="noopener ugc nofollow" target="_blank"><em class="ki"/></a><em class="ki">。</em>此端点将创建 JIRA 事件/任务。</p><h2 id="39b0" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">创建 Azure Monitor 操作组</h2><p id="6bcb" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">I)点击 Azure 门户上的 Monitor，并从中选择操作组。</p><p id="93ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ii)创建一个新的操作组(jira-incident bot ),并将上面的 webhook url 添加为通知系统。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nk"><img src="../Images/bae4e31f2c2eb660db1a532a2e3f530e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c88SD8W5pDhgeXFRaTvrbQ.png"/></div></div></figure><h2 id="ba84" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">创建警报规则</h2><p id="2ee9" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">I)在给定资源的左侧导航选项卡上，单击<strong class="jm io">警报</strong>并从那里<strong class="jm io">创建警报规则</strong>。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nl"><img src="../Images/f77674ac8e88a14fed6efab88623c657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iI0AVSse7yqs_gYkwkVulQ.png"/></div></div></figure><p id="aefb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ii)选择<strong class="jm io">警报指标、警报频率</strong>和正常警报创建所需的其他指标。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nk"><img src="../Images/722a2ebbc695d44133dd0d860daba8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdlhTdX_ICnBH-Pr9XCSQA.png"/></div></div></figure><p id="53d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">iii)选择如上创建的<strong class="jm io">动作组</strong>，以便下次触发警报时，触发功能应用程序上的 web-hook。</p><h2 id="c3bb" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">结束 2 结束测试</h2><p id="ee8c" class="pw-post-body-paragraph jk jl in jm b jn li jp jq jr lj jt ju jv lk jx jy jz ll kb kc kd lm kf kg kh ig bi translated">I)点击 Azure VM 上的一个端点，这导致 404 消息。<br/> ii)警报状态变为“已触发”,如下所示</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nm"><img src="../Images/9bdd802686e383cf7f583d49d7008567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nc3T5Xo1J64MWS7Lp2j4ZA.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd km">天蓝色警报状态改变</strong></figcaption></figure><p id="a3c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建 JIRA 板上的以下问题，并将其分配给待命人员。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nn"><img src="../Images/ca7803d23b810850f385fa0f49648ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iNKZBBF_2F-YuMRg2xc0A.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd km"> JIRA 给待命人员的任务</strong></figcaption></figure><h2 id="c5b0" class="md kl in bd km me mf dn kq mg mh dp ku jv mi mj ky jz mk ml lc kd mm mn lg mo bi translated">额外资源</h2><div class="ms mt gp gr mu mv"><a href="https://github.com/amit894/azure-function-incidentbot" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd io gy z fp na fr fs nb fu fw im bi translated">GitHub—Amit 894/Azure-function-Incident bot:Azure 函数上 Java 中的事件 Bot</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="no l ng nh ni ne nj lx mv"/></div></div></a></div><p id="9284" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如需反馈，请留言至<strong class="jm io"><em class="ki">Amit[dot]894[at]Gmail[dot]com</em></strong><em class="ki">或联系</em><a class="ae kj" href="https://about.me/amit_raj" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://about.me/amit_raj</em></a><em class="ki">的任何链接。</em></p></div></div>    
</body>
</html>