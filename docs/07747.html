<html>
<head>
<title>Asyncio 101 | Writing Asynchronous Python Programs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Asyncio 101 |编写异步 Python 程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/asyncio-101-writing-asynchronous-python-programs-61b732ca77b1?source=collection_archive---------5-----------------------#2022-04-20">https://blog.devgenius.io/asyncio-101-writing-asynchronous-python-programs-61b732ca77b1?source=collection_archive---------5-----------------------#2022-04-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4171" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">异步代码是目前的一个大话题。这是一个相当宽泛的术语，有时可能意味着并发性、并行性，或者两者兼而有之。</p><blockquote class="ki kj kk"><p id="a7c5" class="jk jl kl jm b jn jo jp jq jr js jt ju km jw jx jy kn ka kb kc ko ke kf kg kh ig bi translated">关于并发性和并行性区别的详细讨论，请查看<a class="ae kp" href="https://stackoverflow.com/questions/4844637/what-is-the-difference-between-concurrency-parallelism-and-asynchronous-methods#:~:text=Concurrency%20is%20having%20two%20tasks,on%20the%20same%201%20thread" rel="noopener ugc nofollow" target="_blank">这个 StackOverflow 线程</a>。</p></blockquote><p id="fb22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">出于本教程的目的，我们可以将异步代码看作是可以被分割成可以由计算机同时执行的逻辑片段/组件的代码。当一个任务暂停时(可能是在等待网络数据包)，另一个任务就开始了。他们重复这个过程，直到生命周期结束。它允许我们有效地使用系统资源，同时减少执行时间。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><p id="3157" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">传统上，大多数 Python 代码是同步的，这意味着代码是按顺序执行的。计算机将开始一项任务，并等待该任务完成，然后再执行下一个命令。一个简单的例子:</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="69e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这段代码的总执行时间应该约为 6 秒。计算机顺序或同步执行每项任务。</p><p id="48f3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么如何用 Python 实现异步代码呢？好问题。输入<code class="fe le lf lg lh b">asyncio</code>，添加到 Python 3.4 中的标准库中。<br/>在过去，你必须使用<code class="fe le lf lg lh b">yield from</code>和一个生成器来创建协程。但是<code class="fe le lf lg lh b">asyncio</code>引入了<code class="fe le lf lg lh b">async/await</code>语法。它允许你做一些事情，比如:</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lc ld l"/></div></figure></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><p id="8339" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太好了！时间缩短了 50%！好了，让我们来看看这段代码是做什么的。</p><p id="8292" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们首先从标准库中导入<code class="fe le lf lg lh b">asyncio</code>和<code class="fe le lf lg lh b">timer</code>。<code class="fe le lf lg lh b">asyncio</code>让我们在高层次上管理事件循环和协程，<code class="fe le lf lg lh b">timer</code>让我们监控执行时间。</p><p id="b189" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，如果你使用的是 Windows，你会想要告诉<code class="fe le lf lg lh b">asyncio</code>，这样它可以修改它的行为，否则你会得到<code class="fe le lf lg lh b">.Runtime Error: Event loop is closed</code>。</p><p id="8a94" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe le lf lg lh b">wait_for_some_time </code>是我们第一个异步函数。目前它没有做什么大的事情，但是 s <em class="kl">休眠</em>一会儿，并输出一条很好的消息。<br/> <code class="fe le lf lg lh b">main</code>保存了整个程序流程，在这里你可以看到你通常会在<code class="fe le lf lg lh b">if __name__=="__main__"</code>块中看到的东西。我们实例化新的协程，并将它们传递给<code class="fe le lf lg lh b">asyncio.gather</code>。<br/>请注意，我们用<code class="fe le lf lg lh b">async</code>标记了两个异步函数，因此 Python 知道它们是协程，而不是标准函数。</p><p id="c0d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe le lf lg lh b">asyncio.gather</code>在自己的<em class="kl">线程</em>中启动每个任务，然后等待所有任务完成。所以这里我们用它来分组任务并运行它们。我们还可以做更多的事情，快速浏览一下官方文档会有所帮助。</p><p id="8025" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe le lf lg lh b">asyncio.run</code>是 Python 中与异步程序交互的高级函数。它通常充当主程序循环的入口点。</p><p id="5ea4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我的下一篇文章中，我将展示如何用 Python 创建异步 web 请求来加速网络操作。我们还将创建很酷的个人资料图片🙂。</p><p id="fb38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更多资源:</p><div class="li lj gp gr lk ll"><a href="https://docs.python.org/3/library/asyncio.html" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">asyncio -异步 I/O - Python 3.10.4 文档</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">asyncio 是一个使用 async/await 语法编写并发代码的库。asyncio 被用作…的基础</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">docs.python.org</p></div></div></div></a></div><div class="li lj gp gr lk ll"><a href="https://medium.com/velotio-perspectives/an-introduction-to-asynchronous-programming-in-python-af0189a88bbb" rel="noopener follow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">Python 异步编程简介</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">介绍</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">到 Python Introductionmedium.com 中的异步编程</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz ma ll"/></div></div></a></div><p id="1734" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您对异步如何影响执行时间和伸缩性有疑问或想法，请回复这篇文章。</p><p id="98bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">离别迷因😎</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/2bc0310537b2110ddb3f25e0667be604.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*dZBikGD1DDmrqTbhI_qvUw.jpeg"/></div></figure></div></div>    
</body>
</html>