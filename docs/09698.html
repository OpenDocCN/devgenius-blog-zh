<html>
<head>
<title>How to use Google cloud vision API safe search detection to detect explicit content on image uploads in Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Google cloud vision API 安全搜索检测来检测 Laravel 中图片上传上的露骨内容</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-google-cloud-vision-api-safe-search-detection-to-detect-explicit-content-on-image-ad2f3fb49122?source=collection_archive---------20-----------------------#2022-09-05">https://blog.devgenius.io/how-to-use-google-cloud-vision-api-safe-search-detection-to-detect-explicit-content-on-image-ad2f3fb49122?source=collection_archive---------20-----------------------#2022-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/dbb9834a5d13a35c5b16902b525a3c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0sPjfmdKsIMmIPJUpj0EA.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">拉勒维尔的谷歌云愿景</figcaption></figure><div class=""/><p id="2864" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我们将了解如何使用<a class="ae kx" href="https://cloud.google.com/vision" rel="noopener ugc nofollow" target="_blank"> Google cloud vision API </a>来检测明确的内容，并避免 Laravel 应用程序中不必要的图片上传。</p><p id="1d90" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">视觉 AI </strong></p><p id="d09b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">利用 AutoML 视觉从图像中获得洞察力。通过预先训练的视觉 API 模型检测情绪和理解文本。</p><p id="fecb" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">新客户可以获得 300 美元的免费积分，用于购买 Vision AI。所有客户每月免费获得 1000 单位的图像分析费，不从您的点数中扣除。</p><ul class=""><li id="9311" class="ky kz jc kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">使用机器学习来理解您的图像，具有行业领先的预测准确性</li><li id="ba1e" class="ky kz jc kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">使用 AutoML Vision 训练机器学习模型，根据您的自定义标签对图像进行分类</li><li id="9e9a" class="ky kz jc kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">使用 Vision AP 检测物体和人脸、读取笔迹并构建有价值的图像元数据</li></ul><p id="440d" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Vision API 通过 REST 和 RPC APIs 提供强大的预训练机器学习模型。为图像分配标签，并快速将它们分类到数百万个预定义的类别中。检测物体和人脸，阅读印刷和手写文本，并将有价值的元数据构建到您的图像目录中。</p><p id="eec8" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">更多信息请访问<a class="ae kx" href="https://cloud.google.com/vision/docs" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd">视觉 API 文档</strong> </a></p><p id="983b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意:这可能适用于任何编程语言或框架。</p><p id="8075" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个 laravel 项目被命名为<strong class="kb jd">Google _ Cloud _ Vision _ features _ in _ laravel</strong>，以便对将要演示的 Google Cloud Vision API 的不同特性进行渐进式文档化。</p><p id="6f96" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了保持这篇文章的简短，我们将使用这篇<a class="ae kx" href="https://alemsbaja.hashnode.dev/how-to-upload-files-to-google-cloud-storage-from-a-laravel-application" rel="noopener ugc nofollow" target="_blank">文章</a>中的这个<a class="ae kx" href="https://github.com/RaphAlemoh/laravel_upload_using_google_cloud_storage" rel="noopener ugc nofollow" target="_blank">项目</a>来对图像应用安全搜索检测。</p><p id="d726" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们将在这篇文章中使用 Laravel Fortify 和 Bootstrap 4<a class="ae kx" href="https://alemsbaja.hashnode.dev/complete-laravel-8-authentication-using-laravel-fortify-and-bootstrap-4-part-1" rel="noopener ugc nofollow" target="_blank">完成 Laravel 8 认证，以设置应用认证。</a></p><p id="1a39" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于本教程，我们将停留在文章的登录和注册部分。</p><p id="2d19" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你使用的是 Laravel 9.19，默认的搭建是 Vite 自带的。下面是如何<a class="ae kx" href="https://github.com/laravel/vite-plugin/blob/main/UPGRADE.md#migrating-from-vite-to-laravel-mix" rel="noopener ugc nofollow" target="_blank">迁移</a></p><p id="ef1a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意:我们将在后续教程中使用这个项目</p><blockquote class="lm ln lo"><p id="e0dd" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">接下来，在谷歌控制台中创建一个新项目</em></p></blockquote><p id="07ec" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">点击新建项目按钮</strong></p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lt"><img src="../Images/4dce87a46dd78686580943a7865f76db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bLgjpUGbCw9Z35Vs"/></div></div></figure><blockquote class="lm ln lo"><p id="3896" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">接下来输入项目的首选细节</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ly"><img src="../Images/b81f4362aa3a2ff3876db660e1952fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MsWSRHD9yMTvMH6K"/></div></div></figure><blockquote class="lm ln lo"><p id="b56a" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">创建项目后，详细信息显示在仪表板上</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lz"><img src="../Images/565bc5a301273e08053a1bb0ef71e399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qzhCkRdudrmFCrBf"/></div></div></figure><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="7672" class="mf mg jc mb b gy mh mi l mj mk">Project name<br/>laravel-cloud-xxxx</span><span id="b75c" class="mf mg jc mb b gy ml mi l mj mk">Project number<br/>15331649xxx</span><span id="7685" class="mf mg jc mb b gy ml mi l mj mk">Project ID<br/>laravel-cloud-xxxx</span></pre><blockquote class="lm ln lo"><p id="29e0" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">接下来，为这个项目创建一个服务帐户，以获取凭证的 json 文件</em></p></blockquote><p id="89f1" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">单击导航并将鼠标悬停在 IAM $ Admin 上，然后单击服务帐户</p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/9a5b7b687fc211d7b3958bb31abd5d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/0*T8kbhTUcoDLkRWys"/></div></figure><blockquote class="lm ln lo"><p id="755f" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">点击创建服务帐户，为创建的项目添加一个服务帐户</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mn"><img src="../Images/935ba1e13a1cedd97ee7a1d896cf3276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iNknri0X-lzFuOnn"/></div></div></figure><blockquote class="lm ln lo"><p id="56ab" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">填写服务账户详情</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mo"><img src="../Images/67eafc00f0597eb2a0a42e9097113b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ikrSX3fsTXwUkMgK"/></div></div></figure><p id="57f6" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">点击<strong class="kb jd">创建并继续</strong></p><blockquote class="lm ln lo"><p id="bf5c" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><strong class="kb jd"> <em class="jc">授予此服务帐户对项目</em> </strong> <em class="jc">的访问权限是可选的，我们可以稍后更新。</em></p></blockquote><p id="165f" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">单击继续</p><blockquote class="lm ln lo"><p id="adc1" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">点击完成</em></p></blockquote><p id="36ad" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你会在这里下来的..</p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mp"><img src="../Images/9b33ed7c1c14c5800e14e8f8b20519e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L-LdO6fYqWNk5o_-"/></div></div></figure><blockquote class="lm ln lo"><p id="88fb" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">接下来，单击创建的服务，并转到 keys 选项卡部分，访问包含该项目的配置的 json 文件。</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mq"><img src="../Images/7c06ac518b4ad74ff8a24c15b24945a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s4CtNNUYa0jdlSTq"/></div></div></figure><p id="444b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">点击新建</strong></p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mr"><img src="../Images/e61325a74aaefa5253fbb99a1c93a279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SN_n-cvELyfaNTX4"/></div></div></figure><blockquote class="lm ln lo"><p id="aa4d" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated">然后点击创建，它会自动将 JSON 文件下载到你的电脑上。</p></blockquote><p id="fa1a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">NB；有一个不要暴露 json 文件的警告。</p><p id="b9a4" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">请对这个 JSON 文件或凭证保密，否则 git 会忽略该文件，不让它进入版本控制系统</p><p id="509a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">将 JSON 文件保存在 Laravel 的 config 文件夹中。</p><p id="73a7" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">我们还可以使用 env 变量来创建 JSON 文件的内容，并将其传递到数组中。</strong></p><blockquote class="lm ln lo"><p id="da1a" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">接下来，让我们转到谷歌云视觉 API 集成</em></p></blockquote><p id="830c" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">转到控制台</strong></p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ms"><img src="../Images/e9e0a3e91f0e6016dad3cfe241ade01a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Al4L0o6ZZn0KejQm"/></div></div></figure><p id="eb8a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">控制台视图</strong></p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mt"><img src="../Images/1821a18b890efc31183ba4798fbf21a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7aZwQKjx843m7ZVY"/></div></div></figure><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mt"><img src="../Images/4618d4c515d7d989996e54d855607822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VbE5UqXUtEeW_pXG"/></div></div></figure><p id="e174" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意<strong class="kb jd">如果你已经用完了免费试用</strong>，你需要启用计费来使用这个 API</p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mu"><img src="../Images/e60e82dbca1df38130ac069958af7a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Sod5nOkOKIHNiVg"/></div></div></figure><blockquote class="lm ln lo"><p id="1ccd" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">在控制台中搜索云视觉以启用它</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mv"><img src="../Images/c574449fa1d95e3c38c4647e202fe1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L0GYHLHyXqIoKMVB"/></div></div></figure><blockquote class="lm ln lo"><p id="4720" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">启用后，下面的屏幕显示了 API </em>的用法</p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mw"><img src="../Images/bcd46c110513c2116ec4744464044bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yoAQd7NVkMhU_0IE"/></div></div></figure><p id="9cfd" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">cloud vision API 的完整文档可从<a class="ae kx" href="https://cloud.google.com/vision/docs/" rel="noopener ugc nofollow" target="_blank">这里</a>获得</p><blockquote class="lm ln lo"><p id="bb3c" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">让我们将云视觉软件包集成到我们的 laravel 应用程序中，开始演示云视觉的功能。</em> <a class="ae kx" href="https://packagist.org/packages/google/cloud-vision" rel="noopener ugc nofollow" target="_blank"> <em class="jc">云视觉 PHP 客户端</em> </a></p></blockquote><p id="e9b5" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意<strong class="kb jd"> Google cloud vision 现在使用 v1/Annotator，建议继续使用它，因为旧版本很快就会过时</strong></p><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="9dbd" class="mf mg jc mb b gy mh mi l mj mk">composer require google/cloud-vision</span></pre><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mx"><img src="../Images/3fe6da70eb31d8f3802056dc82e16006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rf1u-bKdQbEMI1Nq"/></div></div></figure><p id="f49c" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">或者一次性安装整套组件:</p><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="98c3" class="mf mg jc mb b gy mh mi l mj mk">composer require google/cloud</span></pre><p id="3729" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb jd">随后要介绍的功能将从这一点开始，因为上面的细节都是一样的。</strong></p><blockquote class="lm ln lo"><p id="d0a0" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">在本教程中，我们将介绍</em> <a class="ae kx" href="https://cloud.google.com/vision/docs/reference/rpc/google.cloud.vision.v1#safesearchannotation" rel="noopener ugc nofollow" target="_blank"> <em class="jc">检测安全搜索</em> </a></p><p id="2614" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><strong class="kb jd"> <em class="jc">安全搜索注释</em> </strong></p></blockquote><p id="f603" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">与图像相关的一组特征，由计算机视觉方法通过安全搜索垂直领域(例如，成人、欺骗、医疗、暴力)计算得出。</p><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi my"><img src="../Images/4e885e9f041ee851372689e749a47b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7YYtXYc8OBMI4Yb4"/></div></div></figure><p id="2217" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里有一个<a class="ae kx" href="https://github.com/GoogleCloudPlatform/php-docs-samples/blob/master/vision/src/detect_safe_search.php" rel="noopener ugc nofollow" target="_blank">存储库</a>及其集成的例子</p><p id="6195" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">每个批注方法的响应可以是下面数组中的任何一个值。</p><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="a833" class="mf mg jc mb b gy mh mi l mj mk">$likelihoodNames = [<br/>            'UNKNOWN', 'VERY_UNLIKELY', 'UNLIKELY',<br/>            'POSSIBLE', 'LIKELY', 'VERY_LIKELY'<br/>        ];</span></pre><blockquote class="lm ln lo"><p id="487e" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">让我们回到我们的 Laravel 代码库… </em></p></blockquote><ul class=""><li id="d081" class="ky kz jc kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">创建一个上传图像的基本表单</li></ul><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="debe" class="mf mg jc mb b gy mh mi l mj mk">&lt;form class="mx-1 mx-md-4" method="POST" action="{{ route('uploads.store') }}" enctype="multipart/form-data"&gt;</span><span id="2f08" class="mf mg jc mb b gy ml mi l mj mk"><a class="ae kx" href="http://twitter.com/csrf" rel="noopener ugc nofollow" target="_blank">@csrf</a></span><span id="9469" class="mf mg jc mb b gy ml mi l mj mk">&lt;div class="d-flex flex-row align-items-center mb-4"&gt;<br/>                                        &lt;i class="fas fa-camera fa-lg me-3 fa-fw"&gt;&lt;/i&gt;<br/>                                        &lt;div class="form-outline flex-fill mb-0"&gt;<br/>                                            &lt;label class="form-label" for="form3Example3c"&gt;Profile picture&lt;/label&gt;<br/>                                            &lt;input type="file" id="form3Example3c" class="form-control <a class="ae kx" href="http://twitter.com/error" rel="noopener ugc nofollow" target="_blank">@error</a>('avatar') is-invalid <a class="ae kx" href="http://twitter.com/enderror" rel="noopener ugc nofollow" target="_blank">@enderror</a>" name="avatar" value="{{ old('avatar') }}" accept="image/*" required /&gt;</span><span id="a266" class="mf mg jc mb b gy ml mi l mj mk"><a class="ae kx" href="http://twitter.com/error" rel="noopener ugc nofollow" target="_blank">@error</a>('avatar')<br/>                                            &lt;span class="invalid-feedback" role="alert"&gt;<br/>                                                &lt;strong&gt;{{ $message }}&lt;/strong&gt;<br/>                                            &lt;/span&gt;<br/>                                            <a class="ae kx" href="http://twitter.com/enderror" rel="noopener ugc nofollow" target="_blank">@enderror</a><br/>                                        &lt;/div&gt;<br/>                                    &lt;/div&gt;</span><span id="337e" class="mf mg jc mb b gy ml mi l mj mk">&lt;div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4"&gt;<br/>                                        &lt;button type="submit" class="btn btn-primary btn-lg"&gt;Update Profile Pic&lt;/button&gt;<br/>                                    &lt;/div&gt;</span><span id="3dd9" class="mf mg jc mb b gy ml mi l mj mk">&lt;/form&gt;</span></pre><blockquote class="lm ln lo"><p id="bfbb" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">导入 V1 图像注释器客户端</em></p></blockquote><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="bfd3" class="mf mg jc mb b gy mh mi l mj mk">use Google\Cloud\Vision\V1\ImageAnnotatorClient;</span></pre><blockquote class="lm ln lo"><p id="feb2" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">upload controller 类有两个方法用于显示表单和处理上传的图像</em></p></blockquote><pre class="lu lv lw lx gt ma mb mc md aw me bi"><span id="efbd" class="mf mg jc mb b gy mh mi l mj mk">public function store(Request $request)<br/>    {<br/>        $request-&gt;validate([<br/>            'avatar' =&gt; 'required|image|max:10240',<br/>        ]);</span><span id="5019" class="mf mg jc mb b gy ml mi l mj mk">try {</span><span id="d59c" class="mf mg jc mb b gy ml mi l mj mk">// we can make the code neater by using a global helper function or a trait</span><span id="e60c" class="mf mg jc mb b gy ml mi l mj mk">$imageAnnotatorClient = new ImageAnnotatorClient([<br/>                //we can also keep the details of the google cloud json file in an env and read it as an object here<br/>                'credentials' =&gt; config_path('laravel-cloud-features.json')<br/>            ]);</span><span id="0e5d" class="mf mg jc mb b gy ml mi l mj mk">$image_path = $request-&gt;file("avatar");<br/>            //get the content of the image<br/>            $imageContent = file_get_contents($image_path);</span><span id="6d2c" class="mf mg jc mb b gy ml mi l mj mk">//run the safe search detection on the image<br/>            $response = $imageAnnotatorClient-&gt;safeSearchDetection($imageContent);</span><span id="b23b" class="mf mg jc mb b gy ml mi l mj mk">if ($error = $response-&gt;getError()) {<br/>                // returns error from annotator client<br/>                return redirect()-&gt;back()<br/>                -&gt;with('danger', $error-&gt;getMessage());<br/>            }</span><span id="aa5a" class="mf mg jc mb b gy ml mi l mj mk">//get the annotation of the response<br/>            $safe = $response-&gt;getSafeSearchAnnotation();</span><span id="4908" class="mf mg jc mb b gy ml mi l mj mk">$likelihood_status =  0;</span><span id="c963" class="mf mg jc mb b gy ml mi l mj mk">//the values in the array of the response are indexed from 0-5</span><span id="938b" class="mf mg jc mb b gy ml mi l mj mk">$likelihood_status = ($safe-&gt;getAdult() &gt;= 3) ? 1 : 0;<br/>            $likelihood_status = ($safe-&gt;getSpoof() &gt;= 3) ? 1 : 0;<br/>            $likelihood_status = ($safe-&gt;getViolence() &gt;= 3) ? 1 : 0;<br/>            $likelihood_status = ($safe-&gt;getRacy() &gt;= 3) ? 1 : 0;</span><span id="93f5" class="mf mg jc mb b gy ml mi l mj mk">if ($likelihood_status === 1) {<br/>                //the image has some unwanted content there in<br/>                return redirect()-&gt;back()<br/>                -&gt;with('danger', 'This image is not allowed on this platform!!!');<br/>            }</span><span id="d620" class="mf mg jc mb b gy ml mi l mj mk">//close the annotation client<br/>            $imageAnnotatorClient-&gt;close();</span><span id="5c36" class="mf mg jc mb b gy ml mi l mj mk">//return home with a success message<br/>            return redirect()-&gt;route('home')<br/>                -&gt;with('success', 'Uploaded successfully!!!');</span><span id="5bc0" class="mf mg jc mb b gy ml mi l mj mk">} catch (Exception $e) {<br/>            return $e-&gt;getMessage();<br/>        }<br/>    }</span></pre><blockquote class="lm ln lo"><p id="3249" class="jz ka lp kb b kc kd ke kf kg kh ki kj lq kl km kn lr kp kq kr ls kt ku kv kw ig bi translated"><em class="jc">有一个部分用于查看向云视觉 API 端点发出的请求</em></p></blockquote><figure class="lu lv lw lx gt ip gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/514942d2d274ce5cc29d017d607db698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/0*rGWkLVIOmy-0zA6Y"/></div></figure><p id="e115" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下面是教程<a class="ae kx" href="https://github.com/RaphAlemoh/google_cloud_vision_features" rel="noopener ugc nofollow" target="_blank">资源库</a></p><p id="cae0" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢您阅读本文！！！。</p><p id="e06b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你觉得这篇文章有帮助，请分享给你的网络，并随时使用评论区的问题，答案和贡献。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="e73f" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="lp">原载于</em><a class="ae kx" href="https://alemsbaja.hashnode.dev/how-to-use-google-cloud-vision-api-safe-search-detection-to-detect-explicit-content-on-image-uploads-in-laravel" rel="noopener ugc nofollow" target="_blank"><em class="lp">https://alemsbaja . hashnode . dev</em></a><em class="lp">。</em></p></div></div>    
</body>
</html>