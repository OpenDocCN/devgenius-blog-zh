<html>
<head>
<title>How to use Firebase UI to control data flow after signing in successfully(redirect or stay?)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">登录成功后如何使用Firebase UI控制数据流(重定向还是停留？)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-firebase-ui-to-control-data-flow-after-signing-in-successfully-redirect-or-stay-10ff238cef70?source=collection_archive---------5-----------------------#2020-08-16">https://blog.devgenius.io/how-to-use-firebase-ui-to-control-data-flow-after-signing-in-successfully-redirect-or-stay-10ff238cef70?source=collection_archive---------5-----------------------#2020-08-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/2f00cfcd971d76b0f9d9735517d84dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*Ed1-ZFk9zKbmvLIsyDf3lg.png"/></div></figure><p id="9b26" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">要构建用户认证系统，Firebase UI是一个出色的工具！一旦你正确地安装和配置了它(在你的代码和Firebase控制台中)，你会得到11个漂亮的工作用户界面来自动登录，对于GCP(Google云平台)用户，你甚至会有两种方法来启用SAML和OIDC提供者。</p><h1 id="378f" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">安装和配置</h1><p id="f87c" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">启动并不太难，你可以按照<a class="ae ls" href="https://github.com/firebase/firebaseui-web#installation" rel="noopener ugc nofollow" target="_blank">文档</a>进行安装，在Firebase控制台中启用特定的提供者并进行配置。由于我将它用于我的Gatsby(这是一个用React编写的框架)应用程序，我也使用这个<a class="ae ls" href="https://github.com/firebase/firebaseui-web-react#firebaseui-react-components" rel="noopener ugc nofollow" target="_blank">文档</a>在React中进行设置。</p><p id="684f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">有两个组件可以使用FirebaseUI : <code class="fe lt lu lv lw b">FirebaseAuth</code>和<code class="fe lt lu lv lw b">StyledFirebaseAuth</code>。文档中对此差异进行了说明:</p><blockquote class="lx ly lz"><p id="c8e4" class="jr js ma jt b ju jv jw jx jy jz ka kb mb kd ke kf mc kh ki kj md kl km kn ko ig bi translated"><code class="fe lt lu lv lw b">FirebaseAuth</code>有一个对FirebaseUI CSS文件的引用(它<code class="fe lt lu lv lw b">requires</code>CSS)。</p><p id="029f" class="jr js ma jt b ju jv jw jx jy jz ka kb mb kd ke kf mc kh ki kj md kl km kn ko ig bi translated"><code class="fe lt lu lv lw b">StyledFirebaseAuth</code>是直接与CSS捆绑在一起的。</p></blockquote><p id="cc28" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我用的是后一种。这是文档中一个<code class="fe lt lu lv lw b">StyledFirebaseAuth</code>的基本示例:</p><pre class="me mf mg mh gt mi lw mj mk aw ml bi"><span id="7cd3" class="mm kq in lw b gy mn mo l mp mq">// Import FirebaseAuth and firebase.<br/>import React from 'react';<br/>import StyledFirebaseAuth from 'react-firebaseui/StyledFirebaseAuth';<br/>import firebase from 'firebase';</span><span id="ac0b" class="mm kq in lw b gy mr mo l mp mq">// Configure Firebase.<br/>const config = {<br/>  apiKey: 'AIzaSyAeue-AsYu76MMQlTOM-KlbYBlusW9c1FM',<br/>  authDomain: 'myproject-1234.firebaseapp.com',<br/>  // ...<br/>};<br/>firebase.initializeApp(config);</span><span id="1b22" class="mm kq in lw b gy mr mo l mp mq">// Configure FirebaseUI.<br/>const uiConfig = {<br/>  // Popup signin flow rather than redirect flow.<br/>  signInFlow: 'popup',<br/>  // Redirect to /signedIn after sign in is successful. Alternatively you can provide a callbacks.signInSuccess function.<br/>  signInSuccessUrl: '/signedIn',<br/>  // We will display Google and Facebook as auth providers.<br/>  signInOptions: [<br/>    firebase.auth.GoogleAuthProvider.PROVIDER_ID,<br/>    firebase.auth.FacebookAuthProvider.PROVIDER_ID<br/>  ]<br/>};</span><span id="3371" class="mm kq in lw b gy mr mo l mp mq">class SignInScreen extends React.Component {<br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;h1&gt;My App&lt;/h1&gt;<br/>        &lt;p&gt;Please sign-in:&lt;/p&gt;<br/>        &lt;StyledFirebaseAuth uiConfig={uiConfig} firebaseAuth={firebase.auth()}/&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span></pre><h1 id="712b" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">登录后回拨</h1><p id="386c" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">文档非常清楚，所以我不打算对此谈论太多。我最关心的是数据流，因为当我几天前在我的盖茨比应用程序中使用时，我没有看到太多的信息。所以我想把它写下来，以防将来有人可能需要它。</p><p id="ff9d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">配置好之后，您可以登录到提供者，将其连接到<code class="fe lt lu lv lw b">Firestore</code>，并在<code class="fe lt lu lv lw b">Firestore</code>的<code class="fe lt lu lv lw b">Authentication</code>中创建一个用户。之后，<code class="fe lt lu lv lw b">signInSuccessUrl: ‘/signedIn’</code>将把流重定向到<code class="fe lt lu lv lw b">/signedIn</code>。</p><p id="f32c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">但是如果你想做的不仅仅是重定向呢？那么你应该使用一个叫做:<code class="fe lt lu lv lw b">signInSuccessWithAuthResult</code>的回调。它应该嵌套在<code class="fe lt lu lv lw b">uiConfig</code>中的<code class="fe lt lu lv lw b">callbacks</code>对象中。因此<a class="ae ls" href="https://github.com/firebase/firebaseui-web-react#using-firebaseauth-with-local-state" rel="noopener ugc nofollow" target="_blank">文档</a>中的示例如下所示:</p><pre class="me mf mg mh gt mi lw mj mk aw ml bi"><span id="3a23" class="mm kq in lw b gy mn mo l mp mq">// Configure FirebaseUI.<br/>  uiConfig = {<br/>    // Popup signin flow rather than redirect flow.<br/>    signInFlow: 'popup',<br/>    // We will display Google and Facebook as auth providers.<br/>    signInOptions: [<br/>      firebase.auth.GoogleAuthProvider.PROVIDER_ID,<br/>      firebase.auth.FacebookAuthProvider.PROVIDER_ID<br/>    ],<br/>    callbacks: {<br/>      signInSuccessWithAuthResult: () =&gt; false<br/>    }<br/>  }</span></pre><h2 id="bcf1" class="mm kq in bd kr ms mt dn kv mu mv dp kz kc mw mx ld kg my mz lh kk na nb ll nc bi translated">使用<code class="fe lt lu lv lw b">signInSuccessWithAuthResult</code>回调来决定重定向或停留</h2><p id="0439" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">回调将是一个接受两个参数的函数，<code class="fe lt lu lv lw b">authObject</code>(通常是<code class="fe lt lu lv lw b">user</code>)和<code class="fe lt lu lv lw b">redirectURL</code>。因此，您可以在成功登录后执行更多操作。</p><p id="7e41" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它将返回的实际上是一个简单的<code class="fe lt lu lv lw b">boolean</code>值。如果它返回true，那么在登录后，用户将被重定向到由<code class="fe lt lu lv lw b">signInSuccessUrl</code>指定的URL。当它返回false时，用户将停留在同一页面上。</p><h2 id="ec6a" class="mm kq in bd kr ms mt dn kv mu mv dp kz kc mw mx ld kg my mz lh kk na nb ll nc bi translated">在<code class="fe lt lu lv lw b">signInSuccessWithAuthResult</code>中处理异步请求</h2><p id="d1cf" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">我在使用<code class="fe lt lu lv lw b"> signInSuccessWithAuthResult</code>时遇到的另一个问题是，由于它确切地要求一个<code class="fe lt lu lv lw b">boolean</code>值，当我使用<code class="fe lt lu lv lw b">async/await</code>试图从数据库或API获取数据时，我得到一个错误，指出我返回的是一个<code class="fe lt lu lv lw b">Promise&lt;boolean&gt;</code>，这与<code class="fe lt lu lv lw b">signInSuccessWithAuthResult</code>预期接收的不完全匹配。</p><p id="63b8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">要处理这个问题，只需使用一个非常小的技巧:使用<code class="fe lt lu lv lw b">.then</code>来处理函数内部的承诺。它只是一个小技巧，但我在网上没有看到太多关于它的信息，所以我写在这里。希望有一天能帮到你。</p><h1 id="f1a1" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">笔记</h1><p id="dabf" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">就试着分享一个关于<code class="fe lt lu lv lw b">signInFlow</code>的笔记吧。有两种方式:<code class="fe lt lu lv lw b">popup</code>和<code class="fe lt lu lv lw b">redirect</code>。它默认为<code class="fe lt lu lv lw b">redirect</code>，所以如果你想加快加载过程，将其指定为<code class="fe lt lu lv lw b">popup</code>！</p><p id="1623" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">感谢阅读！</p></div></div>    
</body>
</html>