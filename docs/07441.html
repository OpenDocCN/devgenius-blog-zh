<html>
<head>
<title>Go: Introduction to HttpRouter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">go:http outer 简介</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/go-httprouter-be9c27f569ba?source=collection_archive---------8-----------------------#2022-03-25">https://blog.devgenius.io/go-httprouter-be9c27f569ba?source=collection_archive---------8-----------------------#2022-03-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ba10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Go 中最流行的 Http 路由器库之一</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6597fd32438d19c9f411c4ba2a3047e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eKWEKRqWVTOCIEmC"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">哈维尔·阿莱格·巴罗斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="647e" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">什么是 HttpRouter？</h1><p id="0f37" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">HTTP Router 是 Golang 中最流行的开源 HTTP 路由器库之一。http outer 很快，也很简单，因为 http outer 只有路由功能。</p><p id="3ba6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想看 HttpRouter 的文档，你可以访问下面的链接:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f3eb" class="mh la in md b gy mi mj l mk ml"><a class="ae ky" href="https://github.com/julienschmidt/httprouter" rel="noopener ugc nofollow" target="_blank">https://github.com/julienschmidt/httprouter</a></span></pre><h1 id="59e1" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">HttpRouter 入门</h1><p id="6087" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在 go 中使用 http outer 之前，您需要将 http outer 包添加到您的项目中。您可以使用此命令将 HttpRouter 包添加到您的项目中。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="b913" class="mh la in md b gy mi mj l mk ml"><strong class="md io">go get  github.com/julienschmidt/httprouter</strong></span></pre></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="143b" class="kz la in bd lb lc mt le lf lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw bi translated">路由器</h1><p id="1f86" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">HttpRouter 库的核心是路由器的<strong class="jm io">结构。路由器是 http 的一个实现。Handler，所以将 Handler 添加到<strong class="jm io"> http 会更容易。服务器</strong>。要创建一个新的路由器，你可以使用<code class="fe my mz na md b"><strong class="jm io">httprouter.New()</strong></code>，它将返回一个路由器</strong>的<strong class="jm io">指针。</strong></p><h1 id="9d6c" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">HTTP 方法</h1><p id="54f8" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">路由器类似于 ServeMux。您可以向路由器添加路由。与 ServeMux 相比，路由器具有优势。在 router 中，您可以轻松选择想要使用的 HTTP 方法。要将路由添加到路由器中，您可以使用相同的功能及其自己的 HTTP 方法，如<code class="fe my mz na md b">GET()</code>、<code class="fe my mz na md b">POST()</code>等。</p><p id="5319" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请参见在 HttpRouter 中添加路由的示例</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="349a" class="mh la in md b gy mi mj l mk ml">router := httprouter.New()<br/>router.GET("/", GetHandlerFunctionName)<br/>router.POST("/post", PostHandlerFunctionName)</span></pre><h1 id="5064" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">处理</h1><p id="b4bc" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">要在 HttpRouter 中添加路由，您可以使用<code class="fe my mz na md b">httprouter.Handle</code>。与只有两个参数的 ServeMux 相比，HttpRouter 有三个参数。有 ResponseWriter、Request 和 Params。不同的是参数。</p><p id="46e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请看使用 HttpRouter 添加处理函数的例子</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="c00b" class="mh la in md b gy mi mj l mk ml">func HandlerName(w http.ResponseWriter, r *http.Request, params httprouter.Params) {}</span></pre><h1 id="8adc" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">参数</h1><p id="ac63" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">之前我提到过 HttpRouter 有三个参数，其中一个是 Params。Param 是存储从客户端接收的参数的位置。有时我们需要使用一个动态的 URL 如<code class="fe my mz na md b">products/1</code>来访问 id 号为 1 的指定产品，其中<strong class="jm io"> 1 </strong>是产品的 id。URL 中的动态参数，将自动在 params 中收集。</p><p id="2c45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请参见如何获取产品 id 的示例</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="8cba" class="mh la in md b gy mi mj l mk ml">router.GET("/products/:id", func(w http.ResponseWriter, r *http.Request, params httprouter.Params) {<br/>    id := params.ByName("id")<br/>}</span></pre><p id="0274" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码中，您需要添加“:”来让 route 知道您的参数在哪里。要获得 params 的值，您可以使用<code class="fe my mz na md b">params.ByName(<strong class="jm io">ParamsName</strong>)</code>，在这种情况下，ParamsName 是<strong class="jm io"> id。</strong>如果您正在访问 URL <code class="fe my mz na md b">products/1</code>，id 变量的值将为“1”。</p><p id="b5ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您也可以从 URL 获取多个参数，要获取多个参数，您可以像这样编辑路径<code class="fe my mz na md b">/products/:id/name/:name</code>。用前面的代码你可以得到参数 id 的值&amp;名。</p><p id="3f1e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Params 也可以获取路径，要捕捉路径你可以在你的 route <code class="fe my mz na md b">iamges/*imagePath</code>中使用这个代码。如果您正在访问 URL <code class="fe my mz na md b">images/productId/photo.png</code>，您可以使用<strong class="jm io"> imagePath </strong> params 访问文件路径，并将返回<code class="fe my mz na md b">/productId/photo.png</code>。</p><h1 id="d413" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">提供文件</h1><p id="1738" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">http outer 还支持 ServeFiles，你可以使用<code class="fe my mz na md b">router.ServeFiles(path, fileSystem)</code>在 http outer 中提供文件。<strong class="jm io"> Path </strong>是一条路径，用于定位您的服务器文件可以访问的位置。<strong class="jm io">文件系统</strong>是您想要服务的文件夹的目录。</p><p id="cd17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请参见使用 Serve 文件的示例</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="5e19" class="mh la in md b gy mi mj l mk ml">router.ServeFiles("/files/*filepath", http.Dir("resource/"))</span></pre><p id="6471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的代码是 serve 文件，在<strong class="jm io">资源文件夹</strong>中，在你的项目中路由<code class="fe my mz na md b">/files/</code>。因此，当您需要从资源文件夹中访问 hello.txt 文件时，您可以使用<code class="fe my mz na md b">/files/hello.txt</code>进行访问。</p><h1 id="8225" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">紧急处理程序</h1><p id="8cf1" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">HtppRouter 具有处理紧急情况的功能。通常，当你的逻辑出现混乱时，你的程序会出错并停止返回任何响应。有时当错误发生时，你需要做些什么。但是使用 HttpRouter，您可以使用下面的代码来处理它。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="748b" class="mh la in md b gy mi mj l mk ml">router.PanicHandler = func(w http.ResponseWriter, r *http.Request, error interface{}) {<br/><strong class="md io">// you can add logic here when panic happens<br/>// you can get an error message with "error"</strong><br/>}</span></pre><h1 id="9cf6" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">未找到处理程序</h1><p id="4d2d" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">HttpRouter 也没有找到处理程序。未找到处理程序可以捕捉到您正在访问找不到的路由的情况。要使用 Not Found 处理程序，您可以使用下面的代码。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="047a" class="mh la in md b gy mi mj l mk ml">router.NotFound = http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {<br/><strong class="md io">// you can add logic here when Not Found happens</strong><br/>})</span></pre><h1 id="3d50" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">方法不允许处理程序</h1><p id="d3b8" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">使用 ServeMux，您不能选择将在处理程序中使用的 HTTP 方法。但是在 HttpRouter 中是可以的。您可以在创建处理程序时设置 HTTP 方法。因此，如果客户端使用我们之前已经设置的不同方法访问路由，不允许的处理程序将捕获它们。您可以使用下面的代码使用不允许的处理程序。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="4fe4" class="mh la in md b gy mi mj l mk ml">router.MethodNotAllowed = http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {<br/><strong class="md io">// you can add logic here when Method Not Allowed happens</strong><br/>})</span></pre></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><blockquote class="nb"><p id="bbfb" class="nc nd in bd ne nf ng nh ni nj nk kh dk translated">参考:<br/> <a class="ae ky" href="https://www.youtube.com/watch?v=spXgBcjiuWM" rel="noopener ugc nofollow" target="_blank"> Golang Http 路由器 by PZN</a><br/><a class="ae ky" href="https://github.com/julienschmidt/httprouter" rel="noopener ugc nofollow" target="_blank">https://github.com/julienschmidt/httprouter</a></p></blockquote></div></div>    
</body>
</html>