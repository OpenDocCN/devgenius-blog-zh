<html>
<head>
<title>A Better Way to Dispatch Emails In Odoo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Odoo 中发送电子邮件的更好方式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-better-way-to-dispatch-emails-in-odoo-a1cbcd99be90?source=collection_archive---------5-----------------------#2022-12-02">https://blog.devgenius.io/a-better-way-to-dispatch-emails-in-odoo-a1cbcd99be90?source=collection_archive---------5-----------------------#2022-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="00b8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理想的实现不知道电子邮件最终是如何发送出去的</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/47c3df97d69682b8676541b47e053f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhtT_FaiNvlXDmfUiZLlVA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由作者设计</figcaption></figure><p id="ac89" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Odoo 中的许多特性可以用多种方式实现。</p><p id="e081" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在 Odoo 中发送电子邮件也是如此。</p><p id="0b0b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我将分享在 Odoo 中调度邮件的两个实现。</p><p id="d8a6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一个糟糕的实现在一些 Odoo 开发者中很常见，大多数是新手和业余爱好者。第二个理想的实现是首选，因为它更简单、简洁，并且利用了<a class="ae lr" href="https://en.wikipedia.org/wiki/Delegation_pattern" rel="noopener ugc nofollow" target="_blank">委托模式</a>。</p><h1 id="173f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在我们继续之前，让我们定义一个基本要求</h1><p id="eeee" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">作为 Odoo 开发人员，您的项目经理分配给您一项任务，为房地产经纪人模块实现电子邮件通知。该模块允许房地产开发商(或经理)向潜在买家列出他们的房产。</p><p id="ff0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的任务是实现一个功能，支持电子邮件通知房地产经纪人每一次买方表现出兴趣的财产。</p><p id="e692" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对所列物业感兴趣的买家将点击物业表格上带有“我感兴趣”标签的按钮，向物业经理发送电子邮件。</p><p id="a113" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看使用 Odoo 实现这一需求的两种方法</p><h1 id="5c6c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">执行不力</h1><p id="c4af" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">奇怪的是，我们仍然使用电子邮件通知的常见实现，我们将采取以下步骤。</p><ol class=""><li id="0777" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq mu mv mw mx bi translated">使用<a class="ae lr" href="https://www.odoo.com/documentation/16.0/developer/reference/frontend/qweb.html" rel="noopener ugc nofollow" target="_blank"> QWeb 模板定义一个电子邮件模板。</a></li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">当潜在客户对他们的任何房地产表现出兴趣时，用于通知物业经理的电子邮件模板</figcaption></figure><p id="61b1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2.在模型<code class="fe na nb nc nd b">realtor.property </code>上定义一个方法<code class="fe na nb nc nd b">action_interested(...) </code>，并将其绑定到标签为‘我感兴趣’的按钮上。此按钮在 realtor 表单视图中定义。</p><p id="f601" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.对于方法<code class="fe na nb nc nd b">action_interested(...)</code>的逻辑，我们将实现接下来的步骤。</p><p id="0850" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.获取对邮件模板上的<code class="fe na nb nc nd b">body_html</code>字段的引用，并用动态确定的值替换模板中所有已定义的占位符。模板中的占位符是包装在<code class="fe na nb nc nd b">--</code>中的变量。以上模板的例子是<code class="fe na nb nc nd b">--property-name--</code>、<code class="fe na nb nc nd b">--customer-name--</code>等。</p><p id="550f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">5.接下来，创建一个<code class="fe na nb nc nd b">mail.mail</code>模型的实例，传递修改后的邮件模板的<code class="fe na nb nc nd b">body_html</code>。</p><p id="df7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">6.最后，在<code class="fe na nb nc nd b">mail.mail</code>的实例上调用<code class="fe na nb nc nd b">send(...) </code>方法，将电子邮件发送给房地产经纪人或经理</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">使用 action_interested(…)方法的房地产属性的模型定义，它发送一封电子邮件通知属性经理对他们的任何属性感兴趣的客户</figcaption></figure><h1 id="5d69" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">理想的实现</h1><p id="908d" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">这种替代实现利用了委托设计模式。这种模式简化了开发人员的代码和代码责任。</p><p id="771c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种模式下，操作被委托(转发)给特定的对象或服务来处理它们的职责，而不是由相关的对象来处理完成这些职责所需的底层机制。</p><p id="c036" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们发送电子邮件的理想实现中利用这种模式，我们将专注于构建我们的电子邮件模板，然后调用模板上的<code class="fe na nb nc nd b">send_mail(...)</code>方法来传递确定向房地产经纪人或物业经理发送电子邮件的机制的职责，而不是在我们的代码中真正处理它。</p><p id="03cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看这个理想实现中所需的步骤。</p><ol class=""><li id="dc3b" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq mu mv mw mx bi translated">使用<a class="ae lr" href="https://www.odoo.com/documentation/16.0/developer/reference/frontend/qweb.html" rel="noopener ugc nofollow" target="_blank"> QWeb 模板定义一个电子邮件模板。</a></li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">当潜在客户对他们的任何房地产表现出兴趣时，用于通知物业经理的电子邮件模板</figcaption></figure><p id="3630" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2.在模型<code class="fe na nb nc nd b">realtor.property </code>上定义一个方法<code class="fe na nb nc nd b">action_interested(...) </code>，并将其绑定到在房地产经纪人表单视图中定义的标记为“我感兴趣”的按钮。</p><p id="454b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.对于方法<code class="fe na nb nc nd b">action_interested(...)</code>的逻辑，我们将实现下面的步骤。</p><p id="4cc2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.获取电子邮件模板的参考。</p><p id="5585" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">5.调用 email 上的<code class="fe na nb nc nd b">send_mail(...)</code>方法，使用我们的模板将电子邮件的发送委托给<code class="fe na nb nc nd b">mail.mail</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">使用 action_interested(…)方法的房地产属性的模型定义，它发送一封电子邮件通知属性经理对他们的任何属性感兴趣的客户</figcaption></figure><p id="7f3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">比较差的实现和我们理想实现的<code class="fe na nb nc nd b">action_interested(...)</code>,很明显后者更简单。它只需要两行代码，而前者需要 10 多行代码。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="caa2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<a class="ae lr" href="https://github.com/ofelix03/odoo-realtor/tree/ideal-implementation" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的源代码。<a class="ae lr" href="https://github.com/ofelix03/odoo-realtor/tree/ideal-implementation" rel="noopener ugc nofollow" target="_blank">库</a>包含两个实现的基本 Odoo 模块。</p><p id="ea25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不良实施在分支<a class="ae lr" href="https://github.com/ofelix03/odoo-realtor/tree/poor-implementation" rel="noopener ugc nofollow" target="_blank">上不良实施</a>，而<a class="ae lr" href="https://github.com/ofelix03/odoo-realtor/tree/ideal-implementation" rel="noopener ugc nofollow" target="_blank">理想实施</a>在分支实施上。</p><p id="1793" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了测试你自己的模块，通过克隆库并添加路径到你的 Odoo addons 路径库。两者都可以工作，但是理想的实现用更少的代码行实现了相同的功能。</p><p id="2e25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记得检查到您想要测试的实现的正确分支。</p><div class="nl nm gp gr nn no"><a href="https://github.com/ofelix03/odoo-realtor/tree/ideal-implementation" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">GitHub - ofelix03/odoo-realtor 处于理想实施状态</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">一个基本的 odoo 模块，演示了用 Odoo 发送电子邮件的两种实现。这两种实现都是功能性的…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kp no"/></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://github.com/ofelix03/odoo-realtor/tree/poor-implementation" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">GitHub - ofelix03/odoo-realtor 实现不佳</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">一个基本的 odoo 模块，演示了用 Odoo 发送电子邮件的两种实现。这两种实现都是功能性的…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="od l nz oa ob nx oc kp no"/></div></div></a></div></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="4ef7" class="ls lt iq bd lu lv oe lx ly lz of mb mc jw og jx me jz oh ka mg kc oi kd mi mj bi translated">方法 2 优于方法 1 的原因</h1><p id="65fb" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">理想的实现消除了在差的实现中需要的下列操作。</p><ol class=""><li id="53cd" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq mu mv mw mx bi translated"><strong class="kx ir">设置电子邮件模板中定义的占位符的值。</strong> <br/>在理想的实现中，电子邮件模板已经保存了对<code class="fe na nb nc nd b">object</code>的引用。在电子邮件模板中，<code class="fe na nb nc nd b">object</code>引用客户感兴趣的资产。此<code class="fe na nb nc nd b">object </code>授权直接访问信息，如物业名称、物业经理姓名、客户姓名和电子邮件等。</li><li id="4299" class="mp mq iq kx b ky oj lb ok le ol li om lm on lq mu mv mw mx bi translated"><strong class="kx ir">创建</strong> <code class="fe na nb nc nd b"><strong class="kx ir">mail.mail</strong></code> <strong class="kx ir">的一个实例，并调用其</strong> <code class="fe na nb nc nd b"><strong class="kx ir">send(...)</strong></code> <strong class="kx ir">方法。</strong> <br/>在理想的实现中，邮件模板的<code class="fe na nb nc nd b">send_mail(...)</code>方法将电子邮件的发送委托给<code class="fe na nb nc nd b">mail.mail</code>而不直接调用<code class="fe na nb nc nd b">send(...)</code>方法。</li><li id="7279" class="mp mq iq kx b ky oj lb ok le ol li om lm on lq mu mv mw mx bi translated"><strong class="kx ir">样板文件和详细代码</strong> <br/>复杂的电子邮件模板需要详细的样板文件代码来更新电子邮件模板中的占位符，创建<code class="fe na nb nc nd b">mail.mail</code>的实例，最后调用其<code class="fe na nb nc nd b">send(...)</code>函数来发送电子邮件。</li></ol></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="ee96" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="oo">感谢您的阅读。我希望这篇文章对你有用。如果有，请花一点时间到</em> <a class="ae lr" href="https://medium.com/subscribe/@ofelix03" rel="noopener"> <em class="oo">订阅</em> </a> <em class="oo">到</em> <a class="ae lr" href="https://medium.com/subscribe/@ofelix03" rel="noopener"> <em class="oo">我的个人资料</em> </a> <em class="oo">接收我每次发表新文章的通知。</em></p><p id="29af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有一件事，如果你能支持我的写作，我将不胜感激。通过 <a class="ae lr" href="https://medium.com/membership/@ofelix03" rel="noopener"> <em class="oo">加盟媒介</em> </a> <em class="oo">与我的</em> <a class="ae lr" href="https://medium.com/membership/@ofelix03" rel="noopener"> <em class="oo">推荐链接</em> </a> <em class="oo">，我从你的会员费中获得一小笔佣金，这有助于我投入时间和精力来撰写和发表这些有用的文章。</em></p><div class="nl nm gp gr nn no"><a href="https://ofelix03.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">每当费利克斯·奥托发表文章时，就收到一封电子邮件。</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">每当费利克斯·奥托发表文章时，就收到一封电子邮件。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">ofelix03.medium.com</p></div></div><div class="nx l"><div class="op l nz oa ob nx oc kp no"/></div></div></a></div></div></div>    
</body>
</html>