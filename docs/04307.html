<html>
<head>
<title>How to Setup Microsoft SQL Server Docker Image in Portainer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Portainer 中设置 Microsoft SQL Server Docker 映像</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-setup-microsoft-sql-server-docker-image-in-portainer-66d37ed8a24b?source=collection_archive---------0-----------------------#2021-02-25">https://blog.devgenius.io/how-to-setup-microsoft-sql-server-docker-image-in-portainer-66d37ed8a24b?source=collection_archive---------0-----------------------#2021-02-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f0fe46b9f66ac08617562b1d1c34cb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n6Ns-38Zp6wmWj-8WVFWmg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Microsoft SQL Server、Docker 和 Portainer</figcaption></figure><p id="0d6e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我得告诉你。当我们在 2017 年听到微软 SQL Server (MSSQL)将开始支持 Linux 的消息时，很多像我一样的软件开发异教徒都兴奋不已。</p><p id="4572" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">像我这样的人认为，任何形式的技术，无论是软件还是硬件，都不应该受到他们使用的平台或操作系统的限制。没有优越的平台或编程语言或操作系统，我们都只想实现一件事:一个可行的项目。所以微软拥抱 Linux 和开源世界的举动真的让我们很兴奋。</p><p id="8c76" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">几年过去了，微软并没有食言。Linux 模拟器来到了 Windows 10，Visual Studio 代码可以在 Linux 和 Mac 上安装和使用，他们去年与 Docker 合作推出了 Azure 容器实例(ACI)。但在我看来，发生的最好的事情是官方 MSSQL Docker 映像的发布，这些映像可以在 Windows 10 或 Linux 上运行。</p><p id="db83" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就在这个星期，我想对我的一个个人项目做一个重大的改变。我维护的一台服务器运行的是 Windows，它提供对网络中其他计算机的 FTP 和 MSSQL 访问。这是一个老服务器，在那里运行 Windows 比以前更长时间可能不是一个好主意，因为 Windows 变得臃肿久而久之。所以我想，如果我重新设置它，提供同样的服务，但是这次，它将运行 Debian，会怎么样呢？因为我是一个懒惰的人，我可以很容易地在那里设置 OpenMediaVault 5 并通过它管理服务器。然后，安装 Docker 和 Portainer 来设置 MSSQL。听起来很简单，对吧？嗯……不完全是。</p><p id="b850" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我遇到了某些障碍，比如权限问题。他们不难对付。但是当你不知道自己在做什么的时候(像我一样)，它确实需要时间来运转。所以我想也许我可以写一下我是如何让它工作的，这样你就可以节省时间，让 MSSQL 在最短的时间内工作。</p><p id="ff6d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以让我们从登录 Portainer 开始。打开 docker 实例并进入容器视图。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kx"><img src="../Images/77945a832b1fe14da7d0b7a3389c70b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5FxnFtSPHTGqHVHv.png"/></div></div></figure><p id="6416" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一些在线文章会建议您使用 Portainer 的 MSSQL 模板，提供必要的值，然后就到此为止。虽然对于大多数人来说这是一个很好的解决方案，但在撰写本文时，该模板仍然指向 MSSQL 2017 Docker 映像。如果你想像我一样使用 MSSQL 2019，你需要手动操作。因此，在容器视图中，单击添加容器。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lc"><img src="../Images/e5ec5b6d9c1f8a62c90112b706ae5357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RoDLXfJFTZuZbFhE.png"/></div></div></figure><p id="6151" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您需要提供以下信息:</p><p id="a952" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">1.容器名称。</p><p id="22b0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.在图像中，您需要提供图像名称和适当的标记。对我来说，是 mcr.microsoft.com/mssql/server:2019-latest。</p><p id="dc99" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.如果您想为 MSSQL Docker 容器使用不同的端口号，您可以在网络端口配置中声明它。请注意，容器值与容器中使用的端口号相关，在本例中，1433 是默认的 MSSQL 端口号。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ld"><img src="../Images/dd5b2a003bdc2c88072d52722e6db678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aWjbTBWh9_WAivX_.png"/></div></div></figure><p id="1622" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.在<strong class="kb io">命令和记录选项卡</strong>中，需要指定用户为<strong class="kb io"> root </strong>。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi le"><img src="../Images/8aed9c6105fdb4a27a3ca5036d6b9373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MejL3q9NmHDLbJ6m.png"/></div></div></figure><p id="10c3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">也许您想知道为什么用户应该被设置为 root。如果你没有使用 root，这就是将要发生的事情。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lf"><img src="../Images/c410459049cee1a52186699f462e46a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xJg16iy4UfDaAoHW.png"/></div></div></figure><p id="1c76" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当您尝试登录时，会出现这种情况:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/c2d623b1d5413b150d89b2a64c2498b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/0*byRBB8hKo7A7fHvF.png"/></div></figure><p id="e6d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为什么会这样？发生这种情况是因为使 MSSQL 工作所必需的文件(例如 master 数据库)不能被复制到/var/opt/mssql 文件夹中。这意味着即使您的容器部署成功并且技术上正常工作，您也无法登录 MSSQL，因为它没有重要的组件。容器需要在启动时进行设置，并且需要 root 权限来完成设置。根就是这样。</p><p id="4623" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">5.在<strong class="kb io">卷标签</strong>中，你至少应该映射数据文件夹。在我的例子中，我映射了 3 个目录:<strong class="kb io">数据文件夹</strong>、<strong class="kb io">日志文件夹</strong>和<strong class="kb io">秘密文件夹</strong>。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi le"><img src="../Images/edda711b0dc08d2086ea15b95684fb4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DuGAF8RT_-Md9Niu.png"/></div></div></figure><p id="dc60" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">6.我离开了电视台。它默认设置为桥接模式，所以除非你知道自己在做什么，否则就随它去吧。</p><p id="3534" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">7.在<strong class="kb io"> Env 页签</strong>中，至少需要设置 3 个环境变量:<strong class="kb io"> ACCEPT_EULA </strong>、<strong class="kb io"> MSSQL_SA_PASSWORD </strong>和<strong class="kb io"> MSSQL_PID </strong>。</p><p id="3ff2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ACCEPT_EULA 应设置为 y。<br/>MSSQL _ SA _ PASSWORD 是您的 SA 帐户的密码。<br/> MSSQL_PID 是您要使用的产品 ID。它可以是评估密钥、开发密钥、快速密钥、Web 密钥、标准密钥、企业密钥或产品密钥。</p><p id="cebf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有关可以使用的环境变量的更多信息，请参考 MSDN 条目<a class="ae lh" href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">在 Linux 上使用环境变量配置 SQL Server 设置</a>。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/8d09beb52d6fad7caa203e6bcf6bffc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sXH2sIubR_yxAApo.png"/></div></div></figure><p id="6bcd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">8.在<strong class="kb io">重启策略选项卡</strong>中，将重启策略设置为<strong class="kb io">始终</strong>。</p><p id="2e1b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">9.除非你知道自己在做什么，否则不要触摸<strong class="kb io">运行时和资源及功能标签</strong>。</p><p id="41cf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">完成所有这些步骤后，您现在可以部署您的 MSSQL 容器了。为了测试它，您打开您的 Management Studio，提供您的服务器的地址和必要的凭证。</p><p id="e3d0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是遇到这种情况你打算怎么办？</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/4ffba7d3ede043b7a5f958aaeda55990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/0*pLbJi7AViL2bStJF.png"/></div></figure><p id="0d37" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">发生这种情况是因为正在使用的证书不是来自<strong class="kb io">可信的证书颁发机构</strong>。这是正常的，在开发中不应该有太大的影响。要做到这一点，只需将连接属性设置为信任证书。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/99594def3d80375b47ea288306267fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*v6Qugm0-mTyEN7V1.png"/></div></figure><p id="a5b4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">请注意<strong class="kb io">在生产环境中这不是一个好的做法</strong>，在处理生产系统时，您最好确保您拥有来自可信 CA 的证书。</p><p id="9e92" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以你有它。如果您遵循了本指南中的所有内容，您应该能够让您的 MSSQL Docker 实例正常工作。编码快乐！</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="347e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢你阅读这篇文章。</p><p id="04cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你觉得这篇文章有趣，点击👏按钮，并分享这篇文章。</p><p id="02b4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我的文章发布在<a class="ae lh" href="https://medium.com/@bien.baldonado" rel="noopener"><strong class="kb io"/></a><strong class="kb io"/>和我的网站<a class="ae lh" href="https://www.thebeet21.com" rel="noopener ugc nofollow" target="_blank"><strong class="kb io">【www.thebeet21.com】</strong></a></p></div></div>    
</body>
</html>