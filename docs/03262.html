<html>
<head>
<title>Top React Hooks — Shared State and Visibility</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">顶部反应挂钩—共享状态和可见性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/top-react-hooks-shared-state-and-visibility-85601f0421cd?source=collection_archive---------7-----------------------#2020-10-17">https://blog.devgenius.io/top-react-hooks-shared-state-and-visibility-85601f0421cd?source=collection_archive---------7-----------------------#2020-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d96e2b1482121bd72a2bc9ac98829e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l6-Ie-LMb8G7Fg0j"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@ecasap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊莱恩·卡萨普</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ea60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Hooks 包含了 React 应用程序中的逻辑代码。</p><p id="4586" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以创建自己的钩子，使用别人提供的钩子。</p><p id="c5df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看一些有用的 React 挂钩。</p><h1 id="410f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">@ rooks/use-visibility-传感器</h1><p id="44fb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">@rooks/use-visibility-sensor 包让我们检测组件的可见性。</p><p id="a840" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ea0d" class="mn lc iq mj b gy mo mp l mq mr">npm install --save @rooks/use-visibility-sensor</span></pre><p id="4172" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="af30" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import useVisibilitySensor from "@rooks/use-visibility-sensor";</span><span id="e954" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const ref = React.useRef(null);<br/>  const { isVisible, visibilityRect } = useVisibilitySensor(ref, {<br/>    intervalCheck: false,<br/>    scrollCheck: true,<br/>    resizeCheck: true<br/>  });<br/>  return (<br/>    &lt;div ref={ref}&gt;<br/>      &lt;p&gt;{isVisible ? "Visible" : "Not Visible"}&lt;/p&gt;<br/>      &lt;p&gt;{JSON.stringify(visibilityRect)}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="01c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe mt mu mv mj b">useVisibilitySensor</code>和一个传递给我们想要检查可见性的元素的 ref。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是一个具有各种选项的对象。</p><p id="4283" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">intervalCheck</code>是一个整数或布尔值，它告诉我们是否定期检查可见性。</p><p id="11d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它是一个数字，那么它就是每次检查之间的时间间隔，以毫秒为单位。</p><p id="9eb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">scrollCheck</code>是一个决定是否检查滚动行为的布尔值。</p><p id="9f5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">resizeCheck</code>如果是<code class="fe mt mu mv mj b">true</code>，让我们检查调整大小。</p><p id="e2e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有其他节流选项等等。</p><h1 id="2028" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">重新同步</h1><p id="4ac7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">重新同步库是一个允许我们在多个组件之间共享状态的库。</p><p id="0a14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b6cf" class="mn lc iq mj b gy mo mp l mq mr">yarn add resynced</span></pre><p id="1146" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ede0" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { createSynced } from "resynced";</span><span id="5a24" class="mn lc iq mj b gy ms mp l mq mr">const initialState = 0;<br/>const [useSyncedState] = createSynced(initialState);</span><span id="f049" class="mn lc iq mj b gy ms mp l mq mr">const Counter = () =&gt; {<br/>  const [count] = useSyncedState();</span><span id="187a" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      &lt;p&gt; {count}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="5282" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const [_, setCount] = useSyncedState();</span><span id="a042" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={() =&gt; setCount(s =&gt; s + 1)}&gt;increment&lt;/button&gt;<br/>      &lt;Counter /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="db27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用 th 初始状态调用<code class="fe mt mu mv mj b">createSynced</code>，用<code class="fe mt mu mv mj b">useSyncedState</code>钩子返回一个数组。</p><p id="6549" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在组件中使用返回的钩子。</p><p id="9b83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个带有状态的数组和按此顺序设置状态的函数。</p><p id="2e5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe mt mu mv mj b">setCount</code>来设置<code class="fe mt mu mv mj b">App</code>中的状态</p><p id="53ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe mt mu mv mj b">Counter</code>中得到<code class="fe mt mu mv mj b">count</code>状态。</p><h1 id="b762" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">RRH</h1><p id="e63d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">RRH 提供了钩子，我们可以用它来获取和设置 React Redux 状态数据。</p><p id="b9e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dfe9" class="mn lc iq mj b gy mo mp l mq mr">npm install rrh --save</span></pre><p id="1898" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3e60" class="mn lc iq mj b gy mo mp l mq mr">yarn add rrh</span></pre><p id="b59f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过连线来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c1e4" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { useProvider, useSelector } from "rrh";<br/>import { createLogger } from "redux-logger";<br/>import { applyMiddleware } from "redux";</span><span id="c380" class="mn lc iq mj b gy ms mp l mq mr">const logger = createLogger();</span><span id="487b" class="mn lc iq mj b gy ms mp l mq mr">const initState = {<br/>  count: 0<br/>};</span><span id="9c48" class="mn lc iq mj b gy ms mp l mq mr">const reducer = (state, action) =&gt; {<br/>  switch (action.type) {<br/>    case "INCREMENT":<br/>      return { count: state.count + 1 };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="3f56" class="mn lc iq mj b gy ms mp l mq mr">const Counter = () =&gt; {<br/>  const selected = useSelector(<br/>    {},<br/>    (dispatch, props) =&gt; ({<br/>      increment: () =&gt; dispatch({ type: "INCREMENT", payload: 1 })<br/>    }),<br/>    (state, props) =&gt; ({ count: state.count }),<br/>    state =&gt; [state.count]<br/>  );</span><span id="cc12" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      {selected.count}<br/>      &lt;button onClick={selected.increment}&gt;INC&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="363b" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const Provider = useProvider(() =&gt; ({<br/>    reducer,<br/>    preloadedState: { count: 1 },<br/>    storeEnhancer: applyMiddleware(logger)<br/>  }));<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Provider&gt;<br/>        &lt;Counter /&gt;<br/>        &lt;Counter /&gt;<br/>      &lt;/Provider&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="bb13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">initState</code>对象创建一个具有初始状态的对象。</p><p id="1dc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe mt mu mv mj b">createLogger</code>函数来返回<code class="fe mt mu mv mj b">logger</code>。</p><p id="cd50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建我们的 reducer 来设置状态。</p><p id="e610" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">Counter</code>中，我们称之为<code class="fe mt mu mv mj b">useSelector</code>钩子。</p><p id="4dc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个论点是道具。</p><p id="5b88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数有一个函数，用于返回一个对象，该对象带有调度操作的函数。</p><p id="5ee7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三个参数按照我们想要的方式映射状态。</p><p id="fc6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第四个参数有一个函数，需要注意它的依赖关系。</p><p id="db89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">状态在<code class="fe mt mu mv mj b">selected</code>变量中。</p><p id="d39d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">App</code>中，我们用<code class="fe mt mu mv mj b">Provider</code>包装我们希望商店可以访问的组件。</p><p id="1d42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">Provider</code>是用接受一个函数的<code class="fe mt mu mv mj b">useProvider</code>钩子创建的。</p><p id="098c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该函数返回一个带有<code class="fe mt mu mv mj b">reducer</code>、<code class="fe mt mu mv mj b">preloadedState</code>和<code class="fe mt mu mv mj b">storeEnhancer</code>的对象。</p><p id="5546" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">reducer</code>有减速器。</p><p id="d00f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">preloadedState</code>有初始状态。</p><p id="f754" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">storeEnhancer</code>有我们要运行的 Redux 中间件。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/86811539388fdd4d64cca6d7704783ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LLWOqG_GjOntpLlZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@kylejglenn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯尔·格伦</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="d510" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="742a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">@ rooks/use-visibility-sensor 让我们检测能见度。</p><p id="d95a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重新同步使我们能够为组件创建共享状态。</p><p id="3b26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">RRH 让我们用钩子来代替 Redux。</p></div></div>    
</body>
</html>