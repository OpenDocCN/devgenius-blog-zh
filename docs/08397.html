<html>
<head>
<title>Courier Service LLD in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang 快递服务有限公司</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/courier-service-lld-in-golang-cdf881a28b03?source=collection_archive---------6-----------------------#2022-06-12">https://blog.devgenius.io/courier-service-lld-in-golang-cdf881a28b03?source=collection_archive---------6-----------------------#2022-06-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b67c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">计划是设计一个命令行应用程序，以估计包裹成本和估计交付时间。</p><h1 id="e8ff" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">需求#1:估计包成本</h1><blockquote class="lg lh li"><p id="4efe" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">功能需求</p></blockquote><p id="be2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">计划是根据给定的以下内容来估计软件包的成本:</p><ol class=""><li id="8173" class="ln lo in jm b jn jo jr js jv lp jz lq kd lr kh ls lt lu lv bi translated">包裹重量。</li><li id="debf" class="ln lo in jm b jn lw jr lx jv ly jz lz kd ma kh ls lt lu lv bi translated">包裹递送的距离。</li><li id="fe16" class="ln lo in jm b jn lw jr lx jv ly jz lz kd ma kh ls lt lu lv bi translated">报价代码选择。</li></ol><blockquote class="lg lh li"><p id="661e" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">出价标准</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mb"><img src="../Images/c0f3cee6e4e6cf225dd06d05b7eb9363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kZrCb4OT3OvQs4pdTRI-w.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/d57437a52175fd118fa0fe4c73000198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*o57FFnhzLTY4q9be6bdNYg.png"/></div></figure><blockquote class="lg lh li"><p id="12eb" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">样本输入和输出</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mo"><img src="../Images/9b77a3f4d096ee2d12fc6c5b0fc3e46f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTDiYi9vxm9pZxP1HCenYA.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mp"><img src="../Images/e13f7754cd1e9f59e4dd08c78172fde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZznDRQdjqyGnfyjyu1LJ-w.png"/></div></div></figure><blockquote class="lg lh li"><p id="4b4c" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">说明</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mq"><img src="../Images/3cf918e58865b8cb63ccda5523e82c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lD2EW-G3NTGqhjnW3ZfihQ.png"/></div></div></figure><h1 id="b669" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">需求#2:交付时间估计</h1><blockquote class="lg lh li"><p id="4888" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">功能需求</p></blockquote><p id="994a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">计划是根据以下给定条件估计递送包裹所需的时间:</p><ol class=""><li id="4742" class="ln lo in jm b jn jo jr js jv lp jz lq kd lr kh ls lt lu lv bi translated">包裹重量。</li><li id="fa85" class="ln lo in jm b jn lw jr lx jv ly jz lz kd ma kh ls lt lu lv bi translated">包裹递送的距离。</li><li id="29e0" class="ln lo in jm b jn lw jr lx jv ly jz lz kd ma kh ls lt lu lv bi translated">装运交付标准。</li></ol><blockquote class="lg lh li"><p id="ada0" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">交付标准</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/1102ac04df9b521f470556acbfa49ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*SHQ9ZSdEJfhkr7LiX1dY7Q.png"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/4eb3f66a31ffc5476e5b37f633523f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*-6vFKuUoAXUAkpVl5tttNw.png"/></div></figure><blockquote class="lg lh li"><p id="e25d" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">说明</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mt"><img src="../Images/021c026fda16ff9b7181c52dbdc34ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ou7H6YbWrpLW56GCYWV9YQ.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mu"><img src="../Images/57a68ae3a6e9cce01d566c81841d4a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-c0k9iSjYr0DBGQknnqlA.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mv"><img src="../Images/c20631c5f72f982155aaedf61901444c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3sG80X8LCyByEL7VTsBSQ.png"/></div></div></figure><h1 id="fb04" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">解决办法</h1><blockquote class="lg lh li"><p id="0c86" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">模型</p></blockquote><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mw"><img src="../Images/1dcbeca33fbf87f3d8ccd729c1441866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFcZkCwA_WFSVx1BF2w52Q.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mx"><img src="../Images/3ce9e9051a8eb01da36079c2b0a89d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aK2NJZuCXP0myGL_44-Q1Q.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi my"><img src="../Images/ad350afd46187cb8162cca4e13c09e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khDonvBe3isrnhIbh8l3_g.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e01895ae7d73a48cb66a6a76c7f37a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*pJFag1DkhTqwPJHNgkiaFg.png"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi na"><img src="../Images/8dd7166205fdd0686e66f6e4cc020773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obAkr274AXWEdynsYzHE3Q.png"/></div></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/3ad2474194e416d9ac96a2bec6acbfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*TXWQwQbHCX35T5TycIDRIQ.png"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b1eb33922b06bee3a9e3762697bc48ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*lqYNGuGfPwNNkHT1sIcxrg.png"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi nd"><img src="../Images/ce0cc367aae43ea9e5a069005f58e175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HLmUQYdcRj2YjnKmrPoDQ.png"/></div></div></figure><blockquote class="lg lh li"><p id="1454" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">成本估算服务</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="f208" class="nj kj in nf b gy nk nl l nm nn">package service<br/><br/>import "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/><br/>type CostEstimation struct{}<br/><br/>func ProvideCostEstimationService() CostEstimation {<br/>   return CostEstimation{}<br/>}<br/><br/>func (ce CostEstimation) CalculateAllPackagesCost(input model.PackageInputFormat) model.PackageOutputFormat {<br/>   output := model.PackageOutputFormat{}<br/>   packageTracker := make(map[string]bool)<br/><br/>   for _, pkg := range input.Packages {<br/>      if offerApplied, ok := packageTracker[pkg.Id]; ok || offerApplied {<br/>         continue<br/>      }<br/><br/>      validity, discountPercent := pkg.IsOfferValid()<br/>      packageTracker[pkg.Id] = validity<br/>      cost, discount := pkg.GetCost(input.BaseDeliveryCost, discountPercent)<br/><br/>      pkgOut := model.PackageOutput{<br/>         Id:        pkg.Id,<br/>         Discount:  discount,<br/>         TotalCost: cost,<br/>      }<br/><br/>      output.Packages = append(output.Packages, pkgOut)<br/>   }<br/><br/>   return output<br/>}</span></pre><blockquote class="lg lh li"><p id="0818" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">成本估算服务:测试</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="1695" class="nj kj in nf b gy nk nl l nm nn">package service_test<br/><br/>import (<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/service"<br/>   "github.com/stretchr/testify/assert"<br/>   "testing"<br/>)<br/><br/>func TestCostEstimation_CalculateAllPackagesCost(t *testing.T) {<br/>   ceSvc := service.ProvideCostEstimationService()<br/><br/>   packages := []model.Package{<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       190,<br/>         DistanceInKm: 150,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       240,<br/>         DistanceInKm: 55,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG4",<br/>         Weight:       240,<br/>         DistanceInKm: 45,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR002",<br/>      },<br/>   }<br/><br/>   input := model.PackageInputFormat{<br/>      BaseDeliveryCost: 100,<br/>      NoOfPackages:     4,<br/>      Packages:         packages,<br/>   }<br/><br/>   expected := model.PackageOutputFormat{Packages: []model.PackageOutput{<br/>      {<br/>         Id:        "PKG1",<br/>         Discount:  103.75,<br/>         TotalCost: 1971.25,<br/>      },<br/>      {<br/>         Id:        "PKG2",<br/>         Discount:  275,<br/>         TotalCost: 2475,<br/>      },<br/>      {<br/>         Id:        "PKG3",<br/>         Discount:  194.25,<br/>         TotalCost: 2580.75,<br/>      },<br/>      {<br/>         Id:        "PKG4",<br/>         Discount:  0,<br/>         TotalCost: 2725,<br/>      },<br/>   }}<br/>   actual := ceSvc.CalculateAllPackagesCost(input)<br/><br/>   assert.Equal(t, expected, actual)<br/>}</span></pre><blockquote class="lg lh li"><p id="f0d6" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">套餐选择服务</p></blockquote><p id="e4dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本上，该服务使用“组合和递归策略”来选择包。</p><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="56c2" class="nj kj in nf b gy nk nl l nm nn">package service<br/><br/>import "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/><br/>type PackageSelectionService struct{}<br/><br/>func ProvidePackageSelectionService() PackageSelectionService {<br/>   return PackageSelectionService{}<br/>}<br/><br/>func (ps PackageSelectionService) SelectPackages(pkgs []model.Package, limit float32) []model.Package {<br/>   if len(pkgs) == 0 {<br/>      return nil<br/>   }<br/><br/>   if len(pkgs) == 1 {<br/>      return pkgs<br/>   }<br/><br/>   ps.SortPackages(pkgs)<br/><br/>   allCombinations := make([][]model.Package, 0)<br/>   combinations := make([]model.Package, 0)<br/><br/>   copyPkgs := make([]model.Package, len(pkgs))<br/>   copy(copyPkgs, pkgs)<br/><br/>   ps.getAllPkgCombinations(copyPkgs, &amp;allCombinations, combinations, 0, limit)<br/><br/>   return ps.getPkgsWithHighestNumberAndHighestWeight(allCombinations)<br/>}<br/><br/>func (ps PackageSelectionService) SortPackages(pkgs []model.Package) {<br/>   for i := 0; i &lt; len(pkgs); i++ {<br/>      maxWeightPkg := i<br/><br/>      for j := i + 1; j &lt; len(pkgs); j++ {<br/>         if pkgs[maxWeightPkg].Weight &lt; pkgs[j].Weight {<br/>            maxWeightPkg = j<br/>         }<br/>      }<br/><br/>      pkgs[i], pkgs[maxWeightPkg] = pkgs[maxWeightPkg], pkgs[i]<br/>   }<br/><br/>   for i := 0; i &lt; len(pkgs)-1; i++ {<br/>      if pkgs[i].Weight == pkgs[i+1].Weight &amp;&amp; pkgs[i].DistanceInKm &gt; pkgs[i+1].DistanceInKm {<br/>         pkgs[i], pkgs[i+1] = pkgs[i+1], pkgs[i]<br/>      }<br/>   }<br/>}<br/><br/>func (ps PackageSelectionService) getAllPkgCombinations(pkgs []model.Package, allCombinations *[][]model.Package, combination []model.Package, idx int, limit float32) {<br/>   lightestWt := ps.getLightestPkg(ps.getRemainingPkgs(pkgs, combination))<br/>   if limit &lt;= lightestWt {<br/>      if !ps.isPackagesPresent(combination, *allCombinations) {<br/>         c := make([]model.Package, len(combination))<br/>         copy(c, combination)<br/>         *allCombinations = append(*allCombinations, c)<br/>      }<br/>      return<br/>   }<br/><br/>   for i := idx; i &lt; len(pkgs); i++ {<br/>      if float32(pkgs[i].Weight) &gt; limit {<br/>         break<br/>      }<br/>      combination = append(combination, pkgs[i])<br/>      ps.getAllPkgCombinations(pkgs, allCombinations, combination, i+1, limit-float32(pkgs[i].Weight))<br/>      combination = combination[0 : len(combination)-1]<br/>   }<br/>}<br/><br/>func (ps PackageSelectionService) getLightestPkg(pkgs []model.Package) float32 {<br/>   if len(pkgs) == 0 {<br/>      return -1<br/>   }<br/><br/>   lightest := pkgs[0]<br/>   for _, p := range pkgs {<br/>      if p.Weight &lt; lightest.Weight {<br/>         lightest = p<br/>      }<br/>   }<br/>   return float32(lightest.Weight)<br/>}<br/><br/>func (ps PackageSelectionService) getRemainingPkgs(pkgs []model.Package, currPkgs []model.Package) []model.Package {<br/>   remainingPkgs := make([]model.Package, 0)<br/>   for _, p := range pkgs {<br/>      if !ps.isPackagePresent(p, currPkgs) {<br/>         remainingPkgs = append(remainingPkgs, p)<br/>      }<br/>   }<br/><br/>   return remainingPkgs<br/>}<br/><br/>func (ps PackageSelectionService) isPackagePresent(pkg model.Package, currPkgs []model.Package) bool {<br/>   for _, p := range currPkgs {<br/>      if p.Id == pkg.Id {<br/>         return true<br/>      }<br/>   }<br/><br/>   return false<br/>}<br/><br/>func (ps PackageSelectionService) isPackagesPresent(pkgs []model.Package, allPkgCombinations [][]model.Package) bool {<br/>   for _, pcs := range allPkgCombinations {<br/>      if len(ps.getRemainingPkgs(pcs, pkgs)) == 0 {<br/>         return true<br/>      }<br/>   }<br/><br/>   return false<br/>}<br/><br/>func (ps PackageSelectionService) getPkgsWithHighestNumberAndHighestWeight(allPkgCombinations [][]model.Package) []model.Package {<br/>   highest := float32(0)<br/>   longest := 0<br/>   var selectedPkgs []model.Package<br/>   for _, pkgs := range allPkgCombinations {<br/>      if wt := ps.getPkgsCombinedWeight(pkgs); wt &gt; highest &amp;&amp; len(pkgs) &gt;= longest {<br/>         longest = len(pkgs)<br/>         highest = wt<br/>         selectedPkgs = pkgs<br/>      }<br/>   }<br/><br/>   return selectedPkgs<br/>}<br/><br/>func (ps PackageSelectionService) getPkgsCombinedWeight(pkgs []model.Package) float32 {<br/>   wt := 0<br/>   for _, p := range pkgs {<br/>      wt += p.Weight<br/>   }<br/>   return float32(wt)<br/>}</span></pre><blockquote class="lg lh li"><p id="2275" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">包选择服务:测试</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="c274" class="nj kj in nf b gy nk nl l nm nn">package service_test<br/><br/>import (<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/service"<br/>   "github.com/stretchr/testify/assert"<br/>   "testing"<br/>)<br/><br/>func TestSortPackages_ShouldSortInDescendingOrderByWeight(t *testing.T) {<br/>   pkgs := []model.Package{<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       190,<br/>         DistanceInKm: 150,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       240,<br/>         DistanceInKm: 55,<br/>         OfferCode:    "OFR002",<br/>      },<br/>   }<br/><br/>   expected := []model.Package{<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       240,<br/>         DistanceInKm: 55,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       190,<br/>         DistanceInKm: 150,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR003",<br/>      },<br/>   }<br/><br/>   pkgSortingSvc := service.ProvidePackageSelectionService()<br/>   pkgSortingSvc.SortPackages(pkgs)<br/><br/>   assert.Equal(t, expected, pkgs)<br/>}<br/><br/>func TestSortPackages_ShouldSortInDescendingOrderByWeightAndIncreasingOrderByDistanceIfWeightMatch(t *testing.T) {<br/>   pkgs := []model.Package{<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       145,<br/>         DistanceInKm: 150,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       240,<br/>         DistanceInKm: 55,<br/>         OfferCode:    "OFR002",<br/>      },<br/>   }<br/><br/>   expected := []model.Package{<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       240,<br/>         DistanceInKm: 55,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       145,<br/>         DistanceInKm: 105,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       145,<br/>         DistanceInKm: 150,<br/>         OfferCode:    "OFR001",<br/>      },<br/>   }<br/><br/>   pkgSortingSvc := service.ProvidePackageSelectionService()<br/>   pkgSortingSvc.SortPackages(pkgs)<br/><br/>   assert.Equal(t, expected, pkgs)<br/>}<br/><br/>func TestPackageSorting_SelectPackages(t *testing.T) {<br/>   packages := []model.Package{<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       50,<br/>         DistanceInKm: 30,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       75,<br/>         DistanceInKm: 125,<br/>         OfferCode:    "OFR008",<br/>      },<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       175,<br/>         DistanceInKm: 100,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG4",<br/>         Weight:       110,<br/>         DistanceInKm: 60,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG5",<br/>         Weight:       155,<br/>         DistanceInKm: 95,<br/>         OfferCode:    "",<br/>      },<br/>   }<br/><br/>   limit := float32(200)<br/><br/>   expected := []model.Package{<br/>      {<br/>         Id:           "PKG4",<br/>         Weight:       110,<br/>         DistanceInKm: 60,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       75,<br/>         DistanceInKm: 125,<br/>         OfferCode:    "OFR008",<br/>      },<br/>   }<br/><br/>   pkgSvc := service.ProvidePackageSelectionService()<br/>   actual := pkgSvc.SelectPackages(packages, limit)<br/><br/>   assert.ElementsMatch(t, expected, actual)<br/>}</span></pre><blockquote class="lg lh li"><p id="0ec4" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">交货估计服务</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="b46a" class="nj kj in nf b gy nk nl l nm nn">package service<br/><br/>import (<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/>   "strconv"<br/>   "strings"<br/>)<br/><br/>const BITSIZE_32 = 32<br/><br/>type DeliveryEstimationService struct {<br/>   pkgSortingSvc PackageSelectionService<br/>}<br/><br/>func ProvideDeliveryEstimationService(pkgSortingSvc PackageSelectionService) DeliveryEstimationService {<br/>   return DeliveryEstimationService{pkgSortingSvc: pkgSortingSvc}<br/>}<br/><br/>func (des DeliveryEstimationService) FetchDeliveryEstimations(pkgs []model.Package, vehicles []model.Vehicle) map[string]float32 {<br/>   outputPkgsMap := make(map[string]float32)<br/><br/>   copyPkgs := make([]model.Package, len(pkgs))<br/>   copy(copyPkgs, pkgs)<br/>   currVehicle := 0<br/>   currTime := float32(0)<br/><br/>   for len(copyPkgs) &gt; 0 {<br/>      selectedPkgs := des.pkgSortingSvc.SelectPackages(copyPkgs, vehicles[currVehicle].MaxWeightLimit)<br/>      if selectedPkgs == nil {<br/>         break<br/>      }<br/><br/>      for _, sp := range selectedPkgs {<br/>         outputPkgsMap[sp.Id] = currTime + des.formatValue(float32(sp.DistanceInKm)/vehicles[currVehicle].MaxSpeedLimit)<br/>      }<br/><br/>      shipment := model.Shipment{Packages: selectedPkgs, Time: currTime}<br/>      vehicles[currVehicle].Shipments = append(vehicles[currVehicle].Shipments, shipment)<br/>      vehicles[currVehicle].NextAvailableTime = currTime + (des.formatValue(des.getHighestShipmentDeliveryTime(vehicles[currVehicle].MaxSpeedLimit, shipment)) * 2)<br/><br/>      copyPkgs = des.getRemainingPkgs(copyPkgs, selectedPkgs)<br/>      currVehicle += 1<br/><br/>      if currVehicle == len(vehicles) {<br/>         minVehicle := 0<br/>         minTime := vehicles[0].NextAvailableTime<br/>         if vehicles[0].NextAvailableTime &gt; vehicles[1].NextAvailableTime {<br/>            minVehicle = 1<br/>            minTime = vehicles[1].NextAvailableTime<br/>         }<br/><br/>         for i := 1; i &lt; len(vehicles); i++ {<br/>            if vehicles[minVehicle].NextAvailableTime &gt; vehicles[i].NextAvailableTime {<br/>               minVehicle = i<br/>               minTime = vehicles[i].NextAvailableTime<br/>            }<br/>         }<br/><br/>         currTime = minTime<br/>         currVehicle = minVehicle<br/>      }<br/>   }<br/><br/>   return outputPkgsMap<br/>}<br/><br/>func (des DeliveryEstimationService) getHighestShipmentDeliveryTime(maxSpeedLimit float32, shipment model.Shipment) float32 {<br/>   max := float32(0)<br/>   for _, p := range shipment.Packages {<br/>      currShipmentTime := float32(p.DistanceInKm) / maxSpeedLimit<br/>      max = des.max(max, currShipmentTime)<br/>   }<br/><br/>   return max<br/>}<br/><br/>func (des DeliveryEstimationService) max(a, b float32) float32 {<br/>   if a &gt; b {<br/>      return a<br/>   }<br/>   return b<br/>}<br/><br/>func (des DeliveryEstimationService) getLowestNextDeliveryVehicle(vehicles []model.Vehicle) int {<br/>   lowest := 0<br/><br/>   for i, v := range vehicles {<br/>      if v.NextAvailableTime &lt; vehicles[lowest].NextAvailableTime {<br/>         lowest = i<br/>      }<br/>   }<br/><br/>   return lowest<br/>}<br/><br/>func (des DeliveryEstimationService) getOutputPkgMap(outputPkgs []model.PackageOutput) map[string]model.PackageOutput {<br/>   outputPkgMap := make(map[string]model.PackageOutput)<br/><br/>   for _, p := range outputPkgs {<br/>      outputPkgMap[p.Id] = p<br/>   }<br/><br/>   return outputPkgMap<br/>}<br/><br/>func (des DeliveryEstimationService) getRemainingPkgs(pkgs []model.Package, currPkgs []model.Package) []model.Package {<br/>   remainingPkgs := make([]model.Package, 0)<br/>   for _, p := range pkgs {<br/>      if !des.isPackagePresent(p, currPkgs) {<br/>         remainingPkgs = append(remainingPkgs, p)<br/>      }<br/>   }<br/><br/>   return remainingPkgs<br/>}<br/><br/>func (des DeliveryEstimationService) isPackagePresent(pkg model.Package, currPkgs []model.Package) bool {<br/>   for _, p := range currPkgs {<br/>      if p.Id == pkg.Id {<br/>         return true<br/>      }<br/>   }<br/><br/>   return false<br/>}<br/><br/>func (des DeliveryEstimationService) formatValue(value float32) float32 {<br/>   strFloat := strconv.FormatFloat(float64(value), 'f', -1, BITSIZE_32)<br/>   strFloatParts := strings.Split(strFloat, ".")<br/>   strFloatParts[1] = strFloatParts[1][0:2]<br/>   strFloat = strings.Join(strFloatParts, ".")<br/>   res, _ := strconv.ParseFloat(strFloat, BITSIZE_32)<br/>   return float32(res)<br/>}</span></pre><blockquote class="lg lh li"><p id="0384" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">交付估计服务:测试</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="fd74" class="nj kj in nf b gy nk nl l nm nn">package service_test<br/><br/>import (<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/service"<br/>   "github.com/stretchr/testify/assert"<br/>   "testing"<br/>)<br/><br/>func TestDeliveryEstimationService_UpdateDeliveryEstimations(t *testing.T) {<br/>   vehicles := []model.Vehicle{<br/>      {<br/>         Id:                "VH1",<br/>         MaxSpeedLimit:     float32(70),<br/>         MaxWeightLimit:    float32(200),<br/>         Shipments:         make([]model.Shipment, 0),<br/>         NextAvailableTime: float32(0),<br/>      },<br/>      {<br/>         Id:                "VH2",<br/>         MaxSpeedLimit:     float32(70),<br/>         MaxWeightLimit:    float32(200),<br/>         Shipments:         make([]model.Shipment, 0),<br/>         NextAvailableTime: float32(0),<br/>      },<br/>   }<br/><br/>   packages := []model.Package{<br/>      {<br/>         Id:           "PKG1",<br/>         Weight:       50,<br/>         DistanceInKm: 30,<br/>         OfferCode:    "OFR001",<br/>      },<br/>      {<br/>         Id:           "PKG2",<br/>         Weight:       75,<br/>         DistanceInKm: 125,<br/>         OfferCode:    "OFR008",<br/>      },<br/>      {<br/>         Id:           "PKG3",<br/>         Weight:       175,<br/>         DistanceInKm: 100,<br/>         OfferCode:    "OFR003",<br/>      },<br/>      {<br/>         Id:           "PKG4",<br/>         Weight:       110,<br/>         DistanceInKm: 60,<br/>         OfferCode:    "OFR002",<br/>      },<br/>      {<br/>         Id:           "PKG5",<br/>         Weight:       155,<br/>         DistanceInKm: 95,<br/>         OfferCode:    "",<br/>      },<br/>   }<br/><br/>   pkgSortSvc := service.ProvidePackageSelectionService()<br/>   deSvc := service.ProvideDeliveryEstimationService(pkgSortSvc)<br/><br/>   expected := map[string]float32{<br/>      "PKG1": float32(3.98),<br/>      "PKG2": float32(1.78),<br/>      "PKG3": float32(1.42),<br/>      "PKG4": float32(0.85),<br/>      "PKG5": float32(4.19),<br/>   }<br/><br/>   actual := deSvc.FetchDeliveryEstimations(packages, vehicles)<br/>   assert.Equal(t, expected, actual)<br/>}</span></pre><blockquote class="lg lh li"><p id="9dd7" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">主要方法:接线</p></blockquote><pre class="mc md me mf gt ne nf ng nh aw ni bi"><span id="0ddf" class="nj kj in nf b gy nk nl l nm nn">package main<br/><br/>import (<br/>   "bufio"<br/>   "fmt"<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/model"<br/>   "github.com/hiteshpattanayak-tw/courier_service/internal/app/service"<br/>   "log"<br/>   "os"<br/>   "strconv"<br/>   "strings"<br/>)<br/><br/>const BITSIZE_32 = 32<br/><br/>func main() {<br/>   reader := bufio.NewReader(os.Stdin)<br/>   fmt.Println("Enter base delivery cost and number of packages in the format: &lt;base_delivery_cost&gt; &lt;no_of_packages&gt;")<br/>   input, _ := reader.ReadString('\n')<br/><br/>   parts := strings.Split(strings.TrimSpace(input), " ")<br/>   if len(parts) != 2 {<br/>      log.Fatal("invalid input, format should be: &lt;base_delivery_cost&gt; &lt;no_of_packages&gt;")<br/>   }<br/><br/>   baseDeliveryCost, err := strconv.Atoi(parts[0])<br/>   if err != nil {<br/>      log.Fatal("invalid entry for base_delivery_cost")<br/>   }<br/><br/>   noOfPackages, err := strconv.Atoi(parts[1])<br/>   if err != nil {<br/>      log.Fatal("invalid entry for no_of_packages")<br/>   }<br/><br/>   packages := make([]model.Package, 0)<br/>   for i := 0; i &lt; noOfPackages; i++ {<br/>      fmt.Println("Enter package info in the format: &lt;pkg_id&gt; &lt;weight_in_kg&gt; &lt;distance_in_km&gt; &lt;offer_code&gt;")<br/>      input, _ = reader.ReadString('\n')<br/><br/>      parts = strings.Split(strings.TrimSpace(input), " ")<br/>      if len(parts) != 4 {<br/>         log.Fatal("invalid input, format should be: &lt;pkg_id&gt; &lt;weight_in_kg&gt; &lt;distance_in_km&gt; &lt;offer_code&gt;")<br/>      }<br/>      pkgId := parts[0]<br/><br/>      weight, err := strconv.Atoi(parts[1])<br/>      if err != nil {<br/>         log.Fatal("invalid entry for weight")<br/>      }<br/><br/>      distance, err := strconv.Atoi(parts[2])<br/>      if err != nil {<br/>         log.Fatal("invalid entry for distance")<br/>      }<br/><br/>      offerCode := parts[3]<br/><br/>      pkg := model.Package{<br/>         Id:           pkgId,<br/>         Weight:       weight,<br/>         DistanceInKm: distance,<br/>         OfferCode:    offerCode,<br/>      }<br/><br/>      packages = append(packages, pkg)<br/>   }<br/><br/>   inputPkgDetails := model.PackageInputFormat{<br/>      BaseDeliveryCost: baseDeliveryCost,<br/>      NoOfPackages:     noOfPackages,<br/>      Packages:         packages,<br/>   }<br/><br/>   fmt.Println("Enter vehicle details in the format: &lt;no_of_vehicles&gt; &lt;max_speed_limit&gt; &lt;max_carry_weight&gt;")<br/>   input, _ = reader.ReadString('\n')<br/><br/>   parts = strings.Split(strings.TrimSpace(input), " ")<br/>   if len(parts) != 3 {<br/>      log.Fatal("invalid input, format should be: &lt;no_of_vehicles&gt; &lt;max_speed_limit&gt; &lt;max_carry_weight&gt;")<br/>   }<br/><br/>   noOfVehicles, err := strconv.Atoi(parts[0])<br/>   if err != nil {<br/>      log.Fatal("invalid entry for no_of_vehicles")<br/>   }<br/><br/>   speedLimit, err := strconv.Atoi(parts[1])<br/>   if err != nil {<br/>      log.Fatal("invalid entry for max_speed_limit")<br/>   }<br/><br/>   weightLimit, err := strconv.Atoi(parts[2])<br/>   if err != nil {<br/>      log.Fatal("invalid entry for max_carry_weight")<br/>   }<br/><br/>   vehicles := make([]model.Vehicle, noOfVehicles)<br/><br/>   for i := 0; i &lt; noOfVehicles; i++ {<br/>      v := model.Vehicle{<br/>         Id:                fmt.Sprintf("VH%d", i),<br/>         MaxWeightLimit:    float32(weightLimit),<br/>         MaxSpeedLimit:     float32(speedLimit),<br/>         Shipments:         make([]model.Shipment, 0),<br/>         NextAvailableTime: 0,<br/>      }<br/><br/>      vehicles[i] = v<br/>   }<br/><br/>   ceSvc := service.ProvideCostEstimationService()<br/>   output := ceSvc.CalculateAllPackagesCost(inputPkgDetails)<br/><br/>   psSvc := service.ProvidePackageSelectionService()<br/>   deSvc := service.ProvideDeliveryEstimationService(psSvc)<br/>   pkgDeliveryTimings := deSvc.FetchDeliveryEstimations(packages, vehicles)<br/><br/>   for i,p := range output.Packages {<br/>      output.Packages[i].DeliveryTimeInHrs = pkgDeliveryTimings[p.Id]<br/>   }<br/><br/>   for _, pkg := range output.Packages {<br/>      fmt.Printf("%s %s %s %f\n", pkg.Id, formatValue(pkg.Discount), formatValue(pkg.TotalCost), formatValue(pkg.DeliveryTimeInHrs))<br/>   }<br/>}<br/><br/>func formatValue(value float32) string {<br/>   return strconv.FormatFloat(float64(value), 'f', -1, BITSIZE_32)<br/>}</span></pre><blockquote class="lg lh li"><p id="d3b0" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">链接到代码库</p></blockquote><p id="c182" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">喜欢回购里的代码请留个星。</p><div class="no np gp gr nq nr"><a href="https://github.com/HiteshRepo/CourierService" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd io gy z fp nw fr fs nx fu fw im bi translated">GitHub-HiteshRepo/快递服务</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ml nr"/></div></div></a></div><blockquote class="lg lh li"><p id="771a" class="jk jl lj jm b jn jo jp jq jr js jt ju lk jw jx jy ll ka kb kc lm ke kf kg kh ig bi translated">结束注释</p></blockquote><p id="a6eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请评论可以做出的改进。</p><p id="02fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">也请在代码库留下一个公关，以改善解决方案。</p><p id="2312" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我本人会努力改进解决方案。</p></div></div>    
</body>
</html>