<html>
<head>
<title>Setting Focus For Accessibility In React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native中为可访问性设置焦点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-focus-for-accessibility-in-react-native-cd7bbe891c5d?source=collection_archive---------4-----------------------#2020-06-17">https://blog.devgenius.io/setting-focus-for-accessibility-in-react-native-cd7bbe891c5d?source=collection_archive---------4-----------------------#2020-06-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6573" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有时候你需要将焦点放在一个元素上。在我的例子中，我遇到了一个问题，一个模态打开时给了用户更多的信息，但是当模态关闭时，焦点回到了屏幕的顶部，而不是停留在元素上。这是一个可访问性问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/82a21613e5e555074b3b0604188aa8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xyebyMLkE38J5cA3uVY4w.jpeg"/></div></div></figure><p id="554b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将首先介绍您<em class="ku">可能</em>尝试实现的解决方案(在React中什么会起作用)，然后提供React本机键来关注元素的可访问性。</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="c64e" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">尝试1: useRef()</h1><p id="27a6" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">如果你有一个功能组件，你可能会像在React中那样使用useRef……然而，你可能会惊讶于你的尝试没有成功。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="e5e5" class="mk ld in mg b gy ml mm l mn mo"><strong class="mg io">import</strong> React, { useRef } from 'react';<br/><br/><strong class="mg io">const</strong> EditableField = () =&gt; {</span><span id="f6b2" class="mk ld in mg b gy mp mm l mn mo">  <strong class="mg io">const</strong> <!-- -->myElement<!-- --> = useRef();</span><span id="74cd" class="mk ld in mg b gy mp mm l mn mo">  <strong class="mg io">const</strong> onModalClose = () =&gt; {   <br/>      <!-- -->myElement<!-- -->.current.focus();<br/>  };</span><span id="27b8" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  return (<br/></strong>    <!-- --> &lt;View&gt;<br/>      &lt;TouchableOpacity<br/>        accessible<br/>        ref={myElement}<br/>        <strong class="mg io">onPress</strong>{() =&gt; {<br/>          Alert.alert(<br/>            'I am an alert',<br/>            'Which tells you more information',<br/>            [{ text: 'Okay', onPress: <strong class="mg io">onModalClose</strong> }],<br/>            { cancelable: true },<br/>          );<br/>        }}<br/>      &gt;<br/>      Click Me!<br/>      &lt;/TouchableOpacity&gt;<br/>   &lt;/View&gt;<br/>  )<br/>};<br/>};</span></pre><h1 id="ab9e" class="lc ld in bd le lf mq lh li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz bi translated">尝试2: createRef</h1><p id="4c29" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在我的例子中，我有一个大的类组件，所以我使用了<strong class="jm io"> createRef </strong>。我像往常一样为React组件编写代码。然而，这种方法不起作用。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="7eb6" class="mk ld in mg b gy ml mm l mn mo"><strong class="mg io">import</strong> React, { createRef } from 'react';<br/><strong class="mg io">import</strong> {  Alert, TouchableOpacity,  View } from 'react-native';</span><span id="040a" class="mk ld in mg b gy mp mm l mn mo">renderElement() {</span><span id="ec43" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const </strong>myElement = createRef();</span><span id="1133" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const</strong> onModalClose = () =&gt; {<br/>    if(myElement &amp;&amp; myElement.current) {<br/>        myElement.current.focus();<br/>    }<br/>  }</span><span id="f75a" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  return</strong> (<br/>    &lt;View&gt;<br/>      &lt;TouchableOpacity<br/>        accessible<br/>        ref={myElement}<br/>        <strong class="mg io">onPress</strong>{() =&gt; {<br/>          Alert.alert(<br/>            'I am an alert',<br/>            'Which tells you more information',<br/>            [{ text: 'Okay', onPress: <strong class="mg io">onModalClose</strong> }],<br/>            { cancelable: true },<br/>          );<br/>        }}<br/>      &gt;<br/>      Click Me!<br/>      &lt;/TouchableOpacity&gt;<br/>   &lt;/View&gt;<br/>  )<br/>};</span></pre><h1 id="824c" class="lc ld in bd le lf mq lh li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz bi translated">React Native解决方案的关键</h1><p id="dfc5" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">React本地解决方案的关键是两个要素:</p><p id="3cd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> findNodeHandle </strong>:获取组件的原生节点句柄</p><p id="8c60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> AccessibilityInfo </strong>:识别设备当前是否有活动的屏幕阅读器。</p><p id="21e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用这两个react-native元素，您可以像这样获取元素并设置焦点:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="ed65" class="mk ld in mg b gy ml mm l mn mo"><strong class="mg io">    const</strong> reactTag = findNodeHandle(myElement.current);<br/>    if (reactTag) {<br/>       AccessibilityInfo.setAccessibilityFocus(reactTag);<br/>    }</span></pre><h1 id="79b7" class="lc ld in bd le lf mq lh li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz bi translated">功能组件解决方案:</h1><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="2561" class="mk ld in mg b gy ml mm l mn mo"><strong class="mg io">import</strong> React, { <strong class="mg io">useRef</strong> } from 'react';<br/><strong class="mg io">import</strong> {  Alert, TouchableOpacity,  View,  AccessibilityInfo,  findNodeHandle } from 'react-native';</span><span id="2cf9" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">const</strong> EditableField = () =&gt; {</span><span id="93e7" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const</strong> <!-- -->myElement<!-- --> = <strong class="mg io">useRef</strong>();</span><span id="292e" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const</strong> onModalClose = () =&gt; {   <br/>  <!-- -->  if(myElement &amp;&amp; myElement.current) {<br/>        <strong class="mg io">const</strong> reactTag = findNodeHandle(myElement.current);<br/>        if (reactTag) {<br/>          AccessibilityInfo.setAccessibilityFocus(reactTag);<br/>        }<br/>     }<!-- -->  <br/>  };</span><span id="52a6" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">return (<br/></strong>    <!-- --> &lt;View&gt;<br/>      &lt;TouchableOpacity<br/>        accessible<br/>        ref={myElement}<br/>        <strong class="mg io">onPress</strong>{() =&gt; {<br/>          Alert.alert(<br/>            'I am an alert',<br/>            'Which tells you more information',<br/>            [{ text: 'Okay', onPress: <strong class="mg io">onModalClose</strong> }],<br/>            { cancelable: true },<br/>          );<br/>        }}<br/>      &gt;<br/>      Click Me!<br/>      &lt;/TouchableOpacity&gt;<br/>   &lt;/View&gt;<br/>  )<br/>};</span></pre><h1 id="308b" class="lc ld in bd le lf mq lh li lj mr ll lm ln ms lp lq lr mt lt lu lv mu lx ly lz bi translated">类组件的解决方案:</h1><p id="a673" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">虽然这种方法可能在web中有效，但对于React Native，有一种不同的方法。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="894a" class="mk ld in mg b gy ml mm l mn mo"><strong class="mg io">import</strong> React, { <strong class="mg io">createRef</strong> } from 'react';<br/><strong class="mg io">import</strong> {  Alert, TouchableOpacity,  View,  AccessibilityInfo,  findNodeHandle } from 'react-native';</span><span id="39c4" class="mk ld in mg b gy mp mm l mn mo">renderElement() {</span><span id="f819" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const </strong>myElement = <strong class="mg io">createRef</strong>();</span><span id="6e34" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  const</strong> onModalClose = () =&gt; {<br/>    if(myElement &amp;&amp; myElement.current){ // null check to satisfy TS<br/>        <strong class="mg io">const</strong> reactTag = findNodeHandle(myElement.current);<br/>        if (reactTag) {<br/>          AccessibilityInfo.setAccessibilityFocus(reactTag);<br/>        }<br/>     }<br/>    }</span><span id="8804" class="mk ld in mg b gy mp mm l mn mo"><strong class="mg io">  return</strong> (<br/>    &lt;View&gt;<br/>      &lt;TouchableOpacity<br/>        accessible<br/>        ref={ myElement }<br/>        <strong class="mg io">onPress</strong>{() =&gt; {<br/>          Alert.alert(<br/>            'I am an alert',<br/>            'Which tells you more information',<br/>            [{ text: 'Okay', onPress: <strong class="mg io">onModalClose</strong> }],<br/>            { cancelable: true },<br/>          );<br/>        }}<br/>      &gt;<br/>      Click Me!<br/>      &lt;/TouchableOpacity&gt;<br/>   &lt;/View&gt;<br/>  )<br/>};</span></pre></div></div>    
</body>
</html>