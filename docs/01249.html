<html>
<head>
<title>Handling loading and error states the right way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">正确处理加载和错误状态</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/handling-loading-and-error-states-the-right-way-a9bbefd0d7cc?source=collection_archive---------11-----------------------#2020-06-28">https://blog.devgenius.io/handling-loading-and-error-states-the-right-way-a9bbefd0d7cc?source=collection_archive---------11-----------------------#2020-06-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0e0f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用状态对象</h2></div><p id="6fbe" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">前几天，我偶然发现了Nicklas Millard写的一篇关于我们应该如何<a class="ae ky" href="https://medium.com/swlh/stop-using-if-else-statements-f4d2323e6e4" rel="noopener">停止使用If-Else语句</a>的文章，这让我思考我到底应该如何处理数据丰富的组件状态。</p><p id="8bc6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我敢打赌，您以前见过这种Redux模式，并且当您需要在组件中获取数据时处理加载和错误状态时，可能会经常使用它。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/3a37abd70e395c26bfb2ba9d0bf9f9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csA9bBatu4sxiTnavzyp4Q.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">处理加载和错误状态的糟糕方式</figcaption></figure><p id="2fc7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你不能发现这个代码的问题，那么这个故事很可能适合你。</p><p id="fb70" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种模式的问题是，您允许您的组件进入“假”状态，并且这也使得在其他组件中保持一致变得更加困难，在这种情况下，您检查加载和错误标志的顺序是一致的。</p><blockquote class="lp"><p id="b5f1" class="lq lr in bd ls lt lu lv lw lx ly kx dk translated">多种渲染条件会让你陷入不一致和复杂的混乱中。</p></blockquote><h2 id="1263" class="lz ma in bd mb mc md dn me mf mg dp mh kl mi mj mk kp ml mm mn kt mo mp mq mr bi translated">问题是</h2><p id="4678" class="pw-post-body-paragraph kc kd in ke b kf ms jo kh ki mt jr kk kl mu kn ko kp mv kr ks kt mw kv kw kx ig bi translated">例如，如果<code class="fe mx my mz na b">isLoading</code>和<code class="fe mx my mz na b">hasError</code>都是<code class="fe mx my mz na b">true</code>，你应该渲染什么？无论您做出什么决定，您都必须为所有未来的组件记住这一点，以便它们的行为是相同的。</p><p id="a073" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果<code class="fe mx my mz na b">hasError</code>是<code class="fe mx my mz na b">true</code>，但是有数据可以显示给用户呢？您只是在重试请求时忘记了重置<code class="fe mx my mz na b">hasError</code>属性。</p><p id="2c72" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当你开始引入更多在给定时间渲染什么的条件时，这很快就会变得一团糟。<br/>假设您也想在获取成功时呈现一些帮助文本，但是列表中没有用户。你最终会用一堆If-Else和令人困惑的<code class="fe mx my mz na b">hasError</code>、<code class="fe mx my mz na b">isLoading</code>和<code class="fe mx my mz na b">hasData</code>的组合来实现想要的结果，然后你必须向下一个开发人员解释，通过到处散布评论来打开这个噩梦。</p><h2 id="ac66" class="lz ma in bd mb mc nb dn me mf nc dp mh kl nd mj mk kp ne mm mn kt nf mp mq mr bi translated">那么我该如何解决这个问题呢？</h2><p id="f6b5" class="pw-post-body-paragraph kc kd in ke b kf ms jo kh ki mt jr kk kl mu kn ko kp mv kr ks kt mw kv kw kx ig bi translated">简单回答:使用状态对象。</p><p id="6149" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你应该引入状态对象，以确保只有有限数量的状态，并且一旦决定了如何计算它们，就可以重用这个逻辑。</p><p id="5861" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这样做的目的是让代码对下一个需要做出改变的开发人员来说是可读和容易理解的。</p><p id="0cb6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">利用选择器可以很容易地做到这一点——这实际上也使测试变得更容易，因为您已经隔离了计算逻辑。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ng"><img src="../Images/f8657924e7b7ab7b878a03f394c4e21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GC--uqeVFjWidm2Sr905wQ.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">基于存储中的数据计算状态</figcaption></figure><p id="2f35" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过这种方式，我们可以为每个资源重用这个代码片段，并隔离测试选择器，这样我们在任何地方都有相同的行为，并且添加新的状态将非常容易，因为您只需在一个地方添加它们。</p><p id="49f1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这也意味着你不会有开发人员忘记处理其中一个状态的风险，因为他们的编辑很可能会因为没有在他们的<code class="fe mx my mz na b">switch</code>中处理所有<code class="fe mx my mz na b">ViewState</code>的情况而对他们大喊大叫。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nh"><img src="../Images/1ddba80abbfd38f24064e86bfac9e427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RiapiZwCgQgy1zW06nQL6g.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">处理状态的正确方式</figcaption></figure><p id="9a36" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如您在最终结果中看到的，我们将计算部分从组件中移出，现在可以安全地呈现已经定义的有限状态集。</p><p id="97eb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它更清晰，更容易阅读，更容易测试——并且没有可能以奇怪的状态结束，我们都显示一个加载指示器和一个错误消息。<em class="ni">此外，我们还清理了一些代码，减少了这么多不同的选择器。</em></p><h2 id="e74a" class="lz ma in bd mb mc nb dn me mf nc dp mh kl nd mj mk kp ne mm mn kt nf mp mq mr bi translated">资源</h2><div class="nj nk gp gr nl nm"><a href="https://www.jetbrains.com/help/idea/replace-conditional-logic-with-strategy-pattern.html#af8cfbe7" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd io gy z fp nr fr fs ns fu fw im bi translated">用策略模式替换条件逻辑</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">当你有一个包含大量条件逻辑(例如if语句)的方法时，你就是在自找麻烦。有条件…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.jetbrains.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa lj nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a href="https://medium.com/swlh/stop-using-if-else-statements-f4d2323e6e4" rel="noopener follow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd io gy z fp nr fr fs ns fu fw im bi translated">停止使用If-Else语句</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">编写干净、可维护的代码，不使用if-else。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">medium.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa lj nm"/></div></div></a></div><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f6ef5a86bb16b9713f7682583b40a099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*R2H_dykS9HNOBQjitRpl_Q.png"/></div></figure><p id="4359" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> Jakob Gaard Andersen </strong>是一家发展最快的银行的软件工程师，他在React中开发面向客户的应用程序。在担任目前的职位之前，他曾就职于四大咨询公司之一，并在诺和诺德、rsted、丹麦劳动力市场和招聘机构以及丹麦税务部的多个项目中发挥了自己的技能。</p><p id="8e48" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ni">连接上</em> <a class="ae ky" href="https://www.linkedin.com/in/jakob-gaard-andersen/" rel="noopener ugc nofollow" target="_blank"> <em class="ni"> LinkedIn </em> </a></p></div></div>    
</body>
</html>