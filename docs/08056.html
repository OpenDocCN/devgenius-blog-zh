<html>
<head>
<title>PyScript — Making HTTP Requests — Best Approach | Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyScript —发出 HTTP 请求—最佳方法|教程</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/pyscript-making-http-requests-best-approach-tutorial-8ae062438335?source=collection_archive---------1-----------------------#2022-05-14">https://blog.devgenius.io/pyscript-making-http-requests-best-approach-tutorial-8ae062438335?source=collection_archive---------1-----------------------#2022-05-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="3da3" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">PyScript 的延续——构建 HTML 网站的新方法。</h2><div class=""/><div class=""><h2 id="f1eb" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">向您介绍使用 PyScript 进行 HTTP 请求的分步教程</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9b1277607e134b07081536232ccf320c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1K8J7daRC845ip71RPucvg.gif"/></div></div></figure><p id="ed72" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi lt translated"><span class="l lu lv lw bm lx ly lz ma mb di"> M </span>在<a class="ae mc" rel="noopener ugc nofollow" target="_blank" href="/pyscript-a-new-way-of-building-html-websites-tutorial-for-beginners-67a75935e039"> PyScript </a>中发出请求是一个热门话题，因为 python 的流行模块<code class="fe md me mf mg b">requests</code> <strong class="kz ix">在 Pyodide 中不被支持</strong>。幸运的是，在 PyScript 中还有其他方法来发出<strong class="kz ix"> HTTP 请求</strong>。</p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="668c" class="mo mp in bd mq mr ms mt mu mv mw mx my kc mz kd na kf nb kg nc ki nd kj ne nf bi translated">方法 1 —使用 Pyodide 的 pyfetch(最佳方法)</h1><p id="615f" class="pw-post-body-paragraph kx ky in kz b la ng jx lc ld nh ka lf lg ni li lj lk nj lm ln lo nk lq lr ls ig bi translated">由于 PyScript 是在 pyodide 之上构建的，所以您可以使用 pyodide  中的<a class="ae mc" href="https://pyodide.org/en/stable/usage/api/python-api.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ix">任何</strong> <strong class="kz ix"> API </strong> <strong class="kz ix">。</strong></a></p><h2 id="9230" class="nl mp in bd mq nm nn dn mu no np dp my lg nq nr na lk ns nt nc lo nu nv ne it bi translated">但是..什么是真正的 pyfetch？</h2><p id="699e" class="pw-post-body-paragraph kx ky in kz b la ng jx lc ld nh ka lf lg ni li lj lk nj lm ln lo nk lq lr ls ig bi translated">根据 pyodide 的文档，pyfetch 是 JavaScript fetch 的包装器。</p><blockquote class="nw nx ny"><p id="82bd" class="kx ky nz kz b la lb jx lc ld le ka lf oa lh li lj ob ll lm ln oc lp lq lr ls ig bi translated">Pyodide 提供了<code class="fe md me mf mg b"><em class="in">pyodide.http.pyfetch</em></code>，这是一个方便的 JavaScript <code class="fe md me mf mg b"><em class="in">fetch</em></code>的<strong class="kz ix">包装器</strong>。</p></blockquote><p id="c9e3" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">相对于 python 的<strong class="kz ix">未支持的</strong>模块<strong class="kz ix">请求</strong>、<strong class="kz ix"> </strong>来说，<strong class="kz ix"> </strong> <code class="fe md me mf mg b">fetch</code> <strong class="kz ix">是异步的</strong>。</p><blockquote class="nw nx ny"><p id="522a" class="kx ky nz kz b la lb jx lc ld le ka lf oa lh li lj ob ll lm ln oc lp lq lr ls ig bi translated">主要问题是<code class="fe md me mf mg b">requests</code> <strong class="kz ix">是同步</strong>而<code class="fe md me mf mg b">fetch</code> <strong class="kz ix">是异步</strong>。可以用<code class="fe md me mf mg b">XMLHttpRequest</code>进行同步调用，但是<strong class="kz ix">不能支持很多选项，效率也不是很高</strong>。</p></blockquote></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><p id="99c9" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们来看看<code class="fe md me mf mg b"><em class="nz">pyodide.http.pyfetch</em></code>的定义</p><pre class="km kn ko kp gt od mg oe of aw og bi"><span id="88a0" class="nl mp in mg b gy oh oi l oj ok">async http.pyfetch(url: str, **kwargs) → pyodide.http.FetchResponse<!-- --> </span></pre><p id="6d38" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">文档指出<code class="fe md me mf mg b">**kwargs</code> <strong class="kz ix">可以是用于<a class="ae mc" href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#parameters" rel="noopener ugc nofollow" target="_blank"> Javascript 的获取 API </a>的可选<strong class="kz ix">参数</strong>中的任何一个</strong>。</p><p id="0dab" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这些参数包括<code class="fe md me mf mg b">body</code>、<code class="fe md me mf mg b">headers</code>、<code class="fe md me mf mg b">method</code></p><pre class="km kn ko kp gt od mg oe of aw og bi"><span id="3fb0" class="nl mp in mg b gy oh oi l oj ok">from pyodide.http import pyfetch<br/>import asyncio</span><span id="b769" class="nl mp in mg b gy ol oi l oj ok">response = await pyfetch(url="https://jsonplaceholder.typicode.com/todos/1", method="GET")</span><span id="7ffe" class="nl mp in mg b gy ol oi l oj ok">output = f"GET request=&gt; status:{response.status}, json:{await response.json()}"</span></pre><p id="da8a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这里的<strong class="kz ix">最重要的</strong>是你<strong class="kz ix">必须</strong>导入<code class="fe md me mf mg b">asyncio</code>包，否则会得到<strong class="kz ix">奇怪的错误</strong>。这个<strong class="kz ix"> <em class="nz">未记录的细节</em> </strong>困扰了我好几个小时。幸运的是，我找到了<a class="ae mc" href="https://www.jhanley.com/pyscript-loading-python-code-in-the-browser/" rel="noopener ugc nofollow" target="_blank">一篇很棒的文章</a>帮助了我。希望当你阅读这篇文章时，这个问题已经解决了。</p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><p id="c217" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">使用<code class="fe md me mf mg b">pyfetch</code>的<code class="fe md me mf mg b">HTTP GET</code> <strong class="kz ix">请求</strong>的<strong class="kz ix">完全工作</strong>示例:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="oo op gj gh gi oq or bd b be z dk translated">用于 HTTP 请求的 PyScript 和 pyfetch</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/531f3a18d400312b93a3107c9aa7b0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_0Rf5OIfjMmMptELTxs6w.png"/></div></div><figcaption class="oo op gj gh gi oq or bd b be z dk translated">使用 pyfetch 的简单 GET HTTP 请求</figcaption></figure></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="d803" class="mo mp in bd mq mr ms mt mu mv mw mx my kc mz kd na kf nb kg nc ki nd kj ne nf bi translated">方法#2 — <code class="fe md me mf mg b"><em class="ot">XMLHttpRequest</em> </code>和其他 JS 功能</h1><p id="b9c2" class="pw-post-body-paragraph kx ky in kz b la ng jx lc ld nh ka lf lg ni li lj lk nj lm ln lo nk lq lr ls ig bi translated">在<strong class="kz ix"> PyScript </strong>中生成<strong class="kz ix"> HTTP 请求</strong>的第二种方法是使用其他<strong class="kz ix"> JavaScript 函数</strong>。使用<strong class="kz ix"> JS 模块</strong>可以调用 PyScript 中的<strong class="kz ix">任何</strong> javascript 函数/对象。(关于<strong class="kz ix">使用<strong class="kz ix"> JS 模块</strong> <a class="ae mc" rel="noopener ugc nofollow" target="_blank" href="/pyscript-a-new-way-of-building-html-websites-tutorial-for-beginners-67a75935e039">访问 HTML DOM &amp;事件</a></strong>的例子，点击这里)。</p><pre class="km kn ko kp gt od mg oe of aw og bi"><span id="f296" class="nl mp in mg b gy oh oi l oj ok">from js import XMLHttpRequest<br/><br/>req = XMLHttpRequest.new()<br/>req.open("GET", "<!-- -->https://jsonplaceholder.typicode.com/todos/1<!-- -->", False)<br/>req.send(None)<br/>output = str(req.response)</span></pre><blockquote class="nw nx ny"><p id="1bab" class="kx ky nz kz b la lb jx lc ld le ka lf oa lh li lj ob ll lm ln oc lp lq lr ls ig bi translated">记住，如果你以这种方式使用<code class="fe md me mf mg b">XMLHttpRequest</code>,你需要发出一个有一些实际原始输出/ json 的 web 请求。如果没有，它会弹出一个 CORS 错误，如果你愿意，你可以在浏览器中禁用这个 tho。</p></blockquote><p id="94d0" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">使用<code class="fe md me mf mg b">XMLHttpRequest</code>的<strong class="kz ix">请求</strong>的<strong class="kz ix">完全工作</strong>示例:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="oo op gj gh gi oq or bd b be z dk translated">用于 HTTP 请求的带有<code class="fe md me mf mg b">XMLHttpRequest</code>的 PyScript</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/5bfcac6eabf61b683a5274f7ad0871b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qibo1NfQ5lLMXdl8vGTp3A.png"/></div></div><figcaption class="oo op gj gh gi oq or bd b be z dk translated">使用<code class="fe md me mf mg b">XMLHttpRequest</code>的简单 GET HTTP 请求</figcaption></figure></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="635e" class="mo mp in bd mq mr ms mt mu mv mw mx my kc mz kd na kf nb kg nc ki nd kj ne nf bi translated">结论</h1><p id="73f4" class="pw-post-body-paragraph kx ky in kz b la ng jx lc ld nh ka lf lg ni li lj lk nj lm ln lo nk lq lr ls ig bi translated">总之，PyScript 中的请求并不难掌握。它们只是现有<code class="fe md me mf mg b"><em class="nz">JavaScript</em></code>函数的<strong class="kz ix">包装器</strong>。</p><p id="43f3" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我不想在这里深究细节，关键是你可以像在<code class="fe md me mf mg b">JavaScript</code>中一样在<code class="fe md me mf mg b">PyScript</code>中发出<strong class="kz ix"> HTTP GET / POST </strong> / etc <strong class="kz ix">请求</strong>。如果你想了解更多关于<strong class="kz ix">JavaScript API</strong>的知识，我建议你去<strong class="kz ix">前查看文档</strong>。</p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><p id="d1ec" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi lt translated">感谢你阅读这篇文章。想要<strong class="kz ix">深入</strong>进入<em class="nz"> PyScript </em>，<strong class="kz ix">跟我来</strong>。我将很快写更多关于 PyScript<em class="nz">的<strong class="kz ix">高级指南</strong>，包括 PyScript 中的<em class="nz"/><strong class="kz ix">最新元素</strong>(py-inputbox、py-box、py-button、py-register-widget 等)<em class="nz">。</em></em></p></div></div>    
</body>
</html>