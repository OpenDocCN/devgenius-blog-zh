<html>
<head>
<title>Python — Packaging Artifact Using Nuitka!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">python——使用 Nuitka 打包工件！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/python-packaging-artifact-using-nuitka-195f4719a9db?source=collection_archive---------1-----------------------#2022-06-05">https://blog.devgenius.io/python-packaging-artifact-using-nuitka-195f4719a9db?source=collection_archive---------1-----------------------#2022-06-05</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="b699" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用 Nuitka 将 Python 代码打包成二进制文件</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/61564fff87d53ae46337a796cc317a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScB4PGTVq3wv0T5bgsz2vg.png"/></div></div></figure><p id="b671" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">你可能已经使用<code class="fe lo lp lq lr b"><em class="ls">pyintaller</em></code> <em class="ls"> </em>来打包你的 Python 代码<em class="ls">。</em>今天我要介绍另一个将你的 Python 代码打包成二进制格式的工具，它叫做“<a class="ae lt" href="https://github.com/Nuitka/Nuitka" rel="noopener ugc nofollow" target="_blank"> Nuikta </a>”。取决于您的用例，当涉及到工件打包时，它可能是一个更好的选择。</p><p id="23cc" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><code class="fe lo lp lq lr b">Nuitka</code>是一个 Python 编译器。它是用 Python 写的。它是 Python 解释器的无缝替代或扩展，当它本身运行在那个 Python 版本上时，可以编译 CPython 2.6 ~ 3.10 的所有结构。然后，它以极其兼容的方式一起执行未编译的代码和编译的代码。</p><p id="0178" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">可以自由使用所有 Python 库模块和所有扩展模块。<code class="fe lo lp lq lr b">Nuitka</code>将 Python 模块翻译成 C 级程序，然后使用<code class="fe lo lp lq lr b">libpython</code>和它自己的静态 C 文件以与 CPython 相同的方式执行。</p><h1 id="c9fe" class="lu lv ir bd lw lx ly lz ma mb mc md me jx mf jy mg ka mh kb mi kd mj ke mk ml bi translated">pyinstaller vs Nuikta</h1><p id="fa35" class="pw-post-body-paragraph ks kt ir ku b kv mm js kx ky mn jv la lb mo ld le lf mp lh li lj mq ll lm ln ik bi translated">在以下情况下，您需要将 Python 代码打包成二进制格式:</p><ul class=""><li id="0e43" class="mr ms ir ku b kv kw ky kz lb mt lf mu lj mv ln mw mx my mz bi translated"><strong class="ku is">隐藏源代码:</strong>这里的<code class="fe lo lp lq lr b">pyinstaller</code>通过设置密钥对源代码进行加密；而<code class="fe lo lp lq lr b">nuitka</code>则将 python 源代码转换成 C++(这里得到的是二进制 pyd 文件，防止反编译)，然后编译成可执行文件。</li><li id="843f" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated"><strong class="ku is">易移植</strong>:用户使用方便，不需要安装任何 python，第三方包之类的。</li><li id="0dd2" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated"><strong class="ku is">性能:</strong>有时候<code class="fe lo lp lq lr b">pyinstaller</code>生成的二进制文件特别大，我遇到过这样的情况，pyinstaller 转换出来的最终 exe 文件是 3G，而<code class="fe lo lp lq lr b">Nuikta</code>只有 7MB！加上打包超级慢，pyinstaller 启动超级慢。</li></ul><h1 id="669e" class="lu lv ir bd lw lx ly lz ma mb mc md me jx mf jy mg ka mh kb mi kd mj ke mk ml bi translated">努特卡要求</h1><ul class=""><li id="92a0" class="mr ms ir ku b kv mm ky mn lb nf lf ng lj nh ln mw mx my mz bi translated">C 编译器:你需要一个支持 C11 或者 C++03 的编译器。</li><li id="d16c" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated"><strong class="ku is"> Python: </strong>版本 2.6、2.7 或 3.3、3.4、3.5、3.6、3.7、3.8、3.9、3.10</li><li id="2f35" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated"><strong class="ku is">操作系统:</strong> Linux，FreeBSD，NetBSD，macOS X，Windows (32/64 位)。</li><li id="8802" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated"><strong class="ku is">架构:</strong> x86、x86_64 (amd64)和 arm，可能还有更多</li></ul><h1 id="699c" class="lu lv ir bd lw lx ly lz ma mb mc md me jx mf jy mg ka mh kb mi kd mj ke mk ml bi translated">装置</h1><p id="3380" class="pw-post-body-paragraph ks kt ir ku b kv mm js kx ky mn jv la lb mo ld le lf mp lh li lj mq ll lm ln ik bi translated">对于大多数系统，在<code class="fe lo lp lq lr b">Nuitka</code>的<a class="ae lt" href="https://nuitka.net/doc/download.html" rel="noopener ugc nofollow" target="_blank">下载页面</a>上会有软件包。但是您也可以从源代码安装它，就像任何其他 Python 程序一样，它可以通过普通的<code class="fe lo lp lq lr b">python setup.py install</code>例程安装。你也可以使用<code class="fe lo lp lq lr b">pip install nuitka</code>。</p><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="ad82" class="nm lv ir lr b gz nn no l np nq">$ pip install nuitka<br/>Looking in indexes: <a class="ae lt" href="https://pypi.python.org/simple" rel="noopener ugc nofollow" target="_blank">https://pypi.python.org/simple</a><br/>Collecting nuitka<br/>  Downloading Nuitka-0.8.3.tar.gz (3.8 MB)<br/>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.8/3.8 MB 32.5 MB/s eta 0:00:00<br/>  Preparing metadata (setup.py) ... done<br/>Using legacy 'setup.py install' for nuitka, since package 'wheel' is not installed.<br/>Installing collected packages: nuitka<br/>  Running setup.py install for nuitka ... done<br/>Successfully installed nuitka-0.8.3</span></pre><h1 id="e9b4" class="lu lv ir bd lw lx ly lz ma mb mc md me jx mf jy mg ka mh kb mi kd mj ke mk ml bi translated">如何使用</h1><h2 id="c9d3" class="nm lv ir bd lw nr ns dn ma nt nu dp me lb nv nw mg lf nx ny mi lj nz oa mk ob bi translated">为 Python 代码创建一个文件夹</h2><ul class=""><li id="4039" class="mr ms ir ku b kv mm ky mn lb nf lf ng lj nh ln mw mx my mz bi translated"><code class="fe lo lp lq lr b">mkdir</code> HelloWorld</li><li id="6127" class="mr ms ir ku b kv na ky nb lb nc lf nd lj ne ln mw mx my mz bi translated">制作一个名为<code class="fe lo lp lq lr b">hello.py</code>的 python 文件，内容如下:</li></ul><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="5551" class="nm lv ir lr b gz nn no l np nq">def talk(message):<br/>    return "Talk " + message</span><span id="eee8" class="nm lv ir lr b gz oc no l np nq">def main():<br/>    print(talk("Hello World"))</span><span id="864b" class="nm lv ir lr b gz oc no l np nq">if __name__ == "__main__":<br/>    main()</span></pre><h2 id="8496" class="nm lv ir bd lw nr ns dn ma nt nu dp me lb nv nw mg lf nx ny mi lj nz oa mk ob bi translated">测试你的程序</h2><p id="68e6" class="pw-post-body-paragraph ks kt ir ku b kv mm js kx ky mn jv la lb mo ld le lf mp lh li lj mq ll lm ln ik bi translated">像平常一样做。在工作不正常的代码上运行 Nuitka 并不容易调试。</p><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="991c" class="nm lv ir lr b gz nn no l np nq">$ python hello.py<br/>Talk Hello World</span></pre><h2 id="d86f" class="nm lv ir bd lw nr ns dn ma nt nu dp me lb nv nw mg lf nx ny mi lj nz oa mk ob bi translated">使用构建它</h2><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="7945" class="nm lv ir lr b gz nn no l np nq">$ time python -m nuitka hello.py<br/>Nuitka-Options:INFO: Used command line options: hello.py<br/>Nuitka-Options:WARNING: You did not specify to follow or include anything but main program. Check options and make sure that is intended.<br/>Nuitka:WARNING: Using very slow fallback for ordered sets, please install 'ordered-set' or 'orderset' PyPI packages for best Python compile time performance.<br/>Nuitka:INFO: Starting Python compilation with Nuitka '0.8.3' on Python '3.10' commercial None.<br/>Nuitka:INFO: Completed Python level compilation and optimization.<br/>Nuitka:INFO: Generating source code for C backend compiler.<br/>Nuitka:INFO: Running data composer tool for optimal constant value handling.<br/>Nuitka:INFO: Running C compilation via Scons.<br/>Nuitka-Scons:INFO: Backend C compiler: clang (clang).<br/>Nuitka-Scons:INFO: Backend linking program (no progress information available).<br/>Nuitka-Scons:INFO: Compiled 10 C files using ccache.<br/>Nuitka-Scons:INFO: Cached C files (using ccache) with result 'cache hit': 9<br/>Nuitka:INFO: Keeping build directory 'hello.build'.<br/>Nuitka:INFO: Successfully created 'hello.bin'.<br/>python -m nuitka hello.py  1.37s user 0.68s system 93% cpu 2.193 total</span></pre><p id="8ac5" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><strong class="ku is">注意:这将提示您下载一个 C 缓存工具(以加速生成的 C 代码的重复编译)和一个基于 MinGW64 的 C 编译器，除非您安装了合适的 MSVC。这两个问题都说</strong> <code class="fe lo lp lq lr b"><strong class="ku is">yes</strong></code> <strong class="ku is">。</strong></p><p id="94a2" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">运行它:</p><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="80b1" class="nm lv ir lr b gz nn no l np nq">$ ./hello.bin<br/>Talk Hello World</span></pre><h1 id="bc4b" class="lu lv ir bd lw lx ly lz ma mb mc md me jx mf jy mg ka mh kb mi kd mj ke mk ml bi translated">分配</h1><p id="5eb5" class="pw-post-body-paragraph ks kt ir ku b kv mm js kx ky mn jv la lb mo ld le lf mp lh li lj mq ll lm ln ik bi translated">要分发，使用<code class="fe lo lp lq lr b">--standalone</code>选项构建，这将不会输出单个可执行文件，而是整个文件夹。将生成的<code class="fe lo lp lq lr b">hello.dist</code>文件夹复制到另一台机器并运行。</p><p id="cd66" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">你也可以尝试<code class="fe lo lp lq lr b">--onefile</code>，它确实创建了一个单独的文件，但是在使用它之前，要确保这个单独的文件正在工作，因为它只会使调试更加困难，例如在丢失数据文件的情况下。例如:</p><pre class="kh ki kj kk gu ni lr nj nk aw nl bi"><span id="f2b1" class="nm lv ir lr b gz nn no l np nq">$ python -m nuitka hello.py --standalone --onefile<br/>Nuitka-Options:INFO: Used command line options: hello.py --standalone --onefile<br/>...<br/>Nuitka:INFO: Keeping dist folder 'hello.dist' for inspection, no need to use it.<br/>Nuitka:INFO: Keeping build directory 'hello.build'.<br/>Nuitka:INFO: Created binary that runs on macOS 12.0 (x86_64) or higher.<br/>Nuitka:INFO: Successfully created 'hello.bin'.</span></pre><p id="c5d9" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><strong class="ku is">注意:如果你正在做跨平台的构建和发布，你可以使用 Docker image + Dockerfile 来确保环境的一致性。</strong></p></div></div>    
</body>
</html>