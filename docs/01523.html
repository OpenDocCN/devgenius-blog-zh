<html>
<head>
<title>Common Vue Problems — Namespaced Vuex Actions, Downloading Binaries, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">常见的 Vue 问题——命名空间 Vuex 操作、下载二进制文件等等</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/common-vue-problems-namespaced-vuex-actions-downloading-binaries-and-more-6428cd78b79f?source=collection_archive---------22-----------------------#2020-07-05">https://blog.devgenius.io/common-vue-problems-namespaced-vuex-actions-downloading-binaries-and-more-6428cd78b79f?source=collection_archive---------22-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4a4ac0af19a9f266e09123a6cceb9470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KXyNXx45OgRvQh2c"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@danieljerez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹尼尔·赫雷斯</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="443f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue.js 让开发前端应用变得简单。然而，我们仍有可能遇到问题。</p><p id="0df2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看一些常见的问题，并看看如何解决它们。</p><h1 id="9631" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在两个命名空间 Vuex 操作之间调度操作</h1><p id="311e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">假设我们有 2 个或更多的名称空间 Vuex 操作:</p><p id="3d6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">game.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3b89" class="mq lc iq mh b gy mr ms l mt mu">const actions = {<br/>  myAction({dispatch}) {<br/>    ...<br/>    dispatch('notification/triggerSelfDismissingNotifcation', {...})<br/>  }<br/>}</span></pre><p id="66b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">notification.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b6b3" class="mq lc iq mh b gy mr ms l mt mu">const actions = {<br/>  dismiss(context, payload) {<br/>    ...<br/>  }<br/>}</span></pre><p id="3072" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过在动作名称前添加名称空间来调度它们。</p><p id="2b8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="53bd" class="mq lc iq mh b gy mr ms l mt mu">dispatch('notification/dismiss', {...}, { root: true })</span></pre><p id="6726" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是动作的名称，前面带有名称空间名称。</p><p id="39f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数像往常一样具有有效载荷。</p><p id="36b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三个参数中的<code class="fe me mf mg mh b">root</code>属性用于访问命名空间操作。</p><p id="a6d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有它就找不到动作。</p><p id="728c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还必须记住在 Vuex 商店模块中将<code class="fe me mf mg mh b">namespaced</code>设置为<code class="fe me mf mg mh b">true</code>。</p><h1 id="2028" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从 URL 获取查询参数</h1><p id="6088" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以从带有<code class="fe me mf mg mh b">this.$route.query</code>属性的 URL 中获取查询参数。</p><p id="c9f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ce41" class="mq lc iq mh b gy mr ms l mt mu">/url?foo=bar</span></pre><p id="b9b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的 URL 中，我们可以通过编写<code class="fe me mf mg mh b">this.$route.query.foo</code>来获得带有关键字<code class="fe me mf mg mh b">foo</code>的查询参数。</p><h1 id="7b06" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Vue 路由器路由器链接活动样式</h1><p id="c0c5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以向<code class="fe me mf mg mh b">router-link-active</code>类或<code class="fe me mf mg mh b">router-link-exact-active</code>类添加样式，向活动链接添加一些样式，比如高亮。</p><p id="0a51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">router-link-active</code>匹配目标路线时应用。</p><p id="b2e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">router-link-exct-active</code>当找到一条路线的精确匹配时，匹配。</p><p id="36e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于样式，我们可以这样写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d1dd" class="mq lc iq mh b gy mr ms l mt mu">.router-link-active,<br/>.router-link-exact-active {<br/>  background-color: green;<br/>  cursor: pointer;<br/>}</span></pre><p id="b357" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将为活动的<code class="fe me mf mg mh b">router-link</code>获取绿色背景。</p><p id="5a0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">类名可以更改。</p><p id="db1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以设置<code class="fe me mf mg mh b">linkActiveClass</code>和<code class="fe me mf mg mh b">linkExactActiveClass</code>属性。</p><p id="22f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8226" class="mq lc iq mh b gy mr ms l mt mu">const router = new VueRouter({<br/>  routes,<br/>  linkActiveClass: "active",<br/>  linkExactActiveClass: "exact-active",<br/>})</span></pre><p id="0809" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们分别将活动类从<code class="fe me mf mg mh b">router-link-active</code>和<code class="fe me mf mg mh b">router-link-exact-active</code>更改为<code class="fe me mf mg mh b">active</code>和<code class="fe me mf mg mh b">exact-active</code>。</p><h1 id="a5b1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用 Vuex 给一个动作传递多个参数</h1><p id="cdb5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Vuex 动作接受一个<code class="fe me mf mg mh b">state</code>和<code class="fe me mf mg mh b">pyaload</code>参数。</p><p id="3d04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们需要传入多条数据，我们可以向第二个参数<code class="fe me mf mg mh b">commit</code>传入一个对象。</p><p id="43af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8d77" class="mq lc iq mh b gy mr ms l mt mu">store.commit('authenticate', {<br/>  token,<br/>  expiration,<br/>});</span></pre><p id="8dc3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二个参数中，我们有一个具有<code class="fe me mf mg mh b">token</code>和<code class="fe me mf mg mh b">expiration</code>属性的对象。</p><p id="43c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么为了定义<code class="fe me mf mg mh b">authenticate</code>突变，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4871" class="mq lc iq mh b gy mr ms l mt mu">mutations: {<br/>  authenticate(state, { token, expiration }) {<br/>    localStorage.setItem('token', token);<br/>    localStorage.setItem('expiration', expiration);<br/>  }<br/>}</span></pre><p id="cb5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从第二个参数，即<code class="fe me mf mg mh b">payload</code>参数中获取属性。</p><p id="6214" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用它做我们想做的事情，比如将值保存在本地存储中。</p><h1 id="3f62" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用 Axios 保存 Blob 数据</h1><p id="7148" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过创建一个新的<code class="fe me mf mg mh b">Blob</code>实例来用 Axios 保存 blob 数据。</p><p id="75b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用它调用<code class="fe me mf mg mh b">window.URL.ceateObjectURL</code>。</p><p id="03cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="270c" class="mq lc iq mh b gy mr ms l mt mu">axios<br/>  .get(`url/with/pdf`, {<br/>    responseType: 'arraybuffer'<br/>  })<br/>  .then(response =&gt; {<br/>     const blob = new Blob([response.data], { type: 'application/pdf' }),<br/>     const url = window.URL.createObjectURL(blob);<br/>     window.open(url);<br/>  })</span></pre><p id="3888" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">responseType</code>设置为<code class="fe me mf mg mh b">'arraybuffer'</code>来告诉 Axios 我们正在下载一个二进制文件。</p><p id="a268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建一个<code class="fe me mf mg mh b">Blob</code>实例，在第一个参数的数组中有二进制数据的<code class="fe me mf mg mh b">response.data</code>。</p><p id="4473" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数将文件 mime 类型设置为<code class="fe me mf mg mh b">'application/pdf'</code>。</p><p id="cadb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建 URL 让我们用<code class="fe me mf mg mh b">window.URL.createObjectURL</code>下载文件。</p><p id="6d7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们用返回的 URL 调用<code class="fe me mf mg mh b">window.open</code>将文件下载到用户的计算机上。</p><h1 id="56df" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">每次部署后清除缓存</h1><p id="4da1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过几种方式在部署 Vue 应用程序后清除缓存。</p><p id="408a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种方法是使用<code class="fe me mf mg mh b">webpack-assets-manifest</code>在静态文件的文件名后添加一个随机散列名。</p><p id="9161" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以将它上传到 CDN 中的版本化文件夹。</p><p id="137a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">no-cache</code>标题也适用于除 IE 之外的大多数浏览器，所以我们可以将它们设置为禁用缓存。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e4fb7d02f3a45b6bec88acaea35d5721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UwYWXV8yRdq3dz2d"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@mrthetrain?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Joshua Hoehne </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="5ed6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2584" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用一些像<code class="fe me mf mg mh b">webpack-assets-manifest</code>这样的包来清空缓存，给我们的静态文件添加一个散列。</p><p id="c589" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vuex 动作可以有名称空间，这样我们就可以把它们分成不同的名称空间。</p><p id="a221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vuex 变异的有效载荷是它的第二个参数，所以如果我们想传入一个数据，我们可以传递值；如果我们想传入更多数据，我们可以传递一个对象。</p></div></div>    
</body>
</html>