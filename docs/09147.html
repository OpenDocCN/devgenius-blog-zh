<html>
<head>
<title>Laravel CRUD Authorization with Inertia and Vue - Access control using role and permission</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有惰性的 Laravel CRUD 授权和使用角色和权限的 Vue 访问控制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-crud-authorization-with-inertia-and-vue-access-control-using-role-and-permission-bb718f0b3a78?source=collection_archive---------3-----------------------#2022-08-02">https://blog.devgenius.io/laravel-crud-authorization-with-inertia-and-vue-access-control-using-role-and-permission-bb718f0b3a78?source=collection_archive---------3-----------------------#2022-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2204" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Laravel 从头开始创建 Vue 管理面板——第 5 部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7ba2c34b8fbaf74c4e7edd5f9b44dee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3yrrzdQe9uTS3OIo"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@mr_williams_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈卡·威廉姆斯</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="d74e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在最后 4 个部分中，我们完成了<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/laravel-creates-a-vue-admin-panel-from-scratch-part-1-installation-and-authentication-56c451d4d697">安装</a>和<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/create-laravel-crud-using-inertia-and-vue-3-list-page-with-search-and-pagination-c4a52b6501c3">权限 CRUD </a>以及<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/laravel-crud-column-sorting-with-inertia-and-vue-6bb16c30d3e0">列排序</a>。在这一部分，我们将根据角色和权限来限制用户访问。以下步骤用于创建对我们的<a class="ae kv" href="https://github.com/balajidharma/laravel-vue-admin-panel" rel="noopener ugc nofollow" target="_blank"> Laravel Vue 管理面板</a>的访问控制。</p><ol class=""><li id="21b4" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">使用中间件</li><li id="4b1d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将授权检查传递给组件</li><li id="4b31" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">组件中的访问控制</li></ol><h2 id="65b0" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">1.使用中间件</h2><p id="44e6" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们使用<a class="ae kv" href="https://spatie.be/docs/laravel-permission" rel="noopener ugc nofollow" target="_blank">Spatie Laravel-permission</a>包来管理用户权限和角色。已经在<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/create-laravel-crud-using-inertia-and-vue-3-list-page-with-search-and-pagination-c4a52b6501c3">部件 2 </a>的<code class="fe ne nf ng nh b">AuthServiceProvider</code>引导功能上授予超级管理员访问权限。</p><p id="1598" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在将要使用<code class="fe ne nf ng nh b">can</code>的权限控制器中，内置了<code class="fe ne nf ng nh b">\Illuminate\Auth\Middleware\Authorize::class</code>提供的 Laravel 中间件</p><p id="5c66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构造函数中添加访问检查中间件，如下所示</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="2c6b" class="mg mh iq nh b gy nm nn l no np">class PermissionController extends Controller<br/>{<br/>    public function __construct()<br/>    {<br/>        $this-&gt;middleware('can:permission list', ['only' =&gt; ['index', 'show']]);<br/>        $this-&gt;middleware('can:permission create', ['only' =&gt; ['create', 'store']]);<br/>        $this-&gt;middleware('can:permission edit', ['only' =&gt; ['edit', 'update']]);<br/>        $this-&gt;middleware('can:permission delete', ['only' =&gt; ['destroy']]);<br/>    }</span></pre><p id="5abf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在以示例用户(test@example.com/password 的身份登录，并尝试创建操作。对于示例用户，您将得到 403。因为此用户角色是一个作者，只能访问“许可权列表”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/c78d6967ffc192c9173ac2fa067c4dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOsirwyC1_sOBuhf6TT9dw.png"/></div></div></figure><p id="3207" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还可以探索其他授权操作<a class="ae kv" href="https://laravel.com/docs/9.x/authorization#gates" rel="noopener ugc nofollow" target="_blank">门</a>和<a class="ae kv" href="https://laravel.com/docs/9.x/authorization#creating-policies" rel="noopener ugc nofollow" target="_blank">策略</a>。这是在 Laravel 授权行动的主要方式。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h2 id="c6f2" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">2.将授权检查传递给组件</h2><p id="d0d1" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">构造器中的中间件将检查所有的动作授权。所以在后端，我们添加了权限和基于角色的访问控制。但是我们需要根据用户权限隐藏前端组件中的“添加权限”、“编辑”和“删除”链接。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/90028faba569fd8446bf2b0f4e78ca30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vee6QgXoztueBc3tj7x62Q.png"/></div></div></figure><p id="431c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了检查 JavaScript 页面组件的访问，我们需要将授权检查作为道具传递给页面组件。打开权限控制器索引函数，并将下面的“can”对象添加到组件中。</p><p id="81b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://inertiajs.com/" rel="noopener ugc nofollow" target="_blank">惯性</a>建议此<a class="ae kv" href="https://inertiajs.com/authorization" rel="noopener ugc nofollow" target="_blank">授权</a>检查是否向页面组件传递属性。</p><p id="0053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ne nf ng nh b">app/Http/Controllers/Admin/PermissionController.php</code></p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="e9e7" class="mg mh iq nh b gy nm nn l no np">return Inertia::render('Admin/Permission/Index', [<br/>    'permissions' =&gt; $permissions,<br/>    'filters' =&gt; request()-&gt;all('search'),<br/>    'can' =&gt; [<br/>        'create' =&gt; Auth::user()-&gt;can('permission create'),<br/>        'edit' =&gt; Auth::user()-&gt;can('permission edit'),<br/>        'delete' =&gt; Auth::user()-&gt;can('permission delete'),<br/>    ]<br/>]);</span></pre><p id="ca94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，在控制器顶部添加<code class="fe ne nf ng nh b">use Illuminate\Support\Facades\Auth;</code>。现在，JavaScript 页面组件上提供了“can”属性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/9b7d72f451ee071798bd58d61dd8bcd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oSwjEhKgaaWMK6Wirl42cw.png"/></div></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h2 id="3987" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">3.组件中的访问控制</h2><p id="8cc8" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">使用“can”道具，我们将隐藏权限索引组件中的操作链接。在此之前，在<code class="fe ne nf ng nh b">defineProps</code>中添加“<code class="fe ne nf ng nh b">can</code>”对象。</p><p id="1c41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ne nf ng nh b">resources/js/Pages/Admin/Permission/Index.vue</code></p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="19cb" class="mg mh iq nh b gy nm nn l no np">const props = defineProps({<br/>  permissions: {<br/>    type: Object,<br/>    default: () =&gt; ({}),<br/>  },<br/>  filters: {<br/>    type: Object,<br/>    default: () =&gt; ({}),<br/>  },<br/>  can: {<br/>    type: Object,<br/>    default: () =&gt; ({}),<br/>  },<br/>});</span></pre><p id="b667" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后添加基于<code class="fe ne nf ng nh b">can</code>对象的<code class="fe ne nf ng nh b">v-if</code></p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="56f9" class="mg mh iq nh b gy nm nn l no np">&lt;div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"&gt;<br/>   &lt;div class="p-6 bg-white border-b border-gray-200"&gt;<br/>     &lt;div class="flex flex-col mt-8"&gt;<br/>-              &lt;div class="d-print-none with-border mb-8"&gt;<br/>+              &lt;div v-if="can.create" class="d-print-none with-border mb-8"&gt;<br/>         &lt;Link<br/>           :href="route('permission.create')"<br/>           class="<br/>@@ -158,6 +162,7 @@ function destroy(id) {<br/>                   &lt;Sort label="Name" attribute="name" /&gt;<br/>                 &lt;/th&gt;<br/>                 &lt;th<br/>+                          v-if="can.edit || can.delete"<br/>                   class="<br/>                     py-2<br/>                     px-4<br/>@@ -203,6 +208,7 @@ function destroy(id) {<br/>                   &lt;/div&gt;<br/>                 &lt;/td&gt;<br/>                 &lt;td<br/>+                          v-if="can.edit || can.delete"<br/>                   class="<br/>                     border-b border-slate-100<br/>                     dark:border-slate-700<br/>@@ -214,6 +220,7 @@ function destroy(id) {<br/>                 &gt;<br/>                   &lt;div class="flex"&gt;<br/>                     &lt;Link<br/>+                              v-if="can.edit"<br/>                       :href="route('permission.edit', permission.id)"<br/>                       class="<br/>                         inline-flex<br/>@@ -245,6 +252,7 @@ function destroy(id) {<br/>                       Edit<br/>                     &lt;/Link&gt;<br/>                     &lt;BreezeButton<br/>+                              v-if="can.delete"<br/>                       class="px-4 py-2 text-white bg-red-600"<br/>                       @click="destroy(permission.id)"<br/>                     &gt;</span></pre><p id="815c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在以示例用户的身份访问许可权索引页面。未授权用户不会看到操作链接。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/458a6a331252746aa872c60c82d0c768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u8NnHT_7GJn0gL-NIjrPNQ.png"/></div></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="614c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经成功地完成了权限 CRUD 的所有功能，包括授权。在接下来的部分中，我们将创建其他角色和用户 CRUD。</p><h2 id="b2c9" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">GitHub 知识库</h2><p id="2de3" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">Laravel Vue 管理面板在<a class="ae kv" href="https://github.com/balajidharma/laravel-vue-admin-panel" rel="noopener ugc nofollow" target="_blank">https://github.com/balajidharma/laravel-vue-admin-panel</a>上可用。安装管理面板并分享您的反馈。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="0b9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p><p id="a322" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">敬请关注更多内容！</p><p id="776f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ob">跟我来</em><a class="ae kv" href="https://balajidharma.medium.com/" rel="noopener"><strong class="ky ir"><em class="ob">balajidharma.medium.com</em></strong></a>。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="59af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上一部分—第 4 部分:<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/laravel-crud-column-sorting-with-inertia-and-vue-6bb16c30d3e0">创建具有惯性和 Vue 的 Laravel CRUD 列排序</a></p><p id="f13e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一部分—第 6 部分:<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/how-to-integrate-laravel-with-vue-tailwind-admin-one-dashboard-3753346181">如何将 Laravel 与 Vue 集成&amp; Tailwind Admin One 仪表盘</a></p></div></div>    
</body>
</html>