<html>
<head>
<title>Easy Manual Setup HTTPS In Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nginx 中简单的手动设置 HTTPS</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/easy-manual-setup-https-in-nginx-9cac185ebdb4?source=collection_archive---------12-----------------------#2022-01-10">https://blog.devgenius.io/easy-manual-setup-https-in-nginx-9cac185ebdb4?source=collection_archive---------12-----------------------#2022-01-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/63ad38a732d3de85519a98a016f9e141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49glYe-285UPvYW9xp7JFw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片由<a class="ae jz" href="https://pixabay.com/id/illustrations/https-situs-web-internet-keamanan-3344700/" rel="noopener ugc nofollow" target="_blank">天空电视台在 Pixabay </a>上拍摄</figcaption></figure><p id="5c44" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你像我一样懒，你可以使用 certbot 为 HTTPS 创建证书。这是我的首选方法，因为它简单、快速，并且可以在证书过期时自动续订。不幸的是，这个世界不全是阳光和彩虹。在某些情况下，certbot 无法立即创建证书，例如:</p><ol class=""><li id="a2b9" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">服务器在 VPN 后面。通常，有一个已经设置好的代理。如果对你来说不是这样，那么我希望你知道应该在哪里设置代理的列表。</li><li id="f937" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">web 服务器位于安全的 TLD(如. app)之后。这意味着您无法通过 HTTP 协议访问它，certbot 也无法创建认证。这是因为，默认情况下，certbot 使用<a class="ae jz" href="https://letsencrypt.org/docs/challenge-types/#http-01-challenge" rel="noopener ugc nofollow" target="_blank"> HTTP-01 质询</a>，这意味着该质询在 web 服务器上将会失败。</li></ol><p id="c745" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您是因为第一个原因来到这里，那么我建议您为 certbot 配置代理。因为迟早您需要将其配置为自动证书续订。如果你现在努力工作，未来的你会感谢你的。</p><p id="a591" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就我而言，我有一些网站使用。app 域。因此，我需要学习如何手动设置证书。出于解释，我将跳过证书的创建，因为它已经在我的域提供者中生成了。如果你想加深对 HTTPS 的了解，你可以看看这幅来自《HowHTTPSWorks》的漫画。</p><p id="3411" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以第一步是拿到你的证书。就我而言，我使用 porkbun 作为我的供应商。在给定的 zip 中有 4 个文件:<code class="fe lm ln lo lp b">domain.cert.pem</code>、<code class="fe lm ln lo lp b">intermediate.cert.pem</code>、<code class="fe lm ln lo lp b">private.key.pem</code>、<code class="fe lm ln lo lp b">public.key.pem</code>。如果你像我一样习惯于 certbot 文件命名，这个映射将帮助你:</p><ul class=""><li id="d0bd" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx lq le lf lg bi translated"><code class="fe lm ln lo lp b">domain.cert.pem</code>(pork bun)-&gt;<code class="fe lm ln lo lp b">fullchain.pem</code>(certbot)-&gt;<code class="fe lm ln lo lp b">ssl_certificate </code>(nginx)</li><li id="dcec" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx lq le lf lg bi translated"><code class="fe lm ln lo lp b">intermediate.cert.pem</code>(pork bun)-&gt;<code class="fe lm ln lo lp b">chain.pem</code>(certbot)-&gt;<code class="fe lm ln lo lp b">ssl_trusted_certificate</code>(nginx)</li><li id="53eb" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx lq le lf lg bi translated"><code class="fe lm ln lo lp b">private.key.pem</code>(pork bun)-&gt;<code class="fe lm ln lo lp b">privkey.pem</code>(certbot)-&gt;<code class="fe lm ln lo lp b">ssl_certificate_key</code></li><li id="30a2" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx lq le lf lg bi translated"><code class="fe lm ln lo lp b">public.key.pem</code>(pork bun)-&gt;<code class="fe lm ln lo lp b">cert.pem</code>(certbot)</li></ul><p id="2c8c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想进一步了解这些文件，可以查看这些 StackOverflow 讨论:</p><ul class=""><li id="f31b" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx lq le lf lg bi translated"><a class="ae jz" href="https://stackoverflow.com/q/63359785" rel="noopener ugc nofollow" target="_blank">如何在 Nginx 上使用 Porkbun SSL 证书文件？</a></li><li id="981d" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx lq le lf lg bi translated"><a class="ae jz" href="https://stackoverflow.com/q/50389883" rel="noopener ugc nofollow" target="_blank">从头开始生成 CRT &amp;密钥 SSL 文件</a></li></ul><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/22ae30ab61598bc8d99fe82dd6c3d563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D3MWFRaYj2LbywNWdL5T4A.png"/></div></div></figure><p id="2ae5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在您需要将这个文件移动到您的服务器上。我们可以使用 SCP 像这样移动它:</p><pre class="ls lt lu lv gt lw lp lx ly aw lz bi"><span id="3b32" class="ma mb in lp b gy mc md l me mf">scp artilearn.app-ssl-bundle host@ipaddress:~/</span></pre><p id="afb2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">SSL 证书被成功复制到我们的远程服务器。现在我们需要把我们的网站放在服务器上。出于本教程的目的，我们将只使用一个虚拟的 HTML 文件来测试我们的 SSL。</p><figure class="ls lt lu lv gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7e1c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后一步是配置 Nginx 配置文件。我们只需要配置 4 样东西:</p><ol class=""><li id="64ed" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">我们的网站将在港口(第 2 行)</li><li id="071d" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">网站的 SSL 证书(第 3–5 行)</li><li id="6130" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我们网站的根文件夹(第 6 行)</li><li id="fb9a" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我们网站的域名(第 7 行)</li></ol><figure class="ls lt lu lv gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="47b5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在用<code class="fe lm ln lo lp b">sudo systemctl restart nginx</code>重启 Nginx 服务。当您检查<code class="fe lm ln lo lp b">https://artilearn.app/dummy.html</code>时，我们的 HTML 文件将成功显示正确的证书！</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/2a2625f35d26d43f3527927d92ae954f.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*BM9IyHxES-KFJpNJu8L6KQ.png"/></div></figure><p id="e0b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们的证书已经成功设置。但是别忘了这个证书是手动设置的，我们还没有配置任何自动续订。但是应该怎么做呢？好吧，我们可以去看看这篇文章的第一句话:懒，用 certbot。我们现在可以这样做，因为我们的网站现在可以从 HTTPS 网址访问，HTTP-01 挑战批准了这种方法。现在只需进入<a class="ae jz" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank"> certbot 网站</a>并遵循那里的简单步骤！</p><p id="e36e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mj">大家好，我是 Adyaksa，我写的是软件开发和我的语言学习经历。我计划每周发布一篇博客，内容是我在做兼职项目时发现的一些有趣的事情。如果你感兴趣，你可以关注我来了解它的最新情况！</em></p></div></div>    
</body>
</html>