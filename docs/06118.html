<html>
<head>
<title>Tips for Improving Kubernetes Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改进Kubernetes部署的技巧</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/tips-for-improving-kubernetes-deployment-d6188851a1b1?source=collection_archive---------12-----------------------#2021-12-14">https://blog.devgenius.io/tips-for-improving-kubernetes-deployment-d6188851a1b1?source=collection_archive---------12-----------------------#2021-12-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/96b2d96f5d2ff0fe0c2d629c44f62ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zkZKkeZgecSzowP2"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://learnk8s.io/kubernetes-wallpapers" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="92c3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kubernetes是一个开源系统，用于自动化部署、扩展和管理容器化的应用程序。它由谷歌在2014年创立，之后捐赠给了CNCF(云计算原生计算基金会)。</p><p id="ccf2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kubernetes是一个古希腊词，意思是驾驶一艘船，在这种情况下，驾驶集装箱。今天，它是云社区中一个家喻户晓的词。它是云计算不可或缺的一部分。因此，使用它的开发人员必须了解针对<a class="ae jz" href="https://komodor.com/blog/5-kubernetes-deployment-best-practices/" rel="noopener ugc nofollow" target="_blank"> Kubernetes部署</a>的改进策略。</p><p id="512f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不过，在我们深入研究这个问题之前，我们需要对Kubernetes和部署中涉及的东西有一个基本的理解。</p><p id="9ef7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务。它是一个多容器管理解决方案，允许将容器分组到逻辑单元中，以便容器可以相互通信。它是用Go语言和YAML语写的。</p><h1 id="10ae" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Kubernetes的积木</h1><h2 id="aad6" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">容器</h2><p id="b1f3" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">容器实例包括依赖项，如框架、代码、操作系统接口、系统库和执行应用程序所需的附加设置。由应用程序组成的容器可以作为一个现成的软件包工作，因为它满足了基本要求。</p><h2 id="e3de" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">豆荚</h2><p id="bc2d" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">它代表Kubernetes集群中的部署单元，可以容纳单个或多个容器。当容器在操作系统之上的物理机器上运行时，使用一个<em class="mn">单容器pod </em>。<em class="mn">当应用程序的运行依赖于其他应用程序/服务时，使用多容器pod </em>。</p><h2 id="8dc1" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">复制控制器</h2><p id="ce2f" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">这是Kubernetes管理pod生命周期的关键特性之一。它确保所需数量的pod始终存在。它有助于创建、缩放和维护多个窗格，作为所需状态的一部分。如果pod崩溃，复制计数器会创建一个新的pod。</p><h2 id="88ab" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">复制集</h2><p id="76b1" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated"><a class="ae jz" href="https://www.fosstechnix.com/kubernetes-replication-controllers-and-replica-sets/" rel="noopener ugc nofollow" target="_blank">复制组</a>类似于复制控制器。它们之间的关键区别是基于对选择器的支持。复制控制器支持“基于权益的选择器”，复制集支持“基于集的选择器”。</p><p id="c618" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<strong class="kc io"> <em class="mn"> </em> </strong> <em class="mn">股权选择器</em>中，过滤条件是基于键和值，其中对象必须满足指定的标签值。在<em class="mn">基于集合的选择器中，</em>与它的对应物相比有更好的灵活性。它允许根据一组值过滤关键字。</p><h2 id="58a6" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">部署</h2><p id="0489" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">部署控制器是复制控制器的升级和更高版本。它管理副本集的部署。它们本质上是声明性的，为pod和副本集提供所需的信息/更新。在创建部署时，会自动为pod创建副本集。这些吊舱通过节点与其他吊舱相连。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="5fac" class="lw kz in mt b gy mx my l mz na"><strong class="mt io">Deployment.yaml</strong></span><span id="7462" class="lw kz in mt b gy nb my l mz na">apiVersion: apps/v1<br/>kind: Deployment<br/>Metadata:<br/> name: myapp-deployment<br/> Labels:<br/> app: myapp<br/>Spec:<br/> replicas: 3<br/> Strategy:<br/> type: RollingUpdate<br/> rollingUpdate:<br/> maxSurge: 25%</span><span id="96f2" class="lw kz in mt b gy nb my l mz na">maxUnavailable: 25%<br/>Selector:<br/> matchLabels:<br/> app: myapp<br/>Template:<br/> Metadata:<br/> Labels:<br/> app: myapp<br/>Spec:<br/> Containers:<br/> — name: myapp-container<br/> image: busybox</span></pre><p id="44a5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">服务</strong>负责将pod暴露给其他pod。入口负责向外界公开你的服务。</p><h1 id="a7dc" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Kubernetes部署的改进策略</h1><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/adc756803b169633decd082c9dca3a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FP1eyB1swJ-SjStC.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://thenewstack.io/kubernetes-deployments-work/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="a2d8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">高效部署在服务器成本管理、提高基础架构利用率以及降低成本以充分利用环境设置方面发挥着至关重要的作用。</p><p id="6478" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下几点有助于您通过Kubernetes部署实现高性能目标。</p><h2 id="f51f" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">根据您的应用程序需求定义部署资源</h2><p id="7579" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">Kubernetes自动化运行容器化工作负载和服务所需的操作工作的核心是将容器高效地调度到节点中。这可以通过指定资源限制来实现。</p><p id="ae64" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要定义请求，并限制CPU、内存和其他资源。因此，在部署描述符中定义资源需求可以让调度器更容易地确保每个资源都被分配给最佳可用节点，从而最大化运行时性能。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="3417" class="lw kz in mt b gy mx my l mz na"><strong class="mt io">Pod.yaml</strong></span><span id="658c" class="lw kz in mt b gy nb my l mz na">Resources:<br/> Requests:<br/>  memory: 1Gi<br/>  cpu: 250m<br/> limits:<br/>  memory: 2.5Gi<br/>  cpu: 750m</span></pre><h2 id="7809" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">实施污染和容忍</h2><p id="e9fe" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">当我们处理大量的容器、标签或节点时，很难将特定的容器放置在特定的节点上。pod相似性允许在一个节点上调度pod，但是污点节点具有排斥一组pod的能力。对这些pod应用容忍，以便它们被调度到具有匹配污点的任何节点上。</p><p id="90df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">污点和容忍作为反向节点选择器，有助于避免在不适当的节点上调度pod。例如，在您希望仅允许通过某个节点计划备份作业的情况下，这可能很有用。它们让运营商能够非常精细地控制部署性能。</p><h2 id="e378" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">Pod优先级</h2><p id="5f3d" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated"><a class="ae jz" href="https://developer.ibm.com/articles/creating-a-custom-kube-scheduler/" rel="noopener ugc nofollow" target="_blank"> Kubernetes调度程序</a>持续监控集群中未绑定(未调度)的pod。找到后，调度程序使用pod优先级来决定首先调度哪个。数值越高的数字表示优先级越高。优先级顺序有助于高效运行部署。</p><h2 id="f203" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">Pod和节点关联性</h2><p id="42f1" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">关联性允许在节点上分配单元。<em class="mn">节点关联</em>可用于确保特定节点用于托管特定pod。<em class="mn"> Pod affinity </em>可用于将两个Pod共同定位在同一节点上。</p><p id="1587" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据pod的资源需求及其在集群中的消耗情况，Kubernetes调度程序可以很好地将pod放置在相关的节点上。然而，我们可能需要控制这些pod在节点上的调度。在这种情况下，可以使用pod亲和力。分析工作负载后，我们需要利用节点和单元关联性策略进行部署。</p><h2 id="ba6a" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">构建优化的图像</h2><p id="3150" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">为了微调Kubernetes部署性能，拥有优化的映像非常重要。容器优化的图像将极大地减小容器图像的大小，这有助于Kubernetes更快地检索图像，并更有效地运行生成的运行容器。</p><h2 id="c176" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">在您的客户端附近部署Kubernetes集群</h2><p id="b876" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">Kubernetes集群部署位置在客户体验中起着重要作用，因为距离较远的位置会增加网络延迟。云提供商在世界各地拥有多个地理区域，允许系统运营商匹配Kubernetes集群部署的最终用户的位置，这有助于保持较低的延迟。</p><h1 id="d659" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="870c" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">Kubernetes是每个云提供商服务的一部分，并将在一段时间内继续在微服务中发挥关键作用。因此，它是一个非常高效的<a class="ae jz" href="https://www.trustradius.com/container-management" rel="noopener ugc nofollow" target="_blank">多容器管理</a>编排工具，当您的部署按照您的需求进行结构配置时，它将提供开箱即用的性能。</p></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><p id="c617" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望你觉得这篇文章很有见地。感谢您的阅读！</p></div></div>    
</body>
</html>