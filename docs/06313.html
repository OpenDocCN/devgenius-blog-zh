<html>
<head>
<title>Build a simple web app using BottlePy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BottlePy构建一个简单的web应用程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/build-a-simple-web-app-using-bottlepy-53a9eb238e0a?source=collection_archive---------9-----------------------#2021-12-29">https://blog.devgenius.io/build-a-simple-web-app-using-bottlepy-53a9eb238e0a?source=collection_archive---------9-----------------------#2021-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9f22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用BottlePy构建一个支持SQLAlchemy和Redis的简单web应用程序</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a5a9e7050a862655d85a28c33917e301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5a-QnLD3HJTZaYhKttmFw.png"/></div></div></figure><h1 id="3920" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">要求</h1><p id="2a60" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要使用这个环境，你需要安装<a class="ae lx" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>和<a class="ae lx" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank"> Docker compose </a>。</p><h1 id="d796" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">应用程序堆栈</h1><p id="5799" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">后端:</p><ul class=""><li id="1ab1" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated"><a class="ae lx" href="https://bottlepy.org/docs/dev/" rel="noopener ugc nofollow" target="_blank">瓶瓶罐罐</a></li><li id="6617" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated"><a class="ae lx" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a></li></ul><p id="a4d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">前端:</p><ul class=""><li id="f5ba" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated"><a class="ae lx" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">自举5 </a></li><li id="8a09" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated"><a class="ae lx" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank"> jQuery </a></li></ul><p id="f712" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">数据库:</p><ul class=""><li id="0ed0" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated"><a class="ae lx" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a></li><li id="5dec" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated"><a class="ae lx" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a></li></ul><p id="fe92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">web服务器:</p><ul class=""><li id="ea4a" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated"><a class="ae lx" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> Nginx </a> —仅生产环境。</li></ul><h1 id="87e4" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用的数据</h1><p id="8ad2" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">为了使用这个示例应用程序，我们需要导入一些示例数据。该示例应用程序使用了在<a class="ae lx" href="https://archive.org/details/stackexchange" rel="noopener ugc nofollow" target="_blank">archive.org</a>上可用的“堆栈交换数据转储”。</p><p id="edd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本网站使用的所有数据都在<a class="ae lx" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> cc-by-sa 4.0 </a>许可下。</p><h1 id="a2e1" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置环境</h1><p id="0f18" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">首先克隆<a class="ae lx" href="https://github.com/garutilorenzo/simple-bottlepy-application" rel="noopener ugc nofollow" target="_blank">这个</a>库</p><p id="1a35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经准备好设置我们的环境了。出于开发目的，链接docker-compose-dev . yml do docker-compose . yml</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="9771" class="mr kv in mn b gy ms mt l mu mv">ln -s docker-compose-dev.yml docker-compose.yml</span></pre><p id="8647" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于生产环境:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="a125" class="mr kv in mn b gy ms mt l mu mv">ln -s docker-compose-prod.yml docker-compose.yml</span></pre><p id="ac99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">开发环境和生产环境之间的区别在于:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4eeb473552724d8594c20b61a3b10d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*gXQLolnLWAQkUefKkmogJA.png"/></div></figure><p id="0d6c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以下载一些样本数据。</p><h1 id="2aa3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">下载样本数据</h1><p id="26c9" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要dwonload一些示例数据运行:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="42c3" class="mr kv in mn b gy ms mt l mu mv">./download_samples.sh</span></pre><p id="e93d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，将下载带有“meta”属性的归档文件。如果您想要更多的数据，请从档案名称中删除download_samples.sh 'meta'。</p><p id="8af6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">小数据:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="fde1" class="mr kv in mn b gy ms mt l mu mv">for sample in workplace.meta.stackexchange.com.7z unix.meta.stackexchange.com.7z</span></pre><p id="7503" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大数据:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="5af6" class="mr kv in mn b gy ms mt l mu mv">for sample in workplace.stackexchange.com.7z unix.stackexchange.com.7z</span></pre><p id="dee2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注意</strong>在本例中，并非所有的stackexchange站点都已导入。选择要下载的归档文件后，调整src/schema/下的network.py模式</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="a472" class="mr kv in mn b gy ms mt l mu mv">class Sites(enum.Enum):<br/>    vi = 'vi.stackexchange.com'<br/>    workplace = 'workplace.stackexchange.com'<br/>    wordpress = 'wordpress.stackexchange.com'<br/>    unix = 'unix.stackexchange.com'<br/>    tex = 'tex.stackexchange.com'</span></pre><p id="a6f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下载数据后，我们可以导入数据:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="f057" class="mr kv in mn b gy ms mt l mu mv">docker-compose run --rm bottle bash</span><span id="e132" class="mr kv in mn b gy mx mt l mu mv">web@4edf053b7e4f:~/src$  python init_db.py # &lt;- Initialize DB<br/>web@4edf053b7e4f:~/src$  python import_data.py # &lt;- Import sample data</span></pre><p id="065c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，对于您下载的每个数据样本(如tex、unix、vi ),将启动一个python子流程，并按顺序导入:</p><ul class=""><li id="5bdd" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated">所有的标签</li><li id="0fa0" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">所有用户</li><li id="e1af" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">所有的帖子</li><li id="3f09" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">所有后历史事件</li></ul><p id="6139" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦导入完成，我们就可以开始我们的环境了</p><h1 id="93de" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">启动环境</h1><p id="f2bf" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">填充了数据库后，我们现在可以启动web应用程序了:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="a6e6" class="mr kv in mn b gy ms mt l mu mv">docker-compose up -d</span><span id="f2a3" class="mr kv in mn b gy mx mt l mu mv">Creating network "bottle-exchange_default" with the default driver<br/>Creating postgres ... done<br/>Creating redis    ... done<br/>Creating bottle   ... done</span></pre><p id="d2fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该应用程序将在<a class="ae lx" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>提供给开发人员，在<a class="ae lx" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>提供给生产人员</p><h1 id="bb2b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">应用概述</h1><h1 id="0981" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">索引</h1><p id="bad3" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">带有搜索表单的主页。在“Network”select上的每次更改中,“Tags”select由/API/autocomplete/form/get _ Tags(POST)上的ajax调用填充(有关更多详细信息，请参见src/bottle/static/asset/js/custom . js)。</p><p id="c8b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">POST调用通过随机硬编码字符串进行验证(参见src/bottle/app.py，api_get_tags)</p><p id="fd0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">带有分页导航的所有可用标签列表。单击标签名称，应用程序将搜索与您选择的标签匹配的所有问题，单击站点名称，应用程序将搜索与您选择的标签和站点匹配的所有问题。</p><h1 id="8a86" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">用户</h1><p id="e720" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">带有分页导航的所有可用用户的表视图。</p><p id="dbd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击用户名，我们进入用户的详细信息页面。在详细的用户页面，我们看到:向上投票，查看，向下投票。如果用户填充了“关于我”字段，我们会看到一个按钮，它触发了一个带有“关于我”详细信息的模式。如果用户问或回答了某个问题，我们会在“帖子”部分看到一个问题列表。</p><h1 id="38ed" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">邮件</h1><p id="652f" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">带有分页导航的所有帖子的列表</p><h1 id="0c87" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">API/REST端点</h1><p id="e6d0" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">这个应用程序公开了一个api/rest route: /api/get/tags。您可以通过POST调用查询这个路由，您必须使用json有效负载进行调用:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="d47b" class="mr kv in mn b gy ms mt l mu mv">curl --header "Content-Type: application/json" \<br/>  --request POST \<br/>  --data '{"auth_key":"dd4d5ff1c13!28356236c402d7ada.aed8b797ebd299b942291bc66,f804492be2009f14"}' \<br/>  <a class="ae lx" href="http://localhost:8080/api/get/tags" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/api/get/tags</a> | jq</span><span id="886d" class="mr kv in mn b gy mx mt l mu mv">{<br/>  "data": [<br/>    {<br/>      "clean_name": "html5",<br/>      "created_time": "2021-12-29 11:33:06.517152+00:00",<br/>      "id": "1",<br/>      "name": "html5",<br/>      "network_sites": "Sites.wordpress",<br/>      "questions": "91",<br/>      "tag_id": "2",<br/>      "updated_time": "None"<br/>    },<br/>    ...<br/>    ],<br/>  "errors": [],<br/>  "items": 5431,<br/>  "last_page": 27<br/>}</span></pre><p id="2e64" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">auth_key硬编码在src/bottle/app.py中</p><h1 id="a38b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">应用程序配置</h1><p id="8676" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">应用程序的配置由load_config模块(src/load_config.py)加载。</p><p id="e320" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该模块将在以下位置加载一个. yml文件:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="da65" class="mr kv in mn b gy ms mt l mu mv">/app/src/&lt;BOTTLE_APP_NAME&gt;/config/&lt;BOTTLE_APP_ENVIRONMENT&gt;</span></pre><p id="fe8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="my">瓶子应用名称</em>和<em class="my">瓶子应用环境</em>是环境变量。</p><p id="abbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">BOTTLE_APP_NAME是我们的BOTTLE应用程序所在的路径名，在本例中是<em class="my"> bottle </em>。BOTTLE_APP_ENVIRONMENT值是prod或env。</p><p id="96c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一个示例配置是:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ec8d" class="mr kv in mn b gy ms mt l mu mv">---<br/>enable_debug: True<br/>enable_reloader: True<br/>http_port: 8080<br/>pgsql_username: "bottle"<br/>pgsql_password: "b0tTl3_Be#"<br/>pgsql_db: "bottle_exchange"<br/>pgsql_host: "pgsql"<br/>pgsql_port: 5432<br/>create_db_schema: True<br/>default_result_limit: 50</span></pre><h1 id="483d" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">数据库配置</h1><p id="9611" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">数据库配置在src/schema模块下定义。</p><p id="5b54" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">base.py文件包含引擎配置:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="3596" class="mr kv in mn b gy ms mt l mu mv">import load_config # &lt;- See App configuration</span><span id="3dbe" class="mr kv in mn b gy mx mt l mu mv">from sqlalchemy import create_engine<br/>from sqlalchemy.ext.declarative import declarative_base<br/>from sqlalchemy.orm import sessionmaker</span><span id="2ff9" class="mr kv in mn b gy mx mt l mu mv">main_config = load_config.load_config()<br/>conn_string = 'postgresql+psycopg2://{pgsql_username}:{pgsql_password}@{pgsql_host}:{pgsql_port}/{pgsql_db}'.format(**main_config)</span><span id="5645" class="mr kv in mn b gy mx mt l mu mv">engine = create_engine(conn_string, pool_size=80, pool_recycle=60)<br/>Session = sessionmaker(bind=engine)</span><span id="d445" class="mr kv in mn b gy mx mt l mu mv">Base = declarative_base()</span></pre><p id="b7c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所有的表都在schema下的一个单独的文件中定义:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/1561286a7a0ef8fdc3a0aab274c5e721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mAK9zxdcj_h0ogOIJQA2A.png"/></div></div></figure><h1 id="1d2c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">SQLAlchemy插件</h1><p id="57b6" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">在这个例子中，应用程序被使用并安装了一个SQLAlchemy插件(src/bottle/bottle_sa.py)。此插件用于处理SQLAlchemy会话:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="268b" class="mr kv in mn b gy ms mt l mu mv">from schema.base import Base, engine # &lt;- Base and engine are defined in the schema module, see "DB configuration"<br/>from bottle_sa import SQLAlchemyPlugin<br/>import load_config</span><span id="ea9e" class="mr kv in mn b gy mx mt l mu mv">main_config = load_config.load_config()</span><span id="23a5" class="mr kv in mn b gy mx mt l mu mv"># Main Bottle app/application<br/>app = application = Bottle()</span><span id="6f4d" class="mr kv in mn b gy mx mt l mu mv"># DB Plugin<br/>saPlugin = SQLAlchemyPlugin(<br/>    engine=engine, metadata=Base.metadata, <br/>    create=main_config['create_db_schema'], <br/>    config=main_config,<br/>)<br/>application.install(saPlugin)</span></pre><p id="3dac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此插件为src/bottle/app.py中定义的每个函数传递一个额外的参数。默认情况下，此参数为“db ”,但可以通过在SQLAlchemyPlugin init中传递额外的参数“keyword”来更改。</p><p id="2751" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，函数示例如下:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="3583" class="mr kv in mn b gy ms mt l mu mv"><a class="ae lx" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/docs')<br/><a class="ae lx" href="http://twitter.com/view" rel="noopener ugc nofollow" target="_blank">@view</a>('docs')<br/>def index(db): # &lt;- db is our SQLAlchemy session<br/>    return dict(page_name='docs')</span></pre><h1 id="8756" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Redis缓存</h1><p id="208a" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">在这个示例应用程序中，我们使用redis来缓存一些页面。如果您有以下情况，缓存“方法”非常有用:</p><ul class=""><li id="5a28" class="ly lz in jm b jn jo jr js jv ma jz mb kd mc kh md me mf mg bi translated">很少更新的网站</li><li id="87a7" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">慢吞吞的页面/路线</li><li id="8c83" class="ly lz in jm b jn mh jr mi jv mj jz mk kd ml kh md me mf mg bi translated">你必须减少数据库的负载</li></ul><p id="6b16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">RedisCache在src/bottle/bottle_cache.py中定义，这是一个用法示例:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="b964" class="mr kv in mn b gy ms mt l mu mv">from bottle_cache import RedisCache</span><span id="f9fd" class="mr kv in mn b gy mx mt l mu mv"># Cache<br/>cache = RedisCache()</span><span id="f561" class="mr kv in mn b gy mx mt l mu mv"><a class="ae lx" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/tags')<br/><a class="ae lx" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/tags/&lt;page_nr:int&gt;')<br/><a class="ae lx" href="http://twitter.com/cache" rel="noopener ugc nofollow" target="_blank">@cache</a>.cached()<br/><a class="ae lx" href="http://twitter.com/view" rel="noopener ugc nofollow" target="_blank">@view</a>('tags')<br/>def get_tags(db, page_nr=1):<br/>    do_something()<br/>    return something</span></pre><p id="bf3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以使用额外的参数config初始化RedisCache类:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="5718" class="mr kv in mn b gy ms mt l mu mv">config = {'redis_host': '&lt;redis_hostname'&gt;, 'redis_port': 6379, 'redis_db': 0, 'cache_expiry': 86400}<br/>cache = RedisCache(config=config)</span></pre><p id="3c09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，配置为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/773fc984f58fb21270ebc4fc52981cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*ezBHbzydRmbhelPCkcni-g.png"/></div></figure><p id="4f38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">@cached decorator可以接受一些参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/3f5b0d1d3d8dd6e808efd7825863bfa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XY7wyO9MOVEsKni3yzSsrg.png"/></div></div></figure><h1 id="dce0" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">缓存json请求</h1><p id="794b" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">json缓存的一个例子是:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="9c74" class="mr kv in mn b gy ms mt l mu mv"><a class="ae lx" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/api/get/tags', method='POST')<br/><a class="ae lx" href="http://twitter.com/cache" rel="noopener ugc nofollow" target="_blank">@cache</a>.cached(content_type='application/json')<br/>def api_get_tags(db):<br/>    do_something()<br/>    return something</span></pre><p id="2759" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要使缓存失效，请将invalidate_cache 键作为查询参数，或者在进行POST调用时在请求体中传递</p><h1 id="8118" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">跳过/绕过缓存</h1><p id="7bf9" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要跳过或绕过缓存，请将<strong class="jm io"> skip_cache </strong>键作为查询参数，或者在进行POST调用时在请求体中传递</p><h1 id="ae90" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">数据导出</h1><p id="6c7d" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要备份PgSQL数据，请运行dump_db.sh</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ca15" class="mr kv in mn b gy ms mt l mu mv">./dump_db.sh</span></pre><p id="8739" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转储文件将被放在这个存储库的根目录下，文件将被命名为dump.sql.gz(Gzipped格式)</p><h1 id="d878" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">数据导入</h1><p id="78e9" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要导入现有数据库，请取消docker-compose.yml中以下行的注释:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="6cb8" class="mr kv in mn b gy ms mt l mu mv">volumes:<br/>    - type: volume<br/>      source: postgres<br/>      target: /var/lib/postgresql/data<br/>    - ./sql:/docker-entrypoint-initdb.d # &lt;- uncomment this line</span></pre><p id="5ef2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并将gzip或纯文本格式的转储文件放在sql/(首先创建目录)下</p><h1 id="4c34" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">停止环境</h1><p id="baf8" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要停止环境运行</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="e95f" class="mr kv in mn b gy ms mt l mu mv">docker-compose down</span><span id="611d" class="mr kv in mn b gy mx mt l mu mv">Stopping bottle   ... done<br/>Stopping postgres ... done<br/>Stopping redis    ... done<br/>Removing bottle   ... done<br/>Removing postgres ... done<br/>Removing redis    ... done<br/>Removing network bottle-exchange_default</span></pre><p id="3eff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了清理所有的数据(pgsql数据)，将额外的参数“-v”传递给docker-compose down。使用此参数，pgsql卷将被删除。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="cb0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="my">原载于2021年12月29日</em><a class="ae lx" href="https://garutilorenzo.github.io/build-simple-web-app-using-bottle/" rel="noopener ugc nofollow" target="_blank"><em class="my">https://garutilorenzo . github . io</em></a><em class="my">。</em></p></div></div>    
</body>
</html>