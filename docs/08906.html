<html>
<head>
<title>Databricks Notebook Widgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据砖块笔记本部件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/databricks-notebook-widgets-e5aae31dc984?source=collection_archive---------2-----------------------#2022-07-18">https://blog.devgenius.io/databricks-notebook-widgets-e5aae31dc984?source=collection_archive---------2-----------------------#2022-07-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7f4935cb526bc882818cfa62d283e418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rDP5OExl0E5CWHibpb_Nw.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">布雷特·乔丹在<a class="ae ja" href="https://unsplash.com/s/photos/widget?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><p id="c4a9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">带参数的可重复使用的数据块笔记本</p><p id="8d8f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">输入部件是数据块中的实用工具，允许我们向仪表板和笔记本添加参数。小部件 API 提供了创建获取值和删除它们的方法。在这篇博客中，我们将看到如何使用这些 API。</p><h2 id="1124" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">帮助</h2><p id="c08f" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">所有小部件的 API 都在<code class="fe lw lx ly lz b">dbutils.widgets</code>下。它有一个帮助 API，提供所提到的小部件的详细信息或一般信息。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="9fac" class="ky kz jd lz b gy mi mj l mk ml">dbutils.widgets.help()<br/>dbutils.widgets.help(&lt;"methodName"&gt;)<br/># dbutils.widgets.help("dropdown")</span></pre><h2 id="0be8" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">创造</h2><p id="757f" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">创建小部件 API 的方法签名如下:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="68a3" class="ky kz jd lz b gy mi mj l mk ml">dbutils.widgets.&lt;widget_type&gt;(&lt;"name"&gt;, &lt;"defaultValue"&gt;, &lt;choices&gt;, &lt;"label"&gt;)</span></pre><h2 id="3b1c" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">类型</h2><p id="3386" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">Databricks 笔记本有 4 种不同类型的小部件:</p><ul class=""><li id="98b3" class="mm mn jd kc b kd ke kh ki kl mo kp mp kt mq kx mr ms mt mu bi translated"><code class="fe lw lx ly lz b">text</code>接受一个字符串作为输入。</li><li id="a109" class="mm mn jd kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated"><code class="fe lw lx ly lz b">dropdown</code>创建一个带有值的下拉列表。</li><li id="2f81" class="mm mn jd kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated"><code class="fe lw lx ly lz b">combobox</code>顾名思义，这是文本和下拉菜单的组合。用户可以从下拉列表中选择值，也可以输入自己的值。</li><li id="d78e" class="mm mn jd kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated"><code class="fe lw lx ly lz b">multiselect</code>创建一个值列表。用户可以从列表中选择一个或多个值(复选框)。</li></ul><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="5996" class="ky kz jd lz b gy mi mj l mk ml">dbutils.widgets.text(name="txt_p1", defaultValue="Hello")<br/>dbutils.widgets.dropdown(name="dd_p1", defaultValue="2022", choices=["2022", "2021", "2020"])<br/>dbutils.widgets.combobox(name="cbx_p1", defaultValue="P1", choices=["P1", "P2", "P3"])<br/>dbutils.widgets.multiselect(name="mst_p1", defaultValue="1", choices=[str(x) for x in range(1, 13)])</span></pre><h2 id="7754" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">得到</h2><p id="a779" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">为了获得分配给小部件参数的值，我们使用了<code class="fe lw lx ly lz b">.get()</code>方法。它接受感兴趣的小部件名称。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="ef65" class="ky kz jd lz b gy mi mj l mk ml">dbutils.widgets.get(&lt;"widget_name"&gt;)<br/># mst_p1_val = dbutils.widgets.get("mst_p1").split(",")</span></pre><p id="101a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们调用一个有小部件的笔记本，我们需要提供来自原始调用者的那些值。要传递来自另一个笔记本的值，我们有两个选项，如下所示:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="9570" class="ky kz jd lz b gy mi mj l mk ml">%run /path/to/notebook $txt_p1="Hey!"<br/>dbutils.notebook.run("path/to/notebook", 60, {"mst_p1": "P2","txt_p1":'Hey!'})</span></pre><h2 id="f85b" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">%run vs notebook.run()</h2><ul class=""><li id="4325" class="mm mn jd kc b kd lr kh ls kl na kp nb kt nc kx mr ms mt mu bi translated">使用%run 将在相同的环境中运行目标笔记本，因此目标笔记本中的所有参数和变量都将在调用笔记本中可用。此外，调用笔记本中的变量在目标笔记本中也是可用的。</li><li id="1a07" class="mm mn jd kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">使用%run 命令，我们只能传递字符串参数。在 run()中，我们可以传递地图对象。</li><li id="6ade" class="mm mn jd kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">run()提供了笔记本执行的细节，而%run 本身并没有这样做。应当使用<code class="fe lw lx ly lz b">dbutils.notebook.exit("returnValue")</code>。</li></ul><h2 id="4a96" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">去除</h2><p id="e981" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">如果我们决定不再需要某个或所有小部件，我们可以使用以下方法删除它们:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="e043" class="ky kz jd lz b gy mi mj l mk ml">dbutils.widgets.remove(&lt;"widget_name"&gt;)<br/>dbutils.widgets.removeAll()</span></pre><p id="ecee" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然我提到了使用 Python API 的所有内容，但这些内容在 SQL 中也是可用的，同样的结构也适用，请参见下面的示例:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="a108" class="ky kz jd lz b gy mi mj l mk ml">CREATE WIDGET TEXT txt_p1 DEFAULT 'Hello';</span><span id="86e6" class="ky kz jd lz b gy nd mj l mk ml">CREATE WIDGET DROPDOWN dd_p1 DEFAULT '2022' CHOICES SELECT DISTINCT t_year FROM demo_widget_table;</span><span id="001a" class="ky kz jd lz b gy nd mj l mk ml">CREATE WIDGET COMBOBOX cbx_p1 DEFAULT 'P1' CHOICES SELECT DISTINCT product_name FROM demo_widget_table LIMIT 5</span><span id="c831" class="ky kz jd lz b gy nd mj l mk ml">CREATE WIDGET MULTISELECT mst_p1 DEFAULT '1' CHOICES SELECT DISTINCT t_month_number FROM demo_widget_table</span><span id="0c95" class="ky kz jd lz b gy nd mj l mk ml">SELECT * FROM demo_widget_2 <br/>WHERE transaction_year = getArgument("dd_p1") <br/>#alternative (= '%$dd_p1%')</span><span id="2e41" class="ky kz jd lz b gy nd mj l mk ml">REMOVE WIDGET &lt;name&gt;</span></pre><p id="3bd0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">默认情况下，widget 设置通常处于<strong class="kc je">运行笔记本</strong>模式。这将意味着每次我们更改值(选择)，它将运行我们笔记本中的每个单元格。为了避免这种情况，我们需要更改小部件的设置。我们可以<strong class="kc je">运行访问的命令。</strong></p><p id="2cbb" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">希望对你有用。快乐记事本！！</p></div></div>    
</body>
</html>