<html>
<head>
<title>6 AWS Lambda Cost Optimization Strategies that Work</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">6个有效的AWS Lambda成本优化策略</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/6-aws-lambda-cost-optimization-strategies-that-work-c1c054f529b4?source=collection_archive---------5-----------------------#2021-05-06">https://blog.devgenius.io/6-aws-lambda-cost-optimization-strategies-that-work-c1c054f529b4?source=collection_archive---------5-----------------------#2021-05-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2ccf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2021年，企业普遍采用按使用量付费的定价模式。和亚马逊没什么区别。这也是为什么这篇文章对于那些希望降低AWS Lambda成本的人来说如此重要的主要原因。</p><p id="c4d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将回顾<strong class="jm io">六个可行的策略，以优化与我们的AWS Lambda使用相关的成本</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a80a067cf1106f9ecb83ffba01965039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWAEStLdVADWeaw4oZsh3A.png"/></div></div></figure><h1 id="b14e" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么是AWS Lambda成本优化？</h1><p id="d69c" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">选择迁移到云的<a class="ae lx" href="https://dashbird.io/blog/business-benefits-of-serverless/" rel="noopener ugc nofollow" target="_blank">主要原因</a>之一是<strong class="jm io">降低成本的能力</strong>。优化你的花费是必要的，所以你只为你需要的东西付费，并且只在你需要的时候付费。优化成本将帮助您的组织<strong class="jm io">从投资中获得最大收益</strong>，帮助<strong class="jm io">满足需求</strong>和<strong class="jm io">产能</strong>，同时使用AWS提供的最经济有用的选项。</p><p id="ed8e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">成本优化<strong class="jm io">允许你决定多少、何时以及在何种情况下为提供给你的服务</strong>付费。AWS将允许您轻松地为您的服务选择合适的大小，并根据您的需要利用内存大小。</p><blockquote class="ly lz ma"><p id="f55b" class="jk jl mb jm b jn jo jp jq jr js jt ju mc jw jx jy md ka kb kc me ke kf kg kh ig bi translated">为了更好地了解情况，您可以使用Dashbird <a class="ae lx" href="https://dashbird.io/aws-lambda-monitoring/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda function成本跟踪工具</a>等工具，它将允许您实时监控您的Lambdas成本，并提供详细的见解。这样，您将始终清楚自己在这项服务上的花费。</p></blockquote><h1 id="2489" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">1.缓存Lambda响应</h1><p id="39da" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">对于一些Lambda函数，比如从<a class="ae lx" href="https://dashbird.io/knowledge-base/api-gateway/what-is-aws-api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>事件调用的函数、AppSync或者从CloudFront调用的Lambda@Edge函数，可以缓存响应。<strong class="jm io">一个没有被调用的函数不会花费你任何钱</strong>，所以如果Lambda函数的响应变化不是那么频繁的话，确保你不要敲打它。</p><p id="2657" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Lambda@Edge函数比常规的Lambda函数更昂贵，但是如果你每隔几分钟就调用一次它们，并且每秒向成千上万的用户发送缓存的响应，你就可以大大减少你的账单。</p><p id="34b4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">缓存的一个好处是更便宜的响应，因为你不用为Lambda付费。另一个好处是，你会看到更快的响应，因为如果涉及到Lambda，你就消除了请求必须经过的额外路径。</p><p id="e3e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从商业角度来看，这也可以通过为最终用户提供更好的体验来增加收入。Lambda成本优化意味着您<strong class="jm io">不仅降低了成本，而且实施可能最终会带来更多收入</strong>。</p><p id="6481" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要为使用AWS SAM，<strong class="jm io">部署的API网关启用缓存，您可以使用MethodSettings属性</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/833d9e6f46c894fa2b95a5cec1f0f5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOzBkHfoOUWBVZBH78mauw.png"/></div></div></figure><p id="abac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mb">你可以在这里找到原代码片段:</em><a class="ae lx" href="https://dashbird.io/blog/aws-lambda-cost-optimization-strategies/" rel="noopener ugc nofollow" target="_blank"><em class="mb">https://dash bird . io/blog/AWS-lambda-cost-optimization-strategies/</em></a></p><p id="e334" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以在HttpMethod和ResourcePath中使用*通配符来为API中的多个路由配置缓存。</p><h1 id="0af0" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">2.最小化Lambda的使用</h1><p id="ca02" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated"><strong class="jm io">不要使用Lambda函数进行简单转换</strong>。如果你正在用AppSync或API Gateway构建一个API，通常就是这样。您在API网关中实现了认证认知和定制授权，现在<strong class="jm io">只想将数据直接推送到上游服务，如DynamoDB或SQS。</strong></p><p id="848f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">API Gateway支持Velocity模板语言，这是一种简单的编程语言，可以转换API Gateway请求的JSON对象。<strong class="jm io">它们不能做所有的事情</strong>，但是它们既没有<a class="ae lx" href="https://dashbird.io/knowledge-base/aws-lambda/cold-starts/" rel="noopener ugc nofollow" target="_blank">冷启动</a>也不会像Lambda函数那样产生额外的成本。</p><p id="f499" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请记住，使用VTL进行优化并不太简单，但是如果您经常调用不需要Lambda全部功能的端点，那么这是值得的。AWS的开发者关系工程师Richard Boyd就这个话题写了一些文章。</p><h1 id="806f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">3.构建小型Lambda函数</h1><p id="93e7" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">你所有AWS Lambda函数的目标都是小而专用的。如果一个Lambda函数只做一件事，你只需要优化这个特定的用例。当一个功能有多个用例时，你可能会做出妥协来满足所有的用例。</p><p id="73d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">功能大小也是成本的一部分。每次冷启动时，Lambda运行时必须从S3或Docker映像注册表中获取函数代码。下载1千兆字节比下载1兆字节花费的时间要多得多。<strong class="jm io">这是你为</strong>付出的等待时间。</strong></p><p id="efb5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为2021 Lambda函数是以一毫秒为增量计费的，所以现在你可以每运行一毫秒就节省一笔钱。因此，将Lambda代码简化到最基本的程度可以为经常运行的函数节省更多的资源。</p><h1 id="32b4" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">4.永远不要从Lambda调用Lambda</h1><p id="1f33" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">同样，这对于同步Lambda调用来说<strong class="jm io">是最重要的，它发生在API Gateway中。</strong></p><p id="b29e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你直接从一个Lambda函数中调用一个Lambda函数，你需要为这两个函数付费。<strong class="jm io">第一个会等第二个完成，你要为等待时间</strong>买单。</p><p id="375f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果需要调用多个Lambda函数，<strong class="jm io">尽量早点完成同步API Gateway Lambda函数</strong>，用一些额外的服务开始运行其他函数的过程。</p><p id="fc2e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">AWS提供多种排队服务。SQS、SNS、Kinesis和<a class="ae lx" href="https://dashbird.io/blog/ultimate-guide-aws-step-functions/" rel="noopener ugc nofollow" target="_blank">步函数</a>就是其中的几个。当繁重的任务完成后，您可以通过WebSockets或电子邮件通知客户。</p><h1 id="213b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">5.选择理想的内存配置</h1><p id="a85a" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">在您确保只在需要时调用函数，并保持它们都很小且是专门构建的之后，您就能够通过遵循几个简单的步骤来控制AWS成本。</p><p id="8fa2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们将提到<strong class="jm io">选择正确的大小，</strong>这意味着使用AWS，您可以设置AWS Lambda函数的内存，进而设置CPU，以精确满足您需要的必要容量。</p><p id="f77e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">没有必要过度配置或做出妥协</strong>。随时调整您的服务以满足实际的业务需求，没有任何惩罚或隐藏费用。AWS允许您在符合您的标准的服务之间进行选择，并且当您的需求发生变化时，可以很容易地切换到满足您新需求的服务选项。AWS还允许您同时运行多个服务选项，帮助您降低成本，同时始终保持最佳性能。</p><p id="8430" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一种方法是利用阶跃函数为你的函数找到最佳的内存容量。这里有一个由Sr. Tech打造的<a class="ae lx" href="https://github.com/alexcasalboni/aws-lambda-power-tuning" rel="noopener ugc nofollow" target="_blank">开源模块</a>。AWS的福音传道者Alex Casalboni。</p><h1 id="d730" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">6.通过可观察性降低成本</h1><p id="55b2" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">有了合适的<a class="ae lx" href="https://dashbird.io/serverless-observability/" rel="noopener ugc nofollow" target="_blank">无服务器可观测系统</a>，您的公司肯定会将无服务器架构固有的风险降至最低。您还将有一种可预测的方式来管理预算，这种方式符合需要长期承诺的政策。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/4fc3693008f08d8036a336f8ee97f8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YQGBfP84lWSzAGAw.gif"/></div></div></figure><p id="9bcf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将包括<strong class="jm io">监控、跟踪、分析和提醒</strong>您的服务使用情况。借助值得信赖的顾问，您可以通过遵循最佳实践来调配资源，从而提高系统性能和可靠性。</p><p id="cba9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这也将增加安全性，并给你机会节省一些钱。CloudWatch是一个选项，它(如果您决定关闭非生产功能)将允许您匹配需求的增加或减少。它将收集和跟踪指标，监控日志文件，并自动响应AWS资源中的任何更改。</p><p id="f8de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但它不能让您全面了解您的系统，也不能在出现问题时发出即时警报。为此，您需要一个工具，确保在您的系统出现问题时能够立即提醒您。Dashbird就是这样一个工具，它让你在一个地方<a class="ae lx" href="https://dashbird.io/aws-lambda-monitoring/" rel="noopener ugc nofollow" target="_blank">洞察你的Lambda函数</a>。</p><h1 id="2304" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">更多机会</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/8ae792a30f81ce89f27b8d3a5bc4a38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EiUnR7xJxKtTS16q.png"/></div></div></figure><p id="1310" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还有其他方法可以降低成本，并根据自己的需要进行优化。<a class="ae lx" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>的成本浏览器可以帮助你分析你的使用和成本。这是一个强大的工具，允许您使用一组默认报告来确定成本驱动因素和使用趋势。Dashbird自己的成本跟踪系统，你可以在整个账户范围或每个功能的基础上看到，也可以实时显示你的服务成本。</p><p id="4e74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有各种各样的选择和策略来降低成本，并根据自己的需要进行优化。你需要意识到的最重要的事情是发现哪种给定的方法最适合你的个人需求。找到你需要的东西后，选择更个性化的方式来降低成本会容易得多。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/6f560dccef324d07d152ff2811f0887e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WJGEwXbkjMMJU0O2.png"/></div></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><p id="4094" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">延伸阅读:</p><p id="458e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lx" href="https://dashbird.io/blog/lambda-metrics-monitoring-what-matters/" rel="noopener ugc nofollow" target="_blank">您应该监控的AWS Lambda指标</a></p><p id="f89f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lx" href="https://dashbird.io/blog/optimizing-aws-lambda-for-production/" rel="noopener ugc nofollow" target="_blank">为生产调整AWS Lambda的4个技巧</a></p><p id="163c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lx" href="https://dashbird.io/blog/saving-money-aws-lambda/" rel="noopener ugc nofollow" target="_blank">削减AWS Lambda成本的快速方法</a></p></div></div>    
</body>
</html>