<html>
<head>
<title>A 4 Minute Guide to Creating Telegram Bot in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中创建电报机器人的4分钟指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-4-minute-guide-to-creating-telegram-bot-in-go-ccf662986bbb?source=collection_archive---------2-----------------------#2020-10-02">https://blog.devgenius.io/a-4-minute-guide-to-creating-telegram-bot-in-go-ccf662986bbb?source=collection_archive---------2-----------------------#2020-10-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e7db" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">新手Go程序员的循序渐进指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/6144865bc5920c73812c380d3dd3d4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0SHKBV6bR0IIovzNDSWpw.png"/></div></div></figure><p id="7cec" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我一直在考虑为Telegram创建机器人。我经常使用电报，所以我有很多想法来帮助我简化我的日常工作。其中一个想法对语言学习者特别有用——字典。</p><p id="98a6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本指南中，我们将讨论如何为Telegram创建一个字典机器人。我试图让这种材料尽可能简单。我将整个编程过程分成几个<em class="lk">小</em>步骤:</p><ol class=""><li id="3e05" class="ll lm in kq b kr ks ku kv kx ln lb lo lf lp lj lq lr ls lt bi translated">我们寻找一个英语词典API，</li><li id="a955" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">然后创建bot，用@BotFather生成一个电报令牌。</li><li id="aca8" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">之后，我们通过授权我们的机器人并接收来自聊天的消息来开始编码。</li><li id="83aa" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">然后，我们使用找到的字典API来请求和接收词义。</li><li id="d75c" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">格式化接收到的单词。</li><li id="c83e" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">并将其发送到聊天室。</li></ol><p id="e002" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在下图中，你可以看到当用户发送一个单词时，机器人是如何工作的:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lz"><img src="../Images/615f36f8ed6646635b7e3ff0ec19491e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwUmG0LxDZ5BpVKX5LUUqg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">图1 .用户发送一个单词时机器人的工作</figcaption></figure><h1 id="1ed9" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">寻找字典API</h1><p id="23f9" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">为了这个项目，我找到了一个<a class="ae nb" href="https://github.com/meetDeveloper/googleDictionaryAPI" rel="noopener ugc nofollow" target="_blank">免费的Google Dictionary API </a>。我们将只阅读完整回复中的含义、定义和示例字段。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/a1c086a4cdfbde61d710b347b3630de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MX1B37g60STDAfmZ1rK6FQ.png"/></div></div></figure><h1 id="4594" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">获取令牌</h1><p id="b77e" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">在电报中搜索<code class="fe nd ne nf ng b">@BotFather</code>。打开聊天。在聊天中输入<code class="fe nd ne nf ng b">/newbot</code>。为你的新机器人选择一个名字。我给我们的机器人取名为<code class="fe nd ne nf ng b">English_Dictionary</code>。然后，考虑一个用户名。我选择了<code class="fe nd ne nf ng b">@dictionary_eng_bot</code>。</p><p id="9b22" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当您找到可用的用户名时，<code class="fe nd ne nf ng b">@BotFather</code>会自动向您发送令牌以访问电报API。切勿与任何人共享此令牌，否则令牌可能会被泄露。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/814f056fda121cc71d6436a2fb1dbacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seD-41HDk1R7EqDXWtJhmA.png"/></div></div></figure><h1 id="cee4" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">授权Bot</h1><p id="59c5" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">我们通过环境变量读取敏感凭证。然后，我们创建一个新的BotAPI实例，它接受给定的令牌。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="44ea" class="nj mf in bd mg nk nl dn mk nm nn dp mo kx no np mq lb nq nr ms lf ns nt mu nu bi translated">审核进度</h2><p id="73ef" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">要构建和执行代码，请使用以下命令:</p><p id="d4c5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe nd ne nf ng b">$ token=x go run main.go</code></p><p id="0573" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果连接已经建立，您应该会看到消息<em class="lk">“帐户授权您的_电报_用户名”</em>。如果连接失败，您会看到消息<em class="lk">“无法连接到电报API”</em>。</p><p id="e0de" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这一步，我们检查bot是否已经被授权。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/409b1ba7f9a70db972d8e27012634669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ss4eSoUM49_oEX08JPOa6A.png"/></div></div></figure><h1 id="574c" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">获取新信息</h1><p id="50c3" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">我们通过更新从用户那里获得的所有信息。为此有两种方法:<code class="fe nd ne nf ng b">getUpdates()</code>和<code class="fe nd ne nf ng b">getUpdatesChan()</code>。我们使用<code class="fe nd ne nf ng b">getUpdatesChan()</code>是因为这个方法返回一个“等待更新”的通道。</p><p id="4f2b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了配置更新请求，我们创建了一个新的<code class="fe nd ne nf ng b">UpdateConfig</code>实例。<code class="fe nd ne nf ng b">UpdateConfig</code>包含<em class="lk">偏移</em>、<em class="lk">极限</em>和<em class="lk">超时</em>字段。为了简单起见，我们将这些参数归零。</p><pre class="kd ke kf kg gt nv ng nw nx aw ny bi"><span id="9ce6" class="nj mf in ng b gy nz oa l ob oc">config := tgbotapi.UpdateConfig{}<br/>updates, err := bot.GetUpdatesChan(config)<br/>if err != nil {<br/>    return err<br/>}</span></pre><p id="0741" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在前面的代码中，<code class="fe nd ne nf ng b">updates</code>是存储来自电报API的响应的通道。</p><pre class="kd ke kf kg gt nv ng nw nx aw ny bi"><span id="a013" class="nj mf in ng b gy nz oa l ob oc">for update := range updates {<br/>	// here we will process the word from the user<br/>}</span></pre><p id="30ba" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe nd ne nf ng b">update.Message.Text</code>是传入词。</p><h2 id="43cc" class="nj mf in bd mg nk nl dn mk nm nn dp mo kx no np mq lb nq nr ms lf ns nt mu nu bi translated">审核进度</h2><p id="024a" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">尝试从聊天中获取单词，并将其打印在屏幕上。</p><p id="1695" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">更改代码:</p><pre class="kd ke kf kg gt nv ng nw nx aw ny bi"><span id="b5c0" class="nj mf in ng b gy nz oa l ob oc">for update := range updates {<br/>    fmt.Println(“word:”, update.Message.Text)<br/>}</span></pre><p id="bc52" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在Telegram中找到bot，按Start并键入一个单词。在您的命令行中，您将看到您发送到聊天中的单词。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/11ce210d295ffd37885abfd960d1f5a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6Bwu0UgucdHoK-maVtPng.png"/></div></div></figure><h1 id="709c" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">处理请求和响应</h1><p id="2af5" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">在下面的代码中，我们发出一个请求，读取响应的所有主体，解析JSON编码的数据，并将这些数据存储在<code class="fe nd ne nf ng b">WordInfo</code>结构中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0ded" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里省略了<code class="fe nd ne nf ng b">requestWord()</code>功能。参见<a class="ae nb" href="https://github.com/kozhevnikova/lang_bot" rel="noopener ugc nofollow" target="_blank">完整代码</a>。</p><p id="d748" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">得到响应后，我们检查状态代码。如果状态代码为200 OK，我们将收到单词信息。</p><p id="5ad3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果状态代码不等于200 OK，则响应不包含所需的数据。发生这种情况的原因有很多。例如，当单词不存在，或者单词拼写错误时。代码中返回错误。</p><h2 id="5276" class="nj mf in bd mg nk nl dn mk nm nn dp mo kx no np mq lb nq nr ms lf ns nt mu nu bi translated">审核进度</h2><p id="8bec" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">更改main():</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9beb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<em class="lk"> "receivedWord:" </em>之后，你得到一个填充了单词信息的结构。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/3d697ead5d0586180eb4e896055a785d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gmHE60mf-kUd520Jew2DyQ.png"/></div></div></figure><h1 id="0c12" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">格式化邮件</h1><p id="1fbf" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">下面是JSON编码的<code class="fe nd ne nf ng b">WordInfo</code>结构片段，因为一个词可以有很多含义、定义和例子。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="c455" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在下面的函数中，我们迭代<code class="fe nd ne nf ng b">WordInfo</code>以找到<em class="lk">定义</em>、<em class="lk">含义</em>和<em class="lk">示例</em>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="2f70" class="nj mf in bd mg nk nl dn mk nm nn dp mo kx no np mq lb nq nr ms lf ns nt mu nu bi translated">审核进度</h2><p id="5942" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">要查看我们获得的单词参数是否正确，请更新main():</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0aa8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">代码执行后，您将在命令行中看到以下格式的消息:</p><pre class="kd ke kf kg gt nv ng nw nx aw ny bi"><span id="ce32" class="nj mf in ng b gy nz oa l ob oc">Part of speech:<br/>Definition:<br/>Example:</span></pre><p id="a4bb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当单词不存在或拼错时,<code class="fe nd ne nf ng b">getWordInfo()</code>函数返回nil和error。要检查这个问题，您可以键入一个错误的单词，然后在聊天中查看消息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/f929bbdc04a5cfe223f8768b8251cb77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcL03jF12Q8Zt8VokHxMxw.png"/></div></div></figure><h1 id="91d7" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">发送结果</h1><p id="ad21" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">我们用<code class="fe nd ne nf ng b">tgbotapi.NewMessage()</code>方法创建一个<code class="fe nd ne nf ng b">message config</code>。为此我们需要两个参数:<code class="fe nd ne nf ng b">update.Message.Chat.ID</code>或者我们需要将消息发送到哪里，以及<code class="fe nd ne nf ng b">wordParams</code>或者我们需要向用户发送什么。然后，使用<code class="fe nd ne nf ng b">bot.Send()</code>方法将消息config发送给用户，如下例所示:</p><pre class="kd ke kf kg gt nv ng nw nx aw ny bi"><span id="12b3" class="nj mf in ng b gy nz oa l ob oc">msg := tgbotapi.NewMessage(update.Message.Chat.ID, wordParams)		</span><span id="ea8a" class="nj mf in ng b gy od oa l ob oc">_, err = bot.Send(msg)<br/>    if err != nil {<br/>        log.Println("Unable to send message:", err)<br/>        return<br/>    }</span></pre><h2 id="796e" class="nj mf in bd mg nk nl dn mk nm nn dp mo kx no np mq lb nq nr ms lf ns nt mu nu bi translated">审核进度</h2><p id="15ab" class="pw-post-body-paragraph ko kp in kq b kr mw jo kt ku mx jr kw kx my kz la lb mz ld le lf na lh li lj ig bi translated">更新您的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/41997fff9cc707eb424ca2cc42ac05a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6UPxP-zz2O2CKIKuI8Qww.png"/></div></div></figure><h1 id="bec3" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated"><a class="ae nb" href="https://github.com/kozhevnikova/lang_bot" rel="noopener ugc nofollow" target="_blank">完整代码</a></h1></div></div>    
</body>
</html>