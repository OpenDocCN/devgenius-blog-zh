<html>
<head>
<title>Code Smell 106 — Production Dependent Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味 106 —依赖于生产的代码</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/code-smell-106-production-dependent-code-f74dbbfde0cf?source=collection_archive---------6-----------------------#2021-11-27">https://blog.devgenius.io/code-smell-106-production-dependent-code-f74dbbfde0cf?source=collection_archive---------6-----------------------#2021-11-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8434" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">不要为生产环境添加 IFs 检查。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/327e1170a2d8a876b7ee6e29b84c6afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ftf-Focjz60D_gju8Di9RA.jpeg"/></div></div></figure><blockquote class="ko kp kq"><p id="1d16" class="kr ks kt ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">TL；DR:避免添加与生产相关的条件句</p></blockquote><h1 id="cb58" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">问题</h1><ul class=""><li id="129f" class="mg mh in ku b kv mi ky mj mk ml mm mn mo mp ln mq mr ms mt bi translated">失败快速原则违反</li><li id="3326" class="mg mh in ku b kv mu ky mv mk mw mm mx mo my ln mq mr ms mt bi translated">缺乏可测试性</li></ul><h1 id="35c5" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">解决方法</h1><p id="a9a7" class="pw-post-body-paragraph kr ks in ku b kv mi jo kx ky mj jr la mk mz ld le mm na lh li mo nb ll lm ln ig bi translated">1.如果完全有必要，模拟环境并测试所有的环境。</p><h1 id="c566" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">语境</h1><p id="4919" class="pw-post-body-paragraph kr ks in ku b kv mi jo kx ky mj jr la mk mz ld le mm na lh li mo nb ll lm ln ig bi translated">有时候，我们需要在开发和生产中创造不同的行为。</p><p id="6fe7" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">例如密码的强度。</p><p id="b660" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">在这种情况下，我们需要用优势策略配置环境，并测试策略而不是环境本身。</p><h1 id="8ce4" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">示例代码</h1><h2 id="41ea" class="nc lp in bd lq nd ne dn lu nf ng dp ly mk nh ni ma mm nj nk mc mo nl nm me nn bi translated">错误的</h2><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="56d3" class="nc lp in np b gy nt nu l nv nw">def send_welcome_email(email_address, environment):<br/> if ENVIRONMENT_NAME == “production”:<br/> print(f”Sending welcome email to {email_address} from Bob Builder &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;”)<br/> else:<br/> print(“Emails are sent only on production”)<br/> <br/>send_welcome_email(“<a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a>”, “development”)<br/># Emails are sent only on production</span><span id="dfd8" class="nc lp in np b gy ny nu l nv nw">send_welcome_email(“<a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a>”, “production”)<br/># Sending welcome email to <a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a> from Bob Builder &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;</span></pre><h2 id="6fa4" class="nc lp in bd lq nd ne dn lu nf ng dp ly mk nh ni ma mm nj nk mc mo nl nm me nn bi translated">对吧</h2><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="f440" class="nc lp in np b gy nt nu l nv nw">class ProductionEnvironment:<br/> FROM_EMAIL = “Bob Builder &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;”</span><span id="e723" class="nc lp in np b gy ny nu l nv nw">class DevelopmentEnvironment:<br/> FROM_EMAIL = “Bob Builder Development &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;”<br/> <br/>#We can unit test environments<br/>#and even implement different sending mechanisms</span><span id="92e7" class="nc lp in np b gy ny nu l nv nw">def send_welcome_email(email_address, environment):<br/> print(f”Sending welcome email to {email_address} from {environment.FROM_EMAIL}”)<br/> #We can delegate into a fake sender (and possible logger)<br/> #and unit test it</span><span id="59d0" class="nc lp in np b gy ny nu l nv nw">send_welcome_email(“<a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a>”, DevelopmentEnvironment())<br/># Sending welcome email to <a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a> from Bob Builder Development &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;</span><span id="aff7" class="nc lp in np b gy ny nu l nv nw">send_welcome_email(“<a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a>”, ProductionEnvironment())<br/># Sending welcome email to <a class="ae nx" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a> from Bob Builder &lt;<a class="ae nx" href="mailto:bob@builder.com" rel="noopener ugc nofollow" target="_blank">bob@builder.com</a>&gt;</span></pre><h1 id="2d4a" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">侦查</h1><p id="fbb7" class="pw-post-body-paragraph kr ks in ku b kv mi jo kx ky mj jr la mk mz ld le mm na lh li mo nb ll lm ln ig bi translated">[X]手册</p><p id="c094" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">这是一种设计气味。</p><p id="eea0" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">我们需要创建空的开发/生产配置，并委托可定制的多态对象。</p><h1 id="4dc7" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">标签</h1><ul class=""><li id="8fc9" class="mg mh in ku b kv mi ky mj mk ml mm mn mo mp ln mq mr ms mt bi translated">连接</li></ul><h1 id="2051" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">结论</h1><p id="1484" class="pw-post-body-paragraph kr ks in ku b kv mi jo kx ky mj jr la mk mz ld le mm na lh li mo nb ll lm ln ig bi translated">避免添加不可测试的条件句。</p><p id="deea" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">创建委派业务规则的配置。</p><p id="7d68" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">使用抽象、协议和接口，避免硬性层次结构。</p><h1 id="0f84" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">关系</h1><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/code-smell-56-preprocessors-89d8beb6655b"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd io gy z fp oh fr fs oi fu fw im bi translated">代码气味 56 —预处理器</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">我们希望我们的代码在不同的环境和操作系统下表现不同，所以在编译时做出决定…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">blog.devgenius.io</p></div></div><div class="ol l"><div class="om l on oo op ol oq km oc"/></div></div></a></div><h1 id="db5c" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">更多信息</h1><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-get-rid-of-annoying-ifs-forever-317033474484"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd io gy z fp oh fr fs oi fu fw im bi translated">如何永远摆脱烦人的 if</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">为什么我们学习编程的第一条指令应该是最后使用的。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">blog.devgenius.io</p></div></div><div class="ol l"><div class="or l on oo op ol oq km oc"/></div></div></a></div></div><div class="ab cl os ot hr ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ig ih ii ij ik"><p id="29ca" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">这条推文的灵感来自<a class="oz pa ep" href="https://medium.com/u/b6b5a296f32f?source=post_page-----f74dbbfde0cf--------------------------------" rel="noopener" target="_blank">简·贾科姆利</a></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl os ot hr ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ig ih ii ij ik"><blockquote class="ko kp kq"><p id="875e" class="kr ks kt ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">复杂是技术不成熟的标志。无论是 ATM 还是爱国者导弹，简单易用都是设计良好的产品的真正标志。</p></blockquote><p id="6375" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated"><em class="kt">林志玲</em></p><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/software-engineering-great-quotes-3af63cea6782"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd io gy z fp oh fr fs oi fu fw im bi translated">软件工程名言</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">blog.devgenius.io</p></div></div><div class="ol l"><div class="pd l on oo op ol oq km oc"/></div></div></a></div></div><div class="ab cl os ot hr ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ig ih ii ij ik"><p id="e96b" class="pw-post-body-paragraph kr ks in ku b kv kw jo kx ky kz jr la mk lc ld le mm lg lh li mo lk ll lm ln ig bi translated">本文是 CodeSmell 系列的一部分。</p><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd io gy z fp oh fr fs oi fu fw im bi translated">如何找到你的代码中有问题的部分</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">blog.devgenius.io</p></div></div><div class="ol l"><div class="pe l on oo op ol oq km oc"/></div></div></a></div></div></div>    
</body>
</html>