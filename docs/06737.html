<html>
<head>
<title>Send mass emails using Google Apps Script from a Google Spreadsheet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Google 电子表格中的 Google Apps 脚本发送大量电子邮件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/send-mass-emails-using-google-apps-script-from-a-google-spreadsheet-fc2f79c9febd?source=collection_archive---------2-----------------------#2022-01-30">https://blog.devgenius.io/send-mass-emails-using-google-apps-script-from-a-google-spreadsheet-fc2f79c9febd?source=collection_archive---------2-----------------------#2022-01-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f6bac2ac354a78d54873a3642e240507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IOlhVEwObC9HE7I6Yh-Ow.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片来源:Enginemailer</figcaption></figure><p id="e0ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你好，学习者，</p><p id="307c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在当今世界，每个人都时间紧迫，他们希望尽快完成任务。在这期间，我们必须给那群人发电子邮件，邀请他们参加会议，以及其他因人而异的细节。所以给一群人一个一个发这样的详细信息的邮件，会非常耗费时间，也会增加发送的详细信息出错的几率。</p><p id="26bf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我们将看到—“<strong class="kb io">如何使用 Google Apps 脚本</strong>从 Google 电子表格发送批量电子邮件”。</p><h1 id="dad3" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">你会从中得到什么好处？</h1><ol class=""><li id="51dd" class="lv lw in kb b kc lx kg ly kk lz ko ma ks mb kw mc md me mf bi translated">基于您需求的个性化电子邮件</li><li id="7b0c" class="lv lw in kb b kc mg kg mh kk mi ko mj ks mk kw mc md me mf bi translated">向群组发送电子邮件时节省的工作量</li><li id="94f8" class="lv lw in kb b kc mg kg mh kk mi ko mj ks mk kw mc md me mf bi translated">用正确的细节与正确的观众互动</li></ol></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><h1 id="941e" class="kx ky in bd kz la ms lc ld le mt lg lh li mu lk ll lm mv lo lp lq mw ls lt lu bi translated">使用 Google 电子表格批量发送电子邮件的 Google Apps 脚本实现</h1><p id="df83" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk mx km kn ko my kq kr ks mz ku kv kw ig bi translated">我们将按照这些步骤来开发批量电子邮件模板。</p><ol class=""><li id="047c" class="lv lw in kb b kc kd kg kh kk na ko nb ks nc kw mc md me mf bi translated">在你的硬盘上创建一个新的谷歌电子表格。</li><li id="e54b" class="lv lw in kb b kc mg kg mh kk mi ko mj ks mk kw mc md me mf bi translated">为栏提供您需要的数据，如电子邮件、姓名、个性化信息等。</li><li id="ed65" class="lv lw in kb b kc mg kg mh kk mi ko mj ks mk kw mc md me mf bi translated">打开 Google Apps 脚本编辑器编写脚本。</li></ol><p id="f8c4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">脚本编辑路径:<strong class="kb io">扩展= &gt; Apps 脚本</strong> <em class="nd">(来自电子表格菜单选项)</em></p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/6a2b1ef7d3114647b6861072d98f5c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*nMl-iHMVfzdiM6h6InzA9w.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">谷歌电子表格扩展菜单栏</figcaption></figure><p id="90c7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当我们继续进行脚本开发时，让我们回顾一下这些步骤。</p><p id="a264" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 1: </strong>在这一步中，我们将创建一个包含所需列的 Google 电子表格。对于这个示例，我添加了三列——姓名、电子邮件和地址。请参见下图中的示例。</p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/178b99893661d92535e4e1aa5f4156ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TgwC2u0Gyx7OpMYsDo5VJQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">谷歌电子表格演示图片</figcaption></figure></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><p id="e1ff" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第二步:</strong>创建电子表格模板后打开脚本编辑器，编写下面的<strong class="kb io">sendmeil()</strong>函数。</p><pre class="nf ng nh ni gt nk nl nm nn aw no bi"><span id="f66e" class="np ky in nl b gy nq nr l ns nt">function sendEmail(){</span><span id="e30f" class="np ky in nl b gy nu nr l ns nt">var ss = SpreadsheetApp.openById("Your_Spreadsheet_ID");</span><span id="2c0d" class="np ky in nl b gy nu nr l ns nt">var sheet = ss.getSheetByName("Your_SheetName");</span><span id="7d5c" class="np ky in nl b gy nu nr l ns nt">var json_data = getData(sheet);</span><span id="cdc3" class="np ky in nl b gy nu nr l ns nt">for(var j=0;j&lt;json_data.length;j++) {</span><span id="263c" class="np ky in nl b gy nu nr l ns nt">var message="Dear "+json_data[j].name+",&lt;br&gt;&lt;br&gt; I am glad to invite you at the following address: "+ json_data[j].address +".&lt;br&gt;&lt;br&gt;";</span><span id="d06b" class="np ky in nl b gy nu nr l ns nt">message=message+"Best wishes,&lt;br&gt;"+"Team&lt;br&gt;&lt;br&gt;";</span><span id="73a0" class="np ky in nl b gy nu nr l ns nt">MailApp.sendEmail({to: json_data[j].email, cc: 'Your_CC_email_ID', subject: "Invitation", htmlBody: message, noReply:true} );</span><span id="81e6" class="np ky in nl b gy nu nr l ns nt">}</span><span id="c4bd" class="np ky in nl b gy nu nr l ns nt">}</span></pre><p id="9735" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们已经在示例发送电子邮件函数中定义了<strong class="kb io">电子表格 id </strong>和<strong class="kb io">工作表名称</strong>。我们的下一节将描述调用<strong class="kb io"> getData() </strong>函数后会发生什么，该函数以 JSON 格式返回电子表格数据。之后我们编写了一个邮件模板，其中设置了 JSON 参数，如姓名、电子邮件、邮件内容之间的地址，并且调用了<strong class="kb io"> MailApp </strong>库函数来发送邮件。整个过程会在一个等于 JSON 数组长度的循环中被调用，这个长度就是 Google 电子表格中的总人数。</p></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><p id="32d2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第三步:我们需要定义<strong class="kb io"> getData() </strong>函数，让我们看看它的代码。编写<strong class="kb io"> getData() </strong>函数来获取 JSON 格式的 Google 电子表格数据。</p><pre class="nf ng nh ni gt nk nl nm nn aw no bi"><span id="5805" class="np ky in nl b gy nq nr l ns nt">function getData(sheet){</span><span id="65ff" class="np ky in nl b gy nu nr l ns nt">   var jo = {};</span><span id="06e2" class="np ky in nl b gy nu nr l ns nt">   var dataArray = [];</span><span id="61b0" class="np ky in nl b gy nu nr l ns nt">// collecting data from 2nd Row , 1st column to last row and last    // column sheet.getLastRow()-1</span><span id="e6af" class="np ky in nl b gy nu nr l ns nt">var rows = sheet.getRange(2,1,sheet.getLastRow()-1, sheet.getLastColumn()).getValues();</span><span id="681d" class="np ky in nl b gy nu nr l ns nt">for(var i = 0, l= rows.length; i&lt;l ; i++){</span><span id="bc64" class="np ky in nl b gy nu nr l ns nt">     var dataRow = rows[i];<br/>     var record = {};<br/>      record['sno'] = dataRow[0];<br/>      record['name'] = dataRow[1];<br/>      record['email'] = dataRow[2];<br/>      record['address']=dataRow[3];<br/>      dataArray.push(record);<br/>   }</span><span id="6b1d" class="np ky in nl b gy nu nr l ns nt">   jo = dataArray;<br/>   var result = JSON.stringify(jo);</span><span id="d020" class="np ky in nl b gy nu nr l ns nt">return jo;<br/>}</span></pre><p id="4382" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们上面声明的函数已经定义了如下几个参数:工作表、最后一行和最后一列的范围，以及数组形式的范围值，它将以 JSON 格式返回完整的范围值。</p></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><p id="4e68" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 4: </strong>这是<strong class="kb io">奖励</strong>步骤，如果你想运行这个功能或从谷歌电子表格的前端调用发送电子邮件功能，你可以在谷歌应用程序脚本的顶部使用下面的脚本。</p><pre class="nf ng nh ni gt nk nl nm nn aw no bi"><span id="b307" class="np ky in nl b gy nq nr l ns nt">function onOpen(e) {</span><span id="2016" class="np ky in nl b gy nu nr l ns nt">// Add a custom menu to the spreadsheet.</span><span id="547e" class="np ky in nl b gy nu nr l ns nt">SpreadsheetApp.getUi() // Or DocumentApp, SlidesApp, or FormApp.<br/>.createMenu('Custom Menu')<br/>.addItem('Send Emails', 'sendEmail'<br/>.addToUi();</span><span id="917d" class="np ky in nl b gy nu nr l ns nt">}</span></pre><p id="f456" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上面的代码中，当执行<strong class="kb io"> onOpen() </strong>函数时，一个名为“<strong class="kb io">自定义菜单</strong>的自定义菜单被添加到电子表格菜单选项的右侧。<strong class="kb io">senemail()</strong>函数需要在自定义菜单下定义，方法是添加<strong class="kb io"> addItem </strong>库函数，作为另一个选项从前端调用它。</p></div><div class="ab cl ml mm hr mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ig ih ii ij ik"><p id="041f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你有兴趣学习 Google Apps 脚本和自动化你的 Google Workspace？必须试试这本<strong class="kb io">电子书</strong>上的“<a class="ae nv" href="https://www.amazon.com/dp/B0BTJC9X5R" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">谷歌应用套件脚本:初学者指南</strong> </a>”</p><p id="e2b6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">希望这篇文章能帮助你了解如何发送个性化的群发邮件。如有疑问，欢迎留言评论。我很乐意帮助你。</p><p id="df61" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">快乐学习！</p></div></div>    
</body>
</html>