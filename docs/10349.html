<html>
<head>
<title>Flask with MongoDB and JWT Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 MongoDB 和 JWT 认证的 Flask</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/flask-with-mongodb-and-jwt-authentication-5d9ba2c3ef7e?source=collection_archive---------3-----------------------#2022-10-26">https://blog.devgenius.io/flask-with-mongodb-and-jwt-authentication-5d9ba2c3ef7e?source=collection_archive---------3-----------------------#2022-10-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="bfce" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">带有 MongoDB 和 JWT 认证的 Flask。</h1><p id="d516" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在这个任务中，我尝试使用 Flask 和 mongo DB 制作带有 JWT 令牌认证的软件。想法是注册一个用户，一个用户可以管理自己的模板(选择，更新，删除，插入)。</p><h1 id="1664" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">端点</h1><ol class=""><li id="0bce" class="lg lh in kk b kl km kp kq kt li kx lj lb lk lf ll lm ln lo bi translated">注册用户</li><li id="c8d9" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">登录用户(JWT)</li><li id="65b7" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">插入模板</li><li id="cc22" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">选择所有模板</li><li id="8b7d" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">更新模板</li><li id="1190" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">删除模板</li></ol><h1 id="ec0e" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">代码部分:</h1><p id="fc91" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">导入所有必需的模块</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8af0" class="md jl in lz b gy me mf l mg mh">from flask import Flask<br/>from pymongo import MongoClient<br/>import hashlib<br/>from flask import Flask, request, jsonify<br/>from flask_jwt_extended import JWTManager, create_access_token, get_jwt_identity, jwt_required<br/>import datetime<br/>import hashlib<br/>import urllib</span></pre><p id="1c45" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">设置 JWT 身份验证</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7f2f" class="md jl in lz b gy me mf l mg mh">app = Flask(__name__)<br/>jwt = JWTManager(app) # initialize JWTManager<br/>app.config['JWT_SECRET_KEY'] = '38dd56f56d405e02ec0ba4be4607eaab'<br/>app.config['JWT_ACCESS_TOKEN_EXPIRES'] = datetime.timedelta(days=1) # define the life span of the token</span></pre><p id="8030" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">JWT 的秘密可以通过秘密图书馆获得。</p><ol class=""><li id="3472" class="lg lh in kk b kl mi kp mj kt mn kx mo lb mp lf ll lm ln lo bi translated">去终点站</li><li id="98a7" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">键入以下几行代码</li></ol><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5002" class="md jl in lz b gy me mf l mg mh">&gt;&gt;&gt; import secrets<br/>&gt;&gt;&gt; secrets.token_hex(16)<br/>'38dd56f56d405e02ec0ba4be4607eaab'</span></pre><p id="5b72" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">设置 Mongo 数据库，我在 mongodb 上在线创建了这个数据库。点击此链接创建在线 mongo db 数据库<a class="ae mq" href="https://www.mongodb.com/docs/atlas/online-archive/connect-to-online-archive/" rel="noopener ugc nofollow" target="_blank">https://www . mongo db . com/docs/atlas/online-archive/connect-to-online-archive/</a></p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ccde" class="md jl in lz b gy me mf l mg mh">client = MongoClient("mongodb+srv://Sohaib:sohaib@cluster0.ljdhvgj.mongodb.net/?retryWrites=true&amp;w=majority")<br/>db = client["mydatabase"]<br/>users_collection = db["users"]<br/>templates_collection = db["templates"]</span></pre><p id="6c3d" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">简单的 Hello world 路线，检查是否一切正常。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="e4f2" class="md jl in lz b gy me mf l mg mh">@app.route('/')<br/>def hello_world():<br/>	return 'Hello, World!'</span></pre><p id="e98e" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">完成后，进入终端并启动应用程序。我将这段代码写在 main.py 文件中。请在启动应用程序之前安装这些要求。<code class="fe mr ms mt lz b">pip install -r requirements.txt</code></p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a6da" class="md jl in lz b gy me mf l mg mh">python main.py</span></pre><h1 id="a125" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">注册 API</h1><p id="f0db" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在让我们创建一个注册用户的端点。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2683" class="md jl in lz b gy me mf l mg mh">@app.route("/api/v1/users", methods=["POST"])<br/>def register():<br/>    new_user = request.get_json() # store the json body request<br/>    # Creating Hash of password to store in the database<br/>    new_user["password"] = hashlib.sha256(new_user["password"].encode("utf-8")).hexdigest() # encrpt password<br/>    # Checking if user already exists<br/>    doc = users_collection.find_one({"username": new_user["username"]}) # check if user exist<br/>    # If not exists than create one<br/>    if not doc:<br/>        # Creating user<br/>        users_collection.insert_one(new_user)<br/>        return jsonify({'msg': 'User created successfully'}), 201<br/>    else:<br/>        return jsonify({'msg': 'Username already exists'}), 409</span></pre><p id="beb0" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">要检查此端点，请转到终端启动应用程序。在那之后打开你的邮差像这样打网址。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="d2ba" class="md jl in lz b gy me mf l mg mh"><a class="ae mq" href="http://localhost:5000/api/v1/users" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/api/v1/users</a></span></pre><p id="ee63" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点的主体</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8dee" class="md jl in lz b gy me mf l mg mh">{<br/>  "username":"sohaib123", <br/>  "password":"sohaib123"<br/>}</span></pre><p id="a500" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5d3a" class="md jl in lz b gy me mf l mg mh">{<br/>  "msg": "User created successfully"<br/>}</span></pre><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/14f41154c92e191e4469f372cd0cf2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9gkS_f8kr0bQ2_Ym.png"/></div></div></figure><h1 id="0614" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">登录用户</h1><p id="1858" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">该端点用于用户登录</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="fd88" class="md jl in lz b gy me mf l mg mh">@app.route("/api/v1/login", methods=["post"])<br/>def login():<br/>    # Getting the login Details from payload<br/>    login_details = request.get_json() # store the json body request<br/>    # Checking if user exists in database or not<br/>    user_from_db = users_collection.find_one({'username': login_details['username']})  # search for user in database<br/>    # If user exists<br/>    if user_from_db:<br/>        # Check if password is correct<br/>        encrpted_password = hashlib.sha256(login_details['password'].encode("utf-8")).hexdigest()<br/>        if encrpted_password == user_from_db['password']:<br/>            # Create JWT Access Token<br/>            access_token = create_access_token(identity=user_from_db['username']) # create jwt token<br/>            # Return Token<br/>            return jsonify(access_token=access_token), 200</span><span id="db84" class="md jl in lz b gy nc mf l mg mh">    return jsonify({'msg': 'The username or password is incorrect'}), 401</span><span id="9699" class="md jl in lz b gy nc mf l mg mh"><a class="ae mq" href="http://localhost:5000/api/v1/login" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/api/v1/login</a></span></pre><p id="279a" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点的主体</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7a10" class="md jl in lz b gy me mf l mg mh">{<br/>  "username":"sohaib123", <br/>  "password":"sohaib123"<br/>}</span></pre><p id="c331" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2bbe" class="md jl in lz b gy me mf l mg mh">{<br/>  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY2Njc4MDg2MywianRpIjoiNTM2Zjg2MTQtODllZi00YWI1LWIxNDgtNmYxOTAxYTYyMDY4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InNvaGFpYjEyMyIsIm5iZiI6MTY2Njc4MDg2MywiZXhwIjoxNjY2ODY3MjYzfQ.IRsLXY2hugjJkmtpHi79X8JgueXUmDIzYC7DlYIQD_A"<br/>}</span></pre><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/9c0d8d5e466348443ee4677bd31eee8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mpMufI6ZG9dv_lR7.png"/></div></div></figure><h1 id="c2f1" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建模板</h1><p id="7014" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">创建模板这里的模板只是一个演示对象，你可以创建书、汽车、自行车等<code class="fe mr ms mt lz b">@jwt_required()</code>这一行帮助我们验证访问令牌是否有效</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ea79" class="md jl in lz b gy me mf l mg mh">@app.route("/create", methods=["POST"])<br/>@jwt_required()<br/>def create_template():<br/>    """Creating the template with respect to the user</span><span id="04f5" class="md jl in lz b gy nc mf l mg mh">    Returns:<br/>        dict: Return the profile and template created<br/>    """<br/>    # Getting the user from access token<br/>    current_user = get_jwt_identity() # Get the identity of the current user<br/>    user_from_db = users_collection.find_one({'username' : current_user})<br/>    <br/>    # Checking if user exists<br/>    if user_from_db:<br/>        # Getting the template details from json<br/>        template_details = request.get_json() # store the json body request<br/>        # Viewing if templated already present in collection<br/>        user_template = {'profile' : user_from_db["username"],  "template": template_details["template"]}<br/>        doc = templates_collection.find_one(user_template) # check if user exist<br/>        # Creating collection if not exists<br/>        <br/>        if not doc:<br/>            templates_collection.insert_one(user_template)<br/>            print("user_template ", user_template)<br/>            return jsonify({'msg': 'Template created successfully'}), 200<br/>        # Returning message if template exists<br/>        else: return jsonify({'msg': 'Template already exists on your profile'}), 404<br/>    else:<br/>        return jsonify({'msg': 'Access Token Expired'}), 404</span><span id="d11b" class="md jl in lz b gy nc mf l mg mh"><a class="ae mq" href="http://localhost:5000/create" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/create</a></span></pre><p id="370b" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点的主体</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="35e9" class="md jl in lz b gy me mf l mg mh">{<br/>  "template":"My First Template"<br/>}</span></pre><p id="814f" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3c15" class="md jl in lz b gy me mf l mg mh">{<br/>  "msg": "Template created successfully"<br/>}</span></pre><p id="e44c" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">在 postman 的 auth 选项中给出访问令牌</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3640" class="md jl in lz b gy me mf l mg mh">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY2Njc4MDg2MywianRpIjoiNTM2Zjg2MTQtODllZi00YWI1LWIxNDgtNmYxOTAxYTYyMDY4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InNvaGFpYjEyMyIsIm5iZiI6MTY2Njc4MDg2MywiZXhwIjoxNjY2ODY3MjYzfQ.IRsLXY2hugjJkmtpHi79X8JgueXUmDIzYC7DlYIQD_A</span></pre><p id="a901" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">访问令牌</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nd"><img src="../Images/5767978ed28f2001f373768e90b6647c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KsV4E4y-JkHcvba9.png"/></div></div></figure><p id="6ae7" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">创建端点</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/928fb497ebd38285b3c15765b4d7dbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*28aGe9wReyTXKjHp.png"/></div></div></figure><h1 id="310b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">获取所有模板</h1><p id="25a0" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">获取特定用户的所有模板<code class="fe mr ms mt lz b">@jwt_required()</code>这一行帮助我们验证访问令牌是否有效</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="396e" class="md jl in lz b gy me mf l mg mh">@app.route("/get", methods=["GET"])<br/>@jwt_required()<br/>def get_template():<br/>    """Get the templates of specefic user</span><span id="b3de" class="md jl in lz b gy nc mf l mg mh">    Returns:<br/>        dict: Return the profile and template <br/>    """<br/>    # Getting the user from access token<br/>    current_user = get_jwt_identity() # Get the identity of the current user<br/>    user_from_db = users_collection.find_one({'username' : current_user})<br/>    # Checking if user exists<br/>    if user_from_db:<br/>        # Viewing if templated already present in collection<br/>        user_template = {'profile' : user_from_db["username"]}<br/>        return jsonify({"docs":list(db.templates.find(user_template, {"_id":0}))}), 200<br/>    else:<br/>        return jsonify({'msg': 'Access Token Expired'}), 404</span><span id="ccc8" class="md jl in lz b gy nc mf l mg mh"><a class="ae mq" href="http://localhost:5000/get" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/get</a></span></pre><p id="dc53" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="22ee" class="md jl in lz b gy me mf l mg mh">{<br/>  "docs": [<br/>    {<br/>      "profile": "sohaib123",<br/>      "template": "My First Template"<br/>    }<br/>  ]<br/>}</span></pre><p id="97b9" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">在 postman 的 auth 选项中给出访问令牌</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7b26" class="md jl in lz b gy me mf l mg mh">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY2Njc4MDg2MywianRpIjoiNTM2Zjg2MTQtODllZi00YWI1LWIxNDgtNmYxOTAxYTYyMDY4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InNvaGFpYjEyMyIsIm5iZiI6MTY2Njc4MDg2MywiZXhwIjoxNjY2ODY3MjYzfQ.IRsLXY2hugjJkmtpHi79X8JgueXUmDIzYC7DlYIQD_A</span></pre><p id="963a" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">访问令牌</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nd"><img src="../Images/cc71427f214e4ea18141d45a76d32ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-VS47dYeBZx1klsV.png"/></div></div></figure><p id="be04" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">创建端点</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/c0446fc3122ab6d98c88bb778684f860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XZBc_RKX3ON_hoI5.png"/></div></div></figure><h1 id="d511" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">更新模板</h1><p id="a1c5" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">更新模板<code class="fe mr ms mt lz b">@jwt_required()</code>这一行帮助我们验证访问令牌是否有效</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5f9e" class="md jl in lz b gy me mf l mg mh">@app.route("/update", methods=["POST"])<br/>@jwt_required()<br/>def update_template():<br/>    """Updating the template with respect to the user</span><span id="bb04" class="md jl in lz b gy nc mf l mg mh">    Returns:<br/>        dict: Return the profile and template created<br/>    """<br/>    # Getting the user from access token<br/>    current_user = get_jwt_identity() # Get the identity of the current user<br/>    user_from_db = users_collection.find_one({'username' : current_user})<br/>    <br/>    # Checking if user exists<br/>    if user_from_db:<br/>        # Getting the template details from json<br/>        template_details = request.get_json() # store the json body request<br/>        # Viewing if templated already present in collection<br/>        user_template = {'profile' : user_from_db["username"],  "template": template_details["old_template"]}<br/>        doc = templates_collection.find_one(user_template) # check if user exist<br/>        # Updating collection if not exists<br/>        <br/>        if doc:<br/>            doc["template"] = template_details["new_template"]<br/>            templates_collection.update_one(user_template, {"$set": {"template":doc["template"]}}, upsert=False)<br/>            return jsonify({'msg': 'Template Updated successfully'}), 200<br/>        # Returning message if template exists<br/>        else: return jsonify({'msg': 'Template not exists on your profile'}), 404<br/>    else:<br/>        return jsonify({'msg': 'Access Token Expired'}), 404</span><span id="b19e" class="md jl in lz b gy nc mf l mg mh"><a class="ae mq" href="http://localhost:5000/update" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/update</a></span></pre><p id="2866" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点的主体</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a21b" class="md jl in lz b gy me mf l mg mh">{<br/>  "old_template":"My First Template",<br/>  "new_template":"My First Updated Template"<br/>}</span></pre><p id="fc4c" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="144e" class="md jl in lz b gy me mf l mg mh">{<br/>  "msg": "Template Updated successfully"<br/>}</span></pre><p id="80bf" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">在 postman 的 auth 选项中给出访问令牌</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="33b1" class="md jl in lz b gy me mf l mg mh">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY2Njc4MDg2MywianRpIjoiNTM2Zjg2MTQtODllZi00YWI1LWIxNDgtNmYxOTAxYTYyMDY4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InNvaGFpYjEyMyIsIm5iZiI6MTY2Njc4MDg2MywiZXhwIjoxNjY2ODY3MjYzfQ.IRsLXY2hugjJkmtpHi79X8JgueXUmDIzYC7DlYIQD_A</span></pre><p id="9836" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">访问令牌</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nd"><img src="../Images/69b2a6dc239651b962e004c61b7d2556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h0EmyZfP98eGYF6n.png"/></div></div></figure><p id="f11a" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">更新终点</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/2c8794cebddfc683b41d101e7492fcfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U3Cmxwg1uOwI9puz.png"/></div></div></figure><p id="753a" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">检查数据库中是否有更新</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/639821c7b8e014bcc83bf44215d826d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QRZa79PP7ddGk-RS.png"/></div></div></figure><h1 id="79ef" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">删除模板</h1><p id="4fcc" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">更新模板<code class="fe mr ms mt lz b">@jwt_required()</code>这一行帮助我们验证访问令牌是否有效</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8cef" class="md jl in lz b gy me mf l mg mh">@app.route("/delete", methods=["POST"])<br/>@jwt_required()<br/>def delete_template():<br/>    """Creating the template with respect to the user</span><span id="c804" class="md jl in lz b gy nc mf l mg mh">    Returns:<br/>        dict: Return the profile and template created<br/>    """<br/>    # Getting the user from access token<br/>    current_user = get_jwt_identity() # Get the identity of the current user<br/>    user_from_db = users_collection.find_one({'username' : current_user})<br/>    <br/>    # Checking if user exists<br/>    if user_from_db:<br/>        # Getting the template details from json<br/>        template_details = request.get_json() # store the json body request<br/>        # Viewing if templated already present in collection<br/>        user_template = {'profile' : user_from_db["username"],  "template": template_details["template"]}<br/>        doc = templates_collection.find_one(user_template) # check if user exist<br/>        # Creating collection if not exists<br/>        <br/>        if doc:<br/>            templates_collection.delete_one(user_template)<br/>            print("user_template ", user_template)<br/>            return jsonify({'msg': 'Template Deleted Sucessfully'}), 404<br/>        # Returning message if template exists<br/>        else: return jsonify({'msg': 'Template not exists on your profile'}), 404<br/>    else:<br/>        return jsonify({'msg': 'Access Token Expired'}), 404</span><span id="8954" class="md jl in lz b gy nc mf l mg mh"><a class="ae mq" href="http://localhost:5000/delete" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/delete</a></span></pre><p id="9b0e" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点的主体</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7abf" class="md jl in lz b gy me mf l mg mh">{<br/>  "template":"My First Updated Template"<br/>}</span></pre><p id="c874" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">端点响应</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="1b4b" class="md jl in lz b gy me mf l mg mh">{<br/>  "msg": "Template Deleted Sucessfully"<br/>}</span></pre><p id="5001" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">在 postman 的 auth 选项中给出访问令牌</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="39e2" class="md jl in lz b gy me mf l mg mh">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY2Njc4MDg2MywianRpIjoiNTM2Zjg2MTQtODllZi00YWI1LWIxNDgtNmYxOTAxYTYyMDY4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InNvaGFpYjEyMyIsIm5iZiI6MTY2Njc4MDg2MywiZXhwIjoxNjY2ODY3MjYzfQ.IRsLXY2hugjJkmtpHi79X8JgueXUmDIzYC7DlYIQD_A</span></pre><p id="9fec" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">访问令牌</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nd"><img src="../Images/c69f50d9c14506e6b0d9d7924abec8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C3goMwWzqLjZqn-C.png"/></div></div></figure><p id="e693" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">更新终点</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/b2af62c0b727af27b12574d43731fbd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3g9MU13UsyCxBZvi.png"/></div></div></figure><p id="886a" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">检查是否从数据库中删除</p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/20967d3b955703686d91ca7342f33594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*64Db0yMaV5YaiB3V.png"/></div></div></figure><p id="da53" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">这就是我们如何在 flask，MongoDB 的帮助下制作一个 JWT 认证软件。希望你喜欢我的博客。</p><h1 id="fc61" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">测试案例</h1><p id="cbff" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在让我们为端点编写测试用例。我写了 3 个测试用例，</p><ol class=""><li id="5532" class="lg lh in kk b kl mi kp mj kt mn kx mo lb mp lf ll lm ln lo bi translated">主要终点</li><li id="a11f" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">登记</li><li id="932c" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ll lm ln lo bi translated">注册</li></ol><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="f2c0" class="md jl in lz b gy me mf l mg mh">import json<br/>from flask import Flask<br/>from main import app<br/></span><span id="e34b" class="md jl in lz b gy nc mf l mg mh">def test_flask():<br/>    """<br/>    GIVEN a Flask application configured for testing<br/>    WHEN the '/' page is requested (GET)<br/>    THEN check that the response is valid<br/>    """<br/>    flask_app =  app<br/></span><span id="3901" class="md jl in lz b gy nc mf l mg mh">    # Create a test client using the Flask application configured for testing<br/>    with flask_app.test_client() as test_client:<br/>        response = test_client.get('/')<br/>        assert response.status_code == 200<br/>       <br/>def test_registration():<br/>    flask_app =  app<br/></span><span id="ad9b" class="md jl in lz b gy nc mf l mg mh">    # Create a test client using the Flask application configured for testing<br/>    with flask_app.test_client() as test_client:<br/>        data = {<br/>            "username":"test1",<br/>            "password":"1234"<br/>        }<br/>        response = test_client.post('/api/v1/users', data=json.dumps(data), headers={"Content-Type": "application/json"})<br/>        assert response.status_code == 201 or response.status_code == 409</span><span id="c73d" class="md jl in lz b gy nc mf l mg mh">def test_login():<br/>    flask_app =  app<br/></span><span id="582d" class="md jl in lz b gy nc mf l mg mh">    # Create a test client using the Flask application configured for testing<br/>    with flask_app.test_client() as test_client:<br/>        data = {<br/>            "username":"test1",<br/>            "password":"1234"<br/>        }<br/>        response = test_client.post('/api/v1/login', data=json.dumps(data), headers={"Content-Type": "application/json"})<br/>        assert response.status_code == 200</span></pre><p id="ab87" class="pw-post-body-paragraph ki kj in kk b kl mi kn ko kp mj kr ks kt mk kv kw kx ml kz la lb mm ld le lf ig bi translated">现在去终端写，<code class="fe mr ms mt lz b">pytest</code></p><figure class="lu lv lw lx gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/2a17e12e236a508ce7cb375c800ca7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GqEAWIhDrZXQVmfG.png"/></div></div></figure><h1 id="1d4e" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">作者</h1><ul class=""><li id="6fd9" class="lg lh in kk b kl km kp kq kt li kx lj lb lk lf ne lm ln lo bi translated">索海卜·安瓦尔</li><li id="c072" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ne lm ln lo bi translated">Gmail:<a class="ae mq" href="mailto:sohaibanwaar36@gmail.com" rel="noopener ugc nofollow" target="_blank">sohaibanwaar36@gmail.com</a></li><li id="d88f" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ne lm ln lo bi translated">LinkedIn : <a class="ae mq" href="https://www.linkedin.com/in/sohaib-anwaar-4b7ba1187/" rel="noopener ugc nofollow" target="_blank">这里有一些专业的谈话</a></li><li id="e743" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ne lm ln lo bi translated">堆栈溢出:<a class="ae mq" href="https://stackoverflow.com/users/7959545/sohaib-anwaar" rel="noopener ugc nofollow" target="_blank">在这里获得我的帮助</a></li><li id="92e5" class="lg lh in kk b kl lp kp lq kt lr kx ls lb lt lf ne lm ln lo bi translated">在这里查看我的杰作<a class="ae mq" href="https://www.kaggle.com/sohaibanwaar1203" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>