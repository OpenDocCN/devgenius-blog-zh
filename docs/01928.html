<html>
<head>
<title>Visualising US COVID-19 Spread Graphically Using Mathematica</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mathematica图形化可视化美国新冠肺炎传播</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/visualising-us-covid-19-spread-graphically-using-mathematica-b55a2494d1f4?source=collection_archive---------21-----------------------#2020-07-14">https://blog.devgenius.io/visualising-us-covid-19-spread-graphically-using-mathematica-b55a2494d1f4?source=collection_archive---------21-----------------------#2020-07-14</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="5d7b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">数据的图形可视化比数字表格更容易理解和直观。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/31791e2a1da953bcf9a264d6cc66b320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKLE6RdKmLQiYR6da_gQqQ.png"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">图片来源:作者</figcaption></figure><p id="abd7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我们在这篇文章中的目的是使用美国大陆的图形表示，并可视化新冠肺炎感染的传播如何随着时间的推移而变化。</p><h1 id="3730" class="lc ld ir bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">检索和处理原始数据的功能</strong></h1><p id="e63b" class="pw-post-body-paragraph jo jp ir jq b jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh me kj kk kl ik bi translated">我们将使用<a class="ae mf" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank"> Johns Hopkins的原始数据</a> —注意,“MM”和“dd”分别表示月份和日期，如果它们小于10，则用零填充，即根据流行编程语言中的标准日期和数字格式规范，七月是“09”而不是“9”。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="cddb" class="ml ld ir mh b gz mm mn l mo mp">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_ 19_data/csse_covid_19_daily_reports_us/MM-dd-YYYY.csv</span></pre><p id="33e2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">首先，我们需要加载原始CSV数据，并将其转换成一个<a class="ae mf" href="https://reference.wolfram.com/language/ref/Dataset.html" rel="noopener ugc nofollow" target="_blank">数据集</a>，以便后续操作。我们将使用一个简单的函数将带有一个标题行的CSV文件转换成数据集，</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="723f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在，我们将要分析的绘图函数的第一次迭代，</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="f9fc" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我知道你们中的一些Wolfram语言纯粹主义者可能会在这里畏缩和摇头，我只能道歉……但是我已经尽力为那些可能不太熟悉这门语言的人把事情提前安排好了。</p><p id="cc19" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在函数<em class="ms">plotusstatestadataheatmap[date _]</em>中，会传入一个格式为MM-dd-YYYY的日期字符串，并从指定的URL中检索一个CSV文件，然后使用toDataset[]函数将其处理成一个数据集。</p><p id="5319" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这个数据集有原始的形式，</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mt"><img src="../Images/880413568ab3f2f2402036b113469b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qshie61RUfwz-StE5gAU0g.png"/></div></div></figure><p id="3bd9" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在所述的列中，我们只需要<em class="ms">省_州</em>、<em class="ms">已确认的</em>、<em class="ms">纬度</em>和<em class="ms">经度_ </em>列，因此它们直接从数据集中提取到变量<em class="ms"> allMatches </em>中，代码如下:</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="eb73" class="ml ld ir mh b gz mm mn l mo mp">allMatches=data[All,{"Province_State","Lat","Long_","Confirmed"}];</span></pre><p id="527f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">因为我们不想包含不在大陆上的地理区域，例如美属萨摩亚群岛或钻石公主号游轮，所以我们还包含了对允许的纬度和经度值的简单限制，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="1eaf" class="ml ld ir mh b gz mm mn l mo mp">filteredMatches=allMatches[Select[#"Lat"&gt;20 &amp;&amp; #"Long_"&gt;-150&amp;]];</span></pre><p id="14d6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">一旦我们有了过滤的数据，而不是使用纬度和经度来绘图(因为它们是点值)，我们需要州或省的值，以便我们可以将它们着色。Wolfram语言有丰富的地理数据集，但不幸的是，它在将字符串转换成实体时非常特别。</p><p id="0f6b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了准确地做到这一点，名字必须删除空格，这样“南卡罗来纳州”就变成了“南卡罗来纳州”，而“哥伦比亚特区”在数据中被列为“哥伦比亚特区”，这有一个问题——大写字母“O”在这里至关重要。无论如何，我们做一些简单的字符串替换来解决这个问题，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="85d0" class="ml ld ir mh b gz mm mn l mo mp">states=Normal[filteredMatches[All,"Province_State"]];<br/>states=Map[StringReplace[#,<br/>           "District of Columbia"-&gt;"District Of Columbia"]&amp;,states];<br/>states=Map[StringReplace[#," "-&gt;""]&amp;,states];</span></pre><p id="4162" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">最终的状态列表现在是，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="09dc" class="ml ld ir mh b gz mm mn l mo mp">{Alabama,Arizona,Arkansas,California,Colorado,Connecticut,Delaware,DistrictOfColumbia,Florida,Georgia,Idaho,Illinois,Indiana,Iowa,Kansas,Kentucky,Louisiana,Maine,Maryland,Massachusetts,Michigan,Minnesota,Mississippi,Missouri,Montana,Nebraska,Nevada,NewHampshire,NewJersey,NewMexico,NewYork,NorthCarolina,NorthDakota,Ohio,Oklahoma,Oregon,Pennsylvania,RhodeIsland,SouthCarolina,SouthDakota,Tennessee,Texas,Utah,Vermont,Virginia,Washington,WestVirginia,Wisconsin,Wyoming}</span></pre><p id="fce7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">从州列表创建实体现在很简单，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="ca06" class="ml ld ir mh b gz mm mn l mo mp">stateEntities=Map[Entity["AdministrativeDivision",#]&amp;,states];</span></pre><p id="5f2d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">最后(在第一次迭代中)调用GeoRegionValuePlot[]，将stateEntities映射到先前从原始数据中提取的值，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="d5fc" class="ml ld ir mh b gz mm mn l mo mp">values=filteredMatches[All,"Confirmed"]//Normal;</span><span id="b7e2" class="ml ld ir mh b gz mu mn l mo mp"><a class="ae mf" href="https://reference.wolfram.com/language/ref/GeoRegionValuePlot.html" rel="noopener ugc nofollow" target="_blank">GeoRegionValuePlot</a>[Partition[Riffle[stateEntities,values],2],<br/>                   PlotLegends-&gt;True,<br/>                   ColorFunction-&gt;Automatic]</span></pre><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mv"><img src="../Images/1e7649c89c476d0c48cfb65fd13ec50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_lmRSVjsYYPLyoBr2jbmQ.png"/></div></div></figure><p id="fb10" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">GeoRegionValuePlot是丰富的可用函数之一。</p><h1 id="ecaf" class="lc ld ir bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">随时间绘制</h1><p id="2814" class="pw-post-body-paragraph jo jp ir jq b jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh me kj kk kl ik bi translated">Mathematica和Wolfram语言提供了几种方法来显示随时间变化的图表。</p><p id="a6f3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">列表动画</strong></p><p id="416b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">使用<a class="ae mf" href="https://reference.wolfram.com/language/ref/ListAnimate.html?q=ListAnimate" rel="noopener ugc nofollow" target="_blank"> ListAnimate </a>可以实现用不同的日期值调用plotUSStatesDataHeatmap 】,并存储返回值。首先，将函数的输出存储到一个列表中。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="9c73" class="ml ld ir mh b gz mm mn l mo mp">list = {plotUSStatesDataHeatmap["04-13-2020"],<br/>        plotUSStatesDataHeatmap["05-13-2020"],<br/>        plotUSStatesDataHeatmap["06-13-2020"],<br/>        plotUSStatesDataHeatmap["07-13-2020"]};</span></pre><p id="b926" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">制作动画很简单，只需在列表上调用ListAnimate，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="fa93" class="ml ld ir mh b gz mm mn l mo mp">ListAnimate[list, AnimationRunning -&gt; True]</span></pre><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mw"><img src="../Images/300663533c445c03652e65c1ad000467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wXvV10kQmiJ0AENIPyNS0w.gif"/></div></div></figure><p id="e0ae" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ListAnimate只对原型或几帧有用，因为重复手动调用原始函数非常重复和耗时，并且必须传递完整的日期。</p><p id="05f9" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">如果我们稍微改变一下函数的参数，取一个月份和日期，我们就能够更成功地自动化这个过程。</p><p id="d54b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">动画制作和操纵功能</strong></p><p id="2a30" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><a class="ae mf" href="https://reference.wolfram.com/language/ref/Manipulate.html" rel="noopener ugc nofollow" target="_blank">操作</a>函数给了我们更多的空间。如果我们稍后对plotusstatedataatmap[]函数稍加修改，并将其重命名，如下图所示我们可以传入月份和日期。</p><p id="93af" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了做到这一点，我们必须确保传入的数字在组合成用于导入原始数据的文件名时，在左侧补零。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="bd28" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Animate可用于播放一系列月份和日期，简单地提供了一个更自动化(和更少的工作要求)的方式来使用ListAnimate。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="51db" class="ml ld ir mh b gz mm mn l mo mp">Animate[plotUSStatesDataHeatmapSpecific[6, x], {x, 1, 30, 1}]</span></pre><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mw"><img src="../Images/dea2b89145ab67400200b5cfcf4614c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*k9UAZ3HfWVTzVUSfhElifQ.gif"/></div></div></figure><p id="a973" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">令人惊讶的是，Manipulate允许手动控制参数，因此您可以在给定的范围内前后移动。调用格式与Animate非常相似。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="4d35" class="ml ld ir mh b gz mm mn l mo mp">Manipulate[plotUSStatesDataHeatmapSpecific[6, x], {x, 1, 30, 1}]</span></pre><h1 id="8715" class="lc ld ir bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">进一步增强</h1><ul class=""><li id="4267" class="mx my ir jq b jr ma jv mb jz mz kd na kh nb kl nc nd ne nf bi translated">图右侧的图例可以更好地标准化，以便提供感染变化的统一测量，而不是在动画之间跳跃。</li><li id="36d5" class="mx my ir jq b jr ng jv nh jz ni kd nj kh nk kl nc nd ne nf bi translated">代替使用感染数据，累积病例数，原始数据的原始URL可以很容易地被改变以可视化死亡率。</li><li id="955d" class="mx my ir jq b jr ng jv nh jz ni kd nj kh nk kl nc nd ne nf bi translated">传递给动画(或操纵)的月份和日期的范围。这将是一个更好的连续几个月的范围，这样动画可以连续运行更长的时间。</li></ul><p id="9485" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这三个练习留给有兴趣的读者作为学习经验，以提高他们的技能！</p><p id="ed1d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">从详细的标签和各种颜色方案，有各种各样的选项来控制图表的绘制——既有预定义的，也可以由开发人员完全控制。</p><h1 id="9687" class="lc ld ir bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">尾注</h1><p id="db85" class="pw-post-body-paragraph jo jp ir jq b jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh me kj kk kl ik bi translated">我希望这是一个有用的简短见解，关于如何使用Mathematica(和Wolfram语言)强大的内置功能快速可视化复杂的数据。</p></div></div>    
</body>
</html>