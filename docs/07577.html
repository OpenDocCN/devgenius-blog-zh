<html>
<head>
<title>Organize your RoR project with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Docker 组织你的 RoR 项目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/organize-your-ror-project-with-docker-87b12d51b042?source=collection_archive---------13-----------------------#2022-04-06">https://blog.devgenius.io/organize-your-ror-project-with-docker-87b12d51b042?source=collection_archive---------13-----------------------#2022-04-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5fc68fe679dac64a8c04a5783e0879b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c7HHfC-jaVVpJS5I"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@joshuafuller?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·富勒</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="476d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为开发人员，我们一天中最重要的事情之一就是处理多个项目，当我们这样做的时候，尽可能地保持我们的环境真正有组织和分离。对于没有准备好以正确的方式进行分离的人来说，版本、包和所有这些依赖关系的问题可能会令人头疼。这就是为什么我决定写这篇文章，给你一个简单的技巧来组织你的 Docker 环境。当然，还有其他的方法，但是当我用 Docker 做这件事的时候，我爱上了它。</p><p id="e997" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您对 docker 一无所知，让我给你一个开端，让你了解我们将在本文中做什么。Docker 非常接近于虚拟机，但是比虚拟机更轻便、更具执行性、更可伸缩，因为它只加载容器工作所需的最小量。一个<em class="ky">映像</em>是你的<em class="ky">容器</em>用来创建的基础，而<em class="ky">容器</em>是那个<em class="ky">映像</em>的实例化。</p><p id="0e89" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了让你更好的理解，<em class="ky">映像</em>有时是基于基本<em class="ky">映像</em>之上的指令，所以，对于一个 Ruby 映像，也许你有一个基本 Debian <em class="ky">映像</em>，它带有一些指令来为你预先配置 Ruby 语言。</p><p id="9704" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，您使用一个<code class="fe kz la lb lc b">Dockerfile</code>来为项目创建<em class="ky">映像</em>，在我们的例子中，有一个<code class="fe kz la lb lc b">docker-compose.yml</code>来处理组织环境本身以及与您的容器一起工作的其他容器。但是让我们一步步来看这个。要知道，这不仅对组织您的项目有意义，我们还有更简单的 CI、更容易的部署、更好的性能管理和更容易的可伸缩性。</p><h1 id="bf1f" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">开始之前</h1><p id="5e68" class="pw-post-body-paragraph ka kb in kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">在我们深入了解配置和我想与您谈论的所有事情之前，请确保您的系统上安装了<strong class="kc io"> Docker </strong>和<strong class="kc io"> Docker Compose </strong>。在未来，这是你唯一需要安装的东西。不再有版本管理器、包、库或任何类似的东西。</p><p id="3318" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以使用这个链接安装<strong class="kc io"> Docker </strong>和<strong class="kc io"> Docker 使用这个链接编写</strong>和<a class="ae jz" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">，当然，在你运行任何东西之前，确保<strong class="kc io"> Docker </strong>正在你的系统上运行。</a></p><h1 id="e430" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">我们开始吧</h1><p id="f9e3" class="pw-post-body-paragraph ka kb in kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">首先，我们需要为 rails 项目本身定义容器。在根路径上创建一个名为<code class="fe kz la lb lc b">Dockerfile</code>的文件，并将以下内容放在其中:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="57ed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一行的注释是定义文件语法所必需的。我曾经试图告诉你为什么我的版本的<code class="fe kz la lb lc b">Dockerfile</code>是这样组织的。</p><p id="71ce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一件需要注意的事情是，我指定了 ruby 版本<code class="fe kz la lb lc b">3.1.1</code>，node js 版本<code class="fe kz la lb lc b">16</code>，以及最后一个稳定的 yarn 版本。我做这些选择是因为在本文中，我将配置最新的稳定的 Rails 版本。</p><p id="8f9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">之后，您将创建一个<code class="fe kz la lb lc b">Gemfile</code>来存储以下内容:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="7b65" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是不言自明的，我们只需要初始化一个 rails 配置来生成项目，然后脚本会用实际内容覆盖这个文件。在这个阶段，您也将创建一个空的<code class="fe kz la lb lc b">Gemfile.lock</code>文件。我们需要它来初始化 rails 项目。</p><p id="ec6b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记住，如果你正在处理一个已经存在的项目，你可以为<code class="fe kz la lb lc b">Gemfile</code>和<code class="fe kz la lb lc b">Gemfile.lock</code>维护你的版本。</p><p id="ba86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那么对于<code class="fe kz la lb lc b">entrypoint.sh</code>文件，我们可以做如下操作:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="1e11" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将保证我们的服务器运行良好。旧的运行可能会给你的项目增加一些<code class="fe kz la lb lc b">server.pid</code>，所以脚本会删除它。</p><p id="ffca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后是<code class="fe kz la lb lc b">docker-compose.yml</code>文件，这是真正神奇的地方。这个文件将定义服务器和数据库容器，使它们一起工作。请看下面:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="83c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还要注意的是，我为项目指定了一个 PostgreSQL 数据库，如果您在现有项目中使用不同的数据库，您可以在 web 上搜索特定数据库的服务示例。有很多例子，只要坚持这个想法去理解它是如何工作的，然后你就可以搜索它。</p><h1 id="c2c1" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">构建项目</h1><p id="5fc6" class="pw-post-body-paragraph ka kb in kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">如果您已经有了一个项目，并且刚刚迁移到 Docker，那么您可以跳过这一步，直接在您的项目上执行<code class="fe kz la lb lc b">docker-compose build</code>命令，以确保一切都被正确构建。</p><p id="996a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要生成 rails 项目，您将需要<code class="fe kz la lb lc b">web</code>容器，但是我们不需要依赖的<code class="fe kz la lb lc b">db</code>,并且我们在运行命令后也不需要维护这个容器。您可以访问<strong class="kc io"> Docker </strong>文档来理解这些如何映射到我在命令中传递的属性。最后，你会得到这样的东西:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="633f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建您的项目文件并用其实际内容更新<code class="fe kz la lb lc b">Gemfile</code>。之后，你就可以用<code class="fe kz la lb lc b">docker-compose build</code>构建项目了。</p><h1 id="3e04" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">配置您的数据库</h1><p id="b818" class="pw-post-body-paragraph ka kb in kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">为了以正确的方式初始化您的数据库，让我们确保数据库配置是正确的。你可以在下面看到我的<code class="fe kz la lb lc b">config/database.yml</code>文件的内容:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="da86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在我的例子中使用 PostgreSQL，但是这里重要的是记住使用<code class="fe kz la lb lc b">docker-compose.yml</code>上的服务名作为数据库主机。其他信息将取决于您如何配置 docker 服务。</p><p id="e308" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在开始工作之前，请确保也创建了数据库:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="b02f" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">最后</h1><p id="98e2" class="pw-post-body-paragraph ka kb in kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">现在，您可以用<code class="fe kz la lb lc b">docker-compose up</code>开始您的 rails 项目，并开始为它努力！</p><p id="bdcb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记得每次在项目中使用 gems 时运行<code class="fe kz la lb lc b">docker-compose build</code>。</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><p id="3ac8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">非常感谢你陪我看完了这篇文章。如果你有任何问题、意见或顾虑，请务必在下面的评论区与我分享。你的掌声和分享对我继续发帖非常重要。</p><p id="71ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还有什么可以发到我在 jpmsantana14@gmail.com 的邮箱里</p></div></div>    
</body>
</html>