<html>
<head>
<title>Security Automation for IaC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IaC 的安全自动化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/security-automation-for-iac-a3256be8cd32?source=collection_archive---------5-----------------------#2020-08-12">https://blog.devgenius.io/security-automation-for-iac-a3256be8cd32?source=collection_archive---------5-----------------------#2020-08-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c305" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随着 DevOps 的出现，<a class="ae ki" href="https://geekflare.com/infrastructure-as-code-intro/" rel="noopener ugc nofollow" target="_blank"> </a> <strong class="jm io"> <em class="kj"> IaC </em> </strong> ( <em class="kj">基础设施即代码</em>)策略的采用在 IT 领域迅速升温，以更快的速度、更低的成本和最少的人为错误开发和部署可扩展和可重复的云实施。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/fabcd0640d124a6ee96c575c32f7e336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSRbUajalblrfOJnSQocsA.png"/></div></div></figure><p id="ea44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">IT 基础设施的指数级增长以及持续集成和持续部署(CI/CD)管道的兴起推动了对一致且可扩展的自动化的需求。</p><h1 id="12c9" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">IaC 有哪些不同的类型？</h1><p id="b54b" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">IaC 工具可以分为两类。</p><p id="256f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="kj">编排工具</em> : </strong>有助于供应、组织和管理基础架构组件的工具(例如，CloudFormation、Terraform、ARM、Pulumi 等)。</p><p id="2c46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="kj">配置管理工具</em> : </strong>另一方面，这些工具用于安装、更新和管理基础设施组件中正在运行的软件(例如 Ansible、Chef、Puppet 和 SaltStack)。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/b214aaa59dfaa8f9f65430b1f6dee8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*kF__92T2iJWyKTBvZZcIqw.jpeg"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">IaC 工具的类型</figcaption></figure><h1 id="0c44" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">为什么<em class="me"> IaC </em>这么快被采用？</strong></h1><p id="3e1d" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated"><strong class="jm io"> <em class="kj"> IaC </em> </strong>帮助您以可重复、一致的方式自动化基础架构部署流程，这有很多好处。好处是如此强大，以至于我们开始看到公司在其 IT 环境中非常迅速地采用这种方法。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mf"><img src="../Images/7c3fae38524cbed4f25c20ca209328fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtQAnVhYrq9MUexa9k2MMg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">IaC 的一些好处</figcaption></figure><p id="fd78" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是采用 IaC 模型的一些好处。</p><ul class=""><li id="8f50" class="mg mh in jm b jn jo jr js jv mi jz mj kd mk kh ml mm mn mo bi translated"><strong class="jm io"/></li><li id="e9f2" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated"><strong class="jm io"> <em class="kj">速度</em></strong><em class="kj"/><strong class="jm io"><em class="kj">→</em></strong>IaC 的目标是通过消除人工流程，消除流程中的懈怠，让事情变得更快。基于代码的方法更容易做到事半功倍。</li><li id="5ac5" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated"><strong class="jm io"> <em class="kj">一致性→ </em> </strong> IaC 完全标准化了基础设施的设置，因此减少了任何错误或偏差的可能性。这将降低基础设施出现任何不兼容问题的可能性，并帮助您的应用程序更平稳地运行。</li><li id="d93c" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated"><strong class="jm io"> <em class="kj">可靠性→ </em> </strong> IaC 完全标准化了基础设施的设置，因此减少了任何错误或偏差的可能性。这将降低基础设施出现任何不兼容问题的可能性，并帮助您的应用程序更平稳地运行。</li><li id="0d8c" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated"><strong class="jm io"> <em class="kj">恢复→ </em> </strong>迁移或重建已经在代码中定义的基础设施很快就变成了一项琐碎的任务。系统的代码已经在那里了，你只需要重新部署它，然后一切又都在那里了。</li></ul><p id="1b2d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是，通过 IaC 保持与 CI/CD 实践的同步会带来一些挑战，并且会给我们带来管理安全风险的巨大责任。</p><blockquote class="mu mv mw"><p id="6727" class="jk jl kj jm b jn jo jp jq jr js jt ju mx jw jx jy my ka kb kc mz ke kf kg kh ig bi translated">这篇博客文章试图向您介绍静态分析工具，这些工具可以在您部署基础设施之前自动检测基础设施中的问题，包括安全漏洞，并利用 IaC 的内置优势将可伸缩性和可预测性的价值转移到基础设施安全中。</p></blockquote><h1 id="4610" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用开源工具实现 IaC 的安全自动化</h1><ol class=""><li id="1533" class="mg mh in jm b jn lu jr lv jv na jz nb kd nc kh nd mm mn mo bi translated"><strong class="jm io"> tfsec <br/> </strong> <em class="kj"> tfsec </em>使用对您的 terraform 模板的静态分析，在您投入生产之前发现潜在的安全问题和错误配置，并帮助您修复它们。</li></ol><p id="df8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安装:</strong></p><pre class="kl km kn ko gt ne nf ng nh aw ni bi"><span id="a717" class="nj kx in nf b gy nk nl l nm nn">Install with brew/linuxbrew:<br/>brew tap liamg/tfsec<br/>brew install liamg/tfsec/tfsec</span><span id="0432" class="nj kx in nf b gy no nl l nm nn">Install with Chocolatey:<br/>choco install tfsec</span><span id="c2aa" class="nj kx in nf b gy no nl l nm nn">Install with Go:<br/>go get -u github.com/liamg/tfsec/cmd/tfsec</span><span id="9069" class="nj kx in nf b gy no nl l nm nn">Use with Docker:<br/>docker run — rm -it -v “$(pwd):/src” liamg/tfsec /src</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi np"><img src="../Images/28cbe529236f9e041645fcc6c582eafa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZO0zDc2ySsA4Ulh7uibig.jpeg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">tfsec 的扫描输出</figcaption></figure><p id="bd6c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 2。Checkov<br/></strong><em class="kj">Checkov</em>是一个针对基础设施即代码的静态代码分析工具。</p><p id="282f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它扫描使用<a class="ae ki" href="https://terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>、<a class="ae ki" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> Cloudformation </a>、<a class="ae ki" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>、<a class="ae ki" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank"> Serverless </a>或<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview" rel="noopener ugc nofollow" target="_blank"> ARM 模板</a>配置的云基础架构，并检测安全性和合规性错误配置。</p><p id="31a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安装</strong>:</p><pre class="kl km kn ko gt ne nf ng nh aw ni bi"><span id="2832" class="nj kx in nf b gy nk nl l nm nn">Install with PIP<br/>pip install checkov</span><span id="7b40" class="nj kx in nf b gy no nl l nm nn">Install with homebrew<br/>brew tap bridgecrewio/checkov <a class="ae ki" href="https://github.com/bridgecrewio/checkov" rel="noopener ugc nofollow" target="_blank">https://github.com/bridgecrewio/checkov</a><br/>brew update<br/>brew install checkov</span><span id="25ac" class="nj kx in nf b gy no nl l nm nn">Use with Docker:<br/>docker run -t -v /user/tf:/tf bridgecrew/checkov -d /tf</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nq"><img src="../Images/d04c7fbc214c617e878dafe4ece517f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4xmjPMlbDqXhW3LaSTkyg.jpeg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">CheckOV 的扫描输出</figcaption></figure><p id="4354" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 3。terras can<br/></strong><em class="kj">terras can</em>将对您的 terraform 模板执行静态代码分析，以确保您的 IAC 遵循安全性和最佳实践。</p><p id="5f14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安装</strong>:</p><pre class="kl km kn ko gt ne nf ng nh aw ni bi"><span id="9f70" class="nj kx in nf b gy nk nl l nm nn">Install with PIP:<br/>pip install terrascan</span><span id="f271" class="nj kx in nf b gy no nl l nm nn">Use with Docker:<br/>docker run accurics/terrascan</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nr"><img src="../Images/6760b1c4749e797d6e2f01102fd834bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8--II2s7l232AE9Eclf5Q.jpeg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">Terrascan 的扫描输出</figcaption></figure><p id="1b99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.cfn-nag <br/> <em class="kj"> cfn-nag </em>解析一组云信息模板，并应用规则来发现<em class="kj">可能</em>导致不安全基础设施的代码模式。该工具的结果包括违反资源的逻辑资源标识符和违反了什么规则的解释。</p><p id="1a1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安装</strong>:</p><pre class="kl km kn ko gt ne nf ng nh aw ni bi"><span id="0d83" class="nj kx in nf b gy nk nl l nm nn">Install with gem:<br/>gem install cfn-nag</span><span id="7a4a" class="nj kx in nf b gy no nl l nm nn">Install with brew:<br/>brew install ruby brew-gem<br/>brew gem install cfn-nag</span><span id="4f7d" class="nj kx in nf b gy no nl l nm nn">Run with Docker:<br/>docker build -t stelligent/cfn_nag .</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ns"><img src="../Images/d141c49ea798ae7922b00bfe2651b965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VcBeFJ_pXYlYDp5o8shutw.jpeg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">使用 cfn-nag cli 扫描输出</figcaption></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nt"><img src="../Images/9a1e3a2085a9e4eb4b3afef5fddc7a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfs_MezFVoW8Z9olAZO7_g.jpeg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">使用 cfn_nag docker 图像扫描输出</figcaption></figure><p id="d932" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您想尝试这些开源工具，可以使用这个易受攻击的代码片段进行测试。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="a12c" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论:</h1><p id="0b15" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">如果处理得当，基础设施即代码安全性既可以解决开发过程中配置错误的 IaC 文件，又可以将运行时安全性问题转化为构建时治理。但是，要使基础设施即代码安全有价值并取得成功，它必须</p><p id="c43e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">1)自动化，2)按代码交付，3)连续工作流程的一部分。</p><h1 id="a295" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">参考文献:</strong></h1><p id="f7e5" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">【https://github.com/liamg/tfsec<br/><a class="ae ki" href="https://github.com/bridgecrewio/checkov" rel="noopener ugc nofollow" target="_blank">https://github.com/bridgecrewio/checkov<br/></a><a class="ae ki" href="https://github.com/accurics/terrascan" rel="noopener ugc nofollow" target="_blank">https://github.com/accurics/terrascan<br/></a>https://github.com/stelligent/cfn_nag</p></div></div>    
</body>
</html>