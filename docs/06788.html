<html>
<head>
<title>Swift advanced charts from scratch — Pt 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift 从头开始提供高级图表— Pt 2</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/swift-advanced-charts-from-scratch-pt-2-193c38c23a21?source=collection_archive---------8-----------------------#2022-02-03">https://blog.devgenius.io/swift-advanced-charts-from-scratch-pt-2-193c38c23a21?source=collection_archive---------8-----------------------#2022-02-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/960ccc8ccad042d55245c373a12042d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4auMSIUGnnuUM6bnFseyA.jpeg"/></div></div></figure><div class=""/><figure class="gl gn jw jx jy ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi jv"><img src="../Images/29cbfcd0008bf856c6a6cba4346d0fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*70QBRSmXVNvQNuUzkvV_xg.gif"/></div></div></figure><p id="6dcf" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">亲爱的读者，你好！这是我关于如何从头开始创建 swift 图表的文章的第二部分。<strong class="kb iz">如果你还没有查第一个——这里有一个链接</strong><a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/swift-advanced-charts-from-scratch-c784971eacb8">。</a></p><p id="d619" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个图表比我们上次做的要简单得多，但是它可以用于许多场景。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="d682" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">插曲</h1><p id="c409" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">我会尽量不重复上一篇文章中的内容，但对于没有读过第一部分的人，我要回答一个问题:</p><p id="88f8" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">“如果我可以使用一些第三方库，为什么要从头开始构建图表？”—答案很简单。如果您只需要一个图表，那么为此导入所有库将是非常浪费的。此外，由于团队/公司/任何事物中的规则，您可能会处于无法使用 UI 库的情况(像我一样)。</p><p id="1bfa" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们开始编码吧！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="87cd" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">步伐</h1><p id="2448" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">这张图表会比我们上次做的简单得多。所以我们只需要两步。</p><ol class=""><li id="5bac" class="mi mj iy kb b kc kd kg kh kk mk ko ml ks mm kw mn mo mp mq bi translated">创建带有多个值的圆形图表。</li><li id="0c68" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">添加动画，这样看起来很棒:)</li></ol><p id="58b6" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb iz">另外，我必须说，今天我们将使用我们为前面的图表创建的一些样板和扩展。</strong>所以，如果您看到一些我没有完全解释的自定义函数，不要感到惊讶。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="992f" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">第 1 步-圆形图表</h1><p id="d418" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">让我们开始吧！</p><p id="d01f" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">首先，我们要像上次一样创建一个图表视图。外部图表将是<strong class="kb iz"> UIView 的一个子类。</strong>姑且称之为<strong class="kb iz">圆图。</strong></p><p id="d400" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">由内而外的循环我们只需要一个函数:</p><ol class=""><li id="39e1" class="mi mj iy kb b kc kd kg kh kk mk ko ml ks mm kw mn mo mp mq bi translated"><strong class="kb iz">设置</strong>——它将创建并绘制我们的图表。</li><li id="1c59" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated"><strong class="kb iz">清除</strong> —这将移除图层，所以我们可以重新绘制图表。</li></ol><p id="6154" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们还需要一个全局变量来存储<strong class="kb iz">图表层。</strong>它将是所有动画的父层。当我们需要的时候，我们可以用一个命令将它从最高层移除。</p><h2 id="94e7" class="mw lg iy bd lh mx my dn ll mz na dp lp kk nb nc lt ko nd ne lx ks nf ng mb nh bi translated">设置</h2><figure class="ni nj nk nl gt ip"><div class="bz fp l di"><div class="nm nn l"/></div></figure><ol class=""><li id="d7a0" class="mi mj iy kb b kc kd kg kh kk mk ko ml ks mm kw mn mo mp mq bi translated">我们的函数将接收元组数组:<strong class="kb iz"> [(CGFloat，UIColor)] </strong>。当然，我们可以为此创建一个特殊的模型，但是为了使它现在变得简单，就让它这样吧。</li><li id="2c0b" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">清除功能——每次绘制图表时，我们都必须移除清除层。</li><li id="6567" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">在循环中，我们计算图表中特定部分的百分比。根据百分比，线的长度将会不同。</li><li id="c215" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">使用我们的百分比和“全部空间”(图表各部分之间的组合空间)得到直线的角度。</li><li id="0995" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">使用当前和以前的角度获得精加工角度。</li><li id="4d07" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">为我们的道路创造第一条弧线。</li><li id="da3c" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">创建第二个弧。<code class="fe no np nq nr b">radius — 15</code>-这是我们得到的线的宽度。</li></ol><p id="8e37" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">休息很简单。创建形状层，添加路径和颜色。最后添加<strong class="kb iz">图层</strong>查看图层。</p><h2 id="7780" class="mw lg iy bd lh mx my dn ll mz na dp lp kk nb nc lt ko nd ne lx ks nf ng mb nh bi translated">清楚的</h2><figure class="ni nj nk nl gt ip"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8cb8" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我想我不需要解释这些了:)</p><h2 id="010c" class="mw lg iy bd lh mx my dn ll mz na dp lp kk nb nc lt ko nd ne lx ks nf ng mb nh bi translated">我们得到了什么？</h2><figure class="ni nj nk nl gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/5b95d33f8ec188cb0c0abaf43be28508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MuDJJi7dlLB4l5VgyJZ4GQ.gif"/></div></div></figure><p id="8779" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">嗯，还不错。我们甚至默认得到某种动画。但这不是我们想要的动画。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="9481" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">步骤 2 —动画</h1><p id="7796" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">为了创建“时钟”动画，我们需要</p><ol class=""><li id="7437" class="mi mj iy kb b kc kd kg kh kk mk ko ml ks mm kw mn mo mp mq bi translated">创建动画本身，并将其应用到层。</li><li id="b5ca" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">正如您在代码中看到的，图表的第一行是在零弧度处绘制的——在 3 点钟位置。我们希望我们的动画从π/2(12 点)开始。为此，<strong class="kb iz">我们将需要旋转整个层。</strong></li></ol><h2 id="da84" class="mw lg iy bd lh mx my dn ll mz na dp lp kk nb nc lt ko nd ne lx ks nf ng mb nh bi translated"><strong class="ak">动画</strong></h2><p id="a6e3" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">在<strong class="kb iz"> CALayer 扩展</strong>中创建以下功能</p><figure class="ni nj nk nl gt ip"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5105" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个动画的所有想法是，我们创建一个形状并把它作为蒙版添加到我们的图表层，之后我们制作蒙版动画。</p><ol class=""><li id="ff02" class="mi mj iy kb b kc kd kg kh kk mk ko ml ks mm kw mn mo mp mq bi translated">将形状层中心设置为与父层中心相同。</li><li id="9ace" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">计算半径。我们创造了巨大的半径，在下一步你会看到为什么。</li><li id="7f62" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">我们让线宽等于我们刚刚计算的半径。想法是创建一个巨大的边界和动画这个边界圆。</li><li id="d872" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">创造圆本身。</li><li id="2874" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated"><strong class="kb iz">添加我们新创建的图层到图表图层作为蒙版。</strong></li><li id="f704" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated">不要忘记设置这个变量，否则当动画完成时，它会自动移除，遮罩会覆盖我们的图表。</li><li id="a49f" class="mi mj iy kb b kc mr kg ms kk mt ko mu ks mv kw mn mo mp mq bi translated"><strong class="kb iz">给遮罩层添加动画。</strong></li></ol></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="00da" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb iz">旋转图层</strong></p><figure class="ni nj nk nl gt ip"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="3e18" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是用 3 行代码完成的。将它们插入到我们的<code class="fe no np nq nr b">setup</code>函数中的<code class="fe no np nq nr b">layer.addSublayer(chartLayer)</code>之前。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="6e8d" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb iz">最后一步</strong></p><p id="a1fc" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我们需要添加一行代码来使它工作。</p><p id="ccc7" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe no np nq nr b">chartLayer.applyClockWipeMaskAnimation(duration: 1.5)</code></p><p id="98df" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在<code class="fe no np nq nr b">setup</code>功能的末尾添加这一行。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="ad0c" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">享受</h1><figure class="ni nj nk nl gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi jv"><img src="../Images/29cbfcd0008bf856c6a6cba4346d0fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*70QBRSmXVNvQNuUzkvV_xg.gif"/></div></div></figure><p id="f3f9" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我们可以享受平滑和漂亮的图表动画！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="06ad" class="lf lg iy bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">临终遗言</h1><p id="0efb" class="pw-post-body-paragraph jz ka iy kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">你能在这里找到的所有源代码:<a class="ae kx" href="https://github.com/Kolch/Charts" rel="noopener ugc nofollow" target="_blank">https://github.com/Kolch/Charts</a></p><p id="6d65" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你可能也会喜欢我这里的另一个图表:<a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/swift-advanced-charts-from-scratch-c784971eacb8">https://blog . dev genius . io/swift-advanced-charts-from-scratch-c 784971 eacb 8</a></p><p id="a852" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">希望你觉得有用！</p><p id="7e5b" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你喜欢这篇文章，请在评论中告诉我。此外，我真的很感谢你会下降喜欢我的 github 回购！</p><p id="9de2" class="pw-post-body-paragraph jz ka iy kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb iz">订阅不要错过关于图表和 swift 的新文章。</strong></p></div></div>    
</body>
</html>