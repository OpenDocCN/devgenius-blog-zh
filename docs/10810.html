<html>
<head>
<title>Docker Security: Container Security Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头安全:集装箱安全最佳实践</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/docker-security-container-security-best-practices-aa070ba2b8e1?source=collection_archive---------8-----------------------#2022-12-01">https://blog.devgenius.io/docker-security-container-security-best-practices-aa070ba2b8e1?source=collection_archive---------8-----------------------#2022-12-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/0304efadf5669ad3f70e0960d6898fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*q8QUe7bbRUBH0fCdk3OEEw.png"/></div></figure><p id="a71f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">容器化环境比 Windows、Linux 或云的传统工作环境复杂得多。通常，生产环境有大量的工作负载、多个流程、分支和节点，使得保护每个组件更加困难。安全团队需要实施某些最佳实践来保护我们的容器环境。</p><p id="11b8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安全专家需要实现安全策略并维护安全策略，以保护容器环境的底层基础设施。将这些最佳实践集成到开发管道中，可以确保所有涉及的组件都受到保护，直到开发生命周期结束。</p><p id="8421" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">集装箱环境面临的挑战</strong></p><p id="57d7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">尽管与通常的生产环境相比，容器提供了许多优势，但是它们也存在难以克服的安全问题。基于许多底层映像的容器的巨大工作负载使它们暴露于许多漏洞。我们面临的另一个问题是底层的内核架构，我们需要确保容器配置的安全，以及允许用户有多少访问和权限。我们需要在某些容器工作负载之间保持隔离，以避免重叠和覆盖问题，并对用户施加限制。由于容器是高度动态的，我们也面临着监控和可见性的挑战。我们需要尽快识别威胁和漏洞，以便能够快速修复。因此，让我们来看看一些可以帮助我们克服这些挑战并使我们的容器环境安全的最佳实践。</p><ol class=""><li id="8712" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">使用非特权用户</li></ol><p id="88c9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">威胁:</p><p id="23ee" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">特权用户可以授予自己对容器的更多控制权，从而获得对容器资源的控制，或者故意或无意损坏容器。</p><p id="5c9f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安全措施:</p><p id="093e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了降低特权提升攻击的风险，我们可以使用非特权用户运行容器。要这样做，而不是使用预先建立的图像总是重新配置和建立自己的 Docker 图像。这样做将允许您根据自己的规范更改和定制各种安全参数。</p><p id="dfd5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了以非特权用户的身份运行 docker，用户需要在构建映像之前向 Dockerfile 添加特定的命令。只需添加以下命令:</p><p id="24c8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe ky kz la lb b">RUN groupadd -r &lt;username&gt; &amp;&amp; useradd -r -g &lt;group&gt; &lt;username&gt;</code></p><p id="1146" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这将把用户添加到 Docker 图像中。现在，您可以使用非特权用户运行容器。现在，在运行容器时，使用以下命令以特定用户运行</p><p id="6d8d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe ky kz la lb b">docker run -u &lt;username&gt; &lt;Image&gt;</code></p><p id="d939" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">2.禁用根用户</p><p id="8ce9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">威胁:</p><p id="2d33" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">从根帐户可以做任何事情，如果一些恶意方得到根帐户，他们可以对容器造成损害。</p><p id="ddfa" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安全措施:</p><p id="6f4d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">可以在 docker 文件中禁用 Root 用户。这将禁止容器上的用户访问 root 帐户，不管他们是否有 root 密码。我们可以将默认 shell 从/bin/bash 更改为/usr/sbin/nologin。为此，我们需要将以下命令添加到 docker 文件中:</p><p id="63f8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe ky kz la lb b">RUN chsh -s /usr/sbin/nologin root</code></p><p id="cadc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请记住，这将完全禁用根用户帐户。</p><p id="138b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">3.防止特权提升攻击</p><p id="bb16" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">威胁:</p><p id="4072" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果用户可以添加更多的权限给自己，从而可以破坏容器。</p><p id="fb2a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安全措施:</p><p id="0317" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了防止用户为自己添加更多权限，我们将禁用添加更多权限的选项。要在运行容器时执行此操作，请在运行命令中添加以下内容:</p><p id="bac2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe ky kz la lb b">docker run — security-opt=no-new-privileges &lt;Image&gt;</code></p><p id="875c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">5.文件系统权限和访问</p><p id="ff48" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">威胁:</p><p id="9df4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">有些文件是不需要的，或者只是临时需要的，但是一直放在容器中，占用了存储空间。有时，用户会有意或无意地更改重要文件，这可能会在以后造成损害。</p><p id="fab5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您还能够指定文件系统权限和访问，允许您使用只读文件系统或临时文件系统来设置容器。如果您想控制容器是否可以存储数据或对文件系统进行更改，那么这个选项非常有用。</p><p id="a4cf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安全措施:</p><p id="aa5a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了防止这种威胁，我们可以建立临时文件系统，并使文件系统只读。这样，临时文件在达到目的后会被自动删除，没有人可以更改重要的系统文件。</p><p id="da33" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe ky kz la lb b">docker run --read-only --tmpfs /tmp &lt;Image&gt;</code></p><p id="2529" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可以分别运行<code class="fe ky kz la lb b">--read-only</code>和<code class="fe ky kz la lb b">--tmpfs /tmp</code>命令。</p><p id="b9ac" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这里有一些快速提示，以保持您的图像安全</p><ol class=""><li id="cf54" class="kp kq in jt b ju jv jy jz kc kr kg ks kk kt ko ku kv kw kx bi translated">保持你的图片小。大图像具有大的攻击面，使码头工人处于危险之中。</li><li id="6013" class="kp kq in jt b ju lc jy ld kc le kg lf kk lg ko ku kv kw kx bi translated">不要选择最新的镜像，而是获取最小的镜像，安装自己的最小软件包和依赖项。</li><li id="4170" class="kp kq in jt b ju lc jy ld kc le kg lf kk lg ko ku kv kw kx bi translated">使用多阶段图像来缩小图像大小。</li></ol><p id="0d53" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这些都是一些非常需要的基本安全措施，以保持您的集装箱安全。这是所有的乡亲。愿原力与你同在。</p></div></div>    
</body>
</html>