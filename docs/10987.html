<html>
<head>
<title>Start using Strict typing in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始在 PHP 中使用严格类型</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/start-using-strict-typing-in-php-897301e54e3d?source=collection_archive---------5-----------------------#2022-12-12">https://blog.devgenius.io/start-using-strict-typing-in-php-897301e54e3d?source=collection_archive---------5-----------------------#2022-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4e1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">PHP 中什么是严格类型化？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f39161796e636c30fe9fff49835fee60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z-Ph5C8aXIuPc_QT"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a5b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在解释 PHP 中的严格类型之前，我们要执行下面的程序。</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="e886" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/><br/>function sum($a, $b)<br/>{<br/>  return $a + $b;<br/>}<br/><br/>echo sum(1, 2.5); // output 3.5<br/><br/>?&gt;</span></pre><p id="94fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的程序是用来求两个给定数字之和的。所以输出是 3.5</p><h2 id="a73e" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">标量类型声明</h2><p id="aec3" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">在 PHP 7.0 中引入了<a class="ae kv" href="https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.scalar-type-declarations" rel="noopener ugc nofollow" target="_blank">标量类型声明</a>。标量<a class="ae kv" href="https://www.php.net/manual/en/language.types.declarations.php" rel="noopener ugc nofollow" target="_blank">类型声明</a>有强制(默认)和严格两种模式。</p><p id="b7e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们要给函数参数添加类型声明。</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="5e66" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/><br/>function sum(int $a, int $b)<br/>{<br/>  return $a + $b;<br/>}<br/><br/>echo sum(1, 2.5); // output 3<br/><br/>?&gt;</span></pre><p id="cdf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您将得到输出 3。为什么？PHP 自动将输入参数的类型改为 int(第二个参数 2.5 浮动为 int)。这被称为强制模式。</p><h2 id="99ee" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">PHP 中什么是严格类型化？</h2><p id="ed05" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">所以根据我们的函数参数类型声明，函数应该接受一个整数值。如果传递非整数值，程序将抛出一个错误，这可以通过使类型声明严格来实现。</p><h2 id="4e20" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">如何启用严格类型？</h2><p id="eb2d" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我们可以在每个文件的基础上启用严格模式。为了实现严格的类型化，<a class="ae kv" href="https://www.php.net/manual/en/control-structures.declare.php" rel="noopener ugc nofollow" target="_blank">声明</a>语句与<code class="fe na nb nc lt b">strict_types</code>声明一起使用。</p><p id="7514" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">严格类型声明只对声明的文件有效。目前没有全局应用严格类型的选项。</p><blockquote class="nd ne nf"><p id="2553" class="kw kx ng ky b kz la jr lb lc ld ju le nh lg lh li ni lk ll lm nj lo lp lq lr ij bi translated">在严格模式下，只接受与类型声明完全对应的值，否则将抛出<a class="ae kv" href="https://www.php.net/manual/en/class.typeerror.php" rel="noopener ugc nofollow" target="_blank"> TypeError </a>。</p></blockquote><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="eedf" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/>  declare(strict_types=1);<br/>?&gt;</span></pre><p id="1aac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向 sum 函数声明严格类型</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="adf4" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/>declare(strict_types=1);<br/><br/>function sum(int $a, int $b)<br/>{<br/>  return $a + $b;<br/>}<br/><br/>echo sum(1, 2.5);<br/><br/>?&gt;</span></pre><p id="9534" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在声明严格类型后，您将得到下面的致命错误。</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="ab6c" class="lx ly iq lt b be lz ma l mb mc">Fatal error: Uncaught TypeError: sum(): Argument #2 ($b) must be of type int, float given, called in C:\xampp\htdocs\test.php on line 8 and defined in C:\xampp\htdocs\test.php:4 Stack trace: #0 C:\xampp\htdocs\test.php(8): sum(1, 2.5) #1 {main} thrown in C:\xampp\htdocs\test.php on line 4</span></pre><p id="5e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们了解了强制模式和严格模式下类型声明的基础。</p><h2 id="98fb" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">返回类型声明</h2><p id="efac" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我们也可以声明函数返回值的类型。</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="c01e" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/>// Coercive mode<br/>function sum(int $a, int $b): int<br/>{<br/>  $c = 0.5;<br/>  return $a + $b + $c;<br/>}<br/><br/>echo sum(1, 2); // Output 3<br/><br/>?&gt;</span></pre><p id="fbf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述程序的输出在加上$c = 0.5 后是 3。因为我们将返回类型声明为 integer。如果声明的返回类型是<code class="fe na nb nc lt b">float</code>，你将得到一个 3.5 的输出。</p><h2 id="c942" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">具有返回类型的严格类型化</h2><p id="9fc9" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">添加严格类型后，您会得到致命错误，因为返回值不是整数。</p><pre class="kg kh ki kj gt ls lt lu bn lv lw bi"><span id="775b" class="lx ly iq lt b be lz ma l mb mc">&lt;?php<br/>declare(strict_types=1);<br/><br/>function sum(int $a, int $b): int<br/>{<br/>  $c = 0.5;<br/>  return $a + $b + $c;<br/>}<br/><br/>echo sum(1, 2); <br/><br/>?&gt;</span></pre><pre class="nk ls lt lu bn lv lw bi"><span id="7619" class="lx ly iq lt b be lz ma l mb mc">Fatal error: Uncaught TypeError: sum(): Return value must be of type int, float returned in C:\xampp\htdocs\test.php:7 Stack trace: #0 C:\xampp\htdocs\test.php(10): sum(1, 2) #1 {main} thrown in C:\xampp\htdocs\test.php on line 7</span></pre><h2 id="a184" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">为什么使用严格的类型？</h2><p id="0481" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">如果在代码中使用标量类型声明，严格类型是最好的。因为有助于防止 bug。否则，不需要严格的类型声明。</p><h2 id="3959" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">结论</h2><p id="1263" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我看到很多 PHP 包开始使用严格类型。如前所述，在使用类型声明时，严格类型是避免错误的最佳方法。那么你为什么还在等待<strong class="ky ir">开始使用严格类型</strong>！</p><p id="8c5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分享你对在 PHP 中使用严格类型的评论。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h2 id="11ca" class="md ly iq bd me mf mg dn mh mi mj dp mk lf ml mm mn lj mo mp mq ln mr ms mt mu bi translated">参考</h2><ul class=""><li id="cf43" class="ns nt iq ky b kz mv lc mw lf nu lj nv ln nw lr nx ny nz oa bi translated"><a class="ae kv" href="https://www.php.net/manual/en/language.types.declarations.php#language.types.declarations.strict" rel="noopener ugc nofollow" target="_blank">类型声明</a></li><li id="6e52" class="ns nt iq ky b kz ob lc oc lf od lj oe ln of lr nx ny nz oa bi translated"><a class="ae kv" href="https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.scalar-type-declarations" rel="noopener ugc nofollow" target="_blank">标量类型声明</a></li></ul></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="a5ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p><p id="3279" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">敬请关注更多内容！</p><p id="1780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ng">跟我来</em><a class="ae kv" href="https://balajidharma.medium.com/" rel="noopener"><strong class="ky ir"><em class="ng">balajidharma.medium.com</em></strong></a>。</p></div></div>    
</body>
</html>