<html>
<head>
<title>Deploying an Nginx Static Website through AWS S3 utilizing Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Docker通过AWS S3部署Nginx静态网站</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploying-a-nginx-static-website-through-aws-s3-utilizing-docker-8b1d09df6df6?source=collection_archive---------2-----------------------#2021-05-11">https://blog.devgenius.io/deploying-a-nginx-static-website-through-aws-s3-utilizing-docker-8b1d09df6df6?source=collection_archive---------2-----------------------#2021-05-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f188f0dd7fd4faf30453984782579dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUOK3spC2HuIHjyUvhRzEw.png"/></div></div></figure><p id="1ab0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">欢迎回到我的博客！在这个项目中，我们将深入探讨Docker，以及它如何让云工程师的工作变得更加轻松。我们将介绍为什么它是一项非常重要的技能，以及它如何无缝集成到AWS资源中。</p><p id="b9dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">我们将在本实验中完成的任务:</strong>您的团队需要您快速部署自定义映像，并在文件中编写快速脚本来完成任务。</p><p id="b623" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">开始之前我们需要知道的事情:</strong></p><ul class=""><li id="bc86" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated"><strong class="jx io">什么是Docker？</strong> Docker是一个开源工具，旨在通过使用容器来简化应用程序的创建、部署和运行。容器允许开发人员将应用程序与它需要的所有部分打包在一起，比如库和其他依赖项，然后作为一个包发送出去。通过这样做，由于有了容器，开发人员可以放心，应用程序将在任何其他Linux机器上运行，而不管该机器的任何定制设置可能与用于编写和测试代码的机器不同。</li><li id="77be" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><strong class="jx io">什么是AWS S3？</strong>亚马逊S3或亚马逊简单存储服务(Amazon Simple Storage Service)是亚马逊网络服务(Amazon Web Services)提供的一项服务，通过网络服务接口提供对象存储。亚马逊S3使用与Amazon.com相同的可扩展存储基础设施来运行其全球电子商务网络。</li><li id="0a85" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><strong class="jx io">Nginx是什么？Nginx <strong class="jx io"> </strong>是一个流行的轻量级web应用程序，用于开发服务器端应用程序。它是一个开放源代码的web服务器，可以在多种操作系统上运行。</strong></li></ul><p id="6a14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">开始之前我们需要做的事情:</strong></p><ul class=""><li id="5cd7" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">将AWS CLI下载到您的本地计算机上。如果您查看了我的实验“从CLI创建自动缩放组”，我将介绍如何下载AWS CLI以及CLI相对于使用AWS控制台GUI的优势。</li><li id="6ac0" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">通过Docker桌面和CLI访问设置Docker帐户。将它下载到您的本地机器上</li><li id="2e04" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">您选择的文本编辑器已经下载并准备好了。我选择使用微软VS代码</li></ul><p id="f816" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">现在我们已经解决了这个问题，下面是我们将在本实验中完成的4项任务:</strong></p><ul class=""><li id="64ce" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">我们将使用Nginx创建一个定制的Docker图像</li><li id="98c0" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">我们将在文件中添加一些日期/时间文本，这样它就不会显示默认页面</li><li id="3371" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">我们将部署端口8080打开的容器</li><li id="b0b5" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">然后，我们将数据存储在AWS S3存储桶中</li></ul><p id="58fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有几个网站，你应该在一个单独的选项卡中打开，这将有助于你理解命令和每个字母代表什么，特别是如果你想定制你的命令。我将尽我所能解释它们，但是对于教科书上的解释，请参考实际的文档:</p><ul class=""><li id="0eec" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated"><a class="ae lh" href="https://docs.docker.com/engine/reference/commandline/build/" rel="noopener ugc nofollow" target="_blank"> Docker的</a>文档解释了如何<strong class="jx io">运行</strong>你的镜像</li><li id="0c80" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><a class="ae lh" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>说明如何从CLI向S3上传文件的文档</li><li id="977f" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><a class="ae lh" href="https://docs.docker.com/engine/reference/commandline/run/" rel="noopener ugc nofollow" target="_blank"> Docker的</a>文档，解释了<strong class="jx io">构建</strong>容器的变量</li></ul><p id="9c8e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好吧，希望你还在。我们开始吧，让派对开始吧！</p><p id="7569" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">第一步</strong> -建立你的形象</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/c6147d20817a31ff3531c80e2bae56da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFSv7aKuyQfJaYKY3xIvaQ.png"/></div></div></figure><p id="547b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们必须首先将ginx图像拖到我们的终端，这样我们就可以从它构建自定义图像。为此，先去<a class="ae lh" href="https://hub.docker.com/_/nginx" rel="noopener ugc nofollow" target="_blank"> Nginx的网站</a>获取pull命令。当您想要构建Docker映像时，无论是自定义映像还是标准映像，您都需要访问<a class="ae lh" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker hub </a>网页来查找您想要构建的映像，然后找到要使用的命令。对于Nginx，我们使用以下命令:</p><p id="e8f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">$ docker pull nginx</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ln"><img src="../Images/69ce320595d1ff811586c6b52bd84ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Mu31lNqq0Z3eO_PT5ms4w.png"/></div></div></figure><p id="569d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来我们要做的是创建一个目录，并在该目录中放入cd，以保存我们的Dockerfile和index.html文件(我们将在后面详细介绍)。进入目录后，创建一个名为Dockerfile和index.html文件的文件。在构建您的映像之前建立一个Docker文件是很重要的，因为当您进入下一步时，您的Docker构建命令会将您的Docker文件作为如何构建您的映像的说明。让我解释一下我的Dockerfile文件的每个部分是什么:</p><p id="6363" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lo lp lq lr b">FROM</code>创建一个层</p><p id="c32f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lo lp lq lr b">COPY</code>添加Docker客户端当前目录中的文件。</p><p id="566d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lo lp lq lr b">CMD</code>指定在容器中运行什么命令。</p><p id="339d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lo lp lq lr b">EXPOSE</code>该指令指示容器监听连接的端口。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ls"><img src="../Images/635d00cb24fabe6a4fa7d58af7f2c22a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07aRN-2J4iQ5jIUWzb4qlQ.png"/></div></div></figure><p id="22ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将使用文本编辑器向刚刚创建的index.html文件添加一些代码。这一步也非常重要，因为它为Nginx提供了一个显示网页时需要遵循的脚本。我将使用的脚本是在我们的静态Nginx网页上显示日期和时间，而不是默认的“欢迎使用Nginx”页面。*更改这个默认页面比我最初想象的要困难得多，但我们稍后会解决这个问题。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/0032d478f8e142fbcbada9573d9a2414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LE7bdzhzlyElnV7Dzkdvhw.png"/></div></div></figure><p id="e05a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦到了这一步，下一个命令将按照docker文件中的说明构建您的映像。但是在我们构建这个映像之前，让我们回顾一下命令的组成部分。“-t”是“tag”的缩写，它实际上是你正在构建的图像的名称。请不要忘记结尾的“.”在命令中。这个“.”指定路径在本地目录中。现在我们已经解决了这个问题，您将使用的命令是:</p><p id="62e9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">$ docker build -t <name>。</name></p><p id="8877" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">第二步</strong> -码头运行</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/e6c139a1ea5a9f62c44f9471742691fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wPv7lO2rCpjBUQajqfGFA.png"/></div></div></figure><p id="6d7a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦我们构建了自定义映像，我们现在就可以构建容器了。构建容器的命令总是以“docker run”开始，然后你可以参考我在上面发布的网页来选择你想要在命令中使用的变量。“-it”是保持STDIN打开，即使没有连接，并分配一个伪TTY。"-rm "会在容器退出时自动删除它。"-d "在后台运行容器并打印容器ID。"-p "向主机发布容器的端口。我选择8080:80作为我想要打开的端口，但是这实际上并不需要，因为我选择在docker文件中公开它。我只是忘记了我是在打这个命令的时候做的，lol。下面是以下命令:</p><p id="926d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">$ docker run-it-RM-d-p 8080:80-name Marshall container nginx</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/19903e65dec86d3d905ba775f618c302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kdwCJWXDGKtQp72wtBicxA.png"/></div></div></figure><p id="9cc2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦这样做了，不幸的是你仍然会看到默认的Nginx网页，lol。但是不用担心，我们将在下一步处理这个问题。只需庆幸容器已经启动并运行。我们总是可以改变网页本身。仅供参考，要访问此页面，请在您的web浏览器的搜索栏中键入localhost:8080。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/6a5facbd4527b477e893377b3eec8111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-e91LuntrCCg1X5phxEdg.png"/></div></div></figure><p id="0e6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们将更改默认页面。这个命令将允许您进入容器本身并在其中执行命令。我们将首先使用“cat index.html”显示默认的index.html文件，它将显示我在上面直接发布的内容。这是默认的Nginx页面，我们不希望这个项目。然后，我创建了一个新目录，并切换到该目录。然后，我们将创建另一个index.html文件，并再次使用VS代码将我们的时间/日期脚本复制并粘贴到该文件中。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/95525dfed1677fa6c69f77a8678d1748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FvyGMl0q6VB3wszq7PBYtQ.png"/></div></div></figure><p id="9505" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦完成，我们应该能够看到我们构建的自定义映像。现在我们必须把这个文件上传到S3 AWS。</p><p id="c852" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">步骤3- </strong>将我们的容器上传到S3</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/7a2007c207ec560acec9feee5c1c77ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wohQ_v11WzTihIJwA-kyTQ.png"/></div></div></figure><p id="a03c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在困难的部分已经解决了，我们现在要做的就是使用下面的命令创建我们的bucket，然后将文件上传到其中。请记住，S3是一个<strong class="jx io">全局</strong>名称空间，因此要确保这是一个唯一的名称，因为没有两个存储桶可以共享同一个名称。</p><p id="cb65" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">$ aws s3 mb s3:// <em class="ly">名称</em></p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/8c6b6d6b30376c332a1e1a3159032d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1iEGyTJRTIwkHacd--JlQ.png"/></div></div></figure><p id="3224" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以随时去控制台仔细检查我们的工作。一旦您看到您的存储桶显示出来，您就可以继续了。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/f265e20546fe095d60c21490b594925b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zT6qZv2t941XJqM3lmHIRg.png"/></div></div></figure><p id="f77b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们将压缩包含docker文件和index.html文件的docker-demo目录，这样我们就可以准备好上传到AWS S3。使用下面的命令:</p><p id="3fcd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">zip-r<em class="ly">whateveryouwanttonamithiszipfile</em><em class="ly">文件夹名称</em></p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/6bf5aac14a628934137b6fe4b95e65fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aa0eQjuomj3UGFfhqgNavw.png"/></div></div></figure><p id="27c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们将把我们的zip文件上传到aws s3。使用下面的命令来上传它。如果成功，您应该会从aws cli获得一个上传返回。</p><p id="a1c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">aws s3 cp <em class="ly">您的zipfile名称</em> e s3:// <em class="ly">您的bucketname </em> / <em class="ly">您的zip file名称</em></p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/36581ee74782700d699319305eabbed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahH5WkD8QNU1mcXUocejtw.png"/></div></div></figure><p id="f4a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将再次检查我们的工作，以确保我们成功了。如果您的zip文件出现在您的存储桶下面，<strong class="jx io">祝贺您</strong>。您现在已经完成了本实验。</p><p id="8941" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您加入我的实验，希望您过得愉快！</p></div></div>    
</body>
</html>