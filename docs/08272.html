<html>
<head>
<title>Basic knowledge about Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于 Redis 的基本知识</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/basic-knowledge-about-redis-26d002a7ee4a?source=collection_archive---------5-----------------------#2022-06-01">https://blog.devgenius.io/basic-knowledge-about-redis-26d002a7ee4a?source=collection_archive---------5-----------------------#2022-06-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/dabe73820772894a50439cfa81d4ed8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcDQVAR-z3caEs00fpUehg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">雷迪斯</figcaption></figure><h1 id="cc21" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">简介&amp;什么是 Redis？</h1><p id="e89d" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="kz io">一个由键值存储的内存数据库</strong>，通常作为一个数据库来缓存，访问速度非常快。</p><p id="1967" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">对视频的评论:</p><blockquote class="ma mb mc"><p id="190e" class="kx ky md kz b la lv lc ld le lw lg lh me lx lk ll mf ly lo lp mg lz ls lt lu ig bi translated"><strong class="kz io"> <em class="in"> Redis 是一个内存中但持久存在于磁盘上的数据库</em> </strong> <em class="in">，因此它代表了一种不同的权衡，即在数据集不能大于内存的限制下实现非常高的读写速度。</em></p><p id="96b5" class="kx ky md kz b la lv lc ld le lw lg lh me lx lk ll mf ly lo lp mg lz ls lt lu ig bi translated">这意味着它不像只存储在内存中，也不是持久的。它将所有内容存储在内存中，写入磁盘是可选的，但仍可供使用</p></blockquote><figure class="mh mi mj mk gt jo"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="be53" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">下面是我从上面的视频中学到的笔记内容。因此，请随意快速浏览并跟着视频练习。</p><h1 id="fada" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Redis 安装</h1><p id="7a23" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">在 Mac 上:</p><p id="193e" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">自制安装:<code class="fe mn mo mp mq b"><strong class="kz io">brew install redis</strong></code></p><p id="f29a" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">运行服务器 Redis: <code class="fe mn mo mp mq b"><strong class="kz io">redis-server</strong></code></p><p id="4e63" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">通过<code class="fe mn mo mp mq b"><strong class="kz io">redis-cli</strong></code>打开一个新的选项卡/窗口访问 Redis CLI，键入<code class="fe mn mo mp mq b"><strong class="kz io">quit</strong></code>退出。</p><h1 id="d14f" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">基本命令</h1><p id="f778" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="kz io">设定</strong> : <code class="fe mn mo mp mq b"><strong class="kz io">SET</strong> key value</code>键的值，该值将存储为<code class="fe mn mo mp mq b">string</code></p><p id="64a7" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">获取键的值</strong> : <code class="fe mn mo mp mq b"><strong class="kz io">GET</strong> key</code></p><p id="bde1" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">检查钥匙是否存在</strong> : <code class="fe mn mo mp mq b"><strong class="kz io">EXISTS</strong> key</code></p><p id="2256" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">检查钥匙是否匹配一个图案</strong>:所有带有<code class="fe mn mo mp mq b"><strong class="kz io">KEY</strong> *</code>的钥匙</p><p id="f32c" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">清除所有缓存</strong> : <code class="fe mn mo mp mq b"><strong class="kz io">FLUSHALL</strong></code></p><p id="4a98" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">清除端子</strong> : <code class="fe mn mo mp mq b"><strong class="kz io">CLEAR</strong></code>上的所有输入</p><p id="988b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">注意:</strong>请注意，您可以同时使用<code class="fe mn mo mp mq b">set</code>或<code class="fe mn mo mp mq b">SET</code></p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="aac6" class="mv ka in mq b gy mw mx l my mz">127.0.0.1:6379&gt; <strong class="mq io">SET</strong> age 16<br/>OK<br/>127.0.0.1:6379&gt; <strong class="mq io">GET</strong> age<br/>"16"<br/>127.0.0.1:6379&gt; <strong class="mq io">EXISTS</strong> age<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">EXISTS</strong> name<br/>(integer) 0<br/>127.0.0.1:6379&gt; <strong class="mq io">KEYS</strong> *<br/>1) "age"<br/>127.0.0.1:6379&gt; <strong class="mq io">flushall</strong><br/>OK<br/>127.0.0.1:6379&gt; KEYS *<br/>(empty list or set)</span></pre><h1 id="a368" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">处理过期</h1><p id="1021" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">如果没有过期，键值将永远存在。</p><p id="822f" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">10 秒后</strong><code class="fe mn mo mp mq b"><strong class="kz io">age</strong></code><strong class="kz io">:</strong><code class="fe mn mo mp mq b"><strong class="kz io">EXPIRE </strong>key timevalue</code></p><p id="802e" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">例:<code class="fe mn mo mp mq b">expire age 10</code></p><p id="dd4b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">检查时间键 live(生存时间— </strong> <code class="fe mn mo mp mq b"><strong class="kz io">TTL</strong></code> <strong class="kz io"> ): </strong> <code class="fe mn mo mp mq b"><strong class="kz io">TTL </strong>key</code></p><p id="895f" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">超时后，密钥将被删除，值为<code class="fe mn mo mp mq b">nil</code></p><p id="f67a" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">同时设置过期键值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">SETEX age 10 16</strong></code></p><p id="59f0" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">这意味着我们设定的年龄在 10 秒内有一个值是 16</p><p id="7494" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">示例代码:</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="aed5" class="mv ka in mq b gy mw mx l my mz">127.0.0.1:6379&gt; <strong class="mq io">SET</strong> age 16<br/>OK<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">EXPIRE</strong> age 10<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">TTL</strong> age<br/>(integer) 4<br/>127.0.0.1:6379&gt; <strong class="mq io">TTL</strong> age<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">TTL</strong> age<br/>(integer) -2<br/>127.0.0.1:6379&gt; <strong class="mq io">GET</strong> age<br/>(nil)<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">SETEX</strong> age 10 16<br/>OK<br/>127.0.0.1:6379&gt; <strong class="mq io">GET</strong> age<br/>"16"<br/>127.0.0.1:6379&gt; <strong class="mq io">TTL</strong> age<br/>(integer) -2<br/>127.0.0.1:6379&gt; <strong class="mq io">GET</strong> age<br/>(nil)</span></pre><h1 id="990e" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">列表</h1><p id="ded6" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="kz io">添加项是值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">LPUSH key value</strong></code></p><p id="de0b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">获取一个键的列表值:</strong>T3】</p><p id="276e" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">由<code class="fe mn mo mp mq b"><strong class="kz io">GET</strong> key</code>将不会工作，因为这只是为字符串工作，这是一个列表</p><p id="61ff" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">将数值推到列表左侧:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">LPUSH key value</strong></code></p><p id="f37b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">将数值推到列表右侧:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">RPUSHKEY value</strong></code></p><p id="dc20" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">从左边弹出一个项目:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">LPOP key</strong></code>，类似的有<code class="fe mn mo mp mq b"><strong class="kz io">RPOP key</strong></code></p><p id="a40e" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">示例代码:</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="7d53" class="mv ka in mq b gy mw mx l my mz">127.0.0.1:6379&gt; <strong class="mq io">KEYS</strong> *<br/>1) "friends"<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">LRANGE</strong> friends 0 -1<br/>1) "thanh"<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">LPUSH</strong> friends nga<br/>(integer) 2<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">LRANGE</strong> friends 0 -1<br/>1) "nga"<br/>2) "thanh"<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">RPUSH</strong> friends xuan<br/>(integer) 3<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">LRANGE</strong> friends 0 -1<br/>1) "nga"<br/>2) "thanh"<br/>3) "xuan"<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">LPOP</strong> friends<br/>"nga"<br/>127.0.0.1:6379&gt; <strong class="mq io">LRANGE</strong> friends 0 -1<br/>1) "thanh"<br/>2) "xuan"</span></pre><h1 id="8218" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">设置</h1><p id="e386" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="kz io">给集合添加一个带值的键:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">SADD key value</strong></code></p><p id="b539" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">获取集合中的所有成员:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">SMEMBERS key</strong></code></p><p id="a28d" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">从集合中删除一个值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">SREM key value</strong></code></p><p id="94a8" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">示例代码:</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="0177" class="mv ka in mq b gy mw mx l my mz">// Add "running" to set<br/>127.0.0.1:6379&gt; <strong class="mq io">SADD</strong> hobbies running<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">SMEMBERS</strong> hobbies<br/>1) "running"<br/><br/>// Add again, will not duplicate value<br/>127.0.0.1:6379&gt; <strong class="mq io">SADD</strong> hobbies running<br/>(integer) 0<br/><br/>// Check all members in a set<br/>127.0.0.1:6379&gt; <strong class="mq io">SMEMBERS</strong> hobbies<br/>1) "running"<br/>127.0.0.1:6379&gt; <strong class="mq io">SADD</strong> hobbies tennis<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">SMEMBERS</strong> hobbies<br/>1) "tennis"<br/>2) "running"<br/>127.0.0.1:6379&gt; <strong class="mq io">SMEMBERS</strong> hobbies<br/>1) "tennis"<br/>2) "running"<br/><br/>// Remove a member in a set<br/>127.0.0.1:6379&gt; srem hobbies tennis<br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">SMEMBERS</strong> hobbies<br/>1) "running"</span></pre><h1 id="0534" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">混杂</h1><p id="c8c9" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><code class="fe mn mo mp mq b">key-value</code>对中的<code class="fe mn mo mp mq b">key-value</code>对</p><p id="72a8" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">设置为哈希一键及其字段的值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">HSET</strong> key field value</code></p><p id="9cbd" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">获取一个字段的值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">HGET</strong> key field</code></p><p id="e5a4" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">获取一个字段的所有值:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">HGETALL</strong> key field</code></p><p id="22ad" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">删除一个键中的字段:</strong>T17】</p><p id="29f3" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">检查一个字段中的键是否存在:</strong> <code class="fe mn mo mp mq b"><strong class="kz io">HEXISTS</strong> key field</code></p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="a0b0" class="mv ka in mq b gy mw mx l my mz">127.0.0.1:6379&gt; <strong class="mq io">HSET</strong> person name thanh <br/>(integer) 1 <br/>127.0.0.1:6379&gt; <strong class="mq io">HGET</strong> person name <br/>"thanh" <br/><br/>127.0.0.1:6379&gt; <strong class="mq io">HGETALL</strong> person <br/>1) "name" <br/>2) "thanh"<br/>127.0.0.1:6379&gt; <strong class="mq io">HSET</strong> person age 30 <br/>(integer) 1<br/>127.0.0.1:6379&gt; <strong class="mq io">HGETALL</strong> person <br/>1) "name" <br/>2) "thanh" <br/>3) "age" <br/>4) "30"<br/><br/>127.0.0.1:6379&gt; <strong class="mq io">HDEL</strong> person age <br/>(integer) 1 <br/>127.0.0.1:6379&gt; <strong class="mq io">HGETALL</strong> person <br/>1) "name" <br/>2) "thanh"</span></pre><h1 id="a6d2" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">节点示例</h1><p id="44a2" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><a class="ae na" href="https://www.youtube.com/watch?v=jgpVdJB2sKQ&amp;t=796s" rel="noopener ugc nofollow" target="_blank">链接演示</a>，我的简短总结:</p><p id="2223" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">第一步:安装并创建 Redis 实例，运行 Redis 服务器</strong></p><p id="f705" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">将 Redis 安装到项目:<code class="fe mn mo mp mq b">npm i redis</code></p><p id="077b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">在代码中，通过以下方式获取 Redis:<code class="fe mn mo mp mq b">const Redis = require("redis")</code></p><p id="0dcf" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">创建 Redis 的实例:<code class="fe mn mo mp mq b">const redisClient = Redis.createClient()</code></p><p id="ee42" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">第二步:设置一个过期的键值</strong></p><p id="a20b" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">使用 redisClient 作为普通 Redis(作为练习)。例如:</p><p id="e219" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">为缓存的数据响应设置一个带有过期时间的键值:</p><p id="361f" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><code class="fe mn mo mp mq b">redisClient.setex(photos, 3600, JSON.stringify(data))</code></p><p id="c5fc" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">步骤 3:在 Redis CLI 中检查密钥及其值</strong></p><p id="5102" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">再次运行应用程序后，我们可以使用<code class="fe mn mo mp mq b">key *</code>访问 Redis CLI 来检查缓存中是否有重要照片</p><p id="a881" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">步骤 4:使用响应数据关键字的缓存值</strong></p><p id="281a" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">然后我们检查 Redis 中的缓存，并使用它来替换数据响应:</p><p id="1fad" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">(如果要清除所有缓存，使用<strong class="kz io"> flushall </strong>)</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="d7b1" class="mv ka in mq b gy mw mx l my mz">api.get("/photos", async(req, res) =&gt; {<br/>  <strong class="mq io">const</strong> albumId = req.query.albumId<br/><br/>  redisClient.get(`photos/?ablumId=${albumId}`, async(errors, photos) =&gt; {  <br/>    <strong class="mq io">if</strong> (errors) console.<strong class="mq io">log</strong>(errors)<br/>    <strong class="mq io">if</strong> (photos !== null) {<br/>      <strong class="mq io">return</strong> res.json(JSON.<strong class="mq io">parse</strong>(photos))<br/>    } <strong class="mq io">else</strong> {<br/>      <strong class="mq io">const</strong> { data } = await axios.get(url)<br/>      res.json(data)<br/>    }<br/>  })<br/>})</span></pre><p id="253a" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><strong class="kz io">步骤 5:为获取或设置缓存的重用逻辑创建函数</strong></p><p id="c7e9" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">函数<code class="fe mn mo mp mq b">getOrSetCache</code>将接受一个键和一个回调</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="64e4" class="mv ka in mq b gy mw mx l my mz"><strong class="mq io">function</strong> getOrSetCache(key, callback) {<br/>  <strong class="mq io">return</strong> <strong class="mq io">new</strong> Promise(resolve, reject) {<br/>    redisClient.get(key, async (error, data) =&gt; {<br/>      <strong class="mq io">if</strong> (error) <strong class="mq io">return</strong> reject(error)<br/>      <strong class="mq io">if</strong> (data !== null) <strong class="mq io">return</strong> resolve(JSON.<strong class="mq io">parse</strong>(data))<br/>      <br/>      <strong class="mq io">const</strong> freshData = await callback()<br/>      redisClient.setex(key, 3600, JSON.<strong class="mq io">stringify</strong>(freshData))<br/>      resolve(freshData)<br/>    })<br/>  }<br/>}</span></pre><p id="79de" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">然后我们将在 get 中使用这个函数，如果想要缓存，对其他请求使用类似的函数:</p><pre class="mh mi mj mk gt mr mq ms mt aw mu bi"><span id="6c81" class="mv ka in mq b gy mw mx l my mz">api.get("/photos", async(req, res) =&gt; {<br/>  <strong class="mq io">const</strong> albumId = req.query.albumId<br/>  <strong class="mq io">const</strong> photos = await getOrSetCache(`photos/?ablumId=${albumId}`, async () =&gt; {<br/>    <strong class="mq io">const</strong> { data } = await axios.get(url)<br/>    <strong class="mq io">return</strong> data<br/>  }) </span><span id="8305" class="mv ka in mq b gy nb mx l my mz">  res.json(photos)<br/>})</span></pre></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="dbde" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">以上是关于 Redis 的一些基础知识，感谢阅读。</p><p id="24e6" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated"><a class="ae na" href="https://beautyoncode.com/basic-knowledges-about-redis/" rel="noopener ugc nofollow" target="_blank">原帖</a>在我的博客上，欢迎你来访问。</p><p id="90cb" class="pw-post-body-paragraph kx ky in kz b la lv lc ld le lw lg lh li lx lk ll lm ly lo lp lq lz ls lt lu ig bi translated">BeautyOnCode。</p></div></div>    
</body>
</html>