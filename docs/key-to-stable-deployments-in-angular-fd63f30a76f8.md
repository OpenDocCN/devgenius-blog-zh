# 角度稳定部署的关键

> 原文：<https://blog.devgenius.io/key-to-stable-deployments-in-angular-fd63f30a76f8?source=collection_archive---------14----------------------->

![](img/b353cb0a25d4457ac22788a27ffe27d0.png)

让我们来谈谈这样一种情况，你花了一个月的时间做一个发布。您正在使用 npm 来管理您的依赖项。之后，您冻结该版本的代码，以便在 2 周后部署到生产环境中。在发布当天，部署会失败，但它仍然可以在您的系统上正常工作。你抓耳挠腮，经过大量的努力和研究后，你发现你使用的第三方依赖关系得到了一个更新版本，该版本有一个错误，导致你的应用程序崩溃。

> 发现这类问题不仅困难，而且令人沮丧。在现实环境中，由于这些原因造成的部署延迟可能会让您的公司付出巨大的代价。

您可能会考虑将 package.json 中的库版本固定为旧版本号，而不使用任何操作符，如~,^等。这将工作，但在未来你将停止接收任何更新的第三方库，其中可能包括补丁，改进和错误修复。

但是等等，我们刚刚说它在你的机器上仍然工作正常。为什么即使在你的机器上重新安装依赖项后，你也没有得到那个错误。有趣的部分来了，npm(版本≥ 5)为我们提供了开箱即用，一旦安装到我们的设置中就可以修复版本。

如果您在创建新项目并在其上运行 npm install 时仔细观察。有一个生成的文件，即 package-lock.json。每当您添加任何依赖项或删除任何依赖项或手动更新任何依赖项版本时，该文件也会更新。

该文件基本上包含在运行 npm install 时安装的依赖项的版本号。这基本上意味着，如果这个文件在您的项目文件夹中，下次您运行 npm install 时，它将安装与先前安装的完全相同的版本，而不考虑任何更新的版本。

在标记为产品发布稳定的分支中，我们应该提交这个文件，这样它就可以在发布后成为标记分支的一部分。

因此，将来如果任何人想要使用旧的标记分支，他将获得与 package-lock.json 中提到的完全相同的依赖版本，而不会对 package.json 中的依赖版本产生任何影响。这意味着它在我的机器上不起作用的问题不会因任何第三方依赖而发生。

这同样适用于生产版本，因为该分支现在有一个 package-lock.json 文件，它将只安装我们检查应用程序是否稳定所需的版本。但是，一旦我们想要在一个分支中自动拥有所有依赖项的更新版本，我们也应该考虑删除这个文件，这样我们就有时间准备一个新的版本并测试它。稍后，当我们检查我们的新分支是否稳定并可以投入生产时，再次提交新生成的 package-lock.json。

另外，如果您的标记分支中有这个文件。安装依赖项后，您拥有的所有标签都是稳定的，可以很好地运行。因为他们现在确切地知道他们对哪个版本的依赖是稳定的。因为在开源环境中，我们知道即使在小版本中，有时第三方依赖也会破坏在它们上面实现的现有代码。

> 虽然有一个稳定的产品发布还有许多其他因素，如适当的测试，更少的错误代码等。但是下次当您在生产环境中部署时遇到部署失败时。由于对第三方的依赖而出现这种情况的可能性非常小。

如果负责任地使用(在需要时再次提交和删除)，package-lock.json 文件是朝着在产品发布当天没有突然惊喜的稳定发布又迈进了一步。

想要了解 package.json 操作符，比如~请参考[这里的](https://medium.com/@Hardy2151/caret-and-tilde-in-package-json-57f1cbbe347b)。