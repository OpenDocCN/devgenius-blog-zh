<html>
<head>
<title>CI/CD with AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 AWS 弹性豆茎的 CI/CD</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ci-cd-with-aws-elasticsbeanstalk-and-travis-ci-6bdd40dbf748?source=collection_archive---------3-----------------------#2020-08-19">https://blog.devgenius.io/ci-cd-with-aws-elasticsbeanstalk-and-travis-ci-6bdd40dbf748?source=collection_archive---------3-----------------------#2020-08-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eaed61afef646e2a7efbfaf17ac30038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cxscoL6bI7oZHlwI4CqtWw.jpeg"/></div></div></figure><p id="57b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个关于如何使用一些 DevOps 原则设置 react 前端的演练，例如持续集成和持续部署<strong class="jx io"> CI/CD </strong>。在演练中，我们将利用诸如<strong class="jx io"> Docker </strong>、<strong class="jx io"> Travis-ci </strong>和<strong class="jx io"> AWS Elastic beanstalk </strong>等工具。这不会是对这些工具的深入探究，但是您仍然可以在没有任何经验的情况下学习。</p><p id="0d4a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">先决条件</strong></p><ol class=""><li id="ffd3" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">使用<strong class="jx io"> git </strong>和<strong class="jx io"> GitHub </strong>的经验。</li></ol><p id="213c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.<strong class="jx io">特拉维斯-Ci </strong>账户。</p><p id="c08e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.<strong class="jx io">拥有管理员权限的 AWS </strong>账户。</p><p id="406a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本演练中，我将使用运行命令<strong class="jx io">npx create-react-app</strong><strong class="jx io">&lt;my-app&gt;时生成的默认 react-native 模板。</strong></p><h1 id="83c8" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">步骤 1 —设置 AWS 弹性豆茎。</strong></h1><p id="e47c" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">从在 Elastic beanstalk 中创建一个新环境开始。从<strong class="jx io"> AWS 管理控制台</strong>搜索弹性豆茎。<strong class="jx io">选择</strong>创建一个新环境。选择环境层<strong class="jx io"> Web 服务器环境。</strong>继续填写表格，添加<strong class="jx io">应用名称。</strong>如下图，选择<strong class="jx io">对接</strong>作为您要设置的<strong class="jx io">平台</strong>。最后同样重要的是创造一个环境。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/d073f3bd5aa27f5c89f0d90b81861bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PTMANX0hV031MSndaUw37g.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">选择 Docker 作为平台</figcaption></figure><p id="92f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mo" href="https://eu-west-2.console.aws.amazon.com/elasticbeanstalk/home?region=eu-west-2" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">Elastic Beanstalk</strong></a>然后会启动一个 S3 桶，里面有一个文件夹，里面会包含你所有设置为添加当前用户名的项目。同时，它将启动一个运行 Docker 和应用程序的 VM。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/5e1e530e24c92adc6c8c4cfe89df5391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiGq1ZzpdfPyE1rfpAfvuA.png"/></div></div></figure><h1 id="1b7f" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">步骤 2 — </strong> <strong class="ak">设置 AWS IAM </strong></h1><p id="fd38" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">因为 Travis-ci 将用于将应用程序集成到要部署的 elastic beanstalk 中。我们必须给特拉维斯一些许可。为此，需要创建秘密密钥，Travis-ci 将使用这些密钥来验证和确认权限集。</p><p id="9f89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从<strong class="jx io"> AWS 管理控制台</strong>搜索<strong class="jx io"> IAM </strong>(身份访问管理)您需要拥有管理员权限或至少拥有授予当前用户创建用户<strong class="jx io"> </strong>和分配策略权限的策略权限。</p><p id="43f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<strong class="jx io"> IAM </strong>仪表盘中，选择左侧菜单上的<strong class="jx io">用户</strong>。然后在顶部选择<strong class="jx io">添加用户。</strong>另一个表格将提示您继续填写您想要的任何<strong class="jx io">用户名* </strong>并<strong class="jx io">选择 AWS 访问类型</strong>作为<strong class="jx io">编程访问。</strong></p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/29d1377749b90e1a4a5d703eb3eb3dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5XU5FEHuiGXDCQYF45-cBw.png"/></div></div></figure><p id="645a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们创建的用户需要能够向 elastic beanstalk 部署新的应用程序。为了实现这一点(1) <strong class="jx io">直接附加现有策略。</strong>通过搜索<strong class="jx io"> </strong>过滤下面的列表(2)使用<strong class="jx io"> Elasticbeanstalk </strong>过滤策略(3)检查<strong class="jx io">AWSElasticBeanstalkFullAccess。</strong>在我们的例子中，这将给予用户 Travis-ci 访问 elastic beanstalk 的完全权限。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/aa15b9acd01bf01b86bc797826068d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CkEXxFj2SQ-P8tmN6AwWA.png"/></div></div></figure><p id="d919" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">下一步:标签，下一步:审核</strong>，最后<strong class="jx io">创建用户</strong></p><p id="70bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在最后一部分，您将看到一条消息，告知成功。在那下面将会出现这个表格。这里重要的是<strong class="jx io">访问密钥 ID </strong>和<strong class="jx io">秘密访问密钥</strong>。可以<strong class="jx io">下载。csv </strong>或<strong class="jx io">或</strong>将两把钥匙(点击<strong class="jx io">显示</strong>)复制到电脑上的文本文件中以备后用。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/f124afe8401d703ca02acb9dc2622bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sAJacZBnikqEX58wMpPGA.png"/></div></div></figure><h1 id="3fbb" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">步骤 3 —创建 Github 存储库</strong></h1><p id="8d69" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">您需要创建一个存储库来保存您想要部署的应用程序的配置文件。在<strong class="jx io"> Github 中创建一个资源库。</strong>如果您已经有了存储库，请跳过这一步。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/5bcb29990520cea4136be6c47c6e26d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQ3cMSfCfIEZ8bBqsdIFlg.png"/></div></div></figure><h1 id="ee22" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">步骤 4 —设置 Travis-ci </strong></h1><p id="d459" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">Travis 是连接 Github 存储库和 AWS 的代理。Travis 可以作为 CI 工具执行许多任务。在 Travis 中，您必须将 GitHub 存储库与 Travis-ci 同步。最好的方法是通过 Oauth 使用您的 GitHub 用户帐户创建一个帐户。</p><p id="3c27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择要添加到 Travis-ci 以进行观察的存储库。在右上角点击 profile，然后选择一个<strong class="jx io">设置。</strong>如果您的帐户被同步，您将看到 GitHub 公共项目列表。<strong class="jx io"> </strong>为你创建的库名过滤项目。如果您没有看到您的存储库启动<strong class="jx io">同步帐户</strong></p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/5d54913fdef35a9e5751e9083158b6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*crk6MTyaaY3mnbPjKgcq6A.png"/></div></div></figure><p id="9303" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择储存库，然后<strong class="jx io">激活储存库。</strong></p><p id="7829" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在同一页面上<strong class="jx io">下的选项</strong>比<strong class="jx io">设置多。</strong>在设置仪表板中，您必须添加我们使用<strong class="jx io"> AWS IAM </strong>步骤 2 <strong class="jx io">创建的<strong class="jx io">密钥</strong>。在环境变量</strong>下，添加<strong class="jx io"> AWS_ACCESS_KEY 和 AWS_SECRET_KEY。</strong></p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/6b54dfff4a2b82566e26e0e82e410a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZsJoyb3-ILaUuSS-8GWq-w.png"/></div></div></figure><p id="3532" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有许多方法可以用 react 设置 CI/CD。通过充分利用容器的可移植性和效率等优势，降低了自动化的复杂性。为此，将设置两个<strong class="jx io"> Dockerfiles </strong>。</p><h1 id="3a75" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">步骤 5- Dockerfile 和 Travis config </strong></h1><p id="9baa" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">Dockerfile 是一个文本文档，它包含用户可以在命令行上调用的所有命令来组合一个图像。这是一个命令<strong class="jx io">声明式</strong>。在某些生产版本中，您可以有一个 docker 文件，但这取决于您的设置和目标。出于本演练的目的，我们将有两个<strong class="jx io"> Dockerfile.dev </strong>和<strong class="jx io"> Dockerfile </strong></p><h2 id="20bd" class="mw ld in bd le mx my dn li mz na dp lm kg nb nc lq kk nd ne lu ko nf ng ly nh bi translated"><strong class="ak"> Dockerfile.dev </strong></h2><p id="4a66" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">这个文件将创建一个 Travis 将用来测试应用程序的环境。Docker 文件使用<strong class="jx io"> node: alpine </strong>作为基本映像，如果您熟悉 nodejs，您会看到最后一个命令将运行应用程序。这个 Dockerfile.dev 将运行应用程序用于<strong class="jx io">测试</strong>目的。我就不赘述了，我假设你对 Docker 有一个简单的了解。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="980f" class="mw ld in bd le mx my dn li mz na dp lm kg nb nc lq kk nd ne lu ko nf ng ly nh bi translated"><strong class="ak"> Dockerfile </strong></h2><p id="6227" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">这个 Dockerfile 将由 AWS Elastic beanstalk 发起。这是应用程序的生产状态。这可以看出，因为我们构建使用<strong class="jx io">运行</strong>运行<strong class="jx io"> npm 运行构建。</strong>该文件将在端口<strong class="jx io"> 80 通过<strong class="jx io"> Nginx </strong>构建并公开应用。</strong></p><p id="0e31" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">注意:</strong>避免使用<strong class="jx io">节点:alpine-builder</strong>和<strong class="jx io">Copy-from = build</strong>否则弹性豆茎会出错。这将被视为两个论点。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="c14b" class="mw ld in bd le mx my dn li mz na dp lm kg nb nc lq kk nd ne lu ko nf ng ly nh bi translated"><strong class="ak"> .travis.yaml </strong></h2><p id="ed52" class="pw-post-body-paragraph jv jw in jx b jy ma ka kb kc mb ke kf kg mc ki kj kk md km kn ko me kq kr ks ig bi translated">这是 Travis-ci 将用于测试和集成到 AWS 的主文件。Travis 将启动一个虚拟机，并使用管理员权限运行<strong class="jx io">Docker</strong>(<strong class="jx io">sudo</strong>)。<strong class="jx io"> before_install </strong>将使用<strong class="jx io"> Dockerfile.dev </strong>创建镜像测试。<strong class="jx io">部署</strong>元数据将告诉 Travis 如何以及在哪里部署应用程序。Travis-ci 已经过预配置，可以部署到一些提供商，参见文档<a class="ae mo" href="https://docs.travis-ci.com/user/deployment" rel="noopener ugc nofollow" target="_blank">https://docs.travis-ci.com/user/deployment</a>。</p><p id="ade3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所有这些信息都可以得到</p><p id="cff3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">提供商— </strong>陈述目标提供商</p><p id="8dd6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">地区— </strong> AWS 有许多地区，在本例中是<strong class="jx io">美国-西部-2-伦敦</strong></p><p id="4e91" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> app — </strong>您在 Elastic beanstalk 中设置的应用名称</p><p id="c24b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> env — </strong>是环境的名称</p><p id="cc44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">bucket _ name—</strong>Elastic beanstalk 在 S3 有自己的文件夹，其中包含所有项目。</p><p id="1b71" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">bucket _ path—</strong>bucket _ name 中包含应用文件的路径</p><p id="9a21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> on: master — </strong>这将告诉 Travis 要触发建造哪个分支。</p><p id="1c53" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> access_key_id </strong> —这个访问密钥是我们在步骤 2 中创建用户时在 AWS 中创建的。这个键将由 Travis 作为环境变量传递。</p><p id="0a02" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> secret_access_key — </strong>这是 Travis 将作为环境变量传递的最终密钥。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4ce7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">最后</strong></p><p id="6375" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦所有这些文件都被添加到应用程序的根目录中。将项目提交并推送到 GitHub。Travis 将启动并部署到 AWS Elastic beanstalk。然后，Elastic beanstalk 将部署 react 应用程序。您可以通过 Elastic Beanstalk 提供的 URL 访问该网站。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/38c25aa288c7393e46d21babd0b1092e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxPh9orIkJpQ9rs-hjMnwA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Travis-ci 中的状态显示</figcaption></figure><p id="89f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果管道不成功，请检查日志中的错误。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/432a3de3c5a34d8e2158e06c9391a248.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8M2E9BFD-AR1Th1xtOCTvw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">AWS 的状态</figcaption></figure><p id="2f01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意右上角的链接，以查看新部署的网站。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/971e9e888650e19f705e2535a026b839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ln2OhkrOBehYkyC8xz3TGQ.png"/></div></div></figure></div></div>    
</body>
</html>