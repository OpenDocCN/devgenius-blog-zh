<html>
<head>
<title>Australian Census 2021. Loading data and showing it on a map</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">澳大利亚 2021 年人口普查。加载数据并将其显示在地图上</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/australian-census-2021-loading-data-and-showing-it-on-a-map-192dd0b49d00?source=collection_archive---------7-----------------------#2022-07-21">https://blog.devgenius.io/australian-census-2021-loading-data-and-showing-it-on-a-map-192dd0b49d00?source=collection_archive---------7-----------------------#2022-07-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9eef4f890e2bd17ab062ea896ddad4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aQHqBD3qwunccy84"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">安妮·斯普拉特在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3e86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">去年我们进行了一次澳大利亚人口普查，现在可以从澳大利亚统计局的网站上下载一个新的数据集。</p><p id="0554" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我处理之前的 2016 年人口普查数据时，我希望改进旧方法的几个缺点:</p><ul class=""><li id="97c4" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">显示普查数据中的任何指标</li><li id="5f17" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">允许使用位置名称在指定区域放大地图</li><li id="13f1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">显示郊区轮廓及其名称</li><li id="24c9" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用人口普查指标计算给定统计区域的人口占总统计区域人口的百分比，例如在希腊出生的人数</li><li id="47e9" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">将地图导出到文件，以便以 PDF 或 JPEG 格式与其他人共享</li></ul><h1 id="7a76" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">从 ABS 网站加载数据</h1><p id="adda" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">最新的 2021 年人口普查数据包可以从 https://www.abs.gov.au/census/find-census-data/datapacks<a class="ae jz" href="https://www.abs.gov.au/census/find-census-data/datapacks" rel="noopener ugc nofollow" target="_blank">下载</a></p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/f77eb064eefd0d66b1c52917092862e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Rgb1HMJ-3e3FEB2vAEWfw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">人口普查数据包下载</figcaption></figure><p id="20eb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择人口普查年份和统计区域 1 (SA1)地理。SA1 是最小的统计区域。sa1 一般人口在 200 到 800 人，平均人口在 400 人左右。</p><p id="86a1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了人口普查数据，我们还需要下载 SHP 文件格式的 SA1 和郊区的地理形状</p><p id="ce73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">https://www . ABS . gov . au/statistics/standards/Australia n-statistical-geography-standard-asgs-edition-3/jul 2021-jun 2026/access-and-downloads/digital-boundary-files</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/3da25646e406a61033b9d3d98945fc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obJ5ykPCFuOpMfeEzagwmA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">SA1 几何下载</figcaption></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/4f954beaafb052bc41b27b33b475aac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7y6eEWqrOsqApufW_tiP1Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">郊区几何图形下载</figcaption></figure><h1 id="b8e9" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">将普查元数据加载到 Pandas 数据框架中</h1><p id="2382" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">普查数据包包含 XLSX 文件格式的 Excel 电子表格。该文件包含两个电子表格，其中包含关于人口普查数据表和每个表中的列的详细信息。可以使用 openpyxl 库将数据加载到 Pandas 中。要安装 run:</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="0889" class="nb ln in mx b gy nc nd l ne nf">!pip install openpyxl</span></pre><p id="7a80" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们可以将元数据加载到数据框中:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="e339" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">census _ cells _ df“Long”列包含对普查指标的详细描述。让我们获取所有包含“人员”的指标:</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="985a" class="nb ln in mx b gy nc nd l ne nf">census_cells_df[census_cells_df.Long.str.contains("Persons")]</span></pre><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/4f6d8dfe7144c7aba0597957c96a6bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sc8uOUPdKTvgrQCnyCnEvQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">普查元数据</figcaption></figure><p id="0aab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，指标“总人数”位于数据包文件“G01”中。</p><h1 id="b3be" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">加载统计区域 1 和郊区几何</h1><p id="8a7f" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">要将 SHP 文件加载到地理数据框中，请运行:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="35bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我也在添加调用<em class="nj">。to_crs(crs=4326) </em>将坐标参考系统设置为 WGS 84。如下图所示，它包含了整个澳大利亚的几何图形:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3f701a30e80babf2723fa033a22e6307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*bzbHz5EdG_82dzPy7i2CzA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">SA1 几何</figcaption></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/c1090c7256be7425fbc5f28146c7904d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*5aH5UtMyEMdr2jPZocTVHw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">郊区几何图形</figcaption></figure><h1 id="0091" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">地图的边界框坐标</h1><p id="5605" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">通常，我们希望显示城市、城镇或城市内区域的人口普查数据。这可以通过定义边界框来完成。它是一个矩形，以十进制的纬度和经度来指定区域的北、南、西、东边界。</p><p id="8a79" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以通过浏览地图来获取它们，但我发现更简单的方法是指定我想要包含的位置，然后构建一个包含所有这些位置的边界框。例如，这里是郊区“新南威尔士州 Engadine”、“新南威尔士州戈登”、“新南威尔士州曼利”和“新南威尔士州梅里兰兹”的边界框:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/a428d35d11c3610fbb164c0a64adade0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*e3jlNeP4OCSl0-8FNPy4-g.png"/></div></figure><p id="18e0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">可以使用 OSMNX 库从 OpenStreetMap 加载位置形状。为什么选择 OpenStreetMap？它提供了更多的位置类型，例如一些“非官方”的地区名称，如悉尼的“内西部”或整个城市的轮廓。人口普查数据只包括郊区和 SA1 地区。</p><p id="4ba9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下代码将返回位置列表的边界框:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4c9a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是生成的边界框:</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="4fd4" class="nb ln in mx b gy nc nd l ne nf">{'north': -33.7428152,<br/> 'south': -34.0795039,<br/> 'west': 150.9625496,<br/> 'east': 151.307459}</span></pre><h1 id="94c5" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">加载人口普查数据表</h1><p id="094e" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">每个普查数据文件都以 CSV 格式存储。我们可以通过传递数据表名将其加载到数据框中，如“G03”:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/23ef7870e4abbc4e118fd036276a7624.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*6c2raFQCez3YeKMSo-X_bw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">G03 数据表中的 Total_Total 指标</figcaption></figure><h1 id="01b9" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">通用地图渲染功能</h1><p id="cc78" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">因为为不同的度量和位置生成地图是相似的，所以我决定实现一个函数，该函数将根据人口普查度量、白色郊区轮廓和郊区标签对区域进行着色。您也可以指定地图边界框的位置。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1e64" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是一个使用此函数显示几个郊区并将它们的形状区域用于色阶的示例:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/216841ba946dc7498da2dad0de549000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*eH9MDtH88xH8ATD11xPRdA.png"/></div></figure><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/f1c7406fff41a08c0b23926ff692ee75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVIBEl4FkuhbCNE87esvMg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">带有郊区轮廓的渲染地图</figcaption></figure><h1 id="f966" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">悉尼人口密度图</h1><p id="3850" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">现在，通过访问人口普查数据和地图渲染功能，我们可以通过将 SA1 人口(数据表 G03，列<strong class="kc io"> Total_Total </strong>)除以其面积(来自几何 SHP 文件的<strong class="kc io"> AREASQKM21 </strong>)来创建人口密度地图。</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="0e9c" class="nb ln in mx b gy nc nd l ne nf">pop_area_sa_df = load_census_table("G03")<br/>pop_area_sa_df["population_density"] = pop_area_sa_df.Total_Total / pop_area_sa_df.AREASQKM21</span></pre><p id="c43e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">和渲染贴图:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/435f313e31e00e219ef1e93d8ae26d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUzcbOkHomeWHYr6dAHoTw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">悉尼人口密度</figcaption></figure><p id="3e8f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我决定对显示的郊区标签的数量进行限制，否则您将无法看到实际的地图。</p><h1 id="01fe" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">简化人口普查地图逻辑</h1><p id="ba98" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">看起来不错，但是其他指标呢？我懒得去查 metric 在哪个数据表里面，键入 title。让代码为我们做这些工作。我们可以使用元数据填充标题并查找度量文件名:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="e807" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们只需要一个公制的长名字(<strong class="kc io">中位数 _ 总数 _ 家庭 _ 收入 _ 每周</strong>)和位置列表就可以得到一张地图。只用一行代码:-)</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="2afe" class="nb ln in mx b gy nc nd l ne nf">show_census_data("Median_total_family_income_weekly", ["Gordon, NSW", "Parramatta, NSW", "Manly, NSW", "Engadine, NSW"])</span></pre><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/279e42ac5379a2bda65029d57929e1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41NtJPVnifvjTLeqGBT6tw.png"/></div></div></figure><p id="6a9e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一些指标，如每周家庭收入，可以用作彩色地图的值，但其他指标，如某个国家的出生人数，只有在我们将该数字与统计区域的总人口进行比较时才有意义。这就是为什么我添加了一个额外的布尔参数<strong class="kc io">relative _ to _ total _ population。</strong>设置为 true 时，将创建一个数据框列，其中包含人口占区域人口的百分比。</p><p id="01af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，metric PERSONS_Greece_Total 的可视化显示出生在希腊的人的百分比:</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="b143" class="nb ln in mx b gy nc nd l ne nf">show_census_data("PERSONS_Greece_Total", ["Gordon, NSW", "Parramatta, NSW", "Manly, NSW", "Engadine, NSW"], relative_to_total_population=True)</span></pre><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/c46d083f434947a9b5bff0a6d6cf2a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4ZohmMnazPi150jL7y1Rw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">悉尼出生在希腊的人的百分比</figcaption></figure><p id="5371" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">想尝试其他指标吗？去 Kaggle 笔记本实验:</p><div class="nt nu gp gr nv nw"><a href="https://www.kaggle.com/code/maxim75/australian-census-2021" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">澳大利亚 2021 年人口普查</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">使用 Kaggle 笔记本探索和运行机器学习代码|使用来自多个数据源的数据</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">www.kaggle.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jt nw"/></div></div></a></div></div></div>    
</body>
</html>