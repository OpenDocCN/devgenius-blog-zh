<html>
<head>
<title>Connect Spring Boot Application with AWS Dynamo DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Spring Boot应用程序与AWS Dynamo DB连接</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connect-spring-boot-application-with-aws-dynamo-db-18c70a34fdea?source=collection_archive---------5-----------------------#2021-08-15">https://blog.devgenius.io/connect-spring-boot-application-with-aws-dynamo-db-18c70a34fdea?source=collection_archive---------5-----------------------#2021-08-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6f19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我将展示如何将Spring Boot应用程序与AWS Dynamo DB连接起来。我还将介绍AWS Dynamo DB的一些基础知识，它是一个非SQL数据库。</p><h1 id="3612" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">AWS发电机数据库</h1><p id="6daf" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">根据Amazon <a class="ae ll" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank">文档</a>，Dynamo DB是无SQL键值和文档数据库。我们确实有一些替代方案，比如Cassandra(键值)或Mongo DB(文档)。</p><p id="973c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">迪纳摩DB提供</p><ul class=""><li id="6ac1" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated">可靠的可扩展性能</li><li id="4111" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">允许键值访问的简单API</li></ul><p id="37d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Dynamo DB通常非常适合具有以下要求的应用程序:</p><ol class=""><li id="00b8" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh ma ls lt lu bi translated">大量数据和延迟要求</li><li id="5dda" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh ma ls lt lu bi translated">推荐系统的数据集</li><li id="a766" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh ma ls lt lu bi translated">使用AWS Lambda的无服务器应用程序</li></ol><h1 id="6f06" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">关键概念</h1><p id="9420" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在我们可以使用<a class="ae ll" href="https://betterjavacode.com/programming/7-aws-services-every-developer-should-know-about" rel="noopener ugc nofollow" target="_blank"> Dynamo DB </a>之前，理解这个数据库的一些关键概念是很重要的。</p><ul class=""><li id="11ce" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated"><strong class="jm io">表格、项目和属性</strong>——这三个是迪纳摩DB的基本模块。表格是一组数据记录。项目是表中的单个数据记录。此后，表中的每一项都使用主键来标识。属性是单个项目中的数据片段。</li><li id="cc7f" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">迪纳摩数据库表是无模式的。然而，我们只需要在创建表时定义一个<strong class="jm io">主键</strong>。简单主键<strong class="jm io">或复合主键<strong class="jm io">是主键的两种类型。</strong></strong></li><li id="e8bb" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">二级索引</strong> —有时主键不足以从表中访问数据。辅助索引支持来自Dynamo DB的附加访问模式。然而，有两种类型的索引— <strong class="jm io">局部二级索引</strong>和<strong class="jm io">全局二级索引</strong>。本地辅助索引使用与基础表相同的分区键，但使用不同的排序键。全局辅助索引使用与基础表不同的分区键和排序键。</li></ul><h1 id="9b97" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">迪纳摩数据库的应用</h1><p id="2316" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">与其他SQL或NoSQL数据库相比，Dynamo DB有一个不同之处。我们可以通过REST调用与Dynamo DB进行交互。我们不需要应用程序需要保持一致连接的JDBC连接协议。</p><p id="4309" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有两种方法可以将应用程序连接到Dynamo DB。</p><ol class=""><li id="64f6" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh ma ls lt lu bi translated">将Spring数据库与Dynamo DB一起使用</li><li id="c6ea" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh ma ls lt lu bi translated">使用AWS SDK提供的客户端</li></ol><h1 id="b4a6" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">Spring Boot应用</h1><p id="9589" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">作为演示的一部分，我们将创建一些描述实体关系的数据模型类。随后，应用程序将为crud操作提供一个简单的REST API，并将数据存储在Dynamo DB中。</p><p id="8ff1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，让我们从在应用程序中添加所需的依赖项开始:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="ff4d" class="mk kj in mg b gy ml mm l mn mo">dependencies {<br/>	implementation 'org.springframework.boot:spring-boot-starter-web'<br/>	implementation 'io.github.boostchicken:spring-data-dynamodb:5.2.5'<br/>	implementation 'junit:junit:4.13.1'<br/>	testImplementation 'org.springframework.boot:spring-boot-starter-test'<br/>}</span></pre><p id="3f28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，依赖关系<code class="fe mp mq mr mg b">spring-data-dynamodb</code>允许我们在模型类中表示Dynamo DB表，并为这些表创建存储库。</p><p id="cd46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将如下创建我们的模型类<code class="fe mp mq mr mg b">Company</code>:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="8e0a" class="mk kj in mg b gy ml mm l mn mo">package com.betterjavacode.dynamodbdemo.models;<br/><br/>import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBAttribute;<br/>import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBAutoGeneratedKey;<br/>import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBHashKey;<br/>import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBTable;<br/><br/>@DynamoDBTable(tableName = "Company")<br/>public class Company<br/>{<br/>    private String companyId;<br/><br/>    private String name;<br/><br/>    private String type;<br/><br/>    @DynamoDBHashKey(attributeName = "CompanyId")<br/>    @DynamoDBAutoGeneratedKey<br/>    public String getCompanyId ()<br/>    {<br/>        return companyId;<br/>    }<br/><br/><br/>    public void setCompanyId (String companyId)<br/>    {<br/>        this.companyId = companyId;<br/>    }<br/><br/>    @DynamoDBAttribute(attributeName = "Name")<br/>    public String getName ()<br/>    {<br/>        return name;<br/>    }<br/><br/>    public void setName (String name)<br/>    {<br/>        this.name = name;<br/>    }<br/><br/>    @DynamoDBAttribute(attributeName = "Type")<br/>    public String getType ()<br/>    {<br/>        return type;<br/>    }<br/><br/>    public void setType (String type)<br/>    {<br/>        this.type = type;<br/>    }<br/>}</span></pre><p id="2baf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以这个类Company映射到同名的Dynamo DB表。注释<code class="fe mp mq mr mg b">DynamoDBTable</code>帮助我们进行映射。同样，<code class="fe mp mq mr mg b">DynamoDBHashKey</code>是这个表的属性键。<code class="fe mp mq mr mg b">DynamoDBAttribute</code>是这张表的其他属性。</p><p id="ac3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将创建一个REST控制器和一个服务类，允许我们调用这个对象的CRUD APIs。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="9618" class="mk kj in mg b gy ml mm l mn mo">package com.betterjavacode.dynamodbdemo.controllers;<br/><br/>import com.betterjavacode.dynamodbdemo.models.Company;<br/>import com.betterjavacode.dynamodbdemo.services.CompanyService;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.http.HttpStatus;<br/>import org.springframework.http.ResponseEntity;<br/>import org.springframework.web.bind.annotation.*;<br/><br/>@RestController<br/>@RequestMapping("v1/betterjavacode/companies")<br/>public class CompanyController<br/>{<br/>    @Autowired<br/>    private CompanyService companyService;<br/><br/>    @GetMapping(value = "/{id}", produces = "application/json")<br/>    public ResponseEntity getCompany(@PathVariable("id") String id)<br/>    {<br/><br/>        Company company = companyService.getCompany(id);<br/><br/>        if(company == null)<br/>        {<br/>            return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST);<br/>        }<br/>        else<br/>        {<br/>            return new ResponseEntity&lt;&gt;(company, HttpStatus.OK);<br/>        }<br/>    }<br/><br/>    @PostMapping()<br/>    public Company createCompany(@RequestBody Company company)<br/>    {<br/>        Company companyCreated = companyService.createCompany(company);<br/><br/>        return company;<br/>    }<br/>}</span></pre><p id="b473" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们有两种方法，一种是获取公司数据，另一种是创建公司。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="9583" class="mk kj in mg b gy ml mm l mn mo">package com.betterjavacode.dynamodbdemo.services;<br/><br/>import com.betterjavacode.dynamodbdemo.models.Company;<br/>import com.betterjavacode.dynamodbdemo.repositories.CompanyRepository;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.stereotype.Service;<br/><br/>import java.util.List;<br/>import java.util.Optional;<br/><br/>@Service<br/>public class CompanyService<br/>{<br/>    @Autowired<br/>    private CompanyRepository companyRepository;<br/><br/>    public Company createCompany(final Company company)<br/>    {<br/>        Company createdCompany = companyRepository.save(company);<br/>        return createdCompany;<br/>    }<br/><br/>    public List getAllCompanies()<br/>    {<br/>        return (List) companyRepository.findAll();<br/>    }<br/><br/>    public Company getCompany(String companyId)<br/>    {<br/>        Optional companyOptional = companyRepository.findById(companyId);<br/><br/>        if(companyOptional.isPresent())<br/>        {<br/>            return companyOptional.get();<br/>        }<br/>        else<br/>        {<br/>            return null;<br/>        }<br/>    }<br/>}</span></pre><h1 id="6702" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">将Spring Boot应用程序与AWS Dynamo DB连接</h1><p id="09f7" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">到目前为止，我们已经创建了应用程序的一些部分。但是，我们还有一个重要的部分，那就是将我们的应用程序连接到AWS中的AWS Dynamo DB服务。</p><p id="e3f3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">登录AWS控制台并访问Dynamo DB。</p><p id="c62c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在Dynamo DB中创建新表。</p><figure class="mb mc md me gt mt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/29bea355e777e2b6a09cd10c128c012d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*S1f8AemXYCkm_mr2"/></div></figure><p id="391a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设，你选择主键为<code class="fe mp mq mr mg b">CompanyId</code>，我们这里应该没问题。记住，那是我们在模型类中定义的分区键。</p><p id="2987" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在回到Spring Boot应用程序。创建一个新bean <code class="fe mp mq mr mg b">ApplicationConfig</code>来定义Dynamo DB配置。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="d4e0" class="mk kj in mg b gy ml mm l mn mo">package com.betterjavacode.dynamodbdemo.config;<br/><br/>import com.amazonaws.auth.AWSCredentials;<br/>import com.amazonaws.auth.AWSCredentialsProvider;<br/>import com.amazonaws.auth.AWSStaticCredentialsProvider;<br/>import com.amazonaws.auth.BasicAWSCredentials;<br/>import com.amazonaws.regions.Regions;<br/>import com.amazonaws.services.dynamodbv2.AmazonDynamoDB;<br/>import com.amazonaws.services.dynamodbv2.AmazonDynamoDBClientBuilder;<br/>import org.socialsignin.spring.data.dynamodb.repository.config.EnableDynamoDBRepositories;<br/>import org.springframework.beans.factory.annotation.Value;<br/>import org.springframework.context.annotation.Bean;<br/>import org.springframework.context.annotation.Configuration;<br/><br/>@Configuration<br/>@EnableDynamoDBRepositories(basePackages = "com.betterjavacode.dynamodbdemo.repositories")<br/>public class ApplicationConfig<br/>{<br/>    @Value("${amazon.aws.accesskey}")<br/>    private String amazonAccessKey;<br/><br/>    @Value("${amazon.aws.secretkey}")<br/>    private String amazonSecretKey;<br/><br/>    public AWSCredentialsProvider awsCredentialsProvider()<br/>    {<br/>        return new AWSStaticCredentialsProvider(amazonAWSCredentials());<br/>    }<br/><br/>    @Bean<br/>    public AWSCredentials amazonAWSCredentials()<br/>    {<br/>        return new BasicAWSCredentials(amazonAccessKey, amazonSecretKey);<br/>    }<br/><br/>    @Bean<br/>    public AmazonDynamoDB amazonDynamoDB()<br/>    {<br/>        return AmazonDynamoDBClientBuilder.standard().withCredentials(awsCredentialsProvider()).withRegion(Regions.US_EAST_1).build();<br/>    }<br/>}</span></pre><p id="9608" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要通过<code class="fe mp mq mr mg b">application.properties</code>中的<code class="fe mp mq mr mg b">accessKey</code>和<code class="fe mp mq mr mg b">secretKey</code>。重要的是，我们在这里创建了一个<code class="fe mp mq mr mg b">AmazonDynamoDB</code> bean。</p><p id="bac9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们启动我们的应用程序，我们将看到日志显示它已经创建了一个与DynamoDB表<code class="fe mp mq mr mg b">Company</code>的连接。</p><figure class="mb mc md me gt mt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/175afeba8c8d69f81c168b8501698478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*VbvP10cct_fLXBm1"/></div></figure><p id="7ae4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦应用程序启动，我们将访问Postman for REST API。</p><figure class="mb mc md me gt mt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/4317f372bc07998846a1aebec37a5f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*gAj7kmPN_1hy0yeS"/></div></figure><h1 id="0cf4" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">结论</h1><p id="9706" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">这个演示的代码可以在我的<a class="ae ll" href="https://github.com/yogsma/betterjavacode/tree/main/dynamodbdemo" rel="noopener ugc nofollow" target="_blank"> github库</a>中找到。</p><p id="091d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我们展示了如何在Spring Boot应用程序中使用Dynamo DB——一个非SQL数据库。</p><ul class=""><li id="a724" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated">我们讨论了迪纳摩DB的概念。</li><li id="ec2d" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">我们创建了一个Spring Boot应用程序。</li><li id="2b24" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">我们在AWS中创建了一个Dynamo DB表。</li><li id="682d" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">我们将Spring Boot应用程序连接到AWS Dynamo数据库表。</li></ul></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="5e93" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nd">原载于2021年8月15日https://betterjavacode.com</em><a class="ae ll" href="https://betterjavacode.com/programming/spring-boot-connect-aws-dynamo-db" rel="noopener ugc nofollow" target="_blank"><em class="nd"/></a><em class="nd">。</em></p></div></div>    
</body>
</html>