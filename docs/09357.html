<html>
<head>
<title>Access the Filesystem with Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Javascript 访问文件系统</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/access-the-filesystem-with-javascript-c36577dc0bb4?source=collection_archive---------6-----------------------#2022-08-16">https://blog.devgenius.io/access-the-filesystem-with-javascript-c36577dc0bb4?source=collection_archive---------6-----------------------#2022-08-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0a45" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">文件系统访问 API 的快速概述</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0c1e5b0d285f4f00bae87d2dead9730d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s4ZNgVl-G-rk-PId"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">图片由 Patrick Lindenberg 通过 unsplash 提供</figcaption></figure><p id="d136" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">文件系统访问一直是 JS 开发人员的白日梦。直到今年，直到文件系统访问 API 的推出。这个 API 使 JS 开发人员能够读写主机的文件系统。在这篇文章中，我将带您了解如何读写文件系统中的数据。</p><h1 id="a4af" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">访问目录和文件</h1><p id="5762" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">您可以通过调用函数<code class="fe mm mn mo mp b">window.showDirectoryPicker</code>来访问目录。这将打开一个选择目录的窗口。一旦选中，该函数将返回一个<code class="fe mm mn mo mp b">Promise</code>。这个<code class="fe mm mn mo mp b">Promise</code>将返回你的目录句柄。目录句柄是文件系统的网关。以下是演示此代码的示例函数:</p><pre class="kd ke kf kg gt mq mp mr ms aw mt bi"><span id="b70e" class="mu lq in mp b gy mv mw l mx my">let dirHandle;</span><span id="e69a" class="mu lq in mp b gy mz mw l mx my">async function readConfig(){</span><span id="e605" class="mu lq in mp b gy mz mw l mx my"><br/>    dirHandle = await window.showDirectoryPicker();</span><span id="fbbd" class="mu lq in mp b gy mz mw l mx my">}</span></pre><p id="f8d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了访问一个文件，我将调用目录句柄方法<code class="fe mm mn mo mp b">getFileHandle</code>。这将返回一个文件句柄。在调用这个函数时，我将把选项<code class="fe mm mn mo mp b">create</code>设置为真。这样，如果文件不存在，API 将创建该文件。为了访问实际的数据，我将从我返回的文件句柄中调用方法<code class="fe mm mn mo mp b">getFile</code>。这将返回一个类型为<code class="fe mm mn mo mp b">File</code>的对象。如果我打开的文件是基于文本的，我可以调用方法<code class="fe mm mn mo mp b">text</code>来检索文件数据的字符串表示。如果文件为空或不存在，将返回一个空字符串。以下是执行此操作的代码:</p><pre class="kd ke kf kg gt mq mp mr ms aw mt bi"><span id="596b" class="mu lq in mp b gy mv mw l mx my">const file = await dirHandle.getFileHandle("config.json", {<br/>       create: true<br/>})</span><span id="6730" class="mu lq in mp b gy mz mw l mx my">fileData = await file.getFile();</span><span id="25c1" class="mu lq in mp b gy mz mw l mx my">let text = await fileData.text()</span><span id="c8b5" class="mu lq in mp b gy mz mw l mx my">alert(text)</span></pre><p id="5ba5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的代码将从前面选择的目录中加载一个名为<code class="fe mm mn mo mp b">config.json</code>的文件。现在，如何将数据写入文件系统呢？</p><h1 id="a8c7" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">写入数据</h1><p id="b4b2" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">为了写数据，我将首先调用我的目录句柄上的<code class="fe mm mn mo mp b">getFileHandle</code>方法。我将通过调用文件句柄方法<code class="fe mm mn mo mp b">createWritable</code>来创建我的文件的可写流。写入流的数据将存储到基础文件中。下面是将 JSON 字符串写入文件的代码块:</p><pre class="kd ke kf kg gt mq mp mr ms aw mt bi"><span id="9a01" class="mu lq in mp b gy mv mw l mx my">const file = await dirHandle.getFileHandle("config.json", {<br/>       create: true<br/>})</span><span id="476a" class="mu lq in mp b gy mz mw l mx my">const sampleConfig = JSON.stringify({<br/>     prop1 : true,<br/>     prop2 : "Very cool key"<br/>})</span><span id="b0ad" class="mu lq in mp b gy mz mw l mx my">const blob = new Blob([sampleConfig])</span><span id="5914" class="mu lq in mp b gy mz mw l mx my">const writableStream = await file.createWritable();</span><span id="d268" class="mu lq in mp b gy mz mw l mx my">// write our file<br/>await writableStream.write(blob);</span><span id="ea47" class="mu lq in mp b gy mz mw l mx my">// close the file and write the contents to disk.<br/>await writableStream.close();</span></pre><h1 id="d15b" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="f660" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在写这篇文章的时候，我发现了 API 的一些局限性。访问文件系统需要用户启动该过程。这意味着最终用户必须通过点击来调用访问文件系统的函数。如果不这样做，将导致引发异常。该 API 在没有 SSL 的网站上无法工作。这是出于显而易见的原因。但是，它可以通过本地主机访问网站。点击下面的链接，你可以了解更多关于文件系统访问 API 的信息。</p><h1 id="5aae" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">其他来源:</h1><div class="na nb gp gr nc nd"><a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">文件系统访问 API-Web API | MDN</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">该 API 允许与用户本地设备上的文件或用户可访问的网络文件系统上的文件进行交互。核心…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">developer.mozilla.org</p></div></div><div class="nm l"><div class="nn l no np nq nm nr km nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://github.com/cheikhshift/medium_examples/tree/main/jsfs" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">medium _ examples/JSF at main cheikh shift/medium _ examples</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">中型文章的代码示例。在 GitHub 上创建一个帐户，为 cheikhshift/medium_examples 开发做贡献。</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="ns l no np nq nm nr km nd"/></div></div></a></div></div></div>    
</body>
</html>