<html>
<head>
<title>Connecting docker to mysql</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 docker 连接到 mysql</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connecting-docker-to-mysql-1c22d35fac2d?source=collection_archive---------6-----------------------#2022-04-04">https://blog.devgenius.io/connecting-docker-to-mysql-1c22d35fac2d?source=collection_archive---------6-----------------------#2022-04-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/0dc4aeecf78ea2e84f27d4064fde9f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*BAUCM3-zfzAVpj02lJSxkg.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">图片来自<a class="ae jv" href="https://betterprogramming.pub/customize-your-mysql-database-in-docker-723ffd59d8fb" rel="noopener ugc nofollow" target="_blank"> better programming.pub </a></figcaption></figure><p id="7111" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">您已经将您的应用程序容器化，并且您想知道如何将它链接到 mysql 数据库，无论是在本地还是在某个远程服务器上。放松，不必担心，这个简单的指南会对你有帮助的。</p><p id="5690" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">假设您已经安装了 mysql，您将需要对用户配置和数据库访问权限进行一些调整。默认情况下，MySQL 被配置为只监听本地连接，因此需要做一些调整。</p><p id="d4da" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">有两种情况需要通过 IP 地址将 docker 容器连接到 MySQL:<br/><br/>*<strong class="jy io"><em class="ku">远程连接</em> </strong>:数据库托管在另一台机器上<br/> * <strong class="jy io"> <em class="ku">本地连接</em> </strong>:数据库托管在托管 docker 系统的同一台机器上。</p><p id="212f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">N/B:需要注意的是，对于上述两种情况，您都需要使用托管数据库的机器的 IP 地址。<br/> <br/>嗯，您可能想知道为什么场景 2 需要一个外部 IP 地址，然而 docker 容器运行在托管 mysql 数据库的同一台机器上。原因是 docker 容器总是被视为某种机器，因此，它被分配了一个不同于主机 IP 地址的地址(<strong class="jy io"> <em class="ku"> 172.17.0.2 </em> </strong>)。<br/> <br/> <strong class="jy io"> 1。配置 mysql 监听外部 IP 地址。</strong></p><p id="52a1" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">第一步:打开 mysqld.cnf</p><p id="5b8f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">导航到/etc/mysql/mysql.conf.d 检查名为 mysql.cnf 或 mysqld.cnf 的文件，并使用 nano 编辑器打开它。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="6b4f" class="le lf in la b gy lg lh l li lj">sudo nano /etc/mysql/mysql.conf.d/mysql.cnf</span></pre><p id="22b3" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第二步:检查具有<em class="ku">bind-address = 127 . 0 . 0 . 1</em></strong><br/>默认值<strong class="jy io"> <em class="ku"> 127.0.0.1 </em> </strong>表示 mysql 将只监听本地连接。因此，为了打开外部地址，我们将该行改为<strong class="jy io"><em class="ku">【bind-address = 0 . 0 . 0 . 0</em></strong>。保存更改，然后退出 nano 编辑器。<br/> N/B:有时<strong class="jy io"><em class="ku">bind-address = 127 . 0 . 0 . 1</em></strong>可能不在 mysqld.cnf 中，在这种情况下，只需在底部添加一行即可(本例中 _bind-address = 0.0.0.0)。</p><p id="ca57" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第三步:你可能还需要打开防火墙的 3306 端口。</strong></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="1e0a" class="le lf in la b gy lg lh l li lj">sudo ufw allow 3306</span></pre><p id="785d" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第四步:重启 mysql </strong></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ce36" class="le lf in la b gy lg lh l li lj">sudo systemctl restart mysql</span></pre><p id="1066" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤 5:创建一个用户，您将使用该用户从 docker 容器(被视为“远程服务器”)连接到主机上的 mysql。</strong></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="c276" class="le lf in la b gy lg lh l li lj">mysql&gt; CREATE USER 'somename'@'docker_container_ip' IDENTIFIED BY 'password';</span></pre><p id="d527" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">注意:使用*hostname -i*检查 docker 容器的 ip 地址</p><p id="5c67" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第 6 步:根据需要授予用户/帐户权限。</strong></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="f9e2" class="le lf in la b gy lg lh l li lj">mysql&gt; GRANT CREATE, ALTER, INSERT, UPDATE, SELECT on *.* TO 'somename'@'docker_ip_address' WITH GRANT OPTION;</span></pre><p id="5001" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤 7:使用*FLUSH PRIVILEGES*命令释放缓存内存，然后退出 mysql </strong></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="3993" class="le lf in la b gy lg lh l li lj">mysql&gt; FLUSH PRIVILEGES;</span><span id="d0f6" class="le lf in la b gy lk lh l li lj">mysql&gt; exit;</span></pre><p id="08a3" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> 2。现在让我们回到我们的代码。在您连接到 mysql 数据库的地方，使用您的凭证如下:</strong> <br/> N/B:记得根据您的凭证替换详细信息。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ef67" class="le lf in la b gy lg lh l li lj">myconnection &lt;- dbPool(drv = RMySQL::MySQL(),<br/>                         dbname = "yourdb",<br/>                         host = "host_machine_ip_address", <br/>                         username = "somename", # This is the user #that we created in mysql (somename)<br/>                         password = "thepasswordyouassigned")</span></pre><p id="867f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> 3。从 docker 文件构建您的 docker 映像，然后运行它并转到</strong><a class="ae jv" href="http://127.0.0.1:3838" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">http://127 . 0 . 0 . 1:3838</strong></a><strong class="jy io">查看您的应用程序。</strong> <br/> <br/>没错！！！我们是一伙的！！</p></div></div>    
</body>
</html>