# Laravel æ•°æ®é©±åŠ¨ç­–ç•¥#1:åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½® A/B æµ‹è¯•

> åŸæ–‡ï¼š<https://blog.devgenius.io/laravel-data-driven-strategies-1-setup-a-b-testing-in-your-application-83eebf3a9499?source=collection_archive---------1----------------------->

![](img/f2b8ac6f8691c130b55c145689f4a395.png)

[è¥¿æ ¼è’™å¾·](https://unsplash.com/@sigmund?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹ç…§

> å¹³é¢è®¾è®¡å¸ˆ:â€œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å»ºç«‹äº†é«˜åº¦äº’åŠ¨çš„ UXï¼Œæˆ‘ä»¬ä¸“æ³¨äºä¸ºä¸€ä¸ªç®€å•çš„ä¸œè¥¿å–ä¸€ä¸ªå¥‡å¦™çš„åå­—ï¼Œè®©å®ƒå˜å¾—æ¼‚äº®ï¼Œæœ‰ååº”ï¼Œæœ‰å¸å¼•åŠ›ã€‚â€æˆ‘èŠ±äº† 4 ä¸ªå°æ—¶å®ç°å®ƒï¼Œå¹¶çœ‹åˆ°ç”¨æˆ·å¦‚ä½•ä½¿ç”¨å®ƒ:â€œé‚£ä¹ˆä¸ºä»€ä¹ˆæ²¡äººç†è§£å®ƒï¼Ÿâ€

æˆ‘ä¸çŸ¥é“ä½ æ˜¯å¦æœ‰è¿‡è¿™æ ·çš„å¯¹è¯ï¼Œä½†æ¥ä¸‹æ¥çš„ç¬¬ä¸€ååº”å°±åƒâš¡ğŸ¯ğŸ’£ğŸ’¥çªç„¶æœ‰äººå‡ºç°ï¼Œè¯´ä»–ä¹Ÿè®¾è®¡äº†ä¸€ä¸ªæ›¿ä»£ç‰ˆæœ¬ï¼Œä½†ç”±äºæŸäº›åŸå› è¢«æ‹’ç»ã€‚å®ç°æŸä¸ªä¸œè¥¿çš„å¤šä¸ªç‰ˆæœ¬éœ€è¦é’±ï¼Œä½†æ˜¯å¦‚æœæŸä¸ªä¸œè¥¿ä¸èƒ½åƒé¢„æœŸçš„é‚£æ ·å·¥ä½œï¼Œé‚£ä¹ˆå®ƒçš„æˆæœ¬ä¼šæ¯”ç¬¬äºŒä¸ªå®ç°çš„æˆæœ¬æ›´é«˜ã€‚

å¯¹äºä¸€ä¸ª IT é¡¹ç›®æ¥è¯´ï¼Œäº†è§£æŸä»¶äº‹æƒ…å¦‚ä½•è¿ä½œä»¥åŠæ˜¯å¦è¿ä½œçš„æœ€ä½³æ–¹å¼æ˜¯è®¾ç½®ä¸€äº› **KPI** ï¼Œå¯¹äºé‚£äº›ç¬¬ä¸€æ¬¡å¬åˆ°è¿™ä¸ªçš„äººæ¥è¯´ï¼ŒKPI ä»£è¡¨*å…³é”®ç»©æ•ˆæŒ‡æ ‡*ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªæ‚¨æƒ³è¦è·Ÿè¸ªä»¥æ£€æŸ¥ç‰¹å®šä¸œè¥¿çš„ç»©æ•ˆçš„æŒ‡æ ‡(ä¾‹å¦‚ï¼Œåœ¨è¥é”€åˆä½œä¹‹åï¼Œæ‚¨å¯èƒ½æƒ³è¦è·Ÿè¸ªæŸä¸ªæ—¶é—´èŒƒå›´å†…çš„é”€å”®å¢é•¿)ã€‚å¯¹äºå›¾å½¢ç»„ä»¶ï¼ŒKPI å¯ä»¥è®¾ç½®åœ¨ç‰¹å®šçš„å­ç»„ä»¶ä¸Šï¼Œå¦‚æŒ‰é’®ã€å¯ç‚¹å‡»æˆ–å¯èšç„¦çš„å­ç»„ä»¶ï¼Œä½†å®ƒä»¬åªæ˜¯æµ‹é‡äº¤äº’ï¼Œå¯ä»¥ä¸æ€»è®¿é—®é‡è¿›è¡Œæ¯”è¾ƒï¼›å¦‚æœæ‚¨æœ‰åŒä¸€ä¸ªç»„ä»¶çš„å¤šä¸ªå®ç°ï¼Œå¹¶ä¸”æƒ³è¦æ£€æŸ¥å“ªä¸ªæ‰§è¡Œå¾—æ›´å¥½ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ **A/B æµ‹è¯•**ã€‚

**A/B æµ‹è¯•**æ˜¯ä¸€ç§æµ‹è¯•ï¼Œåœ¨è¿™ç§æµ‹è¯•ä¸­ï¼Œä½ å®é™…ä¸Šå°†ä½ çš„è§‚ä¼—åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå‘ä»–ä»¬æ¨èä¸åŒç‰ˆæœ¬çš„å†…å®¹:å¦‚æœä½ æœ‰ä¸¤ä¸ªè§†å›¾å®ç°ï¼Œé€šè¿‡ A/B æµ‹è¯•ï¼Œä½ å¯ä»¥å‘ 50%çš„è§‚ä¼—æ¨èç‰ˆæœ¬ Aï¼Œå‘å¦å¤– 50%çš„è§‚ä¼—æ¨èç‰ˆæœ¬ Bï¼Œç„¶åæµ‹é‡æ¯ä¸ªç‰ˆæœ¬çš„ KPIï¼Œè¿™æ ·ä½ å°±å¾—åˆ°äº†è·èƒœçš„ç‰ˆæœ¬ï¼(æˆ–è€…åœ¨éå¸¸ç½•è§çš„æƒ…å†µä¸‹æ‰“æˆå¹³æ‰‹ã€‚)

# è®¾ç½®

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦ç¼–å†™è‡ªå·±çš„ a/b æµ‹è¯•å¼•æ“ï¼Œæ‚¨å¯ä»¥åšæŒä½¿ç”¨ç°æœ‰çš„å¼•æ“ï¼Œè®¾ç½®å¥½å®ƒå¹¶ä¸“æ³¨äºæ‚¨çš„ä¸šåŠ¡é€»è¾‘å®ç°ã€‚å¯¹äº Laravel åº”ç”¨ç¨‹åºï¼Œ`ben182/laravel-ab`åŒ…è®©ä½ åœ¨å‡ åˆ†é’Ÿå†…å‡†å¤‡å¥½ï¼Œä½ å¯ä»¥åœ¨ [Github](https://github.com/ben182/laravel-ab) ä¸Šæ‰¾åˆ°å®ƒã€‚é€šè¿‡ composer `composer require ben182/laravel-ab`å®‰è£…æ˜¯ä¸€ä¸ªç›´æ¥çš„è¿‡ç¨‹ï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½äº†ã€‚

![](img/973427bba277d35204c1ec3e15801e50.png)

A/B æµ‹è¯•åŒ…å®‰è£…

è¯·æ³¨æ„ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ‚¨ä¸èƒ½ç¼–å†™æ‚¨è‡ªå·±çš„ a/b æµ‹è¯•ä»£ç :å¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªå…·æœ‰è®¸å¤šæ–¹é¢çš„è‡ªå®šä¹‰æ¼æ–—ï¼Œå¹¶ä¸”è¿™ä¸ªåŒ…ä¸èƒ½æ»¡è¶³æ‚¨çš„é‡å¿ƒï¼Œæ‚¨å¯ä»¥éšæ—¶å®ç°æ‚¨çš„è‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆï¼

æ­£ç¡®å®‰è£…è½¯ä»¶åŒ…åï¼Œæˆ‘ä»¬åªéœ€å‘å¸ƒé…ç½®å¹¶è¿ç§»å®ƒï¼

```
php artisan vendor:publish --provider="Ben182\AbTesting\AbTestingServiceProvider"
```

è¿™å°†å‘å¸ƒé…ç½®æ–‡ä»¶`config/ab-testing.php`ä»¥ä¾¿ç¨åè°ƒæ•´ã€‚ä¹‹åï¼Œæ‚¨åªéœ€`php artisan migrate`ï¼Œè¿™å°†å‘å¸ƒä¸¤ä¸ªé¢„æœŸçš„è¡¨:

```
**Migrating**: 2019_02_02_200315_create_experiments_table
**Migrated**:  2019_02_02_200315_create_experiments_table (0.01 seconds)
**Migrating**: 2019_02_02_213123_create_goals_table
**Migrated**:  2019_02_02_213123_create_goals_table (0.01 seconds)
```

# åˆè¯•:A è¿˜æ˜¯ Bï¼Ÿ

ç®€å•æ¥è¯´:æ‚¨æƒ³åœ¨ç´¢å¼•è·¯å¾„ä¸­æµ‹è¯•ä¸€ä¸ªæ–‡æœ¬å’Œä¸€ä¸ªæŒ‰é’®æ ·å¼ã€‚ä¸ºäº†ä½¿*æœ‰åˆ›é€ æ€§*ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„æµ‹è¯•å‘½åä¸º`blue-button`å’Œ`purple-button`ã€‚è¦å¼€å§‹è¿™äº›æµ‹è¯•ï¼Œåªéœ€æ‰“å¼€é…ç½®æ–‡ä»¶å¹¶å°†æµ‹è¯•åç§°æ·»åŠ åˆ°å®éªŒæ•°ç»„ä¸­:

```
return [
    'experiments' => [
        **'blue-button',
        'purple-button',**
    ],
    // ...
];
```

ç°åœ¨åªå…³æ³¨å†…å®¹ï¼Œä½†æ˜¯æ€ä¹ˆåšå‘¢ï¼Ÿå¯¹äºè§†å›¾éƒ¨åˆ†ï¼Œæœ‰ä¸€ä¸ª`@ab`å·¥å…·å¯ä»¥è®©ä½ åœ¨æµ‹è¯•ä¹‹é—´åˆ‡æ¢ã€‚

```
**@ab('blue-button')**<div class="title m-b-md">
    This is the blue button test.
</div>
<a href="{!! url('/specialPage') !!}" class="blue-button">
    Blue test
</a>**@elseab('purple-button')**<div class="title m-b-md">
    This is the purple button test.
</div>
<a href="{!! url('/specialPage') !!}" class="purple-button">
    Purple test
</a>**@endab**
```

å°±æ˜¯è¿™æ ·ï¼Œå®ƒçœŸçš„å¾ˆç®€å•ï¼Œä½ çœŸçš„å¯ä»¥åœ¨ä½ çš„åˆ€ç‰‡æ–‡ä»¶çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚è¿™æ ·ï¼Œæ­£å¦‚ä½ åœ¨ä¸‹é¢çœ‹åˆ°çš„ï¼Œå½“ä½ æ‰“å¼€é¡µé¢æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ä¸åŒçš„å†…å®¹ï¼Œå®éªŒç”¨æˆ·çš„åˆ†å¸ƒæ˜¯å¹³å‡åˆ†å¸ƒçš„ã€‚

![](img/5b4bb4b86ded211096617efb93c4bda1.png)

a è¿˜æ˜¯ Bï¼Ÿ

è¿è¡Œå‘½ä»¤`php artisan ab:report`å¯ä»¥çœ‹åˆ°æ¯ä¸ªå®éªŒä¸­æœ‰å¤šå°‘ç”¨æˆ·ç™»é™†ã€‚

```
$ php-fpm php artisan ab:report
+---------------+----------+
| **Experiment** | **Visitors** |
+---------------+----------+
| **blue-button**   | **1**        |
| **purple-button** | **1**        |
+---------------+----------+
```

å¦‚æœä½ æƒ³ä»”ç»†çœ‹çœ‹`@ab`å®ç”¨ç¨‹åºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå‡è®¾

```
@if (AbTesting::isExperiment('your-experiment-name'))
```

è¿™ä¸ªå·¥å…·è¢«å®ç°åˆ°æœåŠ¡æä¾›å•†ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥æ·±å…¥åˆ° Github çš„æ’ä»¶æºä»£ç ä¸­ã€‚

# å¼€å§‹æµ‹é‡

ä¸€èˆ¬æ¥è¯´ï¼Œa/b æµ‹è¯•çš„ç›®çš„æ˜¯æµ‹é‡ä¸åŒè§†å›¾ä¹‹é—´å“ªä¸€ä¸ªå¯ä»¥å¯¼è‡´æ›´å¥½çš„*è½¬æ¢*ã€‚

ä¸ºäº†å¼€å§‹æµ‹é‡è½¬åŒ–ç‡ï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾å®šç›®æ ‡ã€‚ä¸€ä¸ªç®€å•çš„ç›®æ ‡å¯ä»¥æ˜¯ç”¨æˆ·é€šè¿‡æˆ‘ä»¬çš„æŒ‰é’®è®¿é—®ã€‚

```
'goals' => [
    '**page-visited**'
],
```

å‘½ä»¤`php artisan ab:report`å°†è®©ä½ çœ‹åˆ°ä½ é€šè¿‡æ¯ä¸ªå®éªŒè¾¾åˆ°äº†å¤šå°‘è½¬æ¢ã€‚

```
$ php-fpm php artisan ab:report
+---------------+----------+-------------------+
| Experiment    | Visitors | **Goal page-visited** |
+---------------+----------+-------------------+
| blue-button   | 1        | **0 (0%)** |
| purple-button | 1        | **0 (0%)** |
+---------------+----------+-------------------+
```

è¦è·Ÿè¸ªä¸€ä¸ªè½¬æ¢ï¼Œæ ¹æ®ä½ çš„æ¡ä»¶ï¼Œä½ åªéœ€è¦æ·»åŠ 

```
AbTesting::completeGoal('**your-goal-name**');
```

åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œå½“ç‚¹å‡»æŒ‰é’®å¹¶åŠ è½½é¡µé¢æ—¶ï¼Œç›®æ ‡å°±å®Œæˆäº†ã€‚é¡µé¢ä»£ç å°†éå¸¸ç®€å•ï¼Œå®ƒå°†è§¦å‘ç›®æ ‡å®Œæˆ:

```
***AbTesting*::completeGoal('page-visited');**
return view('completed');
```

![](img/38ee08d71c7480a4dcca4da5cdbe2b0b.png)

A/B æµ‹è¯•ç¤ºä¾‹ç›®æ ‡

è¦æ£€æŸ¥è¾¾åˆ°çš„ç›®æ ‡ç»Ÿè®¡æ•°æ®ï¼Œæ‚¨å¯ä»¥å†æ¬¡è¿è¡Œ`php artisan ab:report`ã€‚

```
+---------------+----------+-------------------+
| Experiment    | Visitors | **Goal page-visited** |
+---------------+----------+-------------------+
| blue-button   | 1        | **0 (0%)** |
| **purple-button** | **1** | **1 (100%)** |
+---------------+----------+-------------------+
```

å°±æ˜¯è¿™æ ·ï¼Œç”¨è¿™ä¸ªæ¥è¡¡é‡å’Œæ”¹è¿›ä½ çš„é¡¹ç›®ï¼Œä¸€æ¬¡ä¸€ä¸ªç»Ÿè®¡æ•°æ®ï¼

è¯·ç»§ç»­å…³æ³¨å…¶ä»–æ•°æ®é©±åŠ¨çš„ç­–ç•¥ï¼Œå¦‚æœä½ æ„¿æ„ï¼ŒèŠ±ä¸€ç‚¹æ—¶é—´ï¸ï¸to ç•™ä¸‹è¯„è®ºï¼Œè°ˆè°ˆä½ å¦‚ä½•åšå‡ºç”±å·¥å…·æ”¯æŒçš„æ•°æ®é©±åŠ¨çš„å†³ç­–ï¼â˜•ï¸

# åŒ…æ•°æ®åº“ç»“æ„

å¦‚æœæ‚¨æƒ³åœ¨è‡ªå®šä¹‰é¡µé¢ä¸­é›†æˆè¿™äº›ç»Ÿè®¡æ•°æ®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè®©æˆ‘ä»¬æ·±å…¥æ•°æ®åº“ç»“æ„ã€‚è¯¥åŒ…ç”±ä¸¤ä¸ªå·¥ä½œå°`ab_experiments`å’Œ`ab_goals`ç»„æˆï¼Œå¯¹åº”å‹å·ä¸º`Goal`å’Œ`Experiment`ã€‚

`ab_experiments`è¡¨ç»“æ„:

```
+------------+------------------+------+-----+----------------+
| Field      | Type             | Null | Key | Extra          |
+------------+------------------+------+-----+----------------+
| id         | int(10) unsigned | NO   | PRI | auto_increment |
| name       | varchar(255)     | NO   | UNI |                |
| visitors   | int(11)          | NO   |     |                |
| created_at | timestamp        | YES  |     |                |
| updated_at | timestamp        | YES  |     |                |
+------------+------------------+------+-----+----------------+
```

`ab_goals`è¡¨æ ¼ç»“æ„:

```
+---------------+------------------+------+-----+----------------+
| Field         | Type             | Null | Key | Extra          |
+---------------+------------------+------+-----+----------------+
| id            | int(10) unsigned | NO   | PRI | auto_increment |
| name          | varchar(255)     | NO   |     |                |
| hit           | int(11)          | NO   |     |                |
| experiment_id | int(11)          | NO   |     |                |
| created_at    | timestamp        | YES  |     |                |
| updated_at    | timestamp        | YES  |     |                |
+---------------+------------------+------+-----+----------------+
```

æ‚¨å¯ä»¥ä»å…¶åç§°ç©ºé—´`Ben182\AbTesting\Models.`å¯¼å…¥ç›¸å…³æ¨¡å‹

ä½¿ç”¨æ¨¡å‹`Experiment`è®©ä½ è®¿é—®æ‰€æœ‰çš„å®éªŒæ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡`goals`å±æ€§è·å¾—ç›®æ ‡æ•°æ®(é€šè¿‡ Laravel *hasMany* å®ç°)ã€‚

ä½¿ç”¨æ¨¡å‹`Goal`è®©ä½ è®¿é—®æ‰€æœ‰çš„ç›®æ ‡æ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡`experiment`å±æ€§ç›´æ¥è®¿é—®å®ƒçš„å®éªŒ(é€šè¿‡ä¸‹é¢çš„ Laravel *å®ç°)ã€‚*

æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³å¾—åˆ°ç´«è‰²æŒ‰é’®å®éªŒï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†çš„é›„è¾©æŸ¥è¯¢

```
$purpleExperiment = Experiment::whereName('purple-button')->first();
```

æŠŠå®ƒçš„ç›®æ ‡æ”¾åœ¨æ¥è¿‘å®ƒä»¬çš„åœ°æ–¹

```
$purpleExperiments->goals
```

é€šè¿‡ä½¿ç”¨åŒ…æ¨¡å‹ï¼Œæ‚¨å¯ä»¥åœ¨è‡ªå®šä¹‰é¡µé¢ä¸­æ˜¾ç¤ºæ‚¨æƒ³è¦çš„æ¯ä¸ªç»Ÿè®¡æ•°æ®ï¼