<html>
<head>
<title>Generating different spatial patterns in R and their visualization using ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 ggplot2 在 R 中生成不同的空间模式及其可视化</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/generating-different-spatial-patterns-in-r-and-their-visualization-using-ggplot2-596868f4066e?source=collection_archive---------7-----------------------#2022-09-17">https://blog.devgenius.io/generating-different-spatial-patterns-in-r-and-their-visualization-using-ggplot2-596868f4066e?source=collection_archive---------7-----------------------#2022-09-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1eabd199b7831d8394fedf43a6cd291d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSvBJ5B1nHTlaTUXgYX3Nw.png"/></div></div></figure><p id="24b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">空间格局是个体实体在空间中的排列以及它们之间的地理关系。识别空间模式是理解现象分布背后的复杂空间过程的先决条件。没有视觉化，这种理解是模糊的。</p><p id="1712" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">空间模式可以帮助理解在空间和时间中发生的现象的行为。例如，空间模式可以帮助我们查明疾病爆发的源头(热点)，跟踪流行病的传播，有效地分配资源，风险监控和城市规划，等等。</p><p id="bafc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">空间模式可能因情况而异。我们现在有大量的资源和分析工具来分析和可视化空间数据，以获得可靠和有效决策的洞察力。然而，我们没有太多的资源来生成假设用于采样和教学目的的模式。</p><p id="e95b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇博文中，我将使用 R 中的 matrix 等基本特性来生成不同的模式，然后使用<code class="fe kt ku kv kw b">ggplot2</code>包来可视化这些模式。这些示例有助于设计采样方案，并对学生进行空间数据及其分析方面的教育。</p><h1 id="1819" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">加载库</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="06a2" class="md ky in kw b gy me mf l mg mh"><strong class="kw io">library</strong>(tidyverse)<br/><strong class="kw io">library</strong>(reshape2)</span></pre><p id="147a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我将使用<code class="fe kt ku kv kw b">matrix</code>函数创建一个空矩阵，并将其可视化。</p><h1 id="4fff" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">空矩阵</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="1662" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 4x4 matrix</em><br/>m &lt;- matrix(nrow = 4, ncol = 4, byrow=TRUE)</span><span id="b367" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1, label = "NA")) +<br/>  geom_tile(color = "black", fill = NA, size = 1) + <br/>  geom_text() +<br/>  theme_void() +<br/>  theme(legend.position = "none")</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/d77a9f167e265eba2e9cc414b705de6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zeQGUC8bVenJFs7s.png"/></div></div></figure><h1 id="12e6" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">用值填充矩阵</h1><p id="e3f3" class="pw-post-body-paragraph jv jw in jx b jy ml ka kb kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks ig bi translated">现在，我将用零填充这个矩阵。</p><h1 id="f698" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">零</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="dbd7" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 4x4 matrix with zeros</em><br/>m &lt;- matrix(0, nrow = 4, ncol = 4, byrow=TRUE)</span><span id="bc4f" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1, label = value)) +<br/>  geom_tile(color = "black", fill = NA, size = 1) + <br/>  geom_text() +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/b413b24fa531edcc0e51cc9eaac0e11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_-I1Z3bDZUxQRDqx.png"/></div></div></figure><p id="c50c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我将添加这些来生成一些模式。</p><h1 id="63f0" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">零和一</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="63e4" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 4x4 matrix with zeros and ones</em><br/>m &lt;- matrix(0:1, nrow = 4, ncol = 4, byrow=TRUE)</span><span id="f11a" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1, fill = factor(value), label = value)) +<br/>  geom_tile(color = "black", size = 1) +<br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  geom_text() +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/086a096516d2858cf5e2edebd0d46173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fHQsI_W0rIiAz92j.png"/></div></div></figure><p id="df2a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我将添加这些来生成一些模式。</p><h1 id="56e7" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">每一列都有不同的数字</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="cbfa" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 4x4 matrix with distinct columns</em><br/>m &lt;- matrix(0:3, nrow = 4, ncol = 4, byrow=TRUE)</span><span id="d459" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1, fill = factor(value), label = value)) +<br/>  geom_tile(color = "black", size = 1) + <br/>  scale_fill_brewer(palette = "Accent") +<br/>  geom_text() +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/afe265cb9aa60cde18f176145b158d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Oioo1D-QzNtu72oa.png"/></div></div></figure><p id="efa6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过使用相同的方法，我现在将生成一个随机模式。<strong class="jx io">提示:</strong>如果我们将填充值的范围(这里是 0:5)增加到矩阵的维数，<code class="fe kt ku kv kw b">matrix</code>函数将随机排列数字来填充矩阵。你可以扩大范围，看看格局如何变化。</p><h1 id="aa29" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">无规图样</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="3d8c" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 4x4 matrix with randomly generated number (0:5)</em><br/>m &lt;- matrix(0:5, nrow = 4, ncol = 4, byrow=TRUE)</span><span id="a655" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1, fill = factor(value), label = value)) +<br/>  geom_tile(color = "black", size = 1) +<br/>  scale_fill_brewer(palette = "Set3") +<br/>  geom_text() +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/10bbc4a7479a8eb5e75e1c3c44d473a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u9ftqgYOFH2Fs3p7.png"/></div></div></figure><h1 id="a87e" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">二项式模式</h1><p id="4130" class="pw-post-body-paragraph jv jw in jx b jy ml ka kb kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks ig bi translated">像前面的矩阵一样，我们也可以在 R 中生成一个二项式矩阵来表示二项式模式，即是或否和 0 或 1。为此，我们可以使用<code class="fe kt ku kv kw b">rbinom</code>函数以随机模式生成 0 和 1 值。</p><h1 id="7fc0" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">无规图样</h1><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="ee33" class="md ky in kw b gy me mf l mg mh">set.seed(1)</span><span id="2005" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># 6x6 matrix with randomly generated numbers (0 and 1)</em><br/>m &lt;- matrix(rbinom(36, 1, 0.3), nrow = 6)</span><span id="5e35" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = factor(value)), color = "black", size = 1) + <br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/5eeab6f7ec7c48b204669f1530976228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pb0X9Ykwp7W2klzu.png"/></div></div></figure><p id="3e61" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在最后一个矩阵中，我用概率(<em class="mi"> p </em> = 0.3)生成一个 0 和 1 的随机序列。然而，我们也可以编写一个函数来使用不同的概率生成随机模式，然后可视化它们，以查看随机模式如何随着不同的概率而变化。</p><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="d504" class="md ky in kw b gy me mf l mg mh">pp &lt;- list()</span><span id="13ea" class="md ky in kw b gy mj mf l mg mh"><strong class="kw io">for</strong> (i <strong class="kw io">in</strong> 2:7) {<br/>m &lt;- matrix(rbinom(36, 1, i/10), nrow = 6)</span><span id="9247" class="md ky in kw b gy mj mf l mg mh">data = melt(m)</span><span id="6103" class="md ky in kw b gy mj mf l mg mh">pp[[i]]  &lt;- data |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = factor(value)), color = "black", size = 1) + <br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  labs(fill = NULL, subtitle = paste("p = ", i/10)) +<br/>  theme_void() +<br/>  theme(plot.subtitle = element_text(hjust = 0.5, face = "bold"))<br/>}</span><span id="436c" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># grid of plots</em><br/><strong class="kw io">library</strong>(patchwork)</span><span id="d5a0" class="md ky in kw b gy mj mf l mg mh">pp[[2]] + pp[[3]] + pp[[4]] + pp[[5]] + pp[[6]] + pp[[7]] + plot_layout(ncol = 3, guides = "collect")</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/09b3b63fe53d364d069cb90a8ec2b9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-h_uUYl3wgF-FnIy.png"/></div></div></figure><h1 id="d657" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">正空间自相关</h1><p id="c21a" class="pw-post-body-paragraph jv jw in jx b jy ml ka kb kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks ig bi translated">正空间自相关意味着变量的地理邻近值趋于相似，即高值趋于位于高值附近，低值趋于位于低值附近。我们可以使用下面的代码生成这个模式。</p><h2 id="3f12" class="md ky in bd kz mq mr dn ld ms mt dp lh kg mu mv ll kk mw mx lp ko my mz lt na bi translated">代码 1</h2><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="4a07" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 6x6 matrix </em><br/>m &lt;- matrix(nrow=6, ncol = 6, byrow=TRUE)</span><span id="8c2e" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># filling values in the matrix</em><br/>m[1:6, 1L:3L] = 1 <em class="mi"># rows 1 to 6 in columns 1 to 3 with 1</em><br/>m[1:6, 4L:6L] = 0 <em class="mi"># rows 1 to 6 in columns 4 to 6 with 0</em></span><span id="9b17" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = factor(value)), color = "black", size = 1) + <br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/094ea9102e83b7c4c81a6fa5cae621fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F0ARTI17V_0oTwLk.png"/></div></div></figure><h2 id="dec7" class="md ky in bd kz mq mr dn ld ms mt dp lh kg mu mv ll kk mw mx lp ko my mz lt na bi translated">代码 2</h2><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="45f0" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 6x6 matrix </em><br/>m &lt;- matrix(c(1, 1, 1, 0, 0, 0), nrow=6, ncol = 6, byrow=TRUE)</span><span id="2324" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = factor(value)), color = "black", size = 1) + <br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/b1b8d83c1bdc1c717390bdedf8f87cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IsgqgGRETQS6diph.png"/></div></div></figure><h1 id="a1fd" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">负空间自相关</h1><p id="6d86" class="pw-post-body-paragraph jv jw in jx b jy ml ka kb kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks ig bi translated">负空间自相关与正空间自相关相反，即不同的值在地图上聚集在一起。我们可以使用下面的代码生成这个模式。</p><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="8559" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 6x6 matrix </em><br/>m &lt;- matrix(nrow=6, ncol = 6, byrow=TRUE)</span><span id="6902" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># filling values in the matrix</em><br/>m[c(1, 3, 5), c(1L, 3L, 5L)] = 1<br/>m[c(2, 4, 6), c(2L, 4L, 6L)] = 1<br/>m[c(1, 3, 5), c(2L, 4L, 6L)] = 0<br/>m[c(2, 4, 6), c(1L, 3L, 5L)] = 0</span><span id="fd5e" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = factor(value)), color = "black", size = 1) + <br/>  scale_fill_manual(values = c("white", "orange")) +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/3cf5f1da26f4b7479ce6139f70be6c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eXsCpSU7kttd3KRj.png"/></div></div></figure><h1 id="aff6" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">热点模式</h1><p id="797d" class="pw-post-body-paragraph jv jw in jx b jy ml ka kb kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks ig bi translated">热点模式是另一种表示聚类的正空间自相关模式。我们可以使用下面的代码生成一个热点模式。</p><pre class="lv lw lx ly gt lz kw ma mb aw mc bi"><span id="e04f" class="md ky in kw b gy me mf l mg mh"><em class="mi"># 6x6 matrix </em><br/>m &lt;- matrix(nrow=11, ncol = 11, byrow=TRUE)</span><span id="f7ce" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># filling values in the matrix</em><br/>m[c(1:11), c(1L:11L)] = 0<br/>m[c(2:10), c(2L:10L)] = 1<br/>m[c(3:9), c(3L:9L)] = 2<br/>m[c(4:8), c(4L:8L)] = 3<br/>m[c(5:7), c(5L:7L)] = 4<br/>m[c(6), c(6L)] = 5</span><span id="03da" class="md ky in kw b gy mj mf l mg mh"><em class="mi"># matrix visualization</em><br/>melt(m) |&gt; <br/>  ggplot(aes(x = Var2, y = Var1)) +<br/>  geom_tile(aes(fill = value), color = "black", size = 1) + <br/>  scale_fill_viridis_c(option = "F", direction = -1) +<br/>  labs(fill = NULL) +<br/>  theme_void()</span></pre><figure class="lv lw lx ly gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/dcfb3e57898da1fcc2487d67f9e5feb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m8mA_1pCqmnvCIBp.png"/></div></div></figure><p id="04fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">就是这样！</strong></p><p id="fcb8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">如果你有任何问题，请随时联系我。</strong></p></div></div>    
</body>
</html>