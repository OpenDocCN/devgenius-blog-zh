<html>
<head>
<title>ShardingSphere 5.2.1 is released — Here are the highlights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ShardingSphere 5.2.1 发布了——以下是亮点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/shardingsphere-5-2-1-is-released-here-are-the-highlights-bab8c628f4b6?source=collection_archive---------7-----------------------#2022-10-25">https://blog.devgenius.io/shardingsphere-5-2-1-is-released-here-are-the-highlights-bab8c628f4b6?source=collection_archive---------7-----------------------#2022-10-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a9a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们新的 5.2.1 版本带来了新的功能和增强，如 ShardingSphere 系统数据库、SQL 提示强制分片路由、异步数据一致性检查以及对 Consul 和 Nacos 治理中心的支持。</p><h1 id="8fc1" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">介绍</h1><p id="cd85" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">经过 1.5 个月的开发，<a class="ae ll" href="https://shardingsphere.apache.org/" rel="noopener ugc nofollow" target="_blank">Apache sharding sphere</a>5 . 2 . 1 发布了。我们的社区合并了来自世界各地的团队和个人的 614 个 pr。<a class="ae ll" href="https://github.com/apache/shardingsphere/blob/master/RELEASE-NOTES.md" rel="noopener ugc nofollow" target="_blank">产生的 5.2.1 版本</a>在特性、性能、测试、文档、示例等方面进行了优化。</p><p id="ca34" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">新版本带来了以下亮点:</p><ul class=""><li id="f1b4" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated">ShardingSphere 系统数据库</li><li id="9af3" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">SQL 提示强制分片路由</li><li id="d6aa" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">异步数据一致性检查</li></ul><p id="7398" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">版本 5.2.1 引入了新的 ShardingSphere 系统数据库，为分布式数据库提供统计信息。统计信息可以帮助 SQL 联邦执行引擎评估执行成本，以选择成本最低的执行计划。此外，ShardingSphere 可以收集数据分片后的分布信息，为自动分片缩放管理提供参考。</p><p id="7949" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> SQL 提示是 ShardingSphere 5 提供的一个重要特性。x，利用它用户可以通过 SQL 注释灵活地控制路由。新版本增强了 SQL 提示功能，并支持数据分片强制路由。</strong></p><p id="9d91" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户只需在将分片值传输到 ShardingSphere 路由引擎之前添加格式为:<code class="fe ma mb mc md b">/* SHARDINGSPHERE_HINT: t_order.SHARDING_DATABASE_VALUE=1, t_order.SHARDING_TABLE_VALUE=1 */</code>的注释。与之前的 HintManager 方法相比，SQL HINT 更加灵活，不需要用户编写代码。</p><p id="14e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">新版本还增强了数据迁移期间的数据一致性检查能力，支持异步执行检查。用户可以通过</strong><a class="ae ll" href="https://medium.com/nerd-for-tech/intro-to-distsql-an-open-source-more-powerful-sql-bada4099211" rel="noopener"><strong class="jm io">DistSQL</strong></a><strong class="jm io">查看数据迁移进度，提高了数据迁移的便捷性。</strong></p><p id="9744" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">而且<strong class="jm io">治理中心现在支持 Consul 和 Nacos </strong>，为用户提供了更多的选择。SQL 兼容性大大提高。读/写分割也得到了优化，因为在禁用辅助数据库后，可以使用<code class="fe ma mb mc md b">-f</code>参数强制启动代理。</p><p id="e892" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，本帖将详细介绍 ShardingSphere 5.2.1 的更新。</p><h1 id="7567" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">显著亮点</h1><h2 id="2fc1" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">ShardingSphere 系统数据库</h2><p id="12d3" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">与<a class="ae ll" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>和<a class="ae ll" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>系统数据库一样，ShardingSphere 5.2.1 引入了新的系统数据库来管理数据库的元数据。</p><p id="8d69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ShardingSphere 系统数据库主要存储动态和静态元数据。动态元数据是指经常更新的数据，如来自分布式数据库的统计信息，需要通过内置的调度任务定期收集和维护。</p><p id="f4b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">相比之下，静态元数据指的是无需用户修改就能保持不变的数据。一个例子就是用户设置的 ShardingSphere 分布式数据库的 status 参数，只需要存储在元数据数据库中进行查询即可。</p><p id="46e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于该功能目前处于试验阶段，您需要通过以下配置开始收集元数据。</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="76e6" class="me kj in md b gy my mz l na nb">proxy-metadata-collector-enabled: true</span></pre><p id="3709" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过命令行连接代理，然后执行<code class="fe ma mb mc md b">SHOW DATABASES</code>语句。我们可以看到新的<code class="fe ma mb mc md b">shardingsphere</code>系统数据库，它存储了分布式数据库的元数据。</p><figure class="mq mr ms mt gt nd gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nc"><img src="../Images/33b6d88212f84b093970a902f05067f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mDWA2Dlp0m8AJXga"/></div></div></figure><p id="84d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">目前<code class="fe ma mb mc md b">shardingsphere</code>系统数据库中增加了<code class="fe ma mb mc md b">sharding_table_statistics</code>表，用于收集分片表的分布信息，包括<code class="fe ma mb mc md b">row_count</code>和<code class="fe ma mb mc md b">size</code>。</p><figure class="mq mr ms mt gt nd gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nc"><img src="../Images/6bd7dff4eab071a20dc251827f2ffda3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SBMpMIF2tXA_btvr"/></div></div></figure><p id="1b8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">ShardingSphere 系统数据库提供的统计信息可以帮助 SQL 联邦执行引擎评估执行成本。这允许选择合适的关联顺序和方法，并实现高效执行。</p><p id="4233" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，通过收集存储节点的数据分布信息和负载信息，ShardingSphere 可以进行自动分片缩放，降低用户的运维成本。</p><h2 id="2021" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">SQL 提示强制分片路由</h2><p id="39fe" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在一些特殊的业务场景中，用于分片的字段存在于外部业务逻辑中，而不是 SQL、数据库和表结构中。目前需要<code class="fe ma mb mc md b">Hint</code>引入分片键值来完成分片路由。</p><p id="a1aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 5.2.1 版本之前，<code class="fe ma mb mc md b">Hint</code>有两种使用方式。一种方法是通过 JDBC 接入端口中的 HintManager 来使用它，而另一种方法是在代理接入端口中启动<code class="fe ma mb mc md b">proxy-hint-enabled</code>参数。</p><p id="711b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在第一种情况下，用户需要编写代码来调用<code class="fe ma mb mc md b">addDatabaseShardingValue</code>和<code class="fe ma mb mc md b">addTableShardingValue</code>方法来设置数据库和表分片的值。但是，如果使用 HintManager 方法，用户必须以一定的代价修改原始逻辑。</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="2eeb" class="me kj in md b gy my mz l na nb"><em class="nk">// Sharding database and table with using HintManagerString sql = "SELECT * FROM t_order";</em><br/>try (HintManager hintManager = HintManager.getInstance();<br/>     Connection conn = dataSource.getConnection();<br/>     PreparedStatement preparedStatement = conn.prepareStatement(sql)) {<br/>    hintManager.addDatabaseShardingValue("t_order", 1);<br/>    hintManager.addTableShardingValue("t_order", 2);<br/>    try (ResultSet rs = preparedStatement.executeQuery()) {<br/>        while (rs.next()) {<br/>            <em class="nk">// ...        <br/>        }</em><br/>    }<br/>}</span></pre><p id="8160" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果是第二种情况，首先启动<code class="fe ma mb mc md b">proxy-hint-enabled</code>参数，然后通过下面的<a class="ae ll" href="https://shardingsphere.apache.org/document/5.1.0/en/concepts/distsql/" rel="noopener ugc nofollow" target="_blank"> DistSQL </a>配置清除分片值。</p><p id="208a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，基于提示的方法会将代理的线程处理模型从 IO 多路复用转换为每个请求一个独立的线程，这将降低代理的吞吐量。这意味着用户必须做出权衡。</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="a7a1" class="me kj in md b gy my mz l na nb"><em class="nk">-- For the current connection, add sharding values yy to table xx. xx: logical table name; yy: database sharding value</em><br/>ADD SHARDING HINT DATABASE_VALUE t_order= 100;</span><span id="9e23" class="me kj in md b gy nl mz l na nb"><em class="nk">-- For the current connection, add sharding values yy to table xx. xx: logical table name; yy: table sharding value</em><br/>ADD SHARDING HINT TABLE_VALUE t_order = 100;</span><span id="9aed" class="me kj in md b gy nl mz l na nb"><em class="nk">-- For the current connection, clear sharding hint settings</em><br/>CLEAR SHARDING HINT;</span></pre><p id="9c5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于这两种方法都存在问题，5.2.1 版增加了 SQL 提示强制分片路由功能。这允许用户通过 SQL 注释灵活地控制路由。不需要修改原始代码的逻辑，代理访问端口中的线程处理模型不受影响。</p><p id="2ac5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在使用 SQL 提示强制分片路由之前，用户应该提前启用解析注释的配置，并将<code class="fe ma mb mc md b">sqlCommentParseEnabled</code>设置为<code class="fe ma mb mc md b">true</code>。注释格式只支持<code class="fe ma mb mc md b">/* */</code>，内容必须以<code class="fe ma mb mc md b">SHARDINGSPHERE_HINT:</code>开头。</p><p id="e6fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可选属性包括:</p><ul class=""><li id="af65" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated"><code class="fe ma mb mc md b">{table}.SHARDING_DATABASE_VALUE</code>:用于添加<code class="fe ma mb mc md b">{table}</code>对应的数据源分片键值。多个属性由逗号分隔。</li><li id="d9a4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><code class="fe ma mb mc md b">{table}.SHARDING_TABLE_VALUE</code>:用于添加<code class="fe ma mb mc md b">{table}</code>对应的表格分片键值。多个属性由逗号分隔。</li></ul><blockquote class="nm nn no"><p id="dc4f" class="jk jl nk jm b jn jo jp jq jr js jt ju np jw jx jy nq ka kb kc nr ke kf kg kh ig bi translated"><em class="in">当需要数据库分片而不需要表分片，并且对子数据库进行强制路由时，可以使用</em> <code class="fe ma mb mc md b"><em class="in">SHARDING_DATABASE_VALUE</em></code> <em class="in">添加分片，而不需要指定{table}。</em></p></blockquote><p id="8e9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是一个使用<code class="fe ma mb mc md b">HINT_INLINE</code>算法的例子。</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="d453" class="me kj in md b gy my mz l na nb">rules:<br/>- !SHARDING<br/>  tables:<br/>    t_order:<br/>      actualDataNodes: ds_${0..1}.t_order_${0..1}<br/>      databaseStrategy:<br/>        hint:<br/>          shardingAlgorithmName: database_hint_inline<br/>      tableStrategy:<br/>        hint:<br/>          shardingAlgorithmName: t_order_hint_inline<br/>  defaultDatabaseStrategy:<br/>    none:<br/>  defaultTableStrategy:<br/>    none:</span><span id="c9e1" class="me kj in md b gy nl mz l na nb">  shardingAlgorithms:<br/>    database_hint_inline:<br/>      type: HINT_INLINE<br/>      props:<br/>        algorithm-expression: ds_${value % 2}<br/>    t_order_hint_inline:<br/>      type: HINT_INLINE<br/>      props:<br/>        algorithm-expression: t_order_${value % 2}</span></pre><p id="3bf9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以通过 SQL 提示传递<code class="fe ma mb mc md b">t_order</code>表的分片值。从<code class="fe ma mb mc md b">PREVIEW</code>语句中我们可以看到，虽然 SQL 语句没有指定的分片键，但是 SQL Hint 引入的分片键-值对也可以实现分片路由。</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="23e9" class="me kj in md b gy my mz l na nb"><em class="nk">/* SHARDINGSPHERE_HINT: t_order.SHARDING_DATABASE_VALUE=1, t_order.SHARDING_TABLE_VALUE=1 */</em><br/>SELECT * FROM t_order;</span><span id="ab6f" class="me kj in md b gy nl mz l na nb">PREVIEW <em class="nk">/* SHARDINGSPHERE_HINT: t_order.SHARDING_DATABASE_VALUE=1, t_order.SHARDING_TABLE_VALUE=1 */</em> SELECT * FROM t_order;<br/>+<em class="nk">------------------+----------------------------------------------------------------------------------------------------------------------+</em><br/>| data_source_name | actual_sql                                                                                                           |<br/>+<em class="nk">------------------+----------------------------------------------------------------------------------------------------------------------+</em><br/>| ds_1             | <em class="nk">/* SHARDINGSPHERE_HINT: t_order.SHARDING_DATABASE_VALUE=1, t_order.SHARDING_TABLE_VALUE=1 */</em> SELECT * FROM t_order_1 |<br/>+<em class="nk">------------------+----------------------------------------------------------------------------------------------------------------------+</em></span></pre><h2 id="102e" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">异步数据一致性检查</h2><p id="63a1" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在 5.2.1 版本之前，用户必须等待服务器同步返回检查结果。有时检查很耗时，所以数据库服务器的<code class="fe ma mb mc md b">session</code>可能会超时。</p><p id="e5dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这种情况下，用户无法观察结果，只能查看日志，这对用户不友好。针对该问题，版本 5.2.1 支持异步数据一致性检查功能以及如下 DistSQL 集:</p><ul class=""><li id="5eea" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated">检查迁移作业 Id —异步数据一致性检查</li><li id="eb0a" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">显示迁移检查状态作业 Id —查询检查进度</li><li id="2c79" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">开始迁移检查作业 id-开始检查作业</li><li id="cd17" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated">停止迁移检查作业 id-停止检查作业</li></ul><p id="fb73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过上面的 DistSQL，用户可以更容易地管理数据迁移。例子如下:</p><pre class="mq mr ms mt gt mu md mv mw aw mx bi"><span id="b775" class="me kj in md b gy my mz l na nb"><em class="nk">-- Execute consistency check</em><br/>mysql&gt; CHECK MIGRATION 'j0101270cbb6714cff0d7d13db9fa23c7c0a1' BY TYPE (NAME='DATA_MATCH');<br/>Query OK, 0 rows affected (0.24 sec)</span><span id="c61f" class="me kj in md b gy nl mz l na nb"><em class="nk">-- Query the check progress</em><br/>mysql&gt; SHOW MIGRATION CHECK STATUS 'j0101270cbb6714cff0d7d13db9fa23c7c0a1';<br/>+<em class="nk">---------+--------+---------------------+-------------------+-------------------------+----------------+------------------+---------------+</em><br/>| tables  | result | finished_percentage | remaining_seconds | check_begin_time        | check_end_time | duration_seconds | error_message |<br/>+<em class="nk">---------+--------+---------------------+-------------------+-------------------------+----------------+------------------+---------------+</em><br/>| t_order | false  | 0                   | 2450              | 2022-10-12 16:07:17.082 |                | 14               |               |<br/>+<em class="nk">---------+--------+---------------------+-------------------+-------------------------+----------------+------------------+---------------+</em><br/>1 row in set (0.02 sec)</span><span id="521f" class="me kj in md b gy nl mz l na nb"><em class="nk">-- Stop the check job</em><br/>mysql&gt; STOP MIGRATION CHECK 'j0101270cbb6714cff0d7d13db9fa23c7c0a1';<br/>Query OK, 0 rows affected (0.06 sec)</span><span id="3dfd" class="me kj in md b gy nl mz l na nb"><em class="nk">-- Start the check job</em><br/>mysql&gt; START MIGRATION CHECK 'j0101270cbb6714cff0d7d13db9fa23c7c0a1';<br/>Query OK, 0 rows affected (5.13 sec)</span></pre><p id="2135" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请参考<a class="ae ll" href="https://shardingsphere.apache.org/document/current/en/user-manual/shardingsphere-proxy/migration/usage/" rel="noopener ugc nofollow" target="_blank">官方文档</a>，并关注未来帖子的更多详细信息。</p><h1 id="a530" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">提高</h1><h2 id="741b" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">核心</h2><p id="4ac2" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">此次更新优化了<a class="ae ll" href="https://www.oracle.com/index.html" rel="noopener ugc nofollow" target="_blank"> Oracle </a>和<a class="ae ll" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>的 SQL 解析，大大提高了 ShardingSphere 的 SQL 兼容性。详细的 SQL 解析优化可以在下面的发行说明部分找到。</p><p id="2aa6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">提高 SQL 解析兼容性是 ShardingSphere 社区的一项长期任务，欢迎任何感兴趣的人加入我们。</p><p id="9be1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.2.1 版还支持读/写拆分。辅助数据库被禁用后，可以使用<code class="fe ma mb mc md b">-f</code>参数强制启动<a class="ae ll" href="https://shardingsphere.apache.org/document/current/en/quick-start/shardingsphere-proxy-quick-start/" rel="noopener ugc nofollow" target="_blank"> ShardingSphere-Proxy </a>。</p><p id="e7a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这种情况下，即使部分存储节点不可用，仍可启动代理进行操作和维护工作。此外，内核函数还针对<code class="fe ma mb mc md b">SHOW PROCESSLIST</code>语句的显示结果进行了优化，并增加了<code class="fe ma mb mc md b">Sleep</code>状态的线程显示。</p><p id="1561" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过优化单播路由的逻辑和尽可能重用缓存的数据库连接，ShardingSphere 的执行性能得到了提高。</p><h2 id="5bc5" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">弹性缩放</h2><p id="e27b" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">弹性伸缩模块只支持具有唯一键的表的数据迁移，允许表迁移到新的表名。此外，它优化了数据迁移中线程池的使用。数据一致性检查可以中断，这使得用户更容易管理数据迁移。</p><h2 id="bce4" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">分布式治理</h2><p id="e498" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在分布式治理方面，治理中心现在能够支持 Consul 和 Nacos，为您提供更多的选择。同时，内置的 H2 数据库用于支持以独立模式持久化元数据信息。</p><p id="1007" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在运行模式下，<code class="fe ma mb mc md b">overwrite</code>配置项被删除。元数据信息基于治理中心的数据，用户可以通过 DistSQL 动态更改规则和配置。</p><h1 id="3e3c" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">发布说明</h1><p id="431a" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在接下来的章节中，您将会找到 ShardingSphere 5.2.1 的发行说明。为了改善用户体验，本次更新中修改了部分功能的 API。有关详细信息，请参考下面的 API 更改部分。</p><h2 id="2e08" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">新功能</h2><ol class=""><li id="ad79" class="lm ln in jm b jn lg jr lh jv ns jz nt kd nu kh nv ls lt lu bi translated">添加 ShardingSphere 默认系统数据库以支持全局元数据管理</li><li id="3868" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持异步数据一致性检查</li><li id="ac5b" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">增加了对领事管理中心的支持</li><li id="aa7d" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">增加了对 Nacos 治理中心的支持</li><li id="ef92" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">增加了对治理中心中查看功能的支持</li></ol><h2 id="0b74" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">提高</h2><ol class=""><li id="d974" class="lm ln in jm b jn lg jr lh jv ns jz nt kd nu kh nv ls lt lu bi translated">SQL 联邦引擎增加高级执行器并适配 openGauss 数据库</li><li id="86f6" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持 ShardingSphere 代理在读写拆分读取数据库被禁用后启动</li><li id="0b90" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">SQL 提示支持强制分片路由</li><li id="7f7c" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">Show processlist 支持显示代理连接(睡眠、活动)</li><li id="89a1" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">优化的 sharing sphere-JDBC 数据源配置错误消息</li><li id="65e4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">JDBC 支持 SpringBoot 3。x 版本</li><li id="785c" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持加载 MySQL、PostgreSQL、openGauss 和 SQLServer 视图元数据</li><li id="9e2a" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">将 Snakeyaml 更新为 1.33，打开 YAML 3MB 限制</li><li id="d027" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">单播分片时尽可能重用缓存的连接</li><li id="80b1" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析 ALTER ROLE</li><li id="5c82" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">添加对 Oracle 更改资源成本的支持</li><li id="264b" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析删除实体化视图</li><li id="8217" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析拖放库</li><li id="2a17" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析 DROP JAVA</li><li id="4f09" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析可插拔数据库</li><li id="a82c" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 Oracle 中解析删除索引类型</li><li id="e992" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持在 openGauss 中解析 ALTER 包</li><li id="a74e" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持 openGauss select offset，count 语句解析，删除 PostgreSQL 语法中无用的语法</li><li id="0ef4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">将 max_size 添加到 openGauss 语法</li><li id="41e7" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">优化 alter view/drop view 解析逻辑并修复 alter view 刷新程序错误</li><li id="0d29" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">将 SQL 分析器错误详细信息添加到 ParseCancellationException</li><li id="531f" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">添加对 Postgres 解析 OptOnConflict 的支持</li><li id="b1f5" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">增强对 PostgreSQL 中 ALTER TABLE 和 ALTER VIEW 的支持</li><li id="e4f4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">在 PostgreSQL Declare 语句中添加一个缺少的关键字</li><li id="e9c0" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">为 MySQL 解析器添加 JSON 函数支持</li><li id="00b0" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">ShardingSphere-Proxy 自动适应 Docker 环境中的 cgroup 内存限制</li><li id="7271" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">显示迁移状态 DistSQL respond 新添加的 error_message 列</li><li id="a9dc" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">显示迁移状态响应新添加的已处理记录计数列</li><li id="c55b" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持增量转储中的 MySQL 8 缓存 _ sha2 _ 密码认证</li><li id="e111" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">改进下降管道工艺配置</li><li id="4b59" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持唯一键表迁移</li><li id="88ae" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持将表迁移到新名称表</li><li id="aee9" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">提高流水线任务和运行程序中线程池的使用率</li><li id="aa47" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">支持可取消的数据一致性检查</li><li id="b982" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">DistSQL:创建或更改读写拆分规则时，检查重复的写或读资源</li><li id="b721" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">DistSQL:为<code class="fe ma mb mc md b">ALTER SHARDING BINDING TABLE RULES</code>添加有效性检查</li><li id="5757" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">独立模式 H2 支持持久元数据</li><li id="4269" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复 xa 事务中的 openGauss 游标执行</li><li id="f8c5" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">添加了与事务相关的异常错误修复</li></ol><h2 id="e103" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">错误修复</h2><ol class=""><li id="4cd8" class="lm ln in jm b jn lg jr lh jv ns jz nt kd nu kh nv ls lt lu bi translated">重写时为 PostgreSQL 生成适当的占位符</li><li id="6584" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复 opengauss 更新集解析异常</li><li id="22af" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复使用负值执行插入语句时出现的分析异常</li><li id="3016" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复 OracleDataSourceMetaData 中错误的 connectDescriptorUrlPattern</li><li id="5ed6" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复在特殊规则中重写分片后插入 SQL 的乱码</li><li id="ec94" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复执行 select * from information _ schema . tables 时出现的异常</li><li id="c701" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复执行更改视图重命名时的异常</li><li id="12f6" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复使用 rolsuper 时 PostgreSQL 检查数据源权限</li><li id="bbe9" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">DistSQL:修复没有资源时<code class="fe ma mb mc md b">REFRESH TABLE METADATA</code>的 NPE</li><li id="42f4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修改规则时修复未修改的表元数据</li><li id="6425" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复数据库发现</li><li id="39e3" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">MySQL。NORMAL_REPLICATION 算法找不到主节点"</li><li id="c121" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复了使用 etcd 构建不知道的集群事件</li><li id="b39c" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复未创建事务管理时发生的 NPE</li><li id="c5f8" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">修复当 InlineShardingAlgorithm 算法的分片值超过整数时发生的路由异常</li></ol><h2 id="b0aa" class="me kj in bd kk mf mg dn ko mh mi dp ks jv mj mk kw jz ml mm la kd mn mo le mp bi translated">API 变更</h2><ol class=""><li id="8473" class="lm ln in jm b jn lg jr lh jv ns jz nt kd nu kh nv ls lt lu bi translated">SQL 提示语法格式调整为 SQL 风格的格式</li><li id="dde4" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">DistSQL:删除语法<code class="fe ma mb mc md b">COUNT DATABASE RULES</code></li><li id="31a7" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">ShardingSphere 模式删除覆盖配置</li><li id="9598" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh nv ls lt lu bi translated">代理:优化 agent.yaml 的配置</li></ol><h1 id="2701" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">相关链接</h1><p id="bae8" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">🔗<strong class="jm io"> </strong> <a class="ae ll" href="https://shardingsphere.apache.org/document/current/en/downloads/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">下载链接</strong> </a></p><p id="f798" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">🔗</strong> <a class="ae ll" href="https://github.com/apache/shardingsphere/blob/master/RELEASE-NOTES.md" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">发布说明</strong> </a></p><p id="adb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">🔗</strong> <a class="ae ll" href="https://shardingsphere.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">项目地址</strong> </a></p><p id="501e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">🔗</strong> <a class="ae ll" href="https://github.com/apache/shardingsphere-on-cloud" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">云子项目地址</strong> </a></p><h1 id="796c" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">社区贡献</h1><p id="685c" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">这个 Apache ShardingSphere 5.2.1 版本是由 38 个贡献者提交的 614 个合并 PRs 的结果。谢谢你的努力！</p><figure class="mq mr ms mt gt nd gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nc"><img src="../Images/77c9a8ff7008d3432e5fc8cb3b9c996f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nZuEQUbLdWi9N2XU"/></div></div></figure></div></div>    
</body>
</html>