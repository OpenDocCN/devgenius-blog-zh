<html>
<head>
<title>Feature Flags Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">功能标志解释</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/feature-flags-explained-59ba5c6f85ed?source=collection_archive---------11-----------------------#2020-07-07">https://blog.devgenius.io/feature-flags-explained-59ba5c6f85ed?source=collection_archive---------11-----------------------#2020-07-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9deb" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">以及为什么你应该关心</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8c4a77ce06779fb9d3fea709f2e3c63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ePkjxlu8JA5zkWVsk3ts8A.png"/></div></div></figure><p id="0467" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">去年 11 月，我在 Split 开始了一份新工作，在我们的主核心后端团队担任工程师。我们是做特色旗帜生意的！然而，与我在 Box 时不同的是，我发现要解释我们公司的工作有点困难——尤其是对非工程师而言。也就是说，随着世界变得越来越在线，像特征标志这样的东西开始变得对每个人都很重要。</p><p id="9350" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">那么，什么是特征标志(或特征翻转或分割或特征切换或<a class="ae lk" href="https://en.wikipedia.org/wiki/Feature_toggle" rel="noopener ugc nofollow" target="_blank">许多其他名字用来表示同一件事</a>)？在一个非常高的层次上，特性标志允许你分支你的代码，给不同的用户不同的体验。在它们的许多现代实现中，功能标志是从与代码分离的 web 界面配置的。这意味着我可以去一个网站，点击鼠标改变设置，它可以改变我的应用程序的行为。</p><p id="ea9d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">除了这个非常基本的概念之外，还有许多附加功能，使功能标志成为一个非常强大和通用的工具。事实证明，它们可以解决大量的问题，这使得它们对于大多数现代软件开发来说几乎是不可或缺的。</p><h1 id="ee8d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">将功能发布与代码部署分开</h1><p id="1ef4" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">功能标志最常见的用例可能是将代码部署与功能发布分开。这意味着当我把一个新版本的代码推送到我的服务器上时，我可以等待，直到以后的某个时间点才让任何用户看到该代码中的任何新特性。这是非常有价值的，原因有几个。</p><p id="db70" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我可以处理非常大的特性，并在制作时将这些修改合并到推送到生产服务器的代码中。有了特性标志，我可以防止任何人(除了开发这个特性的其他开发人员)碰到我不完整的特性。因为我是以小增量合并我的变更，所以当我准备好实际发布我的特性时，我不必担心大的合并冲突。还可以允许某些人在您的实际生产环境中测试一个特性，而不会在它准备好之前意外地让任何客户看到它。</p><p id="4457" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">其次，代码部署是有风险的<em class="mi">和</em>特性发布是有风险的。通过将它们分开，如果出了问题，就可以更快地确定是哪一个导致了问题，并扭转这一局面。最重要的是，典型的特性发布比代码部署更有风险，而且实际上取消特性标志总是比回滚发布更快。这意味着当某个特性版本出现问题时，可以通过特性标志更快地修复它。当我在 Box 的时候，现在，当我在 Split 的时候，我们把所有中到大的特性放在一个特性标志后面，我们也把任何有风险的改变(不管多小)放在一个特性标志后面。</p><h1 id="151d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">贝塔和金丝雀</h1><p id="d924" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在与前一个相关的用例中，当我向客户发布一个特性时，我并不总是想一次发布给所有客户。通常会发布一个测试版或者通常所说的金丝雀版。对于测试版，我通常会在一小群信任的客户身上测试我的新功能，这些客户同意对某个功能提供反馈，以换取对它的早期访问。在这种情况下，我只希望少数非常具体的帐户能够访问我的功能。</p><p id="ba6c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">对于金丝雀版本，我希望将我的功能扩展到一小部分流量，然后在一段时间内增加该百分比，同时监控它是否与我的其余流量相关。例如，如果我注意到对一个特定端点的所有调用都导致金丝雀上的错误，而不是我的其余流量，那么无论打开什么功能标志，都可能会给该端点带来问题。对于金丝雀，我通常希望发布一组随机但一致的账户——我不希望给定的用户在不同时间访问我的网站时有不同的体验。我还希望得到金丝雀的用户集能够代表我的全部客户群。</p><p id="d25d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在 Split，我们还对用户进行随机化，这样如果我推出两个不同的功能，每个功能占 5%，就不会有相同的 5%的用户同时打开了这两个功能。我见过使用客户 id 来决定为谁打开某个功能的功能标记解决方案。虽然这是一种更简单的方法，但它导致了我们开玩笑说的 1 的诅咒——所有向任何百分比的流量推出的功能，都是向 id 以 001 结尾的所有用户推出的(5% = id 以 001–005 结尾，10% = id 以 001–010 结尾，等等)。因此，这些 001 账户是最有可能出问题的，因为他们有一堆不同的，有时是实验性的，没有必要一起测试的功能。</p><h1 id="ac3e" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">A/B 测试</h1><p id="9ba6" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我还可以使用一个特性标志来运行一个 A/B 测试(或者甚至可能不止两个变体)。A/B 测试通常是回答特定问题的小型快速实验。如果我的横幅是蓝色或绿色，会有更多人注册吗？如果我在页面中间放一个巨大的“立即购买”按钮，会不会有更多的人购买？如果我介绍使用我的产品的技巧，人们是否更有可能再次光顾？如果我移动导航，人们会更容易到达他们要去的地方吗？而对于 betas 或 canaries，通常期望的结果是最终向所有用户安全地发布该功能，对于 A/B 测试，期望的结果是回答一个问题，然后相应地修改(或不修改)网站。除此之外，在类似金丝雀的版本中，我可能会将其扩展到 5%的流量，如果我没有看到错误率激增，我会将其增加到 10%，然后 50%，然后 100%。对于金丝雀，如果没有明显的问题，我将继续部署，直到出现问题或者我确定它是安全的，通常不超过半天(通常更短)。同时，对于 A/B 测试，我更可能只想让很少一部分用户在更长的时间内体验新的体验。然而，我仍然需要这个百分比具有统计学意义。因此，需要运行更复杂的统计和数据分析。也可能是这样的情况，我们需要考虑多个运行的 A/B 测试以及它们之间的相互作用(再次以统计上显著的方式)。</p><h1 id="ee3b" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">定制包</h1><p id="53e3" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">功能标志还可以用于为用户定制功能集。如果我们试图放弃一个特性，比如一个 API，并希望给现有用户时间来迁移，但确保没有其他人开始使用它，我可以使用一个特性标志，使旧的 API 只对在过去六个月内调用过它的用户可用。或者，我也可以创建功能包，并且只允许基于谁为该包付费来访问它们。我还可以根据用户流量的来源，向用户显示不同的语言或图形。所有这些都可以通过特性标志轻松实现。</p><h1 id="ed5e" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">临时用户界面自定义</h1><p id="e557" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">Split 的一个特性是，我们允许用户定义自定义 JSON 或自定义键-值对，并用它们的特性标志连接起来。这意味着通过管理 UI，我可以根据标志是开还是关来设置不同的值(或者除了我设置的开或关之外的任何其他自定义状态)。举一个更具体的例子，在我的代码中，我可以将一个盒子的颜色设置为一个变量。然后，我可以获取该变量的值以及我的特性标志状态。这允许我改变我的网站上的一个盒子的颜色，而不用推代码。这是很有用的，因为访问这个特性标志定制的人往往比那些会编码的人多得多。更改特性标志也比更改底层代码，然后将代码推送到生产环境中要快得多。</p><p id="2347" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在另一个更进一步的例子中，我们有一个客户，他的页面上有一个消息横幅，如果没有任何消息，它就不会显示。但是，当他们有消息要向客户显示时(例如，由于新冠肺炎造成的延误)，他们可以根据地区显示该消息(因此，如果只有太平洋西北地区受到影响，他们可以只向来自太平洋西北地区的交通显示该消息)，方法是根据地区更改其功能标志的消息，而无需推送一行代码。突然间，他们的客户成功人员可以与他们的客户交流，而不必打扰他们已经超负荷工作的工程团队。</p><h1 id="4c88" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">你为什么要在乎？</h1><p id="d5cf" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">有了所有这些不同的强大用例，我希望我至少让你相信了特性标志对于大多数软件公司来说是非常有价值的。然而，大多数公司都不是软件公司。或者他们是？甚至在疫情袭击之前，越来越多的企业开始向网上转移。大多数商店发现自己有网站可以与亚马逊竞争，许多餐馆现在支持在线订购。我可以在网上安排汽车保养和牙医预约。我甚至可以在网上看我的医生。这意味着几乎每个企业都在成为互联网企业，或者至少有一个互联网的组成部分。最重要的是，如果我在网上做一些事情，我就不那么受地理位置的限制了。我可以选择网站或体验更好的商店，而不是最近的商店。突然之间，商店发现自己与越来越多的其他商店竞争，使得他们的在线存在的有效性比以往任何时候都更重要。很快，每个人都将成为互联网公司，每个人都需要功能标志。</p></div></div>    
</body>
</html>