# 真的需要微服务吗？—如何决定？

> 原文：<https://blog.devgenius.io/do-you-really-need-microservices-how-to-decide-9112dfa0e993?source=collection_archive---------7----------------------->

![](img/062cfd07054f8333e8bfea932422fcd0.png)

微服务是开发者在互联网上搜索最多的话题之一。不幸的是，大多数可用的内容倾向于用一种语言/框架实现微服务。这个主题主要是从单个开发人员或单个产品(或者两个)体验的角度来讨论的。

这种方法的问题是，你只能听到故事的一面之词。你会得到一个简单的利弊清单，试图过度简化一个相对复杂的决定。结果是人们经常对在他们的系统架构中实际使用微服务感到困惑。我遇到的大多数软件架构师要么仍在寻找最佳点(一种实用的心智模型)，要么遵循一些旧书或旧文章(他们坚信这些是正确的)。但在大多数情况下，人们忘记了他们需要问自己的第一个问题— **我们是否需要基于微服务的架构？**

这篇博文将分享我面对同样问题时的心智模型(决策方法)。十多年来，我一直在为产品编写代码。我做过许多自由职业咨询项目，设计的系统已经服务了数百万用户(峰值并发超过每秒 1000 万次以上的操作)。请把这篇博文当做我在这个领域的体验式学习的总结。**这篇文章背后的想法不是命令或推动“正确的方法”！。而是给你一个思维过程的起点**。决策总是高度主观的和有背景的，你总是需要你的心智模型。

# 需要牢记的重要事情

在决定选择单片还是微服务之前，我想强调一些人们经常忘记的重要事实。每当我不得不做出上述决定时，都会涉及到三个支柱。这三大支柱是-

1.  产品
2.  人
3.  技术

我意识到以上几点让我听起来更像一个产品经理，而不是一个开发人员。尽管如此，当你是一名工程领导者时，你应该平衡产品思维和工程思维，因为你的决定会产生长期的影响，可以成就或摧毁整个组织。让我解释一下这些支柱是什么，它们起什么作用。

# 第一大支柱——产品

*   **很好地定义产品**——定义你试图构建的东西对于在微服务和单片产品之间做出选择至关重要。作为一名开发人员/软件架构师，请理解你正在试图解决一个没有完全定义的问题。我见过许多初创公司甚至在产品范围不明确的情况下就开始编写代码。千万别这么做。写代码很贵！
*   软件是为了解决问题而编写的。它本身不应该成为一个问题 —这种情况经常发生，因为工程团队中的人是决策过程的一部分。他们对语言/技术/架构模式的偏见倾向于渗入并搞乱原本可能是完美设计的系统。用这个 X 数据库，不用 y，用这个 A 框架，不用 B，等等。我讨厌语言 X，因为 y。当你的应用程序需要扩展时，因为你的偏见而试图不必要的约束你自己通常会导致混乱。所以，试着超越它，在做决定的时候脑子里只有一件事——给定问题的最佳解决方案。

# 第二大支柱——人

*   **工程团队**——在构建任何成功的软件时，人是最大的资产。在决策过程中，始终包括每一个开发人员/SRE。如果您正在接听与项目中使用的技术相关的特定电话，请与您的团队进行讨论，并尝试得出一个共同的结论，让所有人达成共识。
*   **最终用户** —软件应用程序是为最终用户解决问题而编写的。所以，用户行为应该是你决策的核心。基于你的产品的用户旅程来预测用户行为，将会给你足够的洞察你的系统的访问模式，并帮助你很好地设计系统。我们将在这篇文章的后面更详细地讨论这个问题。

# 第三大支柱——技术

*   **很好地理解技术** —我见过用 PHP 和 Ruby 编写的服务性能远远好于用 Go 或 Rust 编写的服务。而且原因也不是 Ruby/PHP 或者类似的语言比 Go 或者 Rust 好。原因是写那些程序的人很了解他们的技术(编译器如何工作，内存使用，限制等等。)，而且他们知道如何从中获得最大的产出。而编写相应 Go 和 Rust 程序的人并没有完全理解语言特性(特别是运行时和并发部分)。同样的逻辑也适用于框架/数据库/队列/文件存储等。技术不是魔法。使用一项新技术不会自动解决你写的糟糕的逻辑或者糟糕的系统设计的问题。所以，总是尽可能地去理解你正在使用的技术！
*   **基准测试、监控和优化** — 80%的应用程序代码编写后从未被监控或优化。如果功能正常，那么人们会认为可以使用了。那么，在时间和空间复杂性决定一切的情况下，你所解决的数百个竞争性编程问题的意义何在？这就是你获得“体验学习”的方式通过测量和优化，尽可能获得最佳性能并节省大量资金。

我希望更多的人在产品、技术和管理职位上更好地理解上述支柱。

# 无耻的插头

你好。在提出解决方案之前，我决定做一个不要脸的塞。如果你想学习如何创造一流的技术产品，我专门为你创建了一个名为 [cloudeasy.club](http://cloudeasy.club/) 的学习社区。通过加入这个俱乐部，你可以学习系统设计、软件架构和分布式系统。你可以在 [Discord](https://link.cloudeasy.club/Wx31) 或者 [Whatsapp group](https://link.cloudeasy.club/kBMf) 上找到我们。此外，如果您有任何问题，请随时在 [LinkedIn](https://www.linkedin.com/in/theguywithideas/) 或 [Twitter](https://twitter.com/theguywithideas) 上联系我。

# 高级决策流程——用于决定您应该选择微服务还是单片产品

在我进入这个决策流程的细节之前，请理解这是一个非常大胆的简化复杂事物的尝试。同样，这个想法是给你一个思考过程的起点。我艰难地学会了下面提到的流程——通过犯错误，通过打破东西。所以，你的背景可能不同，但是如果你应用下面给出的基本模型，你可以在做这个决定时避免犯很多错误。这是一种使用产品思维和[粗略计算](http://highscalability.com/blog/2011/1/26/google-pro-tip-use-back-of-the-envelope-calculations-to-choo.html)做出正确决策的结构化方法。

# 第一步——收集需求

列出你应该构建的所有产品功能。在黑板上想象它们。我也用米罗板([https://miro.com/](https://miro.com/))。您可以使用任何可视板工具。只写下要点和高层次的需求(不要写复杂的东西)。

# 第二步——列出所有需要解决的工程问题

*   分解工程问题中的所有特征列表。
*   然后根据一个简单的规则——关注点分离——将问题分解成子问题。
*   估计每个子问题的复杂性，以了解两件事——所需的编程工作和所需的资源(CPU/内存/文件系统等)。).如果您是开发人员，这应该很容易估算。
*   每个子问题的解决方案要么是产品中的功能，要么是支持其他功能的幕后系统。

# 第三步——制作用户角色，并根据可度量的标准写下他们对单个功能的预期行为

*   让我给你举个简单的例子——95%滚动 Instagram feed 的用户不会滚动超过 30 篇帖子。或者 90%的用户滚动 Instagram 卷轴不会滚动超过 50 个卷轴。(我不知道真实的数字。只是一个假设的例子)。现在，您已经知道了两个用户角色的预期行为，您可以绘制一个可度量的指标，比如——每秒 HTTP 请求数、每秒消耗的媒体量等。这将为您提供每个功能预期流量(或负载)的粗略估计。在大多数情况下，您可以对所有子问题(或功能)都这样做。
*   在这一步中，还要将功能分为两部分——最少使用的功能和最多使用的功能。
*   使用上面第 1 点中描述的方法估计这些服务的负载。
*   请注意，我在这里使用了“加载”这个词。原因是这种负载会根据您正在编写的应用程序的性质而变化。例如，如果您正在编写一个 REST API(或 REST 后端)，负载将是“每秒请求数”如果它是基于事件的(发布-订阅类型)系统，它将是每秒的事件(或消息)数量，如果它是数据处理系统，数据传输(以 GB、TB 等为单位。)每秒

# 第四步——根据预期的平台流量进一步估算

我们在第三步中估计了每个用户角色(或用户旅程)的负载。在这一步中，我们将负载乘以主要指标(每日活动用户数、任意给定时间的并发用户数等)。)例如，在上一步中，我们举了一个人物角色的例子，其中 90%的 Instagram feed 用户不会滚动超过 50 个卷轴。现在让我们假设 Instagram 对每个卷轴进行四次 API 调用，在任何给定的时间，10000 个并发用户正在滚动卷轴。有了这些假设，您可以乘以并估计您的服务的平均负载。如果您愿意，您可以深入到数据库调用(或 IO 操作等)的数量级别。)你将不得不抓紧每一秒。这就是你到达真相时刻的方式。看完所有数据后，问自己两个问题-

*   如果我将所有这些功能组合成一个单一的整体，它能够在不影响特定功能(或整体用户体验)的情况下承担这个负载吗？
*   简单的水平扩展有助于处理未来可能出现的任何额外的未计算的(超过估计的)负载吗？

如果这两个问题的答案都是肯定的，那么就继续使用单一服务吧。此外，请记住，如果您对自己的估计没有信心，您可以编写一个概念验证代码(或应用程序)，进行简单的基准测试，或者使用负载测试工具模拟负载，以提高估计的准确性。

# 第五步——考虑项目预算

如果你在一个预算有限的组织工作，你必须在做最后决定时考虑到这一点。向适当的利益相关者解释这两种方法的优缺点，并让他们参与进来。根据我的经验，如果您正确选择了工具(语言、数据库、部署架构等)，一个设计良好的系统总是具有成本效益的。).

就是这样。到了第五步，你应该对是否应该为你的下一个项目选择微服务架构有了理想的答案。

# 微服务介绍—完整课程

如果你想了解从单片到微服务架构的所有知识，你可以参加我的课程——“微服务简介”。“这是一门初级课程，给你一个实用的、语言(工具)不可知的微服务世界介绍。youtube 上有免费的。查看 [youtube 播放列表。](https://www.youtube.com/watch?v=7JNTjEc5b3M&list=PL5Eij7mwJNnwiH5fCmT4y2_9bopqKUnCf)它涵盖了许多引人入胜的话题，例如

*   我们如何将现有的单片转换为微服务？
*   微服务中的各种沟通方式。
*   详细的监控和可观察性
*   微服务中使用的不同类型的数据库
*   微服务的部署方法和选项

如果你有任何问题，请随时在 [Twitter](https://twitter.com/theguywithideas) 或 [LinkedIn](https://www.linkedin.com/in/theguywithideas) 上联系我。在 [Discord](https://link.cloudeasy.club/Wx31) 或 [Whatsapp group](https://link.cloudeasy.club/kBMf) 上加入我的社区，了解更多内容。