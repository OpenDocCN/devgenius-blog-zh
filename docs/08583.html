<html>
<head>
<title>DevOps with AWS Lambda: How to define CI/CD pipeline to deploy functions as a container image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS Lambda 的 DevOps:如何定义 CI/CD 管道以将功能部署为容器映像</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-deploy-aws-lambda-functions-as-a-container-image-using-codepipeline-5697abe51653?source=collection_archive---------4-----------------------#2022-06-26">https://blog.devgenius.io/how-to-deploy-aws-lambda-functions-as-a-container-image-using-codepipeline-5697abe51653?source=collection_archive---------4-----------------------#2022-06-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="f40e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用您最喜欢的语言进行本地开发，并通过无服务器应用程序的 IaC 框架 SAM(无服务器应用程序模型)轻松部署到 AWS Lambda。AWS lambda 开始支持打包成容器映像的运行函数，用 lambda 增强您的应用程序开发。例如，您可以部署高达 10GB 的容量，这比以前大得多——250 MB，并且它允许您包含更多的编程语言库。</p><p id="302f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我写了一篇文章解释如何在支持容器图像之前正确地做这件事，所以这篇文章将是旧文章的更新版本！</p><div class="ki kj gp gr kk kl"><a href="https://medium.com/@xiangtai-z/how-to-deploy-aws-lambda-functions-using-codepipeline-313207f75f53" rel="noopener follow" target="_blank"><div class="km ab fo"><div class="kn ab ko cl cj kp"><h2 class="bd io gy z fp kq fr fs kr fu fw im bi translated">如何使用代码管道部署 AWS Lambda 函数</h2><div class="ks l"><h3 class="bd b gy z fp kq fr fs kr fu fw dk translated">我尝试过部署 Python 的 AWS Lambda 函数(包括外部库如 numpy、pandas 等。)使用…</h3></div><div class="kt l"><p class="bd b dl z fp kq fr fs kr fu fw dk translated">medium.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz la kl"/></div></div></a></div><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/ca5aa6c175555125d3570d227e96bb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VmsLyTGdGaKdnrmqHVMdaA.png"/></div></div></figure><h1 id="346c" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">简单概述</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mk"><img src="../Images/d33e0a1bd1ab0c3f0ff2effea52546d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kAZxMBLM0A_KqR25cfwbNA.png"/></div></div></figure><h1 id="27e5" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">先决条件</strong></h1><p id="5079" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我将使用 Python 和 macOS 进行指导，但是这个概念和架构应该可以在你选择的任何语言中工作。</p><ul class=""><li id="238b" class="mq mr in jm b jn jo jr js jv ms jz mt kd mu kh mv mw mx my bi translated">MacBook Air M1 2020(MAC OS Monterey 12 . 2 . 1)——我相信即使你有旧的 MacBook(英特尔芯片)，它也应该可以工作。</li><li id="3c10" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">AWS 帐户—可能会收取少量费用，但绝对不需要任何其他高级或高额收费的服务或订阅</li></ul><p id="2530" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您在本地已经有一个 SAM 应用程序，最好阅读“创建代码提交库”一节。</p><h1 id="2420" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">安装 SAM CLI</h1><p id="8999" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">只要按照 AWS 的这个指示。如果您已经安装了 SAM CLI，<strong class="jm io">请确保其版本高于 v1.13.1. </strong></p><div class="ki kj gp gr kk kl"><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-mac.html" rel="noopener  ugc nofollow" target="_blank"><div class="km ab fo"><div class="kn ab ko cl cj kp"><h2 class="bd io gy z fp kq fr fs kr fu fw im bi translated">在 macOS 上安装 AWS SAM CLI</h2><div class="ks l"><h3 class="bd b gy z fp kq fr fs kr fu fw dk translated">按照以下步骤安装和配置在…上使用 AWS SAM 命令行界面(CLI)的先决条件</h3></div><div class="kt l"><p class="bd b dl z fp kq fr fs kr fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="df5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不要忘记安装 Docker，这是作为一个选项提到的，并安装了“苹果硅 Docker 桌面”。</p><div class="ki kj gp gr kk kl"><a href="https://docs.docker.com/desktop/mac/apple-silicon/" rel="noopener  ugc nofollow" target="_blank"><div class="km ab fo"><div class="kn ab ko cl cj kp"><h2 class="bd io gy z fp kq fr fs kr fu fw im bi translated">苹果芯片的 Docker 桌面</h2><div class="ks l"><h3 class="bd b gy z fp kq fr fs kr fu fw dk translated">预计阅读时间:4 分钟苹果芯片上的 Docker 桌面现已正式发布。这个…</h3></div><div class="kt l"><p class="bd b dl z fp kq fr fs kr fu fw dk translated">docs.docker.com</p></div></div><div class="ku l"><div class="ne l kw kx ky ku kz la kl"/></div></div></a></div><blockquote class="nf ng nh"><p id="a423" class="jk jl ni jm b jn jo jp jq jr js jt ju nj jw jx jy nk ka kb kc nl ke kf kg kh ig bi translated">注意:在安装家酿之前，我必须勾选“使用 Rosetta 打开”才能在 M1 Mac 的终端中使用 brew 命令。</p></blockquote><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/bdae8b087809767a2774c67b5c0f4a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*m1IOMwTH-N1Z71hCxGX_Qg.png"/></div></figure><h1 id="1233" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">安装 AWS CLI 并配置凭据</h1><div class="ki kj gp gr kk kl"><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener  ugc nofollow" target="_blank"><div class="km ab fo"><div class="kn ab ko cl cj kp"><h2 class="bd io gy z fp kq fr fs kr fu fw im bi translated">安装或更新最新版本的 AWS CLI</h2><div class="ks l"><h3 class="bd b gy z fp kq fr fs kr fu fw dk translated">本主题介绍如何在…上安装或更新最新版本的 AWS 命令行界面(AWS CLI)</h3></div><div class="kt l"><p class="bd b dl z fp kq fr fs kr fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><div class="ki kj gp gr kk kl"><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-set-up-credentials.html" rel="noopener  ugc nofollow" target="_blank"><div class="km ab fo"><div class="kn ab ko cl cj kp"><h2 class="bd io gy z fp kq fr fs kr fu fw im bi translated">设置 AWS 凭据</h2><div class="ks l"><h3 class="bd b gy z fp kq fr fs kr fu fw dk translated">AWS SAM 命令行界面(CLI)要求您设置 AWS 凭据，以便它可以调用 AWS 服务…</h3></div><div class="kt l"><p class="bd b dl z fp kq fr fs kr fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><h1 id="1dcc" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">开始前…</h1><p id="c820" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">在这些装置之后，我有:</p><ul class=""><li id="741d" class="mq mr in jm b jn jo jr js jv ms jz mt kd mu kh mv mw mx my bi translated">2016 年 10 月 20 日</li><li id="c658" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">Git — 2.30.1</li><li id="1633" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">自制— 3.5.2</li><li id="365b" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">SAM CLI-1 . 52 . 0</li><li id="da0d" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">AWS CLI — 2.7.11</li></ul><h1 id="197d" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">在本地创建项目</h1><p id="21c5" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">在您的本地目录(例如……/work/server less app/)中，运行“sam init”。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="b03c" class="ns ln in no b gy nt nu l nv nw">$ sam init</span><span id="8df6" class="ns ln in no b gy nx nu l nv nw">Which template source would you like to use?<br/>        1 - AWS Quick Start Templates<br/>        2 - Custom Template Location<br/>Choice: 1</span><span id="b0b4" class="ns ln in no b gy nx nu l nv nw">Choose an AWS Quick Start application template<br/>        1 - Hello World Example<br/>        2 - Multi-step workflow<br/>        3 - Serverless API<br/>        4 - Scheduled task<br/>        5 - Standalone function<br/>        6 - Data processing<br/>        7 - Infrastructure event management<br/>        8 - Machine Learning<br/>Template: 1</span><span id="d532" class="ns ln in no b gy nx nu l nv nw">Use the most popular runtime and package type? (Python and zip) [y/N]: N</span><span id="4ba0" class="ns ln in no b gy nx nu l nv nw">Which runtime would you like to use?<br/>        1 - dotnet6<br/>        2 - dotnet5.0<br/>        3 - dotnetcore3.1<br/>        4 - go1.x<br/>        5 - graalvm.java11 (provided.al2)<br/>        6 - graalvm.java17 (provided.al2)<br/>        7 - java11<br/>        8 - java8.al2<br/>        9 - java8<br/>        10 - nodejs16.x<br/>        11 - nodejs14.x<br/>        12 - nodejs12.x<br/>        13 - python3.9<br/>        14 - python3.8<br/>        15 - python3.7<br/>        16 - python3.6<br/>        17 - ruby2.7<br/>        18 - rust (provided.al2)<br/>Runtime: 13</span><span id="57c0" class="ns ln in no b gy nx nu l nv nw">What package type would you like to use?<br/>        1 - Zip<br/>        2 - Image<br/>Package type: 2 (Note: You have to choose 2!!)</span><span id="e3ab" class="ns ln in no b gy nx nu l nv nw">Based on your selections, the only dependency manager available is pip.<br/>We will proceed copying the template using pip.</span><span id="1b1d" class="ns ln in no b gy nx nu l nv nw">Would you like to enable X-Ray tracing on the function(s) in your application?  [y/N]: N</span><span id="95cf" class="ns ln in no b gy nx nu l nv nw">Project name [sam-app]:</span></pre><p id="1c87" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">初始化后，我得到了这些文件夹和文件。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="02a8" class="ns ln in no b gy nt nu l nv nw">$ cd sam-app<br/>$ tree<br/>.<br/>├── README.md<br/>├── __init__.py<br/>├── events<br/>│   └── event.json<br/>├── hello_world<br/>│   ├── Dockerfile<br/>│   ├── __init__.py<br/>│   ├── app.py<br/>│   └── requirements.txt<br/>├── template.yaml<br/>└── tests<br/>    ├── __init__.py<br/>    └── unit<br/>        ├── __init__.py<br/>        └── test_handler.py</span></pre><p id="d50b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些文件在说明书中特别重要。</p><ul class=""><li id="16a7" class="mq mr in jm b jn jo jr js jv ms jz mt kd mu kh mv mw mx my bi translated">event.json 传递给 Lambda 函数的参数。例如，如果您想通过 S3 事件来触发它，这个参数必须包含一个桶名、一个对象键、它的一个版本或者类似的东西。</li><li id="dd98" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">app.py —代码作为函数运行。可以解析“event.json”中的对象。</li><li id="c94c" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">requirements.txt —您可以添加第三方库(例如 Pandas)。</li><li id="cdd5" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">template.yaml — SAM 模板(即 CloudFormation 的无服务器应用版本或 AWS 的无服务器应用的 IaC 模板)</li><li id="7bd9" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">Dockerfile —生成容器图像。它是在“template.yaml”中定义的。</li></ul><h1 id="8548" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">构建它并调用它</h1><p id="dc0f" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">您可以通过此命令构建一个函数；</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="d18c" class="ns ln in no b gy nt nu l nv nw">$ sam build</span></pre><p id="36ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最好使用这些选项。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="6603" class="ns ln in no b gy nt nu l nv nw">--use-container<br/>--skip-pull-image</span></pre><p id="1cff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">构建成功后，您可以通过该命令调用该函数。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="34cc" class="ns ln in no b gy nt nu l nv nw">$ sam local invoke HelloWorldFunction</span></pre><p id="e6cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“HelloWorldFunction”是这个 SAM 应用程序的名称，它在 template.yaml 中定义。</p><p id="00c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我得到了这个输出。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="00c0" class="ns ln in no b gy nt nu l nv nw">{"statusCode": 200, "body": "{\"message\": \"hello world\"}"}</span></pre><h1 id="0f4c" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">部署它</h1><p id="4317" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">现在我已经准备好第一次部署它了。</p><p id="442d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将此命令与“guided”参数一起使用，该参数将指导您完成部署。这个部署包括创建一个 ECR 存储库来存储每个部署的容器映像。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="8c43" class="ns ln in no b gy nt nu l nv nw">$ sam deploy --guided</span><span id="0def" class="ns ln in no b gy nx nu l nv nw">Configuring SAM deploy<br/>======================</span><span id="768f" class="ns ln in no b gy nx nu l nv nw">Looking for config file [samconfig.toml] :  Not found</span><span id="f3e3" class="ns ln in no b gy nx nu l nv nw">Setting default arguments for 'sam deploy'<br/>        =========================================<br/>        Stack Name [sam-app]: <br/>        AWS Region [us-east-1]: <br/>        #Shows you resources changes to be deployed and require a 'Y' to initiate deploy<br/>        Confirm changes before deploy [y/N]: n<br/>        #SAM needs permission to be able to create roles to connect to the resources in your template<br/>        Allow SAM CLI IAM role creation [Y/n]: y<br/>        #Preserves the state of previously provisioned resources when an operation fails<br/>        Disable rollback [y/N]: y<br/>        HelloWorldFunction may not have authorization defined, Is this okay? [y/N]: y<br/>        Save arguments to configuration file [Y/n]: y<br/>        SAM configuration file [samconfig.toml]: <br/>        SAM configuration environment [default]:</span><span id="cfc5" class="ns ln in no b gy nx nu l nv nw">Looking for resources needed for deployment:<br/>        Creating the required resources...<br/>        Successfully created!<br/>         Managed S3 bucket: aws-sam-cli-managed-default-samclisourcebucket-1dnqot9l267mn<br/>         A different default S3 bucket can be set in samconfig.toml<br/>         Image repositories: Not found.<br/>         #Managed repositories will be deleted when their functions are removed from the template and deployed<br/>         Create managed ECR repositories for all functions? [Y/n]: y</span></pre><p id="824f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">后来终于有了这个日志。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="4bb1" class="ns ln in no b gy nt nu l nv nw">Successfully created/updated stack - sam-app in us-east-1</span></pre><p id="5e4f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该功能已成功部署在我的 AWS 帐户中。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ny"><img src="../Images/46640d30c5806f208d270f97d166a9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8xG368dq8-Zk2CudPuCkw.png"/></div></div></figure><h1 id="51d7" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建代码提交存储库</h1><p id="0dbb" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">到目前为止，这仅仅是个开始。</p><p id="1f32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建您的 CodeCommit 库。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nz"><img src="../Images/fd483f116c2d8f0eed2292814602385d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhgaANAUPmGgOBhfi59gjw.png"/></div></div></figure><p id="bd03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在您的目录中运行这些命令(如果您在运行“sam init”时将它们保留为默认值，则应该是“/sam-app”)。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="44c0" class="ns ln in no b gy nt nu l nv nw">$ git init<br/>$ git remote add origin {your clone URL}<br/>$ git add .<br/>$ git commit -m "first commit"<br/>$ git push --set-upstream origin master</span></pre><p id="4a2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，它被成功地推送到远程存储库。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oa"><img src="../Images/38f4cf3fcf9df084a6e33764015595b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZIBmRSfjZn_Sy12d5vRLg.png"/></div></div></figure><h1 id="e7d6" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建代码构建项目</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ob"><img src="../Images/563d2b59c3cd35fedd2bab33b7ac1e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTxftA08k4upCKAvdLvz6w.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oc"><img src="../Images/f23fbdcd0d1860eefd7110a136a24939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RlsQxmTL-wPRhqxj2DQrg.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi od"><img src="../Images/b3ef344df5a6d89f05a40d32b37aae85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRU12mI7yrqFdia3hPNGog.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oc"><img src="../Images/bf43d3f1e60460a903ca685492a849d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiuGgezHvbZWQob7PBv0yg.png"/></div></div></figure><blockquote class="nf ng nh"><p id="5ff8" class="jk jl ni jm b jn jo jp jq jr js jt ju nj jw jx jy nk ka kb kc nl ke kf kg kh ig bi translated">注意:稍后我会提到“buildspec.yaml”。</p></blockquote><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oe"><img src="../Images/6e33945a1405eabba23862f51ac3edf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45a1d5aQnCz27ZxBuQGigw.png"/></div></div></figure><h1 id="97cd" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">在代码管道中创建 CI/CD 管道</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi of"><img src="../Images/191b45a75db308bdfefba3d8386c27a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Urjuhgw0qp7u8Pf9f1gm9g.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi og"><img src="../Images/2db05b1ea00fe007b1ccec94dd3c8f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Wd-hdq4IWwK_bNpV5_sWw.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oh"><img src="../Images/e04a7f59b2069d2f522966e1e12bbfc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AFsbilVZlVRhh5cbWRLJA.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi of"><img src="../Images/de37e2a3751b7e7e859f3ed45c8ec3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zf1xMRdh7HXftOBS3y--Jg.png"/></div></div></figure><p id="fc32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">管道在创建后立即自动开始执行，但忽略它(无论如何，它一定会失败)。</p><h1 id="e370" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">添加 buildspec.yaml</h1><p id="1189" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">正如您在构建项目中指定的，我们需要一个“buildspec.yaml”文件。这是构建的定义。</p><p id="65eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，它可能是这样的。它将在 python 3.9 上运行构建、调用和部署命令。将此文件放在应用程序的根目录中。</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="8565" class="ns ln in no b gy nt nu l nv nw">version: 0.2</span><span id="8259" class="ns ln in no b gy nx nu l nv nw">phases:<br/>  install:<br/>    runtime-versions:<br/>      python: 3.9<br/>  build:<br/>    commands:<br/>      - sam build --use-container<br/>  post_build:<br/>    commands:<br/>      - sam local invoke HelloWorldFunction<br/>      - sam deploy --force-upload</span></pre><p id="66a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，将其推送到存储库。</p><h1 id="5a19" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">更新生成项目的 IAM 角色</h1><p id="e820" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">要运行“buildspec.yaml”文件中的命令，我必须向构建项目的 IAM 角色授予适当的策略。</p><p id="3b9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过单击构建项目中的链接，可以跳转到 IAM 控制台。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oi"><img src="../Images/e892c4dc742d2b45beb97174b7be4b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uPzDbNAENd6x_BiiyUE1PQ.png"/></div></div></figure><p id="76e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当然，AWS 在最佳实践中说“授予最小特权”，但是为了简单起见，我将在这个指令中授予管理(即 FullAccess)权限。请确保此时它没有遵循最佳实践。</p><p id="ae2c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">构建项目需要构建项目和 SAM 命令应该访问的服务的权限。</p><ul class=""><li id="12d4" class="mq mr in jm b jn jo jr js jv ms jz mt kd mu kh mv mw mx my bi translated">希腊字母的第 11 个</li><li id="e318" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">云的形成</li><li id="20cb" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">electroniccashregister 电子现金出纳机</li><li id="a02c" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">S3</li><li id="8dfc" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">InternationalAssociationofMachinists 国际机械师协会</li></ul><h1 id="2571" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">CI/CD</h1><p id="86e5" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">当您推送到存储库时，管道会自动开始执行。如果您授予 IAM 适当的权限，它应该会成功结束。</p><blockquote class="nf ng nh"><p id="30a4" class="jk jl ni jm b jn jo jp jq jr js jt ju nj jw jx jy nk ka kb kc nl ke kf kg kh ig bi translated">N <!-- -->注:在这种情况下，组织 IAM 策略是非常困难的，所以请不要犹豫，通过一遍又一遍地推动“发布变更”和编辑 IAM 策略来进行试错。</p></blockquote><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oj"><img src="../Images/52550fc1b87f50e8a6fd8125e16460bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xYFNj1Jqp7_ozRm62dqmA.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ok"><img src="../Images/c18709a0e70628cea505834be1415f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yk-V7HY-p-HERMAoiej2kw.png"/></div></div></figure><p id="2206" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是实际使用的注意事项。</p><ul class=""><li id="c911" class="mq mr in jm b jn jo jr js jv ms jz mt kd mu kh mv mw mx my bi translated">限制从本地部署—不允许从您的笔记本电脑进行“sam 部署”)</li><li id="cd34" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">授予最小特权—这真的很难</li><li id="bd1f" class="mq mr in jm b jn mz jr na jv nb jz nc kd nd kh mv mw mx my bi translated">定义自动化测试—对于 CI/CD 是强制性的</li></ul></div></div>    
</body>
</html>