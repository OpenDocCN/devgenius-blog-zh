<html>
<head>
<title>Storybook for React — Globals and Addons and Stories</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React的故事书—全局、插件和故事</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/storybook-for-react-globals-and-addons-and-stories-36bb00af116f?source=collection_archive---------4-----------------------#2021-01-10">https://blog.devgenius.io/storybook-for-react-globals-and-addons-and-stories-36bb00af116f?source=collection_archive---------4-----------------------#2021-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/97a57bbad6dc4a3d37ad7aefd8b63be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eUd7-PFaX2Q9Dcjl"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@alekonpictures?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alekon pictures </a>拍摄于<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="517c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Storybook让我们可以用各种参数轻松地构建组件原型。</p><p id="aeb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用Storybook来处理globals。</p><h1 id="6ca2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在故事中使用全局变量</h1><p id="11f3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在一个故事里消费全局。</p><p id="b930" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们从story函数中获取<code class="fe me mf mg mh b">globals</code>属性。</p><p id="4dbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="c41e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">.storybook/preview.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="edc2" class="mq lc iq mh b gy mr ms l mt mu">export const globalTypes = {<br/>  locale: {<br/>    name: 'Locale',<br/>    description: 'locale',<br/>    defaultValue: 'en',<br/>    toolbar: {<br/>      icon: 'globe',<br/>      items: [<br/>        { value: 'en', right: '🇺🇸', title: 'English' },<br/>        { value: 'fr', right: '🇫🇷', title: 'Français' },<br/>        { value: 'zh', right: '🇨🇳', title: '中文' },<br/>      ],<br/>    },<br/>  },<br/>};</span></pre><p id="7bf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/stories/Button.stories.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c14a" class="mq lc iq mh b gy mr ms l mt mu">import React from 'react';</span><span id="2f56" class="mq lc iq mh b gy mv ms l mt mu">import { Button } from './Button';</span><span id="6760" class="mq lc iq mh b gy mv ms l mt mu">export default {<br/>  title: 'Example/Button',<br/>  component: Button,<br/>  argTypes: {<br/>    backgroundColor: { control: 'color' },<br/>  },<br/>};</span><span id="8c4f" class="mq lc iq mh b gy mv ms l mt mu">const getCaptionForLocale = (locale) =&gt; {<br/>  switch (locale) {<br/>    case 'en': return 'Hello';<br/>    case 'fr': return 'Bonjour';<br/>    case 'zh': return '你好';<br/>    default:<br/>      return 'Hello'<br/>  }<br/>}</span><span id="7e2c" class="mq lc iq mh b gy mv ms l mt mu">const Template = (args, { globals: { locale } }) =&gt; &lt;Button {...{ ...args, label: getCaptionForLocale(locale) }} /&gt;;</span></pre><p id="2076" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">.storybook/preview.js</code>文件定义了<code class="fe me mf mg mh b">locale</code>全局变量。</p><p id="8b67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">src/stories/Button.stories.js</code>文件中，我们用参数的<code class="fe me mf mg mh b">globals.locale</code>属性获得了<code class="fe me mf mg mh b">locale</code>全局属性。</p><p id="c897" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">right</code>属性是当我们将它连接到装饰器时，显示在工具栏菜单右侧的文本。</p><h1 id="a6bf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在插件中使用全局变量</h1><p id="ed3b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在一个附加文件中使用全局变量。</p><p id="7a0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f9b4" class="mq lc iq mh b gy mr ms l mt mu">import React from 'react';<br/>import { useGlobals } from '@storybook/api';<br/>import { addons, types } from '@storybook/addons';<br/>import { AddonPanel, Spaced, Title } from '@storybook/components';</span><span id="8c4b" class="mq lc iq mh b gy mv ms l mt mu">const LocalePanel = props =&gt; {<br/>  const [{ locale }] = useGlobals();</span><span id="4995" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;&gt;<br/>      &lt;style&gt;<br/>        {`<br/>        #panel-tab-content &gt; div &gt; div[hidden] {<br/>          display: flex !important<br/>        }<br/>      `}<br/>      &lt;/style&gt;<br/>      &lt;AddonPanel {...props}&gt;<br/>        &lt;Spaced row={3} outer={1}&gt;<br/>          &lt;Title&gt;{locale}&lt;/Title&gt;<br/>        &lt;/Spaced&gt;<br/>      &lt;/AddonPanel&gt;<br/>    &lt;/&gt;<br/>  );<br/>};</span><span id="20a7" class="mq lc iq mh b gy mv ms l mt mu">const ADDON_ID = 'locale-panel';<br/>const PANEL_ID = `${ADDON_ID}/panel`;</span><span id="5612" class="mq lc iq mh b gy mv ms l mt mu">addons.register(ADDON_ID, (api) =&gt; {<br/>  addons.add(PANEL_ID, {<br/>    type: types.PANEL,<br/>    title: 'Locale',<br/>    render: ({ active, key }) =&gt; {<br/>      return &lt;AddonPanel active={active} key={key}&gt;<br/>        &lt;LocalePanel /&gt;<br/>      &lt;/AddonPanel&gt;<br/>    },<br/>  });<br/>});</span></pre><p id="2535" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加一个插件，用<code class="fe me mf mg mh b">useGlobal</code>钩子获得全局属性。</p><p id="177e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">AddonPanel</code>、<code class="fe me mf mg mh b">Spaced</code>和<code class="fe me mf mg mh b">Title</code>属性来显示addon面板中的内容。</p><p id="da83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">方法注册了附加组件，这样它就会显示在故事书的附加组件面板中。</p><p id="6cd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们有<code class="fe me mf mg mh b">AddonPanel</code>来渲染面板。</p><p id="7f6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们显示带有<code class="fe me mf mg mh b">style</code>标签的面板时，我们让它显示出来。</p><h1 id="4499" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">故事渲染</h1><p id="7067" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以改变故事的呈现方式。</p><p id="39f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了添加到<code class="fe me mf mg mh b">head</code>标签，我们将HTML代码添加到<code class="fe me mf mg mh b">.storybook/preview-head.html</code>文件中:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="46cd" class="mq lc iq mh b gy mr ms l mt mu">&lt;link rel="stylesheet"<br/>    href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"<br/>    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"<br/>    crossorigin="anonymous"&gt;</span></pre><p id="f202" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后它们会显示在iframe内部的head标签中。</p><h1 id="ae39" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="3199" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用故事书添加我们自己的插件面板。</p><p id="a8e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以在iframe的head标签中添加标签。</p></div></div>    
</body>
</html>