<html>
<head>
<title>Making HTTP Requests with React Query — Mutations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React查询生成HTTP请求—突变</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-mutations-3f9e0b5ea1ca?source=collection_archive---------5-----------------------#2021-06-10">https://blog.devgenius.io/making-http-requests-with-react-query-mutations-3f9e0b5ea1ca?source=collection_archive---------5-----------------------#2021-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9f5193d39f5121b8fd96b7e20641f7f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t18U4vqGNEZjBV8x"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@miracleday?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Elena Mozhvilo </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="40e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React查询库让我们可以在React应用程序中轻松地发出HTTP请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query发出HTTP请求。</p><h1 id="4527" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">突变</h1><p id="f3a6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">突变允许我们通过创建、更新和删除HTTP请求来改变服务器上的数据。</p><p id="5dad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="75c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0b85" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="909b" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient();</span><span id="ec57" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="86a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c0db" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useMutation } from "react-query";</span><span id="1b29" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const { mutate, isLoading, isError, isSuccess } = useMutation((data) =&gt;<br/>    axios.post("https://jsonplaceholder.typicode.com/posts", data)<br/>  );</span><span id="b01c" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{isLoading &amp;&amp; "loading"}&lt;/div&gt;<br/>      &lt;div&gt;{isError &amp;&amp; "error"}&lt;/div&gt;<br/>      &lt;div&gt;{isSuccess &amp;&amp; "success"}&lt;/div&gt;<br/>      &lt;button<br/>        onClick={() =&gt; {<br/>          mutate({<br/>            title: "foo",<br/>            body: "bar",<br/>            userId: 1<br/>          });<br/>        }}<br/>      &gt;<br/>        Add Todo<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="cb36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用一个回调函数调用<code class="fe me mf mg mh b">useMutation</code>钩子，这个回调函数让我们向API发出POST请求以提交一些数据。</p><p id="f7fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回调应该返回一个承诺。</p><p id="7b84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请求有效载荷存储在<code class="fe me mf mg mh b">payload</code>参数中。</p><p id="2826" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">钩子返回让我们发出请求的<code class="fe me mf mg mh b">mutate</code>函数。</p><p id="970f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当请求正在加载时,<code class="fe me mf mg mh b">isLoading</code>为<code class="fe me mf mg mh b">true</code>。</p><p id="eb9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">isError</code>是请求失败时的<code class="fe me mf mg mh b">true</code>。</p><p id="d42c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当请求成功完成时<code class="fe me mf mg mh b">isSuccess</code>为<code class="fe me mf mg mh b">true</code>。</p><p id="aadd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，我们可以用属性<code class="fe me mf mg mh b">status</code>替换<code class="fe me mf mg mh b">isLoading</code>、<code class="fe me mf mg mh b">isSuccess</code>和<code class="fe me mf mg mh b">isError</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f21f" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useMutation } from "react-query";</span><span id="fb70" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const { mutate, status } = useMutation((data) =&gt;<br/>    axios.post("https://jsonplaceholder.typicode.com/posts", data)<br/>  );</span><span id="dd72" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{status === "loading" &amp;&amp; "loading"}&lt;/div&gt;<br/>      &lt;div&gt;{status === "error" &amp;&amp; "error"}&lt;/div&gt;<br/>      &lt;div&gt;{status === "success" &amp;&amp; "success"}&lt;/div&gt;<br/>      &lt;button<br/>        onClick={() =&gt; {<br/>          mutate({<br/>            title: "foo",<br/>            body: "bar",<br/>            userId: 1<br/>          });<br/>        }}<br/>      &gt;<br/>        Add Todo<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="156d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">'loading'</code>状态是加载请求时的状态。</p><p id="e805" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">'error'</code>状态是请求出错时的状态。</p><p id="e8d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">'success'</code>状态是请求成功时的状态。</p><h1 id="e457" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">重置突变状态</h1><p id="ab8f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在请求完成后清除变异请求状态。</p><p id="e1b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以调用<code class="fe me mf mg mh b">reset</code>方法:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="aa68" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React, { useState } from "react";<br/>import { useMutation } from "react-query";</span><span id="0b2a" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const { reset, mutate } = useMutation((data) =&gt;<br/>    axios.post("https://jsonplaceholder.typicode.com/posts", data)<br/>  );<br/>  const [title, setTitle] = useState("");</span><span id="7e09" class="mq lc iq mh b gy mv ms l mt mu">  const onCreateTodo = (e) =&gt; {<br/>    e.preventDefault();<br/>    mutate({<br/>      title<br/>    });<br/>  };</span><span id="8ac8" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;form onSubmit={onCreateTodo}&gt;<br/>        &lt;input<br/>          type="text"<br/>          value={title}<br/>          onChange={(e) =&gt; setTitle(e.target.value)}<br/>        /&gt;<br/>        &lt;br /&gt;<br/>        &lt;button type="submit"&gt;Create Todo&lt;/button&gt;<br/>        &lt;button type="button" onClick={() =&gt; reset()}&gt;<br/>          reset<br/>        &lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="2e23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们点击重置由<code class="fe me mf mg mh b">useMutation</code>钩子返回的状态时，我们调用<code class="fe me mf mg mh b">reset</code>方法。</p><h1 id="f26f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="44f9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用React Query <code class="fe me mf mg mh b">useMutation</code>钩子请求改变服务器上的数据。</p></div></div>    
</body>
</html>