<html>
<head>
<title>Azure Function &amp; Dependency Injection using Core Tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用核心工具的 Azure 功能和依赖注入</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/azure-function-dependency-injection-using-core-tools-b84656825df2?source=collection_archive---------7-----------------------#2022-12-13">https://blog.devgenius.io/azure-function-dependency-injection-using-core-tools-b84656825df2?source=collection_archive---------7-----------------------#2022-12-13</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div class="gi gj jo"><img src="../Images/f75b4c84f55f3d3400c57d231d56775a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*Siz-fsevcsr1lHp0NamVcw.png"/></div></figure><p id="a83e" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">昨天我<a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/developing-azure-functions-with-net-6-0-7-0-and-core-tools-48875ef3b85?sk=484b77fee2529294d30cf8afea83f238">写了</a>一篇关于使用核心工具编写功能 app 的文章。今天，我想扩展这个主题，在 Azure 函数中实现依赖注入。我将使用 Visual Studio 代码作为该项目的编辑器。</p><h1 id="0b59" class="ku kv ir bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Visual Studio 代码</h1><p id="763d" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated"><a class="ae kt" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>是一款用于软件开发的开源轻量级 IDE(集成开发环境)。它支持 Azure 功能的端到端开发，但我们只会将它用作编辑器。学习一项技术的最好方法是用最简单的方法来做，这就是为什么我避免在我的开源工作中使用 ide。</p><p id="6ea8" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">打开 Visual Studio 代码，使用快捷键“ctrl+k+o”打开 azure function 应用所在的文件夹。</p><figure class="ly lz ma mb gu js gi gj paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gi gj lx"><img src="../Images/3373da6467babd607b85702437a136a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q135l8roexdX6xuyQmMiHA.png"/></div></div></figure><h1 id="c9ad" class="ku kv ir bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建服务</h1><p id="4518" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated">我们将创建一个文件夹来保存我们的服务接口和实现。</p><figure class="ly lz ma mb gu js gi gj paragraph-image"><div class="gi gj mg"><img src="../Images/a509963118a28f88de1ddfcf80a7c44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*HlRtJ0hmvFk6w_Amywo3Yw.png"/></div></figure><p id="7e12" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">我们的服务类别代码</p><figure class="ly lz ma mb gu js"><div class="bz fq l di"><div class="mh mi l"/></div></figure><p id="901d" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">使用“<strong class="jx is">功能启动”</strong>命令测试应用程序。我们做这个测试是为了确保没有编译问题。</p></div><div class="ab cl mj mk hv ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ik il im in io"><h1 id="0d91" class="ku kv ir bd kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln mu lp lq lr bi translated">安装微软。Azure .函数.扩展</h1><p id="7df1" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated">在 PowerShell 上运行以下 dotnet CLI 命令来安装 NuGet 软件包。。Net core SDK 安装提供了 CLI 工具集，所以我们不需要为 CLI 工具安装任何额外的东西。</p><pre class="ly lz ma mb gu mv mw mx bn my mz bi"><span id="0a60" class="na kv ir mw b be nb nc l nd ne">dotnet add package Microsoft.Azure.Functions.Extensions --version 1.1.0</span></pre><p id="e0c0" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">目前，最新版本是 1.1.0，但它可能会改变；因此，请留意最新版本，并相应地更改命令。还有<a class="ae kt" href="https://www.nuget.org/packages/Microsoft.Azure.Functions.Extensions/" rel="noopener ugc nofollow" target="_blank">其他方式</a>添加这个 NuGet 包。我会建议花些时间用不同的方式教育自己。</p><p id="1752" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">添加包后，我们可以在 SampleProject.csproj 文件中看到一个引用。</p><figure class="ly lz ma mb gu js gi gj paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gi gj nf"><img src="../Images/1f0e4214e5dc0751a609eb24aa41d4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCxg9q9gWAR5sTYdfdizAg.png"/></div></div></figure></div><div class="ab cl mj mk hv ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ik il im in io"><h1 id="4df3" class="ku kv ir bd kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln mu lp lq lr bi translated">在 Startup.cs 中注册服务</h1><p id="5e63" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated">我们将创建一个启动类，将 IService 接口及其实现注册到<a class="ae kt" href="https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection" rel="noopener ugc nofollow" target="_blank">依赖注入容器</a>中。该类应实现 nuget 包 Microsoft . azure . functions . extensions 中的抽象类 FunctionsStartup。</p><p id="bc21" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">为了将我们的接口及其实现注册到 DI 容器中，我们将覆盖 Configure 方法并使用 IfunctionsHostBuilder 对象。</p><pre class="ly lz ma mb gu mv mw mx bn my mz bi"><span id="b912" class="na kv ir mw b be nb nc l nd ne">builder.Services.AddSingleton&lt;IService,Service&gt;();</span></pre><p id="16c2" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">您必须添加名称空间 Microsoft。Extensions.DependencyInjection 包能够在 IServiceCollection 类上使用 AddSignleton 方法。</p><p id="3a3e" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">最终的代码将如下所示:</p><figure class="ly lz ma mb gu js"><div class="bz fq l di"><div class="mh mi l"/></div></figure></div><div class="ab cl mj mk hv ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ik il im in io"><h1 id="c952" class="ku kv ir bd kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln mu lp lq lr bi translated">在 Azure 函数中注入服务</h1><p id="2d58" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated">我们将在 azure 函数中使用构造函数注入来调用 Service.cs 中的方法。</p><pre class="ly lz ma mb gu mv mw mx bn my mz bi"><span id="ad67" class="na kv ir mw b be nb nc l nd ne">private readonly IService _service;<br/>public function1 (IService service){<br/>    _service = service;<br/>}</span></pre><p id="3009" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">函数类的最终版本将如下所示:</p><figure class="ly lz ma mb gu js"><div class="bz fq l di"><div class="mh mi l"/></div></figure></div><div class="ab cl mj mk hv ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ik il im in io"><h1 id="688e" class="ku kv ir bd kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln mu lp lq lr bi translated">运行该功能</h1><p id="593c" class="pw-post-body-paragraph jv jw ir jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ik bi translated">使用命令“func start”运行该函数，我们将看到服务类的运行情况:</p><figure class="ly lz ma mb gu js gi gj paragraph-image"><div class="gi gj ng"><img src="../Images/0cca94579773f47e4eeed3645f0429b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*ai5zpqJRbtszN0EWMUzN4A.png"/></div></figure></div><div class="ab cl mj mk hv ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ik il im in io"><p id="0bea" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">页（page 的缩写）s-Medium 是一个阅读、写作和向其他作者学习的绝佳平台。如果你想加入我的旅程，今天就加入<a class="ae kt" href="https://tarunbhatt9784.medium.com/membership" rel="noopener"> medium </a>。</p></div></div>    
</body>
</html>