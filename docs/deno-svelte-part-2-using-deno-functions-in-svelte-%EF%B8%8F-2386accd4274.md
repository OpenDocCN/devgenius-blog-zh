# Deno + Svelte(ç¬¬ 2 éƒ¨åˆ†):åœ¨ Svelte â¤ï¸ä¸­ä½¿ç”¨ Deno å‡½æ•°ğŸ¦•

> åŸæ–‡ï¼š<https://blog.devgenius.io/deno-svelte-part-2-using-deno-functions-in-svelte-%EF%B8%8F-2386accd4274?source=collection_archive---------3----------------------->

![](img/f321f3ce740c35c51906498923074771.png)

åœ¨ä½ çš„è‹—æ¡åº”ç”¨ä¸­å®‰å…¨åœ°è¿è¡Œä»»ä½• JSã€TS æˆ– wasm

ä¸Šä¸€æ¬¡[æˆ‘å†™è¿™ä¸ªè¯é¢˜](https://douganderson444.medium.com/deno-svelte-compiled-frontend-without-package-headaches-d336f1a6555a)çš„æ—¶å€™ï¼Œè‹—æ¡çš„ç”Ÿæ€ç³»ç»Ÿè¿˜å¤„äºå®ƒçš„å©´å„¿æœŸã€‚æˆ‘ä»¬å¯ä»¥ç”¨ Deno ç¼–è¯‘ä¸€ä¸ªè‹—æ¡çš„è„šæœ¬ï¼Œä½†ä»…æ­¤è€Œå·²ã€‚

è‡ªç¬¬ä¸€ç¯‡æ–‡ç« ä»¥æ¥ï¼Œå·²ç»å‘ç”Ÿäº†ä¸€äº›å¾ˆå¥½çš„æ”¹è¿›:

1.  è‹—æ¡çš„ç”Ÿæ€ç³»ç»Ÿå·²ç»æˆé•¿ä¸ºæ›´å¥½åœ°æ”¯æŒ Deno(é€šè¿‡ [Snel](https://github.com/crewdevio/Snel) )ï¼Œå¹¶ä¸”
2.  æˆ‘å¯¹å¦‚ä½•ä¸æ¥è‡ª Svelte çš„ Deno äº’åŠ¨çš„æƒ³æ³•å·²ç»æˆç†Ÿã€‚

è®©æˆ‘ä»¬åœ¨è¿™äº›éƒ¨åˆ†ä¸­æè¿°æˆ‘çš„ç¼–ç ç»éªŒ:

**A éƒ¨åˆ†:Snelâ€”â€”ä½¿ç”¨ Deno æ„å»ºè‹—æ¡çš„åº”ç”¨ç¨‹åºï¼**

**B éƒ¨åˆ†:Snel â€”å°† Svelte è¿œç¨‹è¿æ¥åˆ° Deno**

**C éƒ¨åˆ†:ä½¿ç”¨æ¥è‡ª Svelte çš„ Deno æ–¹æ³•**

**A åŒºâ€” Snel**

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåœ¨ Deno ä¸­æ„å»ºè‹—æ¡åº”ç”¨çš„èŒèŠ½æ¡†æ¶: [Snel](https://github.com/crewdevio/Snel) ã€‚æˆ‘æƒ³å°è¯•åœ¨æ²¡æœ‰ä»»ä½• Nodejs äº¤äº’çš„æƒ…å†µä¸‹ï¼Œ100%ç”¨ Deno æ„å»ºè¿™ä¸ªè‹—æ¡çš„åº”ç”¨ç¨‹åºã€‚Snel æ˜¯æœ€æœ‰å¸Œæœ›çš„ç­”æ¡ˆã€‚

TLï¼›åšå£«:åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯æœ‰æ•ˆçš„ï¼ *å¤šåŠã€‚*

ä½¿ç”¨ Snel çš„åµŒå…¥å¼ Trex å·¥å…·æŒ‰ç…§ Snel çš„è¯´æ˜è¿›è¡Œæ“ä½œï¼Œå¯ä»¥è®©æ‚¨éå¸¸å¿«é€Ÿåœ°å®Œæˆä¸€ä¸ªé¡¹ç›®ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æƒ³åšä¸€äº›æ›´å¤æ‚çš„æ±‡æ€»å·¥ä½œ(æ¯”å¦‚ä½ çš„ç²¾ç®€ä»£ç ä¸­çš„ä¸€ä¸ªæ–‡ä»¶),é‚£ä¹ˆå¯¹ T2 æ’ä»¶å’Œ T3 çš„æ”¯æŒè¿˜ä¸å¤Ÿæˆç†Ÿã€‚ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¼å…¥ä¸€ä¸ª`json`æ–‡ä»¶æ˜¯ Snel å”¯ä¸€ä¸è®©æˆ‘åšçš„äº‹æƒ…ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒSnel ä¼¼ä¹ä¹Ÿä¸å…è®¸ä½ ä»ä½ çš„ç»†é•¿ä»£ç ä¸­è°ƒç”¨ [Deno.readFile](https://deno.land/manual/examples/read_write_files) (),æ‰€ä»¥æˆ‘å¯¹è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æœ‰ç‚¹å›°æƒ‘ã€‚æœ€åï¼Œæˆ‘åªæ˜¯å¤åˆ¶å¹¶ç²˜è´´äº†æˆ‘æ­£åœ¨å¯»æ‰¾çš„`json config data`å¹¶ç»§ç»­å‰è¿›ã€‚æˆ‘æƒ³å¾ˆå¿«ä¼šæœ‰ä¸€ä¸ªè§£å†³è¿™ç§å°äº‹çš„æ–¹æ³•ã€‚

**B éƒ¨åˆ†:Snel â€” Deno è¿æ¥**

å¥½äº†ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¯ä»¥ç”¨ Deno æ„å»ºçš„å·¥ä½œå‰ç«¯ã€‚ç°åœ¨æ˜¯æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†ï¼

æˆ‘ä»¬çŸ¥é“ Deno æœ€å¥½çš„ä¸€ç‚¹æ˜¯ï¼Œä½ å¯ä»¥ä»â€œnetâ€å’Œâ€œread/writeâ€è¿™æ ·çš„ç¯å¢ƒä¸­[ä¿æŠ¤ä½ çš„ JavaScript ä»£ç ](https://deno.land/manual@v1.10.1/getting_started/permissions),ä»¥çœŸæ­£ä¿æŒå¯¹å¯ç¼–ç¨‹è®¿é—®çš„æ§åˆ¶ã€‚è¿™åœ¨è¿è¡Œå…¶ä»–äººçš„ä»£ç (OPC)æ—¶å°¤å…¶é‡è¦ã€‚ç”šè‡³ ***æ›´é‡è¦çš„æ˜¯*** å½“ä½ ç”¨ ***ä½ çš„*** æ•°æ®è¿è¡Œåˆ«äººçš„ä»£ç æ—¶ã€‚æ‚¨æœ€ä¸å¸Œæœ›çœ‹åˆ°çš„æ˜¯ä¸€äº›å†…ç½®åŠŸèƒ½ã€æ·±åº¦åµŒå¥—çš„åº“æˆ– JavaScript bug å°†æ‚¨çš„ä¸ªäººä¿¡æ¯å·å·è½¬ç§»åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚

æˆ‘ä»¬å¸Œæœ›åœ¨ Deno ä¸­æ‰§è¡Œå…¶ä»–äººçš„ä»£ç (OPC ),ä½†æ˜¯åœ¨ CLI ä¹‹å¤–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‰ç«¯æ¥ä¸ Deno äº¤äº’â€”â€”å› ä¸º[æ²¡æœ‰ Deno æ ‡å‡† GUI](https://github.com/denoland/deno/discussions/3234)â€”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Svelte ä½œä¸ºæˆ‘ä»¬çš„ GUIï¼Œå¹¶å»ºç«‹å®¢æˆ·ç«¯-æœåŠ¡å™¨å…³ç³»æ¥ç›¸äº’äº¤äº’ã€‚

ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œä»æˆ‘ä»¬çº¤ç»†çš„æµè§ˆå™¨ä»£ç ä¸­è·å– Deno çš„å‘½ä»¤å’Œæ•°æ®ã€‚

**å›è½¦:è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)**

RPC å¾ˆé…·ï¼Œå°±åƒç”µå½±ã€Šé˜¿å‡¡è¾¾ã€‹ä¸­çš„[æˆ–è€…æ‰‹å¥—ç®±ã€‚ä½ åœ¨é‚£é‡Œå¾—åˆ°æ‰€æœ‰çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯çœŸçš„åœ¨é‚£é‡Œã€‚å®‰å…¨è·ç¦»å†…çš„åŠŸèƒ½ã€‚](https://www.imdb.com/title/tt0499549/)

![](img/70a75bb86fa360983a2773d01f87983b.png)

æ¥æº:[https://commons . wikimedia . org/wiki/File:S _ Krikalev _ with _ miniglovebox . jpg](https://commons.wikimedia.org/wiki/File:S_Krikalev_with_miniglovebox.jpg)

å°† RPC ä¸ Deno ä¸€èµ·ä½¿ç”¨ç»™äº†æˆ‘ä»¬æ‰€æœ‰æ¥è‡ªæµè§ˆå™¨çš„æ§åˆ¶ï¼Œä½†ä¹Ÿç»™äº†æˆ‘ä»¬ Deno æ‰€æœ‰çš„å®‰å…¨æ€§ã€‚

å¦å¤–:æˆ‘ä¹Ÿè€ƒè™‘è¿‡ç”¨å…¶ä»–æ–¹æ³•è¿›è¡Œè¯•éªŒï¼Œæ¯”å¦‚ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æˆ– Puppeteer æ¥ç¼–è¯‘ Deno ä¸­çš„ JS ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒJavaScript åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¢«å‰¥ç¦»ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç«™ç‚¹å˜æˆäº†ç›¸å½“é™æ€çš„ HTMLã€‚ä½¿ç”¨ RPCï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è·å¾—ç›¸å½“é«˜çš„ååº”æ€§ã€‚ç¨åæˆ‘å¯èƒ½ä¼šå†™å¦ä¸€ç¯‡å…³äº SSR/æœ¨å¶ç‰ˆæœ¬çš„æ–‡ç« ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ˜¯ä»¥ RPC æ–¹å¼è¿›è¡Œçš„ğŸ˜*ã€‚*

**RPC ç±»å‹:HTTP vs Websockets**

ç¬¬ä¸€ä¸ªå›°å¢ƒæ˜¯é€‰æ‹© HTTP POSTï¼Œè¿˜æ˜¯ç”¨ websocket æ¥å›è¿æ¥ï¼Ÿè€ƒè™‘ Deno è¿è¡Œçš„ç¯å¢ƒ:å¦‚æœä½ åœ¨æœ¬åœ°ä¸»æœºä¸Šè¿è¡Œ Denoï¼Œä½ å¯ä»¥ä½¿ç”¨ websocketsï¼Œå¦‚æœä½ æ˜¯ Cloudflares æŒä¹…å¯¹è±¡çš„å†…éƒ¨æµ‹è¯•ç”¨æˆ·ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ websocketsã€‚ä½†æ˜¯å¦‚æœä½ è¦åœ¨ Vercel å‡½æ•°æˆ–æ™®é€šçš„ Cloudflare Workers ä¸­ä½¿ç”¨ Denoï¼Œå®ƒä»¬ä¸æ”¯æŒ websocketsï¼Œæ‰€ä»¥ä½ ä¸èƒ½ä½¿ç”¨è¿™äº›å·¥å…·ã€‚

> æ‰€ä»¥ï¼Œç”±äº HTTP æ˜¯æœ€å°å…¬åˆ†æ¯ï¼Œæˆ‘é€‰æ‹©äº† HTTP POSTã€‚

*æ­¤å¤–:Deno ä¸­æœ€æ–°çš„åŸç”Ÿ HTTP æœåŠ¡å™¨(ä»¥åŠ Deno Oak æœåŠ¡å™¨)ä½¿ç”¨ Rust çš„ Hyper serverï¼Œ* [*æ”¯æŒ HTTP/2*](https://twitter.com/deno_land/status/1382049535782948870) *å› æ­¤ï¼Œå¦‚æœä½ çš„å‰ç«¯æ”¯æŒ HTTP/2ï¼Œä½ å°±æ˜¯æœªæ¥çš„ profã€‚*

æ—¢ç„¶æˆ‘ä»¬å·²ç»é€‰æ‹©äº†ä¸€ä¸ªåè®®ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡º RPC ç­‰å¼ã€‚æˆ‘é€‰æ‹©äº† [JSON-RPC](https://www.jsonrpc.org/) ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥éå¸¸ç®€å•æ˜“æ‡‚ã€‚

ä¸ºäº†è®¾ç½® Deno JSON RPCï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Deno æœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº† Deno çš„ [Oak æœåŠ¡å™¨](https://oakserver.github.io/oak/),å› ä¸ºå®ƒè®©è·¯ç”±å˜å¾—æ›´å®¹æ˜“ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æ‰§è¡Œï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Javascript + WebAssembly å‡½æ•°æ¥è¿”å›â€œç­”æ¡ˆâ€ç»™æˆ‘ä»¬ï¼Œå¹¶å°†å…¶å‘½åä¸º`getAnswer()`:

Deno Oak æœåŠ¡å™¨çš„ getAnswer()å¤„ç†ç¨‹åº

æˆ‘é€‰æ‹©æ‰§è¡Œ WebAssembly (wasm)æ¥è¯´æ˜ä¸€ä¸ªç›®çš„ã€‚ä»å­—èŠ‚ç æ¥çœ‹ï¼Œä½ çœŸçš„ä¸çŸ¥é“è¿™æ®µä»£ç åœ¨åšä»€ä¹ˆã€‚æ®ä½ æ‰€çŸ¥ï¼Œå®ƒä¼šæŠŠä½ çè´µçš„å·ç å‘é€åˆ°æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ã€‚

æœ€æ£’çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Deno ä¸­ä»¥æ— ä¿¡ä»»çš„æ–¹å¼è¿è¡Œè¿™ä¸ª JavaScript å’Œ WebAssembly ä»£ç ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ Deno ä¸å…è®¸è„šæœ¬è®¿é—®äº’è”ç½‘ï¼æˆ–è€…ç¡¬ç›˜ã€‚[é™¤éæˆ‘ä»¬è¿™ä¹ˆè¯´](https://deno.land/manual/getting_started/permissions)ã€‚

åœ¨è¿™ä¸ªåŸå‹çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å°†ä»äº’è”ç½‘ä¸Šè·å¾—è¿™ä¸ª`getAnswer`ä»£ç ï¼Œè€Œä¸å¿…è‡ªå·±ç¼–å†™ã€‚ä½†æ˜¯ä¸ºäº†ä¸¾ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè‡ªå·±è®¾ç½®ä¸€äº›ä¸œè¥¿ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ç­”æ¡ˆå¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬åªéœ€é€šè¿‡ Oak ä¸­çš„`.post()` è·¯ç”±è®¿é—®å®ƒï¼Œå¹¶ä½¿ç”¨ JSON-RPC è¿”å›å“åº”ã€‚è¿™ä¸ªæœåŠ¡å™¨è·¯ç”±æ‰€åšçš„å°±æ˜¯è·å–å‡½æ•°ï¼Œè¿è¡Œå®ƒï¼Œå¹¶å°†å“åº”è¿”å›ç»™æœåŠ¡å™¨ã€‚

**C éƒ¨åˆ†:åœ¨è‹—æ¡ä¸­ä½¿ç”¨ Deno æ–¹æ³•**

äº‹æƒ…è‹—æ¡çš„ä¸€é¢æ›´ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å®Œæˆäº† Deno é¢çš„å¤§éƒ¨åˆ†å¤„ç†ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ª`.js`æ–‡ä»¶ä¸­è®¾ç½® JSON-RPC æ–¹æ³•æ¥ä¸ºæˆ‘ä»¬æ‰§è¡Œå®é™…çš„è°ƒç”¨:

RPC å‡½æ•°å¯¹æœåŠ¡å™¨è¿›è¡Œ fetch è°ƒç”¨ï¼Œä¼ é€’ä»»ä½•å‚æ•°ã€‚`new [Proxy](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)` [æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ JavaScript å¯¹è±¡](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿæˆªå–å¹¶é‡æ–°å®šä¹‰è¯¥å¯¹è±¡çš„åŸºæœ¬æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å°†åŠ¨ä½œé‡å®šå‘åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯åœ¨æœ¬åœ°è°ƒç”¨å®ƒã€‚

ä¸ºäº†å°†è¿™ä¸ªè¿œç¨‹ RPC ä»£ç†å¯¼å…¥åˆ° Svelte ä¸­ï¼Œæˆ‘é€‰æ‹©å°†å®ƒåŒ…å«åœ¨å°† Svelte æ³¨å…¥åˆ° HTML é¡µé¢çš„`main.js` ä¸­ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥å°†å®ƒå¯¼å…¥åˆ°ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹ã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œ`App.svelte`å°±å¯ä»¥å°†æ–¹æ³•ä½œä¸ºå±æ€§(prop)ä½¿ç”¨ã€‚

ç°åœ¨åœ¨ç»†é•¿çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨æˆ‘ä»¬çš„ Deno TypeScript/JavaScript Wasm å‡½æ•°ï¼

é‚£æ˜¯éå¸¸æ¼‚äº®çš„ï¼ä»£ç åœ¨ Deno ä¸­å®‰å…¨æ‰§è¡Œï¼Œä½†åœ¨ Svelte ä¸­å¯ä»¥ç”¨ä½œæœ¬åœ°å‡½æ•°ã€‚

åˆ©ç”¨è¿™ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚æ¯”å¦‚ä»äº’è”ç½‘ä¸Šä¸‹è½½ä»£ç æ¥è¿è¡Œï¼Œåœ¨ Vercel ä¸­è®¾ç½® Deno å‡½æ•°ï¼Œè¿™æ ·è¿™äº›éƒ½å¯ä»¥æ— æœåŠ¡å™¨åœ°å®Œæˆ*ã€‚*æ— æœåŠ¡å™¨*æ˜¯å•è¯äº†å—ï¼Ÿ*

*æˆ‘ç›¸ä¿¡æˆ‘ä¼šåœ¨æœªæ¥çš„åŸºç¡€ä¸Šç»§ç»­åŠªåŠ›(æ‰€ä»¥ï¼Œç‚¹å‡»â€œå–œæ¬¢â€æŒ‰é’®ï¼Œè®¢é˜…ï¼Œç­‰ç­‰ï¼Œç­‰ç­‰ï¼Œæ›´æ–°)ã€‚*

> *æ‰€ä»¥ï¼Œç‚¹å‡»â€œå–œæ¬¢â€æŒ‰é’®ï¼Œè®¢é˜…ç­‰â€¦ç­‰â€¦æ›´æ–°*

*åœ¨æˆ‘ä¹‹å‰å…³äº Deno + Svelte çš„æ–‡ç« ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ç¼–è¯‘æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»ä»è¿™ä¸ªè®¾ç½®çš„ 1.0 ç‰ˆæœ¬èµ°äº†å¾ˆé•¿çš„è·¯ã€‚*

*å®Œæ•´çš„ä»£ç åœ¨è¿™é‡Œ:*

*[](https://github.com/DougAnderson444/deno-rpc) [## DougAnderson444/deno-rpc

### å— rpcseed å’Œ Snel çš„å¯å‘ï¼Œå¦‚æœæ‚¨æƒ³å¯¹æ•°æ®è¿è¡Œä¸å¯ä¿¡çš„ javascriptã€typescript æˆ– webassembly ä»£ç ï¼Œæ‚¨â€¦

github.com](https://github.com/DougAnderson444/deno-rpc)*