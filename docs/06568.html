<html>
<head>
<title>Analysis of Count Data in R in a small dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">小数据集R中计数数据分析</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/analysis-of-count-data-in-r-3345f5373695?source=collection_archive---------10-----------------------#2022-01-17">https://blog.devgenius.io/analysis-of-count-data-in-r-3345f5373695?source=collection_archive---------10-----------------------#2022-01-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="363d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">泊松和(负)二项分布</h2></div><p id="24a0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一个来自奶牛的商业数据示例，在此期间需要使用<a class="ae ky" href="https://medium.com/@marc.jacobs012/analyzing-ordinal-data-in-sas-poisson-and-negative-binomial-distribution-5f46b039aaeb" rel="noopener">泊松和负二项分布</a>来处理(离散)计数数据。因为它是商业的，我不能分享数据，但我会尽我所能展示它的结构。这样，这里显示的代码和分析应该发人深省，并适用于其他离散数据。尤其是因为数据很难建模。利用有限的数据，你可以做很多事情。</p><p id="cd87" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们首先加载我使用的库。从根本上说，你不需要所有的方法来分析数据集，但是R有多种方法来做同样的事情，但有时会更好一些。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="efd8" class="li lj in le b gy lk ll l lm ln">rm(list = ls())<br/>#### LIBRARIES ####<br/>library(readxl)<br/>library(foreign)<br/>library(lme4)<br/>library(ggplot2)<br/>library(rms)<br/>library(plyr)<br/>library(dplyr)<br/>library(Hmisc)<br/>library(data.table)<br/>library(reshape2)<br/>library(lubridate)<br/>library(boot)<br/>library(sjPlot)<br/>library(sjstats)<br/>library(sjmisc)<br/>library(psych)<br/>library(interval)<br/>library(data.table)<br/>library(effects)<br/>library(AICcmodavg)<br/>library(piecewiseSEM)<br/>require(parallel) <br/>library(scales)        <br/>library(gridExtra)<br/>library(coefplot) <br/>library(coda)      <br/>library(aods3)     <br/>library(plotMCMC) <br/>library(bbmle)     <br/>library(nlme)<br/>library(MCMCglmm)<br/>library(merTools)<br/>library(RLRsim) <br/>library(pbkrtest)<br/>library(blme)<br/>library(MASS)<br/>library(multcomp)<br/>library(splines)<br/>library(car)<br/>library(bbmle)</span></pre><p id="20e4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看数据本身。它描述了药物在奶牛身上的使用和测量结果:</p><ol class=""><li id="8004" class="lo lp in ke b kf kg ki kj kl lq kp lr kt ls kx lt lu lv lw bi translated">治疗日期</li><li id="564d" class="lo lp in ke b kf lx ki ly kl lz kp ma kt mb kx lt lu lv lw bi translated">治疗次数</li><li id="5cb0" class="lo lp in ke b kf lx ki ly kl lz kp ma kt mb kx lt lu lv lw bi translated">健康事件的数量</li></ol><p id="d0c4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所有都是离散计数数据。不易建模。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9538" class="li lj in le b gy lk ll l lm ln">#### DATA IMPORT &amp; MANAGEMENT ####  <br/>drug_use &lt;- read_excel("drug use.xlsx",sheet = "for SAS")<br/>str(drug_use)<br/>drug_use$TREATMENT&lt;-as.factor(drug_use$TREATMENT)<br/>drug_use$NO_OF_HEALTHEVENTS&lt;-as.integer(drug_use$NO_OF_HEALTHEVENTS)<br/>drug_use$fGROUP&lt;-as.factor(drug_use$GROUP)<br/>drug_use$fBLOCK&lt;-as.factor(drug_use$BLOCK)<br/>drug_use$DT_prop&lt;-drug_use$DAYS_OF_TREATMENT/30<br/>drug_use$DT_N&lt;-rep(30,length(drug_use$IR))<br/>drug_use$ID&lt;-rownames(drug_use)<br/>str(drug_use)<br/>head(drug_use)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mc"><img src="../Images/8c845be85d5d5b3faa5af4f9321feb9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YONVwuMazni8lkCxovOFGA.png"/></div></div></figure><p id="41b9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您开始使用直方图绘制数据时，这一点变得非常清楚。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d6f4" class="li lj in le b gy lk ll l lm ln">#### DATA EXPLORATION ####<br/>### Days of treatment<br/>histogram(~drug_use$DAYS_OF_TREATMENT|drug_use$TREATMENT)<br/>histogram(~drug_use$DAYS_OF_TREATMENT|drug_use$fBLOCK)<br/>histogram(~drug_use$DAYS_OF_TREATMENT|drug_use$fGROUP)</span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/c34c81ee5239e05fefd803710774b8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*IrMjZc7u6D8cY-CaEr4w7Q.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/722e10f411ebc60359803fd24b95ba2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*tCR-zBAAWiNijmtAK1Xn2A.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/f183b4b9e8fee14ea94f3be960423757.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*W3leSC5du_8f7hSma4jgKA.png"/></div></figure></div><p id="c1ff" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，计数数据传统上使用泊松模型，但正如我们大多数人所知，它是一个有限的分布，因为均值和方差是相互绑定的。让我们看看这些数据，看看我们能否估计出哪种离散分布能够描述我们所看到的情况。</p><p id="2716" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我选择了:</p><ol class=""><li id="a369" class="lo lp in ke b kf kg ki kj kl lq kp lr kt ls kx lt lu lv lw bi translated">正态(<em class="mq">我知道它是连续的，应用于离散数据会低估方差，但如果它适合，我可能会选择贝塔或伽玛分布</em>)。</li><li id="c056" class="lo lp in ke b kf lx ki ly kl lz kp ma kt mb kx lt lu lv lw bi translated">泊松</li><li id="efd1" class="lo lp in ke b kf lx ki ly kl lz kp ma kt mb kx lt lu lv lw bi translated">负二项式</li><li id="d768" class="lo lp in ke b kf lx ki ly kl lz kp ma kt mb kx lt lu lv lw bi translated">二项式</li></ol><p id="d23d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们计算均值-方差比。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6e12" class="li lj in le b gy lk ll l lm ln">var(drug_use$DAYS_OF_TREATMENT)/mean(drug_use$DAYS_OF_TREATMENT) # 5.157128<br/>sd(drug_use$DAYS_OF_TREATMENT)/mean(drug_use$DAYS_OF_TREATMENT) # 1.153634<br/>mean(drug_use$DAYS_OF_TREATMENT) # 3.875</span></pre><p id="fbf2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于<em class="mq">日的治疗</em>，方差比平均值高5倍。如果泊松曲线符合的话，我会很惊讶。然而，如果它会，它将严重低估数据的方差。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2a41" class="li lj in le b gy lk ll l lm ln">par(mfrow=c(5,2), oma = c(0, 0, 2, 0))<br/>nbinom &lt;- fitdistr(drug_use$DAYS_OF_TREATMENT, "negative binomial")<br/>npoiss &lt;- fitdistr(drug_use$DAYS_OF_TREATMENT, "Poisson")<br/>hist(drug_use$DAYS_OF_TREATMENT,xlab="Count", ylab="Frequency", main="Observed distribution")<br/>qqp(drug_use$DAYS_OF_TREATMENT, cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Normal distribution")<br/>hist(rpois(32,npoiss[[1]][[1]]),xlab="Count", ylab="Frequency", main="Simulated Poisson distribution")<br/>qqp(drug_use$DAYS_OF_TREATMENT, "pois", lambda=npoiss[[1]][[1]],cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Poisson distribution")<br/>hist(rnbinom(32, size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]]),cex=2,xlab="Count", ylab="Frequency", main="Simulated Negative Binomial distribution")<br/>qqp(drug_use$DAYS_OF_TREATMENT, "nbinom", size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]],cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Negative Binomial distribution")<br/>hist(rbinom(32, size = 30, prob=sum(drug_use$DAYS_OF_TREATMENT)/sum(drug_use$DT_N)),cex=2,xlab="Count", ylab="Frequency", main="Simulated Binomial distribution")<br/>qqp(drug_use$DAYS_OF_TREATMENT, "binom", size=30, prob=sum(drug_use$DAYS_OF_TREATMENT)/sum(drug_use$DT_N),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution")<br/>qqp(drug_use$DAYS_OF_TREATMENT[drug_use$TREATMENT=="A"], "binom", size=30, prob=sum(drug_use$DAYS_OF_TREATMENT[drug_use$TREATMENT=="A"])/sum(drug_use$DT_N[drug_use$TREATMENT=="A"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment A")<br/>qqp(drug_use$DAYS_OF_TREATMENT[drug_use$TREATMENT=="B"], "binom", size=30, prob=sum(drug_use$DAYS_OF_TREATMENT[drug_use$TREATMENT=="B"])/sum(drug_use$DT_N[drug_use$TREATMENT=="B"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment B")<br/>mtext("Probable Distributions for Days of Treatment", outer=TRUE, side=3, cex = 1.5)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mr"><img src="../Images/288883ebbef8413e58b56f9a039dac56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4gK0xfLhpuGXtzvzu9fjA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">(负)二项式似乎非常适合。</figcaption></figure><p id="0913" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，可能有点矫枉过正，看看均值和方差的关系(跨区块——这是一个<a class="ae ky" href="https://medium.com/@marc.jacobs012/building-and-optimizing-randomized-complete-block-designs-using-sas-c973d127d862" rel="noopener">随机完整区块</a>研究),看看几个分布如何处理自己。不难看出小样本量是如何限制推断的。然而，它清楚地表明，泊松分布不是一个很好的拟合。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="986e" class="li lj in le b gy lk ll l lm ln">mvtab &lt;- ddply(drug_use,<br/>               .(fBLOCK),<br/>               summarise,<br/>               callmean=mean(DAYS_OF_TREATMENT),<br/>               callvar=var(DAYS_OF_TREATMENT))</span><span id="4ae4" class="li lj in le b gy mw ll l lm ln">qplot(callmean,callvar,data=mvtab)+theme_bw()+<br/>  geom_smooth(aes(colour="NB1"), method="lm",formula=y~x-1, alpha=0.5)+ geom_smooth(aes(colour="LOESS"), alpha=0.5)+ geom_smooth(aes(colour="NB2"),method="lm",formula=y~I(x^2)+offset(x)-1, alpha=0.5)+ geom_abline(aes(colour="POISSON"), intercept=0,slope=1, colour="orange")+ scale_colour_manual(name="Fit",values=c(NB1="blue", <br/>                               LOESS="red", <br/>                               NB2="purple", <br/>                               POISSON="orange"))+<br/>  guides(color=guide_legend(override.aes=list(fill=NA)))</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mx"><img src="../Images/15053bdfd26038f95858ed990be5cfe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c18snBsiTT9ZiHEHR7B2LA.png"/></div></div></figure><p id="d7e4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看作为结果所需的<em class="mq">治疗数量</em>。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d284" class="li lj in le b gy lk ll l lm ln">### Number of treatments<br/>histogram(~drug_use$NO_OF_TREATMENTS|drug_use$TREATMENT)<br/>histogram(~drug_use$NO_OF_TREATMENTS|drug_use$fBLOCK)<br/>histogram(~drug_use$NO_OF_TREATMENTS|drug_use$fGROUP)</span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/be2f901fd1d58428109235784393a5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FgGJyEHuzuSLq8crw9EAzQ.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/0f8cc4f44a31c25c204bde491c9293c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MoS39OCJNGKPS-5AJYIe_w.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/0f8cc4f44a31c25c204bde491c9293c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MoS39OCJNGKPS-5AJYIe_w.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk my di mz na translated">不容易建模。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="86c1" class="li lj in le b gy lk ll l lm ln">var(drug_use$NO_OF_TREATMENTS/mean(drug_use$NO_OF_TREATMENTS) # 2.6<br/>sd(drug_use$NO_OF_TREATMENTS)/mean(drug_use$NO_OF_TREATMENTS) # 0.9<br/>mean(drug_use$NO_OF_TREATMENTS) # 3.3</span><span id="5da6" class="li lj in le b gy mw ll l lm ln">par(mfrow=c(5,2), oma = c(0, 0, 2, 0))<br/>nbinom &lt;- fitdistr(drug_use$NO_OF_TREATMENTS, "negative binomial")<br/>npoiss &lt;- fitdistr(drug_use$NO_OF_TREATMENTS, "Poisson")<br/>hist(drug_use$NO_OF_TREATMENTS,xlab="Count", ylab="Frequency", main="Observed distribution")<br/>qqp(drug_use$NO_OF_TREATMENTS, cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Normal distribution")<br/>hist(rpois(32,npoiss[[1]][[1]]),xlab="Count", ylab="Frequency", main="Simulated Poisson distribution")<br/>qqp(drug_use$NO_OF_TREATMENTS, "pois", lambda=npoiss[[1]][[1]],cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Poisson distribution")<br/>hist(rnbinom(32, size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]]),cex=2,xlab="Count", ylab="Frequency", main="Simulated Negative Binomial distribution")<br/>qqp(drug_use$NO_OF_TREATMENTS, "nbinom", size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]],cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Negative Binomial distribution")<br/>hist(rbinom(32, size = 30, prob=sum(drug_use$NO_OF_TREATMENTS)/sum(drug_use$DT_N)),cex=2,xlab="Count", ylab="Frequency", main="Simulated Binomial distribution")<br/>qqp(drug_use$NO_OF_TREATMENTS, "binom", size=30, prob=sum(drug_use$NO_OF_TREATMENTS)/sum(drug_use$DT_N),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution")<br/>qqp(drug_use$NO_OF_TREATMENTS[drug_use$TREATMENT=="A"], "binom", size=30, prob=sum(drug_use$NO_OF_TREATMENTS[drug_use$TREATMENT=="A"])/sum(drug_use$DT_N[drug_use$TREATMENT=="A"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment A")<br/>qqp(drug_use$NO_OF_TREATMENTS[drug_use$TREATMENT=="B"], "binom", size=30, prob=sum(drug_use$NO_OF_TREATMENTS[drug_use$TREATMENT=="B"])/sum(drug_use$DT_N[drug_use$TREATMENT=="B"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment B")<br/>mtext("Probable Distributions for Number of Treatments", outer=TRUE, side=3, cex = 1.5)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nb"><img src="../Images/104eb76dcf99a4f918ab38b1e631cf50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZtT4EQZgd-WsfAGQ4ZW7Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">可以用几种分布来模拟。</figcaption></figure><p id="cd4f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，让我们看看健康事件的<em class="mq">数量。</em></p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="27e5" class="li lj in le b gy lk ll l lm ln">### Number of health events<br/>histogram(~drug_use$NO_OF_HEALTHEVENTS|drug_use$TREATMENT)<br/>histogram(~drug_use$NO_OF_HEALTHEVENTS|drug_use$fBLOCK)<br/>histogram(~drug_use$NO_OF_HEALTHEVENTS|drug_use$fGROUP)</span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/9a7c492e701415278908022812a4ea2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FEE_olV99R45KEpUilVu7g.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/e77b683c494149e31993b6aec0c68235.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*eoVxTO__ixBYkVVNWwRJ3g.png"/></div></figure><figure class="mk md ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/4888998d7471735df12b1c917fba5242.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ftBalhxFrTPkSviFjA1WTw.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk my di mz na translated">似乎更容易一些，至少在不同的治疗中。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="c1be" class="li lj in le b gy lk ll l lm ln">var(drug_use$NO_OF_HEALTHEVENTS)/mean(drug_use$NO_OF_HEALTHEVENTS) 1.062035 <br/>sd(drug_use$NO_OF_HEALTHEVENTS)/mean(drug_use$NO_OF_HEALTHEVENTS) 0.8084305<br/>mean(drug_use$NO_OF_HEALTHEVENTS) <br/>1.625</span><span id="3077" class="li lj in le b gy mw ll l lm ln">par(mfrow=c(5,2), oma = c(0, 0, 2, 0))<br/>nbinom &lt;- fitdistr(drug_use$NO_OF_HEALTHEVENTS, "negative binomial")<br/>npoiss &lt;- fitdistr(drug_use$NO_OF_HEALTHEVENTS, "Poisson")<br/>hist(drug_use$NO_OF_HEALTHEVENTS,xlab="Count", ylab="Frequency", main="Observed distribution")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS, cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Normal distribution")<br/>hist(rpois(32,npoiss[[1]][[1]]),xlab="Count", ylab="Frequency", main="Simulated Poisson distribution")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS, "pois", lambda=npoiss[[1]][[1]],cex=2,xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Poisson distribution")<br/>hist(rnbinom(32, size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]]),cex=2,xlab="Count", ylab="Frequency", main="Simulated Negative Binomial distribution")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS, "nbinom", size = nbinom$estimate[[1]], mu = nbinom$estimate[[2]],cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Negative Binomial distribution")<br/>hist(rbinom(32, size = 30, prob=sum(drug_use$NO_OF_HEALTHEVENTS)/sum(drug_use$DT_N)),cex=2,xlab="Count", ylab="Frequency", main="Simulated Binomial distribution")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS, "binom", size=30, prob=sum(drug_use$NO_OF_HEALTHEVENTS)/sum(drug_use$DT_N),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS[drug_use$TREATMENT=="A"], "binom", size=30, prob=sum(drug_use$NO_OF_HEALTHEVENTS[drug_use$TREATMENT=="A"])/sum(drug_use$DT_N[drug_use$TREATMENT=="A"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment A")<br/>qqp(drug_use$NO_OF_HEALTHEVENTS[drug_use$TREATMENT=="B"], "binom", size=30, prob=sum(drug_use$NO_OF_HEALTHEVENTS[drug_use$TREATMENT=="B"])/sum(drug_use$DT_N[drug_use$TREATMENT=="B"]),cex=2, xlab="Theoretical Quantiles", ylab="Emperical Quantiles", main="Binomial distribution Treatment B")<br/>mtext("Probable Distributions for Number of Health Events", outer=TRUE, side=3, cex = 1.5)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nc"><img src="../Images/99309ecd7a6d358fbf0a29e8016641eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mX5xHyfmg7AmovsdhxomUA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">两个二项式(负的和正的)在这里都可以实现。</figcaption></figure><p id="7229" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们使用泊松建立第一个治疗日的模型，其中我假设均值和方差相等。这使得泊松分布成为最容易处理的分布之一，但它很少(如果有的话)做到这一点。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6d09" class="li lj in le b gy lk ll l lm ln">fit.poisson&lt;-glmer(DAYS_OF_TREATMENT~TREATMENT+(1|fGROUP/fBLOCK), <br/>                   data=drug_use, <br/>                   family="poisson"(link = "log"))<br/>summary(fit.poisson)</span><span id="efec" class="li lj in le b gy mw ll l lm ln">Generalized linear mixed model fit by maximum likelihood (Laplace<br/>  Approximation) [glmerMod]<br/> Family: poisson  ( log )<br/>Formula: DAYS_OF_TREATMENT ~ TREATMENT + (1 | fGROUP/fBLOCK)<br/>   Data: drug_use</span><span id="5b2a" class="li lj in le b gy mw ll l lm ln">AIC      BIC   logLik deviance df.resid <br/>   182.0    187.8    -87.0    174.0       28</span><span id="a88d" class="li lj in le b gy mw ll l lm ln">Scaled residuals: <br/>    Min      1Q  Median      3Q     Max <br/>-1.9755 -1.1386 -0.2341  0.5595  4.1493</span><span id="d386" class="li lj in le b gy mw ll l lm ln">Random effects:<br/> Groups        Name        Variance Std.Dev.<br/> fBLOCK:fGROUP (Intercept) 0.1574   0.3967  <br/> fGROUP        (Intercept) 0.2020   0.4495  <br/>Number of obs: 32, groups:  fBLOCK:fGROUP, 16; fGROUP, 4</span><span id="96dc" class="li lj in le b gy mw ll l lm ln">Fixed effects:<br/>            Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)   0.5771     0.3037   1.900   0.0574 .  <br/>TREATMENTB    0.9734     0.1980   4.916 8.83e-07 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="38cc" class="li lj in le b gy mw ll l lm ln">Correlation of Fixed Effects:<br/>           (Intr)<br/>TREATMENTB -0.473</span></pre><p id="520e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从一开始就开始尝试负二项式。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="177f" class="li lj in le b gy lk ll l lm ln">fit.nb&lt;-glmer.nb(DAYS_OF_TREATMENT~TREATMENT+(1|fGROUP), <br/>                 data=drug_use,<br/>                 control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>summary(fit.nb)<br/>Generalized linear mixed model fit by maximum likelihood (Laplace<br/>  Approximation) [glmerMod]<br/> Family: Negative Binomial(1.3084)  ( log )<br/>Formula: DAYS_OF_TREATMENT ~ TREATMENT + (1 | fGROUP)<br/>   Data: drug_use<br/>Control: glmerControl(optimizer = "bobyqa", nAGQ = 10)</span><span id="d483" class="li lj in le b gy mw ll l lm ln">AIC      BIC   logLik deviance df.resid <br/>   160.2    166.1    -76.1    152.2       28</span><span id="4913" class="li lj in le b gy mw ll l lm ln">Scaled residuals: <br/>    Min      1Q  Median      3Q     Max <br/>-0.9323 -0.8156 -0.3945  0.5203  2.7030</span><span id="2e66" class="li lj in le b gy mw ll l lm ln">Random effects:<br/> Groups Name        Variance Std.Dev.<br/> fGROUP (Intercept) 0.08269  0.2876  <br/>Number of obs: 32, groups:  fGROUP, 4</span><span id="4807" class="li lj in le b gy mw ll l lm ln">Fixed effects:<br/>            Estimate Std. Error z value Pr(&gt;|z|)  <br/>(Intercept)   0.7179     0.3179   2.258   0.0239 *<br/>TREATMENTB    0.9311     0.3754   2.480   0.0131 *<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="818b" class="li lj in le b gy mw ll l lm ln">Correlation of Fixed Effects:<br/>           (Intr)<br/>TREATMENTB -0.633</span></pre><p id="d339" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，是时候比较泊松和负二项式模型了。泊松嵌套在负二项式中，因为过度离差参数在负二项式中估计，但在泊松中保持不变。负二项式更适合。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8e5d" class="li lj in le b gy lk ll l lm ln">pchisq(2 * (logLik(fit.nb) - logLik(fit.poisson)), df = 1, lower.tail = FALSE) </span><span id="3fa8" class="li lj in le b gy mw ll l lm ln">'log Lik.' 3.070599e-06 (df=4)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/5a14deca061703f489e3614dda6ebde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*o8wtYskUv-b0l_90kDFsDA.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">ICtab(fit.poisson，fit.nb)</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="21be" class="li lj in le b gy lk ll l lm ln">require(jtools)<br/>jtools::plot_summs(fit.poisson, fit.nb, scale = TRUE, <br/>                   plot.distributions = TRUE,<br/>                   model.names=c("Poisson", "Negative Binomial"))<br/>export_summs(fit.poisson, fit.nb, scale = TRUE,model.names=c("Poisson", "Negative Binomial"))</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ne"><img src="../Images/0ecb3e265e1b073e736a2741244bd0ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXhukuGALBFb2AXgX-zDhA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">泊松的过度离差在这里清楚地显示出来，它的参数分布小得不合理，如果您绑定均值和方差，这种情况经常发生。</figcaption></figure><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nf"><img src="../Images/79de9545ea282a073a3dc7e27df10584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zPSzfx3VqELHjESB_0rrg.png"/></div></div></figure><p id="04d9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们继续尝试使用比例来拟合药物数据。因为每天都有记录，所以我们有固定的天数，因此有固定的试验次数(30)。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7a87" class="li lj in le b gy lk ll l lm ln">fit.DT&lt;-glmer(DAYS_OF_TREATMENT/DT_N~TREATMENT+<br/>           (1|fGROUP/fBLOCK),<br/>         data=drug_use,<br/>         weight=DT_N,<br/>         family="binomial", <br/>         control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>print(fit.DT, corr=FALSE)<br/>summary(fit.DT)<br/>plot_model(fit.DT)<br/>tab_model(fit.DT)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ng"><img src="../Images/2374ce0b4b0e31069cbe01c97cbbce02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3t8V128cheBXYOgWxXS34w.png"/></div></div></figure><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nh"><img src="../Images/ff02fbe4c265bbdda7d80d2363c65a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W7hTiK1czJIQpn42IPT3lw.png"/></div></div></figure><figure class="kz la lb lc gt md gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a91c31174ba9ab70585076c3681055f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*q67hxMV1UntqawG-BvkhoQ.png"/></div></figure><p id="a050" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们来看看第二个模型，包括一个随机ID，它自动成为一个准二项式模型。我在这里所做的是通过将行号作为随机效应(即一个<a class="ae ky" href="https://medium.com/mlearning-ai/introduction-to-mixed-models-in-r-9c017fd83a63" rel="noopener">正态分布方差分量</a>)来模拟每个观察值之间的额外方差。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b47f" class="li lj in le b gy lk ll l lm ln">fit.DT2&lt;-glmer(DAYS_OF_TREATMENT/DT_N~TREATMENT+<br/>            (1|fGROUP/fBLOCK)+(1|ID),<br/>          data=drug_use,<br/>          weight=DT_N,<br/>          family="binomial", <br/>          control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>anova(fit.DT,fit.DT2) # m2 better so overdispersion<br/>exp(confint(fit.DT2)) # profile confidence intervals of odds ratio</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/cfe5c86a73c5517f83499171daae7d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*yAglz-VtqzTm6myS8ch4OQ.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">第二款表现更好！</figcaption></figure><p id="1fe2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们开始分析处理的<em class="mq">数量</em>，并将它们建模为比例。不要忘记，早期的评估似乎暗示了在建模<em class="mq">治疗数量</em>结果时每个二项分布的有效性。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="3526" class="li lj in le b gy lk ll l lm ln">drug_use$NT_prop&lt;-drug_use$NO_OF_TREATMENTS/30<br/>fit.NT&lt;-glmer(NO_OF_TREATMENTS/DT_N~TREATMENT+<br/>           (1|fGROUP/fBLOCK),<br/>         data=drug_use,<br/>         weight=DT_N,<br/>         family="binomial", <br/>         control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>summary(fit.NT)</span><span id="51b3" class="li lj in le b gy mw ll l lm ln">fit.NT2&lt;-glmer(NO_OF_TREATMENTS/DT_N~TREATMENT+<br/>                (1|fGROUP/fBLOCK) +(1|ID), # not a great fit, because BLOCK nested in Group already gives unique values <br/>              data=drug_use,<br/>              weight=DT_N,<br/>              family="binomial", <br/>              control = glmerControl(optimizer = "bobyqa", <br/>nAGQ = 10))<br/>summary(fit.NT2)<br/>table(drug_use$GROUP, drug_use$BLOCK)<br/>exp(fixef(fit.NT))-exp(fixef(fit.NT2))<br/>exp(confint(fit.NT))<br/>exp(confint(fit.NT2))<br/>AICtab(fit.NT, fit.NT2)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nk"><img src="../Images/6abba56ec2e606a79a364252cec24e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9oFah3g0ktFEiOg40_6xQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">同样在这里，添加一个由行观察值组成的随机组件似乎做得更好。</figcaption></figure><p id="cb5c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我正在向<em class="mq">个卫生事件</em>个结果迈进。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="a5da" class="li lj in le b gy lk ll l lm ln">drug_use$HE_prop&lt;-drug_use$NO_OF_HEALTHEVENTS/drug_use$DT_N<br/>hist(drug_use$HE_prop)<br/>fit.HE&lt;-glmer(drug_use$HE_prop/DT_N~TREATMENT+<br/>                (1|fGROUP),<br/>              data=drug_use,<br/>              weight=DT_N,<br/>              family="binomial", <br/>              control = glmerControl(optimizer = "bobyqa", nAGQ = 1))<br/>summary(fit.HE)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nl"><img src="../Images/8ef6feb6ac5e9d199954376ec5bdaede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsmITomvMNJ-mUQoaReWQw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">红色是一种可爱的颜色，但我不喜欢在这里看到它。每当有关于黑森的问题，你必须非常小心地处理结果。其实就别管结果了。</figcaption></figure><p id="798d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我将利用之前的失败来看看我是应该将所有东西放在一起还是通过随机组件<em class="mq">块</em>进行分析。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6696" class="li lj in le b gy lk ll l lm ln">fit.HE.pooled&lt;-glm(cbind(NO_OF_HEALTHEVENTS, DT_N-NO_OF_HEALTHEVENTS)~TREATMENT, family="binomial", data=drug_use)</span><span id="e394" class="li lj in le b gy mw ll l lm ln">fit.HE.unpooled&lt;-glm(cbind(NO_OF_HEALTHEVENTS, DT_N-NO_OF_HEALTHEVENTS)~TREATMENT+as.factor(BLOCK)+as.factor(GROUP), family="binomial", data=drug_use)</span><span id="4ea5" class="li lj in le b gy mw ll l lm ln">anova(fit.HE.pooled, fit.HE.unpooled)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nm"><img src="../Images/0caf28311a7cc15652def1988a1f8741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*lcmJGmagokRQZ78aZTEP7g.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">似乎池模型表现最好。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="80c6" class="li lj in le b gy lk ll l lm ln">summary(fit.HE.pooled) <br/>summary(fit.HE.unpooled) <br/>fit.HE.pooled.qbinom&lt;-glm(cbind(NO_OF_HEALTHEVENTS, DT_N-NO_OF_HEALTHEVENTS)~TREATMENT, family="quasibinomial", data=drug_use)<br/>fit.HE.unpooled.qbinom&lt;-glm(cbind(NO_OF_HEALTHEVENTS, DT_N-NO_OF_HEALTHEVENTS)~TREATMENT+as.factor(BLOCK)+as.factor(GROUP), family="quasibinomial", data=drug_use)<br/>summary(fit.HE.pooled.qbinom)<br/>summary(fit.HE.unpooled.qbinom)</span><span id="93d0" class="li lj in le b gy mw ll l lm ln">jtools::plot_summs(fit.HE.pooled,<br/>                   fit.HE.unpooled,<br/>                   fit.HE.pooled.qbinom, <br/>                   fit.HE.unpooled.qbinom, <br/>                   scale = TRUE, plot.distributions = TRUE)<br/>export_summs(fit.HE.pooled,<br/>             fit.HE.unpooled,<br/>             fit.HE.pooled.qbinom, <br/>             fit.HE.unpooled.qbinom,<br/>             scale = TRUE)<br/>AICtab(fit.HE.pooled,<br/>       fit.HE.unpooled,<br/>       fit.HE.pooled.qbinom, <br/>       fit.HE.unpooled.qbinom)<br/>tab_model(fit.HE.pooled,<br/>                   fit.HE.unpooled,<br/>                   fit.HE.pooled.qbinom, <br/>                   fit.HE.unpooled.qbinom)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/9f3f7ee49821a2cf5b8f53b9d8ea0a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*AEtaNAxpLSVR-WHksO_boQ.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">准版本甚至没有导致任何东西，因为模型矩阵是秩亏的。</figcaption></figure><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi no"><img src="../Images/88e9c446be5597a9f54784423afeeaa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-QIMJHAYgqaKRQ73iEsIA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">正如你所看到的，这些模型在他们的估计上并没有太大的不同，这些置信限的大小适合于他们的小样本量。对leats来说，分析这样一个数据集是具有挑战性的。</figcaption></figure><p id="521a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每个混合模型都需要有一个适当的评估，其中一个值得检查的部分是假设随机分量遵循一个属于正态分布的QQ图。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="ec99" class="li lj in le b gy lk ll l lm ln">fit.poisson&lt;-glmer(NO_OF_HEALTHEVENTS~1+(1|IR), <br/>                   data=drug_use, <br/>                   family="poisson"(link = "log"))<br/>summary(fit.poisson)<br/>plot_model(fit.poisson, type="diag")</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi np"><img src="../Images/9b98aab0067157062209062af3568f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oAKQw1HhBdiuntGdecnRWA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">看起来正常，但是置信区间很宽。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="386b" class="li lj in le b gy lk ll l lm ln">fit.poisson&lt;-glmer(DAYS_OF_TREATMENT~1+(1|IR), <br/>                   data=drug_use, <br/>                   family="poisson"(link = "log"))<br/>summary(fit.poisson)<br/>plot_model(fit.poisson, type="diag")</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi np"><img src="../Images/a1cfbc0e30d1e543d95f77184ffdb292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mnOKeoy84XDG7_lklF6oA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">看起来正常，但置信区间非常宽，尤其是在开始阶段。你可以清楚地看到这里的块来自随机完全区组设计。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="cecb" class="li lj in le b gy lk ll l lm ln">fit.poisson&lt;-glmer(NO_OF_TREATMENTS~1+(1|IR), <br/>                   data=drug_use, <br/>                   family="poisson"(link = "log"))<br/>summary(fit.poisson)<br/>plot_model(fit.poisson, type="diag")</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi np"><img src="../Images/cef8419494466a5ea14b89fc529ee470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKkEHaMZbrrcTVG-w3ZZHA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">看起来正常，但置信区间非常宽，尤其是在开始阶段。你可以清楚地看到这里的块来自随机完全区组设计。</figcaption></figure><p id="9c3a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在处理离散数据时，需要检查过度偏差(通过受限分布低估数据的方差)。我们可以通过图形化的方式来实现，建模一次，或者建模一次，然后引导结果。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6a05" class="li lj in le b gy lk ll l lm ln">### Testing for overdispersion <br/>fit.poisson2&lt;-glmer(DAYS_OF_TREATMENT~TREATMENT+(1|fGROUP)+(1|fBLOCK), <br/>                    data=drug_use, <br/>                    family="poisson"(link = "log"), <br/>                    control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>summary(fit.poisson2)<br/>simulationOutput&lt;-simulateResiduals(fittedModel=fit.poisson2, n=2000)<br/>plot(simulationOutput)<br/>testZeroInflation(simulationOutput)</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nq"><img src="../Images/7cd847eecf71902b0b96c6b89752c9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qv1-d2T49NeyFShqtzr1Q.png"/></div></div></figure><div class="kz la lb lc gt ab cb"><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/e99ac01225dc6cf491b429f4dc87e488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ncfl3A6ZJsnRJvZsdWsGuQ.png"/></div></figure><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/34d4d597b86d1de369b01dcf1a3d5677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*X3xFTSRZKNqxcoQ42tZBQg.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk ns di nt na translated">看起来不错。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="351d" class="li lj in le b gy lk ll l lm ln">fit.poisson3&lt;-glmer(DAYS_OF_TREATMENT~TREATMENT+(1|GROUP)+(1|BLOCK)+(1|IR),data=drug_use, family="poisson"(link = "log"),control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>summary(fit.poisson3)</span><span id="4cbc" class="li lj in le b gy mw ll l lm ln">fit.nb&lt;-glmer.nb(DAYS_OF_TREATMENT~TREATMENT+(1|GROUP), <br/>                      data=drug_use, control = glmerControl(optimizer = "bobyqa", nAGQ = 10))<br/>summary(fit.nb)</span><span id="2e7e" class="li lj in le b gy mw ll l lm ln">par(mfrow=c(1,2))<br/>hist(drug_use$DAYS_OF_TREATMENT)<br/>hist(rgamma(32,1.3084)) <br/># 1.3084 is shape parameter as indicated via glmer.nb, which is also used for gamma</span></pre><figure class="kz la lb lc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nu"><img src="../Images/54696e57f12865d6a92e026196850deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EnU042gSYk2IqnEhWEZSg.png"/></div></div></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="c814" class="li lj in le b gy lk ll l lm ln">#### MODEL EVALUATION DofT - PROPORTION DATA ####<br/>simulationOutput&lt;-simulateResiduals(fittedModel=fit.DT2, n=2000, refit=F)<br/>plot(simulationOutput)<br/>testZeroInflation(simulationOutput) </span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/17dc1bdec6c78984bc89d4693e5bb171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vg3V2ntoc9-x7XvxX6sV4A.png"/></div></figure><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/59905be96ac414230f04a6bbd70d6e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*SpfZpF6OU8_5Xv-C52kbcw.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk ns di nt na translated">看起来不错。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="93d7" class="li lj in le b gy lk ll l lm ln">#### MODEL EVALUATION NofT - PROPORTION DATA ####<br/>simulationOutput&lt;-simulateResiduals(fittedModel=fit.NT2, n=2000, refit=F)<br/>plot(simulationOutput)<br/>testZeroInflation(simulationOutput) </span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/075f8fc5c1920cc5c07bf1e938e43951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*DBIqMa8elYR1SUfSPmS7_A.png"/></div></figure><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/84224be506506690ff4b75ad64c94950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*us6RcdZ_qExe7KjaPJcooA.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk ns di nt na translated">看起来不错。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b78e" class="li lj in le b gy lk ll l lm ln">simulationOutput&lt;-simulateResiduals(fittedModel=fit.HE.pooled, n=2000, refit=F)<br/>plot(simulationOutput)<br/>testZeroInflation(simulationOutput)</span></pre><div class="kz la lb lc gt ab cb"><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/aadadec5ca7f20a2bcd632798d2b36c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*I_E03OTRszVGW8-ek7HLxg.png"/></div></figure><figure class="mk md nr mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/23067e493a9d51a298b72298eb1c77c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*E4kBZkBFEl65djtJLV09Fw.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk ns di nt na translated">看起来不错。</figcaption></figure></div><p id="c189" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，这是一篇关于如何对具有三个离散计数数据结果的数据集建模的快速帖子。不容易建模，但我希望很清楚，你必须找到一个分布，可以处理自己，检查过度分散，正常的误差(解释和未解释的方差)和停止建模的结果时，没有足够的数据。</p><p id="96a5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">尽情享受吧！</p></div></div>    
</body>
</html>