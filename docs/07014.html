<html>
<head>
<title>How to send bulk emails with attachment using Google Apps Script from a Google Spreadsheet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从 Google 电子表格中使用 Google Apps 脚本发送带有附件的批量电子邮件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-send-bulk-emails-with-attachment-using-google-apps-script-from-a-google-spreadsheet-653a1532233a?source=collection_archive---------6-----------------------#2022-02-19">https://blog.devgenius.io/how-to-send-bulk-emails-with-attachment-using-google-apps-script-from-a-google-spreadsheet-653a1532233a?source=collection_archive---------6-----------------------#2022-02-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/12ad5c2adfcbea3a94552d1472cc34d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKH7iIDRLn0DU7q6LIogzQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图片来源:Mailtrack</figcaption></figure><p id="0d48" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你好，学习者，</p><p id="183d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这篇文章中，我们将开发谷歌应用程序脚本，允许我们发送大量的电子邮件与附件的大规模观众一次。这篇文章是我上一篇文章的延续——<strong class="kb io"/><a class="ae kx" href="https://dilipkashyap15.medium.com/send-mass-emails-using-google-apps-script-from-a-google-spreadsheet-fc2f79c9febd" rel="noopener"><strong class="kb io">从谷歌电子表格</strong> </a> <strong class="kb io">使用谷歌应用套件脚本发送大量电子邮件。</strong></p><p id="9eff" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">让我们来看看为带有附件的批量电子邮件开发 Google 脚本的过程。</strong></p><ol class=""><li id="f76e" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">创建带有所需数据字段的电子表格作为模板。</li><li id="931d" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">SendEmail 功能，用于自动发送电子邮件。</li><li id="a8af" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">getData 函数从模板中获取 json 格式的数据，这将有助于在发送电子邮件函数中设置数据。</li></ol></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="29af" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当我们继续进行脚本开发时，让我们回顾一下这些步骤。</p><p id="59c1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 1: </strong>在这一步中，我们将创建一个包含所需列的 Google 电子表格。对于该示例，我添加了三列——名称、电子邮件、证书 id 和电子邮件状态。请参见下图中的示例。</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/921376e640a7f05f457070bc144f4cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chPFyfHX9fbUbGd6HkhHRg.png"/></div></div></figure><p id="1154" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第二步:</strong>创建电子表格模板后打开脚本编辑器，编写下面的<strong class="kb io">sendmeil()</strong>函数。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="65df" class="md me in lz b gy mf mg l mh mi">function sendEmail(){</span><span id="b241" class="md me in lz b gy mj mg l mh mi">var ss = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID");</span><span id="a2ea" class="md me in lz b gy mj mg l mh mi">var sheet = ss.getSheetByName("main");var json_data = getData(sheet);</span><span id="0908" class="md me in lz b gy mj mg l mh mi">for(var j=0;j&lt;json_data.length;j++) {</span><span id="b626" class="md me in lz b gy mj mg l mh mi">var attachment = [DriveApp.getFileById(json_data[j].fileid).getBlob()];</span><span id="bd6e" class="md me in lz b gy mj mg l mh mi">var message="Dear "+json_data[j].name+",&lt;br&gt;&lt;br&gt;Please find the attachment below.&lt;br&gt;&lt;br&gt;";</span><span id="e0b6" class="md me in lz b gy mj mg l mh mi">message=message+"Best wishes,&lt;br&gt;"+"Coordinators&lt;br&gt;&lt;br&gt;";</span><span id="153f" class="md me in lz b gy mj mg l mh mi">MailApp.sendEmail({to: json_data[j].email, cc: 'internships@iitgn.ac.in', subject: "CERTIFICATE NOTIFICATION", htmlBody: message, noReply:true, attachments: attachment  } );</span><span id="65aa" class="md me in lz b gy mj mg l mh mi">sheet.getRange(j+2,sheet.getLastColumn() ).setValue("Mail sent");</span><span id="76c0" class="md me in lz b gy mj mg l mh mi">}</span><span id="52ae" class="md me in lz b gy mj mg l mh mi">}</span></pre><p id="9546" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们已经在示例发送电子邮件函数中定义了<strong class="kb io">电子表格 id </strong>和<strong class="kb io">工作表名称</strong>。我们的下一节将描述调用<strong class="kb io"> getData() </strong>函数后会发生什么，该函数以 JSON 格式返回电子表格数据。之后我们编写了一个邮件模板，其中设置了 JSON 参数，如姓名、电子邮件、邮件内容之间的地址，并且调用了<strong class="kb io"> MailApp </strong>库函数来发送邮件。对于发送附件，我们使用驱动器链接中的文件 id，或者如果您向所有用户发送相同的附件文件，您可以在电子表格模板或下面的代码中使用直接链接。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="99fa" class="md me in lz b gy mf mg l mh mi">var attachment = [DriveApp.getFileById(json_data[j].fileid).getBlob()]</span></pre><p id="24d0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">整个过程会在一个等于 JSON 数组长度的循环中被调用，这个长度就是 Google 电子表格中的总人数。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="ec7f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第三步:我们需要定义<strong class="kb io"> getData() </strong>函数，让我们看看它的代码。编写<strong class="kb io"> getData() </strong>函数来获取 JSON 格式的 Google 电子表格数据。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5bd7" class="md me in lz b gy mf mg l mh mi">function getData(sheet){  <br/> var jo = {};  <br/> var dataArray = [];<br/>// collecting data from 2nd Row , 1st column to last row and last    // column sheet.getLastRow()-1</span><span id="217c" class="md me in lz b gy mj mg l mh mi">var rows = sheet.getRange(2,1,sheet.getLastRow()-1,sheet.getLastColumn()).getValues();</span><span id="f777" class="md me in lz b gy mj mg l mh mi">for(var i = 0, l= rows.length; i&lt;l ; i++)<br/>{  var dataRow = rows[i];<br/>     var record = {};<br/>      record['sno'] = dataRow[0];<br/>      record['name'] = dataRow[1];<br/>      record['email'] = dataRow[2];<br/>      record['address']=dataRow[3];<br/>      dataArray.push(record);<br/>   }   jo = dataArray;<br/>   var result = JSON.stringify(jo);<br/>return jo;<br/>}</span></pre><p id="e72e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们上面声明的函数已经定义了如下几个参数:工作表、最后一行和最后一列的范围，以及数组形式的范围值，它将以 JSON 格式返回完整的范围值。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="5372" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤 4: </strong>这是<strong class="kb io">奖励</strong>步骤，如果你想运行这个功能或从谷歌电子表格的前端调用发送电子邮件功能，你可以在谷歌应用程序脚本的顶部使用下面的脚本。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="feb3" class="md me in lz b gy mf mg l mh mi">function onOpen(e)<br/> {<br/>// Add a custom menu to the <br/>spreadsheet.SpreadsheetApp.getUi() <br/>// Or DocumentApp, SlidesApp, or FormApp.<br/>.createMenu('Custom Menu')<br/>.addItem('Send Emails', 'sendEmail')<br/>.addToUi();<br/>}</span></pre><p id="a37f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上面的代码中，当执行<strong class="kb io"> onOpen() </strong>函数时，一个名为“<strong class="kb io">自定义菜单</strong>的自定义菜单被添加到电子表格菜单选项的右侧。<strong class="kb io">senemail()</strong>函数需要在自定义菜单下定义，方法是添加<strong class="kb io"> addItem </strong>库函数，作为另一个选项从前端调用它。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="64b3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你有兴趣学习 Google Apps 脚本和自动化你的 Google Workspace？必须试试这本<strong class="kb io">电子书</strong>上的“<a class="ae kx" href="https://www.amazon.com/dp/B0BTJC9X5R" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">谷歌应用套件脚本:初学者指南</strong> </a>”</p><p id="78f8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">希望这篇文章能帮助你了解如何发送个性化的群发邮件。如有疑问，欢迎留言评论。我很乐意帮助你。快乐学习！</p></div></div>    
</body>
</html>