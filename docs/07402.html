<html>
<head>
<title>Typescript RxJS tap vs map keyword</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Typescript RxJS tap vs map 关键字</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/typescript-rxjs-tap-vs-map-keyword-ac0c0b4a56f3?source=collection_archive---------1-----------------------#2022-03-22">https://blog.devgenius.io/typescript-rxjs-tap-vs-map-keyword-ac0c0b4a56f3?source=collection_archive---------1-----------------------#2022-03-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="81af" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">何时使用运算符进行调试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9657076f9d25abfba955682ce45a2fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Y6cUubjmZcGZ94_98Vg5g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">桑德罗·波提切利的《春华秋实》，对立统一于此文。</figcaption></figure><p id="2a7e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">前端应用程序为调试提供了特定的操作符:<code class="fe ky kz la lb b"><strong class="jm io">debugger</strong></code>、<code class="fe ky kz la lb b"><strong class="jm io">console.log()</strong></code>。但是<code class="fe ky kz la lb b"><strong class="jm io">tap </strong></code>关键字允许在可观的地方做这件事。</p><p id="9582" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与可观测量一起工作，我们可以用不同的方式处理发射数据。<strong class="jm io"> Map </strong>、<strong class="jm io"> tap </strong>是可以在管道内链接在一起的操作符，但是它们的行为是不同的:</p><ul class=""><li id="a115" class="lc ld in jm b jn jo jr js jv le jz lf kd lg kh lh li lj lk bi translated"><code class="fe ky kz la lb b">map</code>、flatMap、switchMap 等的目的是<strong class="jm io">转换</strong>可观测的发射值。从一种类型到另一种类型。</li><li id="4586" class="lc ld in jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated"><code class="fe ky kz la lb b">tap </code>的目的是<strong class="jm io">执行某种其他动作</strong>保持可观察值不变。点击将返回原始数据和类型。</li><li id="e259" class="lc ld in jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">平面图——当我们有一个数据发射时，<strong class="jm io">平面图</strong>将以任意顺序获取，而不是保持输入数据顺序的<strong class="jm io">图</strong>。</li><li id="5f93" class="lc ld in jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">切换图——是一种获取最新排放值并忘记该排放源的任何先前数据的能力。</li><li id="b858" class="lc ld in jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">函数式编程为不同的场景提供了许多其他的操作符，比如 concatMap、mergeMap、exhaustMap</li></ul><p id="9d46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Web 浏览器借助 F-12 键提供开发人员工具。<strong class="jm io"> tap </strong>最常见的用法是用<strong class="jm io"> console.log() </strong>输出调试一些情况或者创建自定义<strong class="jm io"> myService.notify(msg) </strong>。</p><p id="01ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">也用管道来组合运算符</strong></p><p id="867c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">管道方法接受由逗号分隔的运算符。每个操作符都应该按照一定的逻辑排序，这取决于应用程序的逻辑。当用户订阅一个可观察对象时，管道按照添加操作符的顺序执行操作符。</p><p id="caab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">什么时候用水龙头？</strong></p><ol class=""><li id="7bca" class="lc ld in jm b jn jo jr js jv le jz lf kd lg kh lq li lj lk bi translated">使用 tap 进行调试，并观察控制台中的结果数据，而不对流进行任何转换。</li></ol><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="73d7" class="lv lw in lb b gy lx ly l lz ma">    this.myService<br/>      .calculate(param1, param2).pipe(<br/>        take(1),<br/>        tap(object =&gt; console.log(object)),<br/>        map(object =&gt; object.name),<br/> <!-- -->       filter(name =&gt; name.endsWith("ltd")),<br/>        tap(name =&gt; console.log(name))<br/>      )<br/>      .subscribe(result =&gt; {<br/>        // notify client<br/>      });</span></pre><p id="7b70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.定义数据更改时的副作用。</p><p id="4189" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，在没有订阅的情况下，服务返回可观察到的结果，tap 实现了副作用:</p><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="9cbf" class="lv lw in lb b gy lx ly l lz ma">isQuotationCreated(session: SessionState): Observable&lt;boolean&gt; {<br/><br/>  return this.chargeService.isQuotationCreated(quotation).pipe(<br/>    tap(result =&gt; console.log(result))<br/>    map(result =&gt; result.data),<br/>    tap(result =&gt; {<br/>      if (!result) {<br/>        const messageData: MessageData = {<br/>          messageType: MsgType.WARNING,<br/>          title: "No quotation found",<br/>          description: "Lorem ipsum"<br/>        };<br/>        this.messageService.showMessage(messageData);<br/>      }<br/>    })<br/>  );<br/>}</span></pre><p id="1cfd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一个关于 Subject 的例子:管道请求一直工作到 observable 被订阅。</p><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="fa18" class="lv lw in lb b gy lx ly l lz ma">private readonly destroy$ = new Subject&lt;boolean&gt;();</span><span id="1a4f" class="lv lw in lb b gy mb ly l lz ma">private readonly requestDate$: Observable&lt;Date&gt;;<br/>isSearchingDate: boolean;</span><span id="09ab" class="lv lw in lb b gy mb ly l lz ma">constructor(<br/>  private readonly dateService: RequestDateService,<br/>) {<br/>  this.requestDate$ = dateService.requestDate$;<br/>}</span><span id="df27" class="lv lw in lb b gy mb ly l lz ma">ngOnDestroy(): void {<br/>  this.destroy$.complete();<br/>  this.destroy$.unsubscribe();<br/>}</span><span id="c374" class="lv lw in lb b gy mb ly l lz ma">loadData(): void {<br/>  this.requestDate$<br/>  .pipe(<br/>    takeUntil(this.destroy$),<br/>    tap(() =&gt; (this.isSearchingDate = true))<br/>  )<br/>  .subscribe(requestDate =&gt; {<br/>    // notify the service<br/>  });<br/>}</span></pre><p id="f2b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它可能是这样一种不同的副作用:</p><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="e03b" class="lv lw in lb b gy lx ly l lz ma">  let actionDispatched = false;<br/>  constructor(private readonly service: MyService) {}</span><span id="54fc" class="lv lw in lb b gy mb ly l lz ma">  function resolve(): Observable&lt;PriceResponse&gt; {<br/>    return this.service.pipe(<br/>      tap(price =&gt; {<br/>        if (!price &amp;&amp; !this.actionDispatched) {<br/>          this.actionDispatched = true;<br/>          this.service.dispatch(<strong class="lb io"><em class="mc">price</em></strong>);<br/>        }<br/>      }),<br/>      skipWhile(price =&gt; !price),<br/>      take(1),<br/>      finalize(() =&gt; (this.actionDispatched = false))<br/>    );<br/>  }</span></pre><p id="7447" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.观察内在的可观察性，以及可观察的操作将如何完成。</p><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="63fd" class="lv lw in lb b gy lx ly l lz ma">import { of } from 'rxjs';<br/>import { tap, map, mergeMap, toArray } from 'rxjs/operators';</span><span id="185a" class="lv lw in lb b gy mb ly l lz ma">const ids = [0,1,2,3,4,5,6,7,8,9];<br/>const transformTo = (id: number) =&gt; of(id).pipe(<br/>  map((data) =&gt; data * 10),<br/>  tap({<br/>    complete: () =&gt; console.log(`Inner value ${id}`),<br/>  })<br/>);</span><span id="2d0a" class="lv lw in lb b gy mb ly l lz ma">of(ids).pipe(<br/>  mergeMap(ids =&gt; ids),<br/>  mergeMap(id =&gt; transformTo(id)),<br/>  tap({<br/>    error: (error) =&gt; console.log(`Error with ${ids}: ` + error)<br/>  }),<br/>  toArray()<br/>).subscribe(e =&gt; console.log(e))</span></pre><p id="28b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.使用点击显示错误。点击使用 3 种方法:下一步，错误和完成。让我们模拟一下可观测量的误差。</p><pre class="kj kk kl km gt lr lb ls lt aw lu bi"><span id="9d3b" class="lv lw in lb b gy lx ly l lz ma">    of("Lorem", "Ipsum", "Vice")<br/>      .pipe(<br/>        map(item =&gt; item.length),<br/>        tap(item =&gt; { console.log("Before " + item) }),<br/>        map(item =&gt; {<br/>          if (item == 4) {<br/>            throw Error;<br/>          }<br/>          return item;<br/>        }),<br/>        tap(<br/>          item =&gt; {<br/>            console.log("After " + item);<br/>          },<br/>          err =&gt; {<br/>            console.log("Error: " + err);<br/>          },<br/>          () =&gt; {<br/>            console.log("Complete");<br/>          }<br/>        )<br/>      )<br/>      .subscribe(item =&gt; console.log(item));</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/ade5090455e2da745bc2a2171aaa3ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO6A-Iu8pnEdU_OjyXXCsw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">华金·索罗拉</figcaption></figure><p id="7ea6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><p id="bd28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">函数式编程提供了以正确和简单的方式操作数据的方法。在前端应用程序中调试不像在后端那么容易。</p><p id="2f5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">链接</strong></p><div class="me mf gp gr mg mh"><a href="https://blog.angular-university.io/rxjs-higher-order-mapping/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd io gy z fp mm fr fs mn fu fw im bi translated">RxJs 映射:切换映射 vs 合并映射 vs 串联映射 vs 穷举映射</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">我们日常发现的一些最常用的 RxJs 运算符是 RxJs 高阶映射…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">blog.angular-university.io</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ks mh"/></div></div></a></div></div></div>    
</body>
</html>