# 干净的(PHP)代码

> 原文：<https://blog.devgenius.io/clean-php-code-57da4cf75537?source=collection_archive---------0----------------------->

如果你问 10 个 PHP 开发人员什么是干净的代码，你会得到 9 个答案，一个非常生气的人会花半个小时向你解释 WordPress 插件必须是脏的，因为它就是这样工作的，如果你是一个更好的程序员，你就会明白。

一旦你远离了第十个人，并提交了必要的限制令，你将最终能够看到其他 9 个开发人员中只有一两个对干净代码有看法。

在过去几年的开发旅程中，我一直在试图弄清楚干净的代码对我来说意味着什么。那段旅程将我引向了诸如[测试驱动开发](https://medium.com/swlh/software-development-is-the-scientific-method-b5edbf6dafc0)、对象健美操、价值对象等主题。

我最大的抱怨，也绝对是我个人的问题，是很少有人关注干净的 *PHP* 代码。

# 关于 PHP 的一点知识

PHP 在干净代码方面有着曲折的过去，你听说过吗？如果你在开发人员圈子里呆过一段时间，你会很难不听到关于 PHP 的负面消息。

我不会去探究人们说的所有事情，因为坦率地说，我认为他们大多是错的(现在)，但就像高中一样，PHP 有一个坏名声。PHP 不像高中，不能只穿个皮夹克假装不在乎。

尽管 PHP 有很多缺点，但它多年来还是一个蹒跚学步的孩子，而*仍然成功地开发了互联网的大部分。*

如今，PHP 已经成长为一门受人尊敬的年轻语言，随着 PHP 8.0 的[发布，它甚至显示出成熟的迹象。](https://www.php.net/archive/2020.php)

# 接下来:成熟的开发者

现在，让我们从说有许多用 PHP 编写干净代码的成熟开发人员开始这一部分。我不是想说没有。

问题是不同的，而且是双重的:

1.  有更多不成熟的开发者编写不干净的 PHP 代码；和
2.  干净 PHP 和非干净 PHP 之间的距离比大多数其他语言都要大。

然而，这两个问题都有一个根本原因，就像 PHP 中的大多数事情一样，根本原因是已知的，也是语言的核心。

PHP 作为一种语言，是非常宽容的。

它并不强迫你做(许多)其他基于 C 语言默认做的事情——看看你，类型声明。正因为如此，许多 PHP 开发人员意外地陷入 PHP，并发现他们的代码工作得很快。

这对采用来说很好，但对干净代码的扩散来说就不那么好了。

# 你必须不怕麻烦地写出干净的 PHP

这并不是说编写干净的 PHP 很难，只是它需要你采取一些语言不强迫你采取的步骤。

当然，所有干净的代码都是如此，但我的观点是，对于 PHP，需要采取更多的步骤。

出于这个原因，我将介绍几个你可以采取的步骤，这些步骤将立即帮助你提高 PHP 的整洁度。其中一些是鲍勃叔叔(罗伯特·马丁的)[的干净代码书](https://amzn.to/3fMW3LC)【附属链接】提供的建议，其他的是我发现的帮助我写更干净代码的建议。

这并不是一个详尽的列表，我在这里只是简单地介绍一下，因为每个建议都可以很容易地成为它自己的文章。但是让我们开始吧。

我们将从所有其他事物存在所必需的一个开始:

# 全局作用域是用来调用你的主方法的，仅此而已

或者换句话说，你应该使用类——或者至少是函数——而不是自上而下地把代码写成一个文件。

很少有程序可以从一个不使用任何自定义函数的脚本中长期运行。随着应用程序的增长，您应该会发现自己将块移动到它们自己的方法中，将方法移动到它们自己的类中。

这是接下来所有事情的必要方面，所以如果你还没有做到这一步，现在就停止阅读，去练习。如果你已经在做这一步了，那就继续吧。

*喜欢这篇文章吗？* [*成为会员*](https://travisweston.com/membership) *和* [*订阅*](https://travisweston.com/subscribe) *获取更多类似这样的精彩内容！*

# 使用类型声明

类型声明不是 PHP 的必需部分，我们在上面讨论过，但是它们让你的[代码闻起来](https://en.wikipedia.org/wiki/Code_smell)更好。当你使用类型声明时，当一年后你被要求完全重写那部分脚本时，你不必猜测变量包含什么。

# 在私有/受保护的类成员前添加下划线

这是我使用的一种习惯，我很想停止使用。问题是，在我们就我的下一点达成全行业一致之前，我觉得这一点是必要的。

一眼就知道你正在处理的变量的范围是很重要的。通过在参数名的开头添加一个简单的下划线，可以区分哪些是私有的和受保护的，哪些是公共的。如果您遵循以下建议，可以安全地忽略这一点:

# 零公共类参数

我们为什么要创建类？在类代码和应用程序的其余部分之间添加一个分离层。公共类参数打破了这一障碍。实际上，它们是传染媒介，其他人可以利用它们来扰乱你的课堂。

类应该有(有限的)公共 API。这些公共 API 应该仅限于类方法，不应该包含 getters 或 setters。是的，我说了。

跟我打。

如果你想要干净的代码，你需要限制你的类的范围。Getters 和 setters 不会这样做。在某些情况下，Getters 是可以被原谅的，但是 setters 应该被避免。

# 使用值对象实现不变性

值对象给一个概念命名。它们封装了逻辑，无论概念是什么，它们允许您将处理逻辑的关注点与数据的使用分开。

我开发过很多基于浏览器的游戏，它们都有一个共同点，就是某种形式的金钱。传统上，这笔钱是作为整数在各个领域传递的。但是通过使用 Value 对象，您可以在清理代码的同时对代码的这一部分进行自文档化。

让我们来看一个例子:

这是一个非常小的样本，并且有相当多的潜在缺陷。

首先，`addMoney`显然是一只名字很奇特的塞特犬。

其次，让我们花一分钟想想`$_wallet`好吗？非常具体地说，钱包是什么？根据它的用法，我们可以假设它是一个整数，对吗？

但是，钱包是整数吗？我把它放在口袋里，它看起来像一块皮革。但我想我可以问它是否真的是自然数。

你(希望)明白我的意思。钱包是自己的东西，包含自己的逻辑。所以我们应该这样对待他们。

让我们来看一个改进了这个想法的例子:

首先，我们创建 Wallet 值对象。这只是我整理的一个快速类，随着投入使用，它可能会随着时间的推移而改进。但是对于这个例子，它做了我们需要的一切。

> *注意:这里有一个吸气剂。我是个伪君子，对吗？嗯，不。在这种情况下，我更喜欢使用 __toString()魔法方法，但是 PHP 没有等效的 __toInt()魔法方法，我们可以使用这个方法代替在整个代码中使用(int)(string)$wallet。*

接下来，我们来谈谈如何使用这个值对象。

我跳过了 Wallet 类，因为如果你正在阅读这篇文章，我假设你知道如何在 PHP 中连接不同的文件。

无论如何，现在我们有了两个类，我们在创建播放器时创建了一个空的钱包，然后我们可以通过调用播放器类上的`addMoney`向这个钱包里添加钱。这很好地控制了一切。

当然，这不是一个完美的例子。有更好的处理钱包的方式，你可能希望你的钱包是一个模型而不是一个价值对象，但在我们的例子中，这就是我们必须处理的。

事实是，直到你真正使用了值对象，你才真正理解它们为可读性和可用性提供的价值。

我在值对象上花了太多时间，所以让我们继续。

# 使用提前返回最多 1 个缩进级别

缩进和 setters 一样邪恶。缩进会使代码难以理解，并使您更容易忘记关闭大括号。如果我听到你告诉我，这没关系，因为 VS 代码会为你关闭括号，所以帮助我，我将被迫打破你的键盘。

VS 代码不是开发者。

你是。

去吧。你的。工作。

让我们看一个例子。

我们都见过这个代码，不是吗？我们想要注册一个用户，所以我们将他们的详细信息传递给函数并完成这个任务。

这里有多少级缩进？嗯，使用零索引，我们从函数体中的缩进级别 0 开始。从那里，我们可以计算出 3 个 if 语句，这给了我们 3 个级别的缩进。

我们想把它降低到不超过 1。

超级简单。我们只需要颠倒这里的逻辑。

这是和上面完全一样的代码，除了我们颠倒了逻辑和*立即*使它更可读。

逻辑反转和提前返回可能是它自己的文章。这是处理太多缩进层次、去掉 else 关键字以及其他许多使代码更整洁的方法的核心策略。

说到…

# 不要用 else…否则

在一个完美的世界里，我们可以完全摆脱条件句。我在干净代码的道路上还没有走多远，但是我可以被说服。然而，现在，我将死在这座山上:永远没有理由使用 *else* 关键字。

我从来没有发现一个 else 块是我无法移动和摆脱 else 关键字的。else 关键字对我来说通常是一种代码味道，它告诉我你在那个方法或代码段中做了不止一件事。

总之，还能是什么？如果我们看看上面关于逻辑反转的概念，我们可以看到，else 相当于前面所有返回 false 的 If 语句。

对于上面的例子，这意味着每个 else 块成为 if 的主块，方法的主逻辑成为事实上的 else 块。

但是如果你想运行的代码在一个 else 块中，并且到达那里的唯一方法是你的方法中的一切都正确运行，那么 else 块就没有必要了。

例如，这两个函数的性能相同:

但是，请注意，第二个函数是如何非常清楚地描述流量的？没有必要使用 else，因为如果第一个 if 为真，函数的执行就会停止。

如果所有的 if 语句都是假的，那么事实上 else 将会运行，所以也不需要最后的 else。

# 就这些吗？

不，那不是全部。PHP 充满了肮脏的代码，包括语言本身——尽管所有语言都是如此——但这只是一个开始。

如果您从这里开始，您的代码将更容易阅读，并且在重构时更容易理解。我不能在一篇文章中教会你成为一名干净的程序员，但是我可以让你开始成为一名干净的程序员。

如果你真的有兴趣了解更多，我鼓励你拿起[罗伯特·马丁的干净代码](https://amzn.to/3fMW3LC)[附属链接]，从头到尾读一遍。他的例子是用 Java 写的，但是 Java 和 PHP 非常相似，你应该能够理解。

如果没有，你真的应该学一点 Java。

*你喜欢这篇文章吗？* [*成为会员*](https://travisweston.com/membership) *准备好 Travis Weston 写的所有东西——以及媒体上所有其他可用的东西。*

*已经是会员了？* [*订阅得到通知*](https://travisweston.com/subscribe) *特拉维斯·韦斯顿写的每一篇文章。*

*本故事包含附属链接。我从通过这些链接进行的购买中获得收入，无需您支付额外费用。*