<html>
<head>
<title>Add Annotations to Lines and Curves with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Visx 库为直线和曲线添加注释</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-annotations-to-lines-and-curves-with-the-visx-library-cf8ce57886c5?source=collection_archive---------3-----------------------#2021-03-24">https://blog.devgenius.io/add-annotations-to-lines-and-curves-with-the-visx-library-cf8ce57886c5?source=collection_archive---------3-----------------------#2021-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/242cde2d29ac0fc2b6144ce6bb13e2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*98Mg7lrrqOtUY_0S"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">本·赫尔希在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="38eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx 是一个库，让我们可以轻松地将图形添加到 React 应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将曲线添加到 React 应用程序中。</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/annotation @visx/mock-data @visx/responsive @visx/scale @visx/shape</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="4761" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建带注释的直线/曲线</h1><p id="04ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加模块提供的项目来创建图表。</p><p id="7bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用来自<code class="fe ms mt mu mj b">@visx/mock-data</code>模块的数据。</p><p id="84b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建它，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2e31" class="mn lc iq mj b gy mo mp l mq mr">import React, { useMemo, useState } from "react";<br/>import { Label, Connector, CircleSubject, LineSubject } from "@visx/annotation";<br/>import { LinePath } from "@visx/shape";<br/>import { bisector, extent } from "d3-array";<br/>import { scaleLinear, scaleTime } from "@visx/scale";<br/>import appleStock from "@visx/mock-data/lib/mocks/appleStock";<br/>import { Annotation } from "@visx/annotation";</span><span id="3765" class="mn lc iq mj b gy mv mp l mq mr">export const orange = "#ff7e67";<br/>export const greens = ["#ecf4f3", "#68b0ab", "#006a71"];<br/>const data = appleStock.slice(-100);<br/>const getDate = (d) =&gt; new Date(d.date).valueOf();<br/>const getStockValue = (d) =&gt; d.close;<br/>const annotateDatum = data[Math.floor(data.length / 2) + 4];<br/>const approxTooltipHeight = 70;</span><span id="d645" class="mn lc iq mj b gy mv mp l mq mr">function findNearestDatum({ value, scale, accessor, data }) {<br/>  const bisect = bisector(accessor).left;<br/>  const nearestValue = scale.invert(value);<br/>  const nearestValueIndex = bisect(data, nearestValue, 1);<br/>  const d0 = data[nearestValueIndex - 1];<br/>  const d1 = data[nearestValueIndex];<br/>  let nearestDatum = d0;<br/>  if (d1 &amp;&amp; accessor(d1)) {<br/>    nearestDatum =<br/>      nearestValue - accessor(d0) &gt; accessor(d1) - nearestValue ? d1 : d0;<br/>  }<br/>  return nearestDatum;<br/>}</span><span id="f19e" class="mn lc iq mj b gy mv mp l mq mr">function Example({ width, height, compact = false }) {<br/>  const xScale = useMemo(<br/>    () =&gt;<br/>      scaleTime({<br/>        domain: extent(data, (d) =&gt; getDate(d)),<br/>        range: [0, width]<br/>      }),<br/>    [width]<br/>  );<br/>  const yScale = useMemo(<br/>    () =&gt;<br/>      scaleLinear({<br/>        domain: extent(data, (d) =&gt; getStockValue(d)),<br/>        range: [height - 100, 100]<br/>      }),<br/>    [height]<br/>  );</span><span id="5cec" class="mn lc iq mj b gy mv mp l mq mr">  const [editLabelPosition] = useState(false);<br/>  const [editSubjectPosition] = useState(false);<br/>  const [title] = useState("Title");<br/>  const [subtitle] = useState(<br/>    compact ? "Subtitle" : "Long Subtitle"<br/>  );<br/>  const [connectorType] = useState("elbow");<br/>  const [subjectType] = useState("circle");<br/>  const [showAnchorLine] = useState(true);<br/>  const [verticalAnchor] = useState("auto");<br/>  const [horizontalAnchor] = useState("auto");<br/>  const [labelWidth] = useState(compact ? 100 : 175);<br/>  const [annotationPosition, setAnnotationPosition] = useState({<br/>    x: xScale(getDate(annotateDatum)) ?? 0,<br/>    y: yScale(getStockValue(annotateDatum)) ?? 0,<br/>    dx: compact ? -50 : -100,<br/>    dy: compact ? -30 : -50<br/>  });</span><span id="ebd0" class="mn lc iq mj b gy mv mp l mq mr">  return (<br/>    &lt;svg width={width} height={height}&gt;<br/>      &lt;rect width={width} height={height} fill={greens[0]} /&gt;<br/>      &lt;LinePath<br/>        stroke={greens[2]}<br/>        strokeWidth={2}<br/>        data={data}<br/>        x={(d) =&gt; xScale(getDate(d)) ?? 0}<br/>        y={(d) =&gt; yScale(getStockValue(d)) ?? 0}<br/>      /&gt;<br/>      &lt;Annotation<br/>        width={width}<br/>        height={height}<br/>        x={annotationPosition.x}<br/>        y={annotationPosition.y}<br/>        dx={annotationPosition.dx}<br/>        dy={annotationPosition.dy}<br/>        canEditLabel={editLabelPosition}<br/>        canEditSubject={editSubjectPosition}<br/>        onDragEnd={({ event, ...nextPosition }) =&gt; {<br/>          const nearestDatum = findNearestDatum({<br/>            accessor:<br/>              subjectType === "horizontal-line" ? getStockValue : getDate,<br/>            data,<br/>            scale: subjectType === "horizontal-line" ? yScale : xScale,<br/>            value:<br/>              subjectType === "horizontal-line"<br/>                ? nextPosition.y<br/>                : nextPosition.x<br/>          });<br/>          const x = xScale(getDate(nearestDatum)) ?? 0;<br/>          const y = yScale(getStockValue(nearestDatum)) ?? 0;</span><span id="b908" class="mn lc iq mj b gy mv mp l mq mr">          const shouldFlipDx =<br/>            (nextPosition.dx &gt; 0 &amp;&amp; x + nextPosition.dx + labelWidth &gt; width) ||<br/>            (nextPosition.dx &lt; 0 &amp;&amp; x + nextPosition.dx - labelWidth &lt;= 0);<br/>          const shouldFlipDy =<br/>            (nextPosition.dy &gt; 0 &amp;&amp;<br/>              height - (y + nextPosition.dy) &lt; approxTooltipHeight) ||<br/>            (nextPosition.dy &lt; 0 &amp;&amp;<br/>              y + nextPosition.dy - approxTooltipHeight &lt;= 0);<br/>          setAnnotationPosition({<br/>            x,<br/>            y,<br/>            dx: (shouldFlipDx ? -1 : 1) * nextPosition.dx,<br/>            dy: (shouldFlipDy ? -1 : 1) * nextPosition.dy<br/>          });<br/>        }}<br/>      &gt;<br/>        &lt;Connector stroke={orange} type={connectorType} /&gt;<br/>        &lt;Label<br/>          backgroundFill="white"<br/>          showAnchorLine={showAnchorLine}<br/>          anchorLineStroke={greens[2]}<br/>          backgroundProps={{ stroke: greens[1] }}<br/>          fontColor={greens[2]}<br/>          horizontalAnchor={horizontalAnchor}<br/>          subtitle={subtitle}<br/>          title={title}<br/>          verticalAnchor={verticalAnchor}<br/>          width={labelWidth}<br/>        /&gt;<br/>        {subjectType === "circle" &amp;&amp; &lt;CircleSubject stroke={orange} /&gt;}<br/>        {subjectType !== "circle" &amp;&amp; (<br/>          &lt;LineSubject<br/>            orientation={<br/>              subjectType === "vertical-line" ? "vertical" : "horizontal"<br/>            }<br/>            stroke={orange}<br/>            min={0}<br/>            max={subjectType === "vertical-line" ? height : width}<br/>          /&gt;<br/>        )}<br/>      &lt;/Annotation&gt;<br/>    &lt;/svg&gt;<br/>  );<br/>}</span><span id="f4bf" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="e006" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe ms mt mu mj b">orange</code>和<code class="fe ms mt mu mj b">green</code>变量来分别设置标记和线条的颜色。</p><p id="226d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">data</code>有该行的数据。</p><p id="dc76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">getDate</code>和<code class="fe ms mt mu mj b">getStockValue</code>分别是 x 轴和 y 轴数据的获取函数。</p><p id="75dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">findNearestDatum</code>功能让我们找到将注释框拖动到的点。</p><p id="17cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">Example</code>组件中，我们创建了<code class="fe ms mt mu mj b">xScale</code>和<code class="fe ms mt mu mj b">yScale</code>对象来创建折线图的刻度。</p><p id="e36b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Annotation</code>组件有该行的注释。</p><p id="4048" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们设置<code class="fe ms mt mu mj b">x</code>和<code class="fe ms mt mu mj b">y</code>位置来放置线的注释。</p><p id="7d10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">width</code>和<code class="fe ms mt mu mj b">height</code>设置宽度和高度。</p><p id="3172" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">dx</code>和<code class="fe ms mt mu mj b">dy</code>设置位置偏移。</p><p id="ab8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">canEditLabel</code>让我们设置是否可以用布尔值编辑标签。</p><p id="90e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">canEditSubject</code>让我们设置是否可以用布尔值编辑主题。</p><p id="9557" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们拖动注释框时,<code class="fe ms mt mu mj b">onDragEnd</code>处理程序改变注释位置。</p><p id="f79b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加<code class="fe ms mt mu mj b">Connection</code>和<code class="fe ms mt mu mj b">Label</code>来为注释框添加标记和标签。</p><p id="d8fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们应该看到一个框显示在该行上，并带有由<code class="fe ms mt mu mj b">subtitle</code>道具设置的文本。</p><h1 id="8144" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="4ab4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Visx 库在我们的代码行中添加一个注释框。</p></div></div>    
</body>
</html>