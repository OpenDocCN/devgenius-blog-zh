<html>
<head>
<title>Helm — Built-in Functions and Values</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Helm —内置函数和值</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/helm-built-in-functions-and-values-2879ecd7fb37?source=collection_archive---------8-----------------------#2022-06-26">https://blog.devgenius.io/helm-built-in-functions-and-values-2879ecd7fb37?source=collection_archive---------8-----------------------#2022-06-26</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="8d95" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">高级头盔用法</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/cd216ad8060118905a3e1311e12c3633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBlbmKE_tF2ICK2-GKlvMw.png"/></div></div></figure><p id="b186" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">在我之前的文章中，我向你展示了如何创建你自己的<code class="fe lo lp lq lr b">HELM Chart</code>:<a class="ae ls" href="https://medium.com/geekculture/helm-create-helm-chart-7084666fab90" rel="noopener">舵——创建舵图</a>。今天来说说<code class="fe lo lp lq lr b">Helm</code>内置函数和值。</p><h1 id="9dde" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">定义舵图</h1><p id="3dd0" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">让我们快速回顾一下如何创建一个<code class="fe lo lp lq lr b">Helm Chart</code>。图表包是文件夹的集合，文件夹名称是图表包的名称。例如，要创建一个<code class="fe lo lp lq lr b">mychart</code>图表包:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="bc32" class="mu lu ir lr b gz mv mw l mx my">$ helm create mychart<br/>Creating mychart<br/>$ tree mychart/<br/>mychart/<br/>├── charts<br/>├── Chart.yaml<br/>├── templates<br/>│   ├── deployment.yaml<br/>│   ├── _helpers.tpl<br/>│   ├── ingress.yaml<br/>│   ├── NOTES.txt<br/>│   └── service.yaml<br/>└── values.yaml</span><span id="d58d" class="mu lu ir lr b gz mz mw l mx my">2 directories, 7 files</span></pre><p id="ce99" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">让我们仔细看看<code class="fe lo lp lq lr b">templates</code>目录:</p><ul class=""><li id="1aee" class="na nb ir ku b kv kw ky kz lb nc lf nd lj ne ln nf ng nh ni bi translated"><strong class="ku is"> NOTES.txt: </strong>“帮助文本”为图表。这在用户运行 helm install 时显示给用户。</li><li id="9a65" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated"><strong class="ku is"> deployment.yaml </strong>:创建 Kubernetes 部署的基本清单</li><li id="0f6b" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated"><strong class="ku is"> service.yaml </strong>:创建部署服务的基本清单</li><li id="f8df" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated"><strong class="ku is"> ingress.yaml </strong>:创建 ingress 对象的资源清单文件</li><li id="91cd" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated"><strong class="ku is"> _helpers.tpl </strong>:放置模板助手的地方，可以在整个图表中重用</li></ul><p id="5047" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">在这里我们了解了每个文件的用途，然后我们可以删除模板目录下的所有文件，然后自己创建模板文件:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="46ac" class="mu lu ir lr b gz mv mw l mx my">$ rm -rf mychart/templates/*.*</span></pre><h1 id="594e" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">创建模板</h1><p id="b841" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">这里我们在 templates 目录下创建一个非常简单的模板 ConfigMap: <code class="fe lo lp lq lr b">configmap.yaml</code>文件:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="3e6d" class="mu lu ir lr b gz mv mw l mx my">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart-configmap<br/>data:<br/>  myvalue: "Hello World"</span></pre><p id="2a07" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">事实上，现在我们有了一个可安装的图表包，可以用<code class="fe lo lp lq lr b">helm install</code>命令安装:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="00b9" class="mu lu ir lr b gz mv mw l mx my">$ <!-- -->helm install mychart ./mychart<br/>NAME: mychart<br/>LAST DEPLOYED: Thu Jun 23 11:38:18 2022<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><p id="79d8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">在上面的输出中，我们可以看到已经创建了 ConfigMap 资源对象。然后，我们可以使用以下命令查看实际的模板呈现的资源文件:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="ee5f" class="mu lu ir lr b gz mv mw l mx my">$ <!-- -->helm get manifest mychart<br/>---<br/># Source: mychart/templates/configmap.yaml<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart-configmap<br/>data:<br/>  myvalue: "Hello World"</span></pre><p id="c562" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在我们看看上面的 ConfigMap 文件是否正是我们在模板文件中设计的，让我们删除当前的文件<code class="fe lo lp lq lr b">release</code>:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="311d" class="mu lu ir lr b gz mv mw l mx my">$ helm delete mychart<br/>release "mychart" deleted</span></pre><h1 id="1cfc" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">添加一个简单的模板</h1><p id="edea" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">我们可以看到上面定义的配置图的名称是固定的，但是这通常不是一个好的做法。我们可以通过插入发布版本的名称来生成资源的名称。例如，这里的配置图名称为:<code class="fe lo lp lq lr b">mychart-configmap</code>，需要使用 Chart 的模板定义方法。</p><p id="93a6" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在让我们重新定义上面的<code class="fe lo lp lq lr b">configmap.yaml</code>文件:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="f70b" class="mu lu ir lr b gz mv mw l mx my">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: {{ .Release.Name }}-configmap<br/>data:<br/>  myvalue: "Hello World"</span></pre><p id="84d7" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们用模板指令<code class="fe lo lp lq lr b">{{ .Release.Name }}-configmap</code>替换了名称，并将发布的名称注入到模板中，这样最终生成的 ConfigMap 名称以发布的名称开始。这里的发布模板对象是<code class="fe lo lp lq lr b">Helm</code>中的内置对象之一，还有很多其他的内置对象，我们后面会讲到。</p><p id="b590" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在让我们重新安装我们的图表包，注意 ConfigMap 资源对象的名称:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="819f" class="mu lu ir lr b gz mv mw l mx my">$ <!-- -->helm install mychart2 ./mychart<br/>NAME: mychart2<br/>LAST DEPLOYED: Thu Jun 23 11:40:19 2022<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><p id="306c" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">让我们再查一遍清单。</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="5365" class="mu lu ir lr b gz mv mw l mx my">helm get manifest mychart2<br/>---<br/># Source: mychart/templates/configmap.yaml<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart2-configmap<br/>data:<br/>  myvalue: "Hello World"</span></pre><p id="ce07" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在你可以看到<code class="fe lo lp lq lr b">metadata.name</code>变成了<code class="fe lo lp lq lr b">mychart2-configmap</code>。</p><h1 id="f3a1" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">排除故障</h1><p id="8ee4" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">我们使用模板来生成资源文件列表，但是如果要调试的话就很不方便了。我们不可能每次都部署一个实例来验证模板是否正确。</p><p id="27d8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">幸运的是，Helm 为我们提供了<code class="fe lo lp lq lr b">--dry-run --debug</code>选项，当您执行<code class="fe lo lp lq lr b">helm install</code>这两个参数时，您可以打印相应的值和最终生成的资源列表文件，而无需实际部署一个版本。例如，让我们调试上面创建的图表包:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="a71e" class="mu lu ir lr b gz mv mw l mx my">$ helm install mychart2 --dry-run --debug ./mychart<br/>install.go:173: [debug] Original chart version: ""<br/>install.go:190: [debug] CHART PATH: /tmp/mychart</span><span id="14e4" class="mu lu ir lr b gz mz mw l mx my">NAME: mychart2<br/>LAST DEPLOYED: Thu Jun 23 11:44:56 2022<br/>NAMESPACE: default<br/>STATUS: pending-install<br/>REVISION: 1<br/>TEST SUITE: None<br/>USER-SUPPLIED VALUES:<br/>{}</span><span id="264d" class="mu lu ir lr b gz mz mw l mx my">COMPUTED VALUES:<br/>affinity: {}<br/>autoscaling:<br/>  enabled: false<br/>  maxReplicas: 100<br/>  minReplicas: 1<br/>  targetCPUUtilizationPercentage: 80<br/>fullnameOverride: ""<br/>image:<br/>  pullPolicy: IfNotPresent<br/>  repository: nginx<br/>  tag: ""<br/>imagePullSecrets: []<br/>ingress:<br/>  annotations: {}<br/>  enabled: false<br/>  hosts:<br/>  - host: chart-example.local<br/>    paths: []<br/>  tls: []<br/>nameOverride: ""<br/>nodeSelector: {}<br/>podAnnotations: {}<br/>podSecurityContext: {}<br/>replicaCount: 1<br/>resources: {}<br/>securityContext: {}<br/>service:<br/>  port: 80<br/>  type: ClusterIP<br/>serviceAccount:<br/>  annotations: {}<br/>  create: true<br/>  name: ""<br/>tolerations: []</span><span id="b8b9" class="mu lu ir lr b gz mz mw l mx my">HOOKS:<br/>MANIFEST:<br/>---<br/># Source: mychart/templates/configmap.yaml<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart2-configmap<br/>data:<br/>  myvalue: "Hello World"</span></pre><p id="b4dc" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在我们可以通过使用它来轻松测试代码，而不必每次都安装一个 release 实例，但需要注意的是，这并不能保证 K8s 本身一定会接受生成的模板。调试之后，您仍然需要转到 Install an actual release 实例进行验证。</p><h1 id="4f7c" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">内置对象</h1><p id="c484" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">刚才我们使用<code class="fe lo lp lq lr b">{{.Release.Name}}</code>将发布的名称插入到模板中。这里的发布是<code class="fe lo lp lq lr b">Helm</code>的内置对象。以下是一些常用的内置对象，需要时可以直接使用:</p><h2 id="9235" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">释放；排放；发布</h2><ul class=""><li id="caa7" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated"><strong class="ku is">发布</strong>:这个对象描述了发布本身。它包含几个对象:</li><li id="119e" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布名称:发布名称</li><li id="b400" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布时间:发布时间</li><li id="8a6f" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布名称空间:版本的名称空间(如果清单中没有包含)</li><li id="a402" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布服务:发布服务的名称(总是 Tiller)。</li><li id="ae67" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布修订版:此版本的修订号，从 1 开始累加。</li><li id="6b30" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布 IsUpgrade:如果当前操作是升级或回滚，则设置为 true。</li><li id="a701" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">发布 IsInstall:如果当前操作是安装，则设置为 true。</li></ul><h2 id="4afa" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">价值观念</h2><ul class=""><li id="daa3" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated"><strong class="ku is">值</strong>:从文件和用户提供的文件传入模板的值<code class="fe lo lp lq lr b">values.yaml</code>。默认情况下，Values 为空。</li></ul><h2 id="16dc" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">图表</h2><ul class=""><li id="fce3" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated"><strong class="ku is">图表</strong> : <code class="fe lo lp lq lr b">Chart.yaml</code>文件的内容。所有图表对象都将从此文件中获取。图表指南中的<a class="ae ls" href="https://github.com/kubernetes/helm/blob/master/docs/charts.md#the-chartyaml-file" rel="noopener ugc nofollow" target="_blank">图表指南</a>中列出了可用字段，可在此处查看。</li></ul><h2 id="3de5" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">文件</h2><ul class=""><li id="cea7" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated"><strong class="ku is">文件</strong>:提供对图表中所有非特殊文件的访问。虽然它不能用来访问模板，但可以用来访问图表中的其他文件。请参见“访问文件”一节。</li><li id="c376" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">文件。Get 是一个按名称获取文件的函数(. Files.Get config.ini)</li><li id="8d9f" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">文件。GetBytes 是以字节数组而不是字符串的形式获取文件内容的函数。这对于图片之类的东西很有用。</li></ul><h2 id="515b" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">能力</h2><ul class=""><li id="d0d7" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated"><strong class="ku is">功能</strong>:这提供了关于 K8s 集群所支持的功能的信息。</li><li id="a3dd" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">能力。APIVersions 是一组版本信息。</li><li id="c0b1" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">能力。APIVersions.Has $version 指示是否在群集上启用版本(batch/v1)。</li><li id="4218" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">能力。KubeVersion 提供了查找 Kubernetes 版本的方法。它有以下值:Major、Minor、GitVersion、GitCommit、GitTreeState、BuildDate、GoVersion、编译器和平台。</li><li id="4d8d" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">能力。TillerVersion 提供了查找 Tiller 版本的方法。它具有以下值:SemVer、GitCommit 和 GitTreeState。</li></ul><h2 id="7f88" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">模板</h2><ul class=""><li id="a73a" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated">Template:包含当前正在执行的模板的信息</li></ul><h2 id="4afe" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">名字</h2><ul class=""><li id="714d" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated">名称:当前模板的文件路径(如 mychart/templates/my template . YAML)</li></ul><h2 id="62d8" class="mu lu ir bd lv no np dn lz nq nr dp md lb ns nt mf lf nu nv mh lj nw nx mj ny bi translated">基本路径</h2><ul class=""><li id="d725" class="na nb ir ku b kv ml ky mm lb nz lf oa lj ob ln nf ng nh ni bi translated">BasePath:当前图表模板目录的路径(如 mychart/templates)。</li></ul><p id="3df4" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">上述值可以在任何顶级模板中使用，注意内置值总是以大写字母开头。这也符合命名惯例。当你创建自己的名字时，你可以自由地使用适合你的团队的惯例。</p><h1 id="bba2" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">值文件</h1><p id="a289" class="pw-post-body-paragraph ks kt ir ku b kv ml js kx ky mm jv la lb mn ld le lf mo lh li lj mp ll lm ln ik bi translated">上面的内置对象之一是<code class="fe lo lp lq lr b">Values</code>，它提供对传入图表的值的访问。Values 对象的值有 4 个来源:</p><ul class=""><li id="dc0d" class="na nb ir ku b kv kw ky kz lb nc lf nd lj ne ln nf ng nh ni bi translated"><strong class="ku is">图表包中的 values.yaml </strong>文件</li><li id="8359" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated"><strong class="ku is">父图表包的 values.yaml </strong>文件</li><li id="ffde" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">通过<code class="fe lo lp lq lr b">helm install</code>或<code class="fe lo lp lq lr b">helm upgrade -f</code>或参数传入的自定义 yaml 文件(我们在上节课已经学过)<code class="fe lo lp lq lr b">--values</code></li><li id="c8a6" class="na nb ir ku b kv nj ky nk lb nl lf nm lj nn ln nf ng nh ni bi translated">参数中的值通过了<code class="fe lo lp lq lr b">--set</code></li></ul><p id="d718" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">例如，这里我们重新编辑<code class="fe lo lp lq lr b">mychart/values.yaml</code>文件，清除所有默认值，并添加一个新数据:(values.yaml)</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="099a" class="mu lu ir lr b gz mv mw l mx my">course: k8s</span></pre><p id="0227" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">然后我们可以在上面的<code class="fe lo lp lq lr b">templates/configmap.yaml</code>模板文件中使用这个值:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="85e4" class="mu lu ir lr b gz mv mw l mx my">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: {{ .Release.Name }}-configmap<br/>data:<br/>  myvalue: "Hello World"<br/>  course: {{ .Values.course }}</span></pre><p id="47c0" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">然后做一次预演:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="d680" class="mu lu ir lr b gz mv mw l mx my">$ helm install mychart --dry-run --debug ./mychart<br/>install.go:173: [debug] Original chart version: ""<br/>install.go:190: [debug] CHART PATH: /tmp/mychart</span><span id="cef9" class="mu lu ir lr b gz mz mw l mx my">NAME: mychart<br/>LAST DEPLOYED: Thu Jun 23 11:52:05 2022<br/>NAMESPACE: default<br/>STATUS: pending-install<br/>REVISION: 1<br/>TEST SUITE: None<br/>USER-SUPPLIED VALUES:<br/>{}</span><span id="8e0d" class="mu lu ir lr b gz mz mw l mx my">COMPUTED VALUES:<br/>course: k8s</span><span id="c8b2" class="mu lu ir lr b gz mz mw l mx my">HOOKS:<br/>MANIFEST:<br/>---<br/># Source: mychart/templates/configmap.yaml<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart2-configmap<br/>data:<br/>  myvalue: "Hello World"<br/>  course: k8s</span></pre><p id="3939" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们可以看到<code class="fe lo lp lq lr b">ConfigMap</code>中的值当然是渲染为 k8s，因为在 default values.yaml 文件中，这个参数的值是 k8s。类似地，我们可以很容易地通过参数<code class="fe lo lp lq lr b">--set</code>覆盖该值:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="38c7" class="mu lu ir lr b gz mv mw l mx my">helm install mychart2 --dry-run --debug ./mychart --set course=python3<br/>install.go:173: [debug] Original chart version: ""<br/>install.go:190: [debug] CHART PATH: /tmp/mychart</span><span id="686b" class="mu lu ir lr b gz mz mw l mx my">NAME: mychart2<br/>LAST DEPLOYED: Thu Jun 23 11:53:33 2022<br/>NAMESPACE: default<br/>STATUS: pending-install<br/>REVISION: 1<br/>TEST SUITE: None<br/>USER-SUPPLIED VALUES:<br/>course: python3</span><span id="01e3" class="mu lu ir lr b gz mz mw l mx my">COMPUTED VALUES:<br/>course: python3</span><span id="a4cb" class="mu lu ir lr b gz mz mw l mx my">HOOKS:<br/>MANIFEST:<br/>---<br/># Source: mychart/templates/configmap.yaml<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: mychart2-configmap<br/>data:<br/>  myvalue: "Hello World"<br/>  course: python3</span></pre><p id="b203" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">因为<code class="fe lo lp lq lr b">--set</code>比默认的<code class="fe lo lp lq lr b">values.yaml</code>文件具有更高的优先级，所以我们的模板被生成为 course: python3。</p><p id="648b" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">values 文件还可以包含更多结构化内容，例如，在 values.yaml 文件中，我们可以创建一个课程部分，并向其中添加一些关键字:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="b1ac" class="mu lu ir lr b gz mv mw l mx my">course:<br/>  k8s: devops<br/>  python: django</span></pre><p id="dd36" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">现在我们稍微修改一下模板:</p><pre class="kh ki kj kk gu mq lr mr ms aw mt bi"><span id="e0c4" class="mu lu ir lr b gz mv mw l mx my">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: {{ .Release.Name }}-configmap<br/>data:<br/>  myvalue: "Hello World"<br/>  k8s: {{ .Values.course.k8s }}<br/>  python: {{ .Values.course.python }}</span></pre></div></div>    
</body>
</html>