# 用 Docker 组织你的 RoR 项目

> 原文：<https://blog.devgenius.io/organize-your-ror-project-with-docker-87b12d51b042?source=collection_archive---------13----------------------->

![](img/5fc68fe679dac64a8c04a5783e0879b5.png)

由[约书亚·富勒](https://unsplash.com/@joshuafuller?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

作为开发人员，我们一天中最重要的事情之一就是处理多个项目，当我们这样做的时候，尽可能地保持我们的环境真正有组织和分离。对于没有准备好以正确的方式进行分离的人来说，版本、包和所有这些依赖关系的问题可能会令人头疼。这就是为什么我决定写这篇文章，给你一个简单的技巧来组织你的 Docker 环境。当然，还有其他的方法，但是当我用 Docker 做这件事的时候，我爱上了它。

如果您对 docker 一无所知，让我给你一个开端，让你了解我们将在本文中做什么。Docker 非常接近于虚拟机，但是比虚拟机更轻便、更具执行性、更可伸缩，因为它只加载容器工作所需的最小量。一个*映像*是你的*容器*用来创建的基础，而*容器*是那个*映像*的实例化。

为了让你更好的理解，*映像*有时是基于基本*映像*之上的指令，所以，对于一个 Ruby 映像，也许你有一个基本 Debian *映像*，它带有一些指令来为你预先配置 Ruby 语言。

基本上，您使用一个`Dockerfile`来为项目创建*映像*，在我们的例子中，有一个`docker-compose.yml`来处理组织环境本身以及与您的容器一起工作的其他容器。但是让我们一步步来看这个。要知道，这不仅对组织您的项目有意义，我们还有更简单的 CI、更容易的部署、更好的性能管理和更容易的可伸缩性。

# 开始之前

在我们深入了解配置和我想与您谈论的所有事情之前，请确保您的系统上安装了 **Docker** 和 **Docker Compose** 。在未来，这是你唯一需要安装的东西。不再有版本管理器、包、库或任何类似的东西。

你可以使用这个链接安装 **Docker** 和 **Docker 使用这个链接编写**和[，当然，在你运行任何东西之前，确保 **Docker** 正在你的系统上运行。](https://docs.docker.com/compose/install/)

# 我们开始吧

首先，我们需要为 rails 项目本身定义容器。在根路径上创建一个名为`Dockerfile`的文件，并将以下内容放在其中:

第一行的注释是定义文件语法所必需的。我曾经试图告诉你为什么我的版本的`Dockerfile`是这样组织的。

另一件需要注意的事情是，我指定了 ruby 版本`3.1.1`，node js 版本`16`，以及最后一个稳定的 yarn 版本。我做这些选择是因为在本文中，我将配置最新的稳定的 Rails 版本。

之后，您将创建一个`Gemfile`来存储以下内容:

这是不言自明的，我们只需要初始化一个 rails 配置来生成项目，然后脚本会用实际内容覆盖这个文件。在这个阶段，您也将创建一个空的`Gemfile.lock`文件。我们需要它来初始化 rails 项目。

记住，如果你正在处理一个已经存在的项目，你可以为`Gemfile`和`Gemfile.lock`维护你的版本。

那么对于`entrypoint.sh`文件，我们可以做如下操作:

这将保证我们的服务器运行良好。旧的运行可能会给你的项目增加一些`server.pid`，所以脚本会删除它。

最后是`docker-compose.yml`文件，这是真正神奇的地方。这个文件将定义服务器和数据库容器，使它们一起工作。请看下面:

还要注意的是，我为项目指定了一个 PostgreSQL 数据库，如果您在现有项目中使用不同的数据库，您可以在 web 上搜索特定数据库的服务示例。有很多例子，只要坚持这个想法去理解它是如何工作的，然后你就可以搜索它。

# 构建项目

如果您已经有了一个项目，并且刚刚迁移到 Docker，那么您可以跳过这一步，直接在您的项目上执行`docker-compose build`命令，以确保一切都被正确构建。

要生成 rails 项目，您将需要`web`容器，但是我们不需要依赖的`db`,并且我们在运行命令后也不需要维护这个容器。您可以访问 **Docker** 文档来理解这些如何映射到我在命令中传递的属性。最后，你会得到这样的东西:

这将创建您的项目文件并用其实际内容更新`Gemfile`。之后，你就可以用`docker-compose build`构建项目了。

# 配置您的数据库

为了以正确的方式初始化您的数据库，让我们确保数据库配置是正确的。你可以在下面看到我的`config/database.yml`文件的内容:

我在我的例子中使用 PostgreSQL，但是这里重要的是记住使用`docker-compose.yml`上的服务名作为数据库主机。其他信息将取决于您如何配置 docker 服务。

在开始工作之前，请确保也创建了数据库:

# 最后

现在，您可以用`docker-compose up`开始您的 rails 项目，并开始为它努力！

记得每次在项目中使用 gems 时运行`docker-compose build`。

非常感谢你陪我看完了这篇文章。如果你有任何问题、意见或顾虑，请务必在下面的评论区与我分享。你的掌声和分享对我继续发帖非常重要。

还有什么可以发到我在 jpmsantana14@gmail.com 的邮箱里