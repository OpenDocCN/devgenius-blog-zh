<html>
<head>
<title>SQL Practice questions — #2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 练习题— #2</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sql-practice-questions-2-f1116b1f5402?source=collection_archive---------8-----------------------#2022-08-13">https://blog.devgenius.io/sql-practice-questions-2-f1116b1f5402?source=collection_archive---------8-----------------------#2022-08-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4d09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">SQL 练习题第二部分</p><p id="8f28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击此处查看第一部分 <a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/sql-practice-questions-3-9fd3d6e56058">第三部分</a> <a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/sql-practice-questions-4-e24a6bdb32d4">第四部分</a> <a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/sql-practice-questions-5-456cfb41757a">第五部分</a></p><h2 id="058a" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">问题 1</h2><p id="c708" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">编写一个 SQL 查询，向使用了您朋友喜欢的页面的用户推荐页面。它不应该推荐你已经喜欢的网页。返回<strong class="jm io">任意订单</strong>中没有重复的结果表。</p><p id="9072" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">例 1: </strong></p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="35bd" class="kj kk in lk b gy lt lu l lv lw"><strong class="lk io">Input:</strong> <br/>Friendship table:<br/>+----------+----------+<br/>| user1_id | user2_id |<br/>+----------+----------+<br/>| 1        | 2        |<br/>| 1        | 3        |<br/>| 1        | 4        |<br/>| 2        | 3        |<br/>| 2        | 4        |<br/>| 2        | 5        |<br/>| 6        | 1        |<br/>+----------+----------+<br/>Likes table:<br/>+---------+---------+<br/>| user_id | page_id |<br/>+---------+---------+<br/>| 1       | 88      |<br/>| 2       | 23      |<br/>| 3       | 24      |<br/>| 4       | 56      |<br/>| 5       | 11      |<br/>| 6       | 33      |<br/>| 2       | 77      |<br/>| 3       | 77      |<br/>| 6       | 88      |<br/>+---------+---------+<br/><strong class="lk io">Output:</strong> <br/>+------------------+<br/>| recommended_page |<br/>+------------------+<br/>| 23               |<br/>| 24               |<br/>| 56               |<br/>| 33               |<br/>| 77               |<br/>+------------------+<br/><strong class="lk io">Explanation:</strong> <br/>User one is friend with users 2, 3, 4 and 6.<br/>Suggested pages are 23 from user 2, 24 from user 3, 56 from user 3 and 33 from user 6.<br/>Page 77 is suggested from both user 2 and user 3.<br/>Page 88 is not suggested because user 1 already likes it.</span></pre><p id="b7bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们找到所有和<code class="fe lh li lj lk b">user_id=1</code>是朋友的用户。然后，我们获取朋友喜欢的页面，并删除用户 1 已经喜欢的页面。</p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="a852" class="kj kk in lk b gy lt lu l lv lw">WITH friends AS (<br/>    SELECT user1_id AS friend<br/>    FROM Friendship<br/>    WHERE user2_id = 1<br/>    <br/>    UNION ALL<br/>    <br/>    SELECT user2_id AS friend<br/>    FROM Friendship<br/>    WHERE user1_id = 1<br/>),<br/>already_liked_pages AS (<br/>    SELECT page_id<br/>    FROM Likes<br/>    WHERE user_id = 1<br/>)<br/>SELECT<br/>    DISTINCT page_id as recommended_page<br/>FROM Likes<br/>WHERE user_id IN<br/>    (SELECT friend FROM friends)<br/>AND page_id NOT IN<br/>    (SELECT page_id from already_liked_pages)</span></pre><h2 id="3036" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">问题 2</h2><p id="8512" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">编写一个 SQL 查询来评估<code class="fe lh li lj lk b">Expressions</code>表中的布尔表达式。返回<strong class="jm io">任意顺序</strong>中的结果表。</p><p id="6848" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">例 1: </strong></p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="4074" class="kj kk in lk b gy lt lu l lv lw"><strong class="lk io">Input:</strong> <br/>Variables table:<br/>+------+-------+<br/>| name | value |<br/>+------+-------+<br/>| x    | 66    |<br/>| y    | 77    |<br/>+------+-------+<br/>Expressions table:<br/>+--------------+----------+---------------+<br/>| left_operand | operator | right_operand |<br/>+--------------+----------+---------------+<br/>| x            | &gt;        | y             |<br/>| x            | &lt;        | y             |<br/>| x            | =        | y             |<br/>| y            | &gt;        | x             |<br/>| y            | &lt;        | x             |<br/>| x            | =        | x             |<br/>+--------------+----------+---------------+<br/><strong class="lk io">Output:</strong> <br/>+--------------+----------+---------------+-------+<br/>| left_operand | operator | right_operand | value |<br/>+--------------+----------+---------------+-------+<br/>| x            | &gt;        | y             | false |<br/>| x            | &lt;        | y             | true  |<br/>| x            | =        | y             | false |<br/>| y            | &gt;        | x             | true  |<br/>| y            | &lt;        | x             | false |<br/>| x            | =        | x             | true  |<br/>+--------------+----------+---------------+-------+<br/><strong class="lk io">Explanation:</strong> <br/>As shown, you need to find the value of each boolean expression in the table using the variables table.</span></pre><p id="1d82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 case when 语句解决了这个问题。基于运算符，我们使用正确的代数运算符来检查表达式是真还是假。</p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="7149" class="kj kk in lk b gy lt lu l lv lw">SELECT e.left_operand, e.operator, e.right_operand,<br/>(<br/>  CASE<br/>    WHEN e.operator = '&lt;' AND v1.value &lt; v2.value THEN 'true'<br/>    WHEN e.operator = '=' AND v1.value = v2.value THEN 'true'<br/>    WHEN e.operator = '&gt;' AND v1.value &gt; v2.value THEN 'true'<br/>    ELSE 'false'<br/>  END<br/>) AS value<br/>FROM Expressions e<br/>JOIN Variables v1<br/>ON e.left_operand = v1.name<br/>JOIN Variables v2<br/>ON e.right_operand = v2.name</span></pre><h2 id="2d33" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">问题 3</h2><p id="b422" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">有一队人等着上公共汽车。但是，巴士的重量限制为<code class="fe lh li lj lk b">1000</code> <strong class="jm io">公斤</strong>，因此可能会有一些人无法上车。编写一个 SQL 查询来查找可以在不超过重量限制的情况下登上公交车的最后一个人的<code class="fe lh li lj lk b">person_name</code>。生成测试用例，使得第一个人不超过重量限制。</p><p id="b183" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">例 1: </strong></p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="3a70" class="kj kk in lk b gy lt lu l lv lw"><strong class="lk io">Input:</strong> <br/>Queue table:<br/>+-----------+-------------+--------+------+<br/>| person_id | person_name | weight | turn |<br/>+-----------+-------------+--------+------+<br/>| 5         | Alice       | 250    | 1    |<br/>| 4         | Bob         | 175    | 5    |<br/>| 3         | Alex        | 350    | 2    |<br/>| 6         | John Cena   | 400    | 3    |<br/>| 1         | Winston     | 500    | 6    |<br/>| 2         | Marie       | 200    | 4    |<br/>+-----------+-------------+--------+------+<br/><strong class="lk io">Output:</strong> <br/>+-------------+<br/>| person_name |<br/>+-------------+<br/>| John Cena   |<br/>+-------------+<br/><strong class="lk io">Explanation:</strong> The folowing table is ordered by the turn for simplicity.<br/>+------+----+-----------+--------+--------------+<br/>| Turn | ID | Name      | Weight | Total Weight |<br/>+------+----+-----------+--------+--------------+<br/>| 1    | 5  | Alice     | 250    | 250          |<br/>| 2    | 3  | Alex      | 350    | 600          |<br/>| 3    | 6  | John Cena | 400    | 1000         | (last person to board)<br/>| 4    | 2  | Marie     | 200    | 1200         | (cannot board)<br/>| 5    | 4  | Bob       | 175    | ___          |<br/>| 6    | 1  | Winston   | 500    | ___          |<br/>+------+----+-----------+--------+--------------+</span></pre><p id="3bc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一个简单的方法是计算上车人数的累计总数，看看是否超过了公共汽车总载客量的限制。</p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="f195" class="kj kk in lk b gy lt lu l lv lw">SELECT person_name<br/>FROM (<br/>    SELECT Turn, person_name, SUM(weight) OVER(ORDER BY Turn asc) AS Total_Weight<br/>    FROM Queue<br/>) AS T<br/>WHERE Total_weight &lt;= 1000<br/>ORDER BY Total_weight desc<br/>limit 1</span></pre><h2 id="45ed" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">问题 4</h2><p id="6d3d" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">编写一个 SQL 查询来报告每只股票的<strong class="jm io">资本收益/损失</strong>。股票的<strong class="jm io">资金损益</strong>是一次或多次买卖股票后的总损益。返回<strong class="jm io">任意顺序</strong>中的结果表。</p><p id="b5fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">例 1: </strong></p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="eaec" class="kj kk in lk b gy lt lu l lv lw"><strong class="lk io">Input:</strong> <br/>Stocks table:<br/>+---------------+-----------+---------------+--------+<br/>| stock_name    | operation | operation_day | price  |<br/>+---------------+-----------+---------------+--------+<br/>| Leetcode      | Buy       | 1             | 1000   |<br/>| Corona Masks  | Buy       | 2             | 10     |<br/>| Leetcode      | Sell      | 5             | 9000   |<br/>| Handbags      | Buy       | 17            | 30000  |<br/>| Corona Masks  | Sell      | 3             | 1010   |<br/>| Corona Masks  | Buy       | 4             | 1000   |<br/>| Corona Masks  | Sell      | 5             | 500    |<br/>| Corona Masks  | Buy       | 6             | 1000   |<br/>| Handbags      | Sell      | 29            | 7000   |<br/>| Corona Masks  | Sell      | 10            | 10000  |<br/>+---------------+-----------+---------------+--------+<br/><strong class="lk io">Output:</strong> <br/>+---------------+-------------------+<br/>| stock_name    | capital_gain_loss |<br/>+---------------+-------------------+<br/>| Corona Masks  | 9500              |<br/>| Leetcode      | 8000              |<br/>| Handbags      | -23000            |<br/>+---------------+-------------------+</span></pre><p id="8b42" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我们买入时，意味着我们花了那么多钱，当我们卖出时，我们得到了那么多钱。总收益或总损失为 sum(收益)— sum(支出)。我们使用 case when 表达式对价格进行正负赋值，然后求和。</p><pre class="ll lm ln lo gt lp lk lq lr aw ls bi"><span id="1b46" class="kj kk in lk b gy lt lu l lv lw">select stock_name, <br/>    SUM(CASE WHEN operation='Buy' THEN -price else price end) as capital_gain_loss<br/>from Stocks<br/>GROUP BY stock_name</span></pre><p id="0041" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">查询愉快！！</p></div></div>    
</body>
</html>