<html>
<head>
<title>How to setup an MLflow 2.0 Workspace with Docker?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Docker 设置 MLflow 2.0 工作空间？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-setup-an-mlflow-2-0-workspace-with-docker-7e4938b695e5?source=collection_archive---------5-----------------------#2022-12-04">https://blog.devgenius.io/how-to-setup-an-mlflow-2-0-workspace-with-docker-7e4938b695e5?source=collection_archive---------5-----------------------#2022-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6220" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">使用 MLflow 管理机器学习生命周期—部署您自己的 MLflow 工作空间</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/58e96f8e7d2d0b9426bb69398eef6943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zy2u1SXfN6osU3E-"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/ja/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CHUTTERSNAP </a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="bc49" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">MLflow 是一个管理机器学习(ML)生命周期的开源平台。通过使用 ML flow，可以对每个 ML 实验的代码、数据和结果进行跟踪，这意味着可以随时查看所有处理步骤。所有实验都是可重复的，您可以使用 MLflow 共享和部署您的模型。此外，MLflow 提供了一组 API，可用于许多现有的 ML 库，如 TensorFlow、PyTorch 或 sklearn，无论您在哪里运行 ML 代码(例如，在 jupyter 笔记本上或在云中)。MLflow 与库无关。所有功能都可以通过<a class="ae kw" href="https://mlflow.org/docs/latest/rest-api.html#rest-api" rel="noopener ugc nofollow" target="_blank"> REST API </a>和<a class="ae kw" href="https://mlflow.org/docs/latest/cli.html#cli" rel="noopener ugc nofollow" target="_blank"> CLI </a>访问。此外，MLflow 项目还包括一个<a class="ae kw" href="https://mlflow.org/docs/latest/python_api/index.html#python-api" rel="noopener ugc nofollow" target="_blank"> Python API </a>、<a class="ae kw" href="https://mlflow.org/docs/latest/R-api.html#r-api" rel="noopener ugc nofollow" target="_blank"> R API </a>和<a class="ae kw" href="https://mlflow.org/docs/latest/java_api/index.html#java-api" rel="noopener ugc nofollow" target="_blank"> Java API </a>。</p><p id="49b5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">作为一名数据科学家，你花了很多时间优化 ML 模型。最佳模型通常取决于最佳超参数或特征选择，并且很难找到最佳组合。还有，你要记住所有的组合，这很费时间。MLflow 是应对这些挑战的高效开源平台。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi lt"><img src="../Images/feb6bb5be4c1157657b2c46b92c910de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ywIFZxiHjVtJ7VNm91_ENg.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">带有 Docker 的 MLflow 工作区(作者插图)</figcaption></figure><p id="6989" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本帖中，我们将介绍 MLflow 的基本功能，并展示 Docker 的设置。在这种情况下，MLflow 建立在 docker 堆栈中，具有 Postgres 数据库、SFTP 服务器和 JupyterLab。这些步骤如下:</p><ol class=""><li id="131a" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls lz ma mb mc bi translated"><strong class="kz ir">物流基础知识</strong></li><li id="1e78" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated"><strong class="kz ir">技术要求</strong></li><li id="0d3b" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated"><strong class="kz ir">使用 Docker </strong>进行设置</li><li id="afb2" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated"><strong class="kz ir">结论</strong></li><li id="c799" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated"><strong class="kz ir">有用的文献和链接</strong></li></ol><h1 id="6610" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">🤔<strong class="ak">物流基础知识</strong></h1><p id="8dc0" class="pw-post-body-paragraph kx ky iq kz b la na jr lc ld nb ju lf lg nc li lj lk nd lm ln lo ne lq lr ls ij bi translated">目前，MLflow 提供了四个组件。您可以在下图中看到它们。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nf"><img src="../Images/790ded96d7efe9ccab11d5663fd5f1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_PbpD09bHM3qb87hb898Q.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">MLflow 功能概述(作者插图)</figcaption></figure><ul class=""><li id="1773" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls ng ma mb mc bi translated"><strong class="kz ir"> MLflow Tracking </strong>用于跟踪和查询实验。它跟踪模型参数、代码、数据和模型工件。此外，MLFlow 的跟踪服务器提供了一个 Web UI，它显示了被跟踪的 ML 模型。ML flow 库已经提供了 Web 用户界面。跟踪服务器是以实验的形式组织的。在实验中，可以通过可视化结果来比较 ML 模型。</li><li id="fd08" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><strong class="kz ir"> MLflow 项目</strong>是一个组件，用于以可重用和可复制的方式封装数据科学代码。</li><li id="ba46" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><strong class="kz ir"> ML 流模型</strong>格式为使用不同库(如 TensorFlow、PyTorch 或 sklearn)创建的 ML 模型提供了统一的存储格式。统一的格式支持在不同的环境中部署。</li><li id="4a4b" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><strong class="kz ir">模型注册</strong>组件允许提供从试生产到生产的生产模型的年表。它支持在中央模型库中管理 ML 模型。</li></ul><p id="84fb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以在 MLflow 的<a class="ae kw" href="https://mlflow.org/docs/latest/index.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>和<a class="ae kw" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中了解更多关于各个组件的信息。</p><h1 id="6f40" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">✅技术要求</h1><p id="eb5b" class="pw-post-body-paragraph kx ky iq kz b la na jr lc ld nb ju lf lg nc li lj lk nd lm ln lo ne lq lr ls ij bi translated">您将需要以下先决条件:</p><ul class=""><li id="4049" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls ng ma mb mc bi translated">您的机器上必须安装最新版本的 Docker。如果您尚未安装，请遵循<a class="ae kw" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">说明</a>。</li><li id="78dc" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated">您的计算机上必须安装最新版本的 Docker Compose。请遵循<a class="ae kw" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">指示</a>。</li><li id="40b3" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated">访问 bash (macOS、Linux 或 Windows)。</li></ul><h1 id="044e" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">🖥 <strong class="ak">用 Docker </strong>设置工作空间</h1><p id="8816" class="pw-post-body-paragraph kx ky iq kz b la na jr lc ld nb ju lf lg nc li lj lk nd lm ln lo ne lq lr ls ij bi translated">首先，您应该检查是否正确安装了 Docker 和 Docker Compose。打开您选择的终端并输入以下命令:</p><pre class="kh ki kj kk gt nh ni nj bn nk nl bi"><span id="f569" class="nm mj iq ni b be nn no l np nq">$ docker --version<br/># Example output: $ Docker version 20.10.21</span></pre><p id="25a0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果安装正确，则输出 Docker 版本。您可以为您的 Docker Compose 安装检查相同的内容。</p><pre class="kh ki kj kk gt nh ni nj bn nk nl bi"><span id="80f7" class="nm mj iq ni b be nn no l np nq">$ docker-compose --version<br/># Example output: $ Docker Compose version v2.12.2</span></pre><p id="2c3d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">是啊。一切正常。现在我们可以从 Docker 组合栈开始。</p><p id="cc8c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">有几种方法可以使用 MLflow。您可以将 MLflow 与 localhost 一起使用，或者为生产环境部署完整的堆栈。在这篇文章中，我们将重点讨论第二种选择。该堆栈包含四个服务，如下图所示。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nr"><img src="../Images/f7ffc0735d0fcd4e780a8f48b15f9d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fi8KDmVe2sbb_QVc5ucDYA.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">Docker 合成堆栈(作者插图)</figcaption></figure><p id="b305" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在下文中，我们描述各个服务。你可以在我们的<a class="ae kw" href="https://github.com/tinztwins/mlflow-workspace" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到完整的 docker-compose 栈。启动堆栈的确切说明在项目自述文件中。我们已经在一个。环境文件。</p><ul class=""><li id="906f" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls ng ma mb mc bi translated"><strong class="kz ir"> JupyterLab </strong>是一个基于网络的笔记本、代码和数据交互开发环境。它经常用于数据科学项目。在这篇文章中，我们使用了 DockerHub 上的<a class="ae kw" href="https://hub.docker.com/r/jupyter/scipy-notebook" rel="noopener ugc nofollow" target="_blank"> jupyter/scipy-notebook </a>图片。您也可以使用其他 Jupyter 图像，如 JupyterHub。在工作区设置中，它可用于创建和跟踪 ML 模型。</li><li id="b677" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated">SFTP 服务器是一个远程数据存储器。SFTP(安全文件传输协议)是一种文件传输协议，提供对远程计算机的安全访问。在这个项目中，我们使用来自 DockerHub 的<a class="ae kw" href="https://hub.docker.com/r/atmoz/sftp" rel="noopener ugc nofollow" target="_blank"> atmoz/sftp </a>映像。您也可以使用其他存储技术，如 AWS S3。在我们的设置中，SFTP 服务器充当工件存储。在这个商店里，我们存放着经过训练的 ML 模型和其他人工制品，如 jupyter 笔记本。</li><li id="c04a" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><strong class="kz ir">物流跟踪服务器</strong>提供物流网络用户界面。在这个 Web UI 上，你可以看到所有的实验，并仔细查看具体的实验。我们使用<a class="ae kw" href="https://hub.docker.com/_/python" rel="noopener ugc nofollow" target="_blank"> python:3.9.15 </a> Docker 图像。服务器可以在<em class="ns"> localhost:5000 </em>访问。你可以在下面看到一个网页界面的截图。</li></ul><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nt"><img src="../Images/7088fedce73630e7c83b7272a6f9be23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rr-B-RqLZXNevnT6lr_EfA.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">MLflow Web 用户界面</figcaption></figure><ul class=""><li id="b5e0" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls ng ma mb mc bi translated">Postgres 是一个免费的开源关系数据库管理系统。我们用它来存储参数和评估指标。在本帖中，我们使用 DockerHub 的官方<a class="ae kw" href="https://hub.docker.com/_/postgres" rel="noopener ugc nofollow" target="_blank"> postgres </a> docker 图片。</li></ul><p id="a2fb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以使用以下命令启动 docker-compose 堆栈:</p><pre class="kh ki kj kk gt nh ni nj bn nk nl bi"><span id="252d" class="nm mj iq ni b be nn no l np nq">$ docker compose up -d</span></pre><p id="50a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">标志-d 意味着容器作为守护进程运行。在这种模式下，终端不输出任何日志。您可以使用以下命令查看特定容器的日志:</p><pre class="kh ki kj kk gt nh ni nj bn nk nl bi"><span id="d8bf" class="nm mj iq ni b be nn no l np nq">$ docker compose logs --follow &lt;container_name&gt;</span></pre><p id="e2a0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">日志显示容器的状态。如果一切正常，那么您可以使用 MLflow 工作区。</p><p id="42eb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">首先，您可以登录 JupyterLab 服务器。您必须使用 jupyter 容器日志中的令牌。当你在本地启动时，网址是<em class="ns"> localhost:8888 </em>。在服务器上，你可以看到 jupyter 笔记本。您可以使用笔记本<em class="ns"> mlflow_example.ipynb </em>检查您的设置。执行每个单元，并检查没有错误出现。没有错误？是的，你的设置很成功。</p><p id="a379" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">接下来，您可以检查 MLflow 跟踪服务器是否正确跟踪了您的实验。访问以下网址:<em class="ns"> localhost:5000。</em>您应该会看到 MLflow web UI。现在你可以选择实验“MLflow Example”并点击运行。新页面打开。此页面显示跟踪的参数、度量和工件。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nu"><img src="../Images/82608b48ea0d9b37a6a1a54343ee3439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2EkKViyai_3g-QJzHctsQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">跟踪值概述</figcaption></figure><p id="bb2a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">还可以看到 jupyter 笔记本被跟踪。结果是由哪个代码生成的总是很清楚的。很有帮助。现在你可以从你的笔记本开始。试试看。</p><h1 id="4933" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">🎬结论</h1><p id="9758" class="pw-post-body-paragraph kx ky iq kz b la na jr lc ld nb ju lf lg nc li lj lk nd lm ln lo ne lq lr ls ij bi translated">在这篇文章中，我们看到了如何用 Docker 建立一个 MLflow 工作空间。在这种情况下，我们学习了如何将服务互连到一个整体系统。我们在我们的<a class="ae kw" href="https://github.com/tinztwins/mlflow-workspace" rel="noopener ugc nofollow" target="_blank"> GitHub </a>账户上提供完整的源代码。试试看。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="3bbe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你喜欢这篇文章吗？成为<a class="ae kw" href="https://tinztwins.medium.com/membership" rel="noopener">中级会员</a>继续无限学习。当您使用该链接时，我们将收取一小部分会员费。您无需支付额外费用。</p><p id="12f4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">不要错过我们接下来的故事:</strong></p><div class="oc od gp gr oe of"><a href="https://tinztwins.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">每当 Tinz Twins 发布时收到一封电子邮件。</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">每当 Tinz Twins 发布时收到一封电子邮件。注册后，如果您还没有，您将创建一个中型帐户…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">tinztwins.medium.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot kq of"/></div></div></a></div><p id="cf8f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">非常感谢你的阅读。如果你喜欢这篇文章，请随意分享。关注我们了解更多内容。祝你有美好的一天！</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ou"><img src="../Images/1924008e75e30f4baed4775b04724600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlzonw5462Puvm28fvAnfg.png"/></div></div></figure><h1 id="2972" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">🔍有用的文献和链接</h1><ul class=""><li id="b83b" class="lu lv iq kz b la na ld nb lg ov lk ow lo ox ls ng ma mb mc bi translated"><a class="ae kw" href="https://mlflow.org/docs/latest/index.html" rel="noopener ugc nofollow" target="_blank">物流单据</a></li><li id="34a2" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><a class="ae kw" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank"> MLflow GitHub </a></li><li id="9390" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><a class="ae kw" href="https://www.packtpub.com/product/machine-learning-engineering-with-mlflow/9781800560796" rel="noopener ugc nofollow" target="_blank">采用 MLflow 的机器学习工程</a></li><li id="ea37" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls ng ma mb mc bi translated"><a class="ae kw" href="https://www.amazon.de/-/en/Sridhar-Alla/dp/1484265483" rel="noopener ugc nofollow" target="_blank">用 MLFlow 开始 MLOps】</a></li></ul></div></div>    
</body>
</html>