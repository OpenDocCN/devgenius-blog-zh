<html>
<head>
<title>Should you use .map(), .forEach(), or .filter()? Are they fast enough?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你应该使用。map()，。forEach()或。filter()？他们够快吗？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/should-you-use-map-reduce-or-filter-are-they-fast-enough-fe3133be8150?source=collection_archive---------1-----------------------#2020-07-24">https://blog.devgenius.io/should-you-use-map-reduce-or-filter-are-they-fast-enough-fe3133be8150?source=collection_archive---------1-----------------------#2020-07-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0fca3e4049c0ccb209ff0c5ea856340d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DyYVYo2yuCNRG7lT"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Jonathan Chng 在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2a21" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我读了下面的文章，建议在JavaScript中使用内置数组函数。我一直听说那些方法比内置的<code class="fe ky kz la lb b">for</code>循环要慢很多，但是我自己从来没有实际测量过。</p><div class="lc ld gp gr le lf"><a href="https://medium.com/poka-techblog/simplify-your-javascript-use-map-reduce-and-filter-bd02c593cc2d" rel="noopener follow" target="_blank"><div class="lg ab fo"><div class="lh ab li cl cj lj"><h2 class="bd io gy z fp lk fr fs ll fu fw im bi translated">简化您的JavaScript——使用。map()，。reduce()和。过滤器()</h2><div class="lm l"><h3 class="bd b gy z fp lk fr fs ll fu fw dk translated">如果你没听说过。map()，。reduce()和。JavaScript中的filter()，你可能想学习使用它！</h3></div><div class="ln l"><p class="bd b dl z fp lk fr fs ll fu fw dk translated">medium.com</p></div></div><div class="lo l"><div class="lp l lq lr ls lo lt jt lf"/></div></div></a></div><p id="76e6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，我想现在是时候了。所以，我们去做些测试吧！</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="2027" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">基线</h1><p id="fe1e" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">我运行代码的机器是MacBook Pro，配有2.5GHz四核英特尔酷睿i7处理器和16GB 1600 MHz DDR3内存。我的节点版本是12.14.0。</p><p id="b30f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然<a class="ae jz" href="https://stackoverflow.com/a/6155063/6496010" rel="noopener ugc nofollow" target="_blank">最大数组长度是2 </a>，但我的计算机实际上无法创建具有该长度的数组而不出现<code class="fe ky kz la lb b">JavaScript heap out of memory</code>错误。基于本地测试，5000万长度的数组是我所能达到的最高长度。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="d402" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">标准</h1><p id="55fd" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">这些功能将通过两种方式进行判断:</p><ul class=""><li id="5b5b" class="ne nf in kc b kd ke kh ki kl ng kp nh kt ni kx nj nk nl nm bi translated">内存使用——使用<code class="fe ky kz la lb b">process.memoryUsage().heapUsed</code>测量</li><li id="0107" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated">执行速度——使用<code class="fe ky kz la lb b">Date</code>对象和一级数学来测量</li></ul></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="440c" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">剧本</h1><figure class="ns nt nu nv gt jo"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e862" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该脚本创建500个增量为100K的数组，测量每个代码执行所需的时间，并输出到一个CSV文件。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="24a8" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">参赛者是谁？</h1><ul class=""><li id="c6b8" class="ne nf in kc b kd mz kh na kl ny kp nz kt oa kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">filter</code></li><li id="d4a8" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">for</code></li><li id="215a" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">forEach</code></li><li id="93cf" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">for / in</code></li><li id="5e22" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">for / of</code></li><li id="f80b" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx nj nk nl nm bi translated"><code class="fe ky kz la lb b">map</code></li></ul><p id="1412" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们看看每个函数是如何执行的！谁对结果感到兴奋？</p><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/9280a58c816a5509b3bbb7bc51ebfe08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hwC2vQeV5neKIgE3"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@camylla93?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Camylla Battani </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。她当然是！！</figcaption></figure></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="9c42" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">过滤器</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/1ba969cd2f8d7fe4fd03d68314616dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZSbIZT9QHyu69_vpUNijw.png"/></div></div></figure><p id="c419" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度线性增加。</p><p id="8b5b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆图显示每个峰之间的距离在超过33M长度后显著缩短。(这个很有意思，但是我还没想明白为什么会这样。).</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="e5c2" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">为</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi od"><img src="../Images/04ca9f6298821c56cf1c753345ffda55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKVhkmqDoNOgMyCtzz215g.png"/></div></div></figure><p id="a189" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度保持在20毫秒以下，直到33.9米。然后它跃升至510毫秒，并在50米时慢慢增加到782毫秒。</p><p id="6db7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆显示了类似的模式，峰值也在33米左右收紧。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="0a7a" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">为每一个</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/dd3ad7f8fbd78d660b7a37de745b736b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EyNj8EcDVQoFN03ZMbnN2A.png"/></div></div></figure><p id="0e1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度线性增加。</p><p id="e5eb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆遵循类似的模式(你会听到我再说几次)。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="45b5" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">福林</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/8b10be95ee6fe5d92010195653d314d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aw7j63K5I5ht5KpeHBaabg.png"/></div></div></figure><p id="149e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度线性增加，但与其他功能相比噪音更大。</p><p id="d757" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆不遵循模式。实际上，内存使用量下降了4300万左右。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="b5d4" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">ForOf</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/0ee78eb5ab59a5897a0a54d1868e20a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzqQPFKNQEqGiO5vhWmcaQ.png"/></div></div></figure><p id="4a6a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度遵循与<code class="fe ky kz la lb b">for</code>循环相似的模式。峰值出现在33.6米处。在峰值出现之前，速度保持在50毫秒以下。</p><p id="6ef5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆遵循正常的模式。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="1033" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">地图</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/0f6c315ce116e57188762334a3511a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-sK3_pKM1bN1xBjZHJx_Q.png"/></div></div></figure><p id="25da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">速度随着峰值线性上升(你猜对了！)33.4米。</p><p id="0f4b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记忆和以前一样遵循以前的模式。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="ef56" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">速度结果</h1><p id="a28e" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">让我们比较一下每个函数的速度。</p><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/360f14ef4c29ecd801fbfa17cb7215ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHa-Kytc-by0xmcgGTDKkQ.png"/></div></div></figure><p id="a5e7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到目前为止，<code class="fe ky kz la lb b">forIn</code>和<code class="fe ky kz la lb b">map</code>表现最差。让我们把这两个都去掉，以便更清楚地看到其他四个。</p><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/33565c41a07e7ca022c42bc7b4ce4c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*neDVvf7-XK9QiO4SQl_HMg.png"/></div></div></figure><p id="c485" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">for</code>是最快的，直到我们达到33.5米的长度，但超过这个长度后就变得最慢，此时<code class="fe ky kz la lb b">forOf</code>成为速度的明显赢家。</p><p id="83f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">for</code>和<code class="fe ky kz la lb b">forOf</code>都达到速度急剧增加的点，其中<code class="fe ky kz la lb b">forEach</code>和<code class="fe ky kz la lb b">filter</code>在整个测试中线性增加。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="edcc" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">记忆结果</h1><figure class="ns nt nu nv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/8a34a0247c29f6b1f296176a4e45d2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSTaCrFexMx4tGnEM05yjg.png"/></div></div></figure><p id="28c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然该图非常嘈杂，但我们通常可以看到<code class="fe ky kz la lb b">for</code>、<code class="fe ky kz la lb b">forOf</code>和<code class="fe ky kz la lb b">forEach</code>使用的内存比其余的要少。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="d591" class="mb mc in bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">判决</h1><p id="8657" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">基于速度和内存数据，<code class="fe ky kz la lb b">for</code>循环今天胜出。对于大多数常见的用例(例如，长度小于3300万的数组)来说，它是最快的，并且与其他相比，它的内存效率更高。</p><p id="d2c9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，对于日常编程使用，这些方法中的任何一个都足够快。1M以下，除了<code class="fe ky kz la lb b">map</code>和<code class="fe ky kz la lb b">for/in</code>都可以在10ms左右完成。</p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><p id="09fc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望在以后的文章中深入探讨几个开放性的问题。(当然，我欢迎任何有识之士)</p><ol class=""><li id="a86d" class="ne nf in kc b kd ke kh ki kl ng kp nh kt ni kx oi nk nl nm bi translated">为什么<code class="fe ky kz la lb b">for</code>和<code class="fe ky kz la lb b">for/of</code>循环达到临界点，导致速度急剧下降？和我的硬件有关吗？还是和节点有关？</li><li id="6f6b" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx oi nk nl nm bi translated">为什么内存图在大约与#1相同的临界点处根据<code class="fe ky kz la lb b">peak width</code>发生变化？</li><li id="ea0c" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx oi nk nl nm bi translated">是什么让<code class="fe ky kz la lb b">map</code>明显比<code class="fe ky kz la lb b">for</code>循环慢？如果我创建一个空数组，使用for循环，并将结果压入新数组，我预计会比<code class="fe ky kz la lb b">map</code>快得多。(下次再考！)</li><li id="4fbc" class="ne nf in kc b kd nn kh no kl np kp nq kt nr kx oi nk nl nm bi translated">为什么<code class="fe ky kz la lb b">for/in</code>的表现比<code class="fe ky kz la lb b">for/of</code>差那么多？</li></ol></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><p id="ef96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。这是一个超级有趣的实验，将我的电脑的冷却系统推到了极限(它变得非常非常热)。请随时给我留言！</p><p id="a1c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哦！我的公司正在招人！<a class="ae jz" href="https://www.skillz.com/careers-list/" rel="noopener ugc nofollow" target="_blank">查看我们的角色</a>！</p></div></div>    
</body>
</html>