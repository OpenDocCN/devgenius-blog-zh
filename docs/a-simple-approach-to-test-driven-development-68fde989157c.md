# 测试驱动开发的简单方法

> 原文：<https://blog.devgenius.io/a-simple-approach-to-test-driven-development-68fde989157c?source=collection_archive---------10----------------------->

🚀 [**打造分层微服务**](https://learnbackend.dev/books/build-layered-microservices) 这本书出来了！立即在 [learnbackend.dev](https://learnbackend.dev/books/build-layered-microservices) 购买您自己的副本。

![](img/8854a3922a3dc576fa6bbc9288b36105.png)

软件测试是一种检查实际产品是否与预期要求相匹配的方法，它还确保:

*   它没有缺陷。
*   它能正确响应各种输入。
*   它在可接受的时间内执行其功能。
*   它可以在预期的环境中正常运行。
*   它是可用的。

但是除此之外，测试也可以作为开发软件的框架。

稍加研究，你会发现有几十种测试技术和软件开发过程，但今天我们将关注一种叫做*的基于*单元测试*的测试驱动开发*。

# 什么是单元测试？

简单地说，*单元测试*是一种测试系统中可以逻辑隔离的最小代码片段的方法。

换句话说，这意味着测试一个特定的功能，它不连接或依赖于外部依赖，如数据库、文件系统或 HTTP 服务；例如计算器程序中的`add`函数，它接受两个数字并返回它们的和。

请记住，这种测试技术的目的纯粹是测试代码逻辑，而不是别的。

# 什么是测试驱动开发，为什么？

如果你是编程新手，你的直觉会告诉你开发一个软件最好最快的方法是首先编码，然后测试，最后修复。

理论上来说，只要项目很小，而且只有你一个人在做，这没什么不好。

但是，假设你的项目发展成为一个产品，你最终雇佣了整个团队来帮助你。

随着时间的推移，您的代码库越来越大，产品的复杂性也越来越大，这通常意味着:

*   错误开始出现
*   添加功能变得很粗糙
*   新开发人员发现很难理解代码
*   团队的速度最终会下降

此时，你意识到编码/测试/修复的方法不再有效，你的团队必须想出新的方法来提高代码的可读性、可靠性和灵活性。

现在，这正是*测试驱动开发*要解决的问题。

*TDD* 是一种测试优先的方法，它将软件开发反过来，并依赖于在软件开发之前首先将产品需求转换成测试用例。

因此，在功能代码之前编写测试可以确保:

*   更好地了解产品
*   守则的有效性
*   对质量的持续关注

# TDD 原则:红色、绿色、重构

这个方法分三个阶段:红色、绿色和重构。

## 红色

*   首先，我们编写一个新的测试，它基于用例以及用户故事来匹配特性的规范。
*   然后我们运行测试用例，见证新测试失败，因为特性还没有实现。

## 格林（姓氏）；绿色的

*   第二，我们编写尽可能简单的代码来使新的测试通过，这不需要优雅或易于理解——它只需要工作。
*   然后，我们重新运行所有的测试用例，这次确保它们都成功通过。

## 重构

*   最后——如果需要——我们重构刚刚编写的代码，但不要忘记最后一次重新运行所有案例，以确保在这个过程中没有任何问题。

# 最佳实践

正如我们所看到的，这种模式的实现相当简单和直接，但是在编写这些测试时需要记住一些事情。

## 他们应该很快

如果它们很慢，开发人员就不会运行它们，所以我们真的需要让它们尽可能的短，并且彼此完全独立。

## 它们应该是可读的

它们是最好的文档形式，因为它们不会与它们记录的代码失去同步。

为此，建议:

**使用 BDD 风格的测试用例，形式为:给定/何时/然后**

*   **鉴于**我的银行账户有存款，而且我最近没有取款，
*   **当**我试图提取的金额少于我卡的限额时，
*   **然后**撤销应该完成，没有错误或警告

**每个方法最好只有一个逻辑断言**

*   "当余额为 30 时，它应该返回 10 . "

**不惜一切代价避免使用魔法值**

*   `0x159621`

## 它们应该是确定性的

确定性是一个有趣的词，它表示无论我们运行多少次测试，如果底层代码没有改变，它们应该以相同的方式运行，否则开发人员没有理由信任它们。

这就是为什么他们不应该依赖:

*   其他测试案例
*   可能改变的环境值，例如当前时间
*   可能失败的文件系统、网络或 API

## 它们应该遵循相同的命名约定

行为驱动开发有一种优雅的写法:应该+预期行为+何时+测试状态。

例如:

*   "当 X 大于 0 时，它应该返回 true . "
*   "当除法器为零时，它应该抛出一个错误."

# 下一步是什么？

不要忘记👏🏻如果你喜欢读我的作品！

👉你喜欢这种内容？在 [https://learnbackend.dev](https://learnbackend.dev/) 查看《如何使用 Express framework 构建生产就绪的分层认证微服务》一书 [**构建分层微服务**](https://learnbackend.dev/books/build-layered-microservices) ，该书从第一行代码到最后一行文档都符合开发实践和软件架构方面的行业标准。