<html>
<head>
<title>Complete guide to translation Django model fields</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 模型字段翻译完全指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/complete-guide-to-translation-django-model-fields-ed926a463689?source=collection_archive---------1-----------------------#2022-03-16">https://blog.devgenius.io/complete-guide-to-translation-django-model-fields-ed926a463689?source=collection_archive---------1-----------------------#2022-03-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="aebb" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使 Django 中的模型字段可翻译</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d7464fe8c3652cbe0f7b7fe615d6fd8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YdpI5RsfQWWitqIwZJ9JA.png"/></div></div></figure><p id="b075" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">拥有多语言内容是现代网站的主要特征之一。在本文中，我们将看到如何使 Django 模型字段可翻译。</p><p id="3f5e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们将使用<em class="lk">django-model translation</em>包。你可以在这里了解更多。</p><h1 id="3997" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">模型</h1><p id="1355" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">假设我们有一个人模型，它有三个字段:姓名和职业。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="0636" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<code class="fe ml mm mn mo b">admin.py</code>文件中注册模型后，我们可以通过管理面板添加人物对象。我们将有一个简单的视图、序列化器和 url 来查看 django rest 框架中作为 json 响应的数据。为了简单起见，我不会展示如何创建所有这些东西，因为主要重点是使字段可翻译。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mp"><img src="../Images/f9a241cfb5f4855ad9149d412f983513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ap-_8Cp-nn9kawq3F4ZFNw.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">在管理界面中添加人员对象</figcaption></figure><p id="34c0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以从图片中看到，我们只能添加一种语言(英语或任何其他语言)的领域。</p><p id="31f1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们将数据视为 json 响应:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mu"><img src="../Images/4a62cef16d3c9e3c7a33780b563a5d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FA76fM4ElmcWaBACDfYPVQ.png"/></div></div></figure><h1 id="bdf5" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">设置</h1><p id="72ab" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">现在让我们安装上面提到的软件包:</p><pre class="kd ke kf kg gt mv mo mw mx aw my bi"><span id="5d1c" class="mz ln in mo b gy na nb l nc nd">$ pip install django-modeltranslation</span></pre><p id="2c26" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安装成功后，我们需要将<code class="fe ml mm mn mo b">modeltranslation</code>添加到项目 settings.py 中的<code class="fe ml mm mn mo b">INSTALLED_APPS</code>中。</p><p id="2e7d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在设置文件中，我们必须设置<code class="fe ml mm mn mo b">USE_I18N = True</code></p><p id="7d10" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">那我们应该设定<code class="fe ml mm mn mo b">LANGUAGES</code></p><pre class="kd ke kf kg gt mv mo mw mx aw my bi"><span id="cced" class="mz ln in mo b gy na nb l nc nd">gettext = lambda s: s<br/>LANGUAGES = (<br/>    ('en', gettext('English')),<br/>    ('ru', gettext('Russian')),<br/>)</span></pre><p id="ee65" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，我们应该在存储<code class="fe ml mm mn mo b">models.py</code>文件的应用程序中创建<code class="fe ml mm mn mo b">translation.py</code>。在这个文件中，我们应该为有问题的型号注册<code class="fe ml mm mn mo b">TranslationOptions</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">translation.py</figcaption></figure><p id="d8bc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe ml mm mn mo b">fields</code>包含我们希望可翻译的字段名。</p><p id="9247" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们应该运行迁移，并将它们迁移到数据库:</p><pre class="kd ke kf kg gt mv mo mw mx aw my bi"><span id="17cb" class="mz ln in mo b gy na nb l nc nd">$<!-- --> python manage.py makemigrations<br/>$<!-- --> python manage.py migrate</span></pre><p id="ebab" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然而，如果我们想在管理面板中添加一个新的 Person 对象，我们会看到每个字段仍然有一个框，这意味着我们只能添加一种语言的值。</p><p id="07ea" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这就是为什么我们要改变<code class="fe ml mm mn mo b">admin.py</code>。<code class="fe ml mm mn mo b">PersonAmin</code>类必须从<code class="fe ml mm mn mo b">modeltranslation.admin</code>继承<code class="fe ml mm mn mo b">TranslatioAdmin</code>。<code class="fe ml mm mn mo b">PersonAdmin</code>类将不包含任何内容，因为我们在此阶段不自定义管理界面。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">管理. py</figcaption></figure><p id="1f2c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当试图添加新的人或改变现有的人时，可以在管理面板中看到新的字段:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/38cd243eb8d934729e7e14199ffcbaaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BahNp785Qnss4Cb3D_s-3A.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">管理中的新字段</figcaption></figure><p id="7eab" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们用新字段再次添加两个对象，并检查 json 响应:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/ff9ebe6b06b0fc36d7f67999f2473bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhRdNEpnKqU1k_HK98EAQw.png"/></div></div></figure><p id="7cb9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以看到添加了两个字段，例如<code class="fe ml mm mn mo b">name_ru </code>和<code class="fe ml mm mn mo b">name_en</code>。如果我们试图获取对象的名称，我们将使用<code class="fe ml mm mn mo b">object.name</code>，它会用默认语言给出值。默认情况下，默认语言是由<code class="fe ml mm mn mo b">LANGUAGE_CODE</code>在<code class="fe ml mm mn mo b">settings.py</code>中指定的语言。</p><h1 id="9fbd" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">处理请求标题中的默认语言</h1><p id="4278" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">因为我们在项目设置中指定了默认语言，所以对于所有请求中的所有用户，我们会得到与设置文件中指定的语言相同的响应。你会同意，这不是我们想要的，因为我们希望每个用户都以特定的语言得到响应。处理它的方法之一是在请求头中发送语言。我们将在请求中发送<code class="fe ml mm mn mo b">Accept-Language</code>报头。让我们更改视图，从请求头中获取语言并激活它，这样我们就可以获得该语言的默认值。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">views.py</figcaption></figure><p id="5c88" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们添加了<code class="fe ml mm mn mo b">get_queryset </code>函数，在这个函数中，我们将从请求头中获取语言，并使用<code class="fe ml mm mn mo b">django.utils</code>中的<code class="fe ml mm mn mo b">translation.activate</code>激活它</p><p id="21e7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，应该检查请求头中是否存在<code class="fe ml mm mn mo b">HTTP_ACCEPT_LANGUAGE</code>(if 语句)。如果它确实存在，我们从包含请求的元数据(比如头)的字典中获取它的值。之后，我们使用<code class="fe ml mm mn mo b">translation.activate</code>激活该语言进行响应。</p><p id="309c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了测试，我将使用<a class="ae ll" href="https://install.advancedrestclient.com/install" rel="noopener ugc nofollow" target="_blank">高级 Rest 客户端</a>，但是你可以使用任何你想要的其他客户端，比如<a class="ae ll" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>。</p><p id="8220" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们在 ARC 中添加一个头，在 Name 部分选择<code class="fe ml mm mn mo b">Accept-Language</code>，在 Value 部分选择<code class="fe ml mm mn mo b">en-US </code>(英语)或<code class="fe ml mm mn mo b">ru </code>(俄语)。</p><p id="cd8f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们先选择<code class="fe ml mm mn mo b">en-US</code>看看响应数据:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ng"><img src="../Images/9a1d1ae4c32731d8dc3dfe173870215e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eu6qbhYJaEPu243J0z1i2w.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/620a82a429d2d4fd459c28695a6ccdd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqOddmJpqG_anRJncZNzLg.png"/></div></div></figure><p id="3287" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在让我们选择<code class="fe ml mm mn mo b">ru</code>并查看默认字段是否为俄语:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/3735e3245102d90194f35ed31cb12802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyUcfFQTp9XT1n8hcL8BTw.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/621631446a0badbd3bbad67814ffaab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xw35xR4zivtaB1qlvV6xLQ.png"/></div></div></figure><p id="92c0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">可以清楚地看到，默认字段包含我们在请求头中指定的语言的值。</p><h2 id="747a" class="mz ln in bd lo nk nl dn ls nm nn dp lw kx no np ly lb nq nr ma lf ns nt mc nu bi translated">附加说明</h2><p id="7d92" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">我们可以在用户模型中有一个特殊的默认语言字段，因此如果用户登录，我们可以直接从用户表中获取语言，而不是从请求头中获取。这有助于不同设备中的相同用户使用相同的语言。</p><h2 id="ade7" class="mz ln in bd lo nk nl dn ls nm nn dp lw kx no np ly lb nq nr ma lf ns nt mc nu bi translated">参考</h2><p id="112f" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated"><a class="ae ll" href="https://django-modeltranslation.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">https://django-model translation . readthedocs . io/en/latest/index . html</a></p></div></div>    
</body>
</html>