<html>
<head>
<title>How to Process PDF Files with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 处理 PDF 文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-process-pdf-files-with-python-61e0d9e62e7?source=collection_archive---------5-----------------------#2022-05-14">https://blog.devgenius.io/how-to-process-pdf-files-with-python-61e0d9e62e7?source=collection_archive---------5-----------------------#2022-05-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2547" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">合并多个 PDF 文件，拆分一个 PDF 文件，转换成 PNG </em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/cbc2a34c0afc817149b26d28b02cad4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*jhQh0eYztLZKwfqRkTJN4w.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://www.techbout.com/wp-content/uploads/2014/12/edit-pdf-files-without-using-adobe-acrobat.png" rel="noopener ugc nofollow" target="_blank">https://www . tech bout . com/WP-content/uploads/2014/12/edit-pdf-files-without-use-adobe-acrobat . png</a></figcaption></figure><p id="61ba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最近我在做一个 RPA 项目，需要处理多个 PDF 文件。主要涉及四项任务:</p><ol class=""><li id="778d" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated">将多个 PDF 文件合并成一个文件。</li><li id="d901" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">将多页 PDF 文件拆分为多个单页 PDF 文件。</li><li id="8e66" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">将 PDF 文件(单页或多页)转换为 PNG 文件。</li><li id="a99f" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">使用 OCR 将 PNG 文件转换为文本。</li></ol><p id="ec02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终目的是根据内容重命名扫描的 PDF 文件。我将在这里介绍解决前 3 个任务的步骤，对于 OCR 部分，有许多可用的选项，但请记住，其中许多选项不能很好地处理中文字符，例如 Tesseract，即使安装了中文简体库，最终结果也很差，无法使用。</p><p id="2d3a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果没有 Python，我们必须使用 Adobe Acrobat Professional 来合并和拆分 PDF 文件，或者找到一些冒着丢失安全信息风险的在线服务。但是我们可以很容易地用 Python 实现这一点，零成本，最大限度地提高安全性和效率。</p><h1 id="a6ba" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">找到合适的包装</h1><p id="2f01" class="pw-post-body-paragraph jk jl in jm b jn mi jp jq jr mj jt ju jv mk jx jy jz ml kb kc kd mm kf kg kh ig bi translated">我最初尝试了我用来填写 PDF 表格的软件包<code class="fe mn mo mp mq b">pdfrw</code>，但是它不适合阅读扫描的 PDF 文档。经过一番搜索，我找到的包是<code class="fe mn mo mp mq b">pymupdf</code>(<a class="ae kv" href="https://github.com/pymupdf/PyMuPDF" rel="noopener ugc nofollow" target="_blank">https://github.com/pymupdf/PyMuPDF</a>)，它服务于我在这里的所有目的，包括合并、拆分 PDF 文件，以及将每一页转换成 PNG 文件。</p><p id="ab66" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要安装<code class="fe mn mo mp mq b">pymupdf</code>，你需要做的就是<code class="fe mn mo mp mq b">pip install pymupdf</code>，然而你实际上需要<code class="fe mn mo mp mq b">import fitz</code>才能使用它，这是一件奇怪的事情，因为你需要记住两个不同的包名。我使用的技巧是在导入行后面留下一个注释:</p><pre class="kk kl km kn gt mr mq ms mt aw mu bi"><span id="cdc3" class="mv ll in mq b gy mw mx l my mz">import fitz # pip install pymupdf</span></pre><h1 id="00cd" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">合并多个 PDF 文件</h1><p id="f41b" class="pw-post-body-paragraph jk jl in jm b jn mi jp jq jr mj jt ju jv mk jx jy jz ml kb kc kd mm kf kg kh ig bi translated">要合并多个 PDF 文件，首先需要使用<code class="fe mn mo mp mq b">fitz.open()</code>创建一个空白的 PDF 文件，然后在将每个 PDF 文件插入新文件后保存。</p><p id="f685" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设您将所有的 PDF 文件及其完整路径存储在一个列表<code class="fe mn mo mp mq b">pdf_files</code>中，下面 3 行代码实现了上述目的:</p><pre class="kk kl km kn gt mr mq ms mt aw mu bi"><span id="a7c9" class="mv ll in mq b gy mw mx l my mz"><em class="ki">with</em> fitz.open() <em class="ki">as</em> doc:<br/>    <em class="ki">for</em> pdf_file <em class="ki">in</em> pdf_files:<br/>        doc.insert_pdf(fitz.open(pdf_file), from_page=0, to_page=-1, rotate=-1, show_progress=True, final=True)<br/>    doc.save(save_as)</span></pre><h1 id="2885" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">分割多页 PDF 文件</h1><p id="b794" class="pw-post-body-paragraph jk jl in jm b jn mi jp jq jr mj jt ju jv mk jx jy jz ml kb kc kd mm kf kg kh ig bi translated">要分割一个多页的 PDF 文件，思路几乎和前面的练习一样，你只需要打开一个现有的 PDF 文件，然后一页一页地插入一堆新文件。</p><p id="1d2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下 9 行代码实现了上述目的:</p><pre class="kk kl km kn gt mr mq ms mt aw mu bi"><span id="b96e" class="mv ll in mq b gy mw mx l my mz"><em class="ki">with</em> fitz.open(pdf_file) <em class="ki">as</em> doc:<br/>    digits = len(str(doc.page_count))<br/>    <em class="ki">for</em> i, page <em class="ki">in</em> enumerate(doc):<br/>        page_id = f'{{:0{digits}}}'.format(i+1)<br/>        file_name = f'{os.path.split(pdf_file)[1][:-4]}_p{page_id}.pdf'<br/>        file_name = os.path.join(save_to, file_name)<br/>        <em class="ki">with</em> fitz.open() <em class="ki">as</em> doc_tmp:<br/>            doc_tmp.insert_pdf(doc, from_page=i, to_page=i, rotate=-1, show_progress=False)<br/>            doc_tmp.save(file_name)</span></pre><p id="abc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第二和第四行计算总页数，如果少于 10 页，则在文件名后添加一个<code class="fe mn mo mp mq b">_p1</code>到<code class="fe mn mo mp mq b">_p9</code>，如果有 10 到 99 页，则在<code class="fe mn mo mp mq b">_p99</code>后添加一个<code class="fe mn mo mp mq b">_p01</code>，依此类推。如果您想在需要手动或通过代码访问文件名时保持文件名有序，这是一个更好的做法。</p><h1 id="f8d5" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">将 PDF 文件转换为 PNG 文件</h1><p id="a3e9" class="pw-post-body-paragraph jk jl in jm b jn mi jp jq jr mj jt ju jv mk jx jy jz ml kb kc kd mm kf kg kh ig bi translated">上面解决了逐页访问 PDF 文件的问题，我们只需要使用下面的代码将一个页面转换成 PNG 文件:</p><pre class="kk kl km kn gt mr mq ms mt aw mu bi"><span id="8d3d" class="mv ll in mq b gy mw mx l my mz">trans = fitz.Matrix(1.0, 1.0).prerotate(0) #<em class="ki"> zoom_x, zoom_y<br/></em>pm = page.get_pixmap(matrix=trans, alpha=False)<br/>pm.save(png_file)</span></pre><p id="82bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结合前面的枚举页面练习，我们有以下完整的代码:</p><pre class="kk kl km kn gt mr mq ms mt aw mu bi"><span id="fa3b" class="mv ll in mq b gy mw mx l my mz"><em class="ki">with</em> fitz.open(pdf_file) <em class="ki">as</em> doc:<br/>    digits = len(str(doc.page_count))<br/>    <em class="ki">for</em> i, page <em class="ki">in</em> enumerate(doc):<br/>        <em class="ki">if</em> doc.page_count&gt;1:<br/>            page_id = f'{{:0{digits}}}'.format(i+1)<br/>            file_name = f'{os.path.split(pdf_file)[1][:-4]}_p{page_id}.png'<br/>        <em class="ki">else</em>:<br/>            file_name = f'{os.path.split(pdf_file)[1][:-4]}.png'<br/>        png_file = os.path.join(save_to, file_name)<br/>        trans = fitz.Matrix(1.0, 1.0).prerotate(0) #<em class="ki"> zoom_x, zoom_y<br/>        </em>pm = page.get_pixmap(matrix=trans, alpha=False)<br/>        pm.save(png_file)</span></pre><p id="0bfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果有多个页面，第 4 到第 8 行代码为 PNG 文件名生成一个后缀，否则只生成带有<code class="fe mn mo mp mq b">.png</code>扩展名的原始 PDF 文件名。</p><h1 id="613b" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">改进的余地</h1><p id="323c" class="pw-post-body-paragraph jk jl in jm b jn mi jp jq jr mj jt ju jv mk jx jy jz ml kb kc kd mm kf kg kh ig bi translated">你可以把上面的代码包装成函数，甚至是一个类，让它们更容易被访问。</p><p id="3c25" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您还可以探索其他领域，例如，您可以提取 TOC、注释等。使用<code class="fe mn mo mp mq b">pymupdf</code>包从 PDF 下载。</p></div></div>    
</body>
</html>