<html>
<head>
<title>Sorting Tables in Angular with RxJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 RxJS 在 Angular 中排序表格</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sorting-tables-in-angularjs-with-rxjs-87f9b1674c60?source=collection_archive---------1-----------------------#2021-05-08">https://blog.devgenius.io/sorting-tables-in-angularjs-with-rxjs-87f9b1674c60?source=collection_archive---------1-----------------------#2021-05-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0bc9" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用可观测量来处理不断变化的数据！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/3af5b2b7322395d337cf6349057b99d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqA9S21JtoUp73egMUVWmA.png"/></div></div></figure><p id="89ae" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我正在做一个大学作业，使用来自 Squiggle API(api.squiggle.com)的澳大利亚足球联盟(AFL)数据在 Angular 建立一个网站，其中一个用户故事要求我显示一个预测列表，表明你的球队将会获胜。所以，很自然地，我做了一张桌子。作为一个超常发挥者，我想知道，“是否有可能对表中的一些列进行排序？”答案显然是肯定的。但是这是一个简单的任务吗？</p><p id="ff78" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">见鬼。没有。</p><p id="6435" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我的背景主要是 React，我试图采取一种非常 React 的方法，但失败了。所以，我求助于谷歌，男孩，我不开心。有很多解决方案，但都是针对旧版本的 Angular。所以，在花了一点时间(也许还流了一些眼泪)看完这些文件后，我想明白了，并想在这里与大家分享。</p><p id="977d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我开始之前:</p><p id="5737" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果你是一个有角度的开发者，请给予反馈！出于对自己诚实的考虑，在我提交作业之前，我不会使用它，但之后我会考虑它，并实施任何改进。:)</p><p id="c869" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">另外…这只是我对这些部分如何组合在一起的理解。不要只相信我的话！在<a class="ae lk" href="http://angular.io" rel="noopener ugc nofollow" target="_blank"> angular.io </a>和<a class="ae lk" href="http://learnrxjs.io" rel="noopener ugc nofollow" target="_blank"> learnrxjs.io </a>处检查文档！</p><p id="7a49" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在开始主秀…</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="1146" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先让我们来看看最新的 Angular CLI:</p><pre class="kd ke kf kg gt ls lt lu lv aw lw bi"><span id="eb12" class="lx ly in lt b gy lz ma l mb mc">npm install -g @angular/cli</span></pre><p id="a4b4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我们想创建一个简单的项目，使用<code class="fe md me mf lt b">ng</code> CLI 命令对此进行测试:</p><pre class="kd ke kf kg gt ls lt lu lv aw lw bi"><span id="646d" class="lx ly in lt b gy lz ma l mb mc">ng new table-sorter-app</span></pre><p id="adc0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在那之后<code class="fe md me mf lt b">cd</code>进入你的项目并创建一个新的组件:</p><pre class="kd ke kf kg gt ls lt lu lv aw lw bi"><span id="c40c" class="lx ly in lt b gy lz ma l mb mc">ng generate component table</span></pre><p id="fd4c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们将在<code class="fe md me mf lt b">table.component.[ts|html]</code>文件中做我们所有的工作。在很大程度上，我将主要谈论打字稿方面的事情。我假设您可以制作自己的表格，所以将只显示 HTML 代码的一个基本片段。</p><p id="95fa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们看看<code class="fe md me mf lt b">table.component.ts</code>会是什么样子</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f6e0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">分解一下，我们将使用来自<code class="fe md me mf lt b">rxjs</code>的<code class="fe md me mf lt b">BehaviorSubject</code>、<code class="fe md me mf lt b">combineLatest</code>、<code class="fe md me mf lt b">Observable</code>和<code class="fe md me mf lt b">of</code>，以及来自<code class="fe md me mf lt b">rxjs/operators</code>的<code class="fe md me mf lt b">map</code>和<code class="fe md me mf lt b">scan</code></p><p id="a648" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们将变量<code class="fe md me mf lt b">table$</code>设置为<code class="fe md me mf lt b">Observable</code>，这样，如果表格数据发生变化，我们可以轻松地更新 HTML。当您有一些来自实时提要或只是一些随机 API 的数据时，这是很好的。</p><p id="9480" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">每当<code class="fe md me mf lt b">sortableColumn$</code>可观察值改变时，我们使用<code class="fe md me mf lt b">BehaviorSubject</code>作为事件发射器来更新表的排序。</p><p id="2d7e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe md me mf lt b">sortDirections$</code>是另一个可观察到的<code class="fe md me mf lt b">pipes</code>、<code class="fe md me mf lt b">sortableColumn$</code>并使用<code class="fe md me mf lt b">scan</code>作为减速器，每当<code class="fe md me mf lt b">sortableColumn$</code>改变时返回正确的<code class="fe md me mf lt b">sortConfig</code>。</p><p id="ceff" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<code class="fe md me mf lt b">constructor</code>中，我们只需要将<code class="fe md me mf lt b">table$</code>设置为某个值，以阻止 TypeScript 抱怨。你可以用一种更有意义的方式来做这件事，但是对于本教程来说，这样做很好。</p><p id="b72c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<code class="fe md me mf lt b">ngOnInit</code>方法中<code class="fe md me mf lt b">combineLatest</code>用于组合<code class="fe md me mf lt b">table</code>数据和<code class="fe md me mf lt b">sortDirection$</code>观察值。我们将<code class="fe md me mf lt b">table</code>包装在<code class="fe md me mf lt b">of</code>中，将其转换为可观察的序列。这样，无论任何一个值发生变化，它都会更新前面提到的<code class="fe md me mf lt b">table$</code>可观察值。我们使用<code class="fe md me mf lt b">combineLatest.pipe()</code>将<code class="fe md me mf lt b">sort</code>函数应用于表数据，有效地在每次更新时对其进行排序。最后，我们<code class="fe md me mf lt b">subscribe</code>到<code class="fe md me mf lt b">sortDirections$</code>可观测值，并且每当值改变时更新我们的<code class="fe md me mf lt b">sortConfig</code>。这最后一部分是可选的，但是你会在后面看到为什么这对我的作业很重要。</p><p id="2f52" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我们有一个<code class="fe md me mf lt b">setSortColumn</code>函数，每当我们选择一个列作为排序依据时，它就更新<code class="fe md me mf lt b">sortableColumn$</code>可观察值(您将在 HTML 代码片段中看到这一点),还有一个<code class="fe md me mf lt b">sort</code>函数，它用于根据所选的列和之前的排序顺序来确定表应该按什么顺序排序。</p><p id="6a97" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">继续我们的<code class="fe md me mf lt b">table.component.html</code>文件，我们可以像这样使用我们的<code class="fe md me mf lt b">table$</code>可观察对象和<code class="fe md me mf lt b">setSortColumn</code>函数:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="0607" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这里，我们可以使用<code class="fe md me mf lt b">(click)</code>事件绑定来调用<code class="fe md me mf lt b">setSortColumn</code>,只要点击一个表格标题。这将通过列排序到<code class="fe md me mf lt b">sortDirection$</code>可观察值，并在<code class="fe md me mf lt b">descending</code>和<code class="fe md me mf lt b">ascending</code>顺序之间切换。为了生成行，我们使用<code class="fe md me mf lt b">*ngFor</code>来遍历<code class="fe md me mf lt b">table$</code>可观测数据中的数据，并使用<code class="fe md me mf lt b">async</code>管道来订阅<code class="fe md me mf lt b">table$</code>以确保我们获得最新的数据。</p><p id="7930" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当该说的都说了，该做的都做了，你会得到这样的东西:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/7f5f59333a782977a7ff6edfea98a4c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jkJ7Ysllti0rO7peABaTOA.gif"/></div></div></figure><p id="a144" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我没有在上面的 HTML 中展示，但是在我的作业中，我使用了表格中的<code class="fe md me mf lt b">sortConfig</code>值来切换图标。每当<code class="fe md me mf lt b">sortConfig.column</code>匹配当前选择的列进行排序时，我会从默认图标切换到<code class="fe md me mf lt b">ascending</code>或<code class="fe md me mf lt b">descending</code>图标。如果您选择不同的列进行排序，那么它会将先前选择的列图标恢复为默认状态。</p><p id="019b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">以这种方式排序的另一个好处是，当你使用 observables 时，你可以连接实时数据，你的表将自动更新！</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="2754" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">嗯……就这样吧！我希望这能帮助一些人！我花了几个小时才弄明白这些东西，我对结果非常满意。如果你有任何意见，请留下！</p></div></div>    
</body>
</html>