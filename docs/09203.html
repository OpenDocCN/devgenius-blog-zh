<html>
<head>
<title>Writing Local tests in Android - Testing Fundamentals</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Android 编写本地测试——测试基础</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/writing-local-tests-in-android-testing-fundamentals-i-bf8e7e9bfc2c?source=collection_archive---------2-----------------------#2022-08-06">https://blog.devgenius.io/writing-local-tests-in-android-testing-fundamentals-i-bf8e7e9bfc2c?source=collection_archive---------2-----------------------#2022-08-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="9595" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">Android 测试教程</h2><div class=""/><div class=""><h2 id="1b27" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">测试一下才相信！</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8d17d516dd768a6bc45d9ebb3cb55fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lnsa7GGPZBkACRNk.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来源:https://www.clouddefense.ai/</figcaption></figure><p id="e92e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">嗯！我们大多数人都知道，我们编写的代码需要进行单元测试，但并不是所有人都遵循这个观念。如果我举我自己的例子，那么我曾经很困惑为什么我们要做单元测试，当我们可以手动地做而不需要写代码的时候。当我开始了解它时，它变得比我想象的更有趣。</p><blockquote class="ly"><p id="cd61" class="lz ma in bd mb mc md me mf mg mh lx dk translated">如果你还没有开始，现在正是时候！</p></blockquote><p id="e9ba" class="pw-post-body-paragraph lc ld in le b lf mi jx lh li mj ka lk ll mk ln lo lp ml lr ls lt mm lv lw lx ig bi translated">在这篇文章中，我们将探索</p><ol class=""><li id="2624" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx ms mt mu mv bi translated">单元测试背后的想法？</li><li id="5c79" class="mn mo in le b lf mw li mx ll my lp mz lt na lx ms mt mu mv bi translated">考什么？</li><li id="2fc7" class="mn mo in le b lf mw li mx ll my lp mz lt na lx ms mt mu mv bi translated">什么是本地测试？</li><li id="e4c9" class="mn mo in le b lf mw li mx ll my lp mz lt na lx ms mt mu mv bi translated">如何构建本地测试？</li></ol><p id="4fef" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">所以让我们开始回答问题。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h2 id="da37" class="ni nj in bd nk nl nm dn nn no np dp nq ll nr ns nt lp nu nv nw lt nx ny nz it bi translated">单元测试背后的思想</h2><p id="11f1" class="pw-post-body-paragraph lc ld in le b lf oa jx lh li ob ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">假设我们已经编写了一个简单的单页应用程序，我们想测试它是否按预期工作。我们开始手动操作。没问题。一切都好。</p><p id="e20c" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在，我们在应用程序中添加了 10 个新功能，代码库变得更大，功能变得复杂。我们再次开始测试，但这一次，在不同的设备上测试每个可能的用户流并不容易。那我们现在怎么办？</p><p id="d0fb" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这就是我们进入单元测试世界的地方，它自动化了这个测试过程，并且能够独立地测试代码中的不同单元。这更快、更可靠，并且正确地通知我们用户可能遇到的错误。比方说，如果特性集不断增加，但我们确保为我们的代码库编写足够多的测试用例，那么这也有助于防止回归错误。</p><p id="c900" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">所以单元测试的想法是保持你的代码没有 bug 并且健康。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h2 id="10c0" class="ni nj in bd nk nl nm dn nn no np dp nq ll nr ns nt lp nu nv nw lt nx ny nz it bi translated">考什么？</h2><p id="9d01" class="pw-post-body-paragraph lc ld in le b lf oa jx lh li ob ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">嗯！这取决于我们项目所需的各种因素和测试类型。但本质上，在任何应用中，我们都应该考虑为</p><ul class=""><li id="63ee" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx of mt mu mv bi translated">查看模型</li><li id="2de2" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">数据层类，例如存储库</li><li id="88b7" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">领域层类，例如用例、交互器</li><li id="55b5" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">助手或实用程序类</li></ul><p id="d08c" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们还应该考虑涵盖不太容易捕捉的边缘情况。根据谷歌文档:</p><ul class=""><li id="6f4f" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx of mt mu mv bi translated">使用负数、零和边界条件的数学运算</li><li id="04d1" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">所有可能的网络连接错误。</li><li id="6e54" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">损坏的数据，如格式错误的 JSON。</li><li id="b533" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">保存到文件时模拟满存储。</li><li id="15af" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">在进程中间重新创建的对象(如设备旋转时的活动)。</li></ul><p id="fb42" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们还应该考虑为我们的 UI 交互和流程编写测试。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h2 id="07f0" class="ni nj in bd nk nl nm dn nn no np dp nq ll nr ns nt lp nu nv nw lt nx ny nz it bi translated">什么是本地测试？</h2><p id="5c7f" class="pw-post-body-paragraph lc ld in le b lf oa jx lh li ob ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">Android 中的本地测试是那些可以</p><ul class=""><li id="80e8" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx of mt mu mv bi translated">在不需要实际 android 设备或仿真器的系统上进行测试</li><li id="01c0" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">在 JVM 上运行</li></ul><p id="ff87" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">本地测试速度更快，因为它们不需要实际的设备部署。我们可以孤立地测试小段代码。特别是对于业务逻辑，这些测试非常有帮助。</p><p id="97ba" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">本地测试的位置在<strong class="le ix"> <em class="og">测试</em> </strong>文件夹下，如图所示。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/5c04c77e08486dc1ac1cf0e35a9fe3b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*vW_ZOfGiwnBk0D12JiH-3g.png"/></div></figure><h2 id="9c4f" class="ni nj in bd nk nl nm dn nn no np dp nq ll nr ns nt lp nu nv nw lt nx ny nz it bi translated">如何构建本地测试？</h2><p id="9b34" class="pw-post-body-paragraph lc ld in le b lf oa jx lh li ob ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">最后，让我们构建一些本地测试。</p><p id="d690" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在 build.gradle 中添加 JUnit 和 Truth 库的依赖项</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="157a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">JUnit 用于单元测试支持。<br/> Truth 是 google 推荐的库。它的代码打字更快，更容易阅读，API 也更简单。</p><p id="3ec0" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在考虑我们之前构建的<a class="ae lb" href="https://github.com/aqua30/FormValidation" rel="noopener ugc nofollow" target="_blank">表单应用程序</a>。让我们为提供验证支持的验证器对象编写本地测试。</p><p id="cb08" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">看一下验证器对象。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="62d9" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们看到四种不同的验证函数。让我们从验证账号功能开始。</p><blockquote class="ok ol om"><p id="ec61" class="lc ld og le b lf lg jx lh li lj ka lk on lm ln lo oo lq lr ls op lu lv lw lx ig bi translated">当帐号不为空且超过 5 位数时，验证成功。</p></blockquote><p id="705f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这意味着我们可以编写通过测试的测试:</p><ul class=""><li id="53bb" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx of mt mu mv bi translated">一个空帐户，并期望返回结果状态为 False。这个测试应该通过，因为我们期望函数有正确的行为。如果它返回 true，那么测试将会失败，因为这不是我们期望从这个验证器函数得到的正确输出。</li><li id="2927" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated">少于 5 位数的帐户，并期望返回结果状态为 False。这个测试应该通过，因为我们期望函数有正确的行为。如果它返回 true，那么测试将会失败，因为这不是我们期望从这个验证器函数得到的正确输出。</li></ul><p id="dbbb" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">好了，现在我们知道要测试什么了。我们先设置一个测试类。为此，右击类名并点击<strong class="le ix"> <em class="og">创建测试。</em> </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/69a9089c4aa5ce9d644cb170020e8ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ooeHoN_dyF6IIlIXfPQG3A.png"/></div></div></figure><p id="958f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这将在 test src 文件夹中创建一个名为 ValidatorTest.kt 的测试类。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="764a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">第 1 行:我们将这个<strong class="le ix"> <em class="og">测试</em> </strong>注释放在每个函数上，使其成为一个测试用例。这是从 JUnit 库导入的。</p><p id="e4dc" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">第 2 行:在本地测试中，我们可以通过将函数名放在<strong class="le ix"> `` </strong>下来提供一个普通的字符串。</p><p id="671e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">第 3 行:我们传递一个空字符串并保存结果。</p><p id="b887" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">第 4 行:<strong class="le ix"> <em class="og">断言</em> </strong>是真值库提供的 api，使用它我们说检查结果状态是否为假。如果它真的为假，那么我们的测试用例就通过了，因为这是它从结果状态<strong class="le ix"> <em class="og"> isFalse() </em> </strong>中所期望的。</p><p id="f434" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们可以通过单击 Run ValidatorTest 来运行它，如下所示。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/f6498772bbe5dda76d5d3ff1686cf0fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvblokIXnTA5D2slKgRs4Q.png"/></div></div></figure><p id="739c" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">结果将会是</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/54939870e09e821cd5b7d87261d143ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*pMAoCMiVaq96hlJBytLjXA.png"/></div></figure><p id="9a78" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">同样，如果测试失败，它会告诉我们原因，如图所示</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ot"><img src="../Images/513a37c9f19ef2f7e592e1108383334a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ITBNBcgrdfnL14yOHTfHA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">当结果为假时，将期望值更改为真</figcaption></figure><p id="4cb1" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">下面是两种情况。从测试用例或者从验证器函数中改变期望，然后进行试验。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="7b93" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/fd0ca404af1737ac1bac3fd3d5a36b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*UMtFQOQnF5VcqOiFg2pK0Q.png"/></div></figure><p id="4356" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">哦耶！！我们成功地编写了测试，并在 24 毫秒内检查了有效性。您可以自己编写其他功能的测试用例，并进行测试。如果你被困在某个地方，请告诉我。</p><p id="cebd" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">您可以在单元测试分支中签出这段代码。</p><div class="ov ow gp gr ox oy"><a href="https://github.com/aqua30/FormValidation/tree/unit-testing" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd ix gy z fp pd fr fs pe fu fw iw bi translated">单元测试时的 GitHub - aqua30/FormValidation</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">这个示例项目演示了如何在组件和视图模型之间实现清晰和更好的交互。uiState…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">github.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm kv oy"/></div></div></a></div><p id="cbf4" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">唷！这将足以作为一个良好的开端。我们将在以后的文章中继续测试。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="4345" class="pn nj in bd nk po pp pq nn pr ps pt nq kc pu kd nt kf pv kg nw ki pw kj nz px bi translated">有奖阅读</h1><ul class=""><li id="077b" class="mn mo in le b lf oa li ob ll py lp pz lt qa lx of mt mu mv bi translated"><a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/testing-room-database-with-coroutines-and-flows-testing-fundamentals-iii-5f6c3b9e4c94">房间数据库测试</a></li><li id="8954" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated"><a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/writing-viewmodel-tests-in-android-testing-fundamentals-ii-5bc44efa4a39">如何在 Android 中查看模型测试</a></li></ul><h1 id="2193" class="pn nj in bd nk po qb pq nn pr qc pt nq kc qd kd nt kf qe kg nw ki qf kj nz px bi translated">目前就这些了！敬请期待！</h1><p id="84cd" class="pw-post-body-paragraph lc ld in le b lf oa jx lh li ob ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">与我联系(如果内容对您有帮助),请访问</p><ul class=""><li id="66a3" class="mn mo in le b lf lg li lj ll mp lp mq lt mr lx of mt mu mv bi translated"><a class="ae lb" href="https://saurabhpant.medium.com/" rel="noopener">中等</a></li><li id="6526" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated"><a class="ae lb" href="https://github.com/aqua30" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="0365" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated"><a class="ae lb" href="https://twitter.com/saurabh30pant" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="8d1b" class="mn mo in le b lf mw li mx ll my lp mz lt na lx of mt mu mv bi translated"><a class="ae lb" href="https://www.linkedin.com/in/saurabh-pant-44619057/" rel="noopener ugc nofollow" target="_blank">领英</a></li></ul><p id="0f1a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">订阅电子邮件，同步了解更多关于 Android/IOS/Backend/Web 的有趣话题。</p><p id="2d16" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">直到下一次…</p><p id="3c89" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">干杯！</p></div></div>    
</body>
</html>