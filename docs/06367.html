<html>
<head>
<title>Automate Your Flask Deployment to VPS Using Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Github 动作自动将 Flask 部署到 VPS</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/automate-your-flask-deployment-to-vps-using-github-actions-37e0a4364313?source=collection_archive---------8-----------------------#2022-01-03">https://blog.devgenius.io/automate-your-flask-deployment-to-vps-using-github-actions-37e0a4364313?source=collection_archive---------8-----------------------#2022-01-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9fd66b41f4ef2eff9d45b6935cb7160e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SABnYfT-DtAuwGOgkqs79g.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@sortino?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">约书亚·索蒂诺</a>在<a class="ae jz" href="https://unsplash.com/s/photos/automation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="965d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我在<a class="ae jz" href="https://medium.com/@adyaksa.w/what-i-learn-from-trying-selenium-on-vps-45f1e79f89a2" rel="noopener">上一篇文章</a>中提到的项目<a class="ae jz" href="https://lnprice.com/" rel="noopener ugc nofollow" target="_blank"> lnprice </a>中，后端部署是这样手动完成的:</p><ol class=""><li id="9c15" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">将代码推送到 Github</li><li id="e6c1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在 VPS 中提取代码</li><li id="fbfb" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">重新部署应用程序</li></ol><p id="f41a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">经过几十次部署，<strong class="kc io">我够了</strong>。我决定学习如何自动化这一点。对于某些上下文，我已经有了使用 Github 动作来自动化我的部署的经验。我没有在这个项目中这样做的原因是我从来没有在 Flask 环境中这样做过。我只想在任何自动化之前优先考虑应用程序。因此，在本文中，我将描述我在 VPS 上自动部署后端的步骤。所有代码都可以在我的<a class="ae jz" href="https://github.com/adyaksaw/tutorial/tree/master/1-flask-deployment" rel="noopener ugc nofollow" target="_blank"> Github 库</a>中访问</p><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lm"><img src="../Images/f89932968f1272eb40b77105f76e2ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*liDJRez82TNvbhaBJn0B1Q.png"/></div></div></figure><h1 id="029e" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated"><strong class="ak"> 1。设置 Pipenv &amp;依赖关系</strong></h1><p id="5f05" class="pw-post-body-paragraph ka kb in kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">为了更容易地自动化部署，我们需要一个简单的依赖管理系统。所以我们需要在我们的项目中安装 Pipenv 来处理我们的依赖，然后安装我们的依赖。我们可以这样做:</p><pre class="ln lo lp lq gt mu mv mw mx aw my bi"><span id="81ca" class="mz ls in mv b gy na nb l nc nd">pip install pipenv<br/>pipenv install flask<br/>pipenv shell</span></pre><p id="4da7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过运行<code class="fe ne nf ng mv b">pipenv shell</code>，我们在这个项目中启动了一个具有 Flask 框架的虚拟环境。</p><h1 id="b71f" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">2.<strong class="ak">创建烧瓶应用程序</strong></h1><p id="b3f4" class="pw-post-body-paragraph ka kb in kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">下一步是创建一个简单的 Flask 应用程序。我们可以在 Flask 主页上使用示例。但是在我的例子中，我对它做了一点修改，使用了一个不同的端口，这样我们就不会意外地使用一个已经使用过的端口。</p><figure class="ln lo lp lq gt jo"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="3bd5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在运行<code class="fe ne nf ng mv b">flask run</code>并转到<code class="fe ne nf ng mv b">localhost:5001</code>，在那个页面上应该有一个‘Hello World’。</p><h1 id="07fc" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">3.创建 Docker 文件</h1><p id="d745" class="pw-post-body-paragraph ka kb in kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">在我看来，部署我们的应用程序最简单、最容易的方法是使用 Docker。我们肯定不能使用它，但仍然能够自动化我们的部署。但是因为不使用 Docker 可能会有很多痛苦，所以我真的建议使用它。</p><p id="6655" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在接触 Docker 之前，我们需要讨论如何将 Flask 部署到生产中。像 Django 一样，Flask 需要一个 WSGI 服务器来部署应用程序。有两种常见的 WSGI 服务器:UWSGI 和 Gunicorn。我就不细说它们有什么区别了。本文将使用 Gunicorn 作为 WSGI 服务器。</p><p id="cc0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，有人已经为<a class="ae jz" href="https://github.com/tiangolo/meinheld-gunicorn-flask-docker" rel="noopener ugc nofollow" target="_blank"> Gunicorn-Flask </a>组合创建了一个 docker 图像。但是在本教程的上下文中，该图像需要修改，所以我们最好从头开始创建它。这是创建的 Dockerfile 文件。</p><figure class="ln lo lp lq gt jo"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7aba" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为什么我们用<code class="fe ne nf ng mv b">requirements.txt</code>而不是直接用 Pipfile？在这里，我只想把 Pipenv 当作某种“依赖组织者”。我不想用 Pipenv 作为虚拟环境工具。您应该能够直接使用 Pipfile 中的依赖项，并使用 Pipenv 通过修改代码来访问依赖项。</p><p id="7e5f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建 Dockerfile 后，我们可以通过运行以下命令来构建和运行 Dockerfile:</p><pre class="ln lo lp lq gt mu mv mw mx aw my bi"><span id="307e" class="mz ls in mv b gy na nb l nc nd">docker build -t 1-flask-deployment .<br/>docker run -dp 5001:5001 1-flask-deployment</span></pre><p id="b951" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">试着运行<code class="fe ne nf ng mv b">docker container ls</code>，集装箱的<code class="fe ne nf ng mv b">1-flask-deployment</code>应该启动并运行，可以从<code class="fe ne nf ng mv b">localhost:5001</code>进入。</p><h1 id="f0e1" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">4.设置 Github Runner</h1><p id="2029" class="pw-post-body-paragraph ka kb in kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">在创建 Github Actions 文件之前，我们需要配置我们自己的 Github Runner。我们需要将 Runner 放在与我们想要放置产品代码的服务器相同的服务器上。对于这一步，我们只需遵循官方<a class="ae jz" href="https://github.com/adyaksaw/tutorial/settings/actions/runners/new?arch=x64&amp;os=linux" rel="noopener ugc nofollow" target="_blank"> Github Runner 文档</a>中概述的步骤</p><h1 id="c7c6" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">5.创建 Github 动作</h1><p id="5446" class="pw-post-body-paragraph ka kb in kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">是时候偿还创建 Dockerfile 文件的困难部分了！因为我们已经知道了运行容器的步骤，现在我们只需要在 Github 动作中重复这一步。</p><figure class="ln lo lp lq gt jo"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6dbc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这段代码中，我配置了 Github 动作，这样它将只在代码被推送到 master(第 3–6 行)并在我自己的虚拟机上运行(第 10 行)时运行。</p><p id="0136" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">按下<code class="fe ne nf ng mv b">deploy.yml</code>后，尝试从 VPS 内部调用<code class="fe ne nf ng mv b">curl localhost:5001</code>。“Hello World”文本应该像我们在本地系统中调用它时那样出现。这意味着 Github Runner 正在工作，部署自动化正在工作！</p><p id="81ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nj">大家好，我是 Adyaksa，我写的是软件开发和我的语言学习经历。我计划每周发布一篇博客，内容是我在做兼职项目时发现的一些有趣的事情。如果你感兴趣，你可以关注我来了解它的最新情况！</em></p><p id="25c6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">参考资料:</p><ul class=""><li id="4214" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx nk le lf lg bi translated">Pipenv 基本:<a class="ae jz" href="https://pipenv.pypa.io/en/latest/basics/" rel="noopener ugc nofollow" target="_blank">https://pipenv.pypa.io/en/latest/basics/</a></li><li id="cf89" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nk le lf lg bi translated">烧瓶快速启动:【https://flask.palletsprojects.com/en/2.0.x/quickstart/ T2】</li><li id="b4f7" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nk le lf lg bi translated">https://pythonspeed.com/articles/pipenv-docker/<a class="ae jz" href="https://pythonspeed.com/articles/pipenv-docker/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="fa1a" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nk le lf lg bi translated">guni corn Flask:<a class="ae jz" href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">https://www . digital ocean . com/community/tutorials/how-to-serve-Flask-applications-with-guni corn-and-nginx-on-Ubuntu-18-04</a></li></ul></div></div>    
</body>
</html>