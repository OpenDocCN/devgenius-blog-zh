<html>
<head>
<title>Create a App Widget.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建应用程序小部件。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-a-app-widget-31ce96196e54?source=collection_archive---------3-----------------------#2022-10-06">https://blog.devgenius.io/create-a-app-widget-31ce96196e54?source=collection_archive---------3-----------------------#2022-10-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="5600" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">安卓|科特林</em></p><h2 id="1f5e" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">什么是 app widget？</h2><p id="cfe3" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">应用程序小部件是一个简单的应用程序可视化用户界面，可以在 android 设备的主屏幕上看到。用户可以在设备的主页上看到或访问一些与应用相关或不相关的数据。例如:时间、天气、音乐播放器等。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/50de22fe2a46d465121df8f5ed01991b.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*vEI1L92YsCyjcEoXBlILBQ.jpeg"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">小部件示例</figcaption></figure><p id="6a99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，在上面的图片中，时间和日期是一个小部件，音乐播放器是另一个小部件。音乐播放器是我创建的小工具。在这篇博客中，我将向你展示如何创建一个具有相同用户界面的小工具，播放和暂停一首歌曲，来回切换歌曲。</p><blockquote class="lt"><p id="33f0" class="lu lv in bd lw lx ly lz ma mb mc kh dk translated">那么，让我们开始吧。</p></blockquote><h2 id="92b1" class="kj kk in bd kl km md dn ko kp me dp kr jv mf kt ku jz mg kw kx kd mh kz la lb bi translated">1.创建应用程序小部件类</h2><p id="2365" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">从创建应用程序小部件类开始。转到应用-&gt;(右击)-&gt;新建-&gt;应用小部件。在创建时，您将获得两个文件:一个保存小部件布局和功能的 kotlin 文件，以及一个包含小部件信息的 xml info 文件。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/2ac8f6a2fbe0de3caf2789ff2091fabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tPB6r9m34m6aS3ypkbCUw.png"/></div></div></figure><p id="ef31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">清单:- </strong>一个接收器将在清单文件中自动生成，我们可以在其中添加意图过滤器，你可以处理文本更改和按钮点击等。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="8cb4" class="kj kk in mo b gy ms mt l mu mv">&lt;receiver<br/>    android:name=".MusicWidget"<br/>    android:exported="false"&gt;<br/><br/>    &lt;meta-data<br/>        android:name="android.appwidget.provider"<br/>        android:resource="@xml/music_widget_info" /&gt;<br/>&lt;/receiver&gt;</span></pre><h2 id="6aa6" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">xml 文件(音乐 _ 小部件 _ 信息. XML)</h2><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="a411" class="kj kk in mo b gy ms mt l mu mv"><em class="ki">&lt;?</em>xml version="1.0" encoding="utf-8"<em class="ki">?&gt;<br/></em>&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:description="@string/app_widget_description"<br/>    android:initialKeyguardLayout="@layout/music_widget"<br/>    android:initialLayout="@layout/music_widget"<br/>    android:minWidth="110dp"<br/>    android:minHeight="110dp"<br/>    android:previewImage="@drawable/example_appwidget_preview"<br/>    android:previewLayout="@layout/music_widget"<br/>    android:resizeMode="horizontal|vertical"<br/>    android:targetCellWidth="3"<br/>    android:targetCellHeight="2"<br/>    android:updatePeriodMillis="86400000"<br/>    android:widgetCategory="home_screen"/&gt;</span></pre><h2 id="4c69" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">初始小部件类设置</h2><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="335f" class="kj kk in mo b gy ms mt l mu mv">class MusicWidget : AppWidgetProvider() {</span><span id="3fcd" class="kj kk in mo b gy mw mt l mu mv">override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {<br/>    for (appWidgetId in appWidgetIds) {<br/>        updateAppWidget(context, appWidgetManager, appWidgetId)<br/>    }<br/>}</span><span id="2f55" class="kj kk in mo b gy mw mt l mu mv">override fun onEnabled(context: Context) {<br/>    <em class="ki">// Enter relevant functionality for when the first widget is created<br/></em>}<br/><br/>override fun onDisabled(context: Context) {<br/>    <em class="ki">// Enter relevant functionality for when the last widget is disabled<br/></em>}</span><span id="e8e8" class="kj kk in mo b gy mw mt l mu mv">fun updateAppWidget(context: Context, appWidgetManager: AppWidgetManager, appWidgetId: Int) {<br/><br/>    val widgetText = context.getString(R.string.<em class="ki">appwidget_text</em>)<br/>    <em class="ki">// Construct the RemoteViews object<br/>    </em>val views = RemoteViews(context.<em class="ki">packageName</em>, R.layout.<em class="ki">music_widget</em>)<br/> appWidgetManager.updateAppWidget(appWidgetId, views)<br/>}<br/>}</span></pre><h2 id="1da1" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">2.设计小部件</h2><p id="2ab0" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">我有一个简单的设计，有一个正在播放的音乐专辑的海报，暂停和播放按钮，下一个按钮，上一个按钮。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="cc12" class="kj kk in mo b gy ms mt l mu mv">&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    style="@style/Widget.WidgetsApp.AppWidget.Container"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="130dp"<br/>    android:background="#1797b4"<br/>    android:theme="@style/Theme.WidgetsApp.AppWidgetContainer"&gt;<br/><br/>    &lt;ImageView<br/>        android:layout_width="130dp"<br/>        android:layout_height="match_parent"<br/>        android:layout_gravity="right"<br/>        android:id="@+id/songImage"<br/>        android:background="@drawable/drawable_layout_background"/&gt;<br/><br/>    &lt;ImageView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        android:layout_marginLeft="100dp"<br/>        android:background="@drawable/drawable_background"/&gt;<br/><br/>    &lt;LinearLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:orientation="vertical"&gt;<br/><br/>        &lt;TextView<br/>            android:layout_width="wrap_content"<br/>            android:layout_height="wrap_content"<br/>            android:text="How far i'll go!.."<br/>            android:textSize="16sp"<br/>            android:id="@+id/title"<br/>            android:textColor="@color/white"<br/>            android:layout_marginTop="20dp"<br/>            android:layout_marginLeft="20dp"/&gt;<br/><br/>        &lt;TextView<br/>            android:layout_width="wrap_content"<br/>            android:layout_height="wrap_content"<br/>            android:text="Auli'i Cravalho"<br/>            android:id="@+id/description"<br/>            android:textSize="12sp"<br/>            android:textColor="@color/white"<br/>            android:layout_marginLeft="20dp"/&gt;<br/><br/>        &lt;LinearLayout<br/>            android:layout_width="wrap_content"<br/>            android:layout_height="wrap_content"<br/>            android:orientation="horizontal"<br/>            android:layout_marginTop="10dp"<br/>            android:layout_marginLeft="20dp"&gt;<br/><br/>            &lt;ImageView<br/>                android:id="@+id/previousBtn"<br/>                android:layout_width="24dp"<br/>                android:layout_height="24dp"<br/>                android:layout_gravity="center"<br/>                android:background="@drawable/back"/&gt;<em class="ki"><br/><br/>            </em>&lt;ImageView<br/>                android:layout_width="28dp"<br/>                android:layout_height="28dp"<br/>                android:id="@+id/play"<br/>                android:layout_gravity="center"<br/>                android:layout_marginLeft="10dp"/&gt;<em class="ki"><br/><br/>            </em>&lt;ImageView<br/>                android:id="@+id/nextBtn"<br/>                android:layout_width="24dp"<br/>                android:layout_height="24dp"<br/>                android:layout_gravity="center"<br/>                android:background="@drawable/next"<br/>                android:layout_marginLeft="10dp"/&gt;<br/><br/>        &lt;/LinearLayout&gt;<br/><br/>    &lt;/LinearLayout&gt;<br/><br/>&lt;/FrameLayout&gt;</span></pre><h2 id="bbb3" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">3.音乐播放器</h2><p id="b273" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">这个小工具是基于一个音乐播放器，例如，我已经添加了 2 首歌曲到应用程序来操作暂停，播放，下一首歌曲和上一首歌曲。非常简单的功能，例如，如果你正在创建一个实时小工具，请确保你添加了一些背景功能，以便音乐将在背景中播放。现在我已经添加了应用程序，如果应用程序关闭，音乐将不会播放。<br/>播放音乐是非常简单的代码，我正在使用媒体播放器，我把它添加到下面供你参考。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="e175" class="kj kk in mo b gy ms mt l mu mv">musicPlayer = MediaPlayer.create(<em class="ki">applicationContext</em>, songList[0])<br/>musicPlayer.start()</span></pre><h2 id="5d08" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">4.小工具上的 OnClicks</h2><p id="a1e4" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">对于 onClick 1st，我们需要创建一个变量，该变量包含一个包名，后跟 action 关键字和一个表示要执行的操作的常量。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="e8dc" class="kj kk in mo b gy ms mt l mu mv">private val ACTION_PLAYPAUSE =  "com.app.widgetsapp.action.ACTION_WIDGET_CLICK"</span></pre><p id="49d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个小部件中有 3 个动作</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="7320" class="kj kk in mo b gy ms mt l mu mv">private val ACTION_PLAYPAUSE =  "com.app.widgetsapp.action.ACTION_WIDGET_CLICK"</span><span id="07ca" class="kj kk in mo b gy mw mt l mu mv">private val ACTION_NEXT =  "com.app.widgetsapp.action.ACTION_NEXT_CLICK"</span><span id="dd79" class="kj kk in mo b gy mw mt l mu mv">private val ACTION_PREVIOUS =  "com.app.widgetsapp.action.ACTION_PREVIOUS_CLICK"</span></pre><p id="2fee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些操作名称必须与清单文件中添加的意图过滤器名称相同。因此，当触发来自小部件的动作时，接收者接收它并将其发送到 AppWidgetProvider 文件。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="32cd" class="kj kk in mo b gy ms mt l mu mv"><strong class="mo io">Manifest File:</strong></span><span id="7bc8" class="kj kk in mo b gy mw mt l mu mv">&lt;receiver<br/>    android:name=".MusicWidget"<br/>    android:exported="false"&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="android.appwidget.action.APPWIDGET_UPDATE"/&gt;<br/>        &lt;action android:name="com.app.widgetsapp.action.ACTION_WIDGET_CLICK"/&gt;<br/>        &lt;action android:name="com.app.widgetsapp.action.ACTION_NEXT_CLICK"/&gt;<br/>        &lt;action android:name="com.app.widgetsapp.action.ACTION_PREVIOUS_CLICK"/&gt;<br/>    &lt;/intent-filter&gt;<br/><br/>    &lt;meta-data<br/>        android:name="android.appwidget.provider"<br/>        android:resource="@xml/music_widget_info" /&gt;<br/>&lt;/receiver&gt;</span></pre><p id="e26a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki">为视图定义 onClick:</em></strong></p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="beb8" class="kj kk in mo b gy ms mt l mu mv">views.setOnClickPendingIntent(R.id.<em class="ki">play</em>, getPendingSelfIntent(context, ACTION_PLAYPAUSE))</span><span id="fdaf" class="kj kk in mo b gy mw mt l mu mv">views.setOnClickPendingIntent(R.id.<em class="ki">nextBtn</em>, getPendingSelfIntent(context, ACTION_NEXT))</span><span id="a9f2" class="kj kk in mo b gy mw mt l mu mv">views.setOnClickPendingIntent(R.id.<em class="ki">previousBtn</em>, getPendingSelfIntent(context, ACTION_PREVIOUS))</span></pre><p id="21ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">需要有一个 onReceive 函数来接收触发器，您可以处理意图动作，我们可以根据点击执行适当的动作。</p><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="a975" class="kj kk in mo b gy ms mt l mu mv">override fun onReceive(context: Context?, intent: Intent?) {<br/>    super.onReceive(context, intent)<br/>    if (intent!!.<em class="ki">action</em>.<em class="ki">equals</em>(ACTION_PLAYPAUSE)) {<br/>        playSong(context!!)<br/>    } else if(intent.<em class="ki">action</em>.<em class="ki">equals</em>(ACTION_NEXT)) {<br/>        playNextSong(context!!)<br/>    } else if(intent.<em class="ki">action</em>.<em class="ki">equals</em>(ACTION_PREVIOUS)) {<br/>        playPreviousSong(context!!)<br/>    }<br/>}</span></pre><h2 id="0e44" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">5.播放歌曲 onClick</h2><pre class="li lj lk ll gt mn mo mp mq aw mr bi"><span id="b8a1" class="kj kk in mo b gy ms mt l mu mv">private fun playSong(context: Context) {<br/>    val views = RemoteViews(context.<em class="ki">packageName</em>, R.layout.<em class="ki">music_widget</em>)<br/>    val localComponentName = ComponentName(context, MusicWidget::class.<em class="ki">java</em>)<br/>    if(!isPlaying) {<br/>    //Change to pause button when song plays<br/>    views.setImageViewResource(R.id.<em class="ki">play</em>, R.drawable.<em class="ki">pause</em>)<br/>        isPlaying = true<br/>      //handle play action<br/>       MainActivity.musicPlayer.start()<br/>    } else {<br/>        views.setImageViewResource(R.id.<em class="ki">play</em>, R.drawable.<em class="ki">play</em>)<br/>        isPlaying = false<br/>        MainActivity.musicPlayer.pause()<br/>    }<br/><br/>    //Updating all the views<br/>AppWidgetManager.getInstance(context).updateAppWidget(localComponentName, views)<br/>}</span></pre><h2 id="1ba4" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">您可以在下面的 github 链接中找到该应用程序</h2><div class="mx my gp gr mz na"><a href="https://github.com/Sha489/MusicPlayerWidget" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd io gy z fp nf fr fs ng fu fw im bi translated">GitHub-sha 489/MusicPlayerWidget</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">github.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ln na"/></div></div></a></div><h2 id="08e7" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">谢谢大家！</h2></div></div>    
</body>
</html>