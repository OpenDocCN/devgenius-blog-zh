<html>
<head>
<title>Learn Python by building investment AI for fintech — Lesson2: Pandas and getting stock prices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过为金融科技构建投资人工智能来学习Python第2课:熊猫和获取股票价格</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/learn-python-by-building-investment-ai-for-fintech-lesson2-pandas-and-getting-stock-prices-46387b87b42e?source=collection_archive---------14-----------------------#2020-06-03">https://blog.devgenius.io/learn-python-by-building-investment-ai-for-fintech-lesson2-pandas-and-getting-stock-prices-46387b87b42e?source=collection_archive---------14-----------------------#2020-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4c47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">AI的牛逼Python课程第二课！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b5a73cf5107900a2f9a3a225ed68fcea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GR9Y4tv_GNVyqrWLAhCMg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Python课程第2课:熊猫和获取数据</figcaption></figure><p id="649d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文原载:<br/><a class="ae lr" href="https://www.blog.duomly.com/python-course-with-building-a-fintech-investment-ai-lesson-2-pandas-and-getting-financial-data" rel="noopener ugc nofollow" target="_blank">https://www . blog . duomly . com/python-course-with-building-a-fin tech-investment-ai-lesson-2-pandas-and-get-financial-data</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1d68" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">介绍</h1><p id="032d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">欢迎来到面向人工智能的精彩Python课程的第二课！</p><p id="30b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上一课中，我们构建了第一个数据库迁移并完成了项目设置。</p><p id="2cc7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是网址:</p><p id="05d5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://www.blog.duomly.com/python-course-with-building-a-fintech-investment-ai-lesson-1-start-the-project/" rel="noopener ugc nofollow" target="_blank">构建金融科技投资人工智能的Python课程——第1课:启动项目</a></p><p id="a895" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">今天，我们将构建超级令人兴奋的东西，并将重点放在金融数据库上，我们稍后将使用它来训练我们的AI。</p><p id="e23c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将与熊猫，一些金融插件，并将做一点重构。</p><p id="1653" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同样，我将教您如何用Python创建CLI命令。</p><p id="6850" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我等不及要教你所有这些强大的技能，所以让我们尽快开始吧！</p><p id="d097" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你喜欢视频，这是youtube的版本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Python课程第2课:如何使用Pandas并获取财务数据</figcaption></figure><h1 id="699f" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">1.迁移中的更改类型</h1><p id="300f" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在上一期中，我们创建了一些类型的数据库迁移和数据库模型。</p><p id="77ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">今天，我们将对它们进行一些修改，以便能够使用小数点后有许多数字的价格。</p><p id="88b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们只需将变量“date”中的类型改为“db”。日期()”。</p><p id="4aaa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要将所有整数改为“db”。Numeric()”。</p><p id="f052" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看看下面的例子。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="0198" class="ni ma iq ne b gy nj nk l nl nm">id = db.Column(db.Integer, primary_key=True)</span><span id="02f1" class="ni ma iq ne b gy nn nk l nl nm">company = db.Column(db.String())</span><span id="bc31" class="ni ma iq ne b gy nn nk l nl nm">date = db.Column(db.Date())</span><span id="572f" class="ni ma iq ne b gy nn nk l nl nm">openPrice = db.Column(db.Numeric())</span><span id="b742" class="ni ma iq ne b gy nn nk l nl nm">highPrice = db.Column(db.Numeric())</span><span id="7038" class="ni ma iq ne b gy nn nk l nl nm">lowPrice = db.Column(db.Numeric())</span><span id="0840" class="ni ma iq ne b gy nn nk l nl nm">closePrice = db.Column(db.Numeric())</span><span id="aaa8" class="ni ma iq ne b gy nn nk l nl nm">volume = db.Column(db.Numeric())</span></pre><h1 id="30a3" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">2.删除迁移文件夹并再次迁移</h1><p id="ec5a" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">现在，我们应该保存我们的更改并用新的更改更新数据库。</p><p id="ecde" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我会建议从头开始DB。</p><p id="0708" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为第一步，您需要删除“migrations”目录(如果您在上一课中创建了该目录)。</p><p id="69f2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，打开终端并键入:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b327" class="ni ma iq ne b gy nj nk l nl nm">flask db init</span></pre><p id="432d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c60a" class="ni ma iq ne b gy nj nk l nl nm">flask db migrate</span></pre><p id="f5eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="6689" class="ni ma iq ne b gy nj nk l nl nm">flask db migrate</span></pre><h1 id="be50" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">3.创建模块价格</h1><p id="9e04" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">太好了！</p><p id="c41b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在可以专注于接下来的功能，并进入价格模块。</p><p id="9306" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先创建名为“prices”的目录。</p><p id="a698" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在文件夹根目录下创建目录。</p><p id="3170" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，进入创建的目录，创建名为“prices.py”的文件。</p><h2 id="0317" class="ni ma iq bd mb no np dn mf nq nr dp mj le ns nt ml li nu nv mn lm nw nx mp ny bi translated">4.安装必要的依赖项</h2><p id="c433" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在我们进入适当的开发之前，我们应该记住安装我们将用于构建AI的所有必要的依赖项。</p><p id="2c2b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们需要创建yfinance，这将帮助我们连接金融API，并下载所有必要的价格数据。</p><p id="288b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开终端并键入:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="68ad" class="ni ma iq ne b gy nj nk l nl nm">pip install yfinance</span></pre><p id="f370" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要安装熊猫:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b0ce" class="ni ma iq ne b gy nj nk l nl nm">pip install yfinance</span></pre><p id="7bcd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要安装的最后一个是pandas datareader，我们将使用它来处理我们的财务数据:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e196" class="ni ma iq ne b gy nj nk l nl nm">pip install pandas_datareader</span></pre><h1 id="1f25" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">5.导入所有必要的依赖项</h1><p id="81e0" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">所以，我们已经准备好了开发所需的所有必要材料。</p><p id="14f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们可以进入prices.py文件，并导入所有这些依赖项。</p><p id="119a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看下面的例子:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="dd59" class="ni ma iq ne b gy nj nk l nl nm">from datetime import date, timedelta</span><span id="e54c" class="ni ma iq ne b gy nn nk l nl nm">import yfinance as yf</span><span id="b4a3" class="ni ma iq ne b gy nn nk l nl nm">import pandas as pd</span><span id="80b6" class="ni ma iq ne b gy nn nk l nl nm">from pandas_datareader import data as pdr</span><span id="3b64" class="ni ma iq ne b gy nn nk l nl nm">from app import app, db</span><span id="3806" class="ni ma iq ne b gy nn nk l nl nm">from models.prices import PriceModel</span></pre><h1 id="be78" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">6.用熊猫取代金融</h1><p id="e983" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">接下来，我们需要用熊猫来覆盖yfinance。</p><p id="7a59" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该行代码应该在prices.py文件中的imports下面。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="33b9" class="ni ma iq ne b gy nj nk l nl nm">yf.pdr_override()</span></pre><h1 id="adc1" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">7.设置CLI</h1><p id="1a3e" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们可以像在golang中那样，通过输入/注释函数来实现。</p><p id="b487" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果我们没有使用flask的用户友好特性，那就太可惜了。</p><p id="0b00" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以非常非常容易地定义CLI命令。</p><p id="e500" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用“app”装饰器并定义应该触发命令定义下面的逻辑的命令就足够了。</p><p id="8a85" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们来看看:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7102" class="ni ma iq ne b gy nj nk l nl nm">@app.cli.command("get-prices")</span></pre><h1 id="42ae" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">8.创建函数getPrices</h1><p id="255a" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在CLI命令下面，我们需要指定一个我们想要触发的函数。</p><p id="06d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，我们需要一个名为“getPrices”的函数。</p><p id="1435" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将用它来开始获取价格。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d0b2" class="ni ma iq ne b gy nj nk l nl nm">@app.cli.command("get-prices")</span><span id="a0f5" class="ni ma iq ne b gy nn nk l nl nm">def getPrices():</span></pre><h1 id="2198" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">9.创建一个我们需要监控的股票列表</h1><p id="33e9" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">下一步，我们应该指定我们希望获得定价的公司符号。</p><p id="ce4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们应该创建一个列表，把所有的纳斯达克符号作为字符串放在那里。</p><p id="45b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我使用了纳斯达克最重的50种股票，但是你可以指定任何你想得到数据的公司。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7bbc" class="ni ma iq ne b gy nj nk l nl nm">stockList = ['MSFT', 'AAPL', 'AMZN', 'FB', 'GOOGL', 'GOOG', 'GOOGL', 'INTC', 'NVDA', 'CSCO', 'ADBE', 'NFLX', 'PEP', 'PYP', 'CMCSA', 'TSLA', 'COST', 'GOOGL', 'AMGN', 'TMUS', 'AVGO', 'CHTR', 'TXN', 'GILD', 'QCOM', 'SBUX', 'INTU', 'MDLZ', 'VRTX', 'FISV', 'BKNG', 'ISRG', 'REGN', 'ADP', 'AMD', 'ATVI', 'CSX', 'BIIB', 'ILMN', 'MU', 'AMAT', 'JD', 'ADSK', 'MELI', 'ADI', 'LRCX', 'MNST', 'WBA', 'EXC', 'KHC', 'LULU', 'EA']</span></pre><h1 id="8f20" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">10.遍历股票列表并调用函数getPrice</h1><p id="6a6c" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在这一步中，我们应该将所有的NASDAQ符号放入for循环中进行迭代。</p><p id="f2a0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于股票的每次迭代，我们应该调用名为“getPrice”的函数，并将“stock”作为参数传递。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5dce" class="ni ma iq ne b gy nj nk l nl nm">for stock in stockList:</span><span id="617b" class="ni ma iq ne b gy nn nk l nl nm"> getPrice(stock)</span></pre><h1 id="5f10" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">11.创建函数getPrice</h1><p id="0bbd" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">要有使用它的可能性，我们需要创建函数“getPrice”。</p><p id="7964" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将“股票”设置为函数中的参数名称。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c860" class="ni ma iq ne b gy nj nk l nl nm">def getPrice(stock):</span></pre><h1 id="a9d7" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">12.设置日期</h1><p id="d4b5" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">现在，我们可以开始关注我们今天感兴趣的核心功能，获取数据。</p><p id="78a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为第一步，我们需要指定感兴趣的日期范围。</p><p id="09ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我将把今天设定为最后一天，31天前的那一天，将是我的股票价格时间范围。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b48a" class="ni ma iq ne b gy nj nk l nl nm">today = date.today()</span><span id="dcd0" class="ni ma iq ne b gy nn nk l nl nm">monthAgo = today - timedelta(days=31)</span></pre><h1 id="c9d3" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">13.下载股票价格</h1><p id="1ce4" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">下一步，我们可以开始获取数据了！</p><p id="676b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看看下面的例子。我们使用pandas_datareader。</p><p id="15a3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我设置了我想要的股票，开始日期和结束日期都是今天。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="badb" class="ni ma iq ne b gy nj nk l nl nm">data = pdr.get_data_yahoo(stock, start=monthAgo, end=today)</span></pre><h1 id="138f" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">14.熊猫重新格式化数据</h1><p id="8f56" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">为了有更好的生活和更容易的数据操作，我们需要重新格式化一点。</p><p id="2254" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以我们可以更轻松地遍历这些数据。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="705d" class="ni ma iq ne b gy nj nk l nl nm">df = pd.DataFrame(data)</span></pre><h1 id="054e" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">15.遍历所有行，并将数据传递给函数addPrice</h1><p id="d288" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">现在我们可以迭代xx公司的所有价格。</p><p id="3f5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们在这里使用“df.iterrows()”方法，因为所有的行都来自熊猫。</p><p id="3418" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们调用“addPrice ”,并传递必要的数据作为参数。</p><p id="e3c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们传递整个“行”,稍后我们将对其进行拆分，接下来我们传递index(这里是数据),但是是格式化的。</p><p id="c3f7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们通过“股票”来知道股票的价格。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e1ad" class="ni ma iq ne b gy nj nk l nl nm">for index, row in df.iterrows():</span><span id="4905" class="ni ma iq ne b gy nn nk l nl nm">  addPrice(row, index.strftime("%Y-%m-%d"), stock)</span></pre><h1 id="37eb" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">16.创建函数addPrice</h1><p id="47a4" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">为了使使用“addPrice”成为可能，我们需要定义这个函数。</p><p id="5e82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用“价格”、“日期”和“库存”作为参数。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1fbf" class="ni ma iq ne b gy nj nk l nl nm">def addPrice(price, date, stock):</span></pre><h1 id="4370" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">17.设置价格模型的数据</h1><p id="5cbb" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们接近决赛了。</p><p id="472f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这一步中，我们应该设置从财务API获得的数据。</p><p id="38bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要将它与我们在Python课程第1课中创建的价格模型相匹配。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="57bc" class="ni ma iq ne b gy nj nk l nl nm">new_price = PriceModel(date=date, company=stock, openPrice=price['Open'], highPrice=price['High'], lowPrice=price['Low'], closePrice=price['Close'], volume=price[‚Volume'])</span></pre><h1 id="862f" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">18.将价格添加到数据库</h1><p id="808e" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">如果我们的数据准备好了，除了在数据库中创建一个新记录之外，我们没有其他事情要做。</p><p id="5756" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不要忘记“db.session.commit()”，它将更新我们的数据库。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="29e5" class="ni ma iq ne b gy nj nk l nl nm">db.session.add(new_price)</span><span id="785d" class="ni ma iq ne b gy nn nk l nl nm">db.session.commit()</span></pre><h1 id="0caf" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">19.在app.py中导入getPrices</h1><p id="816d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">恭喜你！</p><p id="ca9f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">价格模块现在已经准备好了。可以在app.py里面导入。</p><p id="7a3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将这行代码添加到“PriceModel”导入下面。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="33dd" class="ni ma iq ne b gy nj nk l nl nm">from prices.prices import getPrices</span></pre><h1 id="592b" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">20.运行获取价格</h1><p id="508a" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">您现在可以测试您的应用程序了。</p><p id="2947" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始之前，请确保flask app变量配置正确(我们在第1课中已经这样做了)。</p><p id="d10a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果是，只需在项目中打开一个终端并键入:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d838" class="ni ma iq ne b gy nj nk l nl nm">flask get-prices</span></pre><h1 id="7e56" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">结论</h1><p id="d8ff" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">恭喜你！</p><p id="f698" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在你的项目有数百条财务记录。</p><p id="683b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些人已经准备好开始与人工智能合作，我们将建造人工智能。</p><p id="e233" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更重要的是，你已经学会了在哪里寻找股票价格，如何选择它们，以及如何将它们保存到数据库中。</p><p id="1345" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Python课程第2课的代码库在这里:</p><p id="128a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://github.com/Duomly/python-ai-investment-fintech/tree/Python-AI-course-Lesson-2" rel="noopener ugc nofollow" target="_blank">https://github . com/Duomly/Python-AI-investment-fin tech/tree/Python-AI-course-Lesson-2</a></p><p id="fa73" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下一课中，我们将专注于为我们的算法构建第一个AI逻辑。</p><p id="402a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">继续学习，我超级兴奋我有机会教你如何建立强大的投资人工智能，可以预测股票价格！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/da0dbcf44b16aceb7cca413a6d9a5ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJmZtnXM9S7lwHQJTEQngg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae lr" href="https://www.duomly.com" rel="noopener ugc nofollow" target="_blank">编程课程在线</a></figcaption></figure><p id="b3b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读，</p><p id="02c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Duomly的Radek</p></div></div>    
</body>
</html>