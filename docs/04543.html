<html>
<head>
<title>Add Pie and Donut Charts into Our React App with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Visx 库将饼图和圆环图添加到 React 应用程序中</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-a-pie-and-donut-charts-into-our-react-app-with-the-visx-library-f7397c52446c?source=collection_archive---------4-----------------------#2021-03-31">https://blog.devgenius.io/add-a-pie-and-donut-charts-into-our-react-app-with-the-visx-library-f7397c52446c?source=collection_archive---------4-----------------------#2021-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/54e51b6b8b30cfd8e12ac18a3dac15e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e8un4QcFChkINc65"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@priscilladupreez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">普里西拉·杜·普里兹</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="12ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx 是一个库，让我们可以轻松地将图形添加到 React 应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将饼图和圆环图添加到 React 应用程序中</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/gradient @visx/group @visx/mock-data @visx/responsive @visx/scale @visx/shape</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="dd73" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建饼图和圆环图</h1><p id="9a3a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下内容来创建饼图和圆环图:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ecb1" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from "react";<br/>import Pie from "@visx/shape/lib/shapes/Pie";<br/>import { scaleOrdinal } from "@visx/scale";<br/>import { Group } from "@visx/group";<br/>import { GradientPinkBlue } from "@visx/gradient";<br/>import letterFrequency from "@visx/mock-data/lib/mocks/letterFrequency";<br/>import browserUsage from "@visx/mock-data/lib/mocks/browserUsage";<br/>import { animated, useTransition, interpolate } from "react-spring";</span><span id="e3ad" class="mn lc iq mj b gy ms mp l mq mr">const letters = letterFrequency.slice(0, 4);<br/>const browserNames = Object.keys(browserUsage[0]).filter((k) =&gt; k !== "date");<br/>const browsers = browserNames.map((name) =&gt; ({<br/>  label: name,<br/>  usage: Number(browserUsage[0][name])<br/>}));</span><span id="b606" class="mn lc iq mj b gy ms mp l mq mr">const usage = (d) =&gt; d.usage;<br/>const frequency = (d) =&gt; d.frequency;<br/>const getBrowserColor = scaleOrdinal({<br/>  domain: browserNames,<br/>  range: [<br/>    "rgba(255,255,255,0.7)",<br/>    "rgba(255,255,255,0.6)",<br/>    "rgba(255,255,255,0.5)",<br/>    "rgba(255,255,255,0.4)",<br/>    "rgba(255,255,255,0.3)",<br/>    "rgba(255,255,255,0.2)",<br/>    "rgba(255,255,255,0.1)"<br/>  ]<br/>});<br/>const getLetterFrequencyColor = scaleOrdinal({<br/>  domain: letters.map((l) =&gt; l.letter),<br/>  range: [<br/>    "rgba(93,30,91,1)",<br/>    "rgba(93,30,91,0.8)",<br/>    "rgba(93,30,91,0.6)",<br/>    "rgba(93,30,91,0.4)"<br/>  ]<br/>});</span><span id="5ef6" class="mn lc iq mj b gy ms mp l mq mr">const defaultMargin = { top: 20, right: 20, bottom: 20, left: 20 };</span><span id="f183" class="mn lc iq mj b gy ms mp l mq mr">function Example({ width, height, margin = defaultMargin, animate = true }) {<br/>  const [selectedBrowser, setSelectedBrowser] = useState(null);<br/>  const [selectedAlphabetLetter, setSelectedAlphabetLetter] = useState(null);</span><span id="90d6" class="mn lc iq mj b gy ms mp l mq mr">  if (width &lt; 10) return null;</span><span id="a09b" class="mn lc iq mj b gy ms mp l mq mr">  const innerWidth = width - margin.left - margin.right;<br/>  const innerHeight = height - margin.top - margin.bottom;<br/>  const radius = Math.min(innerWidth, innerHeight) / 2;<br/>  const centerY = innerHeight / 2;<br/>  const centerX = innerWidth / 2;<br/>  const donutThickness = 50;</span><span id="d1b1" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;svg width={width} height={height}&gt;<br/>      &lt;GradientPinkBlue id="visx-pie-gradient" /&gt;<br/>      &lt;rect<br/>        rx={14}<br/>        width={width}<br/>        height={height}<br/>        fill="url('#visx-pie-gradient')"<br/>      /&gt;<br/>      &lt;Group top={centerY + margin.top} left={centerX + margin.left}&gt;<br/>        &lt;Pie<br/>          data={<br/>            selectedBrowser<br/>              ? browsers.filter(({ label }) =&gt; label === selectedBrowser)<br/>              : browsers<br/>          }<br/>          pieValue={usage}<br/>          outerRadius={radius}<br/>          innerRadius={radius - donutThickness}<br/>          cornerRadius={3}<br/>          padAngle={0.005}<br/>        &gt;<br/>          {(pie) =&gt; (<br/>            &lt;AnimatedPie<br/>              {...pie}<br/>              animate={animate}<br/>              getKey={(arc) =&gt; arc.data.label}<br/>              onClickDatum={({ data: { label } }) =&gt;<br/>                animate &amp;&amp;<br/>                setSelectedBrowser(<br/>                  selectedBrowser &amp;&amp; selectedBrowser === label ? null : label<br/>                )<br/>              }<br/>              getColor={(arc) =&gt; getBrowserColor(arc.data.label)}<br/>            /&gt;<br/>          )}<br/>        &lt;/Pie&gt;<br/>        &lt;Pie<br/>          data={<br/>            selectedAlphabetLetter<br/>              ? letters.filter(<br/>                  ({ letter }) =&gt; letter === selectedAlphabetLetter<br/>                )<br/>              : letters<br/>          }<br/>          pieValue={frequency}<br/>          pieSortValues={() =&gt; -1}<br/>          outerRadius={radius - donutThickness * 1.3}<br/>        &gt;<br/>          {(pie) =&gt; (<br/>            &lt;AnimatedPie<br/>              {...pie}<br/>              animate={animate}<br/>              getKey={({ data: { letter } }) =&gt; letter}<br/>              onClickDatum={({ data: { letter } }) =&gt;<br/>                animate &amp;&amp;<br/>                setSelectedAlphabetLetter(<br/>                  selectedAlphabetLetter &amp;&amp; selectedAlphabetLetter === letter<br/>                    ? null<br/>                    : letter<br/>                )<br/>              }<br/>              getColor={({ data: { letter } }) =&gt;<br/>                getLetterFrequencyColor(letter)<br/>              }<br/>            /&gt;<br/>          )}<br/>        &lt;/Pie&gt;<br/>      &lt;/Group&gt;<br/>    &lt;/svg&gt;<br/>  );<br/>}</span><span id="213c" class="mn lc iq mj b gy ms mp l mq mr">const fromLeaveTransition = ({ endAngle }) =&gt; ({<br/>  startAngle: endAngle &gt; Math.PI ? 2 * Math.PI : 0,<br/>  endAngle: endAngle &gt; Math.PI ? 2 * Math.PI : 0,<br/>  opacity: 0<br/>});</span><span id="05a1" class="mn lc iq mj b gy ms mp l mq mr">const enterUpdateTransition = ({ startAngle, endAngle }) =&gt; ({<br/>  startAngle,<br/>  endAngle,<br/>  opacity: 1<br/>});</span><span id="1eda" class="mn lc iq mj b gy ms mp l mq mr">function AnimatedPie({ animate, arcs, path, getKey, getColor, onClickDatum }) {<br/>  const transitions = useTransition(arcs, getKey, {<br/>    from: animate ? fromLeaveTransition : enterUpdateTransition,<br/>    enter: enterUpdateTransition,<br/>    update: enterUpdateTransition,<br/>    leave: animate ? fromLeaveTransition : enterUpdateTransition<br/>  });<br/>  return (<br/>    &lt;&gt;<br/>      {transitions.map(({ item: arc, props, key }) =&gt; {<br/>        const [centroidX, centroidY] = path.centroid(arc);<br/>        const hasSpaceForLabel = arc.endAngle - arc.startAngle &gt;= 0.1;</span><span id="e03c" class="mn lc iq mj b gy ms mp l mq mr">        return (<br/>          &lt;g key={key}&gt;<br/>            &lt;animated.path<br/>              d={interpolate(<br/>                [props.startAngle, props.endAngle],<br/>                (startAngle, endAngle) =&gt;<br/>                  path({<br/>                    ...arc,<br/>                    startAngle,<br/>                    endAngle<br/>                  })<br/>              )}<br/>              fill={getColor(arc)}<br/>              onClick={() =&gt; onClickDatum(arc)}<br/>              onTouchStart={() =&gt; onClickDatum(arc)}<br/>            /&gt;<br/>            {hasSpaceForLabel &amp;&amp; (<br/>              &lt;animated.g style={{ opacity: props.opacity }}&gt;<br/>                &lt;text<br/>                  fill="white"<br/>                  x={centroidX}<br/>                  y={centroidY}<br/>                  dy=".33em"<br/>                  fontSize={9}<br/>                  textAnchor="middle"<br/>                  pointerEvents="none"<br/>                &gt;<br/>                  {getKey(arc)}<br/>                &lt;/text&gt;<br/>              &lt;/animated.g&gt;<br/>            )}<br/>          &lt;/g&gt;<br/>        );<br/>      })}<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="a74f" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="fcc2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe mt mu mv mj b">letters</code>变量来为饼图添加数据。</p><p id="13ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">browerNames</code>和<code class="fe mt mu mv mj b">browsers</code>有环形图的数据。</p><p id="56a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">usage</code>和<code class="fe mt mu mv mj b">frequency</code>是数据的存取函数。</p><p id="d1b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">getBrowserData</code>是一个返回浏览器圆环图颜色的函数。</p><p id="7263" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">getLetterFrequencyColor</code>是一个返回浏览器饼图颜色的函数。</p><p id="e69b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">defaultMargin</code>为图表留有页边距。</p><p id="8349" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">Example</code>组件是主图表容器。</p><p id="07f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe mt mu mv mj b">selectedBrowser</code>和<code class="fe mt mu mv mj b">selectedAlphabetLetter</code>状态来分别跟踪选择的甜甜圈和饼图片段。</p><p id="bdcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们点击它们时，它们被选中。</p><p id="0126" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们定义<code class="fe mt mu mv mj b">innerWidth</code>、<code class="fe mt mu mv mj b">innerHeight</code> n <code class="fe mt mu mv mj b">radius</code>、<code class="fe mt mu mv mj b">centerY</code>、<code class="fe mt mu mv mj b">centerX</code>和<code class="fe mt mu mv mj b">donutThickness</code>变量来计算图表的尺寸。</p><p id="786a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">return</code>语句中，我们有带背景的<code class="fe mt mu mv mj b">GradientPinkBlue</code>组件。</p><p id="e261" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">Group</code>组件中，我们有<code class="fe mt mu mv mj b">Pie</code>组件。</p><p id="7d16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们定义了饼图和圆环图。</p><p id="40d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个<code class="fe mt mu mv mj b">Pie</code>有饼图。</p><p id="3b95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个<code class="fe mt mu mv mj b">Pie</code>是圆环图里面的饼图。</p><p id="efd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们中的每一个都有一个 render prop，它返回<code class="fe mt mu mv mj b">AnimatedPie</code>组件来为饼图和圆环图添加动画。</p><p id="c6af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们有<code class="fe mt mu mv mj b">onClickDatum</code>道具，让我们分别设置<code class="fe mt mu mv mj b">selectedBrowser</code>和<code class="fe mt mu mv mj b">selectedAlphabetLetter</code>状态。</p><p id="9869" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">getColor</code>属性有一个返回饼图和甜甜圈段颜色的函数。</p><p id="8782" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">AnimatedPie</code>组件是通过渲染<code class="fe mt mu mv mj b">animated.path</code>来渲染饼图或甜甜圈而创建的。</p><p id="f3e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe mt mu mv mj b">useTransition</code>钩子来添加过渡效果。</p><h1 id="2c4c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="4767" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过 Visx 库轻松地将饼图和圆环图添加到 React 应用程序中。</p></div></div>    
</body>
</html>