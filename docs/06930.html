<html>
<head>
<title>Level Up as a Software Engineer by Writing a Chess Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过编写国际象棋引擎来升级为软件工程师</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/level-up-as-a-software-engineer-by-writing-a-chess-engine-f4532f509b56?source=collection_archive---------9-----------------------#2022-02-12">https://blog.devgenius.io/level-up-as-a-software-engineer-by-writing-a-chess-engine-f4532f509b56?source=collection_archive---------9-----------------------#2022-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bf31" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第三部分:移动世代</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/da9c3a4bafc4112da9b50f5e595993fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*PzSDmpaKemvAk-6_eAb8dQ.jpeg"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated"><a class="ae kr" href="https://www.chessprogramming.org/Ludwig_Zagler" rel="noopener ugc nofollow" target="_blank">路德维希·扎格勒</a>带 Daja 象棋引擎，1976<a class="ae kr" href="https://www.chessprogramming.org/Daja#cite_note-1" rel="noopener ugc nofollow" target="_blank">【1】</a></figcaption></figure><p id="9d0e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">计算机是如何思考的？它必须知道两件事:什么是可能的，什么是最优的。</strong></p><p id="e3f7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">棋步生成函数计算从给定位置可能发生的情况。评价函数决定什么是最优的。<strong class="ku ir">移动代是这两种能力的结合，也是本文的重点。</strong></p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="da26" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">关于评价函数的一点注记</h2><p id="0ea0" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">没有一台计算机可以“看到”一盘棋的结局，但是引擎仍然需要找到有利的位置。这就是为什么需要一个评估函数来对职位的近似优势进行评分。</p><p id="1229" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">评估通常使用点数系统，棋子价值为 100，相对值如下:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="deea" class="lv lw iq mu b gy my mz l na nb">pawn:    100<br/>knight:  300<br/>bishop:  320<br/>queen:   900<br/>king:    99999</span></pre><p id="cc2d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">评价函数还考虑了位置优势。我引擎的评测功能很简单，你可以在这里<a class="ae kr" href="https://github.com/tonyOreglia/glee/blob/master/pkg/evaluate/evaluate.go" rel="noopener ugc nofollow" target="_blank">找到</a>。</p><p id="1130" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">就本文的目的而言，想象一个简单的评估，它只是将每件作品的分数相加，而忽略了位置优势。<strong class="ku ir">根据这种评估方法和移动生成功能，您将如何选择最佳移动？</strong></p><h1 id="ea79" class="nc lw iq bd lx nd ne nf ma ng nh ni md jw nj jx mg jz nk ka mj kc nl kd mm nm bi translated">天真的解决方案</h1><p id="1710" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">天真的方法是评估每一步棋，选择得分最高的一步。</p><p id="fa09" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这种方法有严重的问题。例如，考虑以下用黑色来移动的位置</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/36acf6369e6ab80f7808a3c4ccfe4f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*i5Gb1AkMVMvarPUemguqGA.png"/></div></figure><p id="e9f1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在所有可能的走法中，得分最高的是在黑皇后抓住棋子之后。使用上面提到的评估，拿走棋子将得到负 400 分(负分对黑棋有利)。</p><p id="01fe" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但显然，这是一个糟糕的举动！白方将会抓住黑方皇后，白方得到 500 分。</p><p id="63df" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">就像人类棋手一样，国际象棋引擎需要超越一步棋才能下好。</p><h2 id="f92b" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">更好—最小最大</h2><p id="ddb4" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">想象一下引擎看起来有三层<a class="ae kr" href="https://www.chessprogramming.org/Ply" rel="noopener ugc nofollow" target="_blank">在前面。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/ac33985a3741df510ec252182e66a215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AEkwxyf2jbAGvDZ9ongDQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">双重搜索</figcaption></figure><p id="b772" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这提出了一个有趣的问题。引擎不能简单地选择具有最佳结果的移动，因为对手有机会消除最佳结果。工程师必须假设对手会理性地比赛。它的工作是限制对手的选择，同时最大化自己的选择。<strong class="ku ir">极大极小算法的目的正是为了做到这一点。</strong></p><p id="d2f9" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个故事帮助我将极小极大概念化。想象一下和你讨厌的敌人玩游戏。你们之间有两个敞开的盒子，里面有一堆东西。你必须给你的对手一个盒子。然后他们会从盒子里选择一件东西给你。当然，对手会选择最差的物品。为了使你得到的价值最大化，你必须消除装有最差物品的盒子。</p><p id="3dfe" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">例如，如果一个盒子里有一堆狗屎，而另一个盒子里最糟糕的东西是一个回形针，那么你应该选择有回形针的盒子。</p><p id="5d99" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这种情况类似于双重搜索。但是这个策略也适用于更深层次的搜索。</p><p id="2944" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">下面是一个任意深度的最小-最大函数的伪代码示例(来自<a class="ae kr" href="https://www.chessprogramming.org/Main_Page" rel="noopener ugc nofollow" target="_blank">象棋编程维基</a>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">极大极小搜索伪码</figcaption></figure><p id="d5b4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">从给定位置开始的每次移动都会调用此函数，并选择得分最高的移动。Minimax 要求一方优势为正，对手为负。</p><h2 id="7b69" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">更好— Alpha-beta 修剪</h2><p id="33e9" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">极小极大效率低。</p><p id="c215" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要理解为什么，再想象一下这两个盒子。现在想象你往第一个箱子里看去，最糟糕的东西是一袋钱(<strong class="ku ir">太棒了！</strong>)。现在想象一下，你在第二个盒子里看到的第一件东西是你姻亲的午餐邀请(<strong class="ku ir">哎哟！！</strong>)。对手肯定会给你邀请的。您可以停止勾选第二个框，只选择第一个框。</p><p id="6a66" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">这是一种优化。Alpha-beta 修剪可以做到这一点。本质上，阿尔法-贝塔将忽略那些肯定比之前分析的走势更差的走势。</strong></p><p id="d155" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这里有一些 alpha-beta 修剪函数的伪代码(来自 chess programming wiki):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="a324" class="nc lw iq bd lx nd ne nf ma ng nh ni md jw nj jx mg jz nk ka mj kc nl kd mm nm bi translated">最佳化</h1><p id="3d1b" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">可能的优化和改进是无穷无尽的。我将提到几个，并为感兴趣的人提供链接。</p><h2 id="be4d" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">哈希算法</h2><p id="3512" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">散列表可用于消除重复工作。例如，移动树的一部分将与先前的搜索重叠。如果你能散列位置(用<a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/improve-as-a-software-engineer-by-writing-a-chess-engine-c360109371aa"> bitboards </a>很有效)并存储关于结果的信息，那么在接下来的搜索中可以节省时间。</p><h2 id="3f24" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">静止搜索或选择性深化</h2><p id="0e74" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">引擎的<a class="ae kr" href="https://en.wikipedia.org/wiki/Horizon_effect" rel="noopener ugc nofollow" target="_blank">深度视野</a>有问题。如果引擎向前看了六步，但是第七步是王后捕获，这可能是一个关键的盲点。人类自然会注意到这一点。对于引擎，静止搜索解决了这个问题。静止搜索在某些情况下会更深入。这个想法是只评估“安静”的位置(没有迫在眉睫的捕获或战术)，但在动态位置进行更深入的搜索。</p><h2 id="9c5c" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">迭代深化</h2><p id="584d" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">整个游戏的复杂程度各不相同。在游戏的最后阶段，可能会有两个合法的行动。中局可以有三十步。随着位置的简化，引擎将能够更深入地搜索。因此，搜索深度应该在整个游戏中有所不同。</p><p id="7888" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">迭代加深从低深度搜索开始，并迭代地增加深度，直到达到某个时间限制。这听起来可能效率很低，但是低深度计算是快速的(每层的时间是指数级增加的)。通常，这优化了给定时间窗口的搜索深度。在时间不多，引擎需要快速做出决定的情况下，这很有用。</p><h1 id="1554" class="nc lw iq bd lx nd ne nf ma ng nh ni md jw nj jx mg jz nk ka mj kc nl kd mm nm bi translated">训练电脑思考</h1><p id="12e0" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">我希望这篇文章激起了你对国际象棋编程和编程机器思考的兴趣。即使在机器学习时代，也必须向机器展示<strong class="ku ir">什么是可能的，什么是最优的。</strong>例如，训练一个 ML 算法<strong class="ku ir"> </strong>需要一个数据集进行反馈，以调整“神经元”并增加准确性。甚至 AlphaGo 也被赋予了规则(什么是可能的)，然后自学什么是最优的。</p><p id="81ee" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果你想和我一起深入象棋编程，<a class="ae kr" href="https://tony-oreglia.medium.com/membership" rel="noopener">加入 Medium </a>，<a class="ae kr" href="https://tony-oreglia.medium.com/" rel="noopener">关注</a>，<a class="ae kr" href="https://tony-oreglia.medium.com/subscribe" rel="noopener">订阅我的简讯</a>，或者在<a class="ae kr" href="https://twitter.com/tony_oreglia" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae kr" href="https://www.linkedin.com/in/tony-oreglia/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="3935" class="lv lw iq mu b gy my mz l na nb">This article is part three of a series<br/>- Find Part one <a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/level-up-as-a-software-engineer-by-writing-a-chess-engine-896b7f8eb443">here</a>.<br/>- Find Part three about Move Generation <a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/level-up-as-a-software-engineer-by-writing-a-chess-engine-f4532f509b56">here</a>.<br/>- Find Part four about Testing <a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/level-up-as-a-software-engineer-by-writing-a-chess-engine-1d0ffc7aebf9">here</a>.</span></pre><p id="57f3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我的象棋引擎被命名为 Glee，是 Golang 象棋引擎的缩写。</p><ul class=""><li id="6a2b" class="nv nw iq ku b kv kw ky kz lb nx lf ny lj nz ln oa ob oc od bi translated"><a class="ae kr" href="https://github.com/tonyOreglia/glee" rel="noopener ugc nofollow" target="_blank">象棋引擎源代码</a></li><li id="0be8" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://github.com/tonyOreglia/personal-website/tree/master/src/ChessGame" rel="noopener ugc nofollow" target="_blank">前端源代码</a></li><li id="d1fb" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://tonycodes.com/chess" rel="noopener ugc nofollow" target="_blank">在这里对抗欢乐合唱团！</a></li></ul></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="5108" class="nc lw iq bd lx nd oj nf ma ng ok ni md jw ol jx mg jz om ka mj kc on kd mm nm bi translated">资源</h1><ul class=""><li id="e0f2" class="nv nw iq ku b kv mo ky mp lb oo lf op lj oq ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Iterative_Deepening" rel="noopener ugc nofollow" target="_blank">迭代深化</a></li><li id="f997" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://en.wikipedia.org/wiki/Alpha%E2%80%93beta_pruning" rel="noopener ugc nofollow" target="_blank">阿尔法-贝塔修剪</a></li><li id="ef75" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://en.wikipedia.org/wiki/Minimax" rel="noopener ugc nofollow" target="_blank">极小极大</a></li><li id="d5bb" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Selectivity" rel="noopener ugc nofollow" target="_blank">选择性加深</a></li><li id="e95f" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Quiescence_Search" rel="noopener ugc nofollow" target="_blank">静止搜索</a></li><li id="d5a0" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Hash_Table" rel="noopener ugc nofollow" target="_blank">使用哈希表</a></li><li id="d379" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Search_Tree" rel="noopener ugc nofollow" target="_blank">游戏搜索树</a></li><li id="fda4" class="nv nw iq ku b kv oe ky of lb og lf oh lj oi ln oa ob oc od bi translated"><a class="ae kr" href="https://www.chessprogramming.org/Ply" rel="noopener ugc nofollow" target="_blank">板层</a></li></ul></div></div>    
</body>
</html>