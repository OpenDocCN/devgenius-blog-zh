<html>
<head>
<title>All Aboard the Rails Nested Routes Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">所有登上铁路嵌套路线快车</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/all-aboard-the-rails-nested-routes-express-aa311387563e?source=collection_archive---------3-----------------------#2020-12-08">https://blog.devgenius.io/all-aboard-the-rails-nested-routes-express-aa311387563e?source=collection_archive---------3-----------------------#2020-12-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><figure class="js jt ju jv gt jw gh gi paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="gh gi jr"><img src="../Images/99e388a58ca854c94246c5c593b11460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KBBEqwjK2WO_1Z7B"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">由<a class="ae kh" href="https://unsplash.com/@pixelatelier?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯蒂安·霍尔辛格</a>在<a class="ae kh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="55b3" class="ki kj in bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">这篇博客文章将关注:</h2><ul class=""><li id="0ea2" class="le lf in lg b lh li lj lk kr ll kv lm kz ln lo lp lq lr ls bi translated">Rails 嵌套资源</li><li id="c0fb" class="le lf in lg b lh lt lj lu kr lv kv lw kz lx lo lp lq lr ls bi translated">ActiveRecord 查询方法</li></ul><p id="8a17" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">这篇博文将通过我自己对 Rails 应用的精彩评论来讨论这些问题。</p><p id="825f" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">什么是有价值的评论？</p><p id="53fd" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">简单来说，<em class="mp"> Brew-Ti-Ful Reviews </em>是一个用 Rails 构建的应用，允许用户添加他们已经品尝或尚未品尝的咖啡，并给他们评论。</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><h1 id="3ecd" class="mq kj in bd kk mr ms mt kn mu mv mw kq mx my mz ku na nb nc ky nd ne nf lc ng bi translated">Rails 嵌套资源</h1><p id="e3a8" class="pw-post-body-paragraph ly lz in lg b lh li mb mc lj lk me mf kr nh mh mi kv ni mk ml kz nj mn mo lo ig bi translated">rails 中的嵌套资源使我们能够直接在我们的路由中记录父/子关系。</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="b5d2" class="ki kj in nl b gy np nq l nr ns">class Coffee &lt; ApplicationRecord<br/>  has_many :reviews<br/>end </span><span id="dc13" class="ki kj in nl b gy nt nq l nr ns">class Review &lt; ApplicationRecord<br/>  belongs_to :coffee<br/>end</span></pre><p id="f4d5" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">这里我们有来自两个模型 User 和 Review 的父模型(Coffee)和子模型(Review)。嵌套路由是通过路由获取这些关系的另一种方式。这意味着我们的 URL 将看起来美观，而不是一串随机的数字和字符。</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="e502" class="ki kj in nl b gy np nq l nr ns">resources :coffees do<br/>    resources :reviews, only: [:new, :index, :show]<br/>end</span></pre><p id="5c58" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">此操作将为我们的咖啡创建路线，并且还会将我们的评论发送给评论管理员。嵌套路由还将为我们提供我前面提到的那些美观的 URL 路径。</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="7593" class="ki kj in nl b gy np nq l nr ns">coffee_reviews GET    /coffees/:coffee_id/reviews(.:format)                                                    reviews#index</span><span id="9c2f" class="ki kj in nl b gy nt nq l nr ns">new_coffee_review GET    /coffees/:coffee_id/reviews/new(.:format)                                                reviews#new</span><span id="8ad8" class="ki kj in nl b gy nt nq l nr ns">coffee_review GET    /coffees/:coffee_id/reviews/:id(.:format)                                                reviews#show</span><span id="58e1" class="ki kj in nl b gy nt nq l nr ns">coffees GET    /coffees(.:format)                                                                       coffees#index</span></pre><p id="6c95" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">因此，如果我们想查看特定咖啡的所有评论，URL 在您的浏览器中看起来会像<code class="fe nu nv nw nl b">/coffees/1/reviews</code>。这个方便的方法也将创建路由助手，如<code class="fe nu nv nw nl b">new_coffee_review</code>。</p><p id="2bc3" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">嵌套资源也可以有深度嵌套，如下所示:</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="245a" class="ki kj in nl b gy np nq l nr ns">resources :coffees do<br/>    resources :reviews, only: [:new, :index, :show]<br/>      resources :photos</span><span id="d138" class="ki kj in nl b gy nt nq l nr ns">end</span></pre><p id="ae72" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">然而，做这些深度嵌套的资源是一个很好的方法，可以让你迷失在所有这些繁琐的路由助手和 URL 路径中。因此，为了保持良好的编程实践，最好避免深度嵌套路由。</p><p id="ff34" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">通过嵌套资源，您可以利用这一强大的工具来帮助保持您的路线整洁、动态。</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><h1 id="1a8a" class="mq kj in bd kk mr ms mt kn mu mv mw kq mx my mz ku na nb nc ky nd ne nf lc ng bi translated">ActiveRecord::查询方法</h1><p id="af19" class="pw-post-body-paragraph ly lz in lg b lh li mb mc lj lk me mf kr nh mh mi kv ni mk ml kz nj mn mo lo ig bi translated">在进入 Flatiron 的 Rails mod 之前，我已经习惯了用传统的 Ruby 语法编写方法。直到这个项目，我才发现 ActiveRecord 查询方法的迷人世界。</p><p id="ddc5" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">关于编程，我最喜欢的事情之一是发现新的方法来做我以前已经学会如何做的事情。因此，当我发现这些新的查询方法可以编写类似于我用普通的旧 ruby 语法编写的代码时，我感到非常惊讶。ActiveRecord 查询方法启动命令并在数据库中执行它们，本质上是通过在数据库中执行来加速命令。</p><p id="878c" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">这里是我在做这个项目时学到的一些我最喜欢的查询方法。</p><p id="38e2" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated"><strong class="lg io"> <em class="mp">构建</em> </strong></p><p id="39fb" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated"><code class="fe nu nv nw nl b">build</code> <em class="mp"> </em>方法相当于对一个对象调用<code class="fe nu nv nw nl b">.new</code>。就像<em class="mp"> new 一样，</em> build 不会自动将其保存到数据库中，所以您需要调用变量的 save 方法。</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="8693" class="ki kj in nl b gy np nq l nr ns">@review = @coffee.reviews.build</span></pre><p id="111f" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated"><strong class="lg io">T9】通过找到 _ 或 _ 创建 _ 被</strong></p><p id="685b" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated"><code class="fe nu nv nw nl b">find_or_create_by</code>方法检查具有指定属性的记录是否存在。如果没有，则调用<code class="fe nu nv nw nl b">create</code>。本质上，这是告诉我们的数据库找到某个东西，如果那个东西存在，然后继续，但是，如果数据库中没有记录，那么在数据库中为它创建一个新的条目。这里的方法真的很漂亮！</p><pre class="js jt ju jv gt nk nl nm nn aw no bi"><span id="e933" class="ki kj in nl b gy np nq l nr ns">@user = User.find_or_create_by(email: user_email)</span></pre><p id="8ba7" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">下面是一个例子，我在项目中使用这个查询方法为 omniauth 创建一个控制器操作。</p><p id="ec71" class="pw-post-body-paragraph ly lz in lg b lh ma mb mc lj md me mf kr mg mh mi kv mj mk ml kz mm mn mo lo ig bi translated">有了这些新的查询方法，我觉得我好像给我的开发者腰带添加了一个新工具！我绝对建议您在这里看看《Rails guidelines》<a class="ae kh" href="https://guides.rubyonrails.org/active_record_querying.html" rel="noopener ugc nofollow" target="_blank">,了解更多查询方法的优点！</a></p></div></div>    
</body>
</html>