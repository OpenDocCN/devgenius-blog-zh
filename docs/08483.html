<html>
<head>
<title>Animated Bottom Navigation In Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack Compose 中的动画底部导航</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/animated-bottom-navigation-in-jetpack-compose-af8f590fbeca?source=collection_archive---------4-----------------------#2022-06-18">https://blog.devgenius.io/animated-bottom-navigation-in-jetpack-compose-af8f590fbeca?source=collection_archive---------4-----------------------#2022-06-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b74dfb0928712b398e9926c6999dd3dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYfsS7wdSzKgJQlN3eRCdg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源:<a class="ae jz" href="https://kinsta.com/blog/website-navigation/" rel="noopener ugc nofollow" target="_blank">https://kinsta.com/blog/website-navigation/</a></figcaption></figure><p id="2c67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个创建中，我们将创建一个自定义的底部导航栏，如下图所示，其中有许多复杂的动画，这些动画在预定义的底部导航栏中并不存在。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/447479019fee55b5f6536de0606f6700.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Z0Q3Z1FM_OlyoXypy9h8cQ.gif"/></div></figure><blockquote class="ld le lf"><p id="c4ef" class="ka kb lg kc b kd ke kf kg kh ki kj kk lh km kn ko li kq kr ks lj ku kv kw kx ig bi translated">那么当某样东西不存在时，我们该怎么办呢，在我以前的文章中可以找到答案。</p></blockquote><h2 id="2e13" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">写作中的思考</h2><p id="c898" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我们将把这个问题分成更小的部分，从这些部分构建整个底部导航，首先我将关注底部导航项目的 UI。它看起来像一个盒子里一个图标和一个文本，当一个在上面，另一个在下面时，它们随着动画上下移动。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/f5ea94f5871249005126c8784bd6bb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*HkmyPMTNjRNsqMPQFCF8lg.png"/></div></figure><p id="7cd3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们集中精力制作它们的动画。正如我们所讨论的，当一个图标向上时，另一个图标向下，反之亦然。为了产生这种效果，当需要显示图标时，我可以将文本向上移动到底部导航的可视区域之外，当需要显示文本时，将图标向下移动到底部导航的可视区域之外。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/5810b901951d06920288021bbf59cf87.png" data-original-src="https://miro.medium.com/v2/resize:fit:228/1*vrXMeMT1KN1-FJK_DX3zQw.gif"/></div></figure><p id="26d8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，当选择此项时，我们使用<code class="fe mm mn mo mp b">offset(y = top)</code>将图标顶部对齐底部导航的顶部,<code class="fe mm mn mo mp b">0 dp</code>表示将显示图标。与此同时，我们用<code class="fe mm mn mo mp b">offset(y = top — 56.dp)</code>将文本的底部与底部导航的顶部对齐，因为<code class="fe mm mn mo mp b">top — 56.dp</code>是<code class="fe mm mn mo mp b">-56 dp</code>意味着它将位于图标的正上方，但看不见。</p><p id="022d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还有一个弹性效果，它来自动画的<a class="ae jz" href="https://developer.android.com/jetpack/compose/animation#animationspec" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">动画特效</strong> </a>。你可以把<strong class="kc io"> AnimationSpec </strong>想象成视图世界动画的<a class="ae jz" href="https://thoughtbot.com/blog/android-interpolators-a-visual-guide" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"/></a>。</p><pre class="kz la lb lc gt mq mp mr ms aw mt bi"><span id="9c3a" class="lk ll in mp b gy mu mv l mw mx">val top by <em class="lg">animateDpAsState</em>(<br/>    targetValue = if (selected) 0.<em class="lg">dp </em>else 56.<em class="lg">dp</em>,<br/>    animationSpec = SpringSpec(dampingRatio = 0.5f, stiffness = 200f)<br/>)</span></pre><p id="8536" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里我们正在创建一个<a class="ae jz" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/core/SpringSpec" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> SpringSpec </strong> </a>虽然是默认的<strong class="kc io">animation spec</strong>但是我们调整了<code class="fe mm mn mo mp b">dampingRatio</code>和<code class="fe mm mn mo mp b">stiffness</code>来产生上面的效果。</p><blockquote class="ld le lf"><p id="c9ca" class="ka kb lg kc b kd ke kf kg kh ki kj kk lh km kn ko li kq kr ks lj ku kv kw kx ig bi translated">把阻尼比想象成<code class="fe mm mn mo mp b">dampingRatio</code>更大，这意味着你的弹簧太肥了，所以在你拉伸和释放它之后，它不会反弹太多。阻尼比越小，意味着弹簧越细，弹簧越容易反弹</p><p id="5b37" class="ka kb lg kc b kd ke kf kg kh ki kj kk lh km kn ko li kq kr ks lj ku kv kw kx ig bi translated">把<code class="fe mm mn mo mp b">stiffness</code>想象成这个弹簧在被释放之前被拉伸了多长时间。这里的数字越大，刚度越大。</p></blockquote><p id="a26f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是时候把这些放在底部导航中了</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="0373" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我们首先创建一个数组<strong class="kc io"> BottomNavItem </strong>，它只是一个数据类。然后我们迭代它，并把它们放在可组合的<strong class="kc io">底部导航</strong>中，我们得到👇</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a86e5850faacdaa43b161344c7f5e2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/1*phR-HS5613-990pw6iXelA.gif"/></div></figure><p id="829a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">很好，但是好像少了点什么。<em class="lg">(动画栏)</em></p><p id="acce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您在第一个 gif 中看到的移动到所选项目顶部的栏将在我们的底部导航中，要将它移动到所选项目的顶部，我们需要知道项目何时被选中，我们还需要知道栏的正确位置。让我们看看怎么做。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="2147" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里对于动画栏，我们只是使用了一个高度为<code class="fe mm mn mo mp b">3 dp</code>宽度为<code class="fe mm mn mo mp b">100 dp</code>的盒子，当项目被选中时，我们会用动画将它偏移到正确的位置。</p><p id="4983" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，当第二个项目被选中时，默认情况下它将位于开始位置，并位于底部导航的中间。所以要知道中间在哪里，我们需要知道底部导航的宽度。</p><p id="5d02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">宽度由下式给出👇</p><pre class="kz la lb lc gt mq mp mr ms aw mt bi"><span id="a7ba" class="lk ll in mp b gy mu mv l mw mx">.<em class="lg">onGloballyPositioned </em><strong class="mp io">{<br/>    </strong>width = <strong class="mp io">it</strong>.size.width.toFloat()<br/><strong class="mp io">}</strong></span></pre><p id="e047" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还创建了一个浮动动画👇</p><pre class="kz la lb lc gt mq mp mr ms aw mt bi"><span id="1c57" class="lk ll in mp b gy mu mv l mw mx">val offsetAnim by <em class="lg">animateFloatAsState</em>(<br/>    targetValue = when (currentIndex) {<br/>        1 -&gt; width / 2f - <em class="lg">with</em>(<em class="lg">LocalDensity</em>.current)<strong class="mp io">{</strong>50.<em class="lg">dp</em>.<em class="lg">toPx</em>()<strong class="mp io">}<br/>        </strong>2 -&gt; width - <em class="lg">with</em>(<em class="lg">LocalDensity</em>.current)<strong class="mp io">{</strong>100.<em class="lg">dp</em>.<em class="lg">toPx</em>()<strong class="mp io">}<br/>        </strong>else -&gt; 0f<br/>    }<br/>)</span></pre><p id="54d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当项目被点击时，我们更新索引，更新动画的目标，因此我们在动画中看到了酒吧。</p><p id="4790" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢，祝你愉快😊</p></div></div>    
</body>
</html>