<html>
<head>
<title>K-Means Clustering for Mall Customer Segmentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">k-均值聚类在商场客户细分中的应用</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/k-means-clustering-for-mall-customer-segmentation-5dfd356fcd02?source=collection_archive---------3-----------------------#2022-10-27">https://blog.devgenius.io/k-means-clustering-for-mall-customer-segmentation-5dfd356fcd02?source=collection_archive---------3-----------------------#2022-10-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="1094" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Python 中聚类分析的快速指南</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b678db9df3ff43e76b7c910bf1f982f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v39D8wMsdi9DXmbU5SyLYw.png"/></div></div></figure><p id="5bd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> K-means 聚类</strong>是一种无监督学习技术，通过按特征而不是预定义的类别对未标记的数据进行分组来对其进行分类。变量 K 代表创建的组或类别的数量。目标是将数据分成 K 个不同的组，并报告每个组的质心位置。然后，可以基于封闭的质心为新的数据点分配一个聚类(类)。这种方法的最大优势是人类的偏见被排除在外。机器不是让研究人员创建分类组，而是根据经验证据而不是假设创建自己的聚类。</p><p id="4843" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用的数据集是干净的，就其大小而言很小。当然，这是一个虚拟的。因为数据集足够干净，所以分析可以快速完成。然而，原始比例尺数据并非如此，原始比例尺数据的复杂程度更高，并允许使用其他方法。</p><ol class=""><li id="c95b" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated"><strong class="jm io">加载数据集</strong></li></ol><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="6286" class="li lj in le b gy lk ll l lm ln">import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>from pandas.api.types import is_string_dtype, is_numeric_dtype</span><span id="9635" class="li lj in le b gy lo ll l lm ln"><em class="lp"># set max cullumns to none<br/></em>pd.set_option("display.max_columns",None)</span><span id="d789" class="li lj in le b gy lo ll l lm ln"><em class="lp"># set colwidth high<br/></em>pd.set_option("display.max_colwidth",100)</span><span id="2c5a" class="li lj in le b gy lo ll l lm ln"><em class="lp"># missing values<br/></em>import missingno as msno<br/><em class="lp"># (EDA) importing sweetviz<br/></em>import sweetviz as sv</span><span id="3869" class="li lj in le b gy lo ll l lm ln">from sklearn.cluster import KMeans<br/>from sklearn.metrics import silhouette_samples, silhouette_score<br/>import matplotlib.pyplot as plt<br/>import matplotlib.cm as cm<br/>import numpy as np<br/>import matplotlib.style as style<br/>from sklearn import metrics<br/>from yellowbrick.cluster import KElbowVisualizer</span><span id="8f67" class="li lj in le b gy lo ll l lm ln">dataset = pd.read_csv('Mall_Customers.csv')</span><span id="3425" class="li lj in le b gy lo ll l lm ln">df = dataset.copy()<br/>df.info()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/5776a8f0f0d344b7e1ed691b0fb46dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*JLx965-zQjyihLTs0Pm9_w.png"/></div></figure><p id="41e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 2。EDA(探索性数据分析)</strong></p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="9a51" class="li lj in le b gy lk ll l lm ln"><em class="lp">#analyzing the dataset</em></span><span id="63b2" class="li lj in le b gy lo ll l lm ln">advert_report = sv.analyze(df)</span><span id="a3b6" class="li lj in le b gy lo ll l lm ln"><em class="lp">#display the report</em></span><span id="61c7" class="li lj in le b gy lo ll l lm ln">advert_report.show_html('Mall_clustering.html')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lr"><img src="../Images/86a59e2e3d12bac6f39f88e0cc3e20d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3R1KQ64ofL1FVg_qJbydQ.png"/></div></div></figure><p id="a487" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一种方法是使用 Sweetfiz 库快速浏览所有数据。</p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="8b48" class="li lj in le b gy lk ll l lm ln">#to look at the sumirize<br/>df.describe()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ls"><img src="../Images/73ad967aacee2e7baa15a2c14251f304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijorke2eqToWqszAot9y5g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/92e9f874a9eac2d8e27bcc32151d98a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ba5a2FGPjkdbLfavK1DGw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/9cba270b412e32f4e4b24c281c2dbc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kFwTBjNUzgyZ3q-dQeMygA.png"/></div></div></figure><p id="b021" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 3。数据预处理</strong></p><p id="546a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">既然我们已经定义了目标并对数据有了更好的理解，我们需要对数据进行预处理以满足模型需求。<br/>标准 k 均值算法不能直接应用于分类数据。更具体地说，分类变量(例如，本例中的性别)的搜索空间是离散的(男性或女性)，因此不能直接与连续空间组合并以同样的方式进行测量。因此，我删除了“性别”和“客户 ID”字段。</p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="ecb0" class="li lj in le b gy lk ll l lm ln">df1 = df [['Age','Annual Income (k$)','Spending Score (1-100)']]</span><span id="a95c" class="li lj in le b gy lo ll l lm ln">df1.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/6a4dc5759fa7d0bb72da5b814657e8af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*9aDYF05iKzHt5HmLAC4POQ.png"/></div></figure><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="2b99" class="li lj in le b gy lk ll l lm ln">sns.kdeplot(df1['Spending Score (1-100)'])<br/>sns.kdeplot(df1['Annual Income (k$)'])<br/>sns.kdeplot(df1['Age'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/0cde9e13a14d16caef81663137c1cd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKM3u7TklL4OIBxmOt_YmA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7ceb4c6154558e140144dddd9245a54c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWCsI0byG_PaI-nHMfz8eQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/f843f9af77e2cecff1e8db5f74d218be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NtFbjWN_X4mdKF1GKFcpQ.png"/></div></div></figure><p id="ddac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从前面的单变量分析中我们可以看出，这些变量既不符合正态分布，也不符合法律分布。因此，我使用 MinMaxScaler 将数据范围缩小到 0 到 1 之间，同时保持分布形状。</p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="3e5f" class="li lj in le b gy lk ll l lm ln">from sklearn.preprocessing import MinMaxScaler, StandardScaler</span><span id="d810" class="li lj in le b gy lo ll l lm ln">df1['Age_std'] = StandardScaler().fit_transform(df1['Age'].values.reshape(len(df1), 1))</span><span id="563f" class="li lj in le b gy lo ll l lm ln">df1['Annual Income_std'] = StandardScaler().fit_transform(df1['Annual Income (k$)'].values.reshape(len(df1), 1))</span><span id="21cf" class="li lj in le b gy lo ll l lm ln">df1['Spending Score (1-100)_std'] = StandardScaler().fit_transform(df1['Spending Score (1-100)'].values.reshape(len(df1), 1))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/232f43f7c0bd2db59ba7dc7e57120be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFUMSmJCpUZDACBxzoXfUw.png"/></div></div></figure><p id="f5d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 4。k-均值聚类</strong></p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="f3b1" class="li lj in le b gy lk ll l lm ln">from sklearn.cluster import KMeans<br/>X = df1<br/><em class="lp"># X = dataset_scaled[numerical_features].copy()<br/></em>inertia = []</span><span id="2ed5" class="li lj in le b gy lo ll l lm ln">for i in range(2, 20):<br/>kmeans = KMeans(n_clusters=i, random_state=42)<br/>kmeans.fit(X.values)<br/>inertia.append(kmeans.inertia_)<br/>print(inertia)<br/>plt.figure(figsize=(20, 10))<br/>plt.title('Elbow Method of K-means Clustering')</span><span id="9355" class="li lj in le b gy lo ll l lm ln"><em class="lp"># plt.plot(inertia)</em></span><span id="443d" class="li lj in le b gy lo ll l lm ln">sns.lineplot(x=range(2, 20), y=inertia, color='#000087', linewidth = 4)</span><span id="54e6" class="li lj in le b gy lo ll l lm ln">sns.scatterplot(x=range(2, 20), y=inertia, s=300, color='#800000',  linestyle='--')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/f786978994c70011df8a5728d65e7893.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*2MambIhOgwXMa32Js3_Uyw.png"/></div></figure><p id="9904" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我采取了不同的方法，因为集群的数量“K”仍然是不可见的，我仍然不确定。</p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="5880" class="li lj in le b gy lk ll l lm ln"><em class="lp"># Import ElbowVisualizer<br/></em>model = KMeans(n_clusters=i, random_state=42)</span><span id="ff8a" class="li lj in le b gy lo ll l lm ln"><em class="lp"># k is range of number of clusters.<br/></em>visualizer = KElbowVisualizer(model, k=(2,20), timings= True)<br/>visualizer.fit(X.values)        <em class="lp"># Fit data to visualizer<br/></em>visualizer.show()        <em class="lp"># Finalize and render figure</em></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/0b466374512820d874bab47336394148.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*x29_0nokAJeUNp8Gc1RCTQ.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">字母“K”可以在这里的第 6 组中看到。</figcaption></figure><p id="101d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为 EDA 过程的结果，我们在图表中发现了几个不同的集群。让我们仔细看看该模型是否能如预期的那样将客户细分为不同的细分市场。代码类似于上面的代码，比例年收入与比例支出分数。</p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="4ff8" class="li lj in le b gy lk ll l lm ln"><em class="lp"># Spending vs. Age vs. Annual Income by different number of clusters</em></span><span id="0a9c" class="li lj in le b gy lo ll l lm ln">X3_inertia_values = []<br/>X3_silhouette_scores = []<br/>fig = plt.figure(figsize=(15,15))</span><span id="45d7" class="li lj in le b gy lo ll l lm ln">for i in range (2,11):<br/>X3_inertia, X3_label, X3_centroids, X3_silhouette = KMeans_Algorithm(X3, i)<br/>X3_inertia_values.append(X3_inertia)<br/>X3_silhouette_scores.append(X3_silhouette)<br/>centroids_df = pd.DataFrame(X3_centroids, columns =['X', 'Y', 'Z'])<br/>ax = fig.add_subplot(330 + i - 1, projection='3d')<br/>ax.scatter(df1["Age_std"],df1["Annual Income_std"],df1["Spending Score (1-100)_std"], s = 30, c = df1["label"], cmap = "viridis")<br/>ax.scatter(centroids_df['X'], centroids_df['Y'], centroids_df['Z'], s = 90, marker= ",", color = "r")<br/>ax.set_xlabel("Age")<br/>ax.set_ylabel("Annual Income(k$)")<br/>ax.set_zlabel("Spending Score (1-100)")</span><span id="acd2" class="li lj in le b gy lo ll l lm ln"><em class="lp"># plot inertia values against number of clusters<br/></em>plt.figure(11 , figsize = (15 ,6))<br/>plt.plot(np.arange(2 , 11) , X3_inertia_values , '-')<br/>plt.xlabel("Number of Clusters")<br/>plt.ylabel("Inertia Values")</span><span id="8665" class="li lj in le b gy lo ll l lm ln"><em class="lp"># plot inertia values against number of cluster<br/></em>plt.figure(12, figsize=(15,6))<br/>plt.plot(np.arange(2,11) , X3_silhouette_scores, '-')<br/>plt.xlabel("Number of Clusters")<br/>plt.ylabel("Silhouette Score")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi me"><img src="../Images/205d2b5c014c646c0f479015970e78bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*dXN-Pb8XGCdrPiLhN2UCNA.png"/></div></figure><p id="0a12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 5。数据集的实现</strong></p><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="c815" class="li lj in le b gy lk ll l lm ln">from sklearn.cluster import KMeans</span><span id="dda5" class="li lj in le b gy lo ll l lm ln">kmeans = KMeans(n_clusters=6, random_state=42)<br/>kmeans.fit(X)<br/>X['cluster'] = kmeans.labels_<br/>df['cluster'] = kmeans.labels_</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/776b79d2cd3288fea728de8babf2bd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*EG33GOR-_jl3ZO_ZAIVnzQ.png"/></div></figure><pre class="kj kk kl km gt ld le lf lg aw lh bi"><span id="2417" class="li lj in le b gy lk ll l lm ln">df.groupby('cluster')['Age','Annual Income (k$)','Spending Score (1-100)'].describe()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/37c37afc436b90a3d8498cf320558dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eATMJekhXK089m2gI-JvjA.png"/></div></div></figure><p id="8f01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在“K”之后，下一个分类将“cluster”应用于它所拥有的数据集。可以看出，群组 3 的年收入最高，但支出得分最低，尽管其平均年龄为 41 岁。而聚类 5，平均年收入 25，消费分高达 79，平均年龄 22 岁，则成反比。如果我们看上面的条形图，它显示了集群数量的分布，我们可以看到集群 2 有 44 个，集群 0 和 5 有 22 个。第二类对年收入的贡献平均为 53。最高 67，最低 38。支出得分平均为 49，最高为 60，最低为 35。很明显，经常购物和光顾的大多数购物中心顾客属于第二类，也就是中产阶级，他们只在平均消费分数为 55 分和高消费分数的地方购物。</p></div></div>    
</body>
</html>