<html>
<head>
<title>SQL: Injection Attack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL:注入攻击</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sql-injection-attack-9d4e8077905?source=collection_archive---------5-----------------------#2022-11-29">https://blog.devgenius.io/sql-injection-attack-9d4e8077905?source=collection_archive---------5-----------------------#2022-11-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fc4a102b9cf6bc507b02b8d29bbdcc4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KgPBOeSCwnCVuMiG.png"/></div></div></figure><h1 id="e2e3" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">什么是 SQL 注入？</strong></h1><blockquote class="kt ku kv"><p id="d463" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">SQLi 是基于 web 的应用程序中的一种攻击，攻击者可以在网站的数据库中运行恶意查询。SQL 是一种用于执行恶意 SQL 语句的代码注入技术。</p></blockquote><p id="592c" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">例如，如果您想登录网站，但忘记了用户名和密码，通过使用 SQLi 注入，我们可以在不知道密码的情况下登录或访问网页。</p><h1 id="b872" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">SQL 注入是如何工作的？</strong></h1><p id="20cb" class="pw-post-body-paragraph kw kx in kz b la ly lc ld le lz lg lh lv ma lk ll lw mb lo lp lx mc ls lt lu ig bi translated">SQL 注入包含在应用程序中通过来自客户端的输入数据插入或注入 SQL 查询。这些被注入到影响预定义 SQL 命令的数据平面中。</p><p id="d9d5" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">SQL 注入攻击的目标是动态 SQL 语句中的漏洞。将动态 SQL 语句想象成一个多元数学函数，它的参数是固定的，而结果是由独立变量中的值决定的。</p><p id="aa66" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">类似地，动态 SQL 语句也由一组预定义的参数(如 web 表单)组成，只有当用户提供输入时，才会生成完整的语句。</p><p id="1766" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">请参见以下登录表单的 SQL 语句示例:</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="80d7" class="mm jw in mi b be mn mo l mp mq">SELECT * FROM users WHERE username = '$username' AND password = bcrypt ('$password')</span></pre><p id="fcfa" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">当用户输入用户名和密码时，语句完成。然后向服务器发送一个查询，从数据库中检索用户信息。</p><p id="ca97" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">如果动态 SQL 语句中存在漏洞，攻击者可以在表单中输入复杂的脚本来破坏现有参数并改变整个语句的含义。</p><h1 id="c5c1" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">SQL 注入类型:</strong></h1><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/98db85626dacb0fee05406ce41e67394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1h3FcCXRUUGmUhrz3WBtQ.png"/></div></div></figure><p id="730b" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><strong class="kz io">带内 SQLi: </strong>带内 SQL 注入是一种 SQL 注入，攻击者通过相同的通信信道接收结果作为直接响应。例如，如果攻击者通过她的 web 浏览器手动发起攻击，攻击的结果将显示在同一个 web 浏览器中。带内 SQL 注入也被称为传统 SQL 注入。</p><blockquote class="kt ku kv"><p id="8d8f" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">基于错误的 SQL 注入— <strong class="kz io"> <em class="in"> </em> </strong>在这里，攻击者执行某些操作，导致数据库生成错误消息。您可以使用错误消息来确定正在使用的数据库、处理程序正在使用的服务器版本等。</p><p id="467a" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="kz io">基于联合的 SQL 注入— </strong>由数据库生成的语句，用于获取单个 HTTP 响应。您可以在 URL 中构造查询，或者在输入字段中组合多个语句来尝试生成答案</p></blockquote><p id="b0d7" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><strong class="kz io">盲 SQLi : </strong>盲 SQL 注入是一种 SQL 注入，在这种情况下，攻击者不会从被攻击的数据库获得明确的响应，而是观察数据库服务器和应用程序的行为，以逐步重建数据库结构。盲人 SQL 注入也被称为推理 SQL 注入。</p><blockquote class="kt ku kv"><p id="129e" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">基于布尔的— <strong class="kz io"> </strong>在这里，攻击者向数据库发送一个 SQL 查询，并根据查询返回的是真还是假，要求应用程序返回不同的结果。</p><p id="3ad4" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">基于时间—在这种攻击中，攻击者向数据库提交 SQL 查询，并使数据库在共享结果之前等待指定的时间。响应时间有助于攻击者确定查询是真还是假。</p></blockquote><p id="6b4b" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><strong class="kz io">带外 SQLi: </strong>带外 SQL 注入(OOB SQLi)是一种 SQL 注入，在这种情况下，攻击者不会通过相同的通信信道收到来自被攻击应用程序的响应，但可以被诱骗向攻击者控制的远程端点发送数据。仅当您使用的服务器具有触发 DNS 或 HTTP 请求的命令时，带外 SQL 注入才是可能的。然而，这适用于所有流行的 SQL 服务器。</p><h1 id="7ef8" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">SQLi 的例子</strong></h1><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/6e9105456824dc39f745cd76878baf71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sZm3DdUShCPaw8Ez.png"/></div></div></figure><p id="5662" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">第一个例子非常简单。它展示了攻击者如何利用 SQL 注入漏洞绕过应用程序安全并以管理员身份进行身份验证。</p><p id="1f76" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">以下脚本是在 web 服务器上执行的伪代码。这是一个使用用户名和密码进行身份验证的简单示例。示例数据库有一个名为<code class="fe mt mu mv mi b">users</code>的表，包含以下几列:<code class="fe mt mu mv mi b">username</code>和<code class="fe mt mu mv mi b">password</code>。</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="e037" class="mm jw in mi b be mn mo l mp mq"># Define POST variables<br/>uname = request.POST['username']<br/>passwd = request.POST['password']<br/><br/># SQL query vulnerable to SQLi<br/>sql = “SELECT id FROM users WHERE username=’” + uname + “’ AND password=’” + passwd + “’”<br/><br/># Execute the SQL statement<br/>database.execute(sql)</span></pre><p id="dac6" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">这些输入字段容易受到 SQL 注入的攻击。攻击者可以在输入中使用 SQL 命令，从而改变数据库服务器执行的 SQL 语句。例如，他们可以使用包含单引号的技巧，将<code class="fe mt mu mv mi b">passwd</code>字段设置为:</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="a9fc" class="mm jw in mi b be mn mo l mp mq">password' OR 1=1</span></pre><p id="3e09" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">因此，数据库服务器运行以下 SQL 查询:</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="65a1" class="mm jw in mi b be mn mo l mp mq">SELECT id FROM users WHERE username='username' AND password='password' OR 1=1'</span></pre><p id="c884" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">因为有了<code class="fe mt mu mv mi b">OR 1=1</code>语句，不管<code class="fe mt mu mv mi b">username</code>和<code class="fe mt mu mv mi b">password</code>是什么，<code class="fe mt mu mv mi b">WHERE</code>子句都从<code class="fe mt mu mv mi b">users</code>表中返回第一个<code class="fe mt mu mv mi b">id</code>。数据库中的第一个用户<code class="fe mt mu mv mi b">id</code>通常是管理员。这样，攻击者不仅绕过了身份验证，还获得了管理员权限。他们还可以注释掉 SQL 语句的其余部分，以进一步控制 SQL 查询的执行:</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="3e65" class="mm jw in mi b be mn mo l mp mq">-- MySQL, MSSQL, Oracle, PostgreSQL, SQLite<br/>' OR '1'='1' --<br/>' OR '1'='1' /*<br/>-- MySQL<br/>' OR '1'='1' #<br/>-- Access (using null characters)<br/>' OR '1'='1' %00<br/>' OR '1'='1' %16</span></pre><h1 id="d230" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">如何防止 SQL 注入？</strong></h1><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="ab gu cl mw"><img src="../Images/31573030d1a65a61fbd5e375cc6c1f55.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b31hiO4ynbDLRrXWEFF4aQ.png"/></div></figure><p id="a93d" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">组织可以应用以下策略来防范 SQL 注入攻击。</p><ol class=""><li id="feaf" class="mx my in kz b la lb le lf lv mz lw na lx nb lu nc nd ne nf bi translated">永远不要相信用户的输入。在动态 SQL 语句中使用它们之前，应该对它们进行清理。<br/>存储过程—允许您封装 SQL 语句并将所有输入视为参数。</li><li id="bf06" class="mx my in kz b la ng le nh lv ni lw nj lx nk lu nc nd ne nf bi translated"><strong class="kz io">准备好的语句— </strong>准备好的语句首先构建一条 SQL 语句，然后将提交的用户数据作为参数进行处理。这不会影响 SQL 语句的语法。<br/>正则表达式—可用于检测潜在的恶意代码，并在执行 SQL 语句之前将其删除。</li><li id="4ffa" class="mx my in kz b la ng le nh lv ni lw nj lx nk lu nc nd ne nf bi translated"><strong class="kz io">数据库连接用户权限— </strong>用于连接数据库的帐户应仅被授予必要的权限。这有助于降低服务器上 SQL 语句的性能。</li><li id="e96f" class="mx my in kz b la ng le nh lv ni lw nj lx nk lu nc nd ne nf bi translated"><strong class="kz io">错误消息— </strong>这些消息不会泄露敏感信息或错误的确切位置。“抱歉，出现了技术错误。我已经联系了技术团队。稍后再试”而不是显示导致错误的 SQL 语句。</li></ol><p id="79fd" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><strong class="kz io"/>防止 SQL 注入<strong class="kz io">攻击</strong>的唯一方法是<strong class="kz io">设置</strong>输入<strong class="kz io">验证。</strong>这意味着<strong class="kz io">用户输入的输入应该</strong>被监控和清理，以过滤掉<strong class="kz io">潜在的</strong>恶意<strong class="kz io">代码。</strong></p><p id="df01" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">这正是 web 应用防火墙(WAF)所做的。<strong class="kz io">分析</strong>所有<strong class="kz io">用户输入到您的</strong> web 应用<strong class="kz io">中的</strong>与可疑<strong class="kz io">代码的匹配。</strong></p><p id="3b39" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated">参考资料:</p><p id="080f" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><a class="ae nl" href="https://learn.microsoft.com/en-us/sql/relational-databases/security/sql-injection?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">https://learn . Microsoft . com/en-us/SQL/relational-databases/security/SQL-injection？view=sql-server-ver16 </a></p><p id="a071" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><a class="ae nl" href="https://systemweakness.com/sql-injection-attacks-53e942aae1f8" rel="noopener ugc nofollow" target="_blank">https://system weakness . com/SQL-injection-attacks-53e 942 ae1 f 8</a></p><p id="31f8" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><a class="ae nl" href="https://qawerk.com/blog/what-is-sql-injection/" rel="noopener ugc nofollow" target="_blank">https://qawerk.com/blog/what-is-sql-injection/</a></p><p id="3a32" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lv lj lk ll lw ln lo lp lx lr ls lt lu ig bi translated"><a class="ae nl" href="https://brightsec.com/blog/sql-injection-attack/" rel="noopener ugc nofollow" target="_blank">https://brightsec.com/blog/sql-injection-attack/</a></p><h1 id="bd62" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">也看看我的博客:</strong></h1><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/comparison-inheritance-and-polymorphism-12064ce8a5aa"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">比较遗传和多态性</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">继承:</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">blog.devgenius.io</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od jt np"/></div></div></a></div></div></div>    
</body>
</html>