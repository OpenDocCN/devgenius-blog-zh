<html>
<head>
<title>C++ Operator Overloading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++运算符重载</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/c-operator-overloading-bdd35d41a376?source=collection_archive---------5-----------------------#2020-09-09">https://blog.devgenius.io/c-operator-overloading-bdd35d41a376?source=collection_archive---------5-----------------------#2020-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5985" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过重载运算符创建可读性更强的代码</h2></div><p id="799e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">C++的一个经常被忽视的特性是运算符重载。这是一个其他编程语言都不支持的特性。但在很多情况下，它是极其有用和强大的。运算符重载最常见的领域是自定义数学类。C++没有内置的 vector 或 matrix 类，所以您可能要创建自己的类。假设你想把两个向量相加。如果没有操作符重载，它会是这样的<code class="fe lb lc ld le b">vec3 c = vec3::add( a , b );</code>。然而，通过重载<code class="fe lb lc ld le b">+</code>操作符，你可以简单地写成这样的<code class="fe lb lc ld le b">vec3 c = a + b;</code>。尤其是对于较长的表达式，当它是用重载操作符而不是大量嵌套函数编写时，阅读和理解起来要容易得多。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/8728508d5652e6a4cb1492ee351780a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FVGPMN66Q3yJzP2C"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">凯利·西克玛在<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="e5df" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">运算符重载</h1><p id="5d26" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">重载操作符非常容易。你可以把一个操作符想象成一个普通的函数，它有一个返回值和一些参数。它不使用函数名，而是使用特殊的<code class="fe lb lc ld le b">operator</code>关键字，后跟您想要重载的操作符，如<code class="fe lb lc ld le b">+</code>或<code class="fe lb lc ld le b">-</code>。下面是一个带有一些重载运算符的 vector 类示例:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">带有一些重载操作符的 vec3 类示例。</figcaption></figure><p id="1313" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了像<code class="fe lb lc ld le b">+</code>、<code class="fe lb lc ld le b">-</code>、<code class="fe lb lc ld le b">*</code>、<code class="fe lb lc ld le b">/</code>和<code class="fe lb lc ld le b">%</code>这样的标准算术运算符之外，您还可以重载许多其他运算符:<code class="fe lb lc ld le b">^ &amp; | ~ ! = &lt; &gt; += -= *= /= %= ^= &amp;= |= &lt;&lt; &gt;&gt; &gt;&gt;= &lt;&lt;= == != &lt;= &gt;= &lt;=&gt; &amp;&amp; || ++ -- , -&gt;* -&gt; ( ) [ ]</code>。特别是重载<code class="fe lb lc ld le b">&lt;&lt;</code>操作符对你自己的类很有用，所以可以直接用<code class="fe lb lc ld le b">std::cout</code>打印出来。</p><p id="3505" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您甚至可以重载内存分配操作符<code class="fe lb lc ld le b">new</code>、<code class="fe lb lc ld le b">new[]</code>、<code class="fe lb lc ld le b">delete</code>和<code class="fe lb lc ld le b">delete[]</code>。可以跟踪所有分配的内存，并通过这种方式找到内存泄漏，尽管这有点复杂。</p><h1 id="6418" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">优势</h1><p id="fecf" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">重载操作符的最大优点是方便和清晰。这不仅大大减少了输入，而且特别是对于需要多个运算符的较长方程，当用运算符而不是大量嵌套函数编写时，人类解析起来要容易得多。OpenGL 中一个非常常见的计算是 MVP 矩阵(模型视图投影)，它是三个矩阵的乘积。下面是使用 JavaScript 的 WebGL 和使用 C++的 OpenGL 的比较:</p><p id="5a7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">JS: var M_mvp = mat4.multiply( M_projection , mat4.multiply( M_view , M_model ) );</code></p><p id="7762" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">C++: mat4 M_mvp = M_projection * M_view * M_model;</code></p><p id="568f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您所看到的，理解 C++解决方案在做什么比用 JavaScript 方式解析嵌套函数要容易得多。这是一个相当小的方程，在很多情况下甚至会用到更长的方程。</p><p id="41e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运算符实现更优越的另一个原因是数学的书写和教授方式。你在网上或者书上查一道数学题，所有的方程都是用算子写的。因此，直接使用操作符实现它们要简单得多，而不必创建复杂的功能树。书中的方程和你的代码看起来完全一样，很容易发现错误。</p><p id="8d9d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，当一个新的程序员正在使用你的代码，并且你的操作符被正确地实现时，它们可以像预期的那样被使用。在最好的情况下，当仅仅使用普通的操作符已经完成了您正在寻找的工作时，就不需要查阅任何文档了。</p><h1 id="5d46" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">不足之处</h1><p id="a44e" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">运算符重载并没有什么大的缺点。您可以做一些违反直觉的事情，比如重载<code class="fe lb lc ld le b">+</code>操作符，让它做减法，但是您也可以创建一个名为<code class="fe lb lc ld le b">add</code>的函数来做减法，所以这不是操作符特有的问题。</p><p id="5868" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果性能非常关键，由于实现方式的原因，一些操作符重载比优化的解决方案稍慢。因为<code class="fe lb lc ld le b">vec3</code> <code class="fe lb lc ld le b">+</code>操作符返回一个新的<code class="fe lb lc ld le b">vec3</code>对象，所以需要一些内存分配，有点慢。当您将它与直接处理引用的函数比较时，它是可测量的，但是它只慢了百分之几，所以对于所有正常的用例来说，这不是问题。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="222a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你想到 C++时，首先想到的并不是运算符重载。它甚至可能不在前 5 名之列。但在我看来，这个特性被低估了，而且在很多情况下都非常有用。它让许多数学等式变得非常容易阅读和理解，并在其他领域提供了很多有用的东西。每当我使用一种不同的编程语言时，这是我最怀念的事情之一。经常使用 C++时，运算符重载是工具箱中非常棒的工具，只要适用，您就应该使用它。</p></div></div>    
</body>
</html>