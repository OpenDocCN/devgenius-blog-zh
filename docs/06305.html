<html>
<head>
<title>Spring Cloud annotations simplified</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化的弹簧云注释</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/spring-cloud-useful-annotations-and-explanation-that-are-worth-knowing-for-developing-microservices-4e0ec2339062?source=collection_archive---------1-----------------------#2021-12-29">https://blog.devgenius.io/spring-cloud-useful-annotations-and-explanation-that-are-worth-knowing-for-developing-microservices-4e0ec2339062?source=collection_archive---------1-----------------------#2021-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="64f0" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">春云|微服务</h2><div class=""/><div class=""><h2 id="b3bc" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">Spring Cloud 有很有用的注解，值得开发微服务的人了解。</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b78d0c1c35d8bbe76e6a831b393a1f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQxAIziezQJLleMx1-MjSw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">背景图片由<a class="ae lb" href="https://unsplash.com/@themick79i?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">米克·德·保拉</a>在<a class="ae lb" href="https://unsplash.com/s/photos/cloud-computing?  utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1ae2" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">Spring Cloud module 是原始 Spring 框架的一个巨大扩展，它为开发人员提供了在分布式系统中快速构建一些常见模式的工具，例如服务发现、断路器、智能路由、控制总线、令牌等。</p><p id="0dfb" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">就像 Spring Boot 一样，Spring Cloud 也有一些有用的注释，值得 Spring Cloud 开发人员了解。</p><h2 id="07a4" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated">EnableConfigServer</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用@EnableConfigServer</figcaption></figure><p id="d6b4" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"> @EnableConfigServer </strong>是类级注释。它帮助 Spring Cloud Config Server 非常容易地嵌入到 Spring Boot 应用程序中，并且<strong class="le ix">@ EnableConfigServer<em class="ms"/></strong>注释使 Spring Boot 应用程序充当配置服务器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/2dd2ac32cef79e35ba55139f65a2983c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PtqdM49qgQomEIYkWs3eGA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">尤里卡</figcaption></figure><h2 id="c673" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated"><strong class="ak"> EnableEurekaServer </strong></h2><p id="0ba5" class="pw-post-body-paragraph lc ld in le b lf mu jx lh li mv ka lk ll mw ln lo lp mx lr ls lt my lv lw lx ig bi translated">在大型应用程序中，我们可能有许多应该协同工作的微服务。这些服务可能有不同的服务器地址。所以现在我们面临一个严重的问题，那就是服务之间如何对话。一个简单的方法可能是在使用 RestTemplate 或 WebClient 调用时硬编码所有服务地址，包括端口。</p><p id="d600" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">但是它认为这是一种不好的做法，因为一个服务可能有多个使用不同地址运行的实例，所以在这种情况下，我们如何知道要连接哪些实例。</p><p id="31bb" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">为了解决这类具体问题，我们可以通过<strong class="le ix"> Eureka </strong>使用<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/service-discovery-importance-in-microservices-17970569685"> <strong class="le ix">服务发现</strong> </a>。</p><div class="mz na gp gr nb nc"><a rel="noopener  ugc nofollow" target="_blank" href="/service-discovery-importance-in-microservices-17970569685"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ix gy z fp nh fr fs ni fu fw iw bi translated">什么是服务发现&amp;为什么它在微服务中很重要？</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">什么是服务发现及其在微服务中的重要性</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">blog.devgenius.io</p></div></div><div class="nl l"><div class="nm l nn no np nl nq kv nc"/></div></div></a></div><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@EnableEurekaServer 的使用</figcaption></figure><p id="5c77" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们可以通过用<strong class="le ix"> @EnableEurekaServer <em class="ms">注释一个类，将 Spring Boot 应用程序转换成<strong class="le ix"> Eureka </strong>服务器。现在我们可以使用这个服务器来查看其他的 Eureka 客户端服务来管理它们。服务必须注册到此服务器。</em></strong></p><h2 id="b1a8" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated">EnableEurekaClient</h2><p id="b77d" class="pw-post-body-paragraph lc ld in le b lf mu jx lh li mv ka lk ll mw ln lo lp mx lr ls lt my lv lw lx ig bi translated">如果服务/客户端没有用来自<code class="fe nr ns nt nu b">spring-cloud-netflix</code> <strong class="le ix"> <em class="ms">的<strong class="le ix">@ EnableEurekaClient<em class="ms"/></strong>进行注释，尤里卡服务器就无法找到其他服务/客户端。</em> </strong>我们要向服务器注册的每个服务都要用<strong class="le ix">@ EnableEurekaClient<em class="ms"/></strong>注释。它是类级别的注释。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@EnableEurekaClient 的使用</figcaption></figure><h2 id="1d59" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated"><strong class="ak">启用发现客户端</strong></h2><p id="ebc1" class="pw-post-body-paragraph lc ld in le b lf mu jx lh li mv ka lk ll mw ln lo lp mx lr ls lt my lv lw lx ig bi translated">来自<code class="fe nr ns nt nu b">spring-cloud-commons</code>的<strong class="le ix"><em class="ms">@ EnableDiscoveryClient</em></strong>与<strong class="le ix"><em class="ms">@ EnableEurekaClient</em></strong>相同，但它是“发现服务”的更通用的实现。</p><p id="38d5" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"><em class="ms">@ enableeureka client</em></strong>仅适用于尤里卡，而<strong class="le ix"><em class="ms">@ EnableDiscoveryClient</em></strong>适用于<strong class="le ix">尤里卡</strong>、<strong class="le ix">领事</strong>、<strong class="le ix">动物园管理员</strong>。但是如果 Eureka 在<strong class="le ix">应用程序类路径</strong>上，它们实际上就是<strong class="le ix">相同的</strong>。</p><h2 id="ba96" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated">启用电路断路器</h2><p id="1cd1" class="pw-post-body-paragraph lc ld in le b lf mu jx lh li mv ka lk ll mw ln lo lp mx lr ls lt my lv lw lx ig bi translated">假设在电影租赁应用程序中，我们有三个微服务:MovieCatalogService、MovieRatingService 和 MovieOrderService。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@EnableCircuitBreaker 的用法</figcaption></figure><p id="cdb5" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">并且，这些微服务需要相互交互来处理用户的请求。例如，MovieOrderService 可以调用 MovieCatalogService 和 MovieRatingService 来显示电影名称(来自 MovieCatalogService)和电影分级(来自 MovieRatingService)以及在电影租赁过程中向用户显示的订单(来自 MovieOrderService)。</p><p id="7670" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">假设由于某种原因(网络错误或过载), MovieCatalogService 完全失败并停止为请求提供服务。因此，整个生态系统将由于这种单点故障而变得不稳定。</p><p id="53ee" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在这种情况下，断路器模式就派上了用场。一旦发现任何此类情况，它会将流量重定向到回退路径。<strong class="le ix">@ EnableCircuitBreaker<em class="ms"/></strong>是一个类级别的注释，我们需要将这个注释应用到您的应用程序的每一个服务中。</p><p id="6d23" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">有许多<strong class="le ix"> </strong>工具(<a class="ae lb" href="https://github.com/Netflix/Hystrix" rel="noopener ugc nofollow" target="_blank">网飞 Hystrix </a>、<a class="ae lb" href="https://github.com/resilience4j/resilience4j" rel="noopener ugc nofollow" target="_blank"> Resilience4J </a>、<a class="ae lb" href="https://github.com/alibaba/Sentinel" rel="noopener ugc nofollow" target="_blank"> Sentinel </a>、<a class="ae lb" href="https://github.com/spring-projects/spring-retry" rel="noopener ugc nofollow" target="_blank"> Spring Retry </a>)可用于在春季实现断路器模式。但在本帖中，我们将讨论<a class="ae lb" href="https://github.com/Netflix/Hystrix" rel="noopener ugc nofollow" target="_blank">网飞·海斯特里克斯</a>的常见注释。</p><h2 id="7a3d" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated"><strong class="ak">EnableHystrix&amp;EnableHystrix dashboard</strong></h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@EnableHystrixDashboard 的使用</figcaption></figure><p id="6495" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"> @EnableHystrix </strong>是可选的。<strong class="le ix">@ EnableCircuitBreaker<em class="ms"/></strong>将在类路径中扫描任何兼容的断路器实现，如果<strong class="le ix"> Hystrix </strong>在类路径中，那么我们不需要显式启用<strong class="le ix"> Hystrix。</strong></p><p id="8a53" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix">@ EnableHystrixDashboard</strong>增加了一个有用的仪表板，运行在 Hystrix 提供的 localhost 上，用于监控其状态。</p><h2 id="db5f" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated">hystrix 命令</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@ hystrix 命令的使用</figcaption></figure><p id="ec2c" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们启用了具有相同签名的回退方法<strong class="le ix">@ hystrix command(fallback method = " getMovieOrdersFallback ")</strong>。现在，如果实际的电影订购服务由于某种原因关闭，将调用 fallback 方法。</p><h2 id="8931" class="ly lz in bd ma mb mc dn md me mf dp mg ll mh mi mj lp mk ml mm lt mn mo mp it bi translated">负载平衡</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用@LoadBalanced</figcaption></figure><p id="f5c3" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"><em class="ms">@ load balanced</em></strong>是一个标记标注。用于指示<strong class="le ix"> RestTemplate </strong>或<strong class="le ix"> WebClient </strong>应该使用<strong class="le ix">RibbonLoadBalancerClient</strong>或<strong class="le ix"> LoadBalancerClient </strong>与服务进行交互。反过来，这允许你为我们传递给<strong class="le ix"> RestTemplate </strong>或<strong class="le ix"> WebClient </strong>的 URL 使用“逻辑标识符”。这些逻辑标识符通常是在服务发现中注册的服务的名称。</p><p id="4ce2" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="ms">注</em>:-<strong class="le ix">@ ribbon client(</strong>spring-cloud-starter-网飞-ribbon <strong class="le ix"> ) </strong>和<strong class="le ix">@ LoadBalancerClient</strong>(spring-cloud-commons)可选。这既可以作为客户端的负载平衡器，又可以让我们控制 HTTP 和 TCP 客户端。如果我们使用服务发现，那么我们可以使用默认设置。我们不需要显式地使用这些注释。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">@ ribbon client/@ LoadBalancerClient 的使用</figcaption></figure><p id="11f3" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">但是如果我们没有使用任何服务发现或者需要为特定的客户端定制<strong class="le ix"> Ribbon </strong>或<strong class="le ix"> LoadBalancer </strong>的设置，那么我们需要使用这两个中的任何一个。</p><ul class=""><li id="a217" class="nv nw in le b lf lg li lj ll nx lp ny lt nz lx oa ob oc od bi translated"><code class="fe nr ns nt nu b">name</code> -我们称之为 Ribbon 或 LoadBlancer 的服务，但需要对 Ribbon 或 LoadBlancer 如何与该服务交互进行额外的定制。</li><li id="257e" class="nv nw in le b lf oe li of ll og lp oh lt oi lx oa ob oc od bi translated"><code class="fe nr ns nt nu b">configuration</code>——将它设置为一个<code class="fe nr ns nt nu b">@Configuration</code>类，我们所有的定制都定义为<code class="fe nr ns nt nu b">@Beans .</code></li></ul><p id="2c1e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这个帖子对你有帮助吗？不要忘记为这个帖子鼓掌，给我们一些灵感！</p></div><div class="ab cl oj ok hr ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ig ih ii ij ik"><h1 id="088a" class="oq lz in bd ma or os ot md ou ov ow mg kc ox kd mj kf oy kg mm ki oz kj mp pa bi translated">你对全栈开发感兴趣吗？</h1><p id="164e" class="pw-post-body-paragraph lc ld in le b lf mu jx lh li mv ka lk ll mw ln lo lp mx lr ls lt my lv lw lx ig bi translated"><em class="ms">我写的是关于 fullstack Web Development REST API、微服务、LinkedIn 中的架构、Medium 的循序渐进的编码教程。</em> <a class="ae lb" href="https://www.linkedin.com/in/spsarkar-appxive/" rel="noopener ugc nofollow" target="_blank"> <em class="ms">这里是我的 Linkedin 简介</em> </a> <em class="ms">。</em></p></div></div>    
</body>
</html>