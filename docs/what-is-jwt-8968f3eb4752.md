# 什么是 JWT？

> 原文：<https://blog.devgenius.io/what-is-jwt-8968f3eb4752?source=collection_archive---------5----------------------->

![](img/8ddd12b7e1c74cbcc7a677fffd1911c8.png)

JWT 代表 JSON 网络令牌。它定义了一种机制，我们可以在各方之间安全地传输信息。JWT 相对较小，这使我们能够通过 HTTP 头或 post 参数等发送它。

这是 JWT 的一个例子。它是一个编码字符串(未加密)。

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

JWT 最常见的使用案例之一是授权。授权是一种机制，用于验证向服务器发送请求的用户是否是经过身份验证的同一用户。只有当用户通过身份验证后，才允许他访问系统。

以前，这是通过在服务器中保留一个会话来完成的。用户登录到系统后，服务器会生成一个会话 Id，并将其发送到浏览器，保存在浏览器 cookie 中。每次客户端向服务器发出请求时，它都会向服务器发送一个会话 Id，服务器会验证用户是否被授权。但是，如果我们使用相同的服务器来提供本地移动应用程序，他们就没有 cookies。这就是 JWT 出现的原因。

**JWT 如何在授权中工作？**

![](img/e01612c02e385d411a78b175d2743b2d.png)

一旦用户登录到系统，它将创建一个 JWT 并将其发送回浏览器。例如，如果它是一个 web 应用程序，我们可以将其存储在本地存储中。当每个请求发送到服务器时，它将验证令牌，并确保用户被授权执行特定的操作。重要的是，这里我们不像基于会话的授权那样在服务器端保留任何东西。JWT 包含用户的所有信息，可以用来验证用户。如果令牌被篡改，服务器将使其无效。

**JWT 有什么？**

JSON Web 令牌有 3 个部分。

1.  页眉
2.  有效载荷
3.  签名

![](img/ee566c6c684c64bcd0f28e74729eed85.png)

JWT 在左手边。在解码版本中，我们可以看到报头、有效载荷和签名。

## 标题:

*   alg 是生成签名的哈希算法。typ 表示令牌类型，这里是 JWT。

## 有效载荷

*   有效负载是我们需要存储在令牌中的实际数据。sub 很可能是您想要授权的用户的 id。除此之外，它还有一些共同的领域，如 iss，iat 和 exp。
*   iss:(发行人)发行 JWT 的机构。
*   iat:(发行时间)令牌的发行时间。
*   (到期时间)当 JWT 到期时。
*   最佳做法是让令牌过期，否则如果有人获得了您的令牌，他们就可以通过授权自己为您来永远使用它来访问系统。

## 签名

*   实际上，这是验证用户没有篡改令牌的部分。它将包含报头部分和有效载荷部分。然后，它使用我们提供的密钥，使用标题中提到的算法对它们进行编码，并将它们组合在一起。我们来看看是怎么做到的。

```
**const** encodedHeader = base64urlEncode(header);
**const** encodedPayload = base64urlEncode(payload);
**const** data = encodedHeader + "." + encodedPayload; 
**const** hashedData = HS256(data, <secret_key>);
**const** signature = base64urlEncode(hashedData);**const** JWT = encodedHeader + "." + encodedPayload + "." + signature;
```

首先，对报头和有效载荷进行编码。然后，使用某种秘密密钥，使用散列算法(这里是 HS256)对组合的编码报头和有效载荷进行散列。然后散列数据将被编码(签名)。

现在我们有 3 个独立的编码部分编码头，编码有效载荷和签名。把这三个用点分开的组合起来就是一个 JWT。

有一个平台我们可以用[这个](https://jwt.io/)去玩。让我们试试那个。

![](img/f9b2424a145eb123fed8864f5c0b8a90.png)

在有效载荷中，用户名为“佛罗多·巴金斯”。密钥是“嘘”。如果有人改变了 JWT 会发生什么？这是当字母“e”被删除，然后是令牌的第一个句点时发生的情况。

![](img/d79fc779cc9d7bd759fc625a2db47273.png)

由于令牌的有效负载部分已更改，签名也将更改。因为签名是报头和有效载荷的散列数据，不再类似于 JWT 的最后蓝色部分。那么它将被识别为无效签名。因此，如果它无效，我们知道令牌已被篡改。这就是为什么我们可以将用户信息存储在客户端。无论如何，如果一个用户有你的密钥，那么他将能够创建一个有效的令牌。因此，在实际情况下，密钥必须难以猜测，并安全地存储在您的服务器中，以使其他人无法访问。