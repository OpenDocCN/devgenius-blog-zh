<html>
<head>
<title>Modeling Feed Intake data in Swine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟猪的采食量数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/modelling-feed-intake-data-in-swine-1af3d72f263d?source=collection_archive---------18-----------------------#2022-01-18">https://blog.devgenius.io/modelling-feed-intake-data-in-swine-1af3d72f263d?source=collection_archive---------18-----------------------#2022-01-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="31b4" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用混合模型和 R</h2></div><p id="4189" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在动物研究中，生长的建模并不容易，但它有一些直截了当，因为它可以用 Gompertz 曲线来近似。我已经在这里展示过了。对于采食量数据，建模可能更困难，这也使它更具挑战性，这使它更有趣！</p><p id="7852" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇文章中，我将向你展示我如何从一个商业数据集中建模饲料摄入量数据。我不能添加数据集，但我可以引导您进行分析。您需要的只是包含时间成分的数据。</p><p id="9c99" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我将加载数据。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b521" class="li lj in le b gy lk ll l lm ln">rm(list = ls())</span><span id="160e" class="li lj in le b gy lo ll l lm ln">#### LIBRARY ####<br/>library(lme4)<br/>library(splines)<br/>library(parallel) # parallel computing <br/>library(ggplot2)<br/>library(rms)<br/>library(plyr)<br/>library(reshape2)<br/>library(boot)<br/>library(sjPlot)<br/>library(sjstats)<br/>library(sjmisc)<br/>library(gridExtra)<br/>library(coefplot) <br/>library(coda)      <br/>library(aods3)     <br/>library(plotMCMC) <br/>library(bbmle)     <br/>library(nlme)<br/>library(merTools)<br/>library(RLRsim) <br/>library(multcomp)<br/>library(lsmeans)<br/>library(multcompView)<br/>library(lattice)<br/>library(lmtest)<br/>library(car)<br/>library(corrplot)<br/>library(PerformanceAnalytics)<br/>library(eqs2lavaan)<br/>library(mgcv)<br/>library(gamm4)<br/>library(robustlmm)<br/>library(influence.ME)<br/>library(readxl)<br/>library(data.table)<br/>library(HLMdiag)<br/>library(grid)<br/>library(fitdistrplus)<br/>library(readr)<br/>library(pbkrtest)<br/>library(broom.mixed)</span></pre><p id="7dc5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，最初的数据争论部分创建了许多融合的数据集。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6fdb" class="li lj in le b gy lk ll l lm ln">Data &lt;- read.csv("Data.csv");head(Data)<br/>Datalong&lt;- reshape(Data,<br/>                   varying  = c("X2","X3","X4","X5","X6","X7","X8","X9","X10","X11","X12","X13","X14","X15","X16","X17","X18","X19","X20","X21","X22","X23","X24"),<br/>                   v.names = "Intake",<br/>                   timevar = "Time",<br/>                   times = as.numeric(c("2","3","4", "5", "6", "7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24")),<br/>                   direction = "long")<br/>Datalong$id&lt;-NULL<br/>Datalong&lt;-Datalong[order(Datalong$Sow),]<br/>row.names(Datalong)&lt;-NULL<br/>Datalong$Time2&lt;-Datalong$Time-2<br/>Datalong$Treatment&lt;-as.factor(Datalong$Treatment)<br/>Datalong$LogIntake&lt;-log(Datalong$Intake)<br/>head(Datalong)</span><span id="ab4a" class="li lj in le b gy lo ll l lm ln">### Add time varying predictors<br/>Datalong$Feed&lt;-ifelse(Datalong$Time&lt;=13, "Milk", ifelse(Datalong$Time&gt;=14&amp;Datalong$Time&lt;=16, "Transition", "Dry"))<br/>## Feed--&gt;1(Milk), 2(Transition),3(Dry)<br/>Datalong$Feednum&lt;-ifelse(Datalong$Time&lt;=13, 1, ifelse(Datalong$Time&gt;=14&amp;Datalong$Time&lt;=16, 2, 3))<br/>Datalong&lt;-Datalong[!Datalong$Intake==0,]<br/>head(Datalong)</span><span id="1577" class="li lj in le b gy lo ll l lm ln">### Create Baseline variable <br/>DatalongBaseline&lt;-Datalong<br/>DatalongBaseline&lt;-DatalongBaseline[!DatalongBaseline$Time==2, ]<br/>A&lt;-list(DatalongBaseline, Data[, c("Sow", "X2")])<br/>DatalongBaseline&lt;-join_all(A)<br/>colnames(DatalongBaseline)[12]&lt;-"Baseline"<br/>head(DatalongBaseline)</span><span id="7850" class="li lj in le b gy lo ll l lm ln">### TREATMELT<br/>TREATmelt&lt;-ddply(Datalong, c("Time", "Treatment"), summarise,<br/>                 N = sum(!is.na(Intake)),<br/>                 Mis = sum(is.na(Intake)),<br/>                 Mean = round(mean(Intake, na.rm=T),3),<br/>                 Median = round(median(Intake, na.rm=T),3),<br/>                 SD = round(sd(Intake, na.rm=T),3),<br/>                 SE = round(sd(Intake, na.rm=T) / sqrt(N),5),<br/>                 LCI = round(Mean - (2*SE),3), <br/>                 HCI = round(Mean + (2*SE),3))<br/>TREATmelt</span><span id="0c0f" class="li lj in le b gy lo ll l lm ln">## FEEDMELT<br/>FEEDmelt&lt;-ddply(Datalong, c("Time", "Feed"), summarise,<br/>                 N = sum(!is.na(Intake)),<br/>                 Mis = sum(is.na(Intake)),<br/>                 Mean = round(mean(Intake, na.rm=T),3),<br/>                 Median = round(median(Intake, na.rm=T),3),<br/>                 SD = round(sd(Intake, na.rm=T),3),<br/>                 SE = round(sd(Intake, na.rm=T) / sqrt(N),5),<br/>                 LCI = round(Mean - (2*SE),3), <br/>                 HCI = round(Mean + (2*SE),3))<br/>FEEDmelt</span><span id="81a3" class="li lj in le b gy lo ll l lm ln">## FEEDTREATMELT<br/>FEEDTREATmelt&lt;-ddply(Datalong, c("Time", "Feed", "Treatment"), summarise,<br/>                N = sum(!is.na(Intake)),<br/>                Mis = sum(is.na(Intake)),<br/>                Mean = round(mean(Intake, na.rm=T),3),<br/>                Median = round(median(Intake, na.rm=T),3),<br/>                SD = round(sd(Intake, na.rm=T),3),<br/>                SE = round(sd(Intake, na.rm=T) / sqrt(N),5),<br/>                LCI = round(Mean - (2*SE),3), <br/>                HCI = round(Mean + (2*SE),3))<br/>FEEDTREATmelt</span><span id="41f8" class="li lj in le b gy lo ll l lm ln">## AXMELT<br/>AXmelt&lt;-ddply(Datalong, c("Time", "AX"), summarise,<br/>                N = sum(!is.na(Intake)),<br/>                Mis = sum(is.na(Intake)),<br/>                Mean = round(mean(Intake, na.rm=T),3),<br/>                Median = round(median(Intake, na.rm=T),3),<br/>                SD = round(sd(Intake, na.rm=T),3),<br/>                SE = round(sd(Intake, na.rm=T) / sqrt(N),5),<br/>                LCI = round(Mean - (2*SE),3), <br/>                HCI = round(Mean + (2*SE),3))<br/>AXmelt$AX&lt;-as.factor(AXmelt$AX)</span><span id="a197" class="li lj in le b gy lo ll l lm ln">## CELLMELT<br/>CELLmelt&lt;-ddply(Datalong, c("Time", "CELL"), summarise,<br/>                N = sum(!is.na(Intake)),<br/>                Mis = sum(is.na(Intake)),<br/>                Mean = round(mean(Intake, na.rm=T),3),<br/>                Median = round(median(Intake, na.rm=T),3),<br/>                SD = round(sd(Intake, na.rm=T),3),<br/>                SE = round(sd(Intake, na.rm=T) / sqrt(N),5),<br/>                LCI = round(Mean - (2*SE),3), <br/>                HCI = round(Mean + (2*SE),3))<br/>CELLmelt$CELL&lt;-as.factor(CELLmelt$CELL)</span></pre><p id="d2e5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些数据帧看起来会像这样</p><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/12bd56749233197f9a544e3026c87d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*BE7AGib4hZ4nlgJReX2NQw.png"/></div></figure><p id="8ab7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来是有趣的部分，图形，这将导致下面的情节。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9cf5" class="li lj in le b gy lk ll l lm ln">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 400, by = 50))<br/>ggplot(Datalong, aes(x=Time, y=Intake, group=Sow))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  facet_grid(~Treatment, margins=T)+<br/>  stat_summary(aes(group=1), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=1), fun.y=mean, geom="line", lwd=1.5)</span><span id="e643" class="li lj in le b gy lo ll l lm ln">### Per treatment - combined<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(TREATmelt, aes(x=Time, y=Mean, colour=Treatment))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1)+<br/>  geom_ribbon(aes(ymin=LCI, ymax=HCI, fill=Treatment), alpha=0.1)+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="ac35" class="li lj in le b gy lo ll l lm ln">### AX<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(AXmelt, aes(x=Time, y=Mean, colour=AX))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1)+<br/>  geom_ribbon(aes(ymin=LCI, ymax=HCI, fill=AX), alpha=0.1)+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="5251" class="li lj in le b gy lo ll l lm ln">### CELL<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(CELLmelt, aes(x=Time, y=Mean, colour=CELL))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1)+<br/>  geom_ribbon(aes(ymin=LCI, ymax=HCI, fill=CELL), alpha=0.1)+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="0f54" class="li lj in le b gy lo ll l lm ln">### FEED<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(FEEDmelt, aes(x=Time, y=Mean, colour=Feed))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1)+<br/>  geom_ribbon(aes(ymin=LCI, ymax=HCI, fill=Feed), alpha=0.1)+<br/>  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="7bb1" class="li lj in le b gy lo ll l lm ln">### FEEDTREAT<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(FEEDTREATmelt, aes(x=Time, y=Mean, colour=Feed))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1)+<br/>  geom_ribbon(aes(ymin=LCI, ymax=HCI, fill=Feed), alpha=0.1)+<br/>  facet_wrap(~Treatment, ncol=2)+<br/>  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="30cd" class="li lj in le b gy lo ll l lm ln">### Check for best fit growth<br/>sjp.poly(Datalong$Intake,Datalong$Time, 1)<br/>sjp.poly(Datalong$Intake,Datalong$Time, 2) <br/>sjp.poly(Datalong$Intake,Datalong$Time, 3) # three would suffice, but probably not provide best results<br/>sjp.poly(Datalong$Intake,Datalong$Time, 4)<br/>sjp.poly(Datalong$Intake,Datalong$Time, 5)</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq lu lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2f8b9e05eabec8a6248cbdcb6430fc74.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*dMT03kAV8X9MVyuvNKW3IQ.png"/></div></figure><figure class="lt lq md lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/12da40d49b98cd199018e41a5a80dd15.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*1lqbfKYPpNbQzdHf6W-xHw.png"/></div></figure><figure class="lt lq me lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/5831194de6b847aff1e8d3d4f2cdf256.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*rNRx7AxqfZMqhDuKqFw_MA.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mf lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/9307b9d79e0dde81ac5e541717bc6fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*fLxktcfyslmpGL32ngrdXg.png"/></div></figure><figure class="lt lq mf lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/ab78715a5a2652baa3ccad8ce0ddc4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*xOe60kFgY3Z11Sa1HcGISQ.png"/></div></figure><figure class="lt lq mg lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/6abc9e5382e4803db5dbd1db4861d19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*2md69eOl088AMna10pzu7w.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/e4a1094e8df9b37e7fc7794327b7c535.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*M-5K0jVDeLzsRyegFnG1cw.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/ce38375ccc7a8d3260c5a9f08a7b7a49.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*x_flB3ygRDhAWcGODiVcTw.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/240aa266f19025207bb723f6bc93d151.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*w-i2sHGWr-bB_RoWTTfY6Q.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/ae5f1fa7f74f63ac8b632c12ae4b9665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*6s24fvbniHL7kh_BHarqgg.png"/></div></figure><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/62b970847b1b67f7a6fbc0b7a5bcec15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*o98abefVMgVnohEc649DtA.png"/></div></figure></div><p id="2d35" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我想看看数据的可行性。让建模者的生活变得更轻松的最简单的方法之一就是转换数据。我不得不承认，我不喜欢它，因为你也失去了意义，不得不真正思考你在看什么。对于模型来说，这是减少横截面和纵向方差的一个很好的方法。使得对<a class="ae ky" href="https://medium.com/mlearning-ai/introduction-to-mixed-models-in-r-9c017fd83a63" rel="noopener">混合车型</a>的需求不那么严格。</p><p id="5c6a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">寻找合适变换的最简单方法是使用 Box-Cox 方法。Box-Cox 使用了一个转换阶梯。常见的 Box-Cox 变换都要经过 lambda 标准变换。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="79cd" class="li lj in le b gy lk ll l lm ln">#   -2   --&gt;  1/Y2<br/>#   -1   --&gt;  1/Y1<br/>#   -0.5  --&gt;  1/(Sqrt(Y))<br/>#   0     --&gt;  log(Y)<br/>#   0.5   --&gt;  Sqrt(Y)<br/>#   1     --&gt;  Y<br/>#   2     --&gt;  Y^2</span></pre><p id="b9a2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 MASS 包，我们可以让 Box-Cox 做它的事情并绘制结果。任何 Box-Cox 的基础是一个模型，这里是一个线性回归，包括一个六节点样条。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b18a" class="li lj in le b gy lk ll l lm ln">## MASS package<br/>fitlm&lt;-lm(Intake~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>par(mfrow=c(2,2));plot(fitlm);dev.off()<br/>boxcox(fitlm,lambda=seq(-2,2,by=0.1),plotit=T)<br/>bc1&lt;-boxcox(fitlm,lambda=seq(-2,2,by=0.1),plotit=T)<br/>which.max(bc1$y)<br/>LV&lt;-bc1[1]$x[as.numeric(which.max(bc1$y))]<br/>LV # 0.06060606 --&gt; log transform</span><span id="a7ef" class="li lj in le b gy lo ll l lm ln">histogram(~log(Datalong$Intake)|Datalong$Time) # log transform makes data little bit more normal<br/>bwplot(log(Datalong$Intake)~as.factor(Datalong$Time)) # still heterogeneity of variance</span><span id="b0f2" class="li lj in le b gy lo ll l lm ln">## Compare different fits <br/>fitlm&lt;-lm(Intake~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>fitlog&lt;-lm(log(Intake)~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>fitsqrt&lt;-lm(sqrt(Intake)~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>fitreciproc&lt;-lm(Intake/1~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>fitpower2&lt;-lm(Intake^2~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>fitpower13&lt;-lm(Intake^1/3~ns(Time,6)*Treatment+Department+Feed+as.factor(Sow), data=Datalong)<br/>par(mfrow=c(2,3))<br/>plot(fitlm, which=2, main="BW")<br/>plot(fitlog, which=2, main="BW_log") # solves the upper tail but not the lower tail --&gt; fixating baseline probably would <br/>plot(fitsqrt, which=2, main="BW_sqrt")<br/>plot(fitreciproc, which=2, main="BW_reciprocal")<br/>plot(fitpower2, which=2, main="BW^2")<br/>plot(fitpower13, which=2, main="BW^1/3")</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq mj lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/5e12e9bf9a88413f9e879cccb8ed91ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*5BJtAtbAH9V-E6xFRqBvww.png"/></div></figure><figure class="lt lq mk lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/26e05bf54cb2d4246dbb7a9b2599f110.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*fZ7jmPQ3sbKTtmMbeUztrg.png"/></div></figure><figure class="lt lq ml lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/6ee0551e23e43eba2500effd278a48d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*T50_wA4wwCmdSOV__vAQrQ.png"/></div></figure></div><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/86df5eb8a3e59fdb884ab0ead923c435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*lHIT2ZZ4tgA5mGtgDYkmwA.png"/></div></figure><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mn"><img src="../Images/4ef0f85d290b5a4b3125bf54dfd10690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGRhKB93noONGcbxzj304g.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">一些转换显示出比原始数据更好的拟合，尽管原始数据本身并不坏。</figcaption></figure><p id="4484" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，让我们开始构建一个没有任何转换的混合模型，看看它能带给我们多远。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6403" class="li lj in le b gy lk ll l lm ln">fit.lmer&lt;-lmer(log(Intake)~ns(Time,6)*Treatment+Feed+Department+<br/>                 (ns(Time,3)|Sow),<br/>               data=Datalong,<br/>               control = lmerControl(optCtrl = list(maxfun=100000)))<br/>summary(fit.lmer)<br/>plot(fit.lmer) <br/>plot_model(fit.lmer)<br/>plot_model(fit.lmer, type="re")<br/>plot_model(fit.lmer, type="eff")<br/>plot_model(fit.lmer, type="std")<br/>plot_model(fit.lmer, type="slope")<br/>plot_model(fit.lmer, type="resid")<br/>histogram(resid(fit.lmer), breaks=20)<br/>plot(acf(resid(fit.lmer)))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq ms lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2cd47259482b98d490d4554f5d38d1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*JRR9y0wFbqHdlLYTr6raUQ.png"/></div></figure><figure class="lt lq mt lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/6f40622439972b353a10f5de1aee5772.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*abz8XynC4GFB2ckm7F2aPw.png"/></div></figure><figure class="lt lq mu lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/a4caf9d57ad89c6737ec4385c4fb60e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*zMqN_6GgXX6RckvRBztRSg.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/0608d730e11f3a178718b3dbe003f669.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*fpec76mP4cbmqURfRW2hCQ.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/f32efe363aea246d90d046ba70f6312f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*_LG5PbPHLChkvV7d0O4CBQ.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/9b08fb66f1b79d52825967b523d23de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*J0R8EvJmqHr9o7aXii57CQ.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mv lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1e53d647150fc4e02a99314401451e62.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*3Cn_YnrNntNR00NIVAGEVw.png"/></div></figure><figure class="lt lq mw lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/adf9a8ec3be5dda94af111f1292e64b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*2EBQxIS-id1xJFlK7TDsjQ.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/5862f9a99d459b10dd0d84a22471f4cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*5AcRYnhwyXnBMAcs46kY0Q.png"/></div></figure><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/0f14dda21a2990168d318ef9fc9bd831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*McfRVV157aiS5mYQWEknLw.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk mx di my mz translated">这个模型本身看起来并不坏。</figcaption></figure></div><p id="b6ee" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，R 中最酷的函数之一是<em class="na"> drop1 </em>函数。它是一个迭代预测器，用于观察 AIC 的变化。</p><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/412c6b99198565223783d44154cc50bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*an0_ti0bFI8gqOitTvenaw.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">它显示了删除交互项如何有利于模型拟合。它还显示了删除预测器<strong class="bd nc">提要</strong>肯定不会带来好处。</figcaption></figure><p id="0fb1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我将创建几个迭代的模型，看看哪一个具有最低的 AIC。仅仅使用 AIC 是不够的，也是棘手的，但这是理解最大的预测因子在哪里影响谎言和/或方差分量的好方法。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="a4dd" class="li lj in le b gy lk ll l lm ln">fit.lmer2&lt;-lmer(log(Intake)~ns(Time,6)*Treatment+Department+<br/>                 (ns(Time,6)|Sow),<br/>               data=Datalong,<br/>               control = lmerControl(optCtrl = list(maxfun=100000)))<br/>summary(fit.lmer2)<br/>anova(fit.lmer, fit.lmer2) # fit.lmer2 not better<br/>drop1(fit.lmer2)</span><span id="6cb4" class="li lj in le b gy lo ll l lm ln">fit.lmer3&lt;-lmer(log(Intake)~ns(Time,6)*Treatment+Feed+<br/>                  (ns(Time,6)|Sow),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>plot(fit.lmer3)<br/>anova(fit.lmer, fit.lmer3) # Model 3 is better<br/>KRmodcomp(fit.lmer, fit.lmer3)</span><span id="55c6" class="li lj in le b gy lo ll l lm ln">fit.lmer4&lt;-lmer(log(Intake)~ns(Time,6)+Treatment+Feed+Department+<br/>                  (ns(Time,6)|Sow)+<br/>                  (1|Feed) + (1|Treatment),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>summary(fit.lmer4)<br/>anova(fit.lmer, fit.lmer3, fit.lmer4) # fit.lmer still the best</span><span id="aa06" class="li lj in le b gy lo ll l lm ln">fit.lmer5&lt;-lmer(log(Intake)~ns(Time,2)*Feed+Treatment+Department+<br/>                  (ns(Time,2)*Feed|Sow)+<br/>                  (1|Feed) + (1|Treatment),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>summary(fit.lmer5)<br/>plot(fit.lmer5)<br/>anova(fit.lmer5, fit.lmer)</span><span id="a502" class="li lj in le b gy lo ll l lm ln">fit.lmer6&lt;-lmer(log(Intake)~ns(Time,10)+Feed+Treatment+Department+<br/>                  (ns(Time,10)|Sow)+(1|Feed),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>plot(fit.lmer6)<br/>summary(fit.lmer6)</span><span id="655c" class="li lj in le b gy lo ll l lm ln">fit.lmer7&lt;-lmer(log(Intake)~ns(Time,2)*Feed*Treatment+Department+<br/>                  (ns(Time,2)*Feed|Sow),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>plot(fit.lmer7)</span><span id="e260" class="li lj in le b gy lo ll l lm ln">fit.lmer8&lt;-lmer(log(Intake)~ns(Time,4) +Feed*Treatment+Department+<br/>                  (ns(Time,4)|Sow) + (Feed*Treatment|Sow),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>plot(fit.lmer8)</span><span id="94fb" class="li lj in le b gy lo ll l lm ln">fit.lmer9&lt;-lmer(log(Intake)~as.factor(Time)+Treatment+Feed+Department+<br/>                  (1|Sow) + (1|Feed),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>plot(fit.lmer9)<br/>summary(fit.lmer9)<br/>ICtab(fit.lmer,<br/>       fit.lmer2,<br/>       fit.lmer3,<br/>       fit.lmer4,<br/>       fit.lmer5,<br/>       fit.lmer6,<br/>       fit.lmer7,<br/>       fit.lmer8,<br/>       fit.lmer9)</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/99b9d7285b2cf7170041b94bde1cae49.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*4DPanyTqU_2Pqu9YEYdN2Q.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">从分析来看，6 型似乎是最好的。</figcaption></figure><p id="587b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我不想对原始数据使用对数转换，而是想看看是否可以通过一个<a class="ae ky" href="https://medium.com/@marc.jacobs012/generalized-linear-mixed-models-in-sas-distributions-link-functions-scales-overdisperion-and-4b1c767bb89a" rel="noopener">广义线性混合模型</a>将对数转换包含在模型中。成绩还不错。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="af26" class="li lj in le b gy lk ll l lm ln">fit.glmer&lt;-glmer(Intake~ns(Time,6)+Treatment+Feed+Department+<br/>                   (ns(Time,6)|Sow)+(1|Feed),<br/>                 data=Datalong,<br/>                 family=gaussian(link="log"),<br/>                 control = glmerControl(optimizer = "bobyqa", nAGQ = 1))<br/>summary(fit.glmer)<br/>plot(fit.glmer)<br/>plot_model(fit.glmer)<br/>plot_model(fit.glmer, "diag")</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/5bed7e2195ea2d4208174bc4e81d3d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*OyVNvaSK4ZBtPTZMJBIzVg.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2be4eab6e7b499bababc1809bb24d031.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*C3lYInVWGIWglhvOAjkKqg.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/fa93a4fea24533c99195a28a5ab54868.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*CaSAjnUfR0B1Vks8-RTiAg.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/786c43913efa538a219e97f67283094e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qvnaJlyO0AnccpVMxFQItw.png"/></div></figure><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/07d963939c28cb353ea817ae02c24078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Zoqzn-RMpLM6tNQVME4mnA.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/40cc9dce1d0a6dfe76d84c5bf69c47e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vZ8qwuqXJBl0OjNQaNlCgw.png"/></div></figure><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/88af136390020953fc46563079917371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9KhN5nS9NzrKQrFI3PtklQ.png"/></div></figure></div><p id="d569" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一种对数据建模的方法是使用一般的加性混合模型或 GAMM，而不是使用大的打结样条。在这里，我再次对数据而不是模型使用了对数变换，因为对数正态分布可能非常棘手。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9950" class="li lj in le b gy lk ll l lm ln">Datalong$LogIntake&lt;-log(Datalong$Intake)<br/>fit.gamm4&lt;-gamm4::gamm4(LogIntake~s(Time)+Feed+Treatment+Department,<br/> random=~(ns(Time,6)|Sow)+(1|Feed),<br/> family=gaussian(),<br/> data=Datalong)<br/>dev.off()<br/>plot(fit.gamm4$gam)<br/>summary(fit.gamm4$gam)<br/>summary(fit.gamm4$mer)<br/>plot(resid(fit.gamm4$gam))<br/>qqp(resid(fit.gamm4$gam))<br/>histogram(resid(fit.gamm4$gam), breaks=50)<br/>histogram(resid(fit.gamm4$mer), breaks=50)<br/>plot(exp(fitted(fit.gamm4$gam)) — exp(fitted(fit.gamm4$mer)), col=c(1,2))<br/>fit.gamm4$gam$var.summary</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ne"><img src="../Images/4ad7889fe93b68868aa69e59b022ead9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-PslVvlB96cCGZtfcwtAIw.png"/></div></div></figure><p id="5963" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从模型的表格摘要以及下面突出显示残差的图来看，结果看起来不错。</p><div class="kz la lb lc gt ab cb"><figure class="lt lq nf lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/b99783be4fcf8cc192cf1c2eebd378dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*x5FLqYq4kfHzQJN-PQ4ACQ.png"/></div></figure><figure class="lt lq ng lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/4b28bb6820d69798ec7e67bfc217041f.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*JUPg0Qbf-G15AwVHPvXjxQ.png"/></div></figure><figure class="lt lq ng lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1398bc13930dcddf65335172ac6dfd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*FAy14pgYYRDcuxbZ1FO0bA.png"/></div></figure></div><div class="ab cb"><figure class="lt lq nh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1cc1b92e9e10aea64ee3a43e207d5c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*747udKDYVCO1qv19J71fww.png"/></div></figure><figure class="lt lq ni lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/ed7d77988cf486adab190b02b272581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*EdrmIMEN2w2Z_fIVQhs3BA.png"/></div></figure></div><div class="ab cb"><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/9bb90d388d07c758ec966dc8a0f91544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iPoeg7ERneQF-QU9n-TlVA.png"/></div></figure><figure class="lt lq mi lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/5b4a9a5acf4e4a647fa7e0dc42298c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1MFqbu2uecwPnGYKCWTwRg.png"/></div></figure></div><p id="5152" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了 lme4 和 gamm4 之外，另一个很棒的软件包是<a class="ae ky" href="https://www.rdocumentation.org/packages/nlme/versions/3.1-152/topics/lme" rel="noopener ugc nofollow" target="_blank"> lme </a>软件包，它可能是 r 中最古老的混合模型软件包。对于线性混合模型来说，它仍然非常重要，也仍然是最灵活的。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b5ac" class="li lj in le b gy lk ll l lm ln">#### LME ####<br/>fit.lme&lt;-lme(log(Intake)~ns(Time,6)*Treatment+Feed+Department,<br/>             random=~ns(Time,6)|Sow,<br/>             #weights=varIdent(form=~1|Time),<br/>             correlation=corAR1(form=~Time|Sow), <br/>             data=Datalong,<br/>             method="REML",<br/>             control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000)) <br/>plot(fit.lme)<br/>plot_model(fit.lme)</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq nj lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/30b738b0ce0777d4adc86ac453c00c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*_ohGvkaRDJ_M5HuqUjUB2A.png"/></div></figure><figure class="lt lq nk lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/569fca6bc70ee65bba38ea45f7673ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*17k6vcmkjtJPBFHbyn1vVg.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk nl di nm mz translated">残差看起来不错。</figcaption></figure></div><p id="ea3f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">lme 软件包中最灵活的部分之一是通过协方差结构对误差项建模的能力，这几乎是对 SAS 的补充。在这里，我将展示如何使用基础模型和应用几个协方差结构，并查看 AIC 的变化。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="abc0" class="li lj in le b gy lk ll l lm ln">cp&lt;-list(corCAR1, corExp, corAR1, corCompSymm, corLin,corGaus, corSpher)<br/>z&lt;-vector('list', length(cp))<br/>for(k in 1:length(cp)){<br/>  z[[k]]&lt;-nlme::gls(log(Intake)~Baseline+ns(Time,6)*Treatment+Feed+Department, <br/>              data=DatalongBaseline, <br/>              correlation=cp[[k]](form=~Time|Sow))<br/>}<br/>anova(z[[1]], z[[2]], z[[3]], z[[4]], z[[5]], z[[6]], z[[7]]) # corSpher has lowest AIC<br/>plot(z[[1]])<br/>summary(z[[1]])</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/500df82740ddfff37490676a2c5dfa61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*0wHCO-LGBWKAz2_ffqurvg.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">corAR1 似乎是最合适的，所以让我们在模型中使用它。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="dda3" class="li lj in le b gy lk ll l lm ln">fit.gls&lt;-Gls(log(Intake)~Baseline+ns(Time,10)*Treatment+Feed+Department<br/>             ,correlation=corAR1(form=~Time|Sow), <br/>             data=DatalongBaseline) # this is probably what she realy did <br/>print(fit.gls, latex=TRUE)<br/>v&lt;-Variogram(fit.gls, form=~Time|Sow);plot(v) # looks like the autocorrelation is handling it nicely<br/>summary(fit.gls)<br/>AIC(fit.lme, fit.gls)<br/>plot(acf(resid(fit.gls))) # shows huge amout of autocorrelation even after adding correlation function<br/>plot(fit.gls)<br/>qqp(resid(fit.gls))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/cc802df6e1a52cb528d18d1bcd0400dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*C0J6HX4dEicnJCEPoF5LHg.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/40e9aecc5de77e5093a2ef398426698f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*SGciKYy_z7g331NAcsFSfw.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1815cc74d365ddd12c1ab6aa68ac2e55.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*o7FhPiOHqaU4S5cGxispqg.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk no di np mz translated">残差看起来不错(中间和右边)，但是自相关协方差没有像我希望的那样降低相关误差。</figcaption></figure></div><p id="1c6b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我打算再试一次，让错误建模部分变得更简单。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6bdc" class="li lj in le b gy lk ll l lm ln">fit.gls2&lt;-gls(log(Intake)~Baseline+as.factor(Time)+Treatment, <br/>              correlation =corAR1(), <br/>             data=DatalongBaseline)</span><span id="9713" class="li lj in le b gy lo ll l lm ln">## Model evaluation of GLS <br/>boxplot(resid(fit.gls)~DatalongBaseline$Time) # not constant variance<br/>xyplot(resid(fit.gls)~exp(fitted(fit.gls)))  # not constant variance<br/>anova(fit.gls)</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq nq lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/73636c1607f36e8086082ec2e2693e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*DfepIulu06A3ib44c6_IKQ.png"/></div></figure><figure class="lt lq nq lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/86a9e798d3765867499dd17f43020255.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*sw0IUl4C32OYBCrNsHPLTg.png"/></div></figure><figure class="lt lq nr lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2fbb7474fc5a78a97582bd99a47d8905.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*IgTkZ6A68Fi6AUf-dNhDcg.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk ns di nt mz translated">不，对自相关没有帮助，尽管残差本身在时间上拟合得很好。</figcaption></figure></div><p id="7797" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，如果我用总采食量来建模呢？这里要实现的另一个伟大工具是<a class="ae ky" href="https://www.rdocumentation.org/packages/car/versions/3.0-10/topics/avPlots" rel="noopener ugc nofollow" target="_blank"> aVPlots(附加变量图)</a>，它向你展示了一组预测因子对另一组预测因子的条件交互作用。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="dcd2" class="li lj in le b gy lk ll l lm ln">Data&lt;-Data[order(Data$Treatment),]<br/>Data$TI&lt;-c(5114,5783,11794,6467,6724,4036,<br/>                        8557,<br/>                        5091,<br/>                        4490,<br/>                        13866,<br/>                        11874,<br/>                        7029,<br/>                        9001,<br/>                        14849,<br/>                        5526,<br/>                        4550,<br/>                        18291,<br/>                        10471,<br/>                        3437,<br/>                        9337,<br/>                        14451,<br/>                        6094,<br/>                        4820,<br/>                        11137,<br/>                        13410,<br/>                        6976,<br/>                        14627,<br/>                        7063,<br/>                        14564,<br/>                        7300,<br/>                        7967)<br/>Data$Treatment&lt;-as.factor(Data$Treatment)<br/>DataCOMPL&lt;-Data[!Data$Sow==602,]<br/>head(DataCOMPL)</span><span id="f186" class="li lj in le b gy lo ll l lm ln">fit.lm2&lt;-lm(TI~Treatment+Department, <br/>           data=DataCOMPL)<br/>dev.off()<br/>par(mfrow=c(2,2))<br/>plot(fit.lm2)<br/>dev.off()<br/>Anova(fit.lm2, type=2)<br/>residualPlots(fit.lm2)<br/>avPlots(fit.lm2)<br/>pairs(lsmeans(fit.lm2, ~Treatment))<br/>plot(pairs(lsmeans(fit.lm2, ~Treatment)))</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nu"><img src="../Images/9a29d7ccd49a4c9525467370430c4a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kso_ctqbMNW-1cDTBOaQcw.png"/></div></div></figure><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5ab39c78afbe2d02c0b4f97f8ab0c2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*bDK-fKaG6tdtKRYJYhO8Lw.png"/></div></figure><div class="kz la lb lc gt ab cb"><figure class="lt lq nw lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/8cbab48280d4905b215191677aaf0a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*FKXoamY6HRK30NzKeShmRA.png"/></div></figure><figure class="lt lq nx lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/eab9a7547270bd9b21fecda37d3dc8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*nIo289UNbYbNTXpV1EBMig.png"/></div></figure></div><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ny"><img src="../Images/056f8fcf8187c87741ed3df6676b1932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6R7ZIdpakAUyYCHqzwT8Cw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">这些差异都不显著。</figcaption></figure><p id="e2a8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想回到 Box-Cox 变换，看看我是否能找到一种方法，通过变换，使用<em class="na"> fit.lm2 </em>，达到一个更好的模型。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="4d18" class="li lj in le b gy lk ll l lm ln">boxcox(fit.lm2,lambda=seq(-2,2,by=0.1),plotit=T)<br/>bc2&lt;-boxcox(fit.lm2,lambda=seq(-2,2,by=0.1),plotit=T)<br/>which.max(bc2$y)<br/>bc2[1]$x[as.numeric(which.max(bc2$y))]</span><span id="e340" class="li lj in le b gy lo ll l lm ln">fit.lm3&lt;-lm(log(TI)~Treatment+Department, <br/>            data=DataCOMPL)<br/>pairs(lsmeans(fit.lm3, ~Treatment))</span><span id="9a0b" class="li lj in le b gy lo ll l lm ln">model&lt;-aov(log(TI)~Treatment, <br/>           data=DataCOMPL)<br/>summary(model)<br/>plot(model)<br/>plot(TukeyHSD(model))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq nz lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1a950c56a5dbeb9b6607988828839e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*ZfESlEjCm7PuoiF0XJtv0Q.png"/></div></figure><figure class="lt lq oa lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1256970cc3452efea0425d4dc9109cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*PWONUeHC_NS1WppppYaftA.png"/></div></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7302" class="li lj in le b gy lk ll l lm ln">fit.lmer.inf&lt;-lmer(log(Intake)~ns(Time,5)+Treatment+Feed+Department+<br/>                  (ns(Time,5)|Sow)+<br/>                  (1|Feed),<br/>                data=Datalong,<br/>                control = lmerControl(optCtrl = list(maxfun=100000)))<br/>inf.sow&lt;-influence.ME::influence(fit.lmer.inf, "Sow") # fit.lmer won't do<br/>plot(inf.sow)<br/>plot(inf.sow, which="cook", sort=TRUE)</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq ob lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/1ad7c19ac3b61d43e464514a5a2f7d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*Ze9GQAFKco6Paaxza8J1AQ.png"/></div></figure><figure class="lt lq oc lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/0018352e29bc02b9797deb29d79c6c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*riGiFJOkF7AUu4lkPMBBXw.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk od di oe mz translated">未检测到影响者</figcaption></figure></div><p id="cbc5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是时候看看有哪些模型能够预测感兴趣的结果了。当然，残差已经表明了这一点，但校准图仍然可以相当令人耳目一新。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9c76" class="li lj in le b gy lk ll l lm ln">ggplot(Datalong, aes(x=Intake, <br/>                     y=exp(fitted(fit.lmer, type="response")), <br/>                     colour=Intake-exp(fitted(fit.lmer,type="response"))))+<br/>  geom_point()+<br/>  geom_abline(intercept = 0, slope = 1, lty=2)+<br/>  scale_colour_gradient2(low="red",mid="blue",high="red")+<br/>  labs(title = "Calibration", y="Predicted", x="Observed", colour="Difference")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span><span id="c371" class="li lj in le b gy lo ll l lm ln"># The variance across time <br/>ggplot(Datalong, aes(as.factor(Datalong$Time),resid(fit.lmer), group=as.factor(Datalong$Time)))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Time")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Time")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq of lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/86ca49ceaf05c5233ed4dcacc93b4e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*EODF3Y465nOg74k_eHcupw.png"/></div></figure><figure class="lt lq og lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/71b47613116b40d695a08e328fe6a384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*dU_iufFyPcjuqw1426_v_w.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk oh di oi mz translated">预测还不错，但是一旦动物开始吃得更多，预测就变得更加困难。</figcaption></figure></div><p id="fea2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就像我说的，残差也起作用</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="5458" class="li lj in le b gy lk ll l lm ln"># QQplot residuals <br/>qqmath(~resid(fit.lmer),<br/>       prepanel = prepanel.qqmathline,<br/>       panel = function(x, ...) {<br/>         panel.qqmathline(x, ...)<br/>         panel.qqmath(x, ...)<br/>       }) <br/>histogram(~resid(fit.lmer), breaks=30) # big left tail --&gt; resids are quite low</span><span id="7c38" class="li lj in le b gy lo ll l lm ln"># Residuals stratified by Time<br/>qqmath(~resid(fit.gamm4$mer)|Datalong$Time, aspect = "xy",<br/>       prepanel = prepanel.qqmathline,<br/>       panel = function(x, ...) {<br/>         panel.qqmathline(x, ...)<br/>         panel.qqmath(x, ...)<br/>       })</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq oj lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/82502812f774e462c08dabf2bdf23e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*oG3EzhDk2z75Y3KJ8mn6sQ.png"/></div></figure><figure class="lt lq oj lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/bfe5e3f50fb647363254c1f4792d3163.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*JUDHjpU2WsRPkg2bZm0iyg.png"/></div></figure><figure class="lt lq ok lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/8d081bc4b4f23d9eea93fb688731d0c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*hNTe23e0aDHIh5KNoTDhMA.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk ol di om mz translated">看起来也不错，除了一个细胞和时间的开始。</figcaption></figure></div><p id="cdef" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过 xy 图可以得到更好的预测图</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="5c00" class="li lj in le b gy lk ll l lm ln">xyplot(Intake ~ Time|Sow, data = Datalong, <br/>       strip = FALSE, aspect = "xy", pch = 16, cex=0.5, grid = TRUE,<br/>       panel = function(x, y, ..., fit, subscripts) {<br/>         panel.xyplot(x, y, ...)<br/>         ypred &lt;- exp(fitted(fit.lmer))[subscripts]<br/>         panel.lines(x, ypred, lty=1, col = "orange")<br/>         panel.loess(x, y, lty = 2, col="red")<br/>       })</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi on"><img src="../Images/5165171b70f55c4797bd4cd8d329f48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9T92lq43yE7wr3OlC6dikQ.png"/></div></div></figure><p id="d09f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后看看残差，一个更广泛的图。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="84c1" class="li lj in le b gy lk ll l lm ln">## List of graphs for model evaluation<br/>fit_augmented &lt;- augment(fit.lmer)<br/>g1&lt;-ggplot(fit_augmented, aes(.fitted, .resid))+<br/>  geom_point()+<br/>  stat_smooth(method="loess")+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Fitted values")+ylab("Residuals")+<br/>  ggtitle("Fitted vs Residuals")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g2&lt;-ggplot(fit_augmented, aes(x=.resid))+<br/>  geom_histogram(aes(y=..density..),colour="black", fill="white")+<br/>  geom_density(alpha=.2, fill="#FF6666")+<br/>  xlab("Residuals")+ylab("Density")+<br/>  ggtitle("Histogram Residuals")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>vec&lt;-resid(fit.lmer); y &lt;- quantile(vec[!is.na(vec)], c(0.25, 0.75)); x &lt;- qnorm(c(0.25, 0.75)); slope &lt;- diff(y)/diff(x); int &lt;- y[1L] - slope * x[1L]<br/>g3&lt;-ggplot(fit_augmented, aes(sample=.resid))+<br/>  geom_qq()+<br/>  geom_abline(slope=slope, intercept=int, col="red", lty=2, lwd=1)+<br/>  xlab("Theoretical")+<br/>  ylab("Empirical")+<br/>  ggtitle("QQ-PLot Residuals")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g4&lt;-ggplot(fit_augmented, aes(x=exp(`log(Intake)`), y=exp(fitted(fit.lmer)), colour=`log(Intake)`-exp(fitted(fit.lmer))))+<br/>  geom_point()+scale_colour_gradient2(low="red",mid="blue",high="red")+<br/>  labs(title = "Calibration", y="Predicted", x="Observed", colour="Difference")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g5&lt;-ggplot(fit_augmented, aes(Datalong$Treatment,.resid, group=Datalong$Treatment))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Treatment")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Treatment")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g6&lt;-ggplot(fit_augmented, aes(as.factor(Datalong$Time),.resid, group=Datalong$Time))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Time")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Time")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g7&lt;-ggplot(fit_augmented, aes(as.factor(Datalong$Department),.resid, group=as.factor(Datalong$Department)))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Department")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Department")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g8&lt;-ggplot(fit_augmented, aes(x=Datalong$Feed,y=.resid, group=Datalong$Feed))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Feed")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Feed")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>g9&lt;-ggplot(fit_augmented, aes(x=as.factor(Datalong$Sow),y=.resid, group=Datalong$Sow))+<br/>  geom_boxplot()+<br/>  geom_hline(yintercept=0, col="red", linetype="dashed")+<br/>  xlab("Sow")+<br/>  ylab("Residuals")+<br/>  ggtitle("Residuals vs Sow")+<br/>  theme_bw()+<br/>  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())<br/>gh&lt;-grid.arrange(g1,g2,g3,g4,g5,g6,g7,g8,g9, nrow=5,ncol=2,top=textGrob("Diagnostics Final Model",gp=gpar(cex=2)))<br/>ggsave(gh,filename = "Model Evaluation.png", width=16, height=16, dpi=600)</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi oo"><img src="../Images/e25b4d68471a87f2fff4e1ab37bf108c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9tMhIaVGRypSjKL-7y7Vg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">相当广泛的一组图来观察模型的可行性</figcaption></figure></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><p id="a5e7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我一路做到这里已经是相当跑了。但是我想看看我是否能从数据中得到更多，因为我没有看到任何有意义的东西。记住，商业数据也会带来商业压力，这并不总是好的。</p><p id="c395" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我再看一看。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="385d" class="li lj in le b gy lk ll l lm ln">Datalong$fit&lt;-exp(fitted(fit.lmer))<br/>FEEDTREATMODELmelt&lt;-ddply(Datalong, c("Time", "Feed", "Treatment"), summarise,<br/>                     N = sum(!is.na(fit)),<br/>                     Mis = sum(is.na(fit)),<br/>                     Mean = round(mean(fit, na.rm=T),3),<br/>                     Median = round(median(fit, na.rm=T),3),<br/>                     SD = round(sd(fit, na.rm=T),3),<br/>                     SE = round(sd(fit, na.rm=T) / sqrt(N),5),<br/>                     LCI = round(Mean - (2*SE),3), <br/>                     HCI = round(Mean + (2*SE),3))<br/>FEEDTREATMODELmelt</span><span id="1847" class="li lj in le b gy lo ll l lm ln">## Summary Observed vs Fitted<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 2000, by = 100))<br/>ggplot(FEEDTREATmelt, aes(x=Time, y=Mean, colour=Feed))+<br/>  myx+<br/>  myy+<br/>  geom_line(lwd=1, alpha=0.5)+<br/>  facet_wrap(~Treatment, ncol=2)+<br/>  geom_line(data=FEEDTREATMODELmelt, lwd=1)+<br/>  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+<br/>  geom_ribbon(data=FEEDTREATMODELmelt, aes(ymin=LCI, ymax=HCI, fill=Feed), alpha=0.1)+<br/>  geom_ribbon(data=FEEDTREATmelt, aes(ymin=LCI, ymax=HCI, fill=Feed), alpha=0.1)</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ow"><img src="../Images/148acef6944e8d3e3a439db77d1c5934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRovZv4vUlylBWP640_ctg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">非平滑数据集之上的平滑数据集</figcaption></figure><p id="beb0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当对时间数据建模时，即使是在实体实验中进行，开始时的差异也会影响后续过程。所以，我建立了一个模型来修正开头。看着顶部的情节，我并没有期望太多，比起修复，我更喜欢建模，但这是一个要求。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="40b0" class="li lj in le b gy lk ll l lm ln">head(DatalongBaseline)<br/>LME.model.1&lt;-lme(Intake~1+Baseline+Time2+Department+Treatment+Feed, <br/>                 data=DatalongBaseline, <br/>                 random=~Time|Sow, <br/>                 correlation=corAR1(), <br/>                 method="ML", <br/>                 control=lmeControl(maxIter=10000, msMaxIter = 1000)) # ERROR message = singular convergence (7)<br/>LME.model.2&lt;-lme(Intake~1+Baseline+ns(Time,2)+Department+Treatment+Feed, <br/>                 data=DatalongBaseline, <br/>                 random=~Time|Sow,<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>summary(LME.model.2)</span><span id="bc31" class="li lj in le b gy lo ll l lm ln">LMER.model.1&lt;-lme4::lmer(Intake~1+Baseline+ns(Time,2)+Department+Treatment+Feed+(Time|Sow), <br/>                 data=DatalongBaseline, REML=FALSE, lmerControl(optimizer = "bobyqa")) # Model failed to converge: degenerate  Hessian with 1 negative eigenvalues<br/>AIC(LME.model.2);AIC(LMER.model.1) # same AIC<br/>VarCorr(LME.model.2); VarCorr(LMER.model.1) # approximately the same, so why LMER will not be able to fit a model that LME can fit i do not know</span><span id="d01c" class="li lj in le b gy lo ll l lm ln">Data_new&lt;-groupedData(Intake~Time|Sow,<br/>                      data=DatalongBaseline,<br/>                      FUN=mean)<br/>LME.model.3&lt;-lme(Intake~1+Baseline+ns(Time,4)+Department+Treatment+Feed, <br/>                 data=Data_new, <br/>                 random=~ns(Time,3),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>summary (LME.model.3)<br/>plot(LME.model.3)<br/>res&lt;-residuals(LME.model.3)<br/>qqnorm(res); qqline(res)<br/>plot(res)<br/>plot(augPred(LME.model.3,level=0:3))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/80e5399308db2ac843b25e2504d90bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*VZhJM1aP9RX7bqiIx51MVg.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/e935a2a7df8072b3706c7b2f983a2ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9s0tGFjVhqbOpzZ13cSpIQ.png"/></div></figure><figure class="lt lq mh lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2bcab1ba254b2156553d6cee8cccc95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*sLf2Hjuxl1uGV-WCi8mITQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk no di np mz translated">不完美。</figcaption></figure></div><p id="abf6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一种改进模型的方法是实际手动选择样条线的结。这需要基于生物学来完成，而不是基于你想要(过度)拟合数据的愿望。在这里，我在实际测量发生的日期打上了结。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="e888" class="li lj in le b gy lk ll l lm ln">LME.model.4&lt;-lme(Intake~1+Baseline+ns(Time,knots=c(10,14,17,21))+Treatment+Feed+Department, <br/>                 data=Data_new, <br/>                 random=~ns(Time,knots=c(10,14,17,21)),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>plot(augPred(LME.model.4,level=0:1))<br/>plot(ACF(LME.model.4))<br/>plot(acf(resid(LME.model.4)))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq ox lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/433fc3d70ed746dedaaf4e87c04a6edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*i6RT2RbkLDdOOhvozrAS3A.png"/></div></figure><figure class="lt lq oy lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/f210eb8bcf7d17cf126e0d285e246e3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*qRC4AXkWCgbRdv-NI3-enQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk oz di pa mz translated">看起来好多了！！</figcaption></figure></div><p id="d469" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看结的位置是否正确。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="97ef" class="li lj in le b gy lk ll l lm ln"># Test for splines<br/>dev.off()<br/>plot(Intake~Time, data=Datalong)<br/>Intake.spl&lt;-with(Datalong, smooth.spline(Time, Intake))<br/>summary(Intake.spl)<br/>lines(Intake.spl, col = "blue")<br/>plot(residuals(Intake.spl) ~ fitted(Intake.spl))<br/>abline(h = 0, col = "gray")<br/>rcspline.eval(Datalong$Time, nk=4, inclx=TRUE) # 3, 10, 17, 23</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq pb lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/f1e78875f478670048632c7c26743ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*isKB5clLDbe1c4UFZJh5Nw.png"/></div></figure><figure class="lt lq pc lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/2020a9dcec44eff14068a8a6441d838a.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*Q3abduRnmJ8t5rK-drPfxg.png"/></div></figure><figure class="lt lq pd lv lw lx ly paragraph-image"><img src="../Images/8e3325c364357874df7e8ca8d4c06111.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*z43u8Oo1w1Zo2E6sgMWwsw.png"/><figcaption class="mo mp gj gh gi mq mr bd b be z dk pe di pf mz translated">rcspline.eval 函数选择 3、10、17 和 23 作为放置结的最佳位置。但是，因为我想让生物学在这里领先，我将坚持 9、14、17、19 和 21。</figcaption></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="3e96" class="li lj in le b gy lk ll l lm ln">LME.model.5&lt;-lme(Intake~1+Baseline+ns(Time,knots=c(9,14,17,19,21))+Treatment+Department, <br/>                 data=Data_new, <br/>                 random=~ns(Time,knots=c(9,14,17,19, 21)),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>anova(LME.model.4, LME.model.5)<br/>plot(augPred(LME.model.5,level=0:1))<br/>summary(LME.model.5)<br/>plot(LME.model.5)<br/>plot(ACF(LME.model.5))<br/>resid&lt;-residuals(LME.model.5)<br/>qqline(resid)<br/>plot(ranef(LME.model.5))</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq pg lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/44b0d8107ee3514d45e949df7ad32609.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*WrWOIUsSUjvgLzUaGDpJVA.png"/></div></figure><figure class="lt lq pg lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/e6abbd1e22e8bed1c6cc72c32e637ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*vKvYCgGWny5GmBAhORG_xQ.png"/></div></figure><figure class="lt lq ph lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/22046555d762c590a9df8ee9bca2ee2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*sLGm_1X2A6z2g16om9tDtQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk pi di pj mz translated">看起来不错！</figcaption></figure></div><p id="da98" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，更多的模型。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2e69" class="li lj in le b gy lk ll l lm ln">LME.model.6&lt;-lme(Intake~1+Baseline+rcs(Time,knots=c(9,14,17,19,21))+Treatment+Department, <br/>                 data=Data_new, <br/>                 random=~rcs(Time,knots=c(9,14,17,19, 21)),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>anova(LME.model.4, LME.model.5, LME.model.6) # Rcs is worse - although individual fits are very good!<br/>plot(augPred(LME.model.6,level=0:1))<br/>summary(LME.model.6)<br/>VarCorr(LME.model.6)</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pk"><img src="../Images/fc9c2a55ab497fdd1eb0dba26f4ba3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fm2mB39utDbjhfMOKkMNMw.png"/></div></div></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="3286" class="li lj in le b gy lk ll l lm ln">LME.model.7&lt;-lme(Intake~1+<br/>                   Baseline+<br/>                   I(Time*(Time&lt;9))+<br/>                   I(Time*(Time&gt;=9&amp;Time&lt;14))+<br/>                   I(Time*(Time&gt;=14&amp;Time&lt;17))+<br/>                   I(Time*(Time&gt;=17&amp;Time&lt;21))+<br/>                   I(Time*(Time&gt;= 21))+<br/>                   Treatment+Department,<br/>                 data=Data_new, <br/>                 random=~I(Time*(Time&lt;9))+<br/>                   I(Time*(Time&gt;=9&amp;Time&lt;14))+<br/>                   I(Time*(Time&gt;=14&amp;Time&lt;17))+<br/>                   I(Time*(Time&gt;=17&amp;Time&lt;21))+<br/>                   I(Time*(Time&gt;= 21)),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>anova(LME.model.6, LME.model.7) # broken line is worse fit</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/761f5820033a21a70be38274d4499bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*CHVQxmB0XElp0B1PukiObA.png"/></div></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="33f9" class="li lj in le b gy lk ll l lm ln">plot(LME.model.7)<br/>qqnorm(resid(LME.model.7))<br/>qqline(resid(LME.model.7))<br/>plot(ranef(LME.model.7)) # same amount of parameters as RCS or NS, so does not make sense to do a piecewise linear fit</span><span id="6add" class="li lj in le b gy lo ll l lm ln">LME.model.8&lt;-lme(Intake~1+<br/>                   Baseline+ns(Time, knots=13,17)+<br/>                   Treatment+<br/>                   Department,<br/>                 data=Data_new, <br/>                 random=~ns(Time, knots=13,17),<br/>                 method="ML", <br/>                 control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>anova(LME.model.7, LME.model.8) # cubic spline has better fit</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/2507bad1a46ba2d3748f8fc59e7fca4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*aKynu5fJzSpL1D8emtaUmw.png"/></div></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2f54" class="li lj in le b gy lk ll l lm ln">jtools::plot_summs(LME.model.2,<br/>                   LME.model.8,<br/>                   robust = "HC3", <br/>                   model.names = c("Model 2", "Model 8"))</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pn"><img src="../Images/58cc6281c42c7ed311591804914a2a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2U4vaqUytvdW1oQt9rJvQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">模型 2 和模型 8 是唯一允许比较的。不知道为什么说实话。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b3d7" class="li lj in le b gy lk ll l lm ln"># Influence diagnostics<br/>library(influence.ME)<br/>inf&lt;-influence(fit.lmer, obs=TRUE) # a lot of warnings --&gt; failures to converge<br/>inf2&lt;-influence(fit.lmer, group="Sow") # also here, failures to converge<br/>plot(pchange(inf))<br/>plot(inf)<br/>sigtest(inf2)<br/>plot(inf2, which="dfbetas")</span><span id="bebe" class="li lj in le b gy lo ll l lm ln"># Cooks distance<br/>plot(inf2, which="cook", sort=TRUE) # cutoff is 2/sqrt(n) where n is the number of groups specified --&gt; so here, cutoff is:<br/># is actually the cutoff for standardized beta 2/(sqrt(length(unique(Datalong$Sow))))<br/># Traditional cutoff value for cooks distance is 4/n, which is 4/(length(unique(Datalong$Sow))) --&gt; but still the programm does not pcik it up apparantly..</span><span id="1928" class="li lj in le b gy lo ll l lm ln">cd&lt;-as.data.frame(cooks.distance(inf2))<br/>cd$Sow&lt;-rownames(cd)<br/>ggplot(cd, aes(x=V1, y=Sow))+<br/>  geom_point()+<br/>  labs(x="Cooks Distance", y="Sow")+<br/>  ggtitle("Influence Diagnostics: Cooks Distance")+<br/>  theme_bw()+<br/>  geom_vline(xintercept=2/(sqrt(length(unique(Datalong$Sow)))), colour="red", lty=2)<br/>plot(inf2, which="cook", cutoff=4/(length(unique(Datalong$Sow))),sort=TRUE, xlab="Cook's Distance", ylab="Sow")</span></pre><div class="kz la lb lc gt ab cb"><figure class="lt lq po lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/df0c4474534d81164799812962d4d86d.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*I0JoYvJwtVeBV1ZBVSbMzw.png"/></div></figure><figure class="lt lq pp lv lw lx ly paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/60e6438f4e984b39e221c345f5f01e0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*RxOo23KGTc1AEVnaWJ75cg.png"/></div></figure></div><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9c7f" class="li lj in le b gy lk ll l lm ln">library(hnp)<br/>half&lt;-hnp(fit.lmer, sim=500, col.paint.out=TRUE, how.many.out=TRUE) </span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pq"><img src="../Images/e470ba56de939991c28800ff7ac275f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPlMEMYfwEFUbhlVAN1mdw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">统计极客的半正态分布图。</figcaption></figure><p id="8c02" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，对于任何商业数据集来说，这都是为了找到治疗的统计意义。这些 ls 均值(来自模型的处理均值，而不是来自数据的观察均值)需要一些审查。例如，在寻找差异时，不应该使用并列置信区间来进行比较。原因是因为均值的标准误和均值差异的标准误(SEs)不一样！事实上，当比较受试者内治疗的水平时，它们可以有很大的不同，其中平均值的 SEs 包括受试者之间的差异，但差异的 SEs 不包括受试者之间的差异。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="c56f" class="li lj in le b gy lk ll l lm ln">comp1&lt;-glht(fit.lmer, mcp(Treatment="Tukey")) # multcomp<br/>comp2&lt;-glht(fit.lmer, lsm(pairwise ~ Treatment))# lsmeans<br/>comp1.cld&lt;-cld(comp1)<br/>par(mai=c(1,1.5,1,1), no.readonly=TRUE)<br/>plot(comp1.cld)<br/>par(mai=c(1,1.5,1,1), no.readonly=TRUE)<br/>plot(comp1) # ugly but informative plot <br/>abline(v=0,lty=2,col="gray50")</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pr"><img src="../Images/162904a3adc23421030d6d0ebe6987b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5JKBQtXhVVpiVpF53bf9g.png"/></div></div></figure><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ps"><img src="../Images/9391291e083d07cf831291dc0ff4b3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTVyyZ1VABnzP1FnWKzm1g.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated"><strong class="bd nc"> lsmeans </strong>包中的箭头来源于均值对之间差异的置信区间长度，以及这些区间与零的重叠程度。</figcaption></figure><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="4c99" class="li lj in le b gy lk ll l lm ln">fit.orig&lt;-lsmeans::lsmeans(fit.gls2, ~Treatment|Time, cov.reduce=FALSE)<br/>summary(fit.orig, type="response")<br/>pairs(fit.orig, type="response")<br/>fit.lsm&lt;-lsmeans::lsmeans(fit.gls, ~Treatment|Time, cov.reduce=FALSE)<br/>summary(fit.lsm, type="response") <br/>pairs(fit.lsm)<br/>plot(fit.lsm, intervals = TRUE, int.adjust = "none", comparisons = TRUE)</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/27925646ae72aa6ee5c89a1081924837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*0MP52zPgR_2HfgEnhZjyHg.png"/></div></figure><p id="57c9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，但并非最不重要的，一个预测图，看看模型是否有所作为。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="ee21" class="li lj in le b gy lk ll l lm ln">datapredict&lt;-augment(fit.lmer)<br/>Datalong$fitted&lt;-predict(fit.lmer)<br/>ggplot(Datalong, aes(x=Time, group=Sow))+<br/>  geom_point(aes(y=LogIntake)) + geom_line(aes(y=LogIntake))+<br/>  geom_point(aes(y=fitted), color="red", alpha=0.5) + geom_line(aes(y=fitted), color="red", alpha=0.5)+<br/>  facet_grid(~Treatment)+<br/>  labs(title = "Predicted vs Observed from fit.lmer model")+<br/>  theme_bw()</span></pre><figure class="kz la lb lc gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pu"><img src="../Images/08d7dee3c682ae7e7fe3fe6f141e7a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SOPtK6xz2EdDpzN3iKHJA.png"/></div></div></figure><p id="5bc2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总而言之，采食量数据不容易建模，但肯定不是不可能的。我相信你能比我做得更好，所以请告诉我！</p></div></div>    
</body>
</html>