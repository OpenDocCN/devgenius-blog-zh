<html>
<head>
<title>Firebase — The Way to Fast Track Authentication Implementation of Your App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase —快速跟踪应用程序身份验证实施的方法</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/firebase-the-way-to-fast-track-authentication-implementation-of-your-app-2e93f42002b?source=collection_archive---------20-----------------------#2020-07-12">https://blog.devgenius.io/firebase-the-way-to-fast-track-authentication-implementation-of-your-app-2e93f42002b?source=collection_archive---------20-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0f7c9312dba6a90b41cbd2ac7256d7c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nlLQZJ-YbkQ1_Ifc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">沙哈达特·拉赫曼在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="19db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有一个绝妙的想法，并渴望在短时间内马上实现它，你应该考虑可以提高生产力和加速开发的工具。采用基于云的平台和现成的解决方案绝对是一个不错的选择，您不仅可以享受可扩展基础架构的好处，还可以避免重新开发登录、安全控制和后端存储等常见功能。</p><p id="eae1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，当我通过启用身份验证和迁移到基于云的后端存储来改造我的个人应用程序时，我意识到了 Firebase 现成服务的力量。因此，我渴望分享我的经验，并希望它能对你有所帮助，如果你有兴趣用较少的努力来增强你的应用程序。在本文中，我将重点介绍身份验证设置，并演示如何使用 Firebase 服务实现我的应用程序。</p><h1 id="acde" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">燃烧基地</strong></h1><p id="5932" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在应用程序开发方面，Firebase 是我最喜欢的伙伴。为什么？它提供了各种令人惊叹的现成服务，让移动应用程序开发变得更加容易。它是谷歌的一部分，所以我可以使用我的谷歌帐户管理 Firebase 服务。这些后端服务可以在控制台中轻松配置，即开发人员友好的应用集成 SDK，从而提高生产力并加快应用构建。</p><h1 id="1047" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">费用追踪应用</strong></h1><p id="5495" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">几年前我为自己开发的支出跟踪应用程序是一个简单但有用的工具，可以跟踪我的日常支出，它还让我知道我当前和历史的支出，以便我可以管理和控制我的支出。技术方面，它是一个 Ionic 混合应用程序，在我的手机中存储 SQLite 数据库中的记录。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/cefabcb6c0c53d6434896da6ba3d7c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2n2rJWgb7aoNykiG9ZWrGw.jpeg"/></div></div></figure><p id="4e11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该计划旨在转变应用程序功能，并将本地数据库移动到具有多用户配置文件支持的云后端存储。因此，认证和安全控制是保护数据访问的基本特征。</p><p id="8d07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该应用是基于 React Redux 的框架构建的，如果你想重温 React Redux 的关键概念，可以参考这篇<a class="ae kc" href="https://medium.com/@gavinklfong/develop-your-own-expense-tracker-app-using-react-redux-50dffd3409e4" rel="noopener">文章</a>。在本文中，我将利用这个应用程序来演示 Firebase 身份验证的实现。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="2101" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated"><strong class="ak"> Firebase 认证功能</strong></h1><p id="f52e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们来看看认证。Firebase 提供了许多登录方法，包括基本的电子邮件和密码，以及由 Google、脸书、GitHub 等身份提供商提供的 OAuth 认证。要启用身份验证服务，您可以首先在 Firebase 控制台中创建一个项目，然后在控制台上打开目标登录方法。对于我的应用程序，我启用了两种登录方式——电子邮件和密码以及谷歌。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/c41ecb4647cdbdbde981dc316476bcc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJCh3S2EFHWkEYn64eUhZA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Firebase 控制台—身份验证登录方法</figcaption></figure><h2 id="d1a5" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">登录方式—电子邮件&amp;密码</strong></h2><p id="f450" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是一种基本的身份验证，你可以用初始密码注册电子邮件地址作为登录 id。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/9c398d22db946b22921693198044cc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3i7uLz-6SUu4pokrNmi09g.jpeg"/></div></div></figure><p id="c401" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种登录方法带有邀请电子邮件和密码重置的标准功能，Firebase 允许定制电子邮件内容模板。Firebase SDK 提供了系统实现屏幕流的函数调用，以触发密码重置、电子邮件验证和电子邮件地址更新。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/2eb6aba3aecb01f47b148ff87755fdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McpEktBjFbYRUbuMtv7xlw.jpeg"/></div></div></figure><h2 id="1d7f" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">登录方式——登录谷歌、脸书微软……</strong></h2><p id="07ec" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">第三方登录提供商的支持改变了游戏规则，因为它允许用户使用现有身份登录，而不是创建一组新的凭据，从而提供了出色的用户体验。Firebase 支持登录提供者列表，可以通过简单的配置在 Firebase 控制台上启用，例如注册的客户端 ID 和密码。下面的示例截图是 Google 和 GitHub 登录的配置</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/975cb88bb2a3e3caba682509adc85e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5avz2j9VYZM2ATN5R34Hqw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Google 登录配置</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/1222e99fefb4a7b1a06b23b1ff19c1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnMbXzrDR-JLLKgVWx7KoA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">GitHub 登录配置</figcaption></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="782d" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated"><strong class="ak">用于</strong>认证的 App 集成</h1><p id="3c95" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">一旦我们在 Firebase 控制台上完成了配置，我们就可以开始在 app 上进行集成了。Firebase 提供了开发人员友好的 SDK，因此我们可以通过几个函数调用轻松实现登录。</p><h2 id="12d3" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">认证服务组件</strong></h2><p id="7028" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">根据软件开发的最佳实践，我强烈建议创建一个 facade 服务，以提供一个服务于身份验证功能的前端，目的是消除 app logic 对 Firebase SDK 的直接依赖，从而在我们需要切换到另一个底层服务提供商时提供灵活性，或将未来新版本 SDK 引入的突破性变化可能带来的影响降至最低。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/eb5fc8387b532b5bd86cced41b61380b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekSh8CS2dIsmYK9Y5OoMNA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">组件图—与 Firebase SDK 的集成</figcaption></figure><p id="4bef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是<strong class="kf ir"> AuthService </strong>的示例实现。它是一个单一服务组件，提供身份验证服务并与应用程序逻辑接口。首先，配置 firebase-api.json 可以在 firebase 控制台上生成，它是让 SDK 知道要连接到哪个项目的配置。然后，Firebase SDK 实例可以用配置进行初始化，然后调用任何身份验证函数。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="7b74" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">登录屏幕</strong></h2><p id="14e1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在，让我们来看看登录屏幕。它是一个 React 功能组件，有两个按钮，分别用于电子邮件和谷歌的登录。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/de2d8ee9662c22f5def413e05bca4246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEIjR8N3OxwpQruGzB62uw.jpeg"/></div></div></figure><p id="6cac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该代码片段是登录页面 React 组件的简化版本</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="d14e" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">使用电子邮件地址&amp;密码</strong>登录</h2><p id="c04b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这种登录方法简单明了，用户只需输入电子邮件地址和密码。然后，在 AuthService 上调用一个函数来验证 Firebase 中的记录。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/e5136b6e68fb65a856bf2eee87b67a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rvs0f4YaNsG5zwOR1uH5Hg.png"/></div></div></figure><p id="880b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是 Redux 异步操作的示例代码，当用户点击按钮“用你的电子邮件登录”来验证电子邮件地址和密码时，登录屏幕会发送该代码。为了提供更好的用户体验，登录挂起操作被分派来相应地更新状态，以便在验证电子邮件和密码之前显示加载覆盖。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="2186" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">登录谷歌</strong></h2><p id="4fd3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这种方法利用 OAuth 协议将认证委托给第三方，在本例中是 Google。让我用下面的图表演示一下场景背后的流程。</p><ul class=""><li id="8940" class="nr ns iq kf b kg kh kk kl ko nt ks nu kw nv la nw nx ny nz bi translated"><strong class="kf ir"> <em class="oa">【步骤 1–2】—</em></strong>当用户按下按钮登录 Google 时，费用跟踪程序会将用户重定向到 Google 进行登录。</li><li id="46aa" class="nr ns iq kf b kg ob kk oc ko od ks oe kw of la nw nx ny nz bi translated"><strong class="kf ir"> <em class="oa">【步骤 3–6】—</em></strong>用户向 Google 提供 ID 和凭据进行登录。身份验证完成后，Google 返回一个令牌，并将用户重定向回 Expense Tracker 应用程序，因为 Google 知道这是 OAuth 身份验证，而不是正常登录。</li><li id="f85f" class="nr ns iq kf b kg ob kk oc ko od ks oe kw of la nw nx ny nz bi translated"><strong class="kf ir"> <em class="oa">【步骤 7–10】—</em></strong>费用追踪应用程序使用令牌从谷歌检索用户信息(如姓名)，并完成整个登录过程。</li></ul><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/1e3b3d460465c097f85248996a55b64a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*35gqDeP_HLaNUGMIfKEIxg.jpeg"/></div></figure><p id="5b92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看代码片段。该动作显示了将用户重定向到 Google 进行登录的函数调用<strong class="kf ir"> <em class="oa">【步骤 1–2】</em></strong></p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="9d9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成谷歌登录后，谷歌将提供一个令牌，并将用户重定向回应用程序。下面的 React 钩子从 Google <strong class="kf ir"> <em class="oa">【步骤 7–10】中提取并处理认证结果。</em> </strong>如果用户信息未定义或为空，表示登录失败或用户取消了登录。我们应该更新状态以表明登录已被取消。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="6dca" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">成功登录的处理</strong></h2><p id="a8f7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">您可能会注意到，到目前为止我展示的代码片段只涉及到启动登录的动作分派，但是成功登录后的后处理是什么呢？如果登录已经完成，系统应该导航到登录屏幕或主屏幕，而不是停留在登录屏幕。</p><p id="36a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们依靠事件驱动的流程来处理成功登录的后处理<strong class="kf ir"> </strong>。无论使用何种登录方法，只要身份验证状态发生变化(如成功登录), Firebase 就会发出一个事件。一旦接收到事件，事件处理程序触发更新应用状态中的<em class="oa">【已认证】</em>指示器的动作。接下来，应用程序状态的更改将触发登录屏幕挂钩导航到费用列表。下图显示了事件流:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/72d3c412c285c36f368f17198f4f4e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lfPfX5S7FsfVXoXvYr3cA.jpeg"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">事件流-登录后处理</figcaption></figure><p id="808e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="oa">认证状态事件处理程序</em> </strong></p><p id="8182" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当用户对象的身份验证状态发生变化时，意味着用户已经成功登录。然后，事件处理程序分派动作来更新应用程序状态，例如设置<em class="oa">【is authenticated】</em>指示器和打开加载覆盖</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="cc5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="oa">登录屏幕挂钩</em> </strong></p><p id="6495" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是在 app 状态下监听<em class="oa">【is authenticated】</em>指示器变化的处理程序。如果<em class="oa">【is authenticated】</em>指示器更新为真，app 自动导航到目标屏幕或费用记录列表屏幕。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="c000" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">登录会话持续&amp;自动登录</strong></h2><p id="f0bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">保留现有的登录会话是一个至关重要的功能，否则，用户每次访问应用程序时都需要登录。幸运的是，Firebase 默认保持登录会话，以便系统在下次访问应用程序时识别用户的身份，并直接进入费用记录列表屏幕。不需要开发任何额外的逻辑来支持自动登录，因为 Firebase 会自动检测持续登录会话，并向应用程序发出事件以进行相应的处理。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="25d0" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated">最终想法</h1><p id="8709" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">由于对访问控制和私有数据及资源保护的需求不断增长，身份认证是当今大多数应用程序所必需的基本和强制功能。然而，实现可能是痛苦和复杂的，尤其是通过 OAuth 与各种第三方身份提供者的集成。利用 Firebase 现成的身份验证服务作为构建块可以大大简化集成，从而大大减少开发工作。</p><p id="bd69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了身份验证，我们可以继续将应用程序数据迁移到持久数据存储。我的下一篇分享将继续 Firebase 数据存储的应用程序开发之旅，我将介绍数据模式设计以及我们如何在 Firebase 数据存储中实现数据安全规则。</p></div></div>    
</body>
</html>