<html>
<head>
<title>Cypress E2E automation tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">赛普拉斯 E2E 自动化测试</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/cypress-e2e-automation-tests-4a1f38beb324?source=collection_archive---------3-----------------------#2021-04-16">https://blog.devgenius.io/cypress-e2e-automation-tests-4a1f38beb324?source=collection_archive---------3-----------------------#2021-04-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6fe6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">端到端测试中的一些常规和 mad 情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b1a56a34a2bd708e7c1799f60934ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7ih2zzcCyifrZJ2lOy0FQ.png"/></div></div></figure><p id="9aaa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">单元测试并不是我们需要用来覆盖代码的唯一可能性。端到端测试对于检查 web 应用程序的用户流也很重要。在这里，我将我的一些经验与 Cypress 框架结合起来。</p><p id="1473" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，让我们将柏树添加到项目中:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="5122" class="kz la in kv b gy lb lc l ld le">n<!-- -->pm install cypress<br/>or<br/>yarn add cypress --dev</span></pre><p id="926d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以轻松打开 Cypress 独立交互应用程序:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="2674" class="kz la in kv b gy lb lc l ld le">npx cypress open<br/>or<br/>ng e2e --watch</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lf"><img src="../Images/16883a6d0adf3853268e4114807ba607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5P5CWx9LURqe56RyKi70g.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">Cypress 应用程序运行特定测试</figcaption></figure><p id="54a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您需要启动您的 Angular 项目(ng serve 命令)，例如，它将在<a class="ae lk" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>上运行，并允许 Cypress 在 Angular 上运行 E2E 测试。</p><p id="0b6f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没关系，您将在旧项目或新项目中使用哪个版本的 Cypress。我们总是有方法来模拟页面上的 UI 动作，做出断言并验证它。</p><p id="2976" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">客户机/服务器测试的想法很简单。我们定义页面的行为，然后让<strong class="jm io">访问()。</strong></p><p id="f1d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对服务器的请求可能是真实的，或者我们可以添加存根 json 响应:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="7f44" class="kz la in kv b gy lb lc l ld le">cy.server()<br/>cy.route('/account/*').as('getAccount')<br/>cy.visit('/account/1')<br/>cy.wait('@getAccount').then((xhr) =&gt; {<br/>  // now get the xhr details: body, status...<br/>})</span></pre><p id="35a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Get </strong>关键字——它可以用来获取页面上的常规 UI 元素。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="35ed" class="kz la in kv b gy lb lc l ld le">describe('should test select element', () =&gt; {<br/>  before(function () {<br/>    cy.visit('http://localhost:5000/')<br/>  })<br/><br/>  it('signs up a new user', () =&gt; {<br/>    cy.get('button').contains('Create').click();<br/>    cy.get('#season').select('Spring', {force: true });<br/>    cy.get('#season').contains('Spring')<br/>  });<br/>});</span></pre><p id="24bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者使用 Cypress 的另一个例子——制作 XHR 请求的存根。存根响应确实非常有用。我们创建 fixture 文件夹并存储响应 json 文件。</p><p id="74ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">嘲讽和存根有什么区别？</p><p id="6b8a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">模仿意味着在测试中用一个伪造的副本替换功能，并提供一些与之交互的功能。<br/> Stubbing 是指用假版本替换 api 网络请求或服务。</p><p id="872c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Route </strong> —拦截 XMLHttpRequests 并改变网络请求的行为。在 Cypress 版本≥ 6 中实现了 Fetch。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="f738" class="kz la in kv b gy lb lc l ld le">describe('should be predicted response', () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    cy.server();<br/>    cy.route({<br/>      method : 'GET',<br/>      url: '/account/',<br/>      status: 200,<br/>      response: {<br/>        id: 1,<br/>        phone: 'Test12345',<br/>        email: 'test@test.com',  <br/>      },<br/>    });<br/>  });<br/>  it('successfully loads', () =&gt; {<br/>    cy.visit('/account');<br/>  });<br/>});</span></pre><p id="8866" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">拦截</strong> —从 Cypress 6 开始，最好使用这种改进的方法。而不是不推荐使用的服务器()和路由()。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="a57e" class="kz la in kv b gy lb lc l ld le">cy.intercept({<br/>      method: 'GET',<br/>      url: '**/api/**',<br/>    }).as('MyQuote');<br/>cy.wait('@MyQuote').its('status').should('be', 200);</span></pre><p id="2a73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是<strong class="jm io">拦截</strong>行为已经改变:我们不能使用 fixture json 作为变量。此参数应设置为文本等。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="ef66" class="kz la in kv b gy lb lc l ld le">cy.intercept('GET', '/api/work', { fixture: 'stubWork.json' })</span></pre><p id="f1b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是可以这样做:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="8f25" class="kz la in kv b gy lb lc l ld le">cy.intercept('POST', '/api/work', req =&gt; {<br/>    body = req.body<br/>  }).as('myWork');</span></pre><p id="459e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Its </strong>关键字—获取前一个对象的请求属性。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="5d3d" class="kz la in kv b gy lb lc l ld le">// Wait for response.status to be 200<br/>cy.wait('<a class="ae lk" href="http://twitter.com/dataGetFirst" rel="noopener ugc nofollow" target="_blank">@</a>MyApiData').its('status').should('be', 200);</span><span id="8ee8" class="kz la in kv b gy ll lc l ld le">// get length of checkboxes array<br/>cy.get('.checkbox').its('length').then(($lenght) =&gt; { ... });</span></pre><p id="0f08" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Should </strong>关键字—创建带有条件的断言，以检查元素如何改变其自身的状态。</p><p id="7c45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它可以是不同的条件:存在或不存在、有值、css 或文本、可见或不可见等等。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="4cdb" class="kz la in kv b gy lb lc l ld le">    cy.contains('button', 'Submit').click();<br/>    cy.get('[data-ng-show="user"]', { timeout: 500 })<br/>      .should('be.visible').then(() =&gt; {<br/>         cy.get('[data-ng-show="user"]').click();<br/>   })</span></pre><p id="e594" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">在 vs 中查找</strong> —在父元素范围内工作</p><p id="7098" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">。find()用于对一个元素进行单次搜索，但是只能对该元素进行操作</p><p id="421f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">。within()允许您更改搜索子元素的范围，并使用 cy.get()直接调用它们</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="8c98" class="kz la in kv b gy lb lc l ld le">cy.get("#el").within(() =&gt;<br/>   cy.get("input").should("have.value", value));<br/>or<br/>cy.get(element).find(subelement);</span></pre><p id="224a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">然后</strong>(父元素)<strong class="jm io"> — </strong>关键字，允许您将元素传递给函数使用。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="5b9e" class="kz la in kv b gy lb lc l ld le">cy.get('@example').then((example) =&gt; {<br/>    cy.log(example);<br/>    <!-- -->cy.get(example).find('subelementSelector');<br/>});</span></pre><p id="7905" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">请求</strong> —使用标题、方法等具体细节提出请求。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="88e3" class="kz la in kv b gy lb lc l ld le">const options = {<br/>      method: 'GET',<br/>      url: '**/api/quote/**',<br/>      auth: {<br/>        username: 'user',<br/>        password: 'password',<br/>      },<br/>      headers: {<br/>        contentType: 'application/json',<br/>      }<br/>    };<br/> <br/>cy<!-- -->.server()<!-- -->.request(options).then((response) =&gt; {<br/>  expect(response.status).to.eq(200);<br/>  console.log(response.body);<br/>})</span></pre><p id="35c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">Wrap</strong>——只要等到承诺解决。如果承诺被批准，cy.wrap()将成功通过测试。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="44cf" class="kz la in kv b gy lb lc l ld le">cy.wrap($input)<br/>  .first()<br/>  .should($inputfield =&gt; expect($inputfield).to.be.visible)<br/>  .click()<br/>  .clear()<br/>  .type('test');<br/>cy.wrap($input).parent().find('span').click();</span></pre><h1 id="c6fd" class="lm la in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">一些实际任务</strong></h1><p id="501a" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated"><strong class="jm io">任务一</strong>。获取 HTML 表格的第一行或最后一行</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="0044" class="kz la in kv b gy lb lc l ld le">cy.get(".tariff-selection-table &gt; tbody td")<br/>      .last()<br/>      .click();<br/>    cy.get("#apply-button").click();</span></pre><p id="4dcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者用另一种方法得到最后一行 TR</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="c1e4" class="kz la in kv b gy lb lc l ld le">cy.get('.table').find('tr')<br/>        .then(tr =&gt; {<br/>          const count = Cypress.$(tr).length;<br/>          cy.get('tr').its('length').should('be.gt', 1);<br/>          cy.get(`#selection-table-row-${count-1}`).click();<br/>        });</span></pre><p id="5b0c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务二</strong>。找不到别名。CypressError: cy.wait()找不到“<a class="ae lk" href="http://twitter.com/CoverLetter" rel="noopener ugc nofollow" target="_blank"> @ </a> QuotationRequest”的注册别名。</p><p id="7a1e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请求应及时提出。柏树干得太快了。有时您需要使用 cy.wait(500)毫秒，但是最好使用等待异步操作的别名。</p><p id="6946" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，我们可以在日志中看到已经发出了 2 个请求</p><p id="5f89" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GET/<a class="ae lk" href="http://localhost:4200/api/rest-client/fclquotations/rates" rel="noopener ugc nofollow" target="_blank">API/rest-client/quotes/rates</a>504 2029.601 ms—-</p><p id="5461" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GET/_ _ cypress/xhrs/<a class="ae lk" href="http://localhost:4200/api/rest-client/fclquotations/rates" rel="noopener ugc nofollow" target="_blank">http://localhost:4200/API/rest-client/quotes/rates</a>200 15.544 ms—-</p><p id="1f85" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当组件启动时(在 Cypress 之前)，第一个请求由应用程序自己发出，第二个请求是 Cypress 正确的请求。</p><p id="37c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，Cypress 应该在应用程序执行之前处理请求，否则您将收到一个 504 错误。<br/> <strong class="jm io">由于</strong>关键字创建了 async/await 操作的别名，<strong class="jm io"> wait </strong>关键字只是等待该别名操作结束。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="3169" class="kz la in kv b gy lb lc l ld le">//lets create separate class for methods<br/>stubQuotationRequest() {<br/>  <em class="mo">cy</em>.server()<br/>    .route("GET", "**/api/rest", "fixture:response")<br/>    .as("QuotationRequest");<br/>}<br/>waitForQuotationResponse() {<br/>  <em class="mo">cy</em>.wait("@QuotationRequest");<br/>}</span><span id="8312" class="kz la in kv b gy ll lc l ld le">//now use it in E2E test<br/>stubQuotationRequest();<br/>waitForQuotationResponse();</span></pre><p id="cf44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务三</strong>CypressError:重试超时:应找到元素:“. button.error”，但从未找到。</p><p id="36b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有时我们需要检查元素是否出现在 UI 中，并用它来检查 if/else。可能会出现这样的情况，测试在 localhost 上工作正常，但是由于 api 请求而在 Jenkins 上工作不正常。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="0586" class="kz la in kv b gy lb lc l ld le">    cy.get("body").then($body =&gt; {<br/>      if ($body.find(".button.error").length &gt; 0) {<br/>        cy.get(".button.error").click();<br/>      }<br/>    });</span></pre><p id="e1aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务四</strong>。使用我自己的数据属性，这样更容易定位元素。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="3e2b" class="kz la in kv b gy lb lc l ld le">Let's create custom html component MyButton:<br/>&lt;button class="button" [name]="label" (click)="onClick()"<br/>        [attr.data-cy]="dataCy || null" /&gt;</span><span id="facb" class="kz la in kv b gy ll lc l ld le">use it in Typescript component:<br/>export class MyButton {<br/>  <a class="ae lk" href="http://twitter.com/Input" rel="noopener ugc nofollow" target="_blank">@Input</a>() dataCy?: string;</span><span id="d7f8" class="kz la in kv b gy ll lc l ld le">and spec test it:<br/>  it("should render the default data type of the button", () =&gt; {<br/>    component.dataCy = "submit";<br/>    fixture.detectChanges();<br/>    expect(fixture.nativeElement.querySelector(MyButton")<br/>      .getAttribute("data-cy")).toBe("submit");<br/>  });</span><span id="66e6" class="kz la in kv b gy ll lc l ld le">now it is the time to use component in application:<br/>  &lt;MyButton label='testButton' class='classButton'<br/>     dataCy='myButtonCyId' ... /&gt;</span><span id="0bf3" class="kz la in kv b gy ll lc l ld le">Cypress can access to custom attribute like this:<br/>    cy.get('[datacy="myButtonCyId"]').should('be.visible')<br/>      .should('have.attr', 'datacy', 'myButtonCyId');</span></pre><p id="ca20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">任务五。测试文本与搜索文本进行比较。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="2bc5" class="kz la in kv b gy lb lc l ld le">cy.get('.myInput').invoke('text').should(input =&gt; {<br/>  expect(input.toLowerCase()).to.contain(search.toLowerCase());<br/>})</span></pre><p id="0a9f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">任务六。force:没错——要激励 Cypress 做自己想做的事。<br/>在前一个输入框中输入内容后，您试图在第一个输入框中输入内容。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="9074" class="kz la in kv b gy lb lc l ld le">cy.get("#firstInput").click({ force: true});<br/>cy.get("#firstInput").clear({ force: true});<br/>cy.get("#firstInput").type("First text");<br/>cy.get(".anotherInput").clear({ force: true });<br/>cy.wait(500);<br/>cy.get("#secondInput").type("Second text");</span></pre><p id="c345" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">任务 7 。scrollTo()没有像我们预期的那样工作:在页面上找不到元素。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="7bc3" class="kz la in kv b gy lb lc l ld le">cy.get('.myClass').scrollTo('bottom');</span></pre><p id="36c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用 scrollIntoView()来代替:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="9e6a" class="kz la in kv b gy lb lc l ld le">cy.get("#myId").scrollIntoView();</span></pre><p id="bd96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务 8 </strong>。借助“each”关键字迭代相似的项目。</p><p id="0eb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设我们有许多类'价格头'。我们想结合价值观</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="a417" class="kz la in kv b gy lb lc l ld le">    let topTotal = 0.00;<br/>    cy.get(".price-header").each(($el, index) =&gt; {<br/>      if (index % 3 === 0) topTotal += parseFloat($el.text());<br/>    }).then(() =&gt; {<br/>      expect(topTotal).greaterThan(0); // or .equals(100);<br/>    });</span></pre><p id="17a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者举例来说，我们必须访问每个输入并写入新值</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="346a" class="kz la in kv b gy lb lc l ld le"> cy.get('.input-price-valid')<br/>   .each(($el, index, $list) =&gt; {<br/>      cy.wrap($el).type(value).click();<br/>   });</span></pre><p id="9a5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务 9 </strong>有时 type()输入文本非常慢。我们可以使用一些技巧:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="5c33" class="kz la in kv b gy lb lc l ld le"><strong class="kv io"><em class="mo">cy</em></strong>.get('.rate')<br/>  .within(() =&gt;<br/>    <strong class="kv io"><em class="mo">cy<br/>      </em></strong>.get("input")<br/>      .type(myValue, {delay: 0})<br/>      <!-- -->.type('{enter}')<br/>  );</span></pre><p id="ecb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者我们可以复制+粘贴整个值，而不是使用类型关键字(类型包含这么多 DOM 事件)</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="c93b" class="kz la in kv b gy lb lc l ld le"><strong class="kv io"><em class="mo">cy</em></strong>.get(".rate").within(() =&gt;<br/>  <strong class="kv io"><em class="mo">cy</em></strong>.get('input')<br/>    .invoke('val', myValue)<br/>    .trigger('change')<br/>);</span></pre><p id="8181" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务十</strong>。CypressError: `cy.then()`失败，因为您混淆了异步代码和同步代码。</p><p id="8b26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在运行其他方法之前，我们必须等待同步返回值:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="f25b" class="kz la in kv b gy lb lc l ld le">let carrier = "";</span><span id="a06e" class="kz la in kv b gy ll lc l ld le">// sync code<br/>const result = <strong class="kv io"><em class="mo">cy</em></strong>.get(".prices").click()<br/>  .find('.charge').invoke('text').then((text) =&gt; {<br/>    carrier = text.trim();<br/>    <strong class="kv io"><em class="mo">console</em></strong>.log("carrier: " + carrier);<br/>  });</span><span id="763c" class="kz la in kv b gy ll lc l ld le">// async code<br/><strong class="kv io"><em class="mo">cy</em></strong>.get("#apply-button").click();<br/><br/>result.then(() =&gt; {<br/>  <strong class="kv io"><em class="mo">console</em></strong>.log("carrier result: " + carrier);<br/>  this.verifySelectedLabel(carrier);<br/>});</span></pre><p id="5683" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务十一</strong>。在你的测试中添加循环。有时多次运行测试会很有帮助。你会看到它是否稳定地揭示了代码的衰变位置。</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="3383" class="kz la in kv b gy lb lc l ld le">Cypress._.times(10, () =&gt; {<br/>...<br/>});</span></pre><p id="7bee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">任务 12。</strong>让我们使用正则表达式通过特定模板进行检查:</p><pre class="kj kk kl km gt ku kv kw kx aw ky bi"><span id="75c8" class="kz la in kv b gy lb lc l ld le">cy.get('div.number').contains(/\d+/);</span><span id="3d33" class="kz la in kv b gy ll lc l ld le">cy.contains('div.number', /\d+/);</span><span id="ce02" class="kz la in kv b gy ll lc l ld le">cy.get('.price').contains(/\d+.\d{2} JPY/);</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/033c51305065b425046b0ec62d76e87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rAjXjSm79zZXuulYDbIsrg.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">华金·索罗拉的画，1908 年左右。</figcaption></figure><p id="577d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><p id="78f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样。有时候 Cypress 会让你陷入困境，尤其是 API 请求/响应。我们需要很大的耐心。我们将变化恢复到稳定的状态，并一步一步地前进，以取得积极的成果。可视化自动化测试是必要的，以避免错过最近分支的一些 UI 变化。</p><p id="7d6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">意外的结论</strong></p><p id="3a45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很高兴看到 Cypress 内部使用 jQuery 库来进行简单的迭代操作。jQuery 现在几乎不用了。</p><div class="mq mr gp gr ms mt"><a href="https://docs.cypress.io/api/commands/server#Options" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd io gy z fp my fr fs mz fu fw im bi translated">服务器| Cypress 文档</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">启动一个服务器，开始将响应路由到 cy.route()并更改网络请求的行为。⚠️ cy.route()…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">docs.cypress.io</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh ks mt"/></div></div></a></div><div class="mq mr gp gr ms mt"><a href="https://example.cypress.io/commands/querying" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd io gy z fp my fr fs mz fu fw im bi translated">厨房水槽</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">厨房水槽|柏树示例</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">example.cypress.io</p></div></div></div></a></div><div class="mq mr gp gr ms mt"><a href="https://docs.cypress.io/guides/references/best-practices" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd io gy z fp my fr fs mz fu fw im bi translated">最佳实践| Cypress 文档</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">2018 年 2 月，我们在 AssertJS 举办了“最佳实践”会议。本视频演示了如何接近…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">docs.cypress.io</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh ks mt"/></div></div></a></div></div></div>    
</body>
</html>