<html>
<head>
<title>Add &amp; Remove TextFormFields dynamically in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Flutter 中动态添加和删除文本表单域</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-remove-textformfields-dynamically-in-flutter-5bef6948e778?source=collection_archive---------0-----------------------#2020-07-09">https://blog.devgenius.io/add-remove-textformfields-dynamically-in-flutter-5bef6948e778?source=collection_archive---------0-----------------------#2020-07-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a97f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi ki translated">对了，你的 flutter 表单需要动态添加和删除 TextFormFields 吗？启动时你将初始化多少个文本编辑控制器？当字段被移除时，您将如何正确处理这些控制器？</p><p id="a1f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文将帮助您解决这些问题。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/841b3ae2b8808a5f92cb9b6e4a44df4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WQLrfaYxaY7fpWgeMq45AA.gif"/></div></div></figure><blockquote class="le lf lg"><p id="b365" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">在这里，我来透露一下节省你时间的秘诀:-)。所有动态添加的文本字段本身将是一个有状态的小部件。</p></blockquote><p id="b205" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你愿意，现在可以跳过这篇文章。</p></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><p id="ca11" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还在吗？想看看我是怎么做到的吗？谢谢！</p><blockquote class="le lf lg"><p id="4865" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">好，先立个项目。</p><p id="a189" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">我们的表格将有一个文本字段输入我们的名字，有/有文本字段输入我们的朋友的名字，可以动态添加和删除。</p></blockquote><ol class=""><li id="fb60" class="lr ls in jm b jn jo jr js jv lt jz lu kd lv kh lw lx ly lz bi translated">为我们的表单创建一个有状态的小部件类。</li></ol><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="0bc1" class="mf mg in mb b gy mh mi l mj mk">class MyForm extends StatefulWidget {<br/>  @override<br/>  MyFormState createState() =&gt; MyFormState();<br/>}</span><span id="d14c" class="mf mg in mb b gy ml mi l mj mk">class MyFormState extends State&lt;MyForm&gt; {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      backgroundColor: Colors.grey[200],<br/>      appBar: AppBar(title: Text('Dynamic TextFormFields'),),<br/>      body: Container(),<br/>    );<br/>  }<br/>}</span></pre><p id="7f3e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.添加一个带有文本字段的表单，以输入我们在该班级中的姓名。</p><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="496c" class="mf mg in mb b gy mh mi l mj mk">class MyFormState extends State&lt;MyForm&gt; {</span><span id="70e4" class="mf mg in mb b gy ml mi l mj mk">  final _formKey = GlobalKey&lt;FormState&gt;();<br/>  TextEditingController _nameController;</span><span id="70af" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  void initState() {<br/>    super.initState();<br/>    _nameController = TextEditingController();   <br/>  }</span><span id="b4a7" class="mf mg in mb b gy ml mi l mj mk">  @override <br/>  void dispose() {<br/>    _nameController.dispose(); <br/>    super.dispose();<br/>  }</span><span id="176e" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      backgroundColor: Colors.grey[200],<br/>      appBar: AppBar(title: Text('Dynamic TextFormFields'),),<br/>      body: Form(<br/>        key: _formKey,<br/>        child: Padding(<br/>          padding: const EdgeInsets.all(16.0),<br/>          child: Column(<br/>            crossAxisAlignment: CrossAxisAlignment.start,<br/>            children: [<br/>              <em class="kr">// name textfield</em><br/>              Padding(<br/>                padding: const EdgeInsets.only(right: 32.0),<br/>                child: TextFormField(<br/>                  controller: _nameController,<br/>                  decoration: InputDecoration(<br/>                    hintText: 'Enter your name'<br/>                  ),<br/>                  validator: (v){<br/>                    if(v.trim().isEmpty){<br/>                      return 'Please enter something';<br/>                    }<br/>                    return null;<br/>                  },<br/>                ),<br/>              ),<br/>              SizedBox(height: 20,),<br/>              Text('Add Friends', <br/>                style: TextStyle(<br/>                  fontWeight: FontWeight.w700,  <br/>                  fontSize: 16,<br/>                ),<br/>              ),<br/>           ],<br/>         ),<br/>       ),<br/>     ),<br/>   );<br/>}</span></pre><p id="5ceb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.创建一个列表，该列表将告诉显示多少个动态文本字段，并将存储每个文本字段数据。</p><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="5b17" class="mf mg in mb b gy mh mi l mj mk">static List&lt;String&gt; friendsList = [null];</span></pre><blockquote class="le lf lg"><p id="1128" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">friendsList 已经用一个空值列表初始化，因为我们每次至少需要显示一个朋友文本字段。</p></blockquote><p id="fc61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.为动态文本字段创建一个有状态小部件类。</p><blockquote class="le lf lg"><p id="3f90" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">并传递为其创建文本字段的朋友列表索引，以便它可以在该索引处保存数据，并且我们可以在将来使用这些数据。</p></blockquote><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="2c5d" class="mf mg in mb b gy mh mi l mj mk">class FriendTextFields extends StatefulWidget {</span><span id="e02f" class="mf mg in mb b gy ml mi l mj mk">  final int index;<br/>  FriendTextFields(this.index);</span><span id="6393" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  _FriendTextFieldsState createState() =&gt; _FriendTextFieldsState();<br/>}</span><span id="f55f" class="mf mg in mb b gy ml mi l mj mk">class _FriendTextFieldsState extends State&lt;FriendTextFields&gt; {</span><span id="e3db" class="mf mg in mb b gy ml mi l mj mk">  TextEditingController _nameController;</span><span id="8854" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  void initState() {<br/>    super.initState();<br/>    _nameController = TextEditingController();<br/>  }</span><span id="66d5" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  void dispose() {<br/>    _nameController.dispose();<br/>    super.dispose();<br/>  }</span><span id="858d" class="mf mg in mb b gy ml mi l mj mk">  @override<br/>  Widget build(BuildContext context) {</span><span id="f76f" class="mf mg in mb b gy ml mi l mj mk">    WidgetsBinding.instance.addPostFrameCallback((timeStamp) {<br/>      _nameController.text = _MyFormState.friendsList[widget.index]   <br/>        ?? '';<br/>    });</span><span id="f2fb" class="mf mg in mb b gy ml mi l mj mk">    return TextFormField(<br/>      controller: _nameController,</span><span id="246a" class="mf mg in mb b gy ml mi l mj mk">      <strong class="mb io"><em class="kr">// save text field data in friends list at index <br/>      // whenever text field value changes</em></strong><br/>      onChanged: (v) =&gt; _MyFormState.friendsList[widget.index] = v,<br/>      decoration: InputDecoration(<br/>        hintText: 'Enter your friend\'s name'<br/>      ),<br/>      validator: (v){<br/>        if(v.trim().isEmpty) return 'Please enter something';<br/>        return null;<br/>      },<br/>    );<br/>  }<br/>}</span></pre><blockquote class="le lf lg"><p id="956b" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">现在我们必须将这些动态文本字段添加到主表单中。</p></blockquote><p id="1957" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.在 MyFormState 中创建一个方法，该方法将根据 friendsList 的长度生成朋友文本字段的列表。</p><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="7362" class="mf mg in mb b gy mh mi l mj mk">List&lt;Widget&gt; _getFriends(){<br/>  List&lt;Widget&gt; friendsTextFieldsList = [];<br/>  for(int i=0; i&lt;friendsList.length; i++){<br/>    friendsTextFieldsList.add(<br/>      Padding(<br/>        padding: const EdgeInsets.symmetric(vertical: 16.0),<br/>        child: Row(<br/>          children: [<br/>             Expanded(child: FriendTextFields(i)),<br/>             SizedBox(width: 16,),<br/>             <strong class="mb io"><em class="kr">// we need add button at last friends row only</em></strong><br/>             _addRemoveButton(i == friendsList.length-1, i),<br/>          ],<br/>        ),<br/>      )<br/>    );<br/>  }<br/>  return friendsTextFieldsList;<br/>}</span></pre><blockquote class="le lf lg"><p id="3858" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">朋友文本字段的最后一行将有添加按钮，其余的所有行将有删除按钮。</p></blockquote><p id="d608" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.创建一个方法来提供添加和删除按钮部件，该部件被添加到上面每个朋友文本字段的行中。</p><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="1336" class="mf mg in mb b gy mh mi l mj mk">Widget _addRemoveButton(bool add, int index){<br/>  return InkWell(<br/>    onTap: (){<br/>      if(add){<br/>        <strong class="mb io"><em class="kr">// add new text-fields at the top of all friends textfields</em></strong><br/>        friendsList.insert(0, null);<br/>      }<br/>      else friendsList.removeAt(index);<br/>      setState((){});<br/>    },<br/>    child: Container(<br/>      width: 30,<br/>      height: 30,<br/>      decoration: BoxDecoration(<br/>        color: (add) ? Colors.green : Colors.red,<br/>        borderRadius: BorderRadius.circular(20),<br/>      ),<br/>      child: Icon(<br/>        (add) ? Icons.add : Icons.remove, color: Colors.white,<br/>      ),<br/>    ),<br/>  );<br/>}</span></pre><blockquote class="le lf lg"><p id="1e8a" class="jk jl kr jm b jn jo jp jq jr js jt ju lh jw jx jy li ka kb kc lj ke kf kg kh ig bi translated">我们通过在 friends 列表中的索引 0 处插入一个空值，在所有现有的 friends 文本字段行之上添加一个新行。</p></blockquote><p id="c244" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">7.现在将朋友文本字段列表添加到表单列中。</p><pre class="kt ku kv kw gt ma mb mc md aw me bi"><span id="1e65" class="mf mg in mb b gy mh mi l mj mk">Form(<br/>  key: _formKey,<br/>  child: Padding(<br/>    padding: const EdgeInsets.all(16.0),<br/>    child: Column(<br/>      crossAxisAlignment: CrossAxisAlignment.start,<br/>        children: [ <br/>          // name textfield<br/>          Padding(<br/>            padding: const EdgeInsets.only(right: 32.0),<br/>            child: TextFormField( <br/>              controller: _nameController,<br/>              decoration: InputDecoration(<br/>                hintText: 'Enter your name'<br/>              ),<br/>              validator: (v){<br/>                if(v.trim().isEmpty){<br/>                  return 'Please enter something';<br/>                }<br/>                return null;<br/>              },<br/>            ),<br/>          ),<br/>          SizedBox(height: 20,),<br/>          Text('Add Friends', style: TextStyle(<br/>            fontWeight: FontWeight.w700, fontSize: 16),),<br/>          <strong class="mb io">..._getFriends(),</strong><br/>          SizedBox(height: 40,),<br/>          FlatButton(<br/>            onPressed: (){<br/>              if(_formKey.currentState.validate()){<br/>                _formKey.currentState.save();<br/>              }<br/>          },<br/>          child: Text('Submit'),<br/>          color: Colors.green,<br/>        ),<br/>      ],<br/>    ),<br/>  ),<br/>),</span></pre><p id="0d83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！现在，您可以在 flutter 中使用动态文本表单字段了。</p><h2 id="597b" class="mf mg in bd mm mn mo dn mp mq mr dp ms jv mt mu mv jz mw mx my kd mz na nb nc bi translated">从<a class="ae nd" href="https://gist.github.com/Hitesh822/086267e8b394aa1049cfbbfa95bac133" rel="noopener ugc nofollow" target="_blank">这里</a>获得完整的代码片段。</h2></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><p id="c722" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请在评论区分享你的想法。有不同的解决方案很好:-) </p></div></div>    
</body>
</html>