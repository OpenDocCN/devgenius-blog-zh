<html>
<head>
<title>PHP — P89: MySQL Update (PUT and PATCH)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P89: MySQL 更新(上传并打补丁)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p89-mysql-update-put-and-patch-3d917804d8fb?source=collection_archive---------11-----------------------#2022-11-06">https://blog.devgenius.io/php-p89-mysql-update-put-and-patch-3d917804d8fb?source=collection_archive---------11-----------------------#2022-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2db0ba7935b2a754ef22f991480c7ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aPHK-IHyOWlnS-X8AF_pw.jpeg"/></div></div></figure><p id="965b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">MySQL 发展的下一个逻辑步骤是更新现有资源。我们将介绍 PUT 和 PATCH 之间的区别，并彻底解决这个问题。这真的是一个简单的概念，我不知道为什么人们会觉得如此困惑。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p88-mysql-select-d7a633e736b"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P88: MySQL 选择</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">我们已经完成了插入过程，在 authors 表中插入了一些记录。现在怎么办？一个…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="ea6e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">放置与修补</h1><p id="b483" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">让我们看看我们的<code class="fe mr ms mt mu b">authors</code>桌。它包含以下字段:</p><ul class=""><li id="6bd4" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">id</code></li><li id="c66c" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">first_name</code></li><li id="bea6" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">last_name</code></li><li id="300e" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">email</code></li></ul><p id="3253" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们用<code class="fe mr ms mt mu b">PUT</code>请求更新一个资源，我们需要发送所有的字段。这意味着如果我们更新了<code class="fe mr ms mt mu b">email</code>，我们需要发送<code class="fe mr ms mt mu b">id</code>、<code class="fe mr ms mt mu b">first_name</code>、<code class="fe mr ms mt mu b">last_name</code>和<code class="fe mr ms mt mu b">email</code>。</p><p id="22b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们用<code class="fe mr ms mt mu b">PATCH</code>请求更新一个资源，我们只需要发送我们正在更新的字段。这意味着如果我们更新<code class="fe mr ms mt mu b">email</code>，我们需要发送<code class="fe mr ms mt mu b">email</code>和标识符(通常是<code class="fe mr ms mt mu b">id</code>)。</p><h1 id="947d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">我们可以用柱子吗？</h1><p id="2f40" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">实际上，我们没有办法发送<code class="fe mr ms mt mu b">PUT</code>或<code class="fe mr ms mt mu b">PATCH</code>请求。我们只能以<code class="fe mr ms mt mu b">method</code>的形式指定<code class="fe mr ms mt mu b">POST</code>或<code class="fe mr ms mt mu b">GET</code>请求。如果我们想发送上传和补丁请求，我们需要变得有创造性。</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="ae6d" class="nr lp iq mu b gy ns nt l nu nv">&lt;form method="post"&gt;<br/>  &lt;input type="hidden" name="_method" value="put"&gt;<br/>  ...<!-- --> <br/>&lt;/form&gt;</span></pre><p id="6a14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，服务器端脚本需要解密传入的请求。例如:</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="626f" class="nr lp iq mu b gy ns nt l nu nv">if ( $_POST['_method'] == 'put' ) <br/>{<br/>  // Do something with the put request<br/>}</span></pre><p id="eade" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这同样适用于<code class="fe mr ms mt mu b">DELETE</code>请求。</p><h1 id="4bf8" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">概述计划</h1><p id="b0e0" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">在更新资源之前，我们首先需要检索资源。让我们就更新我们的资源需要做些什么制定一个计划。</p><ul class=""><li id="61dc" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated">基于<code class="fe mr ms mt mu b">id</code>检索资源。</li><li id="f28b" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">在窗体中显示资源域。</li><li id="c34f" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">允许用户更新表格字段并点击<code class="fe mr ms mt mu b">Update</code>按钮。</li><li id="fdda" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">将数据发送到一个<code class="fe mr ms mt mu b">route</code>文件，该文件将引导数据。</li><li id="8abc" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">该信息与<code class="fe mr ms mt mu b">id</code>一起被发送到服务器，服务器将在那里更新资源。</li></ul><p id="2cb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据这些信息，我们可以判断这将是一个<code class="fe mr ms mt mu b">put</code>请求。</p><h1 id="3351" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">基于 id 检索资源</h1><p id="9295" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们需要检索一个将要更新的资源。我们有来自上一篇文章的<code class="fe mr ms mt mu b">select</code>陈述。这将派上用场了。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="dc41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mr ms mt mu b">select</code>方法返回一个数据数组，所以我们的<code class="fe mr ms mt mu b">$update_author</code>现在包含一个数据数组。</p><pre class="nj nk nl nm gt nn mu no np aw nq bi"><span id="bb0b" class="nr lp iq mu b gy ns nt l nu nv">/app/87 MySQL Update/SelectAuthor.php:8:<br/><strong class="mu ir">array</strong> <em class="ny">(size=6)</em><br/>  'id' =&gt; string '1' <em class="ny">(length=1)</em><br/>  'first_name' =&gt; string 'Dino' <em class="ny">(length=4)</em><br/>  'last_name' =&gt; string 'Cajic' <em class="ny">(length=5)</em><br/>  'email' =&gt; string 'dino@example.com' <em class="ny">(length=16)</em><br/>  'updated_at' =&gt; string '2022-11-03 21:56:16' <em class="ny">(length=19)</em><br/>  'created_at' =&gt; string '2022-11-03 21:56:16' <em class="ny">(length=19)</em></span></pre><h1 id="1a73" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">在窗体中显示资源域</h1><p id="e48a" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">接下来，我们需要在表单中回显这些数据。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="a206" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们添加了两个隐藏字段。第一个是我们的<code class="fe mr ms mt mu b">_method</code>，第二个是我们的<code class="fe mr ms mt mu b">id</code>。即使我们可能只需要更新<code class="fe mr ms mt mu b">first_name</code>，我们也要将所有数据传递给我们的<code class="fe mr ms mt mu b">update.php</code>文件。</p><h1 id="f4b4" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">路线文件</h1><p id="b08f" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated"><code class="fe mr ms mt mu b">index.php?page=author</code>是做什么的？<code class="fe mr ms mt mu b">index.php</code>文件将作为我们的<code class="fe mr ms mt mu b">route</code>文件。<code class="fe mr ms mt mu b">page</code>参数告诉服务器提供哪个文件。在这种情况下，它是<code class="fe mr ms mt mu b">author</code>。我们也在传递<code class="fe mr ms mt mu b">put</code>方法。让我们看看我们如何能把所有这些都弄明白。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="de7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前还没有检查如果用户从 url 中移除参数<code class="fe mr ms mt mu b">page</code>会发生什么，这没关系。也没有检查如果<code class="fe mr ms mt mu b">$_POST</code>被操作并且<code class="fe mr ms mt mu b">put</code>请求被移除会发生什么。再说一遍，没关系。我们关注的是更新功能，这已经有些过头了。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="babc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只需要将<code class="fe mr ms mt mu b">$_POST</code>传递给<code class="fe mr ms mt mu b">update</code>方法，这样我们就可以更新资源了。</p><h1 id="15fc" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">向我们的 Author 类添加更新功能</h1><p id="2ad2" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">一旦我们收到了<code class="fe mr ms mt mu b">$_POST</code>数组，我们就可以从中提取细节来更新我们的资源。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c531" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然我们可以不准备就更新资源，但是准备语句、绑定参数和安全地更新资源也一样容易。</p><p id="3b36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果失败，我们将存储错误细节，如果更新失败，我们将返回<code class="fe mr ms mt mu b">false</code>。</p><h1 id="af2f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">路线清理</h1><p id="aa4d" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">因为我们的<code class="fe mr ms mt mu b">update</code>方法返回<code class="fe mr ms mt mu b">true</code>或<code class="fe mr ms mt mu b">false</code>，我们可以用它来返回我们的表单。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e7fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果更新成功，它会将我们重定向回我们的表单，否则，应用程序将终止。不是看起来最干净的代码，但它服务于它的目的。</p><h1 id="adbc" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">补丁怎么样？</h1><p id="3924" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">没什么大不了的。让我们创建另一个只更新电子邮件地址的表单。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ce14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们回显了<code class="fe mr ms mt mu b">first_name</code>和<code class="fe mr ms mt mu b">last_name</code>，但没有发送出去。我们只是发送<code class="fe mr ms mt mu b">id</code>和<code class="fe mr ms mt mu b">email</code>字段。现在是时候修改我们的路由文件了。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="a6ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后要做的事情是在我们的<code class="fe mr ms mt mu b">Author</code>类中创建我们的<code class="fe mr ms mt mu b">update_email</code>方法。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1236" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本除了只更新电子邮件地址之外，几乎完全相同。</p><h1 id="b3fb" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">最后润色</h1><p id="12e3" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">让我们在我们的 route 文件中添加一个<code class="fe mr ms mt mu b">page</code>检查，检查我们的 URL 中是否有页面参数。如果没有，我们将显示两个页面的链接。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b109" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仅此而已。集成了更新功能。没有改变<code class="fe mr ms mt mu b">DB</code>类。完整的代码可以在下面看到。我们在这里一举两得:查看更新功能并确定 put 和 patch 之间的区别。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/dinocajic/php-youtube-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-dinocajic/PHP-YouTube-tutorials:PHP YouTube 教程的代码</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">PHP YouTube 教程的代码确保你已经安装了 Docker。克隆回购。运行以下命令…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="nz l lk ll lm li ln jw kz"/></div></div></a></div></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/353abbca67734928e5083d7b77b01314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8h6_oEIQaC5HJfuh.jpeg"/></div></figure><p id="ad69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae oi" href="http://absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 主管，该公司是<a class="ae oi" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae oi" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Antibody </a>、<a class="ae oi" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae oi" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae oi" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae oi" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他拥有计算机科学学士学位，辅修生物学，并拥有十多年的软件工程经验。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="b717" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae oi" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae oi" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae oi" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="d356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T3】</p></div></div>    
</body>
</html>