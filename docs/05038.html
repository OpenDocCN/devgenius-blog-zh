<html>
<head>
<title>Making HTTP Requests with React Query — Loading State and Refetching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 React 查询发出 HTTP 请求—加载状态和重新提取</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-loading-state-and-refetching-9f57b335fda7?source=collection_archive---------3-----------------------#2021-06-06">https://blog.devgenius.io/making-http-requests-with-react-query-loading-state-and-refetching-9f57b335fda7?source=collection_archive---------3-----------------------#2021-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eb6a09fa698271e6a7acaed8331f630a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lhv6SrzfF5qZsujW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@michael75?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克尔</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="4c3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React 查询库让我们可以在 React 应用程序中轻松地发出 HTTP 请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用 React Query 发出 HTTP 请求。</p><h1 id="90d4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">全局后台获取加载状态</h1><p id="f1a1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在加载任何请求的地方获取所有请求的加载。</p><p id="84f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以使用<code class="fe me mf mg mh b">useIsFetching</code>钩子。</p><p id="d2c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="81fe" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery, useIsFetching } from "react-query";<br/>export default function App() {<br/>  const isFetching = useIsFetching();<br/>  const { data } = useQuery(["todo", 1], ({ queryKey: [, id] }) =&gt; {<br/>    return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>  });</span><span id="0fe7" class="mq lc iq mh b gy mv ms l mt mu">  if (isFetching) {<br/>    return "loading";<br/>  }</span><span id="3986" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="b79c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<code class="fe me mf mg mh b">useIsFetching</code>钩子来检查我们的应用程序中是否有任何请求正在加载。</p><h1 id="934e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">窗口焦点重取</h1><p id="7786" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">默认情况下，当我们关注窗口时，React Query 会自动在后台请求新数据。</p><p id="bc4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要禁用它，我们可以在创建<code class="fe me mf mg mh b">QueryClient</code>实例时将<code class="fe me mf mg mh b">refrechOnWindowFocus</code>设置为<code class="fe me mf mg mh b">false</code>。</p><p id="af98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了对所有请求都这样做，我们编写:</p><p id="2955" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="043d" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="a47c" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient({<br/>  defaultOptions: {<br/>    queries: {<br/>      refetchOnWindowFocus: false<br/>    }<br/>  }<br/>});</span><span id="4efd" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="4afa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8367" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery, useIsFetching } from "react-query";<br/>export default function App() {<br/>  const isFetching = useIsFetching();<br/>  const { data } = useQuery(["todo", 1], ({ queryKey: [, id] }) =&gt; {<br/>    return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>  });</span><span id="6433" class="mq lc iq mh b gy mv ms l mt mu">  if (isFetching) {<br/>    return "loading";<br/>  }</span><span id="6dd4" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="37dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过编写以下内容来禁用每个查询的此选项:</p><p id="28db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d6f2" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="7f31" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient();</span><span id="75be" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="1e06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3f0d" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery, useIsFetching } from "react-query";<br/>export default function App() {<br/>  const isFetching = useIsFetching();<br/>  const { data } = useQuery(<br/>    ["todo", 1],<br/>    ({ queryKey: [, id] }) =&gt; {<br/>      return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>    },<br/>    { refetchOnWindowFocus: false }<br/>  );</span><span id="114f" class="mq lc iq mh b gy mv ms l mt mu">  if (isFetching) {<br/>    return "loading";<br/>  }</span><span id="8f99" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><h1 id="c86c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">禁用或暂停查询</h1><p id="2234" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过将<code class="fe me mf mg mh b">enabled</code>属性设置为<code class="fe me mf mg mh b">false</code>来禁止查询自动运行。</p><p id="37aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9863" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data, refetch } = useQuery(<br/>    ["todo", 1],<br/>    ({ queryKey: [, id] }) =&gt; {<br/>      return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>    },<br/>    { enabled: false }<br/>  );</span><span id="7ea3" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={() =&gt; refetch()}&gt;Fetch Todo&lt;/button&gt;<br/>      &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="c379" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">enabled</code>设置为<code class="fe me mf mg mh b">false</code>,以便在组件挂载时不会发出请求。</p><p id="b2a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要发出请求，我们可以使用<code class="fe me mf mg mh b">refetch</code>函数发出请求。</p><h1 id="b6f6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="5825" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以获得请求的加载状态，并控制何时使用 React Query 发出请求。</p></div></div>    
</body>
</html>