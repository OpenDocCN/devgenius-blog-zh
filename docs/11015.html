<html>
<head>
<title>Day 128 of Game Dev: MonoSingleton — Unity/C#!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">游戏开发第 128 天:MonoSingleton — Unity/C#！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/day-128-of-game-dev-monosingleton-unity-c-83ecc8775072?source=collection_archive---------5-----------------------#2022-12-13">https://blog.devgenius.io/day-128-of-game-dev-monosingleton-unity-c-83ecc8775072?source=collection_archive---------5-----------------------#2022-12-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d7bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">目的:</strong>复习什么是单体及其用途。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/98fb508638289019ca5a30c4636810af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*17bhkEECk-vrwzEceiDtjA.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="http://www.unitygeek.com/unity_c_singleton/" rel="noopener ugc nofollow" target="_blank">图片来源</a></figcaption></figure><p id="2351" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文假设你知道什么是 singleton 以及如何设置它。如果你需要的话，我的<a class="ae ku" href="https://medium.com/dev-genius/day-127-of-unity-dev-singletons-unity-c-781e8c34adf0" rel="noopener">前一篇文章</a>涵盖了这个主题，并且与本文一起很好地工作。你可能还想知道什么是泛型，但这不是绝对必要的。</p><p id="c58a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">MonoSingleton 基本上是一个单例生成类。我的意思是，你可以创建一个单例类，它是一个将其他类变成单例的模板，省去了在每个你想成为单例的类中重复单例创建过程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi kv"><img src="../Images/b0701815276b709d871b0d4ec7d6c24a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*Nf_WTKRZ-PZuDbcN5Xf4LQ.png"/></div></figure><p id="c929" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">比如，这个 GameManager 类被做成一个 singleton。你必须在每一个你想成为单例的类中都这样做。或者我们可以创建一个新类，它传入另一个类并自动将其转换为 singleton，这样我们就不必这么做了。</p><p id="4784" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是我们如何设置它呢？</p><p id="5d16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将首先创建一个名为 MonoSingleton 的新脚本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/013a584a6285f39f0173f570afdf6404.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*BijbvLMM-EUgJU_SUZDrQQ.png"/></div></figure><p id="9d5e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为这个类将作为一个可定制的模板，我应该使它成为一个抽象类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/c7bcd57d0f62468313214e4fab297ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*h2lqg_rktLtE5lPcl7o9jA.png"/></div></figure><p id="27f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我需要让这个类接受一个泛型类型，这意味着任何类都可以被传入，成为一个单例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ky"><img src="../Images/9511a89f6c5216dfb565edf10fbdc075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEbfCbhdjmKIHH8yYwKG_A.png"/></div></div></figure><p id="3c60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这意味着在我的 GameManager 脚本中，例如，我将从 MonoSingleton 继承并作为类型传递给 GameManager，它将把它转换成 Singleton。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/0e2cb2c21cb7d2a7be3a4730665eeaf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*AxjlvHgEAwm6kitaJKqLrQ.png"/></div></figure><p id="8aba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我可以在任何课上做到这一点。请记住，到目前为止，MoneSingleton 类还没有真正做任何事情。我们仍然需要设置它。</p><p id="ff7e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从这里开始，我只需要像往常一样创建一个 singleton，除了我没有在我想要成为 singleton 的类中进行硬编码，而是使用传入的任何泛型类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi le"><img src="../Images/93d3fca68d43d1e577f9072b21a97acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*YFEIJ1pZa8imMenFhWLn7g.png"/></div></figure><p id="04a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">T 变量代表泛型类型，我们已经设置好了，T 变量等于传入的任何类(类型)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/e1bcac5d4c560fa1ba0d639b1ff6b1b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*57o36jntLBq5tvnGZwDi1A.png"/></div></figure><p id="dd21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">同样，这里我用 T 变量来表示一切。你会注意到，在处理泛型类型时，有一些小夸克让它们做你想做的事情，但是一旦你意识到这一点，事情就变得非常简单了。这个调试还有一个很酷的地方。Log，因为它使用的是通用类型，取决于它是 GameManager 还是其他类型的类，它会告诉你哪个类是空的。所以它会说“游戏经理为空”或“UIManager 为空”等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/d63e3b88a9380594c98a5cb9730e7204.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*K1Z4Nl5fP9SRCBwkiZwaqg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lh"><img src="../Images/b362a5a56ece4fb9d5c30ab7b1abaf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xpa1K7IR4aibamaCPoMhpQ.png"/></div></div></figure><p id="417d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们必须将 _instance 设置为这个类。唯一的问题是我们得到了一个错误，那是因为它被 T 是什么搞混了，所以我们只需要对它进行造型。这里有两种不同的方法来铸造它，两者的工作原理相同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi li"><img src="../Images/244868589616c60116ab01003f01743d.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*CdUxHioNnBbVaEDJ885OOA.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/234f9f27bf60848057487ecc29d47f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*hw8GoldK0WPc63-9KP_Mrw.png"/></div></figure><p id="6f83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用前面的同一个例子，GameManager 类将继承 MonoSingleton 类，并自动转换为 Singleton 类。因为 MonoSingleton 继承了 MonoBehavior，所以 GameManager 也将继承 MonoBehavior。</p><p id="abc6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将为 GameManager 类放入一个示例变量，并尝试从我的 Player 类访问。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/f15dfa1ed1f50e0cfa9c16bfbbdf4e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*gMRnWM80MQJqXbjWVNnbOQ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/1b0661ae89e61ecaa19342184b8f13df.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*pDo4Ql2uXysgVsvsCA4J6Q.png"/></div></figure><p id="fc26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它运行得非常好。</p><p id="1076" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="lm">如有任何想法或问题，欢迎评论。让我们制作一些令人敬畏的游戏！</em>T3】</strong></p></div></div>    
</body>
</html>