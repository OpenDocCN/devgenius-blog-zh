<html>
<head>
<title>Configure SSH Server With Windows 10 Native Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Windows 10 原生方式配置 SSH 服务器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/set-up-your-ssh-server-in-windows-10-native-way-1aab9021c3a6?source=collection_archive---------0-----------------------#2020-03-09">https://blog.devgenius.io/set-up-your-ssh-server-in-windows-10-native-way-1aab9021c3a6?source=collection_archive---------0-----------------------#2020-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a78860653e37cffb96e124fe104ee40c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dOu6M0RjpoSFPJPm"/></div></div></figure><p id="bb25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated"><span class="l kx ky kz bm la lb lc ld le di"> C </span> <a class="ae lf" href="https://medium.com/rkttu/set-up-ssh-key-and-git-integration-in-windows-10-native-way-c9b94952dd2c" rel="noopener">从上一篇文章</a>开始，我们将看看如何从 Windows 10 和 Windows Server 1709 开始设置一个内置的 SSH 服务器。这种方法允许 Windows Server 使用 SSH 进行远程连接，就像传统的 Linux 服务器一样。我们还将了解如何使用 SSH 端口隧道安全地使用远程桌面，而无需修改防火墙设置。</p><h1 id="bb03" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">安装和配置 OpenSSH 服务器</h1><p id="26c7" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">您可以像在上一篇文章中安装 SSH 客户机一样安装 OpenSSH 服务器。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="35b9" class="ms lh iq mo b gy mt mu l mv mw">$OpenSSHServer = Get-WindowsCapability -Online | ? Name -like ‘OpenSSH.Server*’<br/>Add-WindowsCapability -Online -Name $OpenSSHServer.Name</span></pre><p id="4080" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装 OpenSSH 服务器程序后，启动并停止 NT 服务一次，以创建必要的初始配置文件。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7170" class="ms lh iq mo b gy mt mu l mv mw">$SSHDaemonSvc = Get-Service -Name ‘sshd’<br/>Start-Service -Name $SSHDaemonSvc.Name<br/>Stop-Service -Name $SSHDaemonSvc.Name</span></pre><h1 id="2314" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">应用非对称密钥身份验证</h1><p id="cbed" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">强烈建议使用公共 SSH 密钥身份验证方法并禁用密码身份验证方法，因为它可以通过密码分配来防止攻击。要启用此身份验证功能，请以管理员身份启动 PowerShell，并使用记事本打开以下路径中的文件。(或者您可以使用自己选择的另一个文本编辑器。)</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c629" class="ms lh iq mo b gy mt mu l mv mw">notepad.exe $env:PROGRAMDATA\ssh\sshd_config</span></pre><p id="dbce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于以下项目，取消线下的注释，并应用如下值:</p><ul class=""><li id="6c3b" class="mx my iq ka b kb kc kf kg kj mz kn na kr nb kv nc nd ne nf bi translated"><code class="fe ng nh ni mo b">PubkeyAuthentication yes</code></li><li id="a373" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated"><code class="fe ng nh ni mo b">PasswordAuthentication no</code></li><li id="801c" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated"><code class="fe ng nh ni mo b">PermitEmptyPasswords no</code></li></ul><p id="bb2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后选择您喜欢的管理 SSH 公钥的方法。从 Windows Server 2019(或 1809)开始，有两种方法可以描述 SSH 公钥。其中之一是在用户的主目录中创建 authorized_keys 文件的传统方式。</p><h1 id="7163" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用<code class="fe ng nh ni mo b">$HOME\.ssh\authorized_keys</code></h1><p id="dea7" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">若要使用此方法，请在配置文件的底部注释掉以下代码块:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="151d" class="ms lh iq mo b gy mt mu l mv mw">Match Group administrators<br/>  AuthorizedKeysFile<br/>  __PROGRAMDATA__/ssh/administrators_authorized_keys</span></pre><p id="549b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后转到你想登录的用户主目录，创建一个<code class="fe ng nh ni mo b">.ssh</code>目录。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="59e7" class="ms lh iq mo b gy mt mu l mv mw">mkdir "$HOME\.ssh"</span></pre><p id="d858" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在新创建的目录中创建一个<code class="fe ng nh ni mo b">authorized_keys</code>文件(不带扩展名),并用您喜欢的文本编辑器打开它。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="439c" class="ms lh iq mo b gy mt mu l mv mw">$authorizedKeyFilePath = “$HOME\.ssh\authorized_keys”<br/>New-Item $authorizedKeyFilePath<br/>notepad.exe $authorizedKeyFilePath</span></pre><p id="ffbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加您在这里使用的公共 SSH 密钥值。</p><p id="e913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存文件时，您必须按照章节<strong class="ka ir">使用认证密钥信息设置文件权限</strong>中的说明更改文件权限设置。如果缺少此设置，SSH 连接将会失败。</p><h1 id="07de" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用<code class="fe ng nh ni mo b">administrators_authorized_keys</code></h1><p id="0160" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">该属性是 Windows Server 2019 (1809)中包含的 OpenSSH 使用的默认属性。您可以在一个地方管理您的文件，而不是为每个用户注册一个新的 SSH 密钥。</p><p id="30d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果使用这种方法，所有公钥都需要存储在$ env:program data \ ssh \ administrators _ authorized _ keys 文件中，非管理用户(即不属于 administrator s 组的用户)除外。如果你尝试，这个设置将被用来代替你的主目录，所以如果这里没有密钥，连接将失败。</p><p id="eb30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ng nh ni mo b">administrators_authorized_keys</code>文件默认不存在，已创建。</p><blockquote class="no np nq"><p id="02b6" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了其他系统文件或配置，系统可能会崩溃。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="fe04" class="ms lh iq mo b gy mt mu l mv mw">$authorizedKeyFilePath = “$env:ProgramData\ssh\administrators_authorized_keys”<br/>New-Item $authorizedKeyFilePath<br/>notepad.exe $authorizedKeyFilePath</span></pre><p id="490f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加您在这里使用的公共 SSH 密钥。</p><p id="5659" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存文件时，您必须按照章节<strong class="ka ir">使用认证密钥信息</strong>设置文件权限中所述更改文件权限设置。如果缺少此设置，SSH 连接将会失败。</p><h1 id="e2d4" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用身份验证密钥信息设置文件权限</h1><p id="ad9c" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在使用 OpenSSH server for Windows 时，您将面临的一个常见且非常棘手的问题是。SSH 密钥文件权限应该具有正确且有限的文件权限。SSH 的 Windows 版本也遵循这个规则，但是特别是在 Windows 中，配置文件权限可能是不直观的。</p><p id="50c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据您在上一步中选择的方法，您必须验证<code class="fe ng nh ni mo b">authorized_keys</code>文件或<code class="fe ng nh ni mo b">administrators_authorized_keys</code>文件的路径，并更改权限，以便只有系统帐户可以使用<code class="fe ng nh ni mo b">icacls.exe</code>实用程序以及<code class="fe ng nh ni mo b">Get-Acl</code>和<code class="fe ng nh ni mo b">Set-Acl</code>命令访问它。</p><blockquote class="no np nq"><p id="610e" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了系统文件的 ACL 配置，系统可能会崩溃。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="1fb8" class="ms lh iq mo b gy mt mu l mv mw">$authorizedKeyFilePath = "..."<br/>icacls.exe $authorizedKeyFilePath /remove “NT AUTHORITY\Authenticated Users”<br/>icacls.exe $authorizedKeyFilePath /inheritance:r<br/>Get-Acl “$env:ProgramData\ssh\ssh_host_dsa_key” | Set-Acl $authorizedKeyFilePath</span></pre><h1 id="5e1d" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">更改 SSH 默认 Shell</h1><p id="d08b" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">基本上，出于兼容性的考虑，Windows 操作系统在很长一段时间内都提供了基于 shell 的解释器，可以识别 DOS 命令。但是现在，随着越来越多的功能，PowerShell 正在成为一个不错的选择。</p><p id="7cf9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要，您可以将 PowerShell 指定为 SSH 的默认 Shell，而不是 DOS 解释器。但是，这里的设置特定于 SSH 会话，而不是远程桌面或控制台会话。</p><blockquote class="no np nq"><p id="435e" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了注册表配置，系统可能会崩溃。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="984d" class="ms lh iq mo b gy mt mu l mv mw">New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "$env:WINDIR\System32\WindowsPowerShell\v1.0\powershell.exe" -PropertyType String -Force</span></pre><h1 id="27c1" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">启动 SSH 服务器</h1><p id="1b03" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">您现在已经准备好启动您的 SSH 服务器了。SSH 服务器默认设置为手动运行，以便您可以将启动模式更改为自动。然后开始服务。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f415" class="ms lh iq mo b gy mt mu l mv mw">$SSHDaemonSvc = Get-Service -Name ‘sshd’<br/>Set-Service -Name $SSHDaemonSvc.Name -StartupType Automatic<br/>Start-Service -Name $SSHDaemonSvc.Name</span></pre><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/1ae187d871c56149ccc0b883ca38010a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*noHK0AIhgOLI23L6.png"/></div></div></figure><p id="ff17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！从现在起，您可以使用 SSH-key 身份验证连接到 Windows。</p><h1 id="ff61" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">如何保护远程桌面</h1><p id="bef5" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">与 Linux 不同，Windows 仍然在图形界面上运行大部分系统，而不是在命令行上。因此，如果您尝试使用这样的终端做一些事情，您可能不会像预期的那样有太多事情要做。</p><p id="14a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，众所周知，远程桌面是许多黑客和脚本小子的食物。你可能会遇到在方便和安全之间选择的困境。</p><p id="8c9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，SSH 提供了隧道的概念，支持安全地中继其他网络连接的能力。远程桌面连接也可以用这种方式保护，这样您就可以放心地使用它们。</p><p id="bf5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从阻塞 TCP 3389 和 UDP 3389 端口开始。您可以这样做，因为您将仅通过 SSH 隧道来使用远程桌面。</p><blockquote class="no np nq"><p id="cbe4" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了防火墙配置，系统可能会变得易受攻击。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="42dc" class="ms lh iq mo b gy mt mu l mv mw">Set-NetFirewallRule -DisplayName “Remote Desktop - User Mode (UDP-In)” -Action Block<br/>Set-NetFirewallRule -DisplayName “Remote Desktop - User Mode (TCP-In)” -Action Block</span></pre><p id="4c15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，您必须更改注册表标志值，以便远程桌面服务器可以接受连接。</p><blockquote class="no np nq"><p id="d3d6" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了注册表配置，系统可能会崩溃。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c60c" class="ms lh iq mo b gy mt mu l mv mw">Set-ItemProperty -Path ‘HKLM:\System\CurrentControlSet\Control\Terminal Server’ -Name “fDenyTSConnections” -Value 0</span></pre><p id="5038" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我现在要解释的部分很酷。正如您在前面看到的，当您连接到 OpenSSH 时，不会要求您输入密码，因此您可以在每次使用时设置一个随机生成的强密码。在系统目录中有一个简单的脚本可以方便地做到这一点。</p><p id="74a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">选择你想要的脚本类型，创建一个名为<code class="fe ng nh ni mo b">ChangePassword.ps1</code>的文件。为了您的方便，我们将把这个脚本保存在系统目录中。</p><blockquote class="no np nq"><p id="0936" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您错误地更改了其他系统文件或配置，系统可能会崩溃。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a14f" class="ms lh iq mo b gy mt mu l mv mw">$change_pwd_script_path = “$env:WINDIR\ChangePassword.ps1”<br/>Clear-Content $change_pwd_script_path -ErrorAction SilentlyContinue<br/>notepad.exe $change_pwd_script_path</span></pre><h1 id="75b6" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">设置您想要的密码</h1><p id="8c9a" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">如下创建<code class="fe ng nh ni mo b">ChangePassword.ps1</code>文件的内容:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ac32" class="ms lh iq mo b gy mt mu l mv mw">$Password = Read-Host -Prompt "Provide your new account password" -AsSecureString<br/>Set-LocalUser -Name "$env:UserName" -Password $Password<br/>Clear-Variable "Password"<br/>Write-Host "Detailed settings such as remote desktop settings, WinRM connection settings, and Windows Update can be controlled using the sconfig command."</span></pre><p id="aa79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本允许您输入密码。但是，除非您更改策略，否则您只能使用通过 Windows Server enhanced 默认密码规则的密码。您必须指定满足以下所有条件的密码。</p><ul class=""><li id="4983" class="mx my iq ka b kb kc kf kg kj mz kn na kr nb kv nc nd ne nf bi translated">英文大写字母(A 到 Z)</li><li id="d142" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated">小写英文字母(a 到 z)</li><li id="56fc" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated">阿拉伯数字(0 到 9)</li><li id="ed44" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated">特殊符号(例如！, $, #,%)</li></ul><h1 id="9bfc" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">每次都生成新密码</h1><p id="852a" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">创建<code class="fe ng nh ni mo b">ChangePassword.ps1</code>文件的内容如下:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5117" class="ms lh iq mo b gy mt mu l mv mw">Add-Type -AssemblyName System.Web<br/>$Password = [System.Web.Security.Membership]::GeneratePassword(30,10)<br/>Set-LocalUser -Name "$env:UserName" -Password ($Password | ConvertTo-SecureString -AsPlainText -Force)<br/>Write-Host "Your New Password is:`r`n`r`n$Password"<br/>Write-Host "Detailed settings such as remote desktop settings, WinRM connection settings, and Windows Update can be controlled using the sconfig command."<br/>Clear-Variable "Password"</span></pre><p id="0e94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样，每次都可以设置强密码。如果您忘记了密码，您可以放心，您仍然可以使用公钥身份验证作为第二种身份验证方法。</p><h1 id="bd51" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">尝试使用隧道登录到远程桌面</h1><p id="31ae" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">现在输入下面的命令来运行上面的脚本。之后，只需设置密码并验证远程桌面连接正在工作。</p><blockquote class="no np nq"><p id="08bb" class="jy jz nr ka b kb kc kd ke kf kg kh ki ns kk kl km nt ko kp kq nu ks kt ku kv ij bi translated">警告:小心运行以下命令。如果您丢失了指定的密码，您将无法访问您的系统。</p></blockquote><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d349" class="ms lh iq mo b gy mt mu l mv mw">ChangePassword</span></pre><p id="ead9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要登录到远程桌面，请运行 SSH，如下所示:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5b92" class="ms lh iq mo b gy mt mu l mv mw">ssh -L 3389:localhost:3389 &lt;user_id&gt;@&lt;host_address&gt;</span></pre><p id="81d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个 3389 是服务器端的端口号，第二个地址是您想在本地使用的端口号。如果您已将 remote desktop 的端口号从注册表更改为服务器上的另一个端口号，您可以输入更改后的端口号，而不是 3389。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/57c96b36b65a5a9654b8e55afa30a031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fr2JkjnDh885IpSj.png"/></div></div></figure><p id="90f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您试图像以前一样仅使用<host_address>部分连接到远程桌面，防火墙将像以前设置的那样阻止连接。因此，没有人能够直接访问远程桌面，除非用户已经向该服务器注册了与 SSH 密钥相匹配的公钥。</host_address></p><h1 id="4092" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用安全文件发送和接收</h1><p id="9d90" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">毫不奇怪，使用基于 SSH 的 SFTP 是可能的。此功能旨在取代远程桌面的文件夹共享功能，安全地处理大型文件传输。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/d625dcab54ff645bd1fc394fea0e69ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2ZL71JJQyD4GP6wZ.png"/></div></div></figure><p id="6e8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">任何支持 SFTP 功能的客户端，如 FileZilla，都是兼容的，并且具有管理优势，因为不需要像传统 FTP 那样应用复杂的防火墙开放策略。</p><h1 id="531a" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">总结</h1><p id="4cda" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">本演练让您了解自 Windows 10 版本 1709 以来添加的所有新 SSH 功能。这两篇文章都适用于 Windows 10 和 Windows Server 2019，因此请花点时间设置它们以获得更高的安全性。</p><h1 id="9f01" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">信用</h1><p id="b68e" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">当我写这篇文章的时候，下面的文章帮助了我。</p><ul class=""><li id="52d5" class="mx my iq ka b kb kc kf kg kj mz kn na kr nb kv nc nd ne nf bi translated"><a class="ae lf" href="https://ilovepowershell.com/2018/05/28/awesome-and-simple-way-to-generate-random-passwords-with-powershell/" rel="noopener ugc nofollow" target="_blank">https://ilovepowershell . com/2018/05/28/awesome-and-simple-way-to-generate-random-passwords-with-powershell/</a></li><li id="0c28" class="mx my iq ka b kb nj kf nk kj nl kn nm kr nn kv nc nd ne nf bi translated"><a class="ae lf" href="https://stackoverflow.com/questions/16212816/setting-up-openssh-for-windows-using-public-key-authentication" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/16212816/setting-up-OpenSSH-for-windows-using-public-key-authentic ation</a></li></ul><figure class="mj mk ml mm gt jr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/rkttu"><div class="gh gi nw"><img src="../Images/6d60b235fcc46a4bd696b90e886419ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*Dpw8-hNGI2fDmosV4E8DVQ.png"/></div></a></figure></div></div>    
</body>
</html>