<html>
<head>
<title>How Did I Contribute to KEDA by Adding A New Scaler for Cassandra</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我为卡珊德拉添加了一个新的缩放器，这对KEDA有什么贡献</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-did-i-contribute-to-keda-by-adding-a-new-scaler-for-cassandra-d0b3878c6baf?source=collection_archive---------1-----------------------#2021-11-13">https://blog.devgenius.io/how-did-i-contribute-to-keda-by-adding-a-new-scaler-for-cassandra-d0b3878c6baf?source=collection_archive---------1-----------------------#2021-11-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/10854239a3d793a40afe444f5cc9f7ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31F-6wQ40ToU6cCsj9VnrA.png"/></div></div></figure><p id="fd30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">在我之前的</em> <a class="ae ku" href="https://nilayasiktoprak.medium.com/how-to-write-a-weather-scaler-for-keda-454183c57790" rel="noopener"> <em class="kt">博客</em> </a> <em class="kt">中，我讲过如何写一个“天气定标器”来理解定标器的工作原理。在这一个中，我将谈论Cassandra scaler做什么，</em> <strong class="jx io"> <em class="kt">如何写scaler，它的单元，和E2E测试</em> </strong> <em class="kt">检查它的运行。</em></p><p id="05f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">您可以查看我的</em>代码</p><ul class=""><li id="cc90" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated"><a class="ae ku" href="https://github.com/kedacore/keda/blob/main/pkg/scalers/cassandra_scaler.go" rel="noopener ugc nofollow" target="_blank"> <em class="kt">卡珊德拉缩放器</em> </a></li><li id="f349" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><a class="ae ku" href="https://github.com/kedacore/keda/blob/main/pkg/scalers/cassandra_scaler_test.go" rel="noopener ugc nofollow" target="_blank"> <em class="kt">单元测试</em> </a></li><li id="af6a" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><a class="ae ku" href="https://github.com/kedacore/keda/blob/main/tests/scalers/cassandra.test.ts" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> E2E测试</em> </a> <em class="kt">来自Github </em></li></ul></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h1 id="6c67" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">什么是KEDA？</h1><p id="3a80" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated"><strong class="jx io"> KEDA(基于Kubernetes的事件驱动自动缩放器)</strong>是一个单一用途的轻量级组件，可以添加到任何Kubernetes集群中。它帮助你根据等待处理的事件数量来扩展Kubernetes中的任何容器。</p><p id="9190" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">KEDA有自己的<strong class="jx io">四</strong> <strong class="jx io">自定义资源</strong> (CRD):</p><p id="dabc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">虽然我将为Cassandra scaler使用<strong class="jx io"> ScaledObjects </strong>和<strong class="jx io"> TriggerAuthentications </strong>，但我不会提及<strong class="jx io"> ScaledJobs </strong>和<strong class="jx io">clustertrigger authentication s</strong>。</p><p id="5746" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv mw b">ScaledObjects</code>表示事件源(例如Cassandra:)和Kubernetes部署、StatefulSet或任何将要扩展的定制资源之间的期望映射。</p><p id="d312" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv mw b">TriggerAuthentication</code>包含监控事件源的认证配置或秘密，可由ScaledObjects引用。</p><p id="9236" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在这里查看如何在Kubernetes <a class="ae ku" href="https://keda.sh/docs/2.4/deploy/" rel="noopener ugc nofollow" target="_blank">中<strong class="jx io">部署KEDA </strong>。</a></p><h1 id="4ee4" class="lq lr in bd ls lt mx lv lw lx my lz ma mb mz md me mf na mh mi mj nb ml mm mn bi translated">【Cassandra Scaler是做什么的？</h1><p id="bdab" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated">Cassandra Scaler通过解析传递了<strong class="jx io">元数据</strong>和<strong class="jx io">触发认证</strong>配置的<code class="fe mt mu mv mw b">scaledobject.yaml</code>文件来打开新的Cassandra会话。</p><p id="25d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">会话建立后，定标器运行查询来检查是否有等于或大于scaledobject.yaml文件中指定的<strong class="jx io"> targetQueryValue </strong>的未决事件。如果是，这将触发缩放器，然后缩放器将其自身设置为“活动”以缩放它们。</p><p id="313e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它根据scaledobject.yaml文件中再次指定的<strong class="jx io"> maxReplicaCount </strong>增加pod编号。在事件被消耗后，这一次，定标器根据<strong class="jx io"> minReplicaCount </strong>减少pod编号，并将其自身设置为“无效”,因为不再有事件。</p><h1 id="e8e3" class="lq lr in bd ls lt mx lv lw lx my lz ma mb mz md me mf na mh mi mj nb ml mm mn bi translated"><strong class="ak">Scaler怎么写？</strong></h1><p id="e25d" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated">KEDA的定标器写在<strong class="jx io"> Go </strong>中。我用<strong class="jx io"> Minikube </strong>做当地的Kubernetes。</p><p id="8163" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先声明scaler的地方应该有一个struct变量。缩放器由元数据和Cassandra会话组成。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="264f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，应该声明<code class="fe mt mu mv mw b">CassandraMetadata</code>结构。要打开带认证的Cassandra会话，需要<strong class="jx io">用户名</strong>和<strong class="jx io">密码</strong>。</p><ul class=""><li id="6c14" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated"><strong class="jx io"> clusterIPAddress </strong>是IP地址或主机名，而<strong class="jx io"> port </strong>是Cassandra实例的端口号。</li><li id="a86b" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io">一致性</strong>是针对会话或单个读取操作的配置。</li><li id="6f58" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io"> protocolVersion </strong>是CQL (Cassandra查询语言)二进制协议。</li><li id="10ed" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io"> keyspace </strong>是定义节点上数据复制的名称空间。</li><li id="a6f0" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io">查询</strong>是一个Cassandra查询，应该返回一个数值。</li><li id="d742" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io"> targetQueryValue </strong>是用户提供的阈值，在水平Pod自动缩放器(HPA)中用作targetAverageValue。</li><li id="b4f8" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io">指标名称</strong>是分配给指标的名称。</li><li id="6a32" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><strong class="jx io"> scalerIndex </strong>通过对metricName进行编号来帮助它变得唯一。</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="f2dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所有类型都声明之后，就该创建函数了。应该有构造定标器的函数:<code class="fe mt mu mv mw b">NewCassandraScaler</code>。</p><p id="3653" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它从<code class="fe mt mu mv mw b">ParseCassandraMetadatathe </code>函数获取解析后的元数据，并将其发送给<code class="fe mt mu mv mw b">NewCassandraSessionthe </code>函数以启动Cassandra会话。这样，如果发生错误，它将返回<strong class="jx io"> cassandraScaler </strong>和<strong class="jx io">错误</strong>。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="afaa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">解析<code class="fe mt mu mv mw b">scaledobject.yaml</code>文件是由<code class="fe mt mu mv mw b">ParseCassandraMetadata</code>函数完成的。它返回<strong class="jx io">Cassandra metadata</strong>struct和一个<strong class="jx io">错误</strong>(如果发生的话)。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="761a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">启动卡珊德拉会话由<code class="fe mt mu mv mw b">NewCassandraSession</code>功能完成。它返回创建的<strong class="jx io">会话</strong>和<strong class="jx io">错误</strong>(如果发生)。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="0dc9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我说过，当有未决事件时，定标器会将其自身设置为<strong class="jx io">活动状态</strong>。通过<code class="fe mt mu mv mw b">IsActive</code>功能完成。它获取查询结果并检查它是否高于0。如果是，则返回<strong class="jx io"> true </strong>表示“激活”，如果出现<strong class="jx io">错误</strong>。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="cd46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行查询并得到结果是通过<code class="fe mt mu mv mw b">GetQueryResult</code>功能完成的。它返回从查询中获得的<strong class="jx io">数值</strong>，如果发生错误则返回<strong class="jx io">错误</strong>。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ce74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">KEDA与Kubernetes <strong class="jx io">卧式豆荚机</strong> <strong class="jx io"> (HPA) </strong>合作。当KEDA注意到一个新的ScaledObject时，它会创建一个HPA对象，该对象包含轮询和相应缩放pod所需度量的基本信息。为了创建这个HPA对象，KEDA求助于<code class="fe mt mu mv mw b">GetMetricSpecForScaling</code>函数。这里也是借助<strong class="jx io"> ScalerIndex </strong>生成<strong class="jx io"> metricName </strong>的地方。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="db61" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv mw b">GetMetrics</code>是洁牙器的关键功能；它返回一个值，该值表示外部度量的当前状态(例如，Cassandra查询结果)。Kubernetes HPA(水平Pod Autoscaler)将通过KEDA的度量服务器定期轮询<code class="fe mt mu mv mw b">GetMetrics</code>(只要至少有一个Pod)，并将返回值与ScaledObject配置中的配置值进行比较。Kubernetes将使用以下公式来决定是否上下缩放豆荚:</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/06455bfacdc5a911a324b65030b46a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADnnhM6_YF_cfxWlhtCrGA.png"/></div></div></figure><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4704" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，还有一个<strong class="jx io"> Close </strong>函数，KEDA调用该函数，以便能够在定标器上的每次轮询之后关闭任何打开的连接来检索度量。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ee54" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kt">注意:</em> </strong> <em class="kt">你可以在最后找到定标器是如何工作的图片！</em></p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h1 id="1066" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">如何为卡珊德拉定标器编写单元测试？</h1><p id="f0d8" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated">单元测试测试输入是否产生预期的输出。KEDA所有的单元测试都写在<strong class="jx io"> Go </strong>中。</p><p id="b084" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在卡珊德拉的单元测试中，有两种类型的结构:一种是存储<strong class="jx io">元数据</strong>的地方，另一种是检查<strong class="jx io">度量名称</strong>。</p><p id="1158" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mt mu mv mw b">parseCassandraMetadataTestData</code>结构中；</p><ul class=""><li id="1415" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">元数据，</li><li id="b191" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">身份验证配置</li><li id="17ec" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">和错误被声明。</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="198a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv mw b">cassandraMetricIdentifier</code>结构中；</p><ul class=""><li id="f7f3" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">解析的元数据，</li><li id="cbb0" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">scalerIndex</li><li id="e81d" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">并声明度量的名称。</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="8ce8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，有两种类型的变量。一个是传递所有测试元数据的地方，另一个是传递预期metricNames的地方。</p><p id="7077" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mt mu mv mw b">testCassandraMetadata</code>变量中，首先没有传递任何会导致错误的东西。接下来，应该不会导致任何错误的所有内容都将通过。然后，所有导致错误的可能性都被忽略了。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="5a68" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mt mu mv mw b">cassandraMetricIdentifiers</code>变量中，写入了期望生成<strong class="jx io"> metricName </strong>的列表。在这种情况下，metricName在<strong class="jx io">列表1 </strong>和<strong class="jx io">列表2 </strong>中进行测试(由于列表2和以下内容在产生metricName方面是相同的，所以我只测试了列表2)。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="25ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，函数出现了。其中一个解析Cassandra元数据，另一个检查metricName生成。</p><p id="554a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里来自定标器的<code class="fe mt mu mv mw b">ParseCassandraMetadata</code>函数用于解析给定的数据。它检查错误的情况，无论它们是否是预期的。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="22b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一个也是最后一个函数<code class="fe mt mu mv mw b">TestCassandraGetMetricSpecForScaling</code>在<code class="fe mt mu mv mw b">PaseCassandraMetadata</code>函数的帮助下再次解析元数据。它创建一个新的Cassandra会话，然后检查测试数据中给定的metricNames是否与生成的metricNames匹配。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="65a9" class="nj lr in bd ls nk nl dn lw nm nn dp ma kg no np me kk nq nr mi ko ns nt mm nu bi translated">如何运行单元测试？</h2><p id="b651" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated">使用如下所示的<code class="fe mt mu mv mw b">go test</code>命令在Go run中编写的单元测试。作为命令的参数；</p><ul class=""><li id="f901" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">单元测试的路径，</li><li id="43cf" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">卡珊德拉scaler，</li><li id="8a2d" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated"><code class="fe mt mu mv mw b">scaler.go</code>文件</li><li id="dc53" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">并且<code class="fe mt mu mv mw b">azure_queue.go scaler</code>(<strong class="jx io">externaMetricType</strong>属性是在azure_queue_scaler.go中定义的，所以需要导入到go测试路径中)必须通过。</li></ul><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/5561df465a626a44b188ce1639772ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLtoOr7cKnegtzXBxK_S7w.png"/></div></div></figure></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h1 id="12e8" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">如何为Cassandra Scaler编写E2E测试？</h1><p id="b08f" class="pw-post-body-paragraph jv jw in jx b jy mo ka kb kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks ig bi translated">E2E测试从头到尾测试整个软件产品，以确保应用程序按预期运行。</p><p id="0527" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">KEDA的E2E考试是用<strong class="jx io">打字稿(。ts) </strong>。</p><p id="cd16" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有3个阶段:测试前，测试，测试后。</p><p id="2eba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">卡珊德拉缩放器的场景是这样的:</p><h2 id="deec" class="nj lr in bd ls nk nl dn lw nm nn dp ma kg no np me kk nq nr mi ko ns nt mm nu bi translated">测试阶段前</h2><ul class=""><li id="154c" class="kv kw in jx b jy mo kc mp kg nw kk nx ko ny ks la lb lc ld bi translated">设置测试中经常用到的常量</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="029a" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">为测试环境创建一个测试命名空间</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="13e9" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">部署Cassandra，等待它启动并运行</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="559a" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">部署Cassandra客户端，等待它启动并运行</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="c9e9" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">进入Cassandra客户端窗格，创建一个键空间和一个表</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="6969" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">部署nginx，因为它将被缩放(一些缩放者更喜欢NGINX缩放，所以我跟随他们)</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="2eb7" class="nj lr in bd ls nk nl dn lw nm nn dp ma kg no np me kk nq nr mi ko ns nt mm nu bi translated">检验阶段</h2><ul class=""><li id="f2b6" class="kv kw in jx b jy mo kc mp kg nw kk nx ko ny ks la lb lc ld bi translated">在将任何数据插入到Cassandra表之前，测试nginx部署是否首先从0副本开始</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="c5be" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">插入足够的数据并测试副本计数是否达到maxReplicaCount</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="ca33" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">删除所有数据，并测试副本计数是否下降到minReplicaCount(零)</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="824a" class="nj lr in bd ls nk nl dn lw nm nn dp ma kg no np me kk nq nr mi ko ns nt mm nu bi translated">测试后</h2><ul class=""><li id="77d2" class="kv kw in jx b jy mo kc mp kg nw kk nx ko ny ks la lb lc ld bi translated">删除测试命名空间</li></ul><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="b2e5" class="nj lr in bd ls nk nl dn lw nm nn dp ma kg no np me kk nq nr mi ko ns nt mm nu bi translated">如何运行E2E测试？</h2><pre class="nc nd ne nf gt nz mw oa ob aw oc bi"><span id="e627" class="nj lr in mw b gy od oe l of og">cd tests/<br/>npx ava scalers/cassandra.test.ts -v</span></pre><p id="7d0d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">E2E测试的输出如下面的第一幅图所示。</p><h1 id="0a71" class="lq lr in bd ls lt mx lv lw lx my lz ma mb mz md me mf na mh mi mj nb ml mm mn bi translated">卡桑德拉Scaler如何工作的照片</h1><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/48899cb52d8a971fefc01d00de3d9de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uLdJe_gUQtI8Aw_Dbc60g.png"/></div></div></figure><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/766a4858590663c9bbfabbf75ddafa0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7zlJ7xyo2KobPEV42_eFw.png"/></div></div></figure></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><p id="c40c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">谢谢你陪我走到这一步！😃希望一切都明白。能为这样一个大而惊人的项目做贡献，我感到非常荣幸！🎉</p><p id="ff39" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我非常感谢坎·厄兹丁纳和<a class="oi oj ep" href="https://medium.com/u/e81e868a724?source=post_page-----d0b3878c6baf--------------------------------" rel="noopener" target="_blank">奥莰·厄兹德米尔</a>在整个项目中的支持。非常特别地感谢我唯一的<a class="oi oj ep" href="https://medium.com/u/4b2a89e759cf?source=post_page-----d0b3878c6baf--------------------------------" rel="noopener" target="_blank">Bar Kurt</a>在这个项目中不分昼夜地帮助和支持我。没有他们我做不到。❤️</p><p id="d204" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">KEDA 有很棒的维护人员，我也要感谢他们一直以来的帮助和理解。他们不厌其烦地回答你的问题。🌟</p></div></div>    
</body>
</html>