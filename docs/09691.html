<html>
<head>
<title>Recreating a Tableau Dashboard using R Shiny</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R Shiny 重新创建 Tableau 仪表板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/tableau-v-s-r-shiny-for-dashboards-86ae04d3611e?source=collection_archive---------13-----------------------#2022-09-05">https://blog.devgenius.io/tableau-v-s-r-shiny-for-dashboards-86ae04d3611e?source=collection_archive---------13-----------------------#2022-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="f719" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我刚刚试着用<a class="ae ki" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> R Shiny </a>重新制作了一个 Tableau 仪表盘，这是我的结果和想法。</p><h1 id="5f72" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">（舞台上由人扮的）静态画面</h1><p id="598e" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">一年前，我用 Tableau 绘制了印度煤矿开采状况的数据，看起来是这样的:</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/339a33d6eed089703678e397b172d315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GFNnFprP_gc_z6hPTAQ5w.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated"><a class="ae ki" href="https://public.tableau.com/app/profile/jayantkaushik/viz/IndiaCoalMines_16287026155770/Dashboard1" rel="noopener ugc nofollow" target="_blank">印度煤矿| Tableau 公共</a></figcaption></figure><p id="0fda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">链接到 Tableau 仪表盘:<a class="ae ki" href="https://public.tableau.com/app/profile/jayantkaushik/viz/IndiaCoalMines_16287026155770/Dashboard1" rel="noopener ugc nofollow" target="_blank">印度煤矿| Tableau 公共</a></p><p id="dab9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个仪表板还有一个向下钻取功能，当您在地图上单击印度的每个邦时，就可以看到它们的数据。</p><p id="2297" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">过程:除了一些数据清理和创建计算字段之外，它主要是一个拖放过程</p><h1 id="6ca7" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">r 闪亮</h1><p id="c4de" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">上周，我学会了 R Shiny 的细微差别(从零开始)，并能够轻松地重新创建上面的仪表板。看看..</p><p id="c7d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">链接到 R 闪亮仪表板:<a class="ae ki" href="https://t95zpt-jayant-kaushik.shinyapps.io/Coal_Mines_India/" rel="noopener ugc nofollow" target="_blank">煤炭生产—印度(shinyapps.io) </a>(第一次加载时给它几秒钟时间)</p><p id="abb7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您希望<a class="ae ki" href="https://medium.com/@jayant_kaushik/tableau-v-s-r-shiny-for-dashboards-86ae04d3611e#2367" rel="noopener"> <strong class="jm io">查看代码</strong> </a>，请跳到本页的最后一部分。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mc"><img src="../Images/627b5d84899a5596857046ae349a992b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMDuqur05WBx3R07ocKs5A.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated"><a class="ae ki" href="https://t95zpt-jayant-kaushik.shinyapps.io/Coal_Mines_India/" rel="noopener ugc nofollow" target="_blank">煤炭产量—印度(shinyapps.io) </a></figcaption></figure><p id="17e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">流程:</strong>获取数据&gt;清理&gt;转换&gt;汇总数据以创建地块&gt;在印度地图上绘制 GIS 数据。</p><p id="c979" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，品味良好的用户界面。我不得不谷歌了很多东西来润色这个应用程序，让它看起来像现在这样。例如，最初我无法找到印度及其各州的坐标/多边形信息。我确实找到了一些来源，比如印度媒体提供的 geojson <a class="ae ki" href="https://github.com/HindustanTimesLabs/shapefiles" rel="noopener ugc nofollow" target="_blank"> shape 文件</a>，我本可以使用这些文件，但是必须有更好的解决方案。那是我发现<a class="ae ki" href="https://gadm.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> GADM </strong> </a>的时候，他们为世界上几乎每一个国家提供最细粒度的形状文件！锦上添花的是，您可以通过简单的一行代码将 GIS 数据直接导入 R 中(data &lt; - getData("GADM "，country= "IND "，level=1))。</p><p id="d78f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">继续，用于创建地图的<strong class="jm io">传单</strong>库是一个非常强大的工具集合，可以创建任何你想要的基于地图的可视化。</p><h2 id="9928" class="md kk in bd kl me mf dn kp mg mh dp kt jv mi mj kx jz mk ml lb kd mm mn lf mo bi translated"><strong class="ak">闪亮的画面:我的想法:</strong></h2><p id="45c2" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">当您希望可视化只使用一次/很少使用，或者数据集很小(在 Excel 中易于管理)并且最终用户不需要太多交互时，Tableau 非常适合快速创建令人印象深刻的可视化</p><p id="da0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其他的都用 R 闪亮。它是快速分析大型数据集的强大工具，并允许您在仪表板上添加许多交互性，这将使您的仪表板不仅仅是第一眼看上去有用。</p><p id="6bf3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">数据:</strong> <a class="ae ki" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/TDEK8O" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">一个数据文件</strong> </a> <strong class="jm io"> + </strong> <a class="ae ki" href="https://iopscience.iop.org/article/10.1088/2633-1357/abdbbb/pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">文章由研究者发表</strong> </a></p><p id="9fad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是原始数据文件的样子:</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mp"><img src="../Images/9fd1fe07d0e23a507065b375cdff344e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fljNuS5wKt93mzpJGuTjxQ.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">Excel 中的原始数据文件</figcaption></figure><h2 id="2367" class="md kk in bd kl me mf dn kp mg mh dp kt jv mi mj kx jz mk ml lb kd mm mn lf mo bi translated"><strong class="ak">代码:</strong></h2><p id="0484" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">每个 R Shiny 应用程序大致有 4 个部分——静态部分、UI 脚本、服务器脚本和 shinyApp(ui，服务器)函数</p><p id="1d4e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这一切是如何运作的:</p><p id="9e41" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">静态部分首先加载</strong>所有应该在应用程序启动时只加载一次的东西都应该放在这个部分。例如数据和所有的库！如果你将数据放入任何其他部分，它会降低你的应用程序的速度，因为每当有人与你的应用程序的元素交互时(如按下按钮)，应用程序都会重新加载数据。</p><p id="e8c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">UI 脚本:这是你告诉 R Shiny 把你设计的各种元素放到页面上的地方。基本上是版面设计。</p><p id="3339" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">服务器脚本:这是你设计的所有 ggplots、地图和其他东西的代码所在的地方。</p><p id="d850" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> shinyApp 功能:</strong>只是告诉 shiny 请使用 UI 脚本和服务器脚本，创造魔法的一种方式！</p><p id="3e84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们看看代码..</p><p id="78cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">静态部分:</strong></p><pre class="ln lo lp lq gt mq mr ms mt aw mu bi"><span id="c8ea" class="md kk in mr b gy mv mw l mx my">library(shiny)# life is dull without this<br/>library(tidyverse)# makes things tidy<br/>library(readxl) # to read source data file<br/>library(shinydashboard) # for layout<br/>library(leaflet) # for map<br/>library(leaflet.providers) # to load OpenStreet Map<br/>library(raster) # for map<br/>library(sf) # for map</span><span id="53e8" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">READING RAW DATA</strong><br/>data &lt;- read_excel("data/coal_data.xlsx")</span><span id="ade6" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">DATA TRANSFORMATIONS</strong> (<strong class="mr io">data for the Bar Charts</strong>):</span><span id="30bb" class="md kk in mr b gy mz mw l mx my">owner_avg &lt;- data %&gt;% group_by(Owner_name) %&gt;% summarise(production_permine = round(mean(Production_MT),1)) %&gt;% arrange(desc(production_permine)) %&gt;% slice(1:10)</span><span id="23f0" class="md kk in mr b gy mz mw l mx my">dist_avg &lt;- data %&gt;% group_by(District_Name) %&gt;% summarise(production_perdistrict = round(sum(Production_MT),1)) %&gt;% arrange(desc(production_perdistrict)) %&gt;% slice(1:10)</span><span id="25a4" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">DATA FOR THE MAP:</strong><br/>data2 &lt;- data %&gt;% select_("State", "District_Name", "Production_MT") %&gt;% group_by(State) %&gt;% summarise(production_perstate = round(sum(Production_MT),1))</span><span id="93de" class="md kk in mr b gy mz mw l mx my"># The map wasn't showing <strong class="mr io">data for Orissa</strong>, turns out the name of the state was changed to Odisha by the Govt of India, so let's change it in our dataset:</span><span id="aecc" class="md kk in mr b gy mz mw l mx my">data2[7, "State"] &lt;- "Odisha"</span><span id="bfbb" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">DOWNLOAD MAP COORDINATES FROM GADM</strong>:<br/>IND_3 &lt;- getData("GADM", country= "IND", level=1) # Level 1 means States, Level 2 would be Districts</span><span id="e518" class="md kk in mr b gy mz mw l mx my">IND_1 &lt;- merge(IND_3, data2,<br/>               by.x = c("NAME_1"), by.y = c("State"),<br/>               all.x = TRUE) <br/>ind_2 &lt;- IND_1[IND_1$NAME_1 %in% data2$State, ]</span><span id="a0bb" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">DEFINING COLOR PALETTE FOR MAP TILES</strong>. Using Black/grey color palette which correlates with color of coal</span><span id="059c" class="md kk in mr b gy mz mw l mx my">pal &lt;- colorNumeric(<br/>  palette = c("#e0e0e0", "#000000"),<br/>  domain = ind_2$production_perstate) #Tiles would be colored based on production_perstate values</span></pre><p id="a383" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">用户界面脚本:</strong></p><pre class="ln lo lp lq gt mq mr ms mt aw mu bi"><span id="7f7e" class="md kk in mr b gy mv mw l mx my"># <strong class="mr io">Defining the layout of the objects</strong>. We use a 'mixed row &amp; column' layout</span><span id="ac0e" class="md kk in mr b gy mz mw l mx my">body &lt;- dashboardBody(fluidRow(box(div(class = "my-class", h3("INDIA'S LARGEST COAL PRODUCERS"), style="text-align:center;"), width = NULL, height = 62, status = "primary"<br/>),<br/>#<strong class="mr io"> Placing the Map:</strong><br/>  column(width = 6, height = 14,<br/>         box(div(class = "my-class", h4("PRODUCTION PER STATE"), style="text-align:left"), style='height:600px;overflow-y: scroll;',<br/>             leafletOutput('myMap', height="500px"), div(class = "my-class", h5("All data for the financial year 2019-20. Units in Metric Tonnes"), style="text-align:left"),width = NULL)),</span><span id="2dda" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">Placing the Bar Charts:</strong>              <br/>  column(width=6,<br/>         box(div(class = "my-class", h4("WHICH COMPANIES GET THE MOST OUT OF EACH MINE?"), style="text-align:center") ,style='height:250px;overflow-y: scroll;',<br/>         plotOutput("bar1", height="350px"), width = NULL, status = "primary"<br/>         ),<br/>                 <br/>         box(div(class = "my-class", h4("WHICH ARE THE TOP PRODUCING DISTRICTS?"), style="text-align:center") ,style='height:250px;overflow-y: scroll;',<br/>         plotOutput("bar2", height="350px"), width = NULL<br/>         )<br/>         )<br/>),<br/># <strong class="mr io">Placing the Citations and Creator Info:</strong><br/>            fluidRow(box(div(class = "my-class", h5("CREATED BY: JAYANT KAUSHIK | " ,tags$a(href="<a class="ae ki" href="https://www.linkedin.com/in/jayantkaushik/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/jayantkaushik/</a>", "Linkedin")), style="text-align:center"),div(class = "my-class", h6("Data Source: ", tags$a(href="<a class="ae ki" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/TDEK8O" rel="noopener ugc nofollow" target="_blank">https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/TDEK8O</a>", "Harvard Dataverse")," | Sandeep Pai and Hisham Zerriffi. A novel dataset for analysing sub-national socioeconomic developments in the Indian coal industry. ", tags$a(href="<a class="ae ki" href="https://iopscience.iop.org/article/10.1088/2633-1357/abdbbb" rel="noopener ugc nofollow" target="_blank">https://iopscience.iop.org/article/10.1088/2633-1357/abdbbb</a>", "IOPSciNotes")), style="text-align:center"), width = NULL, status = "primary"<br/>))<br/>)</span><span id="b5eb" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">Giving all the above to the UI function:</strong></span><span id="020d" class="md kk in mr b gy mz mw l mx my">ui &lt;- dashboardPage(title="Coal Production - India",<br/>  dashboardHeader(disable= TRUE),<br/>  dashboardSidebar(disable = TRUE),<br/>  body<br/>)</span></pre><p id="a0ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">服务器脚本:</strong></p><pre class="ln lo lp lq gt mq mr ms mt aw mu bi"><span id="f9b1" class="md kk in mr b gy mv mw l mx my">server &lt;- function(input, output, session) </span><span id="815e" class="md kk in mr b gy mz mw l mx my"># <strong class="mr io">Creating the Map:</strong><br/>{<br/>  map = ind_2  %&gt;%<br/>    leaflet(options = leafletOptions(minZoom = 4.4, maxZoom = 4.4, zoomControl = FALSE)) %&gt;%<br/>    addProviderTiles(providers$CartoDB.PositronNoLabels) %&gt;% setView( lat = 21.1458<br/>                                                                      , lng = 79.0882<br/>                                                                      , zoom = 4.4 )%&gt;%<br/>    addPolygons(weight = 1,<br/>                stroke = TRUE,<br/>                color = "grey",<br/>                fillColor = ~pal(production_perstate),<br/>                fillOpacity = 0.7,<br/>                dashArray = "0.5",<br/>                #popup = ~NAME_0,<br/>                label = ~paste(NAME_1,<br/>                               "&lt;br/&gt;",<br/>                               "Coal Produced:", production_perstate, "MT")%&gt;% lapply(htmltools::HTML),<br/>                highlight = highlightOptions(<br/>                  weight = 2,<br/>                  dashArray = "",<br/>                  color = "black",<br/>                  bringToFront = TRUE<br/>                ))<br/>    #setView(-93.65, 42.0285, zoom = 17)<br/>  output$myMap = renderLeaflet(map)</span><span id="c283" class="md kk in mr b gy mz mw l mx my"> # <strong class="mr io">Creating Bar Charts:</strong><br/> output$bar1&lt;-renderPlot(<br/>    ggplot(owner_avg, aes(x = production_permine, y = reorder(Owner_name, production_permine) ), )+geom_bar(stat = "identity", width = 0.7, fill ="black")+ geom_text(aes(label=production_permine), hjust=-0.20, size=3.5)+ theme_minimal(base_size = 15)+ labs(x = " ", y = "")+ labs(subtitle = "COAL PRODUCED PER MINE")<br/>    <br/>    )<br/>  output$bar2&lt;-renderPlot(<br/>    <br/>    ggplot(dist_avg, aes(x = production_perdistrict, y = reorder(District_Name, production_perdistrict) ), )+geom_bar(stat = "identity", width = 0.7, fill ="black", name="District_Name")+ geom_text(aes(label=production_perdistrict), hjust=-0.1, size=3.5)+ theme_minimal(base_size = 15)+ labs(x = " ", y = "")<br/>    <br/>    )<br/>  <br/>}</span></pre><p id="5b48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">shinyApp 函数:</p><pre class="ln lo lp lq gt mq mr ms mt aw mu bi"><span id="547a" class="md kk in mr b gy mv mw l mx my">shinyApp(ui, server)</span></pre><p id="de96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，你可以将以上四个部分组合起来，放入一个名为“app”的脚本中。你的仪表板已经准备好了！</p><p id="531a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我工作的下一部分，我将在地图上添加交互性，这样我们就可以深入每个州的数据，并根据用户输入查看条形图的变化！</p><p id="6aeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">快乐学习！</p></div></div>    
</body>
</html>