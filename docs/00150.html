<html>
<head>
<title>Preparing for my first Hadoop &amp; Spark cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为我的第一个 Hadoop 和 Spark 集群做准备</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-i-set-up-my-first-hadoop-spark-cluster-preparation-663893486d12?source=collection_archive---------0-----------------------#2020-04-02">https://blog.devgenius.io/how-i-set-up-my-first-hadoop-spark-cluster-preparation-663893486d12?source=collection_archive---------0-----------------------#2020-04-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="216f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我设想建立一个大数据实践集群已经有一段时间了。从传统的商业智能背景进入软件工程角色(尽管仍然与数据密切相关)，大数据技术引起我的注意只是时间问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8043ec9bc253ecab1892215f1fcea0bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0qfkWpOaOvrNzbbxcqmKg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在第二次尝试中，我的普通集群的 2/3(几乎)正确组装</figcaption></figure><p id="8b2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从局外人的角度来看，大数据景观听起来像是一个时髦词汇和无数产品的集合:从更熟悉的 Hadoop 开始，到适合该生态系统的广泛组件:HDFS、Yarn、Spark、Pig、Hive、Airflow 或 Nifi。我不得不承认他们中的一些人有着非常有趣的名字，但是他们是如何融入这幅画的呢？</p><p id="2f53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">嗯，我一定会开始发现，但这种事情不是你通过观看视频教程就能学会的。此外，学习新事物在开始时总是令人兴奋的，但当你遇到障碍时就会非常沮丧。我之前确实尝试过至少两次设置 Hadoop:一次是在本地，另一次是使用<a class="ae ky" href="https://www.cloudera.com/developers/get-started-with-hadoop-tutorial.html" rel="noopener ugc nofollow" target="_blank"> Cloudera 快速启动虚拟机</a>。第一次，我在几分钟后就放弃了尝试设置我的本地 Java 环境(我知道，我知道)，而第二次，我觉得这是一个单节点的沙盒设置，并不像我想要的那样接近“真实的东西”。</p><p id="8ee3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇文章是一系列文章中的第一篇，本质上是我在这段旅程中的游记汇编。它并不真的是一个教程，因为我将参考其他全面的和写得很好的资源，涵盖了 90%的方式。它的目的是减少读者(或未来的我)需要花在其他 10%上的时间，或者作为一个主题的软介绍。这是一个非常长的介绍，所以让我们开始工作吧！</p><h1 id="bc32" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">准备工作</h1><p id="ab1d" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在开始做任何事情之前，我会在网上寻找不同的资源，寻找能够全程指导我的教程。</p><p id="200f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我发现这个<a class="ae ky" href="https://dev.to/awwsmm/building-a-raspberry-pi-hadoop-spark-cluster-8b2" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">是一个很好的记录，也是一个杰出的系列</strong> </a>，作者是都柏林的一个叫 Andrew 的家伙，他基本上解释了我在开始之前需要知道的一切。我不得不在这里和那里做一些调整。</p><h2 id="952f" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">五金器具</h2><p id="6462" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">首先，我想走真正的硬件路线，而不是建立一个虚拟机舰队。所以我决定来个树莓派集群。我已经有了一个 1GB 的树莓派 3B(T1)(几年前花 35 英镑买的)，还买了另一个 2GB 的树莓派 4B(T3)和一个带散热风扇的集群机箱(T5)。好消息是:我在 24 小时内就把它们从英国送到了布加勒斯特。除了两个 Pi 节点之外，我将在我的笔记本电脑上设置另一个节点，它也将是主节点。</p><p id="d219" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然网络性能和外观有更好的选择(<a class="ae ky" href="https://en.wikipedia.org/wiki/Power_over_Ethernet" rel="noopener ugc nofollow" target="_blank"> PoE </a>)，但由于我的设备有 WiFi 连接，我决定让它们通过无线通信，并使用标准(类似手机的)充电器充电。两者都有一个 16GB 的 microSD 卡作为存储。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b6db6ee5897aa0a2579b123493e9c9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*8IkfUqZ_1kNHU_KEtd85QQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">为我的集群制定计划</figcaption></figure><h2 id="f30e" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">操作系统</h2><p id="a48f" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">接下来，设置 Pis。虽然它们配备了<a class="ae ky" href="https://www.raspberrypi.org/downloads/noobs/" rel="noopener ugc nofollow" target="_blank">Noobs</a>——一个简单的操作系统安装程序——允许安装<a class="ae ky" href="https://www.raspberrypi.org/downloads/raspbian/" rel="noopener ugc nofollow" target="_blank"> Raspbian </a>，一个基于 Debian 的 Linux，这是 Rasbperry Pis 最受欢迎的选择，但我决定在这个平台上使用 Ubuntu。我下载了<a class="ae ky" href="https://ubuntu.com/download/raspberry-pi" rel="noopener ugc nofollow" target="_blank"> Ubuntu 服务器映像</a>，并使用带有<a class="ae ky" href="https://www.raspberrypi.org/blog/raspberry-pi-imager-imaging-utility/" rel="noopener ugc nofollow" target="_blank"> Pi 成像仪</a>的 SD 适配器将它刻录到我的 PC 上的 microSD 中——这是一个简单的过程，大约需要 3 分钟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/d5b815115059b5630c387f4c4ad41df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*wakzrWQhIUEoaWwRIj2m6Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Raspberry Pi 成像仪</figcaption></figure><p id="d769" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我使用这里的说明<a class="ae ky" href="https://askubuntu.com/questions/1143287/how-to-setup-of-raspberry-pi-3-onboard-wifi-for-ubuntu-server-18-04" rel="noopener ugc nofollow" target="_blank">为我新设置的 Raspberry Pi 设置了无线连接。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/4230b41baa867f7546dfbd5faa1512b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtn0LZB_LVHi_Cb58E5Leg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">/etc/net plan/50-cloud-init . YAML</figcaption></figure><h2 id="b011" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">主机名</h2><p id="8436" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">接下来，我在每台机器上设置了主机名和主机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/a5d22872c377878cd09696c163cd30b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXZO6jYWQUy-xr1kfv1cDg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">其中一个 pi 的/etc/hostname 和/etc/hosts</figcaption></figure><h2 id="4745" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">嘘</h2><p id="eb95" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">另一个重要步骤是 SSH 设置。这将允许连接到我们集群中的机器并在其上运行命令。我们从在机器上启用 SSH 开始:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4d8a" class="mc la in ms b gy mw mx l my mz">sudo apt update<br/>sudo apt install openssh-server<!-- --> </span></pre><p id="5ce0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以通过以下方式测试服务是否正常运行:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="7086" class="mc la in ms b gy mw mx l my mz">sudo systemctl status ssh</span></pre><p id="a947" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，假设<em class="na"> ubuntu </em>是我们的用户，<em class="na"> rpi-3 </em>是我们想要连接的机器，我们可以执行下面的命令，输入密码并连接。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="d2ad" class="mc la in ms b gy mw mx l my mz">ssh ubuntu@rpi-3</span></pre><p id="43b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要处理几件事情。要启用无密码登录，让我们在主服务器上创建一个公钥-私钥对:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="f98f" class="mc la in ms b gy mw mx l my mz">ssh-keygen</span></pre><p id="152a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将生成一个公钥和一个私钥，默认位置为<strong class="jm io"> <em class="na"> ~/。ssh </em> </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/8657ca068fa6bd7019ff52bf1340533c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eUF0L-bwxsDc_xHCzeKdDw.png"/></div></div></figure><p id="f2d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在将把我们的<strong class="jm io">公钥</strong>附加到从机的 authorized_keys 上</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="982a" class="mc la in ms b gy mw mx l my mz">cat ~/.ssh/id_rsa.pub | ssh ubuntu@rpi-3 'cat &gt;&gt; .ssh/authorized_keys'</span></pre><p id="ee88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，在主服务器上，我们将在<strong class="jm io"> <em class="na"> ~/处设置一个配置文件。ssh/config </em>和</strong>如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="39a2" class="mc la in ms b gy mw mx l my mz">Host rpi-3<br/>HostName rpi-3<br/>User ubuntu<br/>IdentityFile ~/.ssh/id_rsa</span><span id="0bf7" class="mc la in ms b gy nc mx l my mz">Host rpi-4<br/>HostName rpi-4<br/>User ubuntu<br/>IdentityFile ~/.ssh/id_rsa</span></pre><p id="dc64" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，通过 SSH 连接到另一台机器非常简单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/499b9653b5ce45f6ff838c3db10ab768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYWQJaqbtcAdaIJgNFcGnQ.png"/></div></div></figure><h2 id="9610" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">安全性和实用性</h2><p id="d142" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">前面提到的教程<a class="ae ky" href="https://dev.to/awwsmm/building-a-raspberry-pi-hadoop-spark-cluster-8b2" rel="noopener ugc nofollow" target="_blank">也采取了措施来保护集群(禁用密码登录、登录和当天可能泄露的消息)——我认为应该遵循的重要建议。此外，建议使用实用函数，使集群中的所有机器都能执行一次命令。例如，我在我的<strong class="jm io"> <em class="na">中添加了以下内容。bashrc </em> </strong>以便可以从主节点发出一个命令并在所有节点上执行。我稍微修改了一下我的命令，这样<em class="na">other pi</em>就可以查找名称中有<em class="na"> rpi- </em>的主机，而<em class="na"> clustercmd </em>就不会在我的主机上执行这个命令。</a></p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="1148" class="mc la in ms b gy mw mx l my mz">function otherpis {<br/>  grep "rpi-" /etc/hosts | awk '{print $2}' | grep -v $(hostname)<br/>}</span><span id="63f3" class="mc la in ms b gy nc mx l my mz">function clustercmd {<br/>  for pi in $(otherpis); do ssh $pi "$@"; done<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/1268a754bae533176fce59a8cfc79b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*WCAIhD4tAmhmWIQRArIdgw.png"/></div></figure><h2 id="7e04" class="mc la in bd lb md me dn lf mf mg dp lj jv mh mi ln jz mj mk lr kd ml mm lv mn bi translated">结论</h2><p id="2547" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">现在我们有了一组可以执行命令的机器，我们可以继续设置 Hadoop 和 Spark。我将在下一篇文章中详细介绍我在这个过程中遇到的问题。感谢您的阅读，再见。</p></div></div>    
</body>
</html>