<html>
<head>
<title>Publish a NuGet package to Azure Artifacts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 NuGet 包发布到 Azure 工件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/publish-a-nuget-package-to-azure-artifacts-8a829ae5c062?source=collection_archive---------0-----------------------#2021-04-05">https://blog.devgenius.io/publish-a-nuget-package-to-azure-artifacts-8a829ae5c062?source=collection_archive---------0-----------------------#2021-04-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/57f087dc77a88d362f035f10adae1393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUjtNn5egreEGK6eO9NCUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">礼貌<a class="ae jz" href="https://undraw.co/" rel="noopener ugc nofollow" target="_blank">undraw.co</a></figcaption></figure><p id="9f17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将了解如何使用 NuGet 将包发布到 Azure 工件提要。</p><p id="8c4d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们来定义问题陈述:</p><ul class=""><li id="4aa9" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">我有一个公共类库。NET 核心项目，需要在我的组织中的不同项目中使用</li><li id="9017" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我的组织将我们的私有包存储在 Azure 工件提要中</li><li id="b8b0" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我想将我的公共库发布到 Azure Artifacts feed，以便其他团队可以在他们的项目中使用这个库</li><li id="329e" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">额外收获:我希望我的包被版本化</li></ul><p id="20aa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="lm">注意:我在构建过程中使用 Azure 管道。</em> </strong></p><p id="d6e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要求:</p><ul class=""><li id="3999" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">Azure Artifacts feed——如果你没有 Azure DevOps 账户，你可以在 https://dev.azure.com<a class="ae jz" href="http://dev.azure.com/" rel="noopener ugc nofollow" target="_blank">注册。</a><a class="ae jz" href="https://azure.microsoft.com/en-in/pricing/details/devops/azure-devops-services/" rel="noopener ugc nofollow" target="_blank">免费层</a>为您提供 1 个每月 1800 分钟的 CI/CD 微软托管作业和 1 个每月无限分钟的自托管作业，我认为这非常酷。哦，还有 2 件艺术品！</li><li id="5733" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">可视化工作室</li><li id="e334" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">。NET Core —如果您正在使用。NET 框架，您只需要在。nuspec 和构建管道</li><li id="9c95" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">熟悉 Azure DevOps</li></ul><p id="80e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">源代码<a class="ae jz" href="https://github.com/krisravishankar/artifacts-demo" rel="noopener ugc nofollow" target="_blank">可在这里</a>获得。如果你想继续的话，你可以克隆它。</p><h2 id="9cb8" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">步骤 1:创建您的库项目</h2><p id="fc50" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">我跳过这一步，因为这只是你的项目的基本创建。让我们假设我们已经创建了一个名为<strong class="kc io">工件的解决方案。两个项目的通用演示</strong></p><ul class=""><li id="ef33" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated"><strong class="kc io">神器。演示.常见.模型</strong></li><li id="5801" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><strong class="kc io">神器</strong>。<strong class="kc io">演示。常用工具</strong></li></ul><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a62f6dda9df2b1d65615b1df2405a154.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*c6bIUzeuHxCBzF1k1g4Npg.png"/></div></figure><p id="a00d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意我们有依赖包:Models 项目中的 AutoMapper 和 Newtonsoft。公共事业项目中的 Json。我之所以强调这一点，是因为我们希望通过消费项目来加载这些依赖项。</p><h2 id="49d7" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">步骤 2:创建一个. nuspec 文件</h2><p id="8e4d" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">的。nuspec 文件是一个包含包元数据的 XML 清单。它基本上提供了关于软件包的信息，包括名称、版本号、描述、作者、引用的 dll 和其他依赖项。</p><p id="41b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开 Git Bash 并导航到包含您的解决方案的文件夹(。sln)文件。对我来说，它存在于工件中——demo/src。创建。nuspec 文件使用<em class="lm">触摸</em>命令。如果没有 touch，<a class="ae jz" href="https://www.npmjs.com/package/touch-for-windows" rel="noopener ugc nofollow" target="_blank">可以从这里安装</a>。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="b0a1" class="ln lo in mr b gy mv mw l mx my">touch Artifacts.Demo.Common.nuspec</span></pre><p id="9a77" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建一个空的。nuspec 文件。在编辑器中打开文件并粘贴以下内容:</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5abc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想在这里提出三点:</p><ul class=""><li id="5f9e" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">版本—这是您的软件包版本</li><li id="1773" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">依赖项—您希望指定已导入到项目中的所有依赖项，以便使用应用程序能够正常工作</li><li id="ab88" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">文件——您将在构建过程中生成的 dll 发布到 lib 文件夹中，以便在 NuGet 打包项目时可以提取这些 dll</li></ul><p id="42f6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您还可以使用出色的<a class="ae jz" href="https://github.com/NuGetPackageExplorer/NuGetPackageExplorer" rel="noopener ugc nofollow" target="_blank"> NuGet Package Explorer </a>工具来创建。nuspec 文件。</p><h2 id="2ee3" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">步骤 3:创建 Azure 工件提要</h2><p id="9b86" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">登录到你的 Azure DevOps 帐户(在 dev.azure.com)，转到<strong class="kc io">工件</strong>(如果你还没有从你的项目设置中启用工件)，并创建一个如下所示的 feed:</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/b4c4ad73add7e34f128079193f009fb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yl6KEaDeXAj0dRyUD7SjFg.png"/></div></div></figure><p id="84f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我正在创建一个名为<strong class="kc io">我的工件</strong>的 feed。我取消了“包含来自公共资源的包”的选择，因为我不想让公共包成为我的 feed 的一部分。单击 Save，您的提要就准备好了。</p><h2 id="543f" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">步骤 4:为项目设置 Azure 管道</h2><p id="688b" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">现在点击<strong class="kc io"> Pipelines </strong>菜单项(如果你还没有从你的项目设置中启用 Pipelines)并创建一个<strong class="kc io">新管道</strong>。向导将要求您授权并连接到源代码管理中的项目。我的 repo 在 GitHub 上，所以我选择 GitHub 选项，授权我的帐户，然后选择我当前正在处理的存储库，即<strong class="kc io"> artifacts-demo </strong>。</p><p id="2ea6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<strong class="kc io">配置您的管道</strong>步骤中选择 ASP.NET 核心。</p><p id="479c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当编辑器打开时，清除 azure-pipelines.yml 的现有内容并粘贴以下内容:</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a5b5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">管道将首先使用<strong class="kc io"> <em class="lm"> dotnet build </em> </strong>构建项目，然后使用<strong class="kc io"> <em class="lm"> nuget pack </em> </strong>打包项目，然后使用<strong class="kc io"> <em class="lm"> nuget push </em> </strong>将项目发布到 feed。</p><h2 id="3886" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">步骤 4:运行管道</h2><p id="7640" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">按下<strong class="kc io">保存并运行</strong>按钮，这将自动触发流水线。等待几秒钟，等待构建完成。</p><h2 id="ee6b" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">第五步:完成！</h2><p id="0414" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">您的包现在可以在您的 Azure Artifacts feed 中获得。Tada！</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/2bbfba0f872767604a5a064ca283e53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tXuAiMZJFh3cgvfCZgQ19w.png"/></div></div></figure><p id="148e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在您想在您正在构建的其他项目中使用这个包。您需要从 Visual Studio 的 NuGet 包管理器连接到您的提要。更多信息请点击这里。</p><p id="33fd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果一切顺利，你可以从 NuGet 包管理器添加这个包，如下所示:</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/9dd3707c17466c643725c0c31ec2acec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8428psRHru-xaFi1wyW_SA.jpeg"/></div></div></figure><p id="858c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">很酷，对吧？</p><h2 id="7494" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">奖励:包版本控制</h2><p id="966a" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">看到你包装上的版本号了吗？上面写着 1.0.0，那是因为我们在。nuspec 文件。每次进行更改时，都可以在。nuspec 文件，但我肯定你想自动化。对于版本控制，我使用一个名为<a class="ae jz" href="https://github.com/dotnet/Nerdbank.GitVersioning" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> NerdBank 的包。git versioning</strong>T3。</a></p><p id="7ed9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过运行以下命令安装该工具:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="4d6a" class="ln lo in mr b gy mv mw l mx my">dotnet tool install -g nbgv</span></pre><p id="615d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在转到项目的根文件夹，运行以下命令</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="826c" class="ln lo in mr b gy mv mw l mx my">nbgv install -s <a class="ae jz" href="https://api.nuget.org/v3/index.json" rel="noopener ugc nofollow" target="_blank">https://api.nuget.org/v3/index.json</a></span></pre><p id="8c6f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建您的初始 version.json 文件。它还会添加/修改您的目录。Build.props 文件。这些文件包含您的版本信息，您可以保持原样。</p><p id="6fbf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">回到您的 Azure Pipelines，用以下内容替换您的 azure-pipelines.yml:</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="53d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在这里只添加了几个额外的步骤来安装 ngbv 工具和设置版本号。我们还在第 33 行提到了版本控制方案。</p><p id="7dc0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">保存并再次运行管道。当构建完成时，转到您的工件提要。您现在会看到构建号已经自动增加，并且您有了多个版本的包。</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/1da3eaffc5345d098a38ee114985afa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xv0Lm5o0SbDGSysIp_MprA.png"/></div></div></figure><p id="a960" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是不是很牛逼？</p><p id="d982" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">链接到 GitHub 来源:【https://github.com/krisravishankar/artifacts-demo T4】</p></div></div>    
</body>
</html>