<html>
<head>
<title>Best Practices for Debugging in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js中调试的最佳实践</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-practices-for-debugging-in-node-js-fe113ed64050?source=collection_archive---------5-----------------------#2022-01-02">https://blog.devgenius.io/best-practices-for-debugging-in-node-js-fe113ed64050?source=collection_archive---------5-----------------------#2022-01-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d137b16f2f0af2a5251e020fae035d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-PYsu2gH57idXJlH"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">克里斯汀·休姆在<a class="ae jz" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9416" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">开发的一个重要部分是使应用程序没有bug和缺陷的能力。编写一个完美的应用程序几乎是不可能的，但是我们遵循TDD(测试驱动开发)，它帮助我们在运行之前测试我们的代码。如果出现故障，我们可以很容易地跟踪错误并解决它。</p><p id="a168" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">修复bugs缺陷的艺术叫做调试。随着时间的推移，我们的应用程序会变得越来越复杂。在这种情况下，很难追溯到产生问题的那一行代码。为了解决这个问题，我们可以使用不同的调试技术。开发人员的一个常见做法是在程序运行时打印语句，即<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/Console/log" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">console . log()</em></strong></a>或<strong class="kc io"> <em class="ky"> console.debug()。虽然这是最简单的方法，但也是多余的。每当我们需要检查一些数据时，我们必须添加一个额外的语句。</em></strong></p><p id="b223" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文编译了调试Node.js应用程序的一些最佳实践。在这里，我们将熟悉除<strong class="kc io"><em class="ky">console . log()</em></strong>或<strong class="kc io"><em class="ky">console . debug()</em></strong><em class="ky">之外的不同工具和其他有用的方法。</em></p><p id="bd05" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">调试可以通过两种方式完成——在软件所在的机器上进行本地调试或远程调试。在<a class="ae jz" href="https://lightrun.com/blog/remote-debugging/" rel="noopener ugc nofollow" target="_blank">远程调试</a>中，您调试运行在不同于本地机器的环境中的应用程序。然而，在本文中，我们不会关注远程调试。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="fc7b" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">先决条件</h1><ul class=""><li id="93dc" class="me mf in kc b kd mg kh mh kl mi kp mj kt mk kx ml mm mn mo bi translated">Node.js应该安装在您的本地环境中。在您的终端中键入<strong class="kc io"> <em class="ky"> node -v </em> </strong>。如果安装了节点，您将看到节点版本，即<strong class="kc io"> <em class="ky"> v16.13.0 </em> </strong>。如果没有，可以去Node.js的官方<a class="ae jz" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">网站</a>看看。</li><li id="bb1e" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated">你应该对JavaScript有一个基本的了解。</li><li id="ae21" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated">你应该熟悉Chrome DevTools。</li></ul><p id="5303" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们来看看调试节点应用程序的不同方法。</p><ul class=""><li id="cfc2" class="me mf in kc b kd ke kh ki kl mu kp mv kt mw kx ml mm mn mo bi translated">使用内置Node.js调试器进行调试</li><li id="16df" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated">使用控制台调试</li><li id="a6f7" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated">使用Chrome DevTools调试Chrome。</li></ul><h1 id="9de2" class="lg lh in bd li lj mx ll lm ln my lp lq lr mz lt lu lv na lx ly lz nb mb mc md bi translated">内置Node.js调试器</h1><p id="ba59" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl nc kn ko kp nd kr ks kt ne kv kw kx ig bi translated">调试器为我们提供了一种查看程序内部的方法，而不会将它暴露给任何安全威胁。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="5326" class="no lh in nk b gy np nq l nr ns"><em class="ky">var fs = require(‘fs’);</em></span><span id="c959" class="no lh in nk b gy nt nq l nr ns"><em class="ky">fs.readFile(‘test.txt’,<br/>‘utf8’, function (err, data<br/>) {</em></span><span id="5dae" class="no lh in nk b gy nt nq l nr ns"><em class="ky">debugger;</em></span><span id="f1c5" class="no lh in nk b gy nt nq l nr ns"><em class="ky">if (err) throw err;</em></span><span id="d297" class="no lh in nk b gy nt nq l nr ns"><em class="ky">});</em></span></pre><p id="2ce5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们使用了一个调试器，它允许我们观察对象并添加断点。因此，我们可以逐行跟踪代码。</p><ul class=""><li id="53c4" class="me mf in kc b kd ke kh ki kl mu kp mv kt mw kx ml mm mn mo bi translated">创建一个文件test1.js(你可以随意命名你的文件)，运行<strong class="kc io"> <em class="ky">节点inspect test1.js </em> </strong>。</li></ul><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/c521c49b6bd7f10d5ded1e9ed6ffbc5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4GFi9E1u3_ITDe4F"/></div></div></figure><p id="328d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">终端应该是这样的:<strong class="kc io">调试器监听… </strong></p><p id="4306" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">让我们看看在调试过程中可以使用的命令列表:</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="f020" class="no lh in nk b gy np nq l nr ns">cont or c: Continue execution</span><span id="fad0" class="no lh in nk b gy nt nq l nr ns">next or n: Step next</span><span id="e5c2" class="no lh in nk b gy nt nq l nr ns">step or s: Step in</span><span id="fc50" class="no lh in nk b gy nt nq l nr ns">out or o: Step out</span><span id="7690" class="no lh in nk b gy nt nq l nr ns">pause: Pauses the code</span><span id="af70" class="no lh in nk b gy nt nq l nr ns">watch: Add the expression or variable to watch.</span><span id="6d33" class="no lh in nk b gy nt nq l nr ns">watcher: List the watchers with their values.</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/116c395c3e009a0d71a701d8fe3aeb4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KWt2TKSWWUst2Y_l"/></div></div></figure><p id="07e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经添加了要观察的数据。如您所见，我们正在获取内容:<strong class="kc io"> <em class="ky">【您好这是第一个文本文件】</em> </strong>。</p><h1 id="3723" class="lg lh in bd li lj mx ll lm ln my lp lq lr mz lt lu lv na lx ly lz nb mb mc md bi translated">使用控制台调试</h1><p id="94df" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl nc kn ko kp nd kr ks kt ne kv kw kx ig bi translated">我们都知道console.log。它被普遍使用，而且，我要说，被过度使用了。但是其他有用的方法在调试时也会派上用场。更好地显示对象属性的一些方法有:</p><ul class=""><li id="71b6" class="me mf in kc b kd ke kh ki kl mu kp mv kt mw kx ml mm mn mo bi translated"><strong class="kc io"><em class="ky">console . dir()</em></strong>以交互列表的方式显示控制台中指定对象的属性，方便开发者查看。</li></ul><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/06f60d9ababf5fb7e04adc430139f12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jk43y8FqPkP0ag-z"/></div></div></figure><ul class=""><li id="ac98" class="me mf in kc b kd ke kh ki kl mu kp mv kt mw kx ml mm mn mo bi translated"><strong class="kc io"><em class="ky">console . group()</em></strong>通过像这样将所有日志嵌套在一起，创建一个新的控制台日志集合。</li></ul><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/33824e9e4b363e4e4db04b61c013ea4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*frulAk2XSrru-Crx"/></div></div></figure><ul class=""><li id="5a56" class="me mf in kc b kd ke kh ki kl mu kp mv kt mw kx ml mm mn mo bi translated"><strong class="kc io"><em class="ky">console . groupend()</em></strong>用于退出当前组。</li></ul><p id="7031" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">其他一些有用的方法有:</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="3048" class="no lh in nk b gy np nq l nr ns">warn() — display warning message</span><span id="169a" class="no lh in nk b gy nt nq l nr ns">table(obj) — display arrays of objects in tabular format</span><span id="d042" class="no lh in nk b gy nt nq l nr ns">error(msg) — display an error message</span><span id="5e2f" class="no lh in nk b gy nt nq l nr ns">count(label) — displays the number of times the line has been executed</span><span id="d31b" class="no lh in nk b gy nt nq l nr ns">time(label) — to calculate the duration of an operation</span><span id="2ba5" class="no lh in nk b gy nt nq l nr ns">clear() — clears the console</span><span id="5394" class="no lh in nk b gy nt nq l nr ns">timeEnd(label) — stops the timer to give the total duration</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/c4e046de01015e33dc19d83eff63d374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YDYr0SpcKu4nlaiq"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://medium.com/front-end-weekly/debug-like-a-pro-7749db57b4b1" rel="noopener">来源</a></figcaption></figure><h1 id="23d1" class="lg lh in bd li lj mx ll lm ln my lp lq lr mz lt lu lv na lx ly lz nb mb mc md bi translated">用Chrome DevTools调试Node.js</h1><p id="77f1" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl nc kn ko kp nd kr ks kt ne kv kw kx ig bi translated">Node.js也使用V8 JavaScript引擎。所以，Chrome DevTools 中节点开发者的普遍选择。</p><p id="68b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们首先创建一个运行HTTP服务器并返回JSON响应的节点应用程序。该应用程序将返回一个带有城市名称的JSON。我们将会有一系列的城市。我们将在端口8000上运行这个应用程序。您可以定义您的端口号。</p><p id="3880" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们导入HTTP模块，这是创建HTTP服务器所需要的。函数的作用是:随机选择一个城市名并返回。</p><p id="6a5e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将添加请求监听器，<strong class="kc io"> requestListener() </strong>，它处理HTTP请求。</p><p id="bf12" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在app.js中添加下面的代码，这里使用的代码编辑器是VS代码。你可以选择任何你觉得舒服的编辑器。还有，我用的是VS code提供的内置终端。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="7da2" class="no lh in nk b gy np nq l nr ns">const http = require(“http”);</span><span id="5c36" class="no lh in nk b gy nt nq l nr ns">const host = ‘localhost’;</span><span id="8776" class="no lh in nk b gy nt nq l nr ns">const port = 8000;</span><span id="346a" class="no lh in nk b gy nt nq l nr ns">const cities = [“Mumbai”, “London”, “New York”, “Rome”, “Tokyo”];</span><span id="4bfc" class="no lh in nk b gy nt nq l nr ns">const getCityName = function () {</span><span id="586e" class="no lh in nk b gy nt nq l nr ns">let city = cities[Math.floor(Math.random() * cities.length)];</span><span id="48a7" class="no lh in nk b gy nt nq l nr ns">return city</span><span id="d9cf" class="no lh in nk b gy nt nq l nr ns">}</span><span id="47cb" class="no lh in nk b gy nt nq l nr ns">const requestListener = function (req, res) {</span><span id="db12" class="no lh in nk b gy nt nq l nr ns">let message = getCityName();</span><span id="0505" class="no lh in nk b gy nt nq l nr ns">res.setHeader(“Content-Type”, “application/json”);</span><span id="4c01" class="no lh in nk b gy nt nq l nr ns">res.writeHead(200);</span><span id="136e" class="no lh in nk b gy nt nq l nr ns">res.end(`{“message”: “${message}”}`);</span><span id="8481" class="no lh in nk b gy nt nq l nr ns">};</span><span id="fe9b" class="no lh in nk b gy nt nq l nr ns">const server = http.createServer(requestListener);</span><span id="7f1b" class="no lh in nk b gy nt nq l nr ns">server.listen(port, host, () =&gt; {</span><span id="a3a4" class="no lh in nk b gy nt nq l nr ns">console.log(`Server is running on <a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/${host}:${post}`);">http://${host}:${post}`);</a></span><span id="a4d6" class="no lh in nk b gy nt nq l nr ns">});</span></pre><p id="e43b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到终端键入<strong class="kc io"> <em class="ky">节点— inspect app.js </em> </strong>。</p><p id="7441" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">记住:在使用CLI时，使用</em><strong class="kc io"><em class="ky">inspect</em></strong><em class="ky">而不是</em><strong class="kc io"><em class="ky">—inspect</em></strong><em class="ky">。</em></p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/067eb543dd1b340884f9901c30cf8622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wX47tndX2KyS-DvA"/></div></div></figure><p id="6744" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行上面的命令后，您应该在终端中看到类似这样的内容。</p><p id="9e23" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，导航到谷歌浏览器，输入<strong class="kc io"> <em class="ky"> chrome://inspect </em> </strong></p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/fe34acb501a5d9489e98038070d1df81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c-SrymFEhFn9eSpR"/></div></div></figure><p id="9377" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应该会出现上面的屏幕。点击远程目标下的检查。我们将能够用Chrome调试节点代码。导航到左侧的Sources选项卡。如果您的左侧是空的，导入您编写代码的工作区，并选择app.js。</p><p id="d9a6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们通过添加断点开始调试。单击调试控制台中的数字10。数字和右侧面板旁边会出现一个红点，表示添加了一个新断点。</p><p id="0a28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，添加一个观察表达式。在右侧，单击监视标题旁边的箭头，然后</p><p id="1ef7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击+。在处理请求时，输入城市并按Enter观察其值。</p><p id="6ada" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，打开一个新的浏览器窗口，导航到<a class="ae jz" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>。</p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a863ebea0162c3485b677bdd44d5f42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IM7nISJ-KYdw2b48"/></div></div></figure><p id="bc1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是inspect屏幕的屏幕，您可以在其中轻松调试您的应用程序。</p><h1 id="3779" class="lg lh in bd li lj mx ll lm ln my lp lq lr mz lt lu lv na lx ly lz nb mb mc md bi translated">结论</h1><p id="d1e6" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl nc kn ko kp nd kr ks kt ne kv kw kx ig bi translated">在本文中，我们学习了调试节点应用程序的不同方法，以及一些可以帮助我们成为更好的开发人员的最佳实践。我们创建了一个节点应用程序，并使用调试器、断点、DevTools和观察器对其进行了调试。</p><p id="8385" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">开发人员必须知道的技能之一是如何更好地调试。我希望本文中提到的实践将帮助您成为一名更好的开发人员。</p><p id="eef1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">也可以参考Node。JS官方<a class="ae jz" href="https://nodejs.org/en/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多关于节点调试的内容。</p></div></div>    
</body>
</html>