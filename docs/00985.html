<html>
<head>
<title>Details of Spring Boot AutoConfiguration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot 自动配置的详细信息</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/details-of-spring-boot-autoconfiguration-e2baf94bf0e1?source=collection_archive---------17-----------------------#2020-06-21">https://blog.devgenius.io/details-of-spring-boot-autoconfiguration-e2baf94bf0e1?source=collection_archive---------17-----------------------#2020-06-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6198" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">什么是 Spring Boot？Spring Boot 自动配置是如何工作的？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8d653de4049c6a22c74999e4cd75c5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QzVJvVRW9NpRGQFW"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated"><a class="ae ks" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动创建者</a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="8daf" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">什么是 Spring Boot？</h1><p id="495c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><a class="ae ks" href="https://spring.io/projects/spring-boot" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a>网站上说“<em class="mh">我们对 Spring 平台和第三方库有自己的看法，所以你可以以最少的麻烦开始。大多数 Spring Boot 应用需要最小的弹簧配置。</em></p><p id="b90a" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">Spring Boot 是一个构建应用程序的框架。</p><p id="f5cb" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">Spring Boot 提供了不同的特性，如果您使用它来构建您的应用程序，您将需要不同的 beans。因此，自动配置通过创建这些 beans 来自动配置 Spring Boot 应用程序。</p><h1 id="c76a" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">你为什么使用自动配置？</h1><p id="ced0" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">效率和时间。有了自动配置，Spring 将为开发人员做很多工作，并节省创建 beans 的时间。</p><p id="c89a" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">幕后基本就是一堆<code class="fe mn mo mp mq b">@Configuration</code>班。这些类不使用注释<code class="fe mn mo mp mq b">@Configuration</code>。</p><p id="d85e" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">这些类使用的一些注释是:</p><ul class=""><li id="1bc0" class="mr ms in ln b lo mi lr mj lu mt ly mu mc mv mg mw mx my mz bi translated"><code class="fe mn mo mp mq b">@ConditionalOnClass</code> -只有当给定的类在类路径中时，应用程序才使用它。</li><li id="a4e4" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated"><code class="fe mn mo mp mq b">@Conditional</code> -仅在满足条件时</li><li id="9e06" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated"><code class="fe mn mo mp mq b">@ConditionalOnMissingBean</code> -如果 bean 丢失或未创建，应用程序将使用此选项。</li></ul><p id="1a1b" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">总之，<code class="fe mn mo mp mq b">@Conditional</code>注释是所有注释的基础。</p><h1 id="8ab0" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">这个你到底是怎么理解的？</h1><p id="1ce1" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">您或您的团队正在处理多个项目，并且这些项目共享一些公共代码。如果你想把这个公共代码提取到它自己的库或者共享 beans 中，那么所有的项目都可以使用它们。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="4575" class="nj ku in mq b gy nk nl l nm nn">@Configurationpublic class SharedObjects<br/>{   <br/>    @Bean   <br/>    public CommonObject commonObject()   <br/>    {      <br/>       return new CommonObject();   <br/>    }<br/>}</span></pre><p id="3188" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">一旦这个<code class="fe mn mo mp mq b">CommonObject</code>通过 jar 文件共享，其他项目就可以导入它。</p><p id="2bd2" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">这种方法的缺点是，如果另一个项目想要使用<code class="fe mn mo mp mq b">CommonObject</code>，但是不想使用该公共代码中的任何其他 beans。在项目启动期间，导入这些 beans 将是不必要的开销。因此，你需要一种方法来告诉 Spring，我们只需要<code class="fe mn mo mp mq b">CommonObject</code> Bean 而不需要其他 Bean，甚至不要创建其他 Bean。这时我们就可以使用<code class="fe mn mo mp mq b">@Conditional</code>注释了。</p><p id="34d5" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">要使用这个<code class="fe mn mo mp mq b">@Conditional</code>注释，有几种方法。Spring Boot 提供了一个类可以实现的<code class="fe mn mo mp mq b">Condition</code>接口。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="16ae" class="nj ku in mq b gy nk nl l nm nn">public class IsBrowserOnCondition implements Condition<br/>{   <br/>    @Override   <br/>    public boolean matches(ConditionContext context, AnotatedTypeMetadata metadata)   <br/>    {      <br/>       return isMozillaFirefoxEnabled(context);   <br/>    }      </span><span id="baf9" class="nj ku in mq b gy no nl l nm nn">    public boolean isMozillaFirefoxEnabled(ConditionContext context)   <br/>    {      <br/>       return context.getEnvironment().containsProperty("spring.preferredbrowser");   }<br/>}</span></pre><p id="f4ae" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">在这个类<code class="fe mn mo mp mq b">IsBrowserOnCondition</code>中，我们看到了接口条件的实现。</p><ul class=""><li id="4e73" class="mr ms in ln b lo mi lr mj lu mt ly mu mc mv mg mw mx my mz bi translated">这个实现包括方法<code class="fe mn mo mp mq b">matches</code>。</li><li id="d848" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated">此方法调用另一个方法来检查 Mozilla Firefox 浏览器是否已启用。</li><li id="3030" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated">在这个过程中，它检查一个属性<code class="fe mn mo mp mq b">spring.preferredbrowser</code>条件。</li><li id="21a8" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated">现在，如果我们想要在条件上创建新的 beans，我们将使用注释<code class="fe mn mo mp mq b">@Conditional</code>作为<code class="fe mn mo mp mq b">@Conditional(IsBrowserOnCondition.class)</code>。</li></ul><p id="6d92" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">简而言之，Spring Boot 是一个共享的上下文配置，包含许多使用注释<code class="fe mn mo mp mq b">@Conditional</code>创建的 beans。</p><h1 id="6452" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">使用 Spring Boot 自动配置</h1><p id="db81" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">为了更好地理解自动配置，我们将使用一个简单的 Spring Boot 应用程序。我们想知道当我们启动这个应用程序时会发生什么。</p><p id="5c5c" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">因此，该应用程序的主类如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="aab6" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">当我运行这个主类时，Spring Boot 启动了 tomcat web 服务器。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="91dc" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">在后台，Spring Boot 在 Tomcat 上启动应用程序时正在做一些工作。Spring Boot 在这里使用了 17 种不同的属性来源。官方文件<a class="ae ks" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a>提供了这 17 个来源的细节。开发人员可以将这些属性具体化，很多时候我们会为<code class="fe mn mo mp mq b">application.properties</code>这样做。因此，如果您配置了这些属性中的任何一个，Spring Boot 将读取这些属性，而不是默认源。</p><p id="767b" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">现在，如果我们展开 jar 文件<code class="fe mn mo mp mq b">spring-boot-autoconfigure-2.1.6.RELEASE.jar</code>，您将看到包<code class="fe mn mo mp mq b">org.springframework.boot.autoconfigure</code>下的目录数量。所有这些子包都是 Spring Boot 提取的 beans，但是只是基于<code class="fe mn mo mp mq b">@Conditional</code>注释使用它们。因此，在启动过程中，Spring Boot 会根据您在 Maven 或 Gradle 构建文件中配置的依赖项加载其中一些包。</p><p id="4c81" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">从这个 jar 中，如果我们打开<code class="fe mn mo mp mq b">ThymeleafAutoConfiguration</code>的源文件，我们将看到以下内容:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="56c2" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">如果您正在构建一个 web 应用程序，百里香模板将是您的默认模板引擎。如果加载了<code class="fe mn mo mp mq b">TemplateMode</code>和<code class="fe mn mo mp mq b">SpringBootEngine</code>，Spring boot 将加载该类。我们可以看到<code class="fe mn mo mp mq b">@Conditional</code>注释的用法。</p><h1 id="9fe0" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">如何排除 Spring Boot 自动配置？</h1><p id="eac7" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">Spring Boot 确实提供了一个选项来排除您不想包含在项目中的任何自动配置。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="9a9c" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">这里要记住的一点是，您必须知道为什么要排除某个 bean，如果您确定它可能会排除一些依赖配置。</p><h1 id="9c2d" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">结论</h1><p id="be22" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在这篇文章中，我展示了</p><ul class=""><li id="7361" class="mr ms in ln b lo mi lr mj lu mt ly mu mc mv mg mw mx my mz bi translated">Spring Boot 是如何工作的，以及如何使用一些依赖项来构建 Spring Boot 应用程序。</li><li id="a8ec" class="mr ms in ln b lo na lr nb lu nc ly nd mc ne mg mw mx my mz bi translated">什么是自动配置，包括哪些内容。</li></ul><p id="9856" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated">如果你喜欢这篇文章或者有任何其他问题，请订阅<a class="ae ks" href="https://betterjavacode.com/subscribe" rel="noopener ugc nofollow" target="_blank">我的博客</a>。</p></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="3395" class="pw-post-body-paragraph ll lm in ln b lo mi jo lq lr mj jr lt lu mk lw lx ly ml ma mb mc mm me mf mg ig bi translated"><em class="mh">原载于 2020 年 6 月 21 日</em><a class="ae ks" href="https://betterjavacode.com/spring-boot/details-of-spring-boot-autoconfiguration" rel="noopener ugc nofollow" target="_blank"><em class="mh">【https://betterjavacode.com】</em></a><em class="mh">。</em></p></div></div>    
</body>
</html>