<html>
<head>
<title>Writing an IntelliJ Plugin for Inserting Timestamps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写用于插入时间戳的 IntelliJ 插件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/writing-an-intellij-plugin-for-inserting-timestamps-2cbe6f09b4f8?source=collection_archive---------18-----------------------#2022-07-24">https://blog.devgenius.io/writing-an-intellij-plugin-for-inserting-timestamps-2cbe6f09b4f8?source=collection_archive---------18-----------------------#2022-07-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="1170" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">履行</h2><div class=""/><div class=""><h2 id="f8c2" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">体力劳动略少</h2></div><h2 id="7771" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">问题是</h2><p id="0605" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">在编写大量涉及基于时间的函数的测试时，我厌倦了手动写出完整的时间戳，我复制并粘贴时间戳，然后更改 1 或 2 个数字，使它们对于测试用例是唯一的。这变成了一个重复的任务，因为太频繁地点击复制和粘贴而使我的手指紧张。</p><p id="fed8" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">所有的开发者都会在某个时候面临这个问题，最好的词是“辛苦”(这是我在自由贸易的经理给我指出的，是从谷歌 SRE 的书中杜撰出来的)。这是一个重复的任务，不需要任何新的思维过程，而是需要手动步骤来遵循。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mf"><img src="../Images/eda31d26291e616f67fc15c27d6db524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q_vcCH6CFOd-1qGd"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">照片由<a class="ae me" href="https://unsplash.com/@roum?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃琳娜·鲁梅</a>在<a class="ae me" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="661c" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">解决方案</h2><p id="0c78" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">JetBrains 提供了许多非常有用的插件，它们可以在所有不同的 ide 上工作，我还使用了一个非常流行的插件来生成 UUIDs，它是由 léo Millon 开发的，它给了我灵感来解决另一个文本生成问题。</p><p id="08a3" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">IntelliJ SDK 有<a class="ae me" href="https://plugins.jetbrains.com/docs/intellij/basic-action-system.html" rel="noopener ugc nofollow" target="_blank">动作方法</a>，它们被扩展用于将文本插入剪贴板或光标处的文本编辑器。插件的其余部分只是通过创建一个具有可配置格式的新时间戳值来促进文本插入。</p><p id="887f" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">设置页面允许用户从标准 ISO 或 Java 格式(ISO 8601、即时、本地日期、本地时间、本地日期时间、区域日期时间、RFC 1123)或纪元秒/毫秒之一更改时间戳的格式。</p><h2 id="ac4c" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">IDEA Gradle 插件</h2><p id="bb35" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">gradle 插件<a class="ae me" href="https://plugins.jetbrains.com/docs/intellij/tools-gradle-intellij-plugin.html" rel="noopener ugc nofollow" target="_blank"> com.jetbrains.intellij </a>应用了构建 intellij 插件所需的所有方法。这是你定义版本和平台(IDEA，WebStorm，PyCharm 等)的地方。)是插件的目标。</p><p id="87f9" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">插件还通过<code class="fe mv mw mx my b">runIde</code>任务引入了一些任务，您将使用这些任务在测试 IDE 环境中构建和运行插件。为<code class="fe mv mw mx my b">AnAction</code>创建一个扩展类将被 IDE 选中，并且任何在<code class="fe mv mw mx my b">actionPerformed</code>方法中的代码都将被运行。</p><p id="1b03" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">在这个操作中，我们将替换任何突出显示的文本，或者在编辑器中插入插入符号的位置插入时间戳。这意味着我们必须检查突出显示的文本，并计算出我们的文本将被插入的位置，然后更新插入符号以放置在插入文本的末尾。IntelliJ 插件给了我们一个<code class="fe mv mw mx my b">Document</code>类，它为所有这些需求提供了方法。</p><h2 id="3873" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">构建管道</h2><p id="9381" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">存储库使用 GitHub 动作来构建插件，并运行测试来验证构建是干净的。GitHub 不处理任何部署，它只是一个验证插件是否处于良好状态的地方。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/cf7dbcead47029597f14ae386c8a4d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6TYJ1Mp0I6fTP0-aiDsCQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">构建和测试插件的 GitHub 动作</figcaption></figure><p id="b13d" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">我使用的<a class="ae me" href="https://github.com/AlexBroadbent/timestamp-generator-plugin/blob/master/.github/workflows/build.yml" rel="noopener ugc nofollow" target="_blank">工作流</a>在我的项目中是相当标准的，其中我使用<code class="fe mv mw mx my b">actions/checkout</code>下拉代码，<code class="fe mv mw mx my b">actions/setup-java</code>设置 JDK(我目前正在构建版本 11)，<code class="fe mv mw mx my b">gradle/wrapper-validation-action</code>在存储库中设置 gradle 包装器，然后<code class="fe mv mw mx my b">gradle/gradle-build-action</code>运行构建参数。这就构成了构建代码并对其运行所有测试。</p><p id="4e4c" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">IntelliJ 插件有一个<code class="fe mv mw mx my b">publishPlugin</code>任务，用于签名并向 JetBrains 推送最新版本。</p><h2 id="334d" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">设置菜单</h2><p id="3c24" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">设置菜单是使用<a class="ae me" href="https://www.jetbrains.com/help/idea/components-of-the-gui-designer.html" rel="noopener ugc nofollow" target="_blank">老学校 Swing 库</a>编写的，带有布局的. form 文件和<code class="fe mv mw mx my b">SettingsForm</code>中逻辑的支持类。表单中的组件在<code class="fe mv mw mx my b">createUIComponents</code>方法中初始化，该方法加载格式组合框(下拉菜单)，而<code class="fe mv mw mx my b">loadSettings</code>处理将格式组合框设置为当前在设置中配置的值。有一个<code class="fe mv mw mx my b">updatePreviewLabel</code>方法，它在每次选择新格式时提供对预览标签的更改，以向用户显示时间戳将如何被格式化。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi na"><img src="../Images/19d1e4dfb0d43c39dd6efdce058c7db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g5fDHRcXdGzLabHw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">插件的设置页面</figcaption></figure><h2 id="b835" class="kl km in bd kn ko kp dn kq kr ks dp kt ku kv kw kx ky kz la lb lc ld le lf it bi translated">结论</h2><p id="203a" class="pw-post-body-paragraph lg lh in li b lj lk jx ll lm ln ka lo ku lp lq lr ky ls lt lu lc lv lw lx ly ig bi translated">为你的 IDE 设置正确的插件绝对有很大的价值。它减少了编写代码所需的时间。因此，为 IDE 构建一个插件会让开发人员的体验更加丰富。</p><p id="8da8" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">JetBrains 有关于如何为 IntelliJ 构建插件的很棒的文档，我很高兴能编写一个新的插件，它将利用新的<a class="ae me" href="https://plugins.jetbrains.com/docs/intellij/kotlin-ui-dsl-version-2.html" rel="noopener ugc nofollow" target="_blank"> Kotlin DSL UI </a>。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><p id="35ce" class="pw-post-body-paragraph lg lh in li b lj lz jx ll lm ma ka lo ku mb lq lr ky mc lt lu lc md lw lx ly ig bi translated">源代码:【https://github.com/AlexBroadbent/timestamp-generator-plugin T4】</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div></div>    
</body>
</html>