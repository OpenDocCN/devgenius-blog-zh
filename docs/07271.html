<html>
<head>
<title>How Pry taught me how to OO Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">普里是如何教我如何使用红宝石的</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-pry-taught-me-how-to-oo-ruby-433d0f842829?source=collection_archive---------14-----------------------#2022-03-10">https://blog.devgenius.io/how-pry-taught-me-how-to-oo-ruby-433d0f842829?source=collection_archive---------14-----------------------#2022-03-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="5979" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi ki translated">最初，我想写下关于 T0 的所有荣耀，而使用它可以帮助一个 Ruby 新手更快地掌握 OO 的概念。并帮助建立一个防弹的理解心智模型。<code class="fe kr ks kt ku b">Self</code>在 object 的实例中是指实例本身，在 class 方法中，self 是指支配性的类。我是怎么走到这一步的？</p><p id="a232" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">特别是使用 OO Ruby，我已经看不到来自<a class="ae kv" href="https://www.mikedane.com/" rel="noopener ugc nofollow" target="_blank"> Mike Dane </a>(是的，来自<em class="kw">长颈鹿学院</em>的家伙)的内容了，烧代码不足以帮助我理解一个对象是如何自我感知的。当时，我们突然沉浸在一个由<code class="fe kr ks kt ku b">self</code>、<code class="fe kr ks kt ku b">@instance</code>、<code class="fe kr ks kt ku b">@@class</code>、<code class="fe kr ks kt ku b">&lt;&lt;</code>统治的世界中，这也于事无补。</p><p id="eeb9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我的例子中，它使用了 gem <code class="fe kr ks kt ku b">Pry</code>并编写了我自己的测试来确认 d̶e̶b̶u̶g 的代码按预期工作。IMHO，<code class="fe kr ks kt ku b"><a class="ae kv" href="https://pry.github.io/" rel="noopener ugc nofollow" target="_blank">Pry</a></code>是 Ruby 的标准 IRB shell 及其运行时调用的一个更好的替代方案。这意味着可以在运行程序的过程中对对象调用窥探会话。</p><p id="4d12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了评估之前的任何一点代码，放下<code class="fe kr ks kt ku b">binding.pry</code>将启动一个交互式 shell，在其中你将有机会<em class="kw">通过代码窥探</em>。如果将它插入到一个其所有者不太清楚的方法中，这将特别有帮助。</p><pre class="kx ky kz la gt lb ku lc ld aw le bi"><span id="dfd2" class="lf lg in ku b gy lh li l lj lk">@@all &lt;&lt; self</span><span id="7420" class="lf lg in ku b gy ll li l lj lk">       ...</span><span id="04f5" class="lf lg in ku b gy ll li l lj lk">def self.all<br/>  @@all<br/>end</span><span id="c230" class="lf lg in ku b gy ll li l lj lk">       ...</span><span id="d8ab" class="lf lg in ku b gy ll li l lj lk">def self.class_method<br/>  binding.pry  # execution will freeze for the pry instance<br/>  # does something<br/>end</span><span id="c048" class="lf lg in ku b gy ll li l lj lk">def instance_method<br/>  binding.pry  # execution will freeze for the pry instance<br/>  # does something<br/>end</span></pre><blockquote class="lm ln lo"><p id="5648" class="jk jl kw jm b jn jo jp jq jr js jt ju lp jw jx jy lq ka kb kc lr ke kf kg kh ig bi translated">谁在调用该方法？类的<code class="fe kr ks kt ku b">@instance</code>变量？或者说，<code class="fe kr ks kt ku b">@@class</code>变量？<code class="fe kr ks kt ku b">self</code>是谁或什么？</p></blockquote><p id="9314" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与撬，眼见为实特别为了解<code class="fe kr ks kt ku b">self</code>；这个特殊的关键字让我们可以访问当前对象，无论是类的实例还是类本身。在下一节中，我们将提供一些代码片段来了解 Ruby 对象的生命周期。</p></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><p id="5722" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi ki translated"><span class="l kj kk kl bm km kn ko kp kq di"> C </span>配置为<a class="ae kv" href="https://www.seancdavis.com/posts/how-to-write-a-custom-rake-task/" rel="noopener ugc nofollow" target="_blank"> Rake 任务</a>，Pry 依赖于环境(首先加载特定的类和数据库连接)。撬工具可以通过输入<code class="fe kr ks kt ku b">rake console</code>来触发。</p><pre class="kx ky kz la gt lb ku lc ld aw le bi"><span id="10bf" class="lf lg in ku b gy lh li l lj lk"># Rakefile<br/>desc 'drop into the Pry console'<br/>task console: :environment do<br/>  Pry.start<br/>end</span></pre><p id="d161" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">窥探会话提供了使用查询方法通过关系(关系数据库)遍历数据集合的机会，这些查询方法包括但不限于:<code class="fe kr ks kt ku b">.all</code>、<code class="fe kr ks kt ku b">.first</code>、<code class="fe kr ks kt ku b">.last</code>、<code class="fe kr ks kt ku b">.find(id#)</code>、<code class="fe kr ks kt ku b">.find_by(attribute:)</code>等。</p><pre class="kx ky kz la gt lb ku lc ld aw le bi"><span id="8ecb" class="lf lg in ku b gy lh li l lj lk">def give_stuff(dev, item_name, value)</span><span id="22ac" class="lf lg in ku b gy ll li l lj lk">  Stuff.create(dev_id: dev.id, item_name: item_name, value: value, company_id: self.id)</span><span id="afe6" class="lf lg in ku b gy ll li l lj lk">end</span><span id="87f9" class="lf lg in ku b gy ll li l lj lk"># Rake console<br/>[1] <strong class="ku io">pry(main)&gt; Dev.all</strong><br/>D, [2022-03-08T22:14:51.740658 #9806] DEBUG -- :   Dev Load (0.3ms)  SELECT "devs".* FROM "devs"<br/><strong class="ku io">=&gt; [#&lt;Dev:0x0000000136c5dca8 id: 1, name: "Rick"&gt;, #&lt;Dev:0x0000000136c14788 id: 2, name: "Morty"&gt;, #&lt;Dev:0x0000000136c145f8 id: 3, name: "Mr. Meseeks"&gt;, #&lt;Dev:0x0000000136c0fdc8 id: 4, name: "Gazorpazop"&gt;]</strong><br/>[2] <strong class="ku io">pry(main)&gt; Dev.find(2)</strong><br/>D, [2022-03-08T22:15:44.905104 #9806] DEBUG -- :   Dev Load (0.3ms)  SELECT "devs".* FROM "devs" WHERE "devs"."id" = ? LIMIT ?  [["id", 2], ["LIMIT", 1]]<br/><strong class="ku io">=&gt; #&lt;Dev:0x000000010782dd38 id: 2, name: "Morty"&gt;</strong><br/>[3] pry(main)&gt; <strong class="ku io">d = Dev.find(2)</strong><br/>D, [2022-03-08T22:16:24.410506 #9806] DEBUG -- :   Dev Load (0.2ms)  SELECT "devs".* FROM "devs" WHERE "devs"."id" = ? LIMIT ?  [["id", 2], ["LIMIT", 1]]<br/><strong class="ku io">=&gt; #&lt;Dev:0x0000000136f63ee8 id: 2, name: "Morty"&gt;</strong><br/>[4] pry(main)&gt;<strong class="ku io"> d.name</strong><br/><strong class="ku io">=&gt; "Morty"</strong></span></pre><p id="690a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的窥探会话和下面的代码片段中，变量可以被分配给实例并用于执行该方法。</p><pre class="kx ky kz la gt lb ku lc ld aw le bi"><span id="d5a7" class="lf lg in ku b gy lh li l lj lk"># Rake console<br/>[1] pry(main)&gt; <strong class="ku io">c.give_stuff(d, "computer", 2)</strong><br/>D, [2022-03-08T22:25:32.036343 #9980] DEBUG -- :    (0.4ms)  SELECT sqlite_version(*)<br/>D, [2022-03-08T22:25:32.037006 #9980] DEBUG -- :   Company Load (0.0ms)  SELECT "companies".* FROM "companies" ORDER BY "companies"."id" DESC LIMIT ?  [["LIMIT", 1]]<br/>D, [2022-03-08T22:25:32.039061 #9980] DEBUG -- :   Dev Load (0.0ms)  SELECT "devs".* FROM "devs" ORDER BY "devs"."id" DESC LIMIT ?  [["LIMIT", 1]]<br/>D, [2022-03-08T22:25:32.041861 #9980] DEBUG -- :   TRANSACTION (0.0ms)  begin transaction<br/>D, [2022-03-08T22:25:32.042295 #9980] DEBUG -- :   Stuff Create (0.3ms)  INSERT INTO "stuffs" ("item_name", "value", "company_id", "dev_id") VALUES (?, ?, ?, ?)  [["item_name", "computer"], ["value", 2], ["company_id", 4], ["dev_id", 4]]<br/>D, [2022-03-08T22:25:32.043133 #9980] DEBUG -- :   TRANSACTION (0.7ms)  commit transaction<br/><strong class="ku io">=&gt; #&lt;Stuff:0x0000000129ebe720 id: 15, item_name: "computer", value: 2, company_id: 4, dev_id: 4&gt;</strong></span></pre><p id="f142" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用各种查询展现数据的形状，然后您就能够清楚地理解面向对象编程:一个对象具有状态(实例变量)和行为，一个对象可以对其自身执行，也可能对其他对象执行(方法)。</p><p id="57aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">值得一提的是，我们不必编写 SQL 命令来操作数据库表上的信息行。感谢 ActiveRecord，脏活累活替我们干了！</p><p id="f002" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一想到必须编写 SQL 命令就不寒而栗。</p><figure class="kx ky kz la gt ma gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/c610bdf2bc01e2926cae3b17b5e7dcfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*P4nj9fJjSeJ9-c0rwSZqlg.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">资料来源:xkcd</figcaption></figure><p id="48dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">遍历代码的另一个好地方是在数组中循环。你可以在兔子洞的深处，却不知道哪条路是上还是下。你可以通过使用<code class="fe kr ks kt ku b">whereami</code>或它的别名<code class="fe kr ks kt ku b">@</code>来获得方向感，并尝试放松退出，而不是立即退出撬拨会话。</p><p id="4fdf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">直到下一次…</p><figure class="kx ky kz la gt ma gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/8f2de9a7f9d0267f26cf7ce04d96fd05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*3fCn4bNLbcCVPE04UsOuEg.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">使用 binding.pry 学习 Ruby</figcaption></figure><p id="2ce5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">PS。其他让生活变得更简单且值得一提的非窥探实用程序:</p><ul class=""><li id="be0e" class="mi mj in jm b jn jo jr js jv mk jz ml kd mm kh mn mo mp mq bi translated">【VSCode 的 SQLite 扩展</li><li id="0e59" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><a class="ae kv" href="https://marketplace.visualstudio.com/items?itemName=castwide.solargraph" rel="noopener ugc nofollow" target="_blank">vs code 的 Ruby solar graph</a></li><li id="d199" class="mi mj in jm b jn mr jr ms jv mt jz mu kd mv kh mn mo mp mq bi translated"><a class="ae kv" href="https://dbdiagram.io/home" rel="noopener ugc nofollow" target="_blank"> dbdiagram.io </a>的实体关系图</li></ul></div></div>    
</body>
</html>