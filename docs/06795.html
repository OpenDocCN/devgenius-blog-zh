<html>
<head>
<title>How to Create an NGINX Docker Image and Register it with AWS ECR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建 NGINX Docker 映像并将其注册到 AWS ECR</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-an-nginx-docker-image-and-register-it-with-aws-ecr-7b973940c033?source=collection_archive---------4-----------------------#2022-02-04">https://blog.devgenius.io/how-to-create-an-nginx-docker-image-and-register-it-with-aws-ecr-7b973940c033?source=collection_archive---------4-----------------------#2022-02-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6ef20f8622358d284e4196d66330aba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*czrBZwTMG774aruano4thA.png"/></div></div></figure><p id="f2ed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Docker 是什么？Docker 是一款开源的容器化软件，用于开发、部署和管理应用程序。Docker 使开发人员能够将配置文件、库和应用程序打包到一个隔离的环境中。</p><p id="40d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，您将…</p><ol class=""><li id="e289" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">使用 Nginx 创建您自己的映像，并添加一个文件来告诉您部署容器的时间</li><li id="a6c5" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">在端口 8080 打开的情况下部署容器</li><li id="0772" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">将容器数据保存到弹性容器注册表中</li></ol><blockquote class="lh li lj"><p id="2042" class="jv jw lk jx b jy jz ka kb kc kd ke kf ll kh ki kj lm kl km kn ln kp kq kr ks ig bi translated"><strong class="jx io"> <em class="in">先决条件:<br/> </em> </strong> AWS 帐号(ECR 访问)<br/> <a class="ae lo" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>帐号<br/>安装<a class="ae lo" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">Docker</a>T14】安装 AWS CLI <br/> Vim</p></blockquote><p id="678b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将使用 CentOS 8。</p><h1 id="1925" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 1:用 Vim 创建 Dockerfile</h1><p id="2cf5" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">在您登录到您的服务器并安装 Docker 之后，您需要将这两个文件保存在终端的当前目录中:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="49b6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，您希望用这两个命令启动 docker:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/3a9e9f3aec8709dbdd39e6fdf0fc87f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*vepOXSZeO27aGTe44R_pPQ.png"/></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/6ffb0268fd657ec90c1e15588aecc955.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*filU8tDQ3V0TQOcSySRkYg.png"/></div></figure><h1 id="a68f" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 2:构建 Docker 映像</h1><p id="92d4" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">通过输入以下命令构建 Docker 映像:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/655bc50e2b4e72f2ca39fe725785c151.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*wTMQDvas8mztNSfK_DAFBA.png"/></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/6aeadf8194f813a999b42b05432d7e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZpkKp1sIFs-56z-54ZBQg.png"/></div></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/5ad77ae19611440bada54b18151a71be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3gq-7tWrnFxY8d_L7nSuw.png"/></div></div></figure><h1 id="f86b" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 3:部署端口 8080 打开的容器</h1><p id="cd02" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">使用 Run 命令下拉 Nginx 映像，并在端口 8080 上本地打开容器:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/8a82952689be6a72051bee40acf99add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*g2DDSO7X_sH7TGd2Mp1kHw.png"/></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/87d6074b7152f5f535a478c4ec34c3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKv-Ba8sO9-RJDCXCpD1fA.png"/></div></div></figure><h1 id="235f" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 4:将容器数据保存到弹性容器注册中心</h1><ol class=""><li id="ef11" class="kt ku in jx b jy mn kc mo kg nf kk ng ko nh ks ky kz la lb bi translated">通过输入以下命令在终端中安装 AWS CLI:</li></ol><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/fbbdbf4947b2390a9e011b59e66000b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*waBaE8wi4vMUsUEBm64oqA.png"/></div></figure><p id="ba7e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.通过输入以下命令配置 AWS CLI:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/7efd52ed567b18ed938a9daac0b2daa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*LIi9Ndzz9Qqlclo-nYOLIg.png"/></div></div></figure><p id="1587" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">按照提示输入您的 AWS 访问密钥 ID、AWS 秘密访问密钥和您的默认区域名称。</p><p id="b408" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.输入以下命令以获取 AWS 帐户 ID 号。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/690b754489c76e119b1910857fff7cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*pRn_BNmPeS8-S6YRVWXfIw.png"/></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/558aa0d7bf71577d1bac8f377e3d1b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YB-D9z0aWusHPyEJVlHgFw.png"/></div></div></figure><p id="d3be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一定要复制你的“账号 ID”。我们将在以下命令中使用它来执行 ECR。</p><p id="0095" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">4.向 AWS 验证 Docker:</p><pre class="ms mt mu mv gt nm nn no np aw nq bi"><span id="e98a" class="nr lq in nn b gy ns nt l nu nv">aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <strong class="nn io">&lt;account_id&gt;</strong>.dkr.ecr.us-east-1.amazonaws.com</span></pre><p id="6148" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您看到<account_id>的地方，输入您在上面记下的 ID。输入后，您应该会在底部收到一条“登录成功”的消息。</account_id></p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/bb1894df7a5a2a7614bf21d4c1601a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nr6pBfkx9pp6GMXnUVKUWw.png"/></div></div></figure><p id="0846" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">5.创建新的 ECR 存储库:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/64448aa4082387f8675f78e690a629ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emb1mUEqXU3dvCqxCEB1-A.png"/></div></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/bb96aeace2e678e9845d546f26c91ef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*4FtbPg_QzBdYG9GQ6xsxWA.png"/></div></figure><p id="fcc2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">6.列出图像，以便您可以识别要标记和推送的图像:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/9f3e7e6aff040e5440097ccc3c6e63a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*8P1oYYdSIaxGvoqB0jffag.png"/></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/674e27371654b3235b80746a1e21248c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cudwCN6XV4aSjZeKexUhdg.png"/></div></div></figure><p id="a6b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">7.将图像标记到存储库中:</p><pre class="ms mt mu mv gt nm nn no np aw nq bi"><span id="d6e1" class="nr lq in nn b gy ns nt l nu nv">docker tag <strong class="nn io">&lt;image_id&gt;</strong> <strong class="nn io">&lt;account_id&gt;</strong>.dkr.ecr.us-east-1.amazonaws.com/my-nginx:tag</span></pre><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/277cf7bdc7e4609aa5665d11976d3edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MI065Av7EUimL69L3usB7w.png"/></div></div></figure><p id="b55c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">8.推送图像:</p><pre class="ms mt mu mv gt nm nn no np aw nq bi"><span id="efde" class="nr lq in nn b gy ns nt l nu nv">docker push <strong class="nn io">&lt;aws_account_id&gt;</strong>.dkr.ecr.<strong class="nn io">&lt;region&gt;</strong>.amazonaws.com/my-nginx</span></pre><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/e750a3051da10edea59ab37530f6dde9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyfGMb_mzSW8riobVFdzEw.png"/></div></div></figure><h1 id="87b4" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">决赛:</h1><ol class=""><li id="f237" class="kt ku in jx b jy mn kc mo kg nf kk ng ko nh ks ky kz la lb bi translated">在网络浏览器中查看网页确认:</li></ol><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi od"><img src="../Images/4e4906b4837f323c31f55724bdb0882a.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*Z_6kZS71mLprvjG6UPm13g.png"/></div></figure><p id="f74e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.查看 AWS 控制台 ECR 确认:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/43cbbf70a20dae42c52504cb9c8b0169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOmDOyO2M7VQDPZrIvwPvg.png"/></div></div></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/2d2389e47ca50cc0cd1d7dada019c326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgwp2Kyrhq-jD-xi2lLSEg.png"/></div></div></figure><p id="94c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你做到了！您已经创建了映像，部署了打开了端口 8080 的容器，并且从 AWS CLI 将容器数据保存到了弹性容器注册表中！</p></div></div>    
</body>
</html>