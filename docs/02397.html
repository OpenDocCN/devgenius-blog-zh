<html>
<head>
<title>Part 5: How to Reduce and Reuse Views</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第5部分:如何减少和重用视图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/part-5-how-to-reduce-and-reuse-views-f9d9f3b676e7?source=collection_archive---------11-----------------------#2020-08-01">https://blog.devgenius.io/part-5-how-to-reduce-and-reuse-views-f9d9f3b676e7?source=collection_archive---------11-----------------------#2020-08-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/12de54df51c238601ad6926f01d07b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blsX3P_i0gU_ZnadoAE2qA.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">照片由<a class="ae ja" href="https://unsplash.com/@marjan_blan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">марьянблан| @ marjanblan</a>在<a class="ae ja" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><h2 id="e244" class="jb jc jd bd b dl je jf jg jh ji jj dk jk translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/@Juantri/from-an-app-to-a-super-app-89ae5084e8eb" rel="noopener">从一个App到一个超级App </a></h2><div class=""/><div class=""><h2 id="26f8" class="pw-subtitle-paragraph kj jm jd bd b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dk translated">减少、回收和再利用</h2></div><p id="38bf" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">当你开发一个大项目时，你有时会重复代码和视图，因为你没有足够的时间，你更喜欢复制和粘贴。正如我在上一篇文章<a class="ae ja" href="https://medium.com/jeff-tech/part-2-setting-the-app-in-frameworks-353d07c86f45" rel="noopener"> <em class="lx">设置框架中的应用</em> </a>中告诉你的，我们在<a class="ae ja" href="https://wearejeff.com/" rel="noopener ugc nofollow" target="_blank"> Jeff </a>决定将业务模型转移到框架中，将所有业务逻辑集中到一个公共位置。因此，我们注意到我们有许多重复的视图和逻辑，所以我们决定创建一个通用框架。</p><p id="5daf" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">在这一集的<a class="ae ja" href="https://medium.com/@Juantri/from-an-app-to-a-super-app-89ae5084e8eb" rel="noopener"> <em class="lx">中，我们将讨论如何减少项目的视图数量，以及如何通过不同的方式创建可配置的公共视图，以便在整个项目中重复使用。</em></a></p><p id="da8d" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我们将继续开发我们的<a class="ae ja" href="https://github.com/Juantri94/SchoolProjectPart3" rel="noopener ugc nofollow" target="_blank"> <em class="lx">学校项目</em> </a>，我们将解释我们如何在Jeff iOS团队中管理共同的观点和方法。为了解释这一过程，我们将创建一个新的框架，在其中设置所有通用视图和方法，我们将创建一个通用视图，并在现有的不同框架中管理它。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h1 id="fc1a" class="mf mg jd bd mh mi mj mk ml mm mn mo mp ks mq kt mr kv ms kw mt ky mu kz mv mw bi translated">学院院长</h1><p id="fc2e" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">第一步，添加我们学校的院长。这将是我们项目的公共场所，在这里我们将有共同的类和视图，所以我们将创建dean框架:<em class="lx"> DeanFramework </em>。为了做到这一点，我们按照我之前的文章<a class="ae ja" href="https://medium.com/jeff-tech/part-2-setting-the-app-in-frameworks-353d07c86f45" rel="noopener"> <em class="lx">的步骤在框架</em> </a>中设置应用程序，所以让我们开始吧！</p><p id="1b36" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">根据帖子创建框架，并将其命名为<em class="lx"> DeanFramework </em>。不要创建主视图和局部视图，只创建框架。之后，你要创建DeanApp(也按照帖子的步骤)。当你完成时，你会得到这样的东西:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nc"><img src="../Images/ea8fe3bb0f0db49a2ef9381510d124f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e2Vk0QjhR1fgJgLR"/></div></div></figure><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f75ba8e640e2427d45d0937ee6178309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/0*pF1-b3FCsq4TDNT8"/></div></figure><p id="89c2" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我们将开发两种常见的视图:警报和评级弹出窗口。在<em class="lx"> DeanFramework </em>内部创建一个文件夹并将其命名为<code class="fe ni nj nk nl b">Views</code>，在其中为警报和评级弹出窗口创建另外两个文件夹并将其命名为<code class="fe ni nj nk nl b">Alert</code>和<code class="fe ni nj nk nl b">Rating</code>。在每个文件夹中，我们必须创建我们的视图，所以创建视图控制器，视图模型，路由器和视图，就像我在上一篇文章中解释的那样。你会得到这样的东西:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/46d1580260053ee4ceb454baea5b8a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*cH94pgzcH2U2ps3c"/></div></figure><h1 id="3137" class="mf mg jd bd mh mi nn mk ml mm no mo mp ks np kt mr kv nq kw mt ky nr kz mv mw bi translated">创建通用视图:警报</h1><p id="21fe" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">我们从警报开始。第一件事是思考警报做什么，以及如何传达它。我们创建一个协议来允许警报和实现它的视图之间的通信:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/785e6e771843cbd2ae5fc68f7e27214a.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/0*c3NytOrmlrmWkJZb"/></div></figure><blockquote class="nt nu nv"><p id="45b1" class="lb lc lx ld b le lf kn lg lh li kq lj nw ll lm ln nx lp lq lr ny lt lu lv lw ig bi translated">请记住，协议和视图必须是公共的，以便在框架之外访问它们</p></blockquote><p id="12c3" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">由于警报是可配置的，标签和按钮的文本将作为参数传递给构造函数来配置视图。我们的警报视图的代码如下:</p><div class="im in gp gr io nz"><a href="https://github.com/Juantri94/SchoolProjectPart4/tree/master/DeanFramework/DeanFramework/Views/Alert" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jn gy z fp oe fr fs of fu fw jm bi translated">Juan tri 94/学校项目第4部分</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">帖子第四部分:从一个App到超级App https://medium . com/@ Juan tri/From-an-App-to-a-super-App-89ae 5084 e8eb…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on iu nz"/></div></div></a></div><p id="8f16" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">现在是时候检查警报是否正常工作了，所以打开DeanApp，在<code class="fe ni nj nk nl b">Main.storyboard</code>上添加一个按钮来打开它。我创建了两个按钮:一个用一个按钮打开警报，另一个用一个长体两个按钮打开警报。</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi oo"><img src="../Images/d2310c72eb3551eb454c103450d05033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlqLl3RPN1DGn1pyiXKA7A.png"/></div></div></figure><p id="2580" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">当我们单击警报的任何按钮时，动作由代理(主视图的视图控制器)完成。如果我们添加一个打印函数，我们会得到以下结果:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div class="gh gi op"><img src="../Images/902e7ca7530fdfb1236c7e8a0fbc9db7.png" data-original-src="https://miro.medium.com/v2/resize:fit:234/0*d6AD0l6H6EbMrEJL"/></div></figure><p id="82ac" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">警报正在工作，所以是时候在我们的学校项目中使用它了！</p><h2 id="ac63" class="oq mg jd bd mh or os dn ml ot ou dp mp lk ov ow mr lo ox oy mt ls oz pa mv jj bi translated">使用警报</h2><p id="7a80" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">现在我们必须创建podspec，正如我在上一篇文章<a class="ae ja" href="https://medium.com/jeff-tech/part-2-setting-the-app-in-frameworks-353d07c86f45" rel="noopener"> <em class="lx">中告诉你的那样，在框架</em> </a>中设置应用程序。按照步骤将框架作为pod添加到SchoolProject中。打开<code class="fe ni nj nk nl b">School Home</code>并添加一个按钮来打开警报。</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/509400ab3b6b96348727abab937f3415.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/0*41NHY4IJN4vS6h1X"/></div></figure><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h1 id="f654" class="mf mg jd bd mh mi nn mk ml mm no mo mp ks np kt mr kv nq kw mt ky nr kz mv mw bi translated">创建可重复使用的视图:评级弹出窗口</h1><p id="ea81" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">让我们创建一些更复杂的东西。假设你想对学校和学生进行评级，这是一个常见的操作，但可能每个评级都有不同的逻辑，例如，当你对学校进行评级时，你必须发送一些关于学校的具体数据，但当你对学生进行评级时，你必须只发送学生分数。我们将开发一个可重用的视图，可以根据情况做不同的动作。</p><p id="89cb" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">回到我们的<em class="lx"> DeanFramework </em>并打开评级视图。我们将创建一个带有标题、描述、选项列表和两个按钮(发送和关闭)的评级视图。和以前一样，我们必须为视图创建协议。该协议必须具有视图的两个主要操作:rate和close(两个按钮操作)，因此实现它的类将具有与评级过程相关联的逻辑。</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi pe"><img src="../Images/f9ba29ae6763f6e8277f70d36edffb7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1LfY8O_bYyfBe-Vq"/></div></div></figure><p id="e203" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我们评级弹出窗口的代码:</p><div class="im in gp gr io nz"><a href="https://github.com/Juantri94/SchoolProjectPart4/tree/master/DeanFramework/DeanFramework/Views/Rating" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jn gy z fp oe fr fs of fu fw jm bi translated">Juan tri 94/学校项目第4部分</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">帖子第四部分:从一个App到超级App https://medium . com/@ Juan tri/From-an-App-to-a-super-App-89ae 5084 e8eb…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="pf l ok ol om oi on iu nz"/></div></div></a></div><p id="b415" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">一旦我们有了视图，我们需要一个实现评级弹出协议的类，所以转到<em class="lx"> DeanApp </em>创建一个名为<code class="fe ni nj nk nl b">RatingExample</code> <em class="lx">的新文件。</em> Make类实现了协议并添加了评级的逻辑，例如:</p><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pg pd l"/></div></figure><p id="fc0f" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">打开<code class="fe ni nj nk nl b">main.storyboard</code>并添加一个打开弹出窗口的按钮:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ph"><img src="../Images/1e140d88fb4a2ebbb2fb5202a028b1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D4TDxpZ3c9YgKVd4"/></div></div></figure><p id="41bc" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">启动示例应用程序，选择一个选项，写下评论并发送评级:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi pi"><img src="../Images/3ebb38c084c20dde3254ac4ee4a4c7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kbxirKJ9HYYhfbZAGCjaYA.png"/></div></div></figure><p id="1e5b" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">太好了！你拿到了！</p><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pj pd l"/></div></figure><h2 id="c28f" class="oq mg jd bd mh or os dn ml ot ou dp mp lk ov ow mr lo ox oy mt ls oz pa mv jj bi translated">给学校和学生评级</h2><p id="d817" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">是时候深入了解并在主项目中使用我们的评级弹出窗口了。先说学生框架。打开学生项目并在podfile中添加Dean依赖项(记住也要在podspec中添加)。我们需要一个类来实现分级弹出窗口的协议，所以我们将创建一个名为<code class="fe ni nj nk nl b">StudentRating</code>的类，并使它成为协议的代表。你可以在框架的根文件夹中创建一个名为<code class="fe ni nj nk nl b">Domain</code>的文件夹。在该类中添加以下代码:</p><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pg pd l"/></div></figure><p id="c8dc" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">现在打开学生详细信息视图，并添加一个按钮来打开评级弹出窗口。在视图模型中，您必须为评级弹出窗口创建代理，并将其作为参数传递给路由器，以便初始化视图。像以前一样，启动示例应用程序，选择一个选项，写下评论并发送评级:</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi pk"><img src="../Images/f21ae92a1d339cebf7ca1d37dba394eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oou8-FO0jvTD67t-VF9XCw.png"/></div></div></figure><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pl pd l"/></div></figure><p id="2987" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated"><strong class="ld jn">更进一步！让我们给学校评级吧！</strong></p><p id="751a" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我们必须做与<em class="lx">学生项目相同的事情。</em>我们必须执行与之前相同的步骤:在podfile中添加pod，并创建一个实现分级协议的类。我在一个名为<code class="fe ni nj nk nl b">Domain</code>的新文件夹中创建了一个名为<code class="fe ni nj nk nl b">SchoolRating</code>的类。让我们实现<em class="lx"> StudentFramework </em>中的协议:</p><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pg pd l"/></div></figure><p id="e846" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">如前所述，我们必须在学校主页视图中创建一个按钮，初始化代理，并将其作为参数传递给路由器，以便初始化视图。启动app，给学校打分！</p><figure class="nd ne nf ng gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi pm"><img src="../Images/05a040d49b6b2707e0523b5b20ec7efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wO6whi_vwe8uYswrzqqUDg.png"/></div></div></figure><figure class="nd ne nf ng gt ip"><div class="bz fp l di"><div class="pn pd l"/></div></figure><h1 id="1281" class="mf mg jd bd mh mi nn mk ml mm no mo mp ks np kt mr kv nq kw mt ky nr kz mv mw bi translated">更多选项</h1><p id="b2eb" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">有很多方法可以正视重用和减少视图的问题:</p><ul class=""><li id="bc46" class="po pp jd ld b le lf lh li lk pq lo pr ls ps lw pt pu pv pw bi translated">始终具有相同逻辑的通用视图:预警示例。</li><li id="ecfc" class="po pp jd ld b le px lh py lk pz lo qa ls qb lw pt pu pv pw bi translated">具有不同逻辑的共同视图:评级弹出示例。</li><li id="ddb0" class="po pp jd ld b le px lh py lk pz lo qa ls qb lw pt pu pv pw bi translated">公共视图元素，例如地图:您可以使用地图的逻辑创建视图。另一个例子是横幅:由图标、标题和正文组成的视图，您可以创建一个视图并在init方法中传递数据。</li><li id="ccf8" class="po pp jd ld b le px lh py lk pz lo qa ls qb lw pt pu pv pw bi translated">不同视图中的公共逻辑:一种选择是创建一个包含所有逻辑的基础视图模型，视图的视图模型继承它。</li></ul><h1 id="599d" class="mf mg jd bd mh mi nn mk ml mm no mo mp ks np kt mr kv nq kw mt ky nr kz mv mw bi translated">结论</h1><p id="f698" class="pw-post-body-paragraph lb lc jd ld b le mx kn lg lh my kq lj lk mz lm ln lo na lq lr ls nb lu lv lw ig bi translated">你可以在<a class="ae ja" href="https://github.com/Juantri94/SchoolProjectPart3" rel="noopener ugc nofollow" target="_blank"> </a> <a class="ae ja" href="https://github.com/Juantri94/SchoolProjectPart4" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到例子的源代码。</p><p id="89e7" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">在这篇教程中，我试图解释我在开发过程中发现的最困难的复用视图选项。主要想法是创建一个核心或共同点，我们可以将所有这些视图或逻辑放在一起并重用它们。例如，我们可以添加一些我们将在整个项目中使用的公共文件，比如验证器、扩展等。</p><p id="dd8c" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">作为一个细节，我们可以把风格框架，在之前的<a class="ae ja" href="https://medium.com/@Juantri/part-4-how-to-manage-dependencies-in-an-app-with-frameworks-a59119e7d34f" rel="noopener">帖子</a>中解释过，放在<em class="lx"> DeanFramework </em>中，在普通视图中有风格。同样，我们可以根据<em class="lx"> StudentFramework </em>或<em class="lx"> SchoolProject对它们进行不同的配置。</em></p><p id="9a51" class="pw-post-body-paragraph lb lc jd ld b le lf kn lg lh li kq lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">下一篇文章将是从应用程序到超级应用程序的传奇<a class="ae ja" href="https://medium.com/@Juantri/from-an-app-to-a-super-app-89ae5084e8eb" rel="noopener">的最后一篇，我将分享一个模板来简化新视图的创建。</a></p></div></div>    
</body>
</html>