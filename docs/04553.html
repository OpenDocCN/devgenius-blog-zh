<html>
<head>
<title>Art of Clean Code — Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">干净代码的艺术——日志</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/art-of-clean-code-logging-d760b0918603?source=collection_archive---------0-----------------------#2021-04-02">https://blog.devgenius.io/art-of-clean-code-logging-d760b0918603?source=collection_archive---------0-----------------------#2021-04-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5aff" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">日志可以用简单的语言讲述系统状态的故事</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/42d97fdd1bd56ce6fcf0c31123e8ce19.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*Jfho1qtQhqaetUMa1oy-wg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated"><a class="ae ko" href="https://pixabay.com/illustrations/hand-painting-drawing-painter-2433477/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><blockquote class="kp kq kr"><p id="0a60" class="ks kt ku kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="in">“在某些方面，编程就像绘画。你从一块空白的画布和一些基本的原材料开始。你综合运用科学、艺术和工艺来决定如何处理它们。”安德鲁·亨特</em></p></blockquote><p id="f8db" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我关于伐木重要性的第一堂课是在 2001-02 年，来自我的经理兼教练<a class="ae ko" href="https://www.linkedin.com/in/puneet1409/" rel="noopener ugc nofollow" target="_blank">普内特·阿加瓦尔</a>。我们正在为数据绑定 Swing 组件构建一个框架，该框架可用于使用 Net Beans 类型的 IDE 动态设计任何应用程序，从而实现快速应用程序开发。</p><p id="a570" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">该设计旨在扩展 Swing 组件，为上下文中的数据源(和数据)附加元数据，并使用组件生命周期事件(如添加/删除通知)跨组件层次结构传递元数据，并扩展 paint 函数以使用数据呈现组件。</p><p id="a94e" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">这看起来是一个简单的设计，但是由于 UI 元素的层次性，实现起来很复杂。数据需要从父节点传递到子节点，反之亦然。这意味着这个递归流程中的任何缺失(例如，甚至是在 Swing 触发的重复呈现事件中对数据加载的错误处理)都可能导致数据加载、呈现、内存管理和面向用户的功能的问题。</p><p id="8543" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">在如此复杂的递归系统中调试的唯一救星是“日志艺术”。这时，我的经理告诉我日志的重要性，包括适当级别的日志和适当级别的信息。</p><p id="26be" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我仍然记得这一课，并遵循它</p><blockquote class="ls"><p id="0cbb" class="lt lu in bd lv lw lx ly lz ma mb lo dk translated"><em class="mc">伐木是一门艺术</em></p></blockquote></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="a420" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">现在，我们在 IDE 中有了许多高级特性。例如，断点、调试模式等。这使得调试更加容易，可以使用实时运行时数据并控制事件的开始、重启和停止。</p><p id="8baa" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">话虽如此，当服务器或分布式环境中出现问题时，日志非常有助于通过查看记录的数据来理解问题。即使是在本地开发环境中，通过一次读取适当制作的日志，也可以更容易地看到整个系统的状态。</p><p id="c19d" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">因此，有效的日志记录对于干净的代码是非常重要的，这种代码可以容易地长期维护，可以在生产中运行而不会在晚上给开发人员/操作人员/用户带来困扰，并且如果出现问题，易于调试和快速修复。</p><p id="b7e3" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">让我们来讨论一些有效日志记录的重要基础，从而编写一个简洁有效的代码。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="a890" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">对“日志格式”有共同的理解</h1><p id="bfc9" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">是的，这很重要。参考之前关于干净代码的博客<a class="ae ko" href="https://medium.com/dev-genius/art-of-clean-code-b921142a05e9" rel="noopener">这里</a>，我们在那里讨论了团队中代码库的标准格式，因为它使阅读代码变得容易。同样的原则也适用于日志。如果有不同种类的日志格式和模式，理解它们需要时间。</p><blockquote class="ls"><p id="4266" class="lt lu in bd lv lw lx ly lz ma mb lo dk translated"><em class="mc">我们应该能够像阅读故事一样阅读日志。用简单的语言讲述系统状态的故事</em></p></blockquote><p id="aeb8" class="pw-post-body-paragraph ks kt in kv b kw nh jo ky kz ni jr lb lp nj le lf lq nk li lj lr nl lm ln lo ig bi translated">因此，作为一个团队一起决定一种形式，并遵循它。样本格式:</p><ul class=""><li id="a4a0" class="nm nn in kv b kw kx kz la lp no lq np lr nq lo nr ns nt nu bi translated">一种告诉阶段、系统状态的信息。状态 1[值 1]状态 2[值 2]</li><li id="1183" class="nm nn in kv b kw nv kz nw lp nx lq ny lr nz lo nr ns nt nu bi translated"><reason>造成的错误。预期行为是<expectation>。errorMessage[message]，异常堆栈跟踪(如果有)</expectation></reason></li><li id="5b79" class="nm nn in kv b kw nv kz nw lp nx lq ny lr nz lo nr ns nt nu bi translated">等等...</li></ul><blockquote class="ls"><p id="a2e2" class="lt lu in bd lv lw oa ob oc od oe lo dk translated">日志的格式并不重要，但是，对格式有一个共同的理解才是重要的。</p></blockquote></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="79ed" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">对“记录什么”有共同的理解</h1><p id="076c" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">与日志的格式相似，对要记录的内容有一个共同的理解也同样重要。</p><p id="5063" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">这有助于培养将正确的信息记录为团队文化的习惯，不管是组件还是开发人员。最终，它有助于拥有对称的日志，每个人都可以阅读相似级别的信息。</p><p id="f344" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">它帮助任何人理解系统状态和错误，因此任何人都可以尝试修复它。它有助于消除对一个人甚至一个团队的依赖，至少有助于理解系统状态或失败的原因。</p><p id="36ce" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><strong class="kv io">举例:</strong></p><ul class=""><li id="4290" class="nm nn in kv b kw kx kz la lp no lq np lr nq lo nr ns nt nu bi translated">带有参数、响应代码或状态的系统来电。</li><li id="7125" class="nm nn in kv b kw nv kz nw lp nx lq ny lr nz lo nr ns nt nu bi translated">来自其他服务的传出调用、参数和响应。(当然，在考虑了登录的安全准则之后)</li><li id="7302" class="nm nn in kv b kw nv kz nw lp nx lq ny lr nz lo nr ns nt nu bi translated">等等...</li></ul><p id="e069" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我体验过这样的系统，运营和开发团队过去常常花几个小时打电话，只是为了理解请求、参数和响应代码等。</p><p id="353b" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">值得花一次宝贵的时间来实现有效的日志，而不是花几个小时来让每个人，包括客户，感到沮丧。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="5352" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">对“日志级别”有共同的理解</h1><p id="725a" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">日志记录级别很重要。</p><p id="c740" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">如果所有的日志都已经放在‘info’里了怎么办，在真实环境下会让系统超级慢。日志、字符串操作对性能有重大影响。</p><p id="2a66" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">如果大部分日志都处于调试状态，并且在不启用调试模式的情况下无法理解 prod 环境中的重要状态，该怎么办呢？这会降低整个系统的速度。对于警告、错误和致命类型的模式也是如此。</p><p id="6e4e" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><strong class="kv io">定义什么应该去哪里。</strong></p><p id="e76b" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我们是否希望在 info 中记录所有的呼入和呼出，以了解重要的系统交互数据？</p><p id="cc74" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我们要在 info 中记录所有中间重要事件吗？</p><p id="f5bb" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我们是否希望在调试模式下记录所有状态变化，以便通过打开这些来调试任何问题？</p><p id="5de1" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">我们是要将数据库访问失败记录为错误，还是应该将其记录为致命错误，因为我们没有任何可自动进行故障转移的备用数据库。</p><blockquote class="kp kq kr"><p id="5977" class="ks kt ku kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为团队有一个共同的理解并遵循它。</p></blockquote></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="552a" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">定义用于读取日志的基础架构和工具</h1><p id="cb32" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">定义接收、整理和呈现日志信息所需的工具和基础架构非常重要。该系统应该有助于以易读的格式方便地检索日志。</p><p id="e8b8" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">如果设置正确，它可以节省大量的精力(尤其是在分布式环境中),从不同的机器上查找日志文件，整理数据，然后从多个来源获取信息。</p><p id="a2c4" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">现在有很多很棒的日志分析工具，包括开源的和商业的。选择一个对你的产品、团队和组织生态系统有意义的，并使用它。它节省了大量的精力，也避免了团队在生产问题上的挫败感。</p><p id="91e6" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">另一个好处是，如果前面的所有要点都实现得很好，任何人都可以提取日志，并可以尝试了解系统状态。任何人都可以尝试解决这些问题，或者至少可以提供有用的信息。</p><p id="36d2" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">一些工具和框架的例子:ELK，Graylog，Splunk，Sumologic，Logmatic。这里的是一个关于这些工具的很好的博客简介。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="8ffe" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">使用上述所有工具进行监控、警报和统计</h1><p id="a555" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">一旦日志就位，信息的格式和级别被定义，用于摘要和呈现日志的工具被配置。我们都准备利用这些信息来实现更高的目标，那就是让生活更轻松，让产品更丰富。</p><p id="2729" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">设置对记录数据的监控，这有助于在发生任何不好或好的事件时发出警报。支持团队和开发团队可以在系统中出现问题的第一个迹象时得到通知。这可以让他们有机会主动管理问题或用户的期望，或者两者兼而有之。</p><blockquote class="ls"><p id="92d9" class="lt lu in bd lv lw lx ly lz ma mb lo dk translated"><em class="mc">一个有效的日志监控系统可以通过主动监控系统的重要健康信号来拯救生命</em></p></blockquote><p id="3608" class="pw-post-body-paragraph ks kt in kv b kw nh jo ky kz ni jr lb lp nj le lf lq nk li lj lr nl lm ln lo ig bi translated">可以进一步分析日志生成的数据，以了解使用模式。该数据可进一步用于增强、改善系统弹性或产品特性。例如:</p><ul class=""><li id="5ff0" class="nm nn in kv b kw kx kz la lp no lq np lr nq lo nr ns nt nu bi translated">分析所有 API 的流量有助于主动扩展系统和服务。</li><li id="04f1" class="nm nn in kv b kw nv kz nw lp nx lq ny lr nz lo nr ns nt nu bi translated">通过主动了解用户行为，分析功能的使用模式有助于定义未来增强的策略。</li></ul></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="2127" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">摘要</h1><p id="71dc" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">网上有许多好的博客和资源，可以用来记录最佳实践和工具，这有助于研究最佳策略。然而，最重要的方面是对日志期望、模式和分析需求有一个共同的理解。</p><p id="7833" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">一旦这些基础被定义、达成一致，并在团队层面上被遵循，生态系统的其余部分就可以很容易地围绕这些基础来构建。</p><p id="2aeb" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">正确的日志级别对于系统维护非常重要。正确的日志记录水平可以为团队成员和客户节省大量的时间、精力。因此，它定义了我们对责任的专业程度，以及我们对团队成员和客户的重视程度。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="9802" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">更大的</h1><p id="74db" class="pw-post-body-paragraph ks kt in kv b kw nc jo ky kz nd jr lb lp ne le lf lq nf li lj lr ng lm ln lo ig bi translated">在以下文章中了解干净编码的更多方面:</p><p id="ffa4" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated">干净代码的艺术。 <a class="ae ko" href="https://medium.com/dev-genius/art-of-clean-code-b921142a05e9" rel="noopener">这里指<em class="ku"/></a><em class="ku">。</em></p><p id="6b63" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><em class="ku">干净代码的艺术——错误处理。这里的</em>  <em class="ku">参见</em> <a class="ae ko" href="https://medium.com/dev-genius/art-of-clean-code-error-handling-7951587eac98" rel="noopener"> <em class="ku">。</em></a></p><p id="fea0" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><em class="ku">干净代码的艺术——文档。</em> <a class="ae ko" href="https://medium.com/dev-genius/art-of-clean-code-documentation-177b62a8320" rel="noopener"> <em class="ku">这里指</em> </a> <em class="ku">。</em></p><h2 id="0ada" class="of ml in bd mm og oh dn mq oi oj dp mu lp ok ol mw lq om on my lr oo op na oq bi translated">快乐学习，快乐编码！</h2></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="ba53" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><em class="ku">喜欢看这个，请分享，给个掌声，关注类似的故事！</em></p><p id="dfed" class="pw-post-body-paragraph ks kt in kv b kw kx jo ky kz la jr lb lp ld le lf lq lh li lj lr ll lm ln lo ig bi translated"><em class="ku">如有任何建议，欢迎通过</em><strong class="kv io"><em class="ku">Linkedin</em></strong><em class="ku">:</em><a class="ae ko" href="https://www.linkedin.com/in/mohitkgupta/" rel="noopener ugc nofollow" target="_blank"><em class="ku">Mohit Gupta</em></a>联系我</p></div></div>    
</body>
</html>