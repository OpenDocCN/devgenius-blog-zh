<html>
<head>
<title>Create an EC2 Instance with Ruby installation Using AWS CloudFormation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS CloudFormation 创建带有 Ruby 安装的 EC2 实例</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-an-ec2-instance-with-ruby-installation-using-aws-cloudformation-abc5aa8da0c8?source=collection_archive---------14-----------------------#2022-05-29">https://blog.devgenius.io/create-an-ec2-instance-with-ruby-installation-using-aws-cloudformation-abc5aa8da0c8?source=collection_archive---------14-----------------------#2022-05-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0e56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们正在使用 AWS CloudFormation 创建一个带有 Ruby 安装的 EC2 实例</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3013ad8d82bb851cb35d3ed087d57284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kV_W3VGo84NqjOk3I7XoLA.png"/></div></figure><h1 id="07cd" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">什么是 AWS Cloudformation？</h1><p id="6e24" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">AWS CloudFormation 是一项服务，为开发人员和企业提供了一种简单的方法来创建相关 AWS 和第三方资源的集合，并以有序和可预测的方式提供和管理它们。我们将在这个项目中使用映射、资源和输出。</p><p id="3b08" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是我们将要创建的核心组件:</p><ul class=""><li id="bfab" class="lt lu in jm b jn jo jr js jv lv jz lw kd lx kh ly lz ma mb bi translated">Web 服务器安全组</li><li id="944b" class="lt lu in jm b jn mc jr md jv me jz mf kd mg kh ly lz ma mb bi translated">EC2 实例，带有 Ubuntu 20.04 映像和 8Gb Ebs 卷以及 Ruby 安装。</li></ul><blockquote class="mh mi mj"><p id="d27c" class="jk jl mk jm b jn jo jp jq jr js jt ju ml jw jx jy mm ka kb kc mn ke kf kg kh ig bi translated">要创建 VPC 和子网，请查看下面的文章，在这篇文章中，我们将创建一个安装了 Ruby 的 EC2 实例。<br/> <a class="ae mo" href="https://awstip.com/create-a-vpc-with-private-and-public-subnets-using-cloudformation-939114a38f22" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">使用 CloudFormation </strong> </a>创建带有私有和公共子网的 VPC</p></blockquote><p id="93c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">映射:</strong></p><p id="b638" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/mappings-section-structure.html" rel="noopener ugc nofollow" target="_blank">映射</a>部分基本上是一个使用键:值关系的查找表。在这个模板中，Amazon 机器映像被映射到其各自的区域。我只为这个项目映射了一个区域，所以模板仅限于这一个区域，如果在这些区域之外启动将会失败。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="3900" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">参数:</strong></p><p id="1411" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用可选的<code class="fe mr ms mt mu b"><a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html" rel="noopener ugc nofollow" target="_blank">Parameters</a></code>部分定制您的模板。参数使您能够在每次创建或更新堆栈时向模板输入自定义值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="8614" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更改您的密钥名。</p><p id="2f89" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">资源:</strong></p><p id="d560" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resources-section-structure.html" rel="noopener ugc nofollow" target="_blank"> Resources </a>部分包括您想要在堆栈中创建的所有 AWS 资源。</p><ol class=""><li id="1022" class="lt lu in jm b jn jo jr js jv lv jz lw kd lx kh mv lz ma mb bi translated">对于<em class="mk"> WebserverSecurityGroup </em>，模板正在创建一个安全组，该安全组具有允许 HTTP 上所有流量的入站规则。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="faf3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.对于<em class="mk"> EC2Instance </em>，模板正在创建一个具有以下属性的 EC2 实例:</p><ul class=""><li id="e7ae" class="lt lu in jm b jn jo jr js jv lv jz lw kd lx kh ly lz ma mb bi translated">ImageID:您可以直接为该属性输入 AMI-Id，但是因为我们希望能够在一个区域中使用模板，所以我们使用<a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-findinmap.html" rel="noopener ugc nofollow" target="_blank"> FindInMap 函数</a>来引用我们的映射。</li><li id="4d6f" class="lt lu in jm b jn mc jr md jv me jz mf kd mg kh ly lz ma mb bi translated">UserData:这个部分用于使用<a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" rel="noopener ugc nofollow" target="_blank"> CloudFormation::Init </a>安装 Ruby</li></ul><blockquote class="mh mi mj"><p id="b0d8" class="jk jl mk jm b jn jo jp jq jr js jt ju ml jw jx jy mm ka kb kc mn ke kf kg kh ig bi translated"><strong class="jm io">AWS::CloudFormation::Init<br/></strong>使用 AWS::cloud formation::Init 类型包含 Amazon EC2 实例上的元数据</p></blockquote><p id="fd41" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">EC 实例模板</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a0cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">输出:</strong></p><p id="ba72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建堆栈后，<a class="ae mo" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html" rel="noopener ugc nofollow" target="_blank">输出</a>部分将信息打印到 CloudFormation 中的输出选项卡，也可用于将信息导入其他堆栈。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="7731" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">完整的云形成模板:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c97b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">最终输出</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/2f408fc0d44c305022e79f03e46d3ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2Vv3ozlBesRVELMF7zobg.png"/></div></div></figure><p id="bfca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">RVM 和 Ruby 默认安装输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/6f7174672d0cf3cefe0c31d99f3db361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F400F7KWSV2f9U1saNPubw.png"/></div></div></figure><blockquote class="mh mi mj"><p id="4e7a" class="jk jl mk jm b jn jo jp jq jr js jt ju ml jw jx jy mm ka kb kc mn ke kf kg kh ig bi translated"><em class="in">注意，使用</em> <code class="fe mr ms mt mu b"><em class="in">DeletionPolicy</em></code> <em class="in">可以保留该属性，并且在某些情况下，当资源的堆栈被删除时，可以对其进行备份。您为想要控制的每个资源指定一个</em> <code class="fe mr ms mt mu b"><em class="in">DeletionPolicy</em></code> <em class="in">属性。如果一个资源没有</em> <code class="fe mr ms mt mu b"><em class="in">DeletionPolicy</em></code> <em class="in">属性，亚马逊 CloudFormation 默认删除该资源。如果您想保留您的所有资源，则在每个资源<br/>中添加</em> <code class="fe mr ms mt mu b"><em class="in">DeletionPolicy: Retain</em></code> <em class="in">以了解更多详细信息:</em> <a class="ae mo" href="https://docs.amazonaws.cn/en_us/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html" rel="noopener ugc nofollow" target="_blank"> AWS 文档</a></p></blockquote><p id="4ac2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><p id="c76f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用该模板，您可以创建带有公共和私有子网、Web 服务器安全组的 VPC，并使用 AWS CloudFormation 启动带有 Ruby 安装的 EC2 实例。它构建了一个私有网络环境，您可以在其中安全地运行 AWS 资源以及相关的网络资源。</p><p id="3da3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果本指南对您和您的团队有所帮助，请与他人分享！</p></div></div>    
</body>
</html>