<html>
<head>
<title>Well-Known Locations: A Reserved URI Path Prefix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">众所周知的位置:保留的URI路径前缀</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/well-known-locations-a-reserved-uri-path-prefix-5277b2f37db7?source=collection_archive---------0-----------------------#2020-12-28">https://blog.devgenius.io/well-known-locations-a-reserved-uri-path-prefix-5277b2f37db7?source=collection_archive---------0-----------------------#2020-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="ca88" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">它在域验证和电子邮件安全中的应用</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/38a1e6220d62f0cdb96d287086142ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iSfMBZrWLAGweHAV"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com/@jens_johnsson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">延斯·约翰森</a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ee37" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi lp translated">你知道吗？众所周知的URIs是那些以/开头的。众所周知的/在其路径中，格式为/。知名/ &lt;后缀&gt;。它由<a class="ae ks" href="https://tools.ietf.org/html/rfc8615" rel="noopener ugc nofollow" target="_blank"> RFC 8615 </a>定义。它们用于信息发现、策略和域验证等。提议的标准保留了路径前缀/的使用。众所周知的/在HTTP，HTTPS，WS和WSS方案。</p><blockquote class="ly lz ma"><p id="f7b6" class="kt ku mb kv b kw kx jo ky kz la jr lb mc ld le lf md lh li lj me ll lm ln lo ig bi translated"><a class="ae ks" href="https://tools.ietf.org/html/rfc8615#page-3" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">第1节</strong> </a> <strong class="kv io"> : </strong>为了解决这些用途，本备忘录在HTTP、HTTPS、WebSocket (WS)和安全WebSocket (WSS) URIs中为这些“众所周知的位置”保留了路径前缀，“/。众所周知/”。需要为这种元数据定义资源的未来规范可以注册它们的使用，以避免冲突并最小化对源的URI空间的影响。</p></blockquote><p id="552d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">目前<a class="ae ks" href="https://www.iana.org/assignments/well-known-uris/well-known-uris.xhtml" rel="noopener ugc nofollow" target="_blank">注册的后缀</a>包括用于域验证的“<em class="mb"> acme-challenge”、“PKI-Validation”</em>和提供电子邮件安全传输策略的“<em class="mb">MTA-STS . txt”</em>。</p><h2 id="1bd8" class="mf mg in bd mh mi mj dn mk ml mm dp mn lc mo mp mq lg mr ms mt lk mu mv mw mx bi translated">托管服务提供商</h2><p id="672d" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated">一个众所周知的URI的简单例子是'<a class="ae ks" href="https://github.com/Automattic/hosting-provider" rel="noopener ugc nofollow" target="_blank"><em class="mb"/></a><em class="mb">'</em>后缀。它提供了谁是给定域或子域主机的提示。虽然这没有被广泛部署，但是它适用于Word Press托管的域，</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="1a6d" class="mf mg in ne b gy ni nj l nk nl">$ curl <a class="ae ks" href="https://wordpress.com/.well-known/hosting-provider" rel="noopener ugc nofollow" target="_blank">https://wordpress.com/.well-known/hosting-provider</a><br/>WordPress.com</span></pre></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="d4d9" class="nt mg in bd mh nu nv nw mk nx ny nz mn jt oa ju mq jw ob jx mt jz oc ka mw od bi translated">SMTP MTA —严格的传输安全</h1><h2 id="e0b3" class="mf mg in bd mh mi mj dn mk ml mm dp mn lc mo mp mq lg mr ms mt lk mu mv mw mx bi translated">mta-sts.txt</h2><p id="0391" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated">为了改善电子邮件生态系统和控制垃圾邮件，多年来已经采用了几种方法<a class="ae ks" href="https://en.wikipedia.org/wiki/Sender_Policy_Framework" rel="noopener ugc nofollow" target="_blank"> SPF </a>、<a class="ae ks" href="https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail" rel="noopener ugc nofollow" target="_blank"> DKIM </a>、<a class="ae ks" href="https://dmarc.org/overview/" rel="noopener ugc nofollow" target="_blank"> DMARC </a>、<a class="ae ks" href="https://www.rfc-editor.org/rfc/rfc8617.html" rel="noopener ugc nofollow" target="_blank"> ARC </a>。最新加入该列表的是在<a class="ae ks" href="https://tools.ietf.org/html/rfc8461" rel="noopener ugc nofollow" target="_blank"> RFC 8461 </a>和<a class="ae ks" href="https://tools.ietf.org/html/rfc8460" rel="noopener ugc nofollow" target="_blank"> TLS-RPT </a>中定义的MTA-STS。MTA-STS与此相关，因为它结合使用DNS TXT记录和众所周知的URI进行<a class="ae ks" href="https://tools.ietf.org/html/rfc8461#page-7" rel="noopener ugc nofollow" target="_blank">策略发现</a>。</p><blockquote class="ly lz ma"><p id="a951" class="kt ku mb kv b kw kx jo ky kz la jr lb mc ld le lf md lh li lj me ll lm ln lo ig bi translated">策略本身是一组键/值对(类似于[RFC5322]中的头字段)，通过固定的“众所周知的”[RFC5785]路径中的HTTPS GET方法提供。著名的/mta-sts.txt "由策略主机提供。策略主机DNS名称是通过在策略域前面加上“mta-sts”来构建的。</p><p id="0522" class="kt ku mb kv b kw kx jo ky kz la jr lb mc ld le lf md lh li lj me ll lm ln lo ig bi translated">因此，对于策略域“example.com ”,完整的URL是"https://mta-sts.example.com/。知名/mta-sts.txt”。</p></blockquote><p id="6532" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">谷歌在其安全博客(2019)中宣布Gmail实现了MTA-STS。有了众所周知的gmail.com的URI，可以得到如下的政策:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="5f60" class="mf mg in ne b gy ni nj l nk nl">$ curl <a class="ae ks" href="https://mta-sts.gmail.com/.well-known/mta-sts.txt" rel="noopener ugc nofollow" target="_blank">https://mta-sts.gmail.com/.well-known/mta-sts.txt</a><br/>version: STSv1<br/><strong class="ne io">mode: enforce</strong><br/>mx: gmail-smtp-in.l.google.com<br/>mx: *.gmail-smtp-in.l.google.com<br/>max_age: 86400</span></pre><p id="b7b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">微软也在研究MTA-STS，他们目前对outlook.com和T21的政策如下:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="91d1" class="mf mg in ne b gy ni nj l nk nl">$ curl <a class="ae ks" href="https://mta-sts.outlook.com/.well-known/mta-sts.txt" rel="noopener ugc nofollow" target="_blank">https://mta-sts.outlook.com/.well-known/mta-sts.txt</a><br/>version: STSv1<br/><strong class="ne io">mode: testing</strong><br/>mx: *.olc.protection.outlook.com<br/>max_age: 604800</span></pre><p id="ac1c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一方面，不深入MTA-STS的细节，通过引入HTTPS和著名的URIs来保护电子邮件的方法听起来并不太好。邮件/ SMTP曾经独立于Web / HTTP，但现在不是了。</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="5b6d" class="nt mg in bd mh nu nv nw mk nx ny nz mn jt oa ju mq jw ob jx mt jz oc ka mw od bi translated">域验证</h1><h2 id="57df" class="mf mg in bd mh mi mj dn mk ml mm dp mn lc mo mp mq lg mr ms mt lk mu mv mw mx bi translated">极限挑战</h2><p id="8e6d" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated"><a class="ae ks" href="https://tools.ietf.org/html/rfc8555" rel="noopener ugc nofollow" target="_blank">自动证书管理环境</a>或ACME是一个用于自动验证和颁发证书的协议。它为域所有者提供了多种方法来证明对域的控制。一个这样的方法是HTTP-01，它使用后缀'<em class="mb"> acme-challenge '。</em>在这种方法中，ACME服务器将向需要证书的域发送HTTP请求。请求的URL将采用以下格式:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="8723" class="mf mg in ne b gy ni nj l nk nl">http://&lt;domain&gt;/.well-known/acme-challenge/&lt;token&gt;</span></pre><h2 id="6ded" class="mf mg in bd mh mi mj dn mk ml mm dp mn lc mo mp mq lg mr ms mt lk mu mv mw mx bi translated">pki验证</h2><p id="b3e6" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated">同样，对于向域所有者颁发证书的认证机构，CA/浏览器论坛的<a class="ae ks" href="https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.3.8.pdf" rel="noopener ugc nofollow" target="_blank">基线要求</a>(第3.2.2.4.6节)允许通过对网站进行商定的更改来验证域。这种方法使用后缀“<em class="mb"> pki验证</em>”，并要求在众所周知的位置下放置一个特殊文件，</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="aff5" class="mf mg in ne b gy ni nj l nk nl">http://&lt;domain&gt;/.well-known/pki-validation/&lt;file&gt;</span></pre></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="99d8" class="nt mg in bd mh nu nv nw mk nx ny nz mn jt oa ju mq jw ob jx mt jz oc ka mw od bi translated">安全问题</h1><p id="d134" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated">不幸的是，尽管RFC保留了对众所周知的位置的使用，但是Web服务器并没有将它们与其他位置区别对待。这导致恶意演员<a class="ae ks" href="https://news.netcraft.com/archives/2018/01/29/the-hidden-well-known-phishing-sites.html" rel="noopener ugc nofollow" target="_blank">利用<em class="mb">的存在。知名</em>目录</a>。</p><p id="3ecc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从众所周知的URIs的使用中可以明显看出，它们对安全非常重要。而且，它们的位置应该得到适当的保护，因为有多种方法可以利用它们。对网络来说，这绝对不是一件好事，但这是需要解决的问题。</p><blockquote class="ly lz ma"><p id="308c" class="kt ku mb kv b kw kx jo ky kz la jr lb mc ld le lf md lh li lj me ll lm ln lo ig bi translated">知名地点不是对网络不利吗？它们是，但是由于各种原因——包括技术和社会原因——它们有时是必要的。这份备忘录为他们定义了一个“沙箱”,以降低碰撞风险，并最大限度地减少对现场已有URIs的影响。</p></blockquote><p id="19f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用ACME为我们产品中的子域自动生成TLS证书。由于这需要使用众所周知的URI作为HTTP-01质询的一部分，我们已经采取措施禁止访问众所周知的位置，除非质询需要。</p><h2 id="12e8" class="mf mg in bd mh mi mj dn mk ml mm dp mn lc mo mp mq lg mr ms mt lk mu mv mw mx bi translated">仅当文件存在时</h2><p id="2d03" class="pw-post-body-paragraph kt ku in kv b kw my jo ky kz mz jr lb lc na le lf lg nb li lj lk nc lm ln lo ig bi translated">控制对众所周知的位置的访问的一种快速方法是添加一个Web服务器配置来检查文件(如果它存在的话)。这可以分别在<em class="mb"> nginx </em>和<em class="mb"> httpd </em>与<a class="ae ks" href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> if (-f ) </strong> </a>和<a class="ae ks" href="https://httpd.apache.org/docs/2.4/mod/core.html#if" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">&lt;If-f&gt;</strong></a>指令上实现。nginx服务器的配置示例如下:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="8f49" class="mf mg in ne b gy ni nj l nk nl">location /.well-known/ {<br/>  if (!-f "/secure/path/to/file") {<br/>    return 400;<br/>  }<br/>}</span></pre><p id="870e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这也可以很容易地与需要访问众所周知的位置的工具集成。在<a class="ae ks" href="https://certbot.eff.org/docs/using.html#renewing-certificates" rel="noopener ugc nofollow" target="_blank">证书机器人</a>的情况下，要自动更新证书，可以使用选项<strong class="kv io"> -前挂钩</strong>和<strong class="kv io"> -后挂钩</strong>，如下所示:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="8796" class="mf mg in ne b gy ni nj l nk nl">certbot renew --pre-hook "touch /secure/path/to/file" --post-hook "rm -f /secure/path/to/file"</span></pre></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><p id="9f44" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mb">在第0根，我们提供了一个解决方案，</em> <a class="ae ks" href="https://www.0snet.com/" rel="noopener ugc nofollow" target="_blank"> <em class="mb">第0根安全网络— 0SNet </em> </a> <em class="mb">，它使用TLS客户端证书来保护组织的内部web应用。看看我们的产品吧，它很容易部署，也可以在</em> <a class="ae ks" href="https://0snet.info/#install.aws" rel="noopener ugc nofollow" target="_blank"> <em class="mb"> AWS </em> </a> <em class="mb">、</em> <a class="ae ks" href="https://0snet.info/#install.gcp" rel="noopener ugc nofollow" target="_blank"> <em class="mb">、GCP </em> </a> <em class="mb">和</em><a class="ae ks" href="https://0snet.info/#install.azu" rel="noopener ugc nofollow" target="_blank"><em class="mb">Azure</em></a><em class="mb">上看到。</em></p></div></div>    
</body>
</html>