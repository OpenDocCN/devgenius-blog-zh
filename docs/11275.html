<html>
<head>
<title>How to Profile and Benchmark Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•è¯„æµ‹ Python ä»£ç </h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/how-to-profile-and-benchmark-python-code-e82a22a2a72c?source=collection_archive---------6-----------------------#2022-12-29">https://blog.devgenius.io/how-to-profile-and-benchmark-python-code-e82a22a2a72c?source=collection_archive---------6-----------------------#2022-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/e9ca2da90e9b9a01c958de2f16661350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*Pr7HP1fV3VE_I63BHSiiPw.jpeg"/></div></figure><p id="e4b2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåŠŸèƒ½:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="b66d" class="ky kz in ku b be la lb l lc ld">def multiples_of(x: int, max: int) -&gt; list[int]:<br/>    """<br/>    Iteratively Find all the multiples of `x` between 0 and `max`<br/>    i.e 0 &lt; M &lt;= max.<br/>    <br/>    :return list[int]: all multiples<br/>    """<br/>    v = max // x<br/>    return [(i + 1) * x for i in range(v)]</span></pre><p id="2942" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å’Œ</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="068d" class="ky kz in ku b be la lb l lc ld">def gen_multiples_of(x: int, max:int) -&gt; Generator:<br/>    """<br/>    Find all the multiples of `x` between 0 and `max`<br/>    i.e 0 &lt; M &lt;= max.<br/>    <br/>    :return Generator: Can be iterated over to return a list of multiples<br/>    """<br/>    v = max // x<br/>    i = 0<br/>    multiple = 0<br/>    while (multiple &lt;= max) and (i &lt; v):<br/>        multiple = (i + 1) * x<br/>        i += 1<br/>        yield multiple</span></pre><p id="c5a9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä»–ä»¬éƒ½åšåŒæ ·çš„äº‹æƒ…ã€‚æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­å“ªä¸ªå‡½æ•°ä¼˜åŒ–å¾—æ›´å¥½ï¼Œæ•ˆç‡æ›´é«˜ï¼Ÿæˆ‘ä»¬åº”è¯¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å“ªä¸ªï¼Ÿ</p><blockquote class="le lf lg"><p id="ef94" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•ˆç‡æ„å‘³ç€ç”¨æœ€å°‘çš„æ—¶é—´åšå¤§é‡çš„å·¥ä½œã€‚æˆ‘ä»¬ä¸ä¸€å®šä¼šè€ƒè™‘è®¡ç®—æˆæœ¬ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œé€‰æ‹©ä»»ä½•åŠŸèƒ½éƒ½éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡(å¯ç»´æŠ¤æ€§ã€å¯ç”¨èµ„æºç­‰)ã€‚)</p></blockquote><h1 id="0550" class="ll kz in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Timeit æ¨¡å—</h1><p id="f9c2" class="pw-post-body-paragraph jr js in jt b ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko ig bi translated">å¼€å§‹æ¦‚è¦åˆ†æçš„æœ€ç®€å•æ–¹æ³•ä¹‹ä¸€æ˜¯ï¼Œ<strong class="jt io"> timeit </strong>æ¨¡å—æ˜¯ Python æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚</p><p id="c6e3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æŠ€æœ¯ä¸Šï¼Œ<code class="fe mn mo mp ku b"><strong class="jt io">timeit</strong></code> <strong class="jt io">æ˜¯</strong>ç”¨äºæ ‡æ†ä»£ç ã€‚ä»<a class="ae mq" href="https://rbspy.github.io/" rel="noopener ugc nofollow" target="_blank"> rbspy æ–‡æ¡£</a>ä¸­ï¼Œ</p><blockquote class="le lf lg"><p id="b969" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated"><strong class="jt io">åŸºå‡†æµ‹è¯•å‘Šè¯‰ä½ ä½ çš„ä»£ç æœ‰å¤šæ…¢(â€œåš X Y Z èŠ±äº† 20 ç§’â€)ï¼Œå‰–æå™¨å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆæ…¢(â€œ35%çš„æ—¶é—´èŠ±åœ¨å‹ç¼©ä¸Šâ€)</strong></p></blockquote><p id="1fd7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒæ¥æµ‹è¯•æˆ‘ä»¬çš„åŠŸèƒ½:</p><ul class=""><li id="bde0" class="mr ms in jt b ju jv jy jz kc mt kg mu kk mv ko mw mx my mz bi translated">æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ª main/runner å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç”Ÿæˆå™¨ä¹Ÿä¼šå¾—åˆ°è¯„ä¼°</li></ul><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="3653" class="ky kz in ku b be la lb l lc ld">def run(f):<br/>    # f will be one of our functions<br/>    for i in f(x=3, max=1000):<br/>        pass<br/><br/># Example Usage<br/>lambda: run(multiples_of)<br/>lambda: run(gen_multiples_of)</span></pre><ul class=""><li id="039c" class="mr ms in jt b ju jv jy jz kc mt kg mu kk mv ko mw mx my mz bi translated">å¯¼å…¥<code class="fe mn mo mp ku b"><strong class="jt io">timeit</strong></code>åŒ…å¹¶ä½¿ç”¨å®ƒçš„<code class="fe mn mo mp ku b"><strong class="jt io">timeit</strong></code>å‡½æ•°æ¥æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´</li></ul><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="503f" class="ky kz in ku b be la lb l lc ld">import timeit <br/><br/>n = int(1500)<br/>r = timeit.timeit(lambda: run(multiples_of), number=n)<br/>print(f"Iterative Function:, Total Time (for {n} cycles): {r}s, Average time (per cycle) {r/n}s")<br/><br/>r = timeit.timeit(lambda: run(gen_multiples_of), number=n)<br/>print(f"Generator Function:, Total Time (for {n} cycles): {r}s, Average time (per cycle) {r/n}s")</span></pre><p id="7173" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æ ·æœ¬è¾“å‡º:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="e8ca" class="ky kz in ku b be la lb l lc ld">Iterative Function:, Total Time (for 1500 cycles): 0.15279039996676147s, Average time (per cycle) 0.00010186026664450765s<br/>Generator Function:, Total Time (for 1500 cycles): 0.29554930003359914s, Average time (per cycle) 0.0001970328666890661s</span></pre><p id="920c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">çœ‹æ¥è¿­ä»£å‡½æ•°æ¯”ç”Ÿæˆå‡½æ•°å¿«ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºåˆ—è¡¨ç†è§£å’Œ while å¾ªç¯ä¸­çš„å¸¸é‡æ±‚å€¼å—ï¼Ÿæˆ‘ä»¬ä¼šå’Œå¦ä¸€ä¸ªä¾§å†™å‘˜ä¸€èµ·æ·±å…¥è°ƒæŸ¥ã€‚</p><p id="c2d6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æ¥è‡ª<code class="fe mn mo mp ku b"><a class="ae mq" href="https://docs.python.org/3/library/timeit.html#timeit.Timer.timeit" rel="noopener ugc nofollow" target="_blank">Time.timeit()</a></code> <a class="ae mq" href="https://docs.python.org/3/library/timeit.html#timeit.Timer.timeit" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>:</p><blockquote class="le lf lg"><p id="069b" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated">æ—¶é—´<em class="in">æ•°é‡</em>ä¸»è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€‚è¿™å°†æ‰§è¡Œ setup è¯­å¥ä¸€æ¬¡ï¼Œç„¶å<strong class="jt io">è¿”å›å¤šæ¬¡æ‰§è¡Œ main è¯­å¥æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œä»¥æµ®ç‚¹å½¢å¼è®¡ç®—</strong>ã€‚å‚æ•°æ˜¯å¾ªç¯çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸ºä¸€ç™¾ä¸‡æ¬¡ã€‚</p></blockquote><p id="e8fe" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å…³äº<code class="fe mn mo mp ku b"><strong class="jt io">timeit</strong></code>æ¨¡å—çš„æ³¨æ„äº‹é¡¹:</p><ul class=""><li id="cbd5" class="mr ms in jt b ju jv jy jz kc mt kg mu kk mv ko mw mx my mz bi translated">åœ¨æ‰§è¡Œæµ‹è¯•æ—¶ï¼Œåƒåœ¾æ”¶é›†æ¯æ¬¡éƒ½è¢« time()å‡½æ•°ç¦ç”¨ã€‚</li><li id="fabd" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><strong class="jt io">timeit()</strong></code>æ ¹æ®æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå†…éƒ¨é‡‡ç”¨å‡†ç¡®çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå®ƒå°†ä¸º Windows æ“ä½œç³»ç»Ÿä½¿ç”¨ time.clock()ï¼Œä¸º mac å’Œ Linux ä½¿ç”¨ time.time()ã€‚</li><li id="668b" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><strong class="jt io">timeit</strong></code>è¿˜å…¬å¼€äº†ä¸€ä¸ª<a class="ae mq" href="https://docs.python.org/3/library/timeit.html#command-line-interface" rel="noopener ugc nofollow" target="_blank">å‘½ä»¤è¡Œæ¥å£</a>ã€‚</li></ul><h1 id="81b1" class="ll kz in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">cProfile æ¨¡å—</h1><p id="d407" class="pw-post-body-paragraph jr js in jt b ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko ig bi translated">æ¥è‡ªå®˜æ–¹æ–‡ä»¶:</p><blockquote class="le lf lg"><p id="0ff1" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated"><code class="fe mn mo mp ku b"><a class="ae mq" href="https://docs.python.org/3/library/profile.html#module-cProfile" rel="noopener ugc nofollow" target="_blank">cProfile</a></code>æ¨èå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨ï¼›å®ƒæ˜¯ä¸€ä¸ª C æ‰©å±•ï¼Œå…·æœ‰åˆç†çš„å¼€é”€ï¼Œé€‚åˆäºåˆ†æé•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºã€‚</p></blockquote><p id="abc4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe mn mo mp ku b">cProfile</code>æ¨¡å—æ­ç¤ºäº†æ‰§è¡Œç‰¹å®šå‡½æ•°éœ€è¦å¤šé•¿æ—¶é—´ï¼Œä»¥åŠè¯¥å‡½æ•°åœ¨ç¨‹åºä¸­è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚ä¸€ä¸ªä¾‹å­:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="5408" class="ky kz in ku b be la lb l lc ld">import cProfile<br/>cProfile.run("run(multiples_of)")<br/><br/>print("\n\n")<br/><br/>cProfile.run("run(gen_multiples_of)")</span></pre><p id="9dc4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æˆ‘ä»¬å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡º:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="8964" class="ky kz in ku b be la lb l lc ld">6 function calls in 0.119 seconds<br/><br/>Ordered by: standard name<br/><br/>   ncalls  tottime  percall  cumtime  percall filename:lineno(function)<br/>        1    0.000    0.000    0.119    0.119 &lt;string&gt;:1(&lt;module&gt;)<br/>        1    0.106    0.106    0.106    0.106 euler-1.py:12(&lt;listcomp&gt;)<br/>        1    0.013    0.013    0.119    0.119 euler-1.py:30(run)<br/>        1    0.000    0.000    0.106    0.106 euler-1.py:4(multiples_of)<br/>        1    0.000    0.000    0.119    0.119 {built-in method builtins.exec}<br/>        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}<br/><br/><br/><br/><br/><br/>333338 function calls in 0.415 seconds<br/><br/>Ordered by: standard name<br/><br/>   ncalls  tottime  percall  cumtime  percall filename:lineno(function)<br/>        1    0.000    0.000    0.415    0.415 &lt;string&gt;:1(&lt;module&gt;)<br/>   333334    0.266    0.000    0.266    0.000 euler-1.py:15(gen_multiples_of)<br/>        1    0.149    0.149    0.415    0.415 euler-1.py:30(run)<br/>        1    0.000    0.000    0.415    0.415 {built-in method builtins.exec}<br/>        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}</span></pre><p id="a6f8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">è¿™æ„å‘³ç€ä»€ä¹ˆ(ç›´æ¥æ¥è‡ªæ–‡æ¡£):</p><ul class=""><li id="79be" class="mr ms in jt b ju jv jy jz kc mt kg mu kk mv ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">ncalls</em></code>:å¯¹äºé€šè¯æ¬¡æ•°ï¼Œ</li><li id="e356" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">tottime</em></code>:ç»™å®šå‡½æ•°èŠ±è´¹çš„æ€»æ—¶é—´(ä¸åŒ…æ‹¬è°ƒç”¨å­å‡½æ•°çš„æ—¶é—´)</li><li id="6004" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">percall</em></code>:æ˜¯<code class="fe mn mo mp ku b">tottime</code>çš„å•†é™¤ä»¥<code class="fe mn mo mp ku b">ncalls</code></li><li id="b804" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">cumtime</em></code>:è¯¥å­åŠŸèƒ½å’Œæ‰€æœ‰å­åŠŸèƒ½çš„ç´¯è®¡æ—¶é—´(ä»è°ƒç”¨åˆ°é€€å‡º)ã€‚è¿™ä¸ªæ•°å­—å¯¹äºé€’å½’å‡½æ•°æ¥è¯´æ˜¯ç²¾ç¡®çš„<em class="lh">ç”šè‡³</em>ã€‚</li><li id="272d" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">percall</em></code> : <em class="lh"> </em>æ˜¯<code class="fe mn mo mp ku b">cumtime</code>é™¤ä»¥åŸå§‹è°ƒç”¨çš„å•†</li><li id="9057" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated"><code class="fe mn mo mp ku b"><em class="lh">filename</em></code> : lineno(function)æä¾›å„åŠŸèƒ½å„è‡ªçš„æ•°æ®ä»¥ä¾›è¯†åˆ«ã€‚</li></ul><p id="2234" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä»æˆ‘ä»¬çš„ç»“æœæ¥çœ‹ï¼Œå¾ˆæ˜æ˜¾ï¼Œç”Ÿæˆå™¨å‡½æ•°æœ¬èº«å¹¶ä¸éœ€è¦å¾ˆé•¿æ—¶é—´æ¥æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºå®ƒè¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡(æ¯”<code class="fe mn mo mp ku b">10^5</code>æ›´å¤š)ï¼Œæ‰€ä»¥æ•´ä½“æ‰§è¡Œç›¸å½“æ…¢ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ä¸€æ¬¡è¿­ä»£å‡½æ•°ï¼Œå°±èƒ½åœ¨ 50%çš„æ—¶é—´å†…å®Œæˆã€‚å½“æˆ‘ä»¬å¤„ç†ç›¸å¯¹è¾ƒå¤§çš„æ•°æ®é›†æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤ªå¤šçš„å€¼æ— æ³•æ”¾å…¥å†…å­˜ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°ã€‚è¿™é‡Œçš„æƒè¡¡å˜å¾—å¾ˆæ˜æ˜¾ã€‚</p><p id="452f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å…³äº cProfile éœ€è¦æ³¨æ„çš„äº‹é¡¹:</p><ul class=""><li id="7842" class="mr ms in jt b ju jv jy jz kc mt kg mu kk mv ko mw mx my mz bi translated">æ‚¨å¯ä»¥æ ¹æ®æ‰§è¡Œæ—¶é—´ã€å‡½æ•°åã€è°ƒç”¨æ¬¡æ•°ç­‰å¯¹åˆ†æç»“æœè¿›è¡Œæ’åºã€‚</li><li id="18d2" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated">å¯ä»¥ä½¿ç”¨<code class="fe mn mo mp ku b"><a class="ae mq" href="https://docs.python.org/3/library/profile.html#the-stats-class" rel="noopener ugc nofollow" target="_blank"><em class="lh">pstats</em></a></code> <a class="ae mq" href="https://docs.python.org/3/library/profile.html#the-stats-class" rel="noopener ugc nofollow" target="_blank"> <em class="lh"> </em>åŒ…</a>å¯¹æ‰§è¡Œæ¦‚è¦æ–‡ä»¶è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚</li><li id="f9a3" class="mr ms in jt b ju na jy nb kc nc kg nd kk ne ko mw mx my mz bi translated">cProfile æœ‰ä¸€ä¸ª<a class="ae mq" href="https://docs.python.org/3/library/profile.html#instant-user-s-manual" rel="noopener ugc nofollow" target="_blank">å‘½ä»¤è¡Œæ¥å£</a> (CLI)ä»¥æ–¹ä¾¿ä½¿ç”¨ã€‚</li></ul><h1 id="02bc" class="ll kz in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">å¯è§†åŒ–ä¸ªäººèµ„æ–™ç»Ÿè®¡(SnakeViz)</h1><blockquote class="le lf lg"><p id="45c9" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated">SnakeViz æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„å›¾å½¢æŸ¥çœ‹å™¨ï¼Œç”¨äº Python çš„<a class="ae mq" href="https://docs.python.org/3/library/profile.html#module-cProfile" rel="noopener ugc nofollow" target="_blank"> cProfile </a>æ¨¡å—çš„è¾“å‡ºï¼Œæ˜¯ä½¿ç”¨æ ‡å‡†åº“<code class="fe mn mo mp ku b"><a class="ae mq" href="https://docs.python.org/3/library/profile.html#module-pstats" rel="noopener ugc nofollow" target="_blank">pstats</a></code> <a class="ae mq" href="https://docs.python.org/3/library/profile.html#module-pstats" rel="noopener ugc nofollow" target="_blank">æ¨¡å—</a>çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p></blockquote><p id="789f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å¼€å§‹å®‰è£… snakeviz</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="84c9" class="ky kz in ku b be la lb l lc ld">pip install snakeviz</span></pre><p id="d8e1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å‰–ææ‚¨çš„ä»£ç å¹¶å°†ç»Ÿè®¡æ•°æ®è½¬å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="24a7" class="ky kz in ku b be la lb l lc ld">import cProfile<br/>pr = cProfile.Profile()<br/>pr.enable()<br/>run(multiples_of)<br/>pr.disable()<br/>pr.dump_stats("multiples_of.prof")<br/><br/>pr = cProfile.Profile()<br/>pr.enable()<br/>run(gen_multiples_of)<br/>pr.disable()<br/>pr.dump_stats("gen_multiples_of.prof")</span></pre><p id="7c9b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–°æ–‡ä»¶ã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨<code class="fe mn mo mp ku b"><strong class="jt io">snakeviz</strong></code>æ¥æŸ¥çœ‹ç»“æœã€‚ä»ä½ çš„ç»ˆç«¯è¿è¡Œè¿™ä¸ª</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="b46b" class="ky kz in ku b be la lb l lc ld">snakeviz multiples_of.prof</span></pre><p id="aab4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">SnakeViz å°†ç”Ÿæˆä¸€ä¸ª web æœåŠ¡å™¨(é€šå¸¸åœ¨<a class="ae mq" href="http://127.0.0.1:8080/snakeviz/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8080/SnakeViz/</a>)ï¼Œä»¥å›¾è¡¨çš„å½¢å¼æ˜¾ç¤ºæ‚¨çš„ä¸ªäººèµ„æ–™ç»“æœã€‚åœ¨å‡½æ•°ä¸­èŠ±è´¹çš„æ—¶é—´éƒ¨åˆ†ç”±å¯è§†åŒ–å…ƒç´ çš„èŒƒå›´è¡¨ç¤ºï¼Œå¯ä»¥æ˜¯çŸ©å½¢çš„å®½åº¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼§çš„è§’åº¦èŒƒå›´ï¼Œå…·ä½“å–å†³äºæ‚¨é€‰æ‹©çš„å¯è§†åŒ–æ ·å¼ã€‚</p><h1 id="2887" class="ll kz in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Yappi:åˆ†æå¹¶å‘å’Œå¤šçº¿ç¨‹ç¨‹åº</h1><p id="0bbd" class="pw-post-body-paragraph jr js in jt b ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko ig bi translated">æ ‡å‡†çš„åˆ†æå™¨ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å¹¶å‘å’Œå¤šçº¿ç¨‹ç¨‹åºã€‚ä¸€ä¸ªç¤ºä¾‹ç¨‹åº:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="9526" class="ky kz in ku b be la lb l lc ld">import asyncio<br/><br/>async def waste_a_lot_time():<br/>    await asyncio.sleep(5)<br/><br/>async def do_something_else():<br/>    print("Hello")<br/>    <br/>async def main():<br/>    tasks = asyncio.gather(<br/>        waste_a_lot_time(),<br/>        do_something_else()<br/>        )<br/>    await tasks<br/>    <br/><br/>asyncio.run(main())</span></pre><p id="04f9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å¦‚æœæˆ‘ä»¬ç”¨ cProfile æ¥åˆ†æè¿™æ®µä»£ç ï¼Œå®ƒå°†ä¸èƒ½è¯†åˆ«å‡º<code class="fe mn mo mp ku b">waste_a_lot_time</code>æ˜¯ä¸€ä¸ªç“¶é¢ˆã€‚æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†çš„åˆ†æå™¨æ˜¯ä¸ºäº†å¤„ç†å¹¶å‘è€Œæ„å»ºçš„ï¼Œé™¤éå¼€å‘äººå‘˜è¿›è¡Œä¸€äº›æ¨¡æ‹Ÿä¿®è¡¥ã€‚è¿™å°±æ˜¯ Yappi çš„ç”¨æ­¦ä¹‹åœ°</p><blockquote class="le lf lg"><p id="4ab1" class="jr js lh jt b ju jv jw jx jy jz ka kb li kd ke kf lj kh ki kj lk kl km kn ko ig bi translated">yappi 1.2 ç‰ˆå¼•å…¥äº†<code class="fe mn mo mp ku b">coroutine profiling</code>çš„æ¦‚å¿µã€‚ä½¿ç”¨<code class="fe mn mo mp ku b">coroutine-profiling</code>ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåˆ†ææ­£ç¡®çš„å¢™/cpu æ—¶é—´å’Œåç¨‹çš„è°ƒç”¨æ¬¡æ•°ã€‚(ä¹ŸåŒ…æ‹¬èŠ±è´¹åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šçš„æ—¶é—´)ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ç»†èŠ‚<a class="ae mq" href="https://github.com/sumerc/yappi/blob/master/doc/coroutine-profiling.md" rel="noopener ugc nofollow" target="_blank"/>ã€‚</p></blockquote><p id="354b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å®‰è£…<code class="fe mn mo mp ku b"><strong class="jt io">yappi</strong></code>ä¸</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="2497" class="ky kz in ku b be la lb l lc ld">pip install yappi</span></pre><p id="8423" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æˆ‘ä»¬å°†ä¿®æ”¹ä¹‹å‰çš„è„šæœ¬:</p><pre class="kp kq kr ks gt kt ku kv bn kw kx bi"><span id="7e81" class="ky kz in ku b be la lb l lc ld">import yappi<br/>import asyncio<br/><br/>async def waste_a_lot_time():<br/>    await asyncio.sleep(5)<br/><br/>async def do_something_else():<br/>    print("Hello")<br/>    <br/>async def main():<br/>    tasks = asyncio.gather(<br/>        waste_a_lot_time(),<br/>        do_something_else()<br/>        )<br/>    await tasks<br/>    <br/>yappi.set_clock_type("wall") # Measure the absolute time taken<br/>yappi.start() # Start profiling/watching<br/><br/>asyncio.run(main())<br/><br/>stats = yappi.get_func_stats() # Get the stats for function calls<br/>stats.sort("ttot") # Sort it by total time<br/>stats.print_all() # Print it all out</span></pre><p id="c654" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code class="fe mn mo mp ku b"><strong class="jt io">main</strong></code>å ç”¨äº†å¾ˆå¤šæ—¶é—´ï¼Œè€Œ<code class="fe mn mo mp ku b"><strong class="jt io">waste_a_lot_time</strong></code>å°±æ˜¯è´Ÿè´£è¿™ä¸ªçš„å‡½æ•°ã€‚</p><p id="92c6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">è¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹ã€‚æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¯¹ Python è„šæœ¬è¿›è¡ŒåŸºå‡†æµ‹è¯•å’Œå‰–æï¼Œå¹¶æ ¹æ®æˆ‘ä»¬çš„ç»“æœåšå‡ºä¸šåŠ¡å†³ç­–ã€‚</p><blockquote class="nf"><p id="e4ce" class="ng nh in bd ni nj nk nl nm nn no ko dk translated">æ„Ÿè°¢é˜…è¯»ï¼æ•¬è¯·è®¢é˜…æ›´å¤šğŸ™‚</p></blockquote><h1 id="b59f" class="ll kz in bd lm ln lo lp lq lr ls lt lu lv np lx ly lz nq mb mc md nr mf mg mh bi translated">é¢å¤–èµ„æº</h1><p id="4450" class="pw-post-body-paragraph jr js in jt b ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko ig bi translated"><a class="ae mq" href="https://machinelearningmastery.com/profiling-python-code" rel="noopener ugc nofollow" target="_blank">https://machinelearningmastery.com/profiling-python-code</a></p><div class="ns nt gp gr nu nv"><a href="https://docs.python.org/3/library/timeit.html" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">time itâ€”â€”æµ‹é‡å°ä»£ç ç‰‡æ®µçš„æ‰§è¡Œæ—¶é—´</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">æºä»£ç :Lib/timeit.py è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥ä¸ºå°éƒ¨åˆ† Python ä»£ç è®¡æ—¶ã€‚å®ƒæ—¢æœ‰â€¦</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">docs.python.org</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jp nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://docs.python.org/3/library/profile.html" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">Python åˆ†æå™¨</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">æºä»£ç :Lib/profile.py å’Œ Lib/pstats.pyï¼Œå¹¶æä¾› Python ç¨‹åºçš„ç¡®å®šæ€§åˆ†æã€‚é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªâ€¦</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">docs.python.org</p></div></div><div class="oe l"><div class="ok l og oh oi oe oj jp nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://jiffyclub.github.io/snakeviz/" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">SnakeViz</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">SnakeViz æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„å›¾å½¢æŸ¥çœ‹å™¨ï¼Œç”¨äº Python çš„ cProfile æ¨¡å—çš„è¾“å‡ºï¼Œæ˜¯ä½¿ç”¨â€¦</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">jiffyclub.github.io</p></div></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://github.com/sumerc/yappi/" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">GitHub - sumerc/yappi:åˆä¸€ä¸ª Python åˆ†æå™¨ï¼Œä½†è¿™æ¬¡æ˜¯å¤šçº¿ç¨‹ã€asyncio å’Œâ€¦</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">ä¸€ä¸ªæ”¯æŒå¤šçº¿ç¨‹ã€asyncio å’Œ gevent çš„è·Ÿè¸ªåˆ†æå™¨ã€‚å¿«:Yappi å¿«ã€‚å®ƒå®Œå…¨æ˜¯ç”¨ C è¯­è¨€å†™çš„â€¦</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="ol l og oh oi oe oj jp nv"/></div></div></a></div></div></div>    
</body>
</html>