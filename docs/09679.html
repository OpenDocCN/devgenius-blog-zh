<html>
<head>
<title>Graph Modeling in PySpark using GraphFrames: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 GraphFrames 在 PySpark 中进行图形建模:第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/graph-modeling-in-pyspark-using-graphframes-part-1-e7cb42099182?source=collection_archive---------1-----------------------#2022-09-05">https://blog.devgenius.io/graph-modeling-in-pyspark-using-graphframes-part-1-e7cb42099182?source=collection_archive---------1-----------------------#2022-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2dc3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将是一个多部分的教程，在其中我将演示图形框架的使用。</p><p id="6833" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本系列的第 1 部分中，我们将了解:</p><ol class=""><li id="0a93" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">图表框架概述</li><li id="944d" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">在我们的机器上设置图表框架。</li><li id="8580" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">创建我们的第一个图表并操作它。</li><li id="8bac" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">图形的可视化</li><li id="4364" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">图形中的度数</li></ol><h2 id="b259" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">概观</h2><p id="3d08" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">graph frames<strong class="jm io">是 Apache Spark 的一个包，它提供了基于数据帧的图形</strong>。它提供了 Java、Python 和 Scala 的高级 API。GraphFrames 用于进行图形分析。图形分析<strong class="jm io">使用算法来探索图形数据库中条目之间的关系，包括不同人、交易或组织之间的联系</strong>。</p><p id="f05a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">图是使用边相互连接的顶点的组合。虽然顶点可以被认为是节点或实体，但是边表示这些实体之间的关系。</p><p id="6625" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">图形结构的用例</p><ol class=""><li id="e90a" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">搜索引擎</li><li id="1537" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">社交网络</li><li id="c310" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">欺诈检测</li><li id="06b6" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">人工智能</li></ol><h2 id="9ea2" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">设置图表框架</h2><p id="4bf2" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">在设置 GraphFrames 之前，请确保您遵循了我之前的教程中列出的在 windows 上安装 pyspark 的步骤。</p><p id="332c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lu" href="https://medium.com/data-engineering-on-cloud/pyspark-with-examples-96919b3d1192" rel="noopener">https://medium . com/data-engineering-on-cloud/py spark-with-examples-96919 B3 d 1192</a></p><p id="a8ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请按照以下步骤导入模块-</p><ol class=""><li id="06d9" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">下载“graph frames-0 . 8 . 2-spark 3.0-s _ 2.12”<a class="ae lu" href="https://spark-packages.org/package/graphframes/graphframes" rel="noopener ugc nofollow" target="_blank">https://spark-packages.org/package/graphframes/graphframes</a></li><li id="1621" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">从 graph frames-0 . 8 . 2-spark 3.0-s _ 2.12 中提取 JAR 内容</li><li id="9010" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">导航到“graphframe”目录并压缩其中的内容。<br/> zip graphframes.zip -r *</li><li id="89d3" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">复制压缩文件“graph frames . zip”C:\ spark-3 . 1 . 2-bin-Hadoop 3.2 \ python</li><li id="05f5" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">将 graph frames-0 . 8 . 2-spark 3.0-s _ 2.12 . jar 文件复制到 C:\ spark-3 . 1 . 2-bin-Hadoop 3.2 \ jars 中</li></ol><h2 id="ef3f" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">让我们开始编码吧。</h2><p id="9b6a" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">第一步:启动 jupyter 笔记本</p><p id="edb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">步骤 2:设置环境变量并初始化 spark</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="73c8" class="kw kx in ma b gy me mf l mg mh">import os<br/>import sys<br/>import glob<br/>from os.path import abspath<br/>os.environ['SPARK_HOME'] = 'C:\spark-3.1.2-bin-hadoop3.2'<br/>os.environ['JAVA_HOME'] = 'C:\Program Files\Java\jdk1.8.0_201'<br/>os.environ['HADOOP_HOME'] = 'C:\spark-3.1.2-bin-hadoop3.2'<br/>spark_python = os.path.join(os.environ.get('SPARK_HOME',None),'python')<br/>py4j = glob.glob(os.path.join(spark_python,'lib','py4j-*.zip'))[0]<br/>graphf = glob.glob(os.path.join(spark_python,'graphframes.zip'))[0]<br/>sys.path[:0]=[spark_python,py4j]<br/>sys.path[:0]=[spark_python,graphf]<br/>os.environ['PYTHONPATH']=py4j+os.pathsep+graphf<br/>import findspark<br/>findspark.init()<br/>findspark.find()<br/>from pyspark.sql import SparkSession<br/>spark = SparkSession.builder.appName("Spark Examples").enableHiveSupport().getOrCreate()<br/>from graphframes import *<br/>import networkx as nx<br/>import matplotlib.pyplot as plt</span></pre><p id="839a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">步骤 3:让我们创建两个数据框，顶点数据框和边数据框。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="de87" class="kw kx in ma b gy me mf l mg mh">vertices = spark.createDataFrame([<br/>    ("Alice", 45),<br/>    ("Jacob", 43),<br/>    ("Roy", 21),<br/>    ("Ryan", 49),<br/>    ("Emily", 24),<br/>    ("Sheldon", 52)],<br/>    ["id", "age"]<br/>)</span><span id="d898" class="kw kx in ma b gy mi mf l mg mh">edges = spark.createDataFrame([("Sheldon", "Alice", "Sister"),<br/>                              ("Alice", "Jacob", "Husband"),<br/>                              ("Emily", "Jacob", "Father"),<br/>                              ("Ryan", "Alice", "Friend"),<br/>                              ("Alice", "Emily", "Daughter"),<br/>                              ("Alice", "Roy", "Son"),<br/>                              ("Jacob", "Roy", "Son")],<br/>                             ["src", "dst", "relation"])</span><span id="30f4" class="kw kx in ma b gy mi mf l mg mh">vertices.show()<br/>edges.show()</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/fc6e384d85c6d15a8f52c15903194afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*MFuJ9ZbHQfY7_coVoQEQTg.png"/></div></figure><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/1003d4d82f7a4c2e4ff4e6c101500d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*6jsNY54moML8WLX5x_I05g.png"/></div></figure><p id="496a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下命令创建了您的第一个 GraphFrame。它接受 2 个数据帧作为输入，即顶点和边。</p><p id="0cf3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">需要遵循一些命名约定:</p><ol class=""><li id="ee13" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">表示顶点的 dataframe 应该包含一个名为 id 的列。</li><li id="59de" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">表示边缘的 dataframe 应该包含名为 src 和 dst 的列。</li></ol><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="fa11" class="kw kx in ma b gy me mf l mg mh">family_tree = GraphFrame(vertices, edges)</span></pre><h2 id="6f2f" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">可视化图表</h2><ol class=""><li id="d46d" class="ki kj in jm b jn lp jr lq jv mo jz mp kd mq kh kn ko kp kq bi translated">绘制无向图</li></ol><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="5944" class="kw kx in ma b gy me mf l mg mh"># the function will plot the source and destination nodes and connect them by meand of undirected line<br/>def plot_undirected_graph(edge_list):<br/>    # edge list contains infor,ation about edges which have clear direction<br/>    # hoowever we will diregard the the direction in this function<br/>    # the first thing is to plot the figure<br/>    plt.figure(figsize=(9,9))<br/>    # we instantiate a networkx graoh object.<br/>    # nx. graoh represents an undirected graph.<br/>    gplot=nx.Graph()<br/>    for row in edge_list.select("src", "dst").take(1000):<br/>        gplot.add_edge(row["src"], row["dst"])<br/>    nx.draw(gplot, with_labels=True, font_weight="bold", node_size=3500)</span><span id="c452" class="kw kx in ma b gy mi mf l mg mh">plot_undirected_graph(family_tree.edges)</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/5753448ecf4d6553870cbffeb5570e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*h0tethVkG1yCs7-gm2czaQ.png"/></div></figure><p id="1f97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.有向图</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="c1fb" class="kw kx in ma b gy me mf l mg mh"># the function will plot the source and destination nodes and connect them by meand of undirected line<br/>def plot_directed_graph(edge_list):<br/>    plt.figure(figsize=(9,9))<br/>    gplot=nx.DiGraph()<br/>    edge_labels = {}<br/>    for row in edge_list.select("src", "dst", "relation").take(1000):<br/>        gplot.add_edge(row["src"], row["dst"])<br/>        edge_labels[(row["src"], row["dst"])] = row["relation"]<br/>    pos = nx.spring_layout(gplot)<br/>    nx.draw(gplot, pos, with_labels=True, font_weight="bold", node_size=3500)<br/>    nx.draw_networkx_edge_labels(gplot, pos, edge_labels=edge_labels, font_color="green", font_size=11, font_weight="bold")</span><span id="2bee" class="kw kx in ma b gy mi mf l mg mh">plot_directed_graph(family_tree.edges)</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/011f9f0fcc8f461dff0b6258bcc712a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4flb8VdGiX5MkXudjwlcw.png"/></div></div></figure><h2 id="8233" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">节点的度数</h2><p id="8e49" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">既然我们已经创建了 GraphFrame，理解度是很重要的。</p><p id="c8b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GraphFrames 支持两种类型的度数。</p><ol class=""><li id="a0fc" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">inDegrees:到顶点的传入链接的数量。</li><li id="d95a" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">outDegrees:从一个节点发出的边的数量。</li></ol><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="fef8" class="kw kx in ma b gy me mf l mg mh">tree_degree = family_tree.degrees<br/>tree_degree.show()</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/0c3e148dd873277bb7e780f22feb1e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*O3mGDzAmzCA23U0wVIMkIg.png"/></div></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="2725" class="kw kx in ma b gy me mf l mg mh">degree_edges = edges.filter(("src = 'Alice' or dst = 'Alice'"))<br/>degree_edges.show()</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/037c80687fc1823fc27c6a55d663a01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*RJbFMnQQRsy_J82O5IpGog.png"/></div></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="5401" class="kw kx in ma b gy me mf l mg mh">plot_directed_graph(degree_edges)</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/6192aa79cf601e500e5a319547481da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCLG1b4Y_k6GLFPPNoiJ9w.png"/></div></div></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="844f" class="kw kx in ma b gy me mf l mg mh">tree_inDegree = family_tree.inDegrees<br/>tree_inDegree.show()</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1207a15fe7595272a5e74a180aec8115.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*0NegQuskn2u1aGxJUdqs2Q.png"/></div></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="49b2" class="kw kx in ma b gy me mf l mg mh">indegree_edges = edges.filter(("dst = 'Jacob'"))<br/>plot_directed_graph(indegree_edges)</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/07793e8d22636be5de40c749ac50025a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*4m59E20kC2lBCdZOa1VH_Q.png"/></div></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="c747" class="kw kx in ma b gy me mf l mg mh">tree_outDegree = family_tree.outDegrees<br/>tree_outDegree.show()</span></pre><figure class="lv lw lx ly gt mk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b3bd90df5f6e449515f36dc1a2fbc671.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*VCs_7f5Ggi_4XUFcfSilsw.png"/></div></figure></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><p id="525f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就把我们带到了第 1 部分的结尾，第 1 部分的代码可以在:</p><p id="4b32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lu" href="https://github.com/shorya1996/PySpark/blob/main/GettingStartedWithGraphFramesPart1.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">https://github . com/shorya 1996/PySpark/blob/main/gettingstartedwithgraphframespart 1 . ipynb</strong></a></p><p id="7a47" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">在 Linkedin 上关注我</strong></p><p id="e62c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">领英:</strong><a class="ae lu" href="https://www.linkedin.com/in/shorya-sharma-b94161121/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">https://www.linkedin.com/in/shorya-sharma-b94161121/</strong></a></p></div></div>    
</body>
</html>