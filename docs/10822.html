<html>
<head>
<title>Using AWS CLI to Create EC2 Instance with Nginx Install</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS CLI 创建带有 Nginx 安装的 EC2 实例</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-aws-cli-to-create-ec2-instance-with-nginx-install-75b1510b087?source=collection_archive---------8-----------------------#2022-12-02">https://blog.devgenius.io/using-aws-cli-to-create-ec2-instance-with-nginx-install-75b1510b087?source=collection_archive---------8-----------------------#2022-12-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4f8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如何使用 AWS CLI 和用户数据字段创建 Nginx web 服务器</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/793700af2a65e3a4a16fbc015fe4d511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Drac3VXUw4pLISIzmKIcnQ.png"/></div></div></figure><h1 id="1b57" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">任务:</h1><p id="f589" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我们的目标是使用 Amazon EC2 实例，通过 AWS CLI 启动 Nginx web 服务器。我们将创建一个安全组，并将服务器配置到我们的默认 VPC，安装并启动我们的 web 服务器，而无需登录到它。</p><h1 id="03c3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">要求:</h1><ul class=""><li id="0d3c" class="lx ly in jm b jn ls jr lt jv lz jz ma kd mb kh mc md me mf bi translated">AWS 自由层</li><li id="40b5" class="lx ly in jm b jn mg jr mh jv mi jz mj kd mk kh mc md me mf bi translated">配置 AWS CLI 以供您的帐户使用</li><li id="3602" class="lx ly in jm b jn mg jr mh jv mi jz mj kd mk kh mc md me mf bi translated">尝试</li></ul><h1 id="eb83" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">步骤 1:创建安全组</h1><p id="83df" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">将需要创建一个安全组，以允许来自外部的流量攻击我们的 web 服务器。让我们给它一个名字和描述。我将把它命名为“<strong class="jm io"> allow-web-access </strong>”。</p><pre class="kj kk kl km gt ml mm mn bn mo mp bi"><span id="abe1" class="mq kv in mm b be mr ms l mt mu"><br/>aws ec2 create-security-group --group-name allow-web-access --description 'Allow for inbound traffic to port 80'</span></pre><p id="a2ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果命令成功，您将收到一个用 JSON 编写的响应，注明<strong class="jm io"> GroupID </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/1114fb61c1eeb53c11b8a4fe5d06def0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*3pmb4XXQklrk66iIn3tfWQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">显示带有 GroupID 的响应</figcaption></figure><p id="15f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们需要为组配置规则。我们将创建一个规则，允许从任何 IP 发往 TCP 端口 80 的入站流量。下面是我们将用来为刚刚创建的安全组指定规则的命令。</p><pre class="kj kk kl km gt ml mm mn bn mo mp bi"><span id="cdde" class="mq kv in mm b be mr ms l mt mu">aws ec2 authorize-security-group-ingress --group-name allow-web-access --protocol tcp --port 80 --cidr 0.0.0.0/0</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/beea43f428f7eaac45918f106a4eb8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmrzxGgc9-D0LNEXXGoPOw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">显示成功命令的响应</figcaption></figure><h1 id="296b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">步骤 2:创建 EC2 实例</h1><p id="707a" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">在创建 EC2 实例之前，我们需要收集创建实例所需的信息。首先，让我们看看我们的 AMI 的 ID 是什么。您需要登录到门户来确认您想要的实例的 ID。导航到“<strong class="jm io"> EC2 &gt;实例&gt;启动实例</strong>”，然后选择您想要的图像并记下 ID 和实例类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/b5b6ca98c6284d2fd0703c53cd9f5708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQIycF0TOXNZ0waZy3RGIQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">显示 AMI ID</figcaption></figure><p id="26c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在运行命令创建实例之前，我们需要创建一个 BASH 脚本。这个脚本将用于在初始启动时安装 Ngnix web 服务器。为此，我们将利用“<strong class="jm io">用户数据</strong>”选项。在您的本地机器上创建以下脚本，并将其保存为“<strong class="jm io"> install.sh </strong>”。</p><pre class="kj kk kl km gt ml mm mn bn mo mp bi"><span id="cac4" class="mq kv in mm b be mr ms l nc mu">#!/bin/bash<br/>sudo yum update -y<br/>sudo amazon-linux-extras install nginx1 -y<br/>sudo systemctl start nginx<br/>sudo systemctl enable nginx</span></pre><p id="00ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们运行 AWS CLI 命令来创建实例。</p><pre class="kj kk kl km gt ml mm mn bn mo mp bi"><span id="2e55" class="mq kv in mm b be mr ms l mt mu">aws ec2 run-instances --image-id ami-0b0dcb5067f052a63 --instance-type t2.micro --security-groups allow-web-access --user-data install.sh</span></pre><p id="4e75" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您应该会在控制台中看到我们的新实例。让我们将公共 IP 复制到一个新的浏览器窗口中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/0133dd4d41969284982c0796b1243e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ML5I25dkqEJ2KocvhXnJWQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">显示新实例和公共 IP</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/81e06f7d697968a8dcacba2bc3782331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSDYsgVmZ0fPTrnCdJSkZg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">显示默认网页</figcaption></figure><p id="54c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！</p></div></div>    
</body>
</html>