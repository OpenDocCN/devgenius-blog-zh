<html>
<head>
<title>How to use Floating ui with react</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 react 中使用浮动用户界面</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-floating-ui-with-react-cd605a1410b9?source=collection_archive---------2-----------------------#2022-08-07">https://blog.devgenius.io/how-to-use-floating-ui-with-react-cd605a1410b9?source=collection_archive---------2-----------------------#2022-08-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4a9a169c1bfd6e48882fa2123f918a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-IoQxj-DRrpTCa4Q.png"/></div></div></figure><h1 id="77d1" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">目的</h1><p id="3b8f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">因为我需要在 React 项目中使用浮动用户界面，但是没有太多的资源。所以，我应该做了很多研究。为了帮助你的研究，我将分享我的知识。</p><h1 id="834e" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">什么是浮动 ui？</h1><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="51a0" class="ma jw in lw b gy mb mc l md me">Floating UI is a low-level toolkit to create floating elements. Tooltips, popovers, dropdowns, menus, and more.</span></pre><p id="2970" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">我从官方指南中摘录了以上句子。浮动 ui 最重要的一点是。这个工具包是用来创建浮动元素的，而不是一个包含浮动元素的动画库。换句话说，你可以通过 css 或任何其他库来添加你的动画，但浮动 ui 本身没有。例如，如果你想创建动画淡入模式，你需要自己的动画，没有浮动用户界面。实际上，在官方指南中有一些包含动画的例子，但是这些例子使用的是动画库 framer motion。</p><p id="d325" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">另一方面，就浮动元素而言，这个库非常有用，因为浮动 ui 可以检测元素的移动，并通过点击、滚动、鼠标移动等方式轻松地改变动作。官方指南的首页有几个例子，你可以查看一下。也许你可以自己创建这些浮动项目，但这需要花费很多时间，需要写很多代码，尤其是 css 部分。</p><p id="524c" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">是的，这是创建一些浮动元素的惊人功能。然而，在我看来，没有足够的信息作出反应。有一些教程、例子..但是与普通的 JavaScript 部分相比还不够。你需要用 react 阅读官方文档来创建你的浮动项目。react part 有 ReactDOM 交集，可以用来通过使用 floating-ui 的一些内置自定义钩子(如 useHover、useDismiss)来管理浮动元素的“何时”和“如何”。这比基本浮动更复杂。与交互部分相比，浮动部分通过使用自定义手册“使用浮动”来管理“在哪里”放置元素。</p><p id="22b8" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">好吧，让我们来看一个例子。在这种情况下，我将把重点放在模态部分，因为我很难通过使用这个库来实现这个特性。</p><h1 id="3a5c" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">示例(带反应的模态)</h1><h2 id="0ff0" class="ma jw in bd jx mk ml dn kb mm mn dp kf le mo mp kj li mq mr kn lm ms mt kr mu bi translated">步伐</h2><ol class=""><li id="82d2" class="mv mw in kv b kw kx la lb le mx li my lm mz lq na nb nc nd bi translated">通过创建-反应-应用程序创建一个基本的反应应用程序</li></ol><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="257b" class="ma jw in lw b gy mb mc l md me">npx create-react-app floating-ui // This name is up tp you</span></pre><p id="bb2f" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">2.创建一个“Dialog.js”文件，并编写下面的代码。这段代码显然是必不可少的，因为几乎所有重要的代码都在这段代码中(这段代码主要来自官方指南的例子)。我将解释重要的部分。您可能注意到了，这段代码有两部分。使用浮动部分和使用交互部分。正如我上面提到的，useFloating 是使用“在哪里”放置你的元素，useIntersection 是使用“如何和何时”发生关于你的元素的事件。重要的是，useFloating 基本上是在开放模态的“之前”使用，相反，useIntersection 是在开放模态的“之后”使用。这就是为什么在 useFloating 内部，手动设置 useState open 在带有子元素和 props 的 clone 元素内部使用 useInteraction 的 getReferenceProps 打开 modal。开放模态部分显然“先于”开放部分，所以这是一个 useFloating 的角色，而不是 useInteraction。useInteraction 部分比 useFloating 部分简单，因为 useIntersections 有更有意义的名称(useClick、useRole、useDismiss、FloatingPortal、FloatingOverlay、FloatingFocusManager)，它们只是管理关于模态的“如何和何时”。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="4b7b" class="ma jw in lw b gy mb mc l md me">// Dialog.js</span><span id="6308" class="ma jw in lw b gy ne mc l md me">import "./Dialog.css";<br/></span><span id="aaa3" class="ma jw in lw b gy ne mc l md me">import React, { cloneElement, useState } from "react";<br/></span><span id="8e0a" class="ma jw in lw b gy ne mc l md me">import {<br/>  useFloating,<br/>  useInteractions,<br/>  useClick,<br/>  useRole,<br/>  useDismiss,<br/>  useId,<br/>  FloatingPortal,<br/>  FloatingOverlay,<br/>  FloatingFocusManager,<br/>} from "@floating-ui/react-dom-interactions";<br/></span><span id="c67f" class="ma jw in lw b gy ne mc l md me">const Dialog = ({ render, open: passedOpen = false, children }) =&gt; {<br/>  const [open, setOpen] = useState(passedOpen);<br/></span><span id="239b" class="ma jw in lw b gy ne mc l md me">  const { reference, floating, context } = useFloating({<br/>    open,<br/>    onOpenChange: setOpen,<br/>  });<br/></span><span id="8363" class="ma jw in lw b gy ne mc l md me">  const id = useId();<br/>  const labelId = `${id}-label`;<br/>  const descriptionId = `${id}-description`;<br/></span><span id="891f" class="ma jw in lw b gy ne mc l md me">  const { getReferenceProps, getFloatingProps } = useInteractions([<br/>    useClick(context),<br/>    useRole(context),<br/>    useDismiss(context),<br/>  ]);<br/></span><span id="eb74" class="ma jw in lw b gy ne mc l md me">  return (<br/>    &lt;&gt;<br/>      {cloneElement(<br/>        children,<br/>        getReferenceProps({ ref: reference, ...children.props })<br/>      )}<br/>      &lt;FloatingPortal&gt;<br/>        {open &amp;&amp; (<br/>          &lt;FloatingOverlay<br/>            lockScroll<br/>            style={{<br/>              display: "grid",<br/>              placeItems: "center",<br/>              background: "rgba(25, 25, 25, 0.8)",<br/>            }}<br/>          &gt;<br/>            &lt;FloatingFocusManager context={context}&gt;<br/>              &lt;div<br/>                {...getFloatingProps({<br/>                  ref: floating,<br/>                  className: "Dialog",<br/>                  "aria-labelledby": labelId,<br/>                  "aria-describedby": descriptionId,<br/>                })}<br/>              &gt;<br/>                {render({<br/>                  close: () =&gt; setOpen(false),<br/>                  labelId,<br/>                  descriptionId,<br/>                })}<br/>              &lt;/div&gt;<br/>            &lt;/FloatingFocusManager&gt;<br/>          &lt;/FloatingOverlay&gt;<br/>        )}<br/>      &lt;/FloatingPortal&gt;<br/>    &lt;/&gt;<br/>  );<br/>};<br/></span><span id="5380" class="ma jw in lw b gy ne mc l md me">export default Dialog</span></pre><p id="813e" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">3.创建 Dialog.css 文件并对其进行自定义。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="725b" class="ma jw in lw b gy mb mc l md me">// Dialog.css</span><span id="7eea" class="ma jw in lw b gy ne mc l md me">.Dialog {<br/>  background: white;<br/>  color: black;<br/>  padding: 15px;<br/>  border-radius: 6px;<br/>  margin: 0 15px;<br/>}</span></pre><p id="e13f" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">4.导入 Dialog.js 文件，如下所示使用它。请注意，当您在步骤 2 中编写代码 cloneElement 和带有道具的子元素时。因此，您可以使用触发器(如按钮)作为对话框的子对话框，而无需 onClick。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="4043" class="ma jw in lw b gy mb mc l md me">// App.js</span><span id="44f4" class="ma jw in lw b gy ne mc l md me">import "./App.css";<br/>import Dialog from "./Dialog";<br/></span><span id="ed8d" class="ma jw in lw b gy ne mc l md me">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h1&gt;Floating UI Modal Dialog&lt;/h1&gt;<br/>      &lt;Dialog<br/>        render={({ close, labelId, descriptionId }) =&gt; (<br/>          &lt;&gt;<br/>            &lt;h1 id={labelId}&gt;This is a dialog!&lt;/h1&gt;<br/>            &lt;p id={descriptionId}&gt;<br/>              Now that we've got your attention, you can close this.<br/>            &lt;/p&gt;<br/>            &lt;button onClick={close}&gt;Close&lt;/button&gt;<br/>          &lt;/&gt;<br/>        )}<br/>      &gt;<br/>        &lt;button&gt;Open dialog&lt;/button&gt;<br/>      &lt;/Dialog&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ecca" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">5.下面是屏幕。这是预期的工作</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b4aa78816fd69179582c474c6818a04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*iQjX3aaC6DePv_-Z.gif"/></div></figure><p id="2894" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">好了，你完成了基础部分。所以，我会用 Q 和 a 解释更多关于模态的其他需求。</p><h1 id="dbcd" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">问和一部分</h1><p id="b211" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">当我们想用这个模态滚动时，我们应该怎么做？</p><p id="ff0f" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">A.如果你移除了 FloatingOverlay 里面的锁屏属性，你可以用模态来滚动你的应用。正如你可能知道的，叠加的背景是通过浮动叠加来管理的，所以如果你调整背景样式或删除它，你可以清楚地看到滚动的背景。</p><p id="181c" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">拆下锁头</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="e650" class="ma jw in lw b gy mb mc l md me">&lt;FloatingOverlay<br/>            // lockScroll<br/>            style={{<br/>              display: "grid",<br/>              placeItems: "center",<br/>              background: "rgba(25, 25, 25, 0.8)",<br/>            }}<br/>          &gt;</span></pre><p id="1318" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">屏幕</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1ff0d770a8cb67817c6bf520d7f13047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*_kbqpXgtbizz4Byn.gif"/></div></figure><p id="3062" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">问:我们如何放置这个情态动词的具体位置(右，左，左下…)？</p><p id="911f" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">A.目前我在 FloatingOverlay 设置了“placeItem: center”，所以如果你想设置“左上”，可以用“placeItem: start”，如果你想设置“右下”，可以用“placeItem: end”(这只是一个 css)。但是如果你想把这个模态放在一个特定的位置，你需要在你的 Dialog.css 中使用 place 比如“bottom: 3%”和“position: absolute”来设置一个精确的位置</p><p id="5238" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">移除显示网格并放置项目</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="852d" class="ma jw in lw b gy mb mc l md me">&lt;FloatingOverlay<br/>            lockScroll<br/>            style={{<br/>              // display: "grid",<br/>              // placeItems: "center",<br/>              background: "rgba(25, 25, 25, 0.8)",<br/>            }}<br/>          &gt;</span></pre><p id="8147" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">并添加 DIsplay.css</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="ff5f" class="ma jw in lw b gy mb mc l md me">.Dialog {<br/>  position: absolute; // Add<br/>  bottom: 3%; // Add<br/>  right: 3%; // Add<br/>  background: white;<br/>  color: black;<br/>  padding: 15px;<br/>  border-radius: 6px;<br/>  margin: 0 15px;<br/>}</span></pre><p id="27ab" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">屏幕</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/c8b0fc30270e84e20c753d1c19a6886c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*pi-1EdZNF_emH9Vm.gif"/></div></figure><p id="d681" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">问:我们如何在这个对话框中使用“useRef ”?它不起作用。</p><p id="5589" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">A.您需要在您的外部触发器上添加“div”或任何其他标签，因为浮动 ui 在您的最外部标签中添加了 aria-expand 和 aria-haspopup 属性。这就是为什么你需要添加它。</p><p id="a968" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">像下面这样添加 useRef 和 handler。不要忘记添加外部 div 和内部 ref，否则您的代码将无法运行。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="4a64" class="ma jw in lw b gy mb mc l md me">// App.js</span><span id="e9e6" class="ma jw in lw b gy ne mc l md me">import { useRef } from "react";<br/>import "./App.css";<br/>import Dialog from "./Dialog";<br/></span><span id="2383" class="ma jw in lw b gy ne mc l md me">function App() {<br/>  const dialogRef = useRef(null);<br/>  const handleDialogRef = () =&gt; {<br/>    dialogRef.current.click();<br/>  };<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h1&gt;Floating UI Modal Dialog&lt;/h1&gt;<br/>      &lt;Dialog<br/>        render={({ close, labelId, descriptionId }) =&gt; (<br/>          &lt;&gt;<br/>            &lt;h1 id={labelId}&gt;This is a dialog!&lt;/h1&gt;<br/>            &lt;p id={descriptionId}&gt;<br/>              Now that we've got your attention, you can close this.<br/>            &lt;/p&gt;<br/>            &lt;button onClick={close}&gt;Close&lt;/button&gt;<br/>          &lt;/&gt;<br/>        )}<br/>      &gt;<br/>        &lt;div&gt; // most important part to add<br/>          &lt;button ref={dialogRef}&gt;Open dialog&lt;/button&gt; // add ref here<br/>        &lt;/div&gt;<br/>      &lt;/Dialog&gt;<br/>      &lt;button onClick={handleDialogRef}&gt;Open dialog by Ref&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}<br/></span><span id="0925" class="ma jw in lw b gy ne mc l md me">export default App</span></pre><p id="f3dd" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">屏幕。Ref 工作正常。厉害！</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/7572a560fc7c3535eec6346eb820e053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*k0qUxkw5Qx-zET8z.gif"/></div></figure><h1 id="5763" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="0ece" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">浮动 ui 对于管理你的浮动元素非常有用，所以如果你想灵活的使用你的浮动元素，你可以选择浮动 UI！！</p><h1 id="48b0" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">参考</h1><ul class=""><li id="0526" class="mv mw in kv b kw kx la lb le mx li my lm mz lq ng nb nc nd bi translated">官方文件:<a class="ae nh" href="https://floating-ui.com/" rel="noopener ugc nofollow" target="_blank">https://floating-ui.com/</a></li></ul><p id="1ef4" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">感谢您的阅读！！</p></div></div>    
</body>
</html>