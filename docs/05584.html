<html>
<head>
<title>SSH: What not to do?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宋承宪:不要做什么？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ssh-what-not-to-do-92c266ca430f?source=collection_archive---------9-----------------------#2021-09-12">https://blog.devgenius.io/ssh-what-not-to-do-92c266ca430f?source=collection_archive---------9-----------------------#2021-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e0e691f7fc2f4394f7688e2abd7fa5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOa65EytjeRcMmkDKlpQ9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">远程登录变得简单</figcaption></figure><p id="0a83" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">等级——初学者</strong></p><p id="29e4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">连接到远程服务器的最传统的协议— <strong class="kb io"> SSH(安全外壳)</strong>通过internet/intranet上的不安全网络提供安全连接。SSH使用端口<strong class="kb io"> 22 </strong>，它既是一个<a class="ae kx" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> TCP </strong> </a>又是一个<a class="ae kx" href="https://en.wikipedia.org/wiki/User_Datagram_Protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> UDP </strong> </a>端口。</p><p id="b62b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SSH通常用在以下用例中，用于调试生产/非生产服务器、传输文件和远程代码执行。对于高级用例，ssh可以用于<a class="ae kx" href="https://en.wikipedia.org/wiki/Tunneling_protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">隧道</strong> </a>和<strong class="kb io"> </strong> <a class="ae kx" href="https://en.wikipedia.org/wiki/Port_forwarding" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">端口转发</strong> </a> <strong class="kb io"> </strong>用例(我们可能会在后面的博客中讨论)</p><p id="c55a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">该命令可以在两种模式下运行:</p><p id="6f9b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">i) <strong class="kb io">密码- </strong>用户需要使用<strong class="kb io"> -S </strong>选项输入他/她的密码。这通常不是首选选项，因为可能会将密码暴露为<strong class="kb io">明文</strong>。</p><p id="fac8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ii) <strong class="kb io">无密码- </strong>在这种方法中，用户必须通过密钥而不是密码来验证远程服务器。使用的认证机制是<strong class="kb io">非对称</strong>，其中任一用户将他/她的公钥上传到<strong class="kb io"> ~/。</strong> <strong class="kb io">远程服务器上的ssh/authorized_keys </strong>文件夹或者使用一个公钥，该公钥一般由云厂商发布，如<strong class="kb io"> AWS、Azure、GCP </strong>等。</p><p id="3afc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个博客主要讨论初学者在尝试使用ssh时可能出现的常见故障排除错误:</p><p id="83f3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">使用-v选项运行时，日志可以帮助您更好地调试命令:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="a0ba" class="lh li in ld b gy lj lk l ll lm"><strong class="ld io">ssh</strong> -v -i <strong class="ld io"> keyfile-name &lt;user-name&gt;@Public-IP</strong></span></pre><p id="2e85" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">i) <strong class="kb io">关键文件权限问题:</strong>默认情况下，当您从云提供商下载<strong class="kb io"> pem </strong>文件时，该文件上的文件权限是打开的(<strong class="kb io"> 0644 </strong>)。如果您尝试使用相同级别的密钥权限直接ssh，您可能会得到以下错误。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ln"><img src="../Images/843aa3228a89dfe9c27dda119d901117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSKTzGJS3AzUCSn066gNOA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><strong class="bd lo">具有打开文件权限的密钥文件</strong></figcaption></figure><p id="3fee" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要解决此问题，密钥文件所需的最低权限是400，修复该问题的命令是:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="f2f4" class="lh li in ld b gy lj lk l ll lm"><strong class="ld io"><em class="lp">chmod 400 &lt;key-filename&gt;.pem</em></strong></span></pre><p id="6365" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ii) <strong class="kb io">远程服务器上的authorized_key缺少公钥:</strong>由于ssh工作在非对称认证上，在这种情况下，文件<em class="lp"> ~/。ssh/authorized_keys </em> <strong class="kb io"> </strong>在远程服务器上损坏或者公钥丢失，您可能会得到以下错误</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/c396dbceb7a6646ecc6ca3579d04ba2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6-GD0qIYJVnp_grElPOIA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><strong class="bd lo">没有更多的验证方法可以尝试</strong></figcaption></figure><p id="58f5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">iii) <strong class="kb io">客户端服务器上ssh私有密钥的定制路径:</strong>与远程服务器一样，密钥可能在本地客户端(即您的<strong class="kb io"> mac/linux </strong>中丢失，或者出现在默认定制路径之外的其他位置。错误将与ii)中的相同，但是，要修复相同的错误，请使用以下命令</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="66ac" class="lh li in ld b gy lj lk l ll lm"><strong class="ld io">ssh</strong> -i <strong class="ld io">/</strong>path<strong class="ld io">/</strong>to<strong class="ld io">/</strong>id_rsa user<strong class="ld io">@</strong>server.nixcraft.com</span></pre><p id="f37a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">iv) <strong class="kb io">其他常见错误:</strong></p><p id="0d15" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">位于(<strong class="kb io">/Users/&lt;local-MAC-account/)的<strong class="kb io"> known_hosts </strong>文件。ssh/ </strong>)可能不包含您尝试连接的主机IP的条目。尝试查找与下面类似的条目，以查找试图ssh到的IP</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/f3571339ddded75b992631d9d3f0faf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7ckHUgyqreD-EJfd-fICA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><strong class="bd lo">已知主机文件中的主机IP条目</strong></figcaption></figure><p id="8ce9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意:<a class="ae kx" href="https://en.wikipedia.org/wiki/Secure_copy_protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> scp </strong> </a>命令的工作方式类似于ssh命令，其中的大多数错误也可以在那里使用。</p></div></div>    
</body>
</html>