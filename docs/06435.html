<html>
<head>
<title>Horizontal Scalability Using EC2 Auto Scaling Groups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EC2自动扩展组的水平可扩展性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/horizontal-scalability-using-ec2-auto-scaling-groups-c15f9eb63a58?source=collection_archive---------6-----------------------#2022-01-07">https://blog.devgenius.io/horizontal-scalability-using-ec2-auto-scaling-groups-c15f9eb63a58?source=collection_archive---------6-----------------------#2022-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c800" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“水平可扩展”系统可以通过向系统添加更多机器来增加容量，因此使用“水平”一词。这与“垂直可伸缩”系统形成对比，后者只能在一台计算机上运行其进程；在这样的系统中，提高性能的唯一方法是以更快(或更多)的CPU、<a class="ae ki" href="https://wa.aws.amazon.com/wellarchitected/2020-07-02T19-33-23/wat.concept.memory.en.html" rel="noopener ugc nofollow" target="_blank">内存</a>或存储的形式在一台计算机中添加更多的资源。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f1e5937650fa97ec59605313f34d64a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucZl_wC4GpUTFM1dGj9A1g.png"/></div></div></figure><p id="0da5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过支持并行执行<a class="ae ki" href="https://wa.aws.amazon.com/wellarchitected/2020-07-02T19-33-23/wat.concept.workload.en.html" rel="noopener ugc nofollow" target="_blank">工作负载</a>并将它们分布在许多不同的计算机上，水平可扩展系统的表现通常优于垂直可扩展系统。让我们更详细地理解这一点。</p><p id="53c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设我们有一个运行在单台机器上的web服务，它接受一个请求，对它执行CPU密集型计算，并以一个结果作为响应。现在想象一下，几千个这样的请求同时被发送到这个web服务，你认为会发生什么？</p><p id="a46c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你认为机器变得很慢，没有反应，那么你是正确的。我们该如何应对？</p><p id="1a12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一种解决方案是在不同的机器上托管我们的web服务的几个实例，并在它们前面部署一个负载平衡器。在本文中，我们将学习在AWS上配置自动伸缩组，以根据其中一台机器的平均CPU利用率指标部署额外的实例，作为概念验证。</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="305d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">创建自动缩放组</strong></p><ol class=""><li id="5f73" class="lc ld in jm b jn jo jr js jv le jz lf kd lg kh lh li lj lk bi translated">访问此<a class="ae ki" href="https://ap-south-1.console.aws.amazon.com/ec2autoscaling" rel="noopener ugc nofollow" target="_blank">链接</a>并点击“创建自动缩放组”。</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b578bf9eb07f0b9c768b37fd36fd5b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KyOMnfDaj0Zsucyp11ruKg.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">创建自动缩放组。</figcaption></figure><p id="2de4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.输入自动缩放组的名称，并创建启动模板或配置。在本文中，我们将创建一个启动配置。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lp"><img src="../Images/43f5847add641ba434a09985680a9f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1NwEQZQwVUqGiue1nSbdQ.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">正在创建启动配置</figcaption></figure><p id="34eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的步骤中，输入名称后，我们需要选择一个机器映像，我已经从以前存在的t2.micro CentOS实例之一创建了一个映像。如果您想从现有的ec2实例中创建一个映像，您可以遵循这里列出的步骤<a class="ae ki" href="https://docs.aws.amazon.com/toolkit-for-visual-studio/latest/user-guide/tkv-create-ami-from-instance.html" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lq"><img src="../Images/780e8a1f00eb46f2e691367688c7d5fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXVBp324X3VrSP0B8lM9RA.png"/></div></div></figure><p id="a2be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.如果要使用新的安全组，请创建一个安全组，并选择一个密钥对用于登录。如果您想了解更多关于如何创建安全组的信息，请访问此<a class="ae ki" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/working-with-security-groups.html#creating-security-group" rel="noopener ugc nofollow" target="_blank">链接</a>。完成后，按“创建启动配置”。创建启动配置后，您可以返回“创建自动扩展组”屏幕并选择此配置。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lr"><img src="../Images/5ff5564c4b6d52e08610200087768bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFmIM6v1jdaxJ5HM3pIGkQ.png"/></div></div></figure><p id="17da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第2步到第6步是可选的，所以按照你认为合适的方式进行配置。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ls"><img src="../Images/b5096d707b6aef99020f82b9d123da1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KG-ywkHLWoeKuq67bMEGdQ.png"/></div></div></figure><p id="62a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于本教程，我选择了所需的容量为1，最小实例数为1，最大容量为2。完成后，您可以在创建自动扩展组之前检查所有配置。</p><p id="b6b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦成功创建了自动扩展组，导航到Services/EC2/instances，您将看到创建了一个实例，如下所示。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lt"><img src="../Images/61178a6b867b559e83ed93b35807036f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0I2pCpT5AWnwrPj7rlzHQ.png"/></div></div></figure><p id="2979" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，我们刚刚创建了一个自动缩放组。我们还没有跟踪CPU利用率的机制。为此，我们可以利用AWS CloudWatch度量服务。</p><p id="5e23" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.为此，点击“报警状态”栏下的添加报警，如下所示。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lu"><img src="../Images/b6aed527b740eaa17a16e1d69517bbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5FiyvGSjD8RHWHxhd07eeQ.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/c410ad5ed1b37c488c454ed563f6ce2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*fxK00Tu95njxikr9Mb90bA.png"/></div></figure><p id="7a9f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上述配置表明，如果发现CPU利用率在5分钟内平均超过60%,则触发此警报。到目前为止，我们只创建了一个警报，我们还没有真正将它与自动缩放的概念联系起来。我们现在就去做。</p><p id="156d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.转到Services/EC2/Auto Scaling groups，单击我们之前创建的自动扩展组。见下文。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lw"><img src="../Images/271b74c71e68ec26f2ea09d340b4a678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWu8jTIPAKIWv6p0un2rFA.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lx"><img src="../Images/dbccb83d1adf0020f72ff3f284f69fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8yFsSimQLdAky1ZFRHydw.png"/></div></div></figure><p id="ccfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导航到“自动缩放”选项卡，然后单击“创建动态缩放策略”。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ly"><img src="../Images/592872da86b08fcf06e2f3159ddd926f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxkp1YpBIz2Y_OaHATXtrA.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">创建动态扩展策略</figcaption></figure><p id="20fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的配置表明，如果触发了这个警报，那么向自动缩放组添加另一个实例。</p><p id="c129" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在要做的就是连接到之前创建的单个实例，并在1分钟内将其CPU负载增加到60%以上。</p><h1 id="8874" class="lz ma in bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated"><strong class="ak">我们如何模拟高CPU负载的情况？</strong></h1><p id="e0fd" class="pw-post-body-paragraph jk jl in jm b jn mx jp jq jr my jt ju jv mz jx jy jz na kb kc kd nb kf kg kh ig bi translated">我们可以使用<a class="ae ki" href="https://linux.die.net/man/1/stress" rel="noopener ugc nofollow" target="_blank">压力工具</a>来完成这个任务。使用以下命令连接到CentOS实例</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="2b1b" class="nh ma in nd b gy ni nj l nk nl">ssh -i “your .pem file” ec2-user@ec2–xx–xxx–xxx–xxx.ap-south-1.compute.amazonaws.com</span></pre><p id="27fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下载。应力工具的rpm文件如下所示</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="1a75" class="nh ma in nd b gy ni nj l nk nl">curl fr2.rpmfind.net/linux/dag/redhat/el7/en/x86_64/dag/RPMS/stress-1.0.2–1.el7.rf.x86_64.rpm -o stress-1.0.2–1.el7.rf.x86_64.rpm</span></pre><p id="98a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用yum安装它</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="96d5" class="nh ma in nd b gy ni nj l nk nl">yum localinstall stress-1.0.2–1.el7.rf.x86_64.rpm</span></pre><p id="cfa0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们可以使用下面的命令让CPU利用所有资源。</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="81e7" class="nh ma in nd b gy ni nj l nk nl">stress — cpu 8 — io 4 — vm 2 — vm-bytes 128M — timeout 150s</span></pre><p id="5a1d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以访问CloudWatch管理控制台，查看CPU利用率趋势的可视化。在我的例子中，使用上面的命令，我能够成功地使CPU超过我们设置的60%的阈值。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/b96f9196f940f214a9068a05c00dd531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zXfrfto5fAwZjXnsy2rgA.png"/></div></div></figure><p id="0abc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于超出了阈值，根据我们之前配置的动态伸缩策略，ec2自动伸缩服务已经启动并自动创建了一个额外的实例。请看下文。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/6b91f5bff14d6846be92d00c97ee06cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnXexr1nkhkp3L89GxYw2g.png"/></div></div></figure><p id="ebcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这难道不令人着迷吗？</p><p id="d6f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们主要讨论了ec2自动伸缩如何与CloudWatch警报结合使用，以自动添加额外的实例。这同样适用于缩减所用机器的数量，具体取决于具体的指标。</p><p id="3da7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然可以使用微服务，但除了Docker和Kubernetes之类的技术来实现固有的自动扩展之外，了解云技术也很重要，云技术允许我们在相对较短的时间内实现类似的事情。这种意识有助于我们为日常工作中遇到的问题/挑战选择适当而简单的解决方案。</p><h1 id="f007" class="lz ma in bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated"><strong class="ak">参考文献</strong></h1><ol class=""><li id="4944" class="lc ld in jm b jn mx jr my jv no jz np kd nq kh lh li lj lk bi translated">AWS架构良好的框架<br/>T3】https://wa . AWS . Amazon . com/Well Architected/2020-07-02t 19-33-23/index . en . html</li><li id="7301" class="lc ld in jm b jn nr jr ns jv nt jz nu kd nv kh lh li lj lk bi translated">什么是亚马逊EC2自动缩放？<br/>T6】https://docs . AWS . Amazon . com/auto scaling/ec2/user guide/what-is-Amazon-ec2-auto-scaling . html。</li><li id="a4c8" class="lc ld in jm b jn nr jr ns jv nt jz nu kd nv kh lh li lj lk bi translated">使用亚马逊CloudWatch警报<br/><a class="ae ki" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon cloud watch/latest/monitoring/alarmthatsendsemail . html</a>。</li><li id="49ab" class="lc ld in jm b jn nr jr ns jv nt jz nu kd nv kh lh li lj lk bi translated">缩放您的自动缩放组的大小<br/><a class="ae ki" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/scaling_plan.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Auto Scaling/ec2/user guide/Scaling _ plan . html</a>。</li><li id="ff39" class="lc ld in jm b jn nr jr ns jv nt jz nu kd nv kh lh li lj lk bi translated">从Amazon EC2实例创建AMI<br/><a class="ae ki" href="https://docs.aws.amazon.com/toolkit-for-visual-studio/latest/user-guide/tkv-create-ami-from-instance.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/toolkit-for-visual-studio/latest/user-guide/tkv-create-AMI-from-Instance . html</a></li></ol></div></div>    
</body>
</html>