<html>
<head>
<title>Mastering Kubernetes: How to use the configuration of Kubectl Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握 Kubernetes:如何使用 Kubectl 的配置第 2 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mastering-kubernetes-how-to-use-kubectl-part-2-918800c9d7be?source=collection_archive---------4-----------------------#2022-11-05">https://blog.devgenius.io/mastering-kubernetes-how-to-use-kubectl-part-2-918800c9d7be?source=collection_archive---------4-----------------------#2022-11-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="72a2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何配置 Kubetctl 工具？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/949f97b763fe8a834b1ec49f026a0628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2aL5Zb8MlssATc3VuICxCQ.png"/></div></div></figure></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="384f" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">介绍</h1><p id="37ba" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">大多数时候，我们不需要使用我们的 Kubernetes 集群，因为它会自动协调我们的工作负载。</p><p id="c663" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我说“大部分时间”是因为我们需要采取以下行动:</p><ul class=""><li id="1faf" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">部署新的工作负载</li><li id="32d4" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">更新工作量</li><li id="f663" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">回滚工作负荷</li><li id="8068" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">工作负荷故障排除</li></ul><p id="4a6b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">为此我们有两个选择:</p><ul class=""><li id="3787" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">直接使用<strong class="lp io">Kubernetes API</strong><a class="ae nc" href="https://kubernetes.io/docs/concepts/overview/kubernetes-api/" rel="noopener ugc nofollow" target="_blank">https://Kubernetes . io/docs/concepts/overview/Kubernetes-API/</a></li><li id="d20c" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">使用工具 https://kubernetes.io/docs/reference/kubectl/<strong class="lp io">库贝克</strong>T6</li></ul><p id="3492" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们只使用 Kubernetes API 通过应用程序与 Kubernetes 集群进行通信，以满足特定的需求。</p><p id="81e9" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">所以很多时候当我们需要做上面提到的某个动作的时候，我们会使用工具<strong class="lp io"> Kubectl！</strong></p><h1 id="5a48" class="kv kw in bd kx ky nd la lb lc ne le lf jt nf ju lh jw ng jx lj jz nh ka ll lm bi translated">如何安装和使用 Kubectl？</h1><p id="f8c3" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">我们有两个选择:</p><ul class=""><li id="3f9f" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">使用一个全局项目工具来创建 Kubernetes 集群，并自动安装直接指向该 Kubernetes 集群的 Kubectl:Docker Desktop、Minikube 等..</li><li id="ac4d" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">直接下载并安装 Kubectl。</li></ul><p id="5a20" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们将在这里看到第二种选择。</p><p id="2194" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">Kubectl 项目可以在以下链接中找到:</p><div class="ni nj gp gr nk nl"><a href="https://github.com/kubernetes/kubectl" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">GitHub - kubernetes/kubectl:问题跟踪器和 kubectl 代码镜像</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">k8s.io/kubectl 回购用于跟踪与 k8s.io/kubernetes. It 部门一起分发的 kubectl cli 的问题…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz km nl"/></div></div></a></div><p id="3fac" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">并且是用 Go 语言编写的。</p><p id="b2af" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">要安装 Kubectl，我们可以使用下面的教程:</p><div class="ni nj gp gr nk nl"><a href="https://kubernetes.io/docs/tasks/tools/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">安装工具</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">在您的计算机上设置 Kubernetes 工具。Kubernetes 命令行工具 kubectl 允许您运行命令…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">kubernetes.io</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz km nl"/></div></div></a></div><p id="c855" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">因为我使用的是 Windows 11，所以我会按照教程进行操作</p><div class="ni nj gp gr nk nl"><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">在 Windows 上安装和设置 kubectl</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">在开始之前，您必须使用与您的集群相差一个次要版本的 kubectl 版本。对于…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">kubernetes.io</p></div></div><div class="nu l"><div class="ob l nw nx ny nu nz km nl"/></div></div></a></div><p id="90db" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们只需要下载最新版本:</p><p id="8370" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><a class="ae nc" href="https://dl.k8s.io/release/v1.25.0/bin/windows/amd64/kubectl.exe" rel="noopener ugc nofollow" target="_blank">https://dl . k8s . io/release/v 1 . 25 . 0/bin/windows/amd64/kubectl . exe</a></p><p id="9157" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">然后，我们可以将 kubectl.exe 位置添加到 PATH env 变量中，这样我们就可以在命令行中使用它了。</p><p id="8685" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在我们准备配置我们的工具 Kubectl。</p><p id="527a" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">在没有任何配置的情况下，我们的工具 Kubectl 对 Kubernetes 集群一无所知。</p><p id="464c" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">这将是下一节的主题</p><h1 id="7d57" class="kv kw in bd kx ky nd la lb lc ne le lf jt nf ju lh jw ng jx lj jz nh ka ll lm bi translated">如何配置 Kubectl？</h1><p id="4990" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">让我们运行以下命令:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="fa85" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config<br/>Modify kubeconfig files using subcommands like "kubectl config set current-context my-context"</span><span id="ea79" class="oh kw in od b gy om oj l ok ol">The loading order follows these rules:</span><span id="47b9" class="oh kw in od b gy om oj l ok ol">1.  If the --kubeconfig flag is set, then only that file is loaded. The flag may only be set once and no merging takes<br/>place.<br/>  2.  If $KUBECONFIG environment variable is set, then it is used as a list of paths (normal path delimiting rules for<br/>your system). These paths are merged. When a value is modified, it is modified in the file that defines the stanza. When<br/>a value is created, it is created in the first file that exists. If no files in the chain exist, then it creates the<br/>last file in the list.<br/>  3.  Otherwise, ${HOME}/.kube/config is used and no merging takes place.</span><span id="917d" class="oh kw in od b gy om oj l ok ol">Available Commands:<br/>  current-context   Display the current-context<br/>  delete-cluster    Delete the specified cluster from the kubeconfig<br/>  delete-context    Delete the specified context from the kubeconfig<br/>  delete-user       Delete the specified user from the kubeconfig<br/>  get-clusters      Display clusters defined in the kubeconfig<br/>  get-contexts      Describe one or many contexts<br/>  get-users         Display users defined in the kubeconfig<br/>  rename-context    Rename a context from the kubeconfig file<br/>  set               Set an individual value in a kubeconfig file<br/>  set-cluster       Set a cluster entry in kubeconfig<br/>  set-context       Set a context entry in kubeconfig<br/>  set-credentials   Set a user entry in kubeconfig<br/>  unset             Unset an individual value in a kubeconfig file<br/>  use-context       Set the current-context in a kubeconfig file<br/>  view              Display merged kubeconfig settings or a specified kubeconfig file</span><span id="02ce" class="oh kw in od b gy om oj l ok ol">Usage:<br/>  kubectl config SUBCOMMAND [options]</span><span id="3ee4" class="oh kw in od b gy om oj l ok ol">Use "kubectl &lt;command&gt; --help" for more information about a given command.<br/>Use "kubectl options" for a list of global command-line options (applies to all commands).</span></pre><p id="48f3" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">它说默认情况下使用的配置文件是:${HOME}/。kube/配置。嗯＄{ HOME }是一个 Linux 环境变量，在 Windows 上它是%userprofile%</p><p id="a0b8" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">让我们创建这个目录。kube 和文件配置:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="8b9e" class="oh kw in od b gy oi oj l ok ol">&gt; cd %userprofile<br/>&gt; mkdir .kube<br/>&gt; cd .kube</span></pre><p id="c39b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们刚刚创建了。我们的用户配置文件目录中的 kube 目录。</p><p id="6ddb" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在我们将创建配置文件，它是 YAML 格式的 Kubeconfig 文件。</p><p id="217f" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">它将列出以下项目:</p><ul class=""><li id="43a8" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">集群详细信息</li><li id="13bd" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">用户</li><li id="9f76" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">上下文</li></ul><p id="e00b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">当我们使用 kubectl 和 config 命令时，我们只需要知道上下文。</p><p id="b76b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们可以看到以下依赖性:</p><p id="9d9b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">上下文= &gt;集群= &gt;用户</p><p id="930a" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">一旦我们选择了一个上下文，Kubectl 将获得集群信息，以便在控制平面中访问 Kubernetes API。最后，当 Kubectl 发送命令时，Kubectl 将使用用户信息在 Kubernetes 集群上获得正确的认证和授权。</p><p id="e7fb" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">让我们用最少的信息创建我们的 config yaml 文件:一个上下文:</p><ul class=""><li id="83a8" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">名称:上下文名称</li><li id="88ae" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">名称空间:集群中的默认名称空间</li><li id="fca7" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">user:在 Kubernetes API 中用于身份验证的用户名</li></ul><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="802a" class="oh kw in od b gy oi oj l ok ol">apiVersion: v1<br/>kind: Config<br/>contexts:<br/>- context:<br/>    cluster: minikube<br/>    namespace: default<br/>    user: minikube<br/>  name: minikube</span></pre><p id="c31d" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们只是添加了一个名为 minikube 的上下文，因为我使用 minikube 在我的开发机器上工作。</p><p id="4f7f" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在让我们运行命令:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="c037" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config get-contexts<br/>CURRENT   NAME       CLUSTER   AUTHINFO   NAMESPACE<br/>          minikube</span></pre><p id="681d" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">很好，我们现在知道了:</p><ul class=""><li id="b1ae" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">kubectl 使用什么配置文件</li><li id="3512" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">如何创建 yaml 配置文件并添加上下文</li></ul><p id="384e" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在我们需要知道如何从 minikube 上下文连接到我们的集群。</p><p id="2ac6" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">事实上，Kubectl 无法连接这个基本配置文件:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="27b0" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl get node<br/>Unable to connect to the server: dial tcp [::1]:8080: connectex: No connection could be made because the target machine actively refused it.</span></pre><p id="9fad" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们不得不等待一段时间，因为得到这个响应，我们有一个超时。</p><p id="c124" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在让我们看看如何添加连接到 Minikube 集群的信息:</p><p id="04f8" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">首先，我们添加集群信息:</p><ul class=""><li id="f202" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">服务器:找到 kubernetes API 的 URI</li><li id="46f6" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">名称:集群名称</li><li id="b0bb" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">certificate-authority:它是用于颁发证书的机构:它的数据在%user%profile 中加密。minikube\ca.crt</li></ul><p id="1af2" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">它告诉使用 Kubernetes API 将使用证书来验证请求。</p><p id="1820" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">让我们添加集群信息:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="d44f" class="oh kw in od b gy oi oj l ok ol">apiVersion: v1<br/>kind: Config<br/>contexts:<br/>- context:<br/>    cluster: minikube<br/>    namespace: default<br/>    user: minikube<br/>  name: minikube<br/>clusters:<br/>- cluster:<br/>    certificate-authority: C:\Users\nbarlatier\.minikube\ca.crt<br/>    server: <a class="ae nc" href="https://127.0.0.1:52213" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:52213</a><br/>  name: minikube<br/>preferences: {}</span></pre><p id="b025" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">让我们看看我们得到了什么:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="2968" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config get-contexts<br/>CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE<br/>          minikube   minikube   minikube   default</span></pre><p id="56c6" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们取得了进步:</p><ul class=""><li id="29ee" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">上下文名称</li><li id="d8d8" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">集群名称</li><li id="4073" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">AuthInfo:是用户名</li><li id="1aa2" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">名称空间:默认名称空间</li></ul><p id="3b3a" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">最后，让我们使用将用于验证用户身份的用户信息:</p><ul class=""><li id="e30f" class="mo mp in lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">名称:用户的名称</li><li id="5199" class="mo mp in lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">具有客户端证书和客户端密钥的用户用于通过 CA 颁发的证书对用户进行授权</li></ul><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="9dd6" class="oh kw in od b gy oi oj l ok ol">apiVersion: v1<br/>kind: Config<br/>contexts:<br/>- context:<br/>    cluster: minikube<br/>    namespace: default<br/>    user: minikube<br/>  name: minikube<br/>clusters:<br/>- cluster:<br/>    certificate-authority: C:\Users\nbarlatier\.minikube\ca.crt<br/>    server: <a class="ae nc" href="https://127.0.0.1:52213" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:52213</a><br/>  name: minikube<br/>users:<br/>- name: minikube<br/>  user:<br/>    client-certificate: C:\Users\xxx\.minikube\profiles\minikube\client.crt<br/>    client-key: C:\Users\xxx\.minikube\profiles\minikube\client.key</span></pre><p id="3be9" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在我们得到:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="9e8b" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config get-contexts<br/>CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE<br/>          minikube   minikube   minikube   default</span></pre><p id="fdf7" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们只需要用命令告诉 kubectl 默认的上下文是什么:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="b642" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config use-context minikube<br/>Switched to context "minikube".</span></pre><p id="d8e7" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在我们得到了</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="da78" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config get-contexts<br/>CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE<br/>*         minikube   minikube   minikube   default</span></pre><p id="7055" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们注意到 Current 下面的星号，所以现在 kubectl 可以调用 minikube 集群的 kubernetes API</p><p id="cf0a" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">让我们试试:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="63d0" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl get nodes<br/>NAME       STATUS   ROLES                  AGE   VERSION<br/>minikube   Ready    control-plane,master   17d   v1.23.3</span></pre><p id="8683" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">耶，我们做到了！</p><p id="967f" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">现在，我们更好地了解了如何配置我们的工具 Kubectl，我们可以轻松地导入其他上下文/集群/用户信息，并将我们的 kubectl 切换到我们需要的上下文，这样我们就可以从我们的开发机器管理任何 kubernetes 集群，甚至是远程集群(如果管理员给了您正确的用户，并且显然打开了网络)！</p><p id="0a71" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们可以手动添加配置文件的不同部分，或者使用 kubectl，例如使用以下命令:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="dbde" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config set-cluster</span></pre><p id="e1d3" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">向我们的集群添加信息。</p><p id="df3f" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们可以使用</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="0be7" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config set-context</span></pre><p id="278e" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">向我们的上下文添加信息</p><p id="6552" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们可以使用</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="3cc3" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config set-credentials</span></pre><p id="7fae" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">当请求被发送到 Kubernetes API 时，添加用于身份验证的用户信息。</p><p id="c9bf" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">我们需要浏览参考资料，查看所有可用的选项。</p><p id="5c2e" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">但是这篇文章只是一个介绍。您可以在结论部分的参考资料中找到更多详细信息。</p><p id="5be0" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">此外，当我们不添加参数时，例如当我们使用不带参数的 set-credentials 时，kubectl 可以帮助我们:</p><pre class="kd ke kf kg gt oc od oe of aw og bi"><span id="2035" class="oh kw in od b gy oi oj l ok ol">&gt;kubectl config set-credentials</span><span id="fec3" class="oh kw in od b gy om oj l ok ol">Sets a user entry in kubeconfig</span><span id="64d4" class="oh kw in od b gy om oj l ok ol">Specifying a name that already exists will merge new fields on top of existing values.</span><span id="2117" class="oh kw in od b gy om oj l ok ol">Client-certificate flags:<br/>  --client-certificate=certfile --client-key=keyfile</span><span id="0f39" class="oh kw in od b gy om oj l ok ol">Bearer token flags:<br/>    --token=bearer_token</span><span id="dca9" class="oh kw in od b gy om oj l ok ol">Basic auth flags:<br/>    --username=basic_user --password=basic_password</span><span id="a2a4" class="oh kw in od b gy om oj l ok ol">Bearer token and basic auth are mutually exclusive.</span><span id="2064" class="oh kw in od b gy om oj l ok ol">Examples:<br/>  # Set only the "client-key" field on the "cluster-admin"<br/>  # entry, without touching other values:<br/>  kubectl config set-credentials cluster-admin --client-key=~/.kube/admin.key</span><span id="a5f5" class="oh kw in od b gy om oj l ok ol"># Set basic auth for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --username=admin --password=uXFGweU9l35qcif</span><span id="4fa6" class="oh kw in od b gy om oj l ok ol"># Embed client certificate data in the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --client-certificate=~/.kube/admin.crt<br/>--embed-certs=true</span><span id="bd52" class="oh kw in od b gy om oj l ok ol"># Enable the Google Compute Platform auth provider for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --auth-provider=gcp</span><span id="90aa" class="oh kw in od b gy om oj l ok ol"># Enable the OpenID Connect auth provider for the "cluster-admin" entry with additional args<br/>  kubectl config set-credentials cluster-admin --auth-provider=oidc<br/>--auth-provider-arg=client-id=foo --auth-provider-arg=client-secret=bar</span><span id="47b4" class="oh kw in od b gy om oj l ok ol"># Remove the "client-secret" config value for the OpenID Connect auth provider for the<br/>"cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --auth-provider=oidc<br/>--auth-provider-arg=client-secret-</span><span id="77eb" class="oh kw in od b gy om oj l ok ol"># Enable new exec auth plugin for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --exec-command=/path/to/the/executable<br/>--exec-api-version=client.authentication.k8s.io/v1beta1</span><span id="dd95" class="oh kw in od b gy om oj l ok ol"># Define new exec auth plugin args for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --exec-arg=arg1 --exec-arg=arg2</span><span id="72ed" class="oh kw in od b gy om oj l ok ol"># Create or update exec auth plugin environment variables for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --exec-env=key1=val1 --exec-env=key2=val2</span><span id="a478" class="oh kw in od b gy om oj l ok ol"># Remove exec auth plugin environment variables for the "cluster-admin" entry<br/>  kubectl config set-credentials cluster-admin --exec-env=var-to-remove-</span><span id="7a87" class="oh kw in od b gy om oj l ok ol">Options:<br/>      --auth-provider='': Auth provider for the user entry in kubeconfig<br/>      --auth-provider-arg=[]: 'key=value' arguments for the auth provider<br/>      --embed-certs=false: Embed client cert/key for the user entry in kubeconfig<br/>      --exec-api-version='': API version of the exec credential plugin for the user entry in<br/>kubeconfig<br/>      --exec-arg=[]: New arguments for the exec credential plugin command for the user entry in<br/>kubeconfig<br/>      --exec-command='': Command for the exec credential plugin for the user entry in kubeconfig<br/>      --exec-env=[]: 'key=value' environment values for the exec credential plugin</span><span id="5311" class="oh kw in od b gy om oj l ok ol">Usage:<br/>  kubectl config set-credentials NAME [--client-certificate=path/to/certfile]<br/>[--client-key=path/to/keyfile] [--token=bearer_token] [--username=basic_user]<br/>[--password=basic_password] [--auth-provider=provider_name] [--auth-provider-arg=key=value]<br/>[--exec-command=exec_command] [--exec-api-version=exec_api_version] [--exec-arg=arg]<br/>[--exec-env=key=value] [options]</span><span id="0d36" class="oh kw in od b gy om oj l ok ol">Use "kubectl options" for a list of global command-line options (applies to all commands).<br/>error: Unexpected args: []</span></pre><h1 id="3403" class="kv kw in bd kx ky nd la lb lc ne le lf jt nf ju lh jw ng jx lj jz nh ka ll lm bi translated">结论</h1><p id="7cf3" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">我们可以找到关于 kube 配置的所有参考资料:</p><div class="ni nj gp gr nk nl"><a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">使用 kubeconfig 文件组织集群访问</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">使用 kubeconfig 文件来组织关于集群、用户、名称空间和认证机制的信息。的…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">kubernetes.io</p></div></div><div class="nu l"><div class="on l nw nx ny nu nz km nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#config" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">Kubectl 参考文档</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本节包含在集群上运行工作负载的最基本命令。运行将开始运行 1…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">kubernetes.io</p></div></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">配置对多个集群的访问</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本页显示如何使用配置文件配置对多个集群的访问。在您的集群之后，用户…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">kubernetes.io</p></div></div><div class="nu l"><div class="oo l nw nx ny nu nz km nl"/></div></div></a></div></div></div>    
</body>
</html>