<html>
<head>
<title>Using Kafka For System Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Kafka 进行系统集成</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-kafka-for-system-integration-cc272b214740?source=collection_archive---------4-----------------------#2022-03-04">https://blog.devgenius.io/using-kafka-for-system-integration-cc272b214740?source=collection_archive---------4-----------------------#2022-03-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="78ad" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">概观</h1><p id="3d5a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您想使用 Kafka 连接位于不同机器或不同网络上的多个系统，本文将对您有所帮助。</p><p id="fe8f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在本文中，我将向您展示如何:</p><ul class=""><li id="fb9b" class="ll lm in kk b kl lg kp lh kt ln kx lo lb lp lf lq lr ls lt bi translated">在 Azure 上的专用 Linux 服务器上创建 Kafka 集群</li><li id="6678" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">手动安装和配置 Kafka</li><li id="4589" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">将您的 Kafka 集群暴露给不同的机器</li><li id="bfa9" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">使用单独的生产者和消费者测试您的 Kafka 集群</li></ul><h1 id="18f3" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">在 Azure 上创建虚拟机</h1><p id="538a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">第一步是在我们现有的或新的资源组中创建新的资源，例如 Linux 服务器。' Ubuntu Server 20.04 LTS 版'</p><p id="2931" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">创建实例时要记住的事项:</p><ul class=""><li id="4c14" class="ll lm in kk b kl lg kp lh kt ln kx lo lb lp lf lq lr ls lt bi translated">虚拟机(cpu、内存)的大小，对于开发和测试 B1 实例，1 个 vcpu 和 2 个 GiB 就足够了，对于生产环境，将需要更多功率。还要记住，Kafka 可以水平扩展(更多实例)，而 RabbitMQ 可以垂直扩展(更强大)</li><li id="f53e" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">允许 SSH 入站端口</li><li id="e1ce" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">使用 SSH 公钥(新的或现有的)</li><li id="bc9f" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf lq lr ls lt bi translated">OS 磁盘类型(取决于工作负载)，我选择标准 SSD</li></ul><p id="215b" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在我们的虚拟机成功部署后，您可以使用终端登录，例如。Windows 终端并键入:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="43ce" class="mi jl in me b gy mj mk l ml mm">ssh -i Path\\To\\Private\\Key.pem &lt;vm-user-name-you-choose&gt;@&lt;public-ip-of-vm&gt;</span></pre><p id="63c2" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">下一步:</p><h1 id="4c4a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">安装 Java jre 和 jdk</h1><p id="efd7" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">安装 Java 最简单的选择是使用 Ubuntu 打包的版本。默认情况下，Ubuntu 20.04 包括开放 JDK 11，这是 JRE 和 JDK 的开源版本。</p><p id="dc75" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">要安装此版本，请先更新软件包索引:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="7ed1" class="mi jl in me b gy mj mk l ml mm">sudo apt update</span></pre><p id="b03f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">接下来，检查 Java 是否已经安装:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="e932" class="mi jl in me b gy mj mk l ml mm">java -version</span></pre><p id="f9cb" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">如果当前没有安装 Java，您将看到以下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="210a" class="mi jl in me b gy mj mk l ml mm">Output<br/>Command 'java' not found, but can be installed with:</span><span id="ca70" class="mi jl in me b gy mn mk l ml mm">sudo apt install openjdk-11-jre-headless  # version 11.0.11+9-0ubuntu2~20.04, or<br/>sudo apt install default-jre              # version 2:1.11-72<br/>sudo apt install openjdk-13-jre-headless  # version 13.0.7+5-0ubuntu1~20.04<br/>sudo apt install openjdk-16-jre-headless  # version 16.0.1+9-1~20.04<br/>sudo apt install openjdk-8-jre-headless   # version 8u292-b10-0ubuntu1~20.04</span></pre><p id="a0c2" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">执行以下命令来安装默认的 Java 运行时环境(JRE ),这将从 OpenJDK 11 安装 JRE:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9cc1" class="mi jl in me b gy mj mk l ml mm">sudo apt install default-jre</span></pre><p id="70e3" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">JRE 将允许你运行几乎所有的 Java 软件。</p><p id="61f4" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">使用以下工具验证安装:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d13f" class="mi jl in me b gy mj mk l ml mm">java -version</span></pre><p id="0a90" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您将看到类似如下的输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="e22b" class="mi jl in me b gy mj mk l ml mm">Output<br/>openjdk version "11.0.11" 2021-04-20<br/>OpenJDK Runtime Environment (build 11.0.11+9-Ubuntu-0ubuntu2.20.04)<br/>OpenJDK 64-Bit Server VM (build 11.0.11+9-Ubuntu-0ubuntu2.20.04, mixed mode, sharing))</span></pre><p id="2ba6" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">为了编译和运行一些特定的基于 Java 的软件，除了 JRE 之外，您可能还需要 Java 开发工具包(JDK)。要安装 JDK，请执行以下命令，这也将安装 JRE:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="31a5" class="mi jl in me b gy mj mk l ml mm">sudo apt install default-jdk</span></pre><p id="6083" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">通过检查 Java 编译器<code class="fe mo mp mq me b">javac</code>的版本，验证是否安装了 JDK:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="515d" class="mi jl in me b gy mj mk l ml mm">javac -version</span></pre><p id="2549" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您将看到以下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="fd67" class="mi jl in me b gy mj mk l ml mm">Output<br/>javac11.0.11</span></pre><p id="977f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">下一步:</p><h1 id="6116" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">安装卡夫卡</h1><h1 id="7efd" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 1 —为 Kafka 创建用户</h1><p id="52e5" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因为 Kafka 可以通过网络处理请求，所以您的第一步是为该服务创建一个专用用户。在有人破坏 Kafka 服务器的情况下，这可以最大限度地减少对你的 Ubuntu 机器的损害。但是因为我们已经有了一个用户，并且我们的服务器只为我们的消息代理服务，所以我们可以使用那个用户，并且它已经附带了 sudo 特权。</p><p id="54a4" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">如果我们没有用户，您可以执行以下操作:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="61dc" class="mi jl in me b gy mj mk l ml mm">sudo adduser kafka</span></pre><p id="2c4b" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">按照提示设置密码并创建<code class="fe mo mp mq me b">kafka</code>用户。</p><p id="3a28" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">接下来，使用<code class="fe mo mp mq me b">adduser</code>命令将<code class="fe mo mp mq me b">kafka</code>用户添加到<code class="fe mo mp mq me b">sudo</code>组。您需要这些权限来安装 Kafka 的依赖项:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a415" class="mi jl in me b gy mj mk l ml mm">sudo adduser kafka sudo</span></pre><p id="b4ac" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您的<code class="fe mo mp mq me b">kafka</code>用户现已准备就绪。使用<code class="fe mo mp mq me b">su</code>登录账户:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="aee9" class="mi jl in me b gy mj mk l ml mm">su -l kafka</span></pre><p id="aa05" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在您已经创建了一个特定于 Kafka 的用户，您已经准备好下载并提取 Kafka <strong class="kk io">二进制文件</strong>。</p><p id="1c83" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><strong class="kk io">不要安装源文件，使用二进制文件！！！</strong></p><h1 id="ec3b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 2 —下载并解压缩 Kafka 二进制文件</h1><p id="6810" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">让我们将 Kafka 二进制文件下载并解压到我们的<code class="fe mo mp mq me b">kafka</code>用户主目录的专用文件夹中。</p><p id="e2da" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">首先，在<code class="fe mo mp mq me b">/home/kafka</code>中创建一个名为<code class="fe mo mp mq me b">Downloads</code>的目录来存储您的下载:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b885" class="mi jl in me b gy mj mk l ml mm">mkdir ~/Downloads</span></pre><p id="70cf" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">使用<code class="fe mo mp mq me b">curl</code>下载 Kafka 二进制文件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f505" class="mi jl in me b gy mj mk l ml mm">curl "&lt;https://downloads.apache.org/kafka/3.1.0/kafka_2.13-3.1.0.tgz&gt;" -o ~/Downloads/kafka.tgz</span></pre><p id="f73d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">创建一个名为<code class="fe mo mp mq me b">kafka</code>的目录，并切换到这个目录。这将是 Kafka 安装的基本目录:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="528f" class="mi jl in me b gy mj mk l ml mm">mkdir ~/kafka &amp;&amp; cd ~/kafka</span></pre><p id="a112" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">使用<code class="fe mo mp mq me b">tar</code>命令提取您下载的归档文件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6ab8" class="mi jl in me b gy mj mk l ml mm">tar -xvzf ~/Downloads/kafka.tgz --strip 1</span></pre><p id="a2aa" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">我们指定了<code class="fe mo mp mq me b">--strip 1</code>标志，以确保归档文件的内容是在<code class="fe mo mp mq me b">~/kafka/</code>本身中提取的，而不是在其中的另一个目录(比如<code class="fe mo mp mq me b">~/kafka/kafka_2.13-3.1.0/</code>)中提取的。</p><p id="7e33" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在我们已经成功下载并提取了二进制文件，我们可以开始配置我们的 Kafka 服务器了。</p><p id="f522" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">下一步:</p><h1 id="2dbc" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">设置 Kafka 配置</h1><h1 id="1d42" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 1 —配置 Kafka 服务器</h1><p id="9d61" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Kafka 的默认行为是不允许你删除一个<strong class="kk io">主题</strong>。<a class="ae mr" href="https://kafka.apache.org/documentation/#intro_concepts_and_terms" rel="noopener ugc nofollow" target="_blank">Kafka 主题</a>是可以发布消息的类别、群组或订阅源名称。要对此进行修改，您必须编辑配置文件。</p><p id="623f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">Kafka 的配置选项在<code class="fe mo mp mq me b">server.properties</code>中指定。用<code class="fe mo mp mq me b">nano</code>或你喜欢的编辑器打开这个文件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="7389" class="mi jl in me b gy mj mk l ml mm">nano ~/kafka/config/server.properties</span></pre><p id="b3f8" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">首先，添加一个允许我们删除卡夫卡主题的设置。将以下内容添加到文件的底部:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2402" class="mi jl in me b gy mj mk l ml mm">delete.topic.enable = true</span></pre><p id="4542" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">其次，通过修改<code class="fe mo mp mq me b">logs.dir</code>属性来改变 Kafka 日志存储的目录:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9d54" class="mi jl in me b gy mj mk l ml mm"># 'kafka' being the username<br/>log.dirs=/home/kafka/logs</span></pre><p id="6a5a" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">第三，改变内部和外部将暴露卡夫卡的听众(端口应该不同):</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="89ab" class="mi jl in me b gy mj mk l ml mm">listeners=INTERNAL://0.0.0.0:19092,EXTERNAL://0.0.0.0:9092<br/>listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT<br/>advertised.listeners=INTERNAL://10.0.0.4:19092,EXTERNAL://20.201.63.123:9092<br/>inter.broker.listener.name=INTERNAL</span></pre><p id="2d63" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><strong class="kk io">注意</strong>:内部是虚拟机的私有 IP 地址，外部是虚拟机的公共 IP 地址</p><p id="87c7" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">保存并关闭文件。现在您已经配置了 Kafka，下一步是配置 zookeeper。</p><p id="20d9" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">有一篇很好的文章，您可以查看关于 Kafka 连接的更多选项:</p><p id="70a6" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><a class="ae mr" href="https://rmoff.net/2018/08/02/kafka-listeners-explained/" rel="noopener ugc nofollow" target="_blank">卡夫卡的听众——解释</a></p><h1 id="0021" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 2 —配置 Zookeeper 服务器</h1><p id="1020" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Zookeper 的默认行为会将数据保存在/tmp 中，会引发问题。要对此进行修改，您必须编辑配置文件。</p><p id="3a5c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">Zookeeper 的配置选项在<code class="fe mo mp mq me b">zookeeper.properties</code>中指定。用<code class="fe mo mp mq me b">nano</code>或你喜欢的编辑器打开这个文件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8d3a" class="mi jl in me b gy mj mk l ml mm">nano ~/kafka/config/zookeeper.properties</span></pre><p id="a967" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">修改我们保存 zookeeper 数据的位置:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="881b" class="mi jl in me b gy mj mk l ml mm">dataDir=/home/kafka/zookeeper</span></pre><p id="5645" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">保存并关闭文件。现在您已经配置了 Zookeeper，下一步是创建 systemd 单元文件，以便在启动时运行和启用 Kafka 服务器。</p><h1 id="7375" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">步骤 3 —创建 Systemd 单元文件并启动 Kafka 服务器</h1><p id="7276" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在本节中，您将为 Kafka 服务创建<a class="ae mr" href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files" rel="noopener ugc nofollow" target="_blank"> systemd 单元文件</a>。这将帮助您以与其他 Linux 服务一致的方式执行常见的服务操作，例如启动、停止和重新启动 Kafka。</p><p id="22e9" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">Zookeeper 是 Kafka 用来管理其集群状态和配置的服务。它被用于许多分布式系统中。如果你想了解更多，请访问官方动物园管理员文档。</p><p id="d7e7" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">为<code class="fe mo mp mq me b">zookeeper</code>创建单位档案:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3081" class="mi jl in me b gy mj mk l ml mm">sudo nano /etc/systemd/system/zookeeper.service</span></pre><p id="5bf0" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在文件中输入以下单位定义:</p><p id="7a80" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">/etc/systemd/system/zookeeper . service</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="83e1" class="mi jl in me b gy mj mk l ml mm">[Unit]<br/>Requires=network.target remote-fs.target<br/>After=network.target remote-fs.target</span><span id="8db1" class="mi jl in me b gy mn mk l ml mm">[Service]<br/>Type=simple<br/>User=kafka<br/>ExecStart=/home/kafka/kafka/bin/zookeeper-server-start.sh /home/kafka/kafka/config/zookeeper.properties<br/>ExecStop=/home/kafka/kafka/bin/zookeeper-server-stop.sh<br/>Restart=on-abnormal</span><span id="4374" class="mi jl in me b gy mn mk l ml mm">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="209f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><code class="fe mo mp mq me b">[Unit]</code>部分指定 Zookeeper 需要网络和文件系统准备好才能启动。</p><p id="d50b" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><code class="fe mo mp mq me b">[Service]</code>部分指定 systemd 应该使用<code class="fe mo mp mq me b">zookeeper-server-start.sh</code>和<code class="fe mo mp mq me b">zookeeper-server-stop.sh</code> shell 文件来启动和停止服务。它还指定如果 Zookeeper 异常退出，应该重新启动它。</p><p id="85f9" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">添加此内容后，保存并关闭文件。</p><p id="ff71" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">接下来，为<code class="fe mo mp mq me b">kafka</code>创建 systemd 服务文件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="39ef" class="mi jl in me b gy mj mk l ml mm">sudo nano /etc/systemd/system/kafka.service</span></pre><p id="df4d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在文件中输入以下单位定义:</p><p id="243f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">/etc/systemd/system/Kafka . service</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="254d" class="mi jl in me b gy mj mk l ml mm">[Unit]<br/>Requires=zookeeper.service<br/>After=zookeeper.service</span><span id="3110" class="mi jl in me b gy mn mk l ml mm">[Service]<br/>Type=simple<br/>User=kafka<br/>ExecStart=/bin/sh -c '/home/kafka/kafka/bin/kafka-server-start.sh /home/kafka/kafka/config/server.properties &gt; /home/kafka/kafka/kafka.log 2&gt;&amp;1'<br/>ExecStop=/home/kafka/kafka/bin/kafka-server-stop.sh<br/>Restart=on-abnormal</span><span id="20eb" class="mi jl in me b gy mn mk l ml mm">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="320c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><code class="fe mo mp mq me b">[Unit]</code>部分指定该单元文件依赖于<code class="fe mo mp mq me b">zookeeper.service</code>。这将确保<code class="fe mo mp mq me b">zookeeper</code>在<code class="fe mo mp mq me b">kafka</code>服务启动时自动启动。</p><p id="a873" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><code class="fe mo mp mq me b">[Service]</code>部分指定 systemd 应该使用<code class="fe mo mp mq me b">kafka-server-start.sh</code>和<code class="fe mo mp mq me b">kafka-server-stop.sh</code> shell 文件来启动和停止服务。它还指定如果 Kafka 异常退出，应该重新启动它。</p><p id="6596" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在您已经定义了单元，使用以下命令启动 Kafka:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="bb87" class="mi jl in me b gy mj mk l ml mm">sudo systemctl start kafka</span></pre><p id="59a2" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">为确保服务器已成功启动，请检查<code class="fe mo mp mq me b">kafka</code>单元的日志:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b9f1" class="mi jl in me b gy mj mk l ml mm">sudo systemctl status kafka</span></pre><p id="4ba5" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您将收到如下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="af18" class="mi jl in me b gy mj mk l ml mm">Output<br/>● kafka.service<br/>     Loaded: loaded (/etc/systemd/system/kafka.service; disabled; vendor preset: enabled)<br/>     Active:active (running) since Wed 2021-02-10 00:09:38 UTC; 1min 58s ago<br/>   Main PID: 55828 (sh)<br/>      Tasks: 67 (limit: 4683)<br/>     Memory: 315.8M<br/>     CGroup: /system.slice/kafka.service<br/>             ├─55828 /bin/sh -c /home/kafka/kafka/bin/kafka-server-start.sh /home/kafka/kafka/config/server.properties &gt; /home/kafka/kafka/kafka.log 2&gt;&amp;1<br/>             └─55829 java -Xmx1G -Xms1G -server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:MaxInlineLevel=15 -Djava.awt.headless=true -Xlog:gc*:file=&gt;</span><span id="0af7" class="mi jl in me b gy mn mk l ml mm">Feb 10 00:09:38 cart-67461-1 systemd[1]: Started kafka.service.</span></pre><p id="607f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您现在有一个 Kafka 服务器监听端口<code class="fe mo mp mq me b">9092</code>。</p><p id="b97f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您已经启动了<code class="fe mo mp mq me b">kafka</code>服务。但如果重启服务器，Kafka 不会自动启动。要在服务器启动时启用<code class="fe mo mp mq me b">kafka</code>服务，请运行以下命令:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b287" class="mi jl in me b gy mj mk l ml mm">sudo systemctl enable kafka</span></pre><p id="daa8" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">我发现对调试非常有帮助的一个命令是:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8bb4" class="mi jl in me b gy mj mk l ml mm">sudo journalctl --follow -u kafka.service</span></pre><p id="aa95" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您将收到如下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="259a" class="mi jl in me b gy mj mk l ml mm">-- Logs begin at Thu 2022-03-03 12:47:53 UTC. --<br/>Mar 03 19:03:41 ubuntu-dev-vm systemd[1]: kafka.service: Main process exited, code=exited, status=1/FAILURE<br/>Mar 03 19:03:41 ubuntu-dev-vm systemd[1]: kafka.service: Failed with result 'exit-code'.<br/>Mar 03 19:04:43 ubuntu-dev-vm systemd[1]: Started kafka.service.<br/>Mar 03 19:04:46 ubuntu-dev-vm systemd[1]: kafka.service: Main process exited, code=exited, status=1/FAILURE<br/>Mar 03 19:04:46 ubuntu-dev-vm systemd[1]: kafka.service: Failed with result 'exit-code'.<br/>Mar 03 19:05:11 ubuntu-dev-vm systemd[1]: Started kafka.service.<br/>Mar 03 19:15:47 ubuntu-dev-vm systemd[1]: Stopping kafka.service...<br/>Mar 03 19:16:02 ubuntu-dev-vm systemd[1]: kafka.service: Succeeded.<br/>Mar 03 19:16:02 ubuntu-dev-vm systemd[1]: Stopped kafka.service.<br/>Mar 03 19:16:18 ubuntu-dev-vm systemd[1]: Started kafka.service.</span></pre><p id="5b90" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">这将跟随你的 kafka.service 状态的实时更新，现在你可以打开另一个终端来读取日志或做其他事情，并检查你的服务的实时状态。</p><p id="078e" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">在这一步中，您启动并启用了<code class="fe mo mp mq me b">kafka</code>和<code class="fe mo mp mq me b">zookeeper</code>服务。在下一步中，您将在 Azure vm 网络上设置入站规则。</p><p id="0ac5" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">注意:Kafka 安装帮助来自:</p><p id="7273" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><a class="ae mr" href="https://www.digitalocean.com/community/tutorials/how-to-install-apache-kafka-on-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank">如何在 Ubuntu 20.04 | DigitalOcean 上安装 Apache Kafka</a></p><p id="6f27" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">下一步:</p><h1 id="59e6" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">在 Azure vm 上添加入站端口规则以公开 Kafka</h1><h1 id="fd9a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">在 Azure 门户中打开“网络”选项卡</h1><ol class=""><li id="146c" class="ll lm in kk b kl km kp kq kt ms kx mt lb mu lf mv lr ls lt bi translated">第一件事就是打开你的 Azure 门户。</li><li id="9370" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">然后打开我们需要添加入站规则的虚拟机。</li><li id="3685" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">打开网络选项卡</li><li id="cf5d" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">单击添加入站端口规则按钮</li></ol><figure class="lz ma mb mc gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mw"><img src="../Images/698e120a8e6c7dee276653b4d678f9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRA4Y6S83rWRH0r9XfYjrw.png"/></div></div></figure><h1 id="5fa0" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">添加入站端口规则(您可以根据需要添加自定义规则)</h1><ol class=""><li id="4aa0" class="ll lm in kk b kl km kp kq kt ms kx mt lb mu lf mv lr ls lt bi translated">从来源下拉列表中选择 Ip 地址</li><li id="2017" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">输入您想要加入白名单的 Ip 地址</li><li id="7d1b" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">输入目的地端口</li><li id="3045" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">设置较高的优先级(较低的数字)</li><li id="4e48" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">输入规则名称</li></ol><figure class="lz ma mb mc gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ne"><img src="../Images/1a7f20d6bc9ad64df94f929d1bc55e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzrBn_dEcJM_kNtXp3hGkA.png"/></div></div></figure><p id="775e" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">我们都完成了！</p><p id="b85e" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">现在，下一步我们可以做一些测试，看看我们的 Kafka 集群是否如我们所愿地工作。</p><p id="974d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">下一步:</p><h1 id="4a1b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建 Kafka 生产者和消费者来测试我们的 Kafka 集群</h1><h1 id="a77e" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建卡夫卡主题</h1><p id="a937" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">首先，我们需要创建一个 kafka 主题，从中我们可以产生和消费消息。</p><p id="d85f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">为此，我们需要登录 Kafka 所在的虚拟机。</p><p id="9af8" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">然后转到 kafka 文件夹并键入:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d749" class="mi jl in me b gy mj mk l ml mm">bin/kafka-topics.sh --bootstrap-server INTERNAL://10.0.0.4:19092 --create --topic test --partitions 1</span></pre><h1 id="22bf" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建生产者</h1><p id="1f7c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">下一步，我们可以创建服务人员或控制台应用程序。我将向您展示一个服务人员的例子:</p><ol class=""><li id="1ec5" class="ll lm in kk b kl lg kp lh kt ln kx lo lb lp lf mv lr ls lt bi translated">从 Visual Studio 创建默认的服务工作应用程序</li><li id="f963" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">安装汇流器。NuGet 的卡夫卡包</li><li id="6909" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">将这段代码复制到 Worker 类中</li></ol><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a949" class="mi jl in me b gy mj mk l ml mm">public class Worker : BackgroundService<br/>    {<br/>        private readonly ILogger&lt;Worker&gt; _logger;</span><span id="ffe0" class="mi jl in me b gy mn mk l ml mm">        public Worker(ILogger&lt;Worker&gt; logger)<br/>        {<br/>            _logger = logger;<br/>        }</span><span id="47e7" class="mi jl in me b gy mn mk l ml mm">        protected override async Task ExecuteAsync(CancellationToken stoppingToken)<br/>        {<br/>            while (!stoppingToken.IsCancellationRequested)<br/>            {<br/>                _logger.LogInformation("Worker running at: {time}", DateTimeOffset.Now);</span><span id="7a02" class="mi jl in me b gy mn mk l ml mm">                string brokerList = "20.201.63.123:9092"; // public ip of kafka's virtual machine<br/>                string topicName = "test";</span><span id="2cac" class="mi jl in me b gy mn mk l ml mm">                var config = new ProducerConfig <br/>                { <br/>                    BootstrapServers = brokerList,<br/>                    SecurityProtocol = SecurityProtocol.Plaintext,<br/>                };</span><span id="1a79" class="mi jl in me b gy mn mk l ml mm">                using (var producer = new ProducerBuilder&lt;string, string&gt;(config).Build())<br/>                {<br/>                    Console.WriteLine("\\n-----------------------------------------------------------------------");<br/>                    Console.WriteLine($"Producer {producer.Name} producing on topic {topicName}.");<br/>                    Console.WriteLine("-----------------------------------------------------------------------");<br/>                    Console.WriteLine("To create a kafka message with UTF-8 encoded key and value:");<br/>                    Console.WriteLine("&gt; key value&lt;Enter&gt;");<br/>                    Console.WriteLine("To create a kafka message with a null key and UTF-8 encoded value:");<br/>                    Console.WriteLine("&gt; value&lt;enter&gt;");<br/>                    Console.WriteLine("Ctrl-C to quit.\\n");</span><span id="0a3e" class="mi jl in me b gy mn mk l ml mm">                    var cancelled = false;<br/>                    Console.CancelKeyPress += (_, e) =&gt; {<br/>                        e.Cancel = true; // prevent the process from terminating.<br/>                        cancelled = true;<br/>                    };</span><span id="1b2a" class="mi jl in me b gy mn mk l ml mm">                    while (!cancelled)<br/>                    {<br/>                        Console.Write("&gt; ");</span><span id="fdb1" class="mi jl in me b gy mn mk l ml mm">                        string text;<br/>                        try<br/>                        {<br/>                            text = Console.ReadLine();<br/>                        }<br/>                        catch (IOException)<br/>                        {<br/>                            // IO exception is thrown when ConsoleCancelEventArgs.Cancel == true.<br/>                            break;<br/>                        }<br/>                        if (text == null)<br/>                        {<br/>                            // Console returned null before <br/>                            // the CancelKeyPress was treated<br/>                            break;<br/>                        }</span><span id="c94e" class="mi jl in me b gy mn mk l ml mm">                        string key = null;<br/>                        string val = text;</span><span id="ef42" class="mi jl in me b gy mn mk l ml mm">                        // split line if both key and value specified.<br/>                        int index = text.IndexOf(" ");<br/>                        if (index != -1)<br/>                        {<br/>                            key = text.Substring(0, index);<br/>                            val = text.Substring(index + 1);<br/>                        }</span><span id="12f2" class="mi jl in me b gy mn mk l ml mm">                        try<br/>                        {<br/>                            // Note: Awaiting the asynchronous produce request below prevents flow of execution<br/>                            // from proceeding until the acknowledgement from the broker is received (at the <br/>                            // expense of low throughput).<br/>                            var deliveryReport = await producer.ProduceAsync(<br/>                                topicName, new Message&lt;string, string&gt; { Key = key, Value = val });</span><span id="834a" class="mi jl in me b gy mn mk l ml mm">                            Console.WriteLine($"delivered to: {deliveryReport.TopicPartitionOffset}");<br/>                        }<br/>                        catch (ProduceException&lt;string, string&gt; e)<br/>                        {<br/>                            Console.WriteLine($"failed to deliver message: {e.Message} [{e.Error.Code}]");<br/>                        }<br/>                    }</span><span id="3ea3" class="mi jl in me b gy mn mk l ml mm">                    // Since we are producing synchronously, at this point there will be no messages<br/>                    // in-flight and no delivery reports waiting to be acknowledged, so there is no<br/>                    // need to call producer.Flush before disposing the producer.<br/>                }<br/>            }<br/>        }<br/>    }</span></pre><p id="094d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">运行应用程序并编写一些东西</p><p id="ed3b" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您应该会看到以下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="7f3d" class="mi jl in me b gy mj mk l ml mm">info: KafkaProducer.Worker[0]<br/>      Worker running at: 03/04/2022 16:18:31 +01:00</span><span id="c479" class="mi jl in me b gy mn mk l ml mm">-----------------------------------------------------------------------<br/>Producer rdkafka#producer-1 producing on topic test.<br/>-----------------------------------------------------------------------<br/>To create a kafka message with UTF-8 encoded key and value:<br/>&gt; key value&lt;Enter&gt;<br/>To create a kafka message with a null key and UTF-8 encoded value:<br/>&gt; value&lt;enter&gt;<br/>Ctrl-C to quit.</span><span id="35ac" class="mi jl in me b gy mn mk l ml mm">&gt; Hello Hello from producer<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Application started. Press Ctrl+C to shut down.<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Hosting environment: Development<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Content root path: C:\\Projects\\KafkaProducer\\KafkaProducer<br/>delivered to: test [[0]] @1<br/>&gt;</span></pre><h1 id="e928" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建消费者</h1><p id="d54c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">下一步，我们可以创建服务人员或控制台应用程序。我将向您展示一个控制台应用程序的示例:</p><ol class=""><li id="2f37" class="ll lm in kk b kl lg kp lh kt ln kx lo lb lp lf mv lr ls lt bi translated">安装汇流器。NuGet 的卡夫卡包</li><li id="ebd1" class="ll lm in kk b kl lu kp lv kt lw kx lx lb ly lf mv lr ls lt bi translated">在 Program.cs 类中编写以下代码:</li></ol><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3a8f" class="mi jl in me b gy mj mk l ml mm">var brokerList = "20.201.63.123:9092"; // public ip of kafka's vm<br/>var topics = new List&lt;string&gt; { "test" };<br/>Console.WriteLine($"Started consumer, Ctrl-C to stop consuming");</span><span id="0cd7" class="mi jl in me b gy mn mk l ml mm">CancellationTokenSource cts = new CancellationTokenSource();<br/>Console.CancelKeyPress += (_, e) =&gt; {<br/>    e.Cancel = true; // prevent the process from terminating.<br/>    cts.Cancel();<br/>};</span><span id="7dd9" class="mi jl in me b gy mn mk l ml mm">var config = new ConsumerConfig<br/>{<br/>    // the group.id property must be specified when creating a consumer, even <br/>    // if you do not intend to use any consumer group functionality.<br/>    GroupId = new Guid().ToString(),<br/>    BootstrapServers = brokerList,<br/>    // partition offsets can be committed to a group even by consumers not<br/>    // subscribed to the group. in this example, auto commit is disabled<br/>    // to prevent this from occurring.<br/>    EnableAutoCommit = true<br/>};</span><span id="b633" class="mi jl in me b gy mn mk l ml mm">using (var consumer =<br/>    new ConsumerBuilder&lt;Ignore, string&gt;(config)<br/>        .SetErrorHandler((_, e) =&gt; Console.WriteLine($"Error: {e.Reason}"))<br/>        .Build())<br/>{<br/>    consumer.Assign(topics.Select(topic =&gt; new TopicPartitionOffset(topic, 0, Offset.Beginning)).ToList());</span><span id="b939" class="mi jl in me b gy mn mk l ml mm">    try<br/>    {<br/>        while (true)<br/>        {<br/>            try<br/>            {<br/>                var consumeResult = consumer.Consume(cts.Token);<br/>                // Note: End of partition notification has not been enabled, so<br/>                // it is guaranteed that the ConsumeResult instance corresponds<br/>                // to a Message, and not a PartitionEOF event.<br/>                Console.WriteLine($"Received message at {consumeResult.TopicPartitionOffset}: ${consumeResult.Message.Value}");<br/>            }<br/>            catch (ConsumeException e)<br/>            {<br/>                Console.WriteLine($"Consume error: {e.Error.Reason}");<br/>            }<br/>        }<br/>    }<br/>    catch (OperationCanceledException)<br/>    {<br/>        Console.WriteLine("Closing consumer.");<br/>        consumer.Close();<br/>    }<br/>}</span></pre><p id="0654" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">启动应用程序。</p><p id="cb83" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">您应该会看到以下输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="17e4" class="mi jl in me b gy mj mk l ml mm">Started consumer, Ctrl-C to stop consuming<br/>Received message at test [[0]] @1: $Hello from producer</span></pre><p id="e0ec" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">就是这样！</p><h1 id="d532" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结束注释</h1><p id="f529" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">使用了合流代码的例子。用于. Net 的 Kafka 软件包。其他示例可以查看他们的 github 帐户:</p><p id="d9df" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated"><a class="ae mr" href="https://github.com/confluentinc/confluent-kafka-dotnet/tree/master/examples" rel="noopener ugc nofollow" target="_blank">confluent-Kafka-dot net/master confluent Inc/confluent-Kafka-dot net 的例子</a></p><p id="48bc" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">对于其他配置和设置，请使用 Kafka 官方文档，其中包含最新信息:</p><div class="nf ng gp gr nh ni"><a href="https://kafka.apache.org/documentation/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">阿帕奇卡夫卡</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">下面是对 Apache Kafka 的一些流行用例的描述。有关这些领域的概述…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">kafka.apache.org</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw nc ni"/></div></div></a></div><figure class="lz ma mb mc gt mx gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/7dab6a02931b3072846fa5d6769fff35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*8PyBStycrazhmir_mm7fQw.jpeg"/></div></figure></div></div>    
</body>
</html>