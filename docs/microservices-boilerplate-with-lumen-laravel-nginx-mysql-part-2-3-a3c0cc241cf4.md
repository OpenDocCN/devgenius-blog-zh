# å¾®æœåŠ¡æ ·æ¿æ–‡ä»¶â€”å¸¦æœ‰ Lumen + Laravel + Nginx + Mysql â†’éƒ¨åˆ†(2/3)

> åŸæ–‡ï¼š<https://blog.devgenius.io/microservices-boilerplate-with-lumen-laravel-nginx-mysql-part-2-3-a3c0cc241cf4?source=collection_archive---------3----------------------->

![](img/a2bcd9c49cf0d9dabfa777a6693d9f24.png)

## åœ¨è¿™ä¸ªç³»åˆ—ä¸­

*   [å¾®æœåŠ¡æ ·æ¿æ–‡ä»¶:è®¾ç½®(ç¬¬ 1/3 éƒ¨åˆ†)](https://medium.com/@shadysmaoui/micro-services-with-lumen-laravel-nginx-mysql-70b3554e8068)
*   [å¾®æœåŠ¡æ ·æ¿:è®¾è®¡(ç¬¬ 2/3 éƒ¨åˆ†)](https://medium.com/@shadysmaoui/microservices-boilerplate-with-lumen-laravel-nginx-mysql-part-2-3-a3c0cc241cf4)

ç°åœ¨æˆ‘ä»¬çš„è®¾ç½®å·²ç»å®Œæˆï¼Œå¹¶ä¸”**å¯æ‰©å±•**æ¶æ„çš„åŸºç¡€å·²ç»å‡†å¤‡å¥½ï¼Œæˆ‘ä»¬å¯ä»¥å‘å‰è¿ˆè¿›ï¼Œæ›´æ·±å…¥åœ°æ€è€ƒæˆ‘ä»¬æ•´ä¸ªç³»ç»Ÿçš„æœŸæœ›è®¾è®¡ã€‚

æˆ‘ä»¬å°†æ ¹æ®æˆ‘ä»¬å°†é€‰æ‹©çš„è®¾è®¡è¦æ±‚ï¼Œåœ¨æˆ‘ä»¬å¿…é¡»å®æ–½ç°æœ‰å¾®æœåŠ¡æˆ–åˆ›å»ºæ–°çš„å¾®æœåŠ¡æ—¶ï¼Œå°è¯•å»ºç«‹éµå¾ªçš„å‡†åˆ™ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†å¿…é¡»è¿›è¡Œä¸€äº› DevOps è°ƒæ•´ï¼Œä»¥ç¡®ä¿æ‰€æœ‰éƒ¨åˆ†ä¸€èµ·æ­£å¸¸è¿è¡Œã€‚ä¸æ­¤åŒæ—¶ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ€»çš„æ¥è¯´ï¼Œè®¾ç½®ä¸­æ¯ç‡¥çš„éƒ¨åˆ†å·²ç»è¿‡å»ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šæ¥è¿‘æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚

æ­£å¦‚æœ¬ç³»åˆ—å¼€å§‹æ—¶æåˆ°çš„ï¼Œè¿™äº›æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯é¦–å…ˆä»‹ç»**å¾®æœåŠ¡æ¶æ„**ï¼Œç„¶åæä¾›å¦‚ä½•è®¾è®¡å’Œå®ç°å®ƒçš„åˆ†æ­¥æ¼”ç¤ºã€‚

è™½ç„¶è¿™ç§è½¯ä»¶æ¶æ„é£æ ¼æ²¡æœ‰ç²¾ç¡®çš„å®šä¹‰ï¼Œä½†å›´ç»• ***æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾:å¯ä¼¸ç¼©æ€§ã€æŒç»­é›†æˆã€è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç«¯ç‚¹æ™ºèƒ½ã€è§£è€¦ä¸šåŠ¡é€»è¾‘ã€è¯­è¨€æ— å…³ç»„ä»¶å’Œæ•°æ®çš„åˆ†æ•£æ§åˆ¶*** ã€‚
é‰´äºæœ¬ç³»åˆ—çš„æ•™è‚²æ€§è´¨å’ŒèŒƒå›´ï¼Œæˆ‘ä»¬å°†æ— æ³•æ¶µç›–ä¸Šè¿°æ‰€æœ‰è¦ç´ ï¼Œå°¤å…¶æ˜¯é‚£äº›ä¸å®é™…ç”Ÿäº§æµç¨‹ç›¸å…³çš„è¦ç´ ï¼Œå¦‚ **CICD(æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²)ã€‚**å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å°†å°è¯•ä»è®¾è®¡çš„è§’åº¦å¯¹æ‰€æœ‰é‡è¦æ–¹é¢æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚è¿°ã€‚

## ç³»ç»Ÿå®šä¹‰

å‡ºäºå­¦ä¹ ç›®çš„ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®¡ç†ç”µå­å•†åŠ¡å…¬å¸äº§å“åº“å­˜çš„ **ERP(ä¼ä¸šèµ„æºè§„åˆ’)**ç³»ç»Ÿçš„æœ€å°å¯è¡Œäº§å“ã€‚ä¸ºäº†ä½¿è¿™ä¸ªè¿‡ç¨‹å°½å¯èƒ½é¡ºåˆ©å’Œç®€å•ï¼Œæˆ‘ä»¬å°†åšä¸€äº›æŠ½è±¡ï¼Œé¿å…æ·±å…¥æŒ–æ˜ ERP çš„ä¸šåŠ¡é€»è¾‘ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†åšæŒå®šä¹‰ä¸€ä¸ª **ERP** çš„å·¥ä½œæµç¨‹çš„ä¸»è¦æŒ‡å¯¼æ–¹é’ˆï¼Œä»¥ä¾¿ç»™æˆ‘ä»¬çš„ **MVP** ä¸€ä¸ªæ›´ç°å®çš„æ–¹æ³•ã€‚

## ä¸»è¦ç»„ä»¶

*   **ç­–å±•äºº**ï¼Œè¿™æ˜¯ Laravel åº”ç”¨ç¨‹åºï¼Œå°†ä½¿ç”¨æˆ‘ä»¬çš„å¾®æœåŠ¡å…¬å¼€çš„ APIï¼Œå¹¶å°†ä¸ºæ•´ä¸ªç³»ç»Ÿæ‰®æ¼” UI(ç”¨æˆ·ç•Œé¢)çš„è§’è‰²ï¼Œä»¥åŠç”¨æˆ·çš„ç™»å½•é¡µé¢ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå…·æœ‰ä»ªè¡¨æ¿çš„ç½‘ç«™ï¼Œå…è®¸åˆ›å»ºï¼Œåˆ—è¡¨ï¼Œç¼–è¾‘å’Œåˆ é™¤èµ„æº(äº§å“/å“ç‰Œç­‰)ã€‚
*   **åˆ†å‘å™¨**å°†æ˜¯å¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿçš„ä¸»è¦å…¥å£ç‚¹ï¼Œæ­£å¦‚å…¶åç§°æ‰€è§„å®šçš„ï¼Œå®ƒå°†åˆ†å‘å¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿçš„å…¥ç«™å’Œå‡ºç«™è¯·æ±‚å’Œå“åº”ã€‚ç”¨æŠ€æœ¯æœ¯è¯­æ¥è¯´ï¼Œ**åˆ†é…å™¨**å°†æ˜¯å¾®æœåŠ¡ API ç½‘å…³ã€‚
*   **ms-productï¼Œ**æ˜¯è´Ÿè´£ç®¡ç†äº§å“çš„ä¸»è¦å¾®æœåŠ¡ã€‚å®ƒå°†æ¥æ”¶å’Œå“åº”æ‰€æœ‰ä¸äº§å“ç›¸å…³çš„è¯·æ±‚ã€‚å®ƒå°†æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“å°†æ˜¯å”¯ä¸€çš„çœŸç†æ¥æºï¼Œå½“è°ˆåˆ°äº§å“ã€‚
*   **ms-brand â€”** ä¸å¾®æœåŠ¡çš„è§£è€¦é€»è¾‘ä¸€æ ·ï¼Œ **ms-brand** å°†è´Ÿè´£ç®¡ç†æ‰€æœ‰ä¸äº§å“å“ç‰Œç›¸å…³çš„è¯·æ±‚ã€‚åŸºäºä¸ ms-product ç›¸åŒçš„æ¨ç†ï¼Œms-brand å°†æ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œè¯¥æ•°æ®åº“å°†æˆä¸ºå“ç‰Œä¿¡æ¯çš„å”¯ä¸€æ¥æºã€‚
*   **ms-location â€”** æˆ‘ä»¬çš„äº§å“å°†å­˜æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½æ˜¯åå°å•†åº—ã€å‰å°å•†åº—ã€ä»“åº“ç­‰ã€‚ **ms-location** å°†ä½œä¸ºå¤„ç†ä½ç½®ä¸šåŠ¡é€»è¾‘çš„å‚è€ƒã€‚

![](img/674aebe2b0ca4aa629cab04bfa2069bd.png)

å¾®æœåŠ¡æ ·æ¿

## å¾®æœåŠ¡ç¼“å­˜

ä¸ºäº†å……åˆ†åˆ©ç”¨**å¾®æœåŠ¡æ¶æ„ï¼Œ**æˆ‘ä»¬å°†ä¸ºæ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿã€‚è€ƒè™‘åˆ°æˆ‘ä»¬å°†é€šè¿‡ **Redis** ç¼“å­˜ä½¿ç”¨**å†…å­˜ä¸­æ•°æ®å­˜å‚¨**æ–¹æ³•ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬çš„å¾®æœåŠ¡è·å¾—æå¿«çš„å“åº”æ—¶é—´ã€‚ä¸ PostgreSQLã€Cassandraã€MongoDB å’Œå…¶ä»–å°†å¤§éƒ¨åˆ†æ•°æ®å­˜å‚¨åœ¨ç£ç›˜æˆ–å›ºæ€ç¡¬ç›˜ä¸Šçš„æ•°æ®åº“ç›¸æ¯”ï¼Œæ‰€æœ‰ Redis æ•°æ®éƒ½é©»ç•™åœ¨æœåŠ¡å™¨çš„ä¸»å†…å­˜ä¸­ã€‚ä¸ä¼ ç»Ÿçš„åŸºäºç£ç›˜çš„æ•°æ®åº“(å…¶ä¸­å¤§å¤šæ•°æ“ä½œéœ€è¦å¾€è¿”ç£ç›˜)ç›¸æ¯”ï¼Œ**å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨**å¦‚ **Redis** ä¸ä¼šé­å—åŒæ ·çš„æŸå¤±ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥æ”¯æŒä¸€ä¸ªæ•°é‡çº§ã€æ›´å¤šçš„æ“ä½œå’Œæ›´å¿«çš„å“åº”æ—¶é—´ã€‚ç»“æœæ˜¯æå¿«çš„æ€§èƒ½ï¼Œå¹³å‡è¯»å–æˆ–å†™å…¥æ“ä½œä¸åˆ°ä¸€æ¯«ç§’ï¼Œæ”¯æŒæ¯ç§’æ•°ç™¾ä¸‡æ¬¡æ“ä½œã€‚

![](img/9578d20316a642cf483921d53004379a.png)

## æ·»åŠ å¾®æœåŠ¡

ç°åœ¨æˆ‘ä»¬å¯¹ç³»ç»Ÿè®¾è®¡æœ‰äº†æ›´æ¸…æ™°çš„äº†è§£ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸åŒçš„ç»„ä»¶ã€‚

`->$ composer create-project --prefer-dist laravel/lumen apps/ms-product`

`->$ composer create-project --prefer-dist laravel/lumen apps/ms-brand`

`->$ composer create-project --prefer-dist laravel/lumen apps/ms-location`

è‡³æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰äº†æˆ‘ä»¬**å…¨æ–°ä¸‰å¾®æœåŠ¡**çš„æ¶æ„ã€‚æ˜¯æ—¶å€™æ·»åŠ æ¯ä¸ªå¾®æœåŠ¡çš„å®¹å™¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ·»åŠ å„è‡ªçš„ docker æ–‡ä»¶ã€‚

â†’ `./apps/ms-product/Dockerfile`

é‰´äºè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸‰æ¬¡äº§ç”Ÿä¸€ä¸ªæ–°çš„å¾®æœåŠ¡ï¼Œæˆ‘ç¡®ä¿¡ä½ å°†èƒ½å¤Ÿé€šè¿‡æ­£ç¡®åœ°ä¸º **ms-brand** ä»¥åŠ **ms-location åˆ›å»º Dockerfile æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚**

## è¿è¡ŒçŠ¶å†µæ£€æŸ¥å®æ–½

æˆ‘ä»¬å°†ä¸€èµ·ä¸º**åˆ†å‘å™¨**å®ç°`HealthCheckController`,æˆ‘å°†è®©æ‚¨è´Ÿè´£å°†å®ƒæ·»åŠ åˆ°å…¶ä»–å¾®æœåŠ¡ä¸­ã€‚æ‚¨åªéœ€å¤åˆ¶/ç²˜è´´ç›¸åŒçš„æ–‡ä»¶ï¼Œä¸åšä»»ä½•æ›´æ”¹ã€‚

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º`HealthCheckController`:

`-> ./apps/dispenser/app/Http/Controllers/HealthCheckController.php`

ç°åœ¨æˆ‘ä»¬çš„`HealthCheckController`å·²ç»å®ç°ï¼Œè®©æˆ‘ä»¬åœ¨`web.php`ä¸­æ·»åŠ ä¸ä¹‹ç›¸å…³çš„è·¯ç”±ã€‚

`-> dispenser/routes/web.php`

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·**é¼“æŒå¹¶è®¢é˜…**ï¼å¹²æ¯ï¼ï¼âœŒğŸ½ğŸ’•ğŸ’•ğŸ‘ŒğŸ½

ä¸‹é¢æ˜¯ä¸è¿™ä¸ªé¡¹ç›®ç›¸å…³çš„ Github èµ„æºåº“:

https://github.com/shsma/microservices-workspaceâ€¦â€¦åˆ«å¿˜äº†æ˜æ˜Ÿ

**åŒå›é˜…è¯»ç¬¬ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œ:**

[](https://medium.com/@shadysmaoui/micro-services-with-lumen-laravel-nginx-mysql-70b3554e8068) [## å¸¦æœ‰ Lumen + Laravel + Nginx + Mysql çš„å¾®æœåŠ¡æ ·æ¿->ç¬¬ 2/3 éƒ¨åˆ†

### åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¸€æ­¥ä¸€æ­¥åœ°æ¼”ç¤ºå¦‚ä½•ç”¨ Lumem å’Œ Laravel å°†ä½ çš„å¾®æœåŠ¡é¡¹ç›® dockerize

medium.com](https://medium.com/@shadysmaoui/micro-services-with-lumen-laravel-nginx-mysql-70b3554e8068)