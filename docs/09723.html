<html>
<head>
<title>Heartbeat with local Elasticsearch and Kibana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">心跳与局部弹性搜索和基巴纳</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/heartbeat-with-local-elasticsearch-and-kibana-69b99f7e23a6?source=collection_archive---------9-----------------------#2022-09-07">https://blog.devgenius.io/heartbeat-with-local-elasticsearch-and-kibana-69b99f7e23a6?source=collection_archive---------9-----------------------#2022-09-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e263b1274161245a66e6940ca1948549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oy9pJVNVSSI76t3mKwTcPg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">瑞安·斯通在<a class="ae jz" href="https://unsplash.com/s/photos/heartbeat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="08f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">很高兴在这个弹性堆栈系列中再次见到您😊。今天我们来关注一下垮掉的一族。到目前为止，我们已经讨论了<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/metricbeat-with-local-elasticsearch-and-kibana-c330c902e473"> Metricbeat </a>和<a class="ae jz" href="https://medium.com/@mhdabdel151/ship-logs-to-local-elasticsearch-using-filebeat-36e7fe1bff83" rel="noopener"> Filebeat </a>。如果你还没有，请看看它。</p><p id="f9b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了提供最佳的用户体验，必须保证某些特性，尤其是最重要的特性之一<strong class="kc io">可用性。</strong>你可以把它定义为了解你的系统、服务和数据的正常运行时间的过程。持续可用性确保了无论用户何时在您的服务中发起事务，他都不会遇到“<em class="ky">发生错误，稍后再来</em>”这堵墙。</p><p id="a237" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们知道这一特征非常重要，衡量这一特征的方法是定期收集核心系统、服务和数据的节拍。这些节拍可以存储到高度可扩展和耐用的存储中，如 Elasticsearch，并在以后使用 Kibana 进行分析。</p><p id="2da8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> Heartbeat </strong>是一个轻量级代理，可安装在服务器和容器中，能够定期收集信息并将其发送到任何已配置的输出。所有的数据都以 Kibana 可读的格式收集，并且可以自动创建可视化的图表。因此，这是一个端到端的解决方案，不仅可以收集数据，还可以处理、存储和分析数据。这在其他情况下也很有帮助，比如安全用例。Kibana 中有一个名为<strong class="kc io"> Uptime </strong>的内置应用程序，它允许您在一个地方查看与您的系统或服务可用性相关的所有事情。第一次打开时，它看起来像这样:</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kz"><img src="../Images/5cf98a1869034f3a5d23ba5cfa8b461d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uE5FBc2Gr9ajdqkEcZmcjw.png"/></div></div></figure><p id="72cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">配置心跳时，选择与您希望检查的主机名对应的<strong class="kc io">监视器</strong>。根据您选择的时间表，每个监视器都会运行。目前，Heartbeat 支持<em class="ky"> HTTP </em>、<em class="ky"> ICMP </em> ( <em class="ky"> v4 和 v6 </em> ) <em class="ky"> Echo 请求</em>和<em class="ky"> TCP </em>。</p><h2 id="5fa5" class="le lf in bd lg lh li dn lj lk ll dp lm kl ln lo lp kp lq lr ls kt lt lu lv lw bi translated">心跳安装</h2><p id="46ff" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">现在让我们看看如何安装和配置 Heartbeat 来探测来自系统和服务的可用性信息，并将它们发送到 Elasticsearch。</p><p id="1d28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们开始之前，确保 Elasticsearch 和 Kibana 正在您的机器上运行。如果不是这样，请阅读<a class="ae jz" href="https://medium.com/@mhdabdel151/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e" rel="noopener">这篇关于如何使用 Docker Compose 启动本地 Elasticsearch 和 Kibana 的文章</a>。你还需要根据你的发行版从<a class="ae jz" href="https://www.elastic.co/downloads/beats/heartbeat" rel="noopener ugc nofollow" target="_blank">官网</a>下载 Heartbeat。</p><h2 id="01de" class="le lf in bd lg lh li dn lj lk ll dp lm kl ln lo lp kp lq lr ls kt lt lu lv lw bi translated">微服务</h2><p id="1eda" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">我们还将使用一个非常简单的微服务，它将返回"<em class="ky"> Hello world👋</em>“每次向端点发送请求时(<em class="ky">http://localhhost:3001/API/hello</em>)。我们将部署 Heartbeat 来收集端点的正常运行时间信息，并将其传输到 Elasticsearch。下面是我们应用程序的代码:</p><pre class="la lb lc ld gt mc md me mf aw mg bi"><span id="e873" class="le lf in md b gy mh mi l mj mk">const express = require('express')<br/>const app = express()<br/>const port = 3001</span><span id="e11b" class="le lf in md b gy ml mi l mj mk">app.get('/api/hello', (request, response) =&gt; {<br/>  response.send('Hello World 👋')<br/>})</span><span id="921c" class="le lf in md b gy ml mi l mj mk">app.listen(port, () =&gt; {<br/>  console.log(`App listening on port ${port}`)<br/>})</span></pre><h2 id="d3d6" class="le lf in bd lg lh li dn lj lk ll dp lm kl ln lo lp kp lq lr ls kt lt lu lv lw bi translated">心跳配置</h2><p id="767d" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">下载并提取文件夹的内容后，我们需要配置我们的监视器指向我们的微服务。在<code class="fe mm mn mo md b">heartbeat.yml</code>文件中，在【T10 监视器】部分下，指定其类型(<em class="ky"> http </em>)、将用于探测目标系统可用性的<em class="ky"> URL </em>、用于标识监视器的<em class="ky">名称</em>和<em class="ky"> id </em>以及<em class="ky">时间表</em>(此处为<em class="ky">，从心跳开始</em>起每 5 秒运行一次监视器)。由于我们在禁用安全性的情况下使用 Elasticsearch，因此在<strong class="kc io">输出部分</strong>中不需要额外的信息，只需检查是否提到了用于连接 Elasticsearch 的正确 URL。</p><pre class="la lb lc ld gt mc md me mf aw mg bi"><span id="54e1" class="le lf in md b gy mh mi l mj mk">heartbeat.monitors:</span><span id="9195" class="le lf in md b gy ml mi l mj mk">- type: http</span><span id="a055" class="le lf in md b gy ml mi l mj mk">  # ID used to uniquely identify this monitor<br/>  id: hello-microservice</span><span id="527c" class="le lf in md b gy ml mi l mj mk">  # Display name for this service<br/>  name: Hello world</span><span id="37c3" class="le lf in md b gy ml mi l mj mk">  # List or urls to query<br/>  urls: ["http://localhost:3001/api/hello"]</span><span id="650f" class="le lf in md b gy ml mi l mj mk">  # Configure task schedule<br/>  schedule: '@every 5s'</span></pre><p id="8851" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们可以使用这个配置来启动 Heartbeat，并从我们的微服务中收集正常运行时间信息。在解压缩的文件夹中，有一个启动 Heartbeat 的可执行文件，我们只需使用以下命令启动它:</p><pre class="la lb lc ld gt mc md me mf aw mg bi"><span id="a9d6" class="le lf in md b gy mh mi l mj mk">./heartbeat -e</span></pre><p id="08e8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:<code class="fe mm mn mo md b">-e</code>是可选的，将输出发送到标准错误，而不是配置的日志输出。</p><p id="49ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦执行完毕，返回到 Kibana 并检查 uptime 部分下的可用性信息。例如，您可以查看有问题的微服务的状态，是启动还是关闭。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/a950a24ae47a49a912affd9ee5246e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NgkzD6iaJ2TTiZ8r_o4wvg.png"/></div></div></figure><p id="9bc2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以通过强制应用程序崩溃来测试打印信息的可靠性，并查看 Kibana 是否会改变其结果。在这里，我们只是停止我们的应用程序，回到基巴纳。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/10873541364fa2aab3379d88ee410a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06VoFRvyN225VjqVP2ZpbA.png"/></div></div></figure><p id="733f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，要设置<strong class="kc io">资产</strong>来解析、索引和可视化数据，您可以运行以下命令:</p><pre class="la lb lc ld gt mc md me mf aw mg bi"><span id="5ec4" class="le lf in md b gy mh mi l mj mk">./heartbeat setup -e</span></pre><p id="3853" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一切似乎都正常😎！在这里你还可以做很多事情。请查看关于该主题的官方文件以了解更多细节。</p><p id="f344" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天就到这里，感谢您的阅读，如果您对本文有任何问题或意见，请在下面留下您的评论。</p><p id="ef7c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们下次再见，看更多的帖子🚀。</p><p id="a790" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>