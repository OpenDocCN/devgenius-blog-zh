<html>
<head>
<title>Codeigniter — Extending One Install To Handle Multiple Sites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">codeigniter——扩展一个安装以处理多个站点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/codeigniter-extending-one-install-to-handle-multiple-sites-f0383ae34aae?source=collection_archive---------7-----------------------#2020-07-23">https://blog.devgenius.io/codeigniter-extending-one-install-to-handle-multiple-sites-f0383ae34aae?source=collection_archive---------7-----------------------#2020-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3054cac5048d3564db7554586fb04555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5lLGYJXaxAKqdevef94-QQ.jpeg"/></div></div></figure><p id="a748" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在之前的一篇博客文章中，我谈到了构建一个定制的CMS，它允许我们管理显示在移动应用程序中的数据。</p><p id="183c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我设法让CMS的一个基本版本启动并运行。我们已经用了整整12个月来管理数据，没有出现太多问题或错误。</p><p id="8e7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们的移动应用程序想要达到什么目的。基本想法是让人们在英国的某些地区找到酒馆、酒吧、咖啡馆、外卖、酒店和交通信息。</p><p id="ff87" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这款应用发布18个月后。我们联系了一个人，他在英国经营着很多酒吧。</p><p id="d9b8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们提出的一个想法是创建一个“客户门户”，这样他们就可以登录并管理他们所拥有的酒吧的数据。允许他们在我们的应用程序中显示报价和其他变化的信息。</p><p id="9ad0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这让我们受益匪浅，因为我们可以开始从这个应用程序中赚点钱。该公司从中受益，因为到该地区旅游的人会将他们的酒吧视为推荐去的地方。以及用相关的优惠来吸引人们。</p><p id="a1d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对我来说，最大的挑战是建立并运行这个客户门户。</p><p id="bf11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">专业编程和软件开发的一个原则是不要在你写的代码方面重复你自己。因为我已经做了登录机制的繁重工作，并且能够编辑条目和更新信息。我不想让两个代码库做同样的事情。</p><h2 id="eb4c" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">不要重复你自己</h2><p id="8542" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">我已经写了一些代码和功能，允许你在我们现有的CMS中添加、编辑和删除应用程序中的条目。</p><p id="ff71" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我希望能够在新的客户门户中重用这些代码文件。然而，登录屏幕、仪表板和编辑屏幕的设计必须不同。</p><p id="f11a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望我们的CMS和客户门户在不同的域上运行，但仍然可以访问许多相同的代码。</p><p id="b6d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个挑战。</p><p id="bc2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">两个不同的前端，使用相同的后端代码更新一个数据库。</p><p id="cc63" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我想使用相同代码的原因是，如果我必须改变我们保存条目的方式。我只需要在一个地方改变它，然后更新会过滤到两个网站。</p><p id="f4b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我有两个代码库，我肯定会忘记修改其中的一个。给我们或我们的客户带来问题。</p><h2 id="c383" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">当两个人合二为一</h2><p id="ed5e" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">我已经把我的帽子挂在了<a class="ae kt" href="https://codeigniter.com" rel="noopener ugc nofollow" target="_blank"> Codeigniter </a>框架上。不用自己编写大量代码，就能快速启动并运行某些东西，这很棒。</p><p id="cb19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是的，我找不到任何显而易见的方法来实现我想要的。我开始在很多开发者论坛上挖掘，比如<a class="ae kt" href="https://stackoverflow.com" rel="noopener ugc nofollow" target="_blank"> stackoverflow </a>。希望能找到解决办法。</p><p id="84eb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">幸运的是，我设法找到了一些有用的东西。我现在找不到其中的联系，不管是谁想出来的，都想要一枚奖章。</p><p id="b766" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它节省了我很多时间和精力。</p><p id="a78e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，我是如何在我们的站点中实现它的呢？</p><p id="9bdf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我需要做的第一件事是创建一个基本控制器和基本模型类，以便能够将用户路由到正确的网站。</p><p id="3c05" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在核心文件夹中，我创建了两个名为ADMIN_Controller.php和ADMIN_Model.php的新文件</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/3e011c21078cb5487376c74a6ef6ec80.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/0*auSCS9QME4wXk19N.png"/></div></figure><p id="efae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ADMIN_Controller.php看起来像这样</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="bf6b" class="ku kv in ly b gy mc md l me mf">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br/><br/>class ADMIN_Controller extends CI_Controller {<br/><br/>    function __construct()<br/>    {<br/>        parent::__construct();<br/><br/>        $logged_in_value = 'logged_in';<br/>        $redirect_url = 'admin/login';<br/><br/>        if (SITE == 'my')<br/>        {<br/>            $logged_in_value = 'my_logged_in';<br/>            $redirect_url = 'my/mylogin';<br/>        }<br/><br/>        if($this-&gt;session-&gt;userdata($logged_in_value) !== TRUE)<br/>        {<br/>            $this-&gt;session-&gt;set_userdata('redirect_url', current_url());<br/>            redirect($redirect_url);<br/>        }<br/>    }<br/>}</span></pre><p id="7b8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个控制器将默认为管理员，主CMS，除非该网站是我的。子域，那么它会假设你想登录到我们的客户门户网站。</p><p id="8651" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个控制器的主要目的是确定您是否登录，如果没有登录，重定向url应该是什么。</p><p id="16a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ADMIN_Model.php看起来像这样</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="7f07" class="ku kv in ly b gy mc md l me mf">&lt;?php<br/><br/>class ADMIN_Model extends CI_Model<br/>{<br/>    function __construct()<br/>    {<br/>        parent::__construct();<br/><br/>        //If the site is for my.xxx load new db config<br/>        $site = SITE; <br/>    }<br/>}</span></pre><p id="5b0b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">到目前为止相当直接？</p><p id="2ce2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来要做的是创建一个名为HostNameRouter.php的钩子。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/1a433c952bef57bf76076a6868cafff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/0*yhcNWKfYYdr8O5mi.png"/></div></figure><p id="da3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该文件将根据您访问的子域，将您重定向到主管理CMS或客户端门户。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="6e5a" class="ku kv in ly b gy mc md l me mf">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');<br/>/*<br/>	Manage multiple hostnames (domains, sub-domains) within a single instance of CodeIgniter.<br/>	Example:<br/>		If you had the following domain/sub-domain style for your site:<br/>		your-domain.com<br/>		api.your-domain.com<br/>		shop.your-domain.com<br/>		Create the following sub-directories (+ files) in your application/controllers directory:<br/>		application/controllers/home.php<br/>		application/controllers/api/product.php<br/>		application/controllers/api/products.php<br/>		application/controllers/shop/catalog.php<br/>		And, in your application/config/hosts.php file:<br/>		$config['home'] = 'your-domain.com';<br/>		$config['api'] = 'api.your-domain.com';<br/>		$config['shop'] = 'shop.your-domain.com';<br/>		<br/>		Now if you navigate to your site in a browser, here's what you should get:<br/>		your-domain.com -&gt; Your site's home page<br/>		api.your-domain.com/product -&gt; The product end-point of your API<br/>		api.your-domain.com/products -&gt; The products end-point of your API<br/>		shop.your-domain.com/catalog -&gt; The catalog page of your shop<br/>*/<br/><br/><br/>class HostNameRouter<br/>{<br/>	protected $hosts;<br/>	/*<br/>		Run as a pre-system hook.<br/>	*/<br/>	public function pre_system()<br/>	{<br/>		$this-&gt;prepare_hosts();<br/>		$this-&gt;prevent_direct_controller_group_access();<br/>		$this-&gt;route_host_to_controller_group();<br/>	}<br/>	/*<br/>		Run as a pre-controller hook.<br/>	*/<br/>	public function pre_controller()<br/>	{<br/>		$this-&gt;prepare_hosts();<br/>		$this-&gt;restore_uri();<br/>	}<br/>	/*<br/>		Routes a host name to a specific controller group.<br/>	*/<br/>	protected function route_host_to_controller_group()<br/>	{<br/>		/*<br/>			Have to use a super global here, because CI's Hooks class re-instantiates<br/>			this class for every call to it from the config/hooks.php file.<br/>		*/<br/>		$_SERVER['ORIGINAL_REQUEST_URI'] = $_SERVER['REQUEST_URI'];<br/>		/*<br/>			Only route the request if there is a host name route<br/>			for the current host.<br/>		*/<br/>		if ($this-&gt;has_controller_group($_SERVER['HTTP_HOST']))<br/>		{<br/>			$group = $this-&gt;get_controller_group($_SERVER['HTTP_HOST']);<br/>			$_SERVER['REQUEST_URI'] = '/' . $group . $_SERVER['REQUEST_URI'];<br/>		}<br/>	}<br/>	/*<br/>		Restores the URI-related variables to their originals.<br/>	*/<br/>	protected function restore_uri()<br/>	{<br/>		/*<br/>			Have to do it this way because the $CI object is not available yet.<br/>		*/<br/>		$this-&gt;uri =&amp; load_class('URI', 'core');<br/>		$_SERVER['REQUEST_URI'] = $_SERVER['ORIGINAL_REQUEST_URI'];<br/>		$this-&gt;uri-&gt;uri_string = ltrim($_SERVER['REQUEST_URI'], '/');<br/>		// Remove the query string, if there is one.<br/>		if (strpos($this-&gt;uri-&gt;uri_string, '?') !== false)<br/>			list ($this-&gt;uri-&gt;uri_string, ) = explode('?', $this-&gt;uri-&gt;uri_string);<br/>		$this-&gt;uri-&gt;segments = array();<br/>		if ($this-&gt;uri-&gt;uri_string !== '')<br/>			foreach (explode('/', $this-&gt;uri-&gt;uri_string) as $i =&gt; $segment)<br/>				$this-&gt;uri-&gt;segments[$i + 1] = $segment;<br/>	}<br/>	/*<br/>		Returns TRUE/FALSE depending upon if the given host has a controller group.<br/>	*/<br/>	protected function has_controller_group($host)<br/>	{<br/>		$group = $this-&gt;get_controller_group($host);<br/>		<br/>		$controller_subdir = APPPATH . 'controllers/' . $group;<br/>		return 	$group !== null &amp;&amp;<br/>				file_exists($controller_subdir) &amp;&amp;<br/>				is_dir($controller_subdir);<br/>	}<br/>	/*<br/>		Returns the host's controller group.<br/>	*/<br/>	protected function get_controller_group($host)<br/>	{<br/>		$host_to_group = array_flip($this-&gt;hosts);<br/>		return isset($host_to_group[$host]) ? $host_to_group[$host] : null;<br/>	}<br/>	/*<br/>		Prevents direct URI access of controller groups.<br/>	*/<br/>	protected function prevent_direct_controller_group_access()<br/>	{<br/>		if (!($group = $this-&gt;uri_segment(1)))<br/>			return;<br/>		if ($this-&gt;group_has_host($group))<br/>		{<br/>			$protocol = $this-&gt;request_protocol();<br/>			$host = $this-&gt;get_host_by_group($group);<br/>			$uri = substr($_SERVER['REQUEST_URI'], strlen('/' . $group));<br/>			header('Location: ' . $protocol . '://' . $host . $uri, true, 301);<br/>			exit;<br/>		}<br/>	}<br/>	/*<br/>		Returns TRUE/FALSE depending upon if the given group has a host.<br/>	*/<br/>	protected function group_has_host($group)<br/>	{<br/>		return $this-&gt;get_host_by_group($group) !== null;<br/>	}<br/>	/*<br/>		Returns group's host.<br/>	*/<br/>	protected function get_host_by_group($group)<br/>	{<br/>		return isset($this-&gt;hosts[$group]) ? $this-&gt;hosts[$group] : null;<br/>	}<br/>	/*<br/>		Returns the URI segment specified by $n<br/>	*/<br/>	protected function uri_segment($n)<br/>	{<br/>		$uri = ltrim($_SERVER['REQUEST_URI'], '/');<br/>		$segments = explode('/', $uri);<br/>		return isset($segments[$n - 1]) ? $segments[$n - 1] : null;<br/>	}<br/>	/*<br/>		Returns 'https' if that was the protocol used by the current request.<br/>		Returns 'http' otherwise.<br/>	*/<br/>	protected function request_protocol()<br/>	{<br/>		return isset($_SERVER['HTTPS']) &amp;&amp; strtolower($_SERVER['HTTPS']) === 'on' ? 'https' : 'http';<br/>	}<br/>	/*<br/>		Prepares the hosts array.<br/>	*/<br/>	protected function prepare_hosts()<br/>	{<br/>		$this-&gt;config =&amp; load_class('Config', 'core');<br/>		$this-&gt;config-&gt;load('hosts', true);<br/>		$this-&gt;hosts = $this-&gt;config-&gt;item('hosts');<br/>	}<br/>}<br/>/* End of file HostNameRouter.php */<br/>/* Location: ./application/hooks/HostNameRouter.php */</span></pre><p id="6320" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我去配置hooks.php文件，以了解新的路由器文件。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/0accdebafdfad01d2dbcc7384dda40bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/0*eSxnrQzgdZpLx5j6.png"/></div></figure><p id="c299" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你告诉钩子文件关于新的路由器文件，让系统知道在webapp启动之前和控制器工作之前做什么。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="69c9" class="ku kv in ly b gy mc md l me mf">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br/>/*<br/>| -------------------------------------------------------------------------<br/>| Hooks<br/>| -------------------------------------------------------------------------<br/>| This file lets you define "hooks" to extend CI without hacking the core<br/>| files.  Please see the user guide for info:<br/>|<br/>|	http://codeigniter.com/user_guide/general/hooks.html<br/>|<br/>*/<br/>$hook['pre_system'][] = array(<br/>	'class'    =&gt; 'HostNameRouter',<br/>	'function' =&gt; 'pre_system',<br/>	'filename' =&gt; 'HostNameRouter.php',<br/>	'filepath' =&gt; 'hooks',<br/>	'params'   =&gt; array()<br/>);<br/>$hook['pre_controller'][] = array(<br/>	'class'    =&gt; 'HostNameRouter',<br/>	'function' =&gt; 'pre_controller',<br/>	'filename' =&gt; 'HostNameRouter.php',<br/>	'filepath' =&gt; 'hooks',<br/>	'params'   =&gt; array()<br/>);<br/><br/>/* End of file hooks.php */<br/>/* Location: ./application/config/hooks.php */</span></pre><p id="0c88" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个配置部分的最后一点是编辑config.php文件本身。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/2e7b5427ab00f818efa0131d69f74be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*4zDqdz8zxUksT8oG.png"/></div></figure><p id="1f78" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您需要确保设置了下面几行代码/值。这告诉Codeigniter框架使用您在上一步中设置的挂钩。和您创建的基类的默认前缀。在本例中为ADMIN_</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="c95d" class="ku kv in ly b gy mc md l me mf">$config['enable_hooks'] = TRUE;<br/><br/>$config['subclass_prefix'] = 'ADMIN_';</span></pre><p id="550e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，您需要创建或编辑hosts.php文件。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/032d6ced586e28ebece6ec8ccad8efaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/0*kuGjRaewkENnGu79.png"/></div></figure><p id="59b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将告诉Codeigniter框架您希望在这个解决方案中运行的所有站点。</p><p id="2203" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我的主机文件的内容是:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="dcec" class="ku kv in ly b gy mc md l me mf">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br/>$config = array();<br/>$config[''] = 'admin.xxx';<br/>$config['my'] = 'my.xx';<br/>/*<br/>	Define the SITE constant.<br/>*/<br/><br/>foreach ($config as $site =&gt; $host)<br/>if ($_SERVER['HTTP_HOST'] === $host)<br/>{<br/>    define('SITE', $site);<br/>    break;<br/>}</span></pre><p id="4a1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见，默认主机被设置为管理区域，我有一个客户门户的特定键。</p><p id="be70" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果服务器的主机名与数组中设置的主机名匹配，它将定义一个全局站点常量，供login_redirect控制器稍后使用。</p><p id="d406" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，同样重要的是。告诉routes.php在第一次加载时做什么，如果它找不到页面。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/864a4ef4370df7f5f311a1dd217932d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/0*738z-Hoou1VybNF6.png"/></div></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="803b" class="ku kv in ly b gy mc md l me mf">$route['default_controller'] = "login_redirect";<br/>$route['404_override'] = 'admin_404';</span></pre><p id="6123" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将在后面的文章中展示如何实现login_redirect部分。</p><h2 id="6952" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">我是个模特，你知道我的意思吗</h2><p id="dd32" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">模型文件夹是我的下一站。这是我不想复制的主要代码。</p><p id="b23a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是我如何构建模型文件夹的。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/f6c9334d8d6fb0481e9f0c766a642196.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*-PfQ0cLaxnYY2I9z.png"/></div></figure><p id="cdf1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">里面没什么疯狂的东西。唯一值得一提的是，我创建了两个文件夹。一个叫做“管理”的是我们的主CMS。一个名为“我的”,用于客户门户子域。</p><p id="7380" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每个模型都与一个不同的数据库表相关，用于对用户进行身份验证。</p><p id="557d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">其余的模型我不需要接触那么多。当客户登录门户时，我必须添加一些新的函数来加载相关数据。除此之外，在模型部分没什么可做的。</p><h2 id="e3ca" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">收回控制权</h2><p id="49c5" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">现在，这是更多的繁重工作被完成的地方。因为每个站点都需要不同的工作和外观</p><p id="ec45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是我如何构建控制器文件夹。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/107855ced434aa2d2f8eb3f9513a9ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/0*tWRSJc9TklNJWG5h.png"/></div></figure><p id="2fc6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">管理CMS站点和客户门户有单独的文件夹，其中包含特定站点所需的所有控制器。</p><p id="4651" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">没有任何共享代码或某些控制器的重用。这一部分被有意地分开，以保持关注点的分离，以防万一。</p><p id="ed7a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我在配置部分接触了login_redirect.php。这是文件的外观</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="5b1c" class="ku kv in ly b gy mc md l me mf">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br/><br/>class Login_redirect extends CI_Controller {<br/><br/>    function __construct()<br/>    {<br/>        parent::__construct();<br/>    }<br/><br/>    public function index()<br/>    {<br/>        $site = SITE; <br/>        if($site == 'my')<br/>        {           <br/>            redirect("my/mylogin");<br/>        }                     <br/>        redirect("admin/login");<br/>    }<br/>}</span></pre><p id="38bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你回头看看我们构建的hosts.php文件。这个文件决定了我们在哪个网站。根据我们所在的网站，会显示不同的登录屏幕。</p><p id="56fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于这些控制器需要注意的一点是，你必须确保你继承了主控制器。在本例中是ADMIN_controller.php</p><p id="d0b3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个用于客户门户的home.php控制器的示例。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="52d4" class="ku kv in ly b gy mc md l me mf">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br/><br/>class Home extends ADMIN_Controller {<br/><br/>    function __construct()<br/>    {<br/>        parent::__construct();<br/>        $this-&gt;load-&gt;model('entry_model');<br/>        $this-&gt;load-&gt;model('client_contact_model');<br/>    }<br/><br/>    public function index()<br/>    {<br/>        $places = $this-&gt;entry_model-&gt;get_total_for_client($this-&gt;session-&gt;userdata('client_id'));<br/>        $contacts = $this-&gt;client_contact_model-&gt;get_total_for_client($this-&gt;session-&gt;userdata('client_id'));<br/>        $data['contacts'] = $contacts;<br/>        $data['title'] = 'Home';<br/>        $data['main_content'] = 'my/home/index';<br/>        $data['places'] = $places;<br/>        $data['contacts'] = $contacts;<br/>        $this-&gt;load-&gt;view('my/includes/template', $data);<br/>    }<br/><br/>}</span></pre><p id="4984" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您会注意到“Home extends ADMIN_Controller”行。如果没有设置，你可能会遇到很多重定向和用户认证的问题。</p><h2 id="3a8e" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">观看杀戮</h2><p id="3727" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">如同控制器一样。当创建向用户呈现html的视图时。每个网站都有自己的文件夹，“管理”和“我的”</p><p id="0d3c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，我这样做是为了分离关注点。管理CMS是非常基本的，客户门户的目标是让我们的客户看起来更容易。</p><p id="da88" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每个部分都有自己的“includes”文件夹，以模板文件的形式呈现页眉、页脚和主要内容。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/67558090bf8e1090e62e3958e1cdb9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/0*MqNa_cQcY4iA_nUE.png"/></div></figure><p id="c4f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是template.php文件在客户门户中的样子。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="b704" class="ku kv in ly b gy mc md l me mf">&lt;?php $this-&gt;load-&gt;view('my/includes/header'); ?&gt;<br/>&lt;?php $this-&gt;load-&gt;view($main_content); ?&gt;<br/>&lt;?php $this-&gt;load-&gt;view('my/includes/footer'); ?&gt;</span></pre><p id="a7cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用正确的模板呈现页面。在每个控制器中，我需要做的就是调用下面几行代码</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="6057" class="ku kv in ly b gy mc md l me mf">data['title'] = 'Home';<br/>$data['main_content'] = 'my/home/index';<br/>$this-&gt;load-&gt;view('my/includes/template', $data);</span></pre><p id="0259" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将向登录用户显示正确的html。</p><h2 id="386f" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">拇指向上或拇指向下</h2><p id="eab7" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">这就是了。我能够快速重用我已经编写的大量代码来启动和运行新的客户门户。</p><p id="5e05" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我唯一需要关注的是获得正确的信息，并以更漂亮的方式显示给用户。</p><p id="a0cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想了解更多关于我使用Codeigniter的项目。或者有任何问题请<a class="ae kt" href="https://philliphughes.co.uk/get-in-touch/" rel="noopener ugc nofollow" target="_blank">联系</a>。干杯</p></div></div>    
</body>
</html>