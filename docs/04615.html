<html>
<head>
<title>Everything you need to know about Spring Data JPA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于 Spring Data JPA 你需要知道的一切</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/everything-you-need-to-know-about-spring-data-jpa-e52bd8606ff9?source=collection_archive---------3-----------------------#2021-04-11">https://blog.devgenius.io/everything-you-need-to-know-about-spring-data-jpa-e52bd8606ff9?source=collection_archive---------3-----------------------#2021-04-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="37a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我涵盖了您需要了解的关于 Spring Data JPA 的所有内容，这样您就可以在您的 Spring Boot 应用程序中更自信地使用这个库。我已经看到了很多关于何时使用<code class="fe ki kj kk kl b">CrudRepository</code>或<code class="fe ki kj kk kl b">JpaRepository</code>的困惑，所以我也将涉及到这一点。</p><h1 id="0df5" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是 Spring Data JPA？</h1><p id="5cf1" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">正如 Spring 的官方文档所说,“Spring Data JPA 使得实现基于 JPA 的存储库变得容易。它改进并简化了基于 JPA 的数据访问层的实现。总的来说，数据访问应用程序更容易实现。”</p><p id="c189" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 Spring Data JPA，可以避免应用程序中大量 Java 持久 API (JPA)的样板代码。该库还使得从数据库中查询数据变得容易，减少了开发人员对 SQL 查询的大量实现。</p><p id="af70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为开发人员，您只需编写包括任何自定义方法的存储库接口，Spring Data JPA 将自动提供大部分实现。</p><h1 id="9d60" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么时候使用 Spring 数据 JPA？</h1><p id="91eb" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">什么时候使用 Spring 数据 JPA 实际上取决于你的用例。但是大多数 Spring 应用程序都需要数据对象。如果你有数据对象，你将需要一种方法来访问它们，使用它们进行交易。</p><p id="26d3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您正在构建一个基于数据库的 web 应用程序，那么您将最终创建代表您的数据库实体的对象。当一个层访问这些对象或创建存储在数据库中的数据时，您将需要访问 API。你可以实现<code class="fe ki kj kk kl b">repository</code>接口，它将提供基本的 CRUD 操作。程序员甚至不需要实现这些接口方法。</p><p id="a057" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您还可以在这些存储库接口中添加自定义方法。</p><ol class=""><li id="630c" class="lq lr in jm b jn jo jr js jv ls jz lt kd lu kh lv lw lx ly bi translated">在接口中创建新方法</li><li id="09a3" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh lv lw lx ly bi translated">编写 JPQL 查询，并在查询开始处添加注释<code class="fe ki kj kk kl b">@Query</code>。</li><li id="1746" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh lv lw lx ly bi translated">也可以编写 JPA 命名查询</li></ol><p id="8946" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Spring Data JPA 的其他一些主要特性是:</p><ol class=""><li id="4def" class="lq lr in jm b jn jo jr js jv ls jz lt kd lu kh lv lw lx ly bi translated">域类的审计</li><li id="0dda" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh lv lw lx ly bi translated">在批量加载、动态查询中很有用</li><li id="df8a" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh lv lw lx ly bi translated">支持实体的 XML 映射</li></ol><h1 id="f86f" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Spring 数据 JPA 库的详细信息</h1><p id="8bc7" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">在您的应用程序中，您可以轻松地包含依赖关系，如下所示:</p><pre class="me mf mg mh gt mi kl mj mk aw ml bi"><span id="decf" class="mm kn in kl b gy mn mo l mp mq">implementation 'org.springframework.boot:spring-boot-starter-data-jpa'</span></pre><p id="2795" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，要启用 JPA 存储库，请向主应用程序类添加以下注释:</p><pre class="me mf mg mh gt mi kl mj mk aw ml bi"><span id="0092" class="mm kn in kl b gy mn mo l mp mq">@EnableJpaRepositories(basePackages = "com.betterjavacode.modelmapperdemo")</span></pre><p id="6812" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，要为您的任何域对象添加存储库，您可以创建一个扩展<code class="fe ki kj kk kl b">JpaRepository</code>或<code class="fe ki kj kk kl b">CrudRepository</code>的接口。</p><p id="a8bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将如下所示:</p><pre class="me mf mg mh gt mi kl mj mk aw ml bi"><span id="c9d3" class="mm kn in kl b gy mn mo l mp mq">@Repository<br/>public interface OrderRepository extends JpaRepository&lt;Order, Long&gt;<br/>{<br/>    List findAllByCustomer (Customer customer);<br/>}</span></pre><p id="dd0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如您在上面看到的，我们添加了一个新的接口，它代表了一个域对象<code class="fe ki kj kk kl b">Order</code>。我还添加了一个自定义方法<code class="fe ki kj kk kl b">findAllByCustomer</code>。JPA 命名查询将负责这个方法的实现，以获取客户的所有订单。</p><h1 id="f8c9" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置</h1><p id="15b2" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">Spring Boot 将 Hibernate 配置为默认的 JPA 提供者。如果您想要定制这个配置或者改变默认的 JPA 提供者，您将不得不在您的 Spring 配置中创建一个<code class="fe ki kj kk kl b">entityManagerFactory</code> bean。</p><pre class="me mf mg mh gt mi kl mj mk aw ml bi"><span id="eec6" class="mm kn in kl b gy mn mo l mp mq">@Configuration<br/>@EnableTransactionManagement<br/>@EnableJpaRepositories("com.betterjavacode.modelmapperdemo")<br/>@PropertySource("classpath:application.properties")<br/>public class DataConfig {<br/><br/>	private final String PROPERTY_DRIVER = "driver";<br/>	private final String PROPERTY_URL = "url";<br/>	private final String PROPERTY_USERNAME = "user";<br/>	private final String PROPERTY_PASSWORD = "password";<br/>	private final String PROPERTY_SHOW_SQL = "hibernate.show_sql";<br/>	private final String PROPERTY_DIALECT = "hibernate.dialect";<br/><br/>	@Autowired<br/>	Environment environment;<br/><br/>	@Bean<br/>	LocalContainerEntityManagerFactoryBean entityManagerFactory() {<br/>		LocalContainerEntityManagerFactoryBean lfb = new LocalContainerEntityManagerFactoryBean();<br/>		lfb.setDataSource(dataSource());<br/>		lfb.setPersistenceProviderClass(HibernatePersistence.class);<br/>		lfb.setPackagesToScan("com.betterjavacode.modelmapperdemo");<br/>		lfb.setJpaProperties(hibernateProps());<br/>		return lfb;<br/>	}<br/><br/>	@Bean<br/>	DataSource dataSource() {<br/>		DriverManagerDataSource ds = new DriverManagerDataSource();<br/>		ds.setUrl(environment.getProperty(PROPERTY_URL));<br/>		ds.setUsername(environment.getProperty(PROPERTY_USERNAME));<br/>		ds.setPassword(environment.getProperty(PROPERTY_PASSWORD));<br/>		ds.setDriverClassName(environment.getProperty(PROPERTY_DRIVER));<br/>		return ds;<br/>	}<br/><br/>	Properties hibernateProps() {<br/>		Properties properties = new Properties();<br/>		properties.setProperty(PROPERTY_DIALECT, environment.getProperty(PROPERTY_DIALECT));<br/>		properties.setProperty(PROPERTY_SHOW_SQL, environment.getProperty(PROPERTY_SHOW_SQL));<br/>		return properties;<br/>	}<br/><br/>	@Bean<br/>	JpaTransactionManager transactionManager() {<br/>		JpaTransactionManager transactionManager = new JpaTransactionManager();<br/>		transactionManager.setEntityManagerFactory(entityManagerFactory().getObject());<br/>		return transactionManager;<br/>	}<br/>}</span></pre><p id="ddee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的代码显示了如果您计划定制默认休眠配置，如何添加配置。</p><ul class=""><li id="7a97" class="lq lr in jm b jn jo jr js jv ls jz lt kd lu kh mr lw lx ly bi translated"><code class="fe ki kj kk kl b">@EnableTransactionManagement</code> -启用应用程序中的事务，尤其是在创建或更新数据时。</li><li id="192f" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh mr lw lx ly bi translated"><code class="fe ki kj kk kl b">@PropertySource</code> -读取将在数据源 bean 中使用的应用程序属性。</li></ul><p id="52e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如前所述，Spring Boot 使用 Hibernate 作为默认的持久性提供者。但是很少有像 OpenJPA 或 EclipseLink 这样的持久性提供者。</p><h1 id="40f8" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">CrudRepository 和 JpaRepository 的区别</h1><p id="f524" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">我们之前讨论过创建扩展<code class="fe ki kj kk kl b">JpaRepository</code>或<code class="fe ki kj kk kl b">CrudRepository</code>的存储库接口。但是什么时候用哪个呢？在这一节中，我将阐明关于这些存储库接口的更多细节。</p><p id="9df9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ki kj kk kl b">CrudRepository</code>是基础接口。<code class="fe ki kj kk kl b">JpaRepository</code>延伸<code class="fe ki kj kk kl b">PagingAndSortingRepository</code>，T9 又延伸<code class="fe ki kj kk kl b">CrudRepository</code>。</p><figure class="me mf mg mh gt mt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d0bafb64bee589777809f266201d6ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/0*8JBPUYrhf0Q8K-J0"/></div></figure><ul class=""><li id="4720" class="lq lr in jm b jn jo jr js jv ls jz lt kd lu kh mr lw lx ly bi translated"><code class="fe ki kj kk kl b">CrudRepository</code> -这提供了 CRUD 功能。</li><li id="465d" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh mr lw lx ly bi translated"><code class="fe ki kj kk kl b">PagingAndSortingRepository</code> -为可排序和可分页的数据提供功能。</li><li id="5515" class="lq lr in jm b jn lz jr ma jv mb jz mc kd md kh mr lw lx ly bi translated"><code class="fe ki kj kk kl b">JpaRepository</code> - JpaRepository 提供了 JPA 相关的函数来刷新持久性上下文以及批量删除数据。</li></ul><p id="2fb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">简而言之，可以使用<code class="fe ki kj kk kl b">JpaRepository</code>，因为它将包含<code class="fe ki kj kk kl b">CrudRepository</code>和<code class="fe ki kj kk kl b">PagingAndSortingRepository</code>中的所有其他方法。</p><h1 id="3c45" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论</h1><p id="1bbb" class="pw-post-body-paragraph jk jl in jm b jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd lo kf kg kh ig bi translated">在这篇文章中，我展示了 Spring Data JPA 库的细节以及如何使用它。我还展示了配置细节和要使用的存储库接口。</p></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="8df7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nd">原载于 2021 年 4 月 11 日</em><a class="ae lp" href="https://betterjavacode.com/spring-boot/everything-you-need-to-know-about-spring-data-jpa" rel="noopener ugc nofollow" target="_blank"><em class="nd">https://betterjavacode.com</em></a><em class="nd">。</em></p></div></div>    
</body>
</html>