<html>
<head>
<title>Scanning Kubernetes YAML Files for Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扫描库本内特 YAML 文件的安全性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/scanning-kubernetes-yaml-files-for-security-e302542b5407?source=collection_archive---------5-----------------------#2022-07-12">https://blog.devgenius.io/scanning-kubernetes-yaml-files-for-security-e302542b5407?source=collection_archive---------5-----------------------#2022-07-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/83dcce18c4e89c50842f3debb2b8d785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eWN6WqJTdpJy8WMQ"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/photos/GCFuprAvC6A" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae jz" href="https://unsplash.com/@ihor_dvoretskyi" rel="noopener ugc nofollow" target="_blank"> Ihor Dvoretskyi </a>在 Unsplash 上拍摄</figcaption></figure><p id="8868" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kubernetes 是一个开源的容器编排系统，它自动化了手动流程，例如部署、管理和扩展容器化的应用程序。Kubernetes 的使用在整个软件行业中呈指数增长，因为它有许多优点。</p><p id="ea75" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">重要的 Kubernetes 资源是 pod、服务和部署，它们是使用 YAML 文件以声明的方式创建的。<a class="ae jz" href="https://en.wikipedia.org/wiki/YAML" rel="noopener ugc nofollow" target="_blank"> YAML </a>(另一种标记语言)被用在配置文件中，因为它提供了更好的可读性并且更加用户友好。它是一种数据序列化语言，可以与任何编程语言并行工作。</p><h2 id="fa39" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">库伯内特斯的 YAML 成分</h2><p id="0838" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">定义 Kubernetes pods、服务和部署的 YAML 文件组件包括:</p><p id="1db5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">pod . YAML</strong>:pod 文件包含关于一个或多个容器的细节以及如何运行这些容器的规范。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="c7cd" class="ky kz in mb b gy mf mg l mh mi">apiVersion: v1 //yaml map<br/>kind: Pod<br/>metadata:<br/>  name: mywebapp<br/>  labels:<br/> role: webserver-role<br/> app: uni_app<br/>spec:  //yaml list<br/>  containers: //Here we are defining a web server container<br/>  - name: webserver<br/> image: uni_app:1.6<br/> ports:<br/>  - containerPort:70</span></pre><p id="8fa2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> service.yaml </strong>:服务用于启用一组 pod 的网络访问，并提供访问它们的协议。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="97da" class="ky kz in mb b gy mf mg l mh mi">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: uni_app-service <br/>  labels:<br/> app: uni_app  //Based on the app label the service will identify the pods with the exact label<br/>spec:<br/>  ports:<br/>  - nodePort: 30500<br/> port: 80<br/> protocol: TCP<br/> targetPort: 80<br/>type: NodePort</span></pre><p id="154e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> deployment.yaml </strong>:负责运行一组 pods，通过副本获取资源冗余。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="5b70" class="ky kz in mb b gy mf mg l mh mi">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: uni_app-deployment<br/>  labels:<br/>    app: uni_app<br/>spec:<br/>  replicas: 2 //As mentioned this deployment will have 2 replicas<br/>  selector:<br/>    matchlabels:<br/>      app: uni_app</span></pre><p id="ac1c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些用于定义<a class="ae jz" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/" rel="noopener ugc nofollow" target="_blank"> Kubernetes 对象</a>的 YAML 文件可能包含需要在初始阶段识别和纠正的安全问题。Kubernetes 本身提供了非常基本的安全措施。但是这些还不足以满足用户受益所需的更高级别的安全性。为了解决这个问题，市场上有开源工具可以扫描安全漏洞和错误配置。这些工具有助于识别漏洞和错误配置，提供纠正问题的解决方案，并有助于查看 Kubernetes 集群的实时健康状况。</p><p id="4563" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 Kubernetes 中提供高级安全性的一个开源工具是 Kubescape。Kubescape 是一款开源工具，用于测试 Kubernetes 是否按照美国国家安全局和 CISA 测试的 Kubernetes 强化指南中的定义进行了部署。</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/47dcdc63ccfb16503dd71a1310186ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2_zoW_i_H-cyS-lc"/></div></div></figure><p id="eec8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 CI/CD 管道的早期阶段，根据框架、软件漏洞和 RBAC(基于角色的访问控制)定义，扫描 K8s 集群、YAML 文件和 HELM 图表以检测错误配置。根据获得的结果，计算风险分值，并显示一段时间内的风险趋势。</p><p id="256f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个工具已经在 K8s 世界中流行起来，因为它具有易于使用的 CLI 界面、灵活的输出格式和自动扫描功能。它使用 OPA 引擎，并使用片段扫描从 API 服务器提取的对象。</p><h2 id="d941" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">Kubescape CLI 及其工作原理</h2><p id="413e" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated"><strong class="kc io"> <em class="mk">安装命令</em> : </strong></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="9368" class="ky kz in mb b gy mf mg l mh mi">curl -s https://raw.githubusercontent.com/armosec/kubescape/master/install.sh | /bin/bash</span></pre><p id="6d28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mk">运行命令:</em> </strong></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="a082" class="ky kz in mb b gy mf mg l mh mi">kubescape scan — submit — enable-host-scan — verbose</span></pre><p id="5ecd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">扫描过程提供<strong class="kc io"> <em class="mk"> </em> </strong>以下内容:下载 Kubernetes 安全的框架定义，建立对其对象的访问并启动安全扫描，根据框架定义扫描 Kubernetes 集群，扫描器检查集群中的容器映像是否满足定义，每个扫描阶段都有一个描述来解释如果不满足安全标准会造成的威胁，在扫描结束时提供控制名称(安全定义)、失败资源、所有资源和风险分值的汇总视图</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="ab gu cl ml"><img src="../Images/9a62c794703fbd0aadacce65572ac54f.png" data-original-src="https://miro.medium.com/v2/0*ai30XiRqcaU8sjFg"/></div></figure><p id="6bb1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在控制失败的情况下，它指示文件中通过测试用例所需的更改。</p><p id="3d25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kubescape 允许你构建你自己的框架来执行测试。它提供了用异常标记某些控件的灵活性，以避免在扫描过程中出现异常。</p><p id="4738" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了确保安全标准，扫描仪扫描集群中的集装箱图像，并将结果显示在 SaaS Kubescape 上。扫描仪由 armo-scan-scheduler 触发。扫描时间可以根据您的需要定制。默认情况下，扫描时间安排在午夜。</p><p id="4e6a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kubescape 的优势在于，它扫描 YAML 文件、集群和舵图以提高安全性，它通过分析过去的扫描来帮助可视化风险趋势，它提供配置扫描、图像扫描、RBAC 可视化工具和合规性，并且它可以轻松集成到许多管道工具中，包括 Jenkins、CircleCI、GitLab、GitHub workflows、Prometheus、Slack 等。</p><h1 id="17ca" class="mm kz in bd la mn mo mp ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc bi translated">结论</h1><p id="482a" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">Kubernetes 为其用户提供了丰富的用途。但是伴随这些优势而来的是提供安全性以获得最大吞吐量的重要性。kubespection 和其他工具极大地促进了开源社区利用 Kubernetes 的优势，而没有数据泄露的风险。</p></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><p id="8c16" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望你觉得这篇文章很有见地。感谢您的阅读！</p></div></div>    
</body>
</html>