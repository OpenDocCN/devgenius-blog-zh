<html>
<head>
<title>Airflow Task Parallelism</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">气流任务并行性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/airflow-task-parallelism-6360e60ab942?source=collection_archive---------3-----------------------#2022-09-15">https://blog.devgenius.io/airflow-task-parallelism-6360e60ab942?source=collection_archive---------3-----------------------#2022-09-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/36ec3d8b972202fb9d41b4e6bd183033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQtr_5fbSqk4huMgz3nU9w.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated"><a class="ae ja" href="https://unsplash.com/@mikeenerio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">迈克·埃尼奥</a>在<a class="ae ja" href="https://unsplash.com/s/photos/railway-track?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="da5c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如何控制并发</p><p id="9e4e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">气流允许我们并行运行多个任务。同时，气流是高度可配置的，因此它公开了各种配置参数来控制并行的数量。在这篇博客中，我们将看到控制可以并行运行的任务数量的配置选项列表。</p><p id="26dd" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些配置可以分为三大类</p><blockquote class="ky kz la"><p id="6bf9" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated">安装级别<br/> DAG 级别<br/>任务级别</p></blockquote><p id="de30" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果不存在冲突，更具体的配置优先于通用配置(任务&gt; DAG &gt;安装)。在冲突的情况下，最严格的配置生效。</p><p id="8240" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们详细了解一下配置。</p><h1 id="7fc9" class="lf lg jd bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">安装级别</h1><h2 id="d07d" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">平行</h2><p id="d704" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了在 Airflow 中每个调度程序可以同时运行的任务实例的最大数量。由于这种配置是针对每个调度程序的，如果其他配置允许，拥有两个调度程序将使并发运行任务的最大数量加倍。所有处于<code class="fe mu mv mw mx b">RUNNING, QUEUED</code>状态的任务都计入该限制。默认值为 32。</p><h2 id="b973" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">最大活动任务数</h2><p id="6a45" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这为 DAG 的所有活动运行定义了处于<code class="fe mu mv mw mx b">RUNNING, QUEUED</code>状态的任务实例的最大数量。默认值为 16。</p><p id="d7af" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">早期版本使用<code class="fe mu mv mw mx b">DAG_CONCURRENCY</code> <strong class="kc je"> </strong>进行此设置。</p><h2 id="03cb" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated"><strong class="ak">默认</strong>_ 池化 _ 任务 _ 槽位 _ 计数</h2><p id="f152" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">此参数定义池中可用的总插槽数。降低该值会导致并行度降低，因为运行的任务数量较少。默认值为 128。</p><h2 id="7538" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">最大有效运行次数每 DAG</h2><p id="f0e3" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了 DAG 的活动 DAG 运行的最大数量。如果达到此限制，计划程序将不再创建任何 DAG 运行。默认值为 16。</p><h2 id="29df" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">多个调度程序</h2><p id="ad68" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">借助 Airflow 2.0+可以在 Airflow 中运行多个调度程序。我们可以通过增加调度器的数量来增加任务的并发性。这将增加调度程序级别的任务并发集。这不适用于旧版本(1。*)的气流。</p><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi my"><img src="../Images/91f43c919d094a65f4c64d18a8b40142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XQoq6q5_huRF-fFS0jm04g.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">判断气流的并行性配置是否阻碍新任务调度的决策流程</figcaption></figure><h1 id="f6fb" class="lf lg jd bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">DAG 级别</h1><h2 id="c066" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">最大活动任务数</h2><p id="3203" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了允许在特定 DAG 的所有活动 DAG 运行中运行的任务实例的最大数量。如果未设置，它将退回到<code class="fe mu mv mw mx b">MAX_ACTIVE_TASK_PER_DAG</code>。早期版本的 airflow 使用<code class="fe mu mv mw mx b">concurrency</code>参数来设置这种控制。</p><h2 id="eac4" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">最大有效运行次数</h2><p id="398c" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了给定 DAG 的活动运行的最大数量。如果没有明确设置，默认为<code class="fe mu mv mw mx b">max_active_runs_per_dag</code>。</p><pre class="mz na nb nc gt nd mx ne nf aw ng bi"><span id="38f6" class="md lg jd mx b gy nh ni l nj nk">d = DAG('my_cool_dag', max_active_tasks=10, max_active_runs=2)<br/>d = DAG('my_cool_dag', concurrency=10, max_active_runs=2)</span></pre><h1 id="84b9" class="lf lg jd bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">任务级别</h1><h2 id="b09f" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">泳池</h2><p id="4e42" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了任务将在哪个池中执行。池可以用来限制一些<em class="lb"> </em>任务的逻辑集合的并行性。每个任务将从池槽中占用规定数量的槽，当消耗的槽数达到最大槽数时，将不再有任务排队。</p><p id="c1b9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个池的默认插槽数是 128。</p><h2 id="131e" class="md lg jd bd lh me mf dn ll mg mh dp lp kl mi mj lt kp mk ml lx kt mm mn mb mo bi translated">最大活动时间</h2><p id="d078" class="pw-post-body-paragraph ka kb jd kc b kd mp kf kg kh mq kj kk kl mr kn ko kp ms kr ks kt mt kv kw kx ig bi translated">这定义了此任务在所有活动 DAG 运行中的活动任务实例的最大数量。在早期版本中，它是使用参数<code class="fe mu mv mw mx b">task_concurrency</code>定义的。</p><pre class="mz na nb nc gt nd mx ne nf aw ng bi"><span id="7acf" class="md lg jd mx b gy nh ni l nj nk">t1 = Operator('task_id', pool='critical', task_concurrency=3)<br/>t1 = Operator('task_id', pool='critical', max_active_tis_per_dag=3)</span></pre><p id="f9bb" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">流水线作业快乐！！！</p></div></div>    
</body>
</html>