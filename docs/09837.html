<html>
<head>
<title>Developing a web application with Ktor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Ktor 开发 web 应用程序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/series-developing-a-web-application-with-ktor-9d43af28cc?source=collection_archive---------6-----------------------#2022-09-16">https://blog.devgenius.io/series-developing-a-web-application-with-ktor-9d43af28cc?source=collection_archive---------6-----------------------#2022-09-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b335e56674b3c561e14ddb8538faf56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dX5WByhliJbHx-hl9pgnHQ.png"/></div></div></figure><p id="3bdc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我以前的文章中，我主要介绍了 Kotlin 生态系统中的几个框架，使用了非常基本的例子。这个例子只涵盖了相应框架提供的一小部分功能。为了展示这些框架如何在更真实的应用程序中协同工作，我构建了一个更复杂的示例，它涵盖了所用框架的不同特性，还包括一些特殊情况。</p><p id="0434" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这一系列文章中，我将展示如何开发一个 web 应用程序，它由一个服务器后端和一个 web 客户端组成。该应用程序的基础是由 Kotlin 生态系统的其他几个框架扩展的<strong class="jx io"> Ktor </strong>框架。</p><p id="b2a0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">应用程序开发是以增量方式完成的，还包含在后续步骤中恢复/更新的中间步骤。我也会定期进行重构，只要我觉得代码越来越差，需要改进。我并不打算从一开始就展示一个完美的最终解决方案，而是在并行撰写本系列文章的同时逐步开发。为了保持简短，本文中没有显示所有步骤，但是在包含应用程序代码的 Github 存储库的提交历史中是可见的。</p><p id="a470" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些文章将涵盖以下主题:</p><ul class=""><li id="d64c" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">需求规格</li><li id="8e8f" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">申请的结构</li><li id="2c05" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">服务器后端应用程序—设置</li><li id="422b" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">服务器后端应用程序—持久性</li><li id="7274" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">服务器后端应用程序—业务逻辑</li><li id="0e86" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">服务器后端应用程序— API 接口</li><li id="b518" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">服务器后端应用程序—身份验证+安全性+用户角色</li><li id="9c1e" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">前端 web 客户端—设置+用户界面</li><li id="31c7" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">前端 web 客户端—API 连接+身份验证</li><li id="384c" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">文档+应用交付</li><li id="5933" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">结论</li></ul><p id="7acb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为我在开发过程中写文章，还没有完成最终版本，所以这个系列有多少文章还不确定。这些要求是最终的，我也有一个想法如何实现它们，但细节和缺点直到现在还不清楚。大约在 7 点到 8 点之间。我不喜欢太大的文章，因此我会在一个需求被实现并且文章有大约 8-10 分钟的长度时，将文章拆分。</p><p id="fce9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我会一篇接一篇地发表这些文章(不是一次全部)，并尝试每隔两到三周发表一篇。</p><h1 id="a4ee" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated"><strong class="ak">需求规格</strong></h1><p id="6ffe" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">在第一部分中，我描述了应用程序应该解决的需求，并概述了计划的应用程序的结构。</p><p id="3935" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在接下来的文章中，这些需求是指导方针，也是我在逐步开发过程中唯一需要解决的部分。</p><p id="4864" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要开发的应用程序是一个简单的<strong class="jx io">银行应用程序</strong>，它支持如下一般功能</p><ul class=""><li id="e959" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">创建/更新/删除用户</li><li id="b547" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">为用户添加/更新/删除帐户</li><li id="d674" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">在两个用户帐户之间创建交易</li><li id="5d35" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">为管理员显示所有帐户的历史记录</li><li id="7a33" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">管理员删除交易</li></ul><p id="11b8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">应用程序有<strong class="jx io">一般</strong>要求:</p><ul class=""><li id="da3d" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">使用 Kotlin 原生框架(如果可能的话)。<strong class="jx io"> Ktor </strong>是应用程序的基础框架。</li><li id="58b9" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">该应用程序应该可用于浏览器和 REST API 客户端。</li><li id="6037" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">对于浏览器和 API 客户端的用户应该有一个认证机制。不经过验证就执行请求应该是不可能的。</li><li id="12e8" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">有两种可用的应用程序用户角色:用户和管理员</li><li id="8580" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">前端应用程序和后端应用程序之间的通信应该使用 REST 来完成。</li><li id="3d38" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该记录所有请求。</li><li id="7d6e" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应用程序应该作为 docker 图像交付。</li><li id="0eba" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">API 端点使用 OpenAPI 规范进行记录。</li></ul><p id="8db0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，应用程序还应涵盖以下<strong class="jx io">用例</strong>:</p><h1 id="d6a3" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">用户角色:</h1><p id="5954" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated"><strong class="jx io">用户</strong></p><ul class=""><li id="9451" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">用户由以下属性组成:<em class="mk"> userId </em>(唯一)<em class="mk">名</em>，<em class="mk">姓</em>，<em class="mk">生日</em>，<em class="mk">创建日期</em>，<em class="mk">最后更新</em>。</li><li id="b221" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">用户必须年满 18 岁。</li><li id="43c8" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">只能创建一个名<em class="mk">名</em>、<em class="mk">姓</em>和<em class="mk">生日</em>相同的用户。</li><li id="9051" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以创建新用户。</li><li id="68d1" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以删除一个现有的用户。</li><li id="7094" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以编辑除<em class="mk">用户 Id </em>之外的所有用户数据。</li><li id="1c27" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">用户正在创建过程中设置初始密码。</li><li id="a537" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">密码至少需要 16 个字符，包含数字、小写和大写字母以及特殊字符。</li><li id="9f90" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">用户密码可以更改。</li><li id="f449" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">一个用户可以有多个帐户。</li></ul><p id="2336" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">账户:</strong></p><ul class=""><li id="6b60" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">账户由以下属性组成:<em class="mk">名称</em>(每个用户唯一)<em class="mk">账户 id </em>(唯一)<em class="mk">余额</em>，<em class="mk">显示</em>，<em class="mk">限额</em>，<em class="mk">创建日期</em>，<em class="mk">最后更新</em>。</li><li id="3069" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以为现有用户创建帐户。创建一个没有用户的帐户应该是不可能的。</li><li id="d387" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">一个帐户只能由一个用户拥有。</li><li id="bfce" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以删除现有账户(用户-账户关系被删除，但账户仍然存在，以保证交易历史)。</li><li id="b15a" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以编辑除<em class="mk">账户 id </em>和<em class="mk">余额</em>之外的账户数据。</li><li id="79a1" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">一个帐户可以有多个交易(作为源或作为目标部分)。</li></ul><p id="fa93" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">交易</strong>:</p><ul class=""><li id="0f36" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">该交易由以下属性组成:<em class="mk">交易 id </em>(唯一)、<em class="mk">发起账户</em>、<em class="mk">目标账户</em>、<em class="mk">金额</em>、<em class="mk">创建日期</em>。</li><li id="a279" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">一个交易只能持有一个正数。</li><li id="e108" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该可以创建两个帐户之间的交易。</li><li id="e9ef" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">应该不可能更新或删除交易。</li><li id="ecfd" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">仅当两个帐户的更新余额成功时，才创建交易。</li></ul><h1 id="9c3b" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">管理员角色</h1><ul class=""><li id="e319" class="kt ku in jx b jy mf kc mg kg ml kk mm ko mn ks ky kz la lb bi translated">管理员可以通过 API 或浏览器使用该应用程序。</li><li id="cbfb" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">对于管理员，存在预定义的数据集(不可能创建新的管理员)。</li><li id="5ae9" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">管理员可以重置每个用户的密码。</li><li id="0f81" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">管理员对所有帐户的所有交易都有一个概览。</li><li id="af3f" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">管理员可以删除交易(这将更新源帐户和目标帐户的余额)。</li></ul><h1 id="61d2" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">申请的结构</h1><p id="8ea5" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">该应用程序包含两个部分——后端<strong class="jx io"> Ktor </strong>服务器应用程序和前端 web 客户端应用程序。前端与服务器后端分离，以便于交换。</p><p id="d20d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是对用于两个应用部分的框架/工具的概述。</p><p id="b08b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">科技栈</strong></p><p id="45e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">后端:</p><ul class=""><li id="2c4e" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">格拉德勒</li><li id="e5cc" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">科特林</li><li id="0404" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">Ktor</li><li id="c42a" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">柯因</li><li id="3153" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">暴露的</li><li id="37d3" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">光</li><li id="63b3" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">氘</li><li id="b59d" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">液态碱</li></ul><p id="ef94" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">前端:</p><ul class=""><li id="f7cc" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">格拉德勒</li><li id="977e" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">科特林/JS</li><li id="123a" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">反应</li><li id="ae89" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">引导程序</li></ul><p id="d800" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有了这个概述，我的系列的第一部分就完成了，是时候开始开发了。在下一篇文章中，我将从后端<strong class="jx io"> Ktor </strong>服务器应用程序开始。</p></div></div>    
</body>
</html>