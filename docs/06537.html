<html>
<head>
<title>Django Import Export Tricks &amp; Tips</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 进出口技巧和提示</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/django-import-export-tricks-tips-562e45da35b6?source=collection_archive---------3-----------------------#2022-01-15">https://blog.devgenius.io/django-import-export-tricks-tips-562e45da35b6?source=collection_archive---------3-----------------------#2022-01-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="98de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用导入导出及其特殊功能的提示</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="cf40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Django 的特殊库<a class="ae kp" href="https://django-import-export.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Django Import Export </a>使得在 Django 中导入导出数据变得更加容易。对于基本的实现和功能，请参考我的<a class="ae kp" href="https://vinaykumarmaurya30.medium.com/import-data-using-django-import-export-library-479871df2536" rel="noopener">以前的故事</a>。在这个故事中，我将谈论一些打破常规的场景。</p><p id="c1de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意——所有进出口操作都将通过 Django admin 完成。</p><p id="385f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们清除模型结构，我将在这里使用。</p><p id="55c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在模型中. py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="9e8e" class="kz la in kv b gy lb lc l ld le">class Country(models.Model):<br/>    name = models.CharField(max_length=30)<br/>    code = models.CharField(max_length=10)<br/>    status = models.IntegerField(default=1)<br/>    created_at = models.DateTimeField(auto_now=True)<br/>    updated_at = models.DateTimeField(auto_now_add=True)<br/><br/>    def __str__(self):<br/>        return self.name<br/><br/><br/>class Hobby(models.Model):<br/>    name = models.CharField(max_length=30)<br/>    status = models.IntegerField(default=1)<br/>    created_at = models.DateTimeField(auto_now=True)<br/>    updated_at = models.DateTimeField(auto_now_add=True)<br/><br/>    def __str__(self):<br/>        return self.name<br/><br/><br/>class SkillCategory(models.Model):<br/>    name = models.CharField(max_length=20)<br/>    status = models.IntegerField(default=1)<br/>    created_at = models.DateTimeField(auto_now=True)<br/>    updated_at = models.DateTimeField(auto_now_add=True)<br/><br/>    def __str__(self):<br/>        return self.name<br/><br/><br/>class Skill(models.Model):<br/>    skill_type = models.ForeignKey(SkillCategory,on_delete=models.CASCADE)<br/>    name = models.CharField(max_length=20)<br/>    status = models.IntegerField(default=1)<br/>    created_at = models.DateTimeField(auto_now=True)<br/>    updated_at = models.DateTimeField(auto_now_add=True)<br/><br/>    def __str__(self):<br/>        return "{} - {}".format(self.skill_type.name,self.name)<br/><br/><br/>class PersonDetail(models.Model):<br/>    GENDER = (<br/>        ('M','Male'),<br/>        ('F','Female')<br/>    )<br/>    user = models.ForeignKey(User,null=True,blank=True,on_delete=models.CASCADE)<br/>    name = models.CharField(verbose_name='display name',max_length=20,help_text='Name of the Person')<br/>    gender = models.CharField(max_length=10,choices=GENDER)<br/>    dob = models.DateField()<br/>    mobile = models.IntegerField()<br/>    email = models.EmailField()<br/>    aadhaar = models.IntegerField()<br/>    country = models.ForeignKey(Country,on_delete=models.CASCADE)<br/>    address = models.TextField()<br/>    hobby = models.ManyToManyField(Hobby,null=True)<br/>    skill = models.ManyToManyField(Skill,null=True)<br/>    internal_status = models.CharField(max_length=20,choices=(('active','Active'),('suspended','Suspended')),null=True,blank=True)<br/>    status = models.IntegerField(default=1)<br/>    creation_time = models.TimeField(null=True,blank=True)<br/>    created_at = models.DateTimeField(auto_now=True)<br/>    updated_at = models.DateTimeField(auto_now_add=True)<br/><br/>    def __str__(self):<br/>        return '{} - {}'.format(self.name,self.email)</span></pre><p id="be01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我的主模型类是<strong class="jm io"> PersonDetail </strong>，其中<strong class="jm io"> Country </strong>模型是外键字段，而<strong class="jm io">爱好&amp;技能</strong>字段是多对多字段。现在让我们为基本导入编写资源类。</p><p id="99f1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 resources.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="1547" class="kz la in kv b gy lb lc l ld le">from django.contrib.auth.models import User<br/>from import_export import resources, fields<br/>from import_export.widgets import ForeignKeyWidget, ManyToManyWidget,DateWidget<br/>from .models import Country, Hobby, PersonDetail, Skill</span><span id="1a5c" class="kz la in kv b gy lf lc l ld le">class PersonDetailsAdminResource(resources.ModelResource):<br/>    user = fields.Field(column_name='user', attribute='user', widget=ForeignKeyWidget(User, field='username'))<br/>    country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))<br/>    hobby = fields.Field(column_name='hobby', attribute='hobby', widget=ManyToManyWidget(Hobby, field='name'))<br/>    skill = fields.Field(column_name='skill', attribute='skill', widget=ManyToManyWidget(model=Skill,field='name'))<br/>   <br/><br/>    class Meta:<br/>        model = PersonDetail<br/>        fields = (<br/>            'id',<br/>            'user',<br/>            'name',<br/>            'gender',<br/>            'dob',<br/>            'mobile',<br/>            'email',<br/>            'aadhaar',<br/>            'country',<br/>            'address',<br/>            'hobby',<br/>            'skill'<br/>        )</span></pre><p id="fbaa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在模型管理中添加这个资源类。在 admin.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="ac0a" class="kz la in kv b gy lb lc l ld le">class PersonDetailAdmin(ImportExportModelAdmin):<br/>    list_display = ('name','mobile','email','account_actions')<br/>    resource_class = PersonDetailsAdminResource</span><span id="41cb" class="kz la in kv b gy lf lc l ld le">admin.site.register(PersonDetail,PersonDetailAdmin)</span></pre><p id="f5ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导入示例文件数据。In person_detail.csv</p><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lg"><img src="../Images/cd5a6fa39dcd3b70ddb91619831768e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opL5Kz8kKLieRJmsS6S9DQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">person_detail.csv</figcaption></figure><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ls"><img src="../Images/e40e4d23a7c81174271e23bef0c0eb5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApMk3c58BBWL_91GN9FvOQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">导入预览</figcaption></figure><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lt"><img src="../Images/9768eb2b8f44f97487ff54341eca5210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PgT6RIJI1N6YhmzHvWuxgQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">导入的数据</figcaption></figure><h1 id="f6ff" class="lu la in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">在外键和 ManyToMany 字段中查找</h1><p id="69a8" class="pw-post-body-paragraph jk jl in jm b jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh ig bi translated">默认情况下，导入导出库在外键字段中提供查找字段功能。查找字段默认使用主键(<code class="fe mw mx my kv b"><strong class="jm io">pk</strong></code>)作为查找标准，但可以定制为使用相关模型上的任何字段。</p><p id="407b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如—</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="feed" class="kz la in kv b gy lb lc l ld le"><strong class="kv io">class</strong> <strong class="kv io">Meta</strong>:<br/>    fields = ('country__name',)</span></pre><p id="fe2c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者使用<strong class="jm io"> ForeignKeyWidget </strong>。它的优点是不仅可以用于导出，还可以导入具有外键关系的数据。</p><p id="5c92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如—</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="3f70" class="kz la in kv b gy lb lc l ld le">country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))</span></pre><p id="449a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然对于<strong class="jm io"> ManyToMany </strong>字段<strong class="jm io"> ManyToManyWidget </strong>不支持字段查找，但是我们可以对其进行定制以支持查找。</p><p id="b42f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">想象一下，我有一个 m2m 技术领域，拥有这些数据。</p><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mz"><img src="../Images/981aed94fb7766031b4435b30eb75a31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RF4BVnH_Qu9z33DQ-p1ooQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">技能</figcaption></figure><p id="640f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有两种技能——网络和后台。我不想一个一个的提到某个类别的所有技能，我想提到类别名称，这样所有的技能都可以一次导入到那个类别中。</p><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d831b2e5a5fa39212f2243c51b10213c.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*utnOWeBemSx2OEPNQ5GNMw.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">1.按技能名称导入技能</figcaption></figure><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/146227977b4fae4829968da5c6ec7ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*YWsD3VtoCwgsFjbcFOdZhw.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">2.按技能类别导入技能</figcaption></figure><p id="1e58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的第一个截图是按技能名称导入技能，但我们希望它按技能类别导入，任何属于上述类别的技能都将被导入。为此，我们需要在 m2m 小部件中进行一些定制。</p><p id="7b4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">widgets.py 中</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="08d7" class="kz la in kv b gy lb lc l ld le">class CustomManyToManyWidget(widgets.ManyToManyWidget):<br/><br/>    def __init__(self, model, separator=None, field=None, *args, **kwargs):<br/>        self.lookup_field = kwargs.get('lookup_field', None)<br/>        super(CustomManyToManyWidget, self).__init__(model)<br/>        self.field=field<br/><br/><br/><br/>    def clean(self, value, row=None, *args, **kwargs):<br/>        if not value:<br/>            return self.model.objects.none()<br/>        if isinstance(value, (float, int)):<br/>            ids = [int(value)]<br/>        else:<br/>            ids = value.split(self.separator)<br/>            ids = filter(None, [i.strip() for i in ids])<br/><br/>        return self.model.objects.filter(**{"{}__{}__in".format(self.field,self.lookup_field):ids})</span></pre><p id="e490" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们添加了一个名为<strong class="jm io"> lookup_field </strong>的可选字段，并修改了<strong class="jm io"> clean 方法。</strong></p><p id="7873" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 resources.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="3631" class="kz la in kv b gy lb lc l ld le">from django.contrib.auth.models import User<br/>from import_export import resources, fields<br/>from import_export.widgets import ForeignKeyWidget, ManyToManyWidget,DateWidget<br/>from .models import Country, Hobby, PersonDetail, Skill<br/>from .widgets import ForeignkeyRequiredWidget, CustomManyToManyWidget<br/><br/><br/>class PersonDetailsAdminResource(resources.ModelResource):<br/>    user = fields.Field(column_name='user', attribute='user', widget=ForeignKeyWidget(User, field='username'))<br/>    country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))<br/>    hobby = fields.Field(column_name='hobby', attribute='hobby', widget=ManyToManyWidget(Hobby, field='name'))<br/>    <strong class="kv io">skill = fields.Field(column_name='skill', attribute='skill', widget=CustomManyToManyWidget(model=Skill,field='skill_type',lookup_field='name'))</strong><br/><br/><br/>    class Meta:<br/>        model = PersonDetail<br/>        fields = (<br/>            'id',<br/>            'user',<br/>            'name',<br/>            'gender',<br/>            'dob',<br/>            'mobile',<br/>            'email',<br/>            'aadhaar',<br/>            'country',<br/>            'address',<br/>            'hobby',<br/>            'skill'<br/>        )</span></pre><p id="a757" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以走了。</p><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nc"><img src="../Images/77953f9977acf9e5c203cb6be1637117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0AhbVdcOYHgpKrPFfe9KGw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">m2m_lookup_sample.csv</figcaption></figure><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nd"><img src="../Images/4ba90513e18e25f62a9a4ac73e3c40e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEL8pcPVeueDbdmQhTuP7Q.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">m2m _ 查找 _ 预览</figcaption></figure><h1 id="faf6" class="lu la in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">自定义下拉小工具</strong></h1><p id="0e25" class="pw-post-body-paragraph jk jl in jm b jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh ig bi translated">我的模型包含一个带有元组数据的下拉字段<strong class="jm io">性别</strong></p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="ef11" class="kz la in kv b gy lb lc l ld le">GENDER = (<br/>    ('M','Male'),<br/>    ('F','Female')<br/>)</span></pre><p id="b72d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了导入性别字段，我必须提到 M 或 F，而不是男性或女性作为值，因此为此，我们可以创建我们的自定义下拉小部件。</p><p id="a704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">widgets.py 中</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="fb46" class="kz la in kv b gy lb lc l ld le">class CustomDropDownWidget(widgets.Widget):<br/>    def __init__(self, drop_down=None):<br/>        self.dropdown = dict(drop_down)<br/><br/>    def clean(self, value, row=None, *args, **kwargs):<br/>        if self.dropdown:<br/>            for key,val in self.dropdown.items():<br/>                if val == value:<br/>                    return key</span></pre><p id="d471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 resources.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="3339" class="kz la in kv b gy lb lc l ld le">class PersonDetailsAdminResource(resources.ModelResource):<br/>    user = fields.Field(column_name='user', attribute='user', widget=ForeignKeyWidget(User, field='username'))<br/>    country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))<br/>    hobby = fields.Field(column_name='hobby', attribute='hobby', widget=ManyToManyWidget(Hobby, field='name'))<br/>    <strong class="kv io">gender = fields.Field(column_name='gender', attribute='gender',widget=CustomDropDownWidget(drop_down=PersonDetail.GENDER))</strong><br/>    skill = fields.Field(column_name='skill', attribute='skill', widget=CustomManyToManyWidget(model=Skill,field='skill_type',lookup_field='name'))<br/><br/><br/>    class Meta:<br/>        model = PersonDetail<br/>        fields = (<br/>            'id',<br/>            'user',<br/>            'name',<br/>            'gender',<br/>            'dob',<br/>            'mobile',<br/>            'email',<br/>            'aadhaar',<br/>            'country',<br/>            'address',<br/>            'hobby',<br/>            'skill'<br/>        )</span></pre><h1 id="c821" class="lu la in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">跳过行(避免重复数据)</strong></h1><p id="8968" class="pw-post-body-paragraph jk jl in jm b jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh ig bi translated">跳过行是一种强大的导入导出方法，有助于在某些违反数据验证的情况下跳过行。</p><p id="74fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，如果您有大量需要导入的用户配置文件数据，但这些数据也包含重复的配置文件。您可以覆盖 skip_row 方法来避免 Django 的唯一数据完整性。这个函数返回<strong class="jm io"> False </strong>作为默认值。</p><p id="bba8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我只想导入那些电子邮件 id 尚不存在的配置文件。</p><p id="1530" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">In resource.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="d714" class="kz la in kv b gy lb lc l ld le">def skip_row(self, instance, original):<br/>    <br/>    return True if PersonDetail.objects.filter(email=instance.email).exists() else False</span></pre><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ne"><img src="../Images/61857c0277c81cac256686c53ed3b879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NR_hKY1_Qb1hrL1kdOjQnQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">跳过行，具有此电子邮件的人员已经存在</figcaption></figure><h1 id="31f6" class="lu la in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">导入前排</strong></h1><p id="ef93" class="pw-post-body-paragraph jk jl in jm b jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh ig bi translated">现在，我想在导入数据时将 internal_status 激活，但该字段不会包含在 CSV 文件中，我们将通过覆盖 before_import_row 方法在内部处理此问题。您可以在导入行之前使用自己的逻辑。</p><p id="2793" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 resources.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="986f" class="kz la in kv b gy lb lc l ld le">class PersonDetailsAdminResource(resources.ModelResource):<br/>    user = fields.Field(column_name='user', attribute='user', widget=ForeignKeyWidget(User, field='username'))<br/>    country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))<br/>    hobby = fields.Field(column_name='hobby', attribute='hobby', widget=ManyToManyWidget(Hobby, field='name'))<br/>    gender = fields.Field(column_name='gender', attribute='gender',widget=CustomDropDownWidget(drop_down=PersonDetail.GENDER))<br/>    skill = fields.Field(column_name='skill', attribute='skill', widget=CustomManyToManyWidget(model=Skill,field='skill_type',lookup_field='name'))<br/><br/><br/>    <strong class="kv io">def before_import_row(self, row, **kwargs):<br/>        try:<br/>                row['internal_status'] = 'active'<br/>        except Exception as e:<br/>            print(e)<br/><br/>        return row</strong><br/><br/>    def skip_row(self, instance, original):<br/><br/>        return True if PersonDetail.objects.filter(email=instance.email).exists() else False<br/><br/>    class Meta:<br/>        model = PersonDetail<br/>        fields = (<br/>            'id',<br/>            'user',<br/>            'name',<br/>            'gender',<br/>            'dob',<br/>            'mobile',<br/>            'email',<br/>            'aadhaar',<br/>            'country',<br/>            'address',<br/>            <strong class="kv io">'internal_status',</strong><br/>            'hobby',<br/>            'skill'<br/>        )</span></pre><figure class="kq kr ks kt gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nf"><img src="../Images/a1ee377100053329884a0021f36ebc3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pRc8QPGqXFEoeslwM66rkA.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">导入行预览前</figcaption></figure><h1 id="7caf" class="lu la in bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">导入行后</strong></h1><p id="4e0b" class="pw-post-body-paragraph jk jl in jm b jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh ig bi translated">现在我想在导入概要文件后将 is_staff 设为 True。我们将通过重写 after_import_row 方法在内部处理这个问题。导入行后，您可以使用自己的逻辑。</p><p id="3054" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 resources.py</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="dcb1" class="kz la in kv b gy lb lc l ld le">class PersonDetailsAdminResource(resources.ModelResource):<br/>    user = fields.Field(column_name='user', attribute='user', widget=ForeignKeyWidget(User, field='username'))<br/>    country = fields.Field(column_name='country', attribute='country', widget=ForeignKeyWidget(Country, field='name'))<br/>    hobby = fields.Field(column_name='hobby', attribute='hobby', widget=ManyToManyWidget(Hobby, field='name'))<br/>    gender = fields.Field(column_name='gender', attribute='gender',widget=CustomDropDownWidget(drop_down=PersonDetail.GENDER))<br/>    skill = fields.Field(column_name='skill', attribute='skill', widget=CustomManyToManyWidget(model=Skill,field='skill_type',lookup_field='name'))<br/><br/><br/>    def before_import_row(self, row, **kwargs):<br/>        try:<br/>                row['internal_status'] = 'active'<br/>        except Exception as e:<br/>            print(e)<br/><br/>        return row<br/><br/>    def skip_row(self, instance, original):<br/><br/>        return True if PersonDetail.objects.filter(email=instance.email).exists() else False<br/><br/>    <strong class="kv io">def after_import_row(self, row, row_result, row_number=None, **kwargs):<br/>        <em class="ng">"""<br/>        Override to add additional logic. Does nothing by default.<br/>        """<br/>        </em>try:<br/>            User.objects.filter(username='user').update(is_staff=True)<br/>        except Exception as e:<br/>            print(e)</strong><br/>            <br/>    class Meta:<br/>        model = PersonDetail<br/>        fields = (<br/>            'id',<br/>            'user',<br/>            'name',<br/>            'gender',<br/>            'dob',<br/>            'mobile',<br/>            'email',<br/>            'aadhaar',<br/>            'country',<br/>            'address',<br/>            'internal_status',<br/>            'hobby',<br/>            'skill'<br/>        )</span></pre><p id="a738" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导入导出库还提供了其他方法，我们可以在其中放置这样的逻辑。这些场景只是为了指导如何使用导入导出内置方法。有了这个库，我们可以轻松处理许多事情。有关详细信息，请访问官方文档。</p><p id="f93e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">谢谢！</strong>对于阅读，希望会有帮助。</p></div></div>    
</body>
</html>