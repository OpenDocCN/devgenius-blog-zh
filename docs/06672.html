<html>
<head>
<title>OpenID Connect &amp; OAUTH 2.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenID 连接和 OAUTH 2.0</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/openid-connect-oauth-2-0-758529e6f853?source=collection_archive---------13-----------------------#2022-01-24">https://blog.devgenius.io/openid-connect-oauth-2-0-758529e6f853?source=collection_archive---------13-----------------------#2022-01-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/dc7fa1898be6fe6acec7ec71feb68abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*YOREVOVvRW2AfNa_a9i0eg.jpeg"/></div></figure><p id="3c52" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在开始了解 oidc 和 oauth 2.0 之前，我们需要后退一步，看看它们是干什么用的？</p><p id="74e7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">因此，基本上 oidc 和 oauth 2.0 用于身份和访问管理(IAM)。IAM 包括验证请求访问资源的用户的身份及其访问级别。因此，为了验证用户身份，我们将该过程称为<strong class="jt io">认证</strong>，同时检查名为<strong class="jt io">授权</strong>的用户的访问级别。</p></div><div class="ab cl kp kq hr kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ig ih ii ij ik"><p id="7416" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">有些人互换使用 authN 和 authZ，这是不正确的。它们共同构成了强大的身份和访问管理，而不是一个取代另一个。虽然您只能使用 authZ 来保护 OAuth 2.0 的微服务，我们将在本文的最后介绍这一点。</p></div><div class="ab cl kp kq hr kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ig ih ii ij ik"><p id="38d3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> OpenID 连接工作流程</strong></p><p id="382c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">oidc 表示 authN，而 oauth 表示 authZ。现在，oidc 在 oauth 之上工作，换句话说，它在授权步骤发生之前工作。</p><p id="2d1b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如下所示:</p><ol class=""><li id="ac88" class="kw kx in jt b ju jv jy jz kc ky kg kz kk la ko lb lc ld le bi translated">用户试图通过<strong class="jt io">社交登录(sso) </strong>登录网站</li><li id="9066" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">网站(客户端或中继方)将使用<strong class="jt io">回调</strong> url 将用户重定向到 oidc sso</li><li id="a66c" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">用户输入他们凭证</li><li id="8ea2" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">oidc 端点<strong class="jt io"> (/auth) </strong>对用户进行认证，并向网站页面发送<strong class="jt io">授权码</strong></li><li id="e969" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">网站向 oidc 端点<strong class="jt io"> (/token) </strong>发送具有首选<strong class="jt io">范围</strong>的授权码，以换取<strong class="jt io"> id 令牌</strong>和<strong class="jt io">访问令牌</strong></li><li id="ebee" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">网站向 oidc 端点<strong class="jt io"> (/userinfo) </strong>发送用户声明、角色等的访问令牌</li></ol><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/0331284b3085f07238d1b4cf26a4a294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*ivE1O5d0I1qdgGAMJaEnHA.png"/></div></figure><p id="7817" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">了解工作流程后，我们应该回到一些术语上来。</p><p id="a8de" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> ID 令牌</strong>是一个 Json Web 令牌。这些 ID 令牌由报头、有效负载和签名组成。标头和签名用于验证令牌的真实性，而有效负载包含客户端请求的用户信息。ID 令牌是 oidc 对 OAuth 2.0 的核心扩展。ID 令牌由授权服务器颁发，包含携带用户信息的声明。</p><p id="1a76" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="lp">值得一提的是，除非在联系 oidc 端点时指定 openid 的作用域，否则不会返回 id_token。</em></p><p id="8343" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">访问令牌</strong>是<strong class="jt io"> </strong>一个唯一的令牌，告诉资源服务器这个用户被授权在这个有限的范围内访问它。</p><p id="c2c5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">授权码</strong>是授权码，是客户端用来交换访问令牌的临时码。代码本身是从授权服务器获得的，用户有机会看到客户端请求的信息，并批准或拒绝请求</p></div><div class="ab cl kp kq hr kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ig ih ii ij ik"><p id="34b1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">动手操作:apigee oauth 2.0 策略实施</strong></p><p id="2721" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">首先创建一个代理并选择你喜欢的流，对我来说，我会选择代理预流并放置<strong class="jt io"> OAuthV2 </strong>策略。</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/916a7e67612515a90f557c11783cbc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:144/format:webp/1*GF236tIzX9vDKp6pSh_K-g.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">OAuthV2 图标</figcaption></figure><p id="134c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，为了使这个端点(流)<strong class="jt io">生成</strong>一个访问令牌，您需要选择您首选的<strong class="jt io">授权类型</strong>。出于本教程的考虑，将使用 client_credentials 授权类型。</p><p id="2be7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">因为我们让这个端点生成一个访问令牌，所以我们需要在策略 xml 中的<strong class="jt io">操作</strong>上指定它，如下所示。您也可以从<strong class="jt io"> ExpiresIn 覆盖令牌寿命的默认值。</strong>如果 xml 中给出了范围，则令牌将被限制在此范围内。否则，它的范围将是您的客户端应用程序订阅的任何产品。</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/b6a043c774420cf517a55b2eb812b856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSyKVxUR_tNE5a1gCmncRQ.png"/></div></div></figure><p id="1bcd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在建立您的策略之后，您现在需要做的就是使用您的客户端 id 和客户端密码(用户名和密码)访问该端点。</p></div><div class="ab cl kp kq hr kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ig ih ii ij ik"><p id="73e1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">资源</strong></p><div class="ma mb gp gr mc md"><a href="https://blog.payara.fish/openid-connect-in-the-payara-platform-5.183" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">Payara 平台中的 OpenID Connect 5.183</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">OpenID Connect 是一种安全机制，用于应用程序联系身份服务，验证身份…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">博客. payara.fish</p></div></div></div></a></div><div class="ma mb gp gr mc md"><a href="https://auth0.com/docs/secure/tokens/access-tokens" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">访问令牌</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">访问令牌用于基于令牌的身份验证，以允许应用程序访问 API。应用程序接收…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">auth0.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr jp md"/></div></div></a></div><div class="ma mb gp gr mc md"><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/id-tokens" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">Microsoft 身份平台 ID 令牌- Microsoft 身份平台</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">ID 令牌是 OpenID Connect 对 OAuth 2.0 的核心扩展。身份令牌由授权机构颁发…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">docs.microsoft.com</p></div></div><div class="mm l"><div class="ms l mo mp mq mm mr jp md"/></div></div></a></div><div class="ma mb gp gr mc md"><a href="https://www.oauth.com/oauth2-servers/server-side-apps/authorization-code/" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">授权码授权- OAuth 2.0 简化版</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">授权码是一个临时码，客户端将使用它来交换访问令牌。代码本身是…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">www.oauth.com</p></div></div></div></a></div><div class="ma mb gp gr mc md"><a href="https://www.onelogin.com/blog/openid-connect-explained-in-plain-english" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">用简单的英语解释 OpenID Connect</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">获得关于 OpenID Connect 基础知识的介绍，这本书没有矫饰，但是很幽默！</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">www.onelogin.com</p></div></div><div class="mm l"><div class="mt l mo mp mq mm mr jp md"/></div></div></a></div><div class="ma mb gp gr mc md"><a href="https://cloud.google.com/apigee/docs/api-platform/reference/policies/oauthv2-policy#generateaccesstoken" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd io gy z fp mi fr fs mj fu fw im bi translated">OAuthV2 策略| Apigee X |谷歌云</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">无论您的企业正处于数字化转型的早期阶段，谷歌云都可以帮助您…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">cloud.google.com</p></div></div><div class="mm l"><div class="mu l mo mp mq mm mr jp md"/></div></div></a></div></div></div>    
</body>
</html>