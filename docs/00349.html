<html>
<head>
<title>iOS Simulator Push Notification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS模拟器推送通知</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ios-simulator-push-notification-9ae0ce98d417?source=collection_archive---------9-----------------------#2020-06-03">https://blog.devgenius.io/ios-simulator-push-notification-9ae0ce98d417?source=collection_archive---------9-----------------------#2020-06-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="e1a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">有了XCode 11.4，就可以实现了！</em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a046f40681c9b93a2bb07582340bfe86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qh7B6_sRqDcz2ONMXCinCQ.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">苹果照片</figcaption></figure><p id="6604" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">推送通知在开发生命周期中起着至关重要的作用，从用户的角度来看也是如此。它有助于用户更长时间地使用应用程序。在iOS中推送通知是借助APNS(Apple Push Notification Services)实现的。</p><p id="9a17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，推送通知的实现过程涉及一长串步骤。而且，最痛苦的部分是，它需要一个真实的设备来测试推送通知。但是随着XCode 11.4的发布，你可以在模拟器上实现这一点。</p><p id="7ff5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">Xcode 11.4的新特性是</em> <a class="ae kz" href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_4_release_notes" rel="noopener ugc nofollow" target="_blank"> <em class="ki">这里列出了</em> </a> <em class="ki">。</em></p><p id="38fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">Xcode 11.5的新特性是这里列出的</em><a class="ae kz" href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_5_release_notes" rel="noopener ugc nofollow" target="_blank"><em class="ki"/></a><em class="ki">。</em></p><blockquote class="la lb lc"><p id="b9c6" class="jk jl ki jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">模拟器支持模拟远程推送通知，包括后台内容获取通知。在模拟器中，将APNs文件拖放到目标模拟器上。该文件必须是JSON文件，具有有效的Apple推送通知服务有效负载，包括“aps”密钥。它还必须包含顶级“模拟器目标包”，其字符串值与目标应用程序的包标识符相匹配。—苹果Xcode 11.4发行说明</p><p id="ace8" class="jk jl ki jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">simctl还支持发送模拟推送通知。如果文件包含“Simulator Target Bundle ”,则不需要Bundle标识符，否则您必须将其作为参数提供(8164566):</p></blockquote><p id="e97e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki"> $ xcrun simctl推送&lt;设备&gt;com . example . my-app example push . apns</em></strong></p></div><div class="ab cl lg lh hr li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ig ih ii ij ik"><h1 id="344e" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">让我们从一些变通办法开始</h1><blockquote class="la lb lc"><p id="6549" class="jk jl ki jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">要求:-<br/>1-Xcode 11.4+<br/>2-Mac OS Catalina(10 . 15 . 4)</p></blockquote><p id="a745" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么，现在让我们来看看如何实现Xcode 11.4的这个新特性。为此，你需要Xcode 11.4或以上版本，我有Xcode 11.4。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/39f79c77c581e3339559ae9ec3c6719f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*-pXGxow_uURgKy-_YBdAVg.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Xcode 11.4</figcaption></figure><p id="7258" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一步是在Xcode中创建一个项目，我已经将我的项目命名为<strong class="jm io"><em class="ki">TestingPushNotification</em></strong>并选择了故事板。如果需要，您可以选择SwiftUI。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mm"><img src="../Images/dade24d53b5747556bd98fdb24d12483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMsmViklKrBk9aieEu_-TQ.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">创建了新项目</figcaption></figure><p id="de61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在Main.Storyboard的“ViewController.swift”中添加了背景颜色和带有文本“Push Notification”的UILabel，而不是在点击compile按钮时显示空白视图。</p><p id="7f39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，当我们在模拟器中运行应用程序时，在这种情况下，iPhone Xs看起来像下图。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/bbf30e33df5011710aaa948ab19241a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*EsFg8H2SRBU6pF41OOuMZA.png"/></div></figure><p id="1ce7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们从代码的某个部分开始吧！移动到你的AppDelegate.swift文件，在上面你可以看到<em class="ki"> import UIKit就在它下面导入苹果的用户通知框架。</em></p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="7b78" class="mt lo in mp b gy mu mv l mw mx">import UserNotification</span></pre><p id="8b5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们在AppDelegate类中需要一个函数，“askForPushNotification()”这将请求用户允许向设备发送通知。</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="0e03" class="mt lo in mp b gy mu mv l mw mx"><strong class="mp io">func askForPushNotification() {<br/>let center = UNUserNotificationCenter.current()<br/>center.requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in<br/>// Enable or disable features <br/>}}</strong></span></pre><p id="6050" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在AppDelegate的didfinishlaunchingwithoption()方法中添加“askForPushNotification()”。点击运行应用程序，模拟器会显示一个对话框，要求用户<strong class="jm io">允许</strong>和<strong class="jm io">不允许。</strong>用户需要选择<strong class="jm io">允许</strong>选项来接收通知。</p><p id="2c43" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是带有对话框选项的模拟器图像</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d22f44f506bc5b9691f55a530fbdbb15.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*YpzECPmz1uYoippwWb6pYg.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">要求用户许可的对话框选项</figcaption></figure><p id="dc61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据苹果Xcode 11.4的发布说明，我们需要用有效的苹果推送通知服务有效载荷创建一个JSON文件。让我们创建一个JSON文件，并以. apns. <br/>的扩展名保存它。在我们的例子中，我们已经创建了一个名为"<strong class="jm io"> Notification.apns </strong>"的文件，并确保它有一个" aps "键，以便匹配通知。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mz"><img src="../Images/7b16dd29156731c674299d5265b51195.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*2htrJnCOJ69EPRLNXi6P8g.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Notification.apns文件结构</figcaption></figure><p id="76c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从Notification.apns文件的结构中可以清楚地看到，它有以下几个键:<br/>“alert”——包含文本消息<br/>“sound”——默认值//作为初始值<br/>“badge”——1//它可以根据需要根据值进行更改。<br/>“模拟器目标包”——包含您的应用&lt; com.example.myApp &gt;的包标识符</p><p id="1f4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一步是拖放最近在模拟器中创建的json文件，如下图所示。通过这样做，它将在模拟器中显示一个演示推送通知。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5436421f26ac3385cf8abe78cd3bfc14.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/1*2rcqAmDmAetSPa1GLtgOjw.gif"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">在模拟器中拖放json文件并弹出通知</figcaption></figure></div></div>    
</body>
</html>