<html>
<head>
<title>Why is Nodejs so fast?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nodejs 为什么这么快？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/why-is-nodejs-so-fast-fd4a606c4300?source=collection_archive---------4-----------------------#2022-07-16">https://blog.devgenius.io/why-is-nodejs-so-fast-fd4a606c4300?source=collection_archive---------4-----------------------#2022-07-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="1c41" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">是什么让 Node.js 这么快？</h1><p id="59b1" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">说起 Node.js，首先想到的就是执行速度。因此，在这一节中，我们将尝试找出 Node.js 比其他节点更快的原因。首先，理解“执行速度”的含义是很重要的。从计算斐波那契数列到搜索数据库，执行速度可以是任何东西。<br/>在 Web 服务环境中，执行速度是处理请求并生成对客户端的响应所需要的一切。它是处理一个请求所花费的时间，从第一次连接开始，到客户端收到响应为止。<br/>让我们从几个方面来看看 Node.js 为什么这么快。</p><ul class=""><li id="51c3" class="lg lh in kk b kl li kp lj kt lk kx ll lb lm lf ln lo lp lq bi translated">Node.js 是单线程和异步的:这意味着所有的 I/O 活动不会干扰其他进程，并且可以同时发送电子邮件、读写文件、查询数据库等等。</li><li id="9719" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">对 web 服务器的每个请求都没有不同的 Node.js 进程。但是，一个 Node.js 进程将一直运行，监听连接。所有 JavaScript 代码都在进程的主线程中运行，所有其他 I/O 活动都在另一个线程中运行，几乎没有延迟。</li><li id="837a" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">Node.js (V8)中负责执行 JavaScript 的虚拟机是用 JIT 编译的。在运行时，虚拟机可以获取源代码并将其编译成机器代码。这意味着所有常用的“热”函数都可以编译成机器码，从而加快执行速度。</li></ul><h1 id="bdd2" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">关于异步</h1><p id="bf97" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">借助这个例子，我们将试图掌握异步处理的概念。</p><p id="c0a6" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">假设在山顶上有 100 个球。目标是在尽可能短的时间内将所有的球送到山下。很明显，你不可能一次按下所有的球，所以你必须一次按下一个。此时有两种选择。</p><p id="693a" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在第一种方法中，你可以推动一个球，等待它到达底部，然后再继续下一个。但是，这种方法需要很长时间才能将所有的球推到底部。</p><p id="a0f3" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在第二种方法中，可以一个接一个地推动球，而不用等它们到达底部。使用这种方法，所有 100 个球可以在最短的时间内被推完。</p><p id="aa56" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在这种情况下，第一个方法是同步执行的，而第二个方法是异步执行的。前面的例子演示了异步执行比同步操作快多少。</p><p id="06b4" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">现在，您已经掌握了异步编程的基本知识，让我们看看它是如何帮助 web 服务器性能的。</p><p id="e708" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">假设每个球对应一个数据库查询。因此，如果一个大型项目的数据是同步处理的，有许多聚合、搜索等。，代码执行将会阻塞。</p><p id="4ff0" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">但是，如果异步处理，所有查询可以同时运行，然后收集结果。<br/>在后端，Node.js 与 Angular、React、React Native 和 Vue.js 相结合，提供闪电般的处理和渲染。</p><h1 id="9c7b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">事件循环</h1><p id="526f" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">事件循环是一种负责在程序中调度事件的机制，该程序总是与消息发起者异步运行。</p><p id="238d" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">当使用 Node.js 时，它在执行 I/O 操作时保存分配给该操作的回调，从而允许继续处理其他事件。一旦收集了所有必要的数据，就调用回调。</p><p id="71bf" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">web 服务器将所有请求发送到事件循环，事件循环在线程池中注册操作并给它们分配回调。</p><p id="708a" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">一旦处理了请求，就调用回调。其他高要求的活动，比如搜索数据库，可以使用回调来执行。</p><h1 id="f3c3" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">V8 在优化代码中的作用</h1><p id="b620" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">V8 由两种类型的编译器组成。</p><ul class=""><li id="b85c" class="lg lh in kk b kl li kp lj kt lk kx ll lb lm lf ln lo lp lq bi translated">完整的编译器</li><li id="7df5" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">曲轴编译器</li></ul><p id="b329" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">整个编译器以其生成通用代码的速度和能力而闻名。它还将 JavaScript 函数的抽象语法树(AST)转换成通用本机代码。在这一级，它只执行一种优化:内联缓存。</p><p id="577e" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">V8 在代码执行期间启动一个解析器线程，并编译函数来确定哪些函数是热的，哪些不是。此外，它捕获类型反馈，这有助于 V8 跟踪通过它传递的数据的类型。</p><p id="62c4" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在识别“热”函数并收集某些类型的反馈后，V8 试图通过优化编译器(有时称为“曲轴”编译器)来执行增强的 AST。</p><p id="d6f9" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">曲轴编译器较慢，但它试图生成高效的代码。它由两种元素组成:氢和锂。</p><p id="2e4f" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">Hydrogen 编译器通过从 AST 文件创建控制流图(CFG)来工作。生成的图表显示为静态单一分配(SSA)图表。</p><p id="be71" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">利用 SSA 形式和高级中间表示的简单结构，编译器可以执行许多优化，如方法<br/>内联、常量折叠等。</p><p id="329b" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">Lithium 编译器的主要目标是将优化的 HIR 转换成 LIR，这与机器代码非常相似，只是它是平台独立的。</p><p id="b5db" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">之后，旧的、未优化的代码被优化的代码替换。这有助于更快地执行代码。</p><h1 id="c77b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">几种最佳应用场景</h1><p id="d720" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">除了速度之外，Node.js 还包括许多开发人员可以在一系列应用程序中使用的功能。看看一些顶级 Node.js 应用程序场景。</p><h1 id="442d" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">实时应用</h1><p id="de39" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">当被问到“Node.js 最好的应用场景是什么？”实时应用是最好的解决方案。这是 Node.js 擅长的一个应用。为什么 Node.js 在实时应用中如此受欢迎。</p><ul class=""><li id="82e7" class="lg lh in kk b kl li kp lj kt lk kx ll lb lm lf ln lo lp lq bi translated">Node.js 支持重用和共享用于存储库代码的 Node.js 包。</li><li id="de04" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">它导致服务器和客户端之间的快速数据同步。</li><li id="0f79" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">它可以轻松处理多个客户端请求。</li></ul><p id="5873" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">简而言之，如果实时数据处理和可伸缩性是一个项目的两个重要考虑因素，那么 Node.js 是最好的技术。</p><p id="0951" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">不仅如此，Node.js 应该用于实时应用程序开发还有许多其他原因。因此，如果有人想知道为什么选择 Node.js 来开发实时应用程序，这就是原因。</p><h1 id="df8b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">基于事件的服务器</h1><p id="1f4c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在实时应用程序中必须处理多个实时用户。这就是 Node.js 派上用场的地方，因为它可以处理基于事件的服务器响应，从而实现非阻塞功能。</p><h1 id="9e2a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">数据同步</h1><p id="69b0" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Node.js 开发人员使用非阻塞 I/O 功能。它还允许客户端和服务器之间的快速数据传输。</p><h1 id="f358" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">代理服务器</h1><p id="9755" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">每当需要中间管理员时，Node.js 是理想的选择。要将 Node.js 用作代理服务器，开发人员必须编写 20 行代码。之后，该应用程序将非常适合从许多来源传输数据。</p><h1 id="eebb" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">应用程序监控仪表板</h1><p id="79ed" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">另一个流行的 Node.js 应用程序是跟踪网站访问者并可视化所有实时活动。</p><p id="75f6" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">这里可以收集关于用户的实时统计数据，此外，当消费者到达渠道中的特定阶段时，只需打开沟通渠道，就可以与客户进行有针对性的互动。</p><p id="051f" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">这对任何公司都是非常有益的，因为这可以让他们实时看到他们的消费者或访问者在做什么。它还允许他们实时看到他们的互动。这些数据至关重要，公司可以利用它们来改善服务。由于 Node.js 的实时和双向套接字，这一切都成为可能。</p><h1 id="0b6e" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">系统监控仪表板</h1><p id="6b41" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在转到基础设施方面，考虑一个 SaaS 提供商，该提供商希望为用户提供一个类似于 GitHub 状态页面的服务监控站点。</p><p id="819e" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">Node.js 事件循环允许创建一个强大的基于 web 的仪表板，该仪表板可以异步监视服务的状态。在 WebSockets 的支持下，它还将数据推送到客户端。</p><p id="cdeb" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">这项技术可用于实时报告公共和内部服务的状态。</p><p id="5a69" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">考虑金融机构、电信运营商或云/网络/托管提供商的网络运营中心(NOC)监控应用，所有这些应用都运行在使用 WebSockets 和 Node.js 而不是 Java 或 Java Applet 的开放 Web 堆栈上。</p><h1 id="613f" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">视频流</h1><p id="9032" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">流是以小批量而不是大批量发送大量数据的过程。对于设计视频流应用，Node.js 是个不错的选择。它非常理想，因为它带有内置的视频流模块。</p><p id="476a" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">它还允许创建可写和可读的数据流。您还可以在使用 Node.js 上传文件时对其进行操作。</p><p id="4614" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">网飞也在使用 Node.js，这是世界上最大的流媒体服务，在 190 多个国家开展业务。</p><p id="f4ef" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">网飞的整个用户界面都是基于 Node.js 技术构建的，网飞很快就选择在其他几个堆栈层上使用它，因为它非常有效。网飞开发团队采用 Node.js 的主要目标是创建一个能够提供高性能的轻量级软件。新的基于节点的应用程序将加载过程加快了 70%。除此之外，还导致了以下结果。</p><ul class=""><li id="0f78" class="lg lh in kk b kl li kp lj kt lk kx ll lb lm lf ln lo lp lq bi translated">改进的性能</li><li id="17c9" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">缩短构建时间</li><li id="0606" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">启用用户定制</li></ul><h1 id="848b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">高度可扩展的应用程序</h1><p id="b078" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">随着用户群的稳步增长，Node.js 已经成为所有应用和平台的首选平台。沃尔玛、贝宝、优步、网飞、LinkedIn 和许多其他公司都使用 Node.js，因为它允许无缝扩展。</p><p id="0626" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">Node.js 的尖端技术包括集群模块等功能。它在多个 CPU 内核之间提供负载平衡，从而更容易用较小的模块提供所需的结果，而不会耗尽 RAM。</p><p id="ab18" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">不仅如此，Node.js 还有一个非阻塞事件循环系统，允许服务器实时处理请求。</p><p id="2724" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在开发方面，Node.js 允许使用微服务，这进一步允许将应用程序分解成更小的组件。</p><p id="4c02" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">通过在不同的团队中有效地定义和分配任务，可以加速应用程序每个组件的开发、部署和维护。</p><p id="0546" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">使用 Node.js，现代应用程序可以根据需要进行伸缩。它还可以帮助组织用更少的资源实现更高的性能。</p><h1 id="a084" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">在线聊天</h1><p id="82f7" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">聊天应用程序是实时和多用户应用程序最常见的场景。因为它是一个运行在多个分布式设备上的数据密集型、高流量和轻量级应用程序，所以聊天应用程序是 Node.js 的最大场景之一。</p><p id="d321" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">考虑下面的场景:网站上有一个单独的聊天室，人们可以在这里交流信息。假设站点上有三个人可以访问留言板。<br/>在这种情况下，服务器端的 Express.js 应用程序将实现以下两个函数。</p><ul class=""><li id="3bef" class="lg lh in kk b kl li kp lj kt lk kx ll lb lm lf ln lo lp lq bi translated">服务于网页的请求处理器由一个留言板和一个初始化新消息输入的“发送”按钮组成</li><li id="5b20" class="lg lh in kk b kl lr kp ls kt lt kx lu lb lv lf ln lo lp lq bi translated">WebSockets 服务器监听 WebSocket 客户端发送的所有新消息。</li></ul><p id="972c" class="pw-post-body-paragraph ki kj in kk b kl li kn ko kp lj kr ks kt lw kv kw kx lx kz la lb ly ld le lf ig bi translated">在客户端，我们有一个设置了一些处理程序的 HTML 页面。其中一个是“发送”按钮点击事件，它负责获取传入的消息并将其发送到 WebSocket。另一个用于监听发送到 WebSocket 客户端的新消息。</p><h1 id="1cd7" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">摘要</h1><p id="9b84" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">凭借其闪电般的执行速度，Node.js 被证明是许多开发人员和企业的救星，许多大公司都利用了 Node.js 的这一特性。</p></div></div>    
</body>
</html>