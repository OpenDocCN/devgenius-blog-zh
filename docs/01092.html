<html>
<head>
<title>Python Error Handling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 错误处理</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/python-error-handling-8bed3f5b5769?source=collection_archive---------3-----------------------#2020-06-24">https://blog.devgenius.io/python-error-handling-8bed3f5b5769?source=collection_archive---------3-----------------------#2020-06-24</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="1d3d" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">像专家一样处理 Python 中的错误</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/218339e4a5ac6539e22ed07ee139e151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3HNq0Uc8dkkWFqH6lV54A.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">Python 中的错误处理，图片由作者提供</figcaption></figure><p id="d12c" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">当程序执行期间，Python 遇到错误时，它会停止。这可能是由两种类型的错误引起的，语法错误或异常。在本文中，我们将讨论第二个异常，并展示如何处理、捕捉和引发它们。</p><h1 id="150f" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">什么是例外？</h1><p id="4479" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">异常是当语法正确的代码执行时 Python 报告的错误，以及异常情况的发生。例如，看看下面的代码。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">引发异常的程序</figcaption></figure><p id="548b" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这个程序试图将数字十除以零，这在 Python 中是不可能的。</p><p id="2192" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">当您执行这个程序时，Python 会引发一个 ZeroDivisionError 并终止应用程序。</p><p id="c969" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><code class="fe mr ms mt mu b">&gt; python3 main.py <br/>Traceback (most recent call last):<br/> File “main.py”, line 3, in &lt;module&gt;<br/> result = number / divider<br/>ZeroDivisionError: division by zero</code></p><p id="d5cd" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这个 ZeroDivisionError 是一个<strong class="ky is">异常</strong>。每个异常都是从一个公共基类派生的 Python 类。在本例中，来自 BaseException。</p><p id="d6ad" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">Python 有许多内置的异常。例如，AssertionError、AttributeError、EOFError、FloatingPointError、ImportError、ModuleNotFoundError、IndexError、MemoryError 和 NotImplementedError。</p><p id="4473" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这些都记录在优秀的<a class="ae mv" href="https://docs.python.org/3/library/exceptions.html" rel="noopener ugc nofollow" target="_blank"> Python 文档</a>中。</p><h1 id="ae61" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">我们如何处理异常？</h1><p id="237f" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">正如我们之前看到的，如果一个异常发生而没有处理它，Python 将会报告错误并终止你的应用程序。</p><p id="a421" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">通常，这不是你想要的。为了防止这种情况，您可以通过将语句包含在 try-except 语句中来处理可能的异常。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">处理 ZeroDivisionError 异常</figcaption></figure><p id="6d24" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这个 try-except 语句的工作方式如下。首先，Python 执行<code class="fe mr ms mt mu b">try</code>和<code class="fe mr ms mt mu b">except</code>之间的语句。这些语句称为 try 子句。</p><p id="93e7" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">如果没有异常发生，跳过<code class="fe mr ms mt mu b">except</code>以下的语句，结束<code class="fe mr ms mt mu b">try</code>语句的执行。<code class="fe mr ms mt mu b">except</code>下面的语句称为 except 子句。</p><p id="7661" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是，如果在 try 子句的执行过程中出现异常，则跳过其余的语句。然后，如果类型匹配以<code class="fe mr ms mt mu b">except</code>语句命名的异常，则执行 except 子句。执行在<code class="fe mr ms mt mu b">try</code>语句后继续。</p><h2 id="50b9" class="mw lt ir bd lu mx my dn ly mz na dp mc lf nb nc me lj nd ne mg ln nf ng mi nh bi translated">处理多个异常</h2><p id="b8a0" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">可以为一个 try 子句创建多个 except 子句来处理多个特定的异常。这使您能够在特定异常发生时更好地控制要执行的语句。</p><p id="1e12" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">在这个例子中，我们处理一个<code class="fe mr ms mt mu b">ZeroDivisionError</code>和一个<code class="fe mr ms mt mu b">ValueError</code>。当用户不输入数字时会出现<code class="fe mr ms mt mu b">ValueError</code>，当用户输入 0 时会出现<code class="fe mr ms mt mu b">ZeroDivisionError</code>。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">处理多种类型的异常</figcaption></figure><p id="840b" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这里我们打印一条消息，但是您可以想象根据异常的类型，您可以执行不同的语句。</p><h2 id="1756" class="mw lt ir bd lu mx my dn ly mz na dp mc lf nb nc me lj nd ne mg ln nf ng mi nh bi translated">通用异常处理程序</h2><p id="fa84" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">还可以添加另一个 except 子句来捕获一般的异常。这样，您就创建了一个安全网来捕捉所有其他异常。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">添加一个通用的 except 子句来捕获所有异常</figcaption></figure><p id="82da" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">如果发生了除<code class="fe mr ms mt mu b">ZeroDivisionError</code>或<code class="fe mr ms mt mu b">ValueError</code>之外的异常，则触发第九行的一般 except-子句。这样可以确保所有的异常都得到处理。</p><p id="2e5e" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">except 子句的顺序很重要，总是从最具体的异常开始。如果我们从一般的 except-clause 开始，那么具体的 except-clause 就永远不会被执行。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">不会执行 except-clause ZeroDivisionError 和 except-clause ValueError</figcaption></figure><h1 id="9298" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">最后使用 Try</h1><p id="b3e2" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">无论 try- and except 块的结果如何，<code class="fe mr ms mt mu b">finally</code>块都允许您执行代码。这有时会很有用。例如，在处理文件时。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">使用 finally 块</figcaption></figure><p id="ad54" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">在这个例子中，<code class="fe mr ms mt mu b">finally </code>块关闭了文件。即使出现异常，也会执行<code class="fe mr ms mt mu b">finally</code>块并关闭文件。</p><h2 id="66c6" class="mw lt ir bd lu mx my dn ly mz na dp mc lf nb nc me lj nd ne mg ln nf ng mi nh bi translated">With 语句</h2><p id="5a8c" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">Pythons 的<code class="fe mr ms mt mu b">with</code>语句可以用来简化使用<code class="fe mr ms mt mu b">try-finally</code>的代码。让我们看看如何使用<code class="fe mr ms mt mu b">with</code>重写前面的例子。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">使用 with 确保文件被关闭</figcaption></figure><p id="7388" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">通过在打开文件时使用<code class="fe mr ms mt mu b">with</code>，可以确保当<code class="fe mr ms mt mu b">with</code>块完成时，文件自动关闭。结果与使用 finally 相同，但看起来更干净一些。</p><h1 id="bdd0" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">提出你自己的例外</h1><p id="2a91" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">在我们讨论处理由标准 Python 模块引发的异常之前。也有可能从代码中引发异常。</p><p id="4095" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">现在，你为什么要提出一个例外呢？</p><p id="83dc" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">假设您开发了一个 Python 模块，它需要某个配置文件才能正常工作。当找不到配置文件时，您可能会引发异常。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">引发异常</figcaption></figure><p id="e727" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">在这种情况下，我们会引发 FileNotFoundError 异常，它是标准 Python 模块的一部分。我们也可以定义自己的异常类并引发该异常。</p><h2 id="02de" class="mw lt ir bd lu mx my dn ly mz na dp mc lf nb nc me lj nd ne mg ln nf ng mi nh bi translated">定义自定义异常类</h2><p id="27b5" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">为了能够引发自定义异常，我们需要定义一个从 exception 派生的类。在<code class="fe mr ms mt mu b">ConfigureError</code> init 中，我们称之为超类的 init。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">定义和引发自定义异常</figcaption></figure><h2 id="8bc5" class="mw lt ir bd lu mx my dn ly mz na dp mc lf nb nc me lj nd ne mg ln nf ng mi nh bi translated">记录和引发异常</h2><p id="19a0" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">引发异常的另一个原因是为了日志记录。您捕获异常，记录错误消息，并重新引发异常。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mp mq l"/></div></figure><p id="2650" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">在这种情况下，确保调用<code class="fe mr ms mt mu b">raise</code>时不带任何参数。这将确保调用堆栈信息保持完整。</p><h1 id="2a9c" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">结论</h1><p id="1905" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">在本文中，我们看到了什么是异常以及如何处理它们。我们使用<em class="ni"> try-finally </em>和<em class="ni"> with </em>来定义清理动作。最后，我们看到了如何引发自定义异常。</p><p id="0b5f" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">有了这些信息，您应该能够处理所有的 Python 错误。</p><p id="6660" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>