<html>
<head>
<title>Automatic certificate management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动证书管理</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/automatic-certificate-management-b4ff1b95dbf1?source=collection_archive---------3-----------------------#2022-03-08">https://blog.devgenius.io/automatic-certificate-management-b4ff1b95dbf1?source=collection_archive---------3-----------------------#2022-03-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2547" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Azure 应用程序网关&amp;让我们加密</p><p id="8f2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在你的云之旅的某个时候，你需要开始使用自动证书管理，这篇文章是关于自动颁发和更新<strong class="jm io">让我们使用 Azure 自动化功能在<strong class="jm io"> Azure 应用网关</strong>上加密证书</strong>。</p><p id="afad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我并不是第一个使用这种方法的人，下面将会介绍这种方法，但是我所描述的方法正在被我所采用，并且在真实的生产环境中发挥作用。所以，如果你有实际问题，请。</p><p id="d122" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确保您了解的基本功能</p><ul class=""><li id="207e" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated"><a class="ae kr" href="https://docs.microsoft.com/en-us/azure/application-gateway/overview" rel="noopener ugc nofollow" target="_blank"> Azure 应用网关</a></li><li id="17c1" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="https://docs.microsoft.com/en-us/azure/automation/overview" rel="noopener ugc nofollow" target="_blank">蔚蓝自动化</a></li><li id="898a" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview" rel="noopener ugc nofollow" target="_blank"> Azure blob 存储</a></li><li id="db99" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="https://letsencrypt.org" rel="noopener ugc nofollow" target="_blank">让我们加密</a></li></ul><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/e1ba1ee6f8203bec5c6d212b06c9c398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytekwip0HYmLH-l-XPcgXQ.jpeg"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">图表</figcaption></figure><p id="d55d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是步骤:</p><ol class=""><li id="0321" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh ln ko kp kq bi translated">计划一个自动化作业(每 3 个月)来启动/续订让我们加密证书</li><li id="dd61" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh ln ko kp kq bi translated">该作业触发一个 PowerShell 脚本来实现这一奇迹。</li></ol><p id="55e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.Let's encrypt 所需的 HTTP 响应和证书存储在静态网站中，这是 Azure 存储帐户的一部分。这一切都是由 PowerShell 脚本编排的:</p><ul class=""><li id="ff27" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">向 let's 脚本发起请求</li><li id="a9c6" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">保存响应</li><li id="492a" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">保存证书和密钥</li><li id="6255" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">取下钥匙</li><li id="646f" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">在 azure 应用程序网关上放置(添加/替换)证书</li></ul><p id="d4c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Azure blob 存储</strong></p><p id="a795" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它将物理地存储让我们加密 HTTP 响应/质询和证书。我们需要以某种方式配置公共容器:</p><ol class=""><li id="4ed0" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh ln ko kp kq bi translated">创建公共容器</li><li id="aed7" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh ln ko kp kq bi translated">在该容器下，创建其他文件夹，因此完整路径如下所示:</li></ol><p id="bf82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> public / &lt;你的站点名称&gt; /。知名/极限挑战</strong></p><p id="fe5d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Azure 应用网关</strong></p><ol class=""><li id="33e5" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh ln ko kp kq bi translated">确保你的站点的 CNAME 指向你的 azure 应用网关的公共 ip 地址。</li><li id="758e" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh ln ko kp kq bi translated">对于<strong class="jm io">让我们加密</strong>认证处理，我们需要一个<strong class="jm io"> HTTP </strong>监听器</li><li id="59a1" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh ln ko kp kq bi translated">…以及一个关联的基于路径的规则，该规则执行<strong class="jm io">重定向</strong>到外部站点:</li></ol><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lo"><img src="../Images/567d889eb2a1bbe75906a4455916a2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMBj03hecxRGuqaFRwU9Og.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">应用程序网关规则</figcaption></figure><p id="7448" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">目标 URL 应该指向您的公共容器:</p><p id="9cef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> https:// &lt;容器名&gt;. blob . core . windows . net/public/&lt;你的站点名&gt; </strong></p><p id="b328" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">蔚蓝自动化</strong></p><ol class=""><li id="527c" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh ln ko kp kq bi translated">安装所需的模块。在尝试运行 runbook 并检查错误后，您可以回到这一步。抱歉，没有写下需要的…</li><li id="f4d1" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh ln ko kp kq bi translated">创建 PowerShell runbook 并添加以下脚本:</li></ol><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="b3b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.通过单击“链接到计划”按钮创建一个计划作业，并提供参数:</p><ul class=""><li id="aef3" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">域:证书的 CN</li><li id="0bb1" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">storageName:公共容器的存储名称</li><li id="04bc" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">STResourceGroupName:您的存储帐户的资源组的名称</li><li id="76c3" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">AGName: azure 应用程序网关名称，您要在其中管理证书</li><li id="05d8" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">AGResourceGroupName:应用程序网关的资源组的名称</li><li id="7ad7" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">AGOldCertName:应用程序网关证书的旧名称。如果你从零开始，只需输入你的域名。</li></ul><p id="a9b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您运行您的作业，在它被执行之后，您可以到您的应用程序网关并检查您的<strong class="jm io"> HTTPS </strong>监听器以获得可用的证书。证书的名称应该与您的 dns 条目相同。</p></div></div>    
</body>
</html>