<html>
<head>
<title>Using the Unity Animation System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Unity动画系统</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-the-unity-animation-system-2fe137a56008?source=collection_archive---------4-----------------------#2021-05-27">https://blog.devgenius.io/using-the-unity-animation-system-2fe137a56008?source=collection_archive---------4-----------------------#2021-05-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d4f3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">为玩家设置一个简单的动画控制器。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/e1ad69c3b06658364b4a02b42250ea0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpntgtfJZTkogt5y6e-mwA.png"/></div></div></figure><ol class=""><li id="ebf2" class="ko kp in kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationClips.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画剪辑</strong> </a>在Unity中创建或<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/class-AnimationClip.html" rel="noopener ugc nofollow" target="_blank">从外部源导入</a></li><li id="58cb" class="ko kp in kq b kr lh kt li kv lj kx lk kz ll lb lc ld le lf bi translated"><a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationClips.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画剪辑</strong> </a>放置在<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimatorWindow.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画窗口</strong> </a>中。</li><li id="e0e5" class="ko kp in kq b kr lh kt li kv lj kx lk kz ll lb lc ld le lf bi translated">正在被动画化的游戏对象被分配了一个<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/Animator.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> Animator控制器资源</strong> </a>。</li></ol><h1 id="5330" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">设置动画</h1><p id="20fa" class="pw-post-body-paragraph me mf in kq b kr mg jo mh kt mi jr mj kv mk ml mm kx mn mo mp kz mq mr ms lb ig bi translated">创建一个<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/Animator.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画师控制器资产</strong> </a> <strong class="kq io"> </strong>这允许我为我的角色或<strong class="kq io">对象维护所有的动画。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/932d431b7a6c5a8ac33d0dfb8923afd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/1*sfzKjCwWo_VEWrSow1pWXg.gif"/></div></figure><p id="09f2" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">双击控制器将打开<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimatorWindow.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画窗口</strong> </a>。这就是我可以设置<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationStateMachines.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画状态</strong> </a> <strong class="kq io"> </strong>称为<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/StateMachineBasics.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">状态机</strong> </a>和逻辑(<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/StateMachineTransitions.html" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"/></a>，<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/StateMachineBehaviours.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">行为</strong> </a>，<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationParameters.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画参数</strong> </a>等。)我可以通过代码来触发。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/6cec1d223dc0671a34c462608d86e43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DKEp6eF_E7lEHLSZvlHCkA.gif"/></div></div></figure><p id="425d" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">我可以添加一个<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationClips.html" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"/></a>动画剪辑，方法是将它从项目窗口拖到<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimatorWindow.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> Animator窗口</strong> </a> <strong class="kq io"> </strong>，或者右击创建一个状态并选择其中一个选项。如果我创建了一个空状态，并且我想让它使用一个剪辑，我必须在检查器窗口中添加这个剪辑。我可以有一个空状态，它不做任何事情，也没有附加动画剪辑。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/890f49823855b4e34b9b7101dd560af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rFEZSwFs52HJp0Y7BByZVA.gif"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi my"><img src="../Images/35122ca0da53688efd678307d126b67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4A5e3YzLy_pQWoSVAFEzwQ.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">从选定的剪辑创建状态</figcaption></figure><p id="00a5" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">每个状态机都有一个入口点和一个出口点。从入口点到至少一个称为默认状态的状态总是有一个转换。这是使用状态机时将启动的状态。默认状态设置为添加到状态机的第一个状态。我可以在任何时候通过右键单击我想要作为默认状态的状态并选择设置为层默认值来更改它。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/4782ae54f005a3c5702b3968a0b22d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WJaYcIeh3qsdhPxtoCN3IA.gif"/></div></div></figure><p id="2319" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在我已经添加了我的剪辑，我需要一些<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationParameters.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画参数</strong> </a> <strong class="kq io"> </strong>用于我的过渡。对于散步和闲散，我将使用一个bool正在散步。对于投掷，我将使用触发投掷。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8b5f3805dc2a3bef0e8ce707ffbedb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/1*E26rHnW27QmxM_IulgTxEg.gif"/></div></figure><p id="814b" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在我可以创建我的<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/StateMachineTransitions.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">转场</strong> </a>。</p><p id="48e2" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">当“行走”为真时，我想从空闲过渡到无混合行走，而不是等待当前动画结束播放(有退出时间)。当“行走”为false时，我想转换回空闲状态，不进行混合，并且不等待当前动画结束播放。我想从任何状态转换到Throw而不进行混合，并且在触发Throw时不要等待当前动画结束播放(有退出时间)。一旦投掷动画完成，我想根据行走是真还是假从投掷过渡到行走或空闲。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/0f8b77da51565d624a800b9f4782399a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jY8vqu94E7d2XgKmPwhJyQ.gif"/></div></div></figure><p id="1a1d" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在我需要给我的角色分配这个动画师。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/0d5377404ca383ee23c98e6a310a2308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/1*wnASIvsyqrwDP71anxRwxA.gif"/></div></figure><p id="62d6" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在我可以玩测试游戏，并通过更改animator窗口中的值来触发动画变化。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/c6a2287001a330cb3b978e5a84cd7f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fYtdFjULGkfjmXrP5_sz0Q.gif"/></div></div></figure><h1 id="f274" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated">逻辑中的编码</h1><p id="b603" class="pw-post-body-paragraph me mf in kq b kr mg jo mh kt mi jr mj kv mk ml mm kx mn mo mp kz mq mr ms lb ig bi translated">现在我已经设置了控制器，我需要从我的球员运动代码中传递逻辑。要做到这一点，我需要能够访问<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/ScriptReference/Animator.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画组件</strong> </a>，我需要它在检查器中是可分配的，因为动画组件很可能是在一个子对象上。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/7ce8f9b1f352fddc1c7bf335dfd7e84c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nr6GsVyRp1zM4-u8a64WSg.gif"/></div></div></figure><p id="d48e" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">我将代码放在了错误的行为中，不得不将其移动到“移动到点击”行为中。确保您正在编辑正确的行为总是一个好主意。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/1cb912c247b745c442620a46dc6cd7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sOVCj9M87r4pRaYNDDkDkg.gif"/></div></div></figure><p id="3d9e" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">在我忘记之前，我需要在我的检查员分配这个。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0319133dc8a336b4552140af54dfc0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/1*oFjBfzgf1BHmue71H9IB3A.gif"/></div></figure><p id="e9fc" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在我可以设置<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationParameters.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画参数</strong> </a>当玩家开始行走时为真，当玩家到达目的地时为假。</p><p id="ad38" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">有多种方法可以通过string或int设置一个<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/Manual/AnimationParameters.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">动画参数</strong> </a> <strong class="kq io"> </strong>。字符串速度较慢，对性能要求更高。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/150769c038cf07f0129a71c351d0f968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iu8zJJmkWS2tUEh726Y36g.png"/></div></div></figure><p id="2b3b" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">我将使用int方法。为了获得字符串参数的id，我将使用名为string to hash的静态方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/718ae2a0c7da8132f408214f3fdd9b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEGuJ9p_uAa-iDALif8TiA.png"/></div></div></figure><p id="5a3e" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">我还将使用我的IDE来自动完成这项工作。第一次使用set参数时，我将使用string方法，然后使用上下文将其更改为int方法。IDE将自动为我创建int id，并将方法更改为使用int方法。这是使用IDE帮助加快我的工作流程的一个很好的方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/7848d7b877f3e770449eb84c40a61527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YQoPqysQI2UqRkHnI25DkA.gif"/></div></div></figure><p id="4e86" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">它有时会起作用。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/291d1fe565ca2f0ba002bb4a959ff643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*q7ypg6o5mlI-iTUXrIE54Q.gif"/></div></div></figure><p id="2398" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">我知道问题出在我的代码中，因为这个参数确实是在Animator中设置的。问题实际上是我在哪里检查代理是否在移动。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1f4f41e3767f863c2585640e306e5945.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*knzwTfWK2XGMEhmKyjDlfA.png"/></div></figure><p id="5ee6" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">为了解决这个问题，我需要修改代码，改为使用停车距离。我最初没有使用停止距离，因为我正在处理浮动。在用<code class="fe nq nr ns nt b">Debug.Log(agent.remainingDistance)</code>运行了一些测试后，我意识到NavMesh代理在到达目的地后会将剩余距离设置为0。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e74dcc95a4bcf84fbec51095b01645bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/1*6gnzVB3IpIvS6EKRNNLbBw.gif"/></div></figure><p id="cb91" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在，如果我第二次点击一个新的目的地，它就工作了。这与我代码中的逻辑顺序有关。我设置目标向量，我检查停止移动，这是真的，因为我还没有告诉代理它需要移动。然后我告诉代理，它需要移动。要解决这个问题，我要做的就是把停止移动代码移到告诉代理它需要移动之后。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/28d95a299d645036268459a7d1c55c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*3RiQn0xRv1xKpZVtbTBsLQ.gif"/></div></figure><p id="532d" class="pw-post-body-paragraph me mf in kq b kr ks jo mh kt ku jr mj kv mu ml mm kx mv mo mp kz mw mr ms lb ig bi translated">现在它的工作方式正是我想要的。逻辑的顺序很重要。我还可以添加一个检查，检查路径是否没有挂起。根据<a class="ae lg" href="https://docs.unity3d.com/2021.1/Documentation/ScriptReference/AI.NavMeshAgent-destination.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> Unity脚本API </strong> </a> <strong class="kq io"> </strong>设置的目的地可能在几帧内不可用。上面的返回只负责一帧。未决路径会处理它，需要一个以上的帧。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/98fd0e94553dd2c8e0ef800f23ceb9dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/1*jXjTee9Uuusj5ZfojvWt_Q.gif"/></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/1653a8c8cd0ffb6a2af82472d86e1846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/1*CUUdcHpIWqlVZcu0VRur2g.gif"/></div></figure><h2 id="1a44" class="ny ln in bd lo nz oa dn ls ob oc dp lw kv od oe ly kx of og ma kz oh oi mc oj bi translated">最终代码</h2><p id="0413" class="pw-post-body-paragraph me mf in kq b kr mg jo mh kt mi jr mj kv mk ml mm kx mn mo mp kz mq mr ms lb ig bi translated">我把所有的动画代码都移到了抽象类中，现在我不需要在我想使用动画的其他类中实现它。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/1f2902adfb257558dbc3adf9d9ed00ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15niLLqg2C8Ab2pej916QQ.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/1f2902adfb257558dbc3adf9d9ed00ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15niLLqg2C8Ab2pej916QQ.png"/></div></div></figure></div></div>    
</body>
</html>