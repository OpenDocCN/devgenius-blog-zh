# SAS 中分类数据的功效分析。

> 原文：<https://blog.devgenius.io/power-analysis-for-categorical-data-in-sas-multinomial-ordinal-binary-binomial-beta-poisson-9398888491da?source=collection_archive---------1----------------------->

## 多项式、序数、二进制、二项式、贝塔、泊松、负二项式、贝塔二项式和正态分布示例。

一项研究的能力反映了一项测试发现一种效应的能力，如果这种效应确实存在的话。这意味着“功效”是一项研究**将**检测到一个**效应的**概率**，如果该效应确实存在的话。**更大的能量意味着假阴性或**II 型错误**的概率下降。

所以，如果我们说我们有 86%的能力，这意味着在 86/100 的试验中，我们会发现这个效应，如果它真的存在的话。然而，只有当我们进行完全相同的测试，并且我们预先指定了将要进行的测试的数量时，这个数字才成立。

![](img/653748b298e4fdfd75bfce1a4ec1109d.png)

没怀孕时怀孕(I 型错误)，怀孕时没怀孕(也是 I 型错误)。(它们都有不同的零假设)

![](img/1d4b5834b57aa522866b068a5b1764b9.png)

解释 I 型和 II 型误差的 2*2 矩阵。

![](img/a13ebb53eb0e3ffdc481eef8ba525c48.png)![](img/2c1476f221317ee2fba36c67daab71a9.png)

影响功率的参数，以及如何影响功率。

![](img/c0d4eadb71b931cd10ddb0821f7816b5.png)![](img/9e7c315e3915436ea4076a0bf7e41ef6.png)

幂的计算取决于分布，对于离散变量和连续变量，分布是不同的。

W 我现在要做的是使用我在 [**PROC GLIMMIX** 帖子中使用的关于分析顺序数据](https://medium.com/@marc.jacobs012/generalized-linear-mixed-models-in-sas-distributions-link-functions-scales-overdisperion-and-4b1c767bb89a)的相同示例。这意味着我将展示对[多项、序数](https://medium.com/@marc.jacobs012/analyzing-ordinal-data-in-sas-fe9d9d35a449)、[二元、二项式、贝塔](https://medium.com/@marc.jacobs012/analyzing-ordinal-data-in-sas-using-the-binary-binomial-and-beta-distribution-8efe5fe5af66)、[泊松、负二项式](https://medium.com/@marc.jacobs012/analyzing-ordinal-data-in-sas-poisson-and-negative-binomial-distribution-5f46b039aaeb)、正态和[贝塔二项式分布](https://medium.com/@marc.jacobs012/sample-size-calculation-using-the-beta-binomial-distribution-7adca91035a9)的幂计算。我还将展示如何对死亡率数据、对数转换数据和具有非结构化方差-协方差矩阵的数据进行研究。

让我们从多项式开始。

![](img/36d1c654894adaaf03e056e749e1019d.png)

预测概率来自具有一般 logit 链接的多项分布。

![](img/7b9815f5ac4f5312d625037e1fa54b2f.png)

运行多项式模型的代码

![](img/bab1fe9cb6ab645a8270d029a643af7b.png)

和 add hoc 代码来估计用于治疗的类型 III 测试的功率。[这是一个事后的功率计算，最好用来看一眼](https://medium.com/@marc.jacobs012/inference-estimates-p-values-and-confidence-limits-a-frequentist-approach-acdd45d94bd5)。仅此而已。更好的是模拟数据。

![](img/2af0b92126164df3c166262f4ac4743d.png)

和使用 t 分布代替正态分布的功效。

![](img/e9badd79c18c1c199e58b4814a5e6e2c.png)

模拟多项式模型。

![](img/8c1a45ec4c4ed93a8c8aab67602b0d19.png)![](img/ec8dbefa5a6f814e6c562d592f8fabe8.png)

看到单个模拟的结果。

![](img/c185bb18b86545be8ef0906ccea0f281.png)

运行模拟程序。

![](img/5f7da90fa0d8ee084f85eabcbd1b555f.png)

看到结果。这里，功效等于显著测试的数量/测试总数。

![](img/c0eed59f3be6758d822eaa6967344e33.png)

以及模拟的结果——每个分数每个处理的显著差异的数量。因为这是一个具有一般 logit 链接的多项式，所以每个分数的差异是分开的。

总之，当分析腹泻评分时，多项式模型是最直接的，因为它假设评分是互斥的，并分析每个评分类别的治疗效果。参考分数影响结果。

使用多项式模型估计功率可以通过两种方式进行:

1.  通过使用**PROC glim mix**+non-profiling 请求特别功率分析。
2.  通过模拟多项式数据，然后使用**PROC glim mix**——最灵活的方式。

现在，让我们看看如何使用多项式分布和累积 logit 函数重复上述示例。这将创建一个真正的序数模型。本质上，上面的模拟和我现在要展示的之间的区别仅仅在于我分析数据的方式

![](img/4f4c2a601da7d80cae60120c3c7c57a2.png)

分析数据的代码，以及寻找不同治疗之间差异的事后能力。如您所见，分数不再起作用，因为序数模型假设比例，这意味着分数 1 和 2 之间的差异与 0 和 1 相同。

![](img/317b307f51794226e3ce6849c9e94c99.png)

更好的方法是模拟数据，为此，您需要一个表格来填写比例。

![](img/c73feedfdb4a6b63bad0df2a20e63353.png)

代码与常规 logit 链接模型完全相同。

![](img/d66584f1dad5f83ba402a39746d73ec1.png)

每次治疗的模拟评分频率。

![](img/5d7c295d7b300873684e839d9af165d3.png)

和基于单个模拟的事后功率。

![](img/c44d9a2fd3bea3aaaf23d11af448e7df.png)

以及在全部数量的模拟后每次治疗的功率。

因此，顺序模型是多项式模型，但假设数字有一个自然的顺序。序数模型的功效可以以与多项式模型完全相同的方式进行估计和/或模拟。这里，再次，模拟方法提供了最大的自由和最大的优势，然而也是最复杂和最费时的行为。

现在，我将继续二项式的例子。下面您可以看到用于分析二项式数据、运行事后功效测试以及模拟二项式数据以进行模拟功效分析的代码(这应该是您的首选工作方式)。

![](img/8a5816f490913592856971bb05ff9f60.png)

用于分析和事后计算每个治疗比较的二项式功效的代码。

![](img/c84cdbfc2b95c0155ad3e9533e62a9d3.png)

结果。

![](img/0da8041ceb95b3eb97f0dd9971fbd2dd.png)

如果我**临时**改变方差会发生什么？

![](img/f1a6ce1ce935c890fa28b9abda15d1d7.png)

使用二项式分布模拟功耗分析的代码。

![](img/391511b3ac1654cd4ea6c5dc9f9e50da.png)

和功率图来估计随机化完全区组设计中所需的区组数。

![](img/27f24eaf73c706786e2a45be4b3ceb21.png)

检测显著差异的能力，作为治疗比较的块数的函数。

![](img/bb63df9c059443e4bc7dc9c11bfcf209.png)

另一种方法是模拟数据，一种随机完全区组设计的方法。

![](img/d1bd594484ea48d244f7ca110f0ac3cd.png)

我将获得的数据集

![](img/341359385396b6e24d79705859e96a82.png)

该图显示了我如何建立模拟，以及跨处理和区块的方差。

![](img/8738a303830132d60b4731b2a4e7d98b.png)

测试模拟可行性的单一模拟分析。不要看残差，它们不是正态和同质的。最好看看预测的比例。

![](img/74066003080a697d1cff6bb60c9c1056.png)

以及全仿真的分析。

![](img/c890ac1b1e8121688aa52e63ef9c207c.png)

和功率曲线。

总之，如果你想分析一个二元除法，你需要确定你是想把它作为一个**比例**还是作为一个**比率**来分析:

1.  比例=相同两个指标的比率±腹泻/粪便总量
2.  比率=两个不同指标的比率±腹泻/测得的总天数

二项式数据的功效计算遵循与序数/多项式功效计算相同的方法:

1.  使用 **PROC GLIMMIX** 可轻松进行后期处理。
2.  完全模拟更自由，但耗时更长，也更复杂。

下面你会看到使用 Beta 分布的例子。如你所见，程序总是一样的。我分析数据，进行事后功效计算，然后进行全面模拟，查看功效占被认为显著的治疗差异的百分比。

![](img/9fa4c0dd1a12dd7d368c931b1bc49188.png)

使用 Beta 分布的数据分析和事后功率计算。

![](img/2a8ad4c5f2dbe2e27d7c74b5b3648994.png)

beta 模型的完全模拟。

![](img/3be6d1ee5063cf3c5a2850d9a247e2e7.png)![](img/ab93651696c4fca3e7d9ed8f19e09a75.png)

模拟总体的平均值和标准差

![](img/421c5089d16e9448ec2e96729f84de74.png)

随机效应的协方差估计。[随着样本量的增加，这些将变得更小。](https://medium.com/@marc.jacobs012/randomness-in-mixed-models-8b7affd8a7c4)

![](img/3a457f82de7448a069312db31132e45f.png)

以及作为处理比较、块和所使用的估计和(共)方差的函数的β功效图。

总之，贝塔分布是一种连续分布，它处理比例数据的方式与二项式分布不同。使用 beta 分布寻找腹泻分数的功效意味着:

1.  你需要估计比例参数。
2.  你需要找到阿尔法和贝塔。

PROC GLIMMIX 可以提供一个好的开始，但是完整的模拟是最好的。

N ext-up 是泊松回归。泊松有很多共同点，它也是两个值的函数，一个是速率。要创建该比率，您需要包括偏移变量。

![](img/b5226c20fcdacd01514785e5c69dd1cd.png)

偏移量决定了很多。

![](img/52f9b0c6db31456e7a34f223e0fec864.png)

使用带有偏移变量的泊松分布。

![](img/01fb72be98677c406384647067a72ee2.png)

事后功率计算。

![](img/707e4914b26b98eb88129e5b7055d4da.png)

泊松的模拟。

![](img/55fcb458d23713d2bfb06b80e306ccad.png)![](img/7a785539aafaf271aebdd82318fed7c3.png)

模拟数据集。

![](img/5def3ab1c62541f4ed2eae19de2be510.png)![](img/744b948f0e9aac3ebb563ee4d939b310.png)

单一模拟的分析。没有过度分散。

![](img/9497fa812b351e908c91d22c7e3ff3bb.png)![](img/4d41bb21c29213f04f7b8bd979bd68a7.png)

左边是完整的模拟结果，右边是协方差估计。

![](img/0c9bad5dd9eb3d8840d90845317d79fc.png)

泊松分布的幂图。

既然我们在处理泊松，我们也应该处理负二项式，因为它们经常被连用。请记住，负二项式是一个混合模型，即伽玛-泊松模型。

![](img/3a259dc42a2cc5dd740b5c98767a1b1b.png)

负二项式也可以使用偏移量。

![](img/e705512b2b5ccf7c1a6fb50e91ad4a9e.png)![](img/d8fc4473106175fbd11cbb33fcd083a1.png)

模型的结果。

![](img/ccb9c81851676d4e7682aeba86e247d5.png)

临时权力。

![](img/125807292747fc2140ab355127312c10.png)

完整的模拟代码。

![](img/c78a7e4b2da89ae3842ca318551399c8.png)![](img/335639e3d0ab17f0f6e20845a9ca8aa6.png)

模拟数据集

![](img/aec1c49199dbb649c02d6188d4cba11a.png)![](img/e22d8544650c467133dfae1a9089573f.png)

块和缩放的协方差估计，左边是块方差，右边是缩放参数。

![](img/731358a2df0bc7405bd5c2910ad0acc7.png)

负二项式的幂图。

![](img/320f648c55f747a67c982341fd0e3c2d.png)![](img/4e9b0be94bb4dd4dbbf714fb52859c44.png)

泊松与负二项式幂计算。存在相当大的差异，这可能是由于泊松低估了方差，这是其均值-方差关系的结果(均值=泊松中的方差)。

因此，其他两种可用于模拟有序数据(如动物腹泻)的分布是泊松分布和负二项式分布。两者都处理计数数据，但负二项式更容易处理，因为它估计模型内的方差。这个方差估计是功率模拟中的比例参数和关键。此外，我们现在必须有效地模拟两件事:

1.  偏移变量
2.  腹泻的次数

N ext up，一个与 power for[完全不同的结果，它是用来衡量家禽动物产仔质量的产仔数](https://pubmed.ncbi.nlm.nih.gov/28066939/)。此指标是一个顺序指标，但它有如此多的值(0–10，步长为 0.5)，可以分析为来自正态分布。

![](img/8646b8e0ba7802cafd64ae3b76d7024f.png)![](img/053dca94b1fd0e325676e66f8f6ea471.png)

PROC GLIMMIX 代码示例，用于分析数据和事后功率计算。

![](img/3214bd921f8fa16bb6ad625a86de21fa.png)

使用非结构化方差-协方差矩阵分析重复测量数据的代码，如上所示。

![](img/1a954ca3d9452ad6b070fb5e54399cde.png)

模拟的协方差矩阵。

![](img/095624bd1d91f0de271213df84df8de6.png)![](img/c31b401a389a6772981da5897c442273.png)

测试分析——看起来不错。

![](img/3e81d3d7205a780b61f564517f29cd9c.png)![](img/f7fd2616ebf956da0669a354d3a29d69.png)

看起来又好了。

![](img/70ec08c1ce7e74dba4609cddfded51f0.png)

和每个时间点每次治疗比较的实际功率曲线。

从技术上来说，窝卵分数是分类数据。但是，因为有如此多的类别，您可以安全地应用正态分布。这意味着，对于一个[完全随机区组设计](https://medium.com/@marc.jacobs012/building-and-optimizing-randomized-complete-block-designs-using-sas-c973d127d862)，您可以使用正常数据的幂码来模拟产仔数的数据。

下一个例子处理分析木制乳房数据，这是多项式/序数数据，正如你从下面的图中看到的。

![](img/184e072f926c43aa89f26521e3456e5d.png)![](img/24db9f873def215d61b433206ef2049d.png)

每次治疗的评分频率分布。

![](img/9986cec0dad1729f96885a38afd3d07a.png)![](img/ea1b952991fae1eca0caf5c526c3a054.png)

数据分析和整体事后电源分析。如果你看左边的图，89%的后验权力并不意味着什么。特别是，因为“治疗”实际上是更大曲线的剂量反应部分。

下面是两个模拟场景，每个处理使用相同的比例。

![](img/0250c4e9f90e838dc5b8d1fe03f68801.png)![](img/fb42e6dd6bdbd586b8a019faa4529584.png)

两种不同的模拟场景。

![](img/02f234f2269e58dff7fcc6b00d998c5c.png)

以及最大模拟数据集的功耗计算。

总之，木制乳房数据可以使用顺序或多项式分布进行建模。这里，我们使用了顺序分布。从木制乳房试验中提取能量并模拟新数据的方式与腹泻相同。因此，您可以使用许多其他分布，这取决于您希望如何分析 wooden breast。

下面的例子将处理我将使用负二项式(因为它有两个参数)和对数标度分析的比率。

![](img/a6902e9187eec237de3bc7f8eb251f68.png)![](img/850d90f6a42cbc36459aaf13b50c31c0.png)![](img/cf4ab3fbf93280f2a2d54809fa2b6c7d.png)![](img/1a0f074b843eed59d0f0610ef2c27132.png)

代码和结果。

![](img/d26b94e584a66084e36c40253fdb18a0.png)![](img/fb84f988f34443439bcbe62949e28bb1.png)

事后功率计算。

![](img/c3fc54d2647ba1230704a99fcd58f2e4.png)

以及一种使用事后功率计算来改变场景的方法。我在这里做的是改变方差分量和样本大小。这当然只是一种筛选方法，永远无法取代真正的模拟。

![](img/6abec8fd09fcc812fcf9de0a81f3e2e8.png)![](img/71a43ffd91210b4502b28fd5b58ec30f.png)

左边是来自原始数据的方差-协方差估计，左边是替换值。不要担心没有标准误差。PROC GLIMMIX 将使用接近公式状态下的估计值。

![](img/96950d1b89178f9f786f6b790d08dfb2.png)![](img/abe903a9aa0ab8c420728e1e061a10dd.png)

权力的变化

负二项分布是一种有明显吸引力但也容易混淆的分布。让我们看看[维基百科](https://en.wikipedia.org/wiki/Negative_binomial_distribution)上的一些引文:

> **负二项分布**是一种[离散概率分布](https://en.wikipedia.org/wiki/Discrete_probability_distribution)，它模拟了在指定(非随机)数量的失败(表示为 *r* )发生之前，一系列独立且同分布的[伯努利试验](https://en.wikipedia.org/wiki/Bernoulli_trial)中的成功数量

这意味着负二项式可以表示为 NB ( *r，p* )，其中 *r* 是成功之前的失败次数，而 *p* 是成功的几率——r*不能为负，并且 *p* 必须介于 0 和 1 之间。*

由于负二项式是一个混合模型，它也可以表示为伽玛-泊松，然后我们必须谈论形状，规模和速率参数。

> 负二项分布也作为[泊松分布](https://en.wikipedia.org/wiki/Poisson_distribution)(即[复合概率分布](https://en.wikipedia.org/wiki/Compound_probability_distribution))的连续混合出现，其中泊松率的混合分布是[伽马分布](https://en.wikipedia.org/wiki/Gamma_distribution)。也就是说，我们可以将负二项式视为泊松( *λ* )分布，其中 *λ* 本身是一个随机变量，分布为伽玛分布，其形状= *r* ，比例*θ*=*p*/(1-p)或相应的比率*β*=(1-p/*p*

这就是 SAS 处理负二项式的方法。由此，当然可以提取概率值。

![](img/7d6037ea3d665568937d74adafb2fb90.png)

负二项式中最棘手的参数是比例参数。负二项有很多种表达方式。

![](img/266e24a2a269b2aad98a74a09833275a.png)![](img/fa004d92a430f63824e88abf91763900.png)

在事后分析中使用封闭公式改变方差-协方差的模型，以及比较处理时的功效估计。

![](img/6fb2de5a211546679cd278d150418766.png)![](img/a790b77e025aea4a79f841bddb9d9d08.png)

以及通过增加自由度来改变样本大小。

下面，您可以看到一个数据集的创建，从中可以模拟负二项分布。

![](img/59c712ea18b5dd1ad58d781f933469fb.png)![](img/568dc3a67e38fd0e69431d0886c35559.png)

模拟数据集

![](img/2027a349457d7039cecdbc79822fba1d.png)

模型的测试。

![](img/4d2451d2cf316a2cb742309a0fea5705.png)

事后权力分析。

就我个人而言，我发现这部分是最棘手的，因为 power for 的结果是一个构建的速率。因此，我无法完全模拟它，而是使用 **PROC GLIMMIX** 进行新的功耗分析。

使用 **PROC GLIMMIX** 您可以:

1.  通过*参数*语句改变差异
2.  通过 *DF* 语句增加样本量

下面，我将向你展示如何模拟一个贝塔二项分布来估计死产小猪的数量。[我在](https://medium.com/@marc.jacobs012/sample-size-calculation-using-the-beta-binomial-distribution-7adca91035a9)之前已经发布过这个，但是在这里会稍微扩展一下。

![](img/eb0bb6f5c838d27a5f131bd515c2313c.png)

使用正态和负二项分布分析出生活产数据。尽管残差图不适用于负二项式，但最好选择该分布，因为数据本身是离散的。

![](img/eb59950d5479cc2e159db23cf6316428.png)

模拟代码通过对总出生数使用泊松以及对活产数使用二项式来估计/模拟活产动物。

![](img/ec79d7561187b3fbb6984a191cb3c8b4.png)

以及当我模拟 1–5%的差异时的比例差异。这样的话，还是有很大的可变性。

![](img/13ebd331f333d72518310a09dc0a231a.png)

但是，每次治疗仅使用 100 头母猪，当使用早期试验的差异时，我应该能够轻松实现 100%的功率。

然而，研究的问题不是活产婴儿有 3%的差异，而是死产婴儿有 3%的差异。尽管这是一个零和游戏，但当谈到差异时，两者并不是零和的。因此，为了模拟一个场景，其中静产有 3%的差异，我们需要使用静产进行模拟。

![](img/721247ed720da64e395ca9159fb22a26.png)

让我们使用数据，使用二项式分布。

![](img/ea40e16a991c4d189bd55208c5adfcba.png)

我们可以通过两种方式包括 sow 变化:包括随机 sow 成分(准二项式)或使用β-二项式分布，其中概率部分来自β。

为了模拟贝塔-二项式，我们需要用贝塔分布来模拟二项式的概率部分。这样，将会有更多的方差，我们使用混合分布来模拟母猪方差。

![](img/55009ecc0bdf7354e6c184d578ae142e.png)

以上的关键是找到属于某个处理平均值和方差的α和β值

![](img/0194ea49cabd99440680bf4f953fbc22.png)

让我们寻找α和β值，并将其与两种治疗的平均值和方差估计值联系起来。

![](img/a67312a706e290826befa777af96f33f.png)

这是我发现的。

![](img/a9002113df6c5bbfcdbd931aee88eaba.png)![](img/8e94d81f8c97531fef931a6b27669520.png)

在这里，你可以看到均值和方差之间的关系，以及阿尔法和贝塔。

因此，在开始全面模拟之前，我将再次解释一下这个过程:

1.  我想模特仍然出生。
2.  我寻找每次治疗比例的平均值/方差。
3.  我寻找每种治疗各自的α和β值来填充β分布。
4.  我从贝塔分布中抽取样本来填充二项分布。
5.  我从二项分布中抽取样本，使用贝塔分布中的概率和泊松分布中的动物数量。
6.  这样，对于两个处理，以及模拟的比例差异，我可以模拟每个处理的母猪数量需要达到 3%的差异。

![](img/f87bcb813350309456babe564e862079.png)

我上面解释的代码。

![](img/7a72706d200301194e4ead91d877f52b.png)

和力量。这一次，使用 100 只动物会让你一无所获。你需要很多动物。

总之，模拟数据来估计死产、活产和总产可能相当困难。生命出生和总出生接近正态分布，但都是计数值。因为我们想估计死胎，我们需要坚持死胎。可以通过以下方式进行模拟:

1 .二项分布→变异被低估

2 .随机 sow 包含→通过随机组件的变化

3 .β-二项式→通过混合分布的变化

下面你可以看到一个二项式分布可以用来计算鸟类死亡率的例子。这里，我使用的是随机完全区组设计。

![](img/3f44be6476fe57f9a4c48006592a1458.png)

在比较五种治疗的死亡率概率时，改变块的数量(从而改变样本大小)的代码。

![](img/5620447a92ceb1a2146f96220f558aa9.png)

和功率图。

在动物试验中，死亡率通常很低。因此，发现死亡率差异(如果存在的话)的能力非常低。这未必是一件坏事——你不想要死亡。如果你想模拟死亡率，那么使用二项分布。

这是脚垫损伤的模拟。

![](img/1f0db92029e440c27b5cd6365a7d119b.png)![](img/2997b232b462d990b2d7f39a967d6312.png)

分析试验并使用事后功率计算的代码。

![](img/6baff495197fad2f8e07ca3f7690b0d1.png)

和完全模拟后的功率图，完全模拟遵循与死亡率模拟相同的设置。

就像模拟腹泻和死亡率一样，可以使用二项式分布来模拟足垫损伤。这使得进行分析非常简单。

最后但同样重要的是，偏好数据是一种有趣的数据类型，因为它们是互斥的。零和，如果你想在一次分析中得到结果，需要一个双矩阵。这其实是矫枉过正。

![](img/40d61d2e420af4b8f93a659b5c6e8caf.png)

对数据的分析

和模拟代码。我确信这可以做得更简单，但至少你知道它看起来像什么。为此，我还不得不使用 **SAS / IML** 。

![](img/6a2510289bbcbdf0d0b23a896e61a310.png)![](img/8f47af08c0627dd64b78a46531a7e336.png)![](img/7ad119758aea6643b678cc0f38199c29.png)![](img/b253a3b7aa8b9d326c3fcc7fe1379c0d.png)![](img/338f91a1c9d42748c73af3b43f2a1064.png)

结果呢。

![](img/2e414ed162c93836489816419e625c44.png)

结果呢

可以使用正态分布来分析偏好数据。使用非结构化方差矩阵，once 可以很容易地模拟随时间变化的偏好数据。这里，模拟方法是最简单的。

这是相当多的。我希望你喜欢它！