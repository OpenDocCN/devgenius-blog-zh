<html>
<head>
<title>Laravel Data-Driven Strategies #4: user navigation tracking and funnel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel 数据驱动策略#4:用户导航跟踪和漏斗</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-data-driven-strategies-4-user-navigation-tracking-and-funnel-16fe4c0760b7?source=collection_archive---------3-----------------------#2021-04-28">https://blog.devgenius.io/laravel-data-driven-strategies-4-user-navigation-tracking-and-funnel-16fe4c0760b7?source=collection_archive---------3-----------------------#2021-04-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/77b83ec0439127b22a6efbbe0705e176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AMMWHgcTe3ZVYs8Z"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@cifilter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">香农波特</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><blockquote class="ka kb kc"><p id="15ea" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">“当组织关注业务或技术，但不关注客户或用户体验时，就会出现无意的设计。结果是出现了一种通常并不愉快的体验。”Jared M. Spool </p></blockquote><p id="7d76" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">设计一个大系统可能会导致意想不到的行为。随着功能的增加，它们之间的联系可能会变弱，导致不必要的和不一致的用户体验，损害您的平台使用。</p><p id="fedd" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">在不知道用户如何使用你的网站的情况下，很少会注意到不想要的行为，这就是分析加入聚会的地方。</p><p id="140c" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">许多人依赖于<a class="ae jz" href="https://analytics.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌分析</a>，它无需你写一行代码就能给出许多报告，其他人依赖于<a class="ae jz" href="https://www.cloudflare.com/" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>，它像 CDN 一样记录所有的流量，但是如果你想自己了解用户行为呢？</p><h1 id="421d" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">安装您的个人分析系统</h1><p id="d2a7" class="pw-post-body-paragraph kd ke in kg b kh md kj kk kl me kn ko lc mf kr ks ld mg kv kw le mh kz la lb ig bi translated">有许多为 Laravel 构建的包可以帮助您更快更容易地构建应用程序。我在这里选择的包是<a class="ae jz" href="https://github.com/antonioribeiro/tracker" rel="noopener ugc nofollow" target="_blank"> pragmarx/tracker </a>。</p><blockquote class="ka kb kc"><p id="35ab" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">S <!-- -->将用户跟踪信息存储在索引化和规范化的数据库表中，可以减少磁盘空间的浪费，并且便于提取有关您的应用程序和业务的有价值信息~跟踪器</p></blockquote><p id="3b2b" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">首先，与其他所有软件包一样，只需:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1929" class="mr lg in mn b gy ms mt l mu mv">&gt; <strong class="mn io">composer require pragmarx/tracker</strong></span></pre><p id="5143" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">如果您的 Laravel 安装相当新，您会看到此时您的应用程序已经知道这个包:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="48bb" class="mr lg in mn b gy ms mt l mu mv">Discovered Package:<strong class="mn io"> pragmarx/tracker</strong></span></pre><p id="3e10" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">现在发布与这个包相关的所有内容</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="89bc" class="mr lg in mn b gy ms mt l mu mv">&gt; <strong class="mn io">php artisan vendor:publish --provider="PragmaRX\Tracker\Vendor\Laravel\ServiceProvider"</strong></span><span id="73bd" class="mr lg in mn b gy mw mt l mu mv">Copied File [/vendor/pragmarx/tracker/src/config/config.php] To [/config/tracker.php]<br/>Copied Directory [/vendor/pragmarx/tracker/src/migrations] To [/database/migrations]<br/><em class="kf">Publishing complete.</em></span></pre><p id="bfb3" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">这将发布 34 个迁移文件(将来可能会更多)和一个配置文件。</p><p id="4247" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">现在只需通过配置文件(<code class="fe mx my mz mn b">config/tracker.php</code>)启用跟踪器:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4cdb" class="mr lg in mn b gy ms mt l mu mv">'enabled' =&gt; true,</span></pre><p id="efd2" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">跟踪器配置文件也有一个配置文件供数据库连接使用(来自<code class="fe mx my mz mn b">config/database.php</code>)，它的缺省值是<code class="fe mx my mz mn b">tracker</code>，所以你必须添加一个连接。我将重用我的 MySQL 连接，因此它将成为</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="281d" class="mr lg in mn b gy ms mt l mu mv">'connection' =&gt; 'mysql',</span></pre><p id="58c2" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">确保 MySQL 不处于数据库配置中 connections 键的严格模式:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="32e5" class="mr lg in mn b gy ms mt l mu mv">'connections' =&gt; [<br/> // ...<br/> 'mysql' =&gt; [<br/>  'driver' =&gt; 'mysql',<br/>  'url' =&gt; env('DATABASE_URL'),<br/>  'host' =&gt; env('DB_HOST', '127.0.0.1'),<br/>  'port' =&gt; env('DB_PORT', '3306'),<br/>  'database' =&gt; env('DB_DATABASE', 'forge'),<br/>  'username' =&gt; env('DB_USERNAME', 'forge'),<br/>  'password' =&gt; env('DB_PASSWORD', ''),<br/>  // ...<br/>  <strong class="mn io">'strict' =&gt; false,</strong><br/>  // ...<br/> ],<br/> // ...<br/>],</span></pre><p id="c6db" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">最后，迁移所有内容:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="031d" class="mr lg in mn b gy ms mt l mu mv">&gt; php artisan migrate<br/>[ ... <em class="kf">suppressed output, trust me, it's too long</em> ... ]</span></pre><h1 id="9098" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">配置跟踪器</h1><blockquote class="ka kb kc"><p id="a3fe" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">默认情况下，所有功能都被禁用</p></blockquote><p id="e717" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">追踪器是非常可配置的，你可以启用/禁用任何你想要的:</p><ul class=""><li id="dfd9" class="na nb in kg b kh ki kl km lc nc ld nd le ne lb nf ng nh ni bi translated">隐藏物</li><li id="84eb" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">机器人跟踪</li><li id="30f0" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">记录不可跟踪的会话</li><li id="cfa9" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">HTTP 日志记录</li><li id="aac5" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">控制台命令日志记录</li><li id="43b9" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">SQL 查询日志记录</li><li id="6faa" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">SQL 查询绑定日志记录</li><li id="bf19" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">事件</li><li id="4e43" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">地理信息系统</li><li id="a96f" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">用户代理</li><li id="5e07" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">用户</li><li id="c8b9" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">设备</li><li id="fbf7" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">语言</li><li id="5f5b" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">HTTP 推荐人</li><li id="3da7" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">小路</li><li id="bd3a" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">HTTP 查询</li><li id="939c" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">路线</li><li id="aae6" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">例外</li><li id="ceb9" class="na nb in kg b kh nj kl nk lc nl ld nm le nn lb nf ng nh ni bi translated">统计面板</li></ul><h1 id="aa11" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">统计面板</h1><p id="84f5" class="pw-post-body-paragraph kd ke in kg b kh md kj kk kl me kn ko lc mf kr ks ld mg kv kw le mh kz la lb ig bi translated">Tracker 有一个统计面板，只需几个步骤即可完成:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1881" class="mr lg in mn b gy ms mt l mu mv">&gt; <!-- -->git clone https://github.com/BlackrockDigital/startbootstrap-sb-admin-2.git public/templates/sb-admin-2<br/>&gt; cd public/templates/sb-admin-2<br/>&gt; git checkout tags/v3.3.7+1</span></pre><p id="96e1" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">显然……在<code class="fe mx my mz mn b">config/tracker.php</code>启用它</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a721" class="mr lg in mn b gy ms mt l mu mv">'stats_panel_enabled' =&gt; true,</span></pre><p id="da85" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">你甚至可以调整它的基本路径</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="bceb" class="mr lg in mn b gy ms mt l mu mv">'stats_base_uri' =&gt; <strong class="mn io">'stats'</strong>,</span></pre><p id="87b4" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">只有经过身份验证的用户才能看到统计信息，但前提是您通过 mutator 定义一个假的 admin 属性来授权他们:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="296a" class="mr lg in mn b gy ms mt l mu mv">public function getIsAdminAttribute(): bool<br/>{<br/>    return true; // <em class="kf">your logic here</em><br/>}</span></pre><p id="c2c4" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">现在打开你的<code class="fe mx my mz mn b">/stats</code></p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/31d850a8560ebd3b03faca7767715a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66RDeyuymWlk5HlYfJW_rg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">统计页面</figcaption></figure><p id="8b90" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">参观之后…</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/50d69ad7221d76ef801a9edf842cd556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kjUsXaqFhM83KITpPb07IA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">访问后的统计页面</figcaption></figure><p id="2c21" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">点击一个 ID，你可以看到完整的会话</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/81062d6c4d909396e731ccc68708a23b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfIN7AoARvpaQP-psG35MA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">用户访问</figcaption></figure><p id="f77f" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">基本上…仅此而已！</p><h1 id="d6cf" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">GeoIP？</h1><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/f78e266831083ed6d2612d194e2b567e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rbXH8mLwKop4eDJE"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@heerikhuize?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Matthijs van Heerikhuize </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><blockquote class="ka kb kc"><p id="f012" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">GeoIP 是指通过识别计算机终端的 IP 地址来定位该终端的地理位置的方法。</p></blockquote><p id="6a08" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">使用 GeoIP 可以帮助您通过访问者的 IP 地址来定位他们。GeoIP 本地化非常容易实现:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8db4" class="mr lg in mn b gy ms mt l mu mv">composer require "geoip2/geoip2":"~2.0"</span></pre><p id="6358" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">软件包安装完成后，您可以通过<code class="fe mx my mz mn b">config/tracker.php</code>来启用它:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="31c8" class="mr lg in mn b gy ms mt l mu mv">'log_geoip' =&gt; true,</span></pre><h1 id="416d" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">现在呢？</h1><p id="5146" class="pw-post-body-paragraph kd ke in kg b kh md kj kk kl me kn ko lc mf kr ks ld mg kv kw le mh kz la lb ig bi translated">现在你所有的数据都在那里，你只需要分析、研究和组合它们，就能了解你的用户是如何使用网站的。如果你想知道更多，你可以随时自己查询数据，追踪器是由 13 个表格组成，你可以通过自己挖掘数据库结构或阅读文档来组合！</p><p id="04eb" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">现在该由你来创造伟大的东西了！🥂</p><p id="caf4" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">请继续关注其他数据驱动的策略，如果你愿意，花一点时间️️to 留下评论，谈谈你如何做出由工具支持的数据驱动的决策！☕️</p></div></div>    
</body>
</html>