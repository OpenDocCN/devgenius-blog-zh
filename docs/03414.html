<html>
<head>
<title>Best of Modern JavaScript — Closable Iterators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华——可关闭迭代器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-of-modern-javascript-closable-iterators-a1dfae05e3cd?source=collection_archive---------6-----------------------#2020-10-31">https://blog.devgenius.io/best-of-modern-javascript-closable-iterators-a1dfae05e3cd?source=collection_archive---------6-----------------------#2020-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d8c4f313c7d87b8a6b8e18bf8a0414cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xX7W0mIzOBikDNEW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马克·卡马洛夫在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="41c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究JavaScript可迭代对象。</p><h1 id="ea46" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">可关闭迭代器</h1><p id="8d44" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果迭代器有<code class="fe me mf mg mh b">return</code>方法，它就是可关闭的。</p><p id="ebb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个可选功能。</p><p id="db27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数组迭代器是不可关闭的。</p><p id="0631" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7002" class="mq lc iq mh b gy mr ms l mt mu">const arr = ['foo', 'bar', 'baz'];<br/>const iterator = arr[Symbol.iterator]();<br/>console.log('return' in iterator)</span></pre><p id="e654" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到没有<code class="fe me mf mg mh b">return</code>方法。</p><p id="c705" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，缺省情况下，生成器对象是可关闭的。</p><p id="a751" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="401d" class="mq lc iq mh b gy mr ms l mt mu">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="7c47" class="mq lc iq mh b gy mv ms l mt mu">const gen = genFn();</span></pre><p id="7ae8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过调用生成器<code class="fe me mf mg mh b">gen</code>上的<code class="fe me mf mg mh b">return</code>方法来完成对它的调用。</p><p id="2c2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="352c" class="mq lc iq mh b gy mr ms l mt mu">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="1b50" class="mq lc iq mh b gy mv ms l mt mu">const gen = genFn();<br/>console.log(gen.next());<br/>gen.return();<br/>console.log(gen.next());<br/>console.log(gen.next());</span></pre><p id="fded" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们给<code class="fe me mf mg mh b">return</code>打了电话之后，发电机就完成了。</p><p id="143d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以最后2个<code class="fe me mf mg mh b">return</code>调用给我们:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="51d7" class="mq lc iq mh b gy mr ms l mt mu">{value: undefined, done: true}</span></pre><p id="d6e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果迭代器是不可关闭的，我们可以在从for-of循环中退出后继续迭代。</p><p id="3533" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们有一个带有不可关闭迭代器(如数组)的iterable，我们可以继续遍历它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e1be" class="mq lc iq mh b gy mr ms l mt mu">const arr = ['foo', 'bar', 'baz'];</span><span id="0a61" class="mq lc iq mh b gy mv ms l mt mu">for (const x of arr) {<br/>  console.log(x);<br/>  break;<br/>}<br/>for (const x of arr) {<br/>  console.log(x);<br/>}</span></pre><p id="7085" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们使用<code class="fe me mf mg mh b">break</code>跳出第一个循环后，第二个循环仍然从头到尾迭代。</p><h1 id="bd2f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">防止迭代器被关闭</h1><p id="85ea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过改变<code class="fe me mf mg mh b">return</code>方法来防止迭代器被关闭。</p><p id="7019" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将<code class="fe me mf mg mh b">done</code>集合返回到<code class="fe me mf mg mh b">false</code>，那么它就无法关闭。</p><p id="2d94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="bcc0" class="mq lc iq mh b gy mr ms l mt mu">class NoReturn {<br/>  constructor(iterator) {<br/>    this.iterator = iterator;<br/>  }<br/>  [Symbol.iterator]() {<br/>    return this;<br/>  }<br/>  next() {<br/>    return this.iterator.next();<br/>  }<br/>  return (value) {<br/>    return {<br/>      done: false,<br/>      value<br/>    };<br/>  }<br/>}</span><span id="8388" class="mq lc iq mh b gy mv ms l mt mu">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}<br/>const gen = genFn();<br/>const noReturn = new NoReturn(gen);</span><span id="1c25" class="mq lc iq mh b gy mv ms l mt mu">for (const x of noReturn) {<br/>  console.log(x);<br/>  break;<br/>}<br/>for (const x of noReturn) {<br/>  console.log(x);<br/>}</span></pre><p id="f665" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我们将可关闭的生成器传递给了<code class="fe me mf mg mh b">NoReturn</code>构造函数，它将继续遍历这些项。</p><p id="20cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="00ce" class="mq lc iq mh b gy mr ms l mt mu">foo<br/>bar<br/>baz</span></pre><p id="91c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录在案。</p><p id="4bb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它只是从停止的地方继续迭代，因为它还没有被关闭。</p><p id="a54a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此它可以从停止的地方继续迭代。</p><p id="cb38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过将<code class="fe me mf mg mh b">prototype.return</code>方法设置为<code class="fe me mf mg mh b">undefined</code>来使生成器不可关闭。</p><p id="c0cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们应该意识到这并不适用于所有的transpilers。</p><p id="a98f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6bf6" class="mq lc iq mh b gy mr ms l mt mu">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="1a52" class="mq lc iq mh b gy mv ms l mt mu">genFn.prototype.return = undefined;</span></pre><p id="1ce9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">genFn.prototype.return</code>属性设置为<code class="fe me mf mg mh b">undefined</code>。</p><p id="f7cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写下以下内容来确认它是不可关闭的:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ef62" class="mq lc iq mh b gy mr ms l mt mu">const gen = genFn();</span><span id="e59c" class="mq lc iq mh b gy mv ms l mt mu">for (const x of gen) {<br/>  console.log(x);<br/>  break;<br/>}<br/>for (const x of gen) {<br/>  console.log(x);<br/>}</span></pre><p id="4ac1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="398d" class="mq lc iq mh b gy mr ms l mt mu">foo<br/>bar<br/>baz</span></pre><p id="a6f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从两个循环中。</p><p id="0e36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe me mf mg mh b">break</code>没有关闭发电机。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/aede11e1194ac88a135d53feef6ec8c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v6WDCXin-SmcfRBd"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@ninjason?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梁杰森</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="e89f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="fff9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以调整是否可以关闭迭代器。</p><p id="5f81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果关闭被禁用，这将让我们在中断和类似操作后遍历迭代器项。</p></div></div>    
</body>
</html>