<html>
<head>
<title>Code Smell 108 — Float Assertions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味108 —浮点断言</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/code-smell-108-float-assertions-ce806da449bb?source=collection_archive---------8-----------------------#2021-12-03">https://blog.devgenius.io/code-smell-108-float-assertions-ce806da449bb?source=collection_archive---------8-----------------------#2021-12-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="30d2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">断言两个浮点数是相同的是一个非常困难的问题</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/188e54a69d2943052f459671005b40e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTwZq7ceSHClNuAconBNig.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">米卡·鲍梅斯特在<a class="ae ks" href="https://unsplash.com/s/photos/numbers" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><blockquote class="kt ku kv"><p id="2e75" class="kw kx ky kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">TL；博士:不要比较浮动</p></blockquote><h1 id="ce63" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">问题</h1><ul class=""><li id="ff76" class="ml mm in kz b la mn ld mo mp mq mr ms mt mu ls mv mw mx my bi translated">错误的测试结果</li><li id="271f" class="ml mm in kz b la mz ld na mp nb mr nc mt nd ls mv mw mx my bi translated">脆弱的测试</li><li id="e904" class="ml mm in kz b la mz ld na mp nb mr nc mt nd ls mv mw mx my bi translated">失败快速原则违反</li></ul><h1 id="076f" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">解决方法</h1><p id="8793" class="pw-post-body-paragraph kw kx in kz b la mn jo lc ld mo jr lf mp ne li lj mr nf lm ln mt ng lq lr ls ig bi translated">1.避免浮动，除非你有真正的性能问题</p><p id="7604" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">2.使用任意精度的数字</p><p id="e91b" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">3.如果你需要比较浮动和公差。</p><h1 id="e46c" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">语境</h1><p id="dc0b" class="pw-post-body-paragraph kw kx in kz b la mn jo lc ld mo jr lf mp ne li lj mr nf lm ln mt ng lq lr ls ig bi translated">比较浮点数是一个古老的计算机科学问题。</p><p id="0e27" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">通常的解决方案是使用阈值比较。</p><p id="7b9f" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">我们建议完全避免使用浮点数，尽量使用无限精度的数字。</p><h1 id="b9c7" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">示例代码</h1><h2 id="f36f" class="nh lu in bd lv ni nj dn lz nk nl dp md mp nm nn mf mr no np mh mt nq nr mj ns bi translated">错误的</h2><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="cacb" class="nh lu in nu b gy ny nz l oa ob">Assert.assertEquals(0.0012f, 0.0012f); // Deprecated<br/>Assert.assertTrue(0.0012f == 0.0012f); // Not JUnit — Smell</span></pre><h2 id="457b" class="nh lu in bd lv ni nj dn lz nk nl dp md mp nm nn mf mr no np mh mt nq nr mj ns bi translated">对吧</h2><pre class="kd ke kf kg gt nt nu nv nw aw nx bi"><span id="3928" class="nh lu in nu b gy ny nz l oa ob">Assert.assertEquals(0.0012f, 0.0014f, 0.0002); // true<br/>Assert.assertEquals(0.0012f, 0.0014f, 0.0001); // false<br/>// last parameter is the delta threshold</span><span id="b759" class="nh lu in nu b gy oc nz l oa ob">Assert.assertEquals(12 / 10000, 12 / 10000); // true<br/>Assert.assertEquals(12 / 10000, 14 / 10000); // false</span></pre><h1 id="064b" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">侦查</h1><p id="fa01" class="pw-post-body-paragraph kw kx in kz b la mn jo lc ld mo jr lf mp ne li lj mr nf lm ln mt ng lq lr ls ig bi translated">[X]自动</p><p id="2759" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">我们可以在测试框架上添加一个检查图标<em class="ky"> assertEquals() </em>来避免检查浮动。</p><h1 id="4e49" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">标签</h1><ul class=""><li id="f211" class="ml mm in kz b la mn ld mo mp mq mr ms mt mu ls mv mw mx my bi translated">测试气味</li></ul><h1 id="3ac1" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">结论</h1><p id="2cbb" class="pw-post-body-paragraph kw kx in kz b la mn jo lc ld mo jr lf mp ne li lj mr nf lm ln mt ng lq lr ls ig bi translated">我们应该总是避免比较浮点数。</p><h1 id="2119" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">关系</h1><div class="od oe gp gr of og"><a rel="noopener  ugc nofollow" target="_blank" href="/code-smell-71-magic-floats-disguised-as-decimals-31271b957ac5"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">代码气味71 —伪装成小数的魔法浮动</h2><div class="on l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">blog.devgenius.io</p></div></div><div class="oo l"><div class="op l oq or os oo ot km og"/></div></div></a></div><h1 id="65e3" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">更多信息</h1><div class="od oe gp gr of og"><a href="https://codeburst.io/fail-fast-3f3f036032b0" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">快速失败</h2><div class="ou l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">失败是时尚。制造比思考容易得多，失败不是耻辱，让我们把这个想法带到我们的…</h3></div><div class="on l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">codeburst.io</p></div></div><div class="oo l"><div class="ov l oq or os oo ot km og"/></div></div></a></div></div><div class="ab cl ow ox hr oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="ig ih ii ij ik"><blockquote class="kt ku kv"><p id="d6ca" class="kw kx ky kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">上帝创造了自然数；其他一切都是人类的工作。</p></blockquote><p id="c6ee" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated"><em class="ky">利奥波德·克罗内克</em></p><div class="od oe gp gr of og"><a rel="noopener  ugc nofollow" target="_blank" href="/software-engineering-great-quotes-3af63cea6782"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">软件工程名言</h2><div class="ou l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="on l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">blog.devgenius.io</p></div></div><div class="oo l"><div class="pd l oq or os oo ot km og"/></div></div></a></div></div><div class="ab cl ow ox hr oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="ig ih ii ij ik"><p id="abd4" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated">本文是CodeSmell系列的一部分。</p><div class="od oe gp gr of og"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">如何找到你的代码中有问题的部分</h2><div class="ou l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="on l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">blog.devgenius.io</p></div></div><div class="oo l"><div class="pe l oq or os oo ot km og"/></div></div></a></div></div><div class="ab cl ow ox hr oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="ig ih ii ij ik"><p id="7233" class="pw-post-body-paragraph kw kx in kz b la lb jo lc ld le jr lf mp lh li lj mr ll lm ln mt lp lq lr ls ig bi translated"><em class="ky">更多内容尽在</em><a class="ae ks" href="http://blog.devgenius.io" rel="noopener ugc nofollow" target="_blank"><em class="ky">blog . dev genius . io</em></a><em class="ky">。</em></p></div></div>    
</body>
</html>