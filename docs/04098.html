<html>
<head>
<title>Using MongoDB with Mongoose — Dynamic References</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB和mongose—动态引用</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-mongodb-with-mongoose-dynamic-references-fb2d0eb0ee51?source=collection_archive---------3-----------------------#2021-01-25">https://blog.devgenius.io/using-mongodb-with-mongoose-dynamic-references-fb2d0eb0ee51?source=collection_archive---------3-----------------------#2021-01-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e398516a0a355d103afb49ac99d0768d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_3eOyBU1mzje5eIP"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@veverkolog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杜安·斯美塔纳</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="eae0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简化MongoDB数据库操作，我们可以使用mongose NPM包来简化MongoDB数据库的操作。</p><p id="0b19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Mongoose来操作我们的MongoDB数据库。</p><h1 id="0d7f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过“refPath”进行动态引用</h1><p id="2bc4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用动态引用和<code class="fe me mf mg mh b">refPath</code>属性连接多个模型。</p><p id="4e1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4549" class="mq lc iq mh b gy mr ms l mt mu">async function run() {<br/>  const { createConnection, Types, Schema } = require('mongoose');<br/>  const db = createConnection('mongodb://localhost:27017/test');<br/>  const commentSchema = new Schema({<br/>    body: { type: String, required: true },<br/>    subject: {<br/>      type: Schema.Types.ObjectId,<br/>      required: true,<br/>      refPath: 'subjectModel'<br/>    },<br/>    subjectModel: {<br/>      type: String,<br/>      required: true,<br/>      enum: ['BlogPost', 'Product']<br/>    }<br/>  });<br/>  const Product = db.model('Product', new Schema({ name: String }));<br/>  const BlogPost = db.model('BlogPost', new Schema({ title: String }));<br/>  const Comment = db.model('Comment', commentSchema);<br/>  const book = await Product.create({ name: 'Mongoose for Dummies' });<br/>  const post = await BlogPost.create({ title: 'MongoDB for Dummies' });<br/>  const commentOnBook = await Comment.create({<br/>    body: 'Great read',<br/>    subject: book._id,<br/>    subjectModel: 'Product'<br/>  });<br/>  await commentOnBook.save();<br/>  const commentOnPost = await Comment.create({<br/>    body: 'Very informative',<br/>    subject: post._id,<br/>    subjectModel: 'BlogPost'<br/>  });<br/>  await commentOnPost.save();<br/>  const comments = await Comment.find().populate('subject').sort({ body: 1 });<br/>  console.log(comments)<br/>}<br/>run();</span></pre><p id="908d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有具有<code class="fe me mf mg mh b">subject</code>和<code class="fe me mf mg mh b">subjectModel</code>属性的<code class="fe me mf mg mh b">commentSchema</code>。</p><p id="f0d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">subject</code>被设置为一个对象ID。我们有<code class="fe me mf mg mh b">refPath</code>属性，它引用了它可以引用的模型。</p><p id="7013" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">refPath</code>设置为<code class="fe me mf mg mh b">subjectModel</code>，<code class="fe me mf mg mh b">subjectModel</code>参照<code class="fe me mf mg mh b">BlogPost</code>和<code class="fe me mf mg mh b">Product</code>型号。</p><p id="a4e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此我们可以将评论链接到一个<code class="fe me mf mg mh b">Product</code>条目或一个<code class="fe me mf mg mh b">Post</code>条目。</p><p id="3569" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了链接到我们想要的模型，我们在用<code class="fe me mf mg mh b">create</code>方法创建条目时设置了<code class="fe me mf mg mh b">subject</code>和<code class="fe me mf mg mh b">subjectModel</code>。</p><p id="0ce5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">subject</code>调用<code class="fe me mf mg mh b">populate</code>来获取<code class="fe me mf mg mh b">subject</code>字段的数据。</p><p id="9b17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以将相关的项目放到根模式中。</p><p id="d0b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1948" class="mq lc iq mh b gy mr ms l mt mu">async function run() {<br/>  const { createConnection, Types, Schema } = require('mongoose');<br/>  const db = createConnection('mongodb://localhost:27017/test');<br/>  const commentSchema = new Schema({<br/>    body: { type: String, required: true },<br/>    product: {<br/>      type: Schema.Types.ObjectId,<br/>      required: true,<br/>      ref: 'Product'<br/>    },<br/>    blogPost: {<br/>      type: Schema.Types.ObjectId,<br/>      required: true,<br/>      ref: 'BlogPost'<br/>    }<br/>  });<br/>  const Product = db.model('Product', new Schema({ name: String }));<br/>  const BlogPost = db.model('BlogPost', new Schema({ title: String }));<br/>  const Comment = db.model('Comment', commentSchema);<br/>  const book = await Product.create({ name: 'Mongoose for Dummies' });<br/>  const post = await BlogPost.create({ title: 'MongoDB for Dummies' });<br/>  const commentOnBook = await Comment.create({<br/>    body: 'Great read',<br/>    product: book._id,<br/>    blogPost: post._id,<br/>  });<br/>  await commentOnBook.save();<br/>  const comments = await Comment.find()<br/>    .populate('product')<br/>    .populate('blogPost')<br/>    .sort({ body: 1 });<br/>  console.log(comments)<br/>}<br/>run();</span></pre><p id="0d76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe me mf mg mh b">product</code>和<code class="fe me mf mg mh b">blogPost</code>设置在同一个对象中。</p><p id="4f5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们重新安排了<code class="fe me mf mg mh b">commentSchema</code>以包含<code class="fe me mf mg mh b">products</code>和<code class="fe me mf mg mh b">blogPost</code>引用。</p><p id="4d09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在两个字段上调用<code class="fe me mf mg mh b">populate</code>,这样我们就可以得到注释。</p><h1 id="d0d5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="7695" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在一个模式中引用多个模式。</p><p id="1677" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以调用<code class="fe me mf mg mh b">populate</code>来获取所有字段。</p></div></div>    
</body>
</html>