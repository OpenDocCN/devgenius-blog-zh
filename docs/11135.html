<html>
<head>
<title>Azure Durable Functions with .Net 6.0 and Azure Functions core tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 持久功能。Net 6.0 和 Azure 功能核心工具</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/azure-functions-with-net-6-0-and-azure-functions-core-tools-865a7ff59e76?source=collection_archive---------11-----------------------#2022-12-20">https://blog.devgenius.io/azure-functions-with-net-6-0-and-azure-functions-core-tools-865a7ff59e76?source=collection_archive---------11-----------------------#2022-12-20</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="dbe4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">上周，我提供了一个关于 Azure 持久功能的<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/what-and-why-of-azure-durable-function-27dd8f4ab7d6?sk=eb7c224573b147dd58c5195220d7ec6b">介绍。在本文中，我将使用核心工具、azure 存储模拟器和。Net 6.0。我不会使用</a><a class="ae km" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio 代码</a>或<a class="ae km" href="https://visualstudio.microsoft.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio </a>进行开发。尽管这些工具有益于企业应用程序，但它们不允许我们学习技术基础。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj kn"><img src="../Images/22535bf4528deccab5c4f9ab11179db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/0*8M6pioQJfQYdT6l0.png"/></div></figure><h2 id="c240" class="kv kw ir bd kx ky kz dn la lb lc dp ld jz le lf lg kd lh li lj kh lk ll lm ln bi translated">先决条件</h2><p id="936a" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">为了对 Azure 函数核心工具和 Azure 函数的目录结构有一个基本的了解，请在这里阅读我的介绍文章<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/developing-azure-functions-with-net-6-0-7-0-and-core-tools-48875ef3b85?sk=484b77fee2529294d30cf8afea83f238"/>。</p><h1 id="5d9b" class="lt kw ir bd kx lu lv lw la lx ly lz ld ma mb mc lg md me mf lj mg mh mi lm mj bi translated">功能初始化</h1><p id="d004" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">使用以下命令在您的本地计算机上创建一个 azure function 项目。</p><pre class="ko kp kq kr gu mk ml mm bn mn mo bi"><span id="468d" class="mp kw ir ml b be mq mr l ms mt">func init DurableFunction</span></pre><p id="47fd" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">出现提示时，选择以下配置:</p><ul class=""><li id="7839" class="mu mv ir jq b jr js jv jw jz mw kd mx kh my kl mz na nb nc bi translated">运行时—点网</li><li id="0095" class="mu mv ir jq b jr nd jv ne jz nf kd ng kh nh kl mz na nb nc bi translated">语言— C#</li></ul></div><div class="ab cl ni nj hv nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ik il im in io"><h1 id="f510" class="lt kw ir bd kx lu np lw la lx nq lz ld ma nr mc lg md ns mf lj mg nt mi lm mj bi translated">Azure 存储模拟器</h1><p id="66ae" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">Azure 持久功能需要一个存储帐户来执行。如果你没有 azure 存储帐户，我们可以使用 Azure 存储帐户模拟器。<a class="ae km" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-emulator" rel="noopener ugc nofollow" target="_blank">存储模拟器使用本地 Microsoft SQL Server 2012 Express local db 实例来模拟 Azure 存储服务。您可以选择配置存储模拟器来访问 SQL Server 的本地实例，而不是 LocalDB 实例</a>。</p><p id="d31a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">如果您使用的是 Visual Studio 2022，我们不需要做任何事情。运行函数应用程序会启动存储帐户模拟器。<a class="ae km" href="https://stackoverflow.com/questions/74846785/azure-durable-function-change-the-port-for-azure-storage-emulator/74848305#74848305" rel="noopener ugc nofollow" target="_blank">如果您在开发机器</a>上为另一个服务使用默认端口，就会出现问题。</p><p id="d5aa" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">存储帐户模拟器在<a class="ae km" href="http://127.0.0.1" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1 </a>上托管 blob、队列和表。模拟器位于 SDK 下。模拟器的位置是<strong class="jq is">“C:\ Program Files(x86)\ Microsoft SDKs \ Azure \ Storage Emulator”</strong>。</p><p id="cda5" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">blob、队列和表服务端点位于 azurestorageemulator . exe . config 文件中。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj nu"><img src="../Images/c370ac15ce6cba07efcac3972d7d1181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJ_Lfii5Ls0v8Q_LAr2n4Q.png"/></div></div></figure><p id="562c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">默认的 blob、队列和表端口分别是 10000、10001 和 10002。在我的机器上，这些端口已经被使用。因此，我必须在“C:\ Program Files(x86)\ Microsoft SDKs \ Azure \ Storage Emulator \ azurestorageemulator . exe . config”中更新它们(10003、10004 和 10005)，如下所示:</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj nz"><img src="../Images/9c5446fd7c4fba15d732ec3d1c5ba7b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eU78nEPZsE989tRf_c-elQ.png"/></div></div></figure><p id="9483" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">更改端口后，我们可以通过运行 start 命令来启动模拟器:</p><pre class="ko kp kq kr gu mk ml mm bn mn mo bi"><span id="7163" class="mp kw ir ml b be mq mr l ms mt">.\AzureStorageEmulator.exe start</span></pre><blockquote class="oa"><p id="da44" class="ob oc ir bd od oe of og oh oi oj kl dk translated"><a class="ae km" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-emulator#initialize-the-storage-emulator-to-use-a-different-sql-database" rel="noopener ugc nofollow" target="_blank">如果您想使用 SQL server 的不同实例而不是 LocalDB instaance 用于您的模拟器，请在启动模拟器之前使用 init 命令。</a></p></blockquote><h2 id="f9b8" class="kv kw ir bd kx ky ok dn la lb ol dp ld jz om lf lg kd on li lj kh oo ll lm ln bi translated">使用开发存储</h2><p id="f767" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">持久函数应用程序将查看设置 AzureWebJobsStorage 来查找链接的存储帐户。值“UseDevelopmentStorage=true”表示使用了存储帐户模拟器，而不是实际的 azure 存储帐户。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj op"><img src="../Images/f03a3b1807294fd4bd5e9b56968030e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trNXoaarwsYmUbq0OOHzkQ.png"/></div></div></figure><p id="7ebb" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">由于我们对存储帐户模拟器使用不同的端口，因此我们必须用完整的连接字符串更新配置:</p><pre class="ko kp kq kr gu mk ml mm bn mn mo bi"><span id="2d9f" class="mp kw ir ml b be mq mr l ms mt">“AzureWebJobsStorage”: “DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://127.0.0.1:10003/devstoreaccount1;QueueEndpoint=http://127.0.0.1:10004/devstoreaccount1;TableEndpoint=http://127.0.0.1:10005/devstoreaccount1;",</span></pre><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj oq"><img src="../Images/9821b66993e50073333945a8edad4030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmDdq0HfcPe08eOJpLqsbg.png"/></div></div></figure></div><div class="ab cl ni nj hv nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ik il im in io"><h1 id="7464" class="lt kw ir bd kx lu np lw la lx nq lz ld ma nr mc lg md ns mf lj mg nt mi lm mj bi translated">新功能</h1><p id="2011" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">使用<strong class="jq is"> func new </strong>命令在您的功能应用程序中创建新功能。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj or"><img src="../Images/1ac39156460a72fc0b8d3c1e02ffece7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcKYni_ZprlIf1DdxOmNZA.png"/></div></div></figure><ul class=""><li id="3871" class="mu mv ir jq b jr js jv jw jz mw kd mx kh my kl mz na nb nc bi translated">选择 DurableFunctionsOrchestration 模板以创建持久函数。让我们将该函数命名为 OrchestrationFunction。</li><li id="58dc" class="mu mv ir jq b jr nd jv ne jz nf kd ng kh nh kl mz na nb nc bi translated">该命令将向您的项目添加一个 NuGet 包，以支持持久函数。你可以在 csproj 文件中看到这个包的细节。</li></ul><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj os"><img src="../Images/c1861ea6a6142398e90b6384028a1412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LkyOk9NldSsHbO92tTfw8w.png"/></div></div></figure></div><div class="ab cl ni nj hv nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ik il im in io"><h1 id="0fcb" class="lt kw ir bd kx lu np lw la lx nq lz ld ma nr mc lg md ns mf lj mg nt mi lm mj bi translated">功能启动</h1><p id="b07e" class="pw-post-body-paragraph jo jp ir jq b jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ls kj kk kl ik bi translated">运行命令<strong class="jq is">‘func start’</strong>命令运行该功能。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj nu"><img src="../Images/e6aa652638874ce97a1a108a02e4bbf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hP2CChnTOCFrGjgQf8CKkQ.png"/></div></div></figure><p id="5cd4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我们可以在函数下看到三个条目。让我们逐一看一下:</p><ul class=""><li id="d2f6" class="mu mv ir jq b jr js jv jw jz mw kd mx kh my kl mz na nb nc bi translated"><strong class="jq is">Orchestration _ HttpStart</strong>—这是持久函数的入口点。它调用编排函数，并为每次执行生成一个惟一的 id。唯一 id 有助于查询持久函数的执行状态。</li><li id="413a" class="mu mv ir jq b jr nd jv ne jz nf kd ng kh nh kl mz na nb nc bi translated"><strong class="jq is">编排:编排触发器</strong> —这是调用活动的编排功能。默认实现支持<a class="ae km" href="https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-sequence?tabs=csharp" rel="noopener ugc nofollow" target="_blank">函数链设计模式</a>。</li><li id="149b" class="mu mv ir jq b jr nd jv ne jz nf kd ng kh nh kl mz na nb nc bi translated"><strong class="jq is">Orchestration _ Hello:activity trigger</strong>—一个活动函数，在字符串前面加上“Hello”</li></ul><p id="65fa" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在下一篇文章中，我将借助另一个演示函数链设计模式的用例，深入研究不同的类。</p></div><div class="ab cl ni nj hv nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ik il im in io"><p id="0703" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">页（page 的缩写）s-Medium 是一个阅读、写作和向其他作者学习的绝佳平台。如果你想加入我的旅程，今天就加入<a class="ae km" href="https://tarunbhatt9784.medium.com/membership" rel="noopener"> medium </a>。</p></div></div>    
</body>
</html>