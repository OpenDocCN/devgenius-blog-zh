<html>
<head>
<title>Elastic App Search Client in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin中的弹性应用程序搜索客户端</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/elastic-app-search-client-in-kotlin-8435746024ce?source=collection_archive---------1-----------------------#2021-01-17">https://blog.devgenius.io/elastic-app-search-client-in-kotlin-8435746024ce?source=collection_archive---------1-----------------------#2021-01-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/9ce15191a7cc065695aedec72f9d86c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*3w8yX3-fAjbDm4P64YmwYA.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">应用搜索和Kotlin</figcaption></figure><p id="00be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我之前的<a class="ae kt" href="https://medium.com/dev-genius/elastic-app-search-in-a-nutshell-ad446e7a3293" rel="noopener">帖子</a>中，我试图提供关于弹性应用搜索的亮点，它提供搜索即服务。正如帖子中提到的，Elastic提供了多种语言的客户端实现<a class="ae kt" href="https://www.elastic.co/guide/en/enterprise-search/7.10/programming-language-clients.html" rel="noopener ugc nofollow" target="_blank"/>；但是没有Java或Kotlin的实现。所以我决定实现我自己的。</p><p id="8e1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我对此感到特别兴奋，因为我已经使用Elastic Stack(主要是Elasticsearch)很多年了，App Search也在我的考虑范围之内。对我来说，这是一个深入应用搜索并为生态系统做出贡献的绝佳机会。顾名思义，我选择了Kotlin作为实现语言。你可能已经知道，Kotlin是我最喜欢的编程语言，它在JVM上。</p><p id="b78d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除此之外，这是我第一次设法将一个库部署到公共Maven仓库，并通过<a class="ae kt" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>来简化这个过程。</p><p id="447e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在接下来的几节中，我将试着回顾一下app-search-kotlin实现的一些细节。</p><h1 id="6519" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">放弃</h1><p id="4ad3" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">app-search-kotlin是一个应用程序搜索的客户端实现，我作为一个附带项目开发的，不应该被视为一个产品质量，并相应地包含在项目中。</p><h1 id="182f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">位置</h1><p id="4bf6" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">源代码位于<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/" rel="noopener ugc nofollow" target="_blank"> Github </a>中。app-search-kotlin JAR在<a class="ae kt" href="https://search.maven.org/search?q=a:app-search-kotlin" rel="noopener ugc nofollow" target="_blank">search.maven.org</a>有售。</p><h1 id="a336" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">和睦相处</h1><p id="fbc9" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">app-search-kotlin是使用Elastic Stack 7 . 8 . 1版本开发的(Elasticsearch和Elastic App Search)。我没有对其他7.x.y版本进行测试，但理论上它应该可以工作。</p><p id="19dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">库是用Kotlin 1.3和Java 11开发的，没有针对其他版本进行测试。与弹性堆栈版本类似，它应该不需要或只需要很少的更改就可以工作，但是可能需要重新构建。</p><h1 id="f515" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">属国</h1><p id="c5d4" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">实现本身有两个依赖项，它们是:</p><ul class=""><li id="1fc9" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated"><a class="ae kt" href="https://github.com/FasterXML/jackson-module-kotlin" rel="noopener ugc nofollow" target="_blank">杰克逊</a></li><li id="5fc4" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><a class="ae kt" href="https://hc.apache.org/httpcomponents-client-ga/" rel="noopener ugc nofollow" target="_blank"> Apache Http客户端</a></li></ul><p id="37a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Jackson用于应用搜索请求的JSON序列化和反序列化。注释和Jackson mapper(用于Kotlin)都用于此目的。</p><p id="e17a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于HTTP通信，选择Apache Http客户端。虽然有一些更容易使用的库，比如<a class="ae kt" href="https://github.com/kittinunf/fuel" rel="noopener ugc nofollow" target="_blank"> Fuel </a>和<a class="ae kt" href="http://kong.github.io/unirest-java/" rel="noopener ugc nofollow" target="_blank"> Unirest </a>，但是它们不允许带有主体的HTTP GET和DELETE请求。Apache HTTP客户端可以很容易地被<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/blob/8b6215f1b9333c05847a795a62a9b4e9f9e79947/src/main/kotlin/com/github/itasyurt/appsearch/client/api/util/http/HttpRequests.kt#L10" rel="noopener ugc nofollow" target="_blank">扩展</a>，以在这些请求中包含主体。</p><h1 id="56a1" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">客户端API</h1><p id="cba5" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">界面<em class="ml">客户端(com . github . itasyurt . App Search . Client . Client)</em>作为使用App搜索客户端的主立面。顾名思义，DefaultClient 是默认实现。</p><p id="a387" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">客户端由引用应用程序搜索的<a class="ae kt" href="https://www.elastic.co/guide/en/app-search/current/api-reference.html" rel="noopener ugc nofollow" target="_blank">API</a>的不同客户端对象组成，它们是:</p><ul class=""><li id="347c" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">引擎客户端</li><li id="4a70" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">SchemaClient</li><li id="2f4c" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">搜索客户端</li><li id="b663" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">搜索设置客户端</li><li id="e42e" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">建议客户</li><li id="cf18" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">同义词客户端</li><li id="5a3e" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">策展客户</li></ul><h1 id="120b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">域对象</h1><p id="25d0" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">域对象主要实现为<em class="ml">com . github . itas yurt . app search . client . domain</em>包下的<a class="ae kt" href="https://kotlinlang.org/docs/reference/data-classes.html" rel="noopener ugc nofollow" target="_blank">数据类</a>。域类用Jackson注释修饰，用于JSON序列化/反序列化。</p><p id="9948" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">App搜索文档被认为是<em class="ml">映射&lt;字符串，对象&gt;T17，这是<a class="ae kt" href="https://kotlinlang.org/docs/reference/type-aliases.html" rel="noopener ugc nofollow" target="_blank">别名</a>为<em class="ml">文档</em>类型。</em></p><h1 id="0193" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用</h1><p id="6e1a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">您可以用一个基本URL和API键实例化一个客户端。一旦客户端成功，就可以通过客户端对象访问子API。下面你可以看到一个执行搜索的示例代码片段。(而且你很容易理解我是一级方程式赛车的超级粉丝)。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="78c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">更详细的文档可以在<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/blob/master/README.md#usage" rel="noopener ugc nofollow" target="_blank">自述文件</a>中找到。</p><h1 id="918a" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">局限性和缺失的功能</h1><p id="f43f" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">正如我在免责声明部分提到的，目前<strong class="jx io"><em class="ml">app-search-kot Lin</em></strong>算是我的一个爱好项目。初始版本中不包含某些API。但是在未来的版本中，它们很容易实现:</p><ul class=""><li id="2f5d" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">API日志API</li><li id="0895" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">日志设置API</li><li id="6217" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">分析API</li><li id="84f2" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">点击API</li><li id="0e15" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">凭据API</li><li id="af87" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">元引擎API</li></ul><p id="4177" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，当前版本只能在HTTP上工作，不支持HTTPS。</p><h1 id="e76c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Java兼容性</h1><p id="a1ee" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">因为实现是在Kotlin/JVM中；它可以与Java互操作。然而，一些特性，比如命名参数的默认值，或者类的getter属性，对于Java是不可用的。为了更方便地使用Java，下一步可能是使实现对Java更友好；或者为Java实现一些实用程序(比如构建器)。</p><h1 id="3fa9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">试验</h1><p id="a9b0" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在单元测试中使用<a class="ae kt" href="https://www.mock-server.com/" rel="noopener ugc nofollow" target="_blank"> MockServer </a>测试实现。简而言之，部署一个模拟应用程序搜索请求和响应的模拟服务器，并根据预期的请求和响应测试实现。</p><h1 id="4878" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">构建和发布</h1><p id="e50b" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">神器被发布到search.maven.org的<a class="ae kt" href="https://search.maven.org/search?q=a:app-search-kotlin" rel="noopener ugc nofollow" target="_blank">。当用GitHub动作创建一个发布时，发布被触发。</a></p><p id="8f07" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/blob/master/build.gradle.kts" rel="noopener ugc nofollow" target="_blank"> build.gradle.kts </a>和相关的<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/blob/master/.github/workflows/clean_build.yml" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>中找到更多信息。</p><h1 id="d47e" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="e0c8" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在这篇博文中，我试图记录我为创建弹性应用程序的客户端实现所做的工作。你可以在<a class="ae kt" href="https://github.com/itasyurt/app-search-kotlin/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中看到完整的文档和源代码。</p><p id="554b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这对我来说是一个非常愉快的尝试，因为这是我第一次从零开始实现一个API客户端(更好的是对于我非常喜欢的弹性堆栈)；这也是我第一次发布我的项目，简化工作流程。所以这对我来说是一次很好的学习经历。</p><p id="fcf9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我之前提到的，这是一个业余爱好项目，有许多缺陷和不完整的功能。如果您有任何意见、建议或贡献，请随时联系。</p></div></div>    
</body>
</html>