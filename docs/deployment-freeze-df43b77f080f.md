# 部署冻结

> 原文：<https://blog.devgenius.io/deployment-freeze-df43b77f080f?source=collection_archive---------7----------------------->

**部署冻结**是一个特定的时间窗口，在此期间不允许对特定或所有环境进行部署。
这解决了什么问题吗？

![](img/1a222b2b8ff1015db168471ffb716c6a.png)

许多大公司在高流量期间实施各种部署或代码冻结。我曾在冻结部署的公司工作过，只有一家公司因为紧急情况冻结了代码。

## 部署冻结

根据我的经验，冻结部署会适得其反。部署冻结只对那些以良好的步调部署不同服务的公司有意义。如果您每六个月部署一次 prod，就不需要冻结部署。此外，如果您在 monolith 中，冻结部署的风险较小，可能是因为您的公司没有设计为每天或每周部署多次。

那么，如果我们推动我们的公司增加部署的数量，并且我们是为此而设计的(例如在每个领域使用微服务和团队)，那么迫使整个机制停止会有什么后果呢？。

结果是当部署冻结消失时，增加了生产中的错误风险。因为我们将部署大量的变化，比我们通常做的要大。
为了避免这种风险，我们通常会以每个团队、部门或其他部门的部署窗口的形式增加官僚主义，以与我们以前使用 monolith 时相同的方式协调部署。

一个可能导致灾难的简单例子是两个团队更改了两个紧密耦合的服务:

*   由于引入了新功能，团队 A 更改了服务 A
*   团队 B 更改了服务 B，添加了新的 API
*   团队 B 已经更改了服务 A，以便在服务 B 中使用新的 API

因此，团队 B 知道服务 A 和 B 需要一起部署，但是团队 A 不知道这一信息。因此，如果团队 A 在团队 B 之前部署他们的服务，那么生产中就会出现 bug，而团队 A 什么也不知道。这个问题一直存在，但是如果长时间不将更改部署到 prod，发生的可能性会更高。

这个特定的问题是一个架构问题，反映在[团队的协调](/its-the-coordination-stupid-f3581bbf25cd?sk=644c395aad2747e8409c2f81d5917897)中。对此类事件的通常反应是增加更多的官僚机构来解决协调问题，但真正的问题不是这个，而是两个团队需要更改这两个服务的原因。
事实上，当两个服务在它们之间进行大量对话时，那些代码库的工作人员也需要在它们之间进行对话，我们需要协调。
当一家公司在生产部门进行高频率部署时，这个问题就不太常见了，因为生产部门需要协调人员。我们可以检查部署了哪些版本，它们是否与我们的更改兼容等等。例如，我们可以使用[金丝雀释放技术](https://martinfowler.com/bliki/CanaryRelease.html)针对生产进行测试。

但是如果我们停止部署，我们仍然开发新的功能，那么在这个问题上失败的风险每天都在增加。

## 特征冻结

在我看来，特性冻结是糟糕的技术决策的后果。在某些时候，你需要停下来，修复你创造的所有东西。过去，当我们用一种新型微服务系统取代旧的整体架构时，我就遇到过这种情况。
我在这篇[博客](/start-from-scratch-again-5c5ec9f6f066?sk=bffb88bf58209bd6d661d5352bc55fea)中写了试图从头开始的后果，另一个后果是特性冻结。事实上，冻结功能是一个非常困难的决定，因为没有人愿意承认他们错了。
功能冻结不会增加部署风险。功能冻结试图在不增加新功能的情况下提高产品质量。特性冻结造成的问题更多的是心理上的，它是探测我们失败了。这并不是一件真正的坏事，可以成为一个学习和提高的起点，为将来做准备。但不是每个人都能接受大失败，所以继续冻结有很多阻力(通常是负责项目的经理)。

功能冻结增加了另一种风险，取决于我们修复东西的时间，有更多的选项被解雇。公司没有耐心等待，因为他们赔钱，在这种情况下，成本更容易衡量，没有任何好处。

总的来说，任何形式的冻结对我来说都是一种建筑气味。公司的架构和文化非常相关，所以即使它们因为恐惧而存在，那些恐惧也是在过去产生的，还没有解决。这些气味只是引导我们识别我们在文化或建筑层面上的真正问题。
**值得去解决它们，不要试图通过提高人的协调性来解决它们。**