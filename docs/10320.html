<html>
<head>
<title>Coding GraphQL Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编码 GraphQL 服务</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/coding-graphql-services-eafd9235fdf7?source=collection_archive---------13-----------------------#2022-10-23">https://blog.devgenius.io/coding-graphql-services-eafd9235fdf7?source=collection_archive---------13-----------------------#2022-10-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="30e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本内容面向那些对 REST 和 GraphQL 有基本了解的工程师。我们将陆续公布以下内容。</p><p id="a3f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"># 1<a class="ae ki" href="https://medium.com/@sofikul.m/design-my-todos-project-with-graphql-rest-microservices-482cffc7729b" rel="noopener">my-todos 项目设计</a></p><p id="a381" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> #2 编码 GraphQL 服务(我们在此发帖)</strong></p><p id="02a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#3 GraphQL 服务认证和授权</p><p id="ca24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#4 编码 GraphQL 网关服务</p><p id="56b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#5 使用 Nuxt 编码 my-todos web</p><p id="0606" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#6 所有服务的部署</p></div><div class="ab cl kj kk hr kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ig ih ii ij ik"><h2 id="f64f" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">要求</h2><p id="084d" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">要求是创建一个具有以下功能支持的用户服务</p><ul class=""><li id="6a64" class="lo lp in jm b jn jo jr js jv lq jz lr kd ls kh lt lu lv lw bi translated">按 Id 获取用户</li><li id="ccd4" class="lo lp in jm b jn lx jr ly jv lz jz ma kd mb kh lt lu lv lw bi translated">获取所有用户(只有管理员有权访问此功能)</li><li id="2482" class="lo lp in jm b jn lx jr ly jv lz jz ma kd mb kh lt lu lv lw bi translated">登录功能</li></ul><h2 id="62b0" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">技术栈</h2><p id="06bb" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">我们将用于构建 GraphQL 服务的技术堆栈</p><ul class=""><li id="28a1" class="lo lp in jm b jn jo jr js jv lq jz lr kd ls kh lt lu lv lw bi translated">节点(快速框架)</li><li id="75a1" class="lo lp in jm b jn lx jr ly jv lz jz ma kd mb kh lt lu lv lw bi translated">Apollo GraphQL 服务器</li><li id="334a" class="lo lp in jm b jn lx jr ly jv lz jz ma kd mb kh lt lu lv lw bi translated">以打字打的文件</li><li id="509a" class="lo lp in jm b jn lx jr ly jv lz jz ma kd mb kh lt lu lv lw bi translated">GraphQL 库</li></ul><p id="7c7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">说得够多了，我们将马上着手实施。深呼吸，专注于接下来的部分:)</p><h2 id="13f1" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">项目结构</h2><p id="3ee3" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">让我们首先决定我们的项目结构。现在我有以下内容给你。完整结构参见<a class="ae ki" href="https://github.com/Sofiukl/my-todos-user-gql-api" rel="noopener ugc nofollow" target="_blank">此</a>。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/0e2878885c771011f1b354034b47b66a.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*u8CU_X2VzKGW-OvpBvrpdg.png"/></div></figure><p id="b774" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">#示例配置文件代码</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h2 id="680a" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">项目开发</h2><h2 id="1fc0" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#01 图表 SQL 模式</h2><p id="e945" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">GraphQL 模式是客户端可以从 GraphQL API 请求的数据的描述。它还定义了客户机可以用来从 GraphQL 服务器读取和写入数据的查询和变异函数。</p><pre class="md me mf mg gt mm mn mo mp aw mq bi"><span id="4c33" class="kq kr in mn b gy mr ms l mt mu">directive @auth(requires: Role = ADMIN) on OBJECT | FIELD_DEFINITION<br/><br/>enum Role {<br/>  ADMIN<br/>  REVIEWER<br/>  USER<br/>  UNKNOWN<br/>}<br/><br/>type LogInResponse {<br/>  token: String!<br/>}<br/><br/>type GetUserResponse {<br/>  id: ID!<br/>  email: String!<br/>  role: String!<br/>  createdAt: String!<br/>  createdBy: String!<br/>  updatedAt: String!<br/>  updatedBy: String!<br/>}<br/><br/>type Query {<br/>  users: [GetUserResponse] @auth(requires: ADMIN)<br/>  user(userId: String): GetUserResponse<br/>}<br/><br/>type Mutation {<br/>  login(email: String!, password: String!): LogInResponse!<br/>}</span></pre><p id="4838" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们按照最初的要求定义了用户、用户查询和登录变异。你可以认为 GET APIs 将会进入查询部分，而其他 API(比如 POST、PATCH、DELETE)将会发生变化。</p><h2 id="1e21" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#02 GraphQL 模式到类型生成</h2><p id="1887" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">我们在上面的模式中定义了 GetUserResponse，LogInResponse 类型。我们的代码中也需要相应的类型。我们将使用 npm ( <a class="ae ki" href="https://www.npmjs.com/package/@graphql-codegen/cli" rel="noopener ugc nofollow" target="_blank"> @graphql-codegen </a>)从模式文件中自动创建它。</p><p id="eb7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该库需要一个 codegen.yml 配置文件。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="0ce2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您需要运行下面的命令来创建类型。</p><pre class="md me mf mg gt mm mn mo mp aw mq bi"><span id="6c6c" class="kq kr in mn b gy mr ms l mt mu">graphql-codegen --config codegen.yml</span></pre><p id="1086" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">输出将在/src/generated 文件夹下创建。你可以在我的<a class="ae ki" href="https://github.com/Sofiukl/my-todos-user-gql-api" rel="noopener ugc nofollow" target="_blank">资源库</a>里查看。</p><h2 id="dd4a" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#03 创建阿波罗服务器</h2><p id="ee62" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">我们将使用<a class="ae ki" href="https://www.apollographql.com/" rel="noopener ugc nofollow" target="_blank"> Apollo </a>库来创建 GraphQL 服务器。Apollo 主要需要模式文件和解析器来创建服务器。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="de77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经准备好了模式和服务器。接下来，我们需要我们的查询，突变解析函数。</p><h2 id="4084" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#04 编写解析器代码</h2><p id="84cf" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">解析器是请求处理程序。按照我们的模式，我们需要为用户、用户查询和登录变异创建处理程序。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h2 id="a01f" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#05 在开发模式下运行代码</h2><p id="702a" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">下面是我们在 package.json 中定义的脚本</p><pre class="md me mf mg gt mm mn mo mp aw mq bi"><span id="f566" class="kq kr in mn b gy mr ms l mt mu">"schema-type": "graphql-codegen --config codegen.yml",<br/>"lint": "eslint . --ext .ts",<br/>"build": "npm run schema-type &amp;&amp; tsc",<br/>"start": "npm run build &amp;&amp; node build/server.js"</span></pre><p id="8e69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用<code class="fe mv mw mx mn b">npm run start</code>来运行我们的开发服务器。</p><h2 id="9760" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#06 测试 API</h2><p id="7d77" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">Apollo server 提供了内置文档和平台，可以非常快速轻松地测试这些特性。</p><p id="139a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">操场将在端点<code class="fe mv mw mx mn b">baseurl/graphql</code>可用，例如 http://localhost:4000/graphql</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/e234d619a4022ef11d4fd12da886844c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kD2PDLCTOu0bSeSWAO9IQ.png"/></div></div></figure><p id="c562" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如我们在模式中定义的那样，我们的用户查询是受保护的，只有管理员用户可以访问。所以要访问它，你需要在<code class="fe mv mw mx mn b">Authorization</code>头中传递令牌。(你将获得执行<code class="fe mv mw mx mn b">login</code>突变的令牌)</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/3536976e4746ddc7da3ab1fd2c9edec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84TYwXn45GV_3UrOm9tF3A.png"/></div></div></figure><blockquote class="nd"><p id="ba9f" class="ne nf in bd ng nh ni nj nk nl nm kh dk translated">🔥恭喜你！您已经定义了您的第一个 GraphQL 服务。</p></blockquote><h2 id="905c" class="kq kr in bd ks kt nn dn kv kw no dp ky jv np la lb jz nq ld le kd nr lg lh li bi translated">#07 部署</h2><p id="6a84" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">庆祝你的学习和成就🎉，我会想出新的文章进行部署。</p><h2 id="7050" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">#08 参考</h2><p id="4c74" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">👨‍💻完整的源代码可以在<a class="ae ki" href="https://github.com/Sofiukl/my-todos-user-gql-api" rel="noopener ugc nofollow" target="_blank">这里找到</a></p><h2 id="9cfb" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">下一步是什么</h2><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="ns ml l"/></div></figure><p id="fe61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将在下一篇文章<a class="ae ki" href="https://medium.com/@sofikul.m/6894d6f40ac0" rel="noopener"> <em class="nt"> #3 GraphQL 服务认证和授权</em> </a>中见到您。请订阅，以便在我们发布后立即获得更新。</p><blockquote class="nd"><p id="5915" class="ne nf in bd ng nh nu nv nw nx ny kh dk translated">继续学习！</p></blockquote></div></div>    
</body>
</html>