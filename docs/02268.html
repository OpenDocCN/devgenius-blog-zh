<html>
<head>
<title>How to setup a Magento 2 Development Environment with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Docker设置Magento 2开发环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-install-a-local-magento-2-environment-with-docker-5a698084c610?source=collection_archive---------0-----------------------#2020-07-26">https://blog.devgenius.io/how-to-install-a-local-magento-2-environment-with-docker-5a698084c610?source=collection_archive---------0-----------------------#2020-07-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0b1e3ee9d509d387b0ce90d041398f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unkuR0qAYD_KhjAu6tJWbQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在<a class="ae jz" href="https://unsplash.com/s/photos/whale?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jz" href="https://unsplash.com/@ventiviews?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Cameron Venti </a>拍摄的照片</figcaption></figure><p id="c455" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我刚开始开发PHP应用程序时，我使用Mamp或Xamp来建立本地Lamp堆栈。</p><p id="d626" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">后来这在VirtualBox和最终Docker的组合中成了流浪者。</p><p id="3ed3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Docker的主要优势是可移植性、性能和可伸缩性。这是值得的，尤其是当你在团队中工作的时候。</p><blockquote class="ky"><p id="f10d" class="kz la in bd lb lc ld le lf lg lh kx dk translated">在Magento 2上使用commerce时，可以使用<a class="ae jz" href="https://devdocs.magento.com/cloud/docker/docker-config.html" rel="noopener ugc nofollow" target="_blank"> Magento Cloud Docker </a>环境。</p></blockquote><p id="ebec" class="pw-post-body-paragraph ka kb in kc b kd li kf kg kh lj kj kk kl lk kn ko kp ll kr ks kt lm kv kw kx ig bi translated"><strong class="kc io">docker简介</strong></p><p id="4063" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Docker和VM之间的主要区别主要在于两者之间的架构。虚拟机是一种模拟真实计算机的计算机软件。为此，他使用了一种超级视觉——也称为“来宾机”。</p><p id="280c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虚拟机监控可以是运行虚拟机的软件、固件或硬件。hypervison本身运行在一台真实的计算机上，这被称为“主机”。</p><p id="039e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">hypervison拥有完整的虚拟化堆栈，如网络适配器、存储和CPU，以及自己的操作系统来运行程序。</p><p id="9e92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">容器和VM是相似的，但是容器和VM的主要区别在于容器使用主机内核，而主机内核又与其他容器共享它。</p><p id="3891" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">容器不需要完整的虚拟化堆栈和自己的操作系统来运行程序。</p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ln"><img src="../Images/36797ed172f4731d7d5d214ac6e3ae60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XAUzL085cP6AVi2SoNQxPQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">虚拟机与容器</figcaption></figure><p id="995a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，如果你想更深入地了解docker和VM之间的区别，我推荐你阅读“<a class="ae jz" href="https://www.freecodecamp.org/news/a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b/" rel="noopener ugc nofollow" target="_blank">一个对初学者友好的容器、VM和Docker的介绍</a>”。</p><p id="a5f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">什么是舍监</strong></p><p id="2615" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于那些已经使用过Docker的人来说，您可能会意识到建立一个Docker工作环境需要花费的时间。尤其是如果您没有DevOps团队或sysadmin来设置它。</p><p id="80ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你可以在Github上找到Magento 2的Docker环境，但是我和我的团队的体验并不总是完美的。通常它们不是最新的，它们不像你希望的那样工作，或者你不得不自己进行调整。最终我们找到了典狱长。</p><p id="dfd6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Warden是一个CLI实用程序，即使您对Docker知之甚少或一无所知，也可以轻松安装Magento环境。根据典狱长的记录:</p><p id="19a8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Warden是一个CLI实用程序，用于编排基于Docker的开发人员环境，并通过使用几个集中运行的服务将请求代理到正确的环境容器中，使多个本地环境同时运行，而不会发生端口冲突。</p><p id="7e3f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这意味着您可以毫不费力地同时运行不同的本地环境，而不会相互冲突。典狱长有以下特点:</p><ul class=""><li id="73ca" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx lx ly lz ma bi translated">用于SSL终止和将请求路由/代理到正确容器的Traefik。</li><li id="60b4" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">Portainer用于快速查看本地Docker主机内部正在运行的内容。</li><li id="4f7f" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">为其提供DNS响应的Dnsmasq。测试域消除了/etc/hosts的手动编辑</li><li id="5fcd" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">一个SSH隧道，用于从Sequel Pro或TablePlus连接到多个正在运行的数据库容器中的任何一个。</li><li id="1fa0" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">Warden为在所有本地开发域上运行https颁发了通配符SSL证书。</li><li id="d9e3" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">在macOS和Linux上完全支持Magento 1，Magento 2，Laravel，Symfony 4，Shopware 6。</li><li id="5614" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">能够基于每个项目覆盖、扩展或设置完全自定义的环境定义。</li></ul><p id="db35" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">准备工作</strong></p><p id="27c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要安装Warden，您首先需要Docker。此外，它只能在Linux或macOS上运行——据我所知，还没有办法在windows上运行warden。如果你运行的是macOS，我推荐安装<a class="ae jz" href="https://hub.docker.com/editions/community/docker-ce-desktop-mac" rel="noopener ugc nofollow" target="_blank"> Docker Desktop for Mac </a>。对于Linux，这就是Docker for Linux。还需要docker compose和诱变剂0.11.4或更高。</p><p id="42c3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装Docker </strong></p><p id="f72a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先确保你有一个像Homebrew for macOS这样的包管理器来安装Docker Desktop for Mac，然后运行:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="11f1" class="ml mm in mh b gy mn mo l mp mq">brew cask install docker</span></pre><p id="c5c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将安装以下软件:Docker桌面、Docker社区版、Docker CE。</p><p id="2a9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要安装Docker for Linux，您可以使用Docker引擎。</p><p id="b166" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用snapcraft:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="74ac" class="ml mm in mh b gy mn mo l mp mq">sudo snap install docker</span></pre><p id="7d02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用apt-get:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="fe73" class="ml mm in mh b gy mn mo l mp mq">sudo apt-get install docker-ce docker-ce-cli containerd.io</span></pre><p id="800b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装监护人</strong></p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="f1ef" class="ml mm in mh b gy mn mo l mp mq">brew install davidalger/warden/warden<br/>warden svc up</span></pre><p id="e141" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">全球服务总监</strong></p><p id="5d64" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在您已经安装了warden，您可以通过运行以下命令来启动warden:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="95e4" class="ml mm in mh b gy mn mo l mp mq">warden up</span></pre><p id="2f7e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将启动典狱长的全球服务。参见:<em class="mr"> docker ps </em></p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="2a80" class="ml mm in mh b gy mn mo l mp mq">❯ warden up<br/>Creating network "warden" with the default driver<br/>Creating traefik    ... done<br/>Creating portainer ... done<br/>Creating tunnel    ... done<br/>Creating dnsmasq   ... done</span></pre><p id="6fd5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这包括traefik、portainer、dnsmasq和mailhog。这将为您提供对GUI的访问，您可以通过访问以下URL进行访问:</p><ul class=""><li id="7484" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx lx ly lz ma bi translated"><a class="ae jz" href="https://traefik.warden.test/" rel="noopener ugc nofollow" target="_blank">https://traefik.warden.test/</a></li><li id="9225" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated"><a class="ae jz" href="https://portainer.warden.test/" rel="noopener ugc nofollow" target="_blank">https://portainer.warden.test/</a></li><li id="8707" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated"><a class="ae jz" href="https://dnsmasq.warden.test/" rel="noopener ugc nofollow" target="_blank">https://dnsmasq.warden.test/</a></li><li id="70b2" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated"><a class="ae jz" href="https://mailhog.warden.test/" rel="noopener ugc nofollow" target="_blank">https://mailhog.warden.test/</a></li></ul><p id="78f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">监狱长命令</strong></p><p id="3468" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Warden有一些有用的命令，您可以使用它们与warden一起工作。</p><p id="8148" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">启动管理员:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="80cd" class="ml mm in mh b gy mn mo l mp mq">warden up</span></pre><p id="d128" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">停车管理员:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="194f" class="ml mm in mh b gy mn mo l mp mq">warden down</span></pre><p id="882c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">启动典狱长环境</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="b201" class="ml mm in mh b gy mn mo l mp mq">warden env start</span></pre><p id="bc1c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">停止管理员环境</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="b2b8" class="ml mm in mh b gy mn mo l mp mq">warden env down</span></pre><p id="3847" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">管理员环境中的SSH</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="95cf" class="ml mm in mh b gy mn mo l mp mq">warden shell</span></pre><p id="900c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在管理员环境中运行命令</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="01d9" class="ml mm in mh b gy mn mo l mp mq">warden env exec php-fpm bin/magento</span></pre><p id="3168" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开MySQL会话</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="7da3" class="ml mm in mh b gy mn mo l mp mq">warden db connect -A</span></pre><p id="a14e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">显示PHP日志</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="9b40" class="ml mm in mh b gy mn mo l mp mq">warden env logs — tail 0 -f php-fpm php-debug</span></pre><p id="8a62" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建一个项目</strong></p><p id="0801" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为Magento 2设置一个Warden环境只需要几个步骤。</p><p id="1a84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">配置您的Magento Marketplace凭据</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="9d52" class="ml mm in mh b gy mn mo l mp mq">composer global config http-basic.repo.magento.com &lt;username&gt; &lt;password&gt;</span></pre><p id="3c8e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从创建一个项目开始</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="4bb5" class="ml mm in mh b gy mn mo l mp mq">composer create-project — repository-url=https://repo.magento.com/ magento/project-community-edition — ignore-platform-reqs example &amp;&amp; cd example/</span></pre><p id="25f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将. env文件添加到项目中。</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="768c" class="ml mm in mh b gy mn mo l mp mq">warden env-init &lt;example&gt; magento2</span></pre><p id="eee7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建一个。项目根目录下的env文件。例如，想更新你的PHP版本，你可以在这里做。</p><p id="4bce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个。env文件用于warden env命令。更多详情见典狱长env -h。</p><p id="fdae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建一个SSL证书</strong></p><p id="26cf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以按如下方式创建SSL证书:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="f707" class="ml mm in mh b gy mn mo l mp mq">warden sign-certificate example.test</span></pre><p id="5697" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保该名称与中的“TRAEFIK_DOMAIN”相匹配。包封/包围（动词envelop的简写）</p><p id="b3c6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在运行:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="230a" class="ml mm in mh b gy mn mo l mp mq">warden env up -d</span></pre><p id="7cab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一次运行时，会创建以下内容:</p><ul class=""><li id="3f93" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx lx ly lz ma bi translated">Nginx</li><li id="df07" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">光泽面</li><li id="3702" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">PHP-FPM (7.0以上)</li><li id="d809" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">MariaDB</li><li id="7f2a" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">弹性搜索</li><li id="ebd0" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">兔子q</li><li id="f7ce" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">雷迪斯</li></ul><p id="e736" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这还会启动诱变剂同步会话，将您的文件同步到Docker容器。</p><p id="3aa7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">查看结果:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="f081" class="ml mm in mh b gy mn mo l mp mq">❯ warden env up -d<br/>Creating network "example_default" with the default driver<br/>Creating example_elasticsearch_1 ... done<br/>Creating example_rabbitmq_1      ... done<br/>Creating example_db_1            ... done<br/>Creating example_redis_1         ... done<br/>Creating example_mailhog_1       ... done<br/>Creating example_php-fpm_1       ... done<br/>Creating example_php-debug_1     ... done<br/>Creating example_nginx_1         ... done<br/>Creating example_varnish_1       ... done<br/>Connecting traefik to example_default network<br/>Connecting tunnel to example_default network<br/>Starting example_redis_1         ... done<br/>Starting example_elasticsearch_1 ... done<br/>Starting example_db_1            ... done<br/>Starting example_rabbitmq_1      ... done<br/>Starting example_mailhog_1       ... done<br/>Recreating example_php-fpm_1     ... done<br/>Recreating example_php-debug_1   ... done<br/>Recreating example_nginx_1       ... done<br/>Recreating example_varnish_1     ... done<br/>Created session sync_CQ4ZVwER7plFTM0pOaMGrFUnhopfXMcKksgfpPfNPJK<br/>Waiting for initial synchronization to complete<br/>...................................................................</span></pre><blockquote class="ky"><p id="1fdc" class="kz la in bd lb lc ms mt mu mv mw kx dk translated">使用诱变剂同步会话将webroot中的文件同步到容器中，但发布/媒体除外，它仍然使用委托装载进行装载。</p></blockquote><p id="d902" class="pw-post-body-paragraph ka kb in kc b kd li kf kg kh lj kj kk kl lk kn ko kp ll kr ks kt lm kv kw kx ig bi translated">然后运行<em class="mr"> docker ps </em>看看一切是否都在运行。</p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/5ee48ece04076076b6e646f03b5bbf57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gR7ntFOxwkajg3znvcJ8A.png"/></div></div></figure><p id="fa43" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在容器已经创建并运行了，我们可以继续安装Magento了。</p><p id="2e5e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开到项目的ssh连接</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="3fa2" class="ml mm in mh b gy mn mo l mp mq">warden shell</span></pre><p id="b26a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装Magento </strong></p><p id="5afa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mr">如果您已经有一个现有的Magento项目，请跳到下一步</em></p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="1d23" class="ml mm in mh b gy mn mo l mp mq">## Install Application<br/>bin/magento setup:install \<br/>    --backend-frontname=backend \<br/>    --amqp-host=rabbitmq \<br/>    --amqp-port=5672 \<br/>    --amqp-user=guest \<br/>    --amqp-password=guest \<br/>    --db-host=db \<br/>    --db-name=magento \<br/>    --db-user=magento \<br/>    --db-password=magento \<br/>    --http-cache-hosts=varnish:80 \<br/>    --session-save=redis \<br/>    --session-save-redis-host=redis \<br/>    --session-save-redis-port=6379 \<br/>    --session-save-redis-db=2 \<br/>    --session-save-redis-max-concurrency=20 \<br/>    --cache-backend=redis \<br/>    --cache-backend-redis-server=redis \<br/>    --cache-backend-redis-db=0 \<br/>    --cache-backend-redis-port=6379 \<br/>    --page-cache=redis \<br/>    --page-cache-redis-server=redis \<br/>    --page-cache-redis-db=1 \<br/>    --page-cache-redis-port=6379<br/><br/>## Configure Application<br/>bin/magento config:set --lock-env web/unsecure/base_url \<br/>    "https://${TRAEFIK_SUBDOMAIN}.${TRAEFIK_DOMAIN}/"<br/><br/>bin/magento config:set --lock-env web/secure/base_url \<br/>    "https://${TRAEFIK_SUBDOMAIN}.${TRAEFIK_DOMAIN}/"<br/><br/>bin/magento config:set --lock-env web/secure/offloader_header X-Forwarded-Proto<br/><br/>bin/magento config:set --lock-env web/secure/use_in_frontend 1<br/>bin/magento config:set --lock-env web/secure/use_in_adminhtml 1<br/>bin/magento config:set --lock-env web/seo/use_rewrites 1<br/><br/>bin/magento config:set --lock-env system/full_page_cache/caching_application 2<br/>bin/magento config:set --lock-env system/full_page_cache/ttl 604800<br/><br/>bin/magento config:set --lock-env catalog/search/engine elasticsearch7<br/>bin/magento config:set --lock-env catalog/search/enable_eav_indexer 1<br/>bin/magento config:set --lock-env catalog/search/elasticsearch7_server_hostname elasticsearch<br/>bin/magento config:set --lock-env catalog/search/elasticsearch7_server_port 9200<br/>bin/magento config:set --lock-env catalog/search/elasticsearch7_index_prefix magento2<br/>bin/magento config:set --lock-env catalog/search/elasticsearch7_enable_auth 0<br/>bin/magento config:set --lock-env catalog/search/elasticsearch7_server_timeout 15<br/><br/>bin/magento config:set --lock-env dev/static/sign 0<br/><br/>bin/magento deploy:mode:set -s developer<br/>bin/magento cache:disable block_html full_page<br/><br/>bin/magento indexer:reindex<br/>bin/magento cache:flush<br/><br/>## Generate an admin user<br/>ADMIN_PASS="$(pwgen -n1 16)"<br/>ADMIN_USER=localadmin<br/><br/>bin/magento admin:user:create \<br/>    --admin-password="${ADMIN_PASS}" \<br/>    --admin-user="${ADMIN_USER}" \<br/>    --admin-firstname="Local" \<br/>    --admin-lastname="Admin" \<br/>    --admin-email="${ADMIN_USER}@example.com"<br/>printf "u: %s\np: %s\n" "${ADMIN_USER}" "${ADMIN_PASS}"</span><span id="d1a8" class="ml mm in mh b gy my mo l mp mq">## Exit shell<br/>exit</span></pre><p id="7828" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装现有的Magento 2项目</strong></p><p id="9580" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面的步骤与上面讨论的安装Magento的步骤相同。您首先需要的是现有项目的数据库导出，然后按如下方式导入它:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="cce9" class="ml mm in mh b gy mn mo l mp mq">pv /path/to/&lt;your_database_export&gt;.sql | warden db import</span></pre><p id="d2e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者将数据库导出复制到php-fpm容器中，并使用带有drop tables选项的magerun来导入数据库:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="32a3" class="ml mm in mh b gy mn mo l mp mq">cp /path/to/&lt;your_database_export&gt;.sql &lt;container_id&gt;:/var/www/html<br/>warden env exec php-fpm n98-magerun db:import --drop-tables &lt;your_database_export&gt;.sql</span></pre><blockquote class="ky"><p id="908e" class="kz la in bd lb lc ms mt mu mv mw kx dk translated">安装Warden时默认包含Magerun，不用自己手动安装。</p></blockquote><p id="d038" class="pw-post-body-paragraph ka kb in kc b kd li kf kg kh lj kj kk kl lk kn ko kp ll kr ks kt lm kv kw kx ig bi translated">完成后，您必须将URL正确放入core_config_data表中:</p><p id="c74d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用Magerun:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="9c7e" class="ml mm in mh b gy mn mo l mp mq">warden env exec php-fpm n98-magerun config:set web/unsecure/baseurl  http://app.example.test/<br/><br/>warden env exec php-fpm n98-magerun config:set web/secure/baseurl  https://app.example.test/<br/><br/>warden env exec php-fpm n98-magerun web/unsecure/base_media_url http://app.example.test/media/<br/><br/>warden env exec php-fpm n98-magerun web/secure/base_media_url https://app.example.test/media/</span></pre><p id="fb7f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，您可以通过以下方式在当前项目中打开一个交互式mysql会话:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="c1ef" class="ml mm in mh b gy mn mo l mp mq">warden db connect -A</span></pre><p id="caf7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后通过执行以下sql查询:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="1cde" class="ml mm in mh b gy mn mo l mp mq">UPDATE `core_config_data` SET value = 'http://app.example.test' WHERE path = 'web/unsecure/baseurl';<br/><br/>UPDATE `core_config_data` SET value = 'https://app.example.test' WHERE path = 'web/secure/baseurl';<br/><br/>UPDATE `core_config_data` SET value = 'http://app.example.test/media/' WHERE path = 'web/unsecure/base_media_url';<br/><br/>UPDATE `core_config_data` SET value = 'https://app.example.test/media/' WHERE path = 'web/secure/base_media_url';</span></pre><p id="b58d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你的安装已经准备好了，你可以重新启动Warden。</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="465e" class="ml mm in mh b gy mn mo l mp mq">warden env down &amp;&amp; warden env up -d</span></pre><p id="332a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在浏览器中转到您的应用程序</p><p id="1f16" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://app.example.test" rel="noopener ugc nofollow" target="_blank">https://app . example . test</a></p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/679d7ba53d4af00d742f3dff43e043f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0Woa2Cnpnhu367Tmun6MA.png"/></div></div></figure><p id="d097" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建一个到数据库的SSH连接</strong></p><p id="4b72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在一切都已启动并运行，您可以如下所示连接到您的数据库。</p><ul class=""><li id="d4c8" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx lx ly lz ma bi translated">主持人:<warden_env_name_db_1/></li><li id="71cd" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">用户:magento</li><li id="42c8" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">密码:magento</li><li id="42e3" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">数据库:magento</li><li id="b68c" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated">SSH主机:tunnel.waren.test</li></ul><p id="c425" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> Tableplus </strong></p><p id="6580" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建新连接&gt; MySQL &gt;创建</p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/560591f3f13f9d3a21893a22bf8201f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cnnAGQGUVGC6P8fFGt0XQ.png"/></div></div></figure><p id="620f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">续作Pro </strong></p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ebe73aabcabbe79207c79ddf3e5601d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kkxAds1OApC7BLpS5lFOow.png"/></div></div></figure><p id="16e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> PHPStorm </strong></p><ol class=""><li id="7c73" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx nc ly lz ma bi translated">数据库&gt;数据源&gt; MySQL</li></ol><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/ffb81cd0317ac980e02d69ddd2f1d209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fI11kot4aEUpzN4U"/></div></div></figure><p id="92fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.SSH/SSL &gt;使用SSH隧道&gt;选择配置&gt;</p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/3fb73f2d81ae4e31f29c74f3729d686b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rsNtdp-nAnpTVp_m2ou-Pw.png"/></div></div></figure><p id="f220" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.测试电路</p><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/a42f165bd060412eb7873f3b83f3dc05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvRHr1N9n-3km3ElMT9iyg.png"/></div></div></figure><figure class="lo lp lq lr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/f25aad0a6237b78abf7b79b8d29cb87d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T3I84Vj8RKPM7u0I"/></div></div></figure><p id="4f0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装Grunt并配置Live reload </strong></p><p id="79b3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查是否安装了grunt:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="27ed" class="ml mm in mh b gy mn mo l mp mq">❯ grunt --version<br/>grunt-cli v1.3.2</span></pre><p id="267b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果不是:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="2c7b" class="ml mm in mh b gy mn mo l mp mq">npm install -g grunt-cli</span></pre><p id="819d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将以下内容添加到您的<strong class="kc io"> </strong> <em class="mr"> app/etc/env.php </em></p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="0252" class="ml mm in mh b gy mn mo l mp mq">&lt;?php<br/>return [<br/>    'system' =&gt; [<br/>        'default' =&gt; [<br/>            'design' =&gt; [<br/>                'footer' =&gt; [<br/>                    'absolute_footer' =&gt; '&lt;script src="/livereload.js?port=443"&gt;&lt;/script&gt;'<br/>                ]<br/>            ]<br/>        ]<br/>    ]<br/>];</span></pre><p id="f6cf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您还没有Gruntfile和package.json，请添加它们。</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="4033" class="ml mm in mh b gy mn mo l mp mq">cp Gruntfile.js.sample Gruntfile.js<br/>cp package.json.sample package.json</span></pre><p id="728a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装节点包</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="9d08" class="ml mm in mh b gy mn mo l mp mq">npm install</span></pre><p id="1c78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将文件复制到Docker php-fpm容器中:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="b5a0" class="ml mm in mh b gy mn mo l mp mq">docker cp Gruntfile.js &lt;container_id&gt;:/var/www/html<br/>docker cp package.json &lt;container_id&gt;:/var/www/html<br/>docker cp node_modules &lt;container_id&gt;:/var/www/html</span></pre><p id="045e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">执行以下操作:</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="d0a8" class="ml mm in mh b gy mn mo l mp mq">warden env exec php-fpm grunt clean &amp;&amp; grunt less</span></pre><p id="dad2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后</p><pre class="lo lp lq lr gt mg mh mi mj aw mk bi"><span id="51ae" class="ml mm in mh b gy mn mo l mp mq">warden env exec php-fpm grunt watch</span></pre><p id="6d64" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">至此:“如何用warden为Magento设置一个本地Docker环境”。在第二部分，我将讨论如何在Magento 2和Warden中设置多个商店视图。</p><h1 id="c7ae" class="nh mm in bd ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od bi translated">觉得这个帖子有用吗？请点击👏下面的按钮！:)</h1><p id="2884" class="pw-post-body-paragraph ka kb in kc b kd oe kf kg kh of kj kk kl og kn ko kp oh kr ks kt oi kv kw kx ig bi translated"><em class="mr">来源:</em></p><ul class=""><li id="2011" class="ls lt in kc b kd ke kh ki kl lu kp lv kt lw kx lx ly lz ma bi translated">对容器、虚拟机和Docker的初学者友好的介绍</li><li id="a4fa" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated"><a class="ae jz" href="https://docs.docker.com/engine/install/ubuntu/" rel="noopener ugc nofollow" target="_blank">在Ubuntu上安装Docker引擎</a></li><li id="9704" class="ls lt in kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma bi translated"><a class="ae jz" href="https://docs.warden.dev/installing.html" rel="noopener ugc nofollow" target="_blank">安装监护人</a></li></ul></div></div>    
</body>
</html>