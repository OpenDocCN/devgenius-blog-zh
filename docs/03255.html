<html>
<head>
<title>How to easily send and receive data with an iframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 iframe 轻松发送和接收数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-easily-send-and-receive-data-with-an-iframe-1a9c6da11723?source=collection_archive---------0-----------------------#2020-10-17">https://blog.devgenius.io/how-to-easily-send-and-receive-data-with-an-iframe-1a9c6da11723?source=collection_archive---------0-----------------------#2020-10-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="477c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从安全性问题到可用性和 SEO 问题，Iframes 的包装都很糟糕。尽管如此，它们是我们可以使用的工具之一，知道如何有效地使用它们可以为老问题打开新的解决方案之门。能够在 iframe 和父页面之间发送数据是交付更加集成的解决方案的一个有用技巧，而不是使用传统的无聊的“页面中的页面”方式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f72f4a9e3ac3d50a333af037749fbb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_AtSOlTCnn9wcncW5cP1UQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/html?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@_imkiran?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sai Kiran Anagani </a>拍摄的照片</figcaption></figure><p id="34dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不过，这里讨论的方法并不仅仅针对 iframes，它还适用于任何可以访问另一个页面的“window”对象的情况(因此弹出窗口和嵌入式 web 浏览器也可以加入进来)。但是 Iframes 很容易使用，所以我们将在这个例子中使用它们。</p><p id="2759" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在子页面和父页面之间建立双向通信有几种方法。不过，一般来说，推荐的方法是使用“window.postMessage ”,如果你使用的技术支持的话(对不起 IE 用户)。</p><p id="5562" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，让我们创建一个基本页面作为我们的父页面。</p><pre class="kj kk kl km gt kz la lb lc aw ld bi"><span id="9444" class="le lf in la b gy lg lh l li lj">&lt;!-- index.html --&gt;<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;Parent Page&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;h2&gt;Container&lt;/h2&gt;<br/>    &lt;textarea id="output" cols="30" rows="10" disabled&gt;awaiting data...&lt;/textarea&gt;<br/>    &lt;div&gt;<br/>      &lt;input type="text" id="field" value="type something fun here" /&gt;<br/>      &lt;button id="send"&gt;Send&lt;/button&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;iframe<br/>        height="500px"<br/>        id="inner"<br/>        src=""<br/>        frameborder="0"<br/>      &gt;&lt;/iframe&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ce04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们有一个非常基础的页面。我将使用一个禁用的文本区域来显示来自嵌入式页面的消息数据，并使用一个输入和按钮来发送消息到所述页面。除此之外，我们有嘉宾，iframe 本身，目前没有它的来源，因为我们需要先做一个页面来嵌入。就这么办吧。</p><h2 id="fa45" class="le lf in bd lk ll lm dn ln lo lp dp lq jv lr ls lt jz lu lv lw kd lx ly lz ma bi translated">嵌入页面</h2><p id="37a9" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">这是将在 iframe 或 popup 中运行的页面。在结构上，我们将做一些与父页面非常相似的东西。</p><pre class="kj kk kl km gt kz la lb lc aw ld bi"><span id="a678" class="le lf in la b gy lg lh l li lj">&lt;!-- inner.html --&gt;<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;Embedded Page&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;h2&gt;Embedded&lt;/h2&gt;<br/>    &lt;textarea cols="30" rows="10" disabled id="output"&gt;awaiting data...&lt;/textarea&gt;<br/>    &lt;input type="text" id="field" /&gt;<br/>    &lt;button id="send"&gt;Send&lt;/button&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9e5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们需要将这个页面加载到 iframe 中。最简单的方法是使用类似 npm 包“serve”的东西。如果您安装了“npm ”,请导航到这些文件所在的目录，然后运行“npx serve”。</p><p id="bf51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您应该得到一些输出，指示资产在哪个端口上提供服务。在我的情况下，它们在端口 5000 上被服务。当我访问<a class="ae ky" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>时，我将得到父页面 inner.html，如果我访问<a class="ae ky" href="http://localhost:5000/inner.html" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/inner . html</a>，我将得到我想要嵌入的页面。</p><p id="5b9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这意味着我可以使用该 URL 作为我的 iframe 的源，所以我现在将它设置为我的“src”属性的值。</p><pre class="kj kk kl km gt kz la lb lc aw ld bi"><span id="4beb" class="le lf in la b gy lg lh l li lj">&lt;iframe<br/>    height="500px"<br/>    id="inner"<br/>    src="<a class="ae ky" href="http://localhost:5000/inner.html" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/inner.html</a>"<br/>    frameborder="1"<br/>&gt;&lt;/iframe&gt;</span></pre><p id="8e05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">解决了这个问题，如果我们访问 index.html 页面，我们现在应该看到 iframe 下面包含了我们的另一个页面。下一步是编写一些 JavaScript 来促进两个页面之间的通信。</p><h2 id="b300" class="le lf in bd lk ll lm dn ln lo lp dp lq jv lr ls lt jz lu lv lw kd lx ly lz ma bi translated">JavaScript</h2><p id="01c8" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">首先，我们需要在索引页面上编写一些代码，等待 iframe 加载，然后获取对其“window”对象的引用，这样我们就可以对其调用“window.postMessage”函数。</p><p id="16d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要添加一个事件侦听器来在我们单击发送按钮时发送消息，并添加一个事件侦听器来显示我们从嵌入页面收到的任何消息。</p><p id="d5c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 index.html，在您的“</p><pre class="kj kk kl km gt kz la lb lc aw ld bi"><span id="33db" class="le lf in la b gy lg lh l li lj">&lt;script&gt;<br/>      // assign variables with references to the DOM nodes we will be interacting with<br/>      const output = document.getElementById("output");<br/>      const iframe = document.getElementById("inner");<br/>      const button = document.getElementById("send");<br/>      const field = document.getElementById("field");<br/>      // we will assign this value once the iframe is ready<br/>      let iWindow = null;</span><span id="f055" class="le lf in la b gy mg lh l li lj">// This event listener will run when we click the send button<br/>      button.addEventListener("click", () =&gt; {<br/>        // don't do anything if the iframe isn't ready yet<br/>        if (iWindow === null) {<br/>          return;<br/>        }</span><span id="a4c5" class="le lf in la b gy mg lh l li lj">// otherwise, get the value of our text input<br/>        const text = field.value;</span><span id="ca62" class="le lf in la b gy mg lh l li lj">// and send it to the embedded page<br/>        iWindow.postMessage(text);<br/>      });</span><span id="761c" class="le lf in la b gy mg lh l li lj">// This event listener will run when the embedded page sends us a message<br/>      window.addEventListener("message", (event) =&gt; {<br/>        // extract the data from the message event<br/>        const { data } = event;</span><span id="e37e" class="le lf in la b gy mg lh l li lj">// display it in our textarea as formatted JSON<br/>        output.value = JSON.stringify(data, null, 2);<br/>      });</span><span id="55ee" class="le lf in la b gy mg lh l li lj">// Once the iframe is done loading, assign its window object to the variable we prepared earlier<br/>      iframe.addEventListener("load", () =&gt; {<br/>        iWindow = iframe.contentWindow;<br/>      });<br/>&lt;/script&gt;</span></pre><p id="3b61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尽管 JavaScript 本身不会做太多事情；我们需要在嵌入式页面中添加相应的代码，因此在 inner.html 中添加另一个包含以下内容的脚本标记。</p><pre class="kj kk kl km gt kz la lb lc aw ld bi"><span id="697e" class="le lf in la b gy lg lh l li lj">&lt;script&gt;<br/>      // set up references to DOM nodes<br/>      const output = document.getElementById("output");<br/>      const button = document.getElementById("send");<br/>      const field = document.getElementById("field");</span><span id="74b4" class="le lf in la b gy mg lh l li lj">// create a variable for the parent window. We will assign it once we get the first message.<br/>      let parent = null;</span><span id="e478" class="le lf in la b gy mg lh l li lj">// add an event listener to send messages when the button is clicked<br/>      button.addEventListener("click", () =&gt; {<br/>        // don't do anything if there is no parent reference yet<br/>        if (parent === null) {<br/>          return;<br/>        }</span><span id="0163" class="le lf in la b gy mg lh l li lj">// otherwise get the field text, and send it to the parent<br/>        const text = field.value;<br/>        parent.postMessage(text);<br/>      });</span><span id="1ff6" class="le lf in la b gy mg lh l li lj">// add an event listener to run when a message is received<br/>      window.addEventListener("message", ({ data, source }) =&gt; {<br/>        // if we don't have a reference to the parent window yet, set it now<br/>        if (parent === null) {<br/>          parent = source;<br/>        }</span><span id="cd7b" class="le lf in la b gy mg lh l li lj">// now we can do whatever we want with the message data.<br/>        // in this case, displaying it, and then sending it back<br/>        // wrapped in an object<br/>        output.textContent = JSON.stringify(data);<br/>        const response = {<br/>          success: true,<br/>          request: { data },<br/>        };<br/>        parent.postMessage(response);<br/>      });<br/>&lt;/script&gt;</span></pre><p id="aac1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">保存您的所有文件，刷新您的浏览器，并尝试一下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/33fd9c1d3c503fd0e995f67c4dea9229.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/1*WCveRDWutgW-hWYLMDqVxA.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">双向沟通在起作用</figcaption></figure><p id="b411" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当涉及到弹出窗口、iframes 和嵌入式浏览器时，使用这种发送消息的方法打开了一个全新的交互级别，如果你处理得当，为一些非常酷的交互铺平了道路。</p><p id="71be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Pastebin 链接来源:【index.html】—<a class="ae ky" href="https://pastebin.com/A0HFp6c5" rel="noopener ugc nofollow" target="_blank">https://pastebin.com/A0HFp6c5</a><br/>—inner.html—<a class="ae ky" href="https://pastebin.com/ba6TNXK5" rel="noopener ugc nofollow" target="_blank">https://pastebin.com/ba6TNXK5</a></p></div></div>    
</body>
</html>