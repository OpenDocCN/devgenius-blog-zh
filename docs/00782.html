<html>
<head>
<title>Decoding the Triad T2556</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解码三和弦T2556</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/decoding-the-triad-t2556-6f0ed4cd1125?source=collection_archive---------21-----------------------#2020-06-16">https://blog.devgenius.io/decoding-the-triad-t2556-6f0ed4cd1125?source=collection_archive---------21-----------------------#2020-06-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6a19" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">T2556三联体系列之四</h2></div><p id="c9e8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GIMP 中的<a class="ae ky" href="https://medium.com/@alexwking/tracing-the-triad-t2556-1c9ff7822f0e?source=friends_link&amp;sk=af2fdbb1c6506b9a370725c38696da2d" rel="noopener">检查和清理痕迹的任务真的是漫长而乏味的。一路上，我决定休息一下，看看各种只读存储器是怎么回事。</a></p><p id="dc22" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我知道主板上有三种不同类型的设备:包含代码的EPROM，视频控制器(可能)使用的EPROM，以及有一些神秘应用有待确定的PROM。</p><p id="a96a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">提取EPROMs的内容是一件轻而易举的事情，这要感谢容易获得且价格合理的<a class="ae ky" href="http://www.autoelectric.cn/en/tl866_main.html" rel="noopener ugc nofollow" target="_blank"> TL866A </a>编程器，特别是当它与优秀的<a class="ae ky" href="https://gitlab.com/DavidGriffith/minipro/" rel="noopener ugc nofollow" target="_blank"> Minipro </a>项目配对时，它让我可以在Mac上从命令行做任何事情。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/ab32ccf37039cd0b24a0119aa84ef3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*0HK3G_kXZXm8Bl_HksQCoQ.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">7x9和5x7字符EPROMS的转储</figcaption></figure><p id="0fb2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了查看两个视频EPROMS的内容，我编写了一个小Python脚本来将位渲染到图像中，考虑到这两个视频EPROMS下面的PCB上的丝网印刷显示的是<code class="fe ll lm ln lo b">GRAPH/7x9</code>和<code class="fe ll lm ln lo b">GRAPH/5x7</code>，它们包含位图字体也就不足为奇了。7x9在地址空间的后半部分有这个略显粗糙的Wild West双宽度字符集。公平地说，这是上世纪80年代的事了。</p><p id="1456" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是5x7块的前半部分包含什么呢？看起来有点奇怪。也许当按计划展示时，它会变得更明显。推迟到以后的事情。</p><p id="c98b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">EPROM程序有点不同。我原以为是Z80机器码和一些ASCII文本的混合。检查文本的一个快速方法是使用<code class="fe ll lm ln lo b">strings</code>命令。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/2e986abae43583afde792f2729425dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35bT1J4_fI8rntNaqN7oBw.png"/></div></div></figure><p id="e637" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这看起来很有希望！我注意到对<code class="fe ll lm ln lo b">TRANS/MULTI</code>和<code class="fe ll lm ln lo b">DIFFERENTIAL</code>的引用，这可能是指当<a class="ae ky" href="https://medium.com/@alexwking/discovering-the-triad-t2556-19aa184c1bc3?source=friends_link&amp;sk=355b623f82eb24b785190dbcb7a526cb" rel="noopener">第一次查看电路板</a>时出现的两个不寻常的设备。</p><p id="af10" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上电和复位时，Z80从地址0开始执行代码。我找到了<code class="fe ll lm ln lo b">z80dasm</code>作为合适的Z80拆解器，试用了一下。让我们看看它在EPROM的开头找到了什么:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/3f90bf1b54d52c709c457cbf52c50310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMl5bcsqi0thY4lzCg5UAg.png"/></div></div></figure><p id="d00f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">太棒了。这看起来完全像Z80代码。我们知道EPROM包含程序代码和数据，比如字符串等，但是我很好奇这两者是如何在地址空间中共存的。当我进一步深入研究EPROM时，这将像“地图”一样工作。我编写了一个快速的Python程序，该程序遍历包含EPROM映像的文件，并根据地址的内容为像素着色:如果字节小于32，则为红色；如果值为零，则为黑色；如果值大于127，则为青色；如果值是可打印的ASCII码(即超出这两个范围),则为橙色。另外，如果前面的三个字节也是可打印的，它就变成黄色。为了有助于进一步简化，编码被分成页面或256 (16x16)字节块。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/5d5229b13fb3ea9d3c864b7bd0118ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*g17qGMjZ-ZT_hNkrhDvPKg.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">EPROM程序的彩色编码图</figcaption></figure><p id="3f6d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以看起来有几个黄色的热点是ASCII序列所在的地方。在第四页也有相当大的黑色区域。</p><p id="8a7b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在足够好了。</p><p id="81df" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是真正的挑战是弄清楚那个<a class="ae ky" href="https://archive.org/stream/bitsavers_tidataBookcomputerComponentsDataBook_16851665/1977_TI_Bipolar_Microcomputer_Components_Data_Book#page/n173/mode/2up" rel="noopener ugc nofollow" target="_blank"> 74LS471 </a>上有什么，特别是因为它不被EPROM程序员支持。</p><p id="cc1f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我从互联网上获得灵感，找到了一个page☨，他谈到了使用二进制纹波计数器来记录地址范围。这意味着我只需要几个引脚就可以遍历整个8位地址范围，因此可以在Arduino Uno上运行。万岁！</p><p id="af44" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">电路看起来像这样:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lv"><img src="../Images/f83fc8f642f7337361edb8353eb914da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lfwewzV5PuxY9WXQgFgc_w.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">将PROM数据提取到Arduino的KiCad原理图</figcaption></figure><p id="db84" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将一个Arduino连接到一张厚纸板上，还有一个原型板，所以一旦<a class="ae ky" href="https://web.archive.org/web/20161104125848/http://www.ti.com/lit/ds/symlink/sn74hc4040.pdf" rel="noopener ugc nofollow" target="_blank"> 74HC4040 </a>到达，连接起来非常容易，记住这个设备是静电敏感的，并观察适当的处理。当然，我还需要写一张<a class="ae ky" href="https://gist.github.com/ak15199/f38ccbff70a03b32837452793c18c90d" rel="noopener ugc nofollow" target="_blank">草图</a>来驾驶Arduino。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lw"><img src="../Images/1c721aab09e4c4be7e50b903d6b0f948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k2wFx5TpxN44FfSkuS2gRQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">正在运行PROM捕获</figcaption></figure><p id="7871" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而结果令人困惑:这个芯片上没有任何代码，事实上大部分是空的。有点奇怪。</p><p id="0445" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">几乎所有来自PROM的数据都是1，只有一小块数据看起来更有趣。</p><p id="3a03" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">怎么了？我插上示波器，看看我在Arduino上的程序是否以某种方式记录了错误的位，但不是这样。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/10ff164197e9eb020f97bbeea6d9770c.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*n7g-odiQnpv6YskD65sZmw.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">PROM内容</figcaption></figure><p id="ba72" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在检查连接并重新运行代码三四次后，我至少确信结果是一致的，即使我不知道它们是什么意思。</p><p id="270d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我绘制出原理图时，我脑海中的灵光一现，事实证明没有理由担心——一切都运行得很好。我们改天再谈那个故事。</p><p id="eeaf" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在项目的这一阶段，我觉得我得到了一些答案，但也发现了同样多的问题。</p><p id="0e54" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，这是进步，时间会揭示更多。不过，在我超越自我之前，我可能应该把所有的事情放回一起</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><p id="3d7c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">☨:不幸的是，我在笔记或书签中找不到那一页的参考文献。如果你是我的灵感，请告诉我，我会给你的作品添加一个链接。</p></div></div>    
</body>
</html>