<html>
<head>
<title>Start using Airflow on Heroku(Part II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始在Heroku上使用气流(第二部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/running-airflow-on-heroku-part-ii-c9797a36f11f?source=collection_archive---------3-----------------------#2021-12-19">https://blog.devgenius.io/running-airflow-on-heroku-part-ii-c9797a36f11f?source=collection_archive---------3-----------------------#2021-12-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/80caa492b213825dc58dd44baa2732c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dxx-Uo37RIi7q94tX77r6A.jpeg"/></div></div></figure><p id="1b65" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在前一篇文章中，我们将环境配置为在本地运行<code class="fe kt ku kv kw b">Airflow</code>。在本文中，我们将配置您的<code class="fe kt ku kv kw b">Heroku</code>,并对我们的应用程序进行第一次部署。</p><p id="0a27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将讨论一些主题:</p><ul class=""><li id="ec45" class="kx ky in jx b jy jz kc kd kg kz kk la ko lb ks lc ld le lf bi translated">配置fernet密钥</li><li id="47ac" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">使当地环境更类似于生产</li><li id="506f" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">在<code class="fe kt ku kv kw b">Heroku</code>设立项目</li><li id="6122" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">在<code class="fe kt ku kv kw b">Airflow</code>中创建认证用户</li><li id="0669" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">部署</li></ul><p id="776c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">听起来很多，不是吗？但是你会发现这些步骤都很简单。我还会教你一些技巧，这样我们就可以让你的<code class="fe kt ku kv kw b">Airflow</code>在<code class="fe kt ku kv kw b">Heroku</code>自由层中更有活力和效率。</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h1 id="3147" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">配置Fernet密钥</h1><p id="8c8c" class="pw-post-body-paragraph jv jw in jx b jy mp ka kb kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks ig bi translated">此时，我们需要创建一个名为<code class="fe kt ku kv kw b">generate_kernet_key.py</code>的文件，我们将使用它来生成一个敏感数据加密密钥，供<code class="fe kt ku kv kw b">Airflow</code>使用。</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><h1 id="f147" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">将本地环境设置得更像生产环境</h1><p id="2bcd" class="pw-post-body-paragraph jv jw in jx b jy mp ka kb kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks ig bi translated"><code class="fe kt ku kv kw b">Heroku</code>是一个出色的平台，让我们实施应用变得更加容易。但正如我们所知，开发任何一种更接近实际运行的应用总是好的，为此我们将做一些改变，使您的本地环境运行起来与我们在<code class="fe kt ku kv kw b">Heroku</code>中发现的非常相似。为此，我们需要更改运行<code class="fe kt ku kv kw b">airflow db init</code>命令时创建的<code class="fe kt ku kv kw b">airflow.ctg</code>文件。</p><p id="6ca1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个文件只在本地使用，但是让我们把它做成我们在生产中会看到的样子。在该文件中，我们将修改以下数据:</p><ul class=""><li id="d9ed" class="kx ky in jx b jy jz kc kd kg kz kk la ko lb ks lc ld le lf bi translated">定义气流的PostgresSQL关系数据库</li><li id="6f82" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">注册适当的执行者类型来运行我们的DAGS</li><li id="e8d8" class="kx ky in jx b jy lg kc lh kg li kk lj ko lk ks lc ld le lf bi translated">通过我们的<code class="fe kt ku kv kw b">generate_fernet_key.py</code>脚本用Fernet生成一个密钥</li></ul><p id="0e6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们进行以下更改:</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><p id="d28e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有了这些设置，我们的<code class="fe kt ku kv kw b">Airflow</code>将使用PostgreSQL数据库来存储DAGS及其执行的元数据。</p><p id="59a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们删除我们的<code class="fe kt ku kv kw b">airflow.db</code>文件，并重新运行我们的<code class="fe kt ku kv kw b">airflow db init</code>命令，以便我们的迁移应用到数据库。</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mv lq l"/></div></figure><h1 id="21f0" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">在Heroku建立项目</h1><p id="d16c" class="pw-post-body-paragraph jv jw in jx b jy mp ka kb kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks ig bi translated">在这一步，我们将配置<code class="fe kt ku kv kw b">airflow</code>以便在<code class="fe kt ku kv kw b">Heroku</code>上运行时正确工作，因此我们需要设置一些环境变量。</p><p id="8e1d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mw">在本帖中，我们假设您已经创建了Heroku帐户并在本地进行了配置。</em></p><p id="258f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我们将使用<code class="fe kt ku kv kw b">config:set</code> let's go？</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><p id="9a9b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用这两个命令，我们在<strong class="jx io"> Heroku </strong>上创建你的应用，并添加<strong class="jx io"> Postgres </strong>到其中。</p><p id="e30f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们将设置在<code class="fe kt ku kv kw b">heroku:</code>中运行气流所需的变量</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><p id="ad69" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经定义了我们的设置，让我们进入整个过程中最简单的部分，创建我们的<code class="fe kt ku kv kw b">Procfile</code>文件。这个文件是Heroku用来运行你的应用程序的，在这个文件中，我们将传递我们想要Heroku运行的命令，以使我们的气流正常工作。</p><p id="a6dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的<code class="fe kt ku kv kw b">Procfile</code>文件中，它应该包含以下几行:</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><h1 id="5a99" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">在气流中创建用户</h1><p id="0f9f" class="pw-post-body-paragraph jv jw in jx b jy mp ka kb kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks ig bi translated">在上一篇文章中，我们的用户是由airflow自动创建的，在本文中，我将教您如何使用您的密码创建您的用户，只需运行以下命令:</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><p id="61e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择你的密码，快乐❤️</p><h1 id="cd96" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">部署到Heroku</h1><p id="4b61" class="pw-post-body-paragraph jv jw in jx b jy mp ka kb kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks ig bi translated">现在，我们可以进行第一次部署了，只需在您的命令终端中输入3行代码，就可以完成部署:</p><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mu lq l"/></div></figure><figure class="ll lm ln lo gt jo"><div class="bz fp l di"><div class="mv lq l"/></div></figure><p id="c283" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦完成，你的应用程序将安静地运行在Heroku上，在下一篇文章中，我们将介绍如何创建功能性Dag并最大限度地利用airflow的电力。再见🚀</p></div></div>    
</body>
</html>