<html>
<head>
<title>Testing a Rails API with RSpec</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨ RSpec æµ‹è¯• Rails API</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/testing-a-rails-api-with-rspec-82dedc9f15df?source=collection_archive---------1-----------------------#2022-02-08">https://blog.devgenius.io/testing-a-rails-api-with-rspec-82dedc9f15df?source=collection_archive---------1-----------------------#2022-02-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/652f01fd898864099a36a5b38c94d32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P9iQIqnrcSFAsklJ"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">æ˜†é¡¿Â·åº“åˆ‡åœ¨<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</figcaption></figure><p id="aa51" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨æœ€æµè¡Œçš„ Ruby æµ‹è¯•æ¡†æ¶ RSpec æ¥æµ‹è¯• Ruby on Rails çº¯ API åº”ç”¨ç¨‹åºçš„ GETã€POST å’Œ DELETE æ–¹æ³•ã€‚</p><p id="ae2d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">é¦–å…ˆï¼Œæˆ‘å°†ç¼–å†™ä¼šå¤±è´¥çš„æµ‹è¯•ï¼Œç„¶åç¼–å†™æ§åˆ¶å™¨çš„ä»£ç æ¥è§£å†³è¿™äº›æµ‹è¯•ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘å°†ä½¿ç”¨<a class="ae jz" href="https://en.wikipedia.org/wiki/Test-driven_development#:~:text=Test%2Ddriven%20development%20(TDD),software%20against%20all%20test%20cases." rel="noopener ugc nofollow" target="_blank"> TDD </a>æ–¹æ³•ã€‚</p><p id="c58f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä»¬æ¥ç¼–ç å§ï¼</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="3d59" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç¬¬ä¸€æ­¥ã€‚åˆ›å»ºä¸€ä¸ª Rails API</h1><p id="1b93" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">ä¸€å¼€å§‹ï¼Œä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªç®€å•çš„ Rails API ä¸“ç”¨åº”ç”¨ç¨‹åºã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2aec" class="mr lg in mn b gy ms mt l mu mv">rails new post-api --api <!-- -->-T<br/>cd post-api</span></pre><p id="8c3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ——å¸œ<code class="fe mw mx my mn b">--api</code>ç»§æ‰¿äº†<code class="fe mw mx my mn b">ActionController::API</code>çš„<code class="fe mw mx my mn b">ApplicationController</code>è€Œä¸æ˜¯<code class="fe mw mx my mn b">ActionController::Base</code>ã€‚è¿™æ„å‘³ç€ Action Controller æä¾›äº†æµè§ˆå™¨åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ¨¡å—ï¼Œå¹¶è·³è¿‡äº†ç”Ÿæˆæˆ‘ä»¬ä¸éœ€è¦çš„è§†å›¾ã€åŠ©æ‰‹å’Œèµ„æºã€‚</p><p id="d672" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<em class="mz"> RSpec </em>è€Œä¸æ˜¯<em class="mz"> MiniTest </em>ã€‚å‘½ä»¤<code class="fe mw mx my mn b">-T</code>è·³è¿‡<code class="fe mw mx my mn b">Minitest::Unit</code>æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ç”Ÿæˆã€‚</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="1dc6" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç¬¬äºŒæ­¥ã€‚å®‰è£… gems</h1><p id="eb3d" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">å°†<code class="fe mw mx my mn b">rspec-rails</code>æ·»åŠ åˆ°åº”ç”¨ç¨‹åº<code class="fe mw mx my mn b">Gemfile</code>çš„<code class="fe mw mx my mn b">:development</code>å’Œ<code class="fe mw mx my mn b">:test</code>ç»„ä¸­ã€‚å¦å¤–ï¼Œåœ¨<code class="fe mw mx my mn b">:test</code>ç¯å¢ƒä¸­æ·»åŠ ä¸€ä¸ª<code class="fe mw mx my mn b">factory_bot_rails</code> gem ç”¨äºè®¾ç½®æµ‹è¯•æ•°æ®å¯¹è±¡ï¼Œæ·»åŠ <code class="fe mw mx my mn b">faker</code>ç”¨äºç”Ÿæˆå‡æ•°æ®ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="54ed" class="mr lg in mn b gy ms mt l mu mv">group :development, :test do<br/>  gem 'rspec-rails'<br/>end</span><span id="86ec" class="mr lg in mn b gy na mt l mu mv">group :test do<br/>    gem 'factory_bot_rails'<br/>    <!-- -->gem 'faker'<br/>end</span></pre><p id="795b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å®‰è£…ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="35ae" class="mr lg in mn b gy ms mt l mu mv">bundle</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="9389" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç¬¬ä¸‰æ­¥ã€‚è®¾ç½®æµ‹è¯•ç¯å¢ƒ</h1><p id="a652" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">è¦å®Œæˆ RSpec å®‰è£…ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="c5f7" class="mr lg in mn b gy ms mt l mu mv">rails generate rspec:install</span></pre><p id="e36e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¯¥å‘½ä»¤ç”Ÿæˆä¸€ä¸ªåŒ…å«<code class="fe mw mx my mn b">rails_helper.rb</code>å’Œ<code class="fe mw mx my mn b">spec_helper.rb</code>æ–‡ä»¶çš„<em class="mz">è§„æ ¼</em>æ–‡ä»¶å¤¹ã€‚</p><p id="fb12" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ¥ä¸‹æ¥ï¼Œç”¨<code class="fe mw mx my mn b">spec/factories.rb</code>ä¸­çš„å‡æ•°æ®åˆ›å»º<em class="mz"> Post </em>å·¥å‚ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="3fb6" class="mr lg in mn b gy ms mt l mu mv">FactoryBot.define do<br/>  factory :post do<br/>    title { Faker::Lorem.sentence }<br/>    content { Faker::Lorem.paragraph }<br/>  end<br/>end</span></pre><p id="c4b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¸ºäº†æœ€å°åŒ–ä»£ç ï¼Œæˆ‘å°†ç¼–å†™ä¸€ä¸ª<code class="fe mw mx my mn b">json</code>æ–¹æ³•ã€‚å®ƒåªæ˜¯è§£æå“åº”ä½“å­—ç¬¦ä¸²ã€‚è¿˜æ˜¯å†™åœ¨<code class="fe mw mx my mn b">spec/support/api_helpers.rb</code>å§ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="3780" class="mr lg in mn b gy ms mt l mu mv">module ApiHelpers<br/>  def json<br/>    JSON.parse(response.body)<br/>  end<br/>end</span></pre><p id="d9aa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æœ€åè¦åšçš„æ˜¯è¦æ±‚æ‰€æœ‰çš„æ”¯æŒæ–‡ä»¶ï¼Œå¹¶åœ¨<code class="fe mw mx my mn b">spec/rails_helper.rb</code>ä¸­åŒ…å«<em class="mz"> ApiHelpers </em>æ¨¡å—ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="90c2" class="mr lg in mn b gy ms mt l mu mv">Dir[Rails.root.join("spec/support/**/*.rb")].each { |f| require f }</span><span id="9e02" class="mr lg in mn b gy na mt l mu mv">RSpec.configure do |config|<br/>  # ...<br/>  config.include ApiHelpers<br/>end</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="d0f3" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç¬¬å››æ­¥ã€‚API è§„æ ¼</h1><p id="5e20" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">æˆ‘å°†ä½¿ç”¨<a class="ae jz" href="https://www.freecodecamp.org/news/how-to-version-a-rest-api/#:~:text=so%20let's%20recap%3A-,API%20versioning%20is%20the%20practice%20of%20transparently%20managing%20changes%20to,effective%20API%20change%20management%20principles." rel="noopener ugc nofollow" target="_blank"> REST API ç‰ˆæœ¬æ§åˆ¶</a>ã€‚å½“åœ¨ API ä¸­è¯†åˆ«å‡ºéœ€è¦çš„å˜æ›´æ—¶ï¼Œå®ƒ<strong class="kc io">å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°è¿­ä»£ã€‚è¿™æ˜¯æœ€ä½³å®è·µã€‚</strong></p><h2 id="736f" class="mr lg in bd lh nb nc dn ll nd ne dp lp kl nf ng lt kp nh ni lx kt nj nk mb nl bi translated">å¾—åˆ°</h2><p id="9d05" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">åˆ›å»º<code class="fe mw mx my mn b">spec/requests/get_posts_spec.rb</code>å¹¶æ’å…¥ä»¥ä¸‹ä»£ç :</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ee0c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¼€å§‹æ—¶ï¼Œæˆ‘ä½¿ç”¨ FactoryBot æ–¹æ³•<code class="fe mw mx my mn b">create_list</code>åˆ›å»º 10 ä¸ªå¸–å­ï¼Œç„¶åè°ƒç”¨ä¸€ä¸ª HTTP GETã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æ£€æŸ¥åˆ›å»ºçš„å¸–å­çš„å¤§å°å’Œ HTTP çŠ¶æ€ä»£ç ã€‚</p><h2 id="7ac6" class="mr lg in bd lh nb nc dn ll nd ne dp lp kl nf ng lt kp nh ni lx kt nj nk mb nl bi translated">é‚®æ”¿</h2><p id="a0f7" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">æ¥ä¸‹æ¥ï¼Œåˆ›å»º<code class="fe mw mx my mn b">spec/requests/post_posts_spec.rb</code>å¹¶æ’å…¥å®ƒ:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="12d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘åœ¨<code class="fe mw mx my mn b">let!</code>æ–¹æ³•å†…éƒ¨å†™äº†ä¸€ä¸ª post å®ä¾‹ã€‚é€šå¸¸ï¼Œå¦‚æœæˆ‘éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å®ä¾‹ï¼Œæˆ‘ä¼šä½¿ç”¨<code class="fe mw mx my mn b">let!</code>ï¼Œå¦åˆ™ä½¿ç”¨<code class="fe mw mx my mn b">before</code>ã€‚</p><h2 id="308f" class="mr lg in bd lh nb nc dn ll nd ne dp lp kl nf ng lt kp nh ni lx kt nj nk mb nl bi translated">åˆ é™¤</h2><p id="8405" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">è€Œæœ€åä¸€ä¸ªå°±æ˜¯åˆ›å»º<code class="fe mw mx my mn b">spec/requests/delete_posts_spec.rb</code>å¹¶æ’å…¥ä¸‹é¢çš„ä»£ç ã€‚</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="da74" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿›è¡Œæµ‹è¯•ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="cfc9" class="mr lg in mn b gy ms mt l mu mv">rspec</span></pre><p id="fd51" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æµ‹è¯•è‚¯å®šä¼šå¤±è´¥ï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€æ­¥è§£å†³ã€‚</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="802b" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç¬¬äº”æ­¥ã€‚é€šè¿‡æµ‹è¯•</h1><p id="fe8f" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">é€šè¿‡æµ‹è¯•çš„ç¬¬ä¸€æ­¥æ˜¯<strong class="kc io">ç”Ÿæˆä¸€ä¸ªæ¨¡å‹<em class="mz">å</em> </strong>ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1c6e" class="mr lg in mn b gy ms mt l mu mv">rails g model Post title:string content:text --no-test-framework<br/>rails db:migrate</span></pre><p id="1ca5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mw mx my mn b">--no-test-framework</code>æ ‡å¿—ä¸åˆ›å»ºæ¨¡å‹æµ‹è¯•ã€‚å¦‚æœæ‚¨éœ€è¦æ¨¡å‹æµ‹è¯•ï¼Œæ‚¨å¯ä»¥ç§»é™¤è¯¥æ ‡å¿—ã€‚</p><p id="f700" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¸‹ä¸€æ­¥æ˜¯<strong class="kc io">éªŒè¯æ¨¡å‹</strong>ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="caab" class="mr lg in mn b gy ms mt l mu mv">class Post &lt; ApplicationRecord<br/>  validates :title, :content, presence: true<br/>end</span></pre><p id="e3a8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä»…å¯¹å±æ€§çš„å­˜åœ¨è¿›è¡ŒéªŒè¯ã€‚</p><p id="758e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">å»ºé€ <em class="mz">å²—ä½</em>æ§åˆ¶å™¨</strong>ä»¥æ»¡è¶³æ‰€æœ‰æµ‹è¯•è¦æ±‚ã€‚</p><p id="cfa7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åˆ›å»º<code class="fe mw mx my mn b">app/controllers/api/v1/posts_controller.rb</code>æ–‡ä»¶å¹¶æ’å…¥ä»¥ä¸‹ä»£ç :</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="25dc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ›´æ–°<code class="fe mw mx my mn b">routes.rb</code>ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="561d" class="mr lg in mn b gy ms mt l mu mv">Rails.application.routes.draw do<br/>  namespace :api do<br/>    namespace :v1 do<br/>      resources :posts<br/>    end<br/>  end <br/>end</span></pre><p id="6398" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å†æ¬¡è¿›è¡Œæµ‹è¯•ã€‚</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="acf5" class="mr lg in mn b gy ms mt l mu mv">rspec</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="ae2e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æœ‰ç”¨ï¼ğŸ¥³:è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œå®ƒå°†ä¸ºä½ çš„ API åº”ç”¨ç¨‹åºç¼–å†™æ–°çš„æµ‹è¯•æä¾›ä¸€ä¸ªèµ·ç‚¹ã€‚ç¥ä½ å¥½è¿ï¼</p></div></div>    
</body>
</html>