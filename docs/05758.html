<html>
<head>
<title>How to Monitor System Performance of a Spring Boot Message Driven Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何监控Spring Boot消息驱动服务的系统性能</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-monitor-system-performance-of-a-spring-boot-message-driven-service-48b9b91ab5ef?source=collection_archive---------0-----------------------#2021-10-22">https://blog.devgenius.io/how-to-monitor-system-performance-of-a-spring-boot-message-driven-service-48b9b91ab5ef?source=collection_archive---------0-----------------------#2021-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3899" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们来看一下有用的系统指标——吞吐量、消耗率、处理时间和处理结果</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/400bf6882d5a6146059be8375a05d185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyrgqwMjfclV2oN1U2VIA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">卢克·切瑟在<a class="ae kv" href="https://unsplash.com/s/photos/visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8a06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有适当监控的系统配置是失败的。</p><p id="a265" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管您的系统提供了很棒的功能，但是服务是不受控制的，因为您不知道系统的健康状况和性能。</p><p id="8b1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要能让您了解系统状态和性能的系统指标。通过简单地轮询服务的端点并监控响应时间，可以很容易地观察到使用RESTful APIs的服务。然而，消息驱动服务在后台运行，并以异步方式处理请求。如果没有RESTful API接口，服务基本上对你是不可见的，知道服务内部发生了什么是一个挑战。</p><p id="1a7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有一个保险索赔处理服务，它是一个消息驱动的服务，从消息队列接收索赔请求，并将审查结果输出到另一个队列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/b4baffdb00d60c51521df7da03624f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aE91lhzj3Crif-Wsyq589w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">保险索赔处理服务</figcaption></figure><p id="b8b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在的任务是监控服务的性能。一种简单的方法是在系统日志中记录流程时间，然后从日志文件中提取性能指标。很简单，不是吗？</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="3d83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管添加时间测量的代码是一项简单的任务，但是为从系统日志中提取数据构建脚本并使这个过程自动化将需要您付出努力。将代码添加到您想要跟踪性能的所有系统逻辑也将是一项单调乏味的任务。</p><p id="0cf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与依赖系统日志获取性能指标不同，Spring Boot的Actuator等成熟的库为您提供了一种无需编码即可自动获取系统指标的便捷方式。加上Prometheus和Grafana的现成服务器堆栈，系统指标可以显示在一个有意义的系统仪表板中。下面的Grafana仪表板示例显示了保险索赔处理服务的吞吐量和处理时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lv"><img src="../Images/646ed9ca2b48683ac3baf4f0607795d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9bxVLl9HN_LquLG0ZkkJQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">保险索赔处理Grafana仪表板</figcaption></figure><p id="1647" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，设置这样一个仪表板既简单又直接。它只涉及配置和简单的编码，如果你想捕获应用程序特定的统计数据的话。在本文中，我将向您展示如何使用micrometer和Prometheus和Grafana的流行服务器堆栈来实现Spring Boot消息驱动服务的系统监控。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="8f25" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">用于观察的服务器堆栈</h1><p id="0f5d" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">就系统监控而言，Prometheus和Grafana是出色的现成服务器堆栈。下面的高级组件图清楚地说明了系统指标的数据流。Prometheus定期通过REST endpoint从应用服务和RabbitMQ等公共组件中获取指标。然后，Grafana从Prometheus中提取指标，并作为仪表板展示的前端。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/d37f5ad35496d9385d2eb4f4501d8775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wjLVBri_CGEDSSItdq4gtw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">用于观察的服务器堆栈</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="033e" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">消息驱动服务的系统度量</h1><p id="5806" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">第一步是支持系统指标的生成。对于基于异步消息的服务，有3种方法可以获得系统信息:</p><ul class=""><li id="aa48" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">消息代理度量</li><li id="9209" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">Spring Boot预置指标</li><li id="7d13" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">自定义指标</li></ul><h2 id="bf38" class="np me iq bd mf nq nr dn mj ns nt dp mn lf nu nv mp lj nw nx mr ln ny nz mt oa bi translated">消息代理度量</h2><p id="1b44" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">对于具有消息驱动服务的系统架构，使用消息代理是一种常见的做法。它充当服务间消息传输的中心枢纽。因此，您可以找到已发布消息、已确认消息、处理速率等的计数器。比如RabbitMQ为普罗米修斯提供了一个插件。启用插件后，所有系统信息将通过两个端点公开:</p><ul class=""><li id="4345" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe ob oc od oe b">GET /metrics</code> —对于聚合指标</li><li id="5ef9" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ob oc od oe b">GET /metrics/per-object </code> —针对单个交换机和队列的指标</li></ul><p id="6589" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是端点响应示例的屏幕截图</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/73fa0febaf30875e2a7da22b6d7357f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*_RVBTms93TVMYTFtOHmy0g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">RabbitMQ聚合指标</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/8b771264936c92b45d33eb209086f965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wI4VFIRD_eHtRkqtSwz2Ng.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">每个对象的RabbitMQ指标</figcaption></figure><p id="729e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于来自RabbitMQ的指标数据，我们可以使用以下图表创建一个grafana仪表板示例:</p><ul class=""><li id="5cf7" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">消息速率—发布到队列的索赔请求和从队列中消耗的索赔</li><li id="bbe4" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">队列中待处理的索赔请求数</li><li id="2d32" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">发布到交易所的索赔请求的数量</li><li id="9581" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">已确认的索赔请求数</li></ul><p id="0fb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些图表让我们了解了系统的性能。让我们看一下第一个消息速率图表，您可以看到索赔处理服务每秒处理大约1个请求，但是每秒大约有10个传入请求。显然，随着队列中挂起请求数量的增加，该服务消耗消息的速度不够快。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/f82c3d7e5be800f61088c0e6c985d727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9ryBfzoMTreBKI94vZ_6g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana仪表板— RabbitMQ指标</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h2 id="44a2" class="np me iq bd mf nq nr dn mj ns nt dp mn lf nu nv mp lj nw nx mr ln ny nz mt oa bi translated">Spring Boot预置指标</h2><p id="6e03" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">接下来，Spring Boot的致动器支持普罗米修斯的度量列表，它通过HTTP端点公开信息。对于与消息队列相关的集成，Spring Boot提供了以下带有前缀<strong class="ky ir"> spring_integration_，</strong>的度量，它们是消息监听器和发送器的计数器和处理时间:</p><ul class=""><li id="03fd" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe ob oc od oe b">spring_integration_send_seconds_sum</code> —总处理时间</li><li id="3154" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ob oc od oe b">spring_integration_send_seconds_count</code> <strong class="ky ir"> </strong> —消息请求总数</li><li id="b59c" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ob oc od oe b">spring_integration_send_seconds_max</code> —最大处理时间</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/ed34fa123f306bfa96ad75fe41195ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdiHlcAMoTcnIGaLhBxIaA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Spring Boot执行器消息队列度量</figcaption></figure><p id="b999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要为prometheus启用metric endpoint，请对Maven pom.xml和application.yaml应用以下配置。</p><p id="50b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Maven pom.xml </strong></p><p id="6ee3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将Spring Boot执行器和测微计添加到maven pom.xml的依赖项中</p><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="59f2" class="np me iq oe b gy on oo l op oq"><strong class="oe ir"><em class="or">&lt;</em>dependency<em class="or">&gt;<br/>&lt;</em>groupId<em class="or">&gt;</em></strong>org.springframework.boot<strong class="oe ir"><em class="or">&lt;/</em>groupId<em class="or">&gt;<br/>&lt;</em>artifactId<em class="or">&gt;</em></strong>spring-boot-starter-actuator<strong class="oe ir"><em class="or">&lt;/</em>artifactId<em class="or">&gt;<br/>&lt;/</em>dependency<em class="or">&gt;</em></strong></span><span id="317b" class="np me iq oe b gy os oo l op oq"><strong class="oe ir"><em class="or">&lt;</em>dependency<em class="or">&gt;<br/>&lt;</em>groupId<em class="or">&gt;</em></strong>io.micrometer<strong class="oe ir"><em class="or">&lt;/</em>groupId<em class="or">&gt;<br/>&lt;</em>artifactId<em class="or">&gt;</em></strong>micrometer-registry-prometheus<strong class="oe ir"><em class="or">&lt;/</em>artifactId<em class="or">&gt;<br/>&lt;</em>scope<em class="or">&gt;</em></strong>runtime<strong class="oe ir"><em class="or">&lt;/</em>scope<em class="or">&gt;<br/>&lt;/</em>dependency<em class="or">&gt;</em></strong></span></pre><p id="c460" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Application.yaml </strong></p><p id="6f21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">配置Spring Boot为普罗米修斯公开端点</p><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="3295" class="np me iq oe b gy on oo l op oq"><strong class="oe ir">management</strong>:<br/>  <strong class="oe ir">endpoints</strong>:<br/>    <strong class="oe ir">web</strong>:<br/>      <strong class="oe ir">exposure</strong>:<br/>        <strong class="oe ir">include</strong>: prometheus</span></pre><p id="5014" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于性能指标，可以创建Grafana图表来显示索赔请求的处理率和平均处理时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/b2ccf1e9a9c43b79b940d74d265d0dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWleuI9z7Pv1pdCu-amRGQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana图表— Spring Boot致动器</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h2 id="aff9" class="np me iq bd mf nq nr dn mj ns nt dp mn lf nu nv mp lj nw nx mr ln ny nz mt oa bi translated">自定义指标</h2><p id="b7e1" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">如果需要特定于应用程序的信息，message broker和Spring Actuator提供的系统指标可能不适合业务需求。例如，业务运营可能有兴趣了解按状态划分的索赔审查结果的数量，这样他们就可以预测索赔案例跟进的工作量。</p><p id="2aaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我将向您展示如何创建一个计数器来跟踪索赔结果的数量(按状态——已批准、已拒绝和需要跟进)。我们将基于一个名为Micrometer的库来构建指标，该库支持不同类型的指标，如计数器、计时器和计量器。</p><p id="463f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的示例代码在类构造函数中注册了新的计数器名称。新的指标名称是“claim.result ”,带有标识索赔状态的标记“status”。在索赔审查过程结束时，我们根据审查结果的状态增加相应的计数器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="5a55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着新指标的注册，Spring Actuator将在执行器的端点中包含这些指标。示例响应数据显示了新添加的指标“<code class="fe ob oc od oe b">claim_result_total</code>”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/6f3d541f7d40a0fdf7462c791a6bd2bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9DYfQ17Ej-vhi55nfpqFIQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Spring Boot自定义指标</figcaption></figure><p id="07ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以基于计数器创建有趣的Grafana图表。它显示给定时间段内的索赔审查状态计数，一个饼图显示一段时间内结果状态的百分比和数量。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/daea9d35f75fe6a84b8106ffc401995d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ByERoVbPPhYBGq79orbbA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana图表—自定义指标</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="2e56" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">探索保险索赔处理服务的系统仪表板</h1><p id="1104" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">让我们设置服务器堆栈，并为保险索赔处理服务创建一个仪表板。查看这个GitHub库，docker compose定义提供了所有配置和组件。</p><div class="ow ox gp gr oy oz"><a href="https://github.com/gavinklfong/spring-test-container-demo" rel="noopener  ugc nofollow" target="_blank"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd ir gy z fp pe fr fs pf fu fw ip bi translated">GitHub-gavinklfong/spring-test-container-demo</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">这个存储库的目的是演示一个全自动集成测试的实现，使用…</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">github.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn kp oz"/></div></div></a></div><p id="1043" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您克隆了存储库，在终端控制台中将目录更改为<code class="fe ob oc od oe b">&lt;your local repository&gt;/docker-compose</code>,然后运行这个命令来启动整个服务器栈。</p><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="8e9b" class="np me iq oe b gy on oo l op oq">docker compose -p “insurance-claim-demo” up</span></pre><p id="0c70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保您的本地计算机上安装了docker引擎，并且以下端口可用:9090、5672、15672、15692和8080</p><h2 id="eb6f" class="np me iq bd mf nq nr dn mj ns nt dp mn lf nu nv mp lj nw nx mr ln ny nz mt oa bi translated">格拉夫纳</h2><p id="b75e" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">使用默认的登录id: admin和密码:admin进入Grafana门户网站<code class="fe ob oc od oe b"><a class="ae kv" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>。</p><p id="d77a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要将Prometheus配置为默认数据源。转到配置→数据源并创建一个新的数据源。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/6c712197fa809dd1d1552e3cee886b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*zV5zbpG_OVeTfE9RS16Yfw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —配置</figcaption></figure><p id="d83c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<code class="fe ob oc od oe b"><a class="ae kv" href="http://prometheus:9090" rel="noopener ugc nofollow" target="_blank">http://prometheus:9090</a></code>设置为数据源的Prometheus服务器的URL。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/39e0dfd04a6e270d0866c18bdeefdb10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojkV6U8n51Uf1OTs1FzAeg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana数据源</figcaption></figure><p id="ca37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，点击“上传JSON文件”并在<code class="fe ob oc od oe b">&lt;your local repository&gt;/docker-compose/Claim-Request-Processing-Dashboard.json</code>中选择仪表板文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/54d44d421f40ac69f6d35cdabd78d4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*GeaIKlaHnBuO0ng-s7WycA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Grafana —导入仪表板</figcaption></figure><p id="2d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，您将能够看到这个没有数据的仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/db0104470c633613b438803f7793cc72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bq42_PJoc6AaJ0tJDwzs4Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">保险索赔仪表板</figcaption></figure><p id="624b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要将示例索赔请求输入到系统中，运行此命令以在独立的容器中启动索赔请求生成器。</p><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="ed19" class="np me iq oe b gy on oo l op oq">docker run --rm -e REQ_PER_SEC=4 \<br/>-e SPRING_PROFILES_ACTIVE=docker \ <br/>--network=insurance-claim-demo_default \<br/>whalebig27/demo-insurance-claim-driver</span></pre><p id="65c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将在系统控制台中看到收到的索赔审查结果。数字将出现在Grafana仪表板中。然而，由于声明请求生成器每秒向消息队列提供4个声明请求，声明处理器每秒只能处理大约1个声明。因此，您将观察到，随着生成器运行一段时间，挂起的索赔请求的数量在增加。</p><p id="0600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过调整每秒请求数的参数“REQ_PER_SEC ”,您可以随意试验不同的吞吐量设置，并观察Grafana仪表板中的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/ed2f72a7c92cdb7916b0f5d6ad746f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjN_y2zcOTdrU-M8NADtLg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">保险索赔处理仪表板</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="09b3" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">最终想法</h1><p id="2429" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">系统度量是维护系统健康的关键信息，它不仅提供系统状态，还提供其他有用的信息，如处理时间和系统性能指数。从消息驱动的服务中收集系统指标很容易，因为默认情况下，Spring Boot执行器会自动生成一组全面的系统指标，并通过HTTP端点公开信息。</p><p id="9871" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当Prometheus和Grafana的服务器堆栈神奇地将系统指标转化为有意义和有影响力的仪表板时，探索指标是很有趣的。您探索得越多，就越能理解系统行为，并有助于系统调优和优化。</p></div></div>    
</body>
</html>