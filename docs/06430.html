<html>
<head>
<title>5% of 666 Python repos had comma typos (including Tensorflow, and PyTorch, Sentry, and V8)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">666 个 Python repos 中有 5%有逗号错别字(包括 Tensorflow、PyTorch、Sentry 和 V8)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/5-of-666-python-repos-had-comma-typos-including-tensorflow-and-pytorch-sentry-and-v8-7bc3ad9a1bb7?source=collection_archive---------1-----------------------#2022-01-07">https://blog.devgenius.io/5-of-666-python-repos-had-comma-typos-including-tensorflow-and-pytorch-sentry-and-v8-7bc3ad9a1bb7?source=collection_archive---------1-----------------------#2022-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/95b4111622a3efb9cef65ea500612251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjQg9Mh5jJ-Nf1o4oNyC-A.png"/></div></div></figure><p id="a271" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们发现，在我们检查的 666 个 Python 开源 GitHub 库中，有 5%存在以下三个由错别字引起的逗号相关的错误:</p><p id="4de2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">逗号太少</strong> <br/> <a class="ae kt" href="https://codereview.doctor/features/python/best-practice/avoid-missing-comma" rel="noopener ugc nofollow" target="_blank">列表/元组/集合</a>中的字符串意外遗漏逗号，导致不需要的字符串串联。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ku"><img src="../Images/dfb2fbfbaccf759893863d6505d57f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QbdqjfUyUVvv7H6H.png"/></div></div></figure><p id="03ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">由输入错误导致的隐式字符串连接会改变应用程序的行为。举个例子:</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="22f0" class="le lf in la b gy lg lh l li lj">def is_positive(word):<br/>    words = (<br/>        'yes',<br/>        'correct',<br/>        'affirmative'<br/>        'agreed',<br/>     )<br/> return word in words</span><span id="8853" class="le lf in la b gy lk lh l li lj">is_positive('agreed') is True # evaluates to False</span></pre><p id="a3d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">is_positive('agreed ')的计算结果为 False，因为打字错误导致肯定的结尾缺少逗号，从而导致“肯定”和“同意”隐式连接到“肯定同意”。</p><p id="dba6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://codereview.doctor/features/python/best-practice/tuple-missing-trailing-comma" rel="noopener ugc nofollow" target="_blank">意外遗漏了 1 个元素元组</a>中的逗号，使其成为一个 str 而不是元组。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ll"><img src="../Images/24942be7ef80c4b5dbae955d2f4f6011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DqQgd7OVmKOhsjPf.png"/></div></div></figure><p id="6618" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">由于缺少逗号，当代码稍后试图对评估为<code class="fe lm ln lo la b">str</code>的变量执行元组操作时，预计会得到一个<code class="fe lm ln lo la b">TypeError</code>。</p><p id="1264" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">逗号太多<br/> </strong>错别字<a class="ae kt" href="https://codereview.doctor/features/python/best-practice/tuple-accidental-trailing-comma" rel="noopener ugc nofollow" target="_blank">不小心在值</a>的末尾加了一个逗号，把它变成了一个元组</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/3af1616d529a9bbba632205b3d17f611.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/0*08pVjz-aJkKTETT8.png"/></div></figure><p id="f19b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就 Python 解析器而言，括号对于非空元组是可选的。根据文档:实际上是逗号组成了元组，而不是括号。括号是可选的，除了空元组的情况。</p><p id="0971" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">检测 bug</strong></p><p id="a3cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们没有一行一行地检查存储库。相反，我们通过我们在 AWS Lambda 上运行的<a class="ae kt" href="http://codereview.doctor" rel="noopener ugc nofollow" target="_blank">静态分析检查套件</a>来运行存储库，总共花费了 90 秒。</p><p id="8d89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">主要的困难是减少假阳性。从语法上来说，列表中缺少逗号和有意进行的隐式字符串连接没有区别。事实上，当我们第一次编写“可能缺少一个逗号”检查器时，我们发现 95%的问题实际上都是误报:开发人员进行跨多行的隐式字符串连接的原因非常简单:</p><ul class=""><li id="cfbf" class="lq lr in jx b jy jz kc kd kg ls kk lt ko lu ks lv lw lx ly bi translated">像 SQL 或 HTML 这样的代码</li><li id="e33e" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">用户代理字符串</li><li id="1a62" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">类似路径的值，如文件路径和 URL</li><li id="b165" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">编码文本，如 JSON 和 CSV 文件内容</li><li id="1930" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">非常长的消息</li><li id="de35" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">Sha 哈希</li></ul><p id="5249" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在检查了 666 个代码库之后，我们理解了误报的关键驱动因素，并为这些类型的数据增加了隐式字符串连接的余量。在我们考虑了这些进行隐式字符串连接的有效原因后，假阳性率下降到可以忽略的非恼人水平。在这一点上，我们留下了一个 24 个存储库的列表，这些存储库在代码审查过程中出现了真正的错误。</p><p id="70c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有多普遍？</p><p id="43ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">总的来说，我们在 666 个存储库中的 24 个中检测到了这些错误——其中许多是大型开源项目。我们提出了这些问题，并在一天繁忙的票证和 pr 管理过程中帮助解决了这些问题。以下是最有趣的几个:</p><ul class=""><li id="e91f" class="lq lr in jx b jy jz kc kd kg ls kk lt ko lu ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/tensorflow/tensorflow/issues/53636" rel="noopener ugc nofollow" target="_blank">张量流</a></li><li id="17bd" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/getsentry/sentry/issues/30911" rel="noopener ugc nofollow" target="_blank">哨兵</a></li><li id="f082" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/tensorflow/tensorflow/issues/53636" rel="noopener ugc nofollow" target="_blank">张量流</a></li><li id="ac98" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/pydata/xarray/issues/6136" rel="noopener ugc nofollow" target="_blank"> Pydata 的 xarray </a></li><li id="2188" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://bugs.chromium.org/p/v8/issues/detail?id=12521" rel="noopener ugc nofollow" target="_blank">谷歌的 V8 </a></li><li id="0a8a" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/pytorch/pytorch/issues/70609" rel="noopener ugc nofollow" target="_blank"> PyTorch </a></li><li id="4e1c" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/pytorch/pytorch/issues/70607" rel="noopener ugc nofollow" target="_blank">再次 py torch</a></li><li id="c36a" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/pytorch/pytorch/issues/70611" rel="noopener ugc nofollow" target="_blank"> Pytorch 第三部</a></li><li id="5eee" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/rapidpro/rapidpro/issues/1599" rel="noopener ugc nofollow" target="_blank"> rapidpro </a></li><li id="87d0" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated">姜戈-colorfield </li><li id="e83b" class="lq lr in jx b jy lz kc ma kg mb kk mc ko md ks lv lw lx ly bi translated"><a class="ae kt" href="https://github.com/django-helpdesk/django-helpdesk/issues/988" rel="noopener ugc nofollow" target="_blank">django-服务台</a></li></ul><p id="ae89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">5%的存储库有这三个错误中的一个，并且它们中的大多数是“大的”众所周知的和被广泛使用的项目，有许多贡献者和非常健壮的代码审查过程。这突出表明，对于像代码审查这样的手动过程来说，要在 100%的时间内检测到 100%的 bug，那么在代码审查期间，100%的人必须在 100%的时间内执行得 100%完美。看到认知失调了吗？我们进行代码评审是因为我们在编写代码时预期会出现人为错误，但是在评审代码时预期不会出现人为错误。有些事情人类可以做得很好，有些事情机器人可以做得更好。注意到逗号在错误的地方是其中之一。例如:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/3da22b3a7801922509bfe2aa39f3d8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xYQgo5ImLohOIkmh.png"/></div></div></figure><p id="29b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你能看出问题吗？<a class="ae kt" href="https://github.com/rapidpro/rapidpro/issues/1599" rel="noopener ugc nofollow" target="_blank">第 572 行</a>有隐式字符串串联！</p><p id="f6f2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它少了一个逗号，所以应该是</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="1df3" class="le lf in la b gy lg lh l li lj">'”()&lt;&gt;[]:,;@\\”!#$%&amp;\’-/=?^_{}| ~.a”<a class="ae kt" href="http://twitter.com/example" rel="noopener ugc nofollow" target="_blank">@example</a>.org', '“ “<a class="ae kt" href="http://twitter.com/example" rel="noopener ugc nofollow" target="_blank">@example</a>.org',</span></pre><p id="83c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我一点也不惊讶被人类错过了！</p><p id="15b3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">影响</strong> <br/>有些缺失的逗号影响很小甚至没有影响，但有些却非常有影响。以<a class="ae kt" href="https://github.com/getsentry/sentry/issues/30911" rel="noopener ugc nofollow" target="_blank">哨兵</a>一号为例:</p><p id="9f6c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意列表中缺少的逗号:</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/80be0346a5438a245a895a8fc8b481e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1w4E8jyUdmHne_7p.png"/></div></div></figure><p id="b313" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">“releases”和“discover”之间缺少一个逗号，导致两者隐式连接在一起形成“releasesdiscover”。</p><p id="4b79" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">影响是测试请求了不存在的“/releasesdiscover”，因此测试的不是“/releases”和“/discover”，而是 404 页面。就我们所知，这意味着/releases 和/discover 上的组织切换器可能会被破坏。有一些可怜的虔诚的人维持着依赖于这个测试的组织转换，并把它作为一个质量关口，给他们信心，他们没有破坏产品，但测试并没有真正起作用。就是这种事能害一晚上的睡眠！*让你陷入麻烦的不是你不知道的事。你确定的事情并不是这样的。*</p><p id="cb9f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">保护您的代码库</strong></p><p id="77cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在 GitHub 中添加<a class="ae kt" href="https://github.com/marketplace/django-doctor" rel="noopener ugc nofollow" target="_blank">代码审查医生</a>，这样就可以在你的 PR 中建议对这些问题的修复。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/a331d0fb5aa83dfdf537f9659d8c9f6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uohBGYCBIn22uqyN.png"/></div></div></figure></div></div>    
</body>
</html>