<html>
<head>
<title>Stop using DateTime in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止在 PHP 中使用日期时间</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/stop-using-datetime-in-php-66df3d731875?source=collection_archive---------0-----------------------#2022-11-05">https://blog.devgenius.io/stop-using-datetime-in-php-66df3d731875?source=collection_archive---------0-----------------------#2022-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5205" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">PHP 中为什么需要使用不可变的 DateTime？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/46ddf5208a74a2e46a4b851f5a588fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3bSrTQcRFsvKdIZb"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Julia Taubitz 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8b69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 PHP 中，我们通常在大多数日期操作中使用 DateTime 函数。PHP 日期时间是可变的日期。可变日期可能是混乱的来源，它们会在您的代码中产生意想不到的错误。在这篇博客中，我们讨论可变日期问题和可能的解决方案。</p><h2 id="164b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">日期时间问题</h2><p id="e8a5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在下面的例子中，我们将使用 DateTime 对象显示今天和明天的日期。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="12b7" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTime();<br/>  $tomorrow_date = $today_date-&gt;modify('+1 day');<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d');<br/>  echo "&lt;br&gt;";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre><p id="395c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你执行上面的代码，你将会得到今天和明天相同的日期。因为<code class="fe na nb nc mr b">modify</code>返回 DateTime 的更新实例。由于可变性，它会将$today_date 对象更改为$tomorrow_date。所以 echo 语句返回相同的日期。</p><div class="nd ne gp gr nf ng"><a href="https://balajidharma.medium.com/the-syntax-highlighting-highlight-js-is-now-available-on-medium-58f672595691" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">用语法荧光笔尝试代码块的中等新功能</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">介质上的语法高亮显示</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">balajidharma.medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div><p id="2f5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可能是日期时间上的<code class="fe na nb nc mr b">modify</code>函数的问题。让我们试试其他日期时间函数。下一个例子我们尝试<code class="fe na nb nc mr b">DateTime-&gt;add()</code>方法。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="8e4d" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTime();<br/>  $tomorrow_date = $today_date-&gt;add(new DateInterval('P1D'));<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d')."\n";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre><p id="594a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的示例也返回相同的日期。因此，如果使用可变的 DateTime，您将获得相同的实例。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt ng"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-find-the-number-of-days-between-two-dates-in-php-1404748b1e84"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">如何在 PHP 中找到两个日期之间的天数</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">获取两个日期之间的天数</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">blog.devgenius.io</p></div></div><div class="np l"><div class="oc l nr ns nt np nu kp ng"/></div></div></a></div></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h2 id="2277" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">如何解决这个问题</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b3444ece3d6eb0be858642c67e156256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dGIz08WF_xLPc50S"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">詹姆斯·柯文在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6316" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个简单的修复方法是将$today_date echo 语句移到<code class="fe na nb nc mr b">modify()</code>、<code class="fe na nb nc mr b">add()</code>方法之前。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="6d09" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTime();<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d');<br/> <br/>  $tomorrow_date = $today_date-&gt;modify('+1 day')."\n";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre><p id="38ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们始终不能使用上面的修复方法。因为有时我们需要给视图赋值。这两个时间将具有相同的日期。</p><h2 id="14dc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">PHP 对象克隆</h2><p id="222c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们可以通过使用 PHP <a class="ae kv" href="https://www.php.net/manual/en/language.oop5.cloning.php" rel="noopener ugc nofollow" target="_blank">对象克隆</a>解决这个问题。现在尝试使用 clone 关键字来克隆 DateTime 对象。然后修改或添加您的更改。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="9cac" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTime();<br/>  $tomorrow_date = (clone $today_date)-&gt;modify('+1 day');<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d')."\n";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre><p id="f4b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对象克隆会使您的代码更加复杂，并引入不必要的噪声。也很难一直呼叫克隆人。这个问题不仅仅针对<code class="fe na nb nc mr b">modify()</code>和<code class="fe na nb nc mr b">add()</code>功能。您将在下面的<code class="fe na nb nc mr b">DateTime</code>函数中面临同样的问题。</p><ul class=""><li id="cfee" class="oe of iq ky b kz la lc ld lf og lj oh ln oi lr oj ok ol om bi translated"><code class="fe na nb nc mr b">sub</code></li><li id="18ad" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">setDate</code></li><li id="d233" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">setISODate</code></li><li id="cf5f" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">setTime</code></li><li id="df7c" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">setTimezone</code></li><li id="d5f1" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">modify</code></li><li id="9075" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><code class="fe na nb nc mr b">add</code></li></ul></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h2 id="ec11" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">日期时间不可变</strong></h2><p id="fec8" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><code class="fe na nb nc mr b">DateTimeImmutable</code>类的行为与<a class="ae kv" href="https://www.php.net/manual/en/class.datetime.php" rel="noopener ugc nofollow" target="_blank"> DateTime </a>相同，只是在调用<a class="ae kv" href="https://www.php.net/manual/en/datetime.modify.php" rel="noopener ugc nofollow" target="_blank"> DateTime::modify() </a>等修改方法时会返回新的对象。PHP 5.5 引入了 DateTimeImmutable 类。</p><blockquote class="os ot ou"><p id="7a4a" class="kw kx ov ky b kz la jr lb lc ld ju le ow lg lh li ox lk ll lm oy lo lp lq lr ij bi translated">每次修改对象时，不可变对象都会创建对象的副本</p></blockquote><p id="9ed6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DateTime 和 DateTimeImmutable 从<code class="fe na nb nc mr b"><a class="ae kv" href="https://www.php.net/manual/en/class.datetimeinterface.php" rel="noopener ugc nofollow" target="_blank">DateTimeInterface</a></code>接口实现。</p><p id="fcfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试试<code class="fe na nb nc mr b">DateTimeImmutable</code>我们的例子。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="f8be" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTimeImmutable();<br/>  $tomorrow_date = $today_date-&gt;modify('+1 day');<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d')."\n";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre><p id="eff2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码将打印正确的今天和明天的日期。代替克隆，这个 DateTimeImmutable 实例是我们问题的简单而完美的解决方案。</p><p id="b528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">add()函数的另一个例子</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="90de" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $today_date = new DateTimeImmutable();<br/>  $tomorrow_date = $today_date-&gt;add(new DateInterval('P1D'));<br/>  echo "Today: " . $today_date-&gt;format('Y-m-d')."\n";<br/>  echo "Tomorrow: " . $tomorrow_date-&gt;format('Y-m-d');<br/>?&gt;</span></pre></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h2 id="d24a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">日期时间库</h2><p id="c957" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">PHP <a class="ae kv" href="https://carbon.nesbot.com/" rel="noopener ugc nofollow" target="_blank"> Carbon </a>是最好的日期时间库之一。碳也提供了<code class="fe na nb nc mr b">CarbonImmutable</code>物体。所以如果你使用 carbon 库，就使用不可变对象。</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="a216" class="mv lt iq mr b be mw mx l my mz">&lt;?php<br/>  $mutable = Carbon::now();<br/>  $modifiedMutable = $mutable-&gt;add(1, 'day');<br/><br/>  echo $mutable-&gt;isoFormat('Y-M-D')."\n";<br/>  echo $modifiedMutable-&gt;isoFormat('Y m D')."\n";<br/><br/>  $immutable = CarbonImmutable::now();<br/>  $modifiedImmutable = CarbonImmutable::now()-&gt;add(1, 'day');<br/><br/>  echo $immutable-&gt;isoFormat('Y-M-D')."\n";<br/>  echo $modifiedImmutable-&gt;isoFormat('Y m D')."\n";<br/>?&gt;</span></pre><h2 id="5da6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">结论</h2><p id="8637" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">因此，考虑使用不可变的日期时间对象来避免可变日期时间的某些类型的错误。如果任何特定需求使用可变对象，否则使用<code class="fe na nb nc mr b">DateTimeImmutable</code></p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="78e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p><p id="bfc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">敬请关注更多内容！</p><p id="3d6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ov">跟我来</em><a class="ae kv" href="https://balajidharma.medium.com/" rel="noopener">【balajidharma.medium.com】<em class="ov"/></a>。</p></div></div>    
</body>
</html>