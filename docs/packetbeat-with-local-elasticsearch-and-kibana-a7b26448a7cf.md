# å¸¦æœ‰æœ¬åœ°å¼¹æ€§æœç´¢å’Œ Kibana çš„æ‰“åŒ…å¥—é¤

> åŸæ–‡ï¼š<https://blog.devgenius.io/packetbeat-with-local-elasticsearch-and-kibana-a7b26448a7cf?source=collection_archive---------8----------------------->

![](img/d3a0d553eda348da69287aa270b2fa06.png)

[é˜¿ä¸½å¨œÂ·æ ¼é²å¸ƒå°¼äºš](https://unsplash.com/@alinnnaaaa?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/network?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

ä»€ä¹ˆæ˜¯å¥½äººï¼Ÿæ¬¢è¿å›æ¥ğŸ˜ã€‚ä»Šå¤©æˆ‘ä»¬é€šè¿‡ä»‹ç»å¼¹æ€§æ‹å­æ¥ç»§ç»­æˆ‘ä»¬çš„å‘ç°ã€‚

**Packetbeat** æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç½‘ç»œæ•°æ®å‘é€å™¨ï¼Œå¯ä»¥ä¸ Elasticsearch ç»“åˆä½¿ç”¨ï¼Œæä¾›ä¸€ä¸ªç›‘æ§å’Œåˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½çš„ç³»ç»Ÿã€‚å®ƒæ”¶é›†åº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œæµé‡ï¼Œè§£ç åº”ç”¨å±‚ä½¿ç”¨çš„åè®®(å¦‚ *HTTP* ã€ *MySQL* ã€ *Redis* ç­‰)ï¼ŒåŒ¹é…è¯·æ±‚å’Œå“åº”ï¼Œå¹¶è®°å½•æ¯ä¸ªäº‹åŠ¡çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œ"*å®ƒå¯ä»¥è¿è¡Œåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨åº”ç”¨ç¨‹åºæ‰€åœ¨çš„æœåŠ¡å™¨ä¸Š"*ã€‚ç›®å‰ï¼Œè¿™äº›åè®®ç”± Packetbeat æ”¯æŒ:

*   åŸŸåæœåŠ¡å™¨(Domain Name Server)
*   è¶…æ–‡æœ¬ä¼ é€åè®®
*   ä¸€ç§æ•°æ®åº“ç³»ç»Ÿ
*   å¡æ¡‘å¾·æ‹‰
*   MongoDB
*   èŠ‚ä¿­-RPC
*   AMQP
*   å¦å…‹æ¿€å…‰ç„å‡†é•œï¼ˆTank Laser-Sight çš„ç¼©å†™ï¼‰
*   Memcache
*   å…³ç³»å‹æ•°æ®åº“
*   ICMP (v4 å’Œ v6)
*   é›·è¿ªæ–¯
*   DHCP (v4)
*   é«˜çº§ç£å¯Ÿ/ç¤¾ä¼šå‘å±•è®¡åˆ’(æµ‹è¯•ç‰ˆ)
*   ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ

ç”±äº Packetbeat ä½¿æ‚¨èƒ½å¤Ÿç›‘è§†æœºå™¨çš„ç½‘ç»œè¿æ¥ï¼Œå› æ­¤äº†è§£æ›´å¤šæœ‰å…³æºå’Œç›®æ ‡ IP åœ°å€ä»¥åŠå‘é€å’Œæ¥æ”¶çš„æ•°æ®å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚

åœ¨å®‰è£… Packetbeat ä¹‹å‰ï¼Œç¡®ä¿æ‚¨æœ‰ Elasticsearch å’Œ Kibana çš„æœ¬åœ°éƒ¨ç½²ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œæˆ‘æ¨èé˜…è¯»[è¿™ç¯‡æ–‡ç« ](https://medium.com/@mhdabdel151/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e)ä½ ä¼šå‘ç°æ•´ä¸ªè¿‡ç¨‹ã€‚

## å®‰è£…å’Œé…ç½®

è‡³äºæœ¬ç³»åˆ—ä¸­å·²ç»æ¶‰åŠçš„å…¶ä»– beatsï¼Œä½ å¿…é¡»é¦–å…ˆè¿›å…¥[å®˜æ–¹ä¸‹è½½é¡µé¢](https://www.elastic.co/downloads/beats/packetbeat)æ‰èƒ½è·å¾—ä¸ä½ çš„æ“ä½œç³»ç»Ÿå…¼å®¹çš„æœ€æ–°ç‰ˆæœ¬ã€‚ä¸‹è½½å®Œå­˜æ¡£æ–‡ä»¶åï¼Œæå–å…¶å†…å®¹å¹¶æ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶å¤¹ã€‚æ‚¨å°†æ‰¾åˆ°`packetbeat.yml`æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­è¿›è¡Œä¸€äº›é…ç½®ã€‚

æ³¨æ„:æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿï¼Œä½ å¯èƒ½éœ€è¦å®‰è£…`libpcap`æ•°æ®åŒ…æ•è·åº“ã€‚æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒå®˜æ–¹æ–‡ä»¶çš„[è¿™ä¸€èŠ‚](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-installation-configuration.html#_before_you_begin)ã€‚å› ä¸ºæœ¬æ•™ç¨‹æ˜¯åœ¨ Windows ç³»ç»Ÿä¸Šå®Œæˆçš„ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥æ˜¯ä¸å¿…è¦çš„ã€‚

ä»¥ä¸ä¹‹å‰ç›¸åŒçš„æ–¹å¼:åœ¨è¾“å‡ºéƒ¨åˆ†å¡«å†™æ‚¨çš„ Elasticsearch çš„ URLã€æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç (*å¦‚æœæ‚¨çš„éƒ¨ç½²æ˜¯å®‰å…¨çš„*)ï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„:

```
output.elasticsearch:   
  hosts: ["http://localhost:9200"]   
  username: "elastic"   
  password: "*TYPE_HERE*"  
  *# If using Elasticsearch's default certificate* ssl:
      enabled: true
      ca_trusted_fingerprint:  "your_fingerprint"
```

*æŒ‡çº¹*æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ Elasticsearch æ—¶ç”Ÿæˆçš„ CA è¯ä¹¦çš„åå…­è¿›åˆ¶ç¼–ç  SHA-256ã€‚å¦‚æœæ‚¨ä¸¢å¤±äº†å®ƒï¼Œä¸è¦æƒŠæ…Œï¼Œæ‚¨æ€»æ˜¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¾å›å®ƒ:

```
openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt
```

è¯¥å‘½ä»¤æ— æ³•åœ¨ Windows ç»ˆç«¯ä¸Šè¿è¡Œï¼Œæ‚¨éœ€è¦ä¸‹è½½å¹¶å®‰è£… [Git](https://git-scm.com/download/win) ï¼Œæ‰“å¼€ *Git CMD* å¹¶ä» Elasticsearch æ ¹æ–‡ä»¶å¤¹è¿è¡Œè¯¥å‘½ä»¤ã€‚

è¦æ·»åŠ æˆ–ä¿®æ”¹è¦ç›‘æ§çš„åè®®ï¼Œè¯·è½¬åˆ°`packetbeat.protocols` éƒ¨åˆ†ï¼Œè¾“å…¥è¦ç›‘æ§çš„åè®®ç±»å‹å’Œç›¸å…³ç«¯å£ï¼Œæˆ–è€…é¦–æ¬¡ä½¿ç”¨é»˜è®¤é…ç½®ã€‚

Packetbeat è¿˜é™„å¸¦äº†ä¸€ç»„å®ç”¨ç¨‹åºæ¥æ£€æŸ¥é…ç½®æˆ–è¿æ¥æ˜¯å¦åˆ°ä½ã€‚ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå¹¶ä»æ ¹æ–‡ä»¶å¤¹ä¸­ä¾æ¬¡è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
./packetbeat test config
./packetbeat test output
```

æ­¤å¤–ï¼Œè¦è®¾ç½®**èµ„äº§**æ¥è§£æã€ç´¢å¼•å’Œå¯è§†åŒ–æ‚¨çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
./packetbeat setup
```

è¦å¯åŠ¨ Packetbeatï¼Œåªéœ€è¿è¡Œ:

```
./packetbeat -e
```

åœ¨ Kibana ä¸­ï¼Œæ‚¨ç°åœ¨å¯ä»¥é€šè¿‡è¿‡æ»¤`packetbeat-*`æ¥æŸ¥çœ‹åœ¨ **Discover** ä¸­ä¸Šä¼ çš„ç½‘ç»œæ—¥å¿—ã€‚

![](img/ad302f680e2d12c458afbccdbecca8a2.png)

æ‚¨è¿˜å¯ä»¥åœ¨**ä»ªè¡¨æ¿**éƒ¨åˆ†æ‰¾åˆ°ä»ªè¡¨æ¿ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ http ä»ªè¡¨æ¿ï¼Œå®ƒç»™å‡ºäº†æ‰€æœ‰å¸¦æœ‰çŠ¶æ€ä»£ç çš„äº‹åŠ¡ã€‚

![](img/5921613e4ad999a8592e5b87e5011701.png)

ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œè¯·éšæ„æŸ¥çœ‹å…³äºè¿™ä¸ªä¸»é¢˜çš„[å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-installation-configuration.html#packetbeat-installation-configuration)äº†è§£æ›´å¤šç»†èŠ‚ã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œå¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»»ä½•é—®é¢˜æˆ–è¯„è®ºï¼Œè¯·åœ¨ä¸‹é¢ç•™ä¸‹æ‚¨çš„è¯„è®ºã€‚

æˆ‘ä»¬ä¸‹æ¬¡å†è§ï¼Œçœ‹æ›´å¤šçš„å¸–å­ğŸš€ã€‚

é˜¿åœæœå°”-å·´å‰