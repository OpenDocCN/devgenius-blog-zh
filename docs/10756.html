<html>
<head>
<title>Writing Django Views</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写 Django 视图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/writing-django-views-8835ff4c7166?source=collection_archive---------5-----------------------#2022-11-27">https://blog.devgenius.io/writing-django-views-8835ff4c7166?source=collection_archive---------5-----------------------#2022-11-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2751" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Django 观点解释</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/25f89596b2789c0f075d4a27bddfd54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HFaJtRtSTy-JNnTUsn4Hhg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">保罗·斯科鲁普斯卡斯在<a class="ae ks" href="https://unsplash.com/s/photos/view?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="56dd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Django 使用 MVT(模型-视图-模板)设计模式。视图部分可以定义为一个函数或一个类。它的工作只是接收 web 请求并返回 web 响应。</p><p id="2a96" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以在这里找到演示的示例代码<a class="ae ks" href="https://github.com/okanyenigun/django-view-example" rel="noopener ugc nofollow" target="_blank">。我们只有一个名为<em class="lp"> home </em>的应用程序。它有一个模型；<em class="lp">玩家</em>。</a></p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="8f20" class="lv lw in lr b be lx ly l lz ma">#models.py<br/><br/>from django.db import models<br/><br/>class Player(models.Model):<br/><br/>    first_name = models.CharField(max_length=100)<br/>    last_name = models.CharField(max_length=100)<br/>    nationality = models.CharField(max_length=100)<br/>    age = models.IntegerField()<br/><br/>    def __str__(self):<br/>        return self.last_name</span></pre><pre class="mb lq lr ls bn lt lu bi"><span id="8a1f" class="lv lw in lr b be lx ly l lz ma">#forms.py<br/><br/>from django.forms import ModelForm<br/>from home.models import Player<br/><br/>class PlayerForm(ModelForm):<br/>    class Meta:<br/>        model = Player<br/>        fields = '__all__'</span></pre><p id="ea96" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们的页面上有一个表单和一个显示数据的表格。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mc"><img src="../Images/89858427f4485a4e5c1940c8c5a7e957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TztIp8TRH1xqsb90U3j-GA.png"/></div></div></figure><h1 id="c58f" class="md lw in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">基于功能的视图</h1><p id="22bd" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">首先，我们在<em class="lp"> urls.py </em>中创建 URL。<em class="lp">首页</em>是查看功能。它接受请求。操作完成后，它发送请求和要发送的数据，并呈现页面。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="84ec" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>from django.contrib import admin<br/>from django.urls import path<br/>import home.views as hv<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', hv.home, name='home'),<br/>]</span></pre><pre class="mb lq lr ls bn lt lu bi"><span id="e3ab" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>from django.shortcuts import render<br/>from home.forms import PlayerForm<br/>from home.models import Player<br/><br/>def home(request):<br/>    form = PlayerForm()<br/>    players = Player.objects.all()<br/>    if request.method == "POST":<br/>        form = PlayerForm(request.POST)<br/>        if form.is_valid():<br/>            form.save()<br/>    return render(request, './templates/home.html', <br/>                  {'form':form, 'players':players})</span></pre><p id="bc5c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这里，我们首先创建一个表单，然后获取模型记录。<em class="lp"> home </em>函数可以包含任何类型的请求。如果传入的请求是 POST 类型，我们在条件语句中处理它。例如，在我们的例子中，表单来自 POST 请求。我们在<em class="lp"> post </em>条件下处理它。</p><p id="9fb5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基于函数的视图还是基于类的视图？两者都可以完成相同的任务。</p><p id="e624" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基于函数的视图更直接。你把所有东西都放进一个函数里。基于类的有抽象性。因此，你需要先了解这些结构。</p><p id="374d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通用的基于类的视图有模板。超越这一点可能会很困难。基于功能的视图可能更容易定制。</p><p id="107e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然而，争论哪个更好是没有意义的。这取决于任务或项目，可能会根据个人喜好而有所不同。最好两者都懂，需要什么都能用。</p><h1 id="c94d" class="md lw in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">基于类的视图</h1><p id="2fbf" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">我这边在讨论(？)以上是赞成基于类的视图，我发现这样更模块化。基于类的视图通过继承促进代码重用。唯一能想到的缺点就是由于抽象而无法完全掌握的感觉。但是一旦你学会了，这个问题就消失了(这就是我们在这里的原因)。</p><p id="d2b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在基于类的视图中，为每个 HTTP 请求类型定义了一个单独的方法。如果我们用类类型视图重复上面的例子:</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="981a" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    # path('', hv.home, name='home'),<br/>    path('', hv.HomeView.as_view(), name='home'),<br/>]</span></pre><p id="0a16" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在 URL 中，我们将<em class="lp"> as_view </em>方法用于基于类的视图。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="43f9" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>from django.views import View<br/><br/>class HomeView(View):<br/><br/>    def get(self, request):<br/>        form = PlayerForm()<br/>        players = Player.objects.all()<br/>        return render(request, './templates/home.html', {'form':form, 'players':players})<br/>    <br/>    def post(self, request):<br/>        form = PlayerForm(request.POST)<br/>        if form.is_valid():<br/>            form.save()<br/>        return redirect('home')</span></pre><p id="96b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将上述操作分为<em class="lp">获取</em>和<em class="lp">发布</em>。更加模块化的结构。</p><p id="7f80" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Django 有几个内置的通用视图类。</p><h2 id="65a3" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">模板视图</h2><p id="0972" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">我们可以使用<em class="lp"> TemplateView 的</em>来显示静态页面，或者只使用 GET 方法的页面(例如，“关于我们”页面)。我们不打算在此页面上有任何用户交互。</p><p id="8344" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> HTML: </strong>只是一个空的、静态的“关于”页面</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="30c7" class="lv lw in lr b be lx ly l lz ma">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;About&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div&gt;About me&lt;/div&gt;<br/>    &lt;div&gt;{{header}}&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt; </span></pre><p id="205a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以通过两种方式设置<em class="lp">模板视图</em>。首先，我们可以在<em class="lp">URL . py</em>中定义它:</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="ca51" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>from django.contrib import admin<br/>from django.urls import path<br/>from django.views.generic import TemplateView<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('about/', TemplateView.as_view(template_name='about.html',<br/>                                        extra_context={'header': 'Something'}))<br/>]</span></pre><p id="b6e2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在 URL 路由部分直接定义了<em class="lp">模板视图</em>。在<em class="lp"> as_view </em>方法中，我传递了 HTML 文件名和参数。</p><p id="7605" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一种方法是通过继承<em class="lp">模板视图</em>来定义视图对象。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="296a" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>from django.views.generic.base import TemplateView<br/><br/>class AboutView(TemplateView):<br/><br/>    template_name = "about.html"<br/><br/>    def get_context_data(self, **kwargs):<br/>        context = super().get_context_data(**kwargs)<br/>        context["header"] = "Something"<br/>        return context</span></pre><p id="4bdc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> TemplateView </em>类继承了三个内置的 Django 类:<em class="lp"> TemplateResponseMixin、ContextMixin、</em>和<em class="lp"> View </em>。因此，我们可以使用这些父类的方法。我们可以通过<em class="lp"> get_context_data </em>方法进行数据传输。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="b1ea" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>from django.contrib import admin<br/>from django.urls import path<br/>from django.views.generic import TemplateView<br/>import home.views as hv<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('about/', hv.AboutView.as_view()),<br/>]</span></pre><h2 id="04dd" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">重定向视图</h2><p id="1a3b" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">顾名思义，它用于重定向目的。</p><p id="291d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在继续之前，我们首先从项目自己的<em class="lp">URL . py</em>文件中获取 URL 定义，并使其具有应用特定性。为此，让我们在家庭应用程序中创建一个新的<em class="lp">URL . py</em>文件。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="e394" class="lv lw in lr b be lx ly l lz ma">#home/urls.py<br/><br/>from django.contrib import admin<br/>from django.urls import path<br/>from django.views.generic import TemplateView, RedirectView<br/>import home.views as hv<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', hv.HomeView.as_view(), name='home'),<br/>    path("redirect/",RedirectView.as_view(url='https://www.google.com/?client=safari'), <br/>                                          name='redirect-to-google')<br/>]</span></pre><p id="0fbc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我在<em class="lp"> urlpatterns </em>中定义了一个<em class="lp">重定向视图</em>，并向其发送了一个 URL 地址。我还给了它一个名字，这样我们就可以叫它的名字了。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="54a4" class="lv lw in lr b be lx ly l lz ma">#urls.py (in the project)<br/><br/>from django.contrib import admin<br/>from django.urls import path, include<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('',include(('home.urls', 'home'), namespace='home'))<br/>]</span></pre><p id="5810" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">HTML:我在主页的底部放置了一个<em class="lp">和一个</em>标签。我们使用<em class="lp">首页</em>命名空间来到达<em class="lp">重定向到谷歌。</em></p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="26b1" class="lv lw in lr b be lx ly l lz ma">&lt;a href="{% url 'home:redirect-to-google' %}"&gt; Go To Google&lt;/a&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/3465d1209e952804a44f2bd77a34b93e.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*sapWxRwe1e5Ya_BsyLrkYw.png"/></div></figure><p id="ea9e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们点击这个链接时，它会进入谷歌。</p><p id="6baa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">或者，我们可以创建一个继承<em class="lp"> RedirectView </em>的视图类。这使我们能够确定重定向操作期间将发生的情况。</p><p id="bee9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，让我们创建<em class="lp">predirectview</em>类，它继承了<em class="lp">reddirectview</em>类。我们通过声明父<em class="lp"> RedirectView </em>类的<em class="lp"> pattern_name </em>变量来定义要去哪里。它将重定向至<em class="lp">关于</em>命名空间。</p><p id="fa8e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在重定向之前，该类将运行<em class="lp"> get_redirect_url </em>方法。因此，我们可以在重定向之前自定义行为。例如，我们可以记录一些东西，或者向数据库发送一些数据，等等。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="8e53" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>class PreRedirectView(RedirectView):<br/><br/>    pattern_name = 'home:about'<br/><br/>    def get_redirect_url(self, *args, **kwargs):<br/>        print("Customize here")<br/>        return super().get_redirect_url(*args, **kwargs)</span></pre><p id="1804" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们相应地更新 urls.py。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="3ec5" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>from django.contrib import admin<br/>from django.urls import path<br/>from django.views.generic import TemplateView, RedirectView<br/>import home.views as hv<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('about/', hv.AboutView.as_view(),name='about'),<br/>    path('redirect/', hv.PreRedirectView.as_view(), name='redirect'),<br/>    path('', hv.HomeView.as_view(), name='home'),<br/>    <br/>]</span></pre><p id="8489" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> HTML </strong></p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="d74a" class="lv lw in lr b be lx ly l lz ma">&lt;a href="{% url 'home:redirect' %}"&gt; Go To About&lt;/a&gt;</span></pre><p id="0f1f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们点击链接时，它会在重定向之前运行<em class="lp">prerectorview</em>类中的<em class="lp"> get_redirect_url </em>方法。因此，在重定向之前，您会看到它将打印“在此处自定义”。</p><h2 id="55c2" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">DetailView</h2><p id="342e" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">我们使用<em class="lp"> DetailView 的</em>来呈现单个实例的细节。例如，您在一个页面上有一个对象列表，用户单击其中一个对象，它会将您带到该单独的页面。</p><p id="dc4e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它必须在对象的主键或 slug 上调用。通常，此视图不用于包含表单的页面。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="d578" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('about/', hv.AboutView.as_view(),name='about'),<br/>    path('redirect/', hv.PreRedirectView.as_view(), name='redirect'),<br/>    path('', hv.HomeView.as_view(), name='home'),<br/><br/>    path('&lt;int:pk&gt;/',hv.PlayerDetailView.as_view(), name='detail'),<br/> <br/>]</span></pre><p id="31ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个例子中，我使用了主键，但是你也可以使用 slugs。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="f666" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>from django.views.generic.detail import DetailView<br/>from django.shortcuts import get_object_or_404<br/><br/>class PlayerDetailView(DetailView):<br/><br/>    template_name='detail.html'<br/>    #queryset = Player.objects.all()<br/><br/>    def get_object(self):<br/>        idx = self.kwargs.get("pk")<br/>        return get_object_or_404(Player, id=idx)</span></pre><p id="4fb1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们再次声明<em class="lp">模板名</em>。并且我们覆盖父类的<em class="lp"> get_object </em>方法来定制行为。我们通过给<em class="lp"> get_object_or_404 </em>方法提供主键来获得相应的模型记录。</p><p id="41a0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，我们可以通过定义 queryset 来限制显示的项目数量。默认行为是选择所有记录，但我们可以根据需要进行过滤。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="e0fc" class="lv lw in lr b be lx ly l lz ma">#detail.hmtl<br/><br/> &lt;body&gt;<br/>    {{object.first_name}} {{object.last_name}} {{object.nationality}}<br/>    {{object.age}}<br/>  &lt;/body&gt;</span></pre><p id="441a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以，如果我输入:<a class="ae ks" href="http://127.0.0.1:8000/1/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/1/ </a></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/c4ce0e27fddf02bedc5f0721227ebbf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*LMQ5vm5PCIuGlFamCp_R8Q.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">detail.html</figcaption></figure><p id="221e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">只需几行代码，我们就创建了一个视图，可以在其中查看列表中任何记录的详细信息。</p><h2 id="5e25" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">列表视图</h2><p id="8541" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">通用 ListView 设计用于显示对象列表。它提供了轻松分页的能力。这种通用视图也不太适合拥有表单或记录条目。它更适合显示和列出数据。</p><p id="d722" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，添加一个 URL 到<em class="lp"> urls.py: </em>中的<em class="lp"> urlpatterns </em></p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="1b3d" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>path('lists/', hv.PlayerListView.as_view(), name="player-list"),</span></pre><p id="dc68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们指定想要使用的模型和想要显示数据的模板。在幕后，Django 查询数据并将其输出到模板上。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="1b8b" class="lv lw in lr b be lx ly l lz ma">class PlayerListView(ListView):<br/><br/>    model = Player <br/>    template_name = "lists.html"  </span></pre><p id="29cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">超文本标记语言</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="e035" class="lv lw in lr b be lx ly l lz ma">&lt;table class="table"&gt;<br/>  &lt;thead&gt;<br/>    &lt;tr&gt;<br/>      &lt;th scope="col"&gt;First Name&lt;/th&gt;<br/>      &lt;th scope="col"&gt;Last Name&lt;/th&gt;<br/>      &lt;th scope="col"&gt;Nation&lt;/th&gt;<br/>      &lt;th scope="col"&gt;Age&lt;/th&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/thead&gt;<br/>  &lt;tbody&gt;<br/>    {% for player in object_list %}<br/>    &lt;tr&gt;<br/>      &lt;td&gt;{{player.first_name}}&lt;/td&gt;<br/>      &lt;td&gt;{{player.last_name}}&lt;/td&gt;<br/>      &lt;td&gt;{{player.nationality}}&lt;/td&gt;<br/>      &lt;td&gt;{{player.age}}&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    {% endfor %}<br/>  &lt;/tbody&gt;<br/>&lt;/table&gt;</span></pre><p id="49a2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> object_list </em>是<em class="lp"> ListView 的</em>数据的默认关键字。我们可以通过声明 context_object_name 变量来改变它。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="9fac" class="lv lw in lr b be lx ly l lz ma">class PlayerListView(ListView):<br/><br/>    model = Player <br/>    template_name = "lists.html"  <br/>    context_object_name = "Players"</span></pre><pre class="mb lq lr ls bn lt lu bi"><span id="e4db" class="lv lw in lr b be lx ly l lz ma">{% for player in Players %}<br/>  &lt;tr&gt;<br/>    &lt;td&gt;{{player.first_name}}&lt;/td&gt;<br/>    &lt;td&gt;{{player.last_name}}&lt;/td&gt;<br/>    &lt;td&gt;{{player.nationality}}&lt;/td&gt;<br/>    &lt;td&gt;{{player.age}}&lt;/td&gt;<br/>  &lt;/tr&gt;<br/>  {% endfor %}</span></pre><p id="99bd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">分页</strong></p><p id="1ee5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以用<em class="lp"> paginate_by </em>变量决定显示多少条记录。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="4a51" class="lv lw in lr b be lx ly l lz ma">class PlayerListView(ListView):<br/><br/>    model = Player <br/>    template_name = "lists.html"  <br/>    context_object_name = "Players"<br/>    paginate_by = 1</span></pre><p id="f869" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们使用 Django 文档中的通用代码进行分页。这样，在表格的底部有分页，我们可以来回移动。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="be9c" class="lv lw in lr b be lx ly l lz ma">&lt;body&gt;<br/>    &lt;div&gt;<br/>      &lt;table class="table"&gt;<br/>        &lt;thead&gt;<br/>          &lt;tr&gt;<br/>            &lt;th scope="col"&gt;First Name&lt;/th&gt;<br/>            &lt;th scope="col"&gt;Last Name&lt;/th&gt;<br/>            &lt;th scope="col"&gt;Nation&lt;/th&gt;<br/>            &lt;th scope="col"&gt;Age&lt;/th&gt;<br/>          &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>        &lt;tbody&gt;<br/>          {% for player in Players %}<br/>          &lt;tr&gt;<br/>            &lt;td&gt;{{player.first_name}}&lt;/td&gt;<br/>            &lt;td&gt;{{player.last_name}}&lt;/td&gt;<br/>            &lt;td&gt;{{player.nationality}}&lt;/td&gt;<br/>            &lt;td&gt;{{player.age}}&lt;/td&gt;<br/>          &lt;/tr&gt;<br/>          {% endfor %}<br/>        &lt;/tbody&gt;<br/>      &lt;/table&gt;<br/>    &lt;/div&gt;<br/>    &lt;div class="pagination"&gt;<br/>      &lt;span class="step-links"&gt;<br/>        {% if page_obj.has_previous %}<br/>        &lt;a href="?page=1"&gt;&amp;laquo; first&lt;/a&gt;<br/>        &lt;a href="?page={{ page_obj.previous_page_number }}"&gt;previous&lt;/a&gt;<br/>        {% endif %}<br/><br/>        &lt;span class="current"&gt;<br/>          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.<br/>        &lt;/span&gt;<br/><br/>        {% if page_obj.has_next %}<br/>        &lt;a href="?page={{ page_obj.next_page_number }}"&gt;next&lt;/a&gt;<br/>        &lt;a href="?page={{ page_obj.paginator.num_pages }}"&gt;last &amp;raquo;&lt;/a&gt;<br/>        {% endif %}<br/>      &lt;/span&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/b7006bd3eb438903e061beadc45a50d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1Eeb3Pb2PQXD8KX_RQ0XQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">页码</figcaption></figure><p id="823e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">实现分页的简单方法。</p><p id="a595" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如我们在 DetailView 中所做的那样，我们可以从头定义 queryset，并确定将处理哪些记录。这是一种有效的方法，但是我们也可以使用另一种方法来过滤记录。get_queryset 方法将被覆盖。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="ccd9" class="lv lw in lr b be lx ly l lz ma">class PlayerListView(ListView):<br/><br/>    model = Player <br/>    template_name = "lists.html"  <br/>    context_object_name = "Players"<br/>    paginate_by = 1<br/><br/>    def get_queryset(self):<br/>        queryset = Player.objects.filter(first_name="Lionel")<br/>        return queryset</span></pre><p id="0a30" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们也可以创建这个实例作为一个单独的类。这一次它将接受国籍作为参数。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="dcb0" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>#add this<br/>path('lists/&lt;str:nationality&gt;', hv.NationView.as_view(), name="nation"),</span></pre><p id="44a7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">筛选查询集。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="d081" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>class NationView(ListView):<br/>    model = Player <br/>    template_name = "lists.html"  <br/>    context_object_name = "Players"<br/>    paginate_by = 1<br/><br/>    def get_queryset(self):<br/>        queryset = Player.objects.filter(nationality=self.kwargs.get("nationality"))<br/>        return queryset</span></pre><p id="a12b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="http://127.0.0.1:8000/lists/Portugal" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/lists/葡萄牙</a></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/b5b7e3a7b41eb358b871d14db4d53c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsnWljuEs5YJ6AosVOwRHg.png"/></div></div></figure><h2 id="ca7e" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">表单视图</h2><p id="6ef5" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">到目前为止，我们一直在查看显示数据的通用视图。现在让我们看看数据编辑是怎么回事。</p><p id="d7bd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">顾名思义，我们使用<em class="lp">表单视图</em>来显示表单。我们通常不使用<em class="lp">表单视图</em>来保存新数据。对此有一个单独的通用视图。我们使用<em class="lp"> FormView </em>主要是为了执行一个动作，比如发送一封电子邮件。当然，如果需要，它也可以用来保存新数据。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="cf2a" class="lv lw in lr b be lx ly l lz ma">#views.py<br/><br/>from django.views.generic.edit import FormView<br/><br/>class AddView(FormView):<br/>    template_name = "add_player.html"<br/>    form_class = PlayerForm<br/>    success_url = '/'<br/><br/>    def form_valid(self, form):<br/>        form.save()<br/>        return super().form_valid(form)</span></pre><p id="f4e7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们设置了<em class="lp"> template_name </em>，表单，以及操作完成时将要重定向的 URL。通过覆盖<em class="lp"> form_valid </em>方法，我们可以定制表单验证过程。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="ed2f" class="lv lw in lr b be lx ly l lz ma">#urls.py<br/><br/>path('add/', hv.AddView.as_view(), name='add'),</span></pre><pre class="mb lq lr ls bn lt lu bi"><span id="be53" class="lv lw in lr b be lx ly l lz ma">&lt;div class="main-frame"&gt;<br/>  &lt;form method="POST"&gt;<br/>    {% csrf_token %}<br/>    &lt;div class="left-frame"&gt;<br/>      {{form.as_table}}<br/>      &lt;button name="submit" type="submit" class="btn btn-primary"&gt;<br/>        Save<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  &lt;/form&gt;<br/>&lt;/div&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/248e6859f916d657bb3308320badd590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySt9mSKzALC0LhFPd7IqiA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">add_player.html</figcaption></figure><h2 id="58e0" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">创建视图</h2><p id="7db5" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">这是一个非常具体的通用视图。我们使用<em class="lp"> CreateView </em>来显示创建新记录的表单。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="5425" class="lv lw in lr b be lx ly l lz ma">from django.views.generic.edit import CreateView<br/><br/>class CreatePlayerView(CreateView):<br/>    model = Player<br/>    template_name = "add_player.html"<br/>    form_class = PlayerForm<br/>    success_url = '/'</span></pre><p id="5836" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们不需要在<em class="lp"> CreateView </em>中使用表单验证。除此之外，它的结构与<em class="lp"> FormView </em>类似。</p><h2 id="e1c6" class="mz lw in bd me na nb dn mi nc nd dp mm lc ne nf mo lg ng nh mq lk ni nj ms nk bi translated">更新视图</h2><p id="e85d" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated">它继承了与 CreateView 相同的类和混合。所以，它们是相似的。我们更喜欢用<em class="lp"> UpdateView </em>来检索特定的数据并更新它。</p><p id="23c0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们需要一个新的网址。</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="d804" class="lv lw in lr b be lx ly l lz ma">path('&lt;int:pk&gt;/edit',hv.EditPlayerView.as_view(), name='edit'),</span></pre><p id="fdaf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">观点:</p><pre class="kd ke kf kg gt lq lr ls bn lt lu bi"><span id="326b" class="lv lw in lr b be lx ly l lz ma">class EditPlayerView(UpdateView):<br/>    model = Player<br/>    template_name = "add_player.html"<br/>    form_class = PlayerForm<br/>    success_url = '/'</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/14dde401177ec2ca4c030588c5be5849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5guqQvUiDSoRaMcmGFXMxQ.png"/></div></div></figure><p id="6065" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">目前就这些。感谢阅读。如果你有任何意见或建议或异议，请随时写信给我。</p><h1 id="e0a0" class="md lw in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">阅读更多内容…</h1><div class="np nq gp gr nr ns"><a href="https://awstip.com/discovering-django-forms-dc4b4d9970d9" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd io gy z fp nx fr fs ny fu fw im bi translated">发现 Django 表单</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">在 Django 中使用表单</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">awstip.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og km ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://levelup.gitconnected.com/restful-django-django-rest-framework-8b62bed31dd8" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd io gy z fp nx fr fs ny fu fw im bi translated">RESTful Django — Django REST 框架</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">让我们开发一个 RESTful Django 项目</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og km ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://faun.pub/learn-django-signals-79c5e67134b0" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd io gy z fp nx fr fs ny fu fw im bi translated">学习姜戈信号</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">解释 Django 信号</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">faun.pub</p></div></div><div class="ob l"><div class="oi l od oe of ob og km ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://python.plainenglish.io/learn-django-models-9826d8743a78" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd io gy z fp nx fr fs ny fu fw im bi translated">学习 Django 模型</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">关于姜戈模特的一切</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">python .平原英语. io</p></div></div><div class="ob l"><div class="oj l od oe of ob og km ns"/></div></div></a></div><h1 id="96b9" class="md lw in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">来源</h1><p id="b131" class="pw-post-body-paragraph kt ku in kv b kw mu jo ky kz mv jr lb lc mw le lf lg mx li lj lk my lm ln lo ig bi translated"><a class="ae ks" href="https://docs.djangoproject.com/en/4.1/topics/http/urls/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/4.1/topics/http/urls/</a></p><p id="6729" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://docs.djangoproject.com/en/4.1/topics/http/views/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/4.1/topics/http/views/</a></p><p id="caa6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://docs.djangoproject.com/en/4.1/topics/class-based-views/" rel="noopener ugc nofollow" target="_blank">https://docs . django project . com/en/4.1/topics/class-based-views/</a></p><p id="dc08" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.youtube.com/watch?v=GxA2I-n8NR8&amp;list=PLOLrQ9Pn6caxNb9eFZJ6LfY29nZkKmmXT" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=GxA2I-n8NR8&amp;list = plol rq 9 pn 6 CAX nb 9 efzj 6 LFY 29 nzkkmmxt</a></p><p id="6df3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.youtube.com/watch?v=RE0HlKch_3U" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=RE0HlKch_3U</a></p></div></div>    
</body>
</html>