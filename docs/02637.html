<html>
<head>
<title>Kubernetes Namespaces: Core Concepts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes 名称空间:核心概念</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kubernetes-namespaces-core-concepts-488bb473aaee?source=collection_archive---------5-----------------------#2020-08-17">https://blog.devgenius.io/kubernetes-namespaces-core-concepts-488bb473aaee?source=collection_archive---------5-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读完这篇文章后，你会:</p><ol class=""><li id="8ac7" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">对 kubernetes 中的名称空间有较高的理解。</li><li id="037e" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">了解与名称空间相关的基本 kubectl 命令。</li></ol><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/fa997cadbd371abdfcc6c381bc78944b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-a7LLjP06CgISFfzIoF3Sg.png"/></div></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="feff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们后退一步，从一个简单的类比开始，这将有助于建立一些直觉。</p><p id="46c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想象有两个男孩，都叫路易斯。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/2cce40baf9296ec1f0dd0833db2eb29b.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/0*Eky3whbuKYTxS2Dy.jpg"/></div></figure><p id="ccd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了区分他们，我们用他们的姓来称呼他们:佩雷斯和查韦斯。</p><p id="5d44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们来自不同的家族:查韦斯家族和佩雷斯家族。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lt"><img src="../Images/7e21f0dc8a51c69b07195a57756b3f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ct6TYbKXNwoCmQ4W.jpg"/></div></div></figure><p id="1e14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">房子里还有其他成员，这些人只是以他们的名字相互称呼。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lu"><img src="../Images/6d7942e5ccdfaea88d272ba2f28f4b40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VtNH2Z0YGOTqp1qE.jpg"/></div></div></figure><p id="15a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，父亲称路易斯为“路易斯”。</p><p id="6b02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果父亲希望从另一个房子称呼路易斯，他会使用他的全名。</p><p id="d29c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，房子外面的人也会用全名来称呼房子里的男孩或任何人。</p><p id="fc0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个宫位都有自己的一套<strong class="jp ir">规则</strong>来定义每个人的职责。同样，这些房子有一套他们可以消费的<strong class="jp ir">资源</strong>。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="05d9" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">回到 Kubernetes</h1><p id="09fc" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">正如您可能已经猜到的，房子对应于 kubernetes 中的名称空间。</p><p id="0548" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当您在没有指定名称空间的情况下创建一个 kubernetes 对象时，该对象就被放在<strong class="jp ir">“默认”</strong>名称空间中。</p><p id="c54d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次设置集群时，kubernetes 为其内部管理创建了一组 pods 和服务，例如:</p><ul class=""><li id="7f6c" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk my kr ks kt bi translated">ETCD 服务器</li><li id="edd5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk my kr ks kt bi translated">调度程序</li><li id="2517" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk my kr ks kt bi translated">API 服务器</li><li id="fd75" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk my kr ks kt bi translated">控制器管理器</li></ul><p id="3643" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些在 kubernetes 中被称为<strong class="jp ir">控制平面组件</strong>。</p><p id="afd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了将这些服务与用户隔离开来，并防止您意外删除或修改这些服务，kubernetes 在集群启动时创建的另一个名为<strong class="jp ir"> kube-system </strong>的名称空间下创建它们。</p><p id="d02a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">kubernetes 自动创建的另一个名称空间叫做<strong class="jp ir"> kube-public </strong>名称空间。这是创建所有用户都可以使用的资源的地方。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mz"><img src="../Images/7b24038e798253f0d0f3d522c71b627f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s7Fof3htc63NhDtH.jpg"/></div></div></figure><p id="31c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的环境很小，您实际上不必担心名称空间，您可以继续使用默认的名称空间。</p><p id="9a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当您出于企业或生产目的发展和使用 kubernetes 集群时，您可能希望考虑使用名称空间。</p><p id="1e18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果您希望将同一个集群用于开发和生产环境，但同时隔离它们之间的资源，那么您可以为它们分别创建不同的名称空间。</p><p id="c8ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，当在开发环境中工作时，您不会意外地修改生产环境中的资源。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi na"><img src="../Images/c6b00fa6b4e07524600fbd59f8b9c542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g4cspCIN21WFWa_W.jpg"/></div></div></figure><p id="66a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些名字空间中每一个都可以有自己的一组策略和权限。</p><p id="085b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以为每个名称空间分配一个资源配额，这样每个名称空间就不会使用过多的资源。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="bba2" class="nb lw iq bd lx nc nd dn mb ne nf dp mf jy ng nh mj kc ni nj mn kg nk nl mr nm bi translated">默认命名空间</h2><p id="c5e4" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">就像一个房子里的成员如何称呼彼此的名字一样。名称空间中的资源可以简单地通过它们的名称相互引用。</p><p id="a734" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一个例子来说明:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nn"><img src="../Images/ed5a1b8e956a98079dafc5f3996056e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IorqFYPzKpzKR0je.jpg"/></div></div></figure><p id="1c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，由于这些 kubernetes 对象在同一个名称空间中，如果需要，web app POD 可以通过简单地使用主机名<strong class="jp ir"> <em class="no"> db-service </em> </strong>来访问 db 服务。</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="75e5" class="nb lw iq nq b gy nu nv l nw nx">mysql.connect("db-service");</span></pre><p id="c2e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果资源希望与位于不同名字空间的资源通信。您必须将命名空间的名称附加到服务的名称之后。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ny"><img src="../Images/8bbb820e84461e40bce65c0731ffc6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cp81fr1qMmoXCBRS.jpg"/></div></div></figure><p id="b0d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，对于要连接到 dev 名称空间中的数据库的默认名称空间中的 web pod:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="5148" class="nb lw iq nq b gy nu nv l nw nx">mysql.connect("db-service.dev.svc.cluster.local");</span></pre><p id="cb2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您之所以能够这样做，是因为当创建服务时，会以这种格式自动添加一个 DNS 条目。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nz"><img src="../Images/9316e58f77c6606e82f6f3fd41d75b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i-tn3A0aosMQWrGF.jpg"/></div></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="9c8c" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">相关命令</h1><p id="78ce" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">以下命令用于列出除<em class="no">之外的所有窗格，它只列出默认名称空间</em>中的窗格:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="2832" class="nb lw iq nq b gy nu nv l nw nx">kubectl get pods</span></pre><p id="a70c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在另一个名称空间中列出窗格:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="9e6f" class="nb lw iq nq b gy nu nv l nw nx">kubectl get pods --namespace=[NAMESPACE_NAME]</span></pre></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="1940" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">例子</h1><p id="4e84" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">这里我有一个 pod 定义文件:</p><p id="d63a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">pod-definition.yaml:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="a4db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建 POD 对象，请执行以下操作:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="2a78" class="nb lw iq nq b gy nu nv l nw nx">kubectl create -f pod-definition.yaml</span></pre><p id="7a64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您使用这个文件创建一个 pod 时，因为没有指定名称空间，所以 pod 是在<strong class="jp ir">默认名称空间</strong>中创建的。</p><p id="6bba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在另一个名称空间中创建 pod，请使用<strong class="jp ir"> —名称空间</strong>选项。</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="cbb3" class="nb lw iq nq b gy nu nv l nw nx">kubectl create -f pod-definition.yaml --namespace=dev</span></pre><p id="52fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想确保在 dev 环境中创建这个 POD，而不添加<strong class="jp ir"> —名称空间</strong>选项。在元数据下添加名称空间选项，如下所示:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="ad38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是确保您的资源总是在相同的名称空间中创建的好方法。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="dd4d" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">创建名称空间</h1><p id="16f4" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">有几种方法可以在 kubernetes 中创建名称空间。</p><ul class=""><li id="c9cb" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk my kr ks kt bi translated">使用名称空间定义文件:</li></ul><p id="6600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在命名空间-dev.yaml 中:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oa ob l"/></div></figure><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="a3a6" class="nb lw iq nq b gy nu nv l nw nx">kubectl create -f namespace-dev.yaml</span></pre><ul class=""><li id="44ce" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk my kr ks kt bi translated">如果没有 YAML 定义文件:</li></ul><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="6894" class="nb lw iq nq b gy nu nv l nw nx">kubectl create namespace dev</span></pre><p id="2ba0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您希望从默认命名空间切换，请运行以下命令:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="b2de" class="nb lw iq nq b gy nu nv l nw nx">kubectl config set-context $(kubectl config current-context) --namespace=dev</span></pre><p id="9381" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前面的命令通过修改 kubeconfig 文件来切换当前的名称空间。</p><p id="d468" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，要查看所有名称空间中窗格:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="5e68" class="nb lw iq nq b gy nu nv l nw nx">kubectl get pods --all-namespaces</span></pre><p id="f00f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将列出所有名称空间中的所有窗格。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="ad6c" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">限制命名空间资源</h1><p id="65e4" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">限制命名空间中的资源。</p><p id="db03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建资源配额定义文件，并指定要为其创建配额的命名空间:</p><p id="9af0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 compute-quota.yaml 中:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9c4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，您可以根据自己的需要更改这些规格。</p><p id="1525" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，创建配额对象:</p><pre class="la lb lc ld gt np nq nr ns aw nt bi"><span id="8c04" class="nb lw iq nq b gy nu nv l nw nx">kubectl create -f compute-quota.yaml</span></pre></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="4af0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="no">最初发布于</em><a class="ae oc" href="https://luispreciado.blog/posts/kubernetes/core-concepts/namespaces" rel="noopener ugc nofollow" target="_blank"><em class="no">https://luispreciado . blog</em></a><em class="no">。</em></p></div></div>    
</body>
</html>