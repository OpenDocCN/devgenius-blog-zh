<html>
<head>
<title>Advanced Exception Handling With Power Of Dependency Injection In Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Angular中的依赖注入功能进行高级异常处理</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/advanced-exception-handling-with-power-of-dependency-injection-in-angular-93cd7422f051?source=collection_archive---------3-----------------------#2020-06-12">https://blog.devgenius.io/advanced-exception-handling-with-power-of-dependency-injection-in-angular-93cd7422f051?source=collection_archive---------3-----------------------#2020-06-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fbebbb934f0e177078283dc4dd3e8daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOWyQTPcLQBwM-aD0AfABA.png"/></div></div></figure><blockquote class="jv jw jx"><p id="f26d" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">每个应用程序都应该有一个强大的异常处理机制，在大多数情况下，我们希望有一个全局异常处理层来处理所有这些异常，或者记录这些异常，并将它们发送到服务器以存储我们的日志。</p></blockquote><p id="078d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">在本文中，我们只讨论应用程序错误，而不是HTTP错误。因为它们可以使用HTTP拦截器来处理。但是对于其他类型的错误，Angular为我们提供了一个称为错误处理器的接口。我们必须实现这个接口，并在如下模块中提供它。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated"><strong class="ak">全局错误处理器</strong></figcaption></figure><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated"><strong class="ak">在模块</strong>中提供全局错误处理程序</figcaption></figure><blockquote class="jv jw jx"><p id="f270" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这将开始处理所有错误，并在控制台中打印出来。但是，如果我希望我的应用程序有多个错误处理程序，每个都有各自的用途，该怎么办呢？例如，一个用于打印，一个用于发送到服务器等。我发现的一个解决方案是用另一个类扩展一个类，并调用父类的super.handleError()。类似下面的东西。</p></blockquote><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="8427" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">听起来不错。但是，如果我想在这个层次结构之间添加更多的处理程序，这将需要更多的更改。我想实现一个类似HTTP_INTERCEPTORS的行为，其中我提供了多个错误处理程序，它应该按顺序调用它们。如果我能做到这一点，添加/删除拦截器只需要添加一个提供者。</p><blockquote class="jv jw jx"><p id="282d" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为此，我需要理解什么是HTTP_INTERCEPTORS，我查看了Angular代码，发现它是一个InjectionToken数组。我决定使用相同的方法来实现我想要的行为，并创建了一个名为ERROR_HANDLERS的新的InjectionToken数组。</p></blockquote><p id="aa72" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">完成同样的工作后，这就是我的providers数组的样子。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><blockquote class="jv jw jx"><p id="cb20" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我现在可以在我的应用程序中添加任意数量的错误处理程序，它们将在providers数组中按使用顺序被调用。让我们看看如何实现这一点。</p></blockquote><ol class=""><li id="6ed7" class="lk ll in kb b kc kd kg kh kx lm ky ln kz lo kw lp lq lr ls bi translated">首先，我们必须定义一个注入令牌数组，比如HTTP_INTERCEPTORS。</li></ol><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="7cc2" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">2.现在我想添加我的全局错误处理程序。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated"><strong class="ak">第一个错误处理器</strong></figcaption></figure><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated"><strong class="ak">第二个错误处理器</strong></figcaption></figure><p id="c614" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">3.现在我们需要一个类来访问我们的ERROR_HANDLERS，并按照它们被注入的顺序调用它们的handleError方法。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="2d74" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">这就是依赖注入的力量。我们在那个注入令牌数组中获得了两个错误处理类实例，即<strong class="kb io"> ERROR_HANDLERS </strong>，因为我们在providers数组中为它们提供了这个令牌。让我们再次看看我们的提供商阵列。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="4ee1" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">所以我们说<strong class="kb io"> MyErrorHandler </strong>类将处理所有错误，现在在这个类中，我们通过使用我们的注入令牌数组(即ERROR_HANDLERS)从注入器获得所有实例，并且我们调用每个处理程序的handleError方法。让我们看看我们的实际实现。我在app.component.ts的ngOnInit中抛出了异常。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="d338" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">这是输出。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/d406d52e69cfa753b4c56f672938d5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RqGtFrfCz4bFLMvEAn9Rlg.gif"/></div></div></figure><p id="1cd6" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">现在，我们可以使用新的注入令牌添加任意数量的全局错误处理程序，例如<strong class="kb io"> ERROR_HANDLERS </strong>，就像HTTP_INTERCEPTORS一样。</p><p id="fe6d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">以上内容适用于您或Angular抛出的所有类型的异常。我们通常在模板中找不到未定义错误的字段。让我们来看一个例子。</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="56ba" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">我们忘记了使用安全遍历运算符，即<strong class="kb io">(？我们通常会得到一个错误的控制台，因为说找不到未定义的名称。如果没有新的错误处理程序，我们会得到如下警告。</strong></p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/d1948e2f8d2061339cb6f2bed9fb2614.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*MhzFjk6Mp_gm6oreez22Wg.png"/></div></div></figure><p id="66da" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">您可以将这些异常发送给API，以便登录服务器，下次任何用户抱怨异常或应用程序挂起时使用。您有这些日志来检查用户面临的异常。</p></div></div>    
</body>
</html>