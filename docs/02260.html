<html>
<head>
<title>Power up your repo with GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作启动您的repo</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/power-up-your-repo-with-github-actions-32cd830cd9ee?source=collection_archive---------15-----------------------#2020-07-25">https://blog.devgenius.io/power-up-your-repo-with-github-actions-32cd830cd9ee?source=collection_archive---------15-----------------------#2020-07-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1ca06d0958ba1ee80850e2899b9880e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*99MuAcu_sMqZ4oXp"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">潘卡杰·帕特尔</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="823e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现代软件工程实践提倡使用增量方法一点一点地构建软件。随着微服务架构和全球分布式团队的发展，软件正在被无缝地全天候开发。这种现象的基础是<em class="ky">持续集成(CI) </em>的概念，在这种概念中，团队构建小型的独立功能，并频繁地与<code class="fe kz la lb lc b">mainline</code>分支或<code class="fe kz la lb lc b">trunk</code>集成。为了使这个持续集成的过程变得容易和顺利，近年来发展了许多工具。最常用的工具有<a class="ae jz" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank">詹金斯</a>、<a class="ae jz" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a>、<a class="ae jz" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> TravisCI </a>等。这已被证明是持续集成的行业标准。</p><p id="a4b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述CI工具的一个常见挑战是与源代码控制管理(SCM)工具(如GitHub、SubVersion、Mercurial等)的分离。人们必须在配置管理工具和CI工具之间建立连接，以便创建一个由一些自定义规则触发的工作流。这不仅在技术上具有挑战性，而且在财务上也是一种负担，因为我们现在不得不在至少两种不同的工具上花钱。对于IT管理员来说，学习和掌握额外的工具也是一个永无止境的挑战。如果CI工具被内置到配置管理工具中不是很好吗？这是不可能的——直到现在。随着GitHub <a class="ae jz" href="https://docs.github.com/en/actions" rel="noopener ugc nofollow" target="_blank"> Actions </a>的引入，CI和SCM一起解决了前面提到的挑战。</p></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><h1 id="72a1" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">GitHub操作</h1><p id="0e45" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">近年来，<a class="ae jz" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> Git </a>已经迅速成为各行各业最广泛采用的源代码管理软件，GitHub是管理Git库的事实上的工具。毫不夸张地说，如今几乎所有的大型科技公司都在GitHub上有存储库(公共的和私有的)。虽然GitHub围绕源代码控制提供了优秀而简单的工具，但是GitHub Actions为我们的GitHub库内的持续集成带来了熟悉的简单性。是的，不再需要搭建桥梁和跨越不同工具的管道。</p><p id="d662" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GitHub Actions使用“工作流”的概念提供了对存储库的持续集成支持。工作流是“步骤”的集合，我们可以定义这些步骤来对源代码执行各种操作。这些包括检查代码，运行CLI工具，甚至与包括Azure在内的第三方操作集成。GitHub Actions的伟大之处在于，所有工作流都在GitHub托管的名为“runners”的机器上运行，这些机器可以是基于Windows/MacOS/Linux的机器，甚至可以在任何容器中运行。如果你在GitHub上有一个公共库，大部分功能都是免费的*。</p><h1 id="3418" class="lk ll in bd lm ln mn lp lq lr mo lt lu lv mp lx ly lz mq mb mc md mr mf mg mh bi translated">工作流示例</h1><p id="e92e" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">让我们用一个真实的例子来理解GitHub的动作和工作流程。我有一个个人<a class="ae jz" href="https://www.rakeshkasibhatla.in/" rel="noopener ugc nofollow" target="_blank">网站</a>，我在GitHub repo中为其托管源代码(内容、配置、样式)。每次我对我的站点做了更改，我都想通过SSH把它们发布到我的托管服务器上。现在，这个过程包括以下步骤:</p><ol class=""><li id="dffd" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">对内容进行更改。</li><li id="294b" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">提交对回购的更改。</li><li id="ee3f" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">使用<a class="ae jz" href="https://www.mkdocs.org/" rel="noopener ugc nofollow" target="_blank"> mkdocs </a>构建站点。</li><li id="45ec" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">使用SSH将生成的文件复制到我的托管服务器上。</li></ol><p id="a6b3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想自动化第3步和第4步，以防止任何手动错误，使它没有麻烦。为了使用GitHub动作做到这一点，我所要做的就是在包含我的工作流的目录<code class="fe kz la lb lc b">.github/workflows</code>下向我的repo添加一个新的YAML文件。以下是我的工作流文件的外观:</p><figure class="ng nh ni nj gt jo"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="6e25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们更深入地研究工作流文件。正如我们所看到的，在高层次上，我的工作流文件包含了一系列在一个明显的部分<code class="fe kz la lb lc b">steps</code>下定义的步骤。每一步至少有三个部分——<code class="fe kz la lb lc b">name</code>、<code class="fe kz la lb lc b">uses</code>和<code class="fe kz la lb lc b">run</code>。很明显，<code class="fe kz la lb lc b">name</code>是您的步骤的标识符，<code class="fe kz la lb lc b">uses</code>定义了我们想要使用的任何第三方动作，<code class="fe kz la lb lc b">run</code>定义了要执行的CLI命令。既然我们已经定义了步骤，那么我们什么时候运行它们呢？第<code class="fe kz la lb lc b">on</code>节对此进行了明确定义。在<code class="fe kz la lb lc b">on</code>部分，我们可以定义触发动作的条件。GitHub Actions允许我们在各种条件下运行这些步骤，如<code class="fe kz la lb lc b">push</code>、<code class="fe kz la lb lc b">pull_request</code>等。也在特定的分支上。在上面的例子中，工作流被配置为运行<code class="fe kz la lb lc b">on</code>到<code class="fe kz la lb lc b">push</code>的分支。</p><p id="06b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GitHub Actions最强大的功能之一是在<a class="ae jz" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank"> GitHub市场</a>中提供的第三方操作。市场上有大量有用的操作，我们可以使用<code class="fe kz la lb lc b">uses</code>动词将它们插入到我们的工作流程中。在上面的例子中，我使用了用户“appleboy”的SCP动作。其他一些流行的操作包括来自Google Cloud、Ansible、AWS等。</p><p id="1f24" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看这个工作流程是如何工作的。我对我的网站内容进行更改，然后推送到回购中的<code class="fe kz la lb lc b">master</code>分支。推送完成后，我们可以看到提交仍在处理中，如下面的屏幕截图所示:</p><figure class="ng nh ni nj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/79efe70b8f453e507f7b2e9d00357364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfM8BsyE9510JDx70PEaoQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">橙色圆点表示GitHub操作正在处理提交</figcaption></figure><p id="804d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里刚刚发生的是，我在repo中配置的工作流被触发，它开始执行工作流中提到的步骤，如下所示:</p><figure class="ng nh ni nj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/5bf182c69b147b05b579af89177ec039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ONVhXMzF668eJA3loveCjg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">工作流正在进行</figcaption></figure><p id="e7da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦工作流成功完成，提交现在被应用到<code class="fe kz la lb lc b">master</code>分支，工作流中的“工件”(在本例中是站点文件)被使用SSH自动复制到托管服务器上。在上面的工作流文件中需要注意的一点是，我使用了使用<code class="fe kz la lb lc b">{{ secrets.NFSNUSER }}</code>标记的托管服务器的SSH凭证。这是可能的，因为GitHub提供了secrets功能。使用secrets，我们现在可以在同一个repo中存储敏感信息，如凭证和密钥，从而使它们在工作流中可以访问。下面是我的秘密部分的样子:</p><figure class="ng nh ni nj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/617d6b8468802674b24ac2fcb77f22c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ABmxVqa_pOrmF9VDGrMv7Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">我的主机服务器SSH凭证的秘密</figcaption></figure></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="d038" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我们在上面的例子中看到的，GitHub Actions提供了一种非常简单、高效和强大的方式来在同一个repo上构建工作流，而没有任何外部工具的麻烦。有了GitHub Actions，我们现在有了一个可靠的持续集成和部署故事——就在源代码旁边。</p><p id="26cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是时候启动您的回购了！干杯！</p><p id="b94a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">*请参考GitHub Actions定价<a class="ae jz" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="20d9" class="lk ll in bd lm ln mn lp lq lr mo lt lu lv mp lx ly lz mq mb mc md mr mf mg mh bi translated">参考</h1><p id="373c" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">GitHub动作文档:<a class="ae jz" href="https://docs.github.com/en/actions" rel="noopener ugc nofollow" target="_blank">https://docs.github.com/en/actions</a></p><p id="004d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GitHub行动市场:<a class="ae jz" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank">https://github.com/marketplace?type=actions</a></p></div></div>    
</body>
</html>