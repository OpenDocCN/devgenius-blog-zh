<html>
<head>
<title>Scalability and Cost Analysis for Cloud-Based Software Systems (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于云的软件系统的可扩展性和成本分析(上)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/scalability-and-cost-analysis-for-cloud-based-software-systems-part-1-472012435b26?source=collection_archive---------1-----------------------#2020-06-19">https://blog.devgenius.io/scalability-and-cost-analysis-for-cloud-based-software-systems-part-1-472012435b26?source=collection_archive---------1-----------------------#2020-06-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b6b075e30dcd5314f1c1db1a312e6fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*twmgeEDzfDYu7sc0"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">马文·迈耶在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9914" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">大型组织IT系统从内部部署到公共云平台部署的转变似乎势不可挡。下面是来自<a class="ae jz" href="https://hostingtribunal.com/blog/cloud-adoption-statistics/" rel="noopener ugc nofollow" target="_blank">最近调查</a>的一些关于云采用的数字:</p><ul class=""><li id="7ff7" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">94%的企业已经在使用云服务</li><li id="c7ad" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">所有IT预算的30%分配给云计算</li><li id="d5b8" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">66%的企业已经拥有中央云团队或云卓越中心</li><li id="ee46" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">到2020年，83%的企业工作负载将位于云中</li></ul><p id="194e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">单个市场的调查和分析在很大程度上应被视为幻想，但当所有指标都指向同一个方向时，他们的发现就必须有一定的可信度。</p><p id="0562" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从全球范围来看，这些数字令人震惊。难怪云提供商能赚这么多钱——事实上，预计2020年将达到2660亿美元。从初创公司到政府机构再到跨国公司，各种组织都将云视为数字化转型平台和改善业务连续性的基础技术。</p><p id="5e80" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">云平台的两大吸引力在于其<em class="lm">现收现付</em>计费和快速扩展(和缩减)以满足不断变化的工作负载和数据量的能力。这种扩展能力当然不是免费的。您的应用需要经过<a class="ae jz" href="https://medium.com/@i.gorton/six-rules-of-thumb-for-scaling-software-architectures-a831960414f9" rel="noopener">架构设计，以利用云平台提供的可扩展</a>服务。当然，<a class="ae jz" href="https://medium.com/@i.gorton/building-scalable-distributed-systems-part-1-introduction-to-scalable-systems-9ca471fd77d7" rel="noopener">成本和规模有着不可分割的联系</a> —长期使用的资源越多，月底的云账单就越大。</p><p id="b969" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些每月的云账单可能会很大。非常大。更糟糕的是，出乎意料的大！大量云超支的“价格休克”案例屡见不鲜— <a class="ae jz" href="https://www.prnewswire.com/news-releases/survey-enterprises-overspending-by-millions-on-cloud-bills-300968100.html" rel="noopener ugc nofollow" target="_blank">在一项调查中</a> 69%的受访者经常在云预算上超支25%以上。<a class="ae jz" href="https://www.infotech.com/software-reviews/research/unexpected-cloud-costs-are-rocking-the-enterprise" rel="noopener ugc nofollow" target="_blank">一个众所周知的案例在Azure </a>任务上花费了50万美元才被注意到。导致超支的原因有很多，包括没有部署自动扩展解决方案、长期容量规划不佳，以及未充分利用云架构导致系统占用空间达不到最优。</p><h1 id="0e00" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">成本和规模不可分割地联系在一起</h1><p id="45bf" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">正如我在<a class="ae jz" href="https://medium.com/@i.gorton/six-rules-of-thumb-for-scaling-software-architectures-a831960414f9" rel="noopener">之前的文章</a>中所讨论的，在云平台上扩展系统会增加成本。这是必然的。然而，确切的“多少”是你作为一个建筑师可以通过一系列的架构决策来控制的。</p><p id="5e24" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">术语“软件架构”有太多的定义，因此其使用范围比最初预期的要广得多。一般来说，一个很好的经验法则是，被整合到系统中的设计决策是架构性的，因此很难(也很昂贵)改变。这些设计决策对系统的构建方式和部署后的非功能特性都有影响。因此，用迈克尔·尼加德的术语来说，影响性能和可伸缩性的设计决策是<a class="ae jz" href="http://thinkrelevance.com/blog/2011/11/15/documenting-architecture-decisions" rel="noopener ugc nofollow" target="_blank">架构上重要的</a>。</p><p id="f183" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在云平台上，架构师面临着无数的架构决策。就系统采用的整体架构模式或风格而言，它们既广泛，例如微服务、n层、事件驱动，也狭窄，具体到系统所基于的单个组件和云服务。从这个意义上说，架构决策贯穿于云上系统设计和部署的所有方面。当您收到每月的云账单时，这些决定的后果非常明显。</p><h1 id="7163" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">云中扩展的架构权衡</h1><p id="6697" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">正如我在本文中描述的<a class="ae jz" href="https://medium.com/@i.gorton/building-scalable-distributed-systems-part-1-introduction-to-scalable-systems-9ca471fd77d7" rel="noopener">，经济高效的扩展需要:</a></p><ol class=""><li id="1d84" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx mq le lf lg bi translated">优化单个服务和组件的吞吐量</li><li id="1619" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">当请求负载增长(纵向扩展)时，按需利用额外的资源来提供增强的处理能力</li><li id="d9ea" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">当请求负载减少时释放资源(缩减)</li></ol><p id="aa4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在云平台上，具体如何实现上述目标取决于您所使用的云服务的细节。例如，如果您在基础设施即服务(IaaS)平台上部署您的web服务，您将启动新的虚拟机(VM)来使用云提供的负载平衡服务增加容量。您的成本基本上与您选择的虚拟机类型及其部署持续时间成正比。</p><p id="2a5d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，如果您选择平台即服务(PaaS)部署，您友好的基于云的无服务器引擎，如AWS Lambda或谷歌应用引擎(GAE)将基本上为您管理自动伸缩(向上和向下)。这些平台提供了各种策略，您可以通过配置设置来影响这些策略，以尝试优化扩展。</p><p id="869d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通常，您的成本与您选择部署的服务器实例的类型、请求的数量和每个请求的处理持续时间，以及/或者每个服务器实例在无服务器基础结构上驻留和使用的时间成比例。</p><p id="189c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每个平台都不一样。</p><p id="69dd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你也有其他的决定要做。如果在虚拟机上部署，基本上可以选择任何您想要的服务器框架技术和相关编程语言。带烧瓶的蟒蛇。Node.js和Express。Java的春天。技术世界是你真正的牡蛎。</p><p id="1dd4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您选择无服务器，该平台将限制您的语言和框架选项，或者提供您需要使用的自己的API。举个例子，如果你想部署一个Java/Spring服务器，AWS Lambda框架为从Lambda函数中调用Spring提供了一些胶水。GCP可以轻松部署Java servlets和Spring Boot，但是Spring还是Jersey——还不太清楚？如果PHP是你的工作，那么GCP可能是你的首选，因为它在Lambda上没有本地支持。</p><p id="9839" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在云部署的所有阶段都需要做出类似的架构决策。例如，在数据层，您是在虚拟机上部署和管理自己的数据库服务器，还是使用云管理的数据库服务。如果是前者，您选择什么配置虚拟机，以及随着请求负载的增长，您将如何扩展(纵向或横向扩展)您的数据库？如果是后者，您如何设计一个数据模型来平衡读写性能和成本，以及最小化存储成本？通常还有其他的设计限制。例如，<a class="ae jz" href="https://cloud.google.com/datastore/docs/firestore-or-datastore" rel="noopener ugc nofollow" target="_blank"> Google Firestore限制每秒对10K的并发写入</a>。</p><p id="9065" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">欢迎来到云部署的世界。每个云服务都有许多架构上的重要决策需要解决。优秀的云服务进入门槛低，有足够的设施和能力让你轻松实现支出最大化。我知道这有点愤世嫉俗，但也有一点道理。</p><h1 id="ef0b" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">成本和可扩展性分析实验</h1><p id="df2f" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">虽然架构上重要的云平台决策显然会影响成本，尤其是在服务扩展时，但这种影响的程度很难抽象地衡量。对平台和部署选项进行试验是否会节省20%的基础成本，或者仅仅是微不足道的一部分，与昂贵的工程师和架构师的努力不相称？没有一些对照实验来调查这些影响的程度，我们都只是猜测。</p><p id="73b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">幸运的是，由于来自<a class="ae jz" href="https://edu.google.com/programs/credits/research/?modal_active=none" rel="noopener ugc nofollow" target="_blank">谷歌云平台研究</a>的一些资助，我们能够设计这样一组实验。由于有大量可能的服务和选项可供探索，并且资金和时间有限，我们针对使用无服务器平台的建筑师面临的两个设计决策——在我们的案例中是谷歌应用引擎(GAE)——并围绕它们设计了实验。我们想要回答的问题如下:</p><ol class=""><li id="be2d" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx mq le lf lg bi translated">编程语言的选择如何影响GAE的可伸缩性和成本？</li><li id="d3f0" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">自动伸缩配置设置的平台值如何影响GAE的可伸缩性和成本？</li></ol><p id="f3ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文的剩余部分，我们将描述我们对编程语言多样性的研究结果。后续将描述平台配置实验的结果。</p><p id="4b78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简言之，实验方法如下:</p><ol class=""><li id="5e59" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx mq le lf lg bi translated">用HTTP API设计一个综合应用程序</li><li id="f6db" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">实现一个支持这个API的GAE服务，并使用<a class="ae jz" href="https://cloud.google.com/datastore" rel="noopener ugc nofollow" target="_blank"> GCP数据存储NoSQL数据库</a>来保存数据。在Java、Go、Python和Node.js中实现了相同的服务逻辑和数据库API调用</li><li id="1606" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">构建一个多线程的Java客户端，可以用来在服务器上施加指定的请求负载。可以对客户端进行定制，以指定要发送的客户端线程数量和请求类型。它使用预热和冷却阶段的标准性能测试方法，预示着持续的峰值负载阶段。在一两个段落中会有更多关于这方面的内容。</li></ol><p id="63f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种方法遵循广为人知的<a class="ae jz" href="https://link.springer.com/referenceworkentry/10.1007%2F978-3-319-77525-8_111#:~:text=A%20microbenchmark%20is%20either%20a,operations%2C%20bandwidth%2C%20or%20latency." rel="noopener ugc nofollow" target="_blank"> <em class="lm">微基准</em> </a> <em class="lm"> s </em>方法。微基准测试在区分平台和组件级行为的性能和可伸缩性方面非常有效。为什么？</p><p id="4dfc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在云平台上，处理HTTP服务请求的大部分执行时间都被平台和框架代码消耗了。实际上，我们的服务(业务)逻辑通常只执行总请求时间的一小部分。在微基准测试方法中，这个比例可能在1%左右——在实际应用程序中，通常不会更多。其余时间由平台和语言运行时代码消耗，这在不同的应用程序行为中是相对恒定的。</p><p id="605c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文描述的第一个实验中，我们对服务器执行相同的客户端请求负载，这些服务器执行用Java、Go、Python和Node.js实现的相同业务逻辑。在每个版本中实现了相同的数据模型和相同的数据库API调用，唯一的变量是编程语言运行时，以及随着请求负载的扩展，GAE如何管理它。这意味着结果应该广泛地代表任何应用程序在类似的使用/平台场景中看到的性能差异。</p><p id="ae8e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们对US-West2数据中心上运行的每台服务器进行了一系列测试。在峰值测试阶段，我们将峰值客户端请求负载从128个最大并发请求变为1024个最大并发请求。图1显示了一个包含1024个客户端线程的示例测试运行，其中有预热和冷却阶段，以使测试能够测试GAE的放大和缩小功能。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/a149da5bca2918d1ded2813623a191e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4etXwLOmrNqihrpPaBrRNA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图1一个示例测试运行显示了POST请求的吞吐量。</figcaption></figure><p id="b4e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在客户端上测量并记录所有请求的延迟。测试后处理计算各种延迟统计数据，以及从测试开始到结束每秒处理的请求的吞吐量。</p><p id="7392" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还使用GCP控制台来获得额外的测试指标，包括成本，我们在一个GAE应用程序中用“实例小时”来衡量成本。在US-West2上，<a class="ae jz" href="https://cloud.google.com/appengine/pricing" rel="noopener ugc nofollow" target="_blank">对于我们使用的默认B1实例，一个实例小时的成本是6美分</a>。</p><p id="5e70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在云平台上可靠地复制测试行为是一项众所周知的棘手工作，因为涉及到如此多的潜在变量，而且环境是动态的。这可能导致结果的可变性。幸运的是，研究表明这种可变性在实践中很低。然而，为了最小化可变性的影响，我们进行了实验控制。</p><p id="2f34" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">具体来说:</p><ul class=""><li id="e293" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">每天在同一时间运行测试(美国太平洋时间上午7-9点)。</li><li id="248c" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">对于每个测试配置(客户端负载/语言)，我们执行了一个持续的每日基线测试，以检查测试环境的表现是否与前几天一样。如果基线测试显示结果可变性超过5%，我们当天就不测试了。</li><li id="338a" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">所有语言的测试都在两周内完成。这比预期的时间稍长，因为我们因为在US-West2 GCP数据中心使用了过多的容量而被限制了几天(是的，真的，我认为GCP支持部门从这个问题中学到的和我一样多)。节流期间的结果明显被丢弃！</li><li id="6449" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">每个测试配置至少运行3次，以确保结果一致。偶尔，测试运行会产生异常的结果(网络拥塞？有东西坠毁了？)并且我们丢弃这些，直到3次运行在受控的结果范围内。</li></ul><p id="40e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">TL；DR——我们在时间和预算上尽了最大努力。</p><h1 id="e3e3" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">结果:编程语言的影响</h1><p id="8c6c" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">我们对每个服务器实现运行了相同的测试负载，包括128、256、512和1024个并发客户端。图2总结了吞吐量方面的结果。对于每个测试，我们在左栏中显示完整测试的吞吐量，包括预热和冷却阶段，在右栏中仅显示峰值阶段的吞吐量。从这些图表中最大的收获可能是，随着负载的增长，每种语言的实现都可以很好地伸缩。GAE的自动缩放政策做得相当不错。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/0d8f2a7dfc612dd90d572f6272afbade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*dEXGVMQADRWx5SFkOBHr0A.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图2不同编程语言实现的测试吞吐量</figcaption></figure><p id="e9d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每种语言的绝对吞吐量略有不同，请注意y轴上的不同范围。为了更直接地比较结果，图3比较了每种语言相同的1024个客户端负载的吞吐量。Go实现显然提供了最高的吞吐量，峰值约为13K请求/秒，而Java和Node.js的峰值约为10K请求/秒，Python约为9K。换句话说，Python服务器在峰值负载时提供了Go服务器大约70%的吞吐量，而Java/Node.js服务器提供了大约77%。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/9638ffc3c75db9902768225019a51dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*osH0Jn-t-9a8Qs4yuBsaRw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图3与每种语言的1024个客户端的比较</figcaption></figure><p id="aeae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些结果表明我们有明显的峰值吞吐量差异。事实上，Python提供了强大的性能，并且没有明显的障碍来阻止它进一步扩展。如果你是一家Python商店，这是一件好事😉</p><p id="aa29" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们检查一下成本，如图4所示。这显示了GAE控制台报告的使用1024个客户机执行每个测试的实例小时数。实例是GAE用来执行和自动缩放应用程序的语言运行时。在任何给定的时间，根据负载情况，应用程序可以在一个或多个实例上运行，并在实例间对请求进行GAE负载平衡。在GAE，您是按每个实例小时计费的，因此它基本上代表了服务一个工作负载的成本。</p><p id="2828" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">图4揭示了明显的差异。Go实现只需要Python所需实例的1/3，并且提供了高得多的吞吐量。Java和Node.js介于两者之间，但由于这两者提供了相似的性能，Java在某种程度上更具成本效益。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/61cf9a8eb906d9735132e70d21e9ab96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*yf8ZZu2uY8mgfsEUXxsnZQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图4显示了一个有1024个客户端测试的平均GAE实例小时数。</figcaption></figure><p id="7362" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，让我们检查一个直接的比较，它结合了整个测试的平均吞吐量和每个测试运行的成本。图5显示了每个实例小时的吞吐量，计算方法是将整个测试的平均吞吐量除以运行测试所消耗的实例小时数。这就是有效的性价比。</p><p id="6d25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，Go的性价比比Python高4倍，比Node.js高3倍，比Java高2倍。或者换句话说，Go服务器将提供与Python服务器相同的性能，而成本大约为。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/202defd65b6ac1469508370a6c1586ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*v8bAUWMFL1jBapu_ItU8bA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图5每个GAE实例小时的吞吐量</figcaption></figure><p id="adaa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些结果似乎有些重要。对于任何应用程序，<em class="lm">您的里程数可能会因您的工作负载、业务逻辑、数据模型等而异</em>。但是有充分的理由相信这些结果有广泛的相关性。为什么？</p><p id="cc92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GAE自动伸缩基于许多因素创建运行时实例，包括请求到达率和响应延迟。随着到达的请求数量的增加，会产生新的实例来处理这些请求并保持较低的延迟。有许多自动缩放参数会影响这种行为。在上述测试中，所有语言的所有测试都使用了默认设置。</p><p id="dbea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GCP控制台使您能够在测试过程中监控各种度量。我们密切关注其中的两个:</p><ol class=""><li id="5816" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx mq le lf lg bi translated">测试期间部署的实例的峰值数量</li><li id="b2fe" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx mq le lf lg bi translated">新实例的加载时间</li></ol><p id="9eda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们注意到语言之间在这两个指标上有相当大的差异。例如，在一个1024客户机测试中，为Python部署的实例的峰值数量是550个。对于相同的测试，Go服务器的峰值实例数量级为100。Node.js的峰值实例与Python类似，Java低30%左右。</p><p id="29e1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">新实例的加载时间也是高度可变的。Go实例总是在一秒或更短的时间内加载，而Java的平均加载时间约为4秒，p95约为11秒。实例加载时间是影响性能提升的一个因素，受多种因素影响。这里有一个关于这种复杂性的很好的描述。见使用默认自动缩放设置，我们没有试图通过使用<a class="ae jz" href="https://medium.com/google-cloud/app-engine-resident-instances-and-the-startup-time-problem-8c6587040a80" rel="noopener">常驻实例</a>来避免“冷启动”问题。这可能至少对Java性能有所帮助。当然，常驻实例要花钱。</p><p id="0028" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些指标让我们对我们在测试中观察到的测量成本、性能和可伸缩性可变性有了一些了解。更深入地探索这些问题会很有趣，看看是否有系统的方法来减少Python、Java和Node.js的实例数量和加载时间值。和美元的研究学分。</p><h1 id="6f30" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">摘要和下一期…</h1><p id="715b" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">云的主要吸引力之一是易于扩展系统。如果您从增长的角度来设计您的系统，那么您确实可以轻松获得可伸缩性。这一切当然不是免费的。随着你工作量的增加，月底你的账单也会增加。有时超出你的客户或经理的期望。</p><p id="cb0c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文探讨了Google App Engine上不同编程语言的可伸缩性和成本有何不同。结果强烈地表明了编程语言选择对性能和成本的影响。GAE在扩展你的服务方面做得很好，不管你用什么语言。但是，在最好的情况下，对于给定的工作负载，您选择的语言可以使成本降低四倍。在繁重的工作负荷下，这是一大笔钱。</p><p id="7c22" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，这些结果是上下文相关的，并且特定于GAE无服务器平台如何处理处理实例。基准测试是在2019年夏天进行的，因此语言运行时间和GAE毫无疑问会从那时起发生变化。我们不知道这些工作负载的类似实现在AWS Lambda或Azure Serverless上的表现如何。但我们很乐意调查。我敢打赌，在任何平台上，语言选择都是规模成本的主要决定因素。</p><h1 id="e4d7" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">感谢</h1><p id="e48b" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">我要感谢<a class="ae jz" href="https://www.linkedin.com/in/yixingshao/" rel="noopener ugc nofollow" target="_blank">邵宜兴</a>、<a class="ae jz" href="https://www.linkedin.com/in/yijinleemacy/" rel="noopener ugc nofollow" target="_blank">李一进</a>、<a class="ae jz" href="https://www.linkedin.com/in/yiwen-zhang-525554178/" rel="noopener ugc nofollow" target="_blank">、</a>、<a class="ae jz" href="https://www.linkedin.com/in/cong-li-905/" rel="noopener ugc nofollow" target="_blank">、</a>和<a class="ae jz" href="https://www.linkedin.com/in/stephenlockwoodmartin/" rel="noopener ugc nofollow" target="_blank">斯蒂芬·马丁</a>来自<a class="ae jz" href="https://align.khoury.northeastern.edu/" rel="noopener ugc nofollow" target="_blank">东北大学的Align MSCS项目</a>的努力。他们是我们MSCS项目在整个东北部地区拥有的高质量学生的优秀范例。</p></div></div>    
</body>
</html>