<html>
<head>
<title>Auto Updater for React Electron App | Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 电子应用程序的自动更新程序|教程</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/auto-updater-for-react-electron-app-tutorial-18b1a6db08bd?source=collection_archive---------0-----------------------#2022-06-24">https://blog.devgenius.io/auto-updater-for-react-electron-app-tutorial-18b1a6db08bd?source=collection_archive---------0-----------------------#2022-06-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="da39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大家好，</p><p id="8360" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上一篇文章中，我试图解释<strong class="jm io">“如何用 React 构建和发布一个电子 app？”</strong>如果你还没看过，你可以在这里找到<a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/how-to-build-and-publish-an-electron-app-with-react-tutorial-971e1d9d27ce">。</a></p><p id="e62f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我将继续从事相同的项目。我要集成电子自动更新器。如果你已经有一个电子项目，那么你可以跳过上一篇文章，从这篇文章继续。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/494fb5ebeb41584e9149bce311b7c495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yFAyprQN6n3saAcO5XosrA.png"/></div></div></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="eb25" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在开始开发之前，我想解释一下流程。通过自动更新，该应用程序将每 10 分钟检查一次来自 Github 的更新。<em class="lc">(我用了 10 分钟，但有可能改变它。)</em>如果有新版本，应用程序将下载更新的版本，并通过对话框等待用户的确认，如果用户批准，应用程序将更新并重新启动。</p><p id="01c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们开始开发吧！</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="2724" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为第一步，我通过下面的命令将<strong class="jm io">电子更新器</strong>库安装到项目中。有些版本可能会抛出 404 错误。正因为如此，我更倾向于使用版本<strong class="jm io"> <em class="lc"> 4.6.5 </em> </strong> <em class="lc">。</em>本库希望您的系统中有<strong class="jm io"> GH_TOKEN </strong>环境变量。</p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="ba7e" class="li lj in le b gy lk ll l lm ln">npm i electron-updater@4.6.5</span></pre><p id="92e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后为了能够收听和下载更新，我必须在<strong class="jm io"> electron.js </strong>中做一些改动。作为第一个改变，我在文件的顶部定义了<strong class="jm io">自动更新器</strong>对象。<em class="lc">(GitHub electron.js/Line 4)</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="f508" class="li lj in le b gy lk ll l lm ln">const { autoUpdater } = require(“electron-updater”);</span></pre><p id="9f37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如我前面提到的，该应用程序将每 10 分钟检查一次更新，我为此使用了<strong class="jm io"> setInterval </strong>方法<strong class="jm io"> </strong>。我在文件的顶部将我的实例定义为 null。<em class="lc">(GitHub electron.js/Line 6)</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="db72" class="li lj in le b gy lk ll l lm ln">let updateInterval = null;</span></pre><p id="ff1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将其定义为 null，因为该方法应该在应用程序启动时开始检查更新，在更新下载/安装过程中，应用程序应该停止检查新的更新，直到该过程完成。要开始检查更新，我必须做以下更改。</p><p id="a221" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">之前:</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="e7ef" class="li lj in le b gy lk ll l lm ln">app.whenReady().then(createWindow);</span></pre><p id="ccff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">之后(GitHub electron.js/Line 30 到第 33 行):</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="a4fb" class="li lj in le b gy lk ll l lm ln">app.whenReady().then(() =&gt; {</span><span id="0aef" class="li lj in le b gy lo ll l lm ln">     createWindow();</span><span id="c424" class="li lj in le b gy lo ll l lm ln">     <strong class="le io">updateInterval = setInterval(() =&gt; autoUpdater.checkForUpdates(), 600000);</strong></span><span id="acd8" class="li lj in le b gy lo ll l lm ln">});</span></pre><p id="dfb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更改后，应用程序能够检查更新。现在，我必须对更新流程管理进行一些更新。此时，我将使用两个不同的事件。使用更多是可能的，但是对于本教程，这两个就足够了。要查看所有事件，可使用<a class="ae ki" href="https://www.electronjs.org/docs/latest/api/auto-updater#events" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><ul class=""><li id="d30d" class="lp lq in jm b jn jo jr js jv lr jz ls kd lt kh lu lv lw lx bi translated"><em class="lc">更新识别</em></li><li id="0aae" class="lp lq in jm b jn ly jr lz jv ma jz mb kd mc kh lu lv lw lx bi translated"><em class="lc">更新下载</em></li></ul><p id="02f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们从更新识别继续。我对更新识别事件使用了下面的代码块。基本上，当一个新的更新可用时，应用程序会显示一个信息对话框。如果您不想显示对话框，您需要更改粗体部分。如果您想使用像教程一样的对话框，您必须像下面这样更新第一行，并将对话框对象包含到 electron.js 中。</p><p id="94f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">之前:</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="fc16" class="li lj in le b gy lk ll l lm ln">const { app, BrowserWindow } = require(‘electron’);</span></pre><p id="0372" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(GitHub electron.js/Line 1)之后<em class="lc">:</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="bee0" class="li lj in le b gy lk ll l lm ln">const { app, BrowserWindow<strong class="le io">, dialog</strong> } = require(‘electron’);</span></pre><p id="c0a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">然后(GitHub electron.js/Line 47 到 57 行):</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="6103" class="li lj in le b gy lk ll l lm ln">autoUpdater.on("update-available", (_event, releaseNotes, releaseName) =&gt; {</span><span id="be28" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   const dialogOpts = {</strong></span><span id="9b64" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      type: 'info',</strong></span><span id="e88d" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      buttons: ['Ok'],</strong></span><span id="d2da" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      title: 'Update Available',</strong></span><span id="aa57" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      message: process.platform === 'win32' ? releaseNotes : releaseName,</strong></span><span id="a8c3" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      detail: 'A new version download started. The app will be restarted to install the update.'</strong></span><span id="bb1e" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   };</strong></span><span id="c31f" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   dialog.showMessageBox(dialogOpts);<br/></strong> <br/>  <strong class="le io"> updateInterval = null;</strong></span><span id="601b" class="li lj in le b gy lo ll l lm ln">});</span></pre><p id="a985" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后一步，我将通知用户下载完成的情况。为了能够做到这一点，我使用了以下事件。当下载完成时，系统触发以下事件，并且该事件显示类似于前一事件的信息对话框。但这一次，系统会听取答案，如果用户点击重启，系统会更新应用程序并重启它。在事件中可以编写不同的场景。为了能够做到这一点，应该改变粗体部分。<em class="lc">(GitHub electron.js/Line 59 到第 70 行)</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="f839" class="li lj in le b gy lk ll l lm ln">autoUpdater.on(“update-downloaded”, (_event, releaseNotes, releaseName) =&gt; {</span><span id="c76d" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   const dialogOpts = {</strong></span><span id="f4fd" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      type: ‘info’,</strong></span><span id="0eff" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      buttons: [‘Restart’, ‘Later’],</strong></span><span id="363b" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      title: ‘Application Update’,</strong></span><span id="0fd8" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      message: process.platform === ‘win32’ ? releaseNotes : releaseName,</strong></span><span id="1f54" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      detail: ‘A new version has been downloaded. Restart the application to apply the updates.’</strong></span><span id="add1" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   };<br/></strong></span><span id="645d" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   dialog.showMessageBox(dialogOpts).then((returnValue) =&gt; {</strong></span><span id="a053" class="li lj in le b gy lo ll l lm ln"><strong class="le io">      if (returnValue.response === 0) autoUpdater.quitAndInstall()</strong></span><span id="6f13" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   });</strong></span><span id="7f20" class="li lj in le b gy lo ll l lm ln">});</span></pre><p id="eafb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在开始测试之前，我有一些小的改动。在第一篇文章中，我在<em class="lc"> package.json </em>文件中添加了一个构建部分。我必须在构建部分添加几个新字段。更新后的代码应该如下所示。<em class="lc">(GitHub package.json/Line 54 到 56 线)</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="9de9" class="li lj in le b gy lk ll l lm ln">“build”: {</span><span id="6ecc" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   “appId”: “tutorial.reactElectron”,</strong></span><span id="78c4" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   “productName”: “React Electron App Tutorial”,</strong></span><span id="fda4" class="li lj in le b gy lo ll l lm ln"><strong class="le io">   “copyright”: “Cinarrtolga”,</strong></span><span id="5ff1" class="li lj in le b gy lo ll l lm ln">   “mac”: {</span><span id="4ea6" class="li lj in le b gy lo ll l lm ln">      “publish”: {</span><span id="8a2f" class="li lj in le b gy lo ll l lm ln">         “provider”: “github”,</span><span id="4172" class="li lj in le b gy lo ll l lm ln">         “owner”: “cinarrtolga”,</span><span id="0199" class="li lj in le b gy lo ll l lm ln">         “repo”: “ART-React-Electron-App”</span><span id="6c6e" class="li lj in le b gy lo ll l lm ln">      }</span><span id="e679" class="li lj in le b gy lo ll l lm ln">   },</span><span id="40d1" class="li lj in le b gy lo ll l lm ln">   “win”: {</span><span id="bd30" class="li lj in le b gy lo ll l lm ln">      “publish”: {</span><span id="7ffc" class="li lj in le b gy lo ll l lm ln">         “provider”: “github”,</span><span id="25c3" class="li lj in le b gy lo ll l lm ln">         “owner”: “cinarrtolga”,</span><span id="40e4" class="li lj in le b gy lo ll l lm ln">         “repo”: “ART-React-Electron-App”</span><span id="8b9c" class="li lj in le b gy lo ll l lm ln">      }</span><span id="d98c" class="li lj in le b gy lo ll l lm ln">   },</span><span id="56ab" class="li lj in le b gy lo ll l lm ln">   “files”: [</span><span id="e8dd" class="li lj in le b gy lo ll l lm ln">      “build/**/*”,</span><span id="da70" class="li lj in le b gy lo ll l lm ln">      “node_modules/**/*”</span><span id="cfea" class="li lj in le b gy lo ll l lm ln">   ],</span><span id="0952" class="li lj in le b gy lo ll l lm ln">   “publish”: {</span><span id="aa9a" class="li lj in le b gy lo ll l lm ln">      “provider”: “github”,</span><span id="15f2" class="li lj in le b gy lo ll l lm ln">      “owner”: “cinarrtolga”</span><span id="9d00" class="li lj in le b gy lo ll l lm ln">   }</span><span id="ac35" class="li lj in le b gy lo ll l lm ln">}</span></pre><p id="9e14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，该应用程序已准备好进行测试。提醒一下，如果你尝试使用私有库，那么你应该在<em class="lc"> package.json. </em>中有一个 github 访问令牌，我在<a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/how-to-build-and-publish-an-electron-app-with-react-tutorial-971e1d9d27ce">之前的</a>教程中提到过。此外，在您的环境变量中，您应该有与<strong class="jm io"> GH_TOKEN </strong>变量名相同的标记。<strong class="jm io"> GH_TOKEN </strong>变量对于公共存储库也是必需的。</p><p id="a41a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了能够测试更新功能，我在 Github 上发布了<strong class="jm io"> V0.1.2 </strong>和<strong class="jm io"> V0.1.3 </strong>，然后将<strong class="jm io"> V0.1.2 </strong>下载到我的本地机器上，希望看到更新弹出窗口。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi md"><img src="../Images/7a2a12875e32edb43e5d9644295a86c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chP9vPEb-PZRZ6VJdu875A.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated"><strong class="bd mi">截图一:</strong>更新包<strong class="bd mi"> (V0.1.2) </strong></figcaption></figure><p id="be48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">更新可用</strong>事件看起来像:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mj"><img src="../Images/83abc9705532b22bb2bf600b374361d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRqKY3pdlBRy7pceN660rw.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated"><strong class="bd mi">截图二:</strong>更新-可用事件。</figcaption></figure><p id="c336" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">更新下载</strong>事件看起来像:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mk"><img src="../Images/96858df1bcc9aa9d7c283ae6bea94a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfAN1Wv2EuN9jIeJ0ykY_A.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated"><strong class="bd mi">截图 3: </strong>更新-下载事件。</figcaption></figure><p id="9323" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在所有的改变之后，如果应用程序以一个白色的空白屏幕开始，那么下面的方法调用应该被更新。</p><p id="1057" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">(GitHub electron.js/Line 21)之前:</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="39a5" class="li lj in le b gy lk ll l lm ln">win.loadURL(startUrl);</span></pre><p id="c150" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lc">(GitHub electron.js/Line 22)之后:</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="ba30" class="li lj in le b gy lk ll l lm ln">win.loadURL(‘file:///’ + __dirname + “/index.html”);</span></pre><p id="8aff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，如果您尝试在本地测试自动更新程序，它可能不会工作。为了能够在本地运行它，项目应该有<strong class="jm io"> dev-app-update.yml </strong>并且 electron.js 应该有如下的条件。<em class="lc">(下面的代码只是一个例子。</em> <a class="ae ki" href="https://github.com/cinarrtolga/ART-React-Electron-App" rel="noopener ugc nofollow" target="_blank"> <em class="lc">本项目</em> </a> <em class="lc">不包括它。)</em></p><pre class="kk kl km kn gt ld le lf lg aw lh bi"><span id="317a" class="li lj in le b gy lk ll l lm ln">if (isDevEnv) {<br/>      autoUpdater.updateConfigPath = path.join(__dirname, 'dev-app-update.yml');<br/>}</span></pre><p id="3fcb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可以创建许多不同的更新场景。为了分享这个过程的基本信息，我试着创建一个简单的。<a class="ae ki" href="https://github.com/cinarrtolga/ART-React-Electron-App" rel="noopener ugc nofollow" target="_blank">这里的</a>是教程更新后的源代码。希望这能有所帮助。:)</p><p id="f4f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如有任何补充或错误信息，请联系我。</p></div></div>    
</body>
</html>