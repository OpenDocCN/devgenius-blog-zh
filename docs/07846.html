<html>
<head>
<title>Part 3 — HOW TO: Send Emails from a Spring Boot application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第 3 部分—如何:从 Spring Boot 应用程序发送电子邮件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/part-3-how-to-send-emails-from-a-spring-boot-application-cf0486b2806f?source=collection_archive---------3-----------------------#2022-04-27">https://blog.devgenius.io/part-3-how-to-send-emails-from-a-spring-boot-application-cf0486b2806f?source=collection_archive---------3-----------------------#2022-04-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c08b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">难道现在不是揭开从 Spring Boot 应用程序发送电子邮件这一相当简单的过程的神秘面纱的时候吗？这是一个强大的电子邮件营销或邮件通知或任何其他目的你可能会想到的工具。让我们不要浪费时间，直奔主题。</p><p id="ef83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到<strong class="jm io"> <em class="ki">源代码库</em> </strong>的链接将在本教程的末尾添加。</p><h2 id="3741" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">建立新的 Spring Boot 项目</h2><p id="a086" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">用<strong class="jm io"><em class="ki">Spring Initializr</em></strong>创建一个新项目。我将使用<strong class="jm io"> <em class="ki"> Java 17 </em> </strong>和<strong class="jm io"> <em class="ki"> Maven </em> </strong>，但是你可以选择任何适合你的设置配置。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lh"><img src="../Images/ee2f94cc85f2f9da3cec42174696153b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9y1o55dkWeoxsnjQyns74g.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">用 Spring Initializr 创建一个新的 Spring Boot Maven 项目</figcaption></figure><p id="fb26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将<strong class="jm io"><em class="ki">Java Mail Sender</em></strong>和<strong class="jm io"> <em class="ki"> Lombok </em> </strong>依赖项添加到项目中。这些对于演示来说已经足够了，因为我们不打算构建任何真正复杂的东西。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lx"><img src="../Images/ab7c3188dbb0003db04aae07b2e5c0fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PhsQCRp6UvxJ9L3owOeYw.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">将 Java 邮件发送器和 Lombok 依赖项添加到项目中</figcaption></figure><h2 id="1fca" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">配置邮件属性</h2><p id="7a6d" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">我不会在此赘述，因为我已经在之前的<a class="ae ly" href="https://medium.com/dev-genius/part-2-how-to-configure-properties-in-spring-boot-783c54a39304" rel="noopener"> <strong class="jm io"> <em class="ki">博客</em> </strong> </a>中提供了在 Spring Boot 配置属性的分步指南。如果您已经阅读了那篇文章，您可以跳过这一部分的大部分内容。</p><p id="296b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们在<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">/src/main/resources.</em></strong></code>中创建一个名为<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">mail.properties</em></strong></code>的单独属性文件，将以下配置添加到该文件中(<strong class="jm io"> <em class="ki">不要忘记</em> </strong> <strong class="jm io"> <em class="ki">在需要的地方插入有效信息</em> </strong>):</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="df9f" class="kj kk in mc b gy mh mi l mj mk">mail.transport.protocol=smtp<br/>mail.properties.mail.smtp.auth=true<br/>mail.properties.smtp-starttls-enable=true<br/>mail.properties.mail.smtp.ssl.trust=smtp.gmail.com<br/><br/><em class="ki"># </em><strong class="mc io"><em class="ki">insert valid information instead of these values</em></strong><em class="ki"><br/></em>mail.host=mail.host.domain<br/>mail.port=port<br/>mail.username=username@domain<br/>mail.password=password</span></pre><p id="4c32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，在应用程序中注册这个属性文件。在<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">/src/main/property</em></strong></code>或其任何子文件夹中创建一个新的 Java 类<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">MailProperties</em></strong></code>，并将以下代码放入其中:</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="8b0e" class="kj kk in mc b gy mh mi l mj mk">@Data<br/>@Lazy<br/>@Configuration<br/>@PropertySource("classpath:mail.properties")<br/>@ConfigurationProperties(prefix = "mail")<br/>public class MailProperties {<br/><br/>    @Value("${mail.host}")<br/>    private String host;<br/><br/>    @Value("${mail.port}")<br/>    private Integer port;<br/><br/>    @Value("${mail.username}")<br/>    private String username;<br/><br/>    @Value("${mail.password}")<br/>    private String password;<br/><br/>    @Value("${mail.transport.protocol}")<br/>    private String transportProtocol;<br/><br/>    @Value("${mail.properties.mail.smtp.auth}")<br/>    private String smtpAuth;<br/><br/>    @Value("${mail.properties.smtp-starttls-enable}")<br/>    private String enableSmtpStartTls;<br/><br/>    @Value("${mail.properties.mail.smtp.ssl.trust}")<br/>    private String smtpSslTrust;<br/>    <br/>}</span></pre><p id="282a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，在<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">/src/main/config</em></strong></code>中创建一个<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">MailSenderConfiguration</em></strong></code>类，它将使用上面定义的所有属性来设置 Gmail SMTP 配置，如主机、端口号、用户名和密码:</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="938e" class="kj kk in mc b gy mh mi l mj mk">@Configuration<br/>@AllArgsConstructor<br/>public class MailSenderConfiguration {<br/>    private final MailProperties mailProperties;<br/><br/>    @Bean<br/>    public JavaMailSender emailSender() {<br/>        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();<br/><br/>        mailSender.setHost(mailProperties.getHost());<br/>        mailSender.setPort(mailProperties.getPort());<br/>        mailSender.setUsername(mailProperties.getUsername());<br/>        mailSender.setPassword(mailProperties.getPassword());<br/><br/>        Properties javaMailProperties = mailSender.getJavaMailProperties();<br/>        javaMailProperties.put("mail.smtp.auth", mailProperties.getSmtpAuth());<br/>        javaMailProperties.put("mail.transport.protocol", mailProperties.getTransportProtocol());<br/>        javaMailProperties.put("mail.smtp.starttls.enable", mailProperties.getEnableSmtpStartTls());<br/>        javaMailProperties.put("mail.smtp.ssl.trust", mailProperties.getSmtpSslTrust());<br/>        javaMailProperties.put("mail.debug", "true");<br/><br/>        return mailSender;<br/>    }<br/><br/>}</span></pre><p id="2f76" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">mail.debug = true</em></strong></code>属性将确保我们在本教程结束时尝试发送消息时将在控制台中看到输出。</p><h2 id="6efa" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">创建邮件对象</h2><p id="5109" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">在我们继续创建邮件服务之前，让我们首先定义一个带有简单字段的<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">Mail</em></strong></code>对象，以帮助我们根据需要配置外发消息:</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="5b09" class="kj kk in mc b gy mh mi l mj mk">@Data<br/>public class Mail {<br/>    private String mailFrom;<br/>    private String mailTo;<br/>    private String mailCc;<br/>    private String mailBcc;<br/>    private String mailSubject;<br/>    private String mailContent;<br/>    private String contenType;<br/>    private List&lt;Object&gt; attachments;<br/>}</span></pre><h2 id="7737" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">创建邮件服务</h2><p id="5889" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">完成邮件属性的配置后，我们创建一个新的包<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">service</em></strong></code>，在里面用<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">sendEmail()</em></strong></code>方法创建一个名为<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">MailService</em></strong></code>的接口:</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="4f21" class="kj kk in mc b gy mh mi l mj mk">public interface MailService {<br/><br/>    void sendEmail(Mail mail);<br/><br/>}</span></pre><p id="0564" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，继续创建一个<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">MailServiceImpl</em></strong></code>类并用<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">@Service</em></strong></code>对其进行注释。用<code class="fe lz ma mb mc b"><strong class="jm io"><em class="ki">@Async</em></strong></code>注释该方法，因为我们希望我们的电子邮件在一个单独的线程中发送，并且不妨碍应用程序的运行过程。</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="91a7" class="kj kk in mc b gy mh mi l mj mk">@Service<br/>@AllArgsConstructor<br/>public class MailServiceImpl implements MailService {<br/>    private final JavaMailSender mailSender;<br/><br/>    @Async<br/>    @Override<br/>    public void sendEmail(Mail mail) {<br/>        try {<br/>            MimeMessage mimeMessage = mailSender.createMimeMessage();<br/>            MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, "utf-8");<br/>            helper.setSubject(mail.getMailSubject());<br/>            helper.setFrom(mail.getMailFrom());<br/>            helper.setTo(mail.getMailTo());<br/>            helper.setText(mail.getMailContent(), true);<br/>            mailSender.send(mimeMessage);<br/>        } catch (MessagingException e) {<br/>            throw new RuntimeException(e.getMessage());<br/>        }<br/>    }<br/>}</span></pre><p id="e7d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在方法结束时，填充的 Spring<strong class="jm io"><em class="ki">mime message</em></strong>对象将与附件一起返回，并通过<strong class="jm io"><em class="ki">javamail sender . send()</em></strong>方法发送。</p><h2 id="536b" class="kj kk in bd kl km kn dn ko kp kq dp kr jv ks kt ku jz kv kw kx kd ky kz la lb bi translated">测试应用程序</h2><p id="3db3" class="pw-post-body-paragraph jk jl in jm b jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh ig bi translated">最后，是时候测试我们的应用程序并发送电子邮件了。修改<strong class="jm io">的内容<em class="ki">应用程序的</em>主方法</strong>如下:</p><pre class="li lj lk ll gt md mc me mf aw mg bi"><span id="2429" class="kj kk in mc b gy mh mi l mj mk">@SpringBootApplication<br/>public class MailSenderDemoAppApplication {<br/><br/>    public static void main(String[] args) {<br/>        Mail mail = new Mail();<br/>        mail.setMailFrom("hello@anita.com");<br/>        mail.setMailTo("medium.readers@gmail.com");<br/>        mail.setMailSubject("Thanks!");<br/>        mail.setMailContent("Thank you for reading my blogs!");<br/><br/>        ApplicationContext ctx = SpringApplication.<em class="ki">run</em>(MailSenderDemoAppApplication.class, args);<br/>        MailService mailService = (MailService) ctx.getBean("mailServiceImpl");<br/>        mailService.sendEmail(mail);<br/>    }<br/><br/>}</span></pre><p id="203a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启动应用程序后，一切都应该运行顺利。但是，如果您在发送邮件时遇到类似<strong class="jm io"> <em class="ki">【认证失败】</em> </strong>的错误:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi ml"><img src="../Images/16425a1aeff11ecee5a197c5c505da31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBczMZzLM_4AzG-S3JKLTw.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">MailAuthenticationException</figcaption></figure><p id="a5ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可能需要检查您的 Gmail 帐户安全设置，并打开<strong class="jm io"> <em class="ki">不太安全的应用程序访问</em> </strong>。这不允许用于一般用途，当然，我们这样做只是为了演示:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mm"><img src="../Images/7a474ac798a87760652311aea2ca09b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fijWWgT2-4-7vIxULIDNxg.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">支持不太安全的应用程序访问的 Gmail 帐户设置</figcaption></figure><p id="c0cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">修改该设置后，您可以从控制台输出中看到邮件已成功发送:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mn"><img src="../Images/e10f138e1dcf4f05f297597635818c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3NDAIubBA0QsHTXIAy77w.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">成功发送邮件后的控制台输出</figcaption></figure><p id="505e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！希望真的简单易行！</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><p id="e5f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经成功地创建了一个发送电子邮件的 Spring Boot 项目。如果你错过了什么，所有代码都可以在我的<a class="ae ly" href="https://github.com/anitalakhadze/mail-sender-demo-app" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ki"> GitHub 资源库</em> </strong> </a>找到。</p><p id="a829" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请让我知道你对这个系列中即将到来的博客有什么问题、评论或建议。</p><p id="8fcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki">敬请关注，不要错过以下教程！</em>T9】</strong></p></div></div>    
</body>
</html>