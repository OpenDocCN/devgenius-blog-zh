<html>
<head>
<title>Aggregations in Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹性研究中的聚合</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/aggregations-in-elasticsearch-495503d78b7d?source=collection_archive---------10-----------------------#2022-08-26">https://blog.devgenius.io/aggregations-in-elasticsearch-495503d78b7d?source=collection_archive---------10-----------------------#2022-08-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/09d25d8c31b87fa779bd600e84cf25a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*rw11e2l6akNKD5RcUW70pg.png"/></div></figure><p id="747f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">什么是好人？很高兴在这个系列中再次见到你😁！今天我们就简单说一下 Elasticsearch 中<em class="kp">聚合</em>的概念。</p><p id="3eb8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">汇总</strong>是将数据汇总成指标或统计数据以便进行分析的操作📊。它将帮助您回答以下问题:</p><ul class=""><li id="1fe1" class="kq kr in jt b ju jv jy jz kc ks kg kt kk ku ko kv kw kx ky bi translated">最常去的城市有哪些？</li><li id="5b8c" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated">用户平均年龄是多少？</li><li id="28b2" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated">按性别划分的用户比例是多少？</li></ul><p id="69de" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在让我们看看如何将 Elasticsearch 用于分析。对于本教程，我们将使用在<a class="ae le" href="https://medium.com/@mhdabdel151/the-essentials-of-data-search-in-elasticsearch-ca2efee5509e" rel="noopener">上一篇文章</a>中使用的相同索引，如果你还没有的话，我建议你读一读。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="554f" class="lo lp in lk b gy lq lr l ls lt">PUT users <br/>{<br/>  "settings": {<br/>    "number_of_shards": 2,<br/>    "number_of_replicas": 1<br/>  },<br/>  "mappings": {<br/>    "properties": {<br/>      "name": {<br/>        "type": "text"<br/>      },<br/>      "age": {<br/>        "type": "short"<br/>      },<br/>      "gender": {<br/>        "type": "keyword"<br/>      },<br/>      "quote": {<br/>        "type": "text"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="390f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">进入菜单的<em class="kp">分析</em>标签，打开<em class="kp">可视化库</em>。让我们创建一个新的基于<em class="kp">聚合的</em>可视化，然后选择<em class="kp">竖条</em>表示。您必须通过引用与我们的索引相对应的<em class="kp">索引模式</em>来创建一个视图，这里是<strong class="jt io">用户</strong>。完成后，仪表板应如下所示:</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/42c127f5be10e34f88224bf604c7ba39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PgTWGV01q9o25yWHOjJiUw.png"/></div></div></figure><p id="e53f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">添加一个新的<em class="kp"> X 轴</em> <strong class="jt io">桶</strong>，并为聚合字段选择<em class="kp">术语</em>。我们想要按性别划分的比例，所以我们将在性别方面采取行动。我们的图表生成了。</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lz"><img src="../Images/894be6ebf75215f3f63da6efd34dff62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wODGEJJGe7OGEzYIsDTyFQ.png"/></div></div></figure><p id="020b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请注意，这种表示在这里没有用，因为我们的数据集中只有 3 个用户，这对于大型数据库非常有用。</p><p id="190a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">通过使用 API，我们可以进行聚合。再次打开控制台，我们可以对我们的<strong class="jt io">用户</strong>索引进行<strong class="jt io"> GET </strong>请求，如下所示:</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="148a" class="lo lp in lk b gy lq lr l ls lt">GET users/_search<br/>{<br/> "aggs": {<br/>  "age_average": {<br/>   "avg": {<br/>    "field": "age"<br/>   }<br/>  }<br/> }<br/>}</span></pre><p id="4b4e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这里我们不定义查询，而是进行聚合。在它的定义中，我们会给它一个<em class="kp">的名字(age_average) </em>和一个<em class="kp">的类型</em>。有一套工具可供使用，例如允许按类别对数据进行分组，或计算平均值(<em class="kp"> avg </em>)，以及总和和许多其他操作。在这里，我们指定想要用户索引中字段<em class="kp">年龄</em>的平均值，并打印结果。</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ma"><img src="../Images/90332623eff162e91eeebdcfad554984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V4XNmGvmLX4QxlMI8TxUw.png"/></div></div></figure><p id="6889" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Elasticsearch 将聚合分为三组:</p><ul class=""><li id="9d77" class="kq kr in jt b ju jv jy jz kc ks kg kt kk ku ko kv kw kx ky bi translated"><a class="ae le" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">度量聚合</strong> </a>基于我们可以从文档中提取或通过脚本生成的值，计算平均值等值。这里不支持子聚合。</li><li id="4c38" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated"><a class="ae le" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">桶聚合</strong> </a>将文档全部分组在一起。例如，我们可以通过使用<em class="kp">城市</em>字段上的<em class="kp">术语聚合</em>来检索文档中的所有<em class="kp">城市</em>，并检索 5 个最频繁出现的城市。<br/>弹性搜索将为每个<em class="kp">城市</em>生成一个存储桶，其中包含这些存储桶中的文档数量。与度量聚合不同，桶聚合支持<em class="kp">子聚合</em>。例如，可将<em class="kp">年龄</em>平均值添加到此聚合中。因此，将计算每个时段的平均值。</li><li id="12e9" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated"><a class="ae le" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-pipeline.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">管道聚合</strong> </a>关注其他聚合的结果，而不是文档。有许多不同的品种被分成两个重要的家族。</li></ul><p id="aa8a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可以在同一个查询中运行<em class="kp">多个聚合</em>、返回聚合类型、<em class="kp">在聚合中使用脚本</em>等多种操作。<a class="ae le" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html#search-aggregations" rel="noopener ugc nofollow" target="_blank">这个链接</a>到官方文档将会介绍你在🧗.探险中需要的所有东西</p><p id="9b61" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">今天就到这里。感谢阅读，如果您对本文有任何疑问或评论，请在下面留言。</p><p id="fd4c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">下次我会看到你更多的帖子🚀。</p><p id="8f24" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Abdoul-Bagui M .</p></div></div>    
</body>
</html>