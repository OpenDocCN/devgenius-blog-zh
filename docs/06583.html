<html>
<head>
<title>Accessing VPC Resources Using AWS Client VPN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS 客户端 VPN 访问 VPC 资源</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/accessing-vpc-resources-using-aws-client-vpn-e327aab9767b?source=collection_archive---------5-----------------------#2022-01-18">https://blog.devgenius.io/accessing-vpc-resources-using-aws-client-vpn-e327aab9767b?source=collection_archive---------5-----------------------#2022-01-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8347b5c1de10d34d71681bd1b0f2ed24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bmhf7BYDTyGwm1tQ.jpg"/></div></div></figure><p id="b50e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇文章结束时，我希望你能够解释什么是 VPN，虚拟专用网络，以及如何设置 AWS 客户端 VPN，以访问 VPC，虚拟专用云的 AWS 私有资源。</p><h2 id="f514" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">什么是 VPN？</strong></h2><p id="4d68" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">虚拟专用网络提供了一种在公共或共享网络上扩展专用网络的方式，并使终端能够像在同一网络上一样工作。该连接提供加密，有助于确保敏感数据安全传输，并防止窃听通信。有很多关于 VPN 的信息，所以我将提供一些概念的简要概述。两种主要的 VPN 技术是 IPsec(互联网协议安全)VPN 和 SSL/TLS(安全套接字层/传输层安全)VPN。</p><p id="9146" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">IPsec VPNs 直接运行在 Internet 协议上，在网络层运行。这种类型的 VPN 需要将 VPN 硬件设备放置在内部网络的前端。想要连接的用户必须安装能够连接到 VPN 设备的软件应用程序。一旦建立了安全连接，用户就可以访问整个网络。</p><p id="b237" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">SSL VPNs 使用传输层安全性来加密流量，并在第 4-7 层运行。SSL VPNs 不需要在主机上安装客户机，而是利用 web 浏览器。加密只发生在与浏览器相关的互联网活动中；在浏览器之外做的任何事情都不受保护。这种类型的 VPN 用于将用户连接到特定的应用程序和服务，而不是整个网络。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/f4e3001f406560faf4715bedaecef794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/0*jfBJ6YMnlCSeNNmW.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">比较 IPsec 和 SSL VPNs</figcaption></figure><p id="45ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有站点到站点 VPN 和远程访问 VPN。IPsec VPNs 通常用于站点到站点 VPN。站点到站点 VPN 将安全地连接不同物理位置的两个或多个 LAN(局域网)。这对于连接拥有多个办公室的组织的网络，创建 WAN(广域网)非常有用。在这里，一个远程局域网的 VPN 网关与另一个局域网的网关通信，以创建一个安全的隧道，因此不需要 VPN 客户端。网关负责数据的认证、加密和完整性。</p><p id="ffe1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一方面，远程访问 VPN 允许单个用户连接到一个安全的网络，就像他们直接接入网络一样。当远程员工需要访问公司局域网上的安全资源时，通常会出现这种情况。远程用户的设备负责加密和解密发送或接收的数据。它需要 NAS(网络访问服务器)或 VPN 网关来验证试图登录 VPN 的设备的凭证。客户端软件需要与 VPN 网关进行通信，VPN 网关会将您验证为远程用户，并在局域网和网关之间创建一个安全的隧道。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/99c20038dbce4d4d52ec6fc93a4d3532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Z_qP6w9Q2NKR7rd1w2shw.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">站点到站点与远程访问 VPN</figcaption></figure><p id="0310" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们对 VPN 有了一点了解，我将介绍如何设置远程访问 VPN，以便访问我的 VPC 的专用子网中的资源。</p><h2 id="d51a" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">设置您的环境</h2><p id="5eaf" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">导航至 AWS 控制台，然后导航至 VPC 仪表板，选择您希望设置此功能的区域。请注意，某些服务在某些地区不可用。我用的是 us-east-1 N. Virginia，没有问题。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/71c9f6375abae4dcde93c4cd9a884baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRBrKXZUZJBsf_WRZwxeCA.png"/></div></div></figure><p id="f42a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要为 NAT 网关提供一个弹性 IP 地址。点击侧边栏上的<strong class="jx io">弹性 IPs </strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/684f02d7048c816ef811d6879095c822.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*uecp751-pahg-xtzZFRRUQ.png"/></div></figure><p id="f889" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">分配弹性 IP 地址</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/d3ac52b168e7b315d2ea6d745301f7ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GlFl9xetLHAiRm7yKkUWaw.png"/></div></div></figure><p id="3280" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我在这里保留默认设置。在“标签”下，为其提供一个名称，以便于识别。我把我的命名为 VPN 弹性 IP。完成后点击<strong class="jx io">分配</strong>。记下分配的 IPv4 地址，因为我们将需要它来应用到 VPC。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/739e8f3f4e1af5bbb87adfb8b0ff5d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdW6djWRyfIE0NAacjvwbQ.png"/></div></div></figure><p id="6cb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">返回侧边栏的<strong class="jx io"> VPC 仪表盘</strong>。如果你还没有建立 VPC，你可以在这里查看我以前的帖子。但是，有一种简单的方法可以使用 VPC 向导快速设置带有公共和私有子网的 VPC。点击<strong class="jx io">启动 VPC 向导</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/0977416a47c8a49110bebc74f4facad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7hKCW7SVa4-PFCW1gOMYQ.png"/></div></div></figure><p id="aa3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择第二个选项<strong class="jx io">带有公共和私有子网的 VPC</strong>，然后点击<strong class="jx io">选择</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/ed11c3878c6e7ed41acd348344f70f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJiVhr5yn8_eJt21I7YhVA.png"/></div></div></figure><p id="7d89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">提供一个名称来标识此 VPC。这里我将保留 IPv4 CIDR 块以及公共和私有子网的默认配置。请不要记下专用子网的地址，因为我们稍后在配置 VPN 端点时会用到它。为<strong class="jx io">弹性 IP 分配 ID </strong>选择我们在上一步中创建的弹性 IP。点击<strong class="jx io">创建 VPC </strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/424b0a1b4d068b791c2bd9af58e5e805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNu78KRHZnACw3zVg3j_Yw.png"/></div></div></figure><p id="c987" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这可能需要几分钟时间，以便 NAT 网关状态变为可用。</p><p id="4d03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经有了一个设置了公共和私有子网的 VPC，让我们开始创建远程访问 VPN。</p><h2 id="b559" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">创建远程访问 VPN </strong></h2><p id="3ab5" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">创建远程访问 VPN 将允许我们访问专用网络上的资源。我们将使用 AWS 客户端 VPN 为我们的通信创建一个安全通道。</p><h2 id="9cf0" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">创建认证</strong></h2><p id="fd4d" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">我将在我托管在虚拟机上的 Kali Linux 上设置客户端连接。在其他操作系统和发行版上进行设置可能与我在这里展示的不同。我将使用 easy-rsa，这是一个 CLI 实用程序，用于构建和管理 PKI CA(公钥基础设施认证中心)。它将创建一个根证书颁发机构，并请求和签署证书，包括中间 ca 和证书吊销列表(CRL)。可以在<a class="ae mf" href="https://github.com/OpenVPN/easy-rsa" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p><p id="1497" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，创建一个目录，我们可以将这个存储库克隆到其中。取一个有助于你识别其用途的名字。我将把我的命名为“远程访问 vpn”</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/18ee90796c89bc090b950e5bd49f5367.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*8tkUI_CdyNUD40UR9oDR4A.png"/></div></figure><p id="ff61" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">切换到您刚刚创建的目录。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/b29258d8c830505e46007cb60fdd412a.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*tUY024uT6din73YhqPJNJQ.png"/></div></figure><p id="b5ed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将 easy-rsa 存储库从 Github 克隆到新创建的目录中。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/50ca37e51d4bd0f8bca2cf3337a3d666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*8nfvNkFChySjBneoUxIgFA.png"/></div></figure><p id="70bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到 easy-rsa 目录中的 easyrsa3 目录。在这里你会发现 easyrsa 二进制。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/a4e449cf4e28885dfdf64309dda0f4e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*jAyZH2cx29Wf90S23ur6DQ.png"/></div></figure><p id="aff9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行 easyrsa 二进制文件为 VPN 创建一个新的 PKI 环境。这将允许我们创建一个证书颁发机构或请求，并将为 PKI 创建一个新目录。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/74331b008f5694448499cfdde8b55880.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*UlWVGAX3aWPMwire5bgHSw.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">创建新的 PKI 环境</figcaption></figure><p id="a4bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将通过运行以下命令并在出现提示时提供一个可识别的名称来构建一个新的证书颁发机构(CA)。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4097376e2458a3c2b88f5e44d86f716c.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*25QZWKqPv2_qV0-ui59NBQ.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">创建新的证书颁发机构</figcaption></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/98fd1654afb1d082f93c64467b03c4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thlpGfX8RJ8j0ZhYbN3egA.png"/></div></div></figure><p id="6ef1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然已经创建了证书颁发机构，我们就可以生成服务器和客户端的密钥和证书了。使用以下命令创建服务器密钥和证书:</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/33450e0e252f9c877a87f8fc370aa3f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*0e8m1tpioQR830DRvhsg-w.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">创建服务器密钥和证书</figcaption></figure><p id="776c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用以下命令生成客户端密钥和证书:</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/89705e6ffb2f2b6a61f3f3c343bde199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*3LSdut5O3sjl16rFSApa5A.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">创建客户端密钥和证书</figcaption></figure><p id="e1d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个目录，以便复制服务器和客户端的密钥和证书。将密钥和证书复制到新目录后，导航到该新目录。我创建了一个名为“VPN_certs”的目录，但是您可以使用您喜欢的任何目录。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/22df2df13309bfbcb731ba3db9b5deb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*ohSewqFLore5ZbGXbHQTZQ.png"/></div></figure><h2 id="9326" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">将证书导入 AWS </strong></h2><p id="655c" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">现在我们有了客户机和服务器的密钥和证书，我们需要将它们导入 AWS。在 AWS 控制台中搜索<strong class="jx io">证书管理器</strong>并导航到那里</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/2691ff1604183f40704e8390d9763c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAlwfegUX80V8tPfvXzqVw.png"/></div></div></figure><p id="2321" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">导入证书</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/5d03d25bc8e0fa14f9b8119411ff1da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GT_k_1HxNc-NWKCPBGP4Aw.png"/></div></div></figure><p id="02c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将设置证书，为用户提供一种方法来初始化 VPN 连接，验证身份，并提供访问私有子网的授权。</p><p id="dc48" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<strong class="jx io"> client1.domain.tld.crt </strong>的内容复制粘贴到<strong class="jx io">证书体</strong>字段中。对于所有证书和密钥，仅复制显示从证书开始到证书结束的文本，包括所有破折号。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/07ce761b1e7979cd74805978a8676e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4GhvKJolu2WI_3RUklw_Q.png"/></div></div></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/93b3989541182a6c34376c4124666c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtzbmFEKFs2gqnIF1jI_Og.png"/></div></div></figure><p id="9846" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<strong class="jx io"> client1.domain.tld.key </strong>的内容复制粘贴到<strong class="jx io">证书私钥</strong>字段。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/607b2d58ee2d0df554fe0a887292bde9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W3jbCtefLK4S895i5NWJrw.png"/></div></div></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/dbbfd62e28f0f4fb5846937d22bbed49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoPWc4OHqSiJdHMtBLQYoQ.png"/></div></div></figure><p id="a1e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，将<strong class="jx io"> ca.crt </strong>的内容复制粘贴到<strong class="jx io">证书链</strong>字段，完成后点击<strong class="jx io">下一步</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/50f684f9106e7e2c60de8ad38e3d29ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNj-zYeszSCdE1Nmm1Lo0w.png"/></div></div></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/a996524469bcc01f210890e944b8b4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oX2pBPXe4HG67bDW1_of3A.png"/></div></div></figure><p id="1dd2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">可选—添加标签以帮助您记住这是干什么用的。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/e3047b8995a10c72a1ecfed2ddc0f23e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7ES_Cav3EZ1OVJLusdryQ.png"/></div></div></figure><p id="de56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将被带到审查和导入页面。查看完所有内容后，点击<strong class="jx io">导入</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/44d773f4f4273bdb3346c240900b7b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*VZZrtjlf5kZ_Mj8PJ8hVVg.png"/></div></figure><p id="b1fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对<strong class="jx io"> server.crt </strong>和<strong class="jx io"> server.key </strong>文件重复上述步骤。将<strong class="jx io"> server.crt </strong>放入<strong class="jx io">证书体</strong>中。将<strong class="jx io"> server.key </strong>放入<strong class="jx io">证书私钥</strong>中。对<strong class="jx io">证书链</strong>使用与上述步骤相同的<strong class="jx io"> ca.crt </strong>。</p><p id="e7d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建 VPN 端点</strong></p><p id="1dfc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">导航回到<strong class="jx io"> VPC 控制台</strong>。在侧边栏中选择<strong class="jx io">虚拟专用网络(VPN)下的<strong class="jx io">客户端 VPN 端点</strong>。</strong></p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b111785a1209a5c4475411bde38e3d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*QDt4Lxk25eUAhW17w9p80Q.png"/></div></figure><p id="841d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">创建客户端 VPN 端点</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/ac80c5df503e09b67835b18522d9ca75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wheo3O4Y09bkJkOdjitXMA.png"/></div></div></figure><p id="f76c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输入有助于识别端点的名称。为<strong class="jx io">客户端 IPv4 CIDR </strong>输入一个地址范围。当客户端连接到 VPN 时，它将被分配一个 CIDR 范围内的 IP 地址。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/f6112ccb2d689f1fe670d7f144ecddbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykkEyfdPl_M5boGVtXKViw.png"/></div></div></figure><p id="ae81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为<strong class="jx io">服务器证书 ARN 选择<strong class="jx io">服务器</strong>。</strong></p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/eceee68840bc9e23d34dbe8867f14185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7Zf5dJErlSC8dCYjCu2Dg.png"/></div></div></figure><p id="4a15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<strong class="jx io">认证选项</strong>中选择<strong class="jx io">相互认证</strong>。这将允许您为<strong class="jx io">客户端证书 ARN </strong>选择<strong class="jx io">客户端</strong>。为了建立 VPN 连接，服务器和客户端都需要被认证。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/6e7c33a8ee170f1b0e74d8989c48607c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nk_1TUCmLT-PTXRiZv3Bbg.png"/></div></div></figure><p id="9795" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为这个 VPN 的设置是为了更好地理解它是如何工作的，所以我不会记录客户端连接。然而，对于一个组织来说，我希望通过日志来查看是谁在与 VPN 建立这些连接。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/db8ab755e4d080750cbcd2669784e084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*AC2fQrSSZZDbwswYNwkD1A.png"/></div></div></figure><p id="476c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将传输协议设置为<strong class="jx io"> TCP </strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e8a913bde38167073f01bb6b2161a908.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*ly3CO7F96NWwBCZFsl-MYQ.png"/></div></figure><p id="bce4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">启用切分通道。分割隧道只会加密发往远程专用网络的流量。所有其他流量都不会通过安全隧道发送。这不同于所有流量都通过 VPN 隧道发送的全隧道。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/328ea69583d973081eedf34ca94e0b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*of1LZPZT8h6X-rScw1c3MA.png"/></div></figure><p id="703f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">创建客户端 VPN 端点</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/353c7ec823b24c2c655aadb45e7b502b.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*ichFZEBkpfC5CtUCHNz2wA.png"/></div></figure><p id="c53a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">关联 VPC 并允许进入</strong></p><p id="4a77" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">关联</strong>选项卡。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/c0c549beb65a2ed7faf68a58a9a966e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4NxvM9739l_Uh40oqquDCQ.png"/></div></div></figure><p id="9235" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">关联</strong>按钮。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/964c58a6bbbb504201690518f96f24ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkZYtyOYFm0ZiYa6uIoxJg.png"/></div></div></figure><p id="e3b6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择之前创建的<strong class="jx io"> VPC </strong>，然后为<strong class="jx io">选择<strong class="jx io">专用子网</strong>，选择要关联的子网</strong>。您可能需要在另一个选项卡中打开 VPC 控制台，以检查<strong class="jx io">专用子网</strong>的子网 ID 。点击<strong class="jx io">关联</strong>和<strong class="jx io">关闭</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/d6a6234431fd5d01730151ddaa9f2a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-XxK1x7KUxFKdcCt9wmdw.png"/></div></div></figure><p id="9c31" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，导航到<strong class="jx io">授权</strong>选项卡和<strong class="jx io">授权入口</strong>。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/bf88713fc2ea3835a6ea48b055b8ec10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VZETaCa8szhs0bTHWBvFsw.png"/></div></div></figure><p id="fc45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输入您的<strong class="jx io">私有子网</strong>的<strong class="jx io"> IPv4 CIDR </strong>作为<strong class="jx io">目的网络，启用</strong>，然后<strong class="jx io">添加授权规则</strong>。这定义了我们将能够通过 VPN 连接访问的专用网络。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/95ff1d728fc5954fad0b6211667b4ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aebV3ns0fm3r2kPsAtemSA.png"/></div></div></figure><h2 id="7455" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">连接到 VPN </strong></h2><p id="8900" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">现在我们需要<strong class="jx io">下载客户端配置</strong>到我们的主机。这是将用于启动 VPN 连接的文件。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/8ed123afc20f11347aea2638d2be6815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqaOCC6G7WTxLA51_ABieA.png"/></div></div></figure><p id="5c9d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将文件保存到我们之前创建的 VPN_certs 目录中。我们需要将客户端证书和密钥附加到 downloaded-client-config.ovpn 的末尾。这将允许我们对 vpn 进行身份验证。</p><p id="cdf1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我使用的是 vim，但是您可以使用您喜欢的任何文本编辑器。一直到底部，在“reneg-sec 0”后输入下面的两行。</p><p id="5868" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">cert&lt;path _ to _ VPN _ certs _ folder&gt;/client 1 . domain . TLD . CRT</strong></p><p id="3e83" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">key&lt;path _ to _ VPN _ certs _ folder&gt;/client 1 . domain . TLD . key</strong></p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/1b8b9de79960772e868d3bf0293aaf1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*qepx8eXu1HHSPD6bFz93ZQ.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">将证书和密钥行添加到 ovpn 配置文件的底部</figcaption></figure><p id="823f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用添加的密钥和证书保存文件。</p><p id="8e57" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们有了启动 vpn 的 ovpn 文件，我们需要验证连通性。在测试之前，您必须确保客户端 VPN 端点状态在 AWS 上可用。创建 ovpn 文件后，可能需要一点时间才能从挂起变为可用。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4a0a2f5d65052ef52f81b821a12822be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*Eav0MY6_bf_B_JqYPytGlQ.png"/></div></figure><p id="a17a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然 VPN 端点已经配置好并且可用，那么让我们看看是否可以通过新创建的 VPN 建立到 VPC 私有子网的连接。运行以下命令:</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/d5c8e6a1623508ccc5dd3f7b6810a580.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*tZjI8HQ9dYz2FnOMrZ4bJg.png"/></div></figure><p id="dfc4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果连接成功，最后一行应该说初始化序列完成。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/c5f1c05af68e0a3e93518eb8895b7cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osZg6bmJCG00h8_LhqJw6Q.png"/></div></div></figure><p id="4afd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然连接已经建立，我们就可以测试是否可以访问私有子网中的资源。如果您没有设置任何 EC2 实例，请参考我以前的博文，了解如何在私有子网中设置实例。我将该实例上的安全组设置为默认，允许所有流量进入。不要将它放在公共子网中，因为让它开放会使它容易受到攻击。私有子网中的实例不应该对公共互联网可用，而只能对私有网络中的其他设备可用。</p><p id="701f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">建立了 VPN 连接后，我的客户机就能够与服务器通信了——基本上就像我接入了私有子网一样。我能够 ping 通 Wordpress 服务器并建立 SSH 连接。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9ad273352deb9c0f5f1bd411c67192b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*kVGy_uWOi0hLgoanwIp6Pw.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">对私有子网中的实例执行 ping 操作</figcaption></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/98a103cbb1e4b4461b08e0436dea5a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8cKIUW1zuHSj6GDWUvJ6g.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">到专用子网中实例的 SSH 连接</figcaption></figure><p id="48ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果不使用 VPN，我就无法建立到私有子网中实例的连接。我尝试 SSH，请求在返回连接被拒绝之前挂起了相当长的时间。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/da339487a21ff852e2dd8cffae408edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*6G1B6PnaIiXpTWC85hP1ug.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">尝试在没有 VPN 的专用子网中 ping 实例</figcaption></figure><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/d940b05ad957e9510ba6794df3f2f329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*ZU2rwY6lvIDt5hKzxfEmpw.png"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">尝试在没有 VPN 连接的情况下进行 SSH</figcaption></figure><h2 id="7f70" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">结论</h2><p id="4321" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">尝试连接到 VPC 专用子网中的实例，无论有没有 VPN，都展示了远程访问 VPN 的概念。这是许多远程员工用来访问安全网络中的资源的方式。使用 VPN 有助于防止对安全网络中的资源进行未经授权的访问，并通过加密来保持机密性。希望通过设置远程访问 VPN，可以了解用户如何进行身份验证，并使用密钥和证书启动到专用网络的 VPN 连接，以确保身份验证。</p><p id="ad5b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nv">加入我们的</em> <strong class="jx io"> <em class="nv"> </em> </strong> <a class="ae mf" href="https://blog.devgenius.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="nv">每周简讯</em> </strong> </a> <em class="nv">了解开发者正在做的一切。更多内容请点击</em><a class="ae mf" href="https://blog.devgenius.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nv">blog . devgenius . io</em></strong></a><em class="nv">💻</em></p></div></div>    
</body>
</html>