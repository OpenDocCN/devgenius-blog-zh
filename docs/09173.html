<html>
<head>
<title>Interesting Python tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有趣的 Python 技巧</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/interesting-python-tricks-77567d75e2bd?source=collection_archive---------13-----------------------#2022-08-03">https://blog.devgenius.io/interesting-python-tricks-77567d75e2bd?source=collection_archive---------13-----------------------#2022-08-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b344" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Python 上人类可读的正则表达式与数据处理加速</h2></div><p id="dfec" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">分享一些我最近穿越的有趣的 Python 小技巧。</p><h1 id="0765" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">Python 上人类可读的正则表达式</h1><p id="dca9" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">有时，我们需要编写 r <a class="ae lv" href="https://www.w3schools.com/python/python_regex.asp" rel="noopener ugc nofollow" target="_blank">正则表达式</a>来处理文本。但是，由于我不经常使用，所以只有基本的规则能快速浮现在我的脑海中。所以我之前的策略是在网上搜索和试错，直到我看到了<a class="ae lv" href="https://towardsdatascience.com/pregex-write-human-readable-regular-expressions-in-python-9c87d1b1335" rel="noopener" target="_blank">这篇文章</a>，感谢<a class="lw lx ep" href="https://medium.com/u/84a02493194a?source=post_page-----77567d75e2bd--------------------------------" rel="noopener" target="_blank"> Khuyen Tran </a>。</p><p id="ebc3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">相当有趣。让我们赶紧试试<a class="ae lv" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>(在线 Jupyter 笔记本服务)，“!pip install pregex”显示“找不到合适的 pregex 版本”。按照 pypi.org 的说法，“元节”</p><div class="ly lz gp gr ma mb"><a href="https://pypi.org/project/pregex" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">pregex</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">PRegEx 是一个 Python 包，可以用来以一种更加人性化的方式构造正则表达式模式…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">pypi.org</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp mq mb"/></div></div></a></div><p id="8abc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面明明说需要 Python ≥3.9，默认 Google Colab Python 是 3.7。下面是你如何在 Google Colab 上安装 Python 3.10。</p><h2 id="dc09" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">更新 Ubuntu apt</h2><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="8792" class="mr kz in ni b gy nm nn l no np">!sudo apt update &amp;&amp; sudo apt upgrade -y</span></pre><h2 id="186b" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">添加软件存储库</h2><p id="bba8" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">安装添加自定义 PPAs 所需的依赖项，将死蛇 PPA 添加到 APT 软件包管理器源列表中。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="6294" class="mr kz in ni b gy nm nn l no np">!sudo apt install software-properties-common -y</span><span id="f9dd" class="mr kz in ni b gy nq nn l no np">!sudo add-apt-repository -y ppa:deadsnakes/ppa</span></pre><h2 id="8c09" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">安装 Python 3.10</h2><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="f282" class="mr kz in ni b gy nm nn l no np">!sudo apt install python3.10 -y</span></pre><h2 id="5f90" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">为 Python 3.10 安装 pip</h2><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d7a9" class="mr kz in ni b gy nm nn l no np">!sudo apt -y install python3-pip<br/>!wget <a class="ae lv" href="https://bootstrap.pypa.io/get-pip.py" rel="noopener ugc nofollow" target="_blank">https://bootstrap.pypa.io/get-pip.py</a><br/>!python3.10 get-pip.py<br/>!python3.10 -m pip install --upgrade pip</span></pre><h2 id="ee4b" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">检查 Python，pip 版本</h2><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="5e1f" class="mr kz in ni b gy nm nn l no np">!python3.10 -V<br/># Python 3.10.5<br/>!pip --version<br/># pip 22.2.1 from /usr/local/lib/python3.10/dist-packages/pip (python 3.10)</span></pre><p id="0be5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们最初想要的</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d0e8" class="mr kz in ni b gy nm nn l no np">!pip install pregex==1.0.5<br/># !python3.10 -m pip install pregex</span></pre><p id="c9b9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于 Google Colab 是基于 Jupyter 的，默认内核仍然是 Python 3.7。所以不能用笔记本来测试，需要用 Python3.10 来测试。首先，让我们使用<a class="ae lv" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#cellmagic-writefile" rel="noopener ugc nofollow" target="_blank">" % writefile "</a>魔法命令创建一个文件。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="1c25" class="mr kz in ni b gy nm nn l no np">%%writefile preg.py<br/># <a class="ae lv" href="https://github.com/khuyentran1401/Data-science/blob/master/productive_tools/pregex.ipynb" rel="noopener ugc nofollow" target="_blank">https://github.com/khuyentran1401/Data-science/blob/master/productive_tools/pregex.ipynb</a></span><span id="a391" class="mr kz in ni b gy nq nn l no np">from pregex.quantifiers import Optional, AtLeastOnce, AtLeastAtMost<br/>from pregex.classes import AnyFrom, AnyDigit, AnyWhitespace, AnyButWhitespace, Any<br/>from pregex.groups import CapturingGroup<br/>from pregex.tokens import Backslash<br/>from pregex.operators import Either<br/>from pregex.pre import Pregex</span><span id="0613" class="mr kz in ni b gy nq nn l no np">import re</span><span id="e45f" class="mr kz in ni b gy nq nn l no np">text = "You can find me through GitHub <a class="ae lv" href="https://github.com/khuyentran1401" rel="noopener ugc nofollow" target="_blank">https://github.com/khuyentran1401</a>"</span><span id="c134" class="mr kz in ni b gy nq nn l no np">pre = (<br/>    "https://"<br/>    + AtLeastOnce(AnyButWhitespace())<br/>    + Either(".com", ".org")<br/>    + AtLeastOnce(AnyButWhitespace())<br/>)<br/>print(pre)<br/>print(pre.get_matches(text))</span></pre><p id="cd17" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 Python 3.10 运行</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="22c5" class="mr kz in ni b gy nm nn l no np">!python3.10 preg.py</span></pre><p id="41ff" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它打印生成的正则表达式，并从文本中提取期望的字符串。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="8bdb" class="mr kz in ni b gy nm nn l no np">https\:\/\/[^\s]+(?:\.com|\.org)[^\s]+<br/>['<a class="ae lv" href="https://github.com/khuyentran1401'" rel="noopener ugc nofollow" target="_blank">https://github.com/khuyentran1401'</a>]</span></pre><h1 id="398d" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">加速 Python 数据处理</h1><p id="1e30" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">如果你使用 Python 做数据处理，可能你会经常听到这个建议:不要使用 for 循环，使用矢量化方法以获得更好的性能。事实证明这太简单了，我们不应该仅仅基于这种假设就使用矢量化方法。根据<a class="ae lv" href="https://numpy.org/doc/stable/reference/generated/numpy.vectorize.html" rel="noopener ugc nofollow" target="_blank"> numpy 文档</a>，提供矢量化功能主要是为了方便，而不是为了提高性能。该实现本质上是一个 for 循环。还有一篇有趣的文章:</p><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/dont-assume-numpy-vectorize-is-faster-dd7e455dba2" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">不要认为 NumPy.vectorize 更快</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">用不同的向量化函数解决生日悖论</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="nr l mm mn mo mk mp mq mb"/></div></div></a></div><p id="a04d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，当涉及到数据时，就算法而言，你应该考虑基于集合的<a class="ae lv" href="https://www.codeproject.com/Articles/34142/Understanding-Set-based-and-Procedural-approaches" rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae lv" href="https://www.sqlshack.com/t-sql-asset-set-based-programming-approach/" rel="noopener ugc nofollow" target="_blank"> 2 </a>或矢量化方法<a class="ae lv" href="https://medium.com/productive-data-science/why-you-should-forget-for-loop-for-data-science-code-and-embrace-vectorization-696632622d5f" rel="noopener"> 1 </a>、<a class="ae lv" href="https://resources.experfy.com/bigdata-cloud/why-you-should-forget-loops-and-embrace-vectorization-for-data-science/" rel="noopener ugc nofollow" target="_blank"> 2 </a>、<a class="ae lv" href="https://python.plainenglish.io/pandas-how-you-can-speed-up-50x-using-vectorized-operations-d6e829317f30" rel="noopener ugc nofollow" target="_blank"> 3 </a>，而不是逐行、程序化或 for 循环的方式处理数据。例如，列表理解是一种比 For 循环更好的技术(性能、可读性)。</p><div class="ly lz gp gr ma mb"><a href="https://switowski.com/blog/for-loop-vs-list-comprehension" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">对于循环和列表理解</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Python 中许多简单的“for 循环”可以用列表理解来代替。你经常可以听到列表理解…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">switowski.com</p></div></div><div class="mk l"><div class="ns l mm mn mo mk mp mq mb"/></div></div></a></div><p id="7d2b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于不同的框架，也有其他的技术，例如<a class="ae lv" href="https://numba.pydata.org" rel="noopener ugc nofollow" target="_blank"> numba </a></p><h2 id="9295" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">numpy</h2><p id="1a6c" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">下面的文章讨论了使用 numba 矢量化装饰器来创建高性能的 ufuncs</p><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/numpy-ufuncs-the-magic-behind-vectorized-functions-8cc3ba56aa2c" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">NumPy ufuncs——矢量化函数背后的魔力</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">了解 NumPy 通用函数(ufuncs)以及如何创建它们。编写自己的矢量化函数。</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="nt l mm mn mo mk mp mq mb"/></div></div></a></div><h2 id="b042" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">熊猫</h2><p id="a622" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">你也可以使用“numba”来优化熊猫的性能。</p><div class="ly lz gp gr ma mb"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#numba-jit-compilation" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">增强性能- pandas 1.4.3 文档</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">在教程的这一部分，我们将研究如何加速熊猫数据帧上的某些函数操作…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">pandas.pydata.org</p></div></div><div class="mk l"><div class="nu l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://coderzcolumn.com/tutorials/python/guide-to-speed-up-code-involving-pandas-dataframe-using-numba" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">如何用 Numba 加速涉及熊猫 DataFrame 的代码？作者桑尼·索兰基</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Numba 是一个非常常用的库，用来加速 Python 代码的计算。它让我们通过…来加速我们的代码</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">coderzcolumn.com</p></div></div><div class="mk l"><div class="nv l mm mn mo mk mp mq mb"/></div></div></a></div><p id="a69d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在 select pandas 方法中指定 engine="numba "关键字。就性能而言，第一次使用 Numba 引擎运行函数会很慢，因为 Numba 会有一些函数编译开销。但是，JIT 编译的函数是缓存的，后续调用会很快。</p><div class="ly lz gp gr ma mb"><a href="https://medium.com/analytics-vidhya/understanding-vectorization-in-numpy-and-pandas-188b6ebc5398" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">理解 NumPy 和 Pandas 中的矢量化</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">仅仅几天前，我的导师停下来说明了一点。“做你自己一个…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">medium.com</p></div></div><div class="mk l"><div class="nw l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://python.plainenglish.io/pandas-how-you-can-speed-up-50x-using-vectorized-operations-d6e829317f30" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">如何使用向量化操作加速 Pandas 数据操作</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">使用矢量化运算使 pandas 数据运算速度提高 50 倍的指南。</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">python .平原英语. io</p></div></div><div class="mk l"><div class="nx l mm mn mo mk mp mq mb"/></div></div></a></div><p id="0b6c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ny">矢量化方法比系列应用和系列映射更快。当数据变大时，我们总是希望坚持矢量化的操作，序列或数组。我们应该尽可能避免争吵。当没有可用于您的用例的矢量化操作时，请坚持使用地图操作。这是复习各种文章后的指导方针。</em></p><div class="ly lz gp gr ma mb"><a href="https://pythonspeed.com/articles/pandas-vectorization/" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">熊猫向量化:更快的代码，更慢的代码，臃肿的内存</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">当你用 Pandas 处理数据时，所谓的“矢量化”操作可以显著提高代码速度。或者在…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">pythonspeed.com</p></div></div><div class="mk l"><div class="nz l mm mn mo mk mp mq mb"/></div></div></a></div><p id="60d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面文章中的代码显示了字符串矢量化比非矢量化方法慢(因为它不是完全矢量化，而是在某些时候使用了非矢量化方法)</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="113f" class="mr kz in ni b gy nm nn l no np">import pandas as pd<br/>import time<br/>df = pd.DataFrame({<br/>    'sentences': ['9910 Surrey Avenue','92 N. Bishop Avenue','9910 Golden Star Avenue', '102 Dunbar St.', '17 West Livingston Court']<br/>})</span><span id="bb08" class="mr kz in ni b gy nq nn l no np"># ... Vectorized operation:<br/>start = time.time()<br/>df["sentence_length"] = df["sentences"].str.split().apply(<br/>    len)<br/>end = time.time()<br/>print(end-start)</span><span id="d069" class="mr kz in ni b gy nq nn l no np"># ... Non-vectorized operation:<br/>def sentence_length(s):<br/>    return len(s.split())</span><span id="1cd9" class="mr kz in ni b gy nq nn l no np">start = time.time()<br/>df["sentence_length2"] = df["sentences"].apply(<br/>    sentence_length<br/>)<br/>end = time.time()<br/>print(end-start)</span></pre><p id="1da8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">结果</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="23ff" class="mr kz in ni b gy nm nn l no np"># vectorized: 0.006185054779052734<br/># non-vectorized: 0.0014357566833496094</span></pre><p id="0189" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用于计算数据帧中句子长度的正确矢量化代码如下。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="e2bc" class="mr kz in ni b gy nm nn l no np">start = time.time()<br/>df["sentences"].str.split().str.len()<br/>end = time.time()<br/>print(end-start)<br/># 0.0017879009246826172</span></pre><div class="ly lz gp gr ma mb"><a href="https://medium.com/pythoneers/enhance-python-performance-with-cython-numba-and-eval-fdd4b34c777c" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">使用 Cython、Numba 和 Eval()增强 Python 性能</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">数据科学和软件开发的简单概念</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">medium.com</p></div></div><div class="mk l"><div class="oa l mm mn mo mk mp mq mb"/></div></div></a></div><p id="2648" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">展示 numba 如何加快熊猫的功能。</p><div class="ly lz gp gr ma mb"><a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.10-working-with-strings.html" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">矢量化字符串操作</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Python 的一个优势是它相对容易处理和操纵字符串数据。熊猫以此为基础…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">jakevdp.github.io</p></div></div></div></a></div><p id="f553" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">列出熊猫支持的一些矢量化字符串操作。</p><h2 id="3c45" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">PySpark</h2><p id="920a" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">它有<a class="ae lv" href="https://databricks.com/blog/2017/10/30/introducing-vectorized-udfs-for-pyspark.html" rel="noopener ugc nofollow" target="_blank"> pandas_udf </a>(也称为矢量化 udf)，使用<a class="ae lv" href="https://arrow.apache.org/docs/2.0/python/cuda.html#numba-integration" rel="noopener ugc nofollow" target="_blank"> Apache Arrow </a>，在 Python 中定义低开销、高性能的 UDF。</p><div class="ly lz gp gr ma mb"><a href="https://spark.apache.org/docs/3.0.0/sql-pyspark-pandas-with-arrow.html" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">配有阿帕奇箭的熊猫 PySpark 使用指南</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Apache Arrow 是内存中的列数据格式，在 Spark 中用于在 JVM 和…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">spark.apache.org</p></div></div><div class="mk l"><div class="ob l mm mn mo mk mp mq mb"/></div></div></a></div><p id="7767" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是，numba +熊猫 UDF 能进一步提速吗？</p><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/enhancing-optimized-pyspark-queries-1d2e9685d882" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">增强优化的 PySpark 查询</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">梦想成真的故事</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="oc l mm mn mo mk mp mq mb"/></div></div></a></div><p id="1b5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用以下内容比较熊猫 UDF 和农巴 UDF 的表现:</p><ol class=""><li id="1b09" class="od oe in ke b kf kg ki kj kl of kp og kt oh kx oi oj ok ol bi translated">熊猫 UDF</li><li id="2ff2" class="od oe in ke b kf om ki on kl oo kp op kt oq kx oi oj ok ol bi translated">熊猫 UDF 调用“数字”功能</li></ol><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="a5f8" class="mr kz in ni b gy nm nn l no np">import pandas as pd<br/>from numba import njit</span><span id="d36d" class="mr kz in ni b gy nq nn l no np">from datetime import datetime, date<br/>from pyspark.sql import SparkSession<br/>from pyspark.sql.functions import pandas_udf</span><span id="724d" class="mr kz in ni b gy nq nn l no np">spark = SparkSession.builder.getOrCreate()</span><span id="1c4a" class="mr kz in ni b gy nq nn l no np"><a class="ae lv" href="http://twitter.com/pandas_udf" rel="noopener ugc nofollow" target="_blank">@pandas_udf</a>('long')<br/>def pandas_plus_one(series: pd.Series) -&gt; pd.Series:<br/>    return series + 1</span><span id="761a" class="mr kz in ni b gy nq nn l no np"><a class="ae lv" href="http://twitter.com/njit" rel="noopener ugc nofollow" target="_blank">@njit</a><br/>def numba_plus_one(series):<br/>    return series + 1</span><span id="35c5" class="mr kz in ni b gy nq nn l no np"><a class="ae lv" href="http://twitter.com/pandas_udf" rel="noopener ugc nofollow" target="_blank">@pandas_udf</a>('long')<br/>def numba_udf_plus_one(series: pd.Series) -&gt; pd.Series:<br/>    return pd.Series(numba_plus_one(series.to_numpy()))</span><span id="e48e" class="mr kz in ni b gy nq nn l no np">df=spark.range(10000)</span><span id="1421" class="mr kz in ni b gy nq nn l no np">start = time.time()<br/>df.select(pandas_plus_one(df.id))<br/>end = time.time()<br/>print("time for pandas_plus_one(: {:0.3e} sec".format(end - start))</span><span id="e69c" class="mr kz in ni b gy nq nn l no np">start = time.time()<br/>df.select(numba_udf_plus_one(df.id))<br/>end = time.time()<br/>print("time for numba_udf_plus_one: {:0.3e} sec".format(end - start))</span></pre><p id="3603" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">结果:Numba 没有进一步加速星火熊猫 UDF。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d65d" class="mr kz in ni b gy nm nn l no np">time for pandas_plus_one(: 8.108e-03 sec<br/>time for numba_udf_plus_one: 8.293e-03 sec</span></pre><h1 id="c192" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">奖金</h1><div class="ly lz gp gr ma mb"><a href="https://ismaelaraujo.medium.com/pytrends-a-python-library-that-you-should-know-24764b384bc2" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">PyTrends:您应该知道的 Python 库</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">PyTrends 将使你的下一个项目更上一层楼。原因如下。</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">ismaelaraujo.medium.com</p></div></div><div class="mk l"><div class="or l mm mn mo mk mp mq mb"/></div></div></a></div><h2 id="244d" class="mr kz in bd la ms mt dn le mu mv dp li kl mw mx lk kp my mz lm kt na nb lo nc bi translated">附录</h2><div class="ly lz gp gr ma mb"><a href="https://www.linuxcapable.com/how-to-install-python-3-10-on-ubuntu-22-04-lts/#Install_Python_PIP_with_310" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">如何在 Ubuntu 22.04 LTS 版上安装 Python 3.10 支持 Linux</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Python 是最流行的高级语言之一，专注于高级和面向对象的应用程序，来自…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">www.linuxcapable.com</p></div></div><div class="mk l"><div class="os l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/dont-use-apply-in-python-there-are-better-alternatives-dc6364968f44" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">不要用 Python 中的 Apply，有更好的替代品！</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">应用功能的替代方案，可将性能提高 700 倍</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="ot l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/how-to-skyrocket-your-python-speed-with-numba-89fd16362e47" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">如何用 Numba 提升你的 Python 速度🚀</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">学习如何使用 Numba Decorators 让你的代码更快</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="ou l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://thedatafreak.medium.com/spark-optimization-reducing-shuffle-9cb2c109e977" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">火花优化:减少洗牌</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">"洗牌是大自然唯一不能逆转的事情."——阿瑟·爱丁顿</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">thedatafreak.medium.com</p></div></div><div class="mk l"><div class="ov l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://medium.com/geekculture/right-way-to-test-mock-and-patch-in-python-b02138fc5040" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">在 Python 中测试、模拟和修补的正确方法</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">取代强迫你首先考虑测试的 TDD(测试驱动开发),你可以实践 TPD(测试…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">medium.com</p></div></div><div class="mk l"><div class="ow l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://towardsdatascience.com/12-python-decorators-to-take-your-code-to-the-next-level-a910a1ab3e99" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">12 个 Python 装饰器，让你的代码更上一层楼</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">用更少的代码做更多的事情，而不影响质量</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">towardsdatascience.com</p></div></div><div class="mk l"><div class="ox l mm mn mo mk mp mq mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">Python 请求的高级用法——超时、重试、挂钩</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Python HTTP 库请求可能是我在所有编程语言中最喜欢的 HTTP 工具。很简单…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">findwork.dev</p></div></div><div class="mk l"><div class="oy l mm mn mo mk mp mq mb"/></div></div></a></div></div></div>    
</body>
</html>