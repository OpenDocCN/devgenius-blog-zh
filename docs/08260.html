<html>
<head>
<title>Create PostgreSQL Database from Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Pandas 数据框架创建 PostgreSQL 数据库</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-postgresql-database-from-pandas-dataframe-b759b3b986e9?source=collection_archive---------1-----------------------#2022-05-31">https://blog.devgenius.io/create-postgresql-database-from-pandas-dataframe-b759b3b986e9?source=collection_archive---------1-----------------------#2022-05-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4816a6760c6d054ecd992d9729aaf284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ag8clQpJG2X6_3Xs"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">本杰明·雷曼在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c3fc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇中型文章中，我想比较如何将 pandas 数据帧转换成 PostgreSQL 数据库的不同的 T4 方法。</p><p id="0ba2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">指标</strong>:</p><p id="825b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">0.准备需求</p><p id="171b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">0.a .通过 PgAdmin4 在 PostreSQL 中创建数据库</p><ol class=""><li id="d821" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">数据理解</li><li id="88df" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用 pandas to SQL 方法将 Pandas DataFrame 转换为 Postgres DB</li><li id="a338" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用钻头手动方法</li></ol><p id="2cd5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.a .创建表格</p><p id="da2e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.b .用几种方法插入值</p><p id="7159" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">0.我们需要的要求:</p><p id="dceb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">a.已安装的 PostgreSQL 数据库</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="2ec8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">0.a .创建数据库</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/98e5647f091a96599cb1ace7f98f17d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5eF3NWQfdWLAjTWQmca4A.png"/></div></div></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/0b223e398a82578685424282cfc2af02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eV_7tDdIWd3WcQ8x3XruUw.png"/></div></div></figure><ol class=""><li id="ece2" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">数据理解和预处理</li></ol><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mb ma l"/></div></figure><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mc ma l"/></div></figure><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="md ma l"/></div></figure><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="me ma l"/></div></figure><p id="02da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据以上检查，数据集有<strong class="kc io"> 83.691 </strong>行和<strong class="kc io"> 20 </strong>列。但是，有一个几乎整个列的值都丢失了(<strong class="kc io"> ehail_fee </strong>)。为了处理丢失的值，我决定放弃这个特性。还有另一个缺失值。在这种情况下，我删除了 VendorID、passanger _ count、payment_type、trip_type 和 congestion _ overload 的子集，因为这不是机器学习案例，目的是演示从 dataframe 到 PostgreSQL DB 的转换过程。</p><p id="8592" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基于这些方法，我创建了一个函数来包装基本的数据预处理</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><p id="ec8d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">理解数据后，我们可以进入下一步。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="fd40" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.使用 Pandas 将 DataFrame 转换为 Postgres DB。to_sql 方法</p><p id="6442" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">文件:<a class="ae jz" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" rel="noopener ugc nofollow" target="_blank">https://pandas.pydata.org/docs/reference/api/pandas.data frame . to _ SQL . html #熊猫。DataFrame.to_sql </a></p><p id="b410" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本功能</p><p id="5d9f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">data frame . to _ SQL(<em class="mg">name</em>，<em class="mg"> con </em>，<em class="mg"> schema=None </em>，<em class="mg"> if_exists='fail' </em>，<em class="mg"> index=True </em>，<em class="mg"> index_label=None </em>，<em class="mg"> chunksize=None </em>，<em class="mg"> dtype=None </em>，<em class="mg">method = None</em>)【T33</strong></p><p id="7bda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">名称=表名</p><p id="77ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">con = sqlite3 . connection/<a class="ae jz" href="https://docs.sqlalchemy.org/en/13/core/connections.html" rel="noopener ugc nofollow" target="_blank">sqlalchemy . engine</a></p><p id="e57f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">if_exists =如果表已经创建，您将如何处理该表默认“失败”另一个选项(“替换”和“追加”)</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/134fb650f892fdae9b845349a56e27cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sO_YzSvq767eygFlGmZhiQ.png"/></div></div></figure><p id="c4f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个过程花了将近<strong class="kc io">7.8 秒</strong>，现在我们可以假设这个过程有点慢。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="4a17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.使用手动方法</p><p id="f457" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.a .创建一个 PostgreSQL 连接器，并基于数据帧创建表(如上)</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><p id="fd53" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.b. 1 使用 cursor.executemany(query，vars_list)方法插入</p><p id="9af7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mg">方法:cursor.executemany(query，vars _ list)</em>T3】</strong></p><p id="e424" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">参数:</p><p id="2185" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">查询:sql 查询</p><p id="a2a9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">vars _ list:tuple/mappings</p><p id="f43a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据文档<a class="ae jz" href="https://www.psycopg.org/docs/cursor.html" rel="noopener ugc nofollow" target="_blank"> <em class="mg">站点</em></a><em class="mg"/>execute many 函数需要两个参数 query(postgesql 命令)和 var_list(参数元组或映射)</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/3ad948b7b2a1efee7e41df4738d137b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*VzvnoFcU60mqUpXFx19Opw.png"/></div></figure><p id="d1cf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用 executemany 方法插入值所需的时间约为<strong class="kc io"> 10s。</strong></p><p id="ad63" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.b.2 使用 psycopg2.extras.execute_batch()方法插入</p><p id="9d24" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mg">方法:psycopg 2 . extras . execute _ batch(cur</em>，<em class="mg"> sql </em>，<em class="mg"> argslist) </em> </strong></p><p id="8620" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">参数:</p><p id="a485" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> cur </em>:连接的光标，</p><p id="7cfd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> sql : </em> sql 查询，</p><p id="1672" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> argslist </em>:元组/可映射序列。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/804ca1e60089abb327c999765f36ca7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*sO5ziwycJAonLjFw64N7eg.png"/></div></figure><p id="359d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">与之前的方法相比，<strong class="kc io">7.3 秒</strong>有显著增加。</p><p id="d9e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.b.3 使用 psycopg 2 . extras . execute _ values(<em class="mg">)方法</em>插入</p><p id="5c90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mg">方法:psycopg 2 . extras . execute _ values(cur，sql，argslist) </em> </strong></p><p id="961b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">参数:</p><p id="4334" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> cur </em>:连接的光标，</p><p id="4cbc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> sql : </em> sql 查询，</p><p id="410b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mg"> argslist </em>:元组/可映射序列。</p><p id="27e0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">与 psycopg2.extras.execute_batch 相比，语法看起来是一样的。但是，sql 命令是不同的。在 execute_values 中，对于许多列输入，语法只需要“%s ”,而不是 execute.batch()函数中的每个列输入都需要“%s”。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mf ma l"/></div></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/bc4924b547ceb0f26d2c5ff3616d61f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQOZbbIQmcTkH4Xz3ve-1g.png"/></div></div></figure><p id="0d7a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为我只是比较了将 pandas 数据帧转换成 postgresql 数据库需要多长时间，所以我没有提交这个过程。实际上，您必须在插入后提交。最后一种方法最快，产生<strong class="kc io"> 7.0s(最快)。</strong></p><p id="dbbf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">结论</strong></p><p id="eac4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">时间比较</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/4bbc8dd484cfaa6eaf574afc7e7cdc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*ltnrGHTtjvQ98H3IqAO8vw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">作者的 excel 表格屏幕截图</figcaption></figure><p id="61a5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基于时间，最快的方法是<strong class="kc io"> execute_values </strong>方法。最慢的是。执行许多方法。其他的在大约 7 秒时有相似的性能。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="6253" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的关注。你可以通过我的<a class="ae jz" href="https://www.linkedin.com/in/fakhrirobi/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我，或者你可以在这里星/叉/关注我的 github 账户<a class="ae jz" href="https://github.com/fakhrirobi" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="993b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，如果你想了解更多关于我以前的媒体文章:</p><p id="dc04" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">我的 Fullstack Timeseries 项目:</strong></p><p id="d747" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第一部分:</strong> <a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-passenger-air-traffic-time-series-project-part-1-da51d4e8520a"> <strong class="kc io">时间序列预测:航空客运(时间序列端到端项目第一部分)</strong> </a></p><p id="e46f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第二部分:</strong> <a class="ae jz" href="https://medium.com/@fakhrirobi.fra/create-timeseries-dashboard-using-dash-timeseries-end-to-end-project-part-2-38f0319e952?source=your_stories_page----------------------------------------" rel="noopener"> <strong class="kc io">使用 Dash 创建时间序列仪表板(时间序列端到端项目第二部分)</strong> </a></p><p id="998b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第 3 部分:</strong> <a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/deploy-forecasting-model-as-api-with-fast-api-and-heroku-timeseries-end-to-end-project-part-3-34692d980c3?source=your_stories_page----------------------------------------"> <strong class="kc io">使用 Fast API 和 Heroku 将预测模型部署为 API(时间序列端到端项目第 3 部分)</strong> </a></p></div></div>    
</body>
</html>