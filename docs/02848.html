<html>
<head>
<title>Node.js Best Practices — JWT and Conditional Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 最佳实践— JWT 和条件请求</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-best-practices-jwt-and-conditional-requests-b913f7c4e9bd?source=collection_archive---------6-----------------------#2020-09-04">https://blog.devgenius.io/node-js-best-practices-jwt-and-conditional-requests-b913f7c4e9bd?source=collection_archive---------6-----------------------#2020-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/345536b2314ee7d1bd6bc7c96018b1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wzpmOA0ca32BBOdY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">尼克·卡沃尼斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6094" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="ff94" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用基于 JWT 的无状态身份验证</h1><p id="7ac8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 JSON web 令牌进行身份验证。</p><p id="8318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JSON web 令牌由 3 部分组成。</p><p id="d729" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括:</p><ul class=""><li id="22f3" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">带有令牌类型和哈希算法的标头</li><li id="cda5" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">有效载荷有索赔权</li><li id="37fd" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">签署有效负载的签名。</li></ul><p id="3f2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以很容易地添加一些附件。</p><p id="4b8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以使用 koa-jwt 包来添加令牌。</p><p id="69b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以写:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="34b3" class="nb lc iq mx b gy nc nd l ne nf">const koa = require('koa')<br/>const jwt = require('koa-jwt')</span><span id="76b3" class="nb lc iq mx b gy ng nd l ne nf">const app = koa()</span><span id="b79f" class="nb lc iq mx b gy ng nd l ne nf">app.use(jwt({ <br/>  secret: 'secret' <br/>}))</span><span id="0e99" class="nb lc iq mx b gy ng nd l ne nf">// Protected middleware<br/>app.use(function *(){<br/>  this.body = {<br/>    foo: 'bar'<br/>  }<br/>})</span></pre><p id="60f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是调用<code class="fe nh ni nj mx b">app.use</code>来使用<code class="fe nh ni nj mx b">jwt</code>中间件。</p><p id="8dc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该对象具有签名令牌的秘密。</p><p id="7caa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们添加了一个受保护的中间件。</p><p id="b130" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">令牌内容将在<code class="fe nh ni nj mx b">this.state.user</code>中提供。</p><p id="0d33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JWT 模块不依赖于任何数据库层。</p><p id="65da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">都是自己验证的。</p><p id="b7b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们还可以包含生存时间值。</p><p id="c1cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了确保我们的通信是安全的，我们仍然必须确保 API 端点通过 HTTPS 连接可用。</p><h1 id="2629" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用条件请求</h1><p id="467b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">条件请求是 HTTP 请求，根据请求头值的不同，其结果也不同。</p><p id="df0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标头检查存储在服务器上的资源版本是否与同一资源的给定版本相匹配。</p><p id="1a9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">报头可以是自上次修改以来的时间戳。</p><p id="d13d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它也可以是一个实体标签，每个版本都不同。</p><p id="baa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标题是:</p><ul class=""><li id="3a34" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">Last-Modified</code>指示资源上次修改的时间</li><li id="f569" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">Etag</code>哪个是实体标签</li><li id="4a2c" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">If-Modified-Since</code>与<code class="fe nh ni nj mx b">Last-Modifed</code>割台一起使用</li><li id="4826" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">If-None-Match</code>与<code class="fe nh ni nj mx b">Etag</code>割台一起使用。</li></ul><h1 id="ba7b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用速率限制</h1><p id="23cd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以限制对 API 的请求数量。</p><p id="4cef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了告诉我们的 API 客户端还有多少请求，我们可以设置以下响应头:</p><ul class=""><li id="7b8f" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">X-Rate-Limit-Limit</code>，告诉我们在给定的时间间隔内允许的请求数量</li><li id="650a" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">X-Rate-Limit-Remaining</code>，同一时间间隔内剩余的请求数</li><li id="2e6f" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nh ni nj mx b">X-Rate-Limit-Reset</code>，告诉我们速率限制将被重置的时间</li></ul><p id="f757" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以添加库来为我们的应用程序添加速率限制功能。</p><p id="8561" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了 Koa，我们可以使用<a class="ae kc" href="https://github.com/koajs/ratelimit" rel="noopener ugc nofollow" target="_blank"> koa-ratelimit </a>包。</p><h1 id="7077" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建适当的 API 文档</h1><p id="ca54" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">没有任何文档，很难知道如何使用我们的 API。</p><p id="4a3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让我们的生活更容易，我们可以使用<a class="ae kc" href="https://apiblueprint.org/" rel="noopener ugc nofollow" target="_blank"> API Blueprint </a>或<a class="ae kc" href="http://swagger.io/" rel="noopener ugc nofollow" target="_blank"> Swagger </a>来创建我们的文档。</p><h1 id="5aad" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">API 的未来</h1><p id="3d80" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">除了休息还有其他选择。</p><p id="55a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用 GraphQL 来监听 HTTP 请求，但是它有类型检查，我们可以选择性地选择资源。</p><p id="5fe0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了类型检查和有选择地查询资源的能力，我们可以更有效率并减少出错的机会。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/50745fb99b34437bdaf3618a11845a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ui_KzsDjc74xtiAC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">丹尼·米勒在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="f370" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="848a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 JWT 进行身份验证。</p><p id="b708" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">条件请求让我们根据头部发出不同的请求。</p><p id="bb1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还应该考虑 REST APIs 的替代方案。</p></div></div>    
</body>
</html>