<html>
<head>
<title>Scaffolding in Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby on Rails 脚手架</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/scaffolding-in-ruby-on-rails-64d2acbf4a95?source=collection_archive---------19-----------------------#2022-08-29">https://blog.devgenius.io/scaffolding-in-ruby-on-rails-64d2acbf4a95?source=collection_archive---------19-----------------------#2022-08-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b5beab16f6dd6b8d12761f2d2277393a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*85T022eKRzGsU6t-OjXRBQ.png"/></div></div></figure><p id="8a4b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您开发 Rails 应用程序时，尤其是那些主要为您提供数据库中数据的简单接口的应用程序，使用 scaffold 方法通常很有用。</p><p id="2d25" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">脚手架提供的不仅仅是廉价的演示体验。以下是一些好处:</p><p id="0e49" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以快速将代码呈现在用户面前以获得反馈；</p><p id="0118" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过查看生成的代码，您可以了解 Rails 是如何工作的；</p><p id="3640" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用脚手架作为开始开发的基础。</p><p id="b290" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">脚手架示例</strong></p><p id="6eea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了理解搭建，让我们创建一个名为 cookbook 的数据库和一个名为 recipes 的表。</p><p id="3bec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建一个空白的 Rails web 应用</strong></p><p id="ba21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开命令窗口，转到您想要创建这个 cookbook web 应用程序的位置。因此，运行以下命令来创建一个完整的目录结构。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2494" class="lc ld in ky b gy le lf l lg lh">tp&gt; rails new cookbook</span></pre><p id="3b93" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">配置数据库</p><p id="9d83" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一种创建数据库的方法:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="b4d4" class="lc ld in ky b gy le lf l lg lh">mysql&gt; create database cookbook;<br/>Query OK, 1 row affected (0.01 sec)<br/><br/>mysql&gt; grant all privileges on cookbook.*<br/>to 'root'@'localhost' identified by 'password';<br/>Query OK, 0 rows affected (0.00 sec)<br/><br/>mysql&gt; FLUSH PRIVILEGES;<br/>Query OK, 0 rows affected (0.00 sec)</span></pre><p id="83c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要告诉 Rails 如何找到数据库，请编辑 cookbook \ config \ database.yml 配置文件，并将数据库名称更改为 cookbook。将密码留空。完成后，应该是这样的:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="b96c" class="lc ld in ky b gy le lf l lg lh">development:<br/>   adapter: mysql<br/>   database: cookbook<br/>   username: root<br/>   password: [password]<br/>   host: localhost<br/>	<br/>test:<br/>   adapter: mysql<br/>   database: cookbook<br/>   username: root<br/>   password: [password]<br/>   host: localhost<br/>	<br/>production:<br/>   adapter: mysql<br/>   database: cookbook<br/>   username: root<br/>   password: [password]<br/>   host: localhost</span></pre><p id="eba1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Rails 允许您使用不同的数据库在开发、测试或生产模式下工作。这个应用程序对每一个都使用相同的数据库。</p><p id="6cad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">生成脚手架代码</strong></p><p id="ccb2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用 scaffold Rails action 可以动态生成我们需要的所有代码。通过将 scaffold 作为脚本运行，我们可以将所有代码写到磁盘上，在磁盘上我们可以检查它，然后开始使它适应我们的需求。</p><p id="6adb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，现在让我们使用 scaffold helper 脚本再次开始手动生成 scaffold 代码:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="aa74" class="lc ld in ky b gy le lf l lg lh">cookbook&gt; rails generate scaffold recipe</span></pre><p id="3b95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它生成如下所示的自动文件。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/e9269e31c4a7ad13f4ec5eac0af44cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/1*iTqZFVHAxNBCCTlWj5OpCQ.gif"/></div></figure><p id="902f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">控制器</p><p id="9f3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看控制器背后的代码。这段代码是由脚手架生成器生成的。如果您打开 app/controllers/recipes _ controller . Rb，您会发现以下内容:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="a4f5" class="lc ld in ky b gy le lf l lg lh">class RecipesController &lt; ApplicationController<br/>   before_action :set_recipe, only: [:show, :edit, :update, :destroy]<br/>   <br/>   # GET /recipes<br/>   # GET /recipes.json<br/>   def index<br/>      @recipes = Recipe.all<br/>   end<br/>   <br/>   # GET /recipes/1<br/>   # GET /recipes/1.json<br/>   def show<br/>   end<br/>   <br/>   # GET /recipes/new<br/>   def new<br/>      @recipe = Recipe.new<br/>   end<br/>   <br/>   # GET /recipes/1/edit<br/>   def edit<br/>   end<br/>   <br/>   # POST /recipes<br/>   # POST /recipes.json<br/>   def create<br/>      @recipe = Recipe.new(recipe_params)<br/>      <br/>      respond_to do |format|<br/>         if @recipe.save<br/>            format.html { redirect_to @recipe, notice: 'Recipe was successfully created.' }<br/>            format.json { render :show, status: :created, location: @recipe }<br/>         else<br/>            format.html { render :new }<br/>            format.json { render json: @recipe.errors, status: :unprocessable_entity }<br/>         end<br/>      end<br/>      <br/>   end<br/>   <br/>   # PATCH/PUT /recipes/1<br/>   # PATCH/PUT /recipes/1.json<br/>   def update<br/>      respond_to do |format|<br/>         if @recipe.update(recipe_params)<br/>            format.html { redirect_to @recipe, notice: 'Recipe was successfully updated.' }<br/>            format.json { render :show, status: :ok, location: @recipe }<br/>         else<br/>            format.html { render :edit }<br/>            format.json { render json: @recipe.errors, status: :unprocessable_entity }<br/>         end<br/>      end<br/>      <br/>   end<br/>   <br/>   # DELETE /recipes/1<br/>   # DELETE /recipes/1.json<br/>   def destroy<br/>      @recipe.destroy<br/>         respond_to do |format|<br/>         format.html { redirect_to recipes_url, notice: 'Recipe was successfully destroyed.' }<br/>         format.json { head :no_content }<br/>      end<br/>   end<br/>   <br/>   private<br/>   <br/>   # Use callbacks to share common setup or constraints between actions.<br/>   def set_recipe<br/>      @recipe = Recipe.find(params[:id])<br/>   end<br/>   <br/>   # Never trust parameters from the scary internet, only allow the white list through.<br/>   def recipe_params<br/>      params.require(:recipe).permit(:tittle, :instructions)<br/>   end<br/>end</span></pre><p id="d9a1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当 Rails 应用程序的用户选择一个动作时，比如“show”，控制器将执行适当部分中的任何代码——“def show”——然后显示一个默认同名的模板——“show . html”。欧洲电台。"此默认行为可以被覆盖。</p><p id="1a48" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">控制器使用 ActiveRecord 方法，如 find、find_all、new、save、update_attributes 和 destroy，将数据移入和移出数据库表。请注意，您不需要编写任何 SQL 语句，rails 会自动完成这项工作。</p><p id="1147" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这一行代码将赋予数据库表生命。它将为您的数据和方法提供一个简单的接口:</p><p id="a2b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创造新的记录；</p><p id="b01c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编辑当前记录；</p><p id="ffcd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看当前记录；</p><p id="fb30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">销毁现有记录。</p><p id="01e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建或编辑记录时，scaffold 将为您完成所有繁重的工作，例如生成和处理表单，甚至通过支持以下类型的输入数据来提供智能表单生成:</p><p id="ee3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">简单的文本字符串；</p><p id="b73e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">文本区域(或大块文本)；</p><p id="6992" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">日期选择器；</p><p id="67c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">日期和时间选择器。</p><p id="45f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用 Rails 迁移来创建和维护表。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="727e" class="lc ld in ky b gy le lf l lg lh">rake db:migrate RAILS_ENV=development</span></pre><p id="553f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在转到 cookbook 目录，使用以下命令启动 web 服务器:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="6c38" class="lc ld in ky b gy le lf l lg lh">cookbook&gt; rails server</span></pre><p id="4f42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在打开浏览器，进入<a class="ae lj" href="http://127.0.0.1:3000/recipe/new" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:3000/recipe/new</a>。这将为您提供一个在处方表中创建新条目的屏幕。截图如下。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lk"><img src="../Images/d6e26022f071bf7a0ce8e623682836da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OK9FZAWlXhEzdJ3POqi0QA.gif"/></div></div></figure><p id="a278" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击“创建”按钮创建新配方后，您的输入将被添加到配方表中，并显示以下结果:</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ll"><img src="../Images/96de812a827fea5d6c2bd18e53d41968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OeOwt4XWtR6GWAk9tlLxog.gif"/></div></div></figure><p id="ad0a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以看到编辑、显示和销毁记录的能力。所以，试试这些选项。</p><p id="2ce1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您也可以使用 URL<a class="ae lj" href="http://127.0.0.1:3000/recipe/list" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:3000/recipe/list</a>列出配方表中所有可用的配方。</p><p id="a8f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">改进模型</strong></p><p id="782b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Rails 免费为您提供了许多错误处理。为了理解这一点，向空配方模型添加一些验证规则。</p><p id="8027" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如下修改 app / models / recipe.rb，然后测试您的应用程序:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="8a9d" class="lc ld in ky b gy le lf l lg lh">class Recipe &lt; ActiveRecord::Base<br/>   validates_length_of :title, :within =&gt; 1..20<br/>   validates_uniqueness_of :title, :message =&gt; "already exists"<br/>end</span></pre><p id="3e59" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些条目将给出自动验证:</p><p id="8965" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">validates _ length _ of 字段不为空或过长。</p><p id="ffe1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">validates _ uniqueness _ of 截取重复值。我们在这里给出了自己的消息，而不是默认的 Rails 错误消息。</p><p id="ef02" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">validates _ length _ of 该字段既不为空也不太长。</p><p id="1717" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">validates _ uniqueness _ of 截取重复值。我们在这里给出了自己的消息，而不是默认的 Rails 错误消息。</p><p id="b892" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">搭建脚手架的另一种方式</strong></p><p id="172b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建如上所示的应用程序和如下所示的生成的支架代码。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="5631" class="lc ld in ky b gy le lf l lg lh">rails g scaffold Recipe tittle:string instructions:text</span></pre><p id="37e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面的代码使用 sqlite3 生成自动数据库文件，带有一个标题和一个说明列，如下图所示。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/e9269e31c4a7ad13f4ec5eac0af44cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/1*iTqZFVHAxNBCCTlWj5OpCQ.gif"/></div></figure><p id="7183" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要使用下面的语法来迁移数据库。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="0a8b" class="lc ld in ky b gy le lf l lg lh">$ rake db:migrate RAILS_ENV=development</span></pre><p id="2533" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，使用以下命令行运行应用程序:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3626" class="lc ld in ky b gy le lf l lg lh">rails server</span></pre><p id="63a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所有视图及其相应的控制器方法都是由 scaffold 命令创建的，可以在 app / views / recipes 目录中找到。</p><p id="1d89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">脚手架是做什么的？</strong></p><p id="5c04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你已经阅读了前面的章节，那么你已经看到我们已经创建了显示、显示、删除和创建数据等方法。等等。，但是 scaffolding 会自动完成这项工作。</p></div></div>    
</body>
</html>