<html>
<head>
<title>Receiving data over webhooks with Paystack in Laravel â€” Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨ Laravel ä¸­çš„ Paystack é€šè¿‡ webhooks æ¥æ”¶æ•°æ®â€”ç¬¬ 1 éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/receiving-data-over-webhooks-with-paystack-in-laravel-part-1-857bc4aab657?source=collection_archive---------0-----------------------#2020-09-04">https://blog.devgenius.io/receiving-data-over-webhooks-with-paystack-in-laravel-part-1-857bc4aab657?source=collection_archive---------0-----------------------#2020-09-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f45c6078743841bb9a25b50916ad6471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxW94HpbRncjfsHuFnjokg.jpeg"/></div></div></figure><p id="6f9b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä½ æ˜¯å¦æ›¾ç»åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶æƒ³:â€œæˆ‘å¯ä»¥å‘è¿™ä¸ªæœåŠ¡çš„ API å‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰åŠæ³•è®©ä»–ä»¬è®©æˆ‘çš„åº”ç”¨ç¨‹åºçŸ¥é“<code class="fe kt ku kv kw b">X</code>ä½•æ—¶å‘ç”Ÿï¼Ÿæ‚¨å¯ä»¥å°è¯•åœ¨è®¾å®šçš„æ—¶é—´é—´éš”å†…è°ƒç”¨ APIã€‚è·å–å“åº”ï¼Œå°†å…¶ä¸ä¸Šä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œç„¶åç»§ç»­ã€‚è¿™æ˜¯è½®è¯¢ï¼Œä½†æ•ˆç‡å¾ˆä½ï¼Œè€Œä¸”å¾ˆå®¹æ˜“è¾¾åˆ°é€Ÿç‡é™åˆ¶ã€‚ç›¸åï¼Œä¸€äº› API å’ŒæœåŠ¡æä¾›äº†æ‰€è°“çš„ webhookã€‚ä»–ä»¬ä¸æ˜¯è”ç³»ä»–ä»¬ï¼Œè€Œæ˜¯è”ç³»ä½ ã€‚</p><h1 id="42c0" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">ä»€ä¹ˆæ˜¯ webhookï¼Ÿ</h1><p id="f6ee" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">webhook(ä¹Ÿç§°ä¸º web å›è°ƒæˆ– HTTP æ¨é€ API)æ˜¯åº”ç”¨ç¨‹åºå‘å…¶ä»–åº”ç”¨ç¨‹åºæä¾›å®æ—¶ä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚Webhooks æ˜¯ä¸€ç§å‘é€é€šçŸ¥çš„æ–¹å¼ã€‚å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯å•å‘çš„ã€‚å‘ä»¶äººä¸åœ¨ä¹ä½ ç”¨å®ƒåšä»€ä¹ˆï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ç”šè‡³ä¸åœ¨ä¹ä½ æ˜¯è°ã€‚ä»–ä»¬æœ€å¤šåªæƒ³å¾—åˆ°ä¸€ä¸ªå›å¤ï¼Œè®©ä»–ä»¬çŸ¥é“ä½ çš„åº”ç”¨å·²ç»æ”¶åˆ°äº†ã€‚webhook åœ¨æ•°æ®å‘ç”Ÿæ—¶å°†æ•°æ®ä¼ é€ç»™å…¶ä»–åº”ç”¨ç¨‹åºï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ç«‹å³è·å¾—æ•°æ®ã€‚è®¸å¤šæœåŠ¡ï¼Œå¦‚<a class="ae ma" href="https://stripe.com/docs/api/events" rel="noopener ugc nofollow" target="_blank"> Stripe API </a>ã€<a class="ae ma" href="https://sendgrid.com/docs/for-developers/tracking-events/event/" rel="noopener ugc nofollow" target="_blank"> Paystack API </a>ã€<a class="ae ma" href="https://developer.github.com/webhooks/" rel="noopener ugc nofollow" target="_blank"> GitHub API </a>å’Œ Twillio APIï¼Œéƒ½æä¾›äº†åœ¨äº‹ä»¶å‘ç”Ÿæ—¶ä»¥ç¼–ç¨‹æ–¹å¼é€šçŸ¥æ‚¨çš„èƒ½åŠ›ã€‚webhook å‘æ‚¨é€‰æ‹©çš„ URL å‘å‡ºä¸€ä¸ª<code class="fe kt ku kv kw b">POST</code>è¯·æ±‚ï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ª<em class="mb">æœ‰æ•ˆè´Ÿè½½</em>ï¼Œå…¶ä¸­åŒ…å«äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ä½¿å¾— webhooks å¯¹æä¾›å•†å’Œæ¶ˆè´¹è€…æ¥è¯´éƒ½æ›´åŠ æœ‰æ•ˆã€‚webhooks çš„å”¯ä¸€ç¼ºç‚¹æ˜¯åˆå§‹è®¾ç½®çš„å›°éš¾ã€‚</p><p id="259b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¦‚æœæ‚¨æ›¾ç»æ„å»ºè¿‡æ‚¨çš„åº”ç”¨ç¨‹åºæˆ–å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨çš„ REST APIï¼Œé‚£ä¹ˆæ‚¨å‡ ä¹å·²ç»äº†è§£äº†å…¥é—¨æ‰€éœ€çš„ä¸€åˆ‡ã€‚</p><p id="fab8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º:</p><ol class=""><li id="6b76" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated">Web æœåŠ¡(Paystack API æˆ– Github API)å°†æœ‰æ•ˆè´Ÿè½½å‘é€åˆ°åº”ç”¨ç¨‹åºçš„ç«¯ç‚¹ã€‚</li><li id="26d3" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">ä½ çš„åº”ç”¨ç¨‹åºæ¥æ”¶æœ‰æ•ˆè´Ÿè½½ã€‚</li><li id="e119" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">ä½ çš„åº”ç”¨ç¨‹åºå“åº”å¹¶ç¡®è®¤æ¥æ”¶ã€‚</li><li id="d15b" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">ä½ çš„åº”ç”¨ç¨‹åºä½œç”¨äºæœ‰æ•ˆè½½è·æ•°æ®ã€‚</li></ol><p id="16cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">å¦‚æœä½ æƒ³åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ¶ˆè´¹ webhook ä¹‹å‰æµ‹è¯•å®ƒçš„å½¢çŠ¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼</em><a class="ae ma" href="http://requestbin.net/" rel="noopener ugc nofollow" target="_blank"><em class="mb">request bin</em></a><em class="mb">è¿™æ ·çš„æœåŠ¡ã€‚</em></p><h1 id="8d69" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">æˆ‘ä»¬å°†å»ºé€ ä»€ä¹ˆ</h1><p id="13b8" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªé¡¹ç›®æ¥ç›‘å¬æ¥è‡ª Paystack çš„äº‹ä»¶ã€‚</p><h1 id="195d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">å…ˆå†³æ¡ä»¶</h1><ul class=""><li id="0226" class="mc md in jx b jy lv kc lw kg mq kk mr ko ms ks mt mi mj mk bi translated">Laravel v5.8 æˆ–æ›´é«˜ç‰ˆæœ¬</li><li id="851a" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mt mi mj mk bi translated">spatie/laravel-web hook-å®¢æˆ·ç«¯</li><li id="3a30" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mt mi mj mk bi translated">å·¥èµ„å•è´¦æˆ·ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ³¨å†Œä¸€ä¸ªå…è´¹è´¦æˆ·ã€‚</li></ul><h1 id="23d9" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">è®¾ç½®æ‚¨çš„é¡¹ç›®</h1><p id="883c" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Laravelï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚å¿µä¹Ÿé€‚ç”¨äºå…¶ä»–è¯­è¨€å’Œæ¡†æ¶ã€‚å¦‚æœæ‚¨è¦å°† webhook æ¶ˆè´¹æ·»åŠ åˆ°ç°æœ‰é¡¹ç›®ä¸­ï¼Œè¯·è·³è¿‡ä¸‹é¢çš„è®¾ç½®ã€‚</p><p id="6111" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">é¦–å…ˆï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Laravel é¡¹ç›®:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="804d" class="nc ky in kw b gy nd ne l nf ng">composer create-project --prefer-dist laravel/laravel learning-webhook</span></pre><h1 id="e432" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">å®‰è£… Spatie çš„ Laravel webhook å®¢æˆ·ç«¯åŒ…</h1><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="5e6e" class="nc ky in kw b gy nd ne l nf ng">composer require spatie/laravel-webhook-client</span></pre><p id="d095" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æœ¬æ•™ç¨‹ä½¿ç”¨ Spatie çš„ webhook å®¢æˆ·ç«¯åŒ…æ¥å¤„ç†å’Œå¤„ç†ä¼ å…¥çš„ webhook äº‹ä»¶ï¼Œå®ƒè¿˜éªŒè¯äº‹ä»¶æ²¡æœ‰è¢«ç ´åã€‚</p><h1 id="205d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">é…ç½®åŒ…</h1><p id="9fb4" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‘å¸ƒé…ç½®æ–‡ä»¶:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="8d57" class="nc ky in kw b gy nd ne l nf ng">php artisan vendor:publish --provider="Spatie\WebhookClient\WebhookClientServiceProvider" --tag="config"</span></pre><p id="cd5f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™æ˜¯å°†åœ¨<code class="fe kt ku kv kw b">config/webhook-client.php</code>å‘å¸ƒçš„æ–‡ä»¶å†…å®¹:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="3a19" class="nc ky in kw b gy nd ne l nf ng">return [<br/>    'configs' =&gt; [<br/>        [<br/>            /*<br/>             * This package support multiple webhook receiving endpoints. If you only have<br/>             * one endpoint receiving webhooks, you can use 'default'.<br/>             */<br/>            'name' =&gt; 'default',</span><span id="9ac8" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * We expect that every webhook call will be signed using a secret. This secret<br/>             * is used to verify that the payload has not been tampered with.</span><span id="bc39" class="nc ky in kw b gy nh ne l nf ng">For the purpose of this article we will be using our Paystack secret key. Make sure you add it to the .env file            */<br/>            'signing_secret' =&gt; env('PAYSTACK_SECRET_KEY'),</span><span id="a8a0" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * The name of the header containing the signature.<br/>             */<br/>            'signature_header_name' =&gt; 'x-paystack-signature',</span><span id="a716" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             *  This class will verify that the content of the signature header is valid.<br/>             *<br/>             * It should implement \Spatie\WebhookClient\SignatureValidator\SignatureValidator<br/>             */<br/>            'signature_validator' =&gt; \Spatie\WebhookClient\SignatureValidator\DefaultSignatureValidator::class,</span><span id="97f1" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * This class determines if the webhook call should be stored and processed.<br/>             */<br/>            'webhook_profile' =&gt; \Spatie\WebhookClient\WebhookProfile\ProcessEverythingWebhookProfile::class,</span><span id="afb6" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * This class determines the response on a valid webhook call.<br/>             */<br/>            'webhook_response' =&gt; \Spatie\WebhookClient\WebhookResponse\DefaultRespondsTo::class,</span><span id="3c4c" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * The classname of the model to be used to store call. The class should be equal<br/>             * or extend Spatie\WebhookClient\Models\WebhookCall.<br/>             */<br/>            'webhook_model' =&gt; \Spatie\WebhookClient\Models\WebhookCall::class,</span><span id="0fa2" class="nc ky in kw b gy nh ne l nf ng">            /*<br/>             * The class name of the job that will process the webhook request.<br/>             *<br/>             * This should be set to a class that extends \Spatie\WebhookClient\ProcessWebhookJob.<br/>             */<br/>            'process_webhook_job' =&gt; '',<br/>        ],<br/>    ],</span></pre><p id="3f77" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åè¯ï¼ˆnoun çš„ç¼©å†™ï¼‰b:æˆ‘åœ¨â€œsignature_header_nameâ€å’Œâ€œPAYSTACK_SECRET_KEYâ€ä¸­æ·»åŠ äº† Paystack çš„ç­¾åå¤´â€œx-paystack-signatureâ€ä½œä¸º signing_secretã€‚ä¸ºæ¸…æ¥šèµ·è§ï¼Œè¯·ç‚¹å‡»æŸ¥çœ‹ Paystack å…³äºè®¾ç½® webhook <a class="ae ma" href="https://paystack.com/docs/payments/webhooks/" rel="noopener ugc nofollow" target="_blank">çš„æ–‡æ¡£:</a></p><h1 id="dcbf" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">å‡†å¤‡æ•°æ®åº“</h1><p id="58fd" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ webhook è°ƒç”¨éƒ½ä¼šä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</p><p id="f08c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¦åˆ›å»ºä¿å­˜ webhook è°ƒç”¨çš„è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å†…å®¹å‘å¸ƒè¿ç§»:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="eb07" class="nc ky in kw b gy nd ne l nf ng">php artisan vendor:publish --provider="Spatie\WebhookClient\WebhookClientServiceProvider" --tag="migrations"</span></pre><p id="16c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿ç§»å‘å¸ƒåï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œè¿ç§»æ¥åˆ›å»º<code class="fe kt ku kv kw b">webhook_calls</code>è¡¨:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="e07a" class="nc ky in kw b gy nd ne l nf ng">php artisan migrate</span></pre><h1 id="100a" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">è´Ÿè´£è·¯ç”±</h1><p id="c27f" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥å¤„ç†è·¯ç”±ã€‚Paystack å…è®¸æ‚¨åœ¨è®¾ç½®é¡µé¢çš„ API &amp; Webhook éƒ¨åˆ†å‘æ‚¨çš„ä»ªè¡¨æ¿æ·»åŠ  webhook URLã€‚</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e2ac156685204f5b65c8799488f61579.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*iV7a5_1hhss7QKa4nTx80Q.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">åœ¨æˆ‘çš„ Paystack å¸æˆ·ä¸Šé…ç½®çš„ Webhook URL</figcaption></figure><p id="b7d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨ä½ çš„åº”ç”¨ç¨‹åºçš„ routes æ–‡ä»¶ä¸­ï¼Œä½ å¿…é¡»å°†è¯¥ URL ä¼ é€’ç»™<code class="fe kt ku kv kw b">Route::webhooks</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="295c" class="nc ky in kw b gy nd ne l nf ng">//routes/api.php</span><span id="0207" class="nc ky in kw b gy nh ne l nf ng">Route::webhooks('paystack-webhook');</span></pre><p id="6503" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨åå°ï¼Œè¿™å°†æ³¨å†Œä¸€ä¸ª<code class="fe kt ku kv kw b">POST</code>è·¯ç”±åˆ°è¿™ä¸ªåŒ…æä¾›çš„æ§åˆ¶å™¨ã€‚å› ä¸ºå‘æ‚¨å‘é€ webhooks çš„åº”ç”¨ç¨‹åºæ— æ³•è·å¾— csrf-tokenï¼Œæ‰€ä»¥æ‚¨å¿…é¡»å°†è¯¥è·¯ç”±æ·»åŠ åˆ°<code class="fe kt ku kv kw b">VerifyCsrfToken</code>ä¸­é—´ä»¶çš„<code class="fe kt ku kv kw b">except</code>æ•°ç»„ä¸­:</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="dc3f" class="nc ky in kw b gy nd ne l nf ng">// App/Http/Middleware/VerifyCsrfToken.php</span><span id="c986" class="nc ky in kw b gy nh ne l nf ng">protected $except = [<br/>    'paystack-webhook',<br/>];</span></pre><h1 id="1bda" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ç­¾åéªŒè¯å™¨</h1><p id="9c29" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç­¾åéªŒè¯å™¨ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç­¾åéªŒè¯å™¨å‘¢ï¼Ÿ</p><blockquote class="nn no np"><p id="1065" class="jv jw mb jx b jy jz ka kb kc kd ke kf nq kh ki kj nr kl km kn ns kp kq kr ks ig bi translated">éªŒè¯äº‹ä»¶æºè‡ª Paystack éå¸¸é‡è¦ï¼Œä»¥é¿å…åŸºäº countefeit äº‹ä»¶ä¼ é€’å€¼ã€‚</p></blockquote><p id="db32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä¸Šé¢å¼•ç”¨çš„è¯­å¥æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°<code class="fe kt ku kv kw b">Spatie\WebhookClient\WebhookClient\SignatureValidator\SignatureValidator</code>æ¥å£çš„è‡ªå®šä¹‰ç­¾åéªŒè¯å™¨çš„åŸå› ã€‚</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="ef5f" class="nc ky in kw b gy nd ne l nf ng">//App/Handler/CustomSignatureValidator.php</span><span id="6701" class="nc ky in kw b gy nh ne l nf ng">&lt;?php</span><span id="bacc" class="nc ky in kw b gy nh ne l nf ng">namespace App\Handler;</span><span id="2e23" class="nc ky in kw b gy nh ne l nf ng">use Illuminate\Http\Request;</span><span id="06d7" class="nc ky in kw b gy nh ne l nf ng">use Spatie\WebhookClient\Exceptions\WebhookFailed;</span><span id="3540" class="nc ky in kw b gy nh ne l nf ng">use Spatie\WebhookClient\WebhookConfig;</span><span id="a13f" class="nc ky in kw b gy nh ne l nf ng">use Spatie\WebhookClient\SignatureValidator\SignatureValidator;</span><span id="ff44" class="nc ky in kw b gy nh ne l nf ng">class PaystackSignature implements SignatureValidator{<br/>    public function isValid(Request $request, WebhookConfig $config): bool{</span><span id="3106" class="nc ky in kw b gy nh ne l nf ng">$signature = $request-&gt;header($config-&gt;signatureHeaderName);</span><span id="24e1" class="nc ky in kw b gy nh ne l nf ng">if (! $signature) {</span><span id="a0b5" class="nc ky in kw b gy nh ne l nf ng">return false;<br/>     }</span><span id="bfc7" class="nc ky in kw b gy nh ne l nf ng">$signingSecret = $config-&gt;signingSecret;</span><span id="621a" class="nc ky in kw b gy nh ne l nf ng">if (empty($signingSecret)) {</span><span id="2343" class="nc ky in kw b gy nh ne l nf ng">throw WebhookFailed::signingSecretNotSet();<br/>     }</span><span id="806d" class="nc ky in kw b gy nh ne l nf ng">$computedSignature = hash_hmac('sha512', $request-&gt;getContent(), $signingSecret);</span><span id="a6e6" class="nc ky in kw b gy nh ne l nf ng">return hash_equals($signature, $computedSignature);<br/>   }<br/>}</span></pre><p id="f15d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä¹‹åéœ€è¦åšçš„æ˜¯ç”¨å¤„ç†ä¼ å…¥ webhook å“åº”çš„ç­¾åéªŒè¯çš„ç±»çš„åç§°æ¥æ›´æ–°è¿™ä¸ªè·¯å¾„<code class="fe kt ku kv kw b">config/laravel-webhook-client.php</code>ä¸­çš„æ–‡ä»¶ï¼Œä»¥ä¾¿çœŸæ­£ç¡®å®šå®ƒä¸æ˜¯ä¼ªé€ çš„å“åº”ã€‚</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="8244" class="nc ky in kw b gy nd ne l nf ng">/*</span><span id="3738" class="nc ky in kw b gy nh ne l nf ng">*  This class will verify that the content of the signature header is valid.</span><span id="7c7b" class="nc ky in kw b gy nh ne l nf ng">*</span><span id="90b4" class="nc ky in kw b gy nh ne l nf ng">* It should implement \Spatie\WebhookClient\SignatureValidator\SignatureValidator</span><span id="9270" class="nc ky in kw b gy nh ne l nf ng">*/</span><span id="c053" class="nc ky in kw b gy nh ne l nf ng">'signature_validator' =&gt; App\Handler\CustomSignatureValidator::class,</span></pre><h1 id="57d9" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">å­˜å‚¨å’Œå¤„ç† webhooks</h1><p id="68a2" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">æ—¢ç„¶å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸“æ³¨äºå¤„ç† webhook å“åº”äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe kt ku kv kw b">Handler</code>çš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶æ”¾åœ¨æˆ‘ä»¬çš„<code class="fe kt ku kv kw b">App</code>ç›®å½•ä¸­ã€‚</p><p id="431f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åˆ›å»ºæ–‡ä»¶å¤¹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šé¢åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe kt ku kv kw b">ProcessWebhook.php </code>çš„æ–‡ä»¶æ¥å¤„ç†(å­˜å‚¨å’Œå¤„ç†)webhook å“åº”ã€‚</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="e8c6" class="nc ky in kw b gy nd ne l nf ng">//App/Handler/ProcessWebhook.php<br/>&lt;?php</span><span id="a16d" class="nc ky in kw b gy nh ne l nf ng">namespace App\Handler;<br/>use \Spatie\WebhookClient\ProcessWebhookJob;</span><span id="1cff" class="nc ky in kw b gy nh ne l nf ng">//The class extends "ProcessWebhookJob" class as that is the class //that will handle the job of processing our webhook before we have //access to it.</span><span id="c2cb" class="nc ky in kw b gy nh ne l nf ng">class ProcessWebhook extends ProcessWebhookJob<br/>{</span><span id="1766" class="nc ky in kw b gy nh ne l nf ng">public function handle(){<br/>       $data = json_decode($this-&gt;webhookCall, true);<br/>       //Do something with the event<br/>       logger($data['payload']);<br/>       http_response_code(200); //Acknowledge you received the response</span><span id="76c7" class="nc ky in kw b gy nh ne l nf ng">}<br/>}</span></pre><p id="c2da" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä¹‹åéœ€è¦åšçš„æ˜¯ç”¨å¤„ç†ä» Paystack æˆ–æ‚¨å¯èƒ½ä½¿ç”¨çš„ä»»ä½•å…¶ä»–æœåŠ¡(æ¯”å¦‚ Github APIã€Stripe API ç­‰)è·å¾—çš„ webhook å“åº”çš„ç±»çš„åç§°æ¥æ›´æ–°è¿™ä¸ªè·¯å¾„<code class="fe kt ku kv kw b">config/laravel-webhook-client.php</code>ä¸­çš„æ–‡ä»¶ã€‚</p><pre class="mu mv mw mx gt my kw mz na aw nb bi"><span id="9339" class="nc ky in kw b gy nd ne l nf ng">/*<br/>             * The class name of the job that will process the webhook request.<br/>             *<br/>             * This should be set to a class that extends \Spatie\WebhookClient\ProcessWebhookJob.<br/>             */<br/>            'process_webhook_job' =&gt; App\Handler\ProcessWebhook::class,<br/>        ],</span></pre><h1 id="32b2" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">ç»“è®º</h1><p id="9677" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">å¾ˆæœ‰è¶£ï¼Œå¯¹å§ï¼Ÿåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè®¾ç½®å’Œé…ç½®ä¸€ä¸ª webhook-client åŒ…æ¥å¤„ç†æ¥è‡ª Paystack çš„äº‹ä»¶ã€‚å¯¹äºè¿›ä¸€æ­¥çš„é˜…è¯»ï¼Œä½ å¯ä»¥åœ¨<a class="ae ma" href="https://github.com/spatie/laravel-webhook-client" rel="noopener ugc nofollow" target="_blank"> <em class="mb">é˜…è¯»æ›´å¤šå…³äºæˆ‘ä»¬ç”¨äºè¿™ä¸ªé¡¹ç›®çš„åŒ…ï¼Œå®ƒçš„å®˜æ–¹æ–‡æ¡£</em> </a>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨<a class="ae ma" href="https://github.com/adejorosam/webhook-tutorial" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ä¸ŠæŸ¥çœ‹è¿™ä¸ªé¡¹ç›®çš„å®Œæ•´æºä»£ç ã€‚</p><p id="afc5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æœ¬æ–‡çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•åœ¨ä¸Šçº¿ä¹‹å‰ç”¨ ngrok åœ¨æœ¬åœ°æµ‹è¯•æˆ‘ä»¬çš„ webhookï¼</p><p id="8946" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">å¦‚æœä½ å–œæ¬¢è¿™ä¸ªï¼Œç‚¹å‡»ğŸ’šæ‰€ä»¥å…¶ä»–äººä¼šåœ¨åª’ä½“ä¸Šçœ‹åˆ°è¿™ä¸ªã€‚</em></p><p id="11b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ¨ç‰¹:@samss <a class="ae ma" href="https://twitter.com/samsss_a" rel="noopener ugc nofollow" target="_blank"> s_a </a></p></div></div>    
</body>
</html>