<html>
<head>
<title>Exploring Crypto Prices with QuestDB and Google Data Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 QuestDB 和 Google Data Studio 探索加密价格</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/exploring-crypto-prices-with-questdb-and-google-data-studio-cb3ddced0308?source=collection_archive---------9-----------------------#2022-02-04">https://blog.devgenius.io/exploring-crypto-prices-with-questdb-and-google-data-studio-cb3ddced0308?source=collection_archive---------9-----------------------#2022-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8cda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过将数据导入 QuestDB 并在 Google Data Studio 上绘制价格趋势，可视化以太坊、卡尔达诺和索拉纳的历史价格。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cf92d55ceb224bccc2002c7fda4a47cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8gLzKCsF31nAroqmQXsAw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来源:<a class="ae lb" href="https://pixabay.com/vectors/image-set-interface-pictogram-3375234/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="7543" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">各种秘密的市场研究网站，如<a class="ae lb" href="https://glassnode.com/" rel="noopener ugc nofollow" target="_blank"> Glassnode </a>、<a class="ae lb" href="https://messari.io/" rel="noopener ugc nofollow" target="_blank"> Messari </a>和<a class="ae lb" href="https://www.tradingview.com/" rel="noopener ugc nofollow" target="_blank"> TradingView </a>提供了分析市场趋势的免费和简单的方法。然而，并不是所有的高级图表功能都是免费的，一些最好的功能被锁在付费墙后面。如果您想使用开源和免费的替代品来探索这些数据集，您可以在不到 5 分钟的设置时间内快速开始。</p><h1 id="1b0e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">先决条件</h1><ul class=""><li id="097b" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated"><a class="ae lb" href="https://console.developers.google.com/billing/freetrial?hl=en&amp;pli=1" rel="noopener ugc nofollow" target="_blank">谷歌云账户</a></li><li id="052e" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><a class="ae lb" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank"> gcloud sdk </a></li><li id="2b88" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><a class="ae lb" href="https://v3.helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">舵 3 </a></li><li id="1c4f" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><a class="ae lb" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank">卡格尔账户</a></li><li id="2b9e" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><em class="mq">可选:比特币基地 API </em></li></ul><p id="d24a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将使用 Kaggle 预编译的加密货币价格数据集，但如果您想构建自己的数据集，请参考“<a class="ae lb" href="https://medium.com/swlh/realtime-crypto-tracker-with-kafka-and-questdb-b33b19048fc2" rel="noopener">带有 Kafka 和 QuestDB 的实时加密跟踪器</a>”。</p><h1 id="c1af" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">下载数据集</h1><p id="e7e2" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">Kaggle 上的“<a class="ae lb" href="https://www.kaggle.com/sudalairajkumar/cryptocurrencypricehistory" rel="noopener ugc nofollow" target="_blank">加密货币历史价格</a>”提供了一份来自<a class="ae lb" href="https://coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank"> CoinMarketCap </a>的加密货币价格汇编列表。创建一个免费的 Kaggle 帐户，下载不同时间的硬币价格的各种 csv 文件。由于 2021 年最重要的叙述是第 1 层协议的出现，我将研究以太坊、Cardano 和 Solana 数据集。</p><h1 id="16ab" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Google 云设置</h1><p id="83cb" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">虽然谷歌数据工作室可以连接到任何公共可访问的 PostgreSQL 端点，但我将使用谷歌云，因为我在之前已经写了关于在 GKE 自动驾驶仪上运行<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/running-questdb-on-gke-autopilot-dab25fd76e66"> QuestDB 的文章。</a></p><p id="07ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个新的 Google Cloud 帐户，导航到<a class="ae lb" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Kubernetes 引擎</a>，启用 Kubernetes 引擎 API，然后点击“创建集群”(您需要添加一个计费帐户):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/f23462f65b946a8510ef27257e67a636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3wz6M6drou_G7UuA.png"/></div></figure><p id="881e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个演示，我决定使用“标准模式”,在<code class="fe mv mw mx my b">us-east1-c</code>区域中有一个节点，接受其他默认设置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/2b33fe4b59c37aa8fd83cc847a94fd5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qNI0CqXutW4X2wELMz1mw.png"/></div></div></figure><p id="67eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建集群后，获取集群凭据进行身份验证:</p><pre class="km kn ko kp gt na my nb nc aw nd bi"><span id="090e" class="ne ld iq my b gy nf ng l nh ni">$ gcloud container clusters get-credentials cluster-1 --zone us-east1-c --project &lt;project-id&gt; </span></pre><h1 id="9e8a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">QuestDB 设置</h1><p id="b0ae" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">QuestDB 提供了一个官方的舵图，默认情况下，它使用 50Gi PVC 来部署单个 StatefulSet pod。为了让 Google Data Studio 可以访问 PostgreSQL wire 端点，我们需要修改服务类型并将 expose 字段设置为 true。用以下内容创建一个新的<code class="fe mv mw mx my b">values.yaml</code>文件:</p><pre class="km kn ko kp gt na my nb nc aw nd bi"><span id="4e9b" class="ne ld iq my b gy nf ng l nh ni">service:<br/>  type: LoadBalancer<br/>  expose:<br/>    postgresql:<br/>    enabled: true</span></pre><p id="df89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后部署到我们的 GKE 集群:</p><pre class="km kn ko kp gt na my nb nc aw nd bi"><span id="f435" class="ne ld iq my b gy nf ng l nh ni">$ helm repo add questdb <a class="ae lb" href="https://helm.questdb.io/" rel="noopener ugc nofollow" target="_blank">https://helm.questdb.io/</a><br/>$ helm upgrade -i questdb questdb/questdb -f values.yaml</span></pre><p id="0121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待 pod 变得正常并配置负载平衡器:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/20866ad291c878775ea772c14f32c33b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*TlfrIZPxQ-8HAqjo32DEtQ.png"/></div></figure><p id="14bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Kubernetes Engine &gt; Services &amp; Ingress 下，检查<code class="fe mv mw mx my b">questdb</code>服务的 IP 地址。点击端口<code class="fe mv mw mx my b">9000</code>链接进入用户界面。</p><p id="c6ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击左侧面板上的上传图标，导入 csv 文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/e89d197d26978df0f1c5f9d6f513efab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gc6dDciZ_38LWCIY7hrFrw.png"/></div></div></figure><h1 id="8ab6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Google Data Studio 设置</h1><p id="2520" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">导航至<a class="ae lb" href="https://datastudio.google.com/u/0/" rel="noopener ugc nofollow" target="_blank">https://datastudio.google.com</a>并点击创建&gt;报告。这将自动打开“Add data to report”选项卡，我们可以在其中选择 PostgreSQL。填写 GKE 提供的外部负载平衡器的 ip 以及<a class="ae lb" href="https://questdb.io/docs/develop/connect" rel="noopener ugc nofollow" target="_blank">默认端口和凭证</a>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/571d75e46521b64e1a0d7ff5c32e356e.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*n3zZ9_Mfor4z4dJ7Me3Y0A.png"/></div></figure><p id="71c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，Google 将每个表都视为一个数据源，所以您必须单独导入每个表。默认情况下，Data Studio 将创建一个包含符号和记录计数的默认表:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/c2b634649021e56ca9a3c48540a6c415.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*dviylHpZ8tcKa-tTNUbbBg.png"/></div></figure><p id="0eaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以修改<code class="fe mv mw mx my b">Dimension</code>以添加其他字段，如市值、最高价、最低价等:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/dae8c65663c2c6d98883227f99dab320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*gokfQr3oIFBBePI-xwCBHg.png"/></div></div></figure><p id="9d7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，Google Data Studio 使用的默认日期格式与 QuestDB 不兼容，因为它使用了尚不支持的<code class="fe mv mw mx my b">DATE_TRUNC</code>函数。点击资源&gt;管理添加的数据源，并将日期格式更改为<code class="fe mv mw mx my b">ISO Year Week</code>。然后，您可以创建一个粗略的 Marketcap 时间序列图表:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi no"><img src="../Images/d910e41ceb37014b6b1c86d03c6bd06e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*_RfpFj1dUE4MfOUY3WZGXQ.png"/></div></figure><p id="fc9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以添加多个维度来检查市场是如何开盘的，当天的最高价和最低价是什么。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a84d153733ff2255a69a123c609c50db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*EoSTJhpPhlFzeXTJfNVFfw.png"/></div></figure><p id="dcb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Data Studio 的图形功能有限，但是您可以导入多个数据源来比较 Cardano 与 Solana 在相似时间段内的价格:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/be3028ab6a7f015c8bf4a8303b7ab8d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*uvDIKQWCH2fp7XJZc7bOEg.png"/></div></figure><h1 id="6468" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">后续步骤</h1><p id="c782" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">目前，QuestDB 本身不支持 SSL 连接。为了启用 SSL，我们可以使用<a class="ae lb" href="https://www.pgbouncer.org/" rel="noopener ugc nofollow" target="_blank"> PgBouncer </a>来保护 Google Data Studio 到 PgBouncer，并利用 Kubernetes 内部的服务网格来保护 PgBouncer 到 QuestDB。您还可以将 QuestDB 置于防火墙之后，只将 Dat Studio 用来访问数据库的<a class="ae lb" href="https://support.google.com/datastudio/answer/7288010?hl=en#zippy=%2Cin-this-article" rel="noopener ugc nofollow" target="_blank">IP 列入白名单。</a></p><p id="2147" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">诚然，除了简单的可视化和自动聚合，Google Data Studio 并不适合严肃的数据分析需求。在下一篇文章中，我们将把 QuestDB 直接连接到 Jupyter 笔记本上，以探索我们关于熊猫的数据。</p></div></div>    
</body>
</html>