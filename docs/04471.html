<html>
<head>
<title>Swift advanced charts from scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始的Swift高级图表</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/swift-advanced-charts-from-scratch-c784971eacb8?source=collection_archive---------0-----------------------#2021-03-21">https://blog.devgenius.io/swift-advanced-charts-from-scratch-c784971eacb8?source=collection_archive---------0-----------------------#2021-03-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/99340a49ee1c547577cd3be702785866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubAm4myuX_QxEIcxA12bWw.jpeg"/></div></div></figure><p id="9834" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你好，我叫亚历克斯，很高兴在这里见到你！</p><p id="aa1b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇文章中，我将向你展示如何用你自己的双手创建高度可定制和灵活的条形图。看看下面的gif，这就是它的样子</p><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/18a0cc4c2145947fcad2b6607d4048e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/1*Ky9vOv18FbeBgI0zz3f-Xw.gif"/></div></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="0fee" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">插曲</h1><p id="f6e0" class="pw-post-body-paragraph jv jw in jx b jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks ig bi translated">但是在我们跳到Xcode之前，有一个小插曲。为什么首先我决定写这篇文章，有许多豆荚和图书馆这样的东西？嗯，最近我在一家公司找到了一份工作，实际上是一家大公司，我得到的第一个任务是——统计的整个模块。我的第一个想法是——“让我们添加<em class="mi"> SwiftCharts”。</em>但后来我被告知—“不不不，孩子，所有的UI都是我们自己做的”。所以我在这里，从头开始创建许多不同的图表。因为我从来没有做过这样的事情，所以我谷歌了很多！我到处学习一些好的技术来完成我的任务。</p><p id="ae10" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以当我最终完成后，我决定分享给你们，这样你们就不用花几个小时去搜索了。尽情享受吧！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="f787" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">步伐</h1><ol class=""><li id="97d8" class="mj mk in jx b jy md kc me kg ml kk mm ko mn ks mo mp mq mr bi translated">创建简单的单色条形图，并为接下来的步骤进行设置</li><li id="1f96" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">给图表添加多值能力，这样它可以显示多种颜色</li><li id="091f" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">加动画，这样看起来就牛逼了:)</li></ol></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="4c97" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">简单图表</h1><p id="b5a9" class="pw-post-body-paragraph jv jw in jx b jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks ig bi translated">我将跳过创建和设置项目的部分——我们都知道如何做。</p><p id="ea86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个<strong class="jx io"> UIView </strong>的子类，并将其命名为<strong class="jx io">条形图。</strong></p><p id="68ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在该类中，我们创建了两个枚举:</p><ol class=""><li id="ec00" class="mj mk in jx b jy jz kc kd kg mx kk my ko mz ks mo mp mq mr bi translated">我们将用它来管理不同类型的输入数据。这个枚举有间距值，这将用来分隔我们的酒吧彼此，所以它看起来很好。</li><li id="6246" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">这个是我创建的，因为我的类用不同的UI处理不同的图表类型，在这篇文章中我们将只关注<em class="mi">多色。</em>但无论如何，拥有一些定制和扩展的空间总是好的。</li></ol><p id="634e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还添加了<strong class="jx io">设置功能，</strong>我们将使用该功能创建图表，并在需要时进行更改。再一次，你可以看到图表有不同的选项，但是现在忘掉双色<em class="mi">吧。</em></p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6078" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们用更多的未来来扩展我们的类:</p><ol class=""><li id="9e20" class="mj mk in jx b jy jz kc kd kg mx kk my ko mz ks mo mp mq mr bi translated">颜色:这个枚举将被用来绘制我们的图表，我在这里使用我的自定义颜色。你可以用你的，或者从github项目里拿这个。</li><li id="9d9f" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated"><strong class="jx io">数据点</strong>:这是一个包含所需数据和值的模型</li></ol><h2 id="10de" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated"><strong class="ak">数据点:</strong></h2><ol class=""><li id="431c" class="mj mk in jx b jy md kc me kg ml kk mm ko mn ks mo mp mq mr bi translated"><strong class="jx io">标签</strong>:要显示在条形下方的X值标签</li><li id="2ddf" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated"><strong class="jx io">值</strong>:棒材的实际值</li><li id="16c3" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated"><strong class="jx io">颜色</strong>:包含条形的颜色，所以每个条形实际上可以是不同的颜色</li><li id="ca7d" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">复合值:这是很重要的一个。这是我们未来的一个变量，高级图表。它包含了工具条的附加值，我们将在主工具条上显示这些值。这是一个数组元组<strong class="jx io"> (CGFloat，Color)。</strong>我选择了这种类型，所以我可以很容易地定制我想要的每个单条。它也是按颜色排序的，所以不管传入的是哪个值，颜色排序总是一样的。</li></ol><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="ab29" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated">好了，最后我们的主要功能</h2><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="44ba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在前4行中，我们简单地获取值并计算<strong class="jx io">间距</strong>和<strong class="jx io">条</strong>的宽度。那么让我们来看看循环中的一些线路:</p><ol class=""><li id="e0cd" class="mj mk in jx b jy jz kc kd kg mx kk my ko mz ks mo mp mq mr bi translated">从数组中获取最大值的百分比。这样做，那么最大的价值总是会有最高的标杆。</li><li id="c240" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">这里我们计算当前条的<strong class="jx io">行高</strong>。还有一个棘手的情况:<strong class="jx io"> <em class="mi">(百分比&gt; 0？百分比:2)。</em> </strong>我这样做了，所以如果值为0，条形仍将可见，否则它看起来就像一个缺口。</li><li id="e7c8" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">根据其索引计算<strong class="jx io"> X </strong>的值。</li><li id="eb02" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">最后用我们之前计算的值为我们的条形创建<strong class="jx io"> rect </strong>。然后从这个带圆角的<strong class="jx io">矩形</strong>创建<strong class="jx io">路径</strong>。我调用变量<strong class="jx io"> endPath </strong>而不仅仅是<strong class="jx io"> path </strong>是有原因的，稍后会返回。</li><li id="ada7" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">最后，我们创建<strong class="jx io">层，并设置路径</strong>。并将我们的新条形层添加到视图的主层中。</li></ol><p id="4fb6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们设置我们的视图控制器来检查我们到目前为止所取得的成绩。我在故事板中添加了<strong class="jx io">条形图</strong>和S <strong class="jx io">增强控件</strong>。你可以用你想要的程序来做，没关系。下面是我的<strong class="jx io"> VC </strong>的样子:</p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7414" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于<strong class="jx io"> ViewController </strong>的几件事:</p><p id="1d55" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看一下<strong class="jx io">段动作</strong>功能:根据选择的段，调用<strong class="jx io">条形图</strong>的<strong class="jx io">设置</strong>功能，需要<strong class="jx io">数据点</strong>的计数。这个函数使用了<strong class="jx io"> randomDataPoints </strong>函数，我创建它是为了简单地获取我的图表所需的数据点数量。</p><h2 id="a84f" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated">这是我们目前得到的信息:</h2><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/de2f8e8bb9436cc68d771529f8171cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZMDkazkAXgDDvsctx-_kFw.gif"/></div></figure><p id="f2e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">还不错！现在让我们添加更多的颜色！</strong></p><p id="422e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是在我们再次跳回代码之前，让我解释一下我的实现背后的思想。<strong class="jx io">这个其实挺重要的！</strong></p><p id="1d00" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们以一个值为100的条为例。现在我们不关心它在视图范围内的高度！我们只有一个值为100，高度为x的条形。现在我们想在它上面再添加一种颜色，我们希望它代表总价值的25%。然后我们必须给它传递值25。有道理对吗？这个图表的所有想法，是主条(蓝色)——是条内所有值的100 %。附加颜色仅代表总价值的某个百分比。<strong class="jx io">所以所有附加颜色的值不能超过主(蓝色)条的值。</strong>我希望用我惊人的英语说得更清楚些:)</p><p id="8dbb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们继续</p><h1 id="9fa3" class="lf lg in bd lh li np lk ll lm nq lo lp lq nr ls lt lu ns lw lx ly nt ma mb mc bi translated">多种颜色的条形</h1><p id="a389" class="pw-post-body-paragraph jv jw in jx b jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks ig bi translated">现在，我们在scheduleMultiColor函数的循环中添加这个代码<strong class="jx io">:</strong></p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><ol class=""><li id="49a9" class="mj mk in jx b jy jz kc kd kg mx kk my ko mz ks mo mp mq mr bi translated">创建一个变量来保存Y轴的偏移量，这样我们就不会把新的图层放在彼此的上面。</li><li id="e22a" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">计算行高。正如我所说的，额外一层的价值只是总价值的一个百分比。所以我们用这个想法来计算它的高度。还有一个<strong class="jx io"> min() </strong>函数，只是为了确保我们的额外层不会高于主层。</li><li id="b6f9" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">计算Y位置。因为我们想让我们的子层位于条的顶部，我们需要<strong class="jx io">从主条</strong>的高度减去它的值。然后我们加上<strong class="jx io"> Y偏移</strong>。</li></ol><p id="6bc2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们做和以前一样的事。创建路径，添加到层，并将此层作为子层添加到我们的<strong class="jx io">栏层</strong>。<strong class="jx io">不要忘记增加Y位置偏移。</strong></p><h2 id="79f9" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated">现在让我们将此功能添加到ViewController中:</h2><p id="eb6a" class="pw-post-body-paragraph jv jw in jx b jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks ig bi translated">我们需要稍微改变一下randomDataPoints 函数，以便它为图表提供额外的值。这是函数现在的样子:</p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b451" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以防你需要一些许可，我们是这样做的:</p><ol class=""><li id="6b91" class="mj mk in jx b jy jz kc kd kg mx kk my ko mz ks mo mp mq mr bi translated">现在，我们在变量<strong class="jx io"> randomValue </strong>中生成并存储条形的总值。</li><li id="d384" class="mj mk in jx b jy ms kc mt kg mu kk mv ko mw ks mo mp mq mr bi translated">然后我们用3元组的数组填充<strong class="jx io">复杂值</strong>。第一个代表总价值的1/4，第二个代表1/6，第三个代表1/8。所以它们合起来应该占总价值的一半。</li></ol><h2 id="c897" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated">让我们看看我们得到了什么</h2><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/a0172d7c53b3d6a23c0271bcab916ad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-3XLfgE49p9W3IKYPgU7ew.gif"/></div></div></figure><p id="3ed7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">好看！现在让我们加入我们都喜爱的动画！</strong></p><h1 id="867a" class="lf lg in bd lh li np lk ll lm nq lo lp lq nr ls lt lu ns lw lx ly nt ma mb mc bi translated">动画</h1><p id="ee1f" class="pw-post-body-paragraph jv jw in jx b jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks ig bi translated">在我们开始添加动画到图表之前，让我们为它创建一些助手。</p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="fa86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个动画的帮助结构。它还包含一些我们不打算使用的功能。但我决定也许对你有用。</p><p id="e0d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以及<strong class="jx io">推车机</strong>的延伸:</p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3a15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个扩展使用先前创建的<strong class="jx io">动画</strong>结构。</p><p id="d395" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们只需要添加几行代码来让我们的图表生动起来。</p><p id="3b01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还记得我给我们的<strong class="jx io">方向</strong>和<strong class="jx io">路径</strong>命名前缀<strong class="jx io"> End吗？</strong>原因如下！要激活路径，首先我们需要创建高度等于0的路径条。然后用动画将这条路径更改为最后一条。</p><p id="e491" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，在为此目的对函数进行了一些重构之后，它看起来是这样的:</p><figure class="ku kv kw kx gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="abcf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你看到了，首先我们创建0个高度栏，然后我们用一行代码制作它的动画！此外，看看我们是如何制作额外图层的动画的，为了让我们的多个图层一个接一个地制作动画，我们需要添加这种平静的代码:<strong class="jx io">延迟:0.5 + (0.3 * Double(index))。</strong>像这样，每一层将在前一层之后立即开始动画。</p><h2 id="31c1" class="nc lg in bd lh nd ne dn ll nf ng dp lp kg nh ni lt kk nj nk lx ko nl nm mb nn bi translated">结果是:</h2><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/18a0cc4c2145947fcad2b6607d4048e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/1*Ky9vOv18FbeBgI0zz3f-Xw.gif"/></div></figure><p id="251f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在我的gitHub报告中找到完整的代码:https://github.com/Kolch/Charts<a class="ae nv" href="https://github.com/Kolch/Charts" rel="noopener ugc nofollow" target="_blank"/></p><p id="d941" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">希望你真的嘱咐过它，并发现它对你自己有用！</strong></p><p id="54d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">今天我只是给你看了我从头开始做的许多图表中的一个！如果你喜欢它，如果你想让我展示更多，请在评论中告诉我。</p><p id="b8c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你鼓掌离开，我会很感激的！:)</p></div></div>    
</body>
</html>