<html>
<head>
<title>SQLAlchemy tutorial pt.1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQLAlchemy 教程第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sqlalchemy-tutorial-pt-1-a5d0967eeb07?source=collection_archive---------7-----------------------#2022-10-16">https://blog.devgenius.io/sqlalchemy-tutorial-pt-1-a5d0967eeb07?source=collection_archive---------7-----------------------#2022-10-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="bbc8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi ki translated">QLAlchemy 是一个包，它能够以<strong class="jm io">python</strong>的方式使用 SQL。SQLAlchemy 最大的优点是你<strong class="jm io">不需要处理不同方言的 SQL </strong> (Postgres，MySQL，Oracle 等)。)而是用<strong class="jm io"> Python 对象</strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/ef6d12a611219bfb8a57c54fd0aa6de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*dWnO2aS2ciwfUKFObWENhw.jpeg"/></div></figure><p id="3c26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有 4 个启动级别:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/413b0a281d8987b3107cb16f55d7da25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*mEoH3-1z54EDIgHFmWWPBw.jpeg"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">SQLAlchemy 结构</figcaption></figure><p id="ff97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将解释最高级的<strong class="jm io"> SQLAlchemy — ORM </strong>(对象关系映射器—将面向对象的类与数据库表相关联的过程)的基础知识。</p><p id="58c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，您将了解到:</p><ul class=""><li id="1abe" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated">如何使用 declarative_base 创建表</li><li id="b05d" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">如何使用引擎/会话</li><li id="aa39" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">简单的数据查询</li><li id="15bd" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">将查询结果存储为熊猫数据帧</li></ul><h2 id="4f0f" class="ls lt in bd lu lv lw dn lx ly lz dp ma jv mb mc md jz me mf mg kd mh mi mj mk bi translated">创建订单表</h2><p id="48a0" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">进口清单。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">进口</figcaption></figure><p id="a135" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了开始工作，我们需要创建能够与数据库建立连接的<strong class="jm io"> url </strong>，我将使用<strong class="jm io"> Postgres </strong>，但是 url 模式对于所有方言来说看起来完全相同<strong class="jm io">。</strong>当我们有 url 时，我们需要创建<strong class="jm io">引擎</strong>对象，该对象能够处理所有交易，因此:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">引擎创建</figcaption></figure><p id="3586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们创建类:订单。这个类将成为我们数据库中的表。为了创建它，<strong class="jm io">declarative _ Base</strong>被使用<strong class="jm io"> </strong>并存储在变量<strong class="jm io"> Base </strong>中(类订单继承自它)。稍后我们将回到基地。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建订单类别</figcaption></figure><p id="b8ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> __tablename__ </strong>是将在数据库中创建的表的名称。</p><p id="80b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Order </strong>类中的属性将是表中相应的列(Column、Integer、String 和 Float 是从 sqlalchemy 导入的类)</p><ul class=""><li id="3fb0" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated">id —整数，主键(主键)</li><li id="6538" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">价格浮动</li><li id="ac57" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">金额—整数</li><li id="5ec2" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">产品标识-整数</li></ul><p id="69a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> __repr__ </strong>可选。</p><p id="d334" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看看下面的笔记本片段:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">笔记本 1</figcaption></figure><p id="e9cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的笔记本中，名为<strong class="jm io">的 python 对象订单</strong>已创建，但数据库尚未被触及！如果我们查看模式，我们可以看到表并不存在:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/818731a95fb19969531709add111d064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lURGSAFjGr_pZH5MPi8ycQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">数据库视图</figcaption></figure><p id="34bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面声明的<strong class="jm io">基</strong>现在将用于在数据库中创建表<strong class="jm io">订单</strong>。</p><p id="c631" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们将<strong class="jm io">上下文管理器</strong>(这超出了本文的范围，但为了简单起见，让我们将上下文管理器视为负责为您打开/关闭与数据库的连接的对象)与<strong class="jm io">引擎对象</strong>-方法一起使用。开始提交交易。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="884c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这种情况下，我们<strong class="jm io">只创建了一个表——orders</strong>,但是如果我们创建更多继承自<strong class="jm io"> Base </strong>的类，那么这些类的相应表也将在我们的数据库中变成活动的。</p><p id="ccb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，表已在数据库中创建:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mx"><img src="../Images/42c4bca0bc52a19f0fa4fac2dc9ac828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yvV8knLbx4EV6Atb9dDl6w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">数据库中的表格订单</figcaption></figure><p id="82cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但它是空的，所以现在让我们看看如何添加之前创建的<strong class="jm io">订单对象</strong>。</p><p id="8c52" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Sessionmaker 将用于创建会话对象。Sessionmaker 是一种协调层。它使用之前创建的<strong class="jm io">引擎</strong>，并负责连接、提交和释放与该引擎的连接。</p><p id="644d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们来看看这个笔记本片段:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">笔记本 2</figcaption></figure><p id="0398" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很少有事情发生:</p><ul class=""><li id="f8e5" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated">订单已添加至进程</li><li id="37a0" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">会话已提交</li></ul><p id="9537" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我们查看数据库中的订单表时，我们将看到以下内容:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi my"><img src="../Images/826eba90d539bdbe39ba16d5e13775db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVCOU9bjfvtv-va7cFBTSQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">添加订单后的订单表</figcaption></figure><p id="6896" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当然，我们可以在那时向表中添加多个对象。下面的笔记本片段解释了如何做到这一点:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="145b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">重要的是当我们使用<strong class="jm io">时。在会话 it 上提交</strong>方法<strong class="jm io">会使所有数据</strong>无效—当我们查看会话<strong class="jm io">时。提交后新建</strong>它<strong class="jm io">应该为空</strong>。</p><p id="849f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">新订单已添加到订单表中，所以现在看起来是这样的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/6cc89a3e26027076950333c66cd4e897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkbCFR6lfJJIzdM20kER-A.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">添加多条记录后的订单表</figcaption></figure><h2 id="0048" class="ls lt in bd lu lv lw dn lx ly lz dp ma jv mb mc md jz me mf mg kd mh mi mj mk bi translated">询问</h2><p id="2987" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">这个笔记本片段展示了如何在 SQLAlchemy 中查询数据</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">简单查询</figcaption></figure><h2 id="03fa" class="ls lt in bd lu lv lw dn lx ly lz dp ma jv mb mc md jz me mf mg kd mh mi mj mk bi translated">为熊猫干杯</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">到熊猫数据框</figcaption></figure><h2 id="27cd" class="ls lt in bd lu lv lw dn lx ly lz dp ma jv mb mc md jz me mf mg kd mh mi mj mk bi translated">哪里走得更远？</h2><ul class=""><li id="7915" class="le lf in jm b jn ml jr mm jv na jz nb kd nc kh lj lk ll lm bi translated">SQLAlchemy 文档是杰出的！下面是 ORM 快速入门部分<a class="ae nd" href="https://docs.sqlalchemy.org/en/14/orm/quickstart.html" rel="noopener ugc nofollow" target="_blank">链接</a></li><li id="4087" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">Mike Bayer 解释了如何使用 SQLAlchemy。太神奇了 youtube 教程<a class="ae nd" href="https://www.youtube.com/watch?v=sO7FFPNvX2s&amp;t=9355s&amp;ab_channel=SixFeetUp" rel="noopener ugc nofollow" target="_blank">链接</a></li></ul><p id="5f90" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请继续关注下一篇文章，在那篇文章中，我将解释与 ORM 相关的更高级的东西。</p><p id="c9f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回购代码:<a class="ae nd" href="https://github.com/Cloudy17g35/sql-alchemy-tutorial-medium/tree/main" rel="noopener ugc nofollow" target="_blank">此处</a></p></div></div>    
</body>
</html>