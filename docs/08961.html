<html>
<head>
<title>How to Handle Multiple Environments in NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 NodeJS 中处理多种环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-handle-multiple-environments-in-nodejs-7391d2db2abe?source=collection_archive---------0-----------------------#2022-07-21">https://blog.devgenius.io/how-to-handle-multiple-environments-in-nodejs-7391d2db2abe?source=collection_archive---------0-----------------------#2022-07-21</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="7851" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何建立一个专业的节点工程</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/dc55d69842f08d118c70a801f41dec40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKE-fgf80HbusoX9XSjtRw.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">由<a class="ae kw" href="https://unsplash.com/@euwars?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">法尔扎德·纳兹菲</a>在<a class="ae kw" href="https://unsplash.com/s/photos/technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="f445" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">对于生产级应用程序，我们需要支持多种环境。例如，您需要为不同的环境使用不同的数据库。用途很多，这只是其中之一。</p><p id="b47e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天，我们将了解如何在 NodeJS 应用程序中管理多个环境。</p><h2 id="941e" class="lt lu ir bd lv lw lx dn ly lz ma dp mb lg mc md me lk mf mg mh lo mi mj mk ml bi translated">在我们开始之前…</h2><p id="3c5a" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">我用 ExpressJS 和 Typescript 创建了一个<a class="ae kw" href="https://github.com/Mohammad-Faisal/professional-express-sequelize-docker-boilerplate" rel="noopener ugc nofollow" target="_blank">专业样板。本文是这个系列的一部分。你可以在下面找到所有的文章。</a></p><pre class="kh ki kj kk gu mr ms mt bn mu mv bi"><span id="7fd0" class="mw lu ir ms b be mx my l mz na"><strong class="ms is">* </strong><a class="ae kw" href="https://javascript.plainenglish.io/create-an-express-boilerplate-with-typescript-810eb6c29196" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Creating a ExpressJS + Typescript Boilerplate</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://javascript.plainenglish.io/how-to-set-up-linter-formatter-for-node-js-d6b34c0c8be5" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">How to setup Linter and Formatter for NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/how-to-handle-multiple-environments-in-nodejs-7391d2db2abe"><strong class="ms is">How to handle multiple environments in NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://javascript.plainenglish.io/error-handling-in-node-js-like-a-pro-ed210baa0600" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Error Handling in NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://medium.com/p/c69f2494cf18" rel="noopener"><strong class="ms is">Request validation in NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://levelup.gitconnected.com/use-docker-with-nodejs-projects-like-a-pro-a9e7504e1308" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Using Docker Professionally with NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://javascript.plainenglish.io/node-js-database-with-docker-for-local-development-285212c5162f" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Using Docker for Local Development in NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://javascript.plainenglish.io/node-js-logging-for-professionals-6be07c003e7f" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Logging in NodeJS</strong></a><strong class="ms is"><br/><br/>* </strong><a class="ae kw" href="https://levelup.gitconnected.com/kubernetes-deployment-with-nodejs-made-easy-eaeec32b62e3" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Kubernetes with NodeJS</strong></a></span></pre><p id="1d9f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们开始吧！</p><h1 id="0079" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">传统方式</h1><p id="d069" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">使用环境变量最直接的方法是使用我们的 package.json 文件。让我们创建两个命令来演示两种环境。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="afdf" class="lt lu ir ms b gz np nq l mz na">"scripts": {<br/>    "start-dev": "PORT=3000 ts-node-dev --respawn src/index.ts",<br/>    "start-prod": "PORT=4000  ts-node-dev --respawn src/index.ts"<br/>  }</span></pre><p id="41ff" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们定义了两个命令。对于开发，我们已经设置了<code class="fe nr ns nt ms b">start-dev</code>，其中端口变量的值应该是 3000。而对于<code class="fe nr ns nt ms b">prod</code>将是 4000。</p><p id="cdee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果我们运行应用程序</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="453c" class="lt lu ir ms b gz np nq l mz na">yarn start-dev</span></pre><p id="d218" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">您将收到以下消息。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="3267" class="lt lu ir ms b gz np nq l mz na">Connected successfully on port 3000</span></pre><p id="1639" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">运行 start-prod 将为您提供</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="5401" class="lt lu ir ms b gz np nq l mz na">Connected successfully on port 4000</span></pre><p id="ce98" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，我们已经成功地使我们的应用程序可配置。</p><h1 id="32f2" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">让我们更进一步。</h1><p id="5e3c" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">如果我们需要另一个在不同环境下会变化的变量呢？我们可以在字符串中添加另一个变量。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nu nv l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">package.json</figcaption></figure><p id="4771" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">通过<code class="fe nr ns nt ms b">process.env.SOMETHING_ELSE</code>可以到达这里的<code class="fe nr ns nt ms b">SOMETHING_ELSE</code></p><p id="9625" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是在现实生活中，我们有很多环境需要改变。我们如何做到这一点？</p><h1 id="2330" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">让我们创建一个环境文件。</h1><p id="1a7d" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">为了管理许多环境变量，我们可以使用环境文件。转到您的项目，创建一个. env 文件，并粘贴以下内容。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="81d8" class="lt lu ir ms b gz np nq l mz na">PORT=3000<br/>SOMETHING_ELSE=dev</span></pre><p id="abd6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">并从 package.json 命令中删除环境。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="10ce" class="lt lu ir ms b gz np nq l mz na">"scripts": {<br/>    "start-dev": "ts-node-dev --respawn src/index.ts",<br/>    "start-prod": "ts-node-dev --respawn src/index.ts",<br/> },</span></pre><p id="9fc6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们跑吧！</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="b351" class="lt lu ir ms b gz np nq l mz na">yarn start-dev</span></pre><p id="e159" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这将给出以下输出。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="3f92" class="lt lu ir ms b gz np nq l mz na">Connected successfully on port 5000</span></pre><p id="1ebe" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这太奇怪了。因为我们应该将 3000 视为端口，但它给了我们 5000。</p><p id="66de" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">原因是尽管我们添加了环境变量，NodeJS 不会自动读取它们。</p><h1 id="ff0b" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">让我们读取我们的环境变量。</h1><p id="f751" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">我们有一个非常受欢迎的软件包来为我们做这件事。名字是<a class="ae kw" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a></p><p id="95bf" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们先安装它。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="ff6a" class="lt lu ir ms b gz np nq l mz na">yarn add dotenv</span></pre><p id="a5c3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">并将其导入我们的应用程序，如下所示。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="7653" class="lt lu ir ms b gz np nq l mz na">import "dotenv/config";</span></pre><p id="f4ba" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">或者像这样</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="ae7d" class="lt lu ir ms b gz np nq l mz na">import dotenv from "dotenv";<br/>const configuration: any = dotenv.config().parsed;</span></pre><p id="6768" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这就够了。您不需要做任何其他事情来读取环境文件。这个包将通过 process.env 为我们的应用程序提供变量</p><p id="9bc9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了验证这一点，您可以运行。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="1ead" class="lt lu ir ms b gz np nq l mz na">yarn start-dev</span></pre><p id="e867" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">您将再次看到应用程序在端口 3000 上运行。</p><h1 id="e5fa" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">多重环境</h1><p id="4222" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">现在让我们为应用程序生产做好准备。让我们为不同的环境创建两个不同的文件。</p><p id="c348" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">根据环境创建文件，如<code class="fe nr ns nt ms b">.env.development</code>和<code class="fe nr ns nt ms b">.env.production</code></p><p id="d188" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们需要在启动过程中加载文件。Windows 环境有时会面临加载环境的问题。为了解决这个问题，让我们安装一个名为<code class="fe nr ns nt ms b"><a class="ae kw" href="https://www.npmjs.com/package/cross-env" rel="noopener ugc nofollow" target="_blank"><strong class="kz is">cross-env</strong></a></code>的包</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="0929" class="lt lu ir ms b gz np nq l mz na">yarn add -D cross-env</span></pre><p id="98d0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后为 package.json 中的那些创建单独的脚本</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="2432" class="lt lu ir ms b gz np nq l mz na">"dev": "cross-env NODE_ENV=development ts-node-dev --respawn src/index.ts",<br/>"prod": "cross-env NODE_ENV=production ts-node-dev --respawn src/index.ts",</span></pre><p id="16b0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后修改配置文件，如下所示:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nu nv l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">配置文件</figcaption></figure><p id="ab3b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，我们可以在应用程序的任何地方使用该配置。</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="49c8" class="lt lu ir ms b gz np nq l mz na">import Config from "./utils/Configuration";</span><span id="db84" class="lt lu ir ms b gz nw nq l mz na">console.log(Config.port);</span></pre><p id="51d2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">就是这样！现在，您可以拥有任意多的环境，并轻松处理它们。</p><h1 id="9cd9" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">最后的话</h1><p id="95a8" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">不要忘记添加。env 文件到您的。gitignore 文件。否则，你所有的秘密都会暴露。</p><p id="f617" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">打开您的<code class="fe nr ns nt ms b">.gitignore</code>文件并添加以下内容</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="f898" class="lt lu ir ms b gz np nq l mz na">.env.development<br/>.env.production</span></pre><p id="4dcc" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">就是这样。祝你今天过得愉快，:D</p><pre class="kh ki kj kk gu mr ms nm nn aw no bi"><span id="d498" class="lt lu ir ms b gz np nq l mz na"><strong class="ms is">Want to Connect?</strong></span><span id="e216" class="lt lu ir ms b gz nw nq l mz na">You can reach out to me via <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">LinkedIN</strong></a> or my <a class="ae kw" href="https://www.mohammadfaisal.dev/blog" rel="noopener ugc nofollow" target="_blank"><strong class="ms is">Personal Website</strong></a></span></pre><h1 id="1893" class="nb lu ir bd lv nc nd ne ly nf ng nh mb jx ni jy me ka nj kb mh kd nk ke mk nl bi translated">GitHub 回购</h1><div class="nx ny gq gs nz oa"><a href="https://github.com/Mohammad-Faisal/nodejs-environment-handling" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd is gz z fq of fs ft og fv fx iq bi translated">GitHub-Mohammad-fais al/nodejs-environment-handling:在 NodeJS 中处理多个环境</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">对于生产级应用程序，我们需要支持多种环境。例如，您将需要使用不同的…</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kq oa"/></div></div></a></div><div class="nx ny gq gs nz oa"><a href="https://javascript.plainenglish.io/error-handling-in-node-js-like-a-pro-ed210baa0600" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd is gz z fq of fs ft og fv fx iq bi translated">像专家一样处理 Node.js 中的错误</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">你需要知道的一切。</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="oj l"><div class="op l ol om on oj oo kq oa"/></div></div></a></div><div class="nx ny gq gs nz oa"><a href="https://levelup.gitconnected.com/use-docker-with-nodejs-projects-like-a-pro-a9e7504e1308" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd is gz z fq of fs ft og fv fx iq bi translated">像专业人士一样使用 Docker 和 NodeJS 项目！</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">在开发和生产中利用 Docker 的力量</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo kq oa"/></div></div></a></div><div class="nx ny gq gs nz oa"><a href="https://javascript.plainenglish.io/node-js-logging-for-professionals-6be07c003e7f" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd is gz z fq of fs ft og fv fx iq bi translated">专业人员的 Node.js 日志记录</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">发挥温斯顿和摩根的全部潜力</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="oj l"><div class="or l ol om on oj oo kq oa"/></div></div></a></div><div class="nx ny gq gs nz oa"><a href="https://javascript.plainenglish.io/node-js-database-with-docker-for-local-development-285212c5162f" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd is gz z fq of fs ft og fv fx iq bi translated">Node.js +带有 Docker 的数据库，用于本地开发</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">各种数据库的一站式解决方案。</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="oj l"><div class="os l ol om on oj oo kq oa"/></div></div></a></div></div></div>    
</body>
</html>