<html>
<head>
<title>Custom Shapes in Jetpack Compose (Deep Dive)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack 组合中的自定义形状(深潜)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/custom-shapes-in-jetpack-compose-deep-dive-b987a52c743c?source=collection_archive---------0-----------------------#2022-06-05">https://blog.devgenius.io/custom-shapes-in-jetpack-compose-deep-dive-b987a52c743c?source=collection_archive---------0-----------------------#2022-06-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/49cbe28698babb8cb03bee4f32e70fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wM-tRmJ-ZuiQ3PgwfNZfgA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源:<a class="ae jz" href="https://www.befunky.com/learn/graphic-design-geometric-shapes/" rel="noopener ugc nofollow" target="_blank">https://www . be funky . com/learn/graphic-design-geometric-shapes/</a></figcaption></figure><p id="9bb7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 Compose 中，您可以将可组合剪辑成任何形状。框架提供了一些预定义的形状，如<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">CircleShape</em></strong></code>、<code class="fe ky kz la lb b"> <strong class="kc io"><em class="lc">RoundCornerShape</em></strong></code>、<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">CutCornerShape</em></strong></code>等。但是如果你想要框架中不存在的其他形状，比如五边形呢？。</p><blockquote class="ld le lf"><p id="ce17" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated">当某样东西不存在时，你会怎么做？在我以前的文章中找到答案:)</p></blockquote><h1 id="f992" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">深潜</h1><p id="00c7" class="pw-post-body-paragraph ka kb in kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">您可以使用以下工具裁剪形状</p><pre class="mm mn mo mp gt mq lb mr ms aw mt bi"><span id="8599" class="mu lk in lb b gy mv mw l mx my">Modifier<br/>    .<em class="lc">width</em>(100.<em class="lc">dp</em>)<br/>    .<em class="lc">height</em>(100.<em class="lc">dp</em>)<br/>    .<em class="lc">clip</em>(your shape),</span></pre><p id="c827" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">clip()</code>被定义为以一个形状作为自变量。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="947b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Shape</em></strong></code>是一个带有抽象方法<code class="fe ky kz la lb b">createOutline()</code>的接口，它返回一个<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Outline</em></strong></code>，我们的形状将被裁剪到这个接口上。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="4fab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Outline</em></strong></code>是一个密封类，具有预定义的大纲<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Rectangle</em></strong></code>和<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Rounded.</em></strong></code>，但是我们感兴趣的是<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Generic</em></strong></code>，它接受一个<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Path</em></strong></code>并从中创建大纲。而一条<strong class="kc io"> <em class="lc">路径</em> </strong>可以形成任何你想要的形状。</p><h1 id="65ab" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">保持身材</h1><p id="6238" class="pw-post-body-paragraph ka kb in kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">让我们创建一个<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Shape</em></strong></code>的子类，我们称之为<strong class="kc io">多边形</strong>。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8f41" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">多边形</strong>接受边数并创建一个等边多边形<code class="fe ky kz la lb b"><strong class="kc io">Path</strong></code>，旋转用于旋转该多边形。我们可以将这个<code class="fe ky kz la lb b"><strong class="kc io"><em class="lc">Path</em></strong></code>传递给<code class="fe ky kz la lb b"><strong class="kc io">Outline.Generic()</strong></code></p><p id="9717" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">用法</strong></p><pre class="mm mn mo mp gt mq lb mr ms aw mt bi"><span id="0700" class="mu lk in lb b gy mv mw l mx my">Image(<br/>    painter = painterResource(id = R.drawable.<em class="lc">image10</em>),<br/>    contentDescription = null,<br/>    modifier = Modifier<br/>        .<em class="lc">width</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">height</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">clip</em>(Polygon(3,0f)),<br/>    contentScale = ContentScale.Crop<br/>)</span></pre><p id="1c70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">结果</strong></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b1be3836c6f99f9beb62aad8aa46336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:268/format:webp/1*CF5UQBnaDfc6kt3ibRnY5g.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="nc">剪辑</em>(多边形(3，0f))</figcaption></figure><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/74a7717c4092b7ef2fa4ae9f7389525e.png" data-original-src="https://miro.medium.com/v2/resize:fit:266/format:webp/1*NC7NGaGiiGE_JKTfCBh7NA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><em class="nc">剪辑</em>(多边形(5，0f))</figcaption></figure><p id="a3bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你刚才说了一次吗？，Ok OkT39】</p><p id="5786" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们创建一个平行四边形</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="1bbc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">平行四边形</strong>取左下角的角度。所有其他角度都将从它导出。</p><p id="e61c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">用法</strong></p><pre class="mm mn mo mp gt mq lb mr ms aw mt bi"><span id="60ab" class="mu lk in lb b gy mv mw l mx my">Image(<br/>    painter = painterResource(id = R.drawable.<em class="lc">image10</em>),<br/>    contentDescription = null,<br/>    modifier = Modifier<br/>        .<em class="lc">width</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">height</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">clip</em>(Parallelogram(70f)),<br/>    contentScale = ContentScale.Crop<br/>)</span></pre><p id="c86f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">结果</strong></p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/02edfd6ecfc74bd3225c1b99ed5b7132.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*xhQTpXi1KcAIb2nuWT880Q.png"/></div></figure><h2 id="dc05" class="mu lk in bd ll nf ng dn lp nh ni dp lt kl nj nk lx kp nl nm mb kt nn no mf np bi translated">你说复杂的形状呢？</h2><p id="bc35" class="pw-post-body-paragraph ka kb in kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">是的，你是对的。你想只为简单的形状编写这种路径，但是如果你试图为复杂的任意形状编写这些路径，上面的过程可能会把你的灵魂吸走。</p><p id="52e0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想要一个<strong class="kc io">心形</strong>形状，如下图所示</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9a003610318cd6f11464652829f2061a.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*jIeuFFV3GCcvyrJzD1I-6Q.png"/></div></figure><h1 id="ed88" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">把她放在你的心里</h1><p id="b6a3" class="pw-post-body-paragraph ka kb in kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">编写代码以编程方式为简单形状创建路径是可以的，但为心形等形状创建路径真的会给你带来困难。</p><blockquote class="ld le lf"><p id="1d82" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated">那我们该怎么办？</p></blockquote><p id="0c02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">幸运的是，我们可以从一个<code class="fe ky kz la lb b">svg</code>文件的路径数据中创建一个<code class="fe ky kz la lb b">Path</code>对象。请按照下面的步骤，让它变得非常容易。</p><ol class=""><li id="d6a9" class="nr ns in kc b kd ke kh ki kl nt kp nu kt nv kx nw nx ny nz bi translated">从网上下载一个心形<code class="fe ky kz la lb b">svg</code>或任何其他的<code class="fe ky kz la lb b">svg</code>，但它应该只包含一个<code class="fe ky kz la lb b">Path</code>标签。</li><li id="4d1e" class="nr ns in kc b kd oa kh ob kl oc kp od kt oe kx nw nx ny nz bi translated">现在用记事本打开，找到<code class="fe ky kz la lb b">d</code>属性。</li></ol><blockquote class="ld le lf"><p id="3f51" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">d</code>属性包含用于绘制 svg 的路径命令。</p><p id="6b90" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated">例如，在下面的路径中<code class="fe ky kz la lb b">M60.83,17.19</code>表示与<strong class="kc io">的<code class="fe ky kz la lb b">moveTo(60.83,17.19)</code>类似，路径</strong>的<strong class="kc io">类</strong>和<code class="fe ky kz la lb b">C68.84,8.84,74.45,1.62,86.79,0.21</code>类似<code class="fe ky kz la lb b">cubicTo(68.84,8.84,74.45,1.62,86.79,0.21)</code>等等。你可以在这里 了解更多<code class="fe ky kz la lb b">svg</code>命令<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d" rel="noopener ugc nofollow" target="_blank"> <em class="in"/></a></p></blockquote><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="1943" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个路径字符串<code class="fe ky kz la lb b">d</code>也可以被转换成 android 的一个<code class="fe ky kz la lb b"><strong class="kc io">Path</strong></code>对象，但是这个路径将有硬编码的绘图命令。例如，对于<code class="fe ky kz la lb b">M60.83,17.19 </code>，它将包含一个<code class="fe ky kz la lb b">moveTo(60.83,17.19)</code>，因此我们的组件大小无关紧要，绘图将从<code class="fe ky kz la lb b">x = 60.83</code>和<code class="fe ky kz la lb b">y = 17.19</code>开始。</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/a5b7f77faafd447208c62991ba4d4ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vTvL-BGlkGh8dGc7YRmtDQ.png"/></div></div></figure><p id="2f40" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如你在上面看到的，这不是预期的行为，因为只有一个固定的尺寸适合这种形状，对于其他尺寸，它会在不正确的地方剪辑。但是我们不能根据形状的 svg 大小来调整可组合组件的大小，因为它们应该根据 UI 需求来调整大小。因此，我们必须根据可组合的大小来调整形状。</p><h1 id="59c2" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">缩放路径数据</h1><p id="e97b" class="pw-post-body-paragraph ka kb in kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">svg 中的大小是由<code class="fe ky kz la lb b">svg</code>标签下的<code class="fe ky kz la lb b"><a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox" rel="noopener ugc nofollow" target="_blank">viewBox</a></code>属性给出的，你可以在上面的要点中看到。</p><blockquote class="ld le lf"><p id="890f" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">viewBox=”0 0 122.88 107.41"</code></p><p id="bf2b" class="ka kb lc kc b kd ke kf kg kh ki kj kk lg km kn ko lh kq kr ks li ku kv kw kx ig bi translated">最后两个数字<code class="fe ky kz la lb b">122.88</code>和<code class="fe ky kz la lb b">107.41</code>分别代表<code class="fe ky kz la lb b">width</code>和<code class="fe ky kz la lb b">height</code>，这个<code class="fe ky kz la lb b">svg</code>就是根据这两个数字创建的。</p></blockquote><p id="065f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，在这种情况下，如果我们的可组合元素的大小为<code class="fe ky kz la lb b">width = 122.88</code>像素和<code class="fe ky kz la lb b">height = 107.41</code>，那么命令或原始路径将完全适合，我们不需要做任何改变。但是如果我们的可组合体大小不同，假设它是在<code class="fe ky kz la lb b">viewbox.</code>中给出的大小的两倍</p><p id="d30a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后<code class="fe ky kz la lb b">width = 245.76</code>像素和<code class="fe ky kz la lb b">height = 214</code>因此我们不能使用原始路径，否则它会像上图中的第一个例子一样被剪切。所以我们需要转换 svg 的命令来适应新的大小。</p><p id="f13a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以从<code class="fe ky kz la lb b">viewbox</code>中，如果我知道<code class="fe ky kz la lb b">width = 122.88</code>和<code class="fe ky kz la lb b">height = 107.41</code>并且一个命令是<code class="fe ky kz la lb b">M60.83,17.19</code>，那么我可以说如果宽度和高度加倍，命令中的坐标也会加倍，所以对于<code class="fe ky kz la lb b">width = 245.76</code>和<code class="fe ky kz la lb b">height = 214</code>命令将是由<code class="fe ky kz la lb b">scaleX = newWidth/orignalWith</code>和<code class="fe ky kz la lb b">scaleY = newHeight/originalHeight</code>给出的<code class="fe ky kz la lb b">M121,35.32</code></p><p id="782a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在下面的代码中做了同样的事情，首先我找到了<code class="fe ky kz la lb b">d</code>中的所有数字，因为数字是路径数据中的 x 和 y 坐标，然后我将它们乘以正确的比例因子，并创建一个新的路径数据，然后根据新的路径数据创建<code class="fe ky kz la lb b">Path</code>对象，然后使用该路径对象进行绘制。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c5d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在只要用 like</p><pre class="mm mn mo mp gt mq lb mr ms aw mt bi"><span id="24e6" class="mu lk in lb b gy mv mw l mx my">Image(<br/>    painter = painterResource(id = R.drawable.<em class="lc">image10</em>),<br/>    contentDescription = null,<br/>    modifier = Modifier<br/>        .<em class="lc">width</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">height</em>(100.<em class="lc">dp</em>)<br/>        .<em class="lc">clip</em>(Heart()),<br/>    contentScale = ContentScale.Crop<br/>)</span></pre><p id="876e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢，祝您愉快:)</p></div></div>    
</body>
</html>