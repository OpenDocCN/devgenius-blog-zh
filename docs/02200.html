<html>
<head>
<title>How to Build a Covid-19 Dashboard in Python and Dash and Deploy on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 和 Dash 构建新冠肺炎仪表板并在 Heroku 上部署</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-a-covid-19-dashboard-in-python-and-dash-and-deploy-on-heroku-58ad0fec8cb4?source=collection_archive---------1-----------------------#2020-07-23">https://blog.devgenius.io/how-to-build-a-covid-19-dashboard-in-python-and-dash-and-deploy-on-heroku-58ad0fec8cb4?source=collection_archive---------1-----------------------#2020-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/53fd1ae407d2658ee88cae98e51961a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1I-9ujk8pLYTUg6E3xecw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">具有阳性/阴性百分比和每日百分比变化的每日 Covid 病例</figcaption></figure><h1 id="21e3" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">仪表板 URL:</h1><div class="kx ky gp gr kz la"><a href="http://covid-heroku-us.herokuapp.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd io gy z fp lf fr fs lg fu fw im bi translated">破折号</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">编辑描述</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">covid-heroku-us.herokuapp.com</p></div></div></div></a></div><p id="a4e3" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我将以:无论如何，这都不是一个快速的应用程序开始。它不是建立在一些 wix 或按月付费的托管网站上，它完全是用 python 构建的，并通过 heroku —  <strong class="ll io"> <em class="mh">、免费的</em> </strong> <em class="mh">进行部署。因此，如果它不能立即加载，请耐心等待，它会加载的！</em></p><p id="b55d" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我将第一个承认——我并不以我的设计/艺术能力而闻名。我年轻的时候，喜欢画城堡，但也就画这么多了。此外，我画的也不是城堡，这一点并不明显；有人告诉我有一个看起来像谷仓。我提醒你，这是在手机时代之前。</p><p id="c6a4" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">本文将尝试描述我创建和“设计”美国新冠肺炎仪表板的方法，这种仪表板上的图表在其他地方可能找不到。作为一名数据工程师，以前也是一名数据科学家，我并不觉得高管层要求的典型图表很有趣。</p><h1 id="9093" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">仪表板的步骤</h1><ul class=""><li id="608e" class="mi mj in ll b lm mk lq ml lu mm ly mn mc mo mg mp mq mr ms bi translated">下载所需资料——jupyter、heroku cli、python 和库等。</li><li id="44f6" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">找到数据源——我使用了“我们的数据世界”</li><li id="0cf8" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">导入库并连接到。csv 页面</li><li id="12f7" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">制作图表</li><li id="da87" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">部署在 heroku——说起来容易做起来难，我知道</li></ul><h1 id="762e" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">下载所需材料</h1><p id="b031" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">我不会在这一节过多地讨论——如果您正在阅读本文，那么您可能有自己最喜欢的 IDE，您至少听说过“deploy”和“heroku”这两个词，因此可能也听说过“flask”和“dash ”,所以我不会浪费您太多时间。我们将使用<a class="ae nb" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll io"> Python3 </strong> </a>，<a class="ae nb" href="http://www.plotly.com" rel="noopener ugc nofollow" target="_blank"> <strong class="ll io"> Plotly </strong>。<strong class="ll io"> js </strong> </a>，<a class="ae nb" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll io"> Dash </strong> </a>，<a class="ae nb" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ll io">Atom</strong></a><strong class="ll io"/>，<a class="ae nb" href="https://id.heroku.com/login" rel="noopener ugc nofollow" target="_blank"> <strong class="ll io"> heroku </strong> </a>。要么接受，要么放弃！</p><h1 id="0435" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">数据源</h1><p id="7f1f" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">正如在仪表盘顶部的几个句子中提到的，来源来自这个链接:<a class="ae nb" href="https://covidtracking.com/api/v1/us/daily.csv" rel="noopener ugc nofollow" target="_blank">https://covidtracking.com/api/v1/us/daily.csv</a>把这个导入到你笔记本的数据框中，然后继续前进。</p><ul class=""><li id="da98" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">快速提示，我在运行这个程序时遇到了一个问题——我相信它与身份验证有关——但是之前在一个单元中运行过下面的代码，应该没问题了。</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="b403" class="no ka in nk b gy np nq l nr ns">#Server certificate verification by default has been<br/># introduced to Python recently (in 2.7.9).<br/># This protects against man-in-the-middle attacks,<br/># and it makes the client sure that the server is indeed who it <br/># claims to be.<br/># if the first execution doesn't run, just run it again.</span><span id="4a8d" class="no ka in nk b gy nt nq l nr ns">import os, ssl<br/>if (not os.environ.get('PYTHONHTTPSVERIFY', '') and<br/>getattr(ssl, '_create_unverified_context', None)):<br/>    ssl._create_default_https_context = ssl._create_unverified_context</span></pre><h1 id="e1a5" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">导入这些库</h1><p id="7b5e" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">不管<code class="fe nu nv nw nk b">pip freeze &gt; requirements.txt</code>怎么说，这个应用程序中没有使用太多的库。用于启动和运行笔记本电脑的主要库有:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="dac6" class="no ka in nk b gy np nq l nr ns">import dash  # (version 1.12.0) pip install dash<br/>import dash_table<br/>import dash_core_components as dcc<br/>import dash_html_components as html<br/>from dash.dependencies import Input, Output, State</span><span id="012c" class="no ka in nk b gy nt nq l nr ns">import pandas as pd<br/>import plotly<br/>import numpy as np<br/># import seaborn as sns</span><span id="b3d4" class="no ka in nk b gy nt nq l nr ns">import plotly.express as px<br/>from plotly.subplots import make_subplots<br/>import plotly.graph_objects as go<br/>import matplotlib.pyplot as plt<br/>import plotly.figure_factory as ff</span><span id="4fd1" class="no ka in nk b gy nt nq l nr ns">import csv<br/>from urllib.request import urlopen<br/>import urllib.request</span></pre><h1 id="f850" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将数据拉入熊猫数据框架</h1><p id="ee02" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">运行上面的代码，然后运行下面的代码，你应该很好:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="4e19" class="no ka in nk b gy np nq l nr ns">url = "https://covidtracking.com/api/v1/us/daily.csv"df = pd.read_csv(url)<br/>df.head()</span></pre><h1 id="86ad" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">制作图表——哎呀</h1><p id="00dc" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">这就是开始变得棘手的地方。这些图表都基于一个名为 plotly 的 python 库，这是我迄今为止发现的最好的数据可视化库，可能在地理位置方面不如其他库，但对于常规的旧数据可视化来说，这是很好的。它也是交互式的，并有动画选项。让我们一个接一个地检查一下——如果我不在此时此地记录它，我可能永远也不会记录它。永远不会。</p><h2 id="d718" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">格式化数据</h2><p id="e047" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">在制作图表之前，让我们先把所有的数据整理成正确的格式，然后把所有的栏目加进去。我已经完成了所有这些工作，所以只需运行以下代码:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0ce7" class="no ka in nk b gy np nq l nr ns">#make new date column<br/>df['year'] = df.date.astype(str).str[:4]<br/>df['month_day'] = df.date.astype(str).str[-4:]<br/>df['day'] = df.date.astype(str).str[-2:]<br/>df['month'] = df.month_day.astype(str).str[:2]<br/>df['date_new'] = df['year'] + "-" + df['month'] + "-" + df['day']</span><span id="0702" class="no ka in nk b gy nt nq l nr ns"># df.head()</span><span id="5d0f" class="no ka in nk b gy nt nq l nr ns">df['date_new'] = df['date_new'].astype('datetime64')<br/>df.dtypes</span><span id="0a6d" class="no ka in nk b gy nt nq l nr ns">cases = df[['date_new', 'totalTestResultsIncrease', 'negativeIncrease', 'positiveIncrease', 'deathIncrease', 'hospitalizedIncrease']]<br/># cases.head(20).style.background_gradient(cmap='Pastel1')</span><span id="1ed5" class="no ka in nk b gy nt nq l nr ns">#create percent columns<br/>cases['percent_positive'] = cases['positiveIncrease']/cases['totalTestResultsIncrease']<br/>cases['percent_negative'] = cases['negativeIncrease']/cases['totalTestResultsIncrease']<br/>cases['percent_death'] = cases['deathIncrease']/cases['totalTestResultsIncrease']<br/>cases['percent_hospitalized'] = cases['hospitalizedIncrease']/cases['totalTestResultsIncrease']<br/># cases.head(20)</span><span id="4493" class="no ka in nk b gy nt nq l nr ns">#create percent change columns<br/>cases['positive_pct_change'] = cases['percent_positive'].pct_change()<br/>cases['negative_pct_change'] = cases['percent_negative'].pct_change()<br/>cases['total_cases_pct_change'] = cases['totalTestResultsIncrease'].pct_change()<br/>cases['death_pct_change'] = cases['percent_death'].pct_change()<br/>cases['hospitalized_pct_change'] = cases['percent_hospitalized'].pct_change()<br/># cases</span><span id="bb05" class="no ka in nk b gy nt nq l nr ns">#filter out old dates<br/>cases = cases[cases['date_new'] &gt; '2020-03-20']<br/># cases.head(20).style.background_gradient(cmap="Blues")</span><span id="71bb" class="no ka in nk b gy nt nq l nr ns">#make variables for subplots<br/>percent_positive = list(cases.percent_positive)<br/>percent_negative = list(cases.percent_negative)<br/>percent_death = list(cases.percent_death)<br/>percent_hospitalized = list(cases.percent_hospitalized)</span><span id="df30" class="no ka in nk b gy nt nq l nr ns">negativeIncrease = list(cases.negativeIncrease)<br/>positiveIncrease = list(cases.positiveIncrease)<br/>deathIncrease = list(cases.deathIncrease)<br/>hospitalizedIncrease = list(cases.hospitalizedIncrease)</span><span id="09b6" class="no ka in nk b gy nt nq l nr ns">totalTestResultsIncrease = list(cases.totalTestResultsIncrease)<br/>total_cases_pct_change = list(cases.total_cases_pct_change)<br/>positive_pct_change = list(cases.positive_pct_change)<br/>negative_pct_change = list(cases.negative_pct_change)<br/>death_pct_change = list(cases.death_pct_change)<br/>hospitalized_pct_change = list(cases.hospitalized_pct_change)<br/>date = list(cases.date_new)</span><span id="d90e" class="no ka in nk b gy nt nq l nr ns">#melt daily percent change columns into one dataframe<br/>positive_pct_melt = pd.melt(cases, id_vars=['date_new'],value_vars=['positive_pct_change'])<br/>negative_pct_melt = pd.melt(cases, id_vars=['date_new'],value_vars=['negative_pct_change'])<br/>death_pct_melt = pd.melt(cases, id_vars=['date_new'],value_vars=['death_pct_change'])<br/>hospitalized_pct_melt = pd.melt(cases, id_vars=['date_new'],value_vars=['hospitalized_pct_change'])<br/>total_cases_pct_melt = pd.melt(cases, id_vars=['date_new'],value_vars=['total_cases_pct_change'])</span><span id="4abd" class="no ka in nk b gy nt nq l nr ns"># print(positive_pct_melt.head())<br/># print(negative_pct_melt.head())<br/># print(death_pct_melt.head())<br/># print(hospitalized_pct_melt.head())<br/># print(total_cases_pct_melt.head())</span><span id="76e1" class="no ka in nk b gy nt nq l nr ns">cases_melted1 = positive_pct_melt.append(negative_pct_melt,ignore_index=True)<br/>cases_melted2 = cases_melted1.append(death_pct_melt,ignore_index=True)<br/>cases_melted3 = cases_melted2.append(hospitalized_pct_melt,ignore_index=True)<br/>cases_melted = cases_melted3.append(total_cases_pct_melt,ignore_index=True)<br/>cases_melted.head()<br/>cases_melted.variable.value_counts()</span></pre><h2 id="732b" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 0</h2><p id="b356" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">这是我们将要使用的原始数据表。别担心，我会从这本书衍生出更多的 dfs)</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="932c" class="no ka in nk b gy np nq l nr ns">html.Div([<br/>        html.H2("Dataframe"),<br/>        dash_table.DataTable(<br/>            id='table',<br/>            columns=[{"name": i, "id": i, "deletable": True, "selectable": True} for i in df.columns],<br/>            data=df.to_dict('records'),<br/>            style_cell = {<br/>                    'font-family': 'sans-serif',<br/>                    'font-size': '14px',<br/>                    'text-align': 'center'<br/>                },<br/>            editable=True,<br/>            filter_action="native",<br/>            sort_action="native",<br/>            sort_mode="multi",<br/>            column_selectable="single",<br/>            row_selectable="multi",<br/>            row_deletable=True,<br/>            selected_columns=[],<br/>            selected_rows=[],<br/>            page_action="native",<br/>            page_current= 0,<br/>            page_size= 10,<br/>            style_table={'overflowX': 'scroll'}<br/>            )<br/>        ],style={'padding-left': '2%', 'padding-right': '2%'})</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/1c485ddd79b5b2df77e1cf7c6ff81a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASDCFuX5JHRwtAqIl0VcVg.png"/></div></div></figure><h2 id="fb88" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 1</h2><p id="2c5b" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">下面的图表是一个悲伤的小图表，我从它开始，显示了美国每天累计的 covid 测试。我可能最终会将它从仪表板上删除，但它现在还在这里。是的，创建这些图表真的不需要太多代码。</p><p id="5d85" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">*请记住，我去掉了所有这些图中的<code class="fe nu nv nw nk b">fig.show()</code>行，因为我不希望它们在部署时运行，所以如果您只是在笔记本中运行，请取消这些行的注释。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="63e6" class="no ka in nk b gy np nq l nr ns">fig0 = px.bar(df<br/>             ,x="date_new"<br/>             ,y="totalTestResults"<br/>             ,hover_data=['totalTestResults']<br/>             ,title="&lt;b&gt;Total Covid Tests (Cummulative)&lt;/b&gt;")</span><span id="b7b6" class="no ka in nk b gy nt nq l nr ns"># Add figure title<br/>fig0.update_layout(<br/>    template='plotly_dark'<br/>)<br/># fig0.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a7c09818446d0a1d0f1b82b1b998b423.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*ODj9ksnK739d2zkTiIlRqw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">看看这张悲伤的小图表。我故意把它留得很小</figcaption></figure><h2 id="4b18" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 2</h2><p id="29ee" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">这里也没什么值得大书特书的，但是更有趣一点。此图表显示每日总检测数和总阳性检测数，以及阳性和阴性百分比。咩。代码如下:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="34af" class="no ka in nk b gy np nq l nr ns">percent_positive = list(cases.percent_positive)<br/>percent_negative = list(cases.percent_negative)<br/>date = list(cases.date_new)</span><span id="6853" class="no ka in nk b gy nt nq l nr ns">cases_melt = pd.melt(cases, id_vars=['date_new'], value_vars=['negativeIncrease'<br/>                                                              ,'positiveIncrease'<br/>                                                              ,'totalTestResultsIncrease'<br/>                                                             ]<br/>                    )</span><span id="ad83" class="no ka in nk b gy nt nq l nr ns"># Create fig2ure with secondary y-axis<br/>fig1 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="cc2d" class="no ka in nk b gy nt nq l nr ns">fig1 = px.line(cases_melt, x='date_new', y='value', color='variable')</span><span id="5b62" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig1.add_trace(<br/>    go.Scatter(x=date, y=percent_negative, name="percent_negative"),<br/>    secondary_y=False,<br/>)</span><span id="d877" class="no ka in nk b gy nt nq l nr ns">fig1.add_trace(<br/>    go.Scatter(x=date, y=percent_positive, name="percent_positive"),<br/>    secondary_y=False,<br/>)</span><span id="4f24" class="no ka in nk b gy nt nq l nr ns"># Add fig2ure title<br/>fig1.update_layout(<br/>    title_text="&lt;b&gt;Daily Covid Cases with Percent Changes&lt;/b&gt;"<br/>    ,template='plotly_dark'<br/>    ,showlegend=False<br/>)</span><span id="984e" class="no ka in nk b gy nt nq l nr ns">#update legend<br/># fig1.update_layout(<br/>    # legend=dict(<br/>    #     yanchor="top",<br/>    #     y=0.99,<br/>    #     xanchor="left",<br/>    #     x=0.01<br/>    #     )<br/>    # )</span><span id="081b" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig1.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="6ec0" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig1.update_yaxes(title_text="&lt;b&gt;Count&lt;/b&gt;", secondary_y=False)<br/># fig1.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/66a004d4badf61b95b62438407c35f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*oP1hftaxt7QEPAXw1RzEww.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">留下一个小的。</figcaption></figure><h2 id="587b" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 3</h2><p id="b8e4" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">现在我们在谈话。图 3 相当厚——图表中有很多东西。以至于我甚至在仪表盘上添加了代码。我将尝试解释:图 3 显示:</p><ul class=""><li id="309a" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">累积每日测试</li><li id="cf90" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">每日阳性总数</li><li id="64a7" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">每日正负百分比</li><li id="9cf9" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">每日正百分比变化</li><li id="7ad4" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">每日负百分比变化</li><li id="9819" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">每日总测试百分比变化</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="eb83" class="no ka in nk b gy np nq l nr ns">#make variables for subplots<br/>percent_positive = list(cases.percent_positive)<br/>percent_negative = list(cases.percent_negative)<br/>negativeIncrease = list(cases.negativeIncrease)<br/>positiveIncrease = list(cases.positiveIncrease)<br/>totalTestResultsIncrease = list(cases.totalTestResultsIncrease)<br/>total_cases_pct_change = list(cases.total_cases_pct_change)<br/>positive_pct_change = list(cases.positive_pct_change)<br/>date = list(cases.date_new)</span><span id="fa66" class="no ka in nk b gy nt nq l nr ns"># Create fig16ure with secondary y-axis<br/>fig16 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="d319" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig16.add_trace(<br/>    go.Bar(x=date<br/>           ,y=negativeIncrease<br/>           ,name="negativeIncrease"<br/>           ,marker_color=px.colors.qualitative.Pastel1[3]),<br/>    secondary_y=False,<br/>)<br/>fig16.add_trace(<br/>    go.Bar(x=date, y=positiveIncrease, name="positiveIncrease"),<br/>    secondary_y=False,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=totalTestResultsIncrease<br/>               ,opacity=.7<br/>               ,name="totalTestResultsIncrease"<br/>               ,mode="markers"<br/>               ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=percent_negative<br/>               ,name="percent_negative"<br/>               ,marker_color=px.colors.qualitative.Plotly[2]),<br/>    secondary_y=True,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=percent_positive<br/>               ,name="percent_positive"<br/>               ,marker_color=px.colors.qualitative.D3[3]),<br/>    secondary_y=True,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=positive_pct_change<br/>               ,name="positive_pct_change"<br/>               ,marker_color=px.colors.qualitative.T10[2]),<br/>    secondary_y=True,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=negative_pct_change<br/>               ,name="negative_pct_change"<br/>               ,marker_color=px.colors.qualitative.Plotly[5]),<br/>    secondary_y=True,<br/>)<br/>fig16.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=total_cases_pct_change<br/>               ,name="total_cases_pct_change"<br/>               ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=True,<br/>)</span><span id="450a" class="no ka in nk b gy nt nq l nr ns"># Add fig16ure title<br/>fig16.update_layout(<br/>    title_text="&lt;b&gt;Daily Covid Cases&lt;/b&gt;"<br/>    ,height=800<br/>    # ,width=1200<br/>)</span><span id="6a75" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig16.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="aaa6" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig16.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)<br/>fig16.update_yaxes(title_text="&lt;b&gt;% Change&lt;/b&gt;", secondary_y=True)</span><span id="62c7" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig16.update_layout(barmode='stack')</span><span id="3766" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig16.update_traces(marker_line_width=.01)</span><span id="66b1" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig16.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig16.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ol"><img src="../Images/8d774f747a2c4616dcf5a4469f53c72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lyoi935HTD2-hDuIjkIhJA.png"/></div></div></figure><h2 id="7cea" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 4</h2><p id="ec10" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">不要介意代码中的图形名称。你想怎么称呼他们都行。我只是发现用数字方案给它们命名更容易，这与<code class="fe nu nv nw nk b">html.Div</code>的数字位置无关。</p><p id="e7e4" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">图 4 显示了每天阳性和阴性病例的百分比。图 3 中的红线和绿线。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="86d6" class="no ka in nk b gy np nq l nr ns">fig2 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="0f46" class="no ka in nk b gy nt nq l nr ns">fig2.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=percent_negative<br/>               ,name="percent_negative"<br/>               ,marker_color=px.colors.qualitative.Plotly[2]),<br/>    secondary_y=True,<br/>)<br/>fig2.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=percent_positive<br/>               ,name="percent_positive"<br/>               ,marker_color=px.colors.qualitative.D3[3]),<br/>    secondary_y=True,<br/>)</span><span id="ec47" class="no ka in nk b gy nt nq l nr ns"># Add figure title<br/>fig2.update_layout(<br/>    title_text="&lt;b&gt;Daily Pos/Neg Percent of Covid Tests&lt;/b&gt;"<br/>)</span><span id="b609" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig2.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="2301" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig2.update_yaxes(title_text="&lt;b&gt;Percent&lt;/b&gt;", secondary_y=True)</span><span id="a307" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig2.update_layout(barmode='stack')</span><span id="9487" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig2.update_traces(marker_line_width=.01)</span><span id="1403" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig2.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig2.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/50ed979853b5a9e4e35538c27b16a88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQGihnmjaW8hbp4MOwcv0w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">很公平——我们继续吧</figcaption></figure><h2 id="4d51" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 5</h2><p id="b4c7" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 5 显示了图 3 的另一部分——每日总测试(紫色),每日总阳性和每日总阴性测试。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="f318" class="no ka in nk b gy np nq l nr ns">fig3 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="7c19" class="no ka in nk b gy nt nq l nr ns">fig3.add_trace(<br/>    go.Bar(x=date<br/>           ,y=negativeIncrease<br/>           ,name="negativeIncrease"<br/>           ,marker_color=px.colors.qualitative.Pastel1[3]),<br/>    secondary_y=False,<br/>)<br/>fig3.add_trace(<br/>    go.Bar(x=date<br/>           ,y=positiveIncrease<br/>           ,name="positiveIncrease"),<br/>    secondary_y=False,<br/>)<br/>fig3.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=totalTestResultsIncrease<br/>               ,opacity=.7<br/>               ,name="totalTestResultsIncrease"<br/>               ,mode="markers"<br/>               ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)</span><span id="aeff" class="no ka in nk b gy nt nq l nr ns"># Add fig3ure title<br/>fig3.update_layout(<br/>    title_text="&lt;b&gt;Daily Pos/Neg and Total Tests&lt;/b&gt;"<br/>)</span><span id="76e8" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig3.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="6fba" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig3.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)</span><span id="e598" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig3.update_layout(barmode='stack')</span><span id="db30" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig3.update_traces(marker_line_width=.01)</span><span id="510c" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig3.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig3.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/00e99c24c21c7f51a1135e58ee3b52e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lL4AzkeTc9ZpUzZVfvxyOQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">点击图表顶部的双线图标，显示所有悬停信息！</figcaption></figure><h2 id="2181" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 6</h2><p id="c390" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 6 显示了每日总测试、每日总阳性和每日总阴性测试的每日百分比变化。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="5448" class="no ka in nk b gy np nq l nr ns">fig4 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="b0e8" class="no ka in nk b gy nt nq l nr ns">fig4.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=positive_pct_change<br/>               ,name="positive_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.T10[2]),<br/>    secondary_y=False,<br/>)<br/>fig4.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=negative_pct_change<br/>               ,name="negative_pct_change"<br/>               ,mode="markers"<br/>               ,marker_color=px.colors.qualitative.Plotly[5]),<br/>    secondary_y=True,<br/>)<br/>fig4.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=total_cases_pct_change<br/>               ,name="total_cases_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)</span><span id="05fa" class="no ka in nk b gy nt nq l nr ns"># Add fig4ure title<br/>fig4.update_layout(<br/>    title_text="&lt;b&gt;Daily Percent Changes of Covid Positive Tests and Total Tests&lt;/b&gt;"<br/>)</span><span id="a182" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig4.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="a9ce" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig4.update_yaxes(title_text="&lt;b&gt;Percent Change&lt;/b&gt;", secondary_y=False)</span><span id="3635" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig4.update_layout(barmode='stack')</span><span id="252e" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig4.update_traces(marker_line_width=.01)</span><span id="1d8c" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig4.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig4.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi on"><img src="../Images/27872f584cbc2a5b6d7df57771bf78aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zh5vmQj_vJmB-v8i9He45w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">赢的模式=“线条+标记”或模式=“标记”或模式=“线条”</figcaption></figure><h2 id="98bf" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 7</h2><p id="e89c" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 7 显示了总每日测试、总阳性和阴性每日测试的对数面积图。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0dd7" class="no ka in nk b gy np nq l nr ns">fig5 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="4c3d" class="no ka in nk b gy nt nq l nr ns">fill_colors = ['none', 'tozeroy', 'tozerox', 'tonexty', 'tonextx', 'toself', 'tonext']</span><span id="7572" class="no ka in nk b gy nt nq l nr ns">#negative<br/>fig5.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=negativeIncrease<br/>           ,name="negativeIncrease"<br/>           ,line=dict(width=0.5, color='rgb(111, 231, 219)')<br/>           ,stackgroup='one'<br/>            ),<br/>    secondary_y=False,<br/>)<br/>#positive<br/>fig5.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=positiveIncrease<br/>           ,fill=fill_colors[1]<br/>           ,mode="markers+lines"<br/>           ,name="positiveIncrease"),<br/>    secondary_y=False,<br/>)<br/>#total<br/>fig5.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=totalTestResultsIncrease<br/>               ,opacity=.7<br/>               ,name="totalTestResultsIncrease"<br/>               ,line=dict(width=0.5, color='rgb(131, 90, 241)')<br/>               ,stackgroup='one'),<br/>    secondary_y=False,<br/>)</span><span id="3770" class="no ka in nk b gy nt nq l nr ns"># Add fig5ure title<br/>fig5.update_layout(<br/>    title_text="&lt;b&gt;Daily Pos/Neg and Total Tests&lt;/b&gt;"<br/>)</span><span id="dcc9" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig5.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="205d" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig5.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)</span><span id="cf89" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig5.update_layout(barmode='stack')</span><span id="269d" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig5.update_traces(marker_line_width=.01)</span><span id="5a3e" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig5.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig5.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/ac1400c0d09955ca0e4719bee1641d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nOb1P13G3W4vPILuXtLqkA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">我喜欢面积图。这里的不透明度= 0.7</figcaption></figure><h2 id="3c73" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 8</h2><p id="9e85" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">我构建了图 8 来显示每日百分比变化的峰值。使用相同的列:每日阳性百分比变化、每日阴性百分比变化和每日总测试百分比变化。</p><p id="e189" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">这里要说的是，开始时有很大的波动，但在 5 月中旬以后，情况开始平稳下来，每天都是如此。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="9452" class="no ka in nk b gy np nq l nr ns">fig6 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="8f90" class="no ka in nk b gy nt nq l nr ns">fig6.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=positive_pct_change<br/>               ,name="positive_pct_change"<br/>               ,marker_color=px.colors.qualitative.T10[2]<br/>               ,yaxis="y1")<br/>#     secondary_y=False,<br/>)<br/>fig6.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=negative_pct_change<br/>               ,name="negative_pct_change"<br/>               ,marker_color=px.colors.qualitative.T10[4]<br/>               ,yaxis="y2")<br/>#     secondary_y=False,<br/>)<br/>fig6.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=total_cases_pct_change<br/>               ,name="total_cases_pct_change"<br/>               ,marker_color=px.colors.qualitative.Plotly[3]<br/>               ,yaxis="y3")<br/>#     secondary_y=False,<br/>)</span><span id="5081" class="no ka in nk b gy nt nq l nr ns"># Create axis objects<br/>fig6.update_layout(<br/>#     xaxis=date,<br/>    yaxis1=dict(<br/>        title="positive_pct_change",<br/>        titlefont=dict(<br/>            color="#663399"<br/>        ),<br/>        tickfont=dict(<br/>            color="#663399"<br/>        )<br/>    ),<br/>    yaxis2=dict(<br/>        title="negative_pct_change",<br/>        titlefont=dict(<br/>            color="#006600"<br/>        ),<br/>        tickfont=dict(<br/>            color="#006600"<br/>        ),<br/>        anchor="free",<br/>        overlaying="y",<br/>        side="right",<br/>        position=1<br/>    ),<br/>    yaxis3=dict(<br/>        title="total_cases_pct_change",<br/>        titlefont=dict(<br/>            color="#d62728"<br/>        ),<br/>        tickfont=dict(<br/>            color="#d62728"<br/>        ),<br/>        anchor="x",<br/>        overlaying="y",<br/>        side="right"<br/>    )<br/>)</span><span id="1d2d" class="no ka in nk b gy nt nq l nr ns"># Add fig6ure title<br/>fig6.update_layout(<br/>    title_text="&lt;b&gt;Daily Percent Changes of Covid Pos/Neg Tests and Total Tests&lt;/b&gt;"<br/>)</span><span id="aee0" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig6.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="8077" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig6.update_yaxes(title_text="&lt;b&gt;Percent Change&lt;/b&gt;", secondary_y=False)</span><span id="aa91" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig6.update_layout(barmode='stack')</span><span id="456a" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig6.update_traces(marker_line_width=.01)</span><span id="b59a" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig6.update_layout(legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1<br/>))</span><span id="5f62" class="no ka in nk b gy nt nq l nr ns">fig6.update_layout(<br/>    # width=1200<br/>    template='plotly_dark'<br/>)<br/># fig6.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oo"><img src="../Images/6a5097caad985b60d59788eb1d77b49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0p_ZXleTYtO85TJEFM9Y3w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在我看来，这比每天的总病例数更有趣；也是三轴的胜利；我应该换颜色的…啊，好吧。</figcaption></figure><h2 id="650c" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 9</h2><p id="a985" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 9 是我加入死亡率和住院率的地方。与上图相同，死亡和住院结果的每日百分比变化。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0fbf" class="no ka in nk b gy np nq l nr ns">#second figure<br/>fig7 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="a299" class="no ka in nk b gy nt nq l nr ns">fig7.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=death_pct_change<br/>               ,name="death_pct_change"<br/>               ,marker_color=px.colors.qualitative.T10[0]),<br/>    secondary_y=False,<br/>)<br/>fig7.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=hospitalized_pct_change<br/>               ,name="hospitalized_pct_change"<br/>               ,marker_color=px.colors.qualitative.T10[6]),<br/>    secondary_y=False,<br/>)</span><span id="4bc9" class="no ka in nk b gy nt nq l nr ns"># Add figure title<br/>fig7.update_layout(<br/>    title_text="&lt;b&gt;Daily Percent Changes of Covid Death/Hospitalized&lt;/b&gt;"<br/>)</span><span id="c5fa" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig7.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="818d" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig7.update_yaxes(title_text="&lt;b&gt;Percent Change&lt;/b&gt;", secondary_y=False)<br/># fig7.update_yaxes(title_text="&lt;b&gt;% Change&lt;/b&gt;", secondary_y=True)</span><span id="d7ad" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig7.update_layout(barmode='stack')</span><span id="1d35" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig7.update_traces(<br/>#                   marker_color='rgb(158,202,225)'<br/>#                   , marker_line_color='rgb(8,48,107)',<br/>                  marker_line_width=.1)<br/>#                   ,opacity=0.6)</span><span id="0967" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig7.update_layout(legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.02,<br/>    xanchor="right",<br/>    x=1,<br/>))</span><span id="5f89" class="no ka in nk b gy nt nq l nr ns">fig7.update_layout(<br/>    # width=1200<br/>    template='plotly_dark'<br/>)<br/># fig7.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi on"><img src="../Images/d4fefaedde492ac7345553bba9a45149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dpOSEhvLC24_wjenoV9ng.png"/></div></div></figure><h2 id="e088" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 10</h2><p id="a2a6" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 10 有点忙，但是如果您想看到我刚才提到的最后几幅图中的所有行，那么您的愿望得到了满足。只是看起来我没有包括死亡。死亡率的变化如此之小，无论如何你都看不到这条线。除非我把它偏移，放在第二个 y 轴上。但这可能会让你感到害怕和困惑。所以。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="12cb" class="no ka in nk b gy np nq l nr ns">fig8 = px.scatter(cases<br/>                 ,x="date_new"<br/>                 ,y="positive_pct_change"<br/>                 ,trendline="lowess"<br/>                 ,color_continuous_scale=px.colors.sequential.Inferno<br/>                )<br/>fig8.update_layout(<br/>    height=800<br/>    ,template='plotly_dark')</span><span id="6beb" class="no ka in nk b gy nt nq l nr ns">fig8.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=negative_pct_change<br/>               ,name="negative_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.T10[1]<br/>              )<br/>#     secondary_y=False,<br/>),<br/>fig8.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=death_pct_change<br/>               ,name="death_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.T10[2]<br/>              )<br/>#     secondary_y=False,<br/>),<br/>fig8.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=hospitalized_pct_change<br/>               ,name="hospitalized_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.T10[3]<br/>              )<br/>#     secondary_y=False,<br/>),<br/>fig8.add_trace(<br/>    go.Scatter(x=date<br/>               ,y=total_cases_pct_change<br/>               ,name="total_cases_pct_change"<br/>               ,mode="lines+markers"<br/>               ,marker_color=px.colors.qualitative.T10[4]<br/>              )<br/>#     secondary_y=False,<br/>)<br/># fig8.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi op"><img src="../Images/157bdbdc49b8559c9f32ab36071fa1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qb0UmkKjAWFE_PToVXfm6g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">这么忙</figcaption></figure><h2 id="21ed" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 11–15</h2><p id="7faa" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 11 只是每个指标分布的热图。你可能会认为有一种方法可以让它看起来更小，确实有，但是做起来并不像你想象的那么容易——至少在情节上是这样。这些图表使用了<code class="fe nu nv nw nk b">plotly.express</code>，它需要一些关于支线剧情的更新。但是他们知道这件事。有票的，放心吧。他们是好人。超级活跃在所有的社区论坛。太棒了。如果你们谁看到了，就大声喊出来！</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0d54" class="no ka in nk b gy np nq l nr ns">fig9 = px.scatter(cases, x="date_new", y="positive_pct_change", trendline="lowess"<br/>                  , title="positive_pct_change"<br/>#                   , color_continuous_scale="icefire"<br/>                  , color="positive_pct_change", color_continuous_scale=px.colors.sequential.Inferno<br/>                  , marginal_y="histogram", marginal_x="violin")<br/>fig9.update_layout(<br/>    height=400<br/>    ,template='plotly_dark')<br/># fig9.show()</span><span id="0508" class="no ka in nk b gy nt nq l nr ns">fig10 = px.scatter(cases, x="date_new", y="negative_pct_change", color="negative_pct_change"<br/>                  , trendline="lowess", title="negative_pct_change"<br/>                  , color_continuous_scale=px.colors.sequential.Inferno<br/>                  , marginal_y="histogram", marginal_x="violin")<br/>fig10.update_layout(<br/>    height=400<br/>    ,template='plotly_dark')<br/># fig10.show()</span><span id="71ea" class="no ka in nk b gy nt nq l nr ns">fig11 = px.scatter(cases, x="date_new", y="death_pct_change", color="death_pct_change"<br/>                  , trendline="lowess", title="death_pct_change"<br/>                  , color_continuous_scale=px.colors.sequential.Inferno<br/>                  , marginal_y="histogram", marginal_x="violin")<br/>fig11.update_layout(<br/>    height=400<br/>    ,template='plotly_dark')<br/># fig11.show()</span><span id="62aa" class="no ka in nk b gy nt nq l nr ns">fig12 = px.scatter(cases, x="date_new", y="hospitalized_pct_change", color="hospitalized_pct_change"<br/>                  , trendline="lowess", title="hospitalized_pct_change"<br/>                  , color_continuous_scale=px.colors.sequential.Inferno<br/>                  , marginal_y="histogram", marginal_x="violin")<br/>fig12.update_layout(<br/>    height=400<br/>    ,template='plotly_dark')<br/># fig12.show()</span><span id="1085" class="no ka in nk b gy nt nq l nr ns">fig13 = px.scatter(cases, x="date_new", y="total_cases_pct_change", color="total_cases_pct_change"<br/>                  , trendline="lowess", title="total_cases_pct_change"<br/>                  , color_continuous_scale=px.colors.sequential.Inferno<br/>                  , marginal_y="histogram", marginal_x="violin")<br/>fig13.update_layout(<br/>    height=400<br/>    ,template='plotly_dark')<br/># fig13.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oq"><img src="../Images/c897f6411b891b85c83c1d3fd2f83131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pMQIbTlfGBT7Qiw7uk-WQ.png"/></div></div></figure><h2 id="487c" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 16</h2><p id="0988" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">下面是我将上面的图表放入子情节格式的尝试(使用上面的相同代码，然后运行它):</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="3e44" class="no ka in nk b gy np nq l nr ns">#add traces<br/>trace1 = fig9['data'][0]<br/>trace2 = fig10['data'][0]<br/>trace3 = fig11['data'][0]<br/>trace4 = fig12['data'][0]<br/>trace5 = fig13['data'][0]</span><span id="e550" class="no ka in nk b gy nt nq l nr ns">fig14 = make_subplots(rows=3<br/>                    ,cols=2<br/>                    ,shared_xaxes=False<br/>                    ,row_heights=[9., 9., 9.]<br/>                    ,column_widths=[.1, .1]<br/>                    ,shared_yaxes=False<br/>                    ,vertical_spacing=0.10<br/>                    ,subplot_titles=['&lt;b&gt;positive_pct_change&lt;/b&gt;'<br/>                                     ,'&lt;b&gt;negative_pct_change&lt;/b&gt;'<br/>                                     ,'&lt;b&gt;death_pct_change&lt;/b&gt;'<br/>                                     ,'&lt;b&gt;hospitalized_pct_change&lt;/b&gt;'<br/>                                     ,'&lt;b&gt;total_cases_pct_change&lt;/b&gt;'<br/>                                    ]<br/>                    ,x_title="&lt;b&gt;date&lt;/b&gt;"<br/>                    ,y_title="&lt;b&gt;percent_change&lt;/b&gt;"<br/>                   )</span><span id="bef6" class="no ka in nk b gy nt nq l nr ns">fig14.add_trace(trace1, row=1, col=1)<br/>fig14.add_trace(trace2, row=1, col=2)<br/>fig14.add_trace(trace3, row=2, col=1)<br/>fig14.add_trace(trace4, row=2, col=2)<br/>fig14.add_trace(trace5, row=3, col=1)</span><span id="cdd7" class="no ka in nk b gy nt nq l nr ns">fig14['layout'].update(height=800<br/># , width=1200<br/>        , title='&lt;b&gt;Covid Test Outcome Trends&lt;/b&gt;'<br/>        , template='plotly_dark')<br/># fig14.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi on"><img src="../Images/c42d757f6057c8143eb507d4546b6ec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QW8odyVsAS85MnYcPzHnPw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">不错吧</figcaption></figure><h2 id="d801" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 17</h2><p id="3234" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">最后一次尝试用<code class="fe nu nv nw nk b">facet-col</code>和<code class="fe nu nv nw nk b">marginal-y</code>条把它变成易读的格式！</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="4e96" class="no ka in nk b gy np nq l nr ns">cases_melted.variable.value_counts()<br/>values_list = list(cases_melted.value)</span><span id="8b54" class="no ka in nk b gy nt nq l nr ns">fig15 = px.scatter(cases_melted, x="date_new", y="value"<br/>                 , color="variable", facet_col="variable"<br/>                 , trendline="lowess", trendline_color_override="white"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno<br/>                 , marginal_y="bar", marginal_x="box"<br/>                 , labels = ['test','test','test','test','test'])</span><span id="55a1" class="no ka in nk b gy nt nq l nr ns">fig15['layout'].update(height=800<br/># , width=1200<br/>        , title='&lt;b&gt;Covid Test Outcome Trends&lt;/b&gt;'<br/>        , template='plotly_dark')<br/>fig15.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig15.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/c61e15636dd71c2461b678c88683d488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GGaVOd9hG2CA4BQ2dfOsQQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">边缘-x 和 y 棒是病态的。</figcaption></figure><h2 id="66ea" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">格式化</h2><p id="3d39" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">在我们得到下几个数字之前，我们需要做一些额外的格式化。</p><p id="6b9f" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">步骤:</strong></p><ul class=""><li id="de58" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">首先我们需要制作一个<code class="fe nu nv nw nk b">day_of_week</code>列(这很棘手，但代码不多；可能 20 行)</li><li id="b90d" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">接下来，我创建了一些 x 和 y 最小变量</li><li id="de47" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">接下来，我在<code class="fe nu nv nw nk b">sum()</code>和<code class="fe nu nv nw nk b">mean()</code>周围创建了一些变量，按照每个指标(积极、消极、总测试等)对星期几进行分组。)</li><li id="287f" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">最后，我们将这些变量放在单独的列表中，然后每天一个列表(这样我们可以对条形图进行排序</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0abd" class="no ka in nk b gy np nq l nr ns">#create a day of week column<br/>s = pd.date_range(min(df.date_new),max(df.date_new), freq='D').to_series()<br/>s = s.dt.dayofweek.tolist()<br/>df['day_of_week'] = s</span><span id="3d91" class="no ka in nk b gy nt nq l nr ns">def day_of_week(df):<br/>    if df['day_of_week'] == 0:<br/>        return "Tuesday"<br/>    elif df['day_of_week'] == 1:<br/>        return "Monday"<br/>    elif df['day_of_week'] == 2:<br/>        return "Sunday"<br/>    elif df['day_of_week'] == 3:<br/>        return "Saturday"<br/>    elif df['day_of_week'] == 4:<br/>        return "Friday"<br/>    elif df['day_of_week'] == 5:<br/>        return "Thursday"<br/>    elif df['day_of_week'] == 6:<br/>        return "Wednesday"<br/>    else:<br/>        return ""</span><span id="e9b5" class="no ka in nk b gy nt nq l nr ns">df['dayofweek'] = df.apply(day_of_week, axis=1)<br/># df.head(30)</span><span id="4fe2" class="no ka in nk b gy nt nq l nr ns">#create min and max variables<br/>y_min = min(df.totalTestResultsIncrease)<br/>y_max = max(df.totalTestResultsIncrease)<br/># x_min = min(df.index)<br/># x_max = max(df.index)<br/>x_min = min(df.month)<br/>x_max = max(df.month)<br/>x_range = [x_min,x_max]<br/>y_range = [y_min,y_max]</span><span id="45b1" class="no ka in nk b gy nt nq l nr ns"># print('y_min:',y_min)<br/># print('y_max:',y_max)<br/># print('x_min:',x_min)<br/># print('x_max:',x_max)<br/># print('x_range:',x_range)<br/># print('y_range:',y_range)</span><span id="ef96" class="no ka in nk b gy nt nq l nr ns">#create total pos/neg/total variables by day<br/>total_pos_increase_grp_day = df.groupby(['dayofweek'])['positiveIncrease'].sum()<br/>avg_total_pos_increase_grp_day = df.groupby(['dayofweek'])['positiveIncrease'].mean()</span><span id="6f8b" class="no ka in nk b gy nt nq l nr ns">total_neg_increase_grp_day = df.groupby(['dayofweek'])['negativeIncrease'].sum()<br/>avg_total_neg_increase_grp_day = df.groupby(['dayofweek'])['negativeIncrease'].mean()</span><span id="d830" class="no ka in nk b gy nt nq l nr ns">total_increase_grp_day = df.groupby(['dayofweek'])['totalTestResultsIncrease'].sum()<br/>avg_total_increase_grp_day = df.groupby(['dayofweek'])['totalTestResultsIncrease'].mean()</span><span id="72c2" class="no ka in nk b gy nt nq l nr ns">avg_total_per_week = avg_total_increase_grp_day/7<br/>avg_pos_per_week = avg_total_pos_increase_grp_day/7<br/>avg_neg_per_week = avg_total_neg_increase_grp_day/7</span><span id="5c3f" class="no ka in nk b gy nt nq l nr ns"># print('total_pos_increase_grp_day:',total_pos_increase_grp_day)<br/># print("")<br/># print('total_neg_increase_grp_day:',total_neg_increase_grp_day)<br/># print("")<br/># print('total_increase_grp_day:',total_increase_grp_day)<br/># print("")<br/># print("")<br/># print('avg_total_pos_increase_grp_day:',avg_total_pos_increase_grp_day)<br/># print("")<br/># print('avg_total_neg_increase_grp_day:',avg_total_neg_increase_grp_day)<br/># print("")<br/># print('avg_total_increase_grp_day:',avg_total_increase_grp_day)<br/># print("")<br/># print("")<br/># print('avg_pos_per_week:',avg_pos_per_week)<br/># print("")<br/># print('avg_neg_per_week:',avg_neg_per_week)<br/># print("")<br/># print('avg_total_per_week:',avg_total_per_week)</span><span id="b1e5" class="no ka in nk b gy nt nq l nr ns">#put totals in a list for labeling later on<br/>total_totals = list(total_increase_grp_day)<br/>pos_totals = list(total_pos_increase_grp_day)<br/>neg_totals = list(total_neg_increase_grp_day)</span><span id="3eb5" class="no ka in nk b gy nt nq l nr ns"># print('total_totals:', total_totals)<br/># print('pos_totals:', pos_totals)<br/># print('neg_totals:', neg_totals)</span><span id="3cbe" class="no ka in nk b gy nt nq l nr ns">#make day list<br/>x_labels = ['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']<br/># print('x_labels:', x_labels)</span></pre><h2 id="c9ba" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 18</h2><p id="83d3" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">运行上面的代码后，我们可以运行下面的代码，它显示了一周中每天的阳性测试:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="96cc" class="no ka in nk b gy np nq l nr ns">#plots by day<br/>fig17 = px.bar(df<br/>             ,x='dayofweek'<br/>             ,y='positiveIncrease'<br/>             ,text='positiveIncrease'<br/>             ,color='dayofweek'<br/>             ,height=500<br/>             ,hover_data=['negativeIncrease', 'positiveIncrease', 'totalTestResultsIncrease']<br/>             ,hover_name="positiveIncrease")<br/>fig1.update_traces(texttemplate='%{text:.2s}'<br/>                  ,textposition='top center')<br/>fig1.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 ,title_text="&lt;b&gt;Covid Tests Outcome&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})</span><span id="95a8" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig17.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="4ab5" class="no ka in nk b gy nt nq l nr ns">fig17.add_shape( # add a horizontal "target" line<br/>    type="line", line_color="salmon", line_width=3, opacity=1, line_dash="dot",<br/>    x0=0, x1=1, xref="paper", y0=avg_total_increase_grp_day, y1=avg_total_increase_grp_day, yref="y"<br/>)</span><span id="d709" class="no ka in nk b gy nt nq l nr ns">fig17.add_annotation( # add a text callout with arrow<br/>    text="Woah...!", x="Friday", y=300, arrowhead=1, showarrow=True<br/>)</span><span id="fd8c" class="no ka in nk b gy nt nq l nr ns">total_labels = [{"x": x, "y": pos_totals*1.3, "text": str(pos_totals), "showarrow": False} for x, pos_totals in zip(x_labels, pos_totals)]</span><span id="df77" class="no ka in nk b gy nt nq l nr ns">fig17.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 # ,width=1200<br/>                 ,title_text="&lt;b&gt;Total Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']}<br/>                 ,annotations=total_labels)<br/># fig17.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oo"><img src="../Images/61c636a3c1743829f6668235429d2269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t86p_tXIJwfwVet4gWKFoQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">你不会看到 Woah。好了，现在你知道了，我正在测试它，但我放弃了，显然忘了删除它。</figcaption></figure><h2 id="309d" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 19</h2><p id="538a" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与上面的图表相同，但针对每周的每一天的负面案例。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="98bd" class="no ka in nk b gy np nq l nr ns">fig18 = px.bar(df<br/>             ,x='dayofweek'<br/>             ,y='negativeIncrease'<br/>             ,text='negativeIncrease'<br/>             ,color='dayofweek'<br/>             ,height=500<br/>             ,hover_data=['negativeIncrease', 'positiveIncrease', 'totalTestResultsIncrease']<br/>             ,hover_name="negativeIncrease")<br/>fig18.update_traces(texttemplate='%{text:.2s}'<br/>                  ,textposition='outside')<br/>fig18.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 ,template='plotly_dark'<br/>                 ,title_text="&lt;b&gt;Neagtive Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})</span><span id="773f" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig18.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="3f59" class="no ka in nk b gy nt nq l nr ns">fig18.add_shape( # add a horizontal "target" line<br/>    type="line", line_color="salmon", line_width=3, opacity=1, line_dash="dot",<br/>    x0=0, x1=1, xref="paper", y0=avg_total_increase_grp_day, y1=avg_total_increase_grp_day, yref="y"<br/>)</span><span id="a228" class="no ka in nk b gy nt nq l nr ns">fig18.add_annotation( # add a text callout with arrow<br/>    text="Woah...!", x="Friday", y=300, arrowhead=1, showarrow=True<br/>)</span><span id="6aa1" class="no ka in nk b gy nt nq l nr ns">total_labels = [{"x": x, "y": neg_totals*1.25, "text": str(neg_totals), "showarrow": False} for x, neg_totals in zip(x_labels, neg_totals)]</span><span id="1ed7" class="no ka in nk b gy nt nq l nr ns">fig18.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 # ,width=1200<br/>                 ,title_text="&lt;b&gt;Total Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']}<br/>                 ,annotations=total_labels)<br/># fig18.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oo"><img src="../Images/8ca45380a323601b26b75dec44bb35af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9upE8w49tUbCnewe6BouHA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">但我仍然不知道他为什么要把这些数字随意地放到条形图上方。我应该弄清楚</figcaption></figure><h2 id="7f5a" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 20</h2><p id="0a14" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与上述图表相同，但用于每日总测试。</p><p id="f291" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">比如，人们往往会在周三(T4)接受测试。也就是数据被插入的时候。谁知道呢。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="7015" class="no ka in nk b gy np nq l nr ns">fig19 = px.bar(df<br/>             ,x='dayofweek'<br/>             ,y='totalTestResultsIncrease'<br/>             ,text='totalTestResultsIncrease'<br/>             ,color='dayofweek'<br/>             ,height=500<br/>             ,hover_data=['negativeIncrease', 'positiveIncrease', 'totalTestResultsIncrease']<br/>             ,hover_name="totalTestResultsIncrease")<br/>fig19.update_traces(texttemplate='%{text:.2s}'<br/>                  ,textposition='outside')</span><span id="1bce" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig19.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="79d3" class="no ka in nk b gy nt nq l nr ns">fig19.add_shape( # add a horizontal "target" line<br/>    type="line", line_color="salmon", line_width=3, opacity=1, line_dash="dot",<br/>    x0=0, x1=1, xref="paper", y0=avg_total_increase_grp_day, y1=avg_total_increase_grp_day, yref="y"<br/>)</span><span id="5143" class="no ka in nk b gy nt nq l nr ns">fig19.add_annotation( # add a text callout with arrow<br/>    text="Woah...!", x="Friday", y=300, arrowhead=1, showarrow=True<br/>)</span><span id="278b" class="no ka in nk b gy nt nq l nr ns">total_labels = [{"x": x, "y": total_totals*.95, "text": str(total_totals), "showarrow": True} for x, total_totals in zip(x_labels, total_totals)]</span><span id="0dad" class="no ka in nk b gy nt nq l nr ns">fig19.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 ,title_text="&lt;b&gt;Total Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 # ,width=1200<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']}<br/>                 ,annotations=total_labels)<br/># fig19.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi or"><img src="../Images/2cde71f6f09c071b6668644ceaeb3026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJ9Yn6Aw8wtiupqM7MmNGw.png"/></div></div></figure><h2 id="d62c" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 21</h2><p id="2e26" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与上面的图表相同，但针对的是每周的每一天的死亡人数。我花了很长时间来仔细考虑将这些放在一个图像中，并告诉大家自己更改每个代码段中的几个变量。我想我今天表现不错。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="5edc" class="no ka in nk b gy np nq l nr ns">#deaths<br/>fig20 = px.bar(df<br/>             ,x='dayofweek'<br/>             ,y='deathIncrease'<br/>             ,text='deathIncrease'<br/>             ,color='dayofweek'<br/>             ,height=500<br/>             ,hover_data=['negativeIncrease', 'positiveIncrease', 'totalTestResultsIncrease','deathIncrease']<br/>             ,hover_name="deathIncrease")<br/>fig20.update_traces(texttemplate='%{text:.2s}'<br/>                  ,textposition='outside')<br/>fig20.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 # ,width=1200<br/>                 ,title_text="&lt;b&gt;Death Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})</span><span id="babe" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig20.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="18a2" class="no ka in nk b gy nt nq l nr ns">fig20.add_shape( # add a horizontal "target" line<br/>    type="line", line_color="salmon", line_width=3, opacity=1, line_dash="dot",<br/>    x0=0, x1=1, xref="paper", y0=avg_total_increase_grp_day, y1=avg_total_increase_grp_day, yref="y"<br/>)</span><span id="0a92" class="no ka in nk b gy nt nq l nr ns">fig20.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 # ,width=1200<br/>                 ,title_text="&lt;b&gt;Total Covid Deaths Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})<br/>#                  ,annotations=total_labels)<br/># fig20.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi os"><img src="../Images/fb175d43075ce11a148f33d0d8ea0c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHXAV4T9iBtJ7BhEUoPw6g.png"/></div></div></figure><h2 id="b72e" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 22</h2><p id="21af" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与上述图表相同，但住院天数为周数。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="e49b" class="no ka in nk b gy np nq l nr ns">fig21 = px.bar(df<br/>             ,x='dayofweek'<br/>             ,y='hospitalizedIncrease'<br/>             ,text='hospitalizedIncrease'<br/>             ,color='dayofweek'<br/>             ,height=500<br/>             ,hover_data=['negativeIncrease', 'positiveIncrease', 'totalTestResultsIncrease','deathIncrease','hospitalizedIncrease']<br/>             ,hover_name="hospitalizedIncrease")<br/>fig21.update_traces(texttemplate='%{text:.2s}'<br/>                  ,textposition='outside')<br/>fig21.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 ,title_text="&lt;b&gt;Hospitalized Covid Tests Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 # ,width=1200<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})</span><span id="f2af" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig21.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="a2f0" class="no ka in nk b gy nt nq l nr ns">fig21.add_shape( # add a horizontal "target" line<br/>    type="line", line_color="salmon", line_width=3, opacity=1, line_dash="dot",<br/>    x0=0, x1=1, xref="paper", y0=avg_total_increase_grp_day, y1=avg_total_increase_grp_day, yref="y"<br/>)</span><span id="b44d" class="no ka in nk b gy nt nq l nr ns">fig21.update_layout(uniformtext_minsize=8<br/>                 ,uniformtext_mode='hide'<br/>                 ,title_text="&lt;b&gt;Total Hospitalized Covid Deaths Grouped by Day&lt;/b&gt;"<br/>                 ,template='plotly_dark'<br/>                 ,xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']})<br/># fig21.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi os"><img src="../Images/f99092d2fc6b95aad4930ad46d37cc45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2u3SwVXO5M2q45puAbJz9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">现在一切终于尘埃落定，让我们继续前进吧。</figcaption></figure><h2 id="b956" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 23</h2><p id="f642" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">让我们来看看我们是否能把最后 5 张图表合二为一。要做到这一点，我们需要创建一种映射数据框架，以便将这些指标堆叠/融合到一个名为<code class="fe nu nv nw nk b">variable</code>的列中，然后我们可以执行<code class="fe nu nv nw nk b">facet-col</code>操作，将所有指标放在一个图表中。太棒了。感谢<code class="fe nu nv nw nk b">pd.melt()</code></p><p id="58f0" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">换句话说，此图表显示一周中的哪一天各项指标(pos、neg、死亡、住院和每日总病例数)都出现峰值。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="9aa1" class="no ka in nk b gy np nq l nr ns">#map day of week column to cases_melted dataframe<br/>mapping = df[['date_new', 'dayofweek']]<br/># mapping<br/>cases_melted = pd.merge(cases_melted, mapping, how='left', on=['date_new', 'date_new'])<br/># print(cases_melted)<br/># print(df.dayofweek)</span><span id="74c7" class="no ka in nk b gy nt nq l nr ns">fig22 = px.scatter(cases_melted, x="date_new", y="value"<br/>                 , color="variable", facet_row="variable", facet_col="dayofweek"<br/>                 , trendline="lowess", trendline_color_override="white"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno<br/>                 , marginal_y="bar", marginal_x="box")</span><span id="4a8a" class="no ka in nk b gy nt nq l nr ns">fig22['layout'].update(height=1000<br/>                # , width=1200<br/>                , title='&lt;b&gt;Covid Test Outcome Trends&lt;/b&gt;'<br/>                , template='plotly_dark')<br/>fig22.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig22.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ot"><img src="../Images/ce3f1dd3d728bcb24de1809b920e3653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O36YRMs2W0-KCxuvTv5Ftg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">我要那个。</figcaption></figure><h2 id="b35b" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 24</h2><p id="8196" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与上面的图表相同，但带有条形图。</p><p id="c983" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">要点:周三和周四的住院率波动很大</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a80e" class="no ka in nk b gy np nq l nr ns">fig23 = px.bar(cases_melted, x="date_new", y="value"<br/>                 , color="variable", facet_row="variable", facet_col="dayofweek"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)</span><span id="13f0" class="no ka in nk b gy nt nq l nr ns">fig23['layout'].update(height=1000<br/>                # , width=1200<br/>                , title='&lt;b&gt;Covid Test Outcome Trends&lt;/b&gt;'<br/>                , template='plotly_dark')<br/>fig23.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig23.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ou"><img src="../Images/a2f12bf7703b802ebda58a5d8a61559b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbJUbum6nEHkWokZek-SdQ.png"/></div></div></figure><h2 id="78ea" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 25</h2><p id="7465" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 25 显示了所有每日百分比变化的总和。有点奇怪，但分析让你质疑一切。</p><p id="0e59" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">*在这段代码的开头，我在合并之后删除了一些列。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="fff6" class="no ka in nk b gy np nq l nr ns"># cases_melted = cases_melted.drop(['dayofweek_x', 'dayofweek_y'], axis=1)<br/># cases_melted.style.background_gradient(cmap='Blues')</span><span id="b1d2" class="no ka in nk b gy nt nq l nr ns">cases_melted['rank_value'] = cases_melted['value'].rank(method="max")<br/># print(cases_melted.head(30).sort_values(by='rank_value'))<br/># print(cases_melted.tail(30).sort_values(by='rank_value'))</span><span id="3829" class="no ka in nk b gy nt nq l nr ns">#sum percent changes by day<br/>#sundays have the highest positive percent changes<br/>#tuesdays have the highest negative percent changes<br/>cases_day = cases_melted[['dayofweek','value']]<br/>cases_day = cases_day.groupby('dayofweek').sum().reset_index()<br/># cases_day.head(10).style.background_gradient(cmap='inferno')</span><span id="f34d" class="no ka in nk b gy nt nq l nr ns">fig24 = px.bar(cases_day, x="dayofweek", y="value"<br/>                 , color="dayofweek"<br/>                 , text="value"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno<br/>                 , template="plotly_dark")</span><span id="f75c" class="no ka in nk b gy nt nq l nr ns">fig24['layout'].update(height=800<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Sum of Covid Test Daily Perent Changes per Day Of Week&lt;/b&gt;'<br/>                     , template='plotly_dark'<br/>                     , yaxis_title="Sum of % Change"<br/>                     , xaxis_title="Day of Week"<br/>                     , legend_title="Day of Week"<br/>                     , xaxis={'categoryorder':'array', 'categoryarray':['Monday','Tuesday','Wednesday','Thursday', 'Friday', 'Saturday', 'Sunday']}<br/>                    )<br/># fig24.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ou"><img src="../Images/a72c3770a47e76f0cf819deff40fc467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TI4n_nqE-q3ouN-1GSR4LQ.png"/></div></div></figure><h2 id="00a4" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 26</h2><p id="3ef8" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 26 显示了每个指标的每日百分比变化总和。很高兴在一个图表中看到每个指标的峰值。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="caeb" class="no ka in nk b gy np nq l nr ns">fig25 = px.bar(cases_melted, x="date_new", y="value"<br/>                 , color="variable"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)</span><span id="694b" class="no ka in nk b gy nt nq l nr ns">fig25['layout'].update(height=500<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Sum of Covid Test Daily Percent Changes by Outcome&lt;/b&gt;'<br/>                     , yaxis_title="Sum of Daily % Changes"<br/>                     , xaxis_title="Date"<br/>                     , legend_title="Sum of Daily % Changes"<br/>                     , template='plotly_dark')<br/>fig25.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig25.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ov"><img src="../Images/da3a8011013196d46693c370c909f151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLIFd9ulhT3zHPUc34tbSw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">为获胜而堆叠的酒吧</figcaption></figure><h2 id="6027" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 27</h2><p id="2fbf" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">与图 26 类似，图 27 显示了每天百分比变化的总和。简单的方式来看看哪些天穗更频繁。</p><p id="b45a" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">带走</strong>:周六通常有百分比变化的负数和。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="b38f" class="no ka in nk b gy np nq l nr ns">fig26 = px.bar(cases_melted, x="date_new", y="value"<br/>                 , color="dayofweek"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)</span><span id="597e" class="no ka in nk b gy nt nq l nr ns">fig26['layout'].update(height=500<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Sum of Covid Test Daily Percent Changes by Outcome&lt;/b&gt;'<br/>                     , yaxis_title="Sum of Daily % Changes"<br/>                     , xaxis_title="Date"<br/>                     , legend_title="Day of Week"<br/>                     , template='plotly_dark')<br/>fig26.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig26.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi os"><img src="../Images/653cc5094e7c0b364b5f954e76783307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q1XWo7jBEgkx2cgzM7BBA.png"/></div></div></figure><h2 id="87e2" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 28</h2><p id="7e8c" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 28 只是将每天分组在一起。数据与图表 27 相同，但为了便于查看，对日期进行了分组。</p><p id="5a98" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">外卖:周日涨幅最大；周二的跌幅最大；周六大部分时间都是负百分比变化(我猜人们还是想狂欢——我们只有在重要的时候才会生病；));周四、周三以及周二的一些时候，人们会觉得不舒服(我的意思是，无论如何，谁想在周中工作)。</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="2f97" class="no ka in nk b gy np nq l nr ns">fig27 = px.bar(cases_melted, x="date_new", y="value"<br/>                 , color="dayofweek", facet_col="dayofweek"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)<br/>#                  , facet_col_wrap=3)<br/>#                  , size=cases_melted.index)</span><span id="9e2c" class="no ka in nk b gy nt nq l nr ns">fig27['layout'].update(height=500<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Covid Test Outcome Trends Grouped by Day Of Week&lt;/b&gt;'<br/>                     , template='plotly_dark'<br/>                     , yaxis_title="Sum of Daily % Changes"<br/>                     , xaxis_title="Day of Week"<br/>                     , legend_title="Sum of Daily % Changes")<br/>fig27.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig27.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ow"><img src="../Images/98fc0ad8a2493270e667078ce625715e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vfg3fY-zzPOO147Mn7EbMQ.png"/></div></div></figure><p id="4bcc" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">图 29 </strong></p><p id="65ea" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">图 29 显示了按天分组的每日变化百分比热图。这是你喜欢哪张图表的偏好问题。数据与图 28 相同。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="c205" class="no ka in nk b gy np nq l nr ns">fig28 = px.bar(cases_melted, x="dayofweek", y="value"<br/>                 , color="value"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)<br/>#                  , facet_col_wrap=3)<br/>#                  , size=cases_melted.index)</span><span id="f60b" class="no ka in nk b gy nt nq l nr ns">fig28['layout'].update(height=500<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Covid Test Outcome Trends Grouped by Day Of Week&lt;/b&gt;'<br/>                     , template='plotly_dark'<br/>                     , yaxis_title="Sum of Daily % Changes"<br/>                     , xaxis_title="Day of Week"<br/>                     , legend_title="Sum of Daily % Changes")<br/>fig28.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig28.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ov"><img src="../Images/285d8c14af74bf074be852866c3a31a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkTsLqnf6OG7sMAPG5sMgA.png"/></div></div></figure><h2 id="5292" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 30</h2><p id="3496" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 30 显示了每种指标分组的星期几(彩色)；使得很容易看出哪些天具有最大的增长指标。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="836e" class="no ka in nk b gy np nq l nr ns">fig29 = px.bar(cases_melted, x="variable", y="value"<br/>                 , color="dayofweek"<br/>                 , color_continuous_scale=px.colors.sequential.Inferno)<br/>#                  , facet_col_wrap=3)<br/>#                  , size=cases_melted.index)</span><span id="1fd5" class="no ka in nk b gy nt nq l nr ns">fig29['layout'].update(height=500<br/>                     # , width=1200<br/>                     , title='&lt;b&gt;Covid Test Outcome Trends Grouped by Day Of Week&lt;/b&gt;'<br/>                     , template='plotly_dark'<br/>                     , yaxis_title="Sum of Daily % Changes"<br/>                     , xaxis_title="Outcome"<br/>                     , legend_title="Sum of Daily % Changes")<br/>fig29.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))<br/># fig29.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ox"><img src="../Images/c83ab308e48013e0670bffb3527515d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6GHlePlw2zMBZUi7T4-mA.png"/></div></div></figure><h2 id="c513" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">再次格式化数据</h2><p id="f40a" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">对于接下来的几个图表，我们需要向 is 数据堆栈添加几个东西:</p><ul class=""><li id="ac9d" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">[指标]列已舍入</li><li id="201e" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">一个圆形的列数据框架(它更整洁)</li><li id="c7ed" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天移动平均线柱</li><li id="214e" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天[指标]移动平均斜率列</li><li id="74ec" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">所有这 15 列的列表</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="2bdb" class="no ka in nk b gy np nq l nr ns">#create rounded columns and df<br/>cases['total_rounded'] = cases.totalTestResultsIncrease.round(-4)<br/>cases['percent_positive_rounded'] = cases.percent_positive.round(2)<br/>cases['percent_negative_rounded'] = cases.percent_negative.round(2)<br/>cases['percent_death_rounded'] = cases.percent_death.round(2)<br/>cases['percent_hospitalized_rounded'] = cases.percent_hospitalized.round(2)</span><span id="e12c" class="no ka in nk b gy nt nq l nr ns">cases_rounded = cases[['date_new','total_rounded','percent_positive_rounded'<br/>                      ,'percent_negative_rounded','percent_death_rounded'<br/>                      ,'percent_hospitalized_rounded']]</span><span id="17d8" class="no ka in nk b gy nt nq l nr ns">#add 5 day moving average columns<br/>cases_rounded['percent_pos_5d_avg'] = cases_rounded.rolling(window=5)['percent_positive_rounded'].mean()<br/>cases_rounded['total_rounded_5d_avg'] = cases_rounded.rolling(window=5)['total_rounded'].mean()<br/>cases_rounded['percent_neg_5d_avg'] = cases_rounded.rolling(window=5)['percent_negative_rounded'].mean()<br/>cases_rounded['percent_death_5d_avg'] = cases_rounded.rolling(window=5)['percent_death_rounded'].mean()<br/>cases_rounded['percent_hospitalized_5d_avg'] = cases_rounded.rolling(window=5)['percent_hospitalized_rounded'].mean()</span><span id="0886" class="no ka in nk b gy nt nq l nr ns">#create slope cols<br/>cases_rounded['percent_pos_5d_avg_slope'] = cases_rounded.percent_pos_5d_avg.diff().fillna(0)<br/>cases_rounded['total_rounded_5d_avg_slope'] = cases_rounded.total_rounded_5d_avg.diff().fillna(0)<br/>cases_rounded['percent_neg_5d_avg_slope'] = cases_rounded.percent_neg_5d_avg.diff().fillna(0)<br/>cases_rounded['percent_death_5d_avg_slope'] = cases_rounded.percent_death_5d_avg.diff().fillna(0)<br/>cases_rounded['percent_hospitalized_5d_avg_slope'] = cases_rounded.percent_hospitalized_5d_avg.diff().fillna(0)</span><span id="023e" class="no ka in nk b gy nt nq l nr ns">#convert lists<br/>#rounded lists<br/>total_rounded = list(cases_rounded.total_rounded)<br/>percent_positive_rounded = list(cases_rounded.percent_positive_rounded)<br/>percent_negative_rounded = list(cases_rounded.percent_negative_rounded)<br/>percent_death_rounded = list(cases_rounded.percent_death_rounded)<br/>percent_hospitalized_rounded = list(cases_rounded.percent_hospitalized_rounded)</span><span id="abfc" class="no ka in nk b gy nt nq l nr ns">#5d avg lists<br/>percent_pos_5d_avg = list(cases_rounded.percent_pos_5d_avg)<br/>total_rounded_5d_avg = list(cases_rounded.total_rounded_5d_avg)<br/>percent_neg_5d_avg = list(cases_rounded.percent_neg_5d_avg)<br/>percent_death_5d_avg = list(cases_rounded.percent_death_5d_avg)<br/>percent_hospitalized_5d_avg = list(cases_rounded.percent_hospitalized_5d_avg)</span><span id="4885" class="no ka in nk b gy nt nq l nr ns">#slope lists<br/>percent_pos_5d_avg_slope = list(cases_rounded.percent_pos_5d_avg_slope)<br/>total_rounded_5d_avg_slope = list(cases_rounded.total_rounded_5d_avg_slope)<br/>percent_neg_5d_avg_slope = list(cases_rounded.percent_neg_5d_avg_slope)<br/>percent_death_5d_avg_slope = list(cases_rounded.percent_death_5d_avg_slope)<br/>percent_hospitalized_5d_avg_slope = list(cases_rounded.percent_hospitalized_5d_avg_slope)</span></pre><h2 id="2057" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 31</h2><p id="8b25" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 31 显示了以下内容:</p><ul class=""><li id="1f2f" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">百分比正变化的 5 天运行平均值</li><li id="a4d3" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天运行平均测试总数</li><li id="602f" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">舍入的测试总数</li><li id="a364" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">正舍入百分比</li><li id="3f82" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">正 5 天平均斜率百分比</li></ul><p id="96b7" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">接下来的四个图表的目标是显示每日总[指标]百分比的相关性。第一个图表显示每天的正百分比斜率类似于总累积每日测试斜率。因此，你进行的测试越多，返回的阳性病例就越多。</p><p id="4523" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">要点:到 5 月底/6 月初，正百分比斜率几乎完全符合总累积每日测试斜率。这里有些不对劲…因为基本上，如果你在这一点上测试一半，你会有一半的阳性病例。接下来，我们需要研究死亡与阳性病例之间的关系。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="80f4" class="no ka in nk b gy np nq l nr ns"># Create fig30ure with secondary y-axis<br/>fig30 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="ab59" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=total_rounded<br/>           ,name="total_rounded"<br/>           ,mode="lines+markers"<br/>#            ,opacity=.5<br/>           ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_positive_rounded<br/>#            , opacity=.5<br/>           , mode="lines+markers"<br/>           , marker_color=px.colors.qualitative.Plotly[5]<br/>           , name="percent_positive_rounded"),<br/>    secondary_y=True,<br/>)</span><span id="0be0" class="no ka in nk b gy nt nq l nr ns">#moving averages<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="total_rounded_5d_avg"),<br/>    secondary_y=False,<br/>)<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_pos_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="percent_pos_5d_avg"),<br/>    secondary_y=True,<br/>)</span><span id="c159" class="no ka in nk b gy nt nq l nr ns">#slopes<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[3]<br/>           , name="total_rounded_5d_avg_slope"),<br/>    secondary_y=False,<br/>)<br/>fig30.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_pos_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[5]<br/>           , name="percent_pos_5d_avg_slope"),<br/>    secondary_y=True,<br/>)</span><span id="d494" class="no ka in nk b gy nt nq l nr ns"># Add fig30ure title<br/>fig30.update_layout(<br/>    title_text="&lt;b&gt;Total Daily Cases vs. Daily Percent Positive (Rounded) with 5 Day Moving Average and Slope&lt;/b&gt;"<br/>    ,height=800<br/>)</span><span id="3f3b" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig30.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="ca43" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig30.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)<br/>fig30.update_yaxes(title_text="&lt;b&gt;% Positive Cases&lt;/b&gt;", secondary_y=True)</span><span id="a57c" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig30.update_layout(barmode='stack')</span><span id="607f" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig30.update_traces(<br/>#                   marker_color='rgb(158,202,225)'<br/>#                   , marker_line_color='rgb(8,48,107)',<br/>                  marker_line_width=.01)<br/>#                   ,opacity=0.6)</span><span id="e2b1" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig30.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.01,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig30.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oy"><img src="../Images/10bb734a581a10ed2a9d619189471faa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAUo_KiMruErlIEEPG1aJg.png"/></div></div></figure><h2 id="f588" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 32</h2><p id="2b66" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 32 显示了以下内容:</p><ul class=""><li id="f6d2" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">百分比负变化的 5 天运行平均值</li><li id="ef06" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天运行平均测试总数</li><li id="bef8" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">舍入的测试总数</li><li id="b490" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">负百分比四舍五入</li><li id="9f45" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">负 5 天平均斜率百分比</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="dd7f" class="no ka in nk b gy np nq l nr ns"># Create fig30ure with secondary y-axis<br/>fig31 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="662c" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=total_rounded<br/>           ,name="total_rounded"<br/>           ,mode="lines+markers"<br/>#            ,opacity=.5<br/>           ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_negative_rounded<br/>#            , opacity=.5<br/>           , mode="lines+markers"<br/>           , marker_color=px.colors.qualitative.Plotly[2]<br/>           , name="percent_negative_rounded"),<br/>    secondary_y=True,<br/>)</span><span id="11ba" class="no ka in nk b gy nt nq l nr ns">#moving averages<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="total_rounded_5d_avg"),<br/>    secondary_y=False,<br/>)<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_neg_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="percent_neg_5d_avg"),<br/>    secondary_y=True,<br/>)</span><span id="46a0" class="no ka in nk b gy nt nq l nr ns">#slopes<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[3]<br/>           , name="total_rounded_5d_avg_slope"),<br/>    secondary_y=False,<br/>)<br/>fig31.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_neg_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[2]<br/>           , name="percent_neg_5d_avg_slope"),<br/>    secondary_y=True,<br/>)</span><span id="8218" class="no ka in nk b gy nt nq l nr ns"># Add fig30ure title<br/>fig31.update_layout(<br/>    title_text="&lt;b&gt;Total Daily Cases vs. Daily Percent Negative (Rounded) with 5 Day Moving Average and Slope&lt;/b&gt;"<br/>    ,height=800<br/>)</span><span id="771e" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig31.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="7ace" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig31.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)<br/>fig31.update_yaxes(title_text="&lt;b&gt;% Negative Cases&lt;/b&gt;", secondary_y=True)</span><span id="785d" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig31.update_layout(barmode='stack')</span><span id="417a" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig31.update_traces(<br/>#                   marker_color='rgb(158,202,225)'<br/>#                   , marker_line_color='rgb(8,48,107)',<br/>                  marker_line_width=.01)<br/>#                   ,opacity=0.6)</span><span id="c3b7" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig31.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.01,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig31.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ot"><img src="../Images/c7316403c2d8c48f17e3b3bb69eaeeaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-eimdrSueMU3pnkWgZm-A.png"/></div></div></figure><h2 id="68e8" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 33</h2><p id="813c" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 33 显示了以下内容:</p><ul class=""><li id="e067" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">死亡百分比变化的 5 天运行平均值</li><li id="e787" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天运行平均测试总数</li><li id="0afa" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">舍入的测试总数</li><li id="c4db" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">死亡百分比四舍五入</li><li id="9803" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">死亡率 5 天平均斜率</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="2c95" class="no ka in nk b gy np nq l nr ns"># Create fig30ure with secondary y-axis<br/>fig32 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="7b7c" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=total_rounded<br/>           ,name="total_rounded"<br/>           ,mode="lines+markers"<br/>#            ,opacity=.5<br/>           ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_death_rounded<br/>#            , opacity=.5<br/>           , mode="lines+markers"<br/>           , marker_color=px.colors.qualitative.Plotly[6]<br/>           , name="percent_death_rounded"),<br/>    secondary_y=True,<br/>)</span><span id="d526" class="no ka in nk b gy nt nq l nr ns">#moving averages<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="total_rounded_5d_avg"),<br/>    secondary_y=False,<br/>)<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_death_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="percent_death_5d_avg"),<br/>    secondary_y=True,<br/>)</span><span id="89f9" class="no ka in nk b gy nt nq l nr ns">#slopes<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[3]<br/>           , name="total_rounded_5d_avg_slope"),<br/>    secondary_y=False,<br/>)<br/>fig32.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_death_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[6]<br/>           , name="percent_death_5d_avg_slope"),<br/>    secondary_y=True,<br/>)</span><span id="ef19" class="no ka in nk b gy nt nq l nr ns"># Add fig30ure title<br/>fig32.update_layout(<br/>    title_text="&lt;b&gt;Total Daily Cases vs. Daily Percent Death (Rounded) with 5 Day Moving Average and Slope&lt;/b&gt;"<br/>    ,height=800<br/>)</span><span id="0f37" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig32.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="99c7" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig32.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)<br/>fig32.update_yaxes(title_text="&lt;b&gt;% Death Cases&lt;/b&gt;", secondary_y=True)</span><span id="e5fd" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig32.update_layout(barmode='stack')</span><span id="826b" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig32.update_traces(<br/>#                   marker_color='rgb(158,202,225)'<br/>#                   , marker_line_color='rgb(8,48,107)',<br/>                  marker_line_width=.01)<br/>#                   ,opacity=0.6)</span><span id="f46f" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig32.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.01,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig32.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oz"><img src="../Images/823362daaabf37455036002a31329449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_2A4uqXa5fNvLhzXpx8dg.png"/></div></div></figure><h2 id="d922" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">图 34</h2><p id="329f" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">图 34 显示了以下内容:</p><ul class=""><li id="d74b" class="mi mj in ll b lm ln lq lr lu nc ly nd mc ne mg mp mq mr ms bi translated">住院变化百分比的 5 天连续平均值</li><li id="9695" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">5 天运行平均测试总数</li><li id="6b90" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">舍入的测试总数</li><li id="2716" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">住院四舍五入百分比</li><li id="6054" class="mi mj in ll b lm mt lq mu lu mv ly mw mc mx mg mp mq mr ms bi translated">住院 5 天平均斜率百分比</li></ul><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="aa7d" class="no ka in nk b gy np nq l nr ns"># Create fig30ure with secondary y-axis<br/>fig33 = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="aa96" class="no ka in nk b gy nt nq l nr ns"># Add traces<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           ,y=total_rounded<br/>           ,name="total_rounded"<br/>           ,mode="lines+markers"<br/>#            ,opacity=.5<br/>           ,marker_color=px.colors.qualitative.Plotly[3]),<br/>    secondary_y=False,<br/>)<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_hospitalized_rounded<br/>#            , opacity=.5<br/>           , mode="lines+markers"<br/>           , marker_color=px.colors.qualitative.Plotly[4]<br/>           , name="percent_hospitalized_rounded"),<br/>    secondary_y=True,<br/>)</span><span id="efeb" class="no ka in nk b gy nt nq l nr ns">#moving averages<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="total_rounded_5d_avg"),<br/>    secondary_y=False,<br/>)<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_hospitalized_5d_avg<br/>           , opacity=.6<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[1]<br/>           , name="percent_hospitalized_5d_avg"),<br/>    secondary_y=True,<br/>)</span><span id="fdd1" class="no ka in nk b gy nt nq l nr ns">#slopes<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           , y=total_rounded_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[3]<br/>           , name="total_rounded_5d_avg_slope"),<br/>    secondary_y=False,<br/>)<br/>fig33.add_trace(<br/>    go.Scatter(x=date<br/>           , y=percent_hospitalized_5d_avg_slope<br/>           , opacity=.7<br/>           , mode="lines"<br/>           , marker_color=px.colors.qualitative.Plotly[4]<br/>           , name="percent_hospitalized_5d_avg_slope"),<br/>    secondary_y=True,<br/>)</span><span id="ea83" class="no ka in nk b gy nt nq l nr ns"># Add fig30ure title<br/>fig33.update_layout(<br/>    title_text="&lt;b&gt;Total Daily Cases vs. Daily Percent Hospitalized (Rounded) with 5 Day Moving Average and Slope&lt;/b&gt;"<br/>    ,height=800<br/>)</span><span id="1fda" class="no ka in nk b gy nt nq l nr ns"># Set x-axis title<br/>fig33.update_xaxes(title_text="&lt;b&gt;Date&lt;/b&gt;")</span><span id="d64b" class="no ka in nk b gy nt nq l nr ns"># Set y-axes titles<br/>fig33.update_yaxes(title_text="&lt;b&gt;Count Cases&lt;/b&gt;", secondary_y=False)<br/>fig33.update_yaxes(title_text="&lt;b&gt;% Hospitalized Cases&lt;/b&gt;", secondary_y=True)</span><span id="5306" class="no ka in nk b gy nt nq l nr ns"># Change the bar mode<br/>fig33.update_layout(barmode='stack')</span><span id="57b1" class="no ka in nk b gy nt nq l nr ns"># Customize aspect<br/>fig33.update_traces(<br/>#                   marker_color='rgb(158,202,225)'<br/>#                   , marker_line_color='rgb(8,48,107)',<br/>                  marker_line_width=.01)<br/>#                   ,opacity=0.6)</span><span id="f903" class="no ka in nk b gy nt nq l nr ns">#update legend<br/>fig33.update_layout(<br/>    template='plotly_dark'<br/>    ,legend=dict(<br/>    orientation="h",<br/>    yanchor="bottom",<br/>    y=1.0,<br/>    xanchor="right",<br/>    x=1<br/>))<br/># fig33.show()</span></pre><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pa"><img src="../Images/3efb23d0fd5157c4b49d79bcf28dc6cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sDrjxdctQTiG6SnGVSV8g.png"/></div></div></figure><h2 id="6b05" class="no ka in bd kb nx ny dn kf nz oa dp kj lu ob oc kn ly od oe kr mc of og kv oh bi translated">部署在 Heroku</h2><p id="792d" class="pw-post-body-paragraph lj lk in ll b lm mk lo lp lq ml ls lt lu my lw lx ly mz ma mb mc na me mf mg ig bi translated">这可以说是最烦人的部分。因为这个问题越来越长，所以高层次的问题是:</p><p id="9443" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">过程文件:</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a3e8" class="no ka in nk b gy np nq l nr ns">web: gunicorn app:server --timeout 1000</span></pre><p id="bf27" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io"> Requirements.txt </strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="24d5" class="no ka in nk b gy np nq l nr ns">Run in venv or not in venv (but it will create a bigger slug file, b/c it will contain all your install libraries, for heroku and that will slow down your app if not in venv:</span><span id="cd82" class="no ka in nk b gy nt nq l nr ns">pip freeze &gt; requirements.txt</span></pre><p id="5cfa" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">风格脚本和应用程序的东西</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="960c" class="no ka in nk b gy np nq l nr ns">bgcolors = {<br/>    'background': '#13263a',<br/>    'text': '#FFFFFF'<br/>}</span><span id="ec51" class="no ka in nk b gy nt nq l nr ns">external_scripts = [<br/>    '<a class="ae nb" href="https://www.google-analytics.com/analytics.js'" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com/analytics.js'</a>,<br/>    {'src': '<a class="ae nb" href="https://cdn.polyfill.io/v2/polyfill.min.js'" rel="noopener ugc nofollow" target="_blank">https://cdn.polyfill.io/v2/polyfill.min.js'</a>},<br/>    {<br/>        'src': '<a class="ae nb" href="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.core.js'" rel="noopener ugc nofollow" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.core.js'</a>,<br/>        'integrity': 'sha256-Qqd/EfdABZUcAxjOkMi8eGEivtdTkh3b65xCZL4qAQA=',<br/>        'crossorigin': 'anonymous'<br/>    }<br/>]</span><span id="f0e6" class="no ka in nk b gy nt nq l nr ns">external_stylesheets = ['<a class="ae nb" href="https://codepen.io/chriddyp/pen/bWLwgP.css'" rel="noopener ugc nofollow" target="_blank">https://codepen.io/chriddyp/pen/bWLwgP.css'</a>]</span><span id="dc93" class="no ka in nk b gy nt nq l nr ns">#app stuff<br/>app = dash.Dash(__name__,<br/>                external_scripts=external_scripts,<br/>                external_stylesheets=external_stylesheets)</span><span id="446b" class="no ka in nk b gy nt nq l nr ns">server = app.server</span></pre><p id="5108" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">布局和 html。Div 图形对象</strong></p><p id="df76" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我只是把所有的数字放在一个 div 中，就像这样(这个应用程序大约有 30 个数字):</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="75f1" class="no ka in nk b gy np nq l nr ns">app.layout = html.Div(children=[<br/>html.Br(),</span><span id="81d4" class="no ka in nk b gy nt nq l nr ns">html.Div([<br/>        dcc.Graph(figure=fig28)<br/>        ])</span><span id="7201" class="no ka in nk b gy nt nq l nr ns">,html.Br(),</span><span id="20b4" class="no ka in nk b gy nt nq l nr ns">html.Div([<br/>        dcc.Graph(figure=fig29)<br/>        ])</span><span id="f29d" class="no ka in nk b gy nt nq l nr ns">,html.Br()<br/>        ,html.Br()<br/>        ,html.Br()<br/>        ,html.Br(),</span><span id="e31b" class="no ka in nk b gy nt nq l nr ns">html.H1(children='5 Day Moving Average Meets % of Daily Outcomes (Rounded)')</span><span id="c7b8" class="no ka in nk b gy nt nq l nr ns">,html.Br(),</span><span id="f268" class="no ka in nk b gy nt nq l nr ns">html.Div([<br/>        dcc.Graph(figure=fig30)<br/>        ])</span></pre><p id="c1f0" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">运行它:</strong></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="bf31" class="no ka in nk b gy np nq l nr ns">if __name__ == '__main__':<br/>    app.run_server(debug=True)</span></pre><p id="be9c" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">就是这样！如果你真的读到了所有这些，你就是一个骑兵，好悲伤。主要是供参考。我猜这将包含许多人们试图在 plotly 或 dash 中创建的东西——可能与 covid 无关，但我喜欢分享我的工作，因为我喜欢当我发现有用时人们分享他们的工作。</strong></p><p id="881e" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">欢迎给我发消息，或者通过社交媒体渠道联系我。</p><figure class="nf ng nh ni gt jo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/31yearoldmoron"><div class="gh gi pb"><img src="../Images/5768eced23f6e47f18c56ad2b7691ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*l5CYO--RK4n0piEGDAvxqw.png"/></div></a></figure><p id="d272" class="pw-post-body-paragraph lj lk in ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ll io">Github</strong>:<a class="ae nb" href="https://github.com/maxwellbade/covid_us_final/tree/master/covid_one_million" rel="noopener ugc nofollow" target="_blank">https://Github . com/Maxwell bade/covid _ us _ final/tree/master/covid _ one _ million</a></p></div></div>    
</body>
</html>