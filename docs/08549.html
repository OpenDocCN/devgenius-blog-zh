<html>
<head>
<title>Use Serverless to deploy Sample Google Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器部署示例 Google Cloud 功能</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/use-serverless-to-deploy-sample-google-cloud-functions-c8901f747540?source=collection_archive---------10-----------------------#2022-06-23">https://blog.devgenius.io/use-serverless-to-deploy-sample-google-cloud-functions-c8901f747540?source=collection_archive---------10-----------------------#2022-06-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="69a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一名 AWS 云实践者，我在 AWS 云中使用各种无服务器部署。然而，作为一个实验，我想看看无服务器是否也能为谷歌云提供类似的体验！让我们检查一下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8b710c5ecfd0c7fc48b39d6ac30345f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrJIXrQ_7l0TybP9Usz6Rw.png"/></div></div></figure><h1 id="5a8c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">软件安装</h1><p id="7faf" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">无服务器安装基于 npm pacakage。我用的是 Linux Mint OS (ubuntu 架构)。因此，该命令对于其他操作系统来说可能非常有用。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="4cbe" class="mc kv in ly b gy md me l mf mg">## Install Nodejs &amp; npm</span><span id="a291" class="mc kv in ly b gy mh me l mf mg">curl -sL https://deb.nodesource.com/setup_18.x | sudo -E bash -<br/>sudo apt-get install -y nodejs</span><span id="74da" class="mc kv in ly b gy mh me l mf mg">## You may also need development tools to build native addons:<br/>     sudo apt-get install gcc g++ make</span><span id="d8c7" class="mc kv in ly b gy mh me l mf mg">## To install the Yarn package manager, run:</span><span id="2b30" class="mc kv in ly b gy mh me l mf mg">     curl -sL <a class="ae mi" href="https://dl.yarnpkg.com/debian/pubkey.gpg" rel="noopener ugc nofollow" target="_blank">https://dl.yarnpkg.com/debian/pubkey.gpg</a> | gpg --dearmor | sudo tee /usr/share/keyrings/yarnkey.gpg &gt;/dev/null<br/>     echo "deb [signed-by=/usr/share/keyrings/yarnkey.gpg] <a class="ae mi" href="https://dl.yarnpkg.com/debian" rel="noopener ugc nofollow" target="_blank">https://dl.yarnpkg.com/debian</a> stable main" | sudo tee /etc/apt/sources.list.d/yarn.list<br/>     sudo apt-get update &amp;&amp; sudo apt-get install yarn</span><span id="1e47" class="mc kv in ly b gy mh me l mf mg"># Install actual software :) serverless<br/>npm install -g serverless</span></pre><h1 id="6230" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">检查安装软件版本</h1><p id="8b51" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">要调试任何问题，我们使用的软件版本非常重要。所以检查下面的命令并验证版本。我也记下了输出以供参考</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d1ec" class="mc kv in ly b gy md me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~$ npm version<br/>{<br/>  npm: '8.12.1',<br/>  node: '18.4.0',<br/>  v8: '10.2.154.4-node.8',<br/>  uv: '1.43.0',<br/>  zlib: '1.2.11',<br/>  brotli: '1.0.9',<br/>  ares: '1.18.1',<br/>  modules: '108',<br/>  nghttp2: '1.47.0',<br/>  napi: '8',<br/>  llhttp: '6.0.6',<br/>  openssl: '3.0.3+quic',<br/>  cldr: '41.0',<br/>  icu: '71.1',<br/>  tz: '2022a',<br/>  unicode: '14.0',<br/>  ngtcp2: '0.1.0-DEV',<br/>  nghttp3: '0.1.0-DEV'<br/>}</span><span id="ccbe" class="mc kv in ly b gy mh me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~$ node --version<br/>v18.4.0</span><span id="dc26" class="mc kv in ly b gy mh me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~$ yarn --version<br/>1.22.19</span><span id="8ed3" class="mc kv in ly b gy mh me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~$ sls --version<br/>Framework Core: 3.19.0<br/>Plugin: 6.2.2<br/>SDK: 4.3.2</span><span id="3972" class="mc kv in ly b gy mh me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~$ serverless --version<br/>Framework Core: 3.19.0<br/>Plugin: 6.2.2<br/>SDK: 4.3.2</span></pre><h1 id="29c3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安装 Cloudfunction 特定库</h1><p id="95fc" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">现在我们已经设置了无服务器，我们可以使用我们想要的模块。在这个例子中，我们将使用云函数。所以安装那个插件。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="e01c" class="mc kv in ly b gy md me l mf mg">npm install --save serverless-google-cloudfunctions</span></pre><h1 id="82a1" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用 google Auth 登录</h1><p id="7aac" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我们可以连接谷歌认证或服务帐户无服务器。为了简单起见，我使用谷歌认证。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f584" class="mc kv in ly b gy md me l mf mg">gcloud auth application-default login</span></pre><h1 id="d804" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">启用服务 z</h1><p id="07cd" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">默认情况下，谷歌云在每个项目中只允许很少的服务。对于新创建的项目，请启用它。这项活动只有一次。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="acc3" class="mc kv in ly b gy md me l mf mg">gcloud services enable deploymentmanager.googleapis.com<br/>gcloud services enable cloudfunctions.googleapis.com<br/>gcloud services enable cloudbuild.googleapis.com</span></pre><h1 id="41df" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">编写简单的 http 函数</h1><p id="1793" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">无服务器使安装变得容易。我们可以创建下面的小文件，其中也定义了环境变量。这就是准备飞行的样本代码</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="2515" class="mc kv in ly b gy md me l mf mg"># serverless.yml<br/>service: my-gcloud-service</span><span id="53d9" class="mc kv in ly b gy mh me l mf mg">package:<br/>  patterns:<br/>   - '!node_modules/**'<br/>  excludeDevDependencies: true</span><span id="f1f0" class="mc kv in ly b gy mh me l mf mg">provider:<br/>  name: google<br/>  project: my-test<br/>  labels:<br/>    application: serverless-example</span><span id="6d71" class="mc kv in ly b gy mh me l mf mg">environment:<br/>  max_delay: '5000'</span><span id="ecc9" class="mc kv in ly b gy mh me l mf mg">plugins:<br/>  - serverless-google-cloudfunctions</span><span id="6d48" class="mc kv in ly b gy mh me l mf mg">functions:<br/>  first:<br/>    handler: http<br/>    events:<br/>    - http: path<br/>    labels:<br/>      team: gcf-team</span></pre><p id="f80e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">索引文件:一个小的 http 响应</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="edc1" class="mc kv in ly b gy md me l mf mg">// index.js</span><span id="3cb6" class="mc kv in ly b gy mh me l mf mg">exports.http = (request, response) =&gt;{<br/>  response.status(200).send('Hello World!');<br/>};</span></pre><h1 id="2560" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">本地测试</h1><p id="c1e8" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">关于无服务器最重要的事情是简单的命令来测试本地或从服务器。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="1a64" class="mc kv in ly b gy md me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~/gcloud$ sls invoke local  --function first<br/>Running "serverless" from node_modules<br/>{<br/>    "status": 200,<br/>    "headers": {<br/>        "content-type": "text/html; charset=utf-8",<br/>        "content-length": "12",<br/>        "etag": "W/\"c-Lve95gjOVATpfV8EL5X4nxwjKHE\""<br/>    },<br/>    "body": "Hello World!"<br/>}</span></pre><h1 id="fce0" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">[可选]包装功能</h1><p id="8698" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我们可以封装函数来查看任何编译时错误或构建错误。这个步骤是可选的&amp;已经包含在 deploy 函数中。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="fea7" class="mc kv in ly b gy md me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~/gcloud$ sls package<br/>Running "serverless" from node_modules<br/>Compiling function "first"...</span></pre><h1 id="9bab" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">部署功能</h1><p id="8f6e" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">就像我们可以在我们周围环境中部署功能一样。请在执行前检查它所指向的必需信息。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="c742" class="mc kv in ly b gy md me l mf mg">#Testing we are pointing right environment<br/>gcloud info<br/>gcloud auth list</span><span id="b54f" class="mc kv in ly b gy mh me l mf mg"># deploy function</span><span id="1d4b" class="mc kv in ly b gy mh me l mf mg">nirav@nirav-IdeaPad-Gaming-3-15ARH05:~/gcloud$ sls deploy <br/>Running "serverless" from node_modules<br/>Compiling function "first"...<br/>Uploading artifacts...<br/>Artifacts successfully uploaded...<br/>Updating deployment...<br/>Checking deployment update progress...<br/>..........<br/>Done...<br/>Service Information<br/>service: my-gcloud-service<br/>project: awacs-test<br/>stage: dev<br/>region: us-central1</span><span id="efb5" class="mc kv in ly b gy mh me l mf mg">Deployed functions<br/>first<br/>  <a class="ae mi" href="https://us-central1-awacs-test.cloudfunctions.net/my-gcloud-service-dev-first" rel="noopener ugc nofollow" target="_blank">https://us-central1-my-test.cloudfunctions.net/my-gcloud-service-dev-first</a></span></pre><h1 id="41c3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">执行功能</h1><p id="b7b9" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">当您直接执行 url 时，它会失败，因为它确实需要验证</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/51c2bed67ecde924c136bc6d9459d887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ye-jwjC8k4odBqqvWJikaw.png"/></div></div></figure><p id="3aed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用无服务器或 gcloud 命令来执行它</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="6a5a" class="mc kv in ly b gy md me l mf mg">#With gcloud command<br/>nirav@nirav-IdeaPad-Gaming-3-15ARH05:~/gcloud$ gcloud functions call my-gcloud-service-dev-first <br/>executionId: ykno5z83bs3c<br/>result: Hello World!</span><span id="3ab5" class="mc kv in ly b gy mh me l mf mg">#With sls<br/>sls invoke  --function first</span></pre><h1 id="858c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">参考:</h1><h1 id="03bd" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">参考:</h1><div class="mk ml gp gr mm mn"><a href="https://www.serverless.com/framework/docs/providers/google/guide/installation" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd io gy z fp ms fr fs mt fu fw im bi translated">无服务器框架-谷歌云功能指南-安装无服务器框架</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">Serverless 是一个 Node.js CLI 工具，所以您需要做的第一件事是在您的计算机上安装 Node.js。去…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">www.serverless.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ks mn"/></div></div></a></div><p id="d497" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae mi" href="https://techviewleo.com/how-to-install-nodejs-in-linux-mint/" rel="noopener ugc nofollow" target="_blank">https://techviewleo . com/how-to-install-nodejs-in-Linux-mint/</a></p><div class="mk ml gp gr mm mn"><a href="https://www.serverless.com/framework/docs/providers/google/guide/credentials" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd io gy z fp ms fr fs mt fu fw im bi translated">无服务器框架-谷歌云功能指南-证书</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">无服务器框架需要访问您的谷歌云帐户的帐户凭证，以便它可以创建和…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">www.serverless.com</p></div></div><div class="mw l"><div class="nc l my mz na mw nb ks mn"/></div></div></a></div></div></div>    
</body>
</html>