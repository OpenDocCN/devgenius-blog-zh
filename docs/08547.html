<html>
<head>
<title>How does JavaScript Work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 是如何工作的？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-does-javascript-work-feb906ca536c?source=collection_archive---------8-----------------------#2022-06-23">https://blog.devgenius.io/how-does-javascript-work-feb906ca536c?source=collection_archive---------8-----------------------#2022-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9fb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解释 JavaScript 的内部工作原理</p><p id="bc5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们先了解一下什么是 JavaScript / ECMAScript 引擎。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/defc7c592167d8705430e017a6734ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IOduo6CkW4bOp3eR"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">克劳迪奥·施瓦兹在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="adaf" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">JavaScript/ ECMAScript 引擎</h1><p id="282c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">当您用 JavaScript 编写一段代码时，代码会被 JavaScript 引擎提取。</p><p id="cbcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果代码是用 Node.js 编写的，那么这个引擎会在你的网络浏览器或电脑中运行。</p><p id="7102" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该引擎旨在理解您的代码，然后执行它。</p><p id="16b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有多个 JavaScript 引擎，它们基于<strong class="jp ir"> ECMAScript 标准</strong>。</p><p id="3f99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些受欢迎的是:</p><ul class=""><li id="a0dd" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">V8 引擎:用于谷歌 Chrome、Node.js 和 Deno</li><li id="c4a9" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">查克拉:用于微软边缘和互联网浏览器</li><li id="fc33" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">蜘蛛猴:用于 Mozilla Firefox</li><li id="5cb2" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">JavaScript 核心:在 Safari 中使用</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/30fcb341b6caa329bc12a5c30d94985e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ro8hlXPCShgVDEDk"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">丹尼·米勒在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="a12f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">JavaScript 引擎如何理解代码？</h1><p id="2ab6" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们先了解两个术语:</p><h2 id="9b65" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">解释程序</h2><ul class=""><li id="2f0b" class="mf mg iq jp b jq ma ju mb jy ng kc nh kg ni kk mk ml mm mn bi translated">当程序运行时，它们将代码逐行翻译成机器可读的形式。</li><li id="486f" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">像 Python 和 Ruby 这样的语言使用这些</li></ul><h2 id="2cf9" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">编译程序</h2><ul class=""><li id="e65c" class="mf mg iq jp b jq ma ju mb jy ng kc nh kg ni kk mk ml mm mn bi translated">在程序运行之前，它们立刻把代码翻译成机器可读的形式。</li><li id="c583" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">像 Java 和 C++这样的语言使用这些</li></ul><p id="3a4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解释器启动很快，但总体上很慢，因为它们不支持代码优化(编译器也是如此)。</p><p id="32ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了从这两个过程中获得最佳效果，为现代 JavaScript 引擎制定了一个称为实时(JIT)编译的过程。</p><h2 id="2424" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">实时(JIT)编译</h2><p id="ee24" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">JIT 编译是在程序执行期间而不是执行之前编译代码的过程。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/14633d44b4bc23ed5cfccf870b1a48ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1ELBf_WiCmYPHcSO"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">努贝尔森·费尔南德斯在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="dfb3" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">JIT 编译背后的思想</h1><p id="0f65" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">JavaScript 引擎中添加了一个名为<strong class="jp ir">分析器</strong>的新部件。</p><p id="a703" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它就像一个监视器，在你的代码中寻找可以优化的地方。</p><p id="620c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，它就是这样工作的。</p><ol class=""><li id="a191" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk nk ml mm mn bi translated">代码首先被完全解释。</li><li id="c69a" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk nk ml mm mn bi translated">然后，分析器识别出可以更快执行的区域(比如循环)。</li><li id="a315" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk nk ml mm mn bi translated">这些代码区域被输入到不同的编译器中。</li><li id="219e" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk nk ml mm mn bi translated">然后，这些编译器将这些代码块转换成优化的、更快的机器可读版本。</li><li id="7e13" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk nk ml mm mn bi translated">这些经过编译(优化)的代码块被添加回基础代码。</li></ol><h1 id="e512" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">JavaScript 代码是如何执行的？</h1><p id="be2e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">JavaScript 使用调用堆栈来执行代码。</p><h2 id="68dc" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">什么是堆栈？</h2><p id="46a0" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">堆栈是一种遵循<strong class="jp ir"> FILO(先进先出)</strong>原则的数据结构，即添加到堆栈中的数据首先在最后一个地方弹出。</p><h2 id="62f7" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">调用堆栈</h2><p id="06c2" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为了理解 JavaScript 调用堆栈，让我们创建两个函数。</p><ul class=""><li id="2581" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">函数将两个数字相加</li></ul><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="235c" class="mu ld iq nm b gy nq nr l ns nt">function add(num1, num2){<br/>    return num1 + num2<br/>}; // Returns the sum of num1 &amp; num2</span></pre><ul class=""><li id="453f" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">函数将两个数字相加，并将总和与另一个数字相乘(该函数使用前面的函数)</li></ul><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="2687" class="mu ld iq nm b gy nq nr l ns nt">function addThenMultiply(num1, num2, num3){<br/>    const sum = add(num1, num2);<br/>    return sum * num3<br/>}; // Returns the sum of num1 &amp; num2, and multiplies it by num3</span></pre><p id="6c05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将按如下方式运行这个组合代码。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="e71f" class="mu ld iq nm b gy nq nr l ns nt">function add(num1, num2){<br/>    return num1 + num2<br/>};</span><span id="a530" class="mu ld iq nm b gy nu nr l ns nt">function addThenMultiply(num1, num2, num3){<br/>    const sum = add(num1, num2);<br/>    return sum * num3<br/>};</span><span id="656b" class="mu ld iq nm b gy nu nr l ns nt">console.log(addThenMultiply(1, 2, 3));</span></pre><h2 id="b1f1" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">全局执行上下文</h2><p id="f862" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">当 JavaScript 引擎开始执行代码时，它会创建一个默认的<strong class="jp ir">全局执行上下文</strong>(称为 main())</p><p id="72c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是不在函数内部的所有 JavaScript 代码被执行的地方。</p><p id="e46e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行之前，所有定义的变量和函数都存储在内存堆中。这叫做<strong class="jp ir">吊装</strong>。</p><p id="1d9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，这个全局执行上下文被推到一个空的调用堆栈上。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/2777af7f9647e07f09a50169b71fc4ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*hWzgjAfW6PbrXyvSfaHZYA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在调用堆栈上推送全局执行上下文</figcaption></figure><p id="4816" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，JavaScript 引擎会遇到这段代码:</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="c3a7" class="mu ld iq nm b gy nq nr l ns nt">console.log(addThenMultiply(1, 2, 3));</span></pre><p id="150e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这为“addThenMultiply”函数创建了一个函数执行上下文。</p><p id="f41e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这被推到调用堆栈上。</p><h2 id="d559" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">函数执行上下文</h2><p id="b205" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">对于 JavaScript 引擎遇到的每个函数，它都会为其创建一个函数执行上下文，并将其推送到调用堆栈上。</p><p id="b17f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为“addThenMultiply”函数依赖于“add”函数，所以为“add”函数创建了一个函数执行上下文，并将其推送到调用堆栈上。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nw"><img src="../Images/9514351f2f69892b2c658517aa907994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OF69KFHuIKJbRBbWt2c6iA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">为所有函数创建函数执行上下文</figcaption></figure><p id="8c96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦定义了所有的函数执行上下文，JavaScript 引擎就开始执行“add”函数(调用堆栈上最顶层的函数执行上下文)并返回结果。</p><p id="6514" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这然后从调用堆栈中弹出。</p><p id="1468" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重复这个过程，直到调用堆栈为空。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nx"><img src="../Images/8294fef1fea0590eadf7ca0a2e5fb10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rAc0PcdZkz1JMwNh9HrRiQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">调用堆栈中的执行</figcaption></figure><h2 id="46a5" class="mu ld iq bd le mv mw dn li mx my dp lm jy mz na lq kc nb nc lu kg nd ne ly nf bi translated">为什么 JavaScript 是单线程的？</h2><p id="aa48" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">JavaScript 引擎运行一个调用堆栈。</p><p id="b123" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，它可以一次执行一行代码。</p><p id="2fcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得 JavaScript 成为单线程的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ny"><img src="../Images/acdcac82ecfe107b4e8758c0afc2ca98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9OUFKiy9Hy6VSQiC"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@afgprogrammer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mohammad Rahmani </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="1287" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="og">感谢您阅读本文！</em></p><p id="7189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="og">如果你是一个对 Python 或整体编程不熟悉的人，那就来看看我的新书吧，书名是《不要多头学习 Python 指南》<strong class="jp ir"/><em class="og">如下:</em></em></p><div class="oh oi gp gr oj ok"><a href="https://bamaniaashish.gumroad.com/l/python-book" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">学习 Python 的指南</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">你是一个正在考虑学习编程却不知道从哪里开始的人吗？我有适合你的解决方案…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">bamaniaashish.gumroad.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kv ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://bamania-ashish.medium.com/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">通过我的推荐链接加入 Medium——Ashish Bama nia 博士</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">阅读 Ashish Bamania 博士(以及 Medium 上成千上万的其他作家)的每一个故事。您的会员费直接…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">bamania-ashish.medium.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy kv ok"/></div></div></a></div></div></div>    
</body>
</html>