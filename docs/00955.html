<html>
<head>
<title>How to Create an Apple Card Payment Dial — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Apple Card支付拨号——第4部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-an-apple-card-payment-dial-part-4-c31342450c98?source=collection_archive---------24-----------------------#2020-06-20">https://blog.devgenius.io/how-to-create-an-apple-card-payment-dial-part-4-c31342450c98?source=collection_archive---------24-----------------------#2020-06-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/20247143c9a1250a1bcfa767ff26d435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SnFPYUutOFI8UsG_"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@melvinthambi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梅尔文·坦比</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b35c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">基于用户交互的界面更新。</strong></p><p id="9b2b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在最后一部分中，我们通过添加一个拇指并允许用户在表盘周围拖动拇指来开始与表盘进行交互。<br/>在这一部分，我们将在用户与表盘交互时更新用户界面。</p><p id="c06e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">随着拇指的移动，我们需要更新表盘中间的数字，以及表盘的边框背景颜色。让我们从数字开始。</p><h1 id="7f37" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">数字</h1><p id="543d" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这个刻度盘的全部意义实际上是更新我们想要为我们的虚拟账户提供资金的数量！<br/>为了更新数字，在<code class="fe mb mc md me b">thumbViewPanned()</code>内的<code class="fe mb mc md me b">defer</code>闭包中，添加下面的新函数<code class="fe mb mc md me b">updateFigures()</code>，我们将很快定义它。但在此之前，我们需要声明三个新变量来存储我们的初始数据。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f233" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe mb mc md me b">commonInit()</code>中，我们将添加一个名为<code class="fe mb mc md me b">configureBalance()</code>的新函数，这个函数将解析<code class="fe mb mc md me b">balance</code>字符串并为<code class="fe mb mc md me b">baseBalance</code>设置值。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="33ff" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们也将改变<code class="fe mb mc md me b">balance</code>的属性观察者来调用这个函数。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="337a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">说完这些，让我们回到<code class="fe mb mc md me b">updateFigures()</code>，这里是它的定义:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8339" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的<code class="fe mb mc md me b">angle</code>是使用<code class="fe mb mc md me b">atan2()</code>测量的，此函数返回-CGFloat.pi&lt;<code class="fe mb mc md me b">angle</code>&lt;CGFloat.pi<br/>范围内的角度。在我们的刻度盘中，上半部分代表-CG float . pi，下半部分是CG float . pi。变量<code class="fe mb mc md me b">value</code>正在转换，因此它从0开始。当进入第三象限时，即-CGFloat.pi开始的地方，我们添加2PI以消除它对<code class="fe mb mc md me b">value</code>的影响。<br/>由于第一个标记是我们的起点，我们从计算的<code class="fe mb mc md me b">value</code>中减去它的角度。现在，我们将<code class="fe mb mc md me b">value</code>转换为介于0和<code class="fe mb mc md me b">maximumFundingAmount</code>之间的值。最后，我们更新我们的标签。</p><p id="0441" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行应用程序，平移缩略图，我们应该会得到以下结果:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/2c54c000d001a1b3a6c4dc169ff497e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WBRN8lvmu_4JjBmYY0tYNw.gif"/></div></div></figure><h1 id="0dc3" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">表盘的背景色</h1><p id="723b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">当我们拖动拇指时，我们希望拇指经过的背景有不同的颜色，就像这样:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/c7e1b3823e12f4ffcc87834e3a714324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCao_8q6gVkg4P02L5qRtg.jpeg"/></div></div></figure><p id="d065" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们通过添加一个<code class="fe mb mc md me b">CAGradientLayer</code>到<code class="fe mb mc md me b">dialBody</code>的图层，并用一个添加在上面的<code class="fe mb mc md me b">CAShapeLayer</code>遮罩它来达到这个效果。</p><p id="1fae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要向我们的类中添加以下实例变量:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bc5b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了设置渐变层，我们定义了一个名为<code class="fe mb mc md me b">setupGradient()</code>的函数，并在<code class="fe mb mc md me b">commonInit()</code>中调用它。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="3a0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mb mc md me b">updateDialColors()</code>功能将根据拇指在表盘中的位置改变渐变颜色，其定义如下:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="b8ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe mb mc md me b">setupGradient()</code>结束时调用的<code class="fe mb mc md me b">updateShapeLayer()</code>函数在渐变层的顶部创建蒙版，它创建了一个跟随我们拇指的路径。它的定义是:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f5b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还将<code class="fe mb mc md me b">updateShapeLayer()</code>添加到我们的<code class="fe mb mc md me b">updateThumb()</code>函数中。这样，每次我们移动缩略图时，我们的形状层都会更新。</p><p id="d62a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mb mc md me b">CALayer</code>对象不遵循约束更新。所以在我们的<code class="fe mb mc md me b">updateConstraints()</code>函数中，我们需要更新我们的层对象框架，就像这样:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f16e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了在通过标记后改变渐变颜色，我们检查角度是否位于两个标记之间，如果是，我们将<code class="fe mb mc md me b">currentMarker</code>设置为最小的标记，并相应地更新颜色，当且仅当<code class="fe mb mc md me b">currentMarker</code>已经改变。该检查在新功能<code class="fe mb mc md me b">updateDialColorsIfNeeded()</code>中完成:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="564a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们称<code class="fe mb mc md me b">thumbViewPanned()</code>中的<code class="fe mb mc md me b">updateDialColorsIfNeeded()</code>为<code class="fe mb mc md me b">defer</code>闭包。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="913b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要查看渐变是如何被屏蔽的，隐藏<em class="mn">界面生成器</em>中的<strong class="kc io">文本视图</strong>并运行应用程序。您应该看到以下内容:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/c0a9ce5621371773ee6450b6be8e43c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VWJpPXcSdKHJfvWwh46oKg.gif"/></div></div></figure><p id="0b08" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开<strong class="kc io"> Main.storyboard </strong>现在应该是这样的:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/1a004ca25a5c11e19bc61ab979689799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gUT_00f7AFQjxKG4ECUgQ.jpeg"/></div></div></figure><p id="989c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行该项目，应该会产生以下结果:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/63642444dd560c3353199c65de343aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HEAGRE250ToHw-qo3HRcSA.gif"/></div></div></figure><p id="c08f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Apple Card表盘的拇指上有图标，当您到达一个标记时，图标会更新。我把这个留给你，我的读者朋友，作为一个练习。</p><p id="50a3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在下一部分，我们将看到如何使我们的视图可访问。</p></div></div>    
</body>
</html>