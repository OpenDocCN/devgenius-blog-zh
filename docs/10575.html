<html>
<head>
<title>PHP — P95: Cookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP—P95:cookie</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p95-cookies-8c87c1c74b8d?source=collection_archive---------7-----------------------#2022-11-12">https://blog.devgenius.io/php-p95-cookies-8c87c1c74b8d?source=collection_archive---------7-----------------------#2022-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/499d4ff2d9f8a1aa20b282bba16bb9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EmzzTLszh5yjgspoiUpsQ.jpeg"/></div></div></figure><p id="a7f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经没有话题可写了，所以这可能是我在过渡到 Laravel 之前关于 PHP 的最后一篇文章。既兴奋又悲伤。一旦你过了这个话题，任何你想学的 PHP 相关的东西都将变得微不足道。尽情探索额外的特性，寻找独特的编码方式，标准化您的代码，并进入框架。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p94-sessions-23e106ad374f"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P94:会话</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">什么是会话？这是一种在服务器上存储数据而不使用数据库的方法。当用户从页面转到…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="2d74" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是饼干？</h1><p id="8435" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">cookie 是一个包含用户可识别信息的小文本文件，由服务器设置在用户的计算机上。每当用户发出新的请求时，cookie 就会被发送到服务器。因此，每次用户访问网站上的不同页面时，都会发送请求和 cookie。</p><p id="f745" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您已经看到了用户持续登录 web 应用程序的例子。他们是怎么做到的？有饼干。用户标识符被加密，通常被加盐，并存储在数据库和用户的浏览器中。当他们返回网站时，会发送 cookie，用户会自动登录。这超出了本文的范围，但是如果您有兴趣了解更多内容，可以使用 PHP Cookies 查找身份验证和长期持久性。这里有一篇关于它的好文章。</p><div class="kw kx gp gr ky kz"><a href="https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">在具有长期持久性的 PHP 应用程序中实现安全的用户认证</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">web 开发中的一个常见问题是实现用户身份验证和访问控制，通常是通过…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">paragonie.com</p></div></div><div class="li l"><div class="mr l lk ll lm li ln jw kz"/></div></div></a></div><p id="c6e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个如此简单的概念，但对新开发人员来说却如此神秘。让我们看一个例子，看看我们能做些什么。</p><h1 id="9d03" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">设置 Cookie</h1><p id="e10d" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">还记得我说过服务器在用户的机器上设置 cookie 吗？它是怎么做到的？具有…鼓形辊… <code class="fe ms mt mu mv b">setcookie</code>功能。没错，函数叫<code class="fe ms mt mu mv b">setcookie</code>。</p><p id="48f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b">setcookie</code>函数是<code class="fe ms mt mu mv b">HTTP</code>头的一部分，所以它必须在页面呈现并发送给客户端之前被调用。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="8735" class="ne lp iq mv b be nf ng l nh ni">setcookie(<br/>    string $name,<br/>    string $value = "",<br/>    int $expires_or_options = 0,<br/>    string $path = "",<br/>    string $domain = "",<br/>    bool $secure = false,<br/>    bool $httponly = false<br/>): bool</span></pre><p id="772f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">前三个论点是我们感兴趣的。<code class="fe ms mt mu mv b">$name</code>是 cookie 的名称。<code class="fe ms mt mu mv b">$value</code>是 cookie 的值。而<code class="fe ms mt mu mv b">$expires_or_options</code>就是它到期的时间。它需要一个 unix 时间戳，例如，<code class="fe ms mt mu mv b">time()</code>。如果我们希望 cookie 在 1 小时后过期，我们需要给<code class="fe ms mt mu mv b">time()</code> : <code class="fe ms mt mu mv b">time() + (60 * 60)</code>加上 3600 秒。如果我们想让饼干在 24 小时内过期呢？<code class="fe ms mt mu mv b">time() + (60 * 60 * 24)</code>。一周后的今天呢？<code class="fe ms mt mu mv b">time() + (60 * 60 * 24 * 7)</code>。30 天后呢？<code class="fe ms mt mu mv b">time() + (60 * 60 * 24 * 30)</code>。很简单，对吧？</p><p id="97f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是时候看看<code class="fe ms mt mu mv b">set_cookie.php</code>的代码了。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="a91d" class="ne lp iq mv b be nf ng l nh ni">&lt;?php<br/>setcookie(<br/>    "full_name",<br/>    "Dino Cajic",<br/>    time() + (60 * 60 * 24 * 30)<br/>);</span></pre><p id="a6db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">酷毙了。我们能看看吗？我们当然可以。右键单击页面上的任意位置，然后单击检查元素。转到应用程序-&gt;存储-&gt; cookie。您应该会看到<code class="fe ms mt mu mv b">full_name</code> cookie 和值集。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/d176f8455bc51e4c3455577f3b88f34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zHyMscHkEYGI1jMiz6Kjng.png"/></div></div></figure><p id="aea3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相当酷。我们现在怎么找回它？</p><h1 id="b954" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">检索 Cookie</h1><p id="e690" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们如何从用户那里获得 cookie？由用户的浏览器自动发送到服务器。cookie 存储在<code class="fe ms mt mu mv b">$_COOKIE</code>超全局中。让我们看看转储后的输出是什么。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="5b63" class="ne lp iq mv b be nf ng l nh ni">&lt;?php<br/>var_dump($_COOKIE);</span></pre><p id="532c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令的输出是:</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="85b3" class="ne lp iq mv b be nf ng l nh ni">/app/93 Cookies/view_cookie.php:3:<br/>array (size=1)<br/>  'full_name' =&gt; string 'Dino Cajic' (length=10)</span></pre><p id="2088" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是一个关联数组。让我们将<code class="fe ms mt mu mv b">full_name</code>显示给用户。我们将检查是否设置了<code class="fe ms mt mu mv b">full_name</code>键，如果是<code class="fe ms mt mu mv b">echo</code>则输出用户的全名。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="eac4" class="ne lp iq mv b be nf ng l nh ni">&lt;?php // view_cookie.php<br/><br/>if ( isset($_COOKIE["full_name"]) ) {<br/>    echo "Hello " . $_COOKIE["full_name"];<br/>} else {<br/>    echo "Cookie not set.";<br/>}</span></pre><p id="1d9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据可以修改吗？当然了。在控制台中，我将从<code class="fe ms mt mu mv b">Dino Cajic</code>更改为<code class="fe ms mt mu mv b">Frank Beefy</code>。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/a2402ca4a6ca1da851149931f8cb8ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqCluztyARWBvIaypwnzCw.png"/></div></div></figure><p id="046c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦刷新页面，新的输出将是<code class="fe ms mt mu mv b">Hello Frank Beefy</code>。我们还可以注入 cookie 数据吗？是的，我们可以，所以要小心。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/5053863d7fdaf34907e9c55dcf5d43df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBKbafKPYZX8JLmOfBIPaQ.png"/></div></div></figure><p id="dcf1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们<code class="fe ms mt mu mv b">var_dump</code>了<code class="fe ms mt mu mv b">$_COOKIE</code>，我们会得到下面的。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="dcb1" class="ne lp iq mv b be nf ng l nh ni">/app/93 Cookies/view_cookie.php:3:<br/>array (size=2)<br/>  'full_name' =&gt; string 'Frank Beefy' (length=11)<br/>  'something_random' =&gt; string 'Something I injected' (length=20)</span></pre><p id="4407" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务器没有设置 cookie。用户通过右键单击控制台内部并为该域添加<code class="fe ms mt mu mv b">something_random</code> cookie 来自行设置这个 cookie。</p><h1 id="664f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">如何删除 Cookie？</h1><p id="4199" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">你刚刚设置了它，但是用的是过去的时间。例如，<code class="fe ms mt mu mv b">time() - (60 * 60)</code>。这会将 cookie 设置为过去 1 小时，使其过时。</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="97df" class="ne lp iq mv b be nf ng l nh ni">&lt;?php // delete_cookie.php<br/>setcookie(<br/>    "full_name",<br/>    "",<br/>    time() - (60 * 60)<br/>);</span></pre><p id="a0aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要传递一些数据作为第二个参数，因为你不能跳过它。空字符串有效。</p><p id="245c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在运行脚本之前，打开您的控制台，看着它在您加载您的<code class="fe ms mt mu mv b">delete_cookie.php</code>页面时消失。</p><p id="9dd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">给你，饼干。像其他事情一样简单。有时候你只需要一些孤立的例子和对正在发生的事情有一点点高层次的理解。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/55149026a00db0758b5c59b16c72f367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jUKGnNrfwYcUKT6G.jpeg"/></div></figure><p id="dcbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae ns" href="http://absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 负责人，该公司是<a class="ae ns" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae ns" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute 抗体</a>、<a class="ae ns" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae ns" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae ns" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae ns" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他拥有计算机科学学士学位，辅修生物学，并拥有十多年的软件工程经验。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="1361" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae ns" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae ns" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae ns" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="e346" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T25】</p></div></div>    
</body>
</html>