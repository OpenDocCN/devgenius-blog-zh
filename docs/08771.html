<html>
<head>
<title>Refactoring in Julia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">《朱莉娅》中的重构</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/refactoring-in-julia-155fdf76688e?source=collection_archive---------4-----------------------#2022-07-09">https://blog.devgenius.io/refactoring-in-julia-155fdf76688e?source=collection_archive---------4-----------------------#2022-07-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="fb24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我写的第一个真正的 Julia 程序是一个与 ycashd 交互的包装器(对于不熟悉的人，这是 Ycash 守护进程)。你可以在这里查看源代码。它有几个问题很长时间没有被触及，今天是我解决它们的日子。首先，是你在屏幕上方看到的依赖性混乱。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/6ea2d387613e175204fbbd66df20a928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*gm2DvKiXpKgr6ykVXKVPag.png"/></div></figure><p id="6e89" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们创建一个名为“deps.jl”的文件，然后将所有内容剪切并粘贴到其中。打开“deps.jl”文件，你会在底部看到一些用户提示。我要彻底删除这些废话。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/a3f5f03ebbdc6758ecfd0d545f9a581d.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*qNo-H4KVZI1jfv9NYMZKww.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">删除这个感觉真的真的真的很好</figcaption></figure><p id="f89c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">删除后，保存一切并运行它…</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kw"><img src="../Images/23ec1baf0f88d0c549729e87fd197bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3ypd0vHrrhKdvF0bBEiNw.png"/></div></div></figure><p id="3071" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好，所以它找不到“数据帧”…让我们只在顶部添加我们的 Julian 依赖项。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/da0652344718b3ed1f15287d6efb12e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*DykMSPTS-oYxnsFygpMUBw.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">干净多了</figcaption></figure><p id="2d19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你运行它，接下来你会遇到这个…</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lc"><img src="../Images/5df5c754adb56b8c34eabdad0fae4372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIT4LG4APaeEDm7IqHF2Lg.png"/></div></div></figure><p id="c599" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">每次运行时，程序都会询问我们到 ycashd 的路径。这看起来像是不专业和可怕的结构。这应该在安装文件中。我们已经有一个了，但是我们把它命名为“deps”，让我们把名字改成“setup.jl”从“ycash.jl”中删除这段代码。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/6ab8bd3e59e27479ac02090c5b77e491.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*Ayqmkwmc2Xc9Jk_ztjH2rg.png"/></div></figure><p id="dee6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在“setup.jl”中，我们将添加这个函数。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi le"><img src="../Images/70b67ce3f7469ef91c9c9eb3651801d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*YYhceZcq73rwQtNA8EDEIQ.png"/></div></figure><p id="a339" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在此时运行“ycash.jl”应该会产生以下错误:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lf"><img src="../Images/65d7f153164918d9775eb0f516bcf067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aNXre81_jqYEbb5MIUh3GQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">它找不到 ycash-cli</figcaption></figure><p id="e4e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将把下面的代码添加到“ycash.jl”中，这样它就知道在哪里可以找到 ycash-cli。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/8be062c266d122d2a4f12bfc82533e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*idzMcBIYiWX1itrkhwzRag.png"/></div></figure><p id="dad4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将“ycashcli()”更改为如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/7ed407536edc1ce352b22fbdb8456193.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*QAfMYpyVuCCwAx54NiFXxA.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">简单的一句俏皮话</figcaption></figure><p id="a392" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来是实际功能的工作。单独使用 ycash-cli 时，它可以接受多个参数。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi li"><img src="../Images/236c77309adc03b40671551840d70993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLgu4iJ_EuYbz7uD3jXgMA.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">ycash-cli 的一段输出</figcaption></figure><p id="9e51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们使用“ycashcli()”来运行它。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/6fd1ffe0ad0f50a04a8b3ad26d091ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*jP8trg3AE_XzFR8QDI5OfQ.png"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lk"><img src="../Images/7ed12036b2c33563ecdbf22f025b7014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OuedESY4gqeQHBsVcJTHw.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">我们得到一个错误</figcaption></figure><p id="b995" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个错误是因为“ycashcli()”只能接受一个参数。让我们解决这个问题。首先让我们写一个测试。因为我们将测试整个脚本中的大量内容，所以让我们将测试放在一个单独的文件“tests.jl”中。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/172055b9f452ade0614ecf06dba681c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*6qrzWqfPbUKFkw37NHBL2Q.png"/></div></figure><p id="e3b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一个断言只是为了测试我们是否有测试，然后我们从测试文件中打招呼并运行刚刚给我们一个错误的命令。在“ycash.jl”的底部，我们添加这个。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/029d6ce0b48d7173b534baacd0397b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*AS7whUbWLpHzhh5KVCAIaw.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">这告诉 ycash.jl 运行测试文件</figcaption></figure><p id="e51e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行它</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ln"><img src="../Images/3e6096e35ad0da332d87d18f2bc0e0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebFmPdOM0UmLFn62CKIezw.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">我们已经在测试文件中打了招呼，并重现了错误！</figcaption></figure><p id="c92e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">是时候来点 TDD 了。让我们添加第一个失败的测试。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/b5ce139238ee53ed2c923f0fafb96ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*v8p0cc6hG4LEFiBvq0jbNg.png"/></div></figure><p id="9e5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您在我们的断言中看到的大整数是块 0 的 UNIX 时间戳。现在为了让它通过，让我们重载“ycashcli()”函数。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/4a5323f830a94feb903e8f90de2649c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*WLyKVMUTGN_UlFcmSsahVg.png"/></div></figure><p id="3bf0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行，它会一直运行到脚本的结尾。输出太长，无法在此发布。所以我们写了测试，它失败了，我们让它通过了，现在是时候重构了。嗯，可能是这样，但是我们在前面更改路径时已经重构了“ycashcli()”。是时候完成我们之前开始的大规模重构了。从安装文件中删除“build_deps()”函数，因为我们在“ycash.jl”中包含了 Julian 依赖项。添加正确的安装提示后，最终的“setup.jl”将如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/556abfbaf0a266fc7a91d972dd1e47da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*2LHN_6zmL8q4RNu2T6jrUg.png"/></div></figure><p id="b4e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们也将从 YAGNI 的“ycash.jl”中删除这些内容(你将不再需要它们)。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lr"><img src="../Images/efbf321b4c7e4ace2003d4cca59834c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3mpW2dCqvTcWgPxo-X26w.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">当我第一次写程序时，这些东西是为了初始测试的目的</figcaption></figure><p id="27e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们删除所有这些东西，因为“ycashcli()”需要多个参数，我们不需要它们。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/235a0e640bcc10634c9fee642c385c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*tlz3BG1dNRhnT3WP5DAAaQ.png"/></div></figure><p id="b5c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要处理的下一个问题是“z_send()”函数，我将在下一篇文章中讨论这个问题，因为这是一个大问题。它可以工作，但是它真的很乱。</p></div></div>    
</body>
</html>