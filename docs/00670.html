<html>
<head>
<title>Python Logging Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python日志记录基础</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/python-logging-basics-458ad969e850?source=collection_archive---------2-----------------------#2020-06-14">https://blog.devgenius.io/python-logging-basics-458ad969e850?source=collection_archive---------2-----------------------#2020-06-14</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="91db" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何使用标准日志模块在Python中记录消息</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/023443592ba612329d20003dc56c633f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zpD-rLWf5Of24_W1"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="4d1c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">每个Python安装的标准库都包含一个日志模块，为记录消息提供了一个灵活的框架。大多数Python应用程序和库都使用这个模块。</p><p id="7b06" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">日志记录时使用四种类型的类。</p><ul class=""><li id="227b" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">记录器—公开应用程序可以用来记录日志的接口</li><li id="7c65" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">处理程序—将日志消息发送到适当的目标</li><li id="425b" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">过滤器—确定将哪些消息发送到哪些输出</li><li id="1a7f" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">格式化程序—消息在最终输出中是如何格式化的</li></ul></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="c17f" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">记录器</h1><p id="08a1" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">要在您的应用程序或库中创建一个记录器，您可以调用<code class="fe nl nm nn no b">logging.getLogger("app")</code>。参数<code class="fe nl nm nn no b">"app"</code>是您为这个记录器选择的名称。您可以使用一个日志记录器的名称，通过在名称中使用点来形成一个层次结构，如<code class="fe nl nm nn no b">'app.module.function'</code>。过滤器可以使用这种层次结构来仅查看来自特定功能或模块的消息。您可以自由选择任何名称或层级。</p><p id="6af0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果不指定记录器的名称，<code class="fe nl nm nn no b">logging.getLogger()</code>将返回一个记录器，它是层次结构的根记录器。</p><h2 id="dc9e" class="np mp ir bd mq nq nr dn mu ns nt dp my lg nu nv na lk nw nx nc lo ny nz ne oa bi translated">日志记录级别</h2><p id="c846" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">与所有日志框架一样，您可以在单独的级别上记录消息，以改变其重要性。Python中的日志模块定义了六个级别。</p><ul class=""><li id="43a8" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">关键— <code class="fe nl nm nn no b">logger.critical("critical message")</code></li><li id="0bf7" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">错误— <code class="fe nl nm nn no b">logger.error("error message")</code></li><li id="5a0c" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">警告— <code class="fe nl nm nn no b">logger.warn("warn message")</code></li><li id="ead4" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">信息— <code class="fe nl nm nn no b">logger.info("info message")</code></li><li id="c3cb" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">调试— <code class="fe nl nm nn no b">logger.debug("debug message")</code></li><li id="5e86" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">NOTSET</li></ul><p id="13c1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">默认情况下，日志记录级别在日志记录模块上设置为NotSet。使用NOTSET会导致处理所有消息。如果将日志级别设置为INFO，它将包括INFO、WARNING、ERROR和CRITICAL消息。不包括NOTSET和DEBUG消息。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ob oc l"/></div></figure></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="a34f" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">经理人</h1><p id="a3c3" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">如果您运行前面的示例，日志消息将不会显示。尽管日志记录级别设置为调试，而我们是在信息级别进行日志记录。这是因为我们没有指定处理程序。</p><p id="6c79" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">日志模块中有几个可用的处理程序，如StreamHandler、FileHandler、NullHandler、RotatingFileHandle、SocketHandler、DatagramHandler。</p><p id="be69" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们将使用其中的两个，用于记录控制台的StreamHandler和用于记录文件的FileHandler。参见<a class="ae kw" href="https://docs.python.org/3/library/logging.handlers.html#module-logging.handlers" rel="noopener ugc nofollow" target="_blank"> Python文档</a>了解更多关于其他处理程序的细节。</p><h2 id="8018" class="np mp ir bd mq nq nr dn mu ns nt dp my lg nu nv na lk nw nx nc lo ny nz ne oa bi translated">StreamHandler</h2><p id="881f" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">对于登录到控制台，我们可以使用StreamHandler。我们使用<code class="fe nl nm nn no b">addHandler</code>方法将处理程序添加到记录器中。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="4130" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果运行之前的程序，控制台上会显示日志消息<code class="fe nl nm nn no b">"Starting application"</code>。</p><h2 id="cc2b" class="np mp ir bd mq nq nr dn mu ns nt dp my lg nu nv na lk nw nx nc lo ny nz ne oa bi translated">文件处理器</h2><p id="b429" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">与我们添加StreamHandler的方式相同，您可以添加FileHandler来启用对文件的日志记录。FileHandler接受四个参数。</p><pre class="kh ki kj kk gu od no oe of aw og bi"><span id="0244" class="np mp ir no b gz oh oi l oj ok"><strong class="no is">FileHandler</strong>(<em class="ol">filename</em>, <em class="ol">mode='a'</em>, <em class="ol">encoding=None</em>, <em class="ol">delay=False</em>)</span></pre><p id="10a1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">第一个参数指定了用于存储日志消息的文件名。第二个参数指定文件模式。如果未指定，则使用模式<code class="fe nl nm nn no b">'a'</code>。encoding参数用于打开具有指定编码的文件。如果delay为真，文件将一直打开，直到第一条消息必须写入文件。不然，是不是直接开了。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="684a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果你打开文件<code class="fe nl nm nn no b">logging.txt</code>，你会看到一行信息“启动应用程序”。通常，在记录日志时，您希望在每个日志行上看到额外的信息，比如日期和时间。</p><p id="b8a8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这就是我们可以使用格式化程序的地方。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="f711" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">格式化程序</h1><p id="3803" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">格式化程序负责将内部日志记录转换成可以被人或外部系统解释的字符串。您可以将格式字符串与默认格式化程序一起使用。如果你不提供一个格式字符串，它就像前面的例子一样使用日志消息。</p><p id="5ace" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果您想为每个输出消息添加时间戳，您必须创建一个格式化程序实例，并在处理程序上设置它。</p><p id="172d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在下面的示例中，我在第六行创建了一个新的格式化程序，并在StreamingHandler上设置了该格式化程序。这意味着日志模块将使用这个格式化程序来格式化控制台上的消息。FileHandler仍然有默认的格式化程序。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="c94a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">应用程序启动时会在控制台中显示以下消息。</p><pre class="kh ki kj kk gu od no oe of aw og bi"><span id="1768" class="np mp ir no b gz oh oi l oj ok">2020-06-14 17:49:34,614 - INFO - Starting application</span></pre><p id="5377" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">格式化程序的第二个参数可用于指定日期和时间的特定格式。</p><p id="b0f1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">日志框架的最后一部分是过滤器。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="f936" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">过滤</h1><p id="bbb0" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">您可以使用筛选器实现比使用级别提供的更复杂的筛选。过滤器可以附加到处理程序和记录器上。附加到处理程序的筛选器在处理程序发出事件之前使用。每当在将事件发送到处理程序之前记录事件时，都会使用附加到记录器的筛选器。</p><p id="90c1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">默认过滤器只有一个参数<code class="fe nl nm nn no b">name</code>，这允许您设置记录器的名称来应用该过滤器。使用命名层次结构时，您可以应用更精细的过滤。例如，用“A.B”初始化的过滤器将允许记录器“A.B”、“A.B.C”、“A.B.C.D”、“A.B.D”等记录事件。但不是“A.BB”、“B.A.B”等。如果用空字符串初始化，所有事件都将被传递。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="66a0" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">添加格式化程序和处理程序</h1><p id="e912" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">因为添加格式化程序和处理程序非常常见，所以日志模块提供了助手函数<code class="fe nl nm nn no b">basicConfig</code>。该函数通过创建一个默认为<code class="fe nl nm nn no b">Formatter</code>的<code class="fe nl nm nn no b">StreamHandler</code>并将其添加到root logger来执行基本配置。</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="7db0" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">结论</h1><p id="8435" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">本文展示了使用标准日志模块在Python中进行日志记录的基础。拥有标准日志库的好处是大多数Python模块都使用它。因此您的应用程序日志可以包含您自己的消息，这些消息与来自第三方模块的消息集成在一起。</p><p id="7c36" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>