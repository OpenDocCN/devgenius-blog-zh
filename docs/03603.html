<html>
<head>
<title>Easy Web Scraping With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 轻松抓取网页</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/easy-web-scraping-with-python-f9e884a90420?source=collection_archive---------4-----------------------#2020-11-23">https://blog.devgenius.io/easy-web-scraping-with-python-f9e884a90420?source=collection_archive---------4-----------------------#2020-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">享受自动化—扩展您的能力</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6e4668d80a71b39feb9ada8cb8b1585a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SP3rwEdOFvS3saQe"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">克拉克·蒂布斯在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1ea3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的几年里，我学到的一件事是，我们很快就会对重复的东西感到厌倦。</p><p id="8c72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，你正在寻找一辆新车，不想被愚弄，所以你每天都在许多网站上寻找一个好的建议…这可能相当无聊。当然，现在大部分网站都可以有提醒系统，但不管怎样，你明白了。</p><p id="4e71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就我个人而言，我对网球感兴趣。我想知道每个 D+1 会有哪些球员上场，以确保我不会错过任何我感兴趣的比赛。</p><p id="b553" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在开始编码之前，这里是我的购物清单:</p><ul class=""><li id="5e18" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">找一个能提供每日日程表的网站(tennisexplorer.com)</li><li id="e001" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">找一个 Python HTML 解析器(美汤)</li><li id="e16e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">了解一点 HTML</li></ul><p id="18a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你关注了我以前的文章，我将使用我提到的一些特性(比如<a class="ae lb" href="https://medium.com/better-programming/stop-using-print-to-debug-your-python-code-2ace9217f501" rel="noopener">日志</a>)。</p><p id="4462" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们来认真的谈谈，开始我们的小剧本吧！</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="bc1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们先来谈谈我们将使用的模块 are，从第 1 行到第 5 行定义:</p><ul class=""><li id="cdc7" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated"><strong class="jp ir">请求</strong>:我们需要它来检索 HTML 网页及其内容</li><li id="f530" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><strong class="jp ir">日志</strong>:对调试目的总是有用的</li><li id="4928" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><strong class="jp ir"> BeautifulSoup </strong>:我们的 HTML 解析器——我们将在后面详细讨论</li><li id="726d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><strong class="jp ir"> argparse </strong>:用于使用-v 标志实现详细级别(第 7 行到第 14 行)</li><li id="efb6" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><strong class="jp ir"> datetime </strong>:强大的计算我们的一天+1(见第 17 行的简单计算，和第 18 行典型的 Python 变量赋值)</li></ul><p id="b44d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很简单。我们查找明天的值，并将它们传递给一个<strong class="jp ir"> GET </strong>请求(l25 / l29)。以下是在<strong class="jp ir">调试</strong>模式下运行时的输出</p><pre class="km kn ko kp gt lz ma mb mc aw md bi"><span id="f133" class="me mf iq ma b gy mg mh l mi mj">python tennis.py -vv<br/>2020–11–13 21:09:25,079 — root — DEBUG — day: 14, month: 11, year: 2020<br/>2020–11–13 21:09:25,079 — root — DEBUG — URL : <a class="ae lb" href="https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=14" rel="noopener ugc nofollow" target="_blank">https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=14</a><br/>2020–11–13 21:09:25,208 — urllib3.connectionpool — DEBUG — Starting new HTTPS connection (1): <a class="ae lb" href="http://www.tennisexplorer.com:443" rel="noopener ugc nofollow" target="_blank">www.tennisexplorer.com:443</a><br/>2020–11–13 21:09:25,485 — urllib3.connectionpool — DEBUG — <a class="ae lb" href="https://www.tennisexplorer.com:443" rel="noopener ugc nofollow" target="_blank">https://www.tennisexplorer.com:443</a> “GET /matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=14 HTTP/1.1” 200 16790<br/>2020–11–13 21:09:25,531 — root — DEBUG — Response content: b’&lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0 Transitional//EN” “<a class="ae lb" href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;\n&lt;html</span></pre><p id="c0de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来不错。接下来，我们需要分析我们的 HTML 内容。在用脚本解析 HTML 之前，有一件事可以帮助你，那就是使用 Firefox / Chrome dev 模式来清楚地识别你在网页中寻找的信息是如何表示的。</p><p id="578e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，我想获取蓝色矩形内的所有信息，同时区分红色矩形内的信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/eb3dc0118ab270324d07592633e67607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZJSrSOuCvHqGMJOPQreSA.png"/></div></div></figure><p id="68c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你使用检查工具，你会很快看到所有想要的信息都在一个表中，并且有一个类属性=结果。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/2ef754eb89da93fa128b4ea91001f337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nefYKxApRLj5ZqeCTmDHAw.png"/></div></div></figure><p id="6970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，这是摘录的好开始。然后，我们还可以过滤 tbody(表体)元素，以进一步减少。然后，我们需要确定两件事:</p><ul class=""><li id="b1be" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">锦标赛是在一个特定的职业/ id 还是别的什么？是的，它总是一个<strong class="jp ir"> tr </strong>元素，一个类被设置为“<strong class="jp ir"> head flags </strong></li><li id="d22b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">同样的事情也适用于球员吗？不完全是。每个面对面的人都有一个专用的 id。例如，玩家 1 的 id=r1，而玩家 2 的 id=r1b。也许我们可以在这里做得更容易，我们会看到以后。</li></ul><p id="57ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们将所有的锦标赛位置放入我们的 tbody 中，以便能够逐个解析每个区块:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="33fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第 2 行，我们用 response.content 作为参数初始化我们的 BeautifulSoup 解析器。<br/>然后，我们在表格元素(l4)上应用一个过滤器，在第 5 行上减少。</p><p id="7a57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们使用 enumerate 来获取锦标赛名称(t_name)和锦标赛线(I ),这两个信息将被添加到我们的锦标赛索引列表(tournament_idx_lst)中。</p><pre class="km kn ko kp gt lz ma mb mc aw md bi"><span id="8ea2" class="me mf iq ma b gy mg mh l mi mj">python tennis.py -vv<br/>2020-11-13 21:38:05,436 - root - INFO -   Sofia is located at line 0 of the tbody<br/>2020-11-13 21:38:05,437 - root - INFO -   Cary challenger is located at line 3 of the tbody<br/>2020-11-13 21:38:05,438 - root - INFO -   Bratislava challenger is located at line 6 of the tbody<br/>2020-11-13 21:38:05,440 - root - INFO -   Futures 2020 is located at line 11 of the tbody<br/>2020-11-13 21:38:05,443 - root - INFO - [0, 3, 6, 11, 24]</span></pre><p id="9b34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们的循环将产生的输出。这是一个非常好的开始，因为我们现在可以使用我们的锦标赛 _idx_lst 来提取两个边界之间的内容。</p><p id="c41a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你没注意到，玩家的名字会被截断。我想知道全名。我们需要提取每个玩家的 href 链接，转到玩家的网页，并获得全名。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/b3412c556dd3784e9797b3c9c7161dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XO9IKKtlhSOHs5HIb3dVEQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">每个玩家都有一个 href 链接，在“t-name”类的<td>元素上</td></figcaption></figure><p id="f8c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我会为这个任务专门设计一个函数，因为它会随着玩家数量的增加而被使用。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="9f4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个也超级简单。在玩家页面上，玩家的名字位于一个带有 plDetail 类的表格中，在两个<h3>标签之间。注意 player_name 是一个列表的窍门，第一项[0]永远是我们玩家的名字。</h3></p><p id="db20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的例子将向你展示它是如何工作的:</p><pre class="km kn ko kp gt lz ma mb mc aw md bi"><span id="8d30" class="me mf iq ma b gy mg mh l mi mj">print(getPlayersFullName("/player/sinner-8b8e8/"))<br/>Jannik Sinner</span><span id="ff32" class="me mf iq ma b gy mm mh l mi mj"># Check the content of player_name var<br/>print(player_name)<br/>[&lt;h3&gt;Sinner Jannik&lt;/h3&gt;]</span><span id="7aab" class="me mf iq ma b gy mm mh l mi mj"># Check the content of item n°1 of the list<br/>print(player_name[0])<br/>&lt;h3&gt;Sinner Jannik&lt;/h3&gt;</span><span id="877b" class="me mf iq ma b gy mm mh l mi mj"># Convert it to text (beautiful soup method)<br/>print(player_name[0].text)<br/>Sinner Jannik</span><span id="432c" class="me mf iq ma b gy mm mh l mi mj"># Reverse the content (I need first name - last name)<br/># Convert it to a list to easily reverse, then join it back to have a string<br/>print(' '.join(player_name[0].text.split()[::-1]))<br/>Jannik Sinner</span></pre><p id="a7bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这看起来不错。我们现在只需要用一些 for 循环来解析整个页面。我想要生成的是这样组织的字典:</p><pre class="km kn ko kp gt lz ma mb mc aw md bi"><span id="d80b" class="me mf iq ma b gy mg mh l mi mj">tournament_dict = {<br/>    "tournament1": {<br/>        "current_date": ["x vs y", "z vs p"]<br/>    },<br/>    "tournament2": {<br/>        "current_date": ["a vs b", "c vs d"]<br/>    }<br/>}</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lx ly l"/></div></figure><blockquote class="mn mo mp"><p id="e438" class="jn jo mq jp b jq jr js jt ju jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj kk ij bi translated">让我解释一下我们在这里做什么</p></blockquote><ul class=""><li id="ba22" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">首先，我们解析我们的<strong class="jp ir"> <em class="mq">锦标赛 _ idx _ 列表</em> </strong>，它包含我们的 tbody 项目的所有锦标赛行号</li><li id="48d1" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">锦标赛名称提取自<strong class="jp ir"> <em class="mq"> &lt; td &gt; </em> </strong>标签、<strong class="jp ir"> <em class="mq">类 t-name </em> </strong>、来自<strong class="jp ir"> <em class="mq">行列表</em> </strong>(这是 tbody 表中的所有&lt; tr &gt;)</li><li id="6001" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">如果锦标赛名称不存在于我们的字典中，我们创建上面的树结构</li><li id="288d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">然后，从第 8 行到第 9 行的循环解析两个锦标赛之间的所有记录(基于锦标赛位置—存在于<strong class="jp ir"> <em class="mq">锦标赛 _idx_list </em> </strong>)</li></ul><p id="f70c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您运行该代码，您将会得到类似这样的结果:</p><pre class="km kn ko kp gt lz ma mb mc aw md bi"><span id="ddfd" class="me mf iq ma b gy mg mh l mi mj"># Output with url = <a class="ae lb" href="https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=15" rel="noopener ugc nofollow" target="_blank">https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=15</a><br/>{'Sofia': {'2020-11-15': ['Jannik Sinner vs Vasek Pospisil']}}</span><span id="bc19" class="me mf iq ma b gy mm mh l mi mj"># Output with url = <a class="ae lb" href="https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=15" rel="noopener ugc nofollow" target="_blank">https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=11&amp;day=15</a><br/>{'Masters Cup ATP': {'2020-11-15': ['Dominic Thiem vs Stefanos Tsitsipas', 'Rafael Nadal vs Andrey Rublev']}}</span><span id="4bdf" class="me mf iq ma b gy mm mh l mi mj"># Output with url = <a class="ae lb" href="https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=02&amp;day=03" rel="noopener ugc nofollow" target="_blank">https://www.tennisexplorer.com/matches/?type=atp-single&amp;year=2020&amp;month=02&amp;day=03</a><br/># Multiple tournaments<br/>{'Cordoba': {'2020-11-15': ['Pablo Cuevas vs Federico Delbonis', 'Gianluca Mager vs Pablo Juan Ficovich', 'Attila Balazs vs Lorenzo Sonego']}, 'Pune': {'2020-11-15': ['Salvatore Caruso vs Ramkumar Ramanathan', 'Viktor Troicki vs Sumit Nagal', 'Yuichi Sugita vs Thomas Fabbiano', 'Cedrik-Marcel Stebe vs Ivo Karlovic']}, 'Montpellier': {'2020-11-15': ['Norbert Gombos vs Pablo Carreno-Busta', 'Gregoire Barrere vs Joao Sousa', 'Vasek Pospisil vs Aljaz Bedene', 'Damir Dzumhur vs Elliot Benchetrit', 'Sergiy Stakhovsky vs Danilo Petrovic', 'Enzo Couacaud vs Guillermo Garcia-Lopez', 'Emil Ruusuvuori vs Nicolas Mahut']}}</span></pre><p id="13a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这正是我想要的！当然，您可以用一个循环来运行脚本，以便对未来的匹配有更完整的了解。</p><p id="2186" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望这篇教程能让你的网络抓取不那么黑暗。不要犹豫，如果你有任何建议，请使用下面的评论部分。</p><p id="bd2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读</p></div></div>    
</body>
</html>