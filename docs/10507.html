<html>
<head>
<title>HOW TO DEPLOY REACT &amp; GO PROJECT ON VPS USING NGINX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 NGINX 在 VPS 上部署 REACT &amp; GO 项目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-deploy-react-go-project-on-vps-using-nginx-73df7930f85f?source=collection_archive---------1-----------------------#2022-11-07">https://blog.devgenius.io/how-to-deploy-react-go-project-on-vps-using-nginx-73df7930f85f?source=collection_archive---------1-----------------------#2022-11-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="252d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大家好，在这篇文章中，我将讨论如何使用用 Go Gin 框架编写的后端部署一个 react 项目。</p><p id="cfaa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">先决条件</strong></p><p id="8dee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">应该有域和子域。我将在这篇文章中使用 test.com，api.test.com，admin.test.com。</p><p id="21b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">应该将您的域名绑定到您的公共 IP。您可以搜索如何添加记录。</p><p id="891c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">应该有 VPS(装有 Linux Ubuntu 操作系统的虚拟专用服务器)</p><p id="1c54" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们先看看基本的架构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/86ac108ccbe2b6b1c0aa8d8af638c9be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*Aw9uvoErIg5FGwYuFMpZrw.png"/></div></figure></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="0a18" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">步骤</strong></h1><p id="107e" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated"><strong class="jm io"> 1)通过 SSH 连接到 VPS</strong></p><p id="5105" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要通过 ssh 连接您的 vps，您应该打开端口 22。默认情况下，它通常是打开的(如果不是，请转到您的提供商处，从面板中打开该端口)。</p><p id="9c38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 2)安装必要的软件包</strong></p><p id="0dda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装 nginx，防火墙，golang，npm 和 git。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="7e7c" class="mf ky in mb b gy mg mh l mi mj">apt install nginx</span><span id="e6fd" class="mf ky in mb b gy mk mh l mi mj">apt install ufw</span><span id="03d1" class="mf ky in mb b gy mk mh l mi mj">apt install golang-go</span><span id="f295" class="mf ky in mb b gy mk mh l mi mj">apt install nodejs  //(or apt install npm)</span><span id="8ad4" class="mf ky in mb b gy mk mh l mi mj">apt install git</span></pre><p id="29fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 3)启用防火墙</strong></p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="ef08" class="mf ky in mb b gy mg mh l mi mj">ufw enable</span><span id="b92c" class="mf ky in mb b gy mk mh l mi mj">ufw allow ssh //<em class="ml">(dont forget. If you forget, you may not connect again to your vps 😊)</em></span><span id="2e39" class="mf ky in mb b gy mk mh l mi mj">ufw allow “Nginx Full”</span><span id="b890" class="mf ky in mb b gy mk mh l mi mj">ufw status</span></pre><p id="bf69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 git clone 将你的项目克隆到某个地方。(在我们的例子中，它们是客户端、管理面板和后端)</p><p id="12e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 5)移除/var/www 中的静态 html 文件夹，并创建您的文件夹。</strong></p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="c983" class="mf ky in mb b gy mg mh l mi mj">rm -rf /var/www/html</span><span id="869a" class="mf ky in mb b gy mk mh l mi mj">mkdir /var/www/test/client //<em class="ml">(It ‘ll keep the build files for react client)</em></span><span id="4416" class="mf ky in mb b gy mk mh l mi mj">mkdir /var/www/test/admin-panel //<em class="ml">(It ‘ll keep the build files for react admin-panel)</em></span></pre><p id="9654" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ml">注意:我们没有为后端创建文件夹，因为我们不需要为它发布任何静态文件。</em></p><p id="215a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 6)创建构建文件并复制到/var/www </strong></p><p id="4cd8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转到您的项目目录并运行此命令。我假设您已经运行了 npm install 来获取项目的依赖包。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="da1a" class="mf ky in mb b gy mg mh l mi mj"><strong class="mb io">---For Client---</strong><br/>npm run build</span><span id="8031" class="mf ky in mb b gy mk mh l mi mj">cp -r build/* /var/www/test/client</span><span id="f69c" class="mf ky in mb b gy mk mh l mi mj"><strong class="mb io">--For Admin Panel---</strong><br/>npm run build</span><span id="172e" class="mf ky in mb b gy mk mh l mi mj">cp -r build/* /var/www/test/admin-panel</span></pre><p id="1d72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 7)配置 nginx </strong></p><p id="a6ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先删除默认的 nginx 配置文件。要做到这一点；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="1bbf" class="mf ky in mb b gy mg mh l mi mj">rm /etc/nginx/sites-available/default</span><span id="4d70" class="mf ky in mb b gy mk mh l mi mj">rm /etc/nginx/sites-enabled/default</span></pre><p id="0cd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建您自己的文件；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="46ef" class="mf ky in mb b gy mg mh l mi mj">nano /etc/nginx/sites-available/test</span></pre><p id="cee6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">配置 nginx 文件；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="e537" class="mf ky in mb b gy mg mh l mi mj">server {</span><span id="d0ee" class="mf ky in mb b gy mk mh l mi mj">listen 80;</span><span id="a526" class="mf ky in mb b gy mk mh l mi mj">server_name test.com www.test.com</span><span id="2b4a" class="mf ky in mb b gy mk mh l mi mj">location / {</span><span id="2a6e" class="mf ky in mb b gy mk mh l mi mj">root /var/www/test/client;</span><span id="596e" class="mf ky in mb b gy mk mh l mi mj">index  index.html index.htm;</span><span id="07b7" class="mf ky in mb b gy mk mh l mi mj">proxy_http_version 1.1;</span><span id="459c" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Upgrade $http_upgrade;</span><span id="78ad" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Connection 'upgrade';</span><span id="4c3a" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Host $host;</span><span id="edba" class="mf ky in mb b gy mk mh l mi mj">proxy_cache_bypass $http_upgrade;</span><span id="e2d4" class="mf ky in mb b gy mk mh l mi mj">try_files $uri $uri/ /index.html;</span><span id="5b0b" class="mf ky in mb b gy mk mh l mi mj">}<br/>}</span><span id="44a6" class="mf ky in mb b gy mk mh l mi mj">server {</span><span id="62d9" class="mf ky in mb b gy mk mh l mi mj">listen 80;</span><span id="5a98" class="mf ky in mb b gy mk mh l mi mj">server_name admin.test.com</span><span id="3d95" class="mf ky in mb b gy mk mh l mi mj">location / {</span><span id="c5ef" class="mf ky in mb b gy mk mh l mi mj">root /var/www/test/admin-panel;</span><span id="532b" class="mf ky in mb b gy mk mh l mi mj">index  index.html index.htm;</span><span id="6d92" class="mf ky in mb b gy mk mh l mi mj">proxy_http_version 1.1;</span><span id="f536" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Upgrade $http_upgrade;</span><span id="21f6" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Connection 'upgrade';</span><span id="933f" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Host $host;</span><span id="344f" class="mf ky in mb b gy mk mh l mi mj">proxy_cache_bypass $http_upgrade;</span><span id="a5ac" class="mf ky in mb b gy mk mh l mi mj">try_files $uri $uri/ /index.html;</span><span id="185e" class="mf ky in mb b gy mk mh l mi mj">}<br/>}</span><span id="0e57" class="mf ky in mb b gy mk mh l mi mj">server {</span><span id="d785" class="mf ky in mb b gy mk mh l mi mj">listen 80;</span><span id="45e9" class="mf ky in mb b gy mk mh l mi mj">server_name api.test.com</span><span id="3c46" class="mf ky in mb b gy mk mh l mi mj">location / {</span><span id="447a" class="mf ky in mb b gy mk mh l mi mj">proxy_pass http://&lt;your-public-ip&gt;:&lt;backend-port&gt;;</span><span id="15a5" class="mf ky in mb b gy mk mh l mi mj">proxy_http_version 1.1;</span><span id="fe5e" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Upgrade $http_upgrade;</span><span id="c2e9" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Connection 'upgrade';</span><span id="b29c" class="mf ky in mb b gy mk mh l mi mj">proxy_set_header Host $host;</span><span id="d1c2" class="mf ky in mb b gy mk mh l mi mj">proxy_cache_bypass $http_upgrade;</span><span id="2fd3" class="mf ky in mb b gy mk mh l mi mj">}</span><span id="70bf" class="mf ky in mb b gy mk mh l mi mj">}</span></pre><p id="a814" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">链接站点可用和启用的文件；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="bf60" class="mf ky in mb b gy mg mh l mi mj">ln -s /etc/nginx/sites-available/test /etc/nginx/sites-enabled/test</span></pre><p id="db47" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">重启 nginx</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="eed0" class="mf ky in mb b gy mg mh l mi mj">sudo systemctl restart nginx</span></pre><p id="8482" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经配置了 nginx。客户端和管理面板应该在此刻工作。但是我们的后端呢？我们应该让它继续运行。当然你可以通过运行 main.go 手动完成，但是有一种方法可以在机器启动时默认完成。</p><p id="8969" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经为我们的后端设置了端口 8080。因此你的后端应该监听这个端口，但是 ofc 你可以随意改变它。</p><p id="9b26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要自动运行你的后端，<strong class="jm io"> pm2 </strong>是个不错的选择。</p><p id="dcd9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们使用 npm 全局安装 pm2 包<strong class="jm io"/>。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="8ac3" class="mf ky in mb b gy mg mh l mi mj">npm install  -g pm2</span></pre><p id="d5ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，转到您的后端项目目录并运行它；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="36f1" class="mf ky in mb b gy mg mh l mi mj">pm2 start --name api “go run main.go”</span></pre><p id="f8e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">设置 pm2 启动；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="be4f" class="mf ky in mb b gy mg mh l mi mj">pm2 startup ubuntu</span></pre><p id="0216" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如你所知，我们的域名没有使用 SSL。如果你想主动 ssl 认证；<em class="ml">(不要忘记将来自客户端的后端 URL 替换为 https://) </em></p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="35fd" class="mf ky in mb b gy mg mh l mi mj">apt install certbot python3-certbot-nginx<br/>certbot --nginx -d test.com -d api.test.com -d admin.test.com</span></pre><p id="4e50" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">证书的有效期只有 90 天。如果你想自动刷新它们，设置一个定时器；</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="899b" class="mf ky in mb b gy mg mh l mi mj">systemctl status certbot.timer</span></pre><p id="c099" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安妮，就这样！我希望它有用。谢谢你的时间。如果您有任何问题，请随时联系我:)下一篇文章再见。</p></div></div>    
</body>
</html>