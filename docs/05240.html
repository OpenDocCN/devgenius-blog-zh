<html>
<head>
<title>Laravel Sail with HTTPS Swoole</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">拉勒维尔和HTTPS·斯沃勒一起航行</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-sail-with-https-swoole-ddab7f5303ec?source=collection_archive---------1-----------------------#2021-07-07">https://blog.devgenius.io/laravel-sail-with-https-swoole-ddab7f5303ec?source=collection_archive---------1-----------------------#2021-07-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b8dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi ki translated">大多数PHP应用程序都托管在<strong class="jm io"> LAMP </strong>或<strong class="jm io"> LEMP </strong>栈中，<strong class="jm io"> Nginx+PHP-FPM </strong>组合速度快，易于配置，现在很流行。然而，PHP的游戏规则改变者已经出现了。它为PHP带来了异步能力、真正的多线程和卓越的并发性能！</p><blockquote class="kr ks kt"><p id="55fe" class="jk jl ku jm b jn jo jp jq jr js jt ju kv jw jx jy kw ka kb kc kx ke kf kg kh ig bi translated"><a class="ae ky" href="https://medium.com/@victorgazotti/how-did-we-increased-our-php-app-performance-by-80-with-laravel-and-swoole-6b53d1092cab" rel="noopener">Victor Gazotti</a>&amp;<a class="ae ky" href="https://eldadfux.medium.com/moving-from-nginx-fpm-to-swoole-has-increased-our-php-api-performance-by-91-40f62e51a064" rel="noopener">Eldad a . Fux</a>用<strong class="jm io"> 80% ~ 91%的性能增益</strong>进行了测试！这听起来就像是打了类固醇的PHP！</p></blockquote><p id="d897" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">📝如果你是新人，请随意阅读<a class="ae ky" href="https://medium.com/p/30276265e588" rel="noopener">使用Laravel Sail</a>Kickstart你的Laravel网络应用。</p><p id="aeda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">官方<a class="ae ky" href="https://laravel.com/docs/8.x/octane" rel="noopener ugc nofollow" target="_blank"> Laravel文档</a>没有提供在HTTPS模式下设置<strong class="jm io"> Swoole的方法(<em class="ku">目前还不支持</em>)。</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/8c6cf2a999f5ac5f43223f633650e333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L3nUPUD-ph3NnKYNp0XeYw.png"/></div></div></figure><p id="4e31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下步骤将指导您使用Swoole服务器和HTTPS来设置辛烷🚀🚀🚀！</p><h1 id="6396" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">0.创建您的Laravel项目</h1><p id="e17f" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">创建一个空白项目，你可以在这里阅读教程<a class="ae ky" href="https://medium.com/p/30276265e588" rel="noopener"/>。</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="0118" class="mt lm in mp b gy mu mv l mw mx">cd ~/code</span><span id="75e5" class="mt lm in mp b gy my mv l mw mx">curl -s <a class="ae ky" href="https://laravel.build/test-project" rel="noopener ugc nofollow" target="_blank">https://laravel.build/test-project</a> | bash</span><span id="72bd" class="mt lm in mp b gy my mv l mw mx">cd test-project</span><span id="b025" class="mt lm in mp b gy my mv l mw mx">sail up -d</span></pre><h1 id="f386" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">1.安装Laravel辛烷</h1><p id="c325" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">安装Laravel辛烷</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="59de" class="mt lm in mp b gy mu mv l mw mx">sail composer require laravel/octane</span></pre><p id="d617" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="ceab" class="mt lm in mp b gy mu mv l mw mx">sail artisan octane:install</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mz"><img src="../Images/3ca556525ea179347220f3e5b8f5eb6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oi2qbFo6uEXSX3EXmabnDg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">选择<strong class="bd ln"> 1 </strong>进行旋转</figcaption></figure><p id="a36c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<code class="fe ne nf ng mp b">code .</code>命令打开VS代码。</p><h1 id="ef21" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">1.1辛烷配置文件</h1><p id="206a" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">✏️ <strong class="jm io">在<code class="fe ne nf ng mp b">config/octane.php</code>文件中追加/编辑</strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="fa58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为HTTPS协议设置必要的选项，SSL证书和密钥将由<code class="fe ne nf ng mp b">Dockerfile</code>中的命令生成。您可以通过更改<code class="fe ne nf ng mp b">enable-openssl</code>的值来打开/关闭HTTPS SSL功能，然后重新启动容器。</p><h1 id="67ef" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">2.设置环境文件</h1><p id="f259" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">✏️ <strong class="jm io">在<code class="fe ne nf ng mp b">.env</code>文件中追加</strong></p><p id="c015" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用Swoole作为Octane服务器。标志<code class="fe ne nf ng mp b">OCTANE_HTTPS</code>不是开启SSL功能，它只是关于URL前缀，你可以读<a class="ae ky" href="https://laravel.com/docs/8.x/octane#serving-your-application-via-https" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="5a43" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">3.保持Swoole运行</h1><p id="150f" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">我将使用Laravel Octane来替换PHP内置的HTTP服务器，我们需要始终保持Octane运行。</p><p id="543d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我需要通过发布配置文件来定制我们的Sail:</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="9813" class="mt lm in mp b gy mu mv l mw mx">sail artisan sail:publish</span></pre><p id="88a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">于是，✏️ <strong class="jm io">更新</strong> <code class="fe ne nf ng mp b">docker/8.0/supervisord.conf</code>(第8行)如<a class="ae ky" href="https://laravel.com/docs/8.x/octane#swoole" rel="noopener ugc nofollow" target="_blank">官方文档</a>所述。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="66ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Octane必须重启才能应用您的文件更改，所以我也打开了上面命令中的<code class="fe ne nf ng mp b">--watch</code>标志。然而，确保你也安装了<a class="ae ky" href="https://github.com/paulmillr/chokidar" rel="noopener ugc nofollow" target="_blank"> Chokidar </a>文件监视库，你可以在<a class="ae ky" href="https://laravel.com/docs/8.x/octane#watching-for-file-changes" rel="noopener ugc nofollow" target="_blank">官方文件</a>中读到更多。</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="3698" class="mt lm in mp b gy mu mv l mw mx">sail npm install --save-dev chokidar</span></pre><h1 id="75a9" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">4.Docker配置</h1><p id="d4bf" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated"><strong class="jm io"> A. </strong> ✏️ <strong class="jm io">追加<code class="fe ne nf ng mp b">docker-compose.yml</code>文件<code class="fe ne nf ng mp b">ports</code>段【第13行】的</strong></p><p id="afd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我需要将港口<code class="fe ne nf ng mp b">8000</code>映射到公共地图上</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7305" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了使上面的每个配置正常工作，我需要修改<code class="fe ne nf ng mp b">docker/8.0/Dockerfile</code>。</p><p id="6a05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> B. </strong> ✏️ <strong class="jm io">添加</strong>行用于具有适当文件夹权限的SSL自签名证书</p><blockquote class="kr ks kt"><p id="7dfc" class="jk jl ku jm b jn jo jp jq jr js jt ju kv jw jx jy kw ka kb kc kx ke kf kg kh ig bi translated">你必须更新<strong class="jm io">最新的sail版本</strong> ( &gt; v1.8.4)，其中包括<code class="fe ne nf ng mp b">apt</code>中的<br/> <code class="fe ne nf ng mp b"><em class="in">php8.0-swoole</em></code>包，但没有<code class="fe ne nf ng mp b">pecl</code></p></blockquote><p id="51fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">开船后用户创建(~第47行)——<br/><code class="fe ne nf ng mp b">RUN useradd -ms /bin/bash — no-user-group -g $WWWGROUP -u 1337 sail</code></p><p id="7054" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加这些行…</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="2d04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由此产生的<code class="fe ne nf ng mp b">Dockerfile</code>:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="ac84" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">5.重建容器</h1><p id="0b7f" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">用<code class="fe ne nf ng mp b">sail down</code>关闭你的容器，然后用</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="abb5" class="mt lm in mp b gy mu mv l mw mx">sail build --no-cache</span></pre><h1 id="0dab" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">6.测试</h1><p id="ac8d" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">您的Swoole应该已经启动并运行，您可以检查</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="e295" class="mt lm in mp b gy mu mv l mw mx">sail artisan octane:status</span></pre><p id="4f26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并且同样打开浏览器，输入<a class="ae ky" href="https://localhost:8000" rel="noopener ugc nofollow" target="_blank"> https://localhost:8000 </a>，应该会打开带有https的Laravel欢迎页面。</p><p id="8806" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还使用<strong class="jm io"> ab </strong>运行了测试，以了解性能提高了多少…</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="2cb1" class="mt lm in mp b gy mu mv l mw mx">ab -n 10000 -c 512 -H "Accept-Encoding: gzip, deflate" <a class="ae ky" href="https://localhost:8000/" rel="noopener ugc nofollow" target="_blank">https://localhost:8000/</a></span></pre><p id="4495" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果:</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="e70e" class="mt lm in mp b gy mu mv l mw mx">Server Software:        swoole-http-server<br/>Server Hostname:        localhost<br/>Server Port:            8000<br/>SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256<br/>Server Temp Key:        X25519 253 bits<br/>TLS Server Name:        localhost</span><span id="b35e" class="mt lm in mp b gy my mv l mw mx">Document Path:          /<br/>Document Length:        17503 bytes</span><span id="ba7b" class="mt lm in mp b gy my mv l mw mx">Concurrency Level:      512<br/>Time taken for tests:   97.184 seconds<br/>Complete requests:      10000<br/>Failed requests:        0<br/>Total transferred:      185930000 bytes<br/>HTML transferred:       175030000 bytes<br/>Requests per second:    102.90 [#/sec] (mean)<br/>Time per request:       4975.846 [ms] (mean)<br/>Time per request:       9.718 [ms] (mean, across all concurrent requests)<br/>Transfer rate:          1868.33 [Kbytes/sec] received</span><span id="d6ef" class="mt lm in mp b gy my mv l mw mx">Connection Times (ms)<br/>              min  mean[+/-sd] median   max<br/>Connect:        2   30  96.9      3     633<br/>Processing:    56 4794 2417.4   4598   19666<br/>Waiting:       17 4791 2418.0   4586   19665<br/>Total:         60 4824 2403.2   4613   19668</span><span id="aeb8" class="mt lm in mp b gy my mv l mw mx">Percentage of the requests served within a certain time (ms)<br/>  50%   4613<br/>  66%   5592<br/>  75%   6085<br/>  80%   6398<br/>  90%   7509<br/>  95%   8599<br/>  98%  10384<br/>  99%  12929<br/> 100%  19668 (longest request)</span></pre><p id="87fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为基线:默认的PHP内置服务器</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="a1bb" class="mt lm in mp b gy mu mv l mw mx">ab -n 10000 -c 512 -H "Accept-Encoding: gzip, deflate" <a class="ae ky" href="https://localhost:8000/" rel="noopener ugc nofollow" target="_blank">http://localhost/</a></span></pre><p id="168c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果:</p><pre class="la lb lc ld gt mo mp mq mr aw ms bi"><span id="e410" class="mt lm in mp b gy mu mv l mw mx">Server Software:<br/>Server Hostname:        localhost<br/>Server Port:            80</span><span id="8e3e" class="mt lm in mp b gy my mv l mw mx">Document Path:          /<br/>Document Length:        17490 bytes</span><span id="eaaf" class="mt lm in mp b gy my mv l mw mx">Concurrency Level:      512<br/>Time taken for tests:   198.809 seconds<br/>Complete requests:      10000<br/>Failed requests:        0<br/>Total transferred:      186310000 bytes<br/>HTML transferred:       174900000 bytes<br/>Requests per second:    50.30 [#/sec] (mean)<br/>Time per request:       10179.014 [ms] (mean)<br/>Time per request:       19.881 [ms] (mean, across all concurrent requests)<br/>Transfer rate:          915.17 [Kbytes/sec] received</span><span id="3a76" class="mt lm in mp b gy my mv l mw mx">Connection Times (ms)<br/>              min  mean[+/-sd] median   max<br/>Connect:        0    0   1.4      0       9<br/>Processing:    26 9913 1863.2  10041   13891<br/>Waiting:       15 9912 1863.2  10041   13890<br/>Total:         28 9913 1862.1  10041   13891</span><span id="beba" class="mt lm in mp b gy my mv l mw mx">Percentage of the requests served within a certain time (ms)<br/>  50%  10041<br/>  66%  10549<br/>  75%  11006<br/>  80%  11085<br/>  90%  11833<br/>  95%  12221<br/>  98%  12640<br/>  99%  13391<br/> 100%  13891 (longest request)</span></pre><h1 id="f4f2" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">总结结果</h1><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nj"><img src="../Images/75ace7a27d51d8354e4c389aeb2a59b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FSwYgGLm-2XAPG1F8tVhA.png"/></div></div></figure><p id="bd9c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以看到每秒请求数提高了100%以上🤩！总时间被占用，时间/请求也减半！这个Swoole只是采用默认设置，您可以根据您的要求进行微调，以获得更理想的结果！</p><h1 id="e484" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">视频演示:</h1><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="nk ni l"/></div></figure><h1 id="cffc" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">你准备好把你的网站放在网上，每月只需10美元就可以无限制地托管应用程序了吗？</h1><p id="654e" class="pw-post-body-paragraph jk jl in jm b jn mj jp jq jr mk jt ju jv ml jx jy jz mm kb kc kd mn kf kg kh ig bi translated">Cloudways 提供了大量的功能，让你可以轻松托管你的Laravel、WordPress或任何PHP网站，而不用担心网络安全的噩梦。</p><p id="1d56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您可以在BFCM 2022活动期间享受额外折扣！</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/c4aa55855082de96c53455aff24930d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/0*p55Wmd7swOzYyGty.jpg"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">链接:【www.cloudways.com/en/?id=66136 T2】</figcaption></figure><p id="376b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们开始尝试<strong class="jm io">云道</strong>！</p><p id="7bb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你喜欢我的文章，请鼓掌，关注并分享我的文章(或者你可以☕ <a class="ae ky" href="https://buy.stripe.com/7sI03C9S56Upcpi8ww" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a> ☕)。保重，再见！</p></div></div>    
</body>
</html>