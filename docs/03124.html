<html>
<head>
<title>Best Features of ES2018 — Promise finally and Template Restrictions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ES2018 的最佳功能—最终承诺和模板限制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-features-of-es2018-promise-finally-and-template-restrictions-5c898ddf5a6c?source=collection_archive---------5-----------------------#2020-10-02">https://blog.devgenius.io/best-features-of-es2018-promise-finally-and-template-restrictions-5c898ddf5a6c?source=collection_archive---------5-----------------------#2020-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/46725d6f3bcf6f34daac73aa6eeba36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4ITixjhPGXXO5dG4"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@lnalex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚历山大·莱昂</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e047" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自 2015 年以来，JavaScript 有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解 ES2018 的最佳特性。</p><h1 id="7101" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">Promise.prototype.finally()</code></h1><p id="7955" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">将<code class="fe lz ma mb mc b">finally</code>方法添加到<code class="fe lz ma mb mc b">Promise</code>实例中，以运行一些代码，而不管承诺的结果如何。</p><p id="eb11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="7d81" class="mq lc iq mc b gy mr ms l mt mu">promise<br/>  .then(result =&gt; {<br/>    //...<br/>  })<br/>  .catch(error =&gt; {<br/>    //...<br/>  })<br/>  .finally(() =&gt; {<br/>    //...<br/>  });</span></pre><p id="3545" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当<code class="fe lz ma mb mc b">promise</code>完成时，运行<code class="fe lz ma mb mc b">then</code>回调。</p><p id="5064" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">catch</code>回调在<code class="fe lz ma mb mc b">promise</code>被拒绝时运行。</p><p id="1103" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">finally</code>无论结果如何，都会进行回调。</p><p id="ce70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="475d" class="mq lc iq mc b gy mr ms l mt mu">promise<br/>  .finally(() =&gt; {<br/>    //...<br/>  });</span></pre><p id="3fc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与以下内容相同:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="5b8b" class="mq lc iq mc b gy mr ms l mt mu">promise<br/>  .then(<br/>    result =&gt; {<br/>      //...<br/>      return result;<br/>    },<br/>    error =&gt; {<br/>      //...<br/>      throw error;<br/>    }<br/>  );</span></pre><p id="4a06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最常见的用例类似于同步<code class="fe lz ma mb mc b">finally</code>子句。</p><p id="ae07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们在使用完一个资源后进行清理。</p><p id="f437" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">finally()</code>同<code class="fe lz ma mb mc b">finally {}</code>是同步码。</p><p id="2170" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">try</code>条款对应承诺的<code class="fe lz ma mb mc b">then</code>回拨。</p><p id="8954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">catch</code>就像<code class="fe lz ma mb mc b">.catch</code>在承诺。</p><p id="9f11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">finally</code>就像<code class="fe lz ma mb mc b">.finally</code>在承诺。</p><h1 id="7314" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模板文字更改</h1><p id="3d9a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">标签函数如何与转义序列一起工作。</p><p id="5df1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="62c2" class="mq lc iq mc b gy mr ms l mt mu">const raw = String.raw`\u{50}`</span></pre><p id="432e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到原始形式的<code class="fe lz ma mb mc b">'\u{50}'</code>。</p><p id="f139" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们得到:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="35f0" class="mq lc iq mc b gy mr ms l mt mu">function tag(str) {<br/>  console.log(str);<br/>}</span><span id="5436" class="mq lc iq mc b gy mv ms l mt mu">tag `\u{50}`</span></pre><p id="9815" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为<code class="fe lz ma mb mc b">str</code>的值:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="ad70" class="mq lc iq mc b gy mr ms l mt mu">["P", raw: Array(1)]</span></pre><p id="005c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">熟的形式是<code class="fe lz ma mb mc b">'P'</code>，生的版本是我们有的。</p><p id="8ebe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并不是所有的文本带有反斜杠都是非法的。</p><p id="ae39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以写下这样的话:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="4e2a" class="mq lc iq mc b gy mr ms l mt mu">`\unicode<!-- -->`</span></pre><p id="d703" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">行不通。</p><p id="c2b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ES2018 取消了语法限制，因此我们可以在模板文字中输入这些类型的字符组合。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/c93247e453602c571d551c4d183424b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*etSU9zjK_C9ETcQ_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="ad54" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1ad3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在 ES2018 中，模板文字语法现在比以前限制更少。</p><p id="dc50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些转义序列比较松散。</p><p id="26ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，<code class="fe lz ma mb mc b">finally</code>方法被添加到<code class="fe lz ma mb mc b">Promise</code>实例中，这样我们就可以运行代码，而不管承诺的结果如何。</p></div></div>    
</body>
</html>