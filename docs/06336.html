<html>
<head>
<title>Azure AD B2C for .NET 4.8: Old Dogs Can Learn New Tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure广告B2C。NET 4.8:老狗可以学新把戏</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/azure-ad-b2c-for-net-4-8-old-dogs-can-learn-new-tricks-3b8f8db623a9?source=collection_archive---------7-----------------------#2021-12-31">https://blog.devgenius.io/azure-ad-b2c-for-net-4-8-old-dogs-can-learn-new-tricks-3b8f8db623a9?source=collection_archive---------7-----------------------#2021-12-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a4b04bce4e39875f07e3af3d65d2cc3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqAW4JNPhucwQVs-xFjxAg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来自微软技术文档的照片</figcaption></figure><p id="8c17" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我的一个项目目前正在使用Azure AD进行身份验证。它的工作是为注册用户提供访问权限，并将不良行为者排除在系统之外。然而，它带来了一个非常重要的小限制。</p><p id="c7dc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Azure AD就像某种联合用户账户系统。您可以在其中创建一个帐户。但它只存在于你的Azure目录中。无论你创建什么账号，不管权限什么的，永远是一个<strong class="kb io"> &lt;目录名&gt; .onmicrosoft.com </strong>账号(如testuser @ azure directory . on Microsoft . com)。在你尝试接纳Azure生态系统之外的人之前，这并不是什么大问题。</p><p id="0d09" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有些时候，您希望容纳更多的用户，但是这些用户不愿意在您的目录下创建一个帐户。一些用户已经是不同联合帐户系统的一部分。一些用户只是使用谷歌、亚马逊或微软的通用账户，还有一些用户可能只是想使用他们的社交媒体账户登录一切(这不是我建议的，但不同的人有不同的方式)。</p><p id="847b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你和我们的情况一样，那么你可能应该考虑转向Azure AD B2C。</p><p id="ef14" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这一点上，我仍在试图理解整个Azure生态系统，我还有很多要学的。所以我继续寻找关于它如何工作以及如何实现的文章。网上有很多资料讨论它是如何工作的。然而，这些材料中的大部分(如果不是全部的话)是用。网芯。我做的项目还在用。净4.8。我知道B2C的实现很有可能是专门为。NET Core和更高版本，因为我找不到任何关于它的文章。净4.8。但是我知道我不是唯一一个想到这么做的人，可能有人已经做了一些事情。所以我继续挖掘。</p><p id="ce8e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您瞧，实际上在。NET 4.8中有一个B2C实现。<strong class="kb io">你可以在这里找到:</strong> <a class="ae kx" href="https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> Azure AD B2C:从ASP.NET Web App</strong></a>调用ASP.NET Web API</p><p id="067f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我最初认为从Azure AD到Azure AD B2C的迁移会非常困难，因为我正在使用旧版本的框架来实现新功能。但这并没有我想象的那么难。</p><p id="8baa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">乍看之下，Azure AD和Azure AD B2C中使用的约定并没有太大差别。他们使用同一个库<strong class="kb io">微软。Owin.Security.OpenIdConnect </strong>和接口<strong class="kb io"> IAppBuilder </strong>，这意味着类、方法和接口是相同的，这意味着修改应该是最小的。</p><p id="1f97" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，仅仅因为库是相同的，接口是相同的，这并不意味着声明也是相同的。</p><p id="75ad" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有一些特定的部分是相同的，比如<strong class="kb io"> ClientID </strong>、<strong class="kb io"> RedirectUri </strong>和<strong class="kb io">postlogutredirecturi</strong>。但是有些字段对于我们的实现来说是新的，比如<strong class="kb io">元数据地址</strong>。它似乎是为给定租户和用户流策略组合提供OpenID配置的地址。</p><p id="7666" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">元数据地址应该是这样的:https://<directory>. B2C login . com/TFP/<tenant>/<userflowpolicy>/v 2.0/。众所周知的/openid配置</userflowpolicy></tenant></directory></p><p id="1d1c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">租户</strong>是你的B2C实例的域名。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/d81ae8660997da5613348199cff7479d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cVVlld2WH6-Q59IQ.png"/></div></div></figure><p id="ece9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">用户流策略</strong>是您将在Azure Portal中B2C配置的用户流部分定义的策略。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ld"><img src="../Images/cb76131fb34c6963a88d4bd3d1960504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GtsFlLSo6sVBeLIL.png"/></div></div></figure><p id="df3a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">用户流</strong>基本上是预定义类型的流程流，开发人员可以使用它们来使用户的帐户管理变得简单和安全。这就像是制作你自己的账户管理页面，除了你让Azure AD B2C为你做。示例用户流包括注册和登录(SUSI)、简档编辑和密码重置。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi le"><img src="../Images/730f0c39cece2dcb2ceb382717523bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tKeV1TicSlaVMqSZ.png"/></div></div></figure><p id="dd3f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里有很多东西要讨论。但是本文只是为了说明您不需要最新版本的。NET来实现你自己的B2C认证。已经有很多关于这个主题的视频被制作出来了，尽管是在。网芯。但他们很好地解释了如何做到这一点，从建立自己的目录到创建自己的用户流。我推荐一个来自WintellectNOW的视频。</p><p id="41d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">【https://www.youtube.com/watch?v=RNfJW8Fv10U】</p><p id="c6d1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">至于web.config，这里有一个快速参考:</p><ol class=""><li id="0c8c" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw lk ll lm ln bi translated"><strong class="kb io">租户</strong>—B2C域名。</li><li id="890e" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io"> TenantID </strong> —目录ID。你可以在应用程序注册中或者当你试图在Azure门户中切换目录时找到它。</li><li id="d143" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io"> ClientID </strong> —应用程序ID。这也可以在应用程序注册中找到</li><li id="27c8" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated">ClientSecret  —这是一个计算机生成的代码，有助于保证你的B2C实现的安全性。在应用程序注册中，您将在管理部分看到证书和密码。您可以在那里创建密钥。</li><li id="2fae" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io"> AadInstance </strong> —这是具有正确租户和用户流策略的B2C登录实例的URL。应该是这样的:https:// &lt;目录&gt; .b2clogin.com/tfp/ &lt;租户&gt; / &lt;用户流策略&gt;</li><li id="bc8d" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io"> RedirectUri </strong> —经过身份验证的用户的重定向页面的URL</li><li id="7184" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io">signussigninpolicyid</strong>、<strong class="kb io"> EditProfilePolicyId </strong>和<strong class="kb io">resetpasswordpolicid</strong>——这些分别是注册/登录、编辑个人资料和重置密码的用户流策略</li><li id="b914" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated"><strong class="kb io"> ApiIdentifier </strong> —这是定义请求范围所必需的。</li></ol></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="cdc6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢你阅读这篇文章。</p><p id="d346" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你觉得这篇文章有趣，点击👏按钮，并分享这篇文章。</p><p id="1fe6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我的文章发布在<a class="ae kx" href="https://medium.com/@bien.baldonado" rel="noopener"> <strong class="kb io">媒体</strong> </a> <strong class="kb io"> </strong>和我的网站<a class="ae kx" href="https://www.thebeet21.com" rel="noopener ugc nofollow" target="_blank"><strong class="kb io">www.thebeet21.com</strong></a></p></div></div>    
</body>
</html>