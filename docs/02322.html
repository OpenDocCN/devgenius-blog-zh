<html>
<head>
<title>3 Ways to Manage your Django Environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理 Django 环境的 3 种方法</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/3-ways-to-manage-your-django-environment-5cf7cef8fd03?source=collection_archive---------12-----------------------#2020-07-28">https://blog.devgenius.io/3-ways-to-manage-your-django-environment-5cf7cef8fd03?source=collection_archive---------12-----------------------#2020-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9985e8132fb802c8dd7867929c97f7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P0YyIMDvqCLoUfQh"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在</a><a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="35b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我开发 Django web 应用已经有一段时间了。对于不同版本的 python 及其库，我们需要不同的环境来管理它们。然而，设置环境可能是一件令人头疼的事情。</p><p id="4e55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天我将介绍 3 种方法来解释我如何管理我的 Django 环境。</p><h1 id="1a11" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">虚拟</h1><p id="8bd2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">python 项目可以有几种环境。每个都有自己的配置(env 变量)和包。我们可以把每个环境看作一个与外界(其他环境)隔绝的气泡世界。</p><p id="be09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 Python3 中，它有自己的虚拟环境，名为 virtualenv。基本上，我们可以通过键入以下命令来调用环境:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ebab" class="mn lc iq mj b gy mo mp l mq mr">python3 -m venv env<br/>source env/bin/activate</span></pre><p id="ff1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个特定的环境中，您可以安装/更新软件包，添加/删除环境变量等。您必须始终确保项目运行在相同的环境中，以访问包和变量。</p><p id="0c03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不使用 python 环境也没问题。然后，当您启动 python 项目时，它将自动使用系统的环境<code class="fe ms mt mu mj b">/usr/local/bin</code>。显然这不是一个好的选择，因为你的其他应用程序很容易影响系统环境，你可能会出现一些奇怪的错误。</p><h1 id="4fd6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Pipenv</h1><p id="cd52" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">经过一些研究，我发现了 Django 开发人员常用的工具:</p><div class="mv mw gp gr mx my"><a href="https://github.com/pypa/pipenv" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd ir gy z fp nd fr fs ne fu fw ip bi translated">pypa/pipenv</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">~ pyup . io 的依赖性扫描~ ] Pipenv 是一个工具，旨在带来所有包装世界的最佳(bundler…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">github.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jw my"/></div></div></a></div><p id="db54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Pipenv 自动为您的项目创建和管理一个 virtualenv，并在您安装/卸载软件包时从您的<code class="fe ms mt mu mj b">Pipfile</code>中添加/删除软件包。</p><p id="a6b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 Pipenv，您不必担心 pip 不与 python 环境绑定，因为该工具会自动创建和绑定环境，而且</p><p id="3395" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我总是使用下面的命令将包信息写到 requirement.txt 中，以便持续集成。有时它只是写入一些不必要的系统包。这有时会有问题。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0d1a" class="mn lc iq mj b gy mo mp l mq mr">pip freeze &gt; requirements.txt</span></pre><p id="3d71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Pipenv 使用<code class="fe ms mt mu mj b">Pipfile</code>和<code class="fe ms mt mu mj b">Pipfile.lock</code>将抽象依赖声明从最后测试的组合中分离出来。您可以通过将 Pipfile 上传到 CI 系统来关注它，或者如果您坚持使用 requirements.txt，则运行下面的命令。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3f68" class="mn lc iq mj b gy mo mp l mq mr">pipenv run pip freeze &gt; requirements.txt</span></pre><h1 id="034f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">码头工人</h1><p id="f6cf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Docker 是管理 Django 环境的一个很好的选择，因为 Docker 本身是一个完全不同的环境和文件系统，包含了所有的库。</p><p id="8863" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着开发变得越来越复杂，我们总是有几个不同环境的团队，如 QA、生产、测试和开发等。每个环境都有自己的依赖项和配置。我们传过去的开发环境，不代表我们可以传过去的生产环境。</p><p id="e511" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Docker 作为一个容器是一致的。它允许您以相同的方式打包，而不管您的操作系统是什么。它允许您分发软件，而不管设置如何。它允许您在运行软件的任何地方以同样的方式测试软件。</p><p id="72a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我附上了我的 Django 项目中的 docker 文件和 docker-compose 文件配置:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="947c" class="mn lc iq mj b gy mo mp l mq mr">// Dockerfile</span><span id="601b" class="mn lc iq mj b gy nn mp l mq mr">FROM python:3.7-alpine<br/>MAINTAINER QI LI</span><span id="63b5" class="mn lc iq mj b gy nn mp l mq mr">ENV <em class="no">PYTHONUNBUFFERED </em>1</span><span id="e037" class="mn lc iq mj b gy nn mp l mq mr">COPY ./requirements.txt /requirements.txt<br/>RUN apk add --update --no-cache postgresql-client<br/>RUN apk add --update --no-cache --virtual .tmp-build-deps \<br/>      gcc libc-dev linux-headers postgresql-dev<br/>RUN pip install -r /requirements.txt<br/>RUN apk del .tmp-build-deps</span><span id="ce9b" class="mn lc iq mj b gy nn mp l mq mr">RUN mkdir /app<br/>WORKDIR /app<br/>COPY ./app /app</span><span id="f168" class="mn lc iq mj b gy nn mp l mq mr">RUN adduser -D user<br/>USER user</span><span id="bac4" class="mn lc iq mj b gy nn mp l mq mr">// docker-compose.yml</span><span id="3802" class="mn lc iq mj b gy nn mp l mq mr">version: "3"</span><span id="8c86" class="mn lc iq mj b gy nn mp l mq mr">services:<br/>  app:<br/>    build:<br/>      context: .<br/>    ports:<br/>       - "8000:8000"<br/>    volumes:<br/>       - ./app:/app<br/>    command: &gt;<br/>       sh -c "python manage.py wait_for_db &amp;&amp;<br/>              python manage.py migrate &amp;&amp;<br/>              python manage.py runserver 0.0.0.0:8000"<br/>    environment:<br/>      - DB_Host=db<br/>      - DB_NAME=app<br/>      - DB_USER=postgres<br/>      - DB_PASS=supersecretpassword<br/>    depends_on:<br/>      - db<br/>  db:<br/>    image: postgres:10-alpine<br/>    environment:<br/>      - POSTGRES_DB=app<br/>      - POSTGRES_USER=postgres<br/>      - POSTGRES_PASSWORD=supersecretpassword</span></pre><p id="d41d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Dockerfile 通过一个或多个配置映像的构建命令来定义应用程序的映像内容。<code class="fe ms mt mu mj b">docker-compose.yml</code>文件描述了制作应用程序的服务。这些服务是网络服务器和数据库。</p><p id="8ef2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，我们添加了 python:3.7-alpine image。通过添加新的<code class="fe ms mt mu mj b">app</code>目录来修改父映像。通过安装在<code class="fe ms mt mu mj b">requirements.txt</code>文件中定义的 Python 需求，父映像被进一步修改。</p><p id="505e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有关更多解释，请参考下面的文章:</p><div class="mv mw gp gr mx my"><a href="https://docs.docker.com/compose/django/" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd ir gy z fp nd fr fs ne fu fw ip bi translated">快速入门:作曲和 Django</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">预计阅读时间:7 分钟本快速入门指南演示了如何使用 Docker Compose 来设置和运行一个</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">docs.docker.com</p></div></div><div class="nh l"><div class="np l nj nk nl nh nm jw my"/></div></div></a></div><h1 id="4282" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论:</h1><p id="d575" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当我开发 Django 应用程序的时候。我实际上是一个接一个地逐步更新这三种方式。现在我和崔维斯. CI 的 Docker 在一起。总的来说，这都是关于我们如何有效地管理 python 环境。</p><p id="869c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读。如果你有兴趣阅读我的其他文章，欢迎查看我的个人资料。你也可以通过媒体或邮件联系我。</p></div></div>    
</body>
</html>