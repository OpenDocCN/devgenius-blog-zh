<html>
<head>
<title>Listening to Wikipedia (Python tutorial)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">收听维基百科(Python 教程)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/listening-to-wikipedia-python-tutorial-8c65bb3b449a?source=collection_archive---------8-----------------------#2021-12-22">https://blog.devgenius.io/listening-to-wikipedia-python-tutorial-8c65bb3b449a?source=collection_archive---------8-----------------------#2021-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f7f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你宁愿听维基百科而不是阅读它们，并且你已经安装了 Python，那么你就来对地方了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/cef254e0faaaba16a0e8a5a22a5b4063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ls8ePk71WOUYV7zUKJOLRw.png"/></div></div></figure><p id="cc35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我发现如何在 Python 中执行文本到语音转换时，我想知道如何将它应用到一个有用的研究案例中。然后，我想起我经常访问维基百科页面，这些页面涉及我感兴趣的主题，但包含了许多我不想完全阅读的文本。我宁愿一边听那些页面的内容，一边做别的事情。</p><p id="7f66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我决定使用 Python 将维基百科页面转换成音频文件。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h2 id="c8d6" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">导入包</h2><p id="33c0" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">让我们从导入对这个任务有用的包开始。我将使用的库是用于抓取部分的<strong class="jp ir"> bs4 </strong>和<strong class="jp ir"> requests </strong>，用于正则表达式的<strong class="jp ir"> re </strong>，用于文本到语音部分的<strong class="jp ir"> pyttsx3 </strong>。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="dcab" class="lf lg iq me b gy mi mj l mk ml"><strong class="me ir">from </strong>bs4 <strong class="me ir">import </strong>BeautifulSoup<br/><strong class="me ir">import</strong> requests<br/><strong class="me ir">import</strong> re<br/><strong class="me ir">import </strong>pyttsx3 <strong class="me ir">as</strong> tts</span></pre><h2 id="fc3e" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">擦</h2><p id="6f4e" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">对于抓取部分，我们只需要定义一个 URL，从相应的网页中检索文本。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="205d" class="lf lg iq me b gy mi mj l mk ml">url = "https://en.wikipedia.org/wiki/Wikipedia" <strong class="me ir"><em class="kl">#the web page you want to scrape</em></strong></span><span id="6ea9" class="lf lg iq me b gy mm mj l mk ml"><strong class="me ir"><em class="kl"># Collecting data from the web page</em></strong><br/>r = requests.get(url)<br/>data = r.text<br/>soup = BeautifulSoup(data, "lxml")</span></pre><p id="88fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们希望只保留文本。因此，我们只寻找段落元素。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="3156" class="lf lg iq me b gy mi mj l mk ml">paragraphs = soup.findAll("p")</span></pre><p id="8071" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您打印变量<strong class="jp ir">段落</strong>，您将看到一个列表，其中包含使用变量<strong class="jp ir"> URL </strong>访问的网页中的所有段落元素。</p><h2 id="b474" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">处理数据</h2><p id="15f9" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">当我们将文本转换为语音时，我们需要处理<strong class="jp ir">段落</strong>的内容，以获得可理解的文本。下面的循环让我们将段落元素转换成它们包含的文本。这样，像“&lt; p &gt; … &lt; /p &gt;”这样的标签就从文本中删除了，剩下的内容就是任何人点击那个链接都能在维基百科页面<a class="ae mn" href="https://en.wikipedia.org/wiki/Wikipedia" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Wikipedia</a>上看到的内容。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="469f" class="lf lg iq me b gy mi mj l mk ml">for i in range(len(paragraphs)):<br/>    paragraphs[i] = paragraphs[i].get_text()</span></pre><p id="cd9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你现在看一下段落的内容，你应该会看到与抓取的网页的原始内容非常相似的字符串。然而，当阅读该内容时，引用(以方括号中的数字表示)将被阅读，并使音频不太容易理解。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mo"><img src="../Images/4ca3e3c453337a463bde4cc0e2560171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0XdF5vVPq5IJ3sdqH3wfQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">方括号中的数字</figcaption></figure><p id="a0c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过应用下面给出的进一步处理步骤来删除它们:</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="942a" class="lf lg iq me b gy mi mj l mk ml">pattern = r"\[[^\]]*\]"<br/>for i in range(len(paragraphs)):<br/>    paragraphs[i] = re.sub(pattern, "", paragraphs[i])</span></pre><p id="aa65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们把所有的段落放在一个字符串中，然后我们就可以把文本转换成音频文件了。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="bba6" class="lf lg iq me b gy mi mj l mk ml">text = "".join(paragraphs)</span></pre><h2 id="66f3" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">文本到语音转换</h2><p id="af54" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">作为使用<strong class="jp ir"> pyttsx3 </strong>的第一步，我们必须初始化一个引擎。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="fce3" class="lf lg iq me b gy mi mj l mk ml">engine = tts.init()</span></pre><p id="d40c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，在进行文本到语音转换之前，可能需要检查引擎语音的语言，因为您不希望用英语语音朗读法语文本。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="3af5" class="lf lg iq me b gy mi mj l mk ml"><strong class="me ir"><em class="kl"># Checking the language of the different available voices</em></strong><br/>voices = engine.getProperty("voices")<br/>for voice in voices:<br/>    print(voice)</span></pre><p id="a176" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面的块，您可以显示关于引擎拥有的不同声音的信息，并查看是否有任何声音的语言与您想要转换的文本的语言相匹配。举个例子，我想拥有一个英国人的声音。在我的电脑上，语音列表中索引为 1 的语音是英语语音，所以我决定使用它。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="41d0" class="lf lg iq me b gy mi mj l mk ml">engine.setProperty("voice", voices[1].id) <strong class="me ir"><em class="kl">#replace 1 with an index whose corresponding voice is in the language you wish</em></strong></span></pre><p id="a0d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你设置好引擎的声音，你可以简单地运行下面两行来保存维基百科页面到一个. mp3 文件。</p><pre class="kn ko kp kq gt md me mf mg aw mh bi"><span id="1932" class="lf lg iq me b gy mi mj l mk ml">engine.save_to_file(text, "wikipedia.mp3")<br/>engine.runAndWait()</span></pre><p id="d2ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="2860" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>运行这些步骤后，你可能会得到一个非常大的音频文件。我建议压缩输出文件。我个人使用了 https://www.onlineconverter.com/compress-mp3<a class="ae mn" href="https://www.onlineconverter.com/compress-mp3" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a>提供的在线转换器，我的文件大小被除以 10，尽管音频质量仍然非常好。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="c7fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> GitHub : </strong>此外，在这里你可以找到本文给出的代码，总结在一个笔记本里:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/jmpion/listening-to-wikipedia" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">GitHub-jmp ion/收听维基百科</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kw mw"/></div></div></a></div></div></div>    
</body>
</html>