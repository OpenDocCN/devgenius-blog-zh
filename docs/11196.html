<html>
<head>
<title>How to Self-host Supabase: A complete guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自主主持 Supabase:完全指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-self-host-supabase-a-complete-guide-f4c68f449920?source=collection_archive---------6-----------------------#2022-12-24">https://blog.devgenius.io/how-to-self-host-supabase-a-complete-guide-f4c68f449920?source=collection_archive---------6-----------------------#2022-12-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="5b8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本指南中，我将解释如何自主机 Supabase。包括如何购买和保护虚拟专用服务器(VPS)，安装和设置 Supabase，使用 Nginx 设置反向代理，以及获取安全套接字层(SSL)证书以接受 HTTPS 流量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/658785a8d2618b275743cb452516f0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*u56dSCz606WTT7dOEiX7iA.png"/></div></figure><p id="42cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我第一次写补充指南，所以如果有什么不清楚的地方，或者你有什么反馈，请在下面的评论中留下。</p><h1 id="d623" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">你将取得什么成就</h1><p id="fb2a" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">如果您遵循这些步骤，您将最终拥有一个托管在 VPS 上的受密码保护的 Supabase 服务器，VPS 是一个反向代理，它使用 SSL 证书将流量从域名重定向到 Supabase 后端的相应端点。</p><p id="d3d3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要继续，您需要:</p><ol class=""><li id="1172" class="lt lu in jm b jn jo jr js jv lv jz lw kd lx kh ly lz ma mb bi translated">一个域名，免费或付费，你可以设置一个或 CNAME 记录</li><li id="883a" class="lt lu in jm b jn mc jr md jv me jz mf kd mg kh ly lz ma mb bi translated">一个运行 Ubuntu 20+的 VPS，如果你还没有，这个公会也会推出一个</li></ol><h1 id="b5d1" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">购买 VPS 并设置</h1><p id="d1bf" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">显然，要自己托管一个 Supabase 后端，您需要一个 VPS。如果你已经有了一个，你可以转到关于保护 VPS 的部分，看看你还能做些什么来保护你的 VPS 。如果没有，下面的指南就来说说如何选购一台。</p><h1 id="e52d" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">购买 VPS</h1><p id="2fec" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">我将使用 OxideHost VPS，因为它们相对便宜。我一直在使用它们，它们相当可靠。对于那些感兴趣的人，这是我的<a class="ae mh" href="https://billing.oxide.host/aff.php?aff=166" rel="noopener ugc nofollow" target="_blank">附属链接</a>。</p><p id="c661" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在选择了 VPS 并购买了安装了 Ubuntu 22.04 的 VPS 之后，会有一封电子邮件告诉我如何连接到我的 VPS。最重要的部分是主机名、IP 和默认密码。</p><h1 id="dc2a" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">连接到它</h1><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="2b29" class="mn kr in mj b be mo mp l mq mr">ssh {username}@{ip-address}</span></pre><p id="e586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要连接到我刚刚购买的 VPS，最简单的方法就是在命令行中使用<code class="fe ms mt mu mj b">ssh</code>命令。但是，使用这种方法，我们每次都必须键入这个命令并输入密码。更好的方法是使用 SSH 客户端，比如免费的 PuTTY T8。我将使用 Termius，因为它有一个很好的界面，对学生来说是免费的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/c335e21b662fe7c21c613e9fb8bef093.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/0*OgWSt-SvoY8ffmPZ.png"/></div></figure><p id="2d07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将创建一个新的主机，输入电子邮件中给定的主机名，用户名默认为<code class="fe ms mt mu mj b">root</code>，密码也给了我。它会问你一个关于你想连接到它的问题，点击<code class="fe ms mt mu mj b">yes</code>。然后我将第一次连接到 VPS。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/219d9eb46647590e586de4764df47c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YNt1vYkWiJXky79g"/></div></div></figure><h1 id="79db" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">保护 VPS</h1><p id="bfe4" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在我们已经连接到我们的 VPS，我们想确保我们是唯一可以访问它的人，所以我们需要采取措施来保护它。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="5a2e" class="mn kr in mj b be mo mp l mq mr">apt update apt dist-upgrade</span></pre><p id="d12c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一个任务是更新它，因为更新的软件通常有其安全漏洞补丁。这也升级了 Linux 发行版。命令提示符会问你一些问题，你可以输入<code class="fe ms mt mu mj b">y</code>然后按回车键来回答。而如果是多选，可以按<code class="fe ms mt mu mj b">tab</code>左右导航，按回车键确认选择。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/1882a07c8c6fc2683a89cffb337d6afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AHNFZV2JldoKFBZv"/></div></div></figure><h2 id="75ca" class="nb kr in bd ks nc nd dn kw ne nf dp la jv ng nh le jz ni nj li kd nk nl lm nm bi translated">添加另一个用户</h2><p id="becf" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在你获得了 VPS，黑客们也想得到它。互联网上有大量的机器人破解随机 VPS 的密码，他们通常试图以 root 身份登录，因为这是默认配置。因此，我们将添加一个新用户，将 root 权限传递给它，并禁用 root 登录，这样那些坏机器人就无法登录到我们的 VPS。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="9b69" class="mn kr in mj b be mo mp l mq mr">adduser {username} usermod -aG sudo {username}</span></pre><p id="deee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户名中不能有空格，所以可以使用下划线，如<code class="fe ms mt mu mj b">learn_supabase</code>或<code class="fe ms mt mu mj b">learnsupabase</code>。然后它会问我们一些问题，如果我们不想回答，我们可以输入空白。但是我们需要填写一个<strong class="jm io">安全密码</strong>，我建议使用一些<a class="ae mh" href="https://www.dashlane.com/features/password-generator" rel="noopener ugc nofollow" target="_blank">安全密码生成器</a>输入一个随机生成的密码，这样任何人都无法猜到。然后我们可以给用户 Sudo 特权。并且<strong class="jm io">通过创建新的主机并连接它，尝试使用新的用户名和密码</strong>登录。</p><h2 id="1b29" class="nb kr in bd ks nc nd dn kw ne nf dp la jv ng nh le jz ni nj li kd nk nl lm nm bi translated">禁用 root 登录</h2><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="4d0a" class="mn kr in mj b be mo mp l mq mr">nano /etc/ssh/sshd_config</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/6ea87da3a10afcc0d227889d47924ac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QAAV8NIUCqNcFsbt"/></div></div></figure><p id="697f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们需要把<code class="fe ms mt mu mj b">Port</code>改成一个随机数，让它更难猜，这个数必须小于 65535。而且我们还把链接<code class="fe ms mt mu mj b">PermitRootLogin</code>改成了<code class="fe ms mt mu mj b">no</code>，这样我们就不能再以 root 身份登录了。</p><p id="1b4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">做出更改后，我们可以用<code class="fe ms mt mu mj b">ctrl + o</code>写出更改，用<code class="fe ms mt mu mj b">ctrl + x</code>退出 nano。然后我们执行下面的命令来重启<code class="fe ms mt mu mj b">sshd</code>服务，这样新的配置就会生效。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="3ee7" class="mn kr in mj b be mo mp l mq mr">systemctl restart sshd</span></pre><h1 id="c31f" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装超级数据库</h1><h1 id="d48f" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装 docker</h1><p id="387b" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">我们为此需要 docker，关于如何安装 docker 的教程可以在这里找到<a class="ae mh" href="https://www.linode.com/docs/guides/installing-and-using-docker-on-ubuntu-and-debian/" rel="noopener ugc nofollow" target="_blank"/>。在本教程中，我将总结我们需要运行什么命令。这个命令假设你使用的是 Ubuntu，如果你使用的是其他发行版，请参考上面的教程链接。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="e585" class="mn kr in mj b be mo mp l mq mr">sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null sudo apt update sudo apt install docker-ce docker-ce-cli containerd.io sudo apt install docker-compose-plugin</span></pre><p id="63b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们还需要使用户能够使用 docker。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="25b4" class="mn kr in mj b be mo mp l mq mr">sudo usermod -aG docker {username}</span></pre><h1 id="09e1" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">克隆超级碱基</h1><p id="b931" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">然后我们想从 Github 克隆 Supabase。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="6a73" class="mn kr in mj b be mo mp l mq mr">git clone --depth 1 https://github.com/supabase/supabase</span></pre><h1 id="d151" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">设置超级秘密</h1><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="9f83" class="mn kr in mj b be mo mp l mq mr">cd supabase/docker/ cp .env.example .env</span></pre><p id="d11c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们进入 docker 目录，复制环境变量的文件。</p><h1 id="56da" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">生成密码</h1><p id="11be" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">我们打开<code class="fe ms mt mu mj b">.env</code>文件，会看到很多设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/72f970cf5f648b21750a53b9c6f530c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*10QvijYBaBa0P3VH"/></div></div></figure><p id="6b79" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们想为上述字段设置密码。对于<code class="fe ms mt mu mj b">POSTGRES_PASSWORD</code>，可以使用随机生成的密码。对于 JWT 秘密，我们必须使用<a class="ae mh" href="https://supabase.com/docs/guides/self-hosting#api-keys" rel="noopener ugc nofollow" target="_blank">自定义密钥生成器</a>。您可以复制 JWT 的秘密并将其粘贴到文件中，然后我们可以选择<code class="fe ms mt mu mj b">ANON_KEY</code>，点击生成，将其复制到<code class="fe ms mt mu mj b">ANON_KEY</code>字段，然后是<code class="fe ms mt mu mj b">SERVICE_KEY</code>字段。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nn"><img src="../Images/bff5d65ef16628754ea082a5365568f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5CBpYaQlAus_LBy8"/></div></div></figure><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="c847" class="mn kr in mj b be mo mp l mq mr">nano volumes/api/kong.yml</span></pre><p id="9443" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们也将相同的键复制到 kong 配置中，粘贴新的<code class="fe ms mt mu mj b">anon</code>键和<code class="fe ms mt mu mj b">service</code>键。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/5e5ab6fbaf0ff4997bca3f9bb060e50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z1Gi1IdEtPw7oI5Q"/></div></div></figure><h1 id="3cfa" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">启动 docker</h1><p id="e299" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在我们打开一个新的屏幕，并给它命名，以便我们以后可以连接到它</p><p id="ca8e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里你会看到介绍的画面，点击<code class="fe ms mt mu mj b">enter</code>。然后我们可以做<code class="fe ms mt mu mj b">ctrl + a</code>然后<code class="fe ms mt mu mj b">ctrl + d</code>从屏幕上断开。在控制台中，你会看到你的屏幕号<code class="fe ms mt mu mj b">[detached from 3775963.pts-0.hostname]</code>，<code class="fe ms mt mu mj b">3775963</code>号就是屏幕号。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="aa21" class="mn kr in mj b be mo mp l mq mr">screen -S {screen_number} -X sessionname supabase screen -r supabase</span></pre><p id="5f87" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经重新连接到屏幕<code class="fe ms mt mu mj b">supabase</code>，当我们从它断开时，我们使用<code class="fe ms mt mu mj b">ctrl + a</code>然后使用<code class="fe ms mt mu mj b">ctrl + d</code>。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="7a74" class="mn kr in mj b be mo mp l mq mr">cd supabase/docker/ docker compose up</span></pre><p id="0f02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在 supabase docker 启动了，它会下载一堆东西，你可以在 3000 端口连接到你的域。</p><h1 id="35ca" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">领域映射</h1><p id="11cd" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在，我想将一个自定义域指向后端。我使用了 Namecheap，并创建了一个 A 记录，将一个子域指向我的 VPS 的 IP 地址。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/e2e8114d1ef205660ae2723407def132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jh8g13dn_10gQ0up"/></div></div></figure><h1 id="243d" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">反向代理</h1><p id="85fa" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">反向代理将连接指向正确的端口。这部分在 Linode 的博客文章中解释得很清楚，所以我只简单说说需要运行什么命令，你可以参考他们的博客文章中更详细的解释。</p><p id="aa39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们首先为反向代理安装 Nginx。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="4262" class="mn kr in mj b be mo mp l mq mr">sudo apt install nginx sudo systemctl status nginx</span></pre><p id="faf4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我们连接到我们的域，我们会看到 Nginx 欢迎页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/de0369cb6becdef0649238117cbb8a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DjdDyvIkrGG-8Owy"/></div></div></figure><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="d523" class="mn kr in mj b be mo mp l mq mr">sudo nano /etc/nginx/sites-available/{your_domain_name}</span></pre><p id="e43f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们将以下内容(来自<a class="ae mh" href="https://www.linode.com/docs/guides/installing-supabase/#using-a-reverse-proxy" rel="noopener ugc nofollow" target="_blank"> Linode guide </a>)复制到文件中，用您的自定义域替换<code class="fe ms mt mu mj b">example.com</code>。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="9466" class="mn kr in mj b be mo mp l no mr">map $http_upgrade $connection_upgrade {<br/>    default upgrade;<br/>    '' close;<br/>}<br/><br/>upstream supabase {<br/>    server localhost:3000;<br/>}<br/><br/>upstream kong {<br/>    server localhost:8000;<br/>}<br/><br/>server {<br/>    listen 80;<br/>    server_name example.com;<br/><br/>    # REST<br/>    location ~ ^/rest/v1/(.*)$ {<br/>        proxy_set_header Host $host;<br/>        proxy_pass http://kong;<br/>        proxy_redirect off;<br/>    }<br/><br/>    # AUTH<br/>    location ~ ^/auth/v1/(.*)$ {<br/>        proxy_set_header Host $host;<br/>        proxy_pass http://kong;<br/>        proxy_redirect off;<br/>    }<br/><br/>    # REALTIME<br/>    location ~ ^/realtime/v1/(.*)$ {<br/>        proxy_redirect off;<br/>        proxy_pass http://kong;<br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection $connection_upgrade;<br/>        proxy_set_header Host $host;<br/>    }<br/><br/>    # STUDIO<br/>    location / {<br/>        proxy_set_header Host $host;<br/>        proxy_pass http://supabase;<br/>        proxy_redirect off;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>    }<br/>}<br/></span></pre><p id="5134" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后我们可以做<code class="fe ms mt mu mj b">ctrl + o</code>和<code class="fe ms mt mu mj b">ctrl + x</code>来写和退出。然后我们可以创建一个从站点可用到站点启用的配置的符号链接，链接默认配置，然后重启 Nginx。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="1a84" class="mn kr in mj b be mo mp l mq mr">sudo ln -s /etc/nginx/sites-available/{your_domain_name} /etc/nginx/sites-enabled/{your_domain_name}<br/>sudo unlink /etc/nginx/sites-enabled/default<br/>sudo systemctl restart nginx</span></pre><p id="bf67" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们可以使用域名连接到 Supabase。</p><h1 id="0152" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取 SSL</h1><p id="70d2" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">在这一部分中，我们将使用 Certbot 给我们的 Supabase 一个 SSL 证书。他们的官方网站有很好的说明，所以你可以照着做。但是我也会让你知道我用了什么命令。</p><p id="6726" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们先安装<code class="fe ms mt mu mj b">core</code>，然后安装<code class="fe ms mt mu mj b">certbot</code>。然后我们配置它，最后尝试它如何自动更新，然后重启 Nginx 使它生效。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="0cc3" class="mn kr in mj b be mo mp l mq mr">sudo snap install core; sudo snap refresh core sudo snap install --classic certbot sudo ln -s /snap/bin/certbot /usr/bin/certbot sudo certbot --nginx sudo certbot renew --dry-run sudo systemctl restart nginx</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/32fbcaa284f075216edbec5370650447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QKAwOKMUgGBoM-bW"/></div></div></figure><h1 id="d48d" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安全超级数据库</h1><p id="df44" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">每个人都可以连接到 Supabase 仪表板，为了保护它，我们这样做是为了生成密码。它会要求你输入密码两次，所以你最好从一个安全的密码生成器生成一个密码，然后粘贴到那里两次。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="2670" class="mn kr in mj b be mo mp l mq mr">sudo htpasswd -c /etc/apache2/.htpasswd {admin_username}</span></pre><p id="0e54" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们可以用</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="97af" class="mn kr in mj b be mo mp l mq mr">cat /etc/apache2/.htpasswd</span></pre><p id="19e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们编辑 Nginx 配置以进行密码保护</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="0803" class="mn kr in mj b be mo mp l mq mr">sudo nano /etc/nginx/sites-available/{domain name}</span></pre><p id="8a46" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让它在工作室里</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="b3c4" class="mn kr in mj b be mo mp l no mr">    # STUDIO<br/>    location / {<br/>        proxy_set_header Host $host;<br/>        proxy_pass http://supabase;<br/>        proxy_redirect off;<br/>        proxy_set_header Upgrade $http_upgrade;<br/><br/>        auth_basic           "Administrator’s Area";<br/>        auth_basic_user_file /etc/apache2/.htpasswd;<br/>    }</span></pre><p id="8908" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在最后重启时</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="ef1a" class="mn kr in mj b be mo mp l mq mr">sudo service nginx restart</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/427d64fbe881bbe58e28b91a40e6ccac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Eg7hfIChW-fa_NfR"/></div></div></figure><p id="6b72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里你可以填写用户名作为你输入的<code class="fe ms mt mu mj b">{admin_username}</code>，密码作为你输入的密码。</p><h1 id="3574" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">重新配置超级数据库</h1><p id="a2af" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在，我们要为 Supabase 后端和外部 API 设置域。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="4b8d" class="mn kr in mj b be mo mp l mq mr">screen -r supabase</span></pre><p id="eb49" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们按<code class="fe ms mt mu mj b">ctrl + c</code>结束 Supabase docker 实例。然后我们编辑<code class="fe ms mt mu mj b">.env</code>文件。</p><p id="445d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要改变</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="0cab" class="mn kr in mj b be mo mp l no mr">...<br/>API_EXTERNAL_URL=https://{your_domain}<br/>...<br/>SUPABASE_PUBLIC_URL=https://{your_domain} # replace if you intend to use Studio outside of localhost</span></pre><p id="e5b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们可以执行<code class="fe ms mt mu mj b">ctrl + o</code>和<code class="fe ms mt mu mj b">ctrl + x</code>来保存更改，然后执行以下操作来恢复 Supabase。</p><pre class="kj kk kl km gt mi mj mk bn ml mm bi"><span id="7168" class="mn kr in mj b be mo mp l mq mr">docker compose up</span></pre><p id="f0ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们可以通过执行<code class="fe ms mt mu mj b">ctrl + a</code>然后<code class="fe ms mt mu mj b">ctrl + d</code>来断开连接，而不终止内部的进程，从而退出屏幕。</p><h1 id="7b67" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结论</h1><p id="02c4" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">恭喜你，你现在有一个工作的 Supabase 后端，受密码保护，在一个认证的域内。希望我的解释是清楚的，如果有任何问题或评论，请随时留下评论。你的下一步是开发你的前端，我将在本指南的下一部分<a class="ae mh" href="https://blog.cpbprojects.me/set-up-a-svelte-todo-list-on-self-hosted-supabase-email-sign-up-google-facebook-auth-host-on-github-pages" rel="noopener ugc nofollow" target="_blank">中介绍。</a></p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="9d59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nw">原发布于</em><a class="ae mh" href="https://blog.cpbprojects.me/how-to-self-host-supabase-a-complete-guide" rel="noopener ugc nofollow" target="_blank"><em class="nw">https://blog . CPB projects . me</em></a><em class="nw">。</em></p></div></div>    
</body>
</html>