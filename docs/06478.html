<html>
<head>
<title>How to handle Constraint violation exception using ControllerAdvice in Spring boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Spring boot 中使用 ControllerAdvice 处理约束违反异常</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-handle-constraint-violation-exception-using-controlleradvice-in-spring-boot-2f61147d19de?source=collection_archive---------0-----------------------#2022-01-11">https://blog.devgenius.io/how-to-handle-constraint-violation-exception-using-controlleradvice-in-spring-boot-2f61147d19de?source=collection_archive---------0-----------------------#2022-01-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ec18" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Spring boot 提供了一种很好的简单方法，可以使用经验证的注释对 RequestParams 或 PathVariables 进行适当的验证。在本文中，我们将介绍如何处理 Spring boot 抛出的约束违反异常，并使用 ControllerAdvice 发送适当的 HTTP 状态代码作为响应。</p><p id="7d06" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设我们有一个 Get 端点<code class="fe ki kj kk kl b">/api/student?class={class}</code>，其中我们对<code class="fe ki kj kk kl b">class</code> RequestParam 进行了@NotNull、@Min 和@Max 验证。(<em class="km">您可以在</em> <a class="ae kn" href="https://docs.oracle.com/javaee/7/api/javax/validation/constraints/package-summary.html" rel="noopener ugc nofollow" target="_blank"> <em class="km">官方文档</em> </a> <em class="km">中获得支持的所有验证类型的列表。</em>)</p><pre class="ko kp kq kr gt ks kl kt ku aw kv bi"><span id="f24a" class="kw kx in kl b gy ky kz l la lb">@RestController<br/>@RequestMapping("/api")<br/>@Validated<br/>public class StudentController {</span><span id="a6af" class="kw kx in kl b gy lc kz l la lb">    /**<br/>     * GET endpoint to get list of students which belong<br/>     * to the specified class     <br/>     * @param class - class<br/>     * @return List of Student<br/>     */<br/>    @GetMapping("/student")<br/>    public List&lt;Student&gt;getStudentByClass(<br/>        @RequestParam(value="class", required=true) <br/>        @NotNull <br/>        @Min(1) <br/>        @Max(12) Integer class) {<br/>            // Code to call the service and get the student list<br/>    }<br/>}</span></pre><p id="fcac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于上述 Get 端点，如果客户端为<code class="fe ki kj kk kl b">class param</code>发送了一个不正确的值(如 0、13、null 等。)不满足验证，那么 Spring boot 将抛出违反约束的异常。</p><p id="2547" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们看看如何使用 ControllerAdvice 来处理它。</p><p id="9229" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用<code class="fe ki kj kk kl b">@ControllerAdvice</code>标注的类是通过类路径扫描自动检测的，它允许我们在一个全局处理组件中处理整个应用程序的异常。</p><p id="ee9c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kn" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422" rel="noopener ugc nofollow" target="_blank">引自 MDN 网络文档。</a></p><p id="11bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">"<em class="km">超文本传输协议(HTTP) </em> <code class="fe ki kj kk kl b"><strong class="jm io"><em class="km">422 Unprocessable Entity</em></strong></code> <em class="km">响应状态码表示服务器理解请求实体的内容类型，并且请求实体的语法是正确的，但是它无法处理所包含的指令。</em></p><p id="84a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将发送<code class="fe ki kj kk kl b">422</code> Http 状态代码，因为它封装了我们想要响应客户端的内容的本质。</p><pre class="ko kp kq kr gt ks kl kt ku aw kv bi"><span id="dcc4" class="kw kx in kl b gy ky kz l la lb">@Slf4j<br/>@ControllerAdvice<br/>@RestController<br/>public class ExceptionController {</span><span id="da3f" class="kw kx in kl b gy lc kz l la lb">    /**<br/>     * Constraint violation exception handler   <br/>     * <br/>     * @param ex ConstraintViolationException<br/>     * @return List&lt;ValidationError&gt; - list of ValidationError built<br/>     * from set of ConstraintViolation<br/>     */<br/>    @ResponseStatus(HttpStatus.UNPROCESSABLE_ENTITY)<br/>    @ExceptionHandler(ConstraintViolationException.class)<br/>    public List&lt;ValidationError&gt;<br/>        handleConstraintViolation(ConstraintViolationException ex) {<br/>            log.debug(<br/>                "Constraint violation exception encountered: {}",<br/>                ex.getConstraintViolations(),       <br/>                ex<br/>            );<br/>        return buildValidationErrors(ex.getConstraintViolations());<br/>    }</span><span id="520a" class="kw kx in kl b gy lc kz l la lb">    /**<br/>     * Build list of ValidationError from set of ConstraintViolation<br/>     *<br/>     * @param violations Set&lt;ConstraintViolation&lt;?&gt;&gt; - Set <br/>     * of parameterized ConstraintViolations<br/>     * @return List&lt;ValidationError&gt; - list of validation errors<br/>     */<br/>    private List&lt;ValidationError&gt;  buildValidationErrors(<br/>       Set&lt;ConstraintViolation&lt;?&gt;&gt; violations) {<br/>        return violations.<br/>               stream().<br/>               map(violation -&gt; <br/>               ValidationError.builder().<br/>               field(<br/>                  StreamSupport.stream(<br/>                  violation.getPropertyPath().spliterator(), false).<br/>                  reduce((first, second) -&gt; second).<br/>                  orElse(null).<br/>                  toString()<br/>               ).<br/>               error(violation.getMessage()).<br/>               build()).<br/>               collect(toList());<br/>      }</span><span id="d353" class="kw kx in kl b gy lc kz l la lb">   }</span></pre></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="c00e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想了解更多，请浏览这个文档。</p><ol class=""><li id="c44a" class="lk ll in jm b jn jo jr js jv lm jz ln kd lo kh lp lq lr ls bi translated"><a class="ae kn" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html" rel="noopener ugc nofollow" target="_blank">https://docs . spring . io/spring-framework/docs/current/javadoc-API/org/spring framework/web/bind/annotation/controller advice . html</a></li><li id="34ca" class="lk ll in jm b jn lt jr lu jv lv jz lw kd lx kh lp lq lr ls bi translated"><a class="ae kn" href="https://docs.oracle.com/javaee/7/api/javax/validation/constraints/package-summary.html" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/javaee/7/API/javax/validation/constraints/package-summary . html</a></li><li id="d79d" class="lk ll in jm b jn lt jr lu jv lv jz lw kd lx kh lp lq lr ls bi translated"><a class="ae kn" href="https://www.baeldung.com/exception-handling-for-rest-with-spring" rel="noopener ugc nofollow" target="_blank">https://www . bael dung . com/exception-handling-for-rest-with-spring</a></li></ol></div></div>    
</body>
</html>