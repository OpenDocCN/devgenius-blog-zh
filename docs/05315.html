<html>
<head>
<title>Using Apache Kafka With Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用阿帕奇·卡夫卡和 Spring Boot</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-apache-kafka-with-spring-boot-6ea035db42d9?source=collection_archive---------1-----------------------#2021-07-18">https://blog.devgenius.io/using-apache-kafka-with-spring-boot-6ea035db42d9?source=collection_archive---------1-----------------------#2021-07-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="17ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我将展示如何将 Apache Kafka 与 Spring Boot 应用程序集成。我还将展示如何从我们的应用程序中发送和使用消息。</p><h1 id="0b6e" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">什么是阿帕奇卡夫卡？</h1><p id="ccee" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">我之前写过一篇关于卡夫卡的介绍性文章。但如果你还是对卡夫卡一无所知，那么这将是一个很好的总结。</p><p id="b488" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Kafka 是一个流处理平台，目前作为 Apache 的开源软件提供。Kafka 提供了大量数据的低延迟摄取。</p><p id="9cc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，Kafka 的一个关键优势是它允许移动大量数据并实时处理。Kafka 考虑了横向扩展，这意味着可以通过在 Kafka 集群中增加更多的经纪人来实现扩展。</p><h1 id="9811" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">卡夫卡术语</h1><p id="3e5f" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">所以，<a class="ae ll" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank">卡夫卡</a>有自己的术语。但是，这也很容易理解，如果你正在开始。</p><ol class=""><li id="b93a" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated"><strong class="jm io">Producer</strong>—Producer 是一个客户端，它生成一条消息，并将其发送到指定主题的 Kafka 服务器。</li><li id="35f2" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">消费者</strong> —消费者是消费来自 Kafka topic 的消息的客户端。</li><li id="bd49" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">集群</strong> — Kafka 是一个经纪人的分布式系统。多个代理构成一个集群。</li><li id="fa0b" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io"> Broker </strong> — Kafka broker 可以通过 zookeeper 直接或间接在彼此之间共享信息来创建 Kafka 集群。因此，代理从生产者处接收消息，而消费者通过主题、分区和偏移量从代理处获取该消息。</li><li id="8ffc" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">主题</strong> —主题是类别名称，生产者向其发送消息，消费者从其消费消息。</li><li id="fc20" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">分区</strong> —一个主题的消息在 kafka 集群中传播到几个分区中。</li><li id="1291" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io"> Offset </strong> — Offset 是一个指针，指向卡夫卡发送给消费者的最后一条消息。</li></ol><h1 id="1f17" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">设置 Spring Boot 应用程序</h1><p id="da50" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">作为这篇文章的一部分，我将展示如何在 Spring Boot 应用程序中使用 Apache Kafka。</p><p id="3ef9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将在机器上运行 Kafka 服务器，我们的应用程序将通过生产者向主题发送消息。应用程序的一部分将通过消费者使用该消息。</p><p id="815f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们的项目中需要一个 Kafka 依赖项。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="68df" class="mj kj in mf b gy mk ml l mm mn">implementation 'org.springframework.kafka:spring-kafka:2.5.2'</span></pre><p id="0432" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将有一个 REST 控制器，它将基本上接受一个 JSON 消息，并使用 Kafka Producer 将其发送到 Kafka topic。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="bc35" class="mj kj in mf b gy mk ml l mm mn">package com.betterjavacode.kafkademo.resource;<br/><br/>import com.betterjavacode.kafkademo.model.Company;<br/>import com.betterjavacode.kafkademo.producers.KafkaProducer;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.web.bind.annotation.*;<br/><br/>@RestController<br/>@RequestMapping(value = "/v1/kafka")<br/>public class KafkaRestController<br/>{<br/>    private final KafkaProducer kafkaProducer;<br/><br/>    @Autowired<br/>    public KafkaRestController(KafkaProducer kafkaProducer)<br/>    {<br/>        this.kafkaProducer = kafkaProducer;<br/>    }<br/><br/>    @PostMapping(value = "/send", consumes={"application/json"}, produces = {"application/json"})<br/>    public void sendMessageToKafkaTopic(@RequestBody Company company)<br/>    {<br/>        this.kafkaProducer.sendMessage(company);<br/>    }<br/>}</span></pre><p id="25fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个<code class="fe mo mp mq mf b">KafkaProducer</code>使用 KafkaTemplate 将消息发送到一个主题。KafkaProducer 是我们为此应用程序创建的服务。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8ec9" class="mj kj in mf b gy mk ml l mm mn">@Service<br/>public class KafkaProducer<br/>{<br/>    private static final Logger logger = LoggerFactory.getLogger(KafkaProducer.class);<br/>    private static final String topic = "companies";<br/><br/>    @Autowired<br/>    private KafkaTemplate&lt;String, Company&gt; kafkaTemplate;<br/><br/>    public void sendMessage(Company company)<br/>    {<br/>        logger.info(String.format("Outgoing Message - Producing -&gt; %s", company));<br/>        this.kafkaTemplate.send(topic, company);<br/>    }<br/>}</span></pre><p id="7246" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">同样，我们将有我们的消费者。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4b6a" class="mj kj in mf b gy mk ml l mm mn">@Service<br/>public class KafkaConsumer<br/>{<br/>    private final Logger logger = LoggerFactory.getLogger(KafkaConsumer.class);<br/><br/>    @KafkaListener(topics = "companies", groupId = "group_id")<br/>    public void consume(String company)<br/>    {<br/>        logger.info(String.format("Incoming Message - Consuming -&gt; %s", company));<br/>    }<br/>}</span></pre><p id="502b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的消费者正在使用<code class="fe mo mp mq mf b">KafkaListener</code>，它允许我们听一个话题。当一条消息到达这个主题时，监听器会提醒消费者，消费者会收到这条消息。</p><h1 id="d403" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">卡夫卡式结构</h1><p id="4d6b" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">在展示我们将如何发送和消费这些消息之前，我们仍然需要在我们的应用程序中配置 kafka 集群。我们的生产者和消费者还需要一些其他的属性。</p><p id="7580" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本上，有两种方法可以配置这些属性。以编程方式或通过 YML 配置。对于我们的应用程序，我已经通过 YML 配置文件进行了配置。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="1e43" class="mj kj in mf b gy mk ml l mm mn">server:<br/>  port: 9000<br/>spring:<br/>  kafka:<br/>    consumer:<br/>      bootstrap-servers: localhost:9092<br/>      group-id: group_id<br/>      auto-offset-reset: earliest<br/>      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer<br/>      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer<br/>      properties:<br/>        spring.json.trusted.packages: "com.betterjavacode.kafkademo.model"<br/>    producer:<br/>      bootstrap-servers: localhost:9092<br/>      key-serializer: org.apache.kafka.common.serialization.StringSerializer<br/>      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer</span></pre><p id="3906" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> bootstrap-servers </strong> —运行 Kafka 服务器的主机和端口<br/><strong class="jm io">key-deserializer</strong>—用于反序列化消费者使用的消息的密钥的类<br/><strong class="jm io">value-deserializer</strong>—用于反序列化消费者使用的消息的值的类<br/> <strong class="jm io"> key-serializer </strong> —序列化生产者产生的消息的密钥的序列化器类<br/><strong class="jm io">value-Serializer</strong>—序列化器类</p><p id="6e27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">自动偏移重置</strong>—Kafka 主题分区中的每条消息都有一个唯一的标识符，即<code class="fe mo mp mq mf b">offset</code>。此设置会自动将偏移重置为最早的值。</p><p id="734e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们发送消息之前，我们的主题必须存在。我将手动创建这个主题，并在下一节中展示。在 Spring Boot 应用程序中，我们可以创建一个<code class="fe mo mp mq mf b">KafkaAdmin</code> bean，并使用它来创建主题。</p><h1 id="cdc0" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">运行 Kafka 服务器</h1><p id="07e1" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">作为演示的一部分，我还将展示如何启动我们的第一个 Kafka 服务器实例。从<a class="ae ll" href="https://kafka.apache.org/downloads.html" rel="noopener ugc nofollow" target="_blank">这里</a>下载卡夫卡。</p><p id="468d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦你下载并解压到一个目录中，我们将不得不编辑<code class="fe mo mp mq mf b">zookeeper.properties</code>和<code class="fe mo mp mq mf b">server.properties</code>中的两个属性。</p><p id="72a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用数据目录(dataDir)更新<code class="fe mo mp mq mf b">zookeeper.properties</code>,您希望 zookeeper 在其中存储数据。</p><p id="69e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启动动物园管理员— <code class="fe mo mp mq mf b"> zookeeper-server-start.bat ../../config/zookeeper.properties</code></p><p id="4268" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用日志目录更新<code class="fe mo mp mq mf b">server.properties</code>。</p><p id="f85b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启动服务器— <code class="fe mo mp mq mf b">kafka-server-start.bat ../../config/server.properties</code></p><p id="d315" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在要创建一个主题，我们可以运行另一个命令提示符，并从安装 kafka 的目录中使用这个命令<br/> <code class="fe mo mp mq mf b">kafka-topics.bat -create -topic companies-bootstrap-server localhost:9092</code>。</p><h1 id="2561" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">发送和使用消息</h1><p id="eda1" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">到目前为止，我们已经用 Kafka 创建了一个 Spring Boot 应用程序。我们已经配置了我们的 Kafka 服务器。现在是向卡夫卡主题发送和消费信息的时候了。</p><p id="ca74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们有一个 REST API 来发送关于一家公司的消息。然后卡夫卡制作人将这个消息发送给卡夫卡主题<code class="fe mo mp mq mf b">companies</code>。一个 Kafka 的消费者将会从这个主题中读出这个信息，因为它将会听到它。</p><figure class="ma mb mc md gt ms gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/abe01c5ee43e5d4d4aafdd79636ba855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*6yioWTLLtYly5qL-"/></div></figure><p id="89df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦这个消息被发送，我们可以查看我们的应用服务器日志，因为它将显示通过 Kafka Producer 生成这个消息。</p><figure class="ma mb mc md gt ms gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/04dfc27bdcd21e80ca47905b7ac51d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*dIiKPk-h0xLadFSc"/></div></figure><p id="b751" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">同时，我们的消费者也在倾听。因此，它将获取此消息进行消费。</p><figure class="ma mb mc md gt ms gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3a131ff46344eb1f261763845b9b3ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*PI5HR-kcnY6HVncv"/></div></figure><h1 id="a7a8" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">结论</h1><p id="66cd" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">到目前为止，我们已经展示了如何在 Spring Boot 应用程序中使用 Apache Kafka。随着应用程序中的数据不断增加，以低延迟传输变得越来越重要。这个演示应用程序的代码库是这里的<a class="ae ll" href="https://github.com/yogsma/betterjavacode/tree/main/kafkademo" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f027" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想让我介绍卡夫卡的其他内容，请随意评论这篇文章，我会在接下来的文章中介绍更多关于卡夫卡的细节。</p></div><div class="ab cl mv mw hr mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ig ih ii ij ik"><p id="9ae3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nc">原载于 2021 年 7 月 18 日 https://betterjavacode.com</em><em class="nc">的</em> <a class="ae ll" href="https://betterjavacode.com/kafka/using-apache-kafka-with-spring-boot" rel="noopener ugc nofollow" target="_blank"> <em class="nc">。</em></a></p></div></div>    
</body>
</html>