<html>
<head>
<title>AWS Elastic Load Balancing from a Serverless perspective</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从无服务器的角度看 AWS 弹性负载平衡</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/aws-elastic-load-balancing-from-a-serverless-perspective-6ebc2ba9b942?source=collection_archive---------8-----------------------#2022-01-31">https://blog.devgenius.io/aws-elastic-load-balancing-from-a-serverless-perspective-6ebc2ba9b942?source=collection_archive---------8-----------------------#2022-01-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9a72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">负载平衡是每个面向互联网的软件的重要组成部分，通过<a class="ae ki" href="https://aws.amazon.com/elasticloadbalancing/" rel="noopener ugc nofollow" target="_blank">弹性负载平衡</a> (ELB)，AWS 为每个用例提供了一套负载平衡器。</p><p id="533b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于我们的<a class="ae ki" href="https://dashbird.io/blog/dashbird-now-integrates-with-5-new-aws-services/" rel="noopener ugc nofollow" target="_blank">最新更新</a>，Dashbird 也给你洞察这些 ELB 服务；让我们来看看它们，看看如何在无服务器环境中使用它们。</p><h1 id="7505" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是弹性负载平衡(ELB)？</h1><p id="307c" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">ELB 是由 AWS 提供的一组负载平衡(LB)服务。它们包括<strong class="jm io">经典负载均衡器</strong>、<strong class="jm io">网关负载均衡器</strong>、<strong class="jm io">网络负载均衡器</strong>和<strong class="jm io">应用负载均衡器</strong>。</p><p id="6934" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些 LBs 涵盖了不同的用例。</p><ul class=""><li id="c25f" class="lm ln in jm b jn jo jr js jv lo jz lp kd lq kh lr ls lt lu bi translated">对于基于 EC2 的架构来说，<strong class="jm io">经典负载平衡器</strong>是一个不错的选择</li><li id="d392" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">网关负载平衡器</strong>帮助 VPCs 中的第三方虚拟机</li><li id="6653" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">网络负载平衡器</strong>专注于高性能的低级别网络，考虑基于游戏或物联网的 UPD 连接</li><li id="be90" class="lm ln in jm b jn lv jr lw jv lx jz ly kd lz kh lr ls lt lu bi translated"><strong class="jm io">应用负载均衡器</strong>是一个使用 HTTP 协议的软件的高级解决方案</li></ul><p id="d25c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在无服务器架构的情况下，所有服务都使用<strong class="jm io">HTTP API</strong>，这意味着 ALB 是最好的选择。因此，本文将重点讨论 ALB。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/af47b0c674ae4803cc24714e8ed1b445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yYfbarxZfpWf45YZ.png"/></div></div></figure><h1 id="818c" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是应用程序负载平衡器(ALB)？</h1><p id="f8ea" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">ALB 对 HTTP 的关注允许它使用部分协议来做出关于缓存的决定，并为您节省一些 Lambda 执行。这意味着你的 Lambda 函数必须正确设置它们的缓存头。</p><h1 id="a956" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">定价</h1><p id="4e26" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">虽然 ALB 可以与 Lambda 集成，但它不是无服务器服务；它没有现收现付的模式，也就是说你要为没有使用的时间付费。但是如果你有一个持续稳定流量需求的服务，从长远来看可以比 API Gateway 便宜。</p><h1 id="34b5" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">限制</h1><p id="850d" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">还有，API Gateway 对 10k 连接有限制；ALB 没有。它是一个 API 网关，具有更多次要特性；最基本的，但是为了性能而构建。如果你想做大，ALB 可能是你唯一的解决方案。</p><h1 id="717f" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">许可</h1><p id="d435" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">ALB 更像是一种传统的“绑在公共 HTTP 端点前面”的东西。因此，虽然它与 Lambda 集成，但它不提供基于 IAM 的权限。您必须在您的无服务器函数中处理这个问题。</p><h1 id="fee7" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">转换</h1><p id="0509" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">这种传统的负载平衡方法也意味着 ALB 不能进行请求和响应转换；它只是传输你的数据。同样，这使得 ALB 不如 API Gateway 灵活，并将更多的工作转移到 Lambda。</p><h1 id="a221" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">多区域</h1><p id="71d8" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">您可以一次将 ALB 部署到一个区域。同样，这不是一个无服务器的服务，所以你需要做更多的工作。为了在多个地区之间平衡流量，您需要 Route53 基于 DNS 的平衡。</p><h1 id="084c" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">可靠性或成本配置</h1><p id="5147" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">将 ALB 与 Lambda 目标一起使用通常会带来很好的可靠性，因为 Lambda 会自动伸缩。如果您需要的不仅仅是开箱即用的可靠性，您必须将 ALB 部署到多个地区，并将其置于 Route53 之后。</p><p id="3d97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在成本方面，Lambda 可能会成为你的罪魁祸首。如果你把每一个请求都路由到一个内存配置很大的 Lambda 函数，事情会很快变得很昂贵。因此，遵循无服务器的最佳实践，保持 Lambda 函数小而有目的。为 ALB 侦听器设置条件，以便尽可能使用内存占用较少的函数。</p><h1 id="58af" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">运行状况检查最佳实践</h1><p id="40a8" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">虽然 EC2 目标很容易被淹没，但是 Lambda 目标由于其固有的自动缩放功能而有更多的缓冲空间；在无服务器系统中仍然有可能出错。</p><p id="6cec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，AWS 禁用 Lambda 目标的 ALB 健康检查，因此您必须在这里选择加入。</p><p id="6a62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然有些问题可能是由推送到 Lambda 的错误代码引起的，但大多数问题来自于函数使用的上游服务。因此，设置您的 Lambdas 来通过管道进行健康检查，然后用来自上游服务的结果进行响应。</p><p id="1dfd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果出现问题，唯一快速的解决方案是告诉 Route53 将下面的请求路由到不同的部署。</p><h1 id="a53a" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">AWS 和 Dashbird 中的日志分析</h1><p id="dfad" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">AWS 允许您使用 Amazon Athena 来分析您的 ALB 日志。Athena 是一个无服务器的查询服务。您需要激活查询日志并将它们保存到 S3，以便使用 Athenas SQL 查询来浏览它们。</p><p id="da57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一方面，Dashbird 附带了一个 ALB 图，它将所有基本指标进行了分组。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mm"><img src="../Images/184b90f5f18d134bfca2e6e3f895bcc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QzzzOsSMDjHF_Y4x"/></div></div></figure><p id="7b6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，对于所有的弹性负载平衡服务，有十几个架构良好的见解可用，仅 ALB 就有七个。这些包括安全问题的通知，如 HTTP 到 HTTPS 的丢失重定向和放弃的 ALBs，以及可靠性问题，如没有剩余的健康目标。</p><h1 id="e354" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">用 Dashbird 猎虫子</h1><p id="b099" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">Dashbird 的好处是它可以跟踪你的整个无服务器部署。系统的整体视图允许您找到在 ALB 端点上用 HTTP 状态代码显示的错误，但这些错误与您的上游服务有关。</p><p id="9b86" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，让我们以<strong class="jm io"> 502 —不良网关</strong>响应为例。在您的体系结构中，各种上游错误都很普遍，因此它并不比告诉您“ALB 背后的某些东西坏了”更有价值但是深入 Dashbird 可以揭示<strong class="jm io">到底发生了什么</strong>！</p><p id="ec5d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所有这 502 个响应可能看起来像这样:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/fa2e45c0efa7980179b45ba6c3f1d451.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/0*H0jEL7mlPIjweq66"/></div></figure><p id="2eb2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它们都提供了更多的细节，以便您可以修复错误。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mo"><img src="../Images/83614125fd9b75c4841547256a9e18db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uNU-ioO4KcD3Qwxi"/></div></div></figure><h1 id="2a7f" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">摘要</h1><p id="77bd" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">一般来说，ELB 服务，尤其是 ALB，在扩展您的系统时起着至关重要的作用。虽然 Lambda 目标可以自动扩展，但对于大型工作负载来说，ALB 仍然是一个相对于 API 网关的廉价替代品。如果达到 API Gateway 的极限，这一点尤其正确。</p><p id="b198" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是请记住，ALB 有它自己的限制，不能像 API Gateway 那样提供那么多现成的特性。</p><p id="4e2c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">自从 Dashbirds 新版本发布以来，您可以放心，您所有的 AWS 负载平衡器都受到监控，通过良好的架构洞察力，您可能会发现您的架构中以前没有注意到的一些问题。</p></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><p id="c6ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">延伸阅读:</p><p id="55fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://dashbird.io/blog/dashbird-now-integrates-with-5-new-aws-services/" rel="noopener ugc nofollow" target="_blank"> Dashbird 现在集成了 5 项新的 AWS 服务</a></p><p id="a745" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">【AWS API 网关可以充当负载平衡器吗？</p><p id="f1aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://dashbird.io/blog/resolve-all-api-gateway-errors/" rel="noopener ugc nofollow" target="_blank">关于 AWS API 网关你需要知道的一切</a></p></div></div>    
</body>
</html>