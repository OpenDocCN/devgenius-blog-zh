<html>
<head>
<title>How to do Single-table design with DynamoDB?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 DynamoDB 做单表设计？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-do-single-table-design-with-dynamodb-db9101a43277?source=collection_archive---------2-----------------------#2022-01-26">https://blog.devgenius.io/how-to-do-single-table-design-with-dynamodb-db9101a43277?source=collection_archive---------2-----------------------#2022-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="41b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们在<a class="ae kl" href="https://serverlesscorner.com/serverless-and-dynamodb-a-perfect-fit-c3afe99f14cc" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中讨论 DynamoDB 的关键概念一样，现在是时候深入研究如何使用 DynamoDB 应用单表设计策略了。单表设计性价比最高💰和有效的方式🚀使用 DynamoDB。在这篇文章中，我们将看看如何使用单表设计来建模一个在线图书馆应用程序。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/68319dfa3ed8c152364e42100978b7a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*FtToYkUO3Ht956dS"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">阿姆斯特丹的桌子</figcaption></figure><h2 id="9154" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">介绍</h2><blockquote class="lr ls lt"><p id="4a29" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">这是关于使用无服务器和 DynamoDB 的文章的第 2 部分(T2)。本文详细介绍了什么是单表设计以及如何应用它。</p><p id="5222" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">★ <a class="ae kl" href="https://serverlesscorner.com/serverless-and-dynamodb-a-perfect-fit-c3afe99f14cc" rel="noopener ugc nofollow" target="_blank">本系列的第 1 部分是关于 DynamoDB 如何适应无服务器领域以及 DynamoDB 的关键概念。</a></p><p id="5f1a" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">★本系列的第 2 部分着眼于使用 DynamoDB 的单表设计。</p><p id="02d2" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">★本系列的第 3 部分给出了如何将 Serverless 与 DynamoDB 结合使用的示例。</p></blockquote><h1 id="f7e4" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">什么是单表设计？</h1><p id="cefc" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">那么，单表设计需要什么呢？让我们先退后一步，看看 DynamoDB 试图解决的问题。DynamoDB 是为 Amazon.com 等网站的大规模运行而构建的 NoSQL 键值数据库。它不支持将构造作为外键的关系模型。构建数据取决于您。</p><p id="3273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，还有传统的关系数据库，其中有一种方法来规范化数据并为每个实体创建一个表。通过<em class="lu"> SQL 连接</em>在读取时支持组合这些记录。然而，加入是有代价的。加入的越多，表现越慢。</p><blockquote class="lr ls lt"><p id="abf9" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">连接是性能的大敌，因此 DynamoDB 不支持连接。</p></blockquote><p id="c3ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，如何用 DynamoDB 在不同的实体之间创建关系呢？也许您可以在应用程序中使用单独的表来连接实体？使用 DynamoDB 为不同的实体使用不同的表，并通过多个请求手动连接实体，这种策略带来了太多的网络 I/O，使它变得很慢。所以这是个死胡同。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a942375569f8e51f8e51d41fc985283e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/0*XjL-81Tsgau5t3JJ.jpg"/></div></figure><h1 id="7433" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">单表设计魔术</h1><p id="84e8" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">用 DynamoDB 关联不同的实体并获得高性能的技巧是使用单表设计将它们放在同一个篮子里。为了演示这是如何工作的，我们将使用一个例子。假设您的任务是构建一个在线图书馆应用程序，允许根据作者或类别搜索书籍。数据模型如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/2dead01e96e9f17a3972752aec051a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODJ6JZVfeQVM-VUAVUwOJw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图书馆图书数据模型</figcaption></figure><p id="c628" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个类别包含书籍，一个作者包含书籍，一本书可以有预订。</p><h1 id="5c70" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">访问模式</h1><p id="b7e5" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">在构建 DynamoDB 表的结构时，重要的是了解应用程序的访问模式。对于应用程序，以下访问模式是有区别的:</p><ul class=""><li id="6094" class="na nb iq jp b jq jr ju jv jy nc kc nd kg ne kk nf ng nh ni bi translated">按名称获取一个作者的所有书籍</li><li id="7384" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">按名称获取一个类别的所有书籍</li><li id="a20f" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">有可能预订一本书</li><li id="9889" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">通过 ISBN 得到一本书</li><li id="6053" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">按书名得到一本书</li><li id="b388" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">预订一本书</li></ul><h1 id="cdbb" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">主键</h1><p id="c1d4" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">记得在<a class="ae kl" href="https://serverlesscorner.com/serverless-and-dynamodb-a-perfect-fit-c3afe99f14cc" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中提到主键是必需的，并且 DynamoDB 知道的唯一结构。让我们使用<em class="lu">复合主键将实体映射到主键。</em>复合主键由一个<em class="lu">分区键(PK) </em>和一个<em class="lu">排序键(SK) </em>组成。对于单个表中的所有实体，能够区分实体类型非常重要。因此，我们将在<em class="lu">分区键</em>和<em class="lu">排序键</em>中使用实体名称作为前缀。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi no"><img src="../Images/8e942671d6f0dc7506e1aacc8cdcbf57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulRKqjT73Ck893BZZOvbCw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">具有主键结构的实体表</figcaption></figure><p id="240e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于 PK 和 SK 名称，我使用一种常见的做法，将实体名称作为前缀，后跟实体的标识属性。</p><h1 id="ea85" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">单表联接</h1><p id="35ec" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">看实体行 AuthorBooks 作者所有的书都是以作者为 PK，书为 SK 来组合的。分类书籍也是如此。这是使用<em class="lu">项集合</em>的 SQL-Joins 的单表版本。您可以通过检索 PK 等于作者姓名的所有数据来获取作者和他/她的所有书籍。</p><p id="51d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们用表格中的一些数据来看看这个。分区键定义为 PK，排序键定义为 SK。这些是通用的，因为它们可以包含任何实体类型。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/116a134a423bd9a055446a590712ce20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64Jo7XNc6LVXVJ_AW-SMnA.png"/></div></div></figure><p id="4722" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该表显示了前面显示的实体映射结构的一些示例数据。您可以看到有或没有预订的图书、作者以及带有作者的项目集合中的图书。</p><p id="b639" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看这个结构可以满足哪些访问模式。</p><h2 id="a1a4" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">得到一个叫✔️的作者的所有书</h2><p id="5754" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">按作者获取记录作为 PK 给作者和他/她的书。PK 为<em class="lu"> AUTH#Tolkien_JRR </em>的查询将返回以下项目:</p><ul class=""><li id="a0be" class="na nb iq jp b jq jr ju jv jy nc kc nd kg ne kk nf ng nh ni bi translated"><em class="lu"> AUTH# &lt;托尔金 _JRR &gt; — AUTH# &lt;托尔金 _JRR &gt; </em></li><li id="b471" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated"><em class="lu"> AUTH# &lt;托尔金 _ JRR&gt;—BOOK #&lt;12355&gt;</em></li></ul><p id="0966" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了这个结构，你就知道第一项是作者，后面的记录是书籍。如果您的实体名称按字母顺序不同，您可以使用前缀来构建前缀，以使所需的名称位于顶部。</p><h2 id="df13" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">获得书号✔️的书</h2><p id="527a" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">用 ISBN 检索一本书相当简单，因为有了 ISBN，您可以使用主键来获取项目。</p><h2 id="7d73" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">有可能预订一本书✔️</h2><p id="3fb4" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">预订是一本书的复杂属性。从一个实体看，这是一个定义实体间一对一关系的选项。</p><h2 id="861f" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">预订一本书✔️</h2><p id="fef5" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">预订一本书可以通过 ISBN 获取该书并添加一个预订作为复杂属性来完成。</p><p id="799e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，涵盖了相当多的访问模式。但是我们仍然必须定义一个结构来获取某个类别的书籍，并按标题搜索书籍。我们先来看分类。</p><p id="c873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用一个全局二级索引来创建一个条目集合，将某个类别的所有书籍关联起来。有关示例，请参见下表。分区键命名为 GS1PK，排序键命名为 GS1SK。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nq"><img src="../Images/3d6736e0be7447c04a0782e1a8f83e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bR4CX3wkdu9NXXkPwOk3g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">全局二级索引示例</figcaption></figure><h2 id="7a2f" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">按名称✔️获取某一类别的所有书籍</h2><p id="42e4" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我们现在可以使用全局二级索引的项目集合来获取“幻想”类别的所有书籍。</p><p id="72c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而用 DynamoDB 并不是所有的都是可能的。不建议使用 DynamoDB 搜索字符串。常见的做法是使用亚马逊 CloudSearch 之类的辅助服务。</p><p id="b385" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我希望我在使用 DynamoDB 时受到了使用单表设计的启发。在下面的文章中，我将展示一些与 DynamoDB 交互的实际代码。敬请期待！</p><blockquote class="lr ls lt"><p id="b272" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">关于使用 DynamoDB 进行单表设计的更多信息，强烈推荐以下书籍<a class="ae kl" href="https://www.dynamodbbook.com/" rel="noopener ugc nofollow" target="_blank"><em class="iq"/></a><em class="iq">。</em></p></blockquote><h1 id="0c52" class="ly kz iq bd la lz ma mb ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo bi translated">海科·范德沙夫</h1><ul class=""><li id="816f" class="na nb iq jp b jq mp ju mq jy nr kc ns kg nt kk nf ng nh ni bi translated"><strong class="jp ir"> <em class="lu">如果你喜欢这个，请</em> </strong> <a class="ae kl" href="https://serverlesscorner.com/about" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="lu">跟随 Serverlesscorner.com 上媒</em> </strong> </a> <strong class="jp ir"> <em class="lu">。</em> </strong></li><li id="9126" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated"><strong class="jp ir"> <em class="lu">爱情</em> </strong> ❤️ <strong class="jp ir"> <em class="lu">阅读</em> </strong> <strong class="jp ir"> <em class="lu">我的故事和其他关于媒？</em> </strong> <a class="ae kl" href="https://serverlesscorner.com/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="lu">成为会员</em> </strong> </a> <strong class="jp ir"> <em class="lu">如果你还不是会员的话。</em> </strong></li><li id="30ec" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated"><strong class="jp ir"> <em class="lu">想阅读更多无服务器？报名我的</em> </strong> <a class="ae kl" href="https://serverlessconsulting.org/newsletter" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="lu">月报</em> </strong> </a> <strong class="jp ir"> <em class="lu">📬关于无服务器技术和使用案例的启发性和深刻的故事。</em>T57】</strong></li></ul></div></div>    
</body>
</html>