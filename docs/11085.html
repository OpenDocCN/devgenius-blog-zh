<html>
<head>
<title>Socket Programming in C â€” Bonus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C è¯­è¨€ä¸­çš„å¥—æ¥å­—ç¼–ç¨‹â€”â€”åŠ åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/socket-programming-in-c-bonus-d794a0dc6f7?source=collection_archive---------11-----------------------#2022-12-17">https://blog.devgenius.io/socket-programming-in-c-bonus-d794a0dc6f7?source=collection_archive---------11-----------------------#2022-12-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3a882296a85e99ac02568eb18f8a5dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3J9qvxNWd4V1zK1yAQpEPg.png"/></div></div></figure><p id="af9f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨æœ¬ç³»åˆ—çš„å‰ä¸¤ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªä½¿ç”¨å¥—æ¥å­—çš„æœåŠ¡å™¨-å®¢æˆ·ç«¯é€šä¿¡çš„éå¸¸ç®€å•çš„å®ç°ï¼Œå…¶ä¸­æˆ‘ä»¬ä½¿ç”¨å¥—æ¥å­—åˆ›å»ºäº†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„å®¢æˆ·æ˜¯æˆ‘ä»¬æå‡ºè¯·æ±‚çš„ç½‘ç»œæµè§ˆå™¨ã€‚å› æ­¤ï¼Œåœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºåœ¨æˆ‘ä»¬é¢„å…ˆæ„å»ºçš„æœåŠ¡å™¨ä¸Šå¤„ç†è¿™äº›è¯·æ±‚ã€‚</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><h1 id="be03" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">å¥—æ¥å­—åˆ›å»ºå’Œç»‘å®š</h1><p id="2f8f" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">æœåŠ¡å™¨çš„åˆ›å»ºä¸å‰é¢å®Œå…¨ç›¸åŒã€‚ä¹‹å‰çš„ä»£ç åªæœ‰ä¸€äº›å°æ”¹åŠ¨ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="89b9" class="mm lb in mi b be mn mo l mp mq">int sockfd, newsockfd;<br/>int clilen;<br/>struct sockaddr_in cli_addr, serv_addr;<br/>int i;<br/>char buffer[4096];<br/><br/>if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0)<br/>{<br/>  printf("Cannot create socket\n");<br/>  exit(0);<br/>}<br/><br/>serv_addr.sin_family = AF_INET;<br/>serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);<br/>serv_addr.sin_port = htons(5000);<br/><br/>if (bind(sockfd, (struct sockaddr *)&amp;serv_addr, sizeof(serv_addr)) &lt; 0)<br/>{<br/>  printf("Unable to bind local address\n");<br/>  exit(0);<br/>}<br/><br/>listen(sockfd, 5);</span></pre><p id="4435" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™é‡Œå¼•å…¥ä¸¤ä¸ªæ–°å‡½æ•°ï¼Œ<strong class="jx io"> htonl() </strong>å’Œ<strong class="jx io"> htons() </strong>ã€‚æœ‰ç”¨äºå°†åœ°å€å’Œç«¯å£å·ä»æœ¬æœºå­—èŠ‚é¡ºåºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚é¡ºåºã€‚å—¯ï¼Œå¬èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚æˆ‘ç»™ä½ ç®€å•è§£é‡Šä¸€ä¸‹ã€‚</p><p id="93f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åŸºæœ¬ä¸Š<strong class="jx io">å­—èŠ‚é¡ºåº</strong>å°±æ˜¯ç³»ç»Ÿä¸­æ•°å­—çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œå¤§ç«¯å­—èŠ‚é¡ºåºå°†å­—çš„æœ€é«˜æœ‰æ•ˆå­—èŠ‚å­˜å‚¨åœ¨æœ€å°çš„å†…å­˜åœ°å€ã€‚</p><blockquote class="mr ms mt"><p id="fa4b" class="jv jw mu jx b jy jz ka kb kc kd ke kf mv kh ki kj mw kl km kn mx kp kq kr ks ig bi translated">ç½‘ç»œå­—èŠ‚é¡ºåºæ€»æ˜¯è¢«å®šä¹‰ä¸ºå¤§ç«¯é¡ºåºï¼Œè¿™å¯èƒ½ä¸ä¸»æœºçš„å­—èŠ‚é¡ºåºä¸åŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è½¬æ¢å®ƒä»¬ã€‚</p></blockquote><h1 id="f5a4" class="la lb in bd lc ld my lf lg lh mz lj lk ll na ln lo lp nb lr ls lt nc lv lw lx bi translated">å¤„ç†æ¥è‡ªæµè§ˆå™¨çš„è¯·æ±‚</h1><p id="4a5d" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">HTTP è¯·æ±‚æœ‰ä¸€äº›åŒ…å«è¯·æ±‚æ–¹æ³•ç±»å‹(GETã€POST ç­‰)çš„é¢„å®šä¹‰æ ¼å¼ã€‚)ã€è·¯å¾„ã€å†…å®¹ç±»å‹ã€ç”¨æˆ·ä»£ç†ç­‰ã€‚å› æ­¤ï¼Œç°åœ¨æ¯å½“æˆ‘ä»¬ä»æµè§ˆå™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒéƒ½æ˜¯è¿™ç§æ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦è§£æå®ƒæ¥æå–æ‰€éœ€çš„æ•°æ®ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="e3b0" class="mm lb in mi b be mn mo l mp mq">Sample request format:<br/><br/>GET / HTTP/1.1<br/>Host: localhost:5000<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:69.0) Gecko/20100101 Firefox/69.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Connection: keep-alive<br/>Upgrade-Insecure-Requests: 1</span></pre><p id="04de" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™é‡Œï¼ŒGET åé¢çš„â€œ/â€æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„è·¯å¾„ï¼Œæˆ‘ä»¬å°†è¿”å›ä¸€äº› HTML å†…å®¹ä½œä¸ºå“åº”ã€‚</p><p id="c2a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ¥å—è¿æ¥çš„ä»£ç ä¸å‰é¢çš„ä¸€æ ·ï¼Œåªæœ‰æˆ‘ä»¬ä¼ è¾“æ•°æ®çš„éƒ¨åˆ†ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p id="271a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿æ¥å»ºç«‹åï¼Œä½¿ç”¨ recv()å‡½æ•°å°†è¯·æ±‚å­˜å‚¨åœ¨å­—ç¬¦ä¸²ç¼“å†²åŒºä¸­ï¼Œå¹¶ä»ä¸­æå–æ–¹æ³•ç±»å‹å’Œè¯·æ±‚çš„è·¯å¾„ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="f97f" class="mm lb in mi b be mn mo l mp mq">if (strncmp(buffer, "GET ", 4) == 0)<br/>{<br/>    char *path = NULL;<br/>    path = strtok(buffer, " "); // returns the string "GET"<br/>    path = strtok(NULL, " ");   // returns the requested path<br/>    if (strcmp(path, "/") == 0)<br/>    {<br/>        ...<br/>    }<br/>}</span></pre><p id="bf44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¯¹äºæ­¤ç¤ºä¾‹ï¼Œåœ¨è¯·æ±‚è·¯å¾„â€œ/â€ä¸Šï¼ŒæœåŠ¡å™¨å°†è¯»å–å¹¶å‘é€å­˜å‚¨åœ¨ç³»ç»Ÿ(å³æœåŠ¡å™¨)ä¸­çš„ index.html æ–‡ä»¶çš„å†…å®¹ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="30e4" class="mm lb in mi b be mn mo l mp mq">if ((file_fd = open("index.html", O_RDONLY)) == -1)<br/>{<br/>      printf("File error!");<br/>      continue;<br/>}<br/>len = lseek(file_fd, (off_t)0, SEEK_END); // length of file                                                              /* lseek to the file end to find the length */<br/>lseek(file_fd, (off_t)0, SEEK_SET);</span></pre><p id="f720" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨å‘é€ HTML å†…å®¹ä¹‹å‰ï¼Œå¿…é¡»å‘é€ä¸€äº›æ ‡é¢˜ï¼Œå¦‚å“åº”çš„çŠ¶æ€ç ã€å†…å®¹é•¿åº¦ã€å†…å®¹ç±»å‹ç­‰ã€‚ä»¥ä¾¿å®¢æˆ·æœº(æµè§ˆå™¨)èƒ½å¤Ÿç†è§£ä½œä¸ºå“åº”çš„æ•°æ®ç±»å‹ä»¥åŠå¦‚ä½•æ˜¾ç¤ºå®ƒã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="f41b" class="mm lb in mi b be mn mo l mp mq">Example:<br/>HTTP/1.1 200 OK<br/>Content-Length: 50<br/>Content-Type: text/html<br/>â€¦</span></pre><p id="6f86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ ‡é¢˜å’Œ HTML æ–‡ä»¶å†…å®¹å°†ä½¿ç”¨ send()å‡½æ•°å‘é€ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="a756" class="mm lb in mi b be mn mo l mp mq">// writing headers into buffer string<br/>sprintf(buffer, "HTTP/1.1 200 OK\nContent-Length: %ld\nConnection: close\nContent-Type: text/html\n\n", len);<br/><br/>// sending headers to client<br/>send(newsockfd, buffer, strlen(buffer),0);<br/><br/>// sending file content<br/>while ((ret = read(file_fd, buffer, 4096)) &gt; 0)<br/>{<br/>    send(newsockfd, buffer, ret, 0);<br/>}</span></pre><p id="f4ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ç°åœ¨ï¼Œè¯¥æ–‡ä»¶å¯ä»¥åŒ…å«å¤§é‡å†…å®¹ï¼Œå› æ­¤åº”è¯¥ä»¥å­—èŠ‚å—çš„å½¢å¼å‘é€ï¼Œæ¯”å¦‚ 4096 å­—èŠ‚çš„å—ã€‚</p><p id="2962" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å®Œæˆäº†ï¼ï¼ï¼æ€»ä¹‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¥—æ¥å­—åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œè§£ææ¥è‡ªæµè§ˆå™¨çš„è¯·æ±‚ï¼Œæå–æ–¹æ³•ç±»å‹å’Œè¯·æ±‚è·¯å¾„ï¼Œå¹¶åŸºäºæ­¤æä¾›å“åº”ã€‚å¯¹äºä¸åŒçš„è·¯å¾„ï¼Œå¯ä»¥é‡å¤ç›¸åŒçš„è¿‡ç¨‹ã€‚</p><h2 id="a5bf" class="nd lb in bd lc ne nf dn lg ng nh dp lk kg ni nj lo kk nk nl ls ko nm nn lw no bi translated">æŸ¥çœ‹è¿è¡Œä¸­çš„ä»£ç :</h2><p id="9952" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">è¿è¡ŒæœåŠ¡å™¨ä»£ç ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥æœåŠ¡å™¨çš„åœ°å€(è¿™é‡Œæ˜¯<em class="mu"> localhost:5000/ </em>)ã€‚å®šä¹‰çš„ index.html åœ¨æµè§ˆå™¨ä¸­åŠ è½½å¹¶æ˜¾ç¤ºå…¶å†…å®¹ã€‚</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/c2e6abf65a2aa6f17e91989da0300eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WlVTfv0v1sLfGn6TiAiCA.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">è¾“å‡º</figcaption></figure></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="834a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åªå±•ç¤ºäº† GET è¯·æ±‚çš„å¤„ç†ã€‚å®ƒè¿˜å¯ä»¥æ‰©å±•åˆ°å¤„ç† POST è¯·æ±‚ã€‚æˆ‘ä»¬åªéœ€è§£æ POST è¯·æ±‚ï¼Œæå–åŒ…å«å‚æ•°çš„è·¯å¾„å’Œè¯·æ±‚ä½“ã€‚</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="a658" class="mm lb in mi b be mn mo l mp mq">POST request will have below format:<br/><br/>POST / HTTP/1.1<br/>Host: localhost:5000<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:69.0) Gecko/20100101 Firefox/69.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Content-Type: application/x-www-form-urlencoded<br/>Content-Length: 8<br/>Connection: keep-alive<br/>Referer: http://localhost:5000/<br/>Upgrade-Insecure-Requests: 1<br/><br/>name=asde&amp;age=17&amp;...</span></pre><blockquote class="mr ms mt"><p id="94fd" class="jv jw mu jx b jy jz ka kb kc kd ke kf mv kh ki kj mw kl km kn mx kp kq kr ks ig bi translated">å‚æ•°(ç”¨æˆ·æ•°æ®)å°†ä½äºè¯·æ±‚<strong class="jx io">çš„æœ«å°¾(ä¾‹å¦‚ã€‚name=asde &amp; age=17) </strong></p></blockquote></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="2946" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™ä¸€ç³»åˆ—çš„æœåŠ¡å™¨-å®¢æˆ·ç«¯å®ç°åˆ°æ­¤ç»“æŸã€‚å¦‚æœä½ åœ¨è¿™ä¸‰ä¸ªåšå®¢ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸­å‘ç°ä»»ä½•å›°éš¾ï¼Œé‚£ä¹ˆè¯·å‘è¡¨è¯„è®ºã€‚å¦‚æœæ‚¨å‘ç°ä»»ä½•é—®é¢˜æˆ–é”™è¯¯ä¿¡æ¯ï¼Œè¯·æŒ‡å‡ºæ¥ã€‚</p><p id="3252" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¡¨ç°å‡ºä¸€äº›æ¬£èµğŸ‘ğŸ‘å¦‚æœä½ è§‰å¾—è¿™ä¸ªåšå®¢æœ‰å¸®åŠ©ï¼Œè¯·ä¸ä½ çš„åŒäº‹åˆ†äº«ã€‚</p><p id="65a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ›´äº†è§£æˆ‘:ã€https://linktr.ee/yashpaneliyaã€‘T2</p></div></div>    
</body>
</html>