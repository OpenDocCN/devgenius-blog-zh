# Kubernetes åŸºç¡€ 5 åˆ†é’Ÿ

> åŸæ–‡ï¼š<https://blog.devgenius.io/kubernetes-basics-in-5-minutes-491a6d67448d?source=collection_archive---------7----------------------->

è¿›å…¥ kubernetes çš„ç®€å•æŒ‡å—

![](img/d3a60c8c2f9c96caa8a843d0d45a7e00.png)

# ä»€ä¹ˆæ˜¯ Kubernetes

Kubernetes æ˜¯å®¹å™¨ç¼–æ’å¼•æ“ã€‚kubernetes çš„ä¸»è¦ç›®çš„æ˜¯ç®¡ç†å®¹å™¨éƒ¨ç½²ã€‚ç›®å‰ï¼Œæ‰€æœ‰åº”ç”¨éƒ½åœ¨é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œè€Œä¸æ˜¯æ•´ä½“æ¶æ„ã€‚å®ç°å¾®æœåŠ¡æ¶æ„çš„ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡å®¹å™¨åŒ–æŠ€æœ¯ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒDocker é©æ–°äº†å®¹å™¨æŠ€æœ¯ã€‚æ‰€æœ‰çš„å¼€å‘è€…éƒ½ä½¿ç”¨å®¹å™¨æ¥æ„å»ºä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œä¸ºäº†å¤§è§„æ¨¡ç®¡ç†è¿™äº›å®¹å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ kubernetesã€‚

Kubernetes æœ€åˆç”±è°·æ­Œè®¾è®¡ï¼Œç°åœ¨ç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šç»´æŠ¤ã€‚

# Kubernetes çš„ä¸»è¦å·¥ä½œ

1.  æ‰©å±•éƒ¨ç½²
2.  è´Ÿè½½å¹³è¡¡
3.  ç›‘è§†
4.  è‡ªåŠ¨åŒ–æ¨å‡ºå’Œå›æ»š

# ç»ƒä¹  Kubernetes çš„æ–¹æ³•

1.  åœ¨äº‘ï¼ŒGKE(è°·æ­Œ Kubernetes å¼•æ“)åœ¨è°·æ­Œäº‘ã€‚
2.  Minikube :-è¦å®‰è£… [*ç‚¹å‡»è¿™é‡Œ*](https://kubernetes.io/docs/tasks/tools/install-minikube/)
3.  å’Œ Kubernetes ä¸€èµ·ç©

æˆ‘åœ¨ç”¨ Minikubeã€‚åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šå®‰è£… minikube å¾ˆå®¹æ˜“ã€‚

# Kubernetes çš„ç»“æ„

Kubernetes åˆ›é€ äº†ä¸€ä¸ªé›†ç¾¤ã€‚é›†ç¾¤åŒ…å«ä¸¤ç§ç±»å‹çš„ç»„ä»¶:-

1.  ä¸»ç½‘ç‚¹
2.  å·¥ä½œèŠ‚ç‚¹

æˆ‘ä»¬åœ¨å·¥ä½œè€…èŠ‚ç‚¹ä¸­éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚å·¥ä½œèŠ‚ç‚¹ä¸­çš„éƒ¨ç½²ç”±ä¸»èŠ‚ç‚¹æ§åˆ¶ã€‚

# **kubectl å‘½ä»¤**

è¿™æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶é›†ç¾¤çš„ CLI å‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä¸é›†ç¾¤è¿›è¡Œäº¤äº’ã€‚

# ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å’Œ podï¼Ÿ

èŠ‚ç‚¹åªä¸è¿‡æ˜¯è®¡ç®—å®ä¾‹ã€‚è¿™äº›è®¡ç®—å®ä¾‹åŒ…å« podã€‚

**Pods** è¢«è®¤ä¸ºæ˜¯ kubernetes é›†ç¾¤ä¸­çš„åŸºæœ¬æ‰§è¡Œå•å…ƒã€‚pod åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºçš„å®¹å™¨ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªå•å…ƒï¼Œä¸€ä¸ªå•å…ƒå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸åœ¨ä¸€ä¸ª pod ä¸­åªè¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚

æ‰€ä»¥åŸºæœ¬ä¸Šï¼Œkubernetes çš„å·¥ä½œæ˜¯ç®¡ç†è±†èšã€‚æˆ‘ä»¬å¯ä»¥ç”¨ kubectl å‘½ä»¤æ§åˆ¶è±†èšã€‚

## åˆ›å»ºçª—æ ¼

åœ¨ kubernetes ä¸­æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åˆ›å»ºä»»ä½•ä¸œè¥¿ã€‚å®ƒä»¬æ˜¯é€šè¿‡ä½¿ç”¨ kubectl å‘½ä»¤å’Œ yaml æ–‡ä»¶å®ç°çš„ã€‚

ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨ kubectl åˆ›å»ºä¸€ä¸ªè¿è¡Œ httpd å®¹å™¨çš„ podï¼Œå‘½ä»¤æ˜¯

```
kubectl run <podname> --image=httpd
```

å¯¹ YAML æ–‡ä»¶ä¹Ÿå¯ä»¥è¿™æ ·åš

```
apiVersion: v1
kind: Pod
metadata:
  name: mypod1
spec:
  containers:
  - name: httpd
    image: httpd
```

ç”¨ä»»ä½•åç§°ä¿å­˜æ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†å®ƒä¿å­˜ä¸º pod.yaml

```
kubectl create -f pod.yaml
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåœ¨å…¶ä¸­è¿è¡Œ httpd å®¹å™¨çš„ podã€‚

ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆ**ä¸»èŠ‚ç‚¹**çš„é…ç½®ã€‚

> **æ³¨**:ä¸»èŠ‚ç‚¹é€šå¸¸ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ç§°ä¸ºå·¥ä½œèŠ‚ç‚¹æˆ–ç®€ç§°èŠ‚ç‚¹ã€‚

# ä¸»ç½‘ç‚¹

ä¸»èŠ‚ç‚¹ç”±è®¸å¤šç»„ä»¶ç»„æˆã€‚ä¸»èŠ‚ç‚¹ä¹Ÿç§°ä¸ºæ§åˆ¶å¹³é¢ã€‚ä»–ä»¬æ˜¯

1.  kube-API-æœåŠ¡å™¨
2.  kube æ§åˆ¶å™¨
3.  kube-è°ƒåº¦ç¨‹åº
4.  etcd
5.  äº‘æ§åˆ¶å™¨

## **kube-api-server**

å®ƒæ˜¯ä¸»èŠ‚ç‚¹ä¸­çš„ä¸»è¦ç»„ä»¶ã€‚æ­¤ç»„ä»¶è¿æ¥åˆ°ä¸»æ§å½¢çŠ¶ä¸­çš„å…¶ä»–ç»„ä»¶ã€‚kube-api-server ç›‘å¬ kubectl å‘½ä»¤ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™æ‰€éœ€çš„ç»„ä»¶ã€‚

## kube-è°ƒåº¦ç¨‹åº

è¯¥ç»„ä»¶è´Ÿè´£éƒ¨ç½² podã€‚å®ƒè®¡åˆ’èŠ‚ç‚¹ä¸­çš„ pod éƒ¨ç½²ã€‚

## kube æ§åˆ¶å™¨

å®ƒçš„åŸºæœ¬åŠŸèƒ½æ˜¯ç›‘æ§åŠèˆ±ã€‚å…¶ä¸­æœ‰è®¸å¤šæ§åˆ¶å™¨ï¼Œå¦‚æ§åˆ¶èŠ‚ç‚¹æ•°é‡çš„èŠ‚ç‚¹æ§åˆ¶å™¨ã€ç»´æŠ¤æ‰€éœ€ pod å‰¯æœ¬çš„å¤åˆ¶æ§åˆ¶å™¨ã€‚

## etcd

è¿™æ˜¯ä¸€é¡¹å­˜å‚¨æœåŠ¡ã€‚å®ƒåŒ…å«é›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚å®ƒå¯ä»¥å……å½“é›†ç¾¤æ•°æ®çš„å¤‡ä»½å­˜å‚¨ã€‚

## äº‘æ§åˆ¶å™¨

å®ƒä¸äº‘äº¤äº’å¹¶ç»§æ‰¿å®ƒä»¬çš„ç‰¹å®šåŠŸèƒ½ã€‚äº‘æ§åˆ¶å™¨ç®¡ç†å™¨å…è®¸æ‚¨å°†é›†ç¾¤é“¾æ¥åˆ°äº‘æä¾›å•†çš„ APIï¼Œå¹¶å…è®¸æ‚¨ä»äº‘ç®¡ç†é›†ç¾¤ã€‚

# å·¥ä½œèŠ‚ç‚¹ç»„ä»¶

1.  åº“ä¼¯è±
2.  kube ä»£ç†

## åº“ä¼¯è±

è¦è¿è¡Œä¸€ä¸ª podï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­å®‰è£… kubeletã€‚kubelet åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­å¯åŠ¨å’Œç»´æŠ¤ podã€‚

## kube ä»£ç†

å®ƒè´Ÿè´£ä¸€ä¸ªèŠ‚ç‚¹ä¸­å„å•å…ƒä¹‹é—´çš„è”ç½‘ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ä¸º pod æä¾›è´Ÿè½½å¹³è¡¡

![](img/7e0336dc8791d716440e1cc54b9609fa.png)

åº“ä¼¯å†…ç‰¹å»ºç­‘

å› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹çš„ç»†èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬äº†è§£éƒ¨ç½²åœ¨èŠ‚ç‚¹ä¸Šçš„å¯¹è±¡çš„ç±»å‹ã€‚

# Kubernetes å¯¹è±¡

kubernetes å¯¹è±¡çš„ç±»å‹

1.  å¤åˆ¶æ§åˆ¶å™¨
2.  å¤åˆ¶é›†
3.  éƒ¨ç½²
4.  çŠ¶æ€é›†
5.  è¾¾è’™å¡ç‰¹
6.  ä¹”å¸ƒæ–¯

## å¤åˆ¶æ§åˆ¶å™¨

å®ƒç®¡ç†ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„å•å…ƒæ•°é‡ã€‚å¦‚æœä¸€ä¸ªå•å…ƒå‡ºç°æ•…éšœï¼Œå¤åˆ¶æ§åˆ¶å™¨ä¼šåˆ›å»ºå¦ä¸€ä¸ªå•å…ƒã€‚å®ƒç”¨æ ‡ç­¾æ¥æ£€æµ‹è±†èšã€‚ä»–ä»¬ä¸å†æ˜¯é¦–é€‰ã€‚ç›¸åï¼Œä½¿ç”¨å¤åˆ¶é›†ã€‚

## å¤åˆ¶é›†

å®ƒä»¬æ˜¯å¤åˆ¶æ§åˆ¶å™¨çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚å®ƒä»¬ä½¿ç”¨è®¾ç½®å±æ€§æ¥é€‰æ‹© podï¼Œè€Œå¤åˆ¶æ§åˆ¶å™¨ä½¿ç”¨ç›¸ç­‰å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é›†åˆå±æ€§æ¥ç¼–å†™è¡¨è¾¾å¼ï¼Œè¿™æ ·æ›´åŠ çµæ´»å’Œæ–¹ä¾¿ã€‚æ‰€ä»¥ä½¿ç”¨äº†å¤åˆ¶é›†ã€‚

## éƒ¨ç½²

éƒ¨ç½²ä½¿ç”¨å‰¯æœ¬é›†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½ã€‚ä»–ä»¬è´Ÿè´£æ¨å‡ºå’Œå›æ»šã€‚ä»–ä»¬ç»´æŠ¤ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚

## çŠ¶æ€é›†

å¦‚æœéœ€è¦éƒ¨ç½²ç»´æŠ¤æœ¬åœ°çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼ŒStatefulSet æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚StatefulSet å…·æœ‰å”¯ä¸€çš„æŒä¹…èº«ä»½ï¼Œå…·æœ‰ç¨³å®šçš„ç½‘ç»œèº«ä»½å’ŒæŒä¹…çš„ç£ç›˜å­˜å‚¨ã€‚

## è¾¾è’™å¡ç‰¹

å¦‚æœæ‚¨éœ€è¦åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹æˆ–ä¸€ç»„èŠ‚ç‚¹ä¸Šè¿è¡ŒæŸäº› podï¼Œè¯·ä½¿ç”¨ DaemonSetã€‚DaemonSet ç¡®ä¿ç‰¹å®šçš„ Pod å§‹ç»ˆåœ¨æ‰€æœ‰èŠ‚ç‚¹æˆ–éƒ¨åˆ†èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

## ä¹”å¸ƒæ–¯

ä½œä¸šæ§åˆ¶å™¨åˆ›å»ºè¿è¡Œä»»åŠ¡æ‰€éœ€çš„ä¸€ä¸ªæˆ–å¤šä¸ªçª—æ ¼ã€‚ä»»åŠ¡å®Œæˆåï¼ŒJob å°†ç»ˆæ­¢æ‰€æœ‰è¿™äº› podã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª CronJobï¼Œå®ƒæ ¹æ®æ—¶é—´è¡¨è¿è¡Œ Podsã€‚

åœ¨æ‰€æœ‰å¯¹è±¡ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯éƒ¨ç½²å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„éƒ¨ç½²å¯¹è±¡çš„ YAML æ–‡ä»¶ã€‚

```
apiVersion: apps/v1
kind: Deploymentmetadata:
  name: httpd
  labels:
    dc: IN
    env: devspec:
  replicas: 3
  selector:
    matchLabels:
      env: dev
  template:
    metadata:
      name: pod1
      labels:
        env: dev
    spec:
      containers:
      - name: mycon1
        image: httpd
        ports:
        - containerPort: 80
```

è®©æˆ‘ä»¬æŠŠå®ƒä¿å­˜ä¸º **web.yaml** ã€‚è¦åˆ›å»ºæ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤

```
kubectl apply -f web.yaml
```

1.  kubectl create = >åˆ›å»ºä¸€ä¸ª pod
2.  kubectl apply = >å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª podï¼Œå¦‚æœå·²ç»åˆ›å»ºï¼Œåˆ™æ›´æ–°ä¸€ä¸ª podã€‚

è¿™äº›æ˜¯ kubernetes å¯¹è±¡ï¼Œç”¨äºåœ¨èŠ‚ç‚¹ä¸Šéƒ¨ç½² podã€‚

# kubernetes çš„æœåŠ¡

æˆ‘ä»¬åœ¨ kubernetes ä½¿ç”¨ç½‘ç»œæœåŠ¡ã€‚æœ‰ä¸‰ç§ç±»å‹çš„æœåŠ¡ã€‚ä»–ä»¬æ˜¯

1.  ClusterIp
2.  èŠ‚ç‚¹ç«¯å£
3.  è´Ÿè½½å¹³è¡¡å™¨

## è´Ÿè½½å¹³è¡¡å™¨

è¿™æ˜¯ä¸€ç§ç”¨äºè¿æ¥èŠ‚ç‚¹å†…æ‰€æœ‰å•å…ƒçš„æœåŠ¡ã€‚å®ƒåœ¨èŠ‚ç‚¹ä¸­çš„ pod ä¹‹é—´åˆ†é…æµé‡ã€‚å®ƒé€‰æ‹©å¸¦æœ‰æ ‡ç­¾çš„è±†èšã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…·æœ‰ç›¸åŒæ ‡ç­¾çš„æ–° podï¼Œå®ƒä¼šè‡ªåŠ¨å½’å…¥è´Ÿè½½å¹³è¡¡å™¨æœåŠ¡ã€‚

## ClusterIP

è¿™æ˜¯é»˜è®¤çš„ kubernetes æœåŠ¡ã€‚æˆ‘ä»¬ä½¿ç”¨è¯¥æœåŠ¡æ¥è¿æ¥é›†ç¾¤ä¸­çš„æ‰€æœ‰å•å…ƒã€‚å¯ä»¥ä½¿ç”¨ kube-proxy è®¿é—®å®ƒã€‚

## èŠ‚ç‚¹ç«¯å£

è¯¥æœåŠ¡å‘å¤–éƒ¨å®¢æˆ·ç«¯å¼€æ”¾èŠ‚ç‚¹ã€‚å®ƒä¸ºä¸€ä¸ªèŠ‚ç‚¹æ‰“å¼€ä¸€ä¸ªç‰¹å®šçš„ç«¯å£ï¼Œå¹¶å°†æ‰€æœ‰æµé‡å‘é€ç»™è¯¥èŠ‚ç‚¹ä¸­çš„æœåŠ¡(è´Ÿè½½å¹³è¡¡å™¨)ã€‚æ‚¨åªèƒ½ä½¿ç”¨ 30000â€“32767 ç«¯å£ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ file æˆ– kubectl expose å‘½ä»¤åˆ›å»ºæœåŠ¡ã€‚

![](img/066ac89e6893ac6098455f867b755e21.png)

# kubectl å¸¸è§å‘½ä»¤

1.  kubectl get
2.  kubectl åˆ›å»º
3.  kubectl æè¿°

**ä¾‹å­**

```
kubectl get pods
kubectl get deployments
kubectl get serviceskubectl describe pods <podname> -o=wide
kubectl get pods <podname> -o=yaml
kubectl describe services 
```

[**ç‚¹å‡»æ­¤å¤„**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/) æŸ¥çœ‹ kubectl cheatsheetã€‚

å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œè¯·åˆ†äº«ã€‚ğŸ’–