<html>
<head>
<title>Find out how to ensure your git branch name is valid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解如何确保您的 git 分支名称有效</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/find-out-how-to-ensure-your-git-branch-name-is-valid-6930639eaaaa?source=collection_archive---------6-----------------------#2022-12-21">https://blog.devgenius.io/find-out-how-to-ensure-your-git-branch-name-is-valid-6930639eaaaa?source=collection_archive---------6-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="cbac" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">与大型团队合作的必要 git 验证</h2><div class=""/><div class=""><h2 id="c3d3" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">三个简单有效的解决方案</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/4cc6aae0a97adbcfbe32505ff8e7e864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*00B9mRhUA6CjlsOt"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">扎克·赖纳在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9f7c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在一个大型团队中使用 git 可能会很困难，即使你遵循了所有的最佳实践或像 git-flow 这样的分支策略，就个人而言，我讨厌我们有一堆具有不同名称或结构的分支，像<em class="mb">修复-按钮-屏幕-确认</em>、<em class="mb">专长-标签-用户名-欢迎</em>、<em class="mb">特性-组-视频-共享</em>等等，过一会儿你就会为找到你的分支名称而发生冲突。</p><p id="bd0f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我总是建议使用斜线来分隔三个重要的信息:代码、任务类型、用户名和吉拉入场券或者任务的简短描述。</p><p id="e66c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这里有几个例子，</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="46d3" class="mh mi iq md b be mj mk l ml mm">* feat/username/JIRA-123-new-username-label<br/>* fix/username/JIRA-321-login-crash<br/>* ci/username/JIRA-456-ci-branch-validation</span></pre><p id="b6e9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">任务的类型与传统的提交标准有关，如果你想有一个真正伟大的变更日志或者只是组织你的提交消息，这是非常重要的。<em class="mb">如果你想了解更多关于这个标准的信息，请点击此</em> <a class="ae le" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank"> <em class="mb">链接</em> </a> <em class="mb">。</em></p><p id="c516" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">有三个有效的解决方案来验证分支名称，我更喜欢第三个，但是如果您使用 CI/CD，第一个和第二个可能是很好的解决方案。</p><h2 id="4f54" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">第一种选择:正则表达式</h2><p id="83ae" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">如果您使用 javascript 之类的编程语言，这是验证分支名称的最简单方法。</p><p id="0aca" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正则表达式是一种搜索模式，用于在文本字符串中查找或替换匹配项。正则表达式可用于验证文本字符串是否满足特定标准，例如只允许特定的字母、数字和特殊字符。</p><p id="6e2d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要使用正则表达式来验证 Git 分支名称，首先需要定义想要使用的搜索模式。</p><p id="61e0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例子，</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="ad74" class="mh mi iq md b be mj mk l ml mm">/^(master|develop){1}$|^(feature|chore|fix)\/([\/\w\\-\\d]+)\/(JIRA|TIKET)-([\w\-\d]+)$/</span></pre><p id="26e1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个正则表达式接受我之前提到的结构，并且将<strong class="lh ja"> <em class="mb"> master </em> </strong>或<strong class="lh ja"> <em class="mb"> develop </em> </strong>作为分支的名称，但是您也可以定义自己的结构，<a class="ae le" href="https://regex101.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja"> Regex101 </strong> </a>是一个很好的 web，您可以在其中测试自己的正则表达式。</p><p id="458d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦定义了正则表达式，就可以使用正则表达式验证函数来检查分支名称是否与搜索模式匹配。在一些编程语言中，比如 JavaScript，这可以通过使用<em class="mb"> RegExp.test() </em>函数来完成。</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="ae38" class="mh mi iq md b be mj mk l nj mm">const regex = /^(master|develop){1}$|^(feature|chore|fix)\/([\/\w\\-\\d]+)\/(JIRA|TIKET)-([\w\-\d]+)$/;<br/>const branchName = "feature/francistec/JIRA-123-new-username-label";<br/><br/>if (regex.test(branchName)) {<br/>  console.log("Valid name");<br/>} else {<br/>  console.log("Wrong name");<br/>}</span></pre><p id="6467" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这种情况下，脚本的结果将是“有效名称”。</p><p id="ece5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您使用的 CI/CD 系统可以在启动之前运行脚本，比如 TeamCity 或 Jenkins，那么这个选项真的很好。</p><h2 id="90bb" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">第二个选项:检查参照格式</h2><p id="3254" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">第二个选项比上一个好，在我看来，如果有机会修改的话~/。gitconfig 文件。</p><p id="f39a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在开始使用这个选项之前，您应该修改文件~/。gitconfig 通过在<em class="mb">【core】</em>段中添加标志<em class="mb">【refspecFormat】</em>，就像这个例子<em class="mb"> : </em></p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="a9f9" class="mh mi iq md b be mj mk l ml mm">[core]<br/>  refspecFormat = /^(master|develop){1}$|^(feature|chore|fix)\/([\/\w\\-\\d]+)\/(JIRA|TIKET)-([\w\-\d]+)$/</span></pre><p id="1bf6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦您已经修改了这个文件，您将能够运行下一个命令:</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="f5a8" class="mh mi iq md b be mj mk l nj mm">git check-ref-format --branch feature/francistec/JIRA-123-new-username-label</span></pre><p id="1bdb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">同样，在您的 CI/CD 中，您可以在开始编译或部署之前执行脚本，如下所示:</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="e469" class="mh mi iq md b be mj mk l nj mm">if git check-ref-format --branch feature/francistec/JIRA-123-new-username-label then<br/>  echo "Valid name"<br/>else<br/>  echo "Wrong name"<br/>fi</span></pre><h2 id="7501" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">强壮的</h2><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/ecdc9606b4e0a8a2a40891d1a615413a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UCowVbfNR2lWJ3F0"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的<a class="ae le" href="https://unsplash.com/@gxldy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">灰</a>拍下</a></figcaption></figure><p id="ec26" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Husky 是一个帮助您增强 git 提交消息和推送操作的库。</p><p id="5d0e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Husky 将允许您添加自定义脚本来运行您的存储库，这些脚本可以用作 git 挂钩。</p><p id="adfb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">值得一提的是，Husky 只处理带有 package.json 文件的项目。</p><p id="3069" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个库的安装非常简单，您只需要运行下一个命令:</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="4488" class="mh mi iq md b be mj mk l ml mm">npm install husky --save-dev</span></pre><p id="407a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后，您需要修改 package.json，在脚本部分添加属性 prepare</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="8319" class="mh mi iq md b be mj mk l ml mm">"scripts" {<br/>    //.....<br/>    "prepare": "husky install",<br/>    //.....<br/>}</span></pre><p id="f532" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在展示使用 husky 验证分支名称的最后一步之前，我想向您展示一个 npm 库来验证分支名称。</p><h2 id="ca26" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">第三个选项:验证分支机构名称</h2><p id="627f" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">这个库可以与 Husky 一起使用，但也可以直接在命令行中使用，正如我们在第一个选项中看到的那样。</p><p id="ea4f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您将通过命令行使用该库，您应该在全局上下文中安装该库</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="323d" class="mh mi iq md b be mj mk l ml mm">$ npm i validate-branch-name -g</span></pre><p id="5ee6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您只是将它用作本地库，那么您应该运行</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="2f27" class="mh mi iq md b be mj mk l ml mm">$ npm i validate-branch-name -D</span></pre><p id="1749" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是一些通过命令行运行它的例子</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="fadc" class="mh mi iq md b be mj mk l ml mm">npx feature/francistec/JIRA-123-new-username-label<br/><br/># test target branch name<br/>npx validate-branch-name -t feature/francistec/JIRA-123-new-username-label<br/><br/># define regexp to test branch name<br/>npx validate-branch-name -r /^(master|develop){1}$|^(feature|chore|fix)\/([\/\w\\-\\d]+)\/(JIRA|TIKET)-([\w\-\d]+)$/ -t feature/francistec/JIRA-123-new-username-label<br/><br/># use -h for more usage detail<br/>npx validate-branch-name -h</span></pre><h2 id="f505" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">验证分支机构名称和哈斯基</h2><p id="eab1" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">好了，现在我们可以继续我们的哈士奇配置。正如您所注意到的，Husky 可以在提交消息之前作为钩子运行任何命令，validate-branch-name 是一个可以通过命令行执行的库。</p><p id="c1a9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要使用 husky 添加挂钩，您需要运行下一个命令:</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="cb06" class="mh mi iq md b be mj mk l ml mm">npx husky add .husky/pre-commit "npm test"</span></pre><p id="58e6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">不要忘记将这个文件添加到 git 存储库中。</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="e04d" class="mh mi iq md b be mj mk l ml mm">git add .husky/pre-commit</span></pre><p id="ed0f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，在每次提交之前，将执行命令“<em class="mb"> npm 测试</em>”。</p><p id="5f5d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">因此，如果您想使用 validate branch name，可以将命令“npm test”更改为 validate-branch-name 命令。</p><p id="95d3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您还想返回一条消息，告诉开发人员这条消息不正确，那么您也可以通过添加下一节来修改 package.json</p><pre class="kp kq kr ks gt mc md me bn mf mg bi"><span id="ac98" class="mh mi iq md b be mj mk l ml mm">  "validate-branch-name": {<br/>    "pattern": "^(master|develop){1}$|^(feature|chore|fix)\/([\/\w\\-\\d]+)\/(JIRA|TIKET)-([\w\-\d]+)$",<br/>    "errorMsg": "Please follow standard branch name, rename branch using: git branch -m &lt;oldname&gt; &lt;newname&gt;"<br/>  },</span></pre><p id="bf0d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这一节中，我定义了我想要使用的模式，并且通过提到重命名他们的分支的方法来帮助开发人员。</p><h2 id="2786" class="mn mi iq bd mo mp mq dn mr ms mt dp mu lo mv mw mx ls my mz na lw nb nc nd iw bi translated">结论</h2><p id="ef0c" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">有许多方法可以确保您的 git 分支名称遵循您的标准。我真的希望这篇文章能帮助人们有一个更好的组织，今天我向你展示了三种方法，我提出了一个模式，但是，你可以使用任何模式来帮助你组织你的团队。</p><p id="9b7b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这里重要的是让我们的工作更容易。</p></div></div>    
</body>
</html>