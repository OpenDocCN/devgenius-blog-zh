<html>
<head>
<title>Automation of reporting Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">报告自动化第 1 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/automation-of-reporting-2abe7f101801?source=collection_archive---------7-----------------------#2022-08-24">https://blog.devgenius.io/automation-of-reporting-2abe7f101801?source=collection_archive---------7-----------------------#2022-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c78a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我继续发表关于分析的文章:</p><ul class=""><li id="f5d0" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated"><a class="ae kr" href="/@alex.gladkikh/a-data-analysis-in-business-part-1-7f92c6e919e2" rel="noopener ugc nofollow" target="_blank">商业中的数据分析——BI 系统和可视化</a></li><li id="c82c" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="/@alex.gladkikh/analyses-of-product-metrics-dd4ec2df8590" rel="noopener ugc nofollow" target="_blank">产品指标分析</a></li><li id="b209" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="/@alex.gladkikh/а-b-tests-part-1-3-aa-test-d4eb7b8b1221" rel="noopener ugc nofollow" target="_blank">а/B 测试—第 1/3 部分(AA 测试)</a></li><li id="4459" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="/@alex.gladkikh/а-b-tests-part-2-3-aa-test-9728beaaa709" rel="noopener ugc nofollow" target="_blank">а/B-试验—第 2/3 部分(AB-试验)</a></li><li id="e4af" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="/@alex.gladkikh/a-b-tests-part-3-3-relationship-metrics-882afe43f130" rel="noopener ugc nofollow" target="_blank"> A/B 测试—第 3/3 部分(关系指标)</a></li><li id="def5" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated"><a class="ae kr" href="https://medium.com/@alex.gladkikh/building-an-etl-pipeline-airflow-2fd098cd61ae" rel="noopener">构建 ETL 管道(气流)</a></li></ul><p id="8d84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一系列文章中，我们将讨论基本报告的自动化。我们将在电报中设置报告的自动发送。</p><p id="b29f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如何创建机器人:</p><ol class=""><li id="f90b" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kx ko kp kq bi translated">首先，让我们使用<a class="ae kr" href="https://t.me/BotFather" rel="noopener ugc nofollow" target="_blank"> @BotFather 创建自己的电报机器人。</a></li><li id="f1a0" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kx ko kp kq bi translated">点击开始并发送命令<em class="ky"> /newbot。</em></li><li id="35bb" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kx ko kp kq bi translated">接下来，我们将输入未来 bot 的名称(我的 neme — Zmey56_test)。该名称可能不是唯一的，可以更改。</li><li id="4aba" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kx ko kp kq bi translated">然后输入机器人的昵称。昵称必须以单词“bot”结尾，并且是唯一的。这是无法改变的。</li></ol><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/66fa1cb96df9ea322f5b5a24af7d1364.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*ZE3KZdLR98UwTG8sRdYrtQ.png"/></div></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/0be80bbe5ec5a75c378df845422bc792.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*LCoXUCN_w0wzidWsHfM61g.png"/></div></figure><p id="f161" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们需要找到机器人将向其发送信息的 chat_id。需要注意的是，telegram 的配置使得 chat_id 对于个人聊天为正值，对于群组为负值。开始与机器人对话，允许他写私人信息。为此，请遵循链接 t.me / <nickname of="" the="" bot="">并启动 bot。要允许机器人写入聊天/频道，首先在那里添加机器人，并在频道设置中给它发送消息的权限。要获取 chat_id，请使用链接:<em class="ky">https://api.telegram.org/bot&lt;your _ bot token&gt;/get updates。</em>因此，您将收到以下回复，您可以在其中找到必要的 chat_id:</nickname></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/2c1a404a04a5bcc9eedfe6365ad5d1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0HMHsbwVXHYMZ5L3Pue5JA.png"/></div></div></figure><p id="6145" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们开始通过 python 管理 bot。为此，你需要安装<strong class="jm io">电报</strong>和<strong class="jm io"> python-telegram-bot </strong>库。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="703f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后，我们将检查我们的机器人如何工作。</p><p id="c220" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">获得访问机器人的权限</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="18ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">发送短信</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="409c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">发送图像</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="4721" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">发送文件</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="d59b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">值得注意的是，我从提供给我们的数据库中提取数据以形成文件。您可以从其他来源生成数据。</p><p id="4fd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的小组中的结果:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lp"><img src="../Images/2678f376addfad7ed93025d54e1e85ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkYbzOhUzlYW_nS1kIVHBQ.png"/></div></div></figure><p id="26a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们直接进入任务。它包括设置每天早上自动发送电报报告。该报告应包含:</p><ul class=""><li id="e6c0" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">包含前一天关键指标值(DAU、浏览量、点赞数、点击率)信息的文本</li><li id="9258" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">包含前 7 天指标值的图表</li></ul><p id="73fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们编写收集报告的主要函数:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="af92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">执行完这段代码后，我们的小组收到了以下报告:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lq"><img src="../Images/8ecdcdfed9d8a63f0dd1196b2b29f444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2utD0bgzcNCYM4giujJ2g.png"/></div></div></figure><p id="fd6a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们为我们的报告制作图表:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="f46e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我将在 feed_report 函数的末尾添加以下代码:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="9747" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在对我的代码进行测试检查之后，我在我的组中得到下面的图表:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lr"><img src="../Images/f1a76aab3879c48e12e9d66b311169d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jOHELmtt_KOEEm_0kicKA.jpeg"/></div></div></figure><p id="2826" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将四个图形合并成一个，以便为每个图形排除单独的消息，并且不打扰用户。</p><p id="ab22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于自动化，这次我们将使用 GitLab CI/CD。最好在官方文档中了解如何使用这个系统。你还需要知道什么是<a class="ae kr" href="https://www.educative.io/blog/beginners-guide-to-docker" rel="noopener ugc nofollow" target="_blank">码头工人</a>。</p><p id="0f5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了使我们的机器人的令牌在公共领域不可见，最好隐藏它。</p><p id="e696" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要隐藏 bot 令牌，您需要根据以下算法进行操作:</p><ul class=""><li id="805f" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">在 GitLab 中，进入设置-&gt; CI/CD -&gt;变量</li><li id="e75e" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">通过指定名称和值来添加秘密变量</li><li id="e84f" class="ki kj in jm b jn ks jr kt jv ku jz kv kd kw kh kn ko kp kq bi translated">在代码中，导入 os 库并用字符串 OS . environ . get(" REPORT _ BOT _ TOKEN ")替换 secret 变量的值</li></ul><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="3ad2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后，将文件上传到我们的存储库，并转到 CI/CD -&gt; Editor，在这里我们按下 Configure pipeline 键。之后，我们将提供一个模板。我们将清理它并创造我们自己的。</p><p id="8afb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我使用课程中的 docker 图像，阶段将是<em class="ky"> init </em>和<em class="ky"> run </em>。我们把这个作业叫做<em class="ky"> feed_report_job: </em></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="5411" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，转到时间表并创建发送报告的时间表。我选择了第比利斯(格鲁吉亚)时间上午 11 点。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ls"><img src="../Images/56ec9cdeb9928b8f969317d2d6f38eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RbPiOHPuerlTpOLB1NqcQ.png"/></div></div></figure><p id="4400" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后，您可以通过单击播放(三角形)按钮强制开始，并在您的小组中查看报告。</p><p id="8525" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文到此结束，在下一部分我们将继续讨论报告的自动化。</p><p id="6168" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我提醒你，我所有的作品你都可以看我的网站:<a class="ae kr" href="https://alex.gladkikh.org" rel="noopener ugc nofollow" target="_blank">https://alex.gladkikh.org</a>。</p></div></div>    
</body>
</html>