<html>
<head>
<title>How to Build Debian Packages with Meson/Ninja</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用介子/忍者构建 Debian 包</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-debian-packages-from-meson-ninja-d1c28b60e709?source=collection_archive---------0-----------------------#2021-05-08">https://blog.devgenius.io/how-to-build-debian-packages-from-meson-ninja-d1c28b60e709?source=collection_archive---------0-----------------------#2021-05-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/df91098588af5d9f4e9c8731ed1f3f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zAReLhYhat4nxa3P9zfxg.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="bec2" class="pw-subtitle-paragraph jv ix iy bd b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dk translated">最少二进制文件…</h2></div><p id="f030" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">作者注:</strong> <em class="lj">对于我的老读者，对不起，我知道这与我通常的内容不同，我应该是一名硬件工程师，但这太令人沮丧了，我不得不自己解决它，所以我给 stack overflow-answers 和 medium-blog-posts-on-very-specific-software-issues 的作者回信，因为我已经读了很多。另外，对于硬件工程师来说，处理 rando 固件问题是一件非常频繁的事情。当然，我也不是出于同样的原因付费，在阅读了许多试图解决类似问题的类似帖子后，我想回馈社区。开源万岁(是的，我知道，整件事充满了讽刺)。</em></p><p id="255d" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><em class="lj">我知道世界上只有 5 个人会欣赏这一点，但对这些人来说，这意味着全世界，就像类似的帖子对我的影响一样</em>😅<em class="lj">哇，社区❤ </em></p></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><p id="d7d2" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">也许你和我一样，是一名机械工程师或机电工程师，经常被卷入固件任务。假设有人给了你一个用 meson/ninja 构建的漂亮的 lil 软件包，但是<em class="lj">哦不，</em>你至少需要一个. deb 二进制包来实现版本控制/易于安装等等。</p><p id="8e30" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我这么说既是为了给我的创业伙伴一个大大的互联网拥抱，也是为了说明我现在没有也从来没有声称自己是一个真正的软件工程师，所以这是为了让你从 0 到 1，而不是从 1 到 100。明白了吗？</p><p id="cb5f" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">不建议用于生产(但是我们都已经将类似这样的东西投入生产，不要说谎。)</p><h1 id="c720" class="lr ls iy bd lt lu lv lw lx ly lz ma mb ke mc kf md kh me ki mf kk mg kl mh mi bi translated">从介子/忍者构建 Debian 二进制文件</h1><p id="7a20" class="pw-post-body-paragraph kn ko iy kp b kq mj jz ks kt mk kc kv kw ml ky kz la mm lc ld le mn lg lh li ig bi translated">最不幸的是，这将比<code class="fe mo mp mq mr b">checkinstall -i</code>或<code class="fe mo mp mq mr b">make -j4</code>更加手动。</p><p id="031b" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我强烈推荐阅读这篇<a class="ae ms" href="https://unix.stackexchange.com/questions/30303/how-to-create-a-deb-file-manually" rel="noopener ugc nofollow" target="_blank">Unix&amp;Linux stack exchange 帖子</a>，我把它收藏了起来，并在试图解决这个问题时没完没了地翻来覆去。它只是关于如何构建 Debian 软件包，我对此一无所知(它很短，不像我的漫谈):</p><div class="im in gp gr io mt"><a href="https://unix.stackexchange.com/questions/30303/how-to-create-a-deb-file-manually" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd iz gy z fp my fr fs mz fu fw ix bi translated">如何手动创建 DEB 文件？</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">我的建议是做一个源码包。安装 build-essential，debhelper，dh-make。转到目录…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">unix.stackexchange.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh iu mt"/></div></div></a></div><h2 id="3101" class="ni ls iy bd lt nj nk dn lx nl nm dp mb kw nn no md la np nq mf le nr ns mh nt bi translated">0.继续使用 gechyo Debian 构建工具…</h2><pre class="nu nv nw nx gt ny mr nz oa aw ob bi"><span id="2f24" class="ni ls iy mr b gy oc od l oe of">sudo apt-get install debhelper build-essentials dh-make</span></pre><ol class=""><li id="1ea4" class="og oh iy kp b kq kr kt ku kw oi la oj le ok li ol om on oo bi translated">然后，确保你已经用<code class="fe mo mp mq mr b">meson build</code>构建了你的包。</li><li id="141e" class="og oh iy kp b kq op kt oq kw or la os le ot li ol om on oo bi translated">如果您还没有，<code class="fe mo mp mq mr b">cd</code>进入您的目录——这是您的<code class="fe mo mp mq mr b">meson.build</code>所在的顶层文件夹，如果您最初在原型制作时做了类似于<code class="fe mo mp mq mr b">meson build --prefix=/somewhere/else/</code>的事情，不一定是您的可执行文件所在的位置。</li><li id="0380" class="og oh iy kp b kq op kt oq kw or la os le ot li ol om on oo bi translated">现在，你需要<code class="fe mo mp mq mr b">dh_make --createorig</code>。</li></ol><p id="2374" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">用“s”表示单个包装，用“Y”表示接受。</p><p id="93c1" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">Debian 希望你的包名有一定的格式。如果文件夹名称格式不正确或出现以下错误:</p><pre class="nu nv nw nx gt ny mr nz oa aw ob bi"><span id="d30b" class="ni ls iy mr b gy oc od l oe of">For dh_make to find the package name and version, the current directory<br/>needs to be in the format of &lt;package&gt;-&lt;version&gt;.  Alternatively use the -p flag using the format &lt;name&gt;_&lt;version&gt; to override it.<br/>The directory name you have specified is invalid!</span></pre><p id="1cc4" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">那么你应该做类似于<code class="fe mo mp mq mr b">dh_make --createorig -p example_0.0.1</code>的事情</p><p id="cf0c" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">4.<strong class="kp iz"> </strong>运行<code class="fe mo mp mq mr b">dh_auto_configure --buildsystem=meson</code>，等待过程结束。这是支持 meson/ninja 构建系统的一个关键特性，它最近才被整合到 debhelper 12 中，所以如果有错误，请确保您拥有正确的 debhelper 版本。</p><p id="b66c" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">5.<code class="fe mo mp mq mr b">dh_make</code>生成了<code class="fe mo mp mq mr b">debian/control /compat</code>等。包构建过程的文件。您可能希望在 auto_configure 之后编辑它们。关于何时编辑<code class="fe mo mp mq mr b">debian/rules</code>，请参见下面的“故障排除”。</p><p id="8e02" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">6.最后，您已经为<code class="fe mo mp mq mr b">dpkg-buildpackage -rfakeroot -us -uc -b</code>构建。deb(<code class="fe mo mp mq mr b">-b</code>标志只构建二进制文件)。</p><figure class="nu nv nw nx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ou"><img src="../Images/9da525523affb3014a6cffe47d29460e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-lDonPd6u6qesulG.jpg"/></div></div><figcaption class="ov ow gj gh gi ox oy bd b be z dk translated">我无耻地从:<a class="ae ms" href="https://medium.com/@galaktyk01/how-to-build-opencv-with-gstreamer-b11668fa09c" rel="noopener">https://medium . com/@ galaktyk 01/how-to-build-opencv-with-gstreamer-b 11668 fa 09 c</a>那里窃取了这个想法</figcaption></figure><h1 id="fc2d" class="lr ls iy bd lt lu lv lw lx ly lz ma mb ke mc kf md kh me ki mf kk mg kl mh mi bi translated">尽情享受吧！</h1><p id="3ba0" class="pw-post-body-paragraph kn ko iy kp b kq mj jz ks kt mk kc kv kw ml ky kz la mm lc ld le mn lg lh li ig bi translated">你做到了！恭喜你。包装是一门神奇的黑暗艺术，我还没有完全理解。</p><p id="5121" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">请注意，这将设置安装类似于<code class="fe mo mp mq mr b">dpkg -i examplepack_0.0.1-arch.deb</code>的目录，并将东西放入<code class="fe mo mp mq mr b">/usr/local</code>。</p><p id="5479" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">如果您尝试<code class="fe mo mp mq mr b">dpkg -x</code>到一个本地文件夹，可执行文件将无法正常运行，即使您的初始 meson/ninja 目录可能已经配置为在本地运行。因为这个小小的差异，我认为我已经错误地做了整整两天了。</p><p id="de41" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">希望我达到了自己的标准:</p><figure class="nu nv nw nx gt ip"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h1 id="f66a" class="lr ls iy bd lt lu lv lw lx ly lz ma mb ke mc kf md kh me ki mf kk mg kl mh mi bi translated">附录:故障排除</h1><p id="82f9" class="pw-post-body-paragraph kn ko iy kp b kq mj jz ks kt mk kc kv kw ml ky kz la mm lc ld le mn lg lh li ig bi translated">如果测试和依赖项检查失败，您可能希望通过重写两者来强制构建。有时会发生这种情况<em class="lj">特别是</em>当软件是在 PC 上构建的，但您的目标系统是嵌入式处理器时——当某些硬件不存在时，某些测试可能会失败(如显示器/摄像头检查)。对于自定义版本的库，依赖项检查也可能会失败。</p><p id="2b45" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这是绝对不建议生产，但嘿，世界是你的燃烧。</p><p id="2119" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">您可以通过将上面的#5 更改为:</p><p id="2c30" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><code class="fe mo mp mq mr b">DEB_BUILD_OPTIONS='nocheck' dpkg-buildpackage -rfakeroot -us -uc -b</code></p><p id="0191" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">您可以通过格式化您的<code class="fe mo mp mq mr b">rules</code>文件来覆盖依赖性检查，如下所示:</p><pre class="nu nv nw nx gt ny mr nz oa aw ob bi"><span id="048f" class="ni ls iy mr b gy oc od l oe of">%:<br/> dh $@</span><span id="b4ba" class="ni ls iy mr b gy pb od l oe of"><br/>override_dh_shlibdeps: <br/>      dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info</span></pre><p id="85eb" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">不要复制/粘贴上面的内容，因为<code class="fe mo mp mq mr b">rules</code>很挑剔，你必须确保<code class="fe mo mp mq mr b">dh_shlibdeps</code>前面的空格实际上是一个单独的<strong class="kp iz"> tab </strong>键——你可能还需要删除任何<strong class="kp iz"> enter </strong>键的空格(我认为<strong class="kp iz"> shift+enter </strong>应该没问题)。如果遇到与<code class="fe mo mp mq mr b">debian/rules</code>相关的错误，不要害怕尝试几次重新格式化空白。如果您没有编辑由<code class="fe mo mp mq mr b">dh_make</code>生成的文件，它可能看起来更像这样:</p><pre class="nu nv nw nx gt ny mr nz oa aw ob bi"><span id="13bc" class="ni ls iy mr b gy oc od l oe of"># see ENVIRONMENT in dpkg-buildflags(1)<br/># package maintainers to append CFLAGS<br/>#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic<br/># package maintainers to append LDFLAGS<br/>#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed</span><span id="f503" class="ni ls iy mr b gy pb od l oe of">%:<br/> dh $@</span><span id="34c2" class="ni ls iy mr b gy pb od l oe of"># dh_make generated override targets<br/># This is example for Cmake (See <a class="ae ms" href="https://bugs.debian.org/641051" rel="noopener ugc nofollow" target="_blank">https://bugs.debian.org/641051</a> )<br/>#override_dh_auto_configure:<br/># dh_auto_configure -- # -DCMAKE_LIBRARY_PATH=$(DEB_HOST_MULTIARCH)<br/>override_dh_shlibdeps: <br/>   dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info</span></pre></div></div>    
</body>
</html>