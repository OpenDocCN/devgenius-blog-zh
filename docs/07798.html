<html>
<head>
<title>Writing e2e Tests for React Apps with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Cypress 编写 React 应用的 e2e 测试</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/writing-e2e-tests-for-react-apps-in-cypress-47bf9d232d2?source=collection_archive---------1-----------------------#2022-04-24">https://blog.devgenius.io/writing-e2e-tests-for-react-apps-in-cypress-47bf9d232d2?source=collection_archive---------1-----------------------#2022-04-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/efa860e8f529091bf2e948eaca73e376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MvmWhcWk6dZx-v1UsSSgMQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">自动化测试</figcaption></figure><p id="8836" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">软件测试在软件开发过程中起着至关重要的作用。我喜欢伟大的亚里士多德下面的这句话，它适用于现代世界中作为软件开发人员的我们。</p><blockquote class="kx ky kz"><p id="68d1" class="jz ka la kb b kc kd ke kf kg kh ki kj lb kl km kn lc kp kq kr ld kt ku kv kw ig bi translated">“品质不是一种行为，而是一种习惯”——亚里士多德</p></blockquote><p id="a003" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">忽视测试是一个常见的问题，作为开发人员，我们需要有意识地克服它。在这篇文章中，我将给你一个关于 Cypress 的简要概述，这是一个超级快速和直观的端到端测试 web 应用程序的方法。但是在我们学习 Cypress 之前，我们需要理解端到端测试到底是什么。</p><h1 id="1381" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是端到端测试？</h1><p id="ee0b" class="pw-post-body-paragraph jz ka in kb b kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw ig bi translated">端到端测试用于测试应用程序的整个流程。端到端测试的目标是像最终用户一样与应用程序进行交互。手工端到端测试仍然在几个开发团队中实施。这意味着，QAs 和开发人员必须手动点击应用程序并测试其流程。正如您所预料的，这需要花费大量的时间，并且容易出错。我们可能很容易错过测试某些工作流程，并有未被发现的错误。</p><p id="316b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">自动化端到端测试，通过模拟真实的用户场景，从头到尾测试一个应用程序。</p><p id="ae70" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">良好的自动化端到端测试的好处包括:</p><ul class=""><li id="b447" class="mh mi in kb b kc kd kg kh kk mj ko mk ks ml kw mm mn mo mp bi translated">在早期捕捉 bug</li><li id="ac58" class="mh mi in kb b kc mq kg mr kk ms ko mt ks mu kw mm mn mo mp bi translated">节省花费在手动测试上的时间</li><li id="7ce4" class="mh mi in kb b kc mq kg mr kk ms ko mt ks mu kw mm mn mo mp bi translated">高质量软件</li></ul><h1 id="2a33" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">柏树是什么？</h1><p id="d63a" class="pw-post-body-paragraph jz ka in kb b kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw ig bi translated">Cypress 是一个快速、简单、可靠的端到端测试框架，适用于在您的浏览器上运行的任何东西。<a class="ae mv" href="https://docs.cypress.io/guides/overview/why-cypress" rel="noopener ugc nofollow" target="_blank"> Cypress </a>开源，用 JavaScript 编写。传统上，端到端测试通常更慢，更昂贵。有了 Cypress，端到端的测试体验有了显著的改善。</p><p id="775f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Cypress 提供了完整的端到端测试体验，可以测试在浏览器上运行的任何东西</p><p id="1ec3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">柏树的好处:</p><ul class=""><li id="c473" class="mh mi in kb b kc kd kg kh kk mj ko mk ks ml kw mm mn mo mp bi translated">更快的</li><li id="8494" class="mh mi in kb b kc mq kg mr kk ms ko mt ks mu kw mm mn mo mp bi translated">简单设置</li><li id="5047" class="mh mi in kb b kc mq kg mr kk ms ko mt ks mu kw mm mn mo mp bi translated">易于编写和运行测试</li><li id="53f5" class="mh mi in kb b kc mq kg mr kk ms ko mt ks mu kw mm mn mo mp bi translated">总的来说，开发团队编写端到端测试的成本更低。</li></ul><p id="edb0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Cypress 提供了一些很棒的功能，比如时间旅行调试，自动等待，还有截图和视频。</p><h1 id="acd0" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Cypress 设置</h1><p id="5cd7" class="pw-post-body-paragraph jz ka in kb b kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw ig bi translated">使用 Cypress 进行设置非常简单。要将 Cypress 集成到您的项目中，您可以使用下面的命令安装它。根据你是使用<em class="la"> npm </em>还是<em class="la"> yarn </em>你可以使用任何一个命令来安装。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a6c6" class="nf lf in nb b gy ng nh l ni nj">npm install cypress --save-dev<br/>or<br/>yarn add cypress --dev</span></pre><p id="76f3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在 VS 代码上，有一个很棒的 Cypress 插件，名为<a class="ae mv" href="https://marketplace.visualstudio.com/items?itemName=andrew-codes.cypress-snippets" rel="noopener ugc nofollow" target="_blank"> Cypress Snippets </a>。确保安装它，并且它可以在 VS 代码中为您的 Cypress 代码提供代码片段。</p><p id="1392" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">默认情况下，如果您在现有项目中集成 Cypress，它会在主<strong class="kb io"> cypress <em class="la"> </em> </strong>文件夹中生成子文件夹。文件夹结构如下图所示，包含夹具、集成、插件和支持的文件夹。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/dbf1b6ef4902d5b7d3f8f31ab6d9fa92.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*VYlikJyQWli53ntTIotZLg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">柏树文件夹结构</figcaption></figure><p id="3aa8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">集成文件夹是您添加 Cypress 测试文件的地方。您会注意到 integration 文件夹有两个子文件夹，它们基本上是 cypress 提供给您参考的示例测试。</p><p id="0937" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，您会注意到项目根目录下的 Cypress.json 文件。您可以在这里为 cypress 添加全局配置。我已经设置了一个基本 url 属性并排除了示例测试文件夹。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/71e3fd341f97af35da5ad0ee184042cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSpaOpH6vuhzlAzHCwpYxg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Cypress 配置</figcaption></figure><p id="8169" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Cypress 建议我们使用“data-cy”属性来定位元素。所以我们基本上添加了一个函数，它将根据元素的属性“data-cy”来获取元素。我已经在我的 React 应用程序中添加了这些属性，如下所示。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/f978a2f2b5b8b2345ecdd4cffa71406b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2D-zuaLmHyYNYnW9wIgquw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">数据周期属性</figcaption></figure><p id="20b9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在编写测试之前，我将添加一个自定义命令，这将为我们节省大量时间。在支持文件夹中，您会发现一个名为“commands.js”的文件。添加以下内容。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="5af0" class="nf lf in nb b gy ng nh l ni nj">Cypress.Commands.add('getByTestId', function (id, index = 0) {<br/>       cy.get(`[data-cy=${id}]`).eq(index);<br/>});</span></pre><p id="adb5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">“get”命令获取具有此属性的元素数组。因此，通过提供默认索引，我确保总是获取第一个元素，以防万一，同时如果需要，还可以获取另一个具有不同索引的元素。</p><h1 id="4a92" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">编写您的第一个 e2e 测试</h1><p id="c1c3" class="pw-post-body-paragraph jz ka in kb b kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw ig bi translated">我已经在 localhost: 3000 上运行了一个 React 应用程序，它具有登录和注销功能。因此，让我们编写一个 e2e 测试来访问本地主机，登录然后注销。在集成文件夹中，创建一个扩展名为“. spec.js”的规范文件。我把它命名为“登录和注销. spec.js”。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d8de" class="nf lf in nb b gy ng nh l ni nj">/// &lt;reference types="cypress" /&gt; </span><span id="d088" class="nf lf in nb b gy nm nh l ni nj">describe('login and logout', () =&gt; {<br/>   it('login', () =&gt; {<br/>   cy.visit('/');<br/>   cy.getByTestId('username').type('user123');<br/>   cy.getByTestId('password').type('pass123');<br/>   cy.getByTestId('submit').click();<br/>   });<br/>});</span></pre><p id="cd69" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意，测试使用了像<em class="la">这样的关键字来描述</em>和<em class="la"> it。从其他测试框架来看，这些可能对你来说也很熟悉。它们来自另一个流行的测试框架<a class="ae mv" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>。所有 Cypress 命令都以<em class="la"> cy 开头。</em>后跟命令的名称。然后在你的终端中，运行“npx cypress open”来打开 Cypress GUI。这里你会看到你写的所有测试。点击任何人开始跑步。</em></p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/42aa4513f29e31d558196cf1dbfd5c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcJd-u1HuMPhhLMFappMHw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">柏桂</figcaption></figure><p id="1c3a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您将会注意到 Cypress 测试运行的速度有多快，并且您还可以看到 Cypress 如何像真实用户一样与应用程序进行交互。在左侧，您可以看到正在执行的测试以及显示的每个命令和断言，在右侧，您可以看到浏览器打开并运行应用程序。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/e7f217228c573bbc32fc232be8017a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vu63ZTJ1GiVUegZv4HxlKQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">成功登录</figcaption></figure><p id="0b4d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> Cypress 命令是异步的。</strong>理解 Cypress 命令在被调用时不做任何事情，而是将它们自己排队等待以后运行，这一点非常重要。这就是我们说 Cypress 命令是异步的意思。这意味着我们可以模拟 API 调用，而不需要添加任何特殊的东西。现在让我们添加注销测试。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="ff6d" class="nf lf in nb b gy ng nh l ni nj">/// &lt;reference types="cypress" /&gt;</span><span id="eca1" class="nf lf in nb b gy nm nh l ni nj">describe('login and logout', () =&gt; {<br/>it('login', () =&gt; {<br/>   cy.visit('/');<br/>   cy.getByTestId('username').type('user123');<br/>   cy.getByTestId('password').type('pass123');<br/>   cy.getByTestId('submit').click();<br/>   });</span><span id="7071" class="nf lf in nb b gy nm nh l ni nj">it('logout', () =&gt; {<br/>  cy.getByTestId('home')<br/>  .should('exist').then(function (home) {<br/>        home.find('[data-cy=logout]').click();<br/>  });<br/>  cy.url().should('include', '/login');<br/>  });</span><span id="8c98" class="nf lf in nb b gy nm nh l ni nj">});</span></pre><p id="ef12" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">请注意，我在这里使用了一个断言来确保我们在主页上，即<em class="la"> cy.getByTestId('home ')。应该(' exist ')。</em>增加一个<em class="la">。然后将()</em>添加到您的命令链中，这将导致使用回调函数解析前面的命令，并将生成的主题作为第一个参数。<em class="la"> </em>然后在点击注销按钮后，我们断言 url 包含“/login”以确保我们在登录屏幕上。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/d423356d305d4df1c492b5fbe114cb60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPqBnAhZ1k3IN68p_wNopg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">成功的 e2e 测试</figcaption></figure><p id="0355" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这<strong class="kb io">结束了</strong>编写我们的第一个 e2e 测试。当然，我们只是在这里用柏树做了些皮毛。简单就是用更少的输入完成更多的工作。这就是柏树提供的东西。这只是让你熟悉 Cypress 的一个基本介绍。你可以在这里查看所有的命令<a class="ae mv" href="https://docs.cypress.io/api/commands/find" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>