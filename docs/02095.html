<html>
<head>
<title>GeoJson Decoder Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GeoJson 解码器集成</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/geojson-decoder-integration-e31228fdeb0?source=collection_archive---------5-----------------------#2020-07-19">https://blog.devgenius.io/geojson-decoder-integration-e31228fdeb0?source=collection_archive---------5-----------------------#2020-07-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b07a562dae02ed80e7401ad5e2b55cbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c9UU5-HvOw2YXA_Z"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a45b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嘿！是的，这篇文章更多的是关于 2019 年推出的 GeoJson，由 iOS 13 支持。了解趋势和帮助行为室内地图 apple 在 WWDC_2019 中引入了 IMDF(室内制图数据格式)，并使用 GeoJson 将其解析到 MKMapKit 中。</p><p id="4150" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> MapKit </strong>是 iOS 设备上可用的强大 API，可以轻松显示地图、标记位置、增强自定义数据，甚至在顶部绘制路线或其他形状。</p><p id="b6ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">IDMF 在设计室内地图功能方面发挥了很大的作用。更多信息可以参考<a class="ae jz" href="https://developer.apple.com/videos/play/wwdc2019/245/" rel="noopener ugc nofollow" target="_blank">链接</a>。在这里，苹果也介绍了另一个会员注册和一些产生 IDMF 的先决条件。由于我不打算在这里详细讨论这一点，所以你可以通过上面的链接了解更多关于室内地图的注册和生成。</p><p id="852f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇文章中，我们将解析 GeoJson，显示点，多边形和折线。每种类型都符合从<code class="fe ky kz la lb b">MKGeoJSONFeature</code>让我们对 GeoJsonDecoder 有个大概的了解。当然，不要忘记导入地图工具包。</p><blockquote class="lc"><p id="b093" class="ld le in bd lf lg lh li lj lk ll kx dk translated"><strong class="ak">试试</strong>？MKGeoJSONDecoder()。解码(地理数据)</p></blockquote><p id="78ff" class="pw-post-body-paragraph ka kb in kc b kd lm kf kg kh ln kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx ig bi translated">GeoJsonDecoder 使开发人员从其他来源导入地图变得更加容易。在地图中导入叠加更有用。如今，在 MKMapKit 中很容易导入 GeoJson 文件。GeoJsonDecoder 将帮助从 JSON 中读取覆盖图，并将它们解码为<code class="fe ky kz la lb b">MKGeoJSONFeature</code>对象的集合。MKGeoJsonFeature 符合所有叠加类型，例如:</p><ol class=""><li id="b6f6" class="lr ls in kc b kd ke kh ki kl lt kp lu kt lv kx lw lx ly lz bi translated">MK 多点</li><li id="7dc3" class="lr ls in kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">MK 多重多边形</li><li id="778c" class="lr ls in kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">MK 多重多边形</li><li id="23cc" class="lr ls in kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">MK 多重注释</li><li id="0f41" class="lr ls in kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">MKPolygon</li><li id="ff02" class="lr ls in kc b kd ma kh mb kl mc kp md kt me kx lw lx ly lz bi translated">MKPolyline</li></ol><p id="420f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此 decoder 帮助将 JSON 解码为上述任何对象，并且可以很容易地添加到地图中。</p><p id="1921" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GeoJson 必须有效。这是 GeoJson 的基本格式—</p><blockquote class="lc"><p id="0d04" class="ld le in bd lf lg lh li lj lk ll kx dk translated">{<br/>" type ":" feature collection "，<br/> "features": [] <br/> }</p></blockquote><p id="a6ae" class="pw-post-body-paragraph ka kb in kc b kd lm kf kg kh ln kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx ig bi translated">如果 Json 不像上面的例子，它将永远不会通过 GeoJsonDecoder 解析。GeoJsonDecoder 返回 3 个属性-</p><p id="a883" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> a. Geometry : </strong>这是[MKShape &amp; MKGeoJsonObject]类型，用于从 Json 获取覆盖对象。那些覆盖实例可以直接在地图中使用。</p><p id="e85c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> b .标识符:</strong>(可选字符串)</p><p id="c4d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> c. Properties: </strong>这是 Json 返回的可选数据。它将给出更多关于地图，覆盖，大头针等信息。这是用户控制的，可以自己解析。属性提供了除坐标以外的更多信息，如名称、颜色、图像等，它是用户可定制的。</p><p id="7a17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我相信这是太多的理论，让我们做一个小代码并理解它。并解析具有 2 个点和多边形的 GeoJson。<a class="ae jz" href="https://raw.githubusercontent.com/neophyteKB/GeoJson/master/GeoJsonSample/location.geojson" rel="noopener ugc nofollow" target="_blank">这里的</a>是 geojson 文件的例子。</p><p id="950d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里 GeoJsonDecoder 将返回[MKGeoJsonObject],如下所示:</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="fe81" class="mn mo in lb b gy mp mq l mr ms">func decode(_ data: <a class="ae jz" href="https://developer.apple.com/documentation/foundation/data" rel="noopener ugc nofollow" target="_blank">Data</a>) throws -&gt; [<a class="ae jz" href="https://developer.apple.com/documentation/mapkit/mkgeojsonobject" rel="noopener ugc nofollow" target="_blank">MKGeoJSONObject</a>]<!-- --> </span></pre><p id="9bb7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每个要素必须定义其类型，如点、多边形、折线等。下面是上述解码函数返回的一段代码:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/9df6b6a984e0a0026543e3a33ebc25fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdP_mmhP1tQew5m0KCHfZg.png"/></div></div></figure><p id="db8c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们必须检查每种类型，并将每种类型的组件解析为—</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/7466c54d015d33836c6cbb63eae9f02b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z80mkj3XnBECdmdI9aj0RQ.png"/></div></div></figure><p id="99a0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的例子中，我正在检查多边形，折线和 MKAnnotationPoint。您可以根据需要添加更多。我在 Presenter 中编写了上面的代码，让逻辑在那里进行计算。如你所见，我在每个渲染调用中都返回了一个对象信息。这是实例，将有助于设置每个单独的覆盖属性。请参见以下输出:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/da287211ab6ce2468159fb60f1949cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*4eDeQv2_AmnKfVhiUwnIxw.png"/></div></figure><p id="6aab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">地图包含 1 条折线、1 个多边形和 2 个注记点，因为 geoJson 的所有组件都已成功渲染。</p><p id="f680" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，如果你仔细观察，你会发现折线和多边形的颜色不同。因为我们只有一个委托方法来渲染所有的覆盖。</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="a074" class="mn mo in lb b gy mp mq l mr ms">optional func mapView(_ mapView: <a class="ae jz" href="https://developer.apple.com/documentation/mapkit/mkmapview" rel="noopener ugc nofollow" target="_blank">MKMapView</a>, <br/>          rendererFor overlay: <a class="ae jz" href="https://developer.apple.com/documentation/mapkit/mkoverlay" rel="noopener ugc nofollow" target="_blank">MKOverlay</a>) -&gt; <a class="ae jz" href="https://developer.apple.com/documentation/mapkit/mkoverlayrenderer" rel="noopener ugc nofollow" target="_blank">MKOverlayRenderer</a></span></pre><p id="ab6c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们已经完全相同地使用了每个组件的属性。让我们看看如何:</p><p id="adaf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我首先将属性保存在 MapVC 中:</p><p id="0503" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">私人</strong><strong class="kc io">var</strong>polygonInfo:polygonInfo？</p><p id="304d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">私有</strong><strong class="kc io">var</strong>polyline info:polyline info？</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/86f4021595509b175d04166fdae7d56b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*ZwQw3PmauxYC-_1mqf-46Q.png"/></div></figure><p id="438d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以现在在渲染叠加时，我使用保存的属性来设置它的颜色，笔画宽度等。</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/9180de1c04b6907d54b9b6dd62305390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfzDJIGstgb6okbCQTE5kw.png"/></div></div></figure><p id="2ba6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于两个覆盖图使用不同的渲染器方法渲染，所以我们可以分别设置属性。</p><p id="e9cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，这里我们几乎已经完成了在地图视图中渲染 geojson 所需的所有工作。</p><p id="642f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您也可以从公共存储库中访问代码。<a class="ae jz" href="https://github.com/neophyteKB/GeoJson" rel="noopener ugc nofollow" target="_blank">地质样品</a></p><p id="252a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">非常感谢您的评论和反馈！</p><p id="3d42" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">干杯！快乐编码:)</p></div></div>    
</body>
</html>