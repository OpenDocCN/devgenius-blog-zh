<html>
<head>
<title>Gatsby.js — Tags and Post Page</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —标签和帖子页面</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-tags-and-post-page-a6559a2c076b?source=collection_archive---------4-----------------------#2021-02-10">https://blog.devgenius.io/gatsby-js-tags-and-post-page-a6559a2c076b?source=collection_archive---------4-----------------------#2021-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9e345be42ebc2e4df6cc5db060ad1177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pX0rp4ZxySiOdpx6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@thetalkinglens?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Louie Martinez </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b0aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby是一个基于React的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Gatsby创建一个站点。</p><h1 id="3564" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">博客文章的标签页面</h1><p id="5be7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以为博客文章创建标签页。</p><p id="feec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们需要处理几个文件:</p><p id="fd17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fc73" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [<br/>    `gatsby-transformer-remark`,<br/>    {<br/>      resolve: `gatsby-source-filesystem`,<br/>      options: {<br/>        name: `content`,<br/>        path: `${__dirname}/src/content`,<br/>      },<br/>    },<br/>  ],<br/>}</span></pre><p id="0e6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a1f7" class="mq lc iq mh b gy mr ms l mt mu">const path = require("path")<br/>const _ = require("lodash")<br/>const { createFilePath } = require(`gatsby-source-filesystem`)<br/>exports.onCreateNode = ({ node, getNode, actions }) =&gt; {<br/>  const { createNodeField } = actions<br/>  if (node.internal.type === `MarkdownRemark`) {<br/>    const slug = createFilePath({ node, getNode, basePath: `pages` })<br/>    createNodeField({<br/>      node,<br/>      name: `slug`,<br/>      value: slug,<br/>    })<br/>  }<br/>}<br/>exports.createPages = async ({ actions, graphql, reporter }) =&gt; {<br/>  const { createPage } = actions<br/>  const blogPostTemplate = path.resolve("src/templates/post.js")<br/>  const tagTemplate = path.resolve("src/templates/tags.js")<br/>  const result = await graphql(`<br/>    {<br/>      postsRemark: allMarkdownRemark(<br/>        sort: { order: DESC, fields: [frontmatter___date] }<br/>        limit: 2000<br/>      ) {<br/>        edges {<br/>          node {<br/>            fields {<br/>              slug<br/>            }<br/>            frontmatter {<br/>              tags<br/>            }<br/>          }<br/>        }<br/>      }<br/>      tagsGroup: allMarkdownRemark(limit: 2000) {<br/>        group(field: frontmatter___tags) {<br/>          fieldValue<br/>        }<br/>      }<br/>    }<br/>  `)<br/>  if (result.errors) {<br/>    reporter.panicOnBuild(`Error while running GraphQL query.`)<br/>    return<br/>  }<br/>  const posts = result.data.postsRemark.edges<br/>  posts.forEach(({ node }) =&gt; {<br/>    const slug = node.fields.slug<br/>    createPage({<br/>      path: slug,<br/>      component: blogPostTemplate,<br/>      context: { slug },<br/>    })<br/>  })<br/>  const tags = result.data.tagsGroup.group<br/>  tags.forEach(tag =&gt; {<br/>    createPage({<br/>      path: `/tags/${_.kebabCase(tag.fieldValue)}/`,<br/>      component: tagTemplate,<br/>      context: {<br/>        tag: tag.fieldValue,<br/>      },<br/>    })<br/>  })<br/>}</span></pre><p id="8789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/templates/tags.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="33ea" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import PropTypes from "prop-types"<br/>import { Link, graphql } from "gatsby"</span><span id="6916" class="mq lc iq mh b gy mv ms l mt mu">const Tags = ({ pageContext, data }) =&gt; {<br/>  const { tag } = pageContext<br/>  const { edges, totalCount } = data.allMarkdownRemark<br/>  const tagHeader = `${totalCount} post${totalCount === 1 ? "" : "s"<br/>    } tagged with "${tag}"`<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;{tagHeader}&lt;/h1&gt;<br/>      &lt;ul&gt;<br/>        {edges.map(({ node }) =&gt; {<br/>          const { slug } = node.fields<br/>          const { title } = node.frontmatter<br/>          return (<br/>            &lt;li key={slug}&gt;<br/>              &lt;Link to={slug}&gt;{title}&lt;/Link&gt;<br/>            &lt;/li&gt;<br/>          )<br/>        })}<br/>      &lt;/ul&gt;<br/>      &lt;Link to="/tags"&gt;All tags&lt;/Link&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>Tags.propTypes = {<br/>  pageContext: PropTypes.shape({<br/>    tag: PropTypes.string.isRequired,<br/>  }),<br/>  data: PropTypes.shape({<br/>    allMarkdownRemark: PropTypes.shape({<br/>      totalCount: PropTypes.number.isRequired,<br/>      edges: PropTypes.arrayOf(<br/>        PropTypes.shape({<br/>          node: PropTypes.shape({<br/>            frontmatter: PropTypes.shape({<br/>              title: PropTypes.string.isRequired,<br/>            }),<br/>            fields: PropTypes.shape({<br/>              slug: PropTypes.string.isRequired,<br/>            }),<br/>          }),<br/>        }).isRequired<br/>      ),<br/>    }),<br/>  }),<br/>}<br/>export default Tags<br/>export const pageQuery = graphql`<br/>  query($tag: String) {<br/>    allMarkdownRemark(<br/>      limit: 2000<br/>      sort: { fields: [frontmatter___date], order: DESC }<br/>      filter: { frontmatter: { tags: { in: [$tag] } } }<br/>    ) {<br/>      totalCount<br/>      edges {<br/>        node {<br/>          fields {<br/>            slug<br/>          }<br/>          frontmatter {<br/>            title<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>`</span></pre><p id="c509" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/templates/post.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ffbb" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="073a" class="mq lc iq mh b gy mv ms l mt mu">export default function BlogPost({ data }) {<br/>  const post = data.markdownRemark<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;{post.frontmatter.title}&lt;/h1&gt;<br/>      &lt;div dangerouslySetInnerHTML={{ __html: post.html }} /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export const query = graphql`<br/>  query($slug: String!) {<br/>    markdownRemark(fields: { slug: { eq: $slug } }) {<br/>      html<br/>      frontmatter {<br/>        title<br/>      }<br/>    }<br/>  }<br/>`</span></pre><p id="1284" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/content/post.md</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7ae8" class="mq lc iq mh b gy mr ms l mt mu">---<br/>title: "A Trip To the Zoo"<br/>tags: ["animals", "Chicago", "zoos"]<br/>date: "2020-01-01"<br/>---<br/>I went to the zoo today. It was terrible.</span></pre><p id="d69a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">gatsby-config.js</code>中，我们添加了<code class="fe me mf mg mh b">gatsby-source-filesystem</code>插件来读取<code class="fe me mf mg mh b">src/content</code>文件夹中的降价文件。</p><p id="7987" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了<code class="fe me mf mg mh b">gatsby-transformer-remark</code>插件来将Markdown转换成HTML。</p><p id="2e24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，在<code class="fe me mf mg mh b">gatsby-node.js</code>中，我们用<code class="fe me mf mg mh b">onCreateNode</code>方法创建了<code class="fe me mf mg mh b">slug</code>字段。</p><p id="dff6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">createFilePath</code>函数从文件路径创建<code class="fe me mf mg mh b">slug</code>字段值。</p><p id="eeb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">createNodeField</code>来创建<code class="fe me mf mg mh b">slug</code>字段，其中对象的<code class="fe me mf mg mh b">name</code>设置为<code class="fe me mf mg mh b">'slug'</code>。</p><p id="b99e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该值是我们从<code class="fe me mf mg mh b">createFilePath</code>创建的slug字符串。</p><p id="7017" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">createPages</code>函数中，我们通过查询来获取帖子数据。</p><p id="f1dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">result.data.postRemark.edges</code>有帖子数据。</p><p id="9966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在它上面调用<code class="fe me mf mg mh b">forEach</code>,这样我们就可以在回调中的每个条目上调用<code class="fe me mf mg mh b">createPage</code>来创建页面。</p><p id="9fc2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">node.field.slug</code>具有我们从<code class="fe me mf mg mh b">onCreateNode</code>创建的废料值。</p><p id="ff2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">component</code>设置为<code class="fe me mf mg mh b">blogPostTemplate</code>，这样我们就可以显示该站点。</p><p id="2d74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后为了得到标签，我们使用了<code class="fe me mf mg mh b">result.data.tagsGroup.group</code>属性。</p><p id="db1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">slug</code>传递给第一个<code class="fe me mf mg mh b">forEach</code>中的<code class="fe me mf mg mh b">context</code>属性，以将数据传递给页面。</p><p id="893d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用再次调用<code class="fe me mf mg mh b">createPage</code>函数的回调来调用<code class="fe me mf mg mh b">forEach</code>。</p><p id="3e4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是这一次，我们用它来创建标签页。</p><p id="f6d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">path</code>是标签页面的URL。</p><p id="1139" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">component</code>拥有我们用来呈现标签页面的模板。</p><p id="89b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">context</code>有我们想要在标签页上呈现的数据。</p><p id="ed09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">tags.js</code>中，我们有了标签页面模板。</p><p id="3b79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">pageQuery</code>对象查询带有给定标签的项目。</p><p id="eb1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">tags</code>组件中，我们从<code class="fe me mf mg mh b">data</code> prop获取所有返回的数据。</p><p id="e280" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">edges</code>拥有带有给定标签的物品。</p><p id="0f7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">map</code>来呈现返回的内容。</p><p id="1657" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">slug</code>属性有slug。<code class="fe me mf mg mh b">title</code>有标题。</p><p id="d851" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为每个条目准备了<code class="fe me mf mg mh b">Link</code>组件，这样我们就可以转到给定slug的页面。</p><p id="9136" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">post.js</code>中，我们渲染页面。</p><p id="cc13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">data</code>道具的<code class="fe me mf mg mh b">markdownRemark</code>属性中获取数据。</p><p id="70c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们看到显示的数据。</p><p id="741c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">query</code>对象进行查询，以获得带有给定slug的帖子。</p><h1 id="dffa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="0baa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加一个标签页来显示带有给定标签的Markdown文件，并添加一个post页来显示带有Gatsby的给定slug的Markdown文件。</p></div></div>    
</body>
</html>