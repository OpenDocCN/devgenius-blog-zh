<html>
<head>
<title>Make Form Handling Easy in React Apps with Formik — Dependant Fields and Object Array Fields</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助 Formik 相关字段和对象数组字段，在 React 应用中轻松处理表单</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/make-form-handling-easy-in-react-apps-with-formik-dependant-fields-and-object-array-fields-984d3b1041da?source=collection_archive---------4-----------------------#2021-04-20">https://blog.devgenius.io/make-form-handling-easy-in-react-apps-with-formik-dependant-fields-and-object-array-fields-984d3b1041da?source=collection_archive---------4-----------------------#2021-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/405a571d45dd7ad896c6442bec09ecb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2FGAL70U4C_yWF9R"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@aleskrivec?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ales Krivec </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b6c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Formik 是一个使 React 应用程序中的表单处理变得简单的库。</p><p id="6bcb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Formik 处理表单输入</p><h1 id="079e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从属字段</h1><p id="d764" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以根据一个字段的值来设置另一个字段的值。</p><p id="9e16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b9ee" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { Formik, Field, Form, useField, useFormikContext } from "formik";</span><span id="9ffc" class="mn lc iq mj b gy ms mp l mq mr">const MyField = (props) =&gt; {<br/>  const {<br/>    values: { textA },<br/>    touched,<br/>    setFieldValue<br/>  } = useFormikContext();<br/>  const [field, meta] = useField(props);</span><span id="f0a9" class="mn lc iq mj b gy ms mp l mq mr">  React.useEffect(() =&gt; {<br/>    if (textA.trim() !== "" &amp;&amp; touched.textA) {<br/>      setFieldValue(props.name, `textA: ${textA}`);<br/>    }<br/>  }, [textA, touched.textA, setFieldValue, props.name]);</span><span id="0ff6" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;&gt;<br/>      &lt;input {...props} {...field} /&gt;<br/>      {!!meta.touched &amp;&amp; !!meta.error &amp;&amp; &lt;div&gt;{meta.error}&lt;/div&gt;}<br/>    &lt;/&gt;<br/>  );<br/>};</span><span id="07b8" class="mn lc iq mj b gy ms mp l mq mr">const initialValues = { textA: "", textB: "" };</span><span id="57ab" class="mn lc iq mj b gy ms mp l mq mr">export const FormExample = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;Formik<br/>      initialValues={initialValues}<br/>      onSubmit={async (values) =&gt; alert(JSON.stringify(values, null, 2))}<br/>    &gt;<br/>      &lt;Form&gt;<br/>        &lt;label&gt;<br/>          textA<br/>          &lt;Field name="textA" /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label&gt;<br/>          textB<br/>          &lt;MyField name="textB" /&gt;<br/>        &lt;/label&gt;<br/>        &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/Formik&gt;<br/>  &lt;/div&gt;<br/>);<br/>export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;FormExample /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="a07b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe mt mu mv mj b">MyField</code>组件，并使用<code class="fe mt mu mv mj b">useFormikContext</code>组件来获取<code class="fe mt mu mv mj b">textA</code>字段的状态。</p><p id="e375" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe mt mu mv mj b">values.textA</code>属性中获取它的值。</p><p id="a8a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">touched</code>有感动的价值。</p><p id="6149" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">setFieldValue</code>让我们设置另一个字段的字段值。</p><p id="a3f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们观察具有<code class="fe mt mu mv mj b">useEffect</code>回调的<code class="fe mt mu mv mj b">textA</code>字段的值和具有<code class="fe mt mu mv mj b">textA</code>字段值的数组，具有<code class="fe mt mu mv mj b">textA</code>、<code class="fe mt mu mv mj b">setFieldValue</code>和<code class="fe mt mu mv mj b">props.name</code>的已触摸状态的<code class="fe mt mu mv mj b">touched.textA</code>属性。</p><p id="5186" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们观察他们的变化。</p><p id="d5d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mt mu mv mj b">FormExample</code>中，我们使用<code class="fe mt mu mv mj b">MyField</code>来创建<code class="fe mt mu mv mj b">textB</code>字段。</p><p id="0de7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它观察<code class="fe mt mu mv mj b">textA</code>字段的变化，因此当我们在<code class="fe mt mu mv mj b">textA</code>字段中输入内容时，我们会看到用<code class="fe mt mu mv mj b">textA</code>的值设置的<code class="fe mt mu mv mj b">textB</code>的文本。</p><h1 id="c28c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">对象数组字段</h1><p id="cf46" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将字段绑定到对象数组。</p><p id="3234" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0678" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { Formik, Field, Form, FieldArray, ErrorMessage } from "formik";</span><span id="156c" class="mn lc iq mj b gy ms mp l mq mr">const initialValues = {<br/>  friends: [<br/>    {<br/>      name: "",<br/>      email: ""<br/>    }<br/>  ]<br/>};</span><span id="c189" class="mn lc iq mj b gy ms mp l mq mr">export const FormExample = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;Formik<br/>      initialValues={initialValues}<br/>      onSubmit={async (values) =&gt; {<br/>        await new Promise((r) =&gt; setTimeout(r, 500));<br/>        alert(JSON.stringify(values, null, 2));<br/>      }}<br/>    &gt;<br/>      {({ values }) =&gt; (<br/>        &lt;Form&gt;<br/>          &lt;FieldArray name="friends"&gt;<br/>            {({ remove, push }) =&gt; (<br/>              &lt;div&gt;<br/>                {values.friends.length &gt; 0 &amp;&amp;<br/>                  values.friends.map((friend, index) =&gt; (<br/>                    &lt;div className="row" key={index}&gt;<br/>                      &lt;div className="col"&gt;<br/>                        &lt;label htmlFor={`friends.${index}.name`}&gt;Name&lt;/label&gt;<br/>                        &lt;Field name={`friends.${index}.name`} type="text" /&gt;<br/>                        &lt;ErrorMessage<br/>                          name={`friends.${index}.name`}<br/>                          component="div"<br/>                          className="field-error"<br/>                        /&gt;<br/>                      &lt;/div&gt;<br/>                      &lt;div className="col"&gt;<br/>                        &lt;label htmlFor={`friends.${index}.email`}&gt;Email&lt;/label&gt;<br/>                        &lt;Field name={`friends.${index}.email`} type="email" /&gt;<br/>                        &lt;ErrorMessage<br/>                          name={`friends.${index}.name`}<br/>                          component="div"<br/>                          className="field-error"<br/>                        /&gt;<br/>                      &lt;/div&gt;<br/>                      &lt;div className="col"&gt;<br/>                        &lt;button<br/>                          type="button"<br/>                          className="secondary"<br/>                          onClick={() =&gt; remove(index)}<br/>                        &gt;<br/>                          X<br/>                        &lt;/button&gt;<br/>                      &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                  ))}<br/>                &lt;button<br/>                  type="button"<br/>                  className="secondary"<br/>                  onClick={() =&gt; push({ name: "", email: "" })}<br/>                &gt;<br/>                  Add<br/>                &lt;/button&gt;<br/>              &lt;/div&gt;<br/>            )}<br/>          &lt;/FieldArray&gt;<br/>          &lt;button type="submit"&gt;Invite&lt;/button&gt;<br/>        &lt;/Form&gt;<br/>      )}<br/>    &lt;/Formik&gt;<br/>  &lt;/div&gt;<br/>);</span><span id="2175" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;FormExample /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="6aff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是在<code class="fe mt mu mv mj b">Field</code>组件中将<code class="fe mt mu mv mj b">name</code>设置为我们想要绑定到的属性的路径。</p><p id="326d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们对<code class="fe mt mu mv mj b">ErrorMessage</code>字段进行同样的操作，以获得具有给定属性路径的字段的表单验证错误消息。</p><p id="b8bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要删除一个条目，我们可以使用 Formik 附带的<code class="fe mt mu mv mj b">remove</code>函数。</p><h1 id="1a43" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e30a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Formik 添加依赖字段并将字段绑定到一个对象数组。</p></div></div>    
</body>
</html>