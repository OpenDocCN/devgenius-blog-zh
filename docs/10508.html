<html>
<head>
<title>Real-time Streaming Analytics with Databricks Delta Live Table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用 Databricks Delta 实时表进行实时流分析</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/real-time-streaming-analytics-with-databricks-delta-live-table-574d7747acbd?source=collection_archive---------2-----------------------#2022-11-07">https://blog.devgenius.io/real-time-streaming-analytics-with-databricks-delta-live-table-574d7747acbd?source=collection_archive---------2-----------------------#2022-11-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="de9d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个故事中，让我们通过一个真实的例子来了解流式分析是多么有用。让我们看看如何使用 Apache Kafka、Databricks Delta Live 表和流数据分析等工具/技术来检测特定区域的 COVID 病例。</p><p id="1da4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是来自<a class="ae ki" href="https://2022.currentevent.io/website/39543/welcome" rel="noopener ugc nofollow" target="_blank"> Current.io(卡夫卡峰会 2022) </a>的一个现场演示的故事。在这里，我们可以看到基于模拟数据捐赠项目<a class="ae ki" href="https://corona-datenspende.de/science/en" rel="noopener ugc nofollow" target="_blank"> DDP </a>的数据接收、清理和转换，该项目建立在带有 Apache Kafka、Spark 结构化流和 Delta Live Tables(完全托管的服务)的 lakehouse 之上。</p><p id="4dcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">整个代码库由 databricks 开源发布，可以在<a class="ae ki" href="https://github.com/databricks/delta-live-tables-notebooks/tree/main/kafka-dlt-streaminganalytics" rel="noopener ugc nofollow" target="_blank">这里</a>找到。如果您熟悉 Kafka 和 Databricks delta live 表，请随意跳过。</p><h1 id="d0f7" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">体系结构</h1><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lh"><img src="../Images/ad8bf5ec27a174e3a59c92face2e3246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hb328TqO2x7YnPUwnUxJwg.png"/></div></div></figure><h1 id="d206" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">实施解决方案的步骤</h1><h2 id="a052" class="lt kk in bd kl lu lv dn kp lw lx dp kt jv ly lz kx jz ma mb lb kd mc md lf me bi translated">第一步</h2><p id="ee88" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">我们首先需要一个流媒体源。用户可以拥有用户管理的 apache kafka 或云托管的 apache kafka。出于学习目的，我建议使用云托管的 kafka，即融合云 Kafka，因为一旦你首次通过 google 或 github 登录，他们将提供 400 美元的免费信用 30 天。</p><p id="f229" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦您有了一个融合的 kafka 云登录，如果您没有看到一个<strong class="jm io">默认</strong>集群正在运行，请导航到环境部分并创建一个 Kafka 环境。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mk"><img src="../Images/0226bb029400b27594a9df0007dc9382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zP10pz9pEcoG3ADCelTHjw.png"/></div></div></figure><p id="a54a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦环境启动并运行，通过点击<strong class="jm io">默认</strong>环境导航到主题部分，并创建一个名为<strong class="jm io"> fitness-tracker </strong>的主题，并填充所有默认设置。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi ml"><img src="../Images/7de40c00d9cd8cc5c20342859f9721eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGlGMeSB5B8HP7Q_5_EePw.png"/></div></div></figure><p id="bbd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们需要从汇合门户获取一些细节，以便将消息传送到主题中，并从主题中读取消息。</p><p id="4dd7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导航到“Cluster Overview”部分，单击默认环境后即可看到该部分。</p><p id="9244" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从“Cluster Overview”下的列表中，单击“Cluster Settings”以捕获引导服务器详细信息。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mm"><img src="../Images/cdb5d74caf8bfdbc3e5fdeb91c5f07d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWmMd3rPyISXDIPCbkUHYA.png"/></div></div></figure><p id="6968" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在同一列表中，单击 API 密钥，生成新的 API 密钥，并捕获密钥(CLUSTER_API_KEY)和秘密(CLUSTER_API_SECRET)</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mn"><img src="../Images/a66b4243013ba1a672cea72e52806f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOww4F47pTNuPpEXerEV-A.png"/></div></div></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mo"><img src="../Images/f9b31742675d76322d6b114465a53cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVkYVqhNosewEyxqn4I2pA.png"/></div></div></figure><p id="9e4d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完成上述步骤后，我们将获得 bootstrap.servers、CLUSTER_API_KEY 和 CLUSTER_API_SECRET 的详细信息，这些信息对于通过 Python 客户端连接到融合云非常有用。</p><h2 id="c0c8" class="lt kk in bd kl lu lv dn kp lw lx dp kt jv ly lz kx jz ma mb lb kd mc md lf me bi translated">第二步</h2><p id="1b41" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">从 Databricks 工作区克隆<a class="ae ki" href="https://github.com/databricks/delta-live-tables-notebooks/tree/main/kafka-dlt-streaminganalytics" rel="noopener ugc nofollow" target="_blank"> github repo </a>。这将在您的工作区克隆 3 个笔记本。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/45c0966841e129f2157cdb7bb9501740.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*aqnon1Y_6wYSeffPpFcLAg.png"/></div></figure><p id="46e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> K-GenerateEvents </strong>是一款笔记本电脑，可以帮助生成类似于健身追踪器小工具的数据，并将其发布到融合云。通过输入相应的汇合细节来修改笔记本中的以下行，然后通过附加交互式 spark 集群来运行笔记本。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mq"><img src="../Images/37ac4df8fceb97e59707dae1b3c83129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-707LQ2reLyn-1iB-2AhA.png"/></div></div></figure></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><p id="5d5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> K-DLT-Python </strong>是使用 Delta Live 表从融合云接收消息、清理、聚合并将结果写入 Delta 表的笔记本。在笔记本的<strong class="jm io"> Cmd 4 </strong>中输入相应的汇合细节，修改汇合细节</p><p id="5115" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了执行此操作，请导航至工作流-&gt;增量实时表-&gt;创建管道，然后选择 K-DLT-Python 笔记本的路径。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi my"><img src="../Images/e894ddd7a7fc5dbe20d7b573d9cee2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NHPSYZvl5g58vh8rvv0zg.png"/></div></div></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi mz"><img src="../Images/0e991317c90dcbeb9f6800eb63b57f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*du6gr_lbzVFiaxXOMFInyg.png"/></div></div></figure><p id="71a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击<strong class="jm io"> Start </strong>按钮，开始从汇合处读取信息，并将数据写入 Delta 表。</p></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><p id="0b7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> K-StreamingDataAnalytics </strong>是一个 SQL 记事本，用于查询聚合或清理的数据，并可视化事件。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi na"><img src="../Images/47794a25b2ecab30254e202d4e9f2eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xkbZ1XmlTg_M0vFMNMVCQ.png"/></div></div></figure></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><p id="cef4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我推荐这篇文章和观看演示视频(参考资料部分提到了它的链接)给所有数据领域的新手和想要了解更多关于流用例的数据工程师。这种端到端的使用案例有助于理解流分析如何帮助用最少的工具集解决现实世界的问题。</p><p id="c2c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢 Databricks 和 Confluent 的精彩介绍:-)</p><h2 id="8796" class="lt kk in bd kl lu lv dn kp lw lx dp kt jv ly lz kx jz ma mb lb kd mc md lf me bi translated">参考</h2><figure class="li lj lk ll gt lm"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div></div>    
</body>
</html>