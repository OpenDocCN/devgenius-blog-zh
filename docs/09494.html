<html>
<head>
<title>Publish Golang Private Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发布 Golang 私有包</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/publish-golang-private-package-by-logic-1c1cce6042f9?source=collection_archive---------9-----------------------#2022-08-24">https://blog.devgenius.io/publish-golang-private-package-by-logic-1c1cce6042f9?source=collection_archive---------9-----------------------#2022-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f518" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">循序渐进和逻辑</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/396ecb1f8d69cf6b867a4dd5f46e35ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3Foxm8aYW6C2nHUi7YinQ.png"/></div></div></figure><h1 id="d451" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">包装逻辑介绍</h1><p id="c949" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">如果你有一个坚实的基础设施，你知道不应该有两个类做同样的工作。如果你没有坚实的基础，你知道定义变量或定义函数的重要性。这些都是类似的东西。当需要编辑时，不要在一个地方重新输入和更新，这样可以节省时间。</p><p id="a8b9" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们运行可以在不同文件中作为函数使用的代码。如果我们在不同的文件中定义了可重用的函数，并且我们需要在不同的应用程序中使用这些函数，该怎么办？</p><p id="61bf" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">如果你对这个话题做一些研究，你会发现你需要开发一个包并发送到服务器。如果您不知道这些包，请考虑理解这些包；创建函数是为了不同页面中某些代码块的可重用性，所以创建包是为了不同应用程序中函数的可重用性。</p><p id="2950" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">最常见的例子就是微服务。多个微服务可能需要相同的基础设施。例如，它可能需要相同的错误处理机制、身份验证方法或一些基本功能。将它们作为一个包发布比单独编写更有意义。</p><p id="7b6a" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">包由包服务保存在服务器上，并且可以与 cli 应用程序一起安装。打包服务提供商；如果使用 NodeJS，则为 npm，如果使用。Net 和…如果你用的是 golang？</p><h1 id="9228" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">Golang 如何处理包？</h1><p id="8865" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">Golang 处理外部包的逻辑不同于 NodeJS 或任何其他语言/框架处理包的逻辑。在 golang 中，我们用<code class="fe mh mi mj mk b">go get</code>命令安装包。所以实际上外卖是在围棋本身。</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="b10b" class="mp kp in mk b gy mq mr l ms mt">go get xxx/yyy</span></pre><p id="148c" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">另外，<code class="fe mh mi mj mk b">go get</code>命令根据您输入的名称搜索 Git(在本例中是<code class="fe mh mi mj mk b">xxx/yyy</code>)。这里 git 可以是任何使用 git 的应用程序(bitbucket、gitlab 或 github)。</p><p id="a93a" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">也可以在 npm 中创建私有包，但是需要付费订阅。由于 golang 直接使用 git 系统，如果你授权 go，你可以免费使用任何私有回购。</p><p id="9496" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们将在这篇文章的后面看到如何做到这一点。</p><h1 id="05a8" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">开发您自己的软件包</h1><h2 id="3c65" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">我们的方案能解决什么问题？</h2><p id="5b35" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">一个我们在开发 API 时应该注意的问题；我们所有的请求处理器都以相同的格式返回响应。现代 API 使用 JSON (JavaScript Object Notation ),在这个包示例中，我们将开发一个包含小结果类型和函数的核心包。</p><p id="3954" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们可以把它看作是我们微服务应用的一个通用包，以后再开发。所以结果只是我们包下的一个模块。</p><h2 id="3c8c" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">Go 应用程序初始化和包名</h2><p id="4c48" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">包命名很重要。因为当用户或者我们调用我们的包时，我们用名字来称呼它。golang 有一个命名惯例。一般来说，我们像<code class="fe mh mi mj mk b">go.mongodb.org/mongo-driver/mongo</code>一样把我们的包命名为<code class="fe mh mi mj mk b">host/packagename</code>或<code class="fe mh mi mj mk b">host/namespace/packagename</code>。</p><p id="0cf8" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">要启动我们的 Go 应用程序，我们将使用以下命令:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="be01" class="mp kp in mk b gy mq mr l ms mt">go mod init github.com/ssibrahimbas/micro-core</span></pre><p id="9328" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这里<code class="fe mh mi mj mk b">github.com</code>是我们发布包的域名，<code class="fe mh mi mj mk b">ssibrahimbas</code>是我的用户名(在这里输入你自己的用户名)，其中<code class="fe mh mi mj mk b">micro-core</code>部分是我们包的名称(你可以更改自己的包名)。</p><p id="81fe" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">当我们运行上面的命令时，我们的<code class="fe mh mi mj mk b">go.mod</code>文件将被创建。当你打开这个文件时，你会看到这样的代码</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="9706" class="mp kp in mk b gy mq mr l ms mt"><strong class="mk io">module </strong>github.com/ssibrahimbas/micro-core</span></pre><p id="fb8e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这是我们的模块名</p><h2 id="8a23" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">文件夹结构</h2><p id="0910" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们已经声明，在我们的包下将有一个名为 result 的文件夹。有一个由 Golang 社区设置并由包开发者实现的包结构。你可以在这里找到这个包结构<a class="ae nf" href="https://github.com/golang-standards/project-layout" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b5cc" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">在开发这个包时，我们将受益于这个结构。因此，我们将转到如下图所示的文件夹。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/973e96a3e41c59aa08151048892c7b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*0Z7Ca1kKMs9tdzVD3093Fw.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">文件夹结构</figcaption></figure><h2 id="4b73" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">编码</h2><p id="0776" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">现在让我们在<code class="fe mh mi mj mk b">result.go</code>文件中编写以下代码:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="c605" class="mp kp in mk b gy mq mr l ms mt"><strong class="mk io">package </strong>result<br/><br/><strong class="mk io">type </strong>Result <strong class="mk io">struct </strong>{<br/>   Success bool   `json:"success"`<br/>   Code    int    `json:"code"`<br/>   Message string `json:"message"`<br/>}<br/><br/><strong class="mk io">func </strong>Success(m string, c int) *Result {<br/>   <strong class="mk io">return </strong>&amp;Result{<br/>      Success: <em class="nl">true</em>,<br/>      Message: m,<br/>      Code:    c,<br/>   }<br/>}<br/><br/><strong class="mk io">func </strong>Error(m string, c int) *Result {<br/>   <strong class="mk io">return </strong>&amp;Result{<br/>      Success: <em class="nl">false</em>,<br/>      Message: m,<br/>      Code:    c,<br/>   }<br/>}</span></pre><p id="1e6b" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这里需要注意的是，我们文件第一行的包名和我们的文件夹名是相同的。</p><h2 id="1ef6" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">将包上传到 GitHub</h2><p id="2207" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">现在让我们创建一个与我们的项目同名的<em class="nl">私有</em> GitHub 存储库，并在命令行上运行以下代码</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="ed74" class="mp kp in mk b gy mq mr l ms mt">git init<br/>git add .<br/>git commit -m "first commit"<br/>git branch -M main<br/>git remote add origin https://github.com/ssibrahimbas/micro-core.git<br/>git push -u origin main</span></pre><p id="8dca" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">别忘了把 origin 换成自己的！</p><p id="8bcd" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">然后让我们创建一个发布并发布它</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="9083" class="mp kp in mk b gy mq mr l ms mt">git tag v0.1.0<br/>git push origin v0.1.0</span></pre><p id="d324" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">现在我们的存储库已经准备好了！现在我们将学习如何下载私人回购。</p><h2 id="30ca" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">将私人回购下载到应用程序</h2><p id="ec51" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">出于安全原因，私人回购不能直接上传。如果您打开另一个项目并运行以下命令，您将得到如下错误</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="a6e3" class="mp kp in mk b gy mq mr l ms mt">go get github.com/yourname/package</span></pre><p id="f5ac" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">结果:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="55ae" class="mp kp in mk b gy mq mr l ms mt">go get: module github.com/<!-- -->yourname<!-- -->/<!-- -->package<!-- -->: git ls-remote -q origin in /Users/<!-- -->yourname<!-- -->/go/pkg/mod/cache/vcs/2f8c...b9ea: exit status 128:<br/>	fatal: could not read Username for 'https://github.com': terminal prompts disabled<br/>Confirm the import path was entered correctly.<br/>If this is a private repository, see https://golang.org/doc/faq#git_https for additional information.</span></pre><p id="e17d" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">现在让我们打开<code class="fe mh mi mj mk b">~/.netrc</code>文件在 github 上授权 git</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="3e7d" class="mp kp in mk b gy mq mr l ms mt">code ~/.netrc</span></pre><p id="d3c3" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这里代码是你的编辑器，如果你不全局定义它，你可能会得到一个错误。表情<code class="fe mh mi mj mk b">~</code>。对应于您的家庭路径。因为我用的是 macOS <code class="fe mh mi mj mk b">~</code>替我换了这个。</p><p id="b92a" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">在这里，我们将输入以下代码</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="2252" class="mp kp in mk b gy mq mr l ms mt">machine github.com login &lt;your_username&gt; password &lt;your_github_access_token&gt;</span></pre><p id="811b" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">可以直接用空格粘贴。</p><p id="1186" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">你可以<a class="ae nf" href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" rel="noopener ugc nofollow" target="_blank">按照官方的 github 说明</a>来创建<code class="fe mh mi mj mk b">access_token</code>，这是不言自明的</p><p id="3619" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">最后运行以下命令</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="559e" class="mp kp in mk b gy mq mr l ms mt">export GOPRIVATE=github.com/your_username/project</span></pre><p id="0257" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">在这里，我们告诉 golang 我们的私人回购。如果你有一个以上的回购协议，你应该用逗号(<code class="fe mh mi mj mk b">github.com/your_username/project,github.com/your_username/project2</code>)把它们分开。</p><p id="72c4" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">现在关闭并重新打开您的终端/计算机/IDE 并运行命令</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="646f" class="mp kp in mk b gy mq mr l ms mt">go get github.com/your_username/project</span></pre><p id="a1b4" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">结果:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="63d3" class="mp kp in mk b gy mq mr l ms mt">go: downloading github.com/your_username/project v0.1.0</span><span id="5a86" class="mp kp in mk b gy nm mr l ms mt">go: added github.com/your_username/project v0.1.0</span></pre><h2 id="ab19" class="mp kp in bd kq mu mv dn ku mw mx dp ky lp my mz la lt na nb lc lx nc nd le ne bi translated">测试包</h2><p id="ef4f" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">现在我们已经从 github 下载了我们的包，放在我们开发的包之外的一个文件夹中，我们可以通过在新项目的<code class="fe mh mi mj mk b">main.go</code>文件中编写以下代码来测试我们的包。</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="ccce" class="mp kp in mk b gy mq mr l ms mt"><br/>package main</span><span id="49bc" class="mp kp in mk b gy nm mr l ms mt">import (</span><span id="20f5" class="mp kp in mk b gy nm mr l ms mt">"log"</span><span id="45c3" class="mp kp in mk b gy nm mr l ms mt">"github.com/ssibrahimbas/micro-core/pkg/result"</span><span id="8383" class="mp kp in mk b gy nm mr l ms mt">)</span><span id="c442" class="mp kp in mk b gy nm mr l ms mt">func main() {</span><span id="ee8b" class="mp kp in mk b gy nm mr l ms mt">   log.Fatal(result.Error("Not Found", 404))</span><span id="c6ea" class="mp kp in mk b gy nm mr l ms mt">}</span></pre><p id="a228" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">并使用以下命令运行</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="ac3f" class="mp kp in mk b gy mq mr l ms mt">go run .</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/0e8409bae844817d3ce85ae29e2cfb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1phOjaNfQ3DQrKjM8xv4w.png"/></div></div></figure><p id="f176" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">就是这样！我们的一揽子计划正在发挥作用。当我们用 JSON 输出时，我们会看到这一点。</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="12e3" class="mp kp in mk b gy mq mr l ms mt">{<br/>   "success": false,<br/>   "message": "Not Found"</span><span id="899c" class="mp kp in mk b gy nm mr l ms mt">}</span></pre><h1 id="6253" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">关闭</h1><p id="9232" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在这篇文章中，我们学习了为什么我们需要包，包服务是做什么的，golang 如何看待包系统，以及如何在 golang 中使用私有回购。</p><p id="8779" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">你可以在评论里指明我的缺点，要求或者任何东西。我一定会回答。</p><p id="140a" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">下一篇文章再见。</p></div></div>    
</body>
</html>