# ç”¨ PyCharm çš„äº¤äº’å¼è°ƒè¯•å™¨ä¸º Django ç¼–å†™æ›´å¥½çš„æµ‹è¯•

> åŸæ–‡ï¼š<https://blog.devgenius.io/write-better-tests-for-django-with-pycharms-interactive-debugger-1e55b49993f2?source=collection_archive---------5----------------------->

## PyCharm çš„äº¤äº’å¼è°ƒè¯•å™¨æ˜¯å¦‚ä½•æˆä¸ºæˆ‘å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå®è´µéƒ¨åˆ†çš„ï¼Œå®ƒä¹Ÿåº”è¯¥æˆä¸ºä½ çš„ä¸€éƒ¨åˆ†ã€‚

![](img/35c01c9020e29947367667290da00a19.png)

PyCharm çš„äº¤äº’å¼è°ƒè¯•å™¨å°†å¸®åŠ©æ‚¨æ›´å¿«åœ°ç¼–å†™æ›´å¥å£®çš„ä»£ç ï¼Œå¸®åŠ©æ‚¨ç†è§£å·¥ä½œæµï¼Œå¹¶æ›´å®¹æ˜“åœ°æ‰¾åˆ°å’Œè°ƒè¯•ä»£ç ä¸­çš„é”™è¯¯ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ PyCharm ä¸Šå®Œæˆä¸€ä¸ªåŸºæœ¬çš„ Django é¡¹ç›®çš„è®¾ç½®ã€‚æˆ‘ä»¬å°†å®‰è£…`pytest`å¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†å…¶å¯ç”¨ä¸ºé»˜è®¤çš„æµ‹è¯•è¿è¡Œç¨‹åºã€‚æœ€åï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨è°ƒè¯•å™¨æ¥æŸ¥æ‰¾å’Œä¿®å¤ä¸€äº›é”™è¯¯ï¼Œä»¥åŠå¦‚ä½•åœ¨æ‚¨çš„æ—¥å¸¸å¼€å‘å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨å®ƒã€‚æœ€åè¿˜æœ‰å¥–é‡‘ï¼Œæ‰€ä»¥ä¸è¦èµ°ã€‚

å¦‚æœé˜…è¯»ä¸é€‚åˆä½ ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªçŸ­è§†é¢‘ã€‚

# é¡¹ç›®è®¾ç½®

è¿™ç¯‡æ–‡ç« ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥ç”¨ PyCharm çš„ç¤¾åŒºç‰ˆæ¥å®Œæˆï¼Œæ‰€ä»¥è¯·ç›´æ¥ä»ä»–ä»¬çš„ç½‘ç«™ä¸Šä¸ºæ‚¨çš„ç³»ç»Ÿä¸‹è½½çš„å…è´¹ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨éµå¾ªé»˜è®¤çš„å®‰è£…è¯´æ˜ï¼Œå‡ åˆ†é’Ÿåæ‚¨å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ã€‚æˆ‘ä»¬æ˜¾ç„¶éœ€è¦ä¸€ä¸ªé¡¹ç›®æ¥åˆä½œï¼Œæˆ‘å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œä½ å¯ä»¥ä» [Github](https://github.com/the-nonlinearity/your-first-django-app/tree/start) æ‹‰ã€‚è¯¥é¡¹ç›®åŸºäº[ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª Django åº”ç”¨](https://docs.djangoproject.com/en/3.2/intro/tutorial01/)æ•™ç¨‹ï¼Œä½ å¯ä»¥åœ¨ä»–ä»¬çš„ç½‘ç«™ä¸Šæ‰¾åˆ°ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªåˆå­¦è€…æˆ–è€…æƒ³æ¸©ä¹ ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ è·Ÿéšæ•™ç¨‹ã€‚æˆ‘è¿˜å°†ä¸Šä¼ å¦ä¸€ç¯‡å…³äºç¼–å†™å’Œå‘å¸ƒä½ è‡ªå·±çš„å¯é‡ç”¨ Django åŒ…çš„æ–‡ç« ã€‚

ä»å…‹éš†æ¥è‡ª[åº“](https://github.com/the-nonlinearity/your-first-django-app/tree/start)çš„ä»£ç å¼€å§‹ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ç¼–è¾‘å™¨å’Œä»£ç ï¼Œè®©æˆ‘ä»¬å¼€å§‹åœ¨ PyCharm ä¸Šè®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®ã€‚

## 1.æ‰“å¼€æ‚¨çš„é¡¹ç›®

ä½¿ç”¨é¡¶éƒ¨å¯¼èˆªåœ¨ PyCharm ä¸­æ‰“å¼€æ‚¨çš„é¡¹ç›®ã€‚

![](img/25d5d35930fbb440a68aebcaf2732ea1.png)

å¯¼èˆªåˆ°å…‹éš†é¡¹ç›®çš„ä½ç½®ï¼Œå¹¶åœ¨æ–°çª—å£ä¸­æ‰“å¼€åŸºç¡€é¡¹ç›®æ–‡ä»¶å¤¹ã€‚æ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹:

![](img/3a2b5e378ac1b5eeed59f3de519dee93.png)

ä½ ç¬¬ä¸€æ¬¡æ‰“å¼€ Django åº”ç”¨çš„æ—¶å€™ã€‚

éšç€é¡¹ç›®çš„æ‰“å¼€ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸ºæˆ‘ä»¬çš„é¡¹ç›®é…ç½®è®¾ç½®ã€‚

## 2.åˆ›å»ºæˆ–ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyCharm å°†ä½¿ç”¨æ‚¨é»˜è®¤æ‹¥æœ‰çš„ä»»ä½• python è§£é‡Šå™¨ï¼Œä½†æ˜¯æ‚¨å¾ˆå¯èƒ½æ€»æ˜¯å¸Œæœ›è‡³å°‘åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œæ‚¨çš„é¡¹ç›®ã€‚æ‚¨å¯ä»¥ä»è®¾ç½®(é¦–é€‰é¡¹)çª—å£ç›´æ¥åˆ›å»ºä¸€ä¸ªæˆ–æ·»åŠ ä¸€ä¸ªç°æœ‰çš„ã€‚

![](img/be89d944298bca3ee31146878923dd01.png)

æˆ‘ä½¿ç”¨`pyenv`ï¼Œå› æ­¤æˆ‘å°†æ·»åŠ æˆ‘åœ¨é¡¹ç›®è®¾ç½®æœŸé—´åˆ›å»ºçš„ç°æœ‰ç¯å¢ƒï¼Œä½†æ‚¨å¯ä»¥ç‚¹å‡»å³ä¸Šè§’çš„é½¿è½®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç¯å¢ƒæˆ–æ·»åŠ æ‚¨è‡ªå·±çš„ç¯å¢ƒã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¸Œæœ›å°†æ‚¨çš„ python è§£é‡Šå™¨æ›´æ”¹ä¸º`python3`ã€‚

![](img/24b2f1d422d074369e274cb424a9e65f.png)

åˆ›å»ºäº†æ–°çš„è™šæ‹Ÿç¯å¢ƒåï¼Œæ‚¨ç°åœ¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹:

![](img/52293673f431def125d0a7a1a509d61a.png)

åœ¨è¿™é‡Œï¼Œæ‚¨å°†çœ‹åˆ°é»˜è®¤æƒ…å†µä¸‹å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­çš„è½¯ä»¶åŒ…ã€‚æ‚¨ä¼šæ³¨æ„åˆ° Django è¿˜æ²¡æœ‰å®‰è£…ã€‚æˆ‘ä»¬ç°åœ¨ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

ç”¨æˆ·å¯ä»¥ç›´æ¥ä»è¿™é‡Œå®‰è£…è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥ä»å‘½ä»¤è¡Œç›´æ¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…è½¯ä»¶åŒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤è¡Œï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æƒ³å°†æˆ‘ä»¬çš„åŒ…æ·»åŠ åˆ°é¡¹ç›®çš„`requirements.txt`æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿è·Ÿè¸ªæˆ‘ä»¬å°†ä½¿ç”¨çš„å†…å®¹ã€‚

å°†ä¸‹é¢çš„`requirements.txt`æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®çš„åŸºæœ¬ç›®å½•ä¸­ã€‚

```
Django==4.0.4
pytest==7.1.2
pytest-django==4.5.2
```

ä½ å¯ä»¥ç”¨`pip install -r requirements.txt`æ¥å®‰è£…éœ€æ±‚ï¼Œå®ƒä¼šå®‰è£…ä½ æ‰€æœ‰çš„éœ€æ±‚ã€‚

## 3.è®¾ç½®æµ‹è¯•è·‘æ­¥è€…

ä¸ºäº†ä½¿ç”¨`pytest`åŒ…æ¥è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦å†æ”¹å˜ä¸€ä¸ªé…ç½®è®¾ç½®ã€‚å¯¼èˆªåˆ°`Tools>Python Integrated Tools`å¹¶å°†é»˜è®¤æµ‹è¯•è¿è¡Œå™¨è®¾ç½®ä¸º`pytest`ã€‚

![](img/a7eebe6bafa12cbbf939522231578ba5.png)

æˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰`pytest`åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬çš„é¡¹ç›®è®¾ç½®æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬å°†ä¸‹é¢çš„`pytest.ini`æ–‡ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚

```
[pytest]
DJANGO_SETTINGS_MODULE=mysite.settings
python_files = tests.py test_*.py *_tests.py
```

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†é¡¹ç›®ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹ç¼–å†™ä¸€äº›ä»£ç å¹¶ä½¿ç”¨äº¤äº’å¼è°ƒè¯•å™¨äº†ã€‚

# ç¼–å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•

åœ¨æˆ‘ä»¬åšä»»ä½•è¿›ä¸€æ­¥çš„äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä»¥çº¯ TDD çš„æ–¹å¼ç¼–å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`polls/tests.py`æ–‡ä»¶ä¸­ã€‚

```
from django.test import TestCase
from django.urls import reverse

class IndexViewTests(TestCase):
    def test_index(self):
        *"""
        Test the index page.
        """* response = self.client.get(reverse('polls:index'))
        assert response.status_code == 200
```

ç°åœ¨æ‚¨å°†èƒ½å¤Ÿåœ¨ PyCharm UI ä¸­å¯¼èˆªåˆ°æ‚¨çš„æµ‹è¯•ï¼Œå³é”®å•å‡»`test_index`å¹¶é€‰æ‹©`Run 'pytest for tests.IndexViewTests.test_index'`ã€‚è¿™å°†è¿è¡Œæ‚¨çš„å•ä¸€æµ‹è¯•ã€‚æ‚¨å¯ä»¥å¯¹æµ‹è¯•ç±»æˆ–æ•´ä¸ª`tests.py`æ–‡ä»¶è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚

![](img/a9209fea21c7811fbe5f6c8b77cb5fc0.png)

ç°åœ¨ï¼Œæ‚¨å°†çœ‹åˆ°æµ‹è¯•å¤±è´¥ï¼Œå¹¶ä¸”åœ¨ä¸‹é¢çš„æ§åˆ¶å°ä¸­ä¼šæœ‰ä¸€äº›è¾“å‡ºã€‚

![](img/49d7f6a2212e44a16098817f65856538.png)

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„é”™è¯¯è¾“å‡ºæ¥ä¿®å¤æˆ‘ä»¬çš„æµ‹è¯•ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰åœ¨ Django ä¸­å®šä¹‰è§†å›¾æˆ– urlï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æµ‹è¯•å¤±è´¥å¹¶å‡ºç°`NoReverseMatch`å¼‚å¸¸ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ç´¢å¼•é¡µé¢è§†å›¾å’Œ url æ˜ å°„æ¥å¿«é€Ÿä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚

```
# polls/views.py **from** **django.http** **import** HttpResponse

**def** index(request):
    response_text = "Hello, world. You're at the polls index."
    **return** HttpResponse(response_text)
```

å’ŒæŠ•ç¥¨åº”ç”¨ç¨‹åº url

```
# polls/urls.py
**from** **django.urls** **import** path

**from** **.** **import** views

app_name = 'polls'
urlpatterns = [
    path('', views.index, name='index'),
]
```

ç„¶åå°†æŠ•ç¥¨åº”ç”¨ç¨‹åº URL æ·»åŠ åˆ°`mysite/urls.py`ä¸­çš„ç«™ç‚¹ URLã€‚

```
urlpatterns = [
    path('polls/', include('polls.urls')),
    path('admin/', admin.site.urls),
]
```

æ‚¨å¯ä»¥ä½¿ç”¨ PyCharm ä¸­çš„`alt+return`å¿«æ·æ–¹å¼æ·»åŠ  include å¯¼å…¥ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ç¼ºå°‘çš„å¯¼å…¥ä¸Šï¼Œç„¶åæŒ‰ä¸‹`alt+return`ï¼Œå®ƒä¼šæç¤ºæ‚¨æ˜¯å¦è¦æ·»åŠ å¯¼å…¥ã€‚åªè¦ç¡®ä¿é€‰æ‹©æ­£ç¡®çš„å¯¼å…¥å³å¯ã€‚

![](img/523be8101400856b61a525a09f4aadca.png)

å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ï¼Œç°åœ¨åº”è¯¥é€šè¿‡äº†ã€‚æ—¢ç„¶æˆ‘ä»¬å·²ç»å»ºç«‹äº†é¡¹ç›®å¹¶è¿è¡Œäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä½¿ç”¨ PyCharm ä¸­çš„äº¤äº’å¼è°ƒè¯•å™¨äº†ã€‚

# äº¤äº’å¼è°ƒè¯•å™¨

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨è°ƒè¯•å™¨æ¥æ£€æŸ¥æˆ‘ä»¬ç¼–å†™çš„ä»£ç ã€‚ä¸ºäº†ä½¿ç”¨è°ƒè¯•å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ PyCharm çš„è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œæµ‹è¯•ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨è§†å›¾ä»£ç ä¸­æ·»åŠ æ–­ç‚¹ï¼Œæ–¹æ³•æ˜¯å•å‡»è¡Œå·æ—è¾¹çš„è£…è®¢çº¿ã€‚

![](img/96cd36da5bd5b1324a5652380f2097db.png)

ç°åœ¨ä½¿ç”¨è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•ã€‚

![](img/707436fc90d3994a4dcdddcd59b2d718.png)

æµ‹è¯•ç°åœ¨å°†åœ¨æ–­ç‚¹å¤„æš‚åœæ‰§è¡Œã€‚æ‚¨å°†çœ‹åˆ°å‡½æ•°ä¸­å˜é‡çš„é¢„è§ˆå°†æ˜¾ç¤ºåœ¨æŒ‡å‘æ–­ç‚¹çš„è¡Œä¸­ã€‚

![](img/c9a4a8c463bd07f73e023bc24699e575.png)

ç„¶è€Œï¼Œæœ€æœ‰ä»·å€¼çš„æ˜¯åœ¨ä¸‹é¢çš„äº¤äº’çª—å£ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œè¿›ä¸€æ­¥æ£€æŸ¥å˜é‡ï¼Œå¹¶ä½¿ç”¨å…¶ä»–å„ç§å¯ç”¨çš„æ‰§è¡Œé€‰é¡¹ç»§ç»­æ‰§è¡Œã€‚åœ¨æ­¤è§†å›¾ä¸­è¿˜å¯ä»¥è®¾ç½®å…¶ä»–é…ç½®å’Œè§†å›¾ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºè¿™äº›ã€‚

![](img/f9e9b02b447c792a7bca6a4e898908af.png)

PyCharm çš„æ–‡æ¡£åŒ…å«äº†è°ƒè¯•æ—¶å¯ç”¨çš„å„ç§åŠŸèƒ½çš„å¤§é‡ç¤ºä¾‹ï¼Œæˆ‘å°†åªè¯¦ç»†è¯´æ˜æˆ‘æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚

1.  **è·¨è¿‡**
2.  **è¿›å…¥æˆ‘çš„ä»£ç **
3.  **è¯„ä¼°è¡¨è¾¾å¼**

åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶è¿™äº›ä¹‹å‰ï¼Œè®©æˆ‘ä»¬è·³åˆ° Django æ•™ç¨‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸€ä¸ªæ›´å¥½çš„æµ‹è¯•æ¥è°ƒè¯•ã€‚ä»å­˜å‚¨åº“ä¸­ç­¾å‡ºç¬¬ 5 éƒ¨åˆ†æ ‡ç­¾ã€‚

ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„å³é”®å•å‡»å¹¶è¿è¡Œæ¥è¿è¡Œ`test_was_published_recently_with_future_question`æµ‹è¯•ï¼Œæˆ‘ä»¬çœ‹åˆ°æµ‹è¯•å¦‚é¢„æœŸçš„é‚£æ ·å¤±è´¥äº†ã€‚

![](img/9da6a9ffc8dccd064d63f754beb6ece6.png)

çœ‹çœ‹æµ‹è¯•ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```
**def** test_was_published_recently_with_future_question(self):
    *"""
    was_published_recently() returns False for questions whose pub_date
    is in the future.
    """* time = timezone.now() + datetime.timedelta(days=30)
    future_question = Question(pub_date=time)
    self.**assertIs**(future_question.was_published_recently(), **False**)
```

`test_was_published_recently_with_future_question`åˆ›å»ºäº†ä¸€ä¸ª`Question`å®ä¾‹ï¼Œå®ƒçš„`pub_date`å­—æ®µæ˜¯æœªæ¥ 30 å¤©ï¼Œä½¿ç”¨`assertIs()`æ–¹æ³•ï¼Œå®ƒå‘ç°å®ƒçš„`was_published_recently()`è¿”å›`True`ï¼Œå°½ç®¡æˆ‘ä»¬å¸Œæœ›å®ƒè¿”å›`False`ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ©ç”¨æˆ‘ä»¬çš„äº¤äº’å¼è°ƒè¯•å™¨æ¥æ‰¾å‡ºåˆ°åº•å“ªé‡Œå‡ºé”™äº†ã€‚

å‘æµ‹è¯•ä¸­çš„ç¬¬ä¸€è¡Œæ·»åŠ æ–­ç‚¹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨**å•æ­¥è·³è¿‡**å’Œ**å•æ­¥è¿›å…¥**åŠ¨ä½œæ¥æŸ¥æ‰¾æ•…éšœç‚¹ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†ä½¿ç”¨**æ±‚å€¼è¡¨è¾¾å¼**åŠŸèƒ½æ¥æŸ¥çœ‹å“ªé‡Œå‡ºé”™äº†ã€‚ç»§ç»­åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œæµ‹è¯•ã€‚ä½ åº”è¯¥åœ¨è¿™é‡Œç»“æŸã€‚

![](img/e4601ebbeaae6ee45de5366cdb66010a.png)

ä½¿ç”¨**è·¨è¿‡**åŠ¨ä½œå‘ä¸‹ç§»åŠ¨åˆ° assertIs è¯­å¥ã€‚ä½ ä¼šçœ‹åˆ°ä½ å¯ä»¥æ£€æŸ¥ä½ æ‰€åˆ›å»ºçš„æ—¶é—´ç¡®å®æ˜¯ä½ æ‰€æœŸæœ›çš„ï¼Œç”šè‡³å®ƒè¢«æ­£ç¡®åœ°è®¾ç½®åœ¨ä½ çš„`future_question`å¯¹è±¡ä¸Šã€‚

![](img/1aabf5e5d1ae82ecb1e165d0b5e689d9.png)

ç°åœ¨æˆ‘ä»¬çŸ¥é“è¿™äº›éƒ½æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘ä»¬å¯ä»¥**è·³åˆ°æˆ‘çš„ä»£ç **ä¸­ï¼Œçœ‹çœ‹`was_published_recently()`å‡½æ•°å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚ä½ åº”è¯¥å‘ç°è‡ªå·±åœ¨è¿™é‡Œ:

![](img/ed80adbc1ed9871b78b4848b4d2eca44.png)

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨æ±‚å€¼è¡¨è¾¾å¼å‡½æ•°æ¥æŸ¥æ‰¾å¹¶ä¿®å¤ bugã€‚å¦‚æœæˆ‘ä»¬åœ¨ return è¯­å¥ä¸Šè¿è¡Œ Evaluate è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒè¿”å› Trueï¼Œå°½ç®¡æˆ‘ä»¬é¢„æœŸå®ƒæ˜¯ Falseã€‚

![](img/b3d5d43d90d2b0882f827b460f2dbcc3.png)

è¿›ä¸€æ­¥æ£€æŸ¥æˆ‘ä»¬æ­£åœ¨æ¯”è¾ƒçš„æ—¥æœŸï¼Œæˆ‘ä»¬çœ‹åˆ°`pub_date`ç¡®å®æ˜¯åœ¨æœªæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ä»è¡¨è¾¾å¼ä¸­æ’é™¤æœªæ¥æ—¥æœŸçš„å¸–å­ã€‚æˆ‘ä»¬éœ€è¦æ£€æŸ¥ä¸€ä¸‹`pub_date`æ˜¯å¦ä¹Ÿå°äº`now()`ã€‚åœ¨å°†å®ƒæ”¾å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­æµ‹è¯•å®ƒã€‚

![](img/48eb057340957d0cbf34252ef6e97946.png)

å¤ªå¥½äº†ï¼Œç°åœ¨å®ƒä¼¼ä¹å·¥ä½œäº†ï¼Œæˆ‘ä»¬å¯ä»¥çº æ­£æˆ‘ä»¬çš„ä»£ç å¹¶é‡æ–°è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ã€‚è¿™ä¸€æ¬¡å®ƒæ­£ç¡®åœ°é€šè¿‡äº†ã€‚è¯·è®°ä½ï¼Œåœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ‰§è¡Œæµ‹è¯•æœŸé—´ï¼Œæ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨**æ¢å¤**ã€**æš‚åœ**å’Œ**åœæ­¢**æŒ‰é’®ã€‚

![](img/01b1d4895e6d9f1721b6b20f2d254720.png)

# ç»“è®º

å¸Œæœ›é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­å¯ä»¥å¸®åŠ©æ‚¨ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°æ‚¨çš„å…·ä½“æ¡ˆä¾‹ä¸­ã€‚å®ƒç¡®å®å¸®åŠ©æˆ‘æ›´å¿«åœ°å‘ç°é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æˆ‘è‡ªå·±æ²¡æœ‰å†™æˆ–è€…å¾ˆä¹…ä»¥å‰å†™çš„ä»£ç æ—¶ã€‚ä½¿ç”¨ **Step into my code** å‡½æ•°ä¹Ÿæœ‰åŠ©äºæ‰¾åˆ°ä¿¡å·ä¸­æœ‰æ—¶ä¼šå‘ç”Ÿäº‹æƒ…çš„åœ°æ–¹ã€‚

# å¥–åŠ±æ— è¿ç§»ğŸ‰

å½“æ‚¨åœ¨æµ‹è¯•å¼€å§‹ä¹‹å‰æœ‰è®¸å¤šè¿ç§»è¦è¿è¡Œæ—¶ï¼Œæˆ–è€…å½“æ‚¨æƒ³è¦æµ‹è¯•ä¸€ä¸ªæ¨¡å‹å˜åŒ–è€Œä¸ç»å†æ•´ä¸ªè¿ç§»è¿‡ç¨‹æ—¶ï¼Œè¿™ä¸ª`--nomigrations`æ ‡å¿—æ˜¯ä¸€ä¸ªæ•‘å‘½ç¨»è‰ã€‚æ‚¨å¯ä»¥åœ¨æµ‹è¯•é…ç½®ä¸­è®¾ç½®æ­¤æ ‡å¿—:

![](img/2dd5ddc7dbe186a279d3c6aed44af386.png)

ç„¶ååœ¨**é™„åŠ å‚æ•°**é€‰é¡¹ä¸­æ·»åŠ `--nomigrations`å‚æ•°

![](img/28e62db3156c7567b5e19c7c5dd24eed.png)

æˆ–è€…æ‚¨å¯ä»¥å°†å®ƒå…¨å±€æ·»åŠ åˆ°æ‚¨çš„`pytest.ini`æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ä¸è¦æäº¤è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºæ‚¨ä¸å¸Œæœ›æ‚¨çš„ CI åœ¨ä¸éœ€è¦è¿›è¡Œä»»ä½•è¿ç§»çš„æƒ…å†µä¸‹è¿è¡Œæ‚¨çš„æµ‹è¯•ï¼Œç„¶åå¦‚æœæ‚¨éœ€è¦é¢å¤–çš„æ›´æ”¹ï¼Œéœ€è¦å›æ»šæˆ–æ›´æ”¹å®ƒä»¬ã€‚

```
[pytest]
DJANGO_SETTINGS_MODULE=mysite.settings
python_files = tests.py test_*.py *_tests.py
addopts = --nomigrations
```

ç»§ç»­å‘æ‚¨çš„é—®é¢˜æ¨¡å‹æ·»åŠ ä¸€ä¸ªä¸å¯ä¸ºç©ºçš„å­—æ®µï¼Œçœ‹çœ‹æ‚¨çš„æµ‹è¯•å¦‚ä½•è¿è¡Œã€‚

```
**class** Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published') published_by = models.ForeignKey(User, on_delete=models.CASCADE)

    **def** __str__(self):
        **return** self.question_text
```

è¿˜è¦æ›´æ–°æµ‹è¯•ã€‚

```
**def** test_was_published_recently_with_future_question(self):
    *"""
    was_published_recently() returns False for questions whose pub_date
    is in the future.
    """* user = User.objects.create_user('john', 'lennon@thebeatles.com', 'johnpassword')
    time = timezone.now() + datetime.timedelta(days=30)
    future_question = Question(pub_date=time, published_by=user)
    future_question.save()
    self.**assertIs**(future_question.was_published_recently(), **False**)
    self.**assertEqual**(future_question.published_by, user)
```

![](img/6994a4470b5a4d2b9234ff2fea9e79f6.png)

æˆ‘å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æé«˜æ•ˆç‡å’Œä»£ç è´¨é‡ï¼