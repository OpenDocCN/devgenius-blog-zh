<html>
<head>
<title>Gatsby.js — Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —查询</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-queries-ef9383f354ce?source=collection_archive---------6-----------------------#2021-02-11">https://blog.devgenius.io/gatsby-js-queries-ef9383f354ce?source=collection_archive---------6-----------------------#2021-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4cf87250d8e5a9b229ec6296dff563c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wn79HQIRtepblI8k"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">国家癌症研究所</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="7cd0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby是一个基于React的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Gatsby创建一个站点。</p><h1 id="13a5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">页面查询</h1><p id="9446" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以查询网站的数据，并显示在我们的页面上。</p><p id="4707" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="b2a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="84f4" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [],<br/>  siteMetadata: {<br/>    title: `Gatsby`,<br/>    siteUrl: `https://www.gatsbyjs.com`,<br/>    description: `Blazing fast modern site generator for React`,<br/>  },<br/>}</span></pre><p id="6250" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/pages/index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4f71" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="6e10" class="mq lc iq mh b gy mv ms l mt mu">export const query = graphql`<br/>  query HomePageQuery {<br/>    site {<br/>      siteMetadata {<br/>        title<br/>      }<br/>    }<br/>  }<br/>`</span><span id="c213" class="mq lc iq mh b gy mv ms l mt mu">export default function Home({ data }) {<br/>  return &lt;div&gt;{data.site.siteMetadata.title}&lt;/div&gt;<br/>}</span></pre><p id="4d09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe me mf mg mh b">gatsby-config.js</code>中设置站点的元数据。</p><p id="646e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在页面中获得带有<code class="fe me mf mg mh b">graphql</code>标签的数据。</p><p id="60c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在页面组件中，我们从<code class="fe me mf mg mh b">data</code>道具中获取数据。</p><h1 id="a0c9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用StaticQuery组件查询数据</h1><p id="49b7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以用<code class="fe me mf mg mh b">StaticQuery</code>组件查询数据。</p><p id="559c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这对于获取非页面组件的数据非常有用。</p><p id="aae2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="dadc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="29eb" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [],<br/>  siteMetadata: {<br/>    title: `Gatsby`,<br/>    siteUrl: `https://www.gatsbyjs.com`,<br/>    description: `Blazing fast modern site generator for React`,<br/>  },<br/>}</span></pre><p id="33fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/pages/index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d34d" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { StaticQuery, graphql } from "gatsby"</span><span id="38bf" class="mq lc iq mh b gy mv ms l mt mu">const NonPageComponent = () =&gt; (<br/>  &lt;StaticQuery<br/>    query={graphql`<br/>      query NonPageQuery {<br/>        site {<br/>          siteMetadata {<br/>            title<br/>          }<br/>        }<br/>      }<br/>    `}<br/>    render={(<br/>      data<br/>    ) =&gt; (<br/>        &lt;h1&gt;<br/>          {data.site.siteMetadata.title}<br/>        &lt;/h1&gt;<br/>      )}<br/>  /&gt;<br/>)</span><span id="f22f" class="mq lc iq mh b gy mv ms l mt mu">export default function Home() {<br/>  return &lt;div&gt;<br/>    &lt;NonPageComponent /&gt;<br/>  &lt;/div&gt;<br/>}</span></pre><p id="0856" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe me mf mg mh b">NonPageComponent</code>来从站点的元数据中获取<code class="fe me mf mg mh b">title</code>。</p><p id="0013" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">StaticQuery</code>组件来获取数据。</p><p id="093b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">render</code>道具中，我们有一个函数，以我们想要的方式渲染<code class="fe me mf mg mh b">title</code>。</p><h1 id="005a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用useStaticQuery挂钩查询数据</h1><p id="d963" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">另一种查询数据的方法是使用<code class="fe me mf mg mh b">useStaticQuery</code>钩子。</p><p id="7349" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="05b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="45c0" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [],<br/>  siteMetadata: {<br/>    title: `Gatsby`,<br/>    siteUrl: `https://www.gatsbyjs.com`,<br/>    description: `Blazing fast modern site generator for React`,<br/>  },<br/>}</span></pre><p id="c721" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/pages/index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="091b" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { useStaticQuery, graphql } from "gatsby"</span><span id="3f3c" class="mq lc iq mh b gy mv ms l mt mu">const NonPageComponent = () =&gt; {<br/>  const data = useStaticQuery(graphql`<br/>    query NonPageQuery {<br/>      site {<br/>        siteMetadata {<br/>          title<br/>        }<br/>      }<br/>    }<br/>  `)<br/>  return (<br/>    &lt;h1&gt;<br/>      {data.site.siteMetadata.title}<br/>    &lt;/h1&gt;<br/>  )<br/>}</span><span id="81b1" class="mq lc iq mh b gy mv ms l mt mu">export default function Home() {<br/>  return &lt;div&gt;<br/>    &lt;NonPageComponent /&gt;<br/>  &lt;/div&gt;<br/>}</span></pre><p id="51ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用GraphQL查询对象调用<code class="fe me mf mg mh b">useStaticQuery</code>钩子，该对象是从<code class="fe me mf mg mh b">graphql</code>标签创建的。</p><p id="478f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回数据，我们可以渲染它。</p><h1 id="90a4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用GraphQL限制</h1><p id="9f72" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用GraphQL API/来限制返回结果的数量</p><p id="316c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以运行以下查询:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ee08" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  allSitePage(limit: 3) {<br/>    edges {<br/>      node {<br/>        id<br/>        path<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="15db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="http://localhost:8000/__graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/_ _ graph QL</a>中，结果被限制为3个条目。</p><p id="0c3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以通过运行以下命令来添加排序:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="20c3" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  allSitePage(sort: {fields: path, order: ASC}) {<br/>    edges {<br/>      node {<br/>        id<br/>        path<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="b165" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们按照升序对响应中的<code class="fe me mf mg mh b">path</code>字段进行排序。</p><h1 id="c113" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="7d66" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Gatsby查询我们的站点元数据，并以各种方式配置查询。</p></div></div>    
</body>
</html>