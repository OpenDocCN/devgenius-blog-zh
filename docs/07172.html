<html>
<head>
<title>GoReleaser build multi arch Docker Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GoReleaser 构建多拱门码头图像</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/goreleaser-build-multi-arch-docker-images-8dd9a7903675?source=collection_archive---------6-----------------------#2022-03-03">https://blog.devgenius.io/goreleaser-build-multi-arch-docker-images-8dd9a7903675?source=collection_archive---------6-----------------------#2022-03-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b3489c0b824001c5f428d2688a67aca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xRXRWBlovDZqmlcef3-T-w.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@william07?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威廉·威廉</a>在<a class="ae jz" href="https://unsplash.com/s/photos/container-terminal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><blockquote class="ka kb kc"><p id="52e2" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><em class="in"> GoReleaser 是一款面向 Go 项目的发布自动化工具。目标是简化构建、发布和发布步骤，同时为所有步骤提供变体定制选项。GoReleaser 是基于 CI 工具构建的，您只需下载并在构建脚本中执行它。当然，如果你愿意，你仍然可以在本地安装它。<br/>您的发布流程可以通过. goreleaser.yaml 文件进行定制。<br/>一旦你设置好了，每次你想创建一个新的版本，你需要做的就是标记并运行 go release release</em></p></blockquote><p id="b775" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">我最近了解了 goreleaser，并立即喜欢上了这个工具。它易于使用，极大地简化了部署过程。</p><p id="7848" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">前置要求</strong></p><ol class=""><li id="16c8" class="lf lg in kg b kh ki kl km lc lh ld li le lj lb lk ll lm ln bi translated"><a class="ae jz" href="https://goreleaser.com/install/" rel="noopener ugc nofollow" target="_blank"> GoReleaser </a>(在 1.5.0 版本中测试过)</li><li id="6bf7" class="lf lg in kg b kh lo kl lp lc lq ld lr le ls lb lk ll lm ln bi translated"><a class="ae jz" href="https://docs.docker.com/buildx/working-with-buildx/" rel="noopener ugc nofollow" target="_blank"> Docker Buildx </a>已安装</li></ol><p id="feaa" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">在一些操作系统中，不包括 Docker 的 Buildx，我们必须随后安装它，你可以用命令<code class="fe lt lu lv lw b">docker buildx</code>测试它。</p><p id="8818" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">创建一个 Git 存储库</strong></p><p id="fa5c" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">首先，我们将创建一个 Git 存储库。这样我们就可以使用<a class="ae jz" href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" rel="noopener ugc nofollow" target="_blank"> Git 标签</a>，goreleaser 使用这些标签来创建容器图像标签。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="3d15" class="mf mg in lw b gy mh mi l mj mk">mkdir goreleaser-test<br/>cd goreleaser-test<br/>git init</span></pre><p id="da1e" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">创建一个 Dockerfile </strong></p><p id="b4ce" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">现在我们有了一个工作 git 环境，我们将在我们的工作环境中为我们的构建创建一个最小的 Dockerfile。我们(goreleaser)将把构建二进制文件复制到容器中，当容器启动时,<code class="fe lt lu lv lw b">ENTRYPOINT </code>将运行我们的二进制文件。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="3238" class="mf mg in lw b gy mh mi l mj mk">FROM alpine:3.15.0</span><span id="d113" class="mf mg in lw b gy ml mi l mj mk"># copy over the binary from the first stage<br/>COPY helloworld /helloworld/helloworld</span><span id="b9fa" class="mf mg in lw b gy ml mi l mj mk">WORKDIR “/helloworld”<br/>ENTRYPOINT [ “/helloworld/helloworld” ]</span></pre><p id="276a" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">创造一些围棋</strong></p><p id="67d9" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">我们将创建一个最小的 Go 二进制文件，输出 Hello World、操作系统和处理器架构。所以在<code class="fe lt lu lv lw b">./helloworld/helloworld.go</code>创建文件</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="bb04" class="mf mg in lw b gy mh mi l mj mk">package main</span><span id="b30c" class="mf mg in lw b gy ml mi l mj mk">import (<br/>        "fmt"<br/>        "runtime"<br/>)</span><span id="ed22" class="mf mg in lw b gy ml mi l mj mk">func main() {<br/>        fmt.Println("Hello World")<br/>        fmt.Println(runtime.GOOS, runtime.GOARCH)<br/>}</span></pre><p id="66d9" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">创建. goreleaser.yaml </strong></p><p id="b0a1" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">下一步是准备我们的<code class="fe lt lu lv lw b">.goreleaser.yaml</code>发布。我们把它放在主路。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="ed64" class="mf mg in lw b gy mh mi l mj mk"># <a class="ae jz" href="https://goreleaser.com" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com</a><br/>project_name: helloworld<br/>before:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/hooks/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/hooks/</a><br/>  hooks:<br/>    # tidy up<br/>    - go mod tidy<br/>builds:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/build/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/build/</a><br/>  - main: ./helloworld<br/>    binary: helloworld<br/>    env:<br/>      - CGO_ENABLED=0<br/>    goos:<br/>      - linux<br/>    goarch:<br/>      - amd64<br/>      - arm<br/>      - arm64<br/>    goarm:<br/>      - 6<br/>      - 7<br/>    mod_timestamp: "{{ .CommitTimestamp }}"<br/>dockers:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/docker/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/docker/</a><br/>  - use: buildx<br/>    goos: linux<br/>    goarch: amd64<br/>    image_templates:<br/>      - "0hlov3s/{{ .ProjectName }}:{{ .Version }}-amd64"<br/>      - "0hlov3s/{{ .ProjectName }}:latest-amd64"<br/>    build_flag_templates:<br/>      - "--platform=linux/amd64"<br/>      - "--label=org.opencontainers.image.created={{.Date}}"<br/>      - "--label=org.opencontainers.image.title={{.ProjectName}}"<br/>      - "--label=org.opencontainers.image.revision={{.FullCommit}}"<br/>      - "--label=org.opencontainers.image.version={{.Version}}"<br/>  - use: buildx<br/>    goos: linux<br/>    goarch: arm64<br/>    image_templates:<br/>      - "0hlov3s/{{ .ProjectName }}:{{ .Version }}-arm64v8"<br/>      - "0hlov3s/{{ .ProjectName }}:latest-arm64v8"<br/>    build_flag_templates:<br/>      - "--platform=linux/arm64/v8"<br/>      - "--label=org.opencontainers.image.created={{.Date}}"<br/>      - "--label=org.opencontainers.image.title={{.ProjectName}}"<br/>      - "--label=org.opencontainers.image.revision={{.FullCommit}}"<br/>      - "--label=org.opencontainers.image.version={{.Version}}"<br/>  - use: buildx<br/>    goos: linux<br/>    goarch: arm<br/>    goarm: 6<br/>    image_templates:<br/>      - "0hlov3s/{{ .ProjectName }}:{{ .Version }}-armv6"<br/>      - "0hlov3s/{{ .ProjectName }}:latest-armv6"<br/>    build_flag_templates:<br/>      - "--platform=linux/arm/v6"<br/>      - "--label=org.opencontainers.image.created={{.Date}}"<br/>      - "--label=org.opencontainers.image.title={{.ProjectName}}"<br/>      - "--label=org.opencontainers.image.revision={{.FullCommit}}"<br/>      - "--label=org.opencontainers.image.version={{.Version}}"<br/>  - use: buildx<br/>    goos: linux<br/>    goarch: arm<br/>    goarm: 7<br/>    image_templates:<br/>      - "0hlov3s/{{ .ProjectName }}:{{ .Version }}-armv7"<br/>      - "0hlov3s/{{ .ProjectName }}:latest-armv7"<br/>    build_flag_templates:<br/>      - "--platform=linux/arm/v7"<br/>      - "--label=org.opencontainers.image.created={{.Date}}"<br/>      - "--label=org.opencontainers.image.title={{.ProjectName}}"<br/>      - "--label=org.opencontainers.image.revision={{.FullCommit}}"<br/>      - "--label=org.opencontainers.image.version={{.Version}}"<br/>docker_manifests:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/docker_manifest/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/docker_manifest/</a><br/>  - name_template: 0hlov3s/{{ .ProjectName }}:{{ .Version }}<br/>    image_templates:<br/>      - 0hlov3s/{{ .ProjectName }}:{{ .Version }}-amd64<br/>      - 0hlov3s/{{ .ProjectName }}:{{ .Version }}-arm64v8<br/>      - 0hlov3s/{{ .ProjectName }}:{{ .Version }}-armv6<br/>      - 0hlov3s/{{ .ProjectName }}:{{ .Version }}-armv7<br/>  - name_template: 0hlov3s/{{ .ProjectName }}:latest<br/>    image_templates:<br/>      - 0hlov3s/{{ .ProjectName }}:latest-amd64<br/>      - 0hlov3s/{{ .ProjectName }}:latest-arm64v8<br/>      - 0hlov3s/{{ .ProjectName }}:latest-armv6<br/>      - 0hlov3s/{{ .ProjectName }}:latest-armv7<br/>checksum:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/checksum/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/checksum/</a><br/>  name_template: 'checksums.txt'<br/>snapshot:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/snapshots/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/snapshots/</a><br/>  name_template: "{{ incpatch .Version }}-SNAPSHOT"<br/>source:<br/>  # <a class="ae jz" href="https://goreleaser.com/customization/source/" rel="noopener ugc nofollow" target="_blank">https://goreleaser.com/customization/source/</a><br/>  enabled: true</span></pre><h2 id="3e1a" class="mf mg in bd mm mn mo dn mp mq mr dp ms lc mt mu mv ld mw mx my le mz na nb nc bi translated">git 提交和标记</h2><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="640c" class="mf mg in lw b gy mh mi l mj mk">git add .<br/>git commit -m ‘Initial Commit’<br/>git tag v0.0.1</span></pre><p id="cf9e" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">运行测试版本</strong></p><p id="e7c1" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">既然一切都准备好了，我们就可以进行测试发布了。因此，当我们使用<code class="fe lt lu lv lw b">--snapshot</code>运行 goreleaser 时，我们将在本地构建容器图像，而 goreleaser 不会将它们推送到注册表。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="1f5d" class="mf mg in lw b gy mh mi l mj mk">goreleaser release — rm-dist — snapshot</span></pre><p id="43d3" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">查看您的集装箱图片</strong></p><p id="54c0" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">不，我们成功地创建了容器图像，我们可以在我们当地的 Maschine 上测试它们。所以我们要检查哪些图像是构建的。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="35be" class="mf mg in lw b gy mh mi l mj mk">❯ docker images<br/>REPOSITORY                        TAG                      IMAGE ID       CREATED        SIZE<br/>0hlov3s/helloworld                0.0.2-SNAPSHOT-armv6     a613a22f467a   35 hours ago   6.04MB<br/>0hlov3s/helloworld                latest-armv6             a613a22f467a   35 hours ago   6.04MB<br/>0hlov3s/helloworld                0.0.2-SNAPSHOT-amd64     7058d357c075   35 hours ago   6.79MB<br/>0hlov3s/helloworld                latest-amd64             7058d357c075   35 hours ago   6.79MB<br/>0hlov3s/helloworld                0.0.2-SNAPSHOT-armv7     d8e9a147bdd4   35 hours ago   5.06MB<br/>0hlov3s/helloworld                latest-armv7             d8e9a147bdd4   35 hours ago   5.06MB<br/>0hlov3s/helloworld                0.0.2-SNAPSHOT-arm64v8   1bf6fe199d86   35 hours ago   6.64MB<br/>0hlov3s/helloworld                latest-arm64v8           1bf6fe199d86   35 hours ago   6.64MB</span></pre><p id="70f7" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">既然我们知道了，我们有什么图像，我们就可以用<code class="fe lt lu lv lw b">docker run</code>命令运行它们。</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="a5f2" class="mf mg in lw b gy mh mi l mj mk">❯ docker run 0hlov3s/helloworld:0.0.2-SNAPSHOT-amd64<br/>Hello World</span></pre><p id="7aff" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">有用链接</strong></p><ul class=""><li id="e27e" class="lf lg in kg b kh ki kl km lc lh ld li le lj lb nd ll lm ln bi translated"><a class="ae jz" href="https://github.com/0hlov3/goreleaser-multi-arch-docker" rel="noopener ugc nofollow" target="_blank">git hub Repo 示例</a></li><li id="b980" class="lf lg in kg b kh lo kl lp lc lq ld lr le ls lb nd ll lm ln bi translated"><a class="ae jz" href="https://goreleaser.com/customization/docker/" rel="noopener ugc nofollow" target="_blank">码头工人图像-gore leaser</a></li></ul><p id="561f" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><strong class="kg io">不要相信我</strong></p><p id="145c" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">作者对信息中包含的错误或因使用信息而产生的损害不承担责任。</p><p id="0997" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">不要犹豫，向我提问或向我发送改进建议。</p><p id="9321" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">#go #go/goreleaser</p></div></div>    
</body>
</html>