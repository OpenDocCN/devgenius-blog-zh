<html>
<head>
<title>A common mistake when using a function in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中使用函数时的一个常见错误</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-common-mistake-when-using-a-function-in-python-6ac507a95e4f?source=collection_archive---------12-----------------------#2020-07-06">https://blog.devgenius.io/a-common-mistake-when-using-a-function-in-python-6ac507a95e4f?source=collection_archive---------12-----------------------#2020-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/e6a7bbd46c56ed44838b13699ce97a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*elaQFObhsB0MIRdV9rUHiA.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">图片来源:泰勒·尼克斯<a class="ae jv" href="https://unsplash.com/photos/wVexcTg7oXY" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/wVexcTg7oXY</a></figcaption></figure><p id="cb10" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">你有没有把一个 Python 变量(对象)传递给一个函数进行修改，但是函数运行完之后，变量并没有显示出预期的修改？下面我们来看看 addTwo()这个函数。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="d992" class="ld le in kz b gy lf lg l lh li"><strong class="kz io"># Common Mistake<br/>def</strong> addTwo(val):<br/>  val += 2                <strong class="kz io"><br/>  print</strong>(val, end=" ")</span><span id="1821" class="ld le in kz b gy lj lg l lh li">x = 1                    <br/>addTwo(x)<br/><strong class="kz io">print</strong>(x)</span><span id="608c" class="ld le in kz b gy lj lg l lh li"><strong class="kz io"># Output   3 1<br/># Expected 3 3</strong></span></pre><blockquote class="lk ll lm"><p id="4f4d" class="jw jx ln jy b jz ka kb kc kd ke kf kg lo ki kj kk lp km kn ko lq kq kr ks kt ig bi translated"><strong class="jy io">是什么导致了这个问题？为什么函数运行后 x 还是 1？</strong></p></blockquote><p id="6604" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">正如在输出中看到的，我们只修改了‘val’而没有修改‘x’。因为修改‘val’不会导致‘x’的变化，所以它们是两个不同的对象吗？没有。它们是同一个对象。下面是我们运行上面的代码时 Python 所做的事情。</p><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/9b62e6a89ea010b5061386e4894d906b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAecF_7LzuBiCfFe6K6hCg.png"/></div></div></figure><p id="7495" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">在 Python 中，对象通过赋值来传递。它的意思是当我们调用一个函数时，我们创建一个新的名字标签，并把它贴在输入对象上。对于上面的例子:</p><ul class=""><li id="444d" class="lw lx in jy b jz ka kd ke kh ly kl lz kp ma kt mb mc md me bi translated">当我们将 1 赋给' x '时，我们实际上创建了一个名称标记' x ',并将其标记为一个值为 1 的整数对象。</li><li id="51ff" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt mb mc md me bi translated">当调用 addTwo(x)时，我们创建另一个名为‘val’的名称标记，并将其标记为与‘x’相同的整数对象。</li></ul><blockquote class="lk ll lm"><p id="4de4" class="jw jx ln jy b jz ka kb kc kd ke kf kg lo ki kj kk lp km kn ko lq kq kr ks kt ig bi translated"><strong class="jy io">那么如果‘x’和‘val’是同一个宾语，为什么修改‘val’(val+= 2)不会改变‘x’？</strong></p></blockquote><ul class=""><li id="d46e" class="lw lx in jy b jz ka kd ke kh ly kl lz kp ma kt mb mc md me bi translated">我们实际上不会用‘val+= 2’表达式来修改‘val’。我们所做的是将“val”重新标记为不同的对象。首先，我们将标记对象的值 1 与 2 相加，然后将名称标记“val”分配给一个新对象，该对象的相加结果值为 3。</li><li id="b058" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt mb mc md me bi translated">因此，在函数运行后，‘x’和‘val’标记为两个不同的对象。</li></ul><blockquote class="lk ll lm"><p id="3a3a" class="jw jx ln jy b jz ka kb kc kd ke kf kg lo ki kj kk lp km kn ko lq kq kr ks kt ig bi translated"><strong class="jy io">有办法修改整数对象 1 吗？</strong></p></blockquote><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mk"><img src="../Images/20a76ef086b34e61a0c80964ec379fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKXANKr1RPl25rYnqsVryw.png"/></div></div></figure><p id="5d04" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">没有。一个<strong class="jy io"> Integer </strong>对象是一个不可变的对象，和其他<strong class="jy io">不可变的对象一样，比如 string、tuple、boolean、tuple、frozenset 和 float，</strong>我们不能在它们被创建后修改它们。因此，如果我们想修改不可变对象，就不应该将它们传递给函数。</p><h1 id="f044" class="ml le in bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">修改 Python 变量(对象)的三种不同方式</h1><blockquote class="lk ll lm"><p id="dc5f" class="jw jx ln jy b jz ka kb kc kd ke kf kg lo ki kj kk lp km kn ko lq kq kr ks kt ig bi translated"><strong class="jy io">我们如何修改函数内部的对象？</strong></p></blockquote><h1 id="a001" class="ml le in bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated"><strong class="ak"> a .使用可变对象</strong></h1><p id="7133" class="pw-post-body-paragraph jw jx in jy b jz ni kb kc kd nj kf kg kh nk kj kk kl nl kn ko kp nm kr ks kt ig bi translated">对于第 1 节中的例子，我们可以将一个 Python 列表(它有一个值为 1 的整数对象)赋给“x ”,并将其传递给一个函数。因为列表是一个可变的对象，我们可以在创建它之后修改它。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="fc8b" class="ld le in kz b gy lf lg l lh li"><strong class="kz io"># Use Python List<br/>def</strong> addTwo(val):<br/>  val[0] += 2                <strong class="kz io"><br/>  print</strong>(val[0], end=" ")</span><span id="1235" class="ld le in kz b gy lj lg l lh li">x = [1]    # use a list                 <br/>addTwo(x)<br/><strong class="kz io">print</strong>(x[0])</span><span id="3082" class="ld le in kz b gy lj lg l lh li"><strong class="kz io"># Output   3 3<br/># Expected 3 3</strong></span></pre><p id="4084" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">下面是调用 addTwo(x)后的情况。该函数通过取消标记整数对象 1 并标记新的整数对象 3 来修改列表。虽然现在涉及到了一个不同的整数对象，但是列表对象仍然由函数和它的调用者共享。我们达到了改变来电者所见的目的。</p><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nn"><img src="../Images/5b2fdee2ea90bdc9003771784784127d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VYg__hJnr_OUd9fPpWC_g.png"/></div></div></figure><p id="8ce0" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">因此，如果我们想通过一个函数修改一个对象，这个对象必须是一个可变的对象，比如一个列表、集合、字典或自定义对象。</p><h1 id="2344" class="ml le in bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated"><strong class="ak"> b .从函数中返回一个整数</strong></h1><p id="b1e7" class="pw-post-body-paragraph jw jx in jy b jz ni kb kc kd nj kf kg kh nk kj kk kl nl kn ko kp nm kr ks kt ig bi translated">我们可以将“x”重新标记为一个从函数返回的新的整数对象，而不是修改“x”的整数对象。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="b67f" class="ld le in kz b gy lf lg l lh li"><strong class="kz io"># Use function return value<br/>def</strong> addTwo(val):<br/>  val += 2                <strong class="kz io"><br/>  print</strong>(val, end=" ")<br/>  return val</span><span id="cec9" class="ld le in kz b gy lj lg l lh li">x = 1                   <br/>x = addTwo(x) # assign a return value to x<br/><strong class="kz io">print</strong>(x)</span><span id="2a07" class="ld le in kz b gy lj lg l lh li"><strong class="kz io"># Output   3 3<br/># Expected 3 3</strong></span></pre><p id="83e7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">下面是 addTwo(x)返回后的情况。x '将其自身重新标记为新返回的值为 3 的整数对象。</p><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi no"><img src="../Images/1fd68dcf8a206821a40521fcad1ff7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6QGmN4XrQ_v-_edvMestaw.png"/></div></div></figure><h1 id="72c8" class="ml le in bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated"><strong class="ak"> c .使用全局变量(不推荐)</strong></h1><p id="7d3e" class="pw-post-body-paragraph jw jx in jy b jz ni kb kc kd nj kf kg kh nk kj kk kl nl kn ko kp nm kr ks kt ig bi translated">addTwo()可以通过使用“global”关键字来访问“x”的整数对象。因此，该函数可以将“x”重新标记为一个新的整数对象，该对象的相加结果的值为 3。然而，这并不是修改变量的推荐方法，因为它违背了为除“x”之外的其他变量重用函数的目的。更重要的是，它可能不是线程安全的，并可能造成命名空间污染。关于这两个主题的进一步阅读，请参考本文底部的参考文献 4 和 5。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="e3b2" class="ld le in kz b gy lf lg l lh li"><strong class="kz io"># Use a global variable <br/></strong>x = 1  # declare x as a global var</span><span id="d671" class="ld le in kz b gy lj lg l lh li"><strong class="kz io">def</strong> addTwo():<br/>  global x <br/>  x += 2         <strong class="kz io"><br/>  print</strong>(x, end=" ")</span><span id="50cc" class="ld le in kz b gy lj lg l lh li"><strong class="kz io">def</strong> main():<br/>  addTwo()<br/>  <strong class="kz io">print</strong>(x)</span><span id="e0c1" class="ld le in kz b gy lj lg l lh li">main()</span><span id="f995" class="ld le in kz b gy lj lg l lh li"><strong class="kz io"># Output   3 3<br/># Expected 3 3</strong></span></pre><p id="04bf" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">下面是调用 addTwo()后发生的情况。</p><figure class="ku kv kw kx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi np"><img src="../Images/5150bd0a5fe07e98fe3a529e88362a39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmVic9L4Mgnivfo0wFL2eQ.png"/></div></div></figure><h1 id="418d" class="ml le in bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">结论</h1><p id="ed01" class="pw-post-body-paragraph jw jx in jy b jz ni kb kc kd nj kf kg kh nk kj kk kl nl kn ko kp nm kr ks kt ig bi translated">那么我们学到了什么？我们不能在 Python 中修改不可变的对象。如果我们想用一个函数修改一个变量，我们需要传入一个可变的对象或者从函数返回一个值。</p><p id="3ffe" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我要感谢我的同学基夫·约翰逊和贡萨洛·阿拉纳校对了这篇文章。这是我关于 Medium 的第二篇文章，也是第一篇深入理解 Python 底层工作原理的文章。随着我对 Python 的进一步了解，我很乐意听到关于本文的任何反馈和评论。</p><p id="750f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">参考文献</strong></p><ol class=""><li id="349a" class="lw lx in jy b jz ka kd ke kh ly kl lz kp ma kt nq mc md me bi translated">Python 编程常见问题。<a class="ae jv" href="https://docs.python.org/3/faq/programming.html#how-do-i-write-a-function-with-output-parameters-call-by-reference" rel="noopener ugc nofollow" target="_blank">https://docs . python . org/3/FAQ/programming . html #如何编写带输出参数的函数-通过引用调用</a></li><li id="63c3" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">理解 Python 变量和内存管理。<a class="ae jv" href="http://foobarnbaz.com/2012/07/08/understanding-python-variables/" rel="noopener ugc nofollow" target="_blank">http://foobanbaz . com/2012/07/08/understanding-python-variables/</a></li><li id="ce96" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">Python 是按值调用还是按引用调用？两者都不是<a class="ae jv" href="https://jeffknupp.com/blog/2012/11/13/is-python-callbyvalue-or-callbyreference-neither/" rel="noopener ugc nofollow" target="_blank">https://jeffknupp . com/blog/2012/11/13/is-python-callby value-or-callby reference-never/</a></li><li id="df36" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">Python/C API 参考手册。<a class="ae jv" href="https://docs.python.org/2.0/api/threads.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/2.0/api/threads.html</a></li><li id="01ec" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">全局变量有什么问题？<a class="ae jv" href="https://www.reddit.com/r/learnpython/comments/7l8yig/whats_wrong_with_global_variables/" rel="noopener ugc nofollow" target="_blank">https://www . Reddit . com/r/learn python/comments/7 l8 YIG/whats _ error _ with _ global _ variables/</a></li><li id="11fc" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">形象信用。<a class="ae jv" href="https://unsplash.com/photos/wVexcTg7oXY" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/wVexcTg7oXY</a></li><li id="9e4f" class="lw lx in jy b jz mf kd mg kh mh kl mi kp mj kt nq mc md me bi translated">校对:基夫·约翰逊和贡萨洛·阿拉纳</li></ol></div></div>    
</body>
</html>