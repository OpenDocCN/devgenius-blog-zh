<html>
<head>
<title>Debounce in JavaScript — A Fantastic Design Pattern to Delay/Prevent Unwanted User Action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 中的去抖——延迟/防止不必要的用户动作的奇妙设计模式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/debounce-in-javascript-a-fantastic-design-pattern-to-delay-prevent-unwanted-user-action-ce2bbe51f7cc?source=collection_archive---------7-----------------------#2022-01-14">https://blog.devgenius.io/debounce-in-javascript-a-fantastic-design-pattern-to-delay-prevent-unwanted-user-action-ce2bbe51f7cc?source=collection_archive---------7-----------------------#2022-01-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="fd95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有时，我们希望减少在 web 应用程序中响应用户事件时调用函数或方法的次数。</p><p id="ed1a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，当用户输入一个搜索查询时，我们希望他停止输入一段时间，然后再触发 API 请求。像这样:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">去抖演示</figcaption></figure><p id="ecc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们称这样的设计模式只允许在设定的延迟去抖后重复一个用户动作。</p><p id="ff2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这种行为的几个原因可能是:</p><ol class=""><li id="78f5" class="kt ku in jm b jn jo jr js jv kv jz kw kd kx kh ky kz la lb bi translated"><strong class="jm io"> <em class="lc">计算量大的任务:</em> </strong></li></ol><p id="bc29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果特定的函数或方法调用计算量非常大，那么过于频繁地调用它可能会导致浏览器性能下降，因为 JavaScript 是单线程的。</p><p id="a7f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这种行为的常见情况可能是在图像和视频丰富的网站(如脸书)上滚动事件，过于频繁地触发滚动事件会导致性能问题。</p><p id="3ec5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.<strong class="jm io"> <em class="lc">事件可以被触发的次数限制:</em> </strong></p><p id="ebc5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一个特定的方法或函数调用实现了对我们可以执行它的次数有限制的行为，我们会希望减少它的调用频率。</p><p id="b62a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，当我们向一个 API 发出 HTTP 请求，限制用户每天可以调用它的次数时(就像上面的演示视频)。</p><p id="4c29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.<strong class="jm io"> <em class="lc">防止垃圾邮件等有害用户行为</em> </strong>:</p><p id="1738" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有时，用户可能会误用输入操作，比如重复单击表单中的提交按钮，向服务器端数据库发送垃圾邮件。</p><p id="e2a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不允许用户在一小段时间间隔(比如 30 秒)之前重新单击 submit 按钮，可以阻止这种行为，从而保持数据库的整洁。</p><p id="2be9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">去抖让我们轻松实现这一功能。</p><h1 id="63e6" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">去抖的基本逻辑流程:</h1><p id="d5b9" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">1.设置您想要去抖的函数或方法的<strong class="jm io">超时，带有初始延迟间隔。</strong></p><p id="284f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.如果某个用户动作<strong class="jm io">在延迟间隔</strong>内调用了函数或方法，<strong class="jm io">再次将超时</strong>重置为延迟间隔。</p><p id="b2f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.<strong class="jm io">如果超时，则调用</strong>该函数或方法。</p><p id="96a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是一个简单的代码片段，它用 JavaScript 实现了去抖功能:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/12b3e5e069e020986edf4db9d56c445f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-mtYnKdkssHiY_TIe7qhQ.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">JavaScript 中的去抖</figcaption></figure><p id="e3ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这种去抖实现有两个关键特性。它是:</p><h2 id="6ffc" class="mn le in bd lf mo mp dn lj mq mr dp ln jv ms mt lr jz mu mv lv kd mw mx lz my bi translated"><em class="mz"> 1。灵活</em></h2><p id="c5cb" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">您可以在被调用的函数中传递尽可能多的参数(我们稍后将深入研究代码逻辑)。</p><p id="aa8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您也可以将延迟设置为您喜欢的毫秒数。</p><h2 id="a2c1" class="mn le in bd lf mo mp dn lj mq mr dp ln jv ms mt lr jz mu mv lv kd mw mx lz my bi translated">2.可重复使用的</h2><p id="f4fe" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">上面的去抖功能被很好地包装成一种“迷你模块”。</p><p id="1c2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以在任何一段代码中轻松地插入和播放它。此外，它的灵活性使它非常适合在任何情况下重用。</p><h1 id="d68e" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">代码分解</h1><ol class=""><li id="a1bd" class="kt ku in jm b jn mb jr mc jv na jz nb kd nc kh ky kz la lb bi translated"><strong class="jm io">默认延迟参数:</strong></li></ol><p id="af4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经给出了一个默认的延迟参数，使其无需定制即可重用。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/98ccd16ad560670af67bf662de19907c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-UIpLS9u8Ba0OISRWjv5A.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">默认延迟参数—去抖</figcaption></figure><p id="5a37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.Rest 操作符允许我们收集任意数量的参数:</p><p id="a5e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用了<strong class="jm io"> apply </strong>方法将参数绑定到被调用的函数。</p><p id="e41d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用<strong class="jm io"> Rest 操作符(…) </strong>来收集我们希望在被调用的函数中包含的参数。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/1d4fd546ff9b79b58745525b6b2451b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dBJ6iFiuE988yGp0aUdIw.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">Rest 运算符在去抖中收集许多参数</figcaption></figure><h1 id="9b81" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">去抖的替代实现:</h1><p id="3401" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">我们还可以使用<strong class="jm io"> performance.now() </strong>方法来实现去抖，该方法测量从时间起点(网页的开始)起经过的时间。</p><p id="40f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本方法是这样的:</p><ol class=""><li id="33ca" class="kt ku in jm b jn jo jr js jv kv jz kw kd kx kh ky kz la lb bi translated"><strong class="jm io">记录时间原点</strong>并存储在某个变量中，比如原点。</li><li id="d9cc" class="kt ku in jm b jn nd jr ne jv nf jz ng kd nh kh ky kz la lb bi translated"><strong class="jm io">初始设定从去抖到原点</strong>的退出时间。</li><li id="1946" class="kt ku in jm b jn nd jr ne jv nf jz ng kd nh kh ky kz la lb bi translated"><strong class="jm io">记录用户动作调用时进入去抖</strong>的时间。</li><li id="691a" class="kt ku in jm b jn nd jr ne jv nf jz ng kd nh kh ky kz la lb bi translated"><strong class="jm io">如果退出时间超过进入时间超过设定延迟</strong>，则执行该功能。这是逻辑中的关键一步。</li><li id="fadb" class="kt ku in jm b jn nd jr ne jv nf jz ng kd nh kh ky kz la lb bi translated"><strong class="jm io">否则将退出时间设置为等于进入时间，</strong>并退出去抖。</li></ol><p id="69b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是我们如何用 JavaScript 实现这一点:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/b710e3d123e6f5ee79e0d4ad2a1d227f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_cSMk09fhNXN1KRNcMUCw.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">去抖——替代实施</figcaption></figure><p id="a85f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在这里顺便提一下，你也可以选择一个现成版本的去抖。相当多的 JS 库提供了现成的去抖功能。</p><p id="8ab4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">去抖是一个很棒的功能，可以巧妙地引导用户的行为。正如我们在上面看到的，它还可以防止数据库损坏。</p><p id="9f4e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望你喜欢这篇小文章，并准备好用一些有趣的反弹和谴责来震撼你的代码！Lol！</p></div></div>    
</body>
</html>