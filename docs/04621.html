<html>
<head>
<title>Why Writes in Cassandra Are So Fast?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么卡珊德拉的书写速度这么快？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/why-writes-in-cassandra-are-so-fast-ae4ad9413902?source=collection_archive---------0-----------------------#2021-04-12">https://blog.devgenius.io/why-writes-in-cassandra-are-so-fast-ae4ad9413902?source=collection_archive---------0-----------------------#2021-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1123e50ca74258334b93ad513725cd47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ykI7FaXTsIILeoZP"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">杰克·吉文斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9d98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Cassandra 是一个分布式数据库，支持难以置信写操作，并以其可伸缩性和可用性而闻名。它非常适合支持具有极高写入吞吐量的应用程序。</p><p id="1c5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了实现这种高性能，Cassandra 有一种独特的写入模式。Cassandra 使用了几种不同的数据结构:</p><ul class=""><li id="576c" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">提交日志(磁盘)</li><li id="d0b7" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Memtable(内存)</li><li id="a6a2" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">表(磁盘)</li></ul><p id="d216" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这三种数据结构都包含在每个写入过程中。</p><h1 id="1bbd" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 1:写入提交日志</h1><p id="f749" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">当有写入时，Cassandra 做的第一件事是将其写入提交日志。提交日志是出于持久性目的的仅附加记录日志。如果一个节点在写入过程中关闭或数据损坏，Cassandra 可以使用其提交日志来重放所有事件并重建数据库。</p><p id="f17a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">写入提交日志非常快速高效。万一节点在写入完成前关闭，它也能让您安心。</p><h1 id="e54f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 2:写入 Memtable [Memory]</h1><p id="65d2" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">Cassandra 维护一个名为 Memtable 的内存数据结构。写入提交日志后，Cassandra 会将您的数据写入内存中的 Memtable。一旦数据被写入 memtable，节点就确认写操作成功。</p><p id="7634" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你没看错，Cassandra 在写入内存数据结构后认为写操作是成功的。你现在可能会问，如果节点关闭了呢？还是记忆被抹去了？</p><p id="e0da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于其提交日志和写入冗余，Cassandra 能够在这些情况下进行恢复。提交日志让 Cassandra 在 Memtable 被清除的情况下恢复丢失的数据。写操作还被复制到多个其他节点，因此，如果一个节点丢失了它的 Memtable 数据，有一些机制可以实现最终的一致性。</p><p id="fd85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">写入内存数据结构比写入磁盘快得多。正因为如此，卡珊德拉写作速度极快！</p><p id="3d6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来你可能会问，卡珊德拉肯定不能把所有的数据都存在内存里吧？当然不是。Memtable 被 Cassandra 用作临时缓冲区。Cassandra 会定期将其内容从 Memtable 刷新到名为 SSTable 的磁盘数据结构中。现在让我们来看看。</p><h1 id="4b80" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">步骤 3:刷新到表[磁盘]</h1><p id="dacc" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">Cassandra 在实际保存数据的磁盘中包含多个表。</p><p id="f0da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Cassandra 可以通过两种方式决定何时将其 Memtable 内容刷新到磁盘:</p><ol class=""><li id="c693" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la ms lh li lj bi translated">周期性地。经过一段固定的时间后，它会将其内容写入磁盘。</li><li id="2750" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la ms lh li lj bi translated">内存表大小。每当 memtable 达到一个固定的大小时，比如说 4 MB，它就会刷新 memtable。</li></ol><p id="dac8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦数据写入表中，内存表就会被清除，为更多的输入数据做好准备。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/39207747c4fe66a9aee2a63f2fe77788.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*VEAPFhCeZfbYy2lAzauEVw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">写过程(从<a class="ae kc" href="https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlHowDataWritten.html" rel="noopener ugc nofollow" target="_blank"> DataStax </a> docs 获得)</figcaption></figure><h1 id="0a05" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">结束语</h1><p id="eeaf" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">这就是卡珊德拉写得如此之快的原因。当节点将数据写入其内存中的 Memtables 时，写入操作会得到确认。正因为如此，卡珊德拉可以处理疯狂的写卷。</p></div></div>    
</body>
</html>