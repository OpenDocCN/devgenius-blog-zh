<html>
<head>
<title>Integrating Socket.io in NodeJS Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 NodeJS 应用程序中集成 Socket.io</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/integrating-socket-io-in-nodejs-application-8e6da4f5930e?source=collection_archive---------1-----------------------#2022-11-21">https://blog.devgenius.io/integrating-socket-io-in-nodejs-application-8e6da4f5930e?source=collection_archive---------1-----------------------#2022-11-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1451ea5278796f56789a32a5be3174fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K91yVP0ewgIiJVz_.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">pic Credit @bitsrc.io</figcaption></figure><p id="8269" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这篇博客中，我们将在 NodeJS 应用程序中使用 socket.io。如果你以前没听说过 socket.io</p><blockquote class="kx ky kz"><p id="126e" class="jz ka la kb b kc kd ke kf kg kh ki kj lb kl km kn lc kp kq kr ld kt ku kv kw ig bi translated">插座。IO 是一个用于实时 web 应用程序的事件驱动库。它支持 web 客户端和服务器之间的实时双向通信。</p></blockquote><p id="398a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你可以从他们的官方<a class="ae le" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank">网站</a>了解更多。</p><p id="5a34" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们将建立简单的聊天应用程序。以下是我们将涉及的要点</p><ol class=""><li id="9fdd" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw lk ll lm ln bi translated">带有 socket.io 的 NodeJS 服务器</li><li id="8527" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated">客户端应用程序监听 socket.io</li><li id="ec51" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw lk ll lm ln bi translated">聊天 Ui 和触发 socket.io 事件</li></ol><h2 id="545a" class="lt lu in bd lv lw lx dn ly lz ma dp mb kk mc md me ko mf mg mh ks mi mj mk ml bi translated"><strong class="ak">将 Socket.io 与 NodeJS 应用集成</strong></h2><p id="6815" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">我们将按照以下步骤在 NodeJS 应用程序中添加 socket.io</p><ul class=""><li id="8493" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">首先在 express-generator 的帮助下创建 NodeJS 应用程序，如果您没有安装 express generator，那么您可以通过键入以下命令来安装它</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="b078" class="nb lu in mx b be nc nd l ne nf">npm install -g express-generator</span></pre><ul class=""><li id="a8cb" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">现在生成以 hbs(车把)为前端模板的 NodeJS app。</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="c1f2" class="nb lu in mx b be nc nd l ne nf">npx express-generator --view=hbs -d chat</span></pre><ul class=""><li id="72fa" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">上面的命令将为您创建一个节点应用程序，包含所有必需的依赖项。现在转到<code class="fe ng nh ni mx b">chatting_app</code>目录，键入以下命令</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="fb87" class="nb lu in mx b be nc nd l ne nf">cd chatting_app<br/>npm i<br/>npm start</span></pre><p id="1f39" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">App 默认会在端口<code class="fe ng nh ni mx b">3000 </code>启动。可以在浏览器中打开<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。</p><ul class=""><li id="cfef" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">现在，我们将在应用程序中添加 socket.io。让我们首先安装 socket.io</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="f187" class="nb lu in mx b be nc nd l ne nf">npm install socket.io --save</span></pre><ul class=""><li id="8947" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">在项目中创建一个<code class="fe ng nh ni mx b">helper </code>文件夹，在助手文件夹下创建<code class="fe ng nh ni mx b">socket.helper.js</code>文件，并将下面的代码粘贴到这个文件中。</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="ba1d" class="nb lu in mx b be nc nd l ne nf">const io = require("socket.io")();<br/>const socketapi = {<br/>    io: io<br/>};<br/><br/>// Add your socket.io logic here!<br/>io.on("connection", function (socket) {<br/>    console.log("A user connected");<br/><br/>    socket.on("message", (data) =&gt; {<br/>        console.log("message from client", data);<br/>        // broadcast received message to all other clients<br/>        socket.broadcast.emit("message", {message: "Hello from server: " + data.message})<br/>    });<br/><br/>    socket.on("end", () =&gt; {<br/>        console.log("user left");<br/>    })<br/>});<br/>// end of socket.io logic<br/><br/><br/>module.exports = socketapi;</span></pre><ul class=""><li id="976b" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">在上面的代码中，我正在监听我们将从客户端接收的<strong class="kb io">消息</strong>事件。因此，当我们收到消息事件时，它也会有一些数据，我们将借助回调函数来获取这些数据。</li><li id="a5ba" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw mr ll lm ln bi translated">现在，我们将从客户端向所有其他连接到应用程序的客户端广播收到的消息。</li><li id="fd0c" class="lf lg in kb b kc lo kg lp kk lq ko lr ks ls kw mr ll lm ln bi translated">现在打开<code class="fe ng nh ni mx b">bin/www</code>文件，修改如下</li></ul><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="7fe4" class="nb lu in mx b be nc nd l ne nf">#!/usr/bin/env node<br/><br/>/**<br/> * Module dependencies.<br/> */<br/><br/>var app = require('../app');<br/>var debug = require('debug')('chatting-app:server');<br/>var http = require('http');<br/>const socketapi = require("../helpers/socket.helper"); // added this line<br/><br/>/**<br/> * Get port from environment and store in Express.<br/> */<br/><br/>var port = normalizePort(process.env.PORT || '3000');<br/>app.set('port', port);<br/><br/>/**<br/> * Create HTTP server.<br/> */<br/><br/>var server = http.createServer(app);<br/>socketapi.io.attach(server); // added this line<br/><br/>/**<br/> * Listen on provided port, on all network interfaces.<br/> */<br/>//... </span></pre><ul class=""><li id="37dc" class="lf lg in kb b kc kd kg kh kk lh ko li ks lj kw mr ll lm ln bi translated">在上面的代码中，我们将 socket.io 服务器连接到 NodeJS 服务器。</li></ul><p id="4d8b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，通过进行上述更改，您已经成功地将 socket.io 集成到了 NodeJS 应用程序中。Socket.io 服务器也在监听与 NodeJS 服务器运行相同的端口。</p><h2 id="248f" class="lt lu in bd lv lw lx dn ly lz ma dp mb kk mc md me ko mf mg mh ks mi mj mk ml bi translated">在前端添加 Socket.io</h2><p id="a9a7" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">首先用下面的代码更新您的<strong class="kb io"> layout.hbs </strong>文件。在这里，我添加了 jQuery、Socket.io 客户端库和自定义 javascript 文件，我们将在其中编写 socketIo 代码。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="065f" class="nb lu in mx b be nc nd l ne nf">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/><br/>&lt;head&gt;<br/>  &lt;title&gt;{{title}}&lt;/title&gt;<br/>  &lt;link rel='stylesheet' href='/stylesheets/style.css' /&gt;<br/>  &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;<br/><br/>&lt;body&gt;<br/>  <br/>  {{{body}}}<br/><br/>  &lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br/>  &lt;script src="/javascripts/index.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="549b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在用下面的代码更新<strong class="kb io"> index.hbs </strong>。在这里，我添加了一个 div 元素，我将在其中显示从服务器收到的所有消息，并添加了一个输入框，我们将在其中键入消息。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="7d73" class="nb lu in mx b be nc nd l ne nf">&lt;div id="main"&gt;<br/>    &lt;div class="messages"&gt;&lt;/div&gt;<br/>    &lt;input id="message" placeholder="Enter your message"&gt;<br/>&lt;/div&gt;</span></pre><p id="2855" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在在<strong class="kb io"> public/javascripts </strong>文件夹下创建<strong class="kb io"> index.js </strong>文件，并在其中添加以下代码。这里我添加了 io()构造函数，它将尝试监听 socketIo 服务器，默认情况下，它将监听默认的 post 和主机，即<a class="ae le" href="http://localhost:300" rel="noopener ugc nofollow" target="_blank"> http://localhost:300 </a> 0。</p><p id="d75a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一行中，我添加了两个选择器 1。对于消息输入框和 2。消息类选择器。在下一行，我添加了模糊事件(当一个对象失去焦点时，这个事件将被触发)并向服务器发送消息。</p><p id="74dd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我正在监听我们在 NodeJS 后端触发的 socket.io 消息事件。在回调中，它将包含我们在后端触发事件时发送的数据。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="4cae" class="nb lu in mx b be nc nd l ne nf">const socketIo = io();<br/><br/>const message = $("#message"); // input selector on id<br/>const messages = $(".messages"); // messages div selector on class<br/><br/>message.on("blur", function () {<br/>    const val = message.val();<br/>    // val is not empty <br/>    if (val) {<br/>        // emit message to server<br/>        socketIo.emit('message', { message: val });<br/>    }<br/>})<br/><br/>// Receive message from the server<br/>socketIo.on("message", function (data) {<br/>    messages.append(`&lt;p&gt;${data.message}&lt;/p&gt;`)<br/>})</span></pre><p id="6c8b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里有两个窗口，当我在一个窗口中输入任何东西时，你会在除当前窗口之外的所有其他窗口中看到这条消息，反之亦然。</p><p id="42d2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第二个窗口</strong></p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/6f3b551fc814ab28f78e4e3600c78460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1eb39buDqjDMgKfRnl2hw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">窗口 2</figcaption></figure><p id="33ee" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">第一个窗口</strong></p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/24e58155a2b6f3ab012a59bc47d85af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFPkgl-qCY-rdERnME37Bg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">窗口 1</figcaption></figure><p id="7cef" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">可以在多个窗口打开<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>并尝试测试。你会收到从一个窗口发送到另一个窗口的消息。</p><h2 id="b2aa" class="lt lu in bd lv lw lx dn ly lz ma dp mb kk mc md me ko mf mg mh ks mi mj mk ml bi translated">结论</h2><p id="2071" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">在这篇博客中，我们看到了如何将 socket.io 集成到 NodeJS 应用程序中。这里我举了一个简单例子来构建聊天应用程序。但是你可以用 socket.io 做很多好事情，比如构建通知功能，多人游戏等等。</p><p id="1cc6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢你阅读这篇博客，希望你会喜欢。如果是的话，请鼓掌并跟随我看更多这样的博客。<strong class="kb io">我有自己的 YouTube 频道，我在那里创建基于 NodeJS 的项目，你可以在这里</strong>  <strong class="kb io">查看</strong> <a class="ae le" href="https://www.youtube.com/channel/UCvEB7wXUEXGFE9lCx0USR3Q" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">。同样的博客也将在 https://ajaykrp.me/</strong></a>推出</p></div></div>    
</body>
</html>