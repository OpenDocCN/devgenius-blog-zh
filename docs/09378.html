<html>
<head>
<title>You Can Still have 100% Code Coverage With Untested Code!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对于未测试的代码，您仍然可以拥有 100%的代码覆盖率！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/you-can-still-have-100-code-coverage-with-untested-code-ce3d6a1604be?source=collection_archive---------14-----------------------#2022-08-17">https://blog.devgenius.io/you-can-still-have-100-code-coverage-with-untested-code-ce3d6a1604be?source=collection_archive---------14-----------------------#2022-08-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="e144" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">代码覆盖率一直是测试在一个测试过程中成功执行的行数的度量标准，但是您的代码覆盖率实际上告诉了您什么呢？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6bd2934f134107410d845c9906aeb43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AnCLPijwIPiFRUwo"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">穆罕默德·拉赫马尼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a114" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我曾经尝试回答这个问题“<em class="kz">, 100%的代码覆盖率是可靠性和代码质量的衡量标准吗？</em>”。我使用<a class="ae ky" href="https://codecov.io/" rel="noopener ugc nofollow" target="_blank"> CodeCov </a>和<a class="ae ky" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>演示了一个测试管道，以可视化覆盖率是如何工作的，并试图以此来回答这个问题。在这篇文章中，我将更深入地研究代码覆盖率度量能告诉你什么，以及从中能得到什么。</p><div class="la lb gp gr lc ld"><a rel="noopener  ugc nofollow" target="_blank" href="/getting-started-with-code-coverage-using-codecov-b40f4fe1c91c"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">代码覆盖率入门:使用 CodeCov</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">" 100%的代码覆盖率是可靠性和代码质量的衡量标准吗？"</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">blog.devgenius.io</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr ks ld"/></div></div></a></div><p id="d83b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">总之，代码覆盖率越高，只是测试过程中遇到大量代码行的一种度量。它衡量的是可靠性、安全性还是兼容性？不一定——这是一个衡量标准，用来了解你的代码库的测试生产者达到了多少覆盖率。换个角度来看，100%的代码覆盖率会发生什么？</p><h1 id="aa04" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">以代码覆盖率作为衡量标准</h1><p id="f638" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">我并不是说代码覆盖是不必要的。相反，我认为在每个项目中都应该测量代码覆盖率。如果有的话，代码覆盖率是一个简单的度量，但是它需要被很好地定义，以作为测试代码的坚实和稳定的基础。换句话说，这个标准和你的编程语言类型、测试生成器、业务逻辑和集成一样好。我知道在一个存储库上看到更高的覆盖率是吸引人和有趣的。你自动想到，<em class="kz">“哇！这是一个久经考验的可靠回购”。</em>但是，您可能会发现一些未解决的问题、未解决的拉取请求和一些错误。那是什么意思？为什么会这样？</p><p id="9b60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一方面，代码覆盖本身并不是一种测试方法。它是对调用特定函数后执行多少行代码的度量。代码覆盖率相当于计算机体系结构中的命中率和失效率。有多少命中— <strong class="jm io">已执行的代码行</strong> —与命中— <strong class="jm io">未执行的代码行</strong>。然而，计算机体系结构中的命中率可以决定缓存内存的性能，但代码覆盖率却不能。</p><p id="4841" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于我之前写的一些文章，我收到了一些真诚和建设性的反馈，尤其是关于<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/getting-started-with-code-coverage-using-codecov-b40f4fe1c91c?source=your_stories_page-------------------------------------">之前的代码覆盖率文章</a>。下面是一些想法，这些想法可以在代码覆盖率仍然较高的情况下实现。</p><h2 id="3595" class="mv lt in bd lu mw mx dn ly my mz dp mc jv na nb mg jz nc nd mk kd ne nf mo ng bi translated">未测试代码</h2><p id="4e94" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">“使用未经测试的代码，您仍然可以拥有 100%的代码覆盖率”——软件工程师<a class="ae ky" href="https://www.linkedin.com/in/the-galal/" rel="noopener ugc nofollow" target="_blank"> Amr Galal </a>。还记得那个吸引人且可靠的回购吗？想象一下，某个开发人员负责实现一个 API 端点，但由于某种原因，它并没有得到实际测试。在这种情况下，覆盖率是骗人的，因为从测试过程中调用 API 并没有发生，这意味着覆盖率将测量代码的命中和缺失行的入口点实际上并没有发生。</p><p id="8345" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是否意味着您可以逃脱未经测试的代码？嗯，首先，你<strong class="jm io">不应该</strong>有未经测试的代码。换句话说，无论您使用什么测试方法——单元测试、集成测试等等，如果不测试逻辑基础和代码块需要的任何集成，就不应该提交代码块。</p><h2 id="fb4a" class="mv lt in bd lu mw mx dn ly my mz dp mc jv na nb mg jz nc nd mk kd ne nf mo ng bi translated">资料检索</h2><p id="2c3c" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">覆盖率不是数据检索和集成的指标。数据检索定制一直是后端和前端开发人员之间的一个难题。开发人员同意某种适合设计的定制，并开始数据交换。</p><p id="9dc2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，这种定制属于集成测试。换句话说，测试过程成功通过的几个实体之间的验证。除非您将覆盖范围扩展到两个实体，其中百分比度量可以单独度量每个实体的有效性以及它们之间的集成，否则您仍将度量假定定制的单元测试。</p><p id="f4a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">简单来说，想象一个静态分页的 API 正在被测试，这意味着页面和项目的数量是由设计静态设置的。在后端，覆盖率将是测试用例的结果，对吗？在这种情况下，您正在测试 API，对吗？测试程序是否验证了数据检索定制？因为如果没有，它将是<strong class="jm io">未测试代码</strong>，反之亦然。因此，您可以拥有更高的代码行覆盖率，但仍然存在数据检索和集成的问题。</p><h2 id="1e5f" class="mv lt in bd lu mw mx dn ly my mz dp mc jv na nb mg jz nc nd mk kd ne nf mo ng bi translated">故障容限</h2><p id="7324" class="pw-post-body-paragraph jk jl in jm b jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd mu kf kg kh ig bi translated">大多数项目都达到了容错。实现这一目标的最快方法是尝试处理尽可能多的个案。错误处理是每个项目中的一个主要因素，测试应该保留这一点。</p><p id="dba7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但这就是测试的全部吗？不完全是。让我解释一下。</p><p id="2b00" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在之前的一个项目中，在<em class="kz"> 100%代码覆盖率</em>的情况下，我每隔一段时间进行一次网速测试，并将其作为数据条目保存在数据库中。我的测试方法非常简单。使用持续集成——在 GitHub 的服务器上运行测试，测试总是通过的，因为当然管道上总是有互联网。然而，在我的本地机器上测试它，没有互联网连接，项目和测试失败了。</p><p id="9f17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那是什么意思？我的项目测试很差吗？但是我的覆盖率很高！</p><p id="181f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终，我在项目中添加了一个错误处理程序来检查互联网连接，并相应地调整了一切。但最后，这意味着测试设计很重要。但是我用覆盖率做什么呢？使用覆盖率来验证您的测试生产者测试了您实现的代码的每一部分。主要是验证测试块实际上达到了每个极限情况。</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><p id="aa30" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当然，有许多解决问题的技术，如<strong class="jm io">未测试代码、数据检索和容错</strong>。比如一个常见的手法就是<a class="ae ky" href="https://opensource.com/article/17/4/flashback-internet-mocking-tool" rel="noopener ugc nofollow" target="_blank"> <em class="kz">系统和数据嘲讽</em> </a>。您模仿函数、方法甚至响应来产生可靠和稳定的基础设施。然而，这不是本文的目的，目的是尝试并可视化 100%的代码覆盖率对你的项目有什么影响。如前所述，代码覆盖率是您的测试、模拟和错误处理功能达到原始代码库更高范围的一种表示。</p><p id="d655" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">想象一个开发人员在一个项目中开发一个新的特性。然后开发人员编写一些测试程序并提交他们的代码。代码覆盖率会发生什么？增加？减少？保持不变？</p><p id="a2f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一名开发人员，你可以将代码覆盖率作为测试过程、新特性和一般逻辑的标志。代码覆盖可以帮助你发现你没有测试过的逻辑部分，因此——<strong class="jm io">未测试代码</strong>。相反，开发者现在会明白如何修改测试块。另一方面，如果代码覆盖率增加或者保持不变，这是一件相对好的事情，因为你清楚测试和项目的逻辑。然而，测试基础本身不能通过对代码覆盖率的影响来衡量。</p><p id="d3e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，如果你已经测试了每一个极限情况，每一个新特性的集成，并且你的代码覆盖率没有变化或者增加，你就清楚了！</p><h1 id="88f4" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">谢谢！</h1></div></div>    
</body>
</html>