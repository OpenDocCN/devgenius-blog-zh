<html>
<head>
<title>Top 10 Tips to Improve the Build Speed of your Android Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提高Android项目构建速度的10大技巧</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/top-10-tips-to-improve-the-build-speed-of-your-android-projects-8526bcf97cd4?source=collection_archive---------0-----------------------#2021-08-31">https://blog.devgenius.io/top-10-tips-to-improve-the-build-speed-of-your-android-projects-8526bcf97cd4?source=collection_archive---------0-----------------------#2021-08-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/f2e41a41ab956c28f0abb7b7d064ef88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*N2Ui1ExaDwn5Bp2ABnE4Gw.png"/></div></figure><p id="7e75" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Android项目开发速度慢意味着产品质量低。这种感觉类似于开着车在路上不停地撞一个又一个减速带。更快的开发速度对于获得对生产力至关重要的动力是必不可少的。但是如何提高android项目的开发速度呢？</p><p id="2164" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">答案很简单——实施我们在这篇博客中建议的技巧，你可以将开发构建时间增加四倍。这不过是一套Android最佳实践。为了展示实践的效果，我们将使用<a class="ae kp" href="https://santatracker.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌的圣诞老人追踪器</a> Android项目作为指导示例。但是在我们讨论技巧之前，请记住构建时间取决于项目特征和构建环境。</p><p id="55a6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">说到构建环境，有三种类型的构建场景，如下所示:</p><ul class=""><li id="c5b8" class="kq kr in jt b ju jv jy jz kc ks kg kt kk ku ko kv kw kx ky bi translated">完整版本(干净的汇编调试版本)</li><li id="a99a" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated">增量构建:Java变更(方法实现中的一行Java变更)</li><li id="71fc" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated">增量构建:资源更改(简单的添加或移除字符串资源)</li></ul><h1 id="49e4" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">提高android项目构建速度的最佳实践</h1><h1 id="6ab9" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧1:使用最新的Android Gradle插件</h1><p id="32ac" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">我想给的第一个建议是使用最新的Android Gradle插件。android团队努力修复所有错误，提高性能，并在每个新版本中添加新功能。所以你要确保你用的是最新版本的Gradle。</p><p id="9a42" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="4c81" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">据从旧的Gradle插件2.2.0转换到3.0-alpha1的人说，他们注意到38%的Java变化，16%的资源变化，和25%的完整构建。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/496c61a9e6685365209c7273358fe19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/0*1D7R1WMIByvM_7Pz"/></div></figure><h1 id="be37" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧2:避免遗留的多索引</h1><p id="1d02" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">如果您的应用程序超出了64K方法的引用限制，您将需要一个multidex。但是在您开始使用multidex之前，让我警告您，如果您的minSDKVersion低于21，这意味着您将使用遗留版本。这会显著降低构建时间。如果你使用Android Studio 2.3+那么它会自动避免这一点。</p><p id="615b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="fe80" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">使用multidex可以将构建时间从完全构建减少大约5秒，从增量Java更改减少大约8秒，并且增量资源不会发生任何更改。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/df299322aace5cb571bd33b3822c40c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*HQIk3kc_sH64kMns"/></div></figure><h1 id="2656" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧3:禁用多APK</h1><p id="00d2" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">如果你想提高你的android构建时间，那么你可能想在你的开发构建中禁用多APK。您可以通过使用领域特定语言(DSL)中的Split块来暗示这一点。当您创建多个SDK时，不需要定义维度，因此您在开发构建中不再需要多APK。</p><p id="617c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">但是，您不能直接从分割块中禁用多APK生成，因为该块对于包括生产和开发在内的所有构建变体都是全局的。您可以通过定义一个名为devBuild的属性来正确地做到这一点。如果Gradle看到属性并能够设置splits.abi和splits。密度为假，那么你再也不用担心多APK代了。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6fd561b30d4d34833da176df6231e011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/0*zMkrgSxpiE0i13zU"/></div></figure><p id="3770" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="1ec2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">与其他建议类似，这个建议也将对整个构建时间产生良好的影响。</p><h1 id="7b65" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧4:包含最少的资源</h1><p id="583d" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">现在，如果你想改进你的android构建时间，那么我建议你应该减少你在android开发项目中打包的资源。默认情况下，系统会在您的应用程序或应用程序用来定义的库中添加每种语言和屏幕密度的资源。</p><p id="532e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在这里，如果你的android应用程序支持所有语言和屏幕密度，你将浪费大量的构建时间。在开发阶段，你几乎不会用到这些资源。</p><p id="60bb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">借助resConfigs关键字来解决这个问题，并定义在开发构建期间需要使用的语言和屏幕密度。例如，假设我们要使用英语；</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/42a4139d6e8de7c9e05f6daf712d1980.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/0*PwFN0uDi7U0cIJkD"/></div></figure><p id="0a50" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="c651" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">根据试运行，在开发构建期间使用这种实践，您可以在全盲测试中节省6秒，在Java更改中节省1.5秒，在资源更改中节省2秒。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/67cf33d32674e3a1c8c986e3bbc33eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/0*DwoUbtzsoT-0Ot3Q"/></div></figure><h1 id="6ef2" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧5:禁用PNG处理</h1><p id="ba28" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">我的下一个建议是也禁用PNG处理。要制作一个小的APK，你的应用程序将压缩PNG以最小化它的大小。这是默认设置。现在，你可能会说，为什么禁用这样一个好东西，当它在你的APK发布时是有益的，那么我给你的答案是，它对开发构建没有好处。您可以使用我们在本文技巧3中讨论的相同属性来避免PNG崩溃。当Gradle看到该属性时，它会将aaptOptions.cruncherEnabled设置为false。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/b0b50d1a73f4acd5f1916ee8aaa0db3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/0*L_z4W6kseV6bIl5r"/></div></figure><p id="fe87" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="3e57" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">当您禁用PNG处理时，它不会对Java更改和资源更改产生太大影响，但是它确实将整个构建时间减少了9秒。我不需要告诉你这种改善有多显著。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/714808b1dd914ec680490355747add35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/0*2rgi1Gy1EZa0U1bM"/></div></figure><h1 id="d8d3" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">提示6:使用即时跑步</h1><p id="5926" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">Android Studio 2.0提供即时运行，但它只能在API 21或更高版本中工作。但这并不意味着您可以将应用程序的min SDK设置得比这个低。这仅仅意味着运行即时运行的设备需要是API 21或更高版本。</p><p id="334c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，您可以使用Android Studio的几个按钮来控制应用程序重启的次数，如下所示:</p><ul class=""><li id="f57a" class="kq kr in jt b ju jv jy jz kc ks kg kt kk ku ko kv kw kx ky bi translated">Run用于部署所有更改并重启应用程序。</li><li id="47a5" class="kq kr in jt b ju kz jy la kc lb kg lc kk ld ko kv kw kx ky bi translated">应用更改用于更改您的资源和代码更改。您也可以使用它来仅重启活动，而不重启整个应用程序。</li></ul><p id="7c4e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="c464" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在运行Instant Run之后，资源更改和Java更改减少了3秒，而在完整构建中减少了7秒。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/8b13c3e8c598bd72c4021d787d2390b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/0*cP1JN7Az-FwMxJC9"/></div></figure><h1 id="5142" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧7:避免不经意的改变</h1><p id="d851" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">虽然我不建议这样做，但有必要向您的android开发人员暗示这个技巧。您应该尽一切可能避免对项目进行不经意的更改。</p><p id="a563" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">程序员为了避免不经意的更改，会使用当前的日期时间作为应用程序的版本代码。因此，您将在每次构建时获得一个唯一的ID，当质量保证团队发现一个bug时，他们可以知道它的具体构建。</p><p id="d792" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">虽然这听起来像是一件好事，但它确实迫使android开发人员对每个版本进行更改。结果呢？增加了android开发构建时间。但是，仍然可以看到程序员执行这种做法，以避免由于代码中发现的一些错误或病毒而导致的重大挫折。</p><h1 id="1822" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧8:不要使用动态版本的Gradle</h1><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/181f78f9fecc06841e1b9f8c4c717fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/0*i_iKObC2i-1E-OU0"/></div></figure><p id="2906" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Gradle提供了一种更舒适的方式，让你在(+)符号的帮助下使用最新版本的库。但是强烈建议您不要使用各种依赖关系的动态版本。现在，你使用它们不是很理想吗？</p><p id="80a6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果你使用动态版本，那么Gradle必须每24小时寻找任何给定库的最新版本。这应该会增加您的依赖性解决时间。这可能会对您的android应用程序的性能产生负面影响。因此，您需要做的是不要使用加号，而总是使用特定的依赖版本。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/25bd92f8a9ffb49ed82342ca6234d5fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/0*Vb9hD0GHQpk8mzcI"/></div></div></figure><h1 id="65e8" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧9:注意记忆</h1><p id="3e08" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">你的项目的特点很重要。每当你开始一个新的android项目，Android Studio都会给grad le 1.5千兆字节的内存。对于开发构建来说，这既是一件好事，也是一件坏事。要解决这个问题，你必须在Gradle.properties文件中调整应用程序的设置，并选择对你的android应用程序有利的设置。</p><h1 id="137c" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">技巧10:启用梯度缓存</h1><p id="d7b1" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">如果我告诉你，你现在可以缓存每个任务的所有输出，会怎么样？是的，借助一种叫做梯度缓存的新的缓存机制，这是可能的。现在不要把它与Gradle 2.3中发布的构建缓存Android混淆，因为它只能缓存pre-dex外部库。</p><p id="d112" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">虽然Gradle caching有同样的高级机制，但它不仅适用于最后一次构建，还适用于您之前处理过的每一次构建，而且适用于任何位置。启用Gradle缓存也将启用分布缓存，因此当您更改本地分支或功能分支时，您可以加快android应用程序的构建时间。</p><p id="9a19" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">但是如何执行Gradle缓存呢？如果你问，那么只需在你的gradle.properties文件中设置org.gradle.caching=true。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1567839947d9dc2f40c6d5ad337dd890.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/0*Isw5xwV8vgHMOpeI"/></div></figure><p id="2b2c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">结果</p><p id="9c7d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它对Java更改没有影响，但是它会稍微加快资源更改0.5秒，并通过减少7秒对完整构建产生巨大影响。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/ab58f0ef95d688e8ce96c4f8d50c08c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/0*DODwMADxGDu5Fu4u"/></div></figure><h1 id="4354" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">综合结果</h1><p id="77e3" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">看起来我们已经完成了。但是在我们离开之前，我需要你检查一下我在这个博客中向你建议的所有建议的集体结果。当我们综合这些结果时，我们得到了3倍的完整构建速度、12倍的增量Java更改速度和3倍的增量资源更改速度。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/89f08b24e2e6959a6bfebf6b0916b84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/0*bfb3_xj3aJ1gAqmX"/></div></figure><h1 id="31c5" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="d9bc" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated">在这篇博客中，我试图提供一些简单而有效的技巧和实践，你可以遵循它们来加快android项目的开发。我希望它们对你很有帮助。如果你认为你还有更多这样的建议，或者对我们在这里讨论的内容有任何疑问，那么请在下面的评论部分分享它们。我将感谢您的反馈。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="de43" class="nj lf in bd lg nk nl dn lk nm nn dp lo kc no np ls kg nq nr lw kk ns nt ma nu bi translated">更多相关链接:</h2><p id="cd43" class="pw-post-body-paragraph jr js in jt b ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/top-android-app-development-companies-378c1f33e74e" rel="noopener">顶级安卓开发公司</a></p><p id="fcbb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/top-enterprise-app-development-companies-ec9d861094ba" rel="noopener">顶级企业App开发公司</a></p><p id="1ab6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/best-react-development-companies-693617a9bd25" rel="noopener">顶级ReactJS开发公司</a></p><p id="a1da" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/best-angular-development-companies-46ec6a03394d" rel="noopener">顶级AngularJS开发公司</a></p><p id="3648" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/best-angular-development-companies-46ec6a03394d" rel="noopener">顶级NodeJS开发公司</a></p><p id="f581" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/top-software-companies/top-mobile-app-development-companies-in-the-united-kingdom-f8dc0d83bc44" rel="noopener">英国顶级移动应用开发公司</a></p></div></div>    
</body>
</html>