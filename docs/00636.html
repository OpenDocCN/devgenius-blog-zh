<html>
<head>
<title>Implementing AR in SwiftUI… without Storyboards</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 SwiftUI 中实现 AR…没有故事板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/implementing-ar-in-swiftui-without-storyboards-ec529ace7ab2?source=collection_archive---------0-----------------------#2020-06-13">https://blog.devgenius.io/implementing-ar-in-swiftui-without-storyboards-ec529ace7ab2?source=collection_archive---------0-----------------------#2020-06-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6efe07c428a773d4a08bfcf138dda998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hgelsorB0OUSwN0_"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/@freestocks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> freestocks </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6567" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">AR 通常是用故事板实现的，但不一定是 T21。本教程是为我的开发伙伴准备的，他们想把 SwiftUI 和 AR 配对，而不需要故事板的麻烦。</p><h1 id="ced3" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">我们开始吧</h1><p id="e201" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">转到您现有的 SwiftUI 项目；对于这个演示，我创建了一个新的单视图 SwiftUI 项目。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/0f8facd34ba89bbffa64fc4ccc095be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ju_xJMRIRoZU4cYD2TJOg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">创建单视图应用程序。</figcaption></figure><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/89bdb9c76da6999118ff30ea55327e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2VQq22YRdV1GvT5jK3wiA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">选择 SwiftUI 作为用户界面。</figcaption></figure><p id="79d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好消息！对于这种集成，不需要弄乱<code class="fe mi mj mk ml b">AppDelegate.swift</code>或<code class="fe mi mj mk ml b">SceneDelegate.swift</code>。我们将查看的唯一文件是<code class="fe mi mj mk ml b">ContentView.swift</code>和<code class="fe mi mj mk ml b">ARView.swift</code>(接下来您将创建它们)。</p><h1 id="f061" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">添加 AR 视图</h1><p id="ab23" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">将您的 ARView.swift 文件创建为常规 swift 文件。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/8d4fa3bf5787e349e0dd0409a5bd473e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijWirN9oELRJ-rgz0EHbnA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">将 ARView.swift 创建为常规 swift 文件。</figcaption></figure><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/95129bbe5eee3fa0e4ff712a35cf3864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLLGmB55cvJdyGdNA9fgpw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">项目中所有文件的概述。</figcaption></figure><p id="a179" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">斯威夫特是一张白纸。我们需要导入 ARKit 并用 UIViewController 和 ARSCNViewDelegate 协议声明 ARView 类。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="a976" class="ms la in ml b gy mt mu l mv mw"><strong class="ml io">import Foundation<br/>import ARKit</strong></span><span id="5680" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">class ARView: UIViewController, ARSCNViewDelegate {</strong></span><span id="52a1" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">}</strong></span></pre><p id="26e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们需要实际创建一个视图。这通常是使用故事板的 AR 项目具有 IBAction 出口的地方。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/cdfae4ae566e6c1d4167fb283f4373e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XeHzb-cUX6Wg1QQmvkopXg.png"/></div></div></figure><p id="a33a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将添加以下代码<strong class="kc io">(粗体)</strong>，而不是使用它:</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="13b8" class="ms la in ml b gy mt mu l mv mw">import Foundation<br/>import ARKit</span><span id="abaa" class="ms la in ml b gy mx mu l mv mw">class ARView: UIViewController, ARSCNViewDelegate {</span><span id="d571" class="ms la in ml b gy mx mu l mv mw">   <strong class="ml io">var arView: ARSCNView {<br/>      return self.view as! ARSCNView<br/>   }</strong></span><span id="7d91" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   override func loadView() {<br/>     self.view = ARSCNView(frame: .zero)<br/>   }</strong></span><span id="328a" class="ms la in ml b gy mx mu l mv mw">}</span></pre><p id="7e24" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们加载，指定一个代理，并为这个新的<code class="fe mi mj mk ml b">arView</code>创建一个场景。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="21a4" class="ms la in ml b gy mt mu l mv mw">import Foundation<br/>import ARKit</span><span id="68bf" class="ms la in ml b gy mx mu l mv mw">class ARView: UIViewController, ARSCNViewDelegate {<br/>   <br/>   var arView: ARSCNView {<br/>      return self.view as! ARSCNView<br/>   }</span><span id="24a3" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   </strong>override func loadView() {<br/>     self.view = ARSCNView(frame: .zero)<br/>   }</span><span id="5fcb" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   override func viewDidLoad() {<br/>      super.viewDidLoad()<br/>      arView.delegate = self<br/>      arView.scene = SCNScene()<br/>   }</strong></span><span id="3530" class="ms la in ml b gy mx mu l mv mw">}</span></pre><p id="299d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将把最后的位添加到我们的<code class="fe mi mj mk ml b">ARView</code>类中；这些是标准的 AR 视图和会话处理功能。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="005e" class="ms la in ml b gy mt mu l mv mw">import Foundation<br/>import ARKit</span><span id="af3a" class="ms la in ml b gy mx mu l mv mw">class ARView: UIViewController, ARSCNViewDelegate {<br/>   <br/>   var arView: ARSCNView {<br/>      return self.view as! ARSCNView<br/>   }</span><span id="1bb7" class="ms la in ml b gy mx mu l mv mw">   override func loadView() {<br/>     self.view = ARSCNView(frame: .zero)<br/>   }</span><span id="57eb" class="ms la in ml b gy mx mu l mv mw">   override func viewDidLoad() {<br/>      super.viewDidLoad()<br/>      arView.delegate = self<br/>      arView.scene = SCNScene()<br/>   }</span><span id="52e0" class="ms la in ml b gy mx mu l mv mw">   <strong class="ml io">// MARK: - Functions for standard AR view handling<br/>   override func viewDidAppear(_ animated: Bool) {<br/>      super.viewDidAppear(animated)<br/>   }</strong></span><span id="a309" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   override func viewDidLayoutSubviews() {<br/>      super.viewDidLayoutSubviews()<br/>   }</strong></span><span id="27d6" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   override func viewWillAppear(_ animated: Bool) {<br/>      super.viewWillAppear(animated)<br/>      let configuration = ARWorldTrackingConfiguration()<br/>      arView.session.run(configuration)<br/>      arView.delegate = self<br/>   }</strong></span><span id="e89b" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   override func viewWillDisappear(_ animated: Bool) {<br/>      super.viewWillDisappear(animated)<br/>      arView.session.pause()<br/>   }</strong></span><span id="fd6d" class="ms la in ml b gy mx mu l mv mw">   <strong class="ml io">// MARK: - ARSCNViewDelegate<br/>   func sessionWasInterrupted(_ session: ARSession) {}<br/>   <br/>   func sessionInterruptionEnded(_ session: ARSession) {}</strong></span><span id="21b9" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   func session(_ session: ARSession, didFailWithError error: Error)    <br/>   {}</strong></span><span id="e43e" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   func session(_ session: ARSession, cameraDidChangeTrackingState       <br/>   camera: ARCamera) {}</strong></span><span id="3bef" class="ms la in ml b gy mx mu l mv mw">}</span></pre><p id="f6d8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此时，确保将相机访问添加到<code class="fe mi mj mk ml b">Info.plist</code>，否则您的 AR 视图将不被允许呈现，并导致严重的 SIGABRT 错误。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/73d0bb5ab74ec1eae23df3d87e8415b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mmtqzKk57hpXtnu8eXULQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">允许摄像机进入。</figcaption></figure><h1 id="121b" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">把它绑在一起</h1><p id="92c1" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">为了在这个<code class="fe mi mj mk ml b">ARView</code>和 SwiftUI 之间转换，我们需要向<code class="fe mi mj mk ml b">ARView.swift</code>和<code class="fe mi mj mk ml b">Content.swift</code>添加一些 ViewIndicators。</p><p id="6792" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从<code class="fe mi mj mk ml b">ARView.swift</code>开始，在<code class="fe mi mj mk ml b">ARView</code>类声明上方添加以下内容。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="61be" class="ms la in ml b gy mt mu l mv mw">... //other imports<br/><strong class="ml io">import SwiftUI</strong></span><span id="2869" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">// MARK: - ARViewIndicator<br/>struct ARViewIndicator: UIViewControllerRepresentable {<br/>   typealias UIViewControllerType = ARView<br/>   <br/>   func makeUIViewController(context: Context) -&gt; ARView {<br/>      return ARView()<br/>   }</strong></span><span id="c246" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   func updateUIViewController(_ uiViewController:    <br/>   ARViewIndicator.UIViewControllerType, context:<br/>   UIViewControllerRepresentableContext&lt;ARViewIndicator&gt;) { }<br/>}</strong></span><span id="9eac" class="ms la in ml b gy mx mu l mv mw">... //ARView class declaration and rest of code</span></pre><p id="36d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">切换到 ContentView.swift，您将希望添加一个类似的 ViewIndicator，但使用不同的名称。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="5f57" class="ms la in ml b gy mt mu l mv mw"><strong class="ml io">// MARK: - NavigationIndicator</strong></span><span id="3629" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">struct NavigationIndicator: UIViewControllerRepresentable {<br/>   typealias UIViewControllerType = ARView</strong></span><span id="5171" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   func makeUIViewController(context: Context) -&gt; ARView {<br/>      return ARView()<br/>   }</strong></span><span id="0566" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">   func updateUIViewController(_ uiViewController: <br/>   NavigationIndicator.UIViewControllerType, context:<br/>   UIViewControllerRepresentableContext&lt;NavigationIndicator&gt;) { }<br/>}</strong></span><span id="74eb" class="ms la in ml b gy mx mu l mv mw">... //ContentView Struct</span></pre><h1 id="49b0" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">最后润色</h1><p id="0842" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">所以我们在<code class="fe mi mj mk ml b">ARView.swift</code>和<code class="fe mi mj mk ml b">ContentView.swift</code>中有一个免故事板的 ARView 类和 ViewIndicators，它们可以在两个视图之间无缝转换。</p><p id="ed71" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">尽管如此，我们仍然需要一种从 ContentView 主屏幕进入 ARView 的方法。让我们给<code class="fe mi mj mk ml b">ContentView.swift</code>添加一个堆栈结构和几个按钮来提示 ARView 这种调用视图的方法即使在更复杂的环境中也是一样的。</p><pre class="md me mf mg gt mo ml mp mq aw mr bi"><span id="6265" class="ms la in ml b gy mt mu l mv mw">... //NavigationIndicator</span><span id="652e" class="ms la in ml b gy mx mu l mv mw"><strong class="ml io">struct ContentView: View {<br/>   @State var page = "Home"<br/>   <br/>   var body: some View {<br/>      VStack {<br/>         if page == "Home" {<br/>            Button("Switch to ARView") {<br/>               self.page = "ARView"<br/>            }<br/>         } else if page == "ARView" {<br/>            ZStack {<br/>               NavigationIndicator()<br/>               VStack {<br/>                  Spacer()<br/>                  Spacer()<br/>                  Button("Home") {<br/>                     self.page = "Home"<br/>                  }.padding()<br/>                  .background(RoundedRectangle(cornerRadius: 10)<br/>                  .foregroundColor(Color.white).opacity(0.7))<br/>               }<br/>            }<br/>         }<br/>      }<br/>   }<br/>}</strong></span></pre><p id="9f9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行项目应该显示如下内容:</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/1dc3f5bd1224a832b042d374c723c69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8cThtGCWhe7X_RKT8NiXvQ.gif"/></div></div></figure><p id="d002" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<a class="ae jz" href="https://github.com/mgipson/AR-SwiftUI" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看完整代码。</p><h1 id="7b62" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">尽情享受吧！关注更多关于 iOS 开发、任何 Swift 和通用编程的文章和教程！</h1></div></div>    
</body>
</html>