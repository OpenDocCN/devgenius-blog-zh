<html>
<head>
<title>How to Create an Apple Card Payment Dial — Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Apple Card支付拨号——第5部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-create-an-apple-card-payment-dial-part-5-7b0b508c8a0f?source=collection_archive---------31-----------------------#2020-06-29">https://blog.devgenius.io/how-to-create-an-apple-card-payment-dial-part-5-7b0b508c8a0f?source=collection_archive---------31-----------------------#2020-06-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="dde2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">增加对动态文本和画外音的支持。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/73f74be662c803dc7f9937a0b360f086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXaJQuXKX_7lN03uphOe6Q.jpeg"/></div></div></figure><p id="3509" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">iOS有一些非常棒的工具和技术来支持可访问性。然而不幸的是，大多数开发者似乎完全忽略了它们！</p><h1 id="bb63" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">动态文本</h1><p id="5e22" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">让我们从简单的事情开始。iOS允许用户增加系统的字体大小。我们希望我们的dial是一个好的操作系统公民，并与我们合作。</p><blockquote class="lx ly lz"><p id="db54" class="jk jl ma jm b jn jo jp jq jr js jt ju mb jw jx jy mc ka kb kc md ke kf kg kh ig bi translated">更改操作系统字体的大小。转到<em class="in">设置</em>应用，然后转到<br/> <em class="in">辅助功能</em>-&gt;-<em class="in">显示&amp;文本</em>-&gt;-<em class="in">大文本</em> <br/>底部有一个滑块，可以让你改变文本大小。向右滑动以查看文本变化。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1d7488779e279471d14b23fccf3beda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mr4qJ7wleOny-KC0XW_YaA.jpeg"/></div></div></figure><p id="3dfe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们回到项目并运行它。你会发现一切都没变！不可接受！让我们修理它。</p><h1 id="9ead" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">弯曲的琴弦</h1><p id="088d" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">我们先从弯弦开始。因此，当我们使标签可访问时，我们可以考虑弯曲字符串覆盖的区域。</p><p id="ff69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了获得弯曲字符串的首选字体大小，我们将使用存储在<code class="fe me mf mg mh b">UIApplication</code>提供的<code class="fe me mf mg mh b">preferedContentSizeCategory</code>中的值。苹果在这里详细介绍了<a class="ae mi" href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/typography/" rel="noopener ugc nofollow" target="_blank">如何调整<em class="ma">动态文本</em>的字体大小。在此基础上，我们将编写一个类效用函数，它提供了我们需要在弯曲文本上改变字体大小的数量。</a></p><p id="9443" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe me mf mg mh b">CurvedTextRenderer</code>类中添加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="55dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将上面的函数添加到<code class="fe me mf mg mh b">PaymentDialView</code>中并改变属性字符串的字体大小会更容易。将它添加到<code class="fe me mf mg mh b">CurvedTextRenderer</code>将使我们的渲染器<em class="ma">能够感知动态文本</em>。</p><p id="569f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要用不同大小的相同字体替换传入<code class="fe me mf mg mh b">CurvedTextRenderer</code>的属性字符串的字体。添加以下类函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f58c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe me mf mg mh b">renderRoundedText(:::)</code>中，创建可访问的属性字符串，并使用它们来代替传入的属性字符串。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a69f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随着上面的变化，我们的视图看起来会像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/0884f4c0e3346b69f22faa2dbbfbe8cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUcuB6Atesb1PXtX5Kwbpg.jpeg"/></div></div></figure><p id="fd37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<a class="ae mi" href="https://medium.com/dev-genius/how-to-create-an-apple-card-payment-dial-part-2-ad056b8cf572" rel="noopener">第2部分</a>中，我们讨论了弯曲文本，我们考虑了一个在渲染文本时被称为行高的值，它实际上是字体基线到表盘主体的距离。在标准文本大小的情况下，它看起来不错，但是在上面的图像中，这个距离太大了，非常突出。我们将使用<em class="ma">动态文本</em>调整行高参数。我们可以得到真正的技术，并检查字体的上升，体面和其他类似的参数。我们不会在这里讨论这个问题。相反，我们将根据从<code class="fe me mf mg mh b">accessibilityFontSizeDelta()</code>返回的正增量来插入行高。</p><p id="1115" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从顶部标签开始，我们计算的行高是字体大小乘以1.7。如果我们移除1.7并渲染动态文本<em class="ma">设置为最大，这就是它看起来的样子。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/8c31dac766bad7f8a2018f1b8e480d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltuzF8Cc3LF8sWFCIr64ZA.jpeg"/></div></div></figure><p id="4667" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我喜欢它的外观，承认我不是设计师，但我觉得它很好用。</p><p id="61c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当<em class="ma">动态文本</em>设置为最大值时，为了使乘数取反，让我们将顶部字符串的行高参数改为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="d176" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的代码，随着<code class="fe me mf mg mh b">delta</code>的增加<code class="fe me mf mg mh b">factor</code>减少。如果<code class="fe me mf mg mh b">delta</code>是否定的，我们什么都不做。</p><p id="7b0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe me mf mg mh b">accessibilityFontSizeDelta()</code>也被略微重构。最大值情况<code class="fe me mf mg mh b">.accessibilityExtraExtraExtraLarge</code>现在返回<code class="fe me mf mg mh b">Constants.maximumFontSizeDelta</code>，我们这样声明:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><blockquote class="lx ly lz"><p id="6370" class="jk jl ma jm b jn jo jp jq jr js jt ju mb jw jx jy mc ka kb kc md ke kf kg kh ig bi translated">诚然，我也应该更早地使用这种结构。而不是在整个代码中随机声明数字。这个<code class="fe me mf mg mh b">Constants</code>结构将为它们提供上下文。</p></blockquote><p id="9710" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将我们的注意力转向底线。将底线高度乘以0.3得出以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/03b9e3bf7291790d3253f6dad9097b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-l2dnbbjPSaLFPoX90Mew.jpeg"/></div></div></figure><p id="3c49" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我对结果很满意。我们将继续使底部曲线到表盘主体的距离意识到<em class="ma">动态文本</em>。<br/>将<code class="fe me mf mg mh b">bottomLineHeight</code>改为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="91d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当<em class="ma">动态文本</em>处于其最大值时，<code class="fe me mf mg mh b">bottomLineHeightFactor</code>将为0.7。将<code class="fe me mf mg mh b">fontSize</code>与<code class="fe me mf mg mh b">(1 - bottomLineHeightFactor)</code>相乘将得到<code class="fe me mf mg mh b">bottomLineHeight = fontSize * 0.3</code>。<br/>当<em class="ma">动态文本</em>为0或以下时，<code class="fe me mf mg mh b">bottomLineHeightFactor</code>将为0.0。将<code class="fe me mf mg mh b">fontSize</code>与(1 - <code class="fe me mf mg mh b">bottomLineHeightFactor</code>)相乘将得到<code class="fe me mf mg mh b">bottomLineHeight = fontSize</code>。</p><h1 id="0251" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">两个UILabels</h1><p id="a3d6" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">如果我们在标签上使用<strong class="jm io">文本样式</strong>而不是自定义字体。我们不需要做任何事。</p><p id="b983" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">幸运的是，多亏了<code class="fe me mf mg mh b">UIFontMetrics</code>，让标签尊重<em class="ma">动态文本的</em>用户设置真的很容易。</p><p id="4f00" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将很快使用它来使我们的标签尊重动态文本。但是在我们这样做之前，让我们在<code class="fe me mf mg mh b">commonInit()</code>中添加一个新函数。把它叫做<code class="fe me mf mg mh b">configureAccessibility()</code>，把它加在<code class="fe me mf mg mh b">updateRoundedTextView()</code>之前，它将允许我们的视图在配置视图中的其他元素之前进行必要的更新。要使标签可访问，请更改其字体以使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="aab8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确保<strong class="jm io">辅助功能</strong>设置中的<strong class="jm io">较大文本</strong>尺寸设置为其最高值。现在我们的标签支持动态文本，他们将如何处理它？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/cd581dce4313a94a09de46f477305728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ins7L8JKWSoI8c1_AtDpYA.jpeg"/></div></div></figure><p id="a0f1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">明明工作了，却坏了我们的UI！<code class="fe me mf mg mh b">UIFontMetrics</code>允许我们限制字体的最大尺寸。让我们将上面的<code class="fe me mf mg mh b">label?.font</code>更改为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="6c14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你会注意到我们没有给参数<code class="fe me mf mg mh b">maximumPointSize:</code>提供一个值，而是一个变量<code class="fe me mf mg mh b">maximumSize</code>。这是因为我们想找到绝对最大字体大小，这将适用于所有屏幕大小。为此，在<em class="ma">界面构建器</em>中找到您的视图可接受的最大字体大小。在<strong class="jm io"> PaymentDialView.xib中摆弄标签的字体大小</strong>我满意的最大字体大小是50磅。<strong class="jm io"> PaymentDialView.xib </strong>中视图的当前宽度为414。我们现在可以根据屏幕大小缩放字体大小，方法是将50乘以当前屏幕宽度除以原始视图的宽度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bfd6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行应用程序，你会看到我们的平衡标签，现在正确呈现，并尊重<em class="ma">动态文本</em>，而不必破坏用户界面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/172b593defbc23fb7b2cdd34c5b8313b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFdxEqDzTQk_XP4aDlLocA.jpeg"/></div></div></figure><p id="9b1e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不幸的是，资金标签的文本与底部弯曲的字符串重叠。我们需要为资金标签设置不同的最大值。对资金标签重复上述过程，37.0点似乎是理想的最大值。<br/>考虑到我们的最大字体大小，我们将循环改为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="1713" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们所有的文本都遵循<em class="ma">动态文本</em>的尺寸，表盘看起来如下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/5aa668901ed59f660695541c542a0e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A394hZBt2sm2SbRQ_lqgZg.jpeg"/></div></div></figure><h1 id="d1a5" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">画外音</h1><p id="e8f8" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">说到屏幕阅读器，就支持和体验而言，iOS是同类中最好的。iOS的屏幕阅读器叫做VoiceOver。你可以在<a class="ae mi" href="https://developer.apple.com/documentation/uikit/accessibility_for_ios_and_tvos/supporting_voiceover_in_your_app" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于如何在你的应用中支持VoiceOver的信息。启用VoiceOver最快最简单的方法是使用Siri，说“打开VoiceOver”，显然要关闭它，要求Siri“关闭VoiceOver”。</p><p id="1174" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启用VoiceOver，启动应用程序，我们会看到VoiceOver只识别余额和资金标签。其他的都是它看不见的！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/60a2e5b3768bd0c9067b1a9f6458de2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8ztvHljxNUv_Eg6_vl_kGQ.gif"/></div></div></figure><p id="ea23" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，VoiceOver可以正确读取余额和充值金额中的数字，但它所读取的内容没有上下文。</p><p id="3ff1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们给标签添加上下文。声明一个新函数<code class="fe me mf mg mh b">updateLabelAccessibilityValues()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="04ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将此功能添加到<code class="fe me mf mg mh b">configureBalance()</code>和<code class="fe me mf mg mh b">updateFigures()</code>的末尾。现在，当用户导航到<em class="ma">余额标签</em>时，VoiceOver会告诉用户“Balance ”,然后是余额的数量，因此用户对该数字代表的内容有一个清晰的概念。</p><p id="36e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这同样适用于<em class="ma">资金标签</em>，当用户导航到它时，他们将知道报告的金额将是他们将添加到他们帐户的金额。<br/>但是，用户无法更改资金数额或选择刻度盘的拇指！</p><p id="bf0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了让dial正确支持VoiceOver，我们需要将其分解为一个单独的类。创建一个新文件，命名为<em class="ma">dialpthumbview . swift</em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="48b4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你会注意到我们把大部分的<code class="fe me mf mg mh b">setupThumb()</code>从<code class="fe me mf mg mh b">PaymentDialView</code>移到了<code class="fe me mf mg mh b">DialThumbView</code>的<code class="fe me mf mg mh b">commonInit()</code>。在<code class="fe me mf mg mh b">commonInit()</code>的底部，我们也在上面设置了两个新的<code class="fe me mf mg mh b">UIView</code>属性。<code class="fe me mf mg mh b">isAccessibilityEnabled</code>和<code class="fe me mf mg mh b">accessibilityTraits</code>。<br/> <code class="fe me mf mg mh b">isAccessibilityEnabled</code>告知操作系统视图支持VoiceOver等辅助技术。<br/> <code class="fe me mf mg mh b">accessbilityTraits</code>描述了我们的行为观。在这种情况下，我们使用的是<code class="fe me mf mg mh b">.adjustable</code>，它告诉VoiceOver我们的视图允许用户调整它的值，类似于滑块。当视图获得焦点时，VoiceOver会通知用户，他们可以上下滑动来更改值。<br/>当用户向上或向下滑动时，VoiceOver会相应地调用我们类上的<code class="fe me mf mg mh b">accessibilityIncrement()</code>或<code class="fe me mf mg mh b">accessibilityDecrement()</code>。</p><p id="580b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<em class="ma">界面生成器</em>中，选择左侧<strong class="jm io">文档轮廓</strong>窗格中的<em class="ma">缩略图视图</em>。打开右边Inspector面板中的<strong class="jm io">身份检查器</strong>，将视图的<em class="ma">类</em>改为<code class="fe me mf mg mh b">DialThumbView</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/4cce0051dde8ffdece994f717f38a78f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*85zanuNh9K8pGE0ZxRc5_g.jpeg"/></div></div></figure><p id="0d39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回到<code class="fe me mf mg mh b">PaymentDialView</code>，将<code class="fe me mf mg mh b">IBOutlet</code> <code class="fe me mf mg mh b">thumbView</code>的类改为<code class="fe me mf mg mh b">DialThumbView</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="698e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe me mf mg mh b">setupThumb()</code>简化为如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="89ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们通过将资助标签的可访问性设置器移动到一个新函数中来重构<code class="fe me mf mg mh b">updateLabelAccessibilityValues()</code>，并且我们也在<code class="fe me mf mg mh b">setupThumb()</code>中使用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="cd31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要创建一个<code class="fe me mf mg mh b">DialThumbViewDelegate</code>协议，向<code class="fe me mf mg mh b">PaymentDialView</code>报告用户希望增加/减少的值。</p><pre class="kj kk kl km gt mq mh mr ms aw mt bi"><span id="f6fb" class="mu kv in mh b gy mv mw l mx my">protocol DialThumbViewDelegate: AnyObject {<br/>    func dialShouldIncrementFundingValue()<br/>    func dialShouldDecrementFundingValue()<br/>}</span></pre><p id="ba0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">给<code class="fe me mf mg mh b">DialThumbView</code>增加一个<code class="fe me mf mg mh b">delegate</code>变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="abd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并在我们重写的可访问性函数中调用委托。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="ca7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe me mf mg mh b">PaymentDialView</code>的<code class="fe me mf mg mh b">setupThumb()</code>中设置委托。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="cab3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并使<code class="fe me mf mg mh b">PaymentDialView</code>适应<code class="fe me mf mg mh b">DialThumbViewDelegate</code>协议。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bca6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在类中声明协议函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="7ddc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当用户上下滑动时，我们希望增加/减少5.00，并移动我们的拇指。通过更新<code class="fe me mf mg mh b">angle</code>变量来移动拇指。要将它移动5.00，我们将计算需要沿表盘主体移动多少度。<br/>拇指的活动范围从第一个标记角度到圆圈上的12点钟位置。当拇指在12点时，资助金额为500.00。将该范围除以最大量将得到1.00所需的角度移动量。我们将这个值乘以5，得到我们需要用来更新<code class="fe me mf mg mh b">angle</code>的数量。在代码中，它看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2191" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过使用<code class="fe me mf mg mh b">angle</code>增加/减少间隔来更新协议功能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="cbcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">关于象限检查，在<a class="ae mi" href="https://medium.com/dev-genius/how-to-create-an-apple-card-payment-dial-part-4-c31342450c98" rel="noopener">第4部分</a>中，我们提到<code class="fe me mf mg mh b">angle</code>是使用<code class="fe me mf mg mh b">atan2()</code>测量的，该函数返回-CGFloat.pi&lt;<code class="fe me mf mg mh b">angle</code>&lt;CGFloat.pi范围内的角度。刻度盘的上半部分代表-CG float . pi，下半部分代表CG float . pi。因此，当进入和退出第三象限时，<code class="fe me mf mg mh b">angle</code>需要转换为其正确值。</p><p id="e5dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以允许VoiceOver将拇指的移动限制在表盘主体上。我们对<code class="fe me mf mg mh b">thumbViewPanned(:)</code>进行了重构，将象限检查移到了一个新功能<code class="fe me mf mg mh b">updateQuadrant(::)</code>中，并在使用VoiceOver时禁用了捕捉，否则拇指会卡在原地。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="ec60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们使用VoiceOver的用户将能够设置他们想要的金额来为这个虚拟帐户提供资金。</p><h1 id="3f68" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">可访问性项目顺序</h1><p id="738d" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">当我们的表盘变得可见时，VoiceOver会选择拇指视图作为第一个可访问的元素。我觉得现在的平衡会更合适。要控制VoiceOver遍历可访问元素的顺序，请在<code class="fe me mf mg mh b">configureAccessibility()</code>功能中添加<code class="fe me mf mg mh b">accessibilityElements</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="b531" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">VoiceOver将按照<code class="fe me mf mg mh b">accessibilityElements.</code>中定义的顺序遍历我们的拨号</p><p id="8888" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望你喜欢这个系列。你可以在这里找到完成的Xcode项目<a class="ae mi" href="https://github.com/h4yder/PaymentDial" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>