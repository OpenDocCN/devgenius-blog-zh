<html>
<head>
<title>How to integrate SQL Server and run SQL Script in Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中集成SQL Server并运行SQL脚本？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-integrate-sql-server-with-python-and-using-sql-script-in-python-a20bcbea6def?source=collection_archive---------1-----------------------#2020-06-02">https://blog.devgenius.io/how-to-integrate-sql-server-with-python-and-using-sql-script-in-python-a20bcbea6def?source=collection_archive---------1-----------------------#2020-06-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2709" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在Python中使用SQL的初学者指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/cc0a3d616856c304729c770bca6ff397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ySMdgRP7R5jYw3v6"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ks" href="https://unsplash.com/@pietrozj?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pietro Jeng </a>拍摄</figcaption></figure><p id="563a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为一名数据科学家/分析师，大多数时候我们需要使用不同的工具来解决我们的业务问题。最常见的情况是，我们需要从一个关系数据库中获取数据，这个关系数据库要么位于您的本地服务器上，要么位于云上的中央数据库中。我们如何从数据库中提取数据，一种方法是通过运行SQL脚本来提取数据，并将数据保存在excel中，然后将excel文件导入Python。然而，在Python中直接使用SQL的最有效方式。</p><h2 id="4649" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">在开始之前，我们很多人可能想知道什么是SQL？</h2><p id="2e5d" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">SQL代表结构化查询语言，这是一种用于提取/操作或查询存储在关系数据库管理系统(RDBMS)中的数据的数据库语言。处理这类数据还有其他选择，但SQL是业内最流行、最广泛使用的语言。</p><h1 id="5768" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">SQL能做什么？</h1><ul class=""><li id="fea8" class="my mz in kv b kw mi kz mj lc na lg nb lk nc lo nd ne nf ng bi translated">对数据库执行查询</li><li id="df13" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">从数据库中检索数据</li><li id="6df7" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">在数据库中插入记录</li><li id="ae2a" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">更新数据库中的记录</li><li id="c6f3" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">从数据库中删除记录</li><li id="4dd2" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">创建新数据库</li><li id="a21a" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">在数据库中创建新表</li><li id="85a3" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">在数据库中创建视图</li></ul><h1 id="28eb" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">为什么要在Python中使用SQL？</h1><p id="35f4" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">如您所知，我们需要从数据库中获取数据，一种方法是通过运行SQL脚本提取数据，将数据保存在excel中，然后将excel文件导入Python。另一种方法是在Python中直接使用SQL的最有效的方法。</p><h2 id="8407" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">在SQL和Python之间建立联系的库有哪些？</h2><p id="605f" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">有许多为此开发的库可供使用。在本教程中，我将使用与熊猫集成的<a class="ae ks" href="https://pypi.org/project/pyodbc/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> Pyodbc </strong> </a> <strong class="kv io"> </strong>库。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/61a5455d733c7d01f64e8824a5be91b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kVN3BA9wPmtXWd9l"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">尼克·莫里森在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="702e" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">装置</h1><p id="f286" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">要安装pyodbc库，请运行下面的代码，该命令会自动下载并安装库</p><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="d392" class="lp lq in no b gy ns nt l nu nv">pip install pyodbc</span></pre><h1 id="24c3" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">导入必要的库</h1><p id="1137" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">在这一步中，我们将导入我们将在整个教程中使用的重要库。</p><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="cb15" class="lp lq in no b gy ns nt l nu nv">import pandas as pd<br/>import pyodbc</span></pre><h1 id="b732" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">快速入门</h1><p id="f419" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">一旦库被导入，我们需要获得以下细节。</p><h1 id="8dcd" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">检索服务器名称</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/103686c9d81fca88c9af39b3715d3a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*O6e9xLN987J4y_UbFncMMA.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">SQL server名称</figcaption></figure><h1 id="aff1" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">获取数据库名称</h1><p id="db9c" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">接下来，获取存储所需表的数据库名称。</p><h1 id="ca44" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">获取表名</h1><p id="5ac8" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">现在，您需要获得存储数据的所需表的名称，然后在收集详细信息后，按以下格式更新详细信息</p><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="457c" class="lp lq in no b gy ns nt l nu nv">server = 'INxxxxxxxxx' # your local server name <br/>database = 'xxxxx-old'  # database name that is stored in server</span></pre><p id="b29d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建连接和光标。</p><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="c7eb" class="lp lq in no b gy ns nt l nu nv">connection = pyodbc.connect('driver={SQL Server};server=xxxxxxx;database=xxxxxxx')</span><span id="2501" class="lp lq in no b gy nx nt l nu nv">cursor = connection.cursor()<br/>cursor</span></pre><h1 id="2042" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">使用SQL语句的数据查询</h1><p id="fabb" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">现在您已经连接到数据库，您可以提交数据查询了，每个查询中必须存在的两个主要子句是<code class="fe ny nz oa no b">SELECT</code>和<code class="fe ny nz oa no b">FROM</code>。</p><p id="43be" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> Syntex </strong></p><p id="6f6c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从<em class="ob"> table_name </em>中选择<em class="ob"> column1 </em>、<em class="ob"> column2、…</em><br/>；</p><p id="1667" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从数据库获得响应后，我们需要将它放入熊猫数据框中。</p><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="a66e" class="lp lq in no b gy ns nt l nu nv">query='select * from [dbo].[Iris_data]'</span><span id="2c42" class="lp lq in no b gy nx nt l nu nv"># To extract all columns </span><span id="6470" class="lp lq in no b gy nx nt l nu nv">x=pd.read_sql(query,connection)<br/>x.head()</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a54863f4f431a90bf2304768799a2e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*VqWbKh7IIyuTHhhjSFtSfA.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">输出</figcaption></figure><h2 id="8edd" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">如果我们想要提取一些特定的列，我们可以通过运行下面的代码来实现。</h2><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="ead2" class="lp lq in no b gy ns nt l nu nv">query='select sepal_length,sepal_width  from [dbo].[Iris_data]'<br/>pd.read_sql(query,connection)</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi od"><img src="../Images/6874118e0546ad6d78b3463296392763.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*-QhKN9yi97ZbT_nqVGNfpw.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">输出</figcaption></figure><h2 id="8c6b" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">如果您想从一列中获得不同的<strong class="ak">行，您可以运行以下SQL语句:</strong></h2><pre class="kd ke kf kg gt nn no np nq aw nr bi"><span id="e665" class="lp lq in no b gy ns nt l nu nv">query='select distinct  sepal_length  from [dbo].[Iris_data]'<br/>pd.read_sql(query,connection)</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/cdbe46163af5935656417a792c7e110b.png" data-original-src="https://miro.medium.com/v2/resize:fit:328/format:webp/1*qHI4yVjjv9giAcMhCJllyA.png"/></div></figure><p id="910c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">以上语句涵盖了Python中SQL的基础知识。类似地，你可以编写更多可以在python中使用的SQL语句，更多SQL细节你可以参考这个<a class="ae ks" href="https://www.w3schools.com/sql/default.asp" rel="noopener ugc nofollow" target="_blank">链接</a></p><h1 id="9ce1" class="mn lq in bd lr mo mp mq lu mr ms mt lx jt mu ju ma jw mv jx md jz mw ka mg mx bi translated">结论。</h1><p id="ef5f" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">有许多库可以帮助我们将SQL与Python进行交互，我相信与多种工具的集成会非常有效，并且会产生惊人的结果。</p><p id="5abd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望这篇文章能帮到你，给你一个不一样的视角。如果你有任何建议，请告诉我。</p><p id="1eee" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">快乐学习。</p><p id="afb6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"><em class="ob">Prabhat Pathak</em></strong><em class="ob">(</em><a class="ae ks" href="https://www.linkedin.com/in/prabhat-pathak-029b6466/" rel="noopener ugc nofollow" target="_blank"><em class="ob">Linkedin简介</em> </a> <em class="ob">)是助理分析师。</em></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/2fe86b571dcfef63ea24327919c1aaeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HKHqom_tw8ZmzODD"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">照片由<a class="ae ks" href="https://unsplash.com/@element5digital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">元素5数码</a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div></div>    
</body>
</html>