<html>
<head>
<title>Setup AWS Redshift cluster with external connectivity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用外部连接设置 AWS 红移集群</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-aws-redshift-cluster-with-external-connectivity-6d3a04d60399?source=collection_archive---------2-----------------------#2022-05-07">https://blog.devgenius.io/setup-aws-redshift-cluster-with-external-connectivity-6d3a04d60399?source=collection_archive---------2-----------------------#2022-05-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0429" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用 AWS VPC，AWS 红移，DBeaver </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/31bc031e0cd2786715fa95172dc3faf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zy1W5a0j32gqcKDoLeB4iA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">AWS 红移设置</figcaption></figure><p id="0791" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Amazon Redshift 是 AWS 云中的一个完全托管的数据仓库服务。亚马逊红移数据仓库由各种被称为<em class="ky">节点的计算资源组成。</em>节点被<em class="ky"> </em>组织成一个组，称为<em class="ky">集群</em>。每个集群运行一个 Amazon 红移引擎，并包含一个或多个数据库。在<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/build-your-own-data-lake-on-aws-s3-d984320a5388">之前的</a>文章中，我们用 AWS 胶水用保存在 S3 桶中的数据创建了一个数据湖。我们定义了一个从 S3 推断模式的爬虫，并创建了一个 AWS 胶合目录。它生成了我们在 AWS Athena 中查询的这些表。今天，我们将在此基础上继续努力。我们将创建一个红移集群，将这些数据存储到数据库中以供进一步分析。AWS 红移是基于 Postgres 的，所以如果你熟悉 Postgres，那么一些功能是相似的。为了通过 AWS Glue 或从您的本地 SQL 客户端(例如 DBeaver)连接到 Redshift，我们需要在 AWS 中配置额外的资源。</p><p id="90fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你喜欢视觉效果，那么我在 YouTube<a class="ae kz" href="https://www.youtube.com/watch?v=s8HckCTC6aA&amp;t" rel="noopener ugc nofollow" target="_blank">上有一个附带的视频，里面有完整设置的演示。</a></p><p id="248c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天我们将:</p><ul class=""><li id="6105" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">VPC 及其组成部分概述</li><li id="01cb" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">为外部连接配置端点</li><li id="bfa2" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">向安全组添加规则</li><li id="79ea" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">创建红移集群并从本地机器连接</li></ul><p id="50e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要的第一个组件是 IAM 角色。在之前的<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/build-your-own-data-lake-on-aws-s3-d984320a5388">会话中，我们创建了以下<em class="ky">AWSGlueServiceRole-adventureworks</em>IAM 角色。最初，这个角色拥有 s3 和 Glue 服务权限。我还添加了红移访问。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lo"><img src="../Images/6eac67ef94997b64f356216b0c6589a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7qiymuGOvC_nf4En_ZWeA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">IAM 角色权限</figcaption></figure><p id="0aba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> AWS VPC </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lp"><img src="../Images/8d9e8aa77fd303bd4264277e0094283f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tv-qUeWPmJFkAbG_IBF7nA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">AWS VPC 概述</figcaption></figure><p id="22ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一个难题是 VPC 或虚拟私有云设置。默认情况下，当我们创建帐户时，AWS 会为我们提供一个默认的 VPC 实例。您可以继续创建另一个 VPC，但我们现在将使用默认实例。亚马逊虚拟私有云(或 VPC)是一种服务，允许您在自己定义的逻辑隔离的虚拟网络中启动 AWS 资源。</p><p id="1bf2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">每个 VPC 在 AWS 云中创建一个独立的虚拟网络环境，专用于您的 AWS 帐户。其他 AWS 资源和服务在 VPC 网络内部运行，以提供云服务。</p><p id="c755" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Amazon 使用以下资源为每个帐户创建一个默认 VPC。</p><ul class=""><li id="4c0c" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">子网</li><li id="cef3" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">路由表</li><li id="ac0f" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">安全组</li><li id="316b" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">网络访问控制列表</li></ul><p id="4f64" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">子网</strong></p><p id="f573" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认的<em class="ky"> VPC </em>有六个子网。子网是网络内部的一个 T2 网络。子网是 VPC 中的一系列 IP 地址。您可以将 AWS 资源启动到指定的子网中。对必须连接到互联网的资源使用公共子网，对不会连接到互联网的资源使用专用子网。</p><p id="1979" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">路由表</strong></p><p id="cbb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">路由表包含确定网络流量在 VPC 和子网内如何定向的规则(路由)。VPC 会创建一个名为主路由表的默认路由表。主路由表会自动与所有 VPC 子网相关联。</p><p id="1edc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">终点</strong></p><p id="3a35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要创建一个资源来连接到<em class="ky">红移</em>，一个<em class="ky">端点</em>。<em class="ky"> AWS Glue </em>外部客户端需要一个端点连接到这个 VPC，以便连接到其中的资源。我们的<em class="ky">红移</em>实例将位于私有<em class="ky">子网</em>中。这将删除从<em class="ky">红移</em>实例到互联网或 AWS 服务的所有连接。我们将需要<em class="ky"> AWS Glue </em>来连接到这个服务以执行 ETL。这就是<em class="ky"> VPC </em>端点的由来。它确保你的<em class="ky"> VPC </em>和特定 AWS 服务之间的流量通过<em class="ky"> VPC </em>端点开放，不会离开亚马逊网络。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lq"><img src="../Images/229e0a3c5f5b6ea61044880450a32b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl7WYgWU2BZ_u-cHX4CTpA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">S3 网关端点</figcaption></figure><p id="6b73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安全组</strong></p><p id="149a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安全组充当虚拟防火墙，控制允许到达和离开与其关联的资源的流量。例如，在我们将一个安全组与一个<em class="ky">红移</em>实例相关联之后，它控制该实例的入站和出站流量。</p><p id="4b7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，我们将有一个安全组。该组有一个入站自引用规则。我们将增加两条新规则。首先是<em class="ky">红移</em>，我们将它设置为<em class="ky">我的 IP，</em>在 source <em class="ky">，</em>下，这将帮助我们从本地机器用 DBeaver 或 Jupyter 笔记本连接到<em class="ky">红移</em>。我们需要为<em class="ky"> AWS Glue </em>制定另一条规则:这将来自这个<em class="ky"> VPC </em>中的任何<em class="ky"> IPV4 </em>地址。我们增加了两条附加规则。第一个本地连接到红移，第二个打开红移到任何 IPv4，但是自引用规则将源限制到这个<em class="ky"> VPC </em>中的同一个安全组，所以它不是对所有网络开放。</p><p id="9caf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">红移星团</strong></p><p id="819b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<em class="ky">红移</em>服务下，我们将单击“create cluster”来创建一个新的集群。通常，如果这是你第一次投入<em class="ky"> AWS 红移</em>服务，探索免费试用是个好主意。但是，它不允许我们自定义设置。所以，我们会选择生产。我们将尝试并保留与免费试用相匹配的设置，因此不会产生任何额外费用。让我们选择 dc2 大型节点类型，并将节点数量设置为 1。我们将保留该用户的默认值，并为其设置一个密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lr"><img src="../Images/ca3cb0c1f710429f944a6d83eba42a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*79hN2OU6FGI3aTT55Es1Gw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">红移星团构型</figcaption></figure><p id="86d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将一个角色与该集群相关联。让我们选择默认角色。该角色拥有以下权限<em class="ky">AmazonRedshiftServiceLinkedRolePolicy</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ls"><img src="../Images/47e9866a2ff322061edc330716e57573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVYUn_EI6oM5fjapgimAhA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">集群 IAM 角色</figcaption></figure><p id="679c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们将覆盖一些默认设置。如果您计划从本地 PC 连接到 redshift，这一点非常重要。在“网络和安全”下，我们将检查是否选择了合适的 VPC。该群集将处于默认 VPC 和默认安全组下。</p><p id="cb32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要将该群集公开。这允许 VPC 之外的设备通过端点连接到数据库。让我们单击“create”按钮来创建该集群。创建所有资源需要一段时间。一旦该群集可用，我们将建立到该群集的连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/1ec29adf34ee31cdd5c994ec4be0fa8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uy_l0GMT1R6pkXFyxinVLA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">AWS 集群配置</figcaption></figure><p id="a6de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">连接本地 SQL 客户端</strong></p><p id="b489" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦集群状态变为可用。我们可以单击它来探索它的属性。在“属性”下，我们将找到与<em class="ky">红移</em>相关的大部分信息。我们有数据库<strong class="jm io">开发</strong>、<strong class="jm io">端口</strong>，并且<strong class="jm io">用户</strong>和密码将是我们在创建时提供的。我们需要确保启用公开访问选项。让我们滚动到顶部，复制该群集的端点。这是连接字符串中的主机名。</p><p id="89fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 DBeaver 客户端中，让我们单击 create a new connection。我们将搜索<em class="ky">红移</em>并选择它。让我们将端点粘贴到主机/实例中。它还有一些额外的部分，比如数据库名称和端口，所以我们将把它们和冒号一起删除。我们将保持其余的配置细节不变，并提供我们的密码。让我们测试一下连接，结果是成功的。我们可以单击“完成”来保存它。我们已经使用<em class="ky"> DBeaver </em>成功连接到<em class="ky">红移</em>数据库。我们可以扩展和预览数据库。目前我们没有任何桌子。让我们继续创建一个表。我们将打开一个新的查询窗口，并粘贴一个创建表脚本。让我们执行查询并刷新表节点。我们在数据库中有一个新表。我们可以回去在 AWS 中确认这一点。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="44be" class="lz ma in lv b gy mb mc l md me">CREATE TABLE IF NOT EXISTS public.src_dimproductcategory<br/>(<br/>  productcategorykey BIGINT  <br/> ,productcategoryalternatekey BIGINT  <br/> ,englishproductcategoryname VARCHAR(500)  <br/> ,spanishproductcategoryname VARCHAR(500)  <br/> ,frenchproductcategoryname VARCHAR(500)  <br/>)</span></pre><p id="fbab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将在这里结束，在下一节课中，我们将从<em class="ky"> AWS Glue </em>连接到<em class="ky">红移</em>，并使用<em class="ky"> AWS Glue </em>执行 ETL。所以，下次和我一起。</p><p id="3eee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论:</strong></p><ul class=""><li id="c0bd" class="la lb in jm b jn jo jr js jv lc jz ld kd le kh lf lg lh li bi translated">我们已经介绍并配置了用于外部连接的 AWS VPC 组件。</li><li id="a633" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">我们已经创建并探索了 AWS 红移星团</li><li id="0cdf" class="la lb in jm b jn lj jr lk jv ll jz lm kd ln kh lf lg lh li bi translated">我们从本地 SQL 客户端建立到红移数据库的连接</li></ul></div></div>    
</body>
</html>