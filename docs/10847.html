<html>
<head>
<title>PHP — P107: Scope Quirks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P107:范围怪癖</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p107-scope-quirks-93b188004952?source=collection_archive---------19-----------------------#2022-12-03">https://blog.devgenius.io/php-p107-scope-quirks-93b188004952?source=collection_archive---------19-----------------------#2022-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8ba172a21e8d1f7aa138c18d5da0e550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WsNQ5ejU9dr2djxjpVuf7Q.jpeg"/></div></div></figure><p id="fc0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作用域是程序的某一部分所拥有的变量和函数的可见性。例如，假设我们在函数内部声明了一个变量。其他函数将无法访问该变量。</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="f575" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>function hello() {<br/>    $name = "Dino";<br/>    echo "Hello " . $name; // has access<br/>}<br/><br/>function bye() {<br/>    echo "Bye " . $name; // Doesn't have access<br/>}</span></pre><p id="91a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该变量(<code class="fe ll lm ln lb b">$name</code>)具有创建它的函数的局部作用域。变量可以具有全局范围，并且可以在任何地方访问(不总是立即访问)。这些变量通常在函数之外定义。</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="a24f" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>$x = "Hey";<br/><br/>function hey() {<br/>  echo "Hey";<br/>}<br/><br/>echo $x; // works well</span></pre><p id="c8ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，在 PHP 中，在函数内部调用具有全局范围的变量是不允许的，因为函数会寻找局部变量。</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="1fa8" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>$x = "Hey";<br/><br/>function hey() {<br/>  echo $x; // Doesn't work since it's looking for a local var<br/>}</span></pre><h1 id="5b3f" class="lo lg iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">使用关键字</h1><p id="691f" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">那么我们如何访问这个变量呢？还记得我们的<code class="fe ll lm ln lb b">use</code>关键词吗？如果没有，在这里看一下。</p><div class="mq mr gp gr ms mt"><a rel="noopener  ugc nofollow" target="_blank" href="/php-7-x-p40-use-keyword-37d8e7df9138"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">PHP — P40:使用关键字</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">当函数被定义时，Use 获取全局变量的值，而 global 将获取变量的值…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">blog.devgenius.io</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh jw mt"/></div></div></a></div><p id="3e44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在那篇文章中使用的例子是:</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="e16b" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>$name = "Dino";<br/><br/>$hello = function() use($name) {<br/>    echo $name;<br/>};<br/><br/>echo $name; // Dino<br/><br/>$name = "Harrison";<br/><br/>echo $name; // Harrison<br/>$hello();   // Dino</span></pre><p id="66a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个关于 scope 如何工作的很好的例子。但是，我们在第 11 行将<em class="ni"> $name </em>的值改为<em class="ni"> Harrison </em>，那么为什么会显示<em class="ni"> Dino </em>？</p><blockquote class="nj nk nl"><p id="e23c" class="jy jz ni ka b kb kc kd ke kf kg kh ki nm kk kl km nn ko kp kq no ks kt ku kv ij bi translated"><strong class="ka ir">使用<em class="iq"> </em> </strong> <em class="iq">获取全局变量的值当</em> <strong class="ka ir">函数被定义</strong> <em class="iq">和</em> <strong class="ka ir">全局<em class="iq"> </em> </strong> <em class="iq">将获取变量的值当</em> <strong class="ka ir"> <em class="iq"> </em>函数被调用</strong></p></blockquote><p id="d22a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当 PHP 读取程序时，它在第 5 行定义了函数，并复制了全局变量的值，以便可以使用它。后来，在第 14 行，闭包被调用。已经执行了定义部分，并且值已经固化在闭包内部。这就是为什么你得到的值是<em class="ni">迪诺</em>而不是<em class="ni">哈里森</em>。</p><p id="5380" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看那篇文章的另一个例子。这一次，我们同时使用了参数和传递全局变量</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="9858" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>$name1 = "Dino";<br/>$name2 = "Harrison";<br/><br/>$closure = function($greeting) use($name1) {<br/>    global $name2;<br/>    <br/>    echo $greeting . " " . $name1 . " and " . $name2 . "&lt;br&gt;";<br/>};<br/><br/>$closure("Hello there");<br/><br/>$name1 = "Amy";<br/>$name2 = "Steve";<br/><br/>$closure("Hi there");</span></pre><p id="db1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么我们得到了什么？</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="9805" class="lf lg iq lb b be lh li l lj lk">Hello there Dino and Harrison<br/>Hi there Dino and Steve</span></pre><p id="51d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使两个全局变量都被更改，就匿名函数而言，只有<code class="fe ll lm ln lb b">$name2</code>被更新，因为当<strong class="ka ir">函数被定义时<em class="ni">使用</em>获得全局变量的值，当<strong class="ka ir">函数被调用时</strong>和</strong>全局<em class="ni">获得变量的值。</em></p><h1 id="5eb9" class="lo lg iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">全局关键字</h1><p id="f655" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">有了<code class="fe ll lm ln lb b">global</code>关键词，我们就可以绕过<code class="fe ll lm ln lb b">use</code>关键词的不一致性。您可能想要这种格式，但是如果您不想要，<code class="fe ll lm ln lb b">global</code>是一个不错的选择。</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="3277" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>$a = 10;<br/>$b = 20;<br/><br/>function sum()<br/>{<br/>    global $a, $b;<br/><br/>    $b = $a + $b;<br/>}<br/><br/>sum();<br/>var_dump($a);<br/>var_dump($b);<br/><br/>$a = 0;<br/>$b = 0;<br/>sum();<br/>var_dump($a);<br/>var_dump($b);</span></pre><p id="ea80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里发生了什么？</p><ol class=""><li id="3ce6" class="np nq iq ka b kb kc kf kg kj nr kn ns kr nt kv nu nv nw nx bi translated">PHP 将<code class="fe ll lm ln lb b">10</code>分配给<code class="fe ll lm ln lb b">$a</code>，将<code class="fe ll lm ln lb b">20</code>分配给<code class="fe ll lm ln lb b">$b</code>。</li><li id="e3d9" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">一个函数被声明为<code class="fe ll lm ln lb b">sum</code>，我们将<code class="fe ll lm ln lb b">$a</code>和<code class="fe ll lm ln lb b">$b</code>设置为函数中的<code class="fe ll lm ln lb b">global</code>变量。</li><li id="0ff5" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">调用<code class="fe ll lm ln lb b">sum</code>函数。</li><li id="99e5" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">将变量<code class="fe ll lm ln lb b">$a</code>和<code class="fe ll lm ln lb b">$b</code>相加，并将值赋回<code class="fe ll lm ln lb b">$b</code>。</li><li id="e40e" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe ll lm ln lb b">$b</code>现在等于<code class="fe ll lm ln lb b">30</code>。</li><li id="2502" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">我们检查<code class="fe ll lm ln lb b">$a</code>和<code class="fe ll lm ln lb b">$b</code>的值。它们是<code class="fe ll lm ln lb b">10</code>和<code class="fe ll lm ln lb b">30</code>。</li><li id="e3d0" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated"><code class="fe ll lm ln lb b">$a</code>和<code class="fe ll lm ln lb b">$b</code>现在被设置为<code class="fe ll lm ln lb b">0</code>。</li><li id="073b" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">再次调用<code class="fe ll lm ln lb b">sum</code>函数。</li><li id="9350" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">一旦我们检查了<code class="fe ll lm ln lb b">$a</code>和<code class="fe ll lm ln lb b">$b</code>的值，两者的值都是<code class="fe ll lm ln lb b">0</code>，这是我们通常认为会发生的情况。</li></ol><p id="d61f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不必使用<code class="fe ll lm ln lb b">global</code>关键字来使变量全局化。我们可以使用<code class="fe ll lm ln lb b">$GLOBALS</code>内置数组。每当定义一个全局变量时，变量的名称被设置为<code class="fe ll lm ln lb b">$GLOBALS</code>数组中的键。</p><pre class="kw kx ky kz gt la lb lc bn ld le bi"><span id="e5f1" class="lf lg iq lb b be lh li l lj lk">&lt;?php<br/><br/>function sum()<br/>{<br/>    $GLOBALS['b'] = $GLOBALS['a'] + $GLOBALS['b'];<br/>}</span></pre></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/82e4cce617799ec1ab6f1d7a553c1a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oSCASVUzeTAE7a8l.jpeg"/></div></figure><p id="80bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae ol" href="http://absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 主管，该公司是<a class="ae ol" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae ol" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute 抗体</a>、<a class="ae ol" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae ol" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物科技</a>、<a class="ae ol" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae ol" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他拥有计算机科学学士学位，辅修生物学，并拥有十多年的软件工程经验。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="14eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae ol" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae ol" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae ol" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="fdc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读迪诺·卡吉克(以及媒体上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T9】</p></div></div>    
</body>
</html>