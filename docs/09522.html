<html>
<head>
<title>Setting up LSP Config in Neovim for beautiful error diagnostics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Neovim 中设置 LSP 配置，以便进行漂亮的错误诊断</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-up-lsp-config-in-neovim-for-beautiful-error-diagnostics-26d40bbe40a2?source=collection_archive---------0-----------------------#2022-08-26">https://blog.devgenius.io/setting-up-lsp-config-in-neovim-for-beautiful-error-diagnostics-26d40bbe40a2?source=collection_archive---------0-----------------------#2022-08-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f266b35be71e679de2e9929b52471882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5yXHiRKOEu1Vla4o"/></div></div></figure><h1 id="adb1" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">什么是 LSP？</h1><blockquote class="kt ku kv"><p id="baf5" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">语言服务器协议(LSP)是 IDEs 代码编辑器和服务器之间的通信协议，提供编程语言特定的功能，如代码完成、重构(重命名变量)或导航到符号定义等。</p></blockquote><h1 id="cfad" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">LSP 解决的问题</h1><p id="e7ef" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">有很多代码编辑器像 vim，VSCode，Atom，PyCharm 等。我们对 ide 有所期待:每种语言都有代码完成、导航到定义等特性。在 LSP 出现之前，每个 IDE/代码编辑器都需要添加自己的特定于语言的特性的实现。大多数语言都绑定到一个给定的 IDE 或编辑器上。如果开发了一个新的编辑器，它需要为每种语言实现重命名变量或显示可能出错的曲线等功能。如果一种新的语言出现，它很难被所有现有的编辑支持。</p><p id="9683" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">现在，我们有了语言服务器协议，我们有了两个代理:一个编辑器(客户机)和一个语言服务器(服务器)。服务器提供了特定于语言的特性，如定义、查找引用、悬停、完成、重命名、格式化、重构等。，使用语义整体项目分析。客户端或编辑器执行以下操作:</p><ul class=""><li id="bfb8" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">与服务器就功能进行交流(例如，客户机和服务器能做代码片段吗？)</li><li id="4fb7" class="md me in kz b la mm le mn lx mo lz mp mb mq lu mi mj mk ml bi translated">发送请求并处理响应(例如，当程序员按住 ctrl 键单击 python 文件中的某个符号时，客户端会要求 pyright 查找该符号定义的文件和行号，在 pyright 做出响应后，编辑器会带您查看该定义。并且进行定义已经完成)</li><li id="e851" class="md me in kz b la mm le mn lx mo lz mp mb mq lu mi mj mk ml bi translated">处理服务器发送的通知(例如，错误诊断:在有错误或警告的代码下显示曲线)</li></ul><p id="e72d" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">所有这些通信都遵循语言服务器协议。因此，任何新的编辑器都可以使用任何复杂的语言服务器。任何参与开发新编程语言的程序员都可以让现有的编辑器使用该语言的服务。这就是 Neovim 可以使用 VSCode 的语言服务器(CoC)的原因，因为它们都支持 LSP。</p><blockquote class="kt ku kv"><p id="18d2" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">LSP 最初是由微软为 VSCode 开发的，现在是一个开放标准</p></blockquote><h1 id="5b5b" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">现在我们对 LSP 的工作原理有了一些了解，让我们开始为 Neovim 设置 LSP 配置。</h1><p id="7419" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">这些可以分为三个部分:</p><ul class=""><li id="6ec8" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">安装 nvim-lspconfig</li><li id="d2be" class="md me in kz b la mm le mn lx mo lz mp mb mq lu mi mj mk ml bi translated">在您的路径上安装语言服务器</li><li id="484c" class="md me in kz b la mm le mn lx mo lz mp mb mq lu mi mj mk ml bi translated">告诉 Neovim 使用语言服务器</li></ul><h1 id="0fe2" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">安装 nvim-lspconfig</h1><p id="7d3e" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">首先，我们需要安装 nvim-lspconfig 插件，它为 Nvim LSP 客户端提供配置。根据 TJ Devries 的说法，你在技术上并不需要这个插件，因为 Neovim 已经内置了 LSP 客户端，但是它可以帮助你更容易地管理和连接到 LSP 服务器。它为不同的语言服务器提供了配置，使连接和管理它们变得更加容易。</p><p id="8268" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">要使用 VimPlug 安装，</p><ul class=""><li id="5fcd" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">将<code class="fe mr ms mt mu b">Plug 'neovim/nvim-lspcnofig'</code>添加到您的 vimrc 中</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="ae53" class="nd jw in mu b gy ne nf l ng nh">call plug#begin('~/.config/nvim/plugged')<br/>...<br/>Plug 'neovim/nvim-lspconfig' " Configuration for Nvim LSP<br/>...<br/>call plug#end()</span></pre><ul class=""><li id="a164" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">重启 vim 或使用<code class="fe mr ms mt mu b">source %</code>激活 vimrc</li><li id="49ed" class="md me in kz b la mm le mn lx mo lz mp mb mq lu mi mj mk ml bi translated">键入<code class="fe mr ms mt mu b">:PlugInstall</code>命令，这将安装 nvim-lspconfig。</li></ul><h1 id="8bd3" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">在您的路径上安装语言服务器</h1><p id="08d6" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">因为我使用 python、typescript 并涉猎 Java。我将为这些设置 LSP。</p><ul class=""><li id="148f" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">为 python 安装 pyright LSP 服务器。</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="b6ca" class="nd jw in mu b gy ne nf l ng nh">npm install -g pyright</span></pre><ul class=""><li id="41e2" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">为 typescript 安装 typescript-language-server</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="2ce7" class="nd jw in mu b gy ne nf l ng nh">npm install -g typescript typescript-language-server</span></pre><ul class=""><li id="c9e1" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">安装 Eclipse JDT 语言服务器 for java</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="6c40" class="nd jw in mu b gy ne nf l ng nh">yay -S jdtls</span></pre><blockquote class="kt ku kv"><p id="833e" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">注意:我使用 yay 来安装 jdtls。点击<a class="ae ni" href="https://github.com/eclipse/eclipse.jdt.ls" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于安装 eclipse jdtls 的信息。</p></blockquote><h1 id="d470" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">告诉 Neovim 使用语言服务器</h1><p id="12de" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">最后，您必须为 LSP 提供的功能类型指定所需的键映射，并将它们附加到 vimrc 文件中的每个语言服务器上。</p><ul class=""><li id="664e" class="md me in kz b la lb le lf lx mf lz mg mb mh lu mi mj mk ml bi translated">在您的 vimrc 中，添加以下代码</li></ul><figure class="mv mw mx my gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="e711" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结果呢</h1><p id="aaf3" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">现在，您可以转到 python 或 typescript 或 java 项目，您将看到错误诊断。这么🎉🎉🎉</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/746b0817f01dbdf7b86697186807dfb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1FG7kGm5PxDC8Gqd.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">Java 未使用的导入</figcaption></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/d8fd9f2ce0c2a6e4339d76dd9614b15c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*43H0GhWno-1M1IOx_GzD0w.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">带 Java 的 LSP</figcaption></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/f3eb700b9c87674d5b52201f16144e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZeR6M6z3yGoPxOvub2M_g.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">使用 python 的 LSP</figcaption></figure></div></div>    
</body>
</html>