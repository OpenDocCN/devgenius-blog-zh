<html>
<head>
<title>Reuse Azure DevOps Pipeline Yaml Templates across Organizations and Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨组织和项目重用 Azure DevOps Pipeline Yaml 模板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/reuse-azure-devops-pipeline-yaml-templates-across-organizations-and-projects-aedd03390e08?source=collection_archive---------4-----------------------#2022-07-20">https://blog.devgenius.io/reuse-azure-devops-pipeline-yaml-templates-across-organizations-and-projects-aedd03390e08?source=collection_archive---------4-----------------------#2022-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2314a065e85756d19d5692dd891d26ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tarXM61Zvy5RGwHzcSCmAQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">工作流程</figcaption></figure><p id="ac11" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我将解释跨组织和项目共享 Azure DevOps pipeline yaml 模板的过程。</p><p id="65d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">先决条件:</strong></p><ol class=""><li id="d8b8" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">您可以访问 2 个 Azure DevOps 组织</li></ol><blockquote class="lg lh li"><p id="14c5" class="jz ka lj kb b kc kd ke kf kg kh ki kj lk kl km kn ll kp kq kr lm kt ku kv kw ig bi translated">要创建新组织，请遵循下面提供的官方文档</p></blockquote><div class="ln lo gp gr lp lq"><a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/create-organization?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd io gy z fp lv fr fs lw fu fw im bi translated">创建一个组织- Azure DevOps</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">了解如何使用个人 Microsoft 帐户、GitHub 帐户或工作或…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">docs.microsoft.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me jt lq"/></div></div></a></div><blockquote class="lg lh li"><p id="96c7" class="jz ka lj kb b kc kd ke kf kg kh ki kj lk kl km kn ll kp kq kr lm kt ku kv kw ig bi translated">要创建新项目，请遵循下面提供的官方文档</p></blockquote><div class="ln lo gp gr lp lq"><a href="https://docs.microsoft.com/en-us/azure/devops/organizations/projects/create-project?view=azure-devops&amp;tabs=browser" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd io gy z fp lv fr fs lw fu fw im bi translated">创建一个项目- Azure DevOps</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">Azure DevOps 服务| Azure DevOps 服务器 2020 | Azure DevOps 服务器 2019 | TFS 2018 您创建一个 Azure DevOps…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">docs.microsoft.com</p></div></div><div class="lz l"><div class="mf l mb mc md lz me jt lq"/></div></div></a></div></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><h1 id="ff02" class="mn mo in bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">在 Azure DevOps 组织中共享模板</h1><p id="64b7" class="pw-post-body-paragraph jz ka in kb b kc nl ke kf kg nm ki kj kk nn km kn ko no kq kr ks np ku kv kw ig bi translated">首先，假设您有权访问 2 Azure DevOps 组织。</p><p id="6d1f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤:</strong></p><ol class=""><li id="7c80" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">登录 dev.azure.com，进入您的第一个组织，例如——<strong class="kb io">adotemplatdemo</strong></li></ol><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/24b5e8bf896cf3c3838073af81c6ab34.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*zI_8Zyu91TVujvaEb9TTIw.jpeg"/></div></figure><p id="9955" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.转到您的 Azure DevOps 项目→ Azure Repo 并创建一个文件“stage.yaml ”,如下所示</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/09090578e4a2de1210d00ccf0ba60247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibFBBFobDrhc8jd59j4Ptw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源</figcaption></figure><blockquote class="lg lh li"><p id="b5fb" class="jz ka lj kb b kc kd ke kf kg kh ki kj lk kl km kn ll kp kq kr lm kt ku kv kw ig bi translated">stage.yaml</p></blockquote><pre class="nr ns nt nu gt nw nx ny nz aw oa bi"><span id="56fe" class="ob mo in nx b gy oc od l oe of">stages:<br/>  - stage: stage1<br/>    jobs:<br/>      - job: <br/>        steps:<br/>          - bash: echo Reusing Template from ADOTemplate Collection</span></pre><p id="5e60" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.生成个人访问令牌</p><p id="3874" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">点击用户设置→个人访问令牌</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/24545496b62b42d6b65053371069b099.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*-WfXf4Qabwvhm5KQZV8Fug.png"/></div></figure><p id="11fd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">单击新令牌，提供详细信息并创建 PAT</p><p id="2383" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">保存 PAT，以便在将来的活动中使用。</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/6d8b37835997ac336e8e1b124381a6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*j1EDarx3I2o1GTylN8DA0g.png"/></div></figure><p id="be44" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.转到你的第二个组织，例如- <strong class="kb io"> ADOCollection </strong>并转到你的项目</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/3b2212785da93460a8d6ea8a367ca4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JkrjJGK_ECyBbQj0Kl-2w.jpeg"/></div></div></figure><p id="75f7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">5.创建服务连接</p><p id="0fda" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">转到项目设置→服务连接</p><p id="d50c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">单击“新建服务连接”并选择“Azure Repos/Team Foundation Server”</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/006f1a00eb29071001f9befe4b71994f.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*k0CGXvSD7ZC29KoJp4jABw.png"/></div></figure><p id="b3d3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">提供之前创建的组织 url 和 PAT 令牌</p><p id="9007" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">给服务连接起一个有意义的名字，然后点击 Verify and save</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/df5acdb1141fc3f719525f45ed666e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*6ujyf87bH1CshHv-S5201A.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">服务连接</figcaption></figure><p id="d1c2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">6.转到管道，用下面的 yaml 文件创建一个新的管道</p><pre class="nr ns nt nu gt nw nx ny nz aw oa bi"><span id="ad4a" class="ob mo in nx b gy oc od l oe of">trigger: none</span><span id="73bb" class="ob mo in nx b gy ol od l oe of">resources:<br/>  repositories:<br/>    - repository: templates<br/>      type: git<br/>      name: TemplateProject/TemplateProject<br/>      endpoint: 'ADOCollection-ADOTemplateDemo-ProjectB'<br/>      ref: refs/heads/main<br/>pool:<br/>  vmImage: 'ubuntu-latest'</span><span id="3267" class="ob mo in nx b gy ol od l oe of">stages:<br/>  - template: stage.yaml@templates</span></pre><p id="e3f4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">请注意，端点值应该是您创建的端点，名称应该是“项目名称/存储库名称”</p><p id="c1cf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">还要提到您想要从中获取数据的分支，默认情况下是 ref/heads/master</p><p id="475a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">7.执行管道以查看结果</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/86e61ae817cb3f9e7e5db2a1c5f96b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNKsI-bsShGMK7UbCtB27w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">管道</figcaption></figure></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><h1 id="6309" class="mn mo in bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">跨 Azure DevOps 项目共享模板</h1><p id="5433" class="pw-post-body-paragraph jz ka in kb b kc nl ke kf kg nm ki kj kk nn km kn ko no kq kr ks np ku kv kw ig bi translated">首先，假设你有 2 个 Azure DevOps 项目的访问权限。</p><p id="8d09" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">步骤:</strong></p><ol class=""><li id="a349" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">登录 dev.azure.com 并转到您的组织</li></ol><p id="7e8a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.转到您的 Azure DevOps 项目，例如项目 A → Azure Repo，并创建一个文件“stage.yaml ”,如下所示</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi on"><img src="../Images/e17a15df14a7e06b58b9e236b5a1bb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbbHOR7ZPl7NfwzchfhoIQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">来源</figcaption></figure><blockquote class="lg lh li"><p id="5e45" class="jz ka lj kb b kc kd ke kf kg kh ki kj lk kl km kn ll kp kq kr lm kt ku kv kw ig bi translated">stage.yaml</p></blockquote><pre class="nr ns nt nu gt nw nx ny nz aw oa bi"><span id="fda3" class="ob mo in nx b gy oc od l oe of">stages:<br/>  - stage: stage1<br/>    jobs:<br/>      - job: stagejob1<br/>        steps:<br/>          - bash: echo Share Template Across Projects</span></pre><p id="9366" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">6.转到您的 Azure DevOps 项目，例如项目 B → Azure 管道，并使用以下 yaml 文件创建一个新管道</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oo"><img src="../Images/b3b3f07935b3a7b3c79591a1149c6837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4WZVgqQ3QC-2goR19kmSg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">项目 B</figcaption></figure><pre class="nr ns nt nu gt nw nx ny nz aw oa bi"><span id="a25c" class="ob mo in nx b gy oc od l oe of">trigger: none</span><span id="4b4a" class="ob mo in nx b gy ol od l oe of">resources:<br/>  repositories:<br/>    - repository: templates<br/>      type: git<br/>      name: ProjectA/ProjectA<br/>pool:<br/>  vmImage: 'ubuntu-latest'</span><span id="b596" class="ob mo in nx b gy ol od l oe of">stages:<br/>  - template: stage.yaml@templates</span></pre><p id="51c7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">请注意，端点值应该是您创建的端点，名称应该是“项目名称/存储库名称”</p><p id="c007" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">7.执行管道以查看结果</p><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi op"><img src="../Images/1e5c5e08dc096b466e4e5b3e350d04c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKO-verLzOgYyr4AjzBuNA.png"/></div></div></figure><figure class="nr ns nt nu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oq"><img src="../Images/d2b75f3b2dec2815837c12dff308dbd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iIYZmH9tFRR1jWBAOlIxVA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">结果</figcaption></figure></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><p id="10db" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">其他资源:</strong></p><div class="ln lo gp gr lp lq"><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd io gy z fp lv fr fs lw fu fw im bi translated">模板- Azure 管道</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">模板允许您定义可重用的内容、逻辑和参数。模板有两种作用。你可以插入…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">docs.microsoft.com</p></div></div><div class="lz l"><div class="or l mb mc md lz me jt lq"/></div></div></a></div></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><p id="adf0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我希望你喜欢阅读这篇文章，随时添加你的评论、想法或反馈，不要忘记在 linkedin 上联系。</p></div></div>    
</body>
</html>