<html>
<head>
<title>How to build a headless WordPress website with ReactJS &amp; Frontity - Pt. 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 ReactJS &amp; Frontity - Pt 建立一个无头 WordPress 网站？2</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-a-headless-wordpress-website-with-frontity-reactjs-pt-2-3933990bab54?source=collection_archive---------13-----------------------#2022-08-18">https://blog.devgenius.io/how-to-build-a-headless-wordpress-website-with-frontity-reactjs-pt-2-3933990bab54?source=collection_archive---------13-----------------------#2022-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cf34f467c157fcfa3cfe1dcf7b7c5582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_YzoaT27CjTmgIsGudEEg.png"/></div></div></figure><p id="25e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">设置 Frontity 项目的后续步骤…</p><p id="fb3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤 2: </strong>因为 Frontity 是一个 React 框架，所以在创建项目之前，您需要安装 Node。确保这样做，然后通过在终端中输入以下命令创建一个新的 Frontity 项目:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="35c3" class="lf lg iq lb b gy lh li l lj lk">npx frontity create my-frontity-project</span></pre><p id="9592" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将收到以下提示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/2a520035858c60522c1ed3e9da791a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQulyRlfEkNMV0zidC8bFQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">第一终端消息提示</figcaption></figure><p id="79a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入(y)继续。在安装过程中，终端将再次提示您以下信息:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/ffd5d3f8d0a5c4af18e262750188f67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qz5SUfEmFTHQ6GPlM7xi7Q.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">第二终端消息提示</figcaption></figure><p id="d1c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将被要求选择一个起始主题。建议如果是第一次使用 Frontity，那么应该选择<code class="fe lr ls lt lb b">@frontity/mars-theme</code>开始使用。通过使用 Mars-Theme，Frontity 本质上给了你一个完全自举的项目，它有一个可以轻松定制的启动主题。Frontity 文档也将使用 Mars 主题作为参考，因此很容易遵循 Frontity 自己的安装和定制指南。一旦您选择了这个，安装将完成，并且将创建一个与您使用的项目名称同名的目录。它将具有与此类似的结构:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="cc37" class="lf lg iq lb b gy lh li l lj lk">my-frontity-project/<br/>|__ node_modules/<br/>|__ package.json<br/>|__ frontity.settings.js<br/>|__ favicon.ico<br/>|__ packages/<br/>    |__ mars-theme/</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/64afe85fcaa42c08873d307ee0da19f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*szfHTWRjktplSuMhQTvrrQ.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">您的 Frontity 项目安装后的样子</figcaption></figure><p id="d5df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过从终端执行以下命令，您可以在本地运行项目:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a0a2" class="lf lg iq lb b gy lh li l lj lk">cd my-frontity-project &amp;&amp; npx frontity dev</span></pre><p id="b80f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样做将在<a class="ae lv" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>加载您的 Frontity 项目，在这里您将看到您也安装了 Mars-Theme。它应该如下所示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/2dc2fb5779f3c5700f43b5d8c3c33dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XS12NX-pfdJo8gJ6KO6dUg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">用火星主题测试 Frontity 博客</figcaption></figure><p id="8668" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，你的 Frontity 项目正在使用 Frontity 自己的测试 WordPress 网站——<a class="ae lv" href="https://test.frontity.org/" rel="noopener ugc nofollow" target="_blank">https://test.frontity.org/</a>的内容数据。这是个好消息，因为这意味着你的 Frontity 项目正在从 WordPress REST API 中提取数据，只是还不是你自己的站点。所以让我们来解决这个问题…</p><p id="2370" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在你的 Frontity 项目中，在你选择的 I.D.E .中打开<code class="fe lr ls lt lb b">frontity.settings.js</code>。您应该会看到以下代码:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="23ae" class="lf lg iq lb b gy lh li l lj lk">const settings = {<br/>  ...,<br/>  packages: [<br/>    ...,<br/>    {<br/>      name: "<a class="ae lv" href="http://twitter.com/frontity/wp-source" rel="noopener ugc nofollow" target="_blank">@frontity/wp-source</a>",<br/>      state: {<br/>        source: {<br/>          // Change this url to point to your WordPress site.<br/>          url: "<a class="ae lv" href="https://test.frontity.org/" rel="noopener ugc nofollow" target="_blank">https://test.frontity.org/</a>"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="4ec7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将你自己的 WordPress 安装设置为数据源，你可以通过设置<code class="fe lr ls lt lb b">frontity.settings.js</code>文件中的<code class="fe lr ls lt lb b">state.source.url</code>属性将你自己的 WordPress 站点连接到你的 Frontity 项目。</p><p id="6b0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于本教程的重点是比 Frontity 文档中使用的例子更深入一点，所以在 WordPress 安装端你还需要做一个改变…</p><p id="0171" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Frontity WordPress 测试站点(<a class="ae lv" href="https://test.frontity.org/" rel="noopener ugc nofollow" target="_blank">https://test.frontity.org/</a>)是一个博客，Frontity 文档中的例子假设你正在建立一个博客站点。然而，我的教程告诉你如何建立一个包含博客的网站。因此，如果你自己的 WordPress 安装有页面，但此时没有帖子，你可能不会在本地主机上的 Mars-Theme 中看到你的内容。要解决这个问题，回到你的 WordPress 网站，进入你的网站主页，点击顶部管理栏中的“定制”。然后，您将看到以下内容:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/d7195627970dae4cfbd70f0a3c57a2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*lqtUm70cApUO9ATM4_eHHA.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">WordPress 中的侧面定制面板</figcaption></figure><p id="d270" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击“主页设置”,然后将您的主页设置为静态页面，如下所示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/f278c4f18d82cc910341af7ff6ae68da.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*zCMzSYU4UdYhY2DyY1FDuw.png"/></div></figure><p id="4c6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里还有一个设置你的文章页面的选项，如果你已经添加了一个文章/博客页面，你也可以在这里设置。</p><p id="56d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦这些都设置好了，回到你的 Frontity 项目，再次打开<code class="fe lr ls lt lb b">frontity.settings.js</code>文件。在此设置文件中，您可以通过添加以下内容来反映您刚才所做的更改:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="bfca" class="lf lg iq lb b gy lh li l lj lk">const settings = {<br/>  ...,<br/>  packages: [<br/>    ...,<br/>    {<br/>      name: "<a class="ae lv" href="http://twitter.com/frontity/wp-source" rel="noopener ugc nofollow" target="_blank">@frontity/wp-source</a>",<br/>      state: {<br/>        source: {<br/>          // Change this url to point to your WordPress site.<br/>          url: "<a class="ae lv" href="https://test.frontity.org/" rel="noopener ugc nofollow" target="_blank">https://test.frontity.org/</a>", <br/>          homepage: "<a class="ae lv" href="http://twitter.com/frontity/wp-source" rel="noopener ugc nofollow" target="_blank">/</a>homepage", <br/>          postsPage: "/blog"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="dc43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您将看到您的静态主页以 Mars-Theme 呈现在您的本地主机中。你还会注意到它没有使用你的 WordPress 站点的菜单，而是仍然显示与 Frontity 测试站点相关的菜单。这实际上是硬编码在<code class="fe lr ls lt lb b">frontity.settings.js</code>的火星主题中。让我们删除这些菜单项，取而代之的是从 WordPress 安装中提取动态菜单，从 REST API 调用。请记住，我们已经在 WordPress REST API 端公开了这一点，所以我们只需在 Frontity 项目中做一些更改就可以让它工作了。</p><p id="7b92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，在<code class="fe lr ls lt lb b">frontity.settings.js</code>的“套餐”/“名称”/“状态”/“主题”下，你会看到“菜单”，看起来如下:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="e1b1" class="lf lg iq lb b gy lh li l lj lk">"menu": [<br/>  [<br/>    "Home",<br/>    "/"<br/>  ],<br/>  [<br/>    "Nature",<br/>    "/category/nature/"<br/>  ],<br/>  [<br/>    "Travel",<br/>    "/category/travel/"<br/>  ],<br/>  [<br/>    "Japan",<br/>    "/tag/japan/"<br/>  ],<br/>  [<br/>    "About Us",<br/>    "/about-us/"<br/>  ]<br/>],</span></pre><p id="2c80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从<code class="fe lr ls lt lb b">frontity.settings.js</code>中删除以上内容。完成后，打开 Frontity 项目的 Mars-Theme — <code class="fe lr ls lt lb b">src/components/</code>中“src”目录下的“组件”目录，并在组件目录— <code class="fe lr ls lt lb b">src/components/handlers</code>中添加一个名为“处理程序”的新目录。然后在<code class="fe lr ls lt lb b">src/components/handlers/menu-handlers.js</code>里面添加一个<code class="fe lr ls lt lb b">menu-handlers.js</code>文件。为了从 WordPress API 获取实体，我们需要添加一个处理程序。这将是一个<code class="fe lr ls lt lb b">menuHandler.js</code>组件，它将包含以下代码:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9508" class="lf lg iq lb b gy lh li l lj lk">const menuHandler = {<br/>    name: "menus",<br/>    priority: 10,<br/>    pattern: "/menu/:slug",<br/>    func: async ({ link, params, state, libraries }) =&gt; {<br/>        console.log("PARAMS:", params);<br/>        const { slug } = params;</span><span id="b670" class="lf lg iq lb b gy lz li l lj lk">// Fetch the menu data from the endpoint<br/>        const response = await libraries.source.api.get({<br/>            endpoint: `/menus/v1/menus/${slug}`,<br/>        });</span><span id="007f" class="lf lg iq lb b gy lz li l lj lk">// Parse the JSON to get the object<br/>        const menuData = await response.json();</span><span id="3c74" class="lf lg iq lb b gy lz li l lj lk">// Add the menu items to source.data<br/>        const menu = state.source.data[link];<br/>        console.log(link);<br/>        Object.assign(menu, {<br/>            items: menuData.items,<br/>            isMenu: true,<br/>        });<br/>    },<br/>};</span><span id="1abb" class="lf lg iq lb b gy lz li l lj lk">export default menuHandler;</span></pre><p id="076e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦添加了处理程序，就需要将其导入到您的<code class="fe lr ls lt lb b">index.js</code>文件— <code class="fe lr ls lt lb b">packages/mars-theme/src/index.js</code>中。看起来将如下所示:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="d77c" class="lf lg iq lb b gy lh li l lj lk">// ...<br/>import menuHandler from "./components/handlers/menu-handler";</span><span id="0405" class="lf lg iq lb b gy lz li l lj lk">// ...</span><span id="2efc" class="lf lg iq lb b gy lz li l lj lk">libraries: {<br/>  // ...<br/>  source: {<br/>    handlers: [menuHandler],<br/>  },<br/>},</span></pre><p id="6b51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还必须向 actions 对象添加一个 beforeSSR 方法，如下所示:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="89e9" class="lf lg iq lb b gy lh li l lj lk">actions: {<br/>  theme: {<br/>    // ...<br/>    beforeSSR: async ({ state, actions }) =&gt; {<br/>      await actions.source.fetch(`/menu/${state.theme.menuUrl}/`);<br/>    }<br/>  },<br/>},</span></pre><p id="2f54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，你应该能够在<code class="fe lr ls lt lb b">menu-handler.js</code>的<code class="fe lr ls lt lb b">console.logs</code>中看到你的 WordPress 网站的菜单数据。你现在需要做的就是创建你自己的<code class="fe lr ls lt lb b">Navigation.js</code>组件。我不打算涵盖这一部分的所有细节，因为这很大程度上取决于您的网站设计，但是我将解释如何从 REST API 将菜单数据放入组件。您的组件应该如下所示:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a09b" class="lf lg iq lb b gy lh li l lj lk">const Nav = ({ state }) =&gt; {<br/>  const items = state.source.get(`/menu/${state.theme.menuUrl}`).items;</span><span id="5679" class="lf lg iq lb b gy lz li l lj lk">  console.log('ITEMS:', items);</span><span id="ed11" class="lf lg iq lb b gy lz li l lj lk">  &lt;SiteNavigation&gt;<br/>   ...<br/>  &lt;/SiteNavigation&gt;</span><span id="141d" class="lf lg iq lb b gy lz li l lj lk">}</span></pre><p id="973e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Frontity 将状态定义为<em class="ma">“一个包含你的包所暴露的所有状态的 JavaScript 对象”</em>。</strong></p><p id="f897" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加动态菜单到此结束。<br/> <a class="ae lv" href="https://youtu.be/BMJn0RZ2I9s" rel="noopener ugc nofollow" target="_blank">了解更多关于从 WordPress REST API 获取菜单的信息</a></p><p id="1e7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ma">继续阅读…</em><br/><strong class="ka ir">+</strong><a class="ae lv" href="https://medium.com/@mckenna.niall/how-to-build-a-headless-wordpress-website-with-frontity-reactjs-pt-3-ff98d654ac75" rel="noopener"><strong class="ka ir">如何用 Frontity / ReactJS 构建一个无头 WordPress 网站— Pt。3 </strong> </a></p><p id="25ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到… <br/> <strong class="ka ir"> + </strong> <a class="ae lv" href="https://medium.com/@mckenna.niall/how-to-build-a-headless-wordpress-website-with-frontity-reactjs-pt-1-9cc49f63981e" rel="noopener"> <strong class="ka ir">如何用 Frontity / ReactJS 构建一个无头 WordPress 网站— Pt。1</strong>T25】</a></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="57aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个故事也可以@ https://www . nmk . dev/post/how-to-build-a-headless-WordPress-website-with-frontity-react js-pt-2-3933990 Bab 54</p></div></div>    
</body>
</html>