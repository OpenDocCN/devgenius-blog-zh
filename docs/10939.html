<html>
<head>
<title>Trying to use in Chrono a NodeJS project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">尝试在 Chrono 中使用 NodeJS 项目</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-way-to-find-bugs-and-feature-ideas-to-improve-your-own-code-5c7f1db5167e?source=collection_archive---------8-----------------------#2022-12-08">https://blog.devgenius.io/a-way-to-find-bugs-and-feature-ideas-to-improve-your-own-code-5c7f1db5167e?source=collection_archive---------8-----------------------#2022-12-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/989cac70b44b12e2fcd79710f8b78674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xlebPNq8L-K2msSNeaHccw.png"/></div></div></figure><p id="2296" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">大家好！<br/>在这篇博文中，我将尝试在一个 Node JS 项目中使用<a class="ae kt" href="https://github.com/hazyuun/Chrono" rel="noopener ugc nofollow" target="_blank"> Chrono </a>来发现新的功能想法，以及需要修复的新错误</p><p id="3891" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你不知道什么是<a class="ae kt" href="https://github.com/hazyuun/Chrono" rel="noopener ugc nofollow" target="_blank"> Chrono </a>，我推荐你阅读<a class="ae kt" href="https://medium.com/dev-genius/chrono-the-git-time-machine-c52e75b48f5c" rel="noopener">我之前关于 chrono </a>的文章，或者继续，我会一路简要解释。</p><h1 id="f4a2" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">放弃</h1><blockquote class="ls lt lu"><p id="b21a" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated"><a class="ae kt" href="https://github.com/hazyuun/Chrono" rel="noopener ugc nofollow" target="_blank"> Chrono </a>还在开发阶段，不保证稳定。</p><p id="5cb9" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">如果您打算使用它或测试它，请谨慎使用。</p><p id="0442" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">使用风险自担，我不对你的任何行为负责。</p><p id="e88f" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">另外，如果您发现任何 bug 或有任何建议，请随时<a class="ae kt" href="https://github.com/hazyuun/Chrono/issues" rel="noopener ugc nofollow" target="_blank">在 Github 上提交问题。</a></p><p id="f526" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">谢谢！</p></blockquote><h1 id="4aba" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">介绍</h1><p id="e70e" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">几个月前，我开始研究<a class="ae kt" href="https://github.com/hazyuun/Chrono" rel="noopener ugc nofollow" target="_blank"> Chrono </a>，这是一个简单的工具，当事件发生时，git 会在临时分支中为你提交(定期或在文件保存时)，在<a class="ae kt" href="https://medium.com/dev-genius/chrono-the-git-time-machine-c52e75b48f5c" rel="noopener">我之前的博客文章</a>中了解更多信息。</p><p id="b13d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你自己的项目中发现问题和新特性想法的最好方法之一，就是试着自己使用它！这就是我所做的，我试着在一个简单的 Express JS 服务器中使用它，下面是它是如何进行的</p><h1 id="4c1d" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用 Chrono 设置节点 JS 项目</h1><p id="d8d7" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">让我们试着用 Express 制作一个非常简单的 REST-ful API，我将跳过初始化过程，因为这超出了这篇博文的范围。</p><p id="9d3f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好了，我们有了这个基本的文件夹结构，以<code class="fe me mf mg mh b">index.js</code>作为主入口点。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/70678957cb2191ae656edf8de8915a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*j-qUy6IKfBrmdS7fVVQCCg.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">文件夹结构</figcaption></figure><p id="983d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，由于我们将使用超时空，我认为在<code class="fe me mf mg mh b">package.json</code>中为它添加一些 npm 脚本是个好主意</p><p id="c59c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，让我们从基本的会话列表/创建/删除/启动命令开始:</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/64b9afb2d4f3459a26aad459b29be0fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*hsFR6vPCtilJENWvKzIC6w.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">一些超时空的脚本</figcaption></figure><p id="e924" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们可能希望同时启动会话和运行 nodemon，并用 Ctrl+C (SIGINT)停止它们，这样做有点棘手；首先，我们想同时运行这两个命令，这相当容易:</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="7e84" class="mw kv in mh b be mx my l mz na">yarn dev &amp; yarn chrono:start</span></pre><blockquote class="ls lt lu"><p id="1a20" class="jv jw lv jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">注意，我把<code class="fe me mf mg mh b">yarn chrono:start</code>留在了最后，以便让它获得命令行参数(会话名)</p></blockquote><p id="db40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，如果我们让它保持原样，它会工作得很好，但是当我们按 Ctrl+C 时，我们不能停止这两个进程，所以要这样做，我们可以使用<code class="fe me mf mg mh b">trap</code>命令注册一个 SIGINT 信号处理程序来终止这两个进程，就像这样:</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="0f9e" class="mw kv in mh b be mx my l mz na">trap 'kill %1; kill %2' SIGINT; yarn dev &amp; yarn chrono:start</span></pre><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ec6a63a08ee365df127c454a0834f20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5KrsJ_0jS_N4Afqfaxhw6Q.png"/></div></div></figure><ul class=""><li id="b634" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated">添加功能:如果我们也可以使用 Chrono 命令合并会话，那就太好了(我之前也有过这个想法，但我还是在待办事项列表中注明了)</li></ul><p id="b91a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要<code class="fe me mf mg mh b">chrono.yaml</code>配置文件，我刚刚用了这个</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="2147" class="mw kv in mh b be mx my l mz na">events:<br/>  periodic:<br/>    period: 10<br/>    files: ["."]<br/>  save:<br/>    files: ["."]</span></pre><p id="359b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">初次提交的时间</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="62fb" class="mw kv in mh b be mx my l mz na">$ git init<br/>$ git add .<br/>$ git commit -m "Initial commit"</span></pre><p id="5089" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不错！</p><h1 id="ab5c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">尝试使用它</h1><p id="a827" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">首先，我创建了一个计时会话</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="f207" class="mw kv in mh b be mx my l mz na">$ yarn chrono:create simple_api</span></pre><p id="7401" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以看到它被创造出来:</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="0275" class="mw kv in mh b be mx my l mz na">$ yarn chrono:sessions</span></pre><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/ed22c34e708995e42e19bea6254625df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lSv7XGBxx8MfLnqW_4Y_Q.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">会话列表</figcaption></figure><p id="d9c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我开始了这次会议</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="974c" class="mw kv in mh b be mx my l mz na">$ yarn chrono:start simple_api</span></pre><p id="e359" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我在<code class="fe me mf mg mh b">index.js</code>中写了一个简单的路线并保存，保存事件被触发了，但是没有提交任何东西！原来保存事件不会递归地触发子目录，换句话说，配置文件中的<code class="fe me mf mg mh b">"."</code>不包括目录中的文件，</p><ul class=""><li id="f92b" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated"><strong class="jx io">要修复的错误:</strong>子目录中的文件不会触发保存事件</li></ul><p id="6704" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为解决办法，我修改了配置文件，使其也包含了<code class="fe me mf mg mh b">./src</code>，并重启了 Chrono</p><pre class="mj mk ml mm gt ms mh mt bn mu mv bi"><span id="7659" class="mw kv in mh b be mx my l mz na">events:<br/>  periodic:<br/>    period: 10<br/>    files: ["./src/*"]<br/>  save:<br/>    files: ["./src", "."]</span></pre><p id="f13a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我决定将路由与入口点分开，所以我添加了一个新文件，只包含路由，然后注意到它没有被提交，因为它没有被 git 跟踪！</p><ul class=""><li id="82b2" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated">要添加的功能:如果我们有自动添加新文件的选项，那就太好了</li></ul><h1 id="bf48" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">添加新功能后</h1><p id="dce6" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我补充道:</p><ul class=""><li id="4a4b" class="nc nd in jx b jy jz kc kd kg ne kk nf ko ng ks nh ni nj nk bi translated">合并命令</li><li id="80e4" class="nc nd in jx b jy nm kc nn kg no kk np ko nq ks nh ni nj nk bi translated">未跟踪文件的自动添加选项</li></ul><p id="d194" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">之后，我给<code class="fe me mf mg mh b">package.json</code>添加了合并脚本</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/3b32a7336b0ea76f8c11c289bb9e3457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McDU4XR2kw6B8aUepr_7gw.png"/></div></div></figure><p id="83e6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并在计时配置文件中启用自动添加</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/db6221a4be2d5c031b63df819ad7c62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*rlASeqVWhfhli6EOED2T7w.png"/></div></figure><p id="551e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后再次尝试使用它(从头开始),这次很顺利</p><h1 id="98e5" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="645b" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">这是在我自己的代码中发现新问题和 bug，以及新特性想法的好方法</p><p id="ea3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望你喜欢阅读这篇文章，你可以查看 github 上的<a class="ae kt" href="https://github.com/hazyuun/Chrono" rel="noopener ugc nofollow" target="_blank"> Chrono 库</a></p><p id="74f2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">祝你白天/晚上愉快！<br/>干杯！</p></div></div>    
</body>
</html>