<html>
<head>
<title>Smart way of error handling in Golang For easy debugging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang 中智能的错误处理方式便于调试</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/smart-way-of-error-handling-in-golang-for-easy-debuging-83ef6ed33622?source=collection_archive---------4-----------------------#2022-08-18">https://blog.devgenius.io/smart-way-of-error-handling-in-golang-for-easy-debuging-83ef6ed33622?source=collection_archive---------4-----------------------#2022-08-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b9164e12a1f3d19b161cfe7cf8e67df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kky-xJR48kYSZ5kw"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jz" href="https://unsplash.com/@geekgunda?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Chinmay Bhattar </a>拍摄的照片</figcaption></figure><p id="1ce8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 golang 中，没有像 try/catch 这样的异常处理来管理错误，但它确实有一个简单的原则，即从函数返回(比如 func3())的早期抛出错误，并从函数的调用方(比如 func2())捕获错误，然后在那里做一些事情，或者它可以简单地返回错误，以便调用方(比如 func1())可以决定如何处理错误。</p><p id="d0e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">示例:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="1f65" class="lh li in ld b gy lj lk l ll lm">// You can edit this code!<br/>// Click here and start typing.<br/>package main</span><span id="860b" class="lh li in ld b gy ln lk l ll lm">import (<br/> "errors"<br/> "fmt"<br/> "log"<br/> "os"<br/>)</span><span id="7223" class="lh li in ld b gy ln lk l ll lm">func func1(message string) error {<br/> if err := func2(message); err != nil {<br/>  fmt.Printf("func2 failed with err:%v\n", err)<br/>  fmt.Println("Trying to create the file and store it in mongo DB")</span><span id="3f4c" class="lh li in ld b gy ln lk l ll lm">  if err := createAndStoreInDB(message); err != nil {<br/>   fmt.Printf("failed to create file in DB err:%v\n", err)<br/>   return fmt.Errorf("failed to create file on neither OS nor in DB")</span><span id="8d73" class="lh li in ld b gy ln lk l ll lm">} else {<br/>   fmt.Println("file creation successful in mango DB")<br/>   return nil<br/>  }<br/> }<br/> fmt.Println("file creation successful in OS")<br/> return nil<br/>}</span><span id="1b9f" class="lh li in ld b gy ln lk l ll lm">func func2(message string) error {<br/> message = message + "added more content"<br/> if err := func3(message); err != nil {<br/>  fmt.Printf("func3 failed with err:%v\n", err)<br/>  return err<br/> }<br/> return nil<br/>}</span><span id="995c" class="lh li in ld b gy ln lk l ll lm">func func3(message string) error {<br/> f, err := os.Open("filename.ext")<br/> if err != nil {<br/>  return err<br/> }<br/> fmt.Printf("file created successfully file:%v \n", f)<br/> return nil<br/>}<br/>func createAndStoreInDB(message string) error {<br/> message = message + "added more content for DB"<br/> // call the db function and return error<br/> //return nil<br/> return errors.New("failed to connect to db")<br/>}</span><span id="b1c0" class="lh li in ld b gy ln lk l ll lm">func main() {<br/> msg := "create the file in the os by adding more content"<br/> if err := func1(msg); err != nil {<br/>  log.Fatal(err)<br/> }</span><span id="aa6f" class="lh li in ld b gy ln lk l ll lm">}</span></pre><p id="107e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">输出</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="5a64" class="lh li in ld b gy lj lk l ll lm">func3 failed with err:open filename.ext: no such file or directory<br/>func2 failed with err:open filename.ext: no such file or directory<br/>Trying to create the file and store it in mongo DB<br/>failed to create file in DB err:failed to connect to db<br/>2009/11/10 23:00:00 failed to create file on neither OS nor in DB<br/><br/>Program exited.</span></pre><p id="2ac4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">去操场吧</p><div class="lo lp gp gr lq lr"><a href="https://go.dev/play/p/j9oP9wF5DS8" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">Go Playground-Go 编程语言</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">Go Playground 是一个运行在 go.dev 服务器上的 web 服务。该服务接收 Go 程序，审查，编译…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">go.dev</p></div></div><div class="ma l"><div class="mb l mc md me ma mf jt lr"/></div></div></a></div><p id="32b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使调试更加直观</p><p id="b244" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您在这里观察到开发人员不清楚最初的错误是从哪个文件和行号发生的。他必须浏览所有的代码库，找出其中的位置，这非常耗时，有时还令人沮丧。让我们来看看同一个程序的改进版本，但是使用了更直观的方式来方便调试，特别是对于有数千行代码和不同模块/包的大型项目。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c90a" class="lh li in ld b gy lj lk l ll lm">// You can edit this code!<br/>// Click here and start typing.<br/>package main</span><span id="5277" class="lh li in ld b gy ln lk l ll lm">import (<br/> "fmt"<br/> "log"<br/> "os"<br/> "runtime"<br/>)</span><span id="8f94" class="lh li in ld b gy ln lk l ll lm">func NewError(err error) error {<br/> _, file, line, _ := runtime.Caller(1)<br/> return fmt.Errorf("[%s][%d] : %v\n", file, line, err)<br/>}</span><span id="d545" class="lh li in ld b gy ln lk l ll lm">func func1(message string) error {<br/> log.Println("entering func1")<br/> defer log.Println("exiting func1")<br/> if err := func2(message); err != nil {<br/>  log.Printf("func2 failed with err:%v\n", err)<br/>  log.Println("Trying to create the file and store it in mongo DB")</span><span id="836d" class="lh li in ld b gy ln lk l ll lm">if err := createAndStoreInDB(message); err != nil {<br/>   log.Printf("failed to create file in DB err:%v\n", err)<br/>   return NewError(fmt.Errorf("failed to create file on neither OS nor in DB"))</span><span id="08e6" class="lh li in ld b gy ln lk l ll lm">} else {<br/>   log.Println("file creation successful in mango DB")<br/>   return nil<br/>  }<br/> }<br/> /*<br/>  more code logic<br/> */<br/> log.Println("file creation successful in OS")<br/> return nil<br/>}</span><span id="ebc1" class="lh li in ld b gy ln lk l ll lm">func func2(message string) error {<br/> log.Println("entering func2")<br/> defer log.Println("exiting func2")</span><span id="4934" class="lh li in ld b gy ln lk l ll lm">message = message + "added more content"<br/> /*<br/>  more code logic<br/> */<br/> if err := func3(message); err != nil {<br/>  return err</span><span id="d894" class="lh li in ld b gy ln lk l ll lm">}<br/> return nil<br/>}</span><span id="8859" class="lh li in ld b gy ln lk l ll lm">func func3(message string) error {<br/> log.Println("entering func3")<br/> defer log.Println("exiting func3")</span><span id="529b" class="lh li in ld b gy ln lk l ll lm">/*<br/>  more code logic<br/> */</span><span id="ec9a" class="lh li in ld b gy ln lk l ll lm">f, err := os.Open("filename.ext")<br/> if err != nil {<br/>  return NewError(err)<br/> }<br/> log.Printf("file created successfully file:%v \n", f)<br/> return nil<br/>}<br/>func createAndStoreInDB(message string) error {<br/> log.Println("entering createAndStoreInDB")<br/> defer log.Println("exiting createAndStoreInDB")</span><span id="e6fc" class="lh li in ld b gy ln lk l ll lm">message = message + "added more content for DB"<br/> // call the db function and return error<br/> //return nil<br/> /*<br/>  if err:=connectDB(); err!=nil{<br/>  return NewError(fmt.Errorf("failed to connect to db err:%v",err))<br/>  }<br/> */<br/> return NewError(fmt.Errorf("failed to connect to db"))<br/>}</span><span id="b101" class="lh li in ld b gy ln lk l ll lm">func main() {<br/> /*<br/>  more code logic<br/> */<br/> msg := "create the file in the os by adding more content"<br/> if err := func1(msg); err != nil {<br/>  //log.Println(err)<br/>  log.Fatalf("failed the job err:%v", err)<br/> }<br/> /*<br/>  more code logic<br/> */<br/>}</span></pre><p id="61b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">输出:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="fd38" class="lh li in ld b gy lj lk l ll lm">2009/11/10 23:00:00 entering func1<br/>2009/11/10 23:00:00 entering func2<br/>2009/11/10 23:00:00 entering func3<br/>2009/11/10 23:00:00 exiting func3<br/>2009/11/10 23:00:00 exiting func2<br/>2009/11/10 23:00:00 func2 failed with err:[/tmp/sandbox1645831660/prog.go][66] : open filename.ext: no such file or directory<br/><br/>2009/11/10 23:00:00 Trying to create the file and store it in mongo DB<br/>2009/11/10 23:00:00 entering createAndStoreInDB<br/>2009/11/10 23:00:00 exiting createAndStoreInDB<br/>2009/11/10 23:00:00 failed to create file in DB err:[/tmp/sandbox1645831660/prog.go][83] : failed to connect to db<br/><br/>2009/11/10 23:00:00 exiting func1<br/>2009/11/10 23:00:00 failed the job err:[/tmp/sandbox1645831660/prog.go][26] : failed to create file on neither OS nor in DB<br/><br/>Program exited.</span></pre><p id="450b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">去操场吧</p><div class="lo lp gp gr lq lr"><a href="https://go.dev/play/p/yb-btQxE500" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">Go Playground-Go 编程语言</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">Go Playground 是一个运行在 go.dev 服务器上的 web 服务。该服务接收 Go 程序，审查，编译…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">go.dev</p></div></div><div class="ma l"><div class="mg l mc md me ma mf jt lr"/></div></div></a></div><p id="6980" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">结论:</p><p id="e46d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们必须以更有意义的方式包装错误，以便调用者可以在任何类型的错误发生时决定做什么，这需要更多的定制错误。我们可以通过在 struct 数据类型上实现 Error() func 来做到这一点。</p><div class="lo lp gp gr lq lr"><a href="https://go.dev/play/p/Kl6lU_mVzhe" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">Go Playground-Go 编程语言</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">Go Playground 是一个运行在 go.dev 服务器上的 web 服务。该服务接收 Go 程序，审查，编译…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">go.dev</p></div></div><div class="ma l"><div class="mh l mc md me ma mf jt lr"/></div></div></a></div></div></div>    
</body>
</html>