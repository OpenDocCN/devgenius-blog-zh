<html>
<head>
<title>Should I Add Semicolons to JavaScript Code?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我应该在 JavaScript 代码中添加分号吗？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/should-i-add-semicolons-to-javascript-code-6f254e1e170b?source=collection_archive---------4-----------------------#2022-05-23">https://blog.devgenius.io/should-i-add-semicolons-to-javascript-code-6f254e1e170b?source=collection_archive---------4-----------------------#2022-05-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a4dc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么不呢？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/8827fdb9fb0c790274c04a175006c264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*qtvsoQpeFN2oY1bSr87MKw.png"/></div></figure><p id="1b18" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">最近有刚接触 JavaScript 的朋友问我:JavaScript 里需要加分号吗？</p><p id="8ec3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这其实是一个一直在讨论的话题。有人认为不应该加分号，他们的意见和这个差不多:</p><ul class=""><li id="7204" class="lj lk iq kp b kq kr kt ku kw ll la lm le ln li lo lp lq lr bi translated">流行语言中有很多可选的分号。比如 Go，Ruby，Python，Swift 都可以加分号，但是没人加。</li><li id="241a" class="lj lk iq kp b kq ls kt lt kw lu la lv le lw li lo lp lq lr bi translated">不加分号可以让代码更清晰，减少视觉负担。</li><li id="c7a2" class="lj lk iq kp b kq ls kt lt kw lu la lv le lw li lo lp lq lr bi translated">还有很多。</li></ul><p id="64f6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">也有一些人认为应该加上分号。他们观点最大的一点是，没有分号可能会有问题。例如:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/b4aa25fd8dca5d3414f7dd8de95b3a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wkc7hj_HeZ-kd-5sislqOA.png"/></div></div></figure><p id="3f4a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">或者这个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mc"><img src="../Images/e9bfe5ccf78668e92dd5c747387dc57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1YtOYTq0YKjnjqKPPwKKw.png"/></div></div></figure><p id="85f5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这是因为 JavaScript 解释器(如 V8)将这些代码视为同一行语句。也就是说，上面的两个例子可以这样解释:</p><pre class="kg kh ki kj gt md me mf mg aw mh bi"><span id="e97f" class="mi mj iq me b gy mk ml l mm mn">// Example1<br/><strong class="me ir">const test = {<br/>  name: 1,<br/>}(() =&gt; {<br/>  test.name = 2;<br/>})();</strong></span><span id="e495" class="mi mj iq me b gy mo ml l mm mn">// Example2<br/><strong class="me ir">const test = {<br/>  name: 1,<br/>}[(2, 3)].map(() =&gt; {});</strong></span></pre><p id="56cd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以它当然会给出一个错误。解决方法是在<code class="fe mp mq mr me b">(</code>或<code class="fe mp mq mr me b">[</code>前加一个分号，或者在前面的语句后加一个分号。</p><p id="ba0a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">另外，没有分号可能会出现一些意外，比如我期望返回下面的对象，但它实际上返回了<code class="fe mp mq mr me b">undefined</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ms"><img src="../Images/16e7553ec57b1c370c4ca0643d0d5f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5KHPdrwPxWrTOfQHQxeWw.png"/></div></div></figure><p id="3079" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这样做的原因是因为 JavaScript 的自动分号插入(ASI)。上面的代码将被解析如下:</p><pre class="kg kh ki kj gt md me mf mg aw mh bi"><span id="a436" class="mi mj iq me b gy mk ml l mm mn">(function test() {<br/>  return;<br/>  {<br/>    name: 1;<br/>  }<br/>})();</span></pre><p id="cd61" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="mt">参见</em> <a class="ae mu" href="https://262.ecma-international.org/7.0/#sec-rules-of-automatic-semicolon-insertion" rel="noopener ugc nofollow" target="_blank"> <em class="mt">规范</em> </a> <em class="mt">了解关于该规则的更多描述。</em></p><p id="87d5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你是不是觉得这个规则很奇怪，为什么要这样设计？</p><p id="c31d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Brendan Eich(JavaScript 的创造者)在他的博客文章<a class="ae mu" href="https://brendaneich.com/2012/04/the-infernal-semicolon/" rel="noopener ugc nofollow" target="_blank">中提到了原因，这正是他所说的:</a></p><blockquote class="mv mw mx"><p id="1589" class="kn ko mt kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">ASI(正式来说)是一个语法纠错程序。如果你开始编码，就好像它是一个通用的有效换行符规则，你会遇到麻烦。</p></blockquote><p id="160c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我对它的解释是:ASI 是一种容错方案，它允许编程语言有更多的自由度。这是因为编码风格是不可控的，你可以选择加分号或者不加分号(忘了分号)，有了这个机制，代码会尽可能好的工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nb"><img src="../Images/f726bc8f23bb2e519e04bf60ba0d5de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vUZLlnTbfEQFvBL6"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">照片由<a class="ae mu" href="https://unsplash.com/@cookiethepom?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Cookie 在<a class="ae mu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的 Pom </a>拍摄</figcaption></figure><p id="4f0b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">那么回到主题，我们应该在 JavaScript 代码中添加分号吗？</p><p id="1574" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从上面的代码中，我们也可以知道，在那些特定的场景中，比如以<code class="fe mp mq mr me b">(</code>、<code class="fe mp mq mr me b">[</code>、<code class="fe mp mq mr me b">/</code>、<code class="fe mp mq mr me b">+</code>、<code class="fe mp mq mr me b">-</code>这些记号开头的语句，我们必须添加分号来确保程序正确执行。</p><p id="80e7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">另外，如果没有分号，那么我们还需要了解 ASI 规则，以避免一些意外情况。</p><p id="3579" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因此，如果这是一个全新的项目，我更喜欢在所有 JavaScript 代码中添加分号。如果是维护时间比较长的项目，那就按照原来的分号规则。</p><p id="8ee7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你使用像 Webpack 这样的构建工具，他们会用分号来编译你的代码，以确保你的代码是要传达的。</p><p id="31eb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你在你的项目中使用格式化工具，比如 Prettier，那么我推荐你使用 Git 钩子，比如<a class="ae mu" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank"> husky </a>，<a class="ae mu" href="https://github.com/toplenboren/simple-git-hooks" rel="noopener ugc nofollow" target="_blank"> simple-git-hooks </a>等等。以确保添加到远程的代码具有统一的风格。</p><p id="1eca" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">另外，通过 VS 代码的<code class="fe mp mq mr me b">"editor.formatOnSave": true</code>配置，可以在保存代码时及时看到格式的变化，保证想要表达的意思。</p><p id="91f8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">例如，当您配置为在所有代码中添加分号时，您可以在编写时只在那些必要的地方添加分号，然后 VS 代码会在保存时根据配置格式化您的代码，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ng"><img src="../Images/efb9461ce5ad43f0bbaead1c52673947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DRU7qnNKYtvX8F1nSfNjcA.gif"/></div></div></figure><p id="a38f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">本文到此为止。那么你怎么看待 JavaScript 中的分号呢？欢迎在评论区畅所欲言！</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="2a3b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="mt">今天就到这里。我是 Zachary，我将继续输出与 web 开发相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae mu" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="mt">中会员</em> </a> <em class="mt">。每月 5 美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae mu" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="mt">我的链接</em> </a> <em class="mt">报名，我会得到一点佣金。</em></p><p id="803a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你的支持对我来说很重要——谢谢。</p></div></div>    
</body>
</html>