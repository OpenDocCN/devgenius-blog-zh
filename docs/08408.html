<html>
<head>
<title>Writing Tests in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Go 中编写测试</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/writing-tests-in-go-6861c81132b1?source=collection_archive---------5-----------------------#2022-06-13">https://blog.devgenius.io/writing-tests-in-go-6861c81132b1?source=collection_archive---------5-----------------------#2022-06-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="90c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在今天的帖子中，我们将探讨如何在 Go 中编写测试。测试驱动开发，也称为 TDD，是一种鼓励开发人员在开发过程中测试代码的范例。</p><h1 id="9cdf" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">什么是测试，我为什么要关心？</h1><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/66097b408761c0984a4e5828673a0dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ZqMRQWFjIeUiuQyjZiim9g.jpeg"/></div></figure><p id="7fe4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">测试是一段用来验证您的代码行为是否正常的代码。起初，这可能听起来很乏味。</p><blockquote class="lo lp lq"><p id="b63b" class="jk jl lr jm b jn jo jp jq jr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg kh ig bi translated"><em class="in"> Meh。我完全了解我的代码。我知道我在做什么。考试真是浪费时间。</em></p><p id="492d" class="jk jl lr jm b jn jo jp jq jr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg kh ig bi translated"><em class="in"> —你真正的遗言:’)</em></p></blockquote><p id="dbeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我曾经认为编写测试也是浪费时间。我写了代码，所以我应该最清楚它是否有效，对吗？我总是可以打印调试并修复错误，对吗？当从其他地方调用我的函数时，它不可能会出错，对吗？…对吗？</p><p id="b02e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编写测试之所以重要，有几个原因。当你在职业生涯或学校项目中取得进展时，有可能会和其他人一起工作。当你们一起做一个项目时，你可能要负责编写一段必须被其他人使用的代码。我们称之为<em class="lr">库</em>。当其他人依赖您的代码正常工作时，确保您处理边缘情况是至关重要的，否则他们需要等待，直到您修复它。这可能非常耗时，并且可以通过中途测试您的代码来避免。测试就像是你在独自编码时不知道自己需要的工具，但碰巧是团队项目中的救命稻草。</p><p id="a601" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编写测试的第二个原因是，它通常会产生更干净的代码。当我们提到测试时，我们通常指的是<em class="lr">单元测试</em>，这意味着我们正在测试代码的每一个单独的组件。为了编写这些测试，您需要以模块化的方式编写代码。例如，我们可以把一个庞大臃肿的功能分解成能做好一件事的原子功能，而不是一个。然后，可以单独测试这些功能，以确保它们正常工作。</p><p id="6168" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第三个原因更加主观。我认为 TDD 帮助我更好地将事情可视化。在 TDD 中，鼓励您在实际实现功能之前先编写测试。在我的情况下，通过首先编写测试，我更确定我的模块应该接受什么作为输入，应该输出什么。我也可以事先考虑边缘情况，这样我就不需要事后去修改我的实现。</p><h1 id="2d6d" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">在 Go 中编写测试</h1><p id="f8fd" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">用 Go 编写测试非常容易。Go 在其标准库中包含了<code class="fe ma mb mc md b">testing</code>包，我认为这是该语言的开发者非常深思熟虑的决定。你真的不需要像其他语言那样的单独的测试框架或库，我很欣赏这一点。</p><p id="b898" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Go 测试存储在<code class="fe ma mb mc md b">*_test.go</code>文件中。星号代表您的<code class="fe ma mb mc md b">.go</code>文件，其中包含您想要测试的函数。例如，假设我有一个<code class="fe ma mb mc md b">areas.go</code>文件，其中包含计算不同形状面积的函数。这些功能的测试将在<code class="fe ma mb mc md b">areas_test.go</code>中进行。</p><p id="6cef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们从代码的高级概述开始。正如我前面提到的，<code class="fe ma mb mc md b">areas.go</code>将存储三个计算面积的函数:<code class="fe ma mb mc md b">findTriangleArea</code>、<code class="fe ma mb mc md b">findSquareArea</code>和<code class="fe ma mb mc md b">findCircleArea</code>。我们将在后面编写实现。我们应该首先编写输入和输出，否则当我们编写测试时，Go 会抱怨。</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="63d6" class="mi kj in md b gy mj mk l ml mm">package areas</span><span id="ef58" class="mi kj in md b gy mn mk l ml mm">func findTriangleArea(base, height float64) float64 {<br/>    return 0.0<br/>}</span><span id="5380" class="mi kj in md b gy mn mk l ml mm">func findSquareArea()</span><span id="7ab2" class="mi kj in md b gy mn mk l ml mm">func findCircleArea()</span></pre><p id="59f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在可以开始编写测试了。记住，我们希望在函数之前编写测试。创建一个名为<code class="fe ma mb mc md b">areas_test.go</code>的文件，并键入以下内容:</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="0c97" class="mi kj in md b gy mj mk l ml mm">package areas</span><span id="358b" class="mi kj in md b gy mn mk l ml mm">import (<br/>    "testing"<br/>)</span></pre><p id="b6f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们从导入这些包开始。</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="131a" class="mi kj in md b gy mj mk l ml mm">func TestFindTriangleArea(t *testing.T) {<br/>    base := 2.0<br/>    height := 3.0<br/>    expectedArea := 3.0<br/>    actualArea := findTriangleArea(base, height)</span><span id="633d" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }<br/>}</span></pre><p id="8716" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是<code class="fe ma mb mc md b">findTriangleArea</code>的测试功能。所有 Go 测试函数的名称都采用了<code class="fe ma mb mc md b">TestXxx(t *testing.T)</code>的格式，其中<code class="fe ma mb mc md b">Xxx</code>是您想要测试的函数的名称。测试的第一个字符必须大写。<code class="fe ma mb mc md b">testing.T</code>是一个负责跟踪测试状态的变量。<code class="fe ma mb mc md b">T</code>可用于调用特定的方法，如<code class="fe ma mb mc md b">Errorf</code>或<code class="fe ma mb mc md b">Fatalf</code>来终止测试、返回错误、记录结果等等。</p><p id="d972" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在函数内部，我们看到了测试的主要逻辑。简单地说，测试检查期望值和实际值是否匹配。在我们的例子中，我们调用底部为 2.0、高度为 3.0 的<code class="fe ma mb mc md b">findTriangleArea</code>。我们期望看到 3.0 的输出，因为<code class="fe ma mb mc md b">(base * height) / 2</code>找到了一个三角形的面积。如果对<code class="fe ma mb mc md b">findTriangleArea</code>的调用返回一个非零错误，或者如果返回的区域与预期的区域不匹配，我们将输出一个错误并停止测试。</p><p id="3569" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ma mb mc md b">t.Fatalf</code>就像<code class="fe ma mb mc md b">fmt.Sprintf</code>一样，我们可以根据自己的喜好格式化输出。我喜欢输出期望值，我们得到的实际值，以及任何错误，如果它存在的话。</p><p id="504f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们进行测试。为了在 Go 中运行一个测试，我们进入终端，并且<code class="fe ma mb mc md b">cd</code>进入测试文件所在的目录。然后，我们运行<code class="fe ma mb mc md b">go test -v</code>。您将得到如下输出:</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="4250" class="mi kj in md b gy mj mk l ml mm">$ go test -v<br/>=== RUN   TestFindTriangleArea<br/>    areas_test.go:15: expected 3, got 0<br/>--- FAIL: TestFindTriangleArea (0.00s)<br/>FAIL<br/>exit status 1<br/>FAIL    example.com/areas     0.002s</span></pre><p id="a414" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以写出<code class="fe ma mb mc md b">findTriangleArea</code>的实现了。</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="69a2" class="mi kj in md b gy mj mk l ml mm">func findTriangleArea(base, height float64) float64 {<br/>    area := base * height / 2<br/>    return area<br/>}</span></pre><p id="c50b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">简单吧？我也会为其他函数写一个。这是我们的最终结果。</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="24fc" class="mi kj in md b gy mj mk l ml mm">// areas.go<br/>package areas</span><span id="99b9" class="mi kj in md b gy mn mk l ml mm">import "math"</span><span id="981a" class="mi kj in md b gy mn mk l ml mm">func findTriangleArea(base, height float64) float64 {<br/>    area := base * height / 2<br/>    return area, nil<br/>}</span><span id="fc1b" class="mi kj in md b gy mn mk l ml mm">func findSquareArea(side float64) float64 {<br/>    area := side * side<br/>    return area<br/>}</span><span id="bd86" class="mi kj in md b gy mn mk l ml mm">func findCircleArea(radius float64) float64 {<br/>    area := math.Pi * radius * radius</span><span id="d701" class="mi kj in md b gy mn mk l ml mm">    // round to the 3rd decimal place<br/>    roundedArea := math.Round(area*1000) / 1000<br/>    return roundedArea<br/>}</span><span id="1821" class="mi kj in md b gy mn mk l ml mm">package areas</span><span id="04e5" class="mi kj in md b gy mn mk l ml mm">import (<br/>    "testing"<br/>)</span><span id="42f4" class="mi kj in md b gy mn mk l ml mm">func TestFindTriangleArea(t *testing.T) {<br/>    base := 2.0<br/>    height := 3.0<br/>    expectedArea := 3.0<br/>    actualArea := findTriangleArea(base, height)</span><span id="5ed3" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }<br/>}</span><span id="7b3a" class="mi kj in md b gy mn mk l ml mm">func TestFindSquareArea(t *testing.T) {<br/>    side := 2.0<br/>    expectedArea := 4.0<br/>    actualArea := findSquareArea(side)</span><span id="c049" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }<br/>}</span><span id="a42e" class="mi kj in md b gy mn mk l ml mm">func TestFindCircleArea(t *testing.T) {<br/>    radius := 2.0<br/>    expectedArea := 12.566<br/>    actualArea := findTriangleArea(radius)</span><span id="ae9f" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }<br/>}</span></pre><p id="30e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我们现在运行<code class="fe ma mb mc md b">go test -v</code>，我们将得到以下结果:</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="52f6" class="mi kj in md b gy mj mk l ml mm">$ go test -v<br/>=== RUN   TestFindTriangleArea<br/>--- PASS: TestFindTriangleArea (0.00s)<br/>=== RUN   TestFindSquareArea<br/>--- PASS: TestFindSquareArea (0.00s)<br/>=== RUN   TestFindCircleArea<br/>--- PASS: TestFindCircleArea (0.00s)<br/>PASS<br/>ok    example.com/areas     0.001s</span></pre><p id="19df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">厉害！我们所有的测试都通过了。</p><h1 id="be46" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">多个案例的测试</h1><p id="9a60" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">这都是阳光和彩虹，但如果我们要测试多个案例呢？您可能希望对多个案例进行测试。你是对的。</p><p id="7c04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">凭直觉，我们可以这样写:</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="8eb7" class="mi kj in md b gy mj mk l ml mm">func TestFindSquareArea(t *testing.T) {<br/>    side := 2.0<br/>    expectedArea := 4.0<br/>    actualArea := findSquareArea(side)</span><span id="32d7" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }</span><span id="528f" class="mi kj in md b gy mn mk l ml mm">    side = 3.0<br/>    expectedArea = 4.0<br/>    actualArea := findSquareArea(side)</span><span id="d0cc" class="mi kj in md b gy mn mk l ml mm">    if actualArea != expectedArea {<br/>        t.Fatalf("expected %v, got %v", expectedArea, actualArea)<br/>    }</span><span id="c5ed" class="mi kj in md b gy mn mk l ml mm">    // repeat...<br/>}</span></pre><p id="b7ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为这段代码会很快变得难看，所以让我们试试别的。</p><pre class="lh li lj lk gt me md mf mg aw mh bi"><span id="3c31" class="mi kj in md b gy mj mk l ml mm">func TestFindSquareArea(t *testing.T) {<br/>    type findSquareAreaTest struct {<br/>        side float64<br/>        expected float64<br/>    }</span><span id="c733" class="mi kj in md b gy mn mk l ml mm">    findSquareAreaTests := []findSquareAreaTest{<br/>        {2.0, 4.0},<br/>        {3.0, 9.0},<br/>        {4.0, 16.0},<br/>        {0.0, 0.0},<br/>    }</span><span id="fcc7" class="mi kj in md b gy mn mk l ml mm">    for _, test := range findSquareAreaTests {<br/>        output := findSquareArea(test.side)<br/>        if output != test.expected {<br/>            t.Fatalf("expected %v, got %v", test.expected, output)<br/>        }<br/>    }<br/>}</span></pre><p id="b62d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个看起来好多了。我们声明了一个保存<code class="fe ma mb mc md b">side</code>值和<code class="fe ma mb mc md b">expected</code>值的结构<code class="fe ma mb mc md b">findSquareAreaTest</code>。然后，我们创建该结构的一个片段，它保存了我们所有的测试用例。我们只需要使用一个 for 循环来遍历每个测试用例。这种类型的方法被称为<em class="lr">表驱动测试</em>，因为我们使用了一个包含许多测试用例的表。</p><h1 id="80b3" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">结论</h1><p id="983e" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">感谢你阅读这篇文章。希望你觉得有用。当然还有比我在这里列出的更高级的测试策略。我强烈建议您查看 <code class="fe ma mb mc md b"><a class="ae mo" href="https://pkg.go.dev/testing" rel="noopener ugc nofollow" target="_blank">testing</a></code> <a class="ae mo" href="https://pkg.go.dev/testing" rel="noopener ugc nofollow" target="_blank">包</a>的<a class="ae mo" href="https://pkg.go.dev/testing" rel="noopener ugc nofollow" target="_blank">文档，以便深入了解。然而，这篇文章将带你开始测试驱动开发。尝试在你自己的个人项目中应用它！下次见，有更多有趣的话题。再见！</a></p><p id="a9cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你也可以在<a class="ae mo" href="https://dev.to/jpoly1219/writing-tests-in-go-fd8" rel="noopener ugc nofollow" target="_blank"> Dev.to </a>和<a class="ae mo" href="https://jpoly1219.github.io" rel="noopener ugc nofollow" target="_blank"> my personal site </a>上阅读这篇文章。</p></div></div>    
</body>
</html>