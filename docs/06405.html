<html>
<head>
<title>Marginal vs Conditional Probabilities</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">边际概率与条件概率</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/marginal-vs-conditional-probabilities-visualizations-and-models-in-r-e7288ad26cb9?source=collection_archive---------4-----------------------#2022-01-05">https://blog.devgenius.io/marginal-vs-conditional-probabilities-visualizations-and-models-in-r-e7288ad26cb9?source=collection_archive---------4-----------------------#2022-01-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f884" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">r中的可视化和模型。</h2></div><p id="e6f7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi ky translated">当我们比较各组时，我们愿意相信任何发现的差异都可以归因于所做的比较。例如，如果我观察一组女性和男性，并比较他们的身高，我愿意相信这种差异是由性别造成的。这是生物学上的差异。</p><p id="a7a7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我在SAT考试中比较男性和女性，我看到了差异，我愿意相信SAT分数的差异是由性别造成的。当然，这种说法比身高差异更敏感，大多数人会要求在分析中包括第三、第四和第五个变量。这就是辛普森悖论的根源。这就是条件概率发挥最大作用的地方。</p><p id="7a9f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">边际概率和条件概率的区别其实很简单。边际平均值。条件意味着依赖。因此，边际概率，或边际均值，或边际什么的，就是平均值。在男性和女性之间的差异中，发现的差异取决于被观察者的性别。这意味着对一个人的身高或SAT分数的观察取决于其性别。条件概率/发现。现在，如果我们只报告平均长度或SAT分数，我们会有一个边际发现。</p><p id="c25c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">条件概率的问题在于，有许多已知和未知的因素需要考虑。事实上，这个清单如此之长，又如此不为人知，以至于似乎不可能把它们都考虑进去。这就是为什么<a class="ae lh" href="https://medium.com/@marc.jacobs012/general-introduction-to-design-of-experiments-in-animal-science-using-sas-for-codes-fe1c5272b37a" rel="noopener">随机化</a>被认为是实验设计如此重要的一个方面，但却不是万无一失的。这就是为什么<a class="ae lh" href="https://medium.com/@marc.jacobs012/building-and-optimizing-randomized-complete-block-designs-using-sas-c973d127d862" rel="noopener">阻塞</a>，或者分层随机化被发明出来。然而，<a class="ae lh" href="https://medium.com/@marc.jacobs012/randomization-needs-numbers-bb4c85faaebe" rel="noopener">随机化并不能防止不正确的模型规格</a>，因此未知因素，即使随机分布，仍然会在背景中产生影响。</p><p id="8287" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">条件概率处于<a class="ae lh" href="https://medium.com/@marc.jacobs012/pr-non-vax-icu-pr-icu-non-vax-f7af477896ad" rel="noopener">贝叶斯分析</a>、<a class="ae lh" href="https://medium.com/@marc.jacobs012/why-science-is-beautifully-human-and-very-frail-4f6225d32bb0" rel="noopener">以及科学</a>的最前沿，但它们是建模所固有的<a class="ae lh" href="https://medium.com/@marc.jacobs012/multivariate-relationships-three-is-seldom-a-crowd-8c0a9e09b5c" rel="noopener">。</a></p><p id="0277" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天，我想向你们展示如何通过图表和模型更深入地研究条件概率。我将使用R标准的diamonds数据集，因此分析更容易复制。然而，我想敦促你在你自己的数据集上尝试所有这些。仅仅运行代码和“查找熟悉的东西”的危险在于学习过程会更加平淡。它没有让灰质得到应有的激活。</p><p id="3ce8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们开始吧。请记住，这些示例向您展示了如何寻找依赖关系以及如何处理它们。事实上，只要确定你期望依赖。</p><p id="e2a0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi ky translated">当考虑概率或影响者时，想象是关键。我们是视觉生物，所以你需要视觉化来看到数据中的一些东西，这些东西可能会使边际概率变得没有意义。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="3354" class="lr ls in ln b gy lt lu l lv lw">library(tidyverse)<br/>library(plotly)<br/>library(gridExtra)</span><span id="08af" class="lr ls in ln b gy lx lu l lv lw">names(diamonds)<br/>head(diamonds)<br/>ggplot(diamonds,aes(x=price,y=depth, <br/>                    col=as.factor(cut)))+geom_point(alpha=0.2)+theme_bw()<br/>ggplot(diamonds,aes(x=price,y=depth, <br/>                    col=as.factor(cut)))+<br/>  facet_grid(~clarity)+<br/>  geom_point(alpha=0.2)+theme_bw()<br/>ggplot(diamonds,aes(x=price,y=depth, <br/>                    col=as.factor(clarity)))+<br/>  facet_grid(~cut)+<br/>  geom_point(alpha=0.2)+theme_bw()</span></pre><div class="li lj lk ll gt ab cb"><figure class="ly lz ma mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/810d3a5b156296366d2e796e5dff081a.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*nfTYRZH3mMQNLw7EnxGNHg.png"/></div></figure><figure class="ly lz ml mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/bec512a15c8923052c4268db7f7303f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*mvwKtwm4-Ea69gfN0U42OA.png"/></div></figure><figure class="ly lz ml mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/4c6cde0020a4c87446aa20828fec4a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*UASBAqtffg47kXJUZ0MBeA.png"/></div></figure></div><p id="3a7a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">尽管散点图很好，但它们在这里并没有什么实际作用。条件密度图呢？</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="766b" class="lr ls in ln b gy lt lu l lv lw">cdplot(diamonds$cut ~ diamonds$price)<br/>cdplot(diamonds$cut ~ diamonds$price, bw = 2)<br/>cdplot(diamonds$cut ~ diamonds$price, bw = "SJ")<br/>spineplot(diamonds$cut ~ diamonds$price)</span></pre><div class="li lj lk ll gt ab cb"><figure class="ly lz mm mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/c5d50d2347b87b9603c1ea3c5cb1ff15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*_3ZVmTO7IMLLvpJeZ5h89g.png"/></div></figure><figure class="ly lz mm mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/2fdf53377c66aa3853fb421116d6cfd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*QaDVn074XyOa1NkXnM8vfg.png"/></div></figure></div><div class="ab cb"><figure class="ly lz mm mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/67cd2af6d643576eca471076d4715a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cclIywyP3kG6eQFjqzG-CQ.png"/></div></figure><figure class="ly lz mm mb mc md me paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><img src="../Images/49e274901b6173492d9e055d8f4f8cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*leNuAn-_zxGigEZ3gAoBWQ.png"/></div></figure></div><p id="ffed" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们也可以在ggplot2中重新创建它。下面并没有暗示交互作用的存在，但这并不意味着达到特定价格的概率不依赖于切割。如果完全没有效果，水平和垂直拆分将完全均匀分布。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="03fd" class="lr ls in ln b gy lt lu l lv lw">ggplot(diamonds, aes(x=price, fill=as.factor(cut))) + <br/>  geom_density(position='fill', alpha = 0.5) + <br/>  xlab("Price") + labs(fill='Cut') +<br/>  theme(legend.text=element_text(size=12), <br/>        axis.title=element_text(size=14))+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mn"><img src="../Images/ce2ab1e8ff9afc63d925c4012d20be75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGWn1LniyTp2YSYXOLQRIg.png"/></div></div></figure><p id="7734" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们添加另一个变量，使事情变得更有趣，更有条件！</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="661e" class="lr ls in ln b gy lt lu l lv lw">ggplot(diamonds, aes(x=price, fill=as.factor(cut))) + <br/>  geom_density(position='fill', alpha = 0.5) + <br/>  xlab("Price") + labs(fill='Cut') +<br/>  facet_grid(~clarity)+<br/>  theme(legend.text=element_text(size=12), <br/>        axis.title=element_text(size=14))+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mo"><img src="../Images/3adf51b84edc85193eb4c115fdd3bbbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9Uewcs1t57iOaHqvdvOtQ.png"/></div></div></figure><p id="d5fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">被<em class="mp">颜色</em>分裂没有被<em class="mp">清晰度</em>分裂那么强烈，但是条件效应是有的。如果不是这样，这些面将会是彼此的精确副本。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="6291" class="lr ls in ln b gy lt lu l lv lw">ggplot(diamonds, aes(x=price, fill=as.factor(cut))) + <br/>  geom_density(position='fill', alpha = 0.5) + <br/>  xlab("Price") + labs(fill='Cut') + facet_wrap(~color)+<br/>  theme(legend.text=element_text(size=12), <br/>        axis.title=element_text(size=14))+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mn"><img src="../Images/851cf81ec023e9520969d6ef380d7550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1-13qANPHL80Bi8ZrlGXw.png"/></div></div></figure><p id="a09f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们拥有一切——色彩和清晰度<em class="mp"/>。虽然它看起来像一个极端的条件矩阵，但在制作一些非常奇怪的图形时，您也会看到数据的稀疏性下降。</p><p id="e30c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不要错误地分割数据集，否则每次分割都只能得到一个或更少的观测值。条件概率也必须有意义，或者至少是假设的一部分。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="4cae" class="lr ls in ln b gy lt lu l lv lw">Γggplot(diamonds, aes(x=price, fill=as.factor(cut))) + <br/>  geom_density(position='fill', alpha = 0.5) + <br/>  xlab("Price") + labs(fill='Cut') +<br/>  facet_grid(color ~ clarity, margins = TRUE)+<br/>  theme(legend.text=element_text(size=12), <br/>        axis.title=element_text(size=14))+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mq"><img src="../Images/c0cdb8d0ececddab3070e7a4d35b9cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoIvhzTjlb6-oxarMChvlg.png"/></div></div></figure><p id="2b11" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的矩阵已经显示了，我也将在下面显示的，是右外侧的边际图。最边缘的图是右下角的图。这些图表非常棒，因为您可以直观地检查这些图表的偏差，以寻找条件概率的线索。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="10c9" class="lr ls in ln b gy lt lu l lv lw">diamonds$cut&lt;-factor(diamonds$cut, ordered=FALSE)<br/>preproc1 &lt;- preProcess(diamonds, method=c("center", "scale"))<br/>norm1 &lt;- predict(preproc1, diamonds)<br/>summary(norm1)</span><span id="9f17" class="lr ls in ln b gy lx lu l lv lw">ggplot(norm1, aes(x=carat, <br/>                  y=price, <br/>                  size=depth, <br/>                  col=as.factor(cut))) + <br/>  geom_point(alpha = 0.5) + <br/>  facet_grid(color ~ clarity, margins = TRUE)+<br/>  xlab("Price") + labs(col='Cut') +<br/>theme(legend.text=element_text(size=12), <br/>      axis.title=element_text(size=14))+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mr"><img src="../Images/a5a69b0d156344f50c1108d1364c12ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHhVw-Zkxj1_GyUlvL_3_w.png"/></div></div></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="601e" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-ggplot(norm1, aes(x=carat, <br/>                  y=price, <br/>                  z=depth))+<br/>geom_hex(bins=60) + coord_fixed() +<br/>  scale_fill_viridis(option="magma") + theme_bw()</span><span id="3fb8" class="lr ls in ln b gy lx lu l lv lw">g2&lt;-ggplot(norm1, aes(x=carat, <br/>                  y=depth, <br/>                  z=price))+<br/>  geom_hex(bins=60) + coord_fixed() +<br/>  scale_fill_viridis(option="magma") + theme_bw()</span><span id="524e" class="lr ls in ln b gy lx lu l lv lw">g3&lt;-ggplot(norm1, aes(x=carat, <br/>                  y=depth, <br/>                  z=price))+<br/>  geom_hex(bins=60) + coord_fixed() + facet_grid(~color)+<br/>  scale_fill_viridis(option="magma") + theme_bw()<br/>grid.arrange(g1,g2,g3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ms"><img src="../Images/24c28c333073b4a3e5b0b3293e4a9d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ldn_yzexMoay6jOgFnKGUg.png"/></div></div></figure><p id="cdf0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，是时候离开图形，开始构建模型了。图表对于检查数据集中是否存在已知的生物相关性，以及寻找未知因素非常重要。有了模型，您甚至可以指定您想要如何测试关系。</p><p id="2f1e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面你看到一个<a class="ae lh" href="https://medium.com/@marc.jacobs012/introduction-to-mixed-models-in-r-9c017fd83a63" rel="noopener">混合模型</a>，使用lme4包。我包括了<a class="ae lh" href="https://medium.com/@marc.jacobs012/analysis-of-bodyweight-in-grower-finisher-pigs-using-mixed-models-splines-and-bootstrapping-in-r-4a997a04f77d" rel="noopener">样条</a>，以及双向和三向交互。模型很重，可能太重了，我们需要检查一下。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="0c19" class="lr ls in ln b gy lt lu l lv lw">m1&lt;-lme4::lmer(price~ns(depth,3) + <br/>                     ns(table,3) + <br/>                     ns(carat,3) + <br/>                     ns(carat,3):ns(depth,3):ns(table,3) +<br/>                 ns(depth,3):cut+<br/>                 ns(table,3):cut+<br/>                 ns(carat,3):cut+<br/>              (1|color) + <br/>              (1|clarity),<br/>            data=norm1)<br/>summ(m1)<br/>tab_model(m1)<br/>plot_model(m1, show.values = TRUE, value.offset = .3, type = "std")+theme_bw()<br/>g1&lt;-plot_model(m1, type = "pred", terms="depth [all]") +theme_bw()<br/>g2&lt;-plot_model(m1, type = "pred", terms="table [all]") +theme_bw()<br/>g3&lt;-plot_model(m1, type = "pred", terms="carat [all]") +theme_bw()<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mt"><img src="../Images/4ccb6b02c036f68e2710e15f660869e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iohiJkQUBU2ITLuqs8CyRg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">你可以在这里看到模型的主要效果。样条似乎有优点，但正如我们将在后面看到的，模型过于拟合。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="dcde" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-plot_model(m1, type = "pred", terms=c("depth [all]", "cut")) +theme_bw()<br/>g2&lt;-plot_model(m1, type = "pred", terms=c("table [all]", "cut")) +theme_bw()<br/>g3&lt;-plot_model(m1, type = "pred", terms=c("carat [all]", "cut")) +theme_bw()<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi my"><img src="../Images/946f665f8cb311003e0caa12be9c2d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZkJoCfm-nbVIXNRdHf74w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">这里你可以看到溢出。图中的置信区间突出显示了实际数据所在的位置。在某个地方，这个模型超越了它的舒适区。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="33ac" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-interact_plot(m1, pred = depth, modx = cut, plot.points = TRUE)<br/>g2&lt;-interact_plot(m1, pred = table, modx = cut, plot.points = TRUE)<br/>g3&lt;-interact_plot(m1, pred = carat, modx = cut, plot.points = TRUE)<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mz"><img src="../Images/0961313d5e5fa89e32088e18c5baf8cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-kkTmy35SSzpm7SrBuP9A.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">我在前面两张图下面说的，终于在这里显示出来了。样条超出了它们的舒适区，尽管前面的图/图确实暗示了条件概率，但这里的模型拟合得太多了。你总是需要检查你所做的是有意义的，是可辩护的。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="f25a" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-interact_plot(m1, pred = depth, modx = carat, plot.points = TRUE)<br/>g2&lt;-interact_plot(m1, pred = depth, modx = table, plot.points = TRUE)<br/>g3&lt;-interact_plot(m1, pred = table, modx = carat, plot.points = TRUE)<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi na"><img src="../Images/cf762d7f8eef949d47fa206c710dfc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fqrQ6cCubZiNQHISxt_3sw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">相同的故事</figcaption></figure><p id="2081" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，引入样条函数可能不是一个好主意。通常，我会尽可能地使用样条函数，因为它们不会像多项式那样过度拟合(或者至少会超出它们的舒适区)，而且它们很好地消除了方差。但这次不是，所以我将回到线性，但仍然包括双向和三向交互。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="57c9" class="lr ls in ln b gy lt lu l lv lw">m2&lt;-lme4::lmer(price~depth + <br/>                 table + <br/>                 carat +<br/>                 depth:table+<br/>                 depth:carat:<br/>                 table:carat+<br/>                 carat:depth:table +<br/>                 depth:cut+<br/>                 table:cut+<br/>                 carat:cut+<br/>                 (1|color) + <br/>                 (1|clarity),<br/>               data=norm1)<br/>g1&lt;-plot_model(m2, type = "pred", terms="depth") +theme_bw()<br/>g2&lt;-plot_model(m2, type = "pred", terms=c("depth", "cut")) +theme_bw()<br/>g3&lt;-interact_plot(m2, pred = depth, modx = cut,interval = TRUE,<br/>              int.width = 0.8)<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nb"><img src="../Images/f417f109d5e6a8e3550fd5a93bcea1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bw57LwN6PoDJlKGnBd4v5g.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">即使在线性模型中，某些东西也一直出错。边际模型不够，在<strong class="bd nc">深度</strong>和<strong class="bd nc">价格</strong>依赖<strong class="bd nc">切</strong>之间有明确的条件关系，但并不是五个等级中的每一个加起来都是等幂的。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="ae2f" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-plot_model(m2, type = "pred", terms="table") +theme_bw()<br/>g2&lt;-plot_model(m2, type = "pred", terms=c("table", "cut")) +theme_bw()<br/>g3&lt;-interact_plot(m2, pred = table, modx = cut,interval = TRUE,<br/>              int.width = 0.8)<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nd"><img src="../Images/ed4de891fce8414a32b068a806245cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJUrHyFbdD4ve09SrZfm7w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd nc">工作台</strong>和<strong class="bd nc">切刀</strong>之间的交互效果清晰。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="41aa" class="lr ls in ln b gy lt lu l lv lw">g1&lt;-plot_model(m2, type = "pred", terms="carat") +theme_bw()<br/>g2&lt;-plot_model(m2, type = "pred", terms=c("carat", "cut")) +theme_bw()<br/>g3&lt;-interact_plot(m2, pred = carat, modx = cut, interval = TRUE,<br/>              int.width = 0.8)<br/>grid.arrange(g1,g2,g3,ncol=3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ne"><img src="../Images/7eb6150dda80293372d324473ca423df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-bIVuGRB5fUiA3eZNpdEA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd nc">克拉</strong>和<strong class="bd nc">切工</strong>之间的交互效果最强。</figcaption></figure><p id="467d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们更深入地看看这些交互。<a class="ae lh" href="https://www.rdocumentation.org/packages/interactions/versions/1.1.5" rel="noopener ugc nofollow" target="_blank">交互包</a>有很好的工具来可视化交互的存在，无论是图形化的还是通过测试过程。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="e845" class="lr ls in ln b gy lt lu l lv lw">ss &lt;- interactions::sim_slopes(m2, pred = depth, modx = table)<br/>plot(ss)<br/>as_huxtable(ss)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/91403be0e0a14e4b7ea8b7204da032d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*wTf_LHVM1JQhnwqRfAbo1Q.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">深度和表格的交互效果清晰。</figcaption></figure><p id="da3d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">展示互动效应的一个很好的方法是展开<a class="ae lh" href="https://interactions.jacob-long.com/reference/johnson_neyman.html" rel="noopener ugc nofollow" target="_blank">约翰逊-内曼图</a>。下面你会发现两种方法，给你同样的结果。记住，我使用的是标准化数据。Johnson-Neyman图有助于理解在多元线性回归中，简单斜率在相互作用的环境中的重要性。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="c893" class="lr ls in ln b gy lt lu l lv lw">sim_slopes(m2, pred = depth, modx = table,jnplot = TRUE)</span><span id="5240" class="lr ls in ln b gy lx lu l lv lw">johnson_neyman(m2, pred = depth, modx = table, alpha = .05, control.fdr = TRUE)</span><span id="48d6" class="lr ls in ln b gy lx lu l lv lw">JOHNSON-NEYMAN INTERVAL</span><span id="3e53" class="lr ls in ln b gy lx lu l lv lw">When table is OUTSIDE the interval [3.88, 7.80], the slope of<br/>depth is p &lt; .05.</span><span id="442a" class="lr ls in ln b gy lx lu l lv lw">Note: The range of observed values of table is [-6.47, 16.80]</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ng"><img src="../Images/65532d0756d662df8219210ccf127115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWLzmGMq9OZXAOAXSzqP9w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">正如你所看到的，深度T1和T2价格T3之间的相互作用并不总是对调节变量T4表T5的每一个级别都有意义。所以，我所关注的是预测变量<strong class="bd nc">深度</strong>，对<strong class="bd nc">价格</strong>的影响，以及调节变量<strong class="bd nc">表</strong>对预测和结果之间关系的影响。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="d5e0" class="lr ls in ln b gy lt lu l lv lw">m3&lt;-lme4::lmer(price~depth + <br/>                 table + <br/>                 carat +<br/>                 depth:table+<br/>                 depth:carat:<br/>                 table:carat+<br/>                 depth:cut+<br/>                 table:cut+<br/>                 carat:cut+<br/>                 carat:depth:table +<br/>                 carat:depth:cut+<br/>                 (1|color) + <br/>                 (1|clarity),<br/>               data=norm1)<br/>interact_plot(m3, <br/>              pred = depth, <br/>              modx = table, <br/>              mod2 = carat)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nh"><img src="../Images/90dff28dc6e9e437d9c42ae10b8665ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2g2Myq_ow0yevvlVYBV7uQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">在这里，你再次看到一个图表，显示了深度对价格的影响，通过表格调节。上面的Johnson-Neyman图可能看起来更直观，但需要将两个图结合起来，以获得关于三个变量相互影响的感觉。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="4b71" class="lr ls in ln b gy lt lu l lv lw">sim_slopes(m3, pred = depth, <br/>           modx = table, <br/>           mod2 = carat,<br/>           jnplot = TRUE)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ni"><img src="../Images/165e2cfcee7f5c3e46fe2d1ea90ce3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AXkMfKgghvZO_Eus79qjQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">清楚地看到<strong class="bd nc">表</strong>对<strong class="bd nc">价格</strong>的影响取决于<strong class="bd nc">克拉</strong>。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="d9ce" class="lr ls in ln b gy lt lu l lv lw">interact_plot(m3, <br/>              pred = depth, <br/>              modx = carat, <br/>              mod2 = cut)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nj"><img src="../Images/dbc274675f80522bf4c8f797e58cf4ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I_qAdIJP4IrRbe0BTHjskw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">而且这里看起来好像是<strong class="bd nc">深度</strong>对<strong class="bd nc">价格</strong>的影响取决于<strong class="bd nc">切割</strong>，但肯定不是在<strong class="bd nc">切割</strong>的每一个层次上。事实上，这是一个很难把握的互动。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="f88f" class="lr ls in ln b gy lt lu l lv lw">ss3 &lt;- sim_slopes(m3, pred = depth, <br/>                  modx = table, <br/>                  mod2 = carat)<br/>plot(ss3)</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ms"><img src="../Images/a054afc78b60912bce617944deef102b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkEoHHJVSmThOXjV6uZLlg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">另一幅图显示了<strong class="bd nc">深度</strong>和<strong class="bd nc">价格</strong>通过<strong class="bd nc">切割</strong>的反向相互作用。</figcaption></figure><p id="0292" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我必须承认，我不喜欢让我的第一个样条模型超出它的舒适区。所以，我想再试一次，展示一下一般加性车型的美。混合模式版本会更好，但我会留给你。现在，让我们看看如何使用样条和张量积对交互进行建模。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="60a5" class="lr ls in ln b gy lt lu l lv lw">m4 &lt;- gam(price ~ s(table, by=cut), data = norm1)<br/>gam.check(m4)<br/>m4_p&lt;-tidymv::predict_gam(m4)<br/>m4_p%&gt;%ggplot(., aes(table, fit)) + geom_smooth_ci(cut)+theme_bw()</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ms"><img src="../Images/6b737ecfca41eb580a520320810ab89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4Ym6Qnt0UfoqaDMqQ-XKw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">不是最好的互动图。我们已经看到了<strong class="bd nc">切割</strong>的调制效果在每一关都不一样，有时会很混乱。</figcaption></figure><p id="86fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们试试别的，建立一个相互作用张量(<em class="mp"> ti </em>)。然后，我想把它的预测形象化。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="f987" class="lr ls in ln b gy lt lu l lv lw">m5 &lt;- gam(price ~ s(table) + s(depth) + ti(table, depth) + color, data = norm1)<br/>m5_p&lt;-tidymv::predict_gam(m5)</span><span id="e4b9" class="lr ls in ln b gy lx lu l lv lw">m5_p%&gt;%ggplot(aes(table, depth, z = fit)) +<br/>  geom_raster(aes(fill = fit)) +<br/>  geom_contour(colour = "white") +<br/>  scale_fill_viridis(option="magma") +<br/>  theme_minimal() +<br/>  theme(legend.position = "top")</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ms"><img src="../Images/0d3ddda51736e4c84894c15a6fadd814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qy-irPj7KrFclNs6QqAzDg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">似乎发生了什么事。</figcaption></figure><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="7e7d" class="lr ls in ln b gy lt lu l lv lw">m5_p%&gt;%ggplot(aes(table, depth, z = fit)) +<br/>  geom_raster(aes(fill = fit)) +<br/>  geom_contour(colour = "white") +<br/>  facet_grid(~color)+<br/>  scale_fill_viridis(option="magma") +<br/>  theme_minimal() +<br/>  theme(legend.position = "top")</span></pre><figure class="li lj lk ll gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nk"><img src="../Images/e276ac781fe81202741599774d01adb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nptJI6mUOK7QZj70w2M72w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">但不是为了颜色。也许，因为我只把颜色作为一种主要效果，而不是一种互动。</figcaption></figure><p id="afa7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，我希望这篇文章对展示如何可视化和建模条件关系有所帮助。请记住，没有生物学上的关系是真正边缘的——总有第二、第三、第五或第六个预测者潜伏着，他们会把以前发现的关系颠倒过来！</p></div></div>    
</body>
</html>