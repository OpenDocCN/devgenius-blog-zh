<html>
<head>
<title>How To Make HTTP Requests With URLSession in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Swift 中使用 URLSession 进行 HTTP 请求</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-make-http-requests-with-urlsession-in-swift-4dced0287d40?source=collection_archive---------0-----------------------#2019-10-30">https://blog.devgenius.io/how-to-make-http-requests-with-urlsession-in-swift-4dced0287d40?source=collection_archive---------0-----------------------#2019-10-30</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="4a33" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">不使用第三方库进行 HTTP 请求的更快方法</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/27bc3dc2984f30fef45f2efed6219d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dm081VcbFnbl4J9O"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">谢尔盖·佐尔金在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="ada4" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">介绍</h1><p id="dfb7" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">如今，应用程序不断地从网络上下载数据。当您使用应用程序进行搜索时，会调用一个端点。结果数据被下载，放入一个对象中，然后在几毫秒内显示给你。</p><p id="5a1a" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">为了发出 HTTP 网络请求，开发人员通常倾向于添加第三方项目，如<a class="ae kw" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"> Alamofire </a>。但是通常这个库的功能比需要的多，占用了很多无用的空间。</p><p id="d362" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">在本文中，我们将讨论如何使用<code class="fe mq mr ms mt b">URLSession</code>发出 HTTP 请求并将 JSON 结果序列化为一个对象。</p></div><div class="ab cl mu mv hv mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ik il im in io"><h1 id="5e8c" class="kx ky ir bd kz la nb lc ld le nc lg lh jx nd jy lj ka ne kb ll kd nf ke ln lo bi translated">入门指南</h1><p id="60f5" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">首先，打开<a class="ae kw" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode，</a>创建一个新项目。选择单视图应用程序。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ng"><img src="../Images/b09eba9fbe2240c7412ecf15710a69d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfsxatHosidlWBKmIqRFAA.png"/></div></div></figure><p id="bc02" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">现在，在屏幕中央创建一个按钮，点击它将调用我们的 API 方法。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nh"><img src="../Images/e9ef35fe224dcc2667580383efac1ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9_hO7qsg8f8XG8K_AvKJA.png"/></div></div></figure></div><div class="ab cl mu mv hv mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ik il im in io"><h1 id="c5cd" class="kx ky ir bd kz la nb lc ld le nc lg lh jx nd jy lj ka ne kb ll kd nf ke ln lo bi translated">履行</h1><p id="9938" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">首先，我们需要发出 HTTP 请求。对于这个例子，我将使用来自<a class="ae kw" href="https://jsonplaceholder.typicode.com" rel="noopener ugc nofollow" target="_blank"> jsonplaceholder 的一个端点，</a>一个伪在线 REST API，用于测试和原型开发，每个月有超过 3.5 亿个请求！</p><p id="b535" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这个端点将返回一个包含<code class="fe mq mr ms mt b">userId</code>、<code class="fe mq mr ms mt b">postId</code>、<code class="fe mq mr ms mt b">title</code>和<code class="fe mq mr ms mt b">body</code>的帖子列表。</p><pre class="kh ki kj kk gu ni mt nj nk aw nl bi"><span id="2fdf" class="nm ky ir mt b gz nn no l np nq">let session = URLSession.shared<br/>let url = URL(string: "https://jsonplaceholder.typicode.com/posts")!</span></pre><p id="9b60" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">然后，我们将创建一个调用<a class="ae kw" href="https://developer.apple.com/documentation/foundation/urlsession/1407613-datatask" rel="noopener ugc nofollow" target="_blank"> URLSession.dataTask </a>方法的<code class="fe mq mr ms mt b">dataTask</code>。这将创建一个任务，从 URL 集中检索内容，并在请求完成时调用一个处理程序:</p><pre class="kh ki kj kk gu ni mt nj nk aw nl bi"><span id="5e26" class="nm ky ir mt b gz nn no l np nq">let task = session.dataTask(with: url, completionHandler: { data, response, error in<br/>    // Check the response            <br/>            print(error)             <br/>            print(response)                                              <br/>    })<br/>    task.resume()</span></pre><p id="de24" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated"><strong class="lr is">注意:</strong>不要忘记在最后调用<code class="fe mq mr ms mt b">task.resume()</code>，否则请求不会被执行。</p><p id="fc3f" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如果您现在运行代码，您将在控制台中看到 HTTP 响应，如下所示:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nr"><img src="../Images/e4b50e2cf47f769c82cb622d928c0730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DDHhGdVera2ulWd1XUJnw.png"/></div></div></figure><p id="a454" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">你可能在问我们的数据在哪里，对吗？简单来说:在<code class="fe mq mr ms mt b">dataTask</code>方法返回的<code class="fe mq mr ms mt b">data</code>参数中。如果我们尝试打印它，我们将看到 JSON 作为字符串返回——但是我们需要在一个自定义对象中使用它。我们如何做到这一点？</p><p id="4756" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">我们可以使用<code class="fe mq mr ms mt b">userId</code>、<code class="fe mq mr ms mt b">id</code>、<code class="fe mq mr ms mt b">title</code>和<code class="fe mq mr ms mt b">body</code>作为属性手动创建我们的类，或者使用<a class="ae kw" href="https://app.quicktype.io" rel="noopener ugc nofollow" target="_blank"> quicktype.io </a>以更快的方式创建。</p><pre class="kh ki kj kk gu ni mt nj nk aw nl bi"><span id="38aa" class="nm ky ir mt b gz nn no l np nq">import Foundation<br/><br/>class Post: Codable {<br/>    let userID, id: Int<br/>    let title, body: String<br/><br/>    enum CodingKeys: String, CodingKey {<br/>        case userID = "userId"<br/>        case id, title, body<br/>    }<br/><br/>    init(userID: Int, id: Int, title: String, body: String) {<br/>        self.userID = userID<br/>        self.id = id<br/>        self.title = title<br/>        self.body = body<br/>    }<br/>}</span></pre><p id="5da6" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">然后返回到您的<code class="fe mq mr ms mt b">ViewController</code>文件中，将前面的代码改为如下:</p><pre class="kh ki kj kk gu ni mt nj nk aw nl bi"><span id="a122" class="nm ky ir mt b gz nn no l np nq">let session = URLSession.shared<br/>        let url = URL(string: "https://jsonplaceholder.typicode.com/posts")!<br/>        let task = session.dataTask(with: url, completionHandler: { data, response, error in<br/>            // Check the response<br/>            print(response)<br/>            <br/>            // Check if an error occured<br/>            if error != nil {<br/>                // HERE you can manage the error<br/>                print(error)<br/>                return<br/>            }<br/>            <br/>            // Serialize the data into an object<br/>            do {                <br/>                let json = try JSONDecoder().decode([Post].self, from: data! )<br/>                    //try JSONSerialization.jsonObject(with: data!, options: [])<br/>                print(json)<br/>            } catch {<br/>                print("Error during JSON serialization: \(error.localizedDescription)")<br/>            }<br/>            <br/>        })<br/>        task.resume()</span></pre></div><div class="ab cl mu mv hv mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ik il im in io"><h1 id="123e" class="kx ky ir bd kz la nb lc ld le nc lg lh jx nd jy lj ka ne kb ll kd nf ke ln lo bi translated">是时候测试一下了</h1><p id="991b" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">我们终于准备好启动我们的应用程序，并尝试进行 API 调用。</p><p id="def6" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">由于我们的应用程序还没有一个真正的接口，我将在我们将 JSON 解码成我们的对象的地方放一个断点。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nh"><img src="../Images/7a873bfbd0f7727902aa93cb81f89c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMT5j88Uu3e4Ub-OuOIPpA.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">带有数据的对象</figcaption></figure><p id="6286" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如果我们在 variables 视图上添加我们的对象，我们将看到它包含我们从端点正确获得的所有数据。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj ns"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><p id="2809" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated"><strong class="lr is">这里</strong>  <strong class="lr is">可以找到完整的代码</strong> <a class="ae kw" href="https://github.com/domeniconicoli/UIActivityViewControllerExample/tree/master" rel="noopener ugc nofollow" target="_blank"> <strong class="lr is">。</strong></a></p></div></div>    
</body>
</html>