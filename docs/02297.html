<html>
<head>
<title>Build Automation for Absolute Beginners (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为绝对初学者构建自动化(第 2 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/build-automation-for-absolute-beginners-part-2-244551a4168a?source=collection_archive---------11-----------------------#2020-07-27">https://blog.devgenius.io/build-automation-for-absolute-beginners-part-2-244551a4168a?source=collection_archive---------11-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9835" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一键构建、测试和部署应用程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b43820fd5c1ddcb79b1371f4018fb914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TsYl0-7oFgALg_8Vri1Uhg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图片由来自<a class="ae kv" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4287422" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kv" href="https://pixabay.com/users/12831137-12831137/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4287422" rel="noopener ugc nofollow" target="_blank"> wichan yodsawai </a>提供</figcaption></figure><p id="36c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的绝对初学者系列的最后一篇，但它将分为四个部分；设置、构建、测试和部署。我们从构建一个简单的应用程序开始，将其容器化，现在我们将自动执行从推动代码更改到应用程序在完成状态可用之间的所有过程。在上一篇文章中，我们在运行于您的笔记本电脑上的 Kubernetes 实例中设置了 Jenkins。在本文中，我们将重新构建一个容器，然后自动化这一步。在随后的文章中，我们将着眼于测试，我们将更深入地了解部署某些东西意味着什么。</p><p id="9d53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了从本文中获得最大收益，您应该已经阅读了之前的所有文章，从<a class="ae kv" href="https://medium.com/dev-genius/application-programming-for-absolute-beginners-bf2a035efdf6" rel="noopener">面向绝对初学者的应用程序编程</a>，到<a class="ae kv" href="https://medium.com/dev-genius/build-automation-for-absolute-beginners-part-1-73ecf15ebd72" rel="noopener">面向绝对初学者的构建自动化(第 1 部分)</a>(参见本文底部的完整列表)。</p><p id="4b8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我说这是针对绝对初学者的时候，那并不是指任何人。但并不需要大家在谈论软件开发时总会想到的技巧。你不需要高水平的数学技能、抽象逻辑或夏洛克·福尔摩斯级别的推理能力(尽管你仍然可以抽烟斗，戴顶滑稽的帽子)。你最需要的是一个像样的记忆(这么…多…命令)，坚持，和耐心。在大多数情况下，坚持和耐心至少和解决问题的技巧一样重要。正如托马斯·爱迪生所说:“我们最大的弱点在于放弃。成功最可靠的方法就是再试一次。”</p><p id="de58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个系列的另一个独特之处是，唯一的硬件要求是一台 Mac 笔记本电脑。我选择 Mac 是因为我使用 Mac，所以我能更好地给出安装和运行这个项目所需的应用程序的更精确的说明。此外，根据我的经验，在专业环境中，大多数人使用 MAC 作为开发的标准平台。你也许可以使用 Windows 笔记本电脑，但你可能需要对它进行不同的设置。</p><p id="d31d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本系列的目标之一是只安装最少的软件就能让您正常运行。到目前为止，我们安装了 GitHub 桌面、Atom 编辑器、Brew 包管理器、Node.js JavaScript 语言、Docker 桌面和 Helm。其他一切都是作为容器运行的，因此很容易移除。如果你决定编程适合你，你可能想尝试不同的语言，如 Go、Python 或 Java。我们安装的软件可以很好地与每一种语言兼容，尽管如果你想专注于一种语言，一个针对这种语言的编辑器会很有帮助。</p><p id="cd64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始之前还有最后一件事。我们将在我们的笔记本电脑上运行构建自动化，但只有这样我们才能获得使用工具的实践经验，而不需要我们自己的 IT 部门或云服务器的费用。在正常的工作场所中，构建自动化将在本地或云中运行的服务器上执行。构建自动化是协作过程的一部分，团队使用它来确保每个人的变更都在一起工作。因此，它们不属于任何一个人的笔记本电脑。但是对于实践和构建自动化的实验来说，在你的笔记本电脑上运行所有的东西是完美的沙箱，因为它不会影响其他人。</p><p id="cbfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们要解决的第一件事是构建能够运行的软件。虽然 JavaScript 如其名，是一种脚本语言，不需要编译，但我们仍然希望创建一个图像。在以前的文章中，我们已经用几个 shell 脚本实现了这一点。现在我们将在上一篇文章<a class="ae kv" href="https://medium.com/dev-genius/build-automation-for-absolute-beginners-part-1-73ecf15ebd72" rel="noopener">为绝对初学者构建自动化(第 1 部分)</a>中设置的 Jenkins 实例中构建它。只有一个问题，而且是一个偷偷摸摸的问题。我们使用 Docker 命令来构建映像，Docker 在我们运行 Jenkins 构建器的 Kubernetes 中运行得不好。这是该行业目前面临的一个现实问题，有一些解决方案。</p><p id="dee6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了解决这个问题，我们将使用一个叫做<a class="ae kv" href="https://github.com/GoogleContainerTools/kaniko" rel="noopener ugc nofollow" target="_blank"> Kaniko </a>的应用程序。Kaniko 可以在不使用 Docker 的情况下构建映像，因此它可以在容器内部运行。要在 Jenkins 内部运行它，我们需要一个带有 Kaniko 图像的 Kubernetes pod，我们还需要正确执行它的步骤。我们可以在 Jenkins 配置中添加 Kaniko pod，但是这样它就不会在版本控制中，如果我们想要重建 Jenkins 实例，这将是另一件需要记住的事情。幸运的是，Jenkins 可以访问我们构建可用的所有文件，所以我们只需要将它添加到我们的源代码树中。我再次提醒不要在应用程序存储库中存储与构建相关的组件，但是为了简单起见，我们将在这里这样做。</p><p id="dd39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您已经阅读了本系列，那么您的笔记本电脑上应该已经有了存储库<a class="ae kv" href="https://github.com/rkamradt/myfirstrepository/tree/v0.1" rel="noopener ugc nofollow" target="_blank"> myfirstrepository </a>，您可以使用 Atom 将它添加为项目目录。请注意，我上面给出的链接是针对在我们将要进行的任何更改之前标记的版本的(您会在文章的底部找到标记有我们将要进行的所有更改的存储库链接)。你的窗口应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/ecac8c134da31591b4c0655bc2c3631c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8B2BgvwNtBQgc5MxTEmFA.png"/></div></div></figure><p id="31c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">右键点击<code class="fe lt lu lv lw b">myfirstrepository</code>，添加一个名为<code class="fe lt lu lv lw b">kaniko-pod.yaml</code>的文件。然后可以添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="9c2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以在上一篇文章中创建的<code class="fe lt lu lv lw b">Jenkinsfile</code>中利用它。</p><p id="4d10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是首先，请注意体积字段。那些是什么？因为我们正在推送到 DockerHub，所以我们需要默认存储在<code class="fe lt lu lv lw b">~/.docker/config.yaml</code>文件中的凭证。我们需要将该文件添加到 Kubernetes 容器中，以便 Kaniko 拥有推送 DockerHub 所需的凭证。Kubernetes 容器被很好地隔离，不能访问其他容器或主机。</p><p id="9559" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了将它添加到 Kubernetes，我们将创建一个“ConfigMap ”,这是一个 Kubernetes 实体，旨在提供跨 pod 的通用配置。在许多情况下，配置映射是作为一组环境变量来访问的。但是，您也可以将它作为“卷”来“挂载”,它看起来只是容器文件系统中的一个文件。我们将用适当的 DockerHub 凭证创建一个<code class="fe lt lu lv lw b">config.json</code>文件。用以下内容创建一个名为<code class="fe lt lu lv lw b">create-configmap.yaml</code>的文件:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="221e" class="md me iq lw b gy mf mg l mh mi">export CREDS=`echo -n "${DOCKERHUB_USER}:${DOCKERHUB_PASSWORD}" \<br/>     | base64`<br/>echo credentials = $CREDS</span><span id="45da" class="md me iq lw b gy mj mg l mh mi">cat &lt;&lt;EOF | kubectl apply -f -<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: docker-config<br/>data:<br/>  config.json: "\<br/>  {\"auths\": \<br/>    {\"<a class="ae kv" href="https://index.docker.io/v1/\" rel="noopener ugc nofollow" target="_blank">https://index.docker.io/v1/\</a>": \<br/>      {\"auth\": \"$CREDS\"\<br/>    }\<br/>  }\<br/>}"<br/>EOF</span></pre><p id="2ee0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个脚本是创建 Kubernetes 对象的一种有趣的内联方式，在本例中是一个 ConfigMap。控件来保存它。要运行它，首先，我们必须将环境变量<code class="fe lt lu lv lw b">DOCKERHUB_USER</code>和<code class="fe lt lu lv lw b">DOCKERHUB_PASSWORD</code>设置为您的 DockerHub 用户和密码。我们还必须使脚本可执行。以下是步骤:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="fe6e" class="md me iq lw b gy mf mg l mh mi">chmod +x create-configmap<br/>export DOCKERHUB_USER=&lt;your dockerhub username&gt;<br/>export DOCKERHUB_PASSWORD=&lt;your dockerhub password&gt;<br/>./create-configmap</span></pre><p id="2cab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">chmod</code>命令改变文件“模式”，在这种情况下，用<code class="fe lt lu lv lw b">+x</code>标志使其可运行。在脚本名<code class="fe lt lu lv lw b">create-configmap</code>前需要<code class="fe lt lu lv lw b">./</code>的原因是命令提示符不会在没有指定路径的情况下运行脚本。<code class="fe lt lu lv lw b">.</code>路径是当前目录的简写。</p><p id="9e9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以修改<code class="fe lt lu lv lw b">Jenkinsfile</code>的第一步，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="69f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以将更改提交并推回 GitHub，然后在我们的 Jenkins 实例中运行它。先用 Control-s 保存 Atom 中的文件。以下是提交和推送的命令:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="77cd" class="md me iq lw b gy mf mg l mh mi">git add .<br/>git commit -m "added build stage"<br/>git push</span></pre><p id="3679" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到我们在上一篇文章中创建的 Jenkins 实例(<a class="ae kv" href="http://jenkins:8080/job/myfirstrepository/" rel="noopener ugc nofollow" target="_blank">http://Jenkins:8080/job/myfirstrepository/</a>)，我们可以按‘Build Now’按钮来启动作业。完成后，您的屏幕应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/0cdd45f909f119a4f76c92be1749c105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1kbeRpuveaXupupwU94VA.png"/></div></div></figure><p id="94ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顶部的管道都是绿色的，所以这意味着它进行得很顺利。注意在我做对之前所有的红色(失败)尝试！如果第一次(或第 19 次)不顺利，不要放弃。这很好地提醒了我们，做一名软件开发人员需要耐心和毅力。</p><p id="2a59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的下一篇文章将是关于测试我们刚刚构建的应用程序。我们将构建一个非常简单的测试，并像构建应用程序本身一样构建它。然后我们可以使用 Kubernetes 在一个非常接近生产环境的环境中运行测试。</p><p id="c904" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢你一直支持我。让一切自动化并不容易，但是构建自动化最终会为您节省无数的时间，所以它几乎总是一个好的投资。软件开发不是一件容易的工作，但这就是为什么一旦你掌握了它，你将是高需求。</p><p id="d442" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文中使用的存储库:</p><div class="ml mm gp gr mn mo"><a href="https://github.com/rkamradt/myfirstrepository/tree/v0.2" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">rkamradt/myfirstrepository</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">我的第一个仓库。通过在 GitHub 上创建一个帐户，为 rkamradt/myfirstrepository 开发做出贡献。</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc kp mo"/></div></div></a></div><p id="5cbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提到的其他文章:</p><div class="ml mm gp gr mn mo"><a href="https://medium.com/dev-genius/application-programming-for-absolute-beginners-bf2a035efdf6" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">绝对初学者的应用程序设计</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">如何将您的普通 Mac 笔记本电脑变成一个疯狂的开发怪物</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="nd l mz na nb mx nc kp mo"/></div></div></a></div><div class="ml mm gp gr mn mo"><a href="https://medium.com/dev-genius/application-containers-for-absolute-beginners-253a61bb6e39" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">绝对初学者的应用程序容器</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">为真实世界准备您的应用程序</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="ne l mz na nb mx nc kp mo"/></div></div></a></div><div class="ml mm gp gr mn mo"><a href="https://medium.com/dev-genius/build-automation-for-absolute-beginners-part-1-73ecf15ebd72" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">为绝对初学者构建自动化(第 1 部分)</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">自动化应用程序构建、测试和部署</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="nf l mz na nb mx nc kp mo"/></div></div></a></div></div></div>    
</body>
</html>