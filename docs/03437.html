<html>
<head>
<title>Best of Modern JavaScript — Generators as Producers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华——作为生产者的生成器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/best-of-modern-javascript-generators-as-producers-139644005441?source=collection_archive---------5-----------------------#2020-11-03">https://blog.devgenius.io/best-of-modern-javascript-generators-as-producers-139644005441?source=collection_archive---------5-----------------------#2020-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f2de4bd501a45254b69457b8cafac0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fh3tk0Hj927kuw2u"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kc" href="https://unsplash.com/@kealearl2013?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kervin Edward Lara </a>拍摄的照片</figcaption></figure><p id="afe0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究JavaScript生成器。</p><h1 id="c008" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">作为迭代器的生成器</h1><p id="0416" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用生成器函数作为迭代器。</p><p id="6ad4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="de26" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="a35f" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();</span><span id="f3b1" class="mn lc iq mj b gy ms mp l mq mr">console.log(gen.next());<br/>console.log(gen.next());</span></pre><p id="002a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个生成器函数和一个生成器。</p><p id="5306" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">genFn</code>是用<code class="fe mt mu mv mj b">function*</code>关键字表示的发生器功能。</p><p id="f64a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该函数通过<code class="fe mt mu mv mj b">genFn</code>调用返回一个生成器。</p><p id="61d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">next</code>来获取列表中的下一项。</p><p id="b4bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">yield</code>关键字让我们通过<code class="fe mt mu mv mj b">next</code>方法调用返回值。</p><p id="099e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e51e" class="mn lc iq mj b gy mo mp l mq mr">{value: "foo", done: false}<br/>{value: "bar", done: false}</span></pre><p id="a821" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过<code class="fe mt mu mv mj b">value</code>属性获取产出的项目。</p><p id="4d37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用for-of循环访问生成的值。</p><p id="4ac9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eb77" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="0034" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();</span><span id="a188" class="mn lc iq mj b gy ms mp l mq mr">for (const x of gen) {<br/>  console.log(x);<br/>}</span></pre><p id="a0c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c570" class="mn lc iq mj b gy mo mp l mq mr">foo<br/>bar<br/>baz</span></pre><p id="a150" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录在案。</p><p id="d092" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">for-of循环可以访问生成器中的值。</p><p id="b1a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">spread运算符允许我们通过提取生成的值并将其放入数组来将生成器转换为数组:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f156" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="81ed" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();<br/>const arr = [...gen];</span></pre><p id="a58b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和析构也可以与生成器一起工作，方法是将生成的值指定为左侧变量的值:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3839" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  yield 'baz';<br/>}</span><span id="9637" class="mn lc iq mj b gy ms mp l mq mr">const [x, y] = genFn();</span></pre><p id="af22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe mt mu mv mj b">x</code>是<code class="fe mt mu mv mj b">'foo'</code>，<code class="fe mt mu mv mj b">y</code>是<code class="fe mt mu mv mj b">'bar'</code>。</p><h1 id="6258" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从发电机返回</h1><p id="a1d5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用生成器中的<code class="fe mt mu mv mj b">return</code>语句。</p><p id="3b8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cedb" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  return 'baz';<br/>}</span></pre><p id="cfa4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下代码来调用生成器:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a397" class="mn lc iq mj b gy mo mp l mq mr">const gen = genFn();<br/>console.log(gen.next());<br/>console.log(gen.next());<br/>console.log(gen.next());</span></pre><p id="78d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从控制台日志中，我们可以看到这些值是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="82a1" class="mn lc iq mj b gy mo mp l mq mr">{value: "foo", done: false}<br/>{value: "bar", done: false}<br/>{value: "baz", done: true}</span></pre><p id="e9f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">return</code>语句将<code class="fe mt mu mv mj b">done</code>设置为<code class="fe mt mu mv mj b">true</code>。</p><p id="b9c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，大多数其他使用iterable对象的const5ructurs忽略返回值。</p><p id="8b3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有for-of循环:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9eb1" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  return 'baz';<br/>}</span><span id="ea31" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();<br/>for (const x of gen) {<br/>  console.log(x);<br/>}</span></pre><p id="7b40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="303b" class="mn lc iq mj b gy mo mp l mq mr">foo<br/>bar</span></pre><p id="0134" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录在案。</p><p id="facc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有扩展操作符:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1eaf" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  yield 'foo';<br/>  yield 'bar';<br/>  return 'baz';<br/>}</span><span id="e0f2" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();<br/>const arr = [...gen];</span></pre><p id="06de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe mt mu mv mj b">arr</code>就是<code class="fe mt mu mv mj b">[“foo”, “bar”]</code>。</p><h1 id="0296" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从生成器引发异常</h1><p id="a12c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以从生成器中抛出异常。</p><p id="dc45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8c6e" class="mn lc iq mj b gy mo mp l mq mr">function* genFn() {<br/>  throw new Error('error');<br/>}</span><span id="d3c2" class="mn lc iq mj b gy ms mp l mq mr">const gen = genFn();<br/>console.log(gen.next())</span></pre><p id="ff49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个抛出错误的生成器函数。</p><p id="86d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们调用它，然后在返回的生成器上调用<code class="fe mt mu mv mj b">next</code>时，我们会看到控制台中记录的错误。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/f0b6f0478e8654e3e3163c0a79ff6237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sQCQk6nRgi6ESBfQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马丁·比约克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="6a24" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="9232" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在生成器函数中返回项目并抛出错误。</p><p id="a39f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们也能产生我们可以利用的价值。</p></div></div>    
</body>
</html>