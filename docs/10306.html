<html>
<head>
<title>PHP — P79: File Size Checks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P79:文件大小检查</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p79-file-size-checks-e419bc6483bf?source=collection_archive---------8-----------------------#2022-10-22">https://blog.devgenius.io/php-p79-file-size-checks-e419bc6483bf?source=collection_archive---------8-----------------------#2022-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3476a9ce1ae78b63502632c9976649d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OA-Do32CUpUTLo6JhkSBw.jpeg"/></div></div></figure><p id="77cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上传文件时，我们还需要进行一些检查。我们已经上传了一个文件，并限制用户上传所有文件类型，但仍有一些事情我们需要检查，如文件大小。我有目的地对这个主题采取一种更深入的方法，因为大多数人在看到完整的脚本运行时会感到不知所措，而从来没有看到它们的组成部分:单独的检查。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p78-checking-file-types-ffb2762d2d19"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P78:检查文件类型</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">我们在上一篇文章中看到了文件上传，并使用了最少的步骤来完成它。这一次…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="740e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">概述</h1><p id="2ae5" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们有一个基本的 HTML 表单和一个简单的流程脚本。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9d4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的文件上传脚本中，第一个检查是文件扩展名检查。通过后，文件将从其临时位置移动到最终位置。</p><h1 id="3f21" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">文件大小检查</h1><p id="50bd" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">接下来我们要做的是将文件大小限制在某个阈值以上。我们需要确保文件存储不会被不必要的大文件填满。</p><p id="7494" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何做到这一点？让我们看看我们的<code class="fe mx my mz na b">$_FILES</code>数组包含了哪些可能对我们有帮助的内容。</p><pre class="mr ms mt mu gt nb na nc nd aw ne bi"><span id="709b" class="nf lp iq na b gy ng nh l ni nj">var_dump($_FILES);</span><span id="87d2" class="nf lp iq na b gy nk nh l ni nj"><strong class="na ir">array</strong> <em class="nl">(size=1)</em><br/>  'file_name' =&gt; <br/>    <strong class="na ir">array</strong> <em class="nl">(size=5)</em><br/>      'name' =&gt; string '75-Get-vs-Post.jpg' <em class="nl">(length=18)</em><br/>      'type' =&gt; string 'image/jpeg' <em class="nl">(length=10)</em><br/>      'tmp_name' =&gt; string '/tmp/phpbRYmkz' <em class="nl">(length=14)</em><br/>      'error' =&gt; int 0<br/>      'size' =&gt; int 133821</span></pre><p id="502d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">显而易见。在我们的<code class="fe mx my mz na b">$_FILES['file_name']</code>数组中有一个<code class="fe mx my mz na b">size</code>键。要访问它，我们只需使用<code class="fe mx my mz na b">$_FILES['file_name']['size']</code>。它是以字节为单位的，所以我们需要用字节来限制它。</p><pre class="mr ms mt mu gt nb na nc nd aw ne bi"><span id="269b" class="nf lp iq na b gy ng nh l ni nj">1KB = 1024 bytes<br/>1MB = 1048576 bytes<br/>1GB = 1073741824 bytes<br/>1TB = 1099511627776 by<!-- -->tes</span></pre><p id="1e16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想将用户限制在 1MB，我们需要测试 1，048，576 字节。</p><p id="45b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">计算尺寸的简单技巧。1MB * 1024 * 1024 = 1048576 字节。所以你要限制 5MB，就做 5MB * 1024 * 1024 就行了。这就是我在我们的例子中列出它的方式。我想限制用户上传任何超过 1/2MB 的内容。</p><pre class="mr ms mt mu gt nb na nc nd aw ne bi"><span id="4c8c" class="nf lp iq na b gy ng nh l ni nj">$max_size_mb = 0.5;<br/>$max_size_bytes = $max_size_mb * 1024 * 1024;<br/><br/>if ( $_FILES["file_name"]["size"] &gt; $max_size_bytes )<br/>{<br/>    die("The file size is too large.);<br/>}</span></pre><p id="796a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整的脚本现在是这样的。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cc26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以看到每次都是这样。代码就是这样，一个缓慢的建立。在下一个脚本中，我们将处理一些最终的检查，然后我们将在第 81 篇文章中用一种更加面向对象的方法来看这个问题。下次见。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/dinocajic/php-youtube-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-dinocajic/PHP-YouTube-tutorials:PHP YouTube 教程的代码</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">PHP YouTube 教程的代码确保你已经安装了 Docker。克隆回购。运行以下命令…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="nm l lk ll lm li ln jw kz"/></div></div></a></div></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3d2ab350c561cf86cfd9e485ed3a5791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GtOPNPHhHpiFpVxv.jpeg"/></div></figure><p id="fa42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡伊奇目前是<a class="ae nv" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(生命周期生物科学公司)</a>、<a class="ae nv" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae nv" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae nv" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物</a>、<a class="ae nv" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae nv" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="df99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae nv" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae nv" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae nv" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="7f4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae nv" href="https://dinocajic.medium.com/membership" rel="noopener"> <em class="nl">阅读迪诺·卡吉克(以及媒体上成千上万其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。</em> </a></p></div></div>    
</body>
</html>