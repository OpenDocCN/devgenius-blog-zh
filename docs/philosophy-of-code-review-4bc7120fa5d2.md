# 代码审查的哲学

> 原文：<https://blog.devgenius.io/philosophy-of-code-review-4bc7120fa5d2?source=collection_archive---------14----------------------->

![](img/d84985fe7127b35a1334e406ecc724d5.png)

查尔斯·德鲁维奥在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 简介:

代码审查不仅在早期防止潜在的(未来的)错误，它还是在团队内部交流变更和分享经验的有效方式。没有比代码评审更能吸引工程师的方式了。

一个好的代码审查过程应该导致开放的开发环境，知识共享和团队极客指数的增加，以及更少的错误和回归。

# **概述:**

有效的代码审查将涵盖好代码的所有主要方面，即:

1.  一般(低级)—CS 概念、卫生、语言结构及其生态系统的有效使用
2.  设计——坚持设计原则和模式(特别是。当开发新模块时)和对现有设计的坚持(在增量开发的情况下)
3.  功能性——支持它的业务用例及测试用例的覆盖范围

# **评论的味道:**

*   一般评论
*   代码设计审查
*   功能审查

## *总评:*

团队中的任何人都可以进行常规检查。我鼓励更多的成员审查主要版本。

在这一级别，期望仅从实现技术的角度审查代码:

*   有效使用各种 CS 概念，如 DS/Algo、并发性、锁定等。审查算法并确保有足够的文档。寻找优化的机会。确保对应用程序的可能和不可能状态都有单元测试。
*   有效使用语言结构和最佳实践。大多数最佳实践都在一些流行书籍中进行了总结，如*有效的 Java、代码完整、实用程序员、实践中的 Java 并发性* *等*。
*   有效使用语言生态系统，如标准库(数据结构等)，单元测试框架等。我们应该鼓励尽可能多地重用经过实战检验的代码。
*   卫生，如风格指南、文档、类型安全、资源管理、对象构造、DI、验证等。

## 代码设计审查:

在这个阶段，评审者需要熟悉领域来证明设计选择的合理性。根据变更的性质，评审可以有不同的期望:

*   发布新产品时:确保代码符合实施前起草的设计文档(如果没有，鼓励被评审者提交一份)。在设计文档没有被评审或者没有设计文档的任何意外情况下，评审者需要评审合同以确保它们正确地对域建模。
*   当现有产品发生变更时:评审者必须确保变更符合产品的既定设计。并且变更遵守产品的约束或者统一地影响所有约束(而不是有条件地)

总的来说，审查必须确保:

*   干燥——不要重复自己——评审者需要确保逻辑和抽象的干燥，而不仅仅是代码。
*   单一责任原则(SRP)——功能是模块化的、简洁的，并且只处理一个问题
*   接口传达了明确的意图，没有无用的方法
    这里需要回顾一下关注点的分离。
*   专为并发环境设计—对象声明线程安全契约
*   OOPs 原则——状态的标识及其封装、对象的责任以及对象之间的通信协议
*   设计是可扩展的；一种流行方法是，如果有机会，确保使用正确的设计模式(例如:算法应该可以通过策略模式等插入)
*   可测试性——功能必须是单元可测试的。

请注意，这是一个指示性的清单，而不是详尽的清单。请随意根据您的经验从更多方面进行评估。可以参考书籍(在一般复习部分提到)

## **职能审查:**

这是复习最重要的一步。评审者必须熟悉产品，并对产品有所贡献，理解产品的特性和限制。除了专用回归套件之外，评审人员的熟悉程度为发现不可预见的情况提供了独特的机会。在这里，评审者需要确保没有因为变更而出现倒退。此外，审查者应该审查单元测试和集成测试，并确保它们在应用程序的所有可能状态(可能和不可能状态)下测试功能的行为

形式上，评审者需要确保

1.  领域建模是正确的(如果 LLD - CD/ERD 等没有被彻底审查)
2.  代码得到了充分的检测(业务和系统检测)
3.  抽象和类之间的关系已经清楚地展示出来了(并且很容易从代码中推导出来)
4.  安全方面，如
    >输入和输出验证
    >防御已知漏洞
    >边界检查(如数组 OOB)可能导致溢出以及 DoS
    >平台和库漏洞(应对已知问题进行基本审计)

# 总结:

在结尾注释中，超过 500 行的代码审查被搁置了(因为缺少足够的时间，在文件之间移动时丢失了上下文等等)。最好是被评审者和评审者同步进行代码演练，并一起评审代码。根据经验，这种情况应该尽可能少发生。

代码审查不是吹毛求疵。根据我的经验，评审者和被评审者在代码评审后都会受益。通过阅读别人的代码，我学到了很多。

代码审查不仅限于开发人员。QAs 做代码审查也有帮助。

自动化我们代码的大部分基本健全性(代码覆盖、静态代码分析、风格检查)的工具应该越来越多地集成到 CI 和检入管道中，以减少代码审查的不必要负担。

# 参考资料:

1.  总结:[http://blog . d3in . org/post/111338685456/maslows-pyramid-of-code-review](http://blog.d3in.org/post/111338685456/maslows-pyramid-of-code-review)