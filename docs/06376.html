<html>
<head>
<title>GitHub Container Registry: Publish A Postgres Docker Image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GitHub容器注册表:发布Postgres Docker图像</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/github-container-registry-publish-a-postgres-docker-image-c0bdfbd1cd21?source=collection_archive---------17-----------------------#2022-01-03">https://blog.devgenius.io/github-container-registry-publish-a-postgres-docker-image-c0bdfbd1cd21?source=collection_archive---------17-----------------------#2022-01-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1fc1b31702a9561ed6459d050876cd9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxse_DUL4N-i6IxEOakeVg.png"/></div></div></figure><h1 id="44f5" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">为什么是Postgres？</h1><p id="b581" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">Postgres提供以下服务:</p><ul class=""><li id="00dd" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">完全开源</li><li id="ec34" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">使用起来很便宜</li><li id="65bd" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">可靠的</li><li id="7f6e" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">安全的</li><li id="4e8d" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">可攀登的</li><li id="bdb6" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">用SQL、c和plgpsql编写函数和存储过程的选项</li></ul><p id="c201" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">为什么不是MySQL，Oracle，Sybase，SQL Server等？目标项目上的Postgres实现是一个更大的数据库架构的一部分，该架构包括MongoDB和DynamoDB的元素。公平地说，我使用了一个可以轻松扩展AWS的工具。</p><p id="c67e" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">互联网上有很多资源提供了关于Postgres与竞争对手的客观和一些(微小的)扭曲的观点。既然我们对加入赞成或反对的争论不感兴趣，我建议你挑选对手头的项目有用的。</p><p id="5c9e" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">就我而言，我追求可扩展性、成本和灵活性。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="73b6" class="jv jw in bd jx jy mr ka kb kc ms ke kf kg mt ki kj kk mu km kn ko mv kq kr ks bi translated"><strong class="ak">假设和前提</strong></h1><h2 id="f309" class="mw jw in bd jx mx my dn kb mz na dp kf le nb nc kj li nd ne kn lm nf ng kr nh bi translated"><strong class="ak">你已经安装了Docker桌面</strong></h2><p id="5bf3" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><a class="ae ni" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">https://www.docker.com/products/docker-desktop</a></p><h2 id="f1d6" class="mw jw in bd jx mx my dn kb mz na dp kf le nb nc kj li nd ne kn lm nf ng kr nh bi translated"><strong class="ak">您拥有Docker Hub账户(可选，但很酷)</strong></h2><p id="db17" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><a class="ae ni" href="https://hub.docker.com/signup" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/signup</a></p><p id="a6c4" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">还假设您已经从Docker Hub上的官方Postgres映像创建了一个容器，并对DB进行了一些修改。如果没有，请运行下面的命令开始:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="d368" class="mw jw in no b gy ns nt l nu nv">docker pull postgres</span></pre><p id="dde4" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">然后您可以继续运行映像，使用您选择的工具访问您导入的服务器(我推荐使用Eclipse的<a class="ae ni" href="https://dbeaver.io/" rel="noopener ugc nofollow" target="_blank"> DBeaver </a>插件或<a class="ae ni" href="https://www.jetbrains.com/datagrip/" rel="noopener ugc nofollow" target="_blank"> JetBrain的DataGrip </a>)。</p><p id="acda" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">创建您的数据库，添加一些表和一些函数或存储过程，我们就可以开始真正的交易了。但首先，让我们考虑几个基本问题。</p><p id="67c1" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated"><strong class="kv io">为什么要使用GitHub容器注册表？</strong></p><p id="7154" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">对于免费帐户，Docker Hub规定了一个私有存储库的限制。在拉取阈值、访问控制等方面还有其他限制。</p><p id="15d2" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">本教程将指导我们探索Github的容器注册表所提供的可能性(在本文中我们将称之为GCR)。</p><blockquote class="nw"><p id="4f1f" class="nx ny in bd nz oa ob oc od oe of lq dk translated"><em class="og">GitHub容器注册中心改进了我们在GitHub包中处理容器的方式。借助今天推出的新功能，您可以更好地实施访问策略，鼓励使用标准基础映像，并通过在整个组织内更轻松地共享来促进内部采购。— GitHub </em></p></blockquote><p id="b7a2" class="pw-post-body-paragraph kt ku in kv b kw oh ky kz la oi lc ld le oj lg lh li ok lk ll lm ol lo lp lq ig bi translated">GitHub容器注册表提供匿名访问，在撰写本文时，GCR是免费的，并提供无限的图像存储库。</p><p id="ce9b" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">在需要某种级别的隐私和访问控制的地方，GCR提供了限定范围的访问。</p><blockquote class="nw"><p id="87fa" class="nx ny in bd nz oa ob oc od oe of lq dk translated">为了更好地支持跨团队的协作，并帮助我们的客户强化他们发布的最佳实践，我们还在整个组织中引入了容器的数据共享和细粒度权限。</p><p id="d3d3" class="nx ny in bd nz oa ob oc od oe of lq dk translated"><em class="og">通过向组织发布容器图像，团队可以更容易、更安全地与团队中的其他开发人员共享它们。通过将包的权限与其源代码的权限分开，团队可以将发布限制在较小的用户范围内，或者实施其他发布策略。</em></p></blockquote><p id="3f06" class="pw-post-body-paragraph kt ku in kv b kw oh ky kz la oi lc ld le oj lg lh li ok lk ll lm ol lo lp lq ig bi translated">还有更多；使用GitHub Actions，您可以创建工作流来自动化GCR的发布过程。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><p id="6dfb" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">好了，现在我们准备好了。您的Docker桌面容器选项卡应该类似于以下内容:</p><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/4d39120f913d04b2aa260441a53c7090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*469Idgzyp3-iiMriDuj25A.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk translated">Docker桌面在我们从Docker Hub获取Postgres映像后</figcaption></figure><p id="ebd4" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">至此，我们已经有了Postgres Docker容器，并对其进行了一些DB更改。这是我们推进GCR进程的起点。</p><p id="cb06" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">但不要太快。让我们为即将发生的事情准备好我们的Github简介。首先，我们需要创建一个个人访问令牌(PAT)。</p><p id="777c" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated"><strong class="kv io">创建个人访问令牌</strong></p><p id="722b" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">PAT应为此目的定制创建，其范围权限应基于需要。</p><ol class=""><li id="882d" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq or lz ma mb bi translated">访问您的GitHub个人资料</li><li id="2110" class="lr ls in kv b kw mc la md le me li mf lm mg lq or lz ma mb bi translated">单击您的个人资料下方的下拉菜单中的设置</li></ol><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div class="gh gi os"><img src="../Images/924ce8eb6034a89a2dd30cc81c5eef24.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*Vg30MOyaxkqgsS-Duku9Fg.png"/></div></figure><ol class=""><li id="7fe3" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq or lz ma mb bi translated">点击开发者设置</li><li id="f24c" class="lr ls in kv b kw mc la md le me li mf lm mg lq or lz ma mb bi translated">选择个人访问令牌</li><li id="20a2" class="lr ls in kv b kw mc la md le me li mf lm mg lq or lz ma mb bi translated">单击生成新令牌</li><li id="4843" class="lr ls in kv b kw mc la md le me li mf lm mg lq or lz ma mb bi translated">添加一个用于识别此令牌的注释，设置有效期(最长1年)并选择相应的范围。GitHub推荐以下范围选择:</li></ol><blockquote class="nw"><p id="89f1" class="nx ny in bd nz oa ot ou ov ow ox lq dk translated"><em class="og">选择read:packages范围来下载容器图像并读取它们的元数据。</em></p><p id="1018" class="nx ny in bd nz oa ob oc od oe of lq dk translated"><em class="og">选择write:packages范围来下载和上传容器映像，并读取和写入它们的元数据。</em></p><p id="ef9a" class="nx ny in bd nz oa ob oc od oe of lq dk translated"><em class="og">选择删除:包范围以删除容器图像。</em></p></blockquote><p id="2f45" class="pw-post-body-paragraph kt ku in kv b kw oh ky kz la oi lc ld le oj lg lh li ok lk ll lm ol lo lp lq ig bi translated">完成上述步骤后，单击生成令牌。</p><p id="3e1f" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">记下新令牌，并将其保存在安全的地方。这个令牌从今以后再也不会在Github上显示了。如果丢失，您可能需要生成新的令牌。</p><p id="7365" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">现在让我们进入下一步，我们将存储和使用PAT。</p><p id="9097" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated"><strong class="kv io">将PAT存储在环境变量中</strong></p><p id="c4dc" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">现在已经创建了PAT，使用以下命令将其设置为环境变量。我们将这个变量命名为CR_PAT。我用的是PowerShell的Windows 11。</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="f565" class="mw jw in no b gy ns nt l nu nv">set “CR_PAT=YOUR_GENERATED_TOKEN”</span></pre><p id="8d2f" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">现在使用以下命令来确认环境变量:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="a65f" class="mw jw in no b gy ns nt l nu nv">dir env:CR_PAT</span></pre><p id="1667" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">您应该会得到类似如下的结果:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="3de0" class="mw jw in no b gy ns nt l nu nv">PS C:\Users\Okechukwu Agufuobi&gt; dir env:CR_PAT</span><span id="5b06" class="mw jw in no b gy oy nt l nu nv">Name Value<br/>----                           -----<br/><br/>CR_PAT                         YOUR_PERSONAL_ACCESS_TOKEN</span></pre><p id="4665" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated"><em class="oz">提示:使用dir env:将列出系统上的所有环境变量:-) </em></p><p id="55cd" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">在GIT Bash上运行这个</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="482d" class="mw jw in no b gy ns nt l nu nv">echo $CR_PAT | docker login ghcr.io -u sdg7onado — password-std<br/> ni</span></pre><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pa"><img src="../Images/b3b80cecf3becfe8d28754a36cecd194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yezx8d1fu5aZbVzv1cB2JQ.png"/></div></div></figure><p id="ebca" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">现在返回Powershell并运行下面的命令来列出我们所有的容器。</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="e253" class="mw jw in no b gy ns nt l nu nv">docker ps -a</span></pre><p id="aa8e" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">您应该会看到类似下面的结果</p><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/50e3ad89a5ed24190967246982d11c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*8IMGedow51HHq5828cmfVg.png"/></div></figure><p id="bbdd" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">现在，使用上一个窗口中的容器ID运行以下命令:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="eaab" class="mw jw in no b gy ns nt l nu nv">docker commit d8a37326cb35 custodian_postgres_env</span></pre><p id="cef4" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">这将我们的容器提交给一个新的图像。图像将在下一步发送到GCR。您应该会得到这样的结果:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="c15b" class="mw jw in no b gy ns nt l nu nv">sha256:8191303b0XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXe1c6fa</span></pre><p id="2fe2" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">运行以下命令查看所有Docker图像:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="3576" class="mw jw in no b gy ns nt l nu nv">docker images</span></pre><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pc"><img src="../Images/94dba0a764bdc22b66be7b69d17eeea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ES_zR3LFo9YNvKCLApVrjw.png"/></div></div></figure><p id="17ef" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">太棒了！现在，您已经准备好了一个Docker映像。</p><p id="6745" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">下一个命令标记图像，为我们的推送做准备:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="c1ff" class="mw jw in no b gy ns nt l nu nv">docker image tag custodian_postgres_env ghcr.io/sdg7onado/custodian_postgres_env:latest</span></pre><p id="a661" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">您可能希望再次运行docker images命令来查看图像的状态。</p><p id="9ab5" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">确认标签后，我们现在运行下面的命令。在此之前，请确保您有一个活跃和稳定的互联网连接。</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="7c28" class="mw jw in no b gy ns nt l nu nv">docker push ghcr.io/sdg7onado/custodian_postgres_env:latest</span></pre><p id="45de" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">push命令告诉Docker将映像推送到GCR。ghcr代表GitHub容器注册。sdg7onado是我的Github ID，最后一部分是图片名称和标签。</p><p id="857d" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">如果一切顺利，您应该会看到一个类似这样的窗口</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="cebf" class="mw jw in no b gy ns nt l nu nv">The push refers to repository [ghcr.io/sdg7onado/custodian_postgres_env<br/> 50f47d97acf5: Pushed<br/> 3e93c64fbb74: Pushed<br/> 1271062941c7: Pushed<br/> f763ae8cc88c: Pushed<br/> efba6dde34b9: Pushed<br/> 5d3ce28a718f: Pushed<br/> fc03e921344f: Pushed<br/> 5b21fbd19d68: Pushed<br/> ad809b5894e9: Pushed<br/> 76941029e9a9: Pushed<br/> 9f5f669ea81c: Pushed<br/> 295288988f3a: Pushed<br/> 8baa2c90b0ab: Pushed<br/> e1bbcf243d0e: Pushed<br/> latest: digest: sha256:161f61ffXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX74bd1b9a5 size: 3245]</span></pre><p id="0e3e" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">就是这样！</p><p id="808a" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">您已经将图像推送到Github的容器注册表中。如果您遵循这些步骤，您应该会看到类似这样的内容。在packages标签下，你会发现你全新的容器图像，准备好与我们地球人分享。</p><figure class="nj nk nl nm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pd"><img src="../Images/1a37b71b2ef378ba4fb19760507619c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4ptpJIoFdMd2wN_qzFrxA.png"/></div></div></figure><p id="afc6" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">随意探索如何让你的队友尝试拉你的形象。</p></div></div>    
</body>
</html>