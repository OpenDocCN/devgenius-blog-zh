<html>
<head>
<title>Let’s simplify the logic of data fetching in your React project with SWR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们用 SWR 简化 React 项目中的数据获取逻辑</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/lets-simplify-the-logic-of-data-fetching-in-your-react-project-with-swr-155c00dd54bf?source=collection_archive---------7-----------------------#2022-11-06">https://blog.devgenius.io/lets-simplify-the-logic-of-data-fetching-in-your-react-project-with-swr-155c00dd54bf?source=collection_archive---------7-----------------------#2022-11-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/79e458362f46493429676f978f9bb5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RJp2835GiQTHWAHg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">资料来源:vercel</figcaption></figure><p id="9bd5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi kx translated"><span class="l ky kz la bm lb lc ld le lf di">我们</span>知道 React 正在带来一个快速的用户界面，而无需做太多工作来专门优化性能。但是，仍然有一些方法可以让它变得更快。当我在谷歌代码之夏<a class="ae lg" href="https://youtu.be/ODHz5-kjR3U" rel="noopener ugc nofollow" target="_blank">项目</a>工作时，我从一位同事那里了解到了 SWR。如果你对我的 GSoC 项目感兴趣，可以参考这篇<a class="ae lg" href="https://anjulashanaka.medium.com/gsoc-2022-rebuild-openmrs-cohort-builder-final-evaluation-64b093b68a61" rel="noopener">文章</a>。在这篇文章中，让我们简要了解一下 SWR。</p><h2 id="bd8d" class="lh li in bd lj lk ll dn lm ln lo dp lp kk lq lr ls ko lt lu lv ks lw lx ly lz bi translated">什么是 SWR？</h2><blockquote class="ma mb mc"><p id="3020" class="jz ka md kb b kc kd ke kf kg kh ki kj me kl km kn mf kp kq kr mg kt ku kv kw ig bi translated">“SWR”这个名字来源于<code class="fe mh mi mj mk b">stale-while-revalidate</code>，一种由<a class="ae lg" href="https://tools.ietf.org/html/rfc5861" rel="noopener ugc nofollow" target="_blank"> HTTP RFC 5861 </a>推广的 HTTP 缓存失效策略。SWR 是一种策略，首先从缓存返回数据(陈旧)，然后发送获取请求(重新验证)，最后是最新的数据。</p></blockquote><p id="af93" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">react 的工作原理基本上是使用<a class="ae lg" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React 钩子</a>。换句话说，SWR 为远程数据获取提供了 React 钩子。</p><p id="e66f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SWR 是由<a class="ae lg" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>背后的同一个团队创造的。</p><h2 id="524d" class="lh li in bd lj lk ll dn lm ln lo dp lp kk lq lr ls ko lt lu lv ks lw lx ly lz bi translated">但是为什么是 SWR 呢？</h2><p id="8683" class="pw-post-body-paragraph jz ka in kb b kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw ig bi translated">有了 SWR，组件将不断自动获得一系列数据更新。由于这个原因，用户界面将总是快速和反应性的。</p><p id="8a9e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SWR 帮助您简化项目中的数据获取逻辑，并且具有所有这些开箱即用的惊人特性:</p><ul class=""><li id="3039" class="mq mr in kb b kc kd kg kh kk ms ko mt ks mu kw mv mw mx my bi translated"><strong class="kb io">快速</strong>、<strong class="kb io">轻量级、</strong>和<strong class="kb io">可重用</strong>数据提取</li><li id="600b" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">内置<strong class="kb io">缓存</strong>并请求重复数据删除</li><li id="22ff" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated"><strong class="kb io">实时</strong>体验</li><li id="27dc" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">SSR / ISR / SSG 支持</li><li id="1710" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">打字稿准备好了</li><li id="0d9d" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">反应自然</li></ul><p id="4c64" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SWR 涵盖了速度、正确性和稳定性的所有方面，帮助您建立更好的体验:</p><ul class=""><li id="bd7a" class="mq mr in kb b kc kd kg kh kk ms ko mt ks mu kw mv mw mx my bi translated">快速页面导航</li><li id="9f11" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">间隔轮询</li><li id="2493" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">数据依赖性</li><li id="c0f7" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">焦点的重新验证</li><li id="e9e2" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">网络恢复的再验证</li><li id="ba1b" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">局部变异(乐观用户界面)</li><li id="18b2" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">智能错误重试</li><li id="0b67" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">分页和滚动位置恢复</li><li id="19e1" class="mq mr in kb b kc mz kg na kk nb ko nc ks nd kw mv mw mx my bi translated">反应悬念</li></ul><p id="e6cf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">还有很多<a class="ae lg" href="https://swr.vercel.app/docs/getting-started" rel="noopener ugc nofollow" target="_blank">更多的</a>。</p><h2 id="9541" class="lh li in bd lj lk ll dn lm ln lo dp lp kk lq lr ls ko lt lu lv ks lw lx ly lz bi translated">入门指南</h2><p id="7bd3" class="pw-post-body-paragraph jz ka in kb b kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw ig bi translated">通常，您需要使用<a class="ae lg" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>或<a class="ae lg" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱线</a>安装 SWR。你可以跑</p><pre class="ne nf ng nh gt ni mk nj nk aw nl bi"><span id="666b" class="lh li in mk b gy nm nn l no np">yarn add swr</span></pre><p id="c443" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">或使用 npm:</p><pre class="ne nf ng nh gt ni mk nj nk aw nl bi"><span id="ca41" class="lh li in mk b gy nm nn l no np">npm install swr</span></pre><p id="1e17" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在您的 React 目录中。</p><p id="dee0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们了解如何使用 SWR。为此，我使用了我自己使用的代码片段。获取一些位置。</p><figure class="ne nf ng nh gt jo"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="722b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上面的例子中，<code class="fe mh mi mj mk b">useSWR</code>钩子接受一个<code class="fe mh mi mj mk b">key</code>字符串和一个<code class="fe mh mi mj mk b">fetcher</code>函数。<code class="fe mh mi mj mk b">key</code>是数据的唯一标识符(通常是 API URL，在这种情况下是<code class="fe mh mi mj mk b">/ws/rest/v1/location</code>)，并将被传递给<code class="fe mh mi mj mk b">fetcher</code>。<code class="fe mh mi mj mk b">fetcher</code>可以是任何返回数据的异步函数，可以使用原生 fetch 或者像<a class="ae lg" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>这样的工具。我曾经<a class="ae lg" href="https://openmrs.org/" rel="noopener ugc nofollow" target="_blank">从<a class="ae lg" href="https://www.npmjs.com/package/@openmrs/esm-framework" rel="noopener ugc nofollow" target="_blank"> openMRS ESM 框架</a>获取 openMRS </a>。</p><p id="8bf3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">钩子根据请求的状态返回 3 个值:<code class="fe mh mi mj mk b">isLoading</code>、<code class="fe mh mi mj mk b">data</code>和<code class="fe mh mi mj mk b">error</code>。</p><p id="507f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，您可以像这样使用 react 文件中的这个钩子，</p><figure class="ne nf ng nh gt jo"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="603d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">基于你的使用有不同的钩子，例如我们可以使用<a class="ae lg" href="https://swr.vercel.app/docs/revalidation#disable-automatic-revalidations" rel="noopener ugc nofollow" target="_blank">useswrimutable</a>用于不改变的数据。这个请求肯定只是从缓存中加载，根本不会影响网络。</p><p id="bc2e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我喜欢的另一个特性是<strong class="kb io">焦点重新验证</strong>特性。</p><p id="7695" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当您重新聚焦页面或在选项卡之间切换时，SWR 会自动重新验证数据。这对于立即同步到最新状态非常有用。这有助于在陈旧的移动标签或进入睡眠状态的笔记本电脑等场景中刷新数据。</p><p id="2d3b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SWR API 为您提供了启用/禁用上述功能的选项。您可以访问<a class="ae lg" href="https://swr.vercel.app/docs/options" rel="noopener ugc nofollow" target="_blank">选项</a>页面了解更多详情。</p></div><div class="ab cl ns nt hr nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ig ih ii ij ik"><p id="d39a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就这样，我们来到了本文的结尾。我们在这篇文章中瞥了 SWR 一眼，你可以为我查阅文档中的<a class="ae lg" href="https://swr.vercel.app/docs/getting-started" rel="noopener ugc nofollow" target="_blank">细节</a>解释。别忘了看看我的其他文章。下次再见了。在那之前保持安全！✌️</p><p id="3870" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">想要联网吗？<br/>Linkedin:<a class="ae lg" href="https://www.linkedin.com/in/anjula-sack/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/anjula-sack/</a>T5】脸书:<a class="ae lg" href="https://www.facebook.com/anjula.shanaka/" rel="noopener ugc nofollow" target="_blank">https://www.facebook.com/anjula.shanaka/</a><br/>Github:<a class="ae lg" href="https://github.com/anjula-sack" rel="noopener ugc nofollow" target="_blank">https://github.com/anjula-sack</a></p><h1 id="07c8" class="nz li in bd lj oa ob oc lm od oe of lp og oh oi ls oj ok ol lv om on oo ly op bi translated">参考资料:</h1><p id="0632" class="pw-post-body-paragraph jz ka in kb b kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw ig bi translated">[1].开始使用。[2022]SWR[在线]。发布时间:<a class="ae lg" href="https://swr.vercel.app/docs/getting-started" rel="noopener ugc nofollow" target="_blank">https://swr.vercel.app/docs/getting-started</a>【2022 年 11 月 6 日发布】</p></div></div>    
</body>
</html>