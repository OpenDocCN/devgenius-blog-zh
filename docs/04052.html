<html>
<head>
<title>Node.js Basics — MongoDB Cursor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 基础— MongoDB 游标</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/node-js-basics-mongodb-cursor-6fe8aa8b8c03?source=collection_archive---------3-----------------------#2021-01-20">https://blog.devgenius.io/node-js-basics-mongodb-cursor-6fe8aa8b8c03?source=collection_archive---------3-----------------------#2021-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9d97b152f08d099fee613e47b4616fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*338JumVDLO3mio3W"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Jan Antonin Kolar 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fe07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Node.js 是一个流行的运行时平台，用于创建在其上运行的程序。</p><p id="c1ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们可以在浏览器之外运行 JavaScript。</p><p id="6597" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始使用 Node.js 创建程序。</p><h1 id="bc29" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">事件 API</h1><p id="2fb8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 Node.js 的事件 API 从我们的集合中获得查询结果。</p><p id="c0bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a674" class="mn lc iq mj b gy mo mp l mq mr">const { MongoClient } = require('mongodb');<br/>const connection = "mongodb://localhost:27017";<br/>const client = new MongoClient(connection);</span><span id="1cea" class="mn lc iq mj b gy ms mp l mq mr">async function run() {<br/>  try {<br/>    await client.connect();<br/>    const testCollection = await client.db("test").collection('test');<br/>    const result = await testCollection.insertMany([<br/>      {<br/>        name: "Popeye",<br/>        rating: 5,<br/>        qty: 100<br/>      },<br/>      {<br/>        name: "KFC",<br/>        rating: 4,<br/>        qty: 121<br/>      },<br/>    ]);<br/>    console.log(result)<br/>    const query = {<br/>      name: "Popeye",<br/>    };<br/>    const cursor = testCollection.find(query);<br/>    cursor.on("data", data =&gt; console.log(data));<br/>  } finally {<br/>    await client.close();<br/>  }<br/>}<br/>run().catch(console.dir);</span></pre><p id="b713" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">观察<code class="fe mt mu mv mj b">'data'</code>事件，这样我们就可以从结果中获取数据。</p><h1 id="63f6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">以数组形式获取结果</h1><p id="7807" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以把结果作为一个数组。</p><p id="aac4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0469" class="mn lc iq mj b gy mo mp l mq mr">const { MongoClient } = require('mongodb');<br/>const connection = "mongodb://localhost:27017";<br/>const client = new MongoClient(connection);</span><span id="1c68" class="mn lc iq mj b gy ms mp l mq mr">async function run() {<br/>  try {<br/>    await client.connect();<br/>    const testCollection = await client.db("test").collection('test');<br/>    const result = await testCollection.insertMany([<br/>      {<br/>        name: "Popeye",<br/>        rating: 5,<br/>        qty: 100<br/>      },<br/>      {<br/>        name: "KFC",<br/>        rating: 4,<br/>        qty: 121<br/>      },<br/>    ]);<br/>    console.log(result)<br/>    const query = {<br/>      name: "Popeye",<br/>    };<br/>    const cursor = testCollection.find(query);<br/>    const allValues = await cursor.toArray();<br/>    console.log(allValues);<br/>  } finally {<br/>    await client.close();<br/>  }<br/>}<br/>run().catch(console.dir);</span></pre><p id="379d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe mt mu mv mj b">cursor</code>上的<code class="fe mt mu mv mj b">toArray</code>方法，该方法返回解析为来自<code class="fe mt mu mv mj b">test</code>集合的结果的承诺。</p><h1 id="c726" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">游标实用程序方法</h1><p id="6aa1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">cursor 对象有几个实用方法。</p><p id="75ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">count</code>方法返回从集合中检索到的结果数。</p><p id="3a54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7ac5" class="mn lc iq mj b gy mo mp l mq mr">const { MongoClient } = require('mongodb');<br/>const connection = "mongodb://localhost:27017";<br/>const client = new MongoClient(connection);</span><span id="895f" class="mn lc iq mj b gy ms mp l mq mr">async function run() {<br/>  try {<br/>    await client.connect();<br/>    const testCollection = await client.db("test").collection('test');<br/>    const result = await testCollection.insertMany([<br/>      {<br/>        name: "Popeye",<br/>        rating: 5,<br/>        qty: 100<br/>      },<br/>      {<br/>        name: "KFC",<br/>        rating: 4,<br/>        qty: 121<br/>      },<br/>    ]);<br/>    console.log(result)<br/>    const query = {<br/>      name: "Popeye",<br/>    };<br/>    const cursor = testCollection.find(query);<br/>    const count = await cursor.count();<br/>    console.log(count);<br/>  } finally {<br/>    await client.close();<br/>  }<br/>}<br/>run().catch(console.dir);</span></pre><p id="6046" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获取查询返回的项目。</p><p id="fbe9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">rewind</code>方法让我们将光标重置到它在返回文档集中的初始位置。</p><p id="919b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="52c8" class="mn lc iq mj b gy mo mp l mq mr">const { MongoClient } = require('mongodb');<br/>const connection = "mongodb://localhost:27017";<br/>const client = new MongoClient(connection);</span><span id="6a8e" class="mn lc iq mj b gy ms mp l mq mr">async function run() {<br/>  try {<br/>    await client.connect();<br/>    const testCollection = await client.db("test").collection('test');<br/>    const result = await testCollection.insertMany([<br/>      {<br/>        name: "Popeye",<br/>        rating: 5,<br/>        qty: 100<br/>      },<br/>      {<br/>        name: "KFC",<br/>        rating: 4,<br/>        qty: 121<br/>      },<br/>    ]);<br/>    console.log(result)<br/>    const query = {<br/>      name: "Popeye",<br/>    };<br/>    const cursor = testCollection.find(query);<br/>    const firstResult = await cursor.toArray();<br/>    console.log("First count: ", firstResult.length);<br/>    await cursor.rewind();<br/>    const secondResult = await cursor.toArray();<br/>    console.log("Second count: ", secondResult.length);<br/>  } finally {<br/>    await client.close();<br/>  }<br/>}<br/>run().catch(console.dir);</span></pre><p id="0109" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用了<code class="fe mt mu mv mj b">rewind</code>，在调用<code class="fe mt mu mv mj b">rewind</code>前后从光标处得到结果。</p><p id="f8d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在每个控制台日志中得到相同的结果，因为我们调用了<code class="fe mt mu mv mj b">rewind</code>来重置光标。</p><h1 id="379c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2717" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以监听<code class="fe mt mu mv mj b">data</code>事件，从那里获取数据。</p><p id="acb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用光标做各种检索操作。</p></div></div>    
</body>
</html>