<html>
<head>
<title>How to Create Custom Keymaps in Neovim With Lua</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Lua在Neovim中创建自定义键映射</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-custom-keymaps-in-neovim-with-lua-d1167de0f2c2?source=collection_archive---------0-----------------------#2021-11-10">https://blog.devgenius.io/create-custom-keymaps-in-neovim-with-lua-d1167de0f2c2?source=collection_archive---------0-----------------------#2021-11-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="5815" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">尼奥维姆</h2><div class=""/><div class=""><h2 id="d987" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">学习使用可选的内置Lua运行时在Neovim中创建自定义键绑定。为了Lua的利益，抛弃古老而神秘的VimScript！</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/715edf0516b411b9143d2ae265f01bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bLOZZCYgrF2ReFDb.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">开始使用Lua来配置Neovim &amp;同时保护您的理智(图片来源:Somraj Saha)</figcaption></figure><p id="4a43" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">Neovim ( <em class="lx">甚至Vim </em>)对于任何开发者来说都是一款优秀的软件。创建自定义按键绑定的能力&amp;几乎可以做任何事情<br/>证明了Vim的受欢迎程度。如果您以前使用过Vim，那么您应该<br/>知道通过自定义Vim键绑定可以做些什么。</p><p id="0277" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">对于门外汉来说，Vim对于创建自定义按键绑定的开放性几乎没有竞争对手<br/>。因此，只有你的想象力才能限制你使用自定义键绑定所能创造的东西。</p><p id="9e0a" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">Vim用户还需要具备Vimscript ( <em class="lx">这是一种为Vim配置而构建的脚本语言</em>)的工作知识。它不是最优雅的语言，在Vim之外也没有任何用处。对于你们中的许多人来说，学习一门多余的编程语言所需的时间投入可能也不会有什么成效。幸运的是，<em class="lx"> Neovim v0.5+ </em>给了社区一个重要的更新，可以用来玩&amp;内置的Lua运行时。</p><p id="606a" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">可选的Lua运行时也是向后兼容的，这意味着您仍然可以在Vimscript中尝试可选的运行时。我们将不讨论如何在Vimscript中编写Lua代码，因为这超出了本文的范围。但是，请随意参考GitHub上的这个令人惊叹的<a class="ae ly" href="https://github.com/nanotee/nvim-lua-guide" rel="noopener ugc nofollow" target="_blank"> Neovim-Lua指南</a>以获得快速参考。</p><p id="b01c" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">如果这激起了你的兴趣&amp;你想继续了解在Neovim中创建自定义键绑定是多么愉快的体验，那么请继续阅读<br/>。本文的其余部分首先简要介绍可选的Lua <br/>运行时，然后创建一个Lua函数来映射定制的键绑定。在文章的最后，我们会推荐更多的资源，你可能想看一看，以便更好地了解Neovim的Lua运行时。</p><h2 id="a464" class="lz ma in bd mb mc md dn me mf mg dp mh lk mi mj mk lo ml mm mn ls mo mp mq it bi translated">介绍可选的Lua运行时</h2><p id="f707" class="pw-post-body-paragraph lb lc in ld b le mr jx lg lh ms ka lj lk mt lm ln lo mu lq lr ls mv lu lv lw ig bi translated">在我们深入本文之前，让我们简要介绍一下Neovim中的Lua <br/>运行时。对它有所了解将有助于更好地理解如何创造什么。</p><p id="9b34" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">也就是说，Neovim发布时提供了一些有用的功能。使Neovim脱颖而出的一个这样的<br/>特性是它的<a class="ae ly" href="https://neovim.io/doc/user/api.html" rel="noopener ugc nofollow" target="_blank">内置API </a>。Lua运行时对API &amp;的编程访问意味着如果你愿意，你可以尽情发挥你的想象力。</p><p id="b4c7" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">正如你所知道的，像任何其他用于攻击Neovim/Vim的配置文件一样，Lua代码也需要放在<em class="lx"> runtimepath </em>(更多信息<em class="lx">参见</em> <strong class="ld ix"> <em class="lx"> :h rtp </em> </strong> <em class="lx">)。这些配置文件(<em class="lx">带有. lua扩展名</em>)被放在一个<br/>目录中，这个目录被恰当地命名为<em class="lx"> lua </em>。Neovim将在调用时获取该<br/>目录中的所有内容。</em></p><p id="b45b" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">请注意，Neovim运行时路径的位置因您选择的操作系统而异。所以，对于Linux用户来说，检查你的操作系统是否遵循了<br/> <a class="ae ly" href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html" rel="noopener ugc nofollow" target="_blank"> XDG基本目录</a>规范，那么Lua文件通常可以在:<strong class="ld ix"> <em class="lx"> $HOME/获得。config/nvim/Lua</em>T22】。我的Windows用户伙伴们，你们应该在<strong class="ld ix"><em class="lx">% local appdata % \ nvim \ Lua</em></strong>查看Lua文件。</strong></p><p id="2f66" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">关于在哪里放置配置文件的更多信息，请查看GitHub上Neovim-Lua指南的<br/><a class="ae ly" href="https://github.com/nanotee/nvim-lua-guide#where-to-put-lua-files" rel="noopener ugc nofollow" target="_blank">放置Lua文件</a>部分。</p><p id="8a3d" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">鉴于我们对可选Lua运行时的简单介绍，让<br/>看看如何用Lua配置Neovim键绑定。在接下来的几个<br/>小节中，我们将看一看，编写一个示例Lua函数，后面跟着一个<br/>Lua中的实际函数包装器。这个功能包装器将用于创建我们的自定义键绑定，其中&amp;在任何需要的时候。</p><h2 id="7293" class="lz ma in bd mb mc md dn me mf mg dp mh lk mi mj mk lo ml mm mn ls mo mp mq it bi translated">如何为Neovim键绑定编写Lua函数</h2><p id="c891" class="pw-post-body-paragraph lb lc in ld b le mr jx lg lh ms ka lj lk mt lm ln lo mu lq lr ls mv lu lv lw ig bi translated">回到Neovim还不存在的时候，vim提供了<strong class="ld ix"> <em class="lx"> remap </em> </strong>命令(<em class="lx">和</em><strong class="ld ix"><em class="lx">no remap</em></strong><em class="lx">用于非递归重映射</em>)来定制&amp;重映射键绑定。因此，看到<strong class="ld ix"> <em class="lx"> nnoremap </em> </strong>命令散落在<strong class="ld ix"> <em class="lx">各处是很常见的场景。vimrc </em>文件</strong>文件。这里有一个这样的<br/> <a class="ae ly" href="https://github.com/jessfraz/.vim/blob/master/vimrc" rel="noopener ugc nofollow" target="_blank"> <em class="lx">例子</em> <strong class="ld ix"> <em class="lx">。vimrc </em> </strong> </a>文件我从网上捡的。文件巨大(<em class="lx"> ~1200行代码！</em>)，很难操作&amp;维护起来简直是一场噩梦。</p><p id="80eb" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这是我从<strong class="ld ix"> <em class="lx">中摘录的一小段代码。vimrc </em>上面的</strong>文件。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">仅使用Vimscript配置Neovim的示例</figcaption></figure><p id="b14f" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">幸运的是，Neovim通过它的内置API提供了一个助手功能。<br/>恰如其分地命名为<strong class="ld ix"><em class="lx">nvim _ set _ key map()</em></strong>，用户可以直接使用这个函数<br/>，也可以将其封装在Lua代码中使用。推荐使用后一种方法，因为这样可以遵循标准的编码实践。将Lua代码与Neovim API结合使用也有助于配置的模块化。从而使维护变得更加容易&amp;保持你的理智完好无损。</p><p id="8ba9" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">使用包装函数还可以确保配置是"<a class="ae ly" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"><strong class="ld ix"/></a>"&amp;"<a class="ae ly" href="https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-five-principles-of-object-oriented-design" rel="noopener ugc nofollow" target="_blank"><strong class="ld ix"/></a>"。遵循这样的通用开发标准实践意味着配置看起来也很干净&amp;有条理。</p><p id="1bf5" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">那么，当与Lua一起使用时，典型的Neovim配置是什么样子的呢？<br/>这里有一个例子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建Lua功能，通过遵循干燥和坚固的原则来定制Neovim按键</figcaption></figure><p id="9812" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">乍一看，Lua代码可能显得过于冗长，但这是一件好事，您很快就会看到。</p><p id="676b" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">在上面我们分享的Lua代码片段中，我们定义了一个名为<strong class="ld ix"> <em class="lx"> map() </em> </strong>的函数。它接受四个参数，即:</p><ol class=""><li id="177e" class="my mz in ld b le lf lh li lk na lo nb ls nc lw nd ne nf ng bi translated"><strong class="ld ix"> <em class="lx">模式</em> </strong> ( <em class="lx">如同在Vim模式中一样</em> <strong class="ld ix"> <em class="lx">正常</em> </strong> <em class="lx"> / </em> <strong class="ld ix"> <em class="lx">插入</em> </strong> <em class="lx">模式</em>)</li><li id="487a" class="my mz in ld b le nh lh ni lk nj lo nk ls nl lw nd ne nf ng bi translated"><strong class="ld ix"> lhs </strong> ( <em class="lx">您需要的自定义键位</em>)</li><li id="0223" class="my mz in ld b le nh lh ni lk nj lo nk ls nl lw nd ne nf ng bi translated"><strong class="ld ix"> rhs </strong> ( <em class="lx">命令或已有的按键来定制</em>)</li><li id="86da" class="my mz in ld b le nh lh ni lk nj lo nk ls nl lw nd ne nf ng bi translated"><strong class="ld ix"> opts </strong> ( <em class="lx">附加选项如</em> <strong class="ld ix"> <em class="lx"> &lt;静音&gt;</em></strong><em class="lx">/</em><strong class="ld ix">&lt;no remap&gt;</strong><em class="lx">，参见</em><strong class="ld ix"><em class="lx">:h map-arguments</em></strong><em class="lx">了解更多信息</em>)</li></ol><p id="ca05" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">默认情况下，<strong class="ld ix"> <em class="lx"> map() </em> </strong>函数的<strong class="ld ix"> <em class="lx"> opts </em> </strong>参数赋给一个表<br/><strong class="ld ix"><em class="lx">{ nore map = true }</em></strong>。这样做时，允许映射的嵌套&amp;递归使用(<em class="lx">参考</em><strong class="ld ix"><em class="lx">:h map-commands</em></strong><em class="lx">了解更多信息</em>)。您可以根据需要进一步扩展<strong class="ld ix"> <em class="lx"> opts </em> </strong>表，添加<strong class="ld ix"><em class="lx">map-arguments</em></strong>。包装器的核心是<strong class="ld ix"><em class="lx">vim . API . nvim _ set _ key map()</em></strong>函数，它接受上面提到的参数列表。</p><p id="db95" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这个函数可以在任何需要的地方重用。正如您将在<br/>中看到的，接下来我们可以进一步模块化我们的Neovim配置！</p><h2 id="a859" class="lz ma in bd mb mc md dn me mf mg dp mh lk mi mj mk lo ml mm mn ls mo mp mq it bi translated">在Neovim运行时文件中使用Lua函数</h2><p id="4491" class="pw-post-body-paragraph lb lc in ld b le mr jx lg lh ms ka lj lk mt lm ln lo mu lq lr ls mv lu lv lw ig bi translated">我们在上一节中使用的包装函数确实有助于定制<br/>默认Vim重映射。但是定义包装函数&amp;然后在我们的<strong class="ld ix"> <em class="lx"> init.lua </em> </strong>文件中使用它根本不符合DRY和/或SOLID原则。为了使配置更符合标准开发实践，我们将使用<a class="ae ly" href="https://www.lua.org/manual/5.1/manual.html#5.3" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ix"> Lua模块</strong> </a>。使用Lua模块确保了在我们的配置中有清晰的逻辑分离。</p><p id="b212" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">如果您需要复习如何为Neovim创建Lua模块，请参考GitHub上Neovim-Lua指南的<br/>和<a class="ae ly" href="https://github.com/nanotee/nvim-lua-guide#modules" rel="noopener ugc nofollow" target="_blank">模块</a>部分。</p><p id="60ab" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">也就是说，在runtimepath中的"<strong class="ld ix"><em class="lx">【Lua</em></strong>"目录下创建一个"<strong class="ld ix"><em class="lx">【utils . Lua</em></strong><em class="lx"/>"目录。<br/>如果Lua模块包含以下代码行，则它们被识别:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">定义Lua模块的基本框架</figcaption></figure><p id="1464" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">解释Lua模块也超出了本文的范围，所以可以参考上面链接的Lua 5.1文档。</p><p id="575d" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">对于我们的用例，我们定义的Lua模块将包含定制键绑定的功能包装器。照这样这就是我们的"<strong class="ld ix"><em class="lx">utils . Lua</em></strong><em class="lx">"</em>模块的内容会是什么样子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">一个Lua模块的例子，包含了我们的实用map()函数，用于定制Neovim按键绑定</figcaption></figure><p id="ebc3" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">由于Neovim源和加载位于runtimepath中“lua”目录下的任何Lua文件，我们的<strong class="ld ix"> <em class="lx"> map() </em> </strong>函数也可以导入到任何其他地方。因此，现在可以简单地将包装器导入到您的“<strong class="ld ix"><em class="lx">init . Lua</em></strong><em class="lx">”</em>文件&amp;中，用它来创建您的remaps。因此，你现在可以保持文件干净，可维护的&amp;快速加载。</p><p id="aaa8" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">下面是如何通过从"<strong class="ld ix"> <em class="lx"> utils </em> </strong>"模块导入"<strong class="ld ix"> <em class="lx"> map() </em> </strong> " <br/>"函数来重写"<strong class="ld ix"> <em class="lx"> init.lua </em> </strong>"文件；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6e8a" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">既然代码已经被适当地模块化了，维护就不应该是一件苦差事&amp;出问题的几率会低得多。此外，如果您希望扩展我们基本的<strong class="ld ix"> <em class="lx"> map() </em> </strong>函数，只需对“<strong class="ld ix"> <em class="lx"> utils </em> </strong>”模块进行必要的更改即可！</p><p id="a161" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">也就是说，如果你已经使用Neovim有一段时间了，你还需要将你的配置迁移到Lua代码。你会很高兴听到Neovim开发人员竭尽全力保持向后兼容性。如果对现有配置进行从Vimscript到Lua代码的迁移更改让您感到不安，那么不要担心。您甚至可以在Vimscript中使用Lua代码！为此，请参考“<strong class="ld ix"> <em class="lx"> :h heredocs </em> </strong>”了解更多关于该主题的信息。</p><p id="7dfc" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">为了帮助您在迁移现有配置时找到合适的方法，<br/>下一节将推荐一些有用的参考资料供您参考。</p><h2 id="536e" class="lz ma in bd mb mc md dn me mf mg dp mh lk mi mj mk lo ml mm mn ls mo mp mq it bi translated">最后的话&amp;值得期待的事情</h2><p id="ae24" class="pw-post-body-paragraph lb lc in ld b le mr jx lg lh ms ka lj lk mt lm ln lo mu lq lr ls mv lu lv lw ig bi translated">Neovim中可选的Lua运行时是天赐之物&amp;这也是使Neovim从vim中脱颖而出的特性之一。但是由于特性&amp; Neovim本身相对较新，所以很难找到关于这些特性的资源。因此，如果用Lua配置Neovim引起了您的兴趣，您可能想看看下面的一些资源。</p><ol class=""><li id="1210" class="my mz in ld b le lf lh li lk na lo nb ls nc lw nd ne nf ng bi translated"><a class="ae ly" href="https://github.com/nanotee/nvim-lua-guide" rel="noopener ugc nofollow" target="_blank">在Neovim中使用Lua的指南</a></li><li id="df0a" class="my mz in ld b le nh lh ni lk nj lo nk ls nl lw nd ne nf ng bi translated">"<a class="ae ly" href="https://neovim.io/doc/user/lua.html" rel="noopener ugc nofollow" target="_blank"><strong class="ld ix"><em class="lx">h:lua</em></strong></a>"获得如何在Neovim中使用Lua的全面指导。</li><li id="68e6" class="my mz in ld b le nh lh ni lk nj lo nk ls nl lw nd ne nf ng bi translated">有点无耻，你也可以用我的博客作为参考。我曾经写过一篇这样的文章，介绍在<a class="ae ly" href="https://jarmos.netlify.app/posts/vim-vs-neovim/" rel="noopener ugc nofollow" target="_blank"> Vim或Neovim中为Neovim使用Lua的好处？以下是你应该使用后者</a>的原因。还会有更多这样的文章，所以请保持警惕。</li></ol><p id="5169" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我错过了其他有用的资源吗？如果我做了，让我知道！</p><p id="01a9" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">而且总结一下这篇文章，你怎么看待用Lua配置<br/> Neovim？您当前的配置是Vimscript还是Lua？你注意到使用这两种方法有什么不同吗？</p><p id="5cc9" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">给我发一条短信到推特<a class="ae ly" href="https://twitter.com/Jarmosan" rel="noopener ugc nofollow" target="_blank">推特</a>或者电子邮件，随你喜欢。</p></div></div>    
</body>
</html>