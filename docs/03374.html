<html>
<head>
<title>Non Root Gluster CLI access</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非根Gluster CLI访问</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/non-root-gluster-cli-access-723b171e1915?source=collection_archive---------7-----------------------#2020-10-27">https://blog.devgenius.io/non-root-gluster-cli-access-723b171e1915?source=collection_archive---------7-----------------------#2020-10-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="189b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Glusterfs的二进制文件和文件，如果你不得不探索将属于根用户。在nix中，一切都是文件。因此，只有文件的所有者和允许组中的人才能执行二进制文件。这是否意味着非根用户不能运行Glusterfs？</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="10bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一个人在一个系统中工作，其中默认用户是不属于sudoers文件的<strong class="jm io">和</strong>。这意味着他们将无法访问(无论是打开文件还是告诉系统执行该文件的内容)文件系统中不属于他们的组或者不属于<strong class="jm io">和</strong>用户的文件。</p><p id="07ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果<strong class="jm io">蚂蚁</strong>运行一个gluster命令，比如说</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="eb7b" class="ky kz in ku b gy la lb l lc ld"># gluster vol status</span></pre><p id="1f2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">他们会得到甜蜜的回应</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="70ef" class="ky kz in ku b gy la lb l lc ld">ERROR: failed to create logfile "/var/log/glusterfs/cli.log" (Permission denied)<br/>ERROR: failed to open logfile /var/log/glusterfs/cli.log</span></pre><p id="f312" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">原因是<strong class="jm io"> ant </strong>没有运行gluster cli命令的必要权限。现在有各种各样的解决方法..</p><ol class=""><li id="62a1" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated">将ant添加到sudoers组并使用sudo运行命令</li><li id="e5a7" class="le lf in jm b jn ln jr lo jv lp jz lq kd lr kh lj lk ll lm bi translated">设置二进制文件的setuid位。</li></ol><p id="476b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">路径1非常简单，所以我们不会深入研究它，而且，这也回避了这样一个问题:如果系统管理员非常坚决地不为<strong class="jm io"> ant提供sudo特权，该怎么办？</strong></p><p id="356d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，输入setuid位…</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="dc53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">setuid位是nix中的一个特殊权限，其中某些文件(同样，所有文件都是文件！！)可以被一个用户访问，该用户在正常情况下甚至不应该访问所述文件，但是由于该文件设置了一个位，所以能够访问。这个位允许非根用户以扩展权限运行文件(换句话说，与文件所有者相同的权限)。</p><p id="7f9f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，root是gluster二进制文件的所有者，为了允许<strong class="jm io"> ant </strong>运行gluster cli命令，需要设置/usr/sbin/gluster(假设我们只是在谈论gluster cli)二进制文件的一个位。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="ed85" class="ky kz in ku b gy la lb l lc ld"># chmod u+s /usr/sbin/gluster</span></pre><p id="852a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在做一个ls的时候，我们看到..</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="5b76" class="ky kz in ku b gy la lb l lc ld">-rwsr-xr-x. 1 root root 511312 Oct 23 12:07 gluster</span></pre><p id="699c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们这里有一个s，它表示已经授予了setuid权限。现在，如果<strong class="jm io"> ant </strong>运行gluster vol status命令，将会收到所需的输出。</p><p id="20a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要恢复到原来的状态，可以使用相同的chmod命令，只需稍作修改，</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="41fc" class="ky kz in ku b gy la lb l lc ld"># chmod u-s /usr/sbin/gluster</span></pre></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><p id="be53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随着更大的特权而来的是更多的威胁……setuid必须在经过深思熟虑和与你的系统管理员讨论后使用(不管怎样，他是一个可以给予许可的人:p ),并考虑你提供这个特权的可执行文件或文件。</p><p id="0770" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">人们可以探索setuid丰富多彩的过去，以及人们如何利用它作为攻击整个系统的媒介。</p></div></div>    
</body>
</html>