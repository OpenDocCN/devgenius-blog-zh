<html>
<head>
<title>Troubleshooting PostgreSQL Installation Problems On Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows 上 PostgreSQL 安装问题的疑难解答</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/troubleshooting-postgresql-installation-on-windows-6b36f6addb4f?source=collection_archive---------4-----------------------#2022-11-16">https://blog.devgenius.io/troubleshooting-postgresql-installation-on-windows-6b36f6addb4f?source=collection_archive---------4-----------------------#2022-11-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e515d640c6001aea020f21cb781c131b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LB5pkUzFgWpqjJdD"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@ikukevk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯文·Ku</a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c3f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 Stack Overflow 中有一些关于 Windows 平台上 PostgreSQL 安装问题的讨论。其中包括:</p><p id="6564" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">(1) An error occurred executing the Microsoft VC++ runtime installer</code></p><p id="488f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">(2) psql: error: could not connect to server: Connection refused</code></p><p id="f6f6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">(3) psql: error: FATAL: password authentication failed for user “xxxxx”</code></p><p id="738f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一个问题与安装前问题有关，而第二个和第三个问题与安装后问题有关。</p><p id="e256" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了解决预安装问题，建议开发者使用 Chocolatey(虫火谷)安装方法。它将下载 PostgreSQL 的所有先决条件。按照步骤在处安装虫火谷<a class="ae jz" href="https://chocolatey.org/install" rel="noopener ugc nofollow" target="_blank">，即</a><a class="ae jz" href="https://chocolatey.org/install" rel="noopener ugc nofollow" target="_blank">https://chocolatey.org/install</a>。</p><p id="1cb7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装虫火谷后，访问 https://community.chocolatey.org/packages/postgresql13<a class="ae jz" href="https://community.chocolatey.org/packages/postgresql13" rel="noopener ugc nofollow" target="_blank">按照 PostgreSQL 的安装指南进行操作。虫火谷网站提供了如下所示的自定义安装脚本示例。</a></p><pre class="lc ld le lf gt lg lb lh bn li lj bi"><span id="91be" class="lk ll in lb b be lm ln l lo lp">choco install postgresql13 --params '/Password:test /Port:5433' --ia '--enable-components server,commandlinetools'</span></pre><p id="6696" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该脚本告诉虫火谷为默认用户“postgres”安装密码为“test”的 PostgreSQL 版本 13，然后将服务设置为在端口 5433 运行。</p><p id="6ec3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">PostgreSQL 安装完成后，开发人员将能够通过一个名为 PSQL 的程序使用服务器。PSQL 开始运行时会出现两个常见问题；(1)无法连接到服务器，(2)密码验证失败。除此之外，可能还有与字符编码(即代码页)相关的警告消息。</p><h1 id="8665" class="lq ll in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">(1)无法连接到服务器</h1><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/b6a3896a9d6f7c0606f40eff34ce3068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfpjwJiz-yNvP3c5lxdBNQ.png"/></div></div></figure><p id="4842" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，PSQL 告诉我们它无法连接到服务器，并建议我们检查 PostgreSQL 服务的状态。运行 Windows 服务管理器(按 WIN 按钮，键入 services.msc，然后按 ENTER)。检查列表中是否有 postgresql 服务。如果服务尚未运行，请单击启动按钮。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/7f225f7fc681af65beb350bd019d6582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yQN9FQLxH2dDpSTYvWyrUA.png"/></div></div></figure><p id="0fba" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果服务已经启动，但错误消息仍然存在，请返回到 Windows 服务管理器，右键单击 postgresql 项目，然后选择属性。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/332181b590461a19b85b63c60f596904.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*T04ycc1iLc2V51dMlFUF9A.png"/></div></figure><p id="5e18" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看看下面显示的“可执行文件路径”条目。复制数据路径，例如<code class="fe ky kz la lb b">“C:\Program Files\PostgreSQL\13\data”</code></p><pre class="lc ld le lf gt lg lb lh bn li lj bi"><span id="3765" class="lk ll in lb b be lm ln l lo lp">"C:\Program Files\PostgreSQL\13\bin\pg_ctl.exe" runservice -N "postgresql-x64-13" -D "C:\Program Files\PostgreSQL\13\data" -w</span></pre><p id="cff3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">进入数据路径文件夹，找到配置文件，即<code class="fe ky kz la lb b">postgresql.conf</code>文件。它是 PostgreSQL 的主配置文件，也是配置参数设置的主要来源。检查该文件中提到的端口号是否与虫火谷自定义安装脚本中包含的端口号相似(例如<strong class="kc io"> 5433 </strong>)。如果不是，使用文件中声明的值。例如，下面的配置文件使用<strong class="kc io"> 5413 </strong>。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/55fe3d1f8318535196bd6e41ed761169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35xi7uWUbLiEqaXbWxbzUg.png"/></div></div></figure><p id="d56f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">尝试使用 port 参数运行 PSQL，即</p><p id="3146" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">psql -p 5413</code></p><h1 id="8a67" class="lq ll in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">(2)密码错误</h1><p id="eca2" class="pw-post-body-paragraph ka kb in kc b kd mr kf kg kh ms kj kk kl mt kn ko kp mu kr ks kt mv kv kw kx ig bi translated">一旦检测到正确的端口，PSQL 将对用户进行身份验证。默认情况下，它将本地主机用户名作为登录名，而登录名通常不是“postgres ”,因此默认密码(在虫火谷自定义安装脚本中指定)将不起作用。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/f220d5cb1e1b304bdad711682d4ffe12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGOSx9Wb9GSzcBHZHyEehg.png"/></div></div></figure><p id="837c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加另一个参数，将<strong class="kc io"> postgres </strong>设置为登录用户名，即</p><p id="fc7e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">psql -p 5413 -U postgres</code></p><p id="4684" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后键入密码，例如<code class="fe ky kz la lb b">test</code>(基于上面的虫火谷自定义安装脚本)。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d87e992917578920b6738c14af733edf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*-xT4PGhcK9MYfNAKI8DwAQ.png"/></div></figure><p id="2d23" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，创建一个名为“postgres”的 Windows 用户，并使用该帐户运行 psql。(提示:使用控制台命令<code class="fe ky kz la lb b">whoami</code>检查本地机器的当前用户)。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/ab055f69c9d5233a1b779bbafa1394a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*l9eRTzcGZrJv_oa5y7_xiA.jpeg"/></div></figure><p id="8734" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这两种方法都有助于解决密码错误。</p><h1 id="643a" class="lq ll in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">(3) PostgreSQL 代码页警告</h1><p id="b8e3" class="pw-post-body-paragraph ka kb in kc b kd mr kf kg kh ms kj kk kl mt kn ko kp mu kr ks kt mv kv kw kx ig bi translated">现在用户已经成功登录，PSQL 可能会报告一条警告消息，指出控制台代码页不同于 Windows 代码页。要解决代码页问题，请退出 PSQL，即<code class="fe ky kz la lb b">\q</code>。键入终端命令<code class="fe ky kz la lb b">chcp 1252</code>，然后再次登录。警告现在应该已经消失了。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/318a2e97af48025956a997cfb772af18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*M6lo-nsCEMnh2Z0vOiLR6g.png"/></div></figure><p id="0eb7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">问题已解决😊</p></div></div>    
</body>
</html>