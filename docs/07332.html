<html>
<head>
<title>Track Web Component When Resizing Without a Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在没有库的情况下调整大小时跟踪 Web 组件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/track-web-component-when-resizing-without-a-library-a93faa900cc1?source=collection_archive---------14-----------------------#2022-03-15">https://blog.devgenius.io/track-web-component-when-resizing-without-a-library-a93faa900cc1?source=collection_archive---------14-----------------------#2022-03-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="38d7" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">WebDev</h2><div class=""/><p id="9a19" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我是一名前端开发人员，我的目标一直是让网页反应灵敏、美观。我最近遇到的一个问题是让仪表板的一个组件在监听内容区域的宽度而不是设备宽度时做出响应。</p><p id="c5df" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">如果您只需要解决方案:<code class="fe kr ks kt ku b">ResizeObserver</code>一个 Web API，请跳过故事部分。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/3354e2397c62fdc639e014b6024842be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vxqtcg2KMMbV5pi2-1j24A.jpeg"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">照片由<a class="ae ll" href="https://unsplash.com/@frostroomhead" rel="noopener ugc nofollow" target="_blank"> Rodion Kutsaev </a>从 Unsplash 拍摄。</figcaption></figure><h2 id="5a83" class="lm ln in bd lo lp lq dn lr ls lt dp lu ke lv lw lx ki ly lz ma km mb mc md it bi translated">故事</h2><p id="b502" class="pw-post-body-paragraph jt ju in jv b jw me jy jz ka mf kc kd ke mg kg kh ki mh kk kl km mi ko kp kq ig bi translated">更详细地说，我希望当用户切换菜单栏以折叠或展开时，仪表板项目变得更具交互性。我的团队没有每种设备上应用程序的完整设计，所以我们简单地为在<code class="fe kr ks kt ku b">769px</code>下使用我们应用程序的用户使用移动设计，为更大的屏幕尺寸使用桌面设计。问题发生在平板电脑屏幕尺寸上，它不够大，无法像桌面屏幕一样拉伸所有仪表板组件。一句话，丑。有些条目看不见了，有些条目的文本成了罐头里的沙丁鱼。</p><p id="ef32" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">所以我有了一个想法，当容器宽度大于 x 时，给组件添加一个动态的<code class="fe kr ks kt ku b">class</code>,当容器收缩时，移除这个<code class="fe kr ks kt ku b">class</code>。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi mj"><img src="../Images/3e8f40c93d81c5d92190773b4a75d2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EKF1hS_tcrKmVFKnb0NJQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">这个问题的简单形象</figcaption></figure><p id="5c6e" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">有点棘手的是，<code class="fe kr ks kt ku b">@media query</code>会给我我想要的效果，但它需要每隔几个像素进行一次查询，每个设备都会有不同的情况，尤其是<code class="fe kr ks kt ku b">@container</code>还没有发布。多让人头疼啊，对吧？我正在使用 Vue，所以下一个方法是使用一个<code class="fe kr ks kt ku b">Watcher</code>和 JavaScript <code class="fe kr ks kt ku b">getElementById</code>以及 Vue <code class="fe kr ks kt ku b">ref</code>方法，这两种方法都可以，但是有几个问题仍然使解决方案不完美。</p><ol class=""><li id="4980" class="mk ml in jv b jw jx ka kb ke mm ki mn km mo kq mp mq mr ms bi translated">至少注册两个道具:<code class="fe kr ks kt ku b">componentId</code>和<code class="fe kr ks kt ku b">aFlagBoolean</code></li><li id="e560" class="mk ml in jv b jw mt ka mu ke mv ki mw km mx kq mp mq mr ms bi translated"><code class="fe kr ks kt ku b">getElementById</code>或<code class="fe kr ks kt ku b">ref</code>在获得<code class="fe kr ks kt ku b">innerWidth</code>时有延迟，在第一次尝试中，一切看起来都很好，但第二次或第三次会开始给你相反的结果。更多的<code class="fe kr ks kt ku b">ifelse</code>去修理它，它会把你带到一个洞里</li></ol><h2 id="9f58" class="lm ln in bd lo lp lq dn lr ls lt dp lu ke lv lw lx ki ly lz ma km mb mc md it bi translated">解决办法</h2><p id="d735" class="pw-post-body-paragraph jt ju in jv b jw me jy jz ka mf kc kd ke mg kg kh ki mh kk kl km mi ko kp kq ig bi translated">我没有导入另一个库，而是发现<a class="ae ll" href="https://developer.mozilla.org/en-US/docs/Web/API" rel="noopener ugc nofollow" target="_blank"> WebAPI </a>有<code class="fe kr ks kt ku b"><a class="ae ll" href="https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver" rel="noopener ugc nofollow" target="_blank">ResizeObserver</a></code>，它正在做我需要的正确的事情。它会跟踪你在上面注册的组件。我们用代码说话吧。</p><p id="9ad0" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">在使用这个 API 之前，请确保您的组件已经由<code class="fe kr ks kt ku b">getElementById</code>、<code class="fe kr ks kt ku b">ref</code>或其他人成功注册。</p><pre class="kw kx ky kz gt my ku mz na aw nb bi"><span id="64bb" class="lm ln in ku b gy nc nd l ne nf">&gt;&gt;&gt; HTML<br/>&lt;div id="container"&gt;&lt;/div&gt;</span><span id="63d3" class="lm ln in ku b gy ng nd l ne nf">&gt;&gt;&gt; JavaScript<br/>const container = document.getElementById('container');<br/>const resizeObserver = new ResizeObserver(entries =&gt; {<br/>  <!-- -->window.requestAnimationFrame(() =&gt; {<br/>    if (!Array.isArray(entries) || !entries.length) {<br/>      return;<br/>  }</span><span id="4424" class="lm ln in ku b gy ng nd l ne nf">  for (let entry of entries) {<br/>    /* Do something <!-- -->*/<br/>    if (entry.contentRect.width &gt; 400) {<br/>      console.log('Width is wider than 400px');<br/>    } <br/>    if (entry.contentRect.height &gt; 450) {<br/>      console.log('Height is over 450px');<br/>    }<br/>  <!-- -->}<br/>});<br/><br/>resizeObserver.observe(container);</span></pre><p id="cc5b" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我们需要预设调整观察器应该执行什么操作，然后将组件注册到观察列表中。它将返回一个对象列表，因此您的逻辑和检查必须放在 for 循环中。要在观察列表中注册一个组件，只需简单的<code class="fe kr ks kt ku b">resizeObserver.observe(component)</code>；移除一个组件<code class="fe kr ks kt ku b">resizeObserver.unobserve(component)</code>。</p><p id="43ef" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">为了避免控制台警告过于频繁，我们可以添加<code class="fe kr ks kt ku b">window.requestAnimationFrame</code>。对于 TypeScript 用户，我们可以通过在 resize observer 前面添加<code class="fe kr ks kt ku b">(window as any)</code>来摆脱<code class="fe kr ks kt ku b">unknown import</code>警告。完整版本看起来应该如下所示:</p><pre class="kw kx ky kz gt my ku mz na aw nb bi"><span id="be3a" class="lm ln in ku b gy nc nd l ne nf">const resizeObserver = new (window as any).ResizeObserver(entries =&gt; {<br/>  <!-- -->window.requestAnimationFrame(() =&gt; {<br/>    if (!Array.isArray(entries) || !entries.length) {<br/>      return;<br/>  }</span><span id="7e73" class="lm ln in ku b gy ng nd l ne nf">for (let entry of entries) {<br/>    /* Do something <!-- -->*/<br/>    if (entry.contentRect.width &gt; 400) {<br/>      console.log('Width is wider than 400px');<br/>    } <br/>    if (entry.contentRect.height &gt; 450) {<br/>      console.log('Height is over 450px');<br/>    }<br/>  <!-- -->}<br/>});</span></pre></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><p id="ae18" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">希望它有所帮助，并祝你的项目好运。现在一个问题有很多解决方案，挑一个符合你风格和需要的吧~</p></div></div>    
</body>
</html>