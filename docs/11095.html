<html>
<head>
<title>OTA updates for your ESP32 project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ESP32 项目的 OTA 更新</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ota-updates-for-your-esp32-project-e15af9cb24af?source=collection_archive---------5-----------------------#2022-12-18">https://blog.devgenius.io/ota-updates-for-your-esp32-project-e15af9cb24af?source=collection_archive---------5-----------------------#2022-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="969a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在当今互联设备的世界中，无线(OTA)更新固件的能力是许多电子项目的一项基本功能。流行的微控制器 ESP32 提供 Wi-Fi 和蓝牙连接，但实现 OTA 功能的过程可能很棘手。在本文中，我将介绍一个名为<a class="ae ki" href="https://github.com/Fishwaldo/esp_ghota" rel="noopener ugc nofollow" target="_blank"> esp_ghota </a>的新 ota 库，它由 Justin Hammond 开发，可以轻松地将 OTA 更新添加到您的 ESP32 项目中。我将解释 esp_ghosta 是如何工作的，以及它如何帮助您在不需要物理访问的情况下保持项目最新。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/81085411aaa48653c5f16bee0345acc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8h7fqzQsEEmpcl_-zpKeqw.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">ESP-WROOM-32 开发板，图像维基共享</figcaption></figure><p id="bb79" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">esp_ghota 采用了一种独特的 ota 更新方法，使用 GitHub 版本作为固件更新的来源。为了支持这一点，Hammond 包含了一个流 JSON 解析器来处理来自 GitHub API 的大量响应。使用 esp_ghota 很简单——用户只需要在 GitHub 上推一个新的提交给他们的 repo，GitHub 动作会处理剩下的事情:它会构建并发布固件，esp_ghota 会定期检查更新并完成剩下的工作。</p><p id="7b9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">库功能:</p><ul class=""><li id="2d6b" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">使用 esp_https_ota 库更新固件映像</li><li id="fca0" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">也可以更新 spiffs/littlefs/fatfs 分区</li><li id="bedb" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">使用 SemVer 比较版本，仅在有新版本可用时才进行更新</li><li id="d585" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">与 esp-idf 引导程序的应用程序回滚和反回滚功能配合良好</li><li id="5600" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">直接从 github 发布页面下载固件和分区镜像</li><li id="50a3" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">支持具有不同固件映像的多个设备</li><li id="64b9" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">包括一个示例 Github 动作，当一个新标签被推送时，它构建并释放图像</li><li id="f25a" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">更新可以手动触发，也可以通过间隔计时器触发</li><li id="d768" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">使用流 JSON 解析器来减少内存使用(Github API 响应可能会很大)</li><li id="ebc0" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">支持私有存储库(需要 Github API 令牌*)</li><li id="a2e2" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">支持 Github Enterprise</li><li id="4c8e" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">支持 Github 个人访问令牌以克服 Github API 速率限制</li><li id="7863" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">通过 esp_event_loop 发送更新进度</li></ul><p id="e2c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">除了库本身，Hammond 还提供了一个示例 GitHub 操作和一个示例 ESP32 项目来帮助用户入门。这使得 esp_ghota 成为任何希望在他们的 ESP32 项目中实现 ota 更新的人非常有用的工具。</p><h2 id="35b6" class="ln lo in bd lp lq lr dn ls lt lu dp lv jv lw lx ly jz lz ma mb kd mc md me mf bi translated">用法示例</h2><p id="782e" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">这些是来自 esp_ghota <a class="ae ki" href="https://esp-github-ota.readthedocs.io/en/latest/README.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>的用法示例。初始化网络访问后，启动计时器定期检查新版本:</p><pre class="kk kl km kn gt ml mm mn bn mo mp bi"><span id="64c0" class="mq lo in mm b be mr ms l mt mu">ghota_config_t ghconfig = {<br/>        .filenamematch = "GithubOTA-esp32.bin", // Glob Pattern to match against the Firmware file<br/>        .storagenamematch = "storage-esp32.bin", // Glob Pattern to match against the storage firmware file<br/>        .storagepartitionname = "storage", // Update the storage partition<br/>        .updateInterval = 60, // Check for updates every 60 minuites<br/>    };<br/>    ghota_client_handle_t *ghota_client = ghota_init(&amp;ghconfig);<br/>    if (ghota_client == NULL) {<br/>        ESP_LOGE(TAG, "ghota_client_init failed");<br/>        return;<br/>    }<br/>    esp_event_handler_register(GHOTA_EVENTS, ESP_EVENT_ANY_ID, &amp;ghota_event_callback, ghota_client); // Register a handler to get updates on progress <br/>    ESP_ERROR_CHECK(ghota_start_update_timer(ghota_client)); // Start the timer to check for updates</span></pre><p id="4b26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者手动检查更新:</p><pre class="kk kl km kn gt ml mm mn bn mo mp bi"><span id="2853" class="mq lo in mm b be mr ms l mt mu">ghota_config_t ghconfig = {<br/>        .filenamematch = "GithubOTA-esp32.bin",<br/>        .storagenamematch = "storage-esp32.bin",<br/>        .storagepartitionname = "storage",<br/>        .updateInterval = 60,<br/>    };<br/>    ghota_client_handle_t *ghota_client = ghota_init(&amp;ghconfig);<br/>    if (ghota_client == NULL) {<br/>        ESP_LOGE(TAG, "ghota_client_init failed");<br/>        return;<br/>    }<br/>    esp_event_handler_register(GHOTA_EVENTS, ESP_EVENT_ANY_ID, &amp;ghota_event_callback, ghota_client);<br/>    ESP_ERROR_CHECK(ghota_check(ghota_client));<br/><br/>    semver_t *cur = ghota_get_current_version(ghota_client);<br/>    if (cur) {<br/>        ESP_LOGI(TAG, "Current version: %d.%d.%d", cur-&gt;major, cur-&gt;minor, cur-&gt;patch);<br/>        semver_free(cur);<br/>    }<br/><br/>    semver_t *new = ghota_get_latest_version(ghota_client);<br/>    if (new) {<br/>        ESP_LOGI(TAG, "New version: %d.%d.%d", new-&gt;major, new-&gt;minor, new-&gt;patch);<br/>        semver_free(new);<br/>    }<br/>    ESP_ERROR_CHECK(ghota_update(ghota_client));<br/>    ESP_ERROR_CHECK(ghota_free(ghota_client));</span></pre><p id="f169" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是全部了！您的 ESP32 项目现在将自动检查固件更新，并在您指定的 GitHub 存储库中有新版本可用时通过无线方式自我更新</p><h2 id="6110" class="ln lo in bd lp lq lr dn ls lt lu dp lv jv lw lx ly jz lz ma mb kd mc md me mf bi translated">结论</h2><p id="2792" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">总之，esp_ghosta 对于任何希望向他们的 ESP32 项目添加 OTA 更新的人来说都是一个有价值的工具。通过利用 GitHub 版本的强大功能，esp_ghosta 提供了一种简单有效的方法来保持固件最新，而无需物理访问设备。凭借其流 JSON 解析器和对多个文件系统的支持，esp_ghosta 为 ESP32 上的 OTA 更新提供了一个健壮的解决方案。由于 Justin Hammond 提供了示例 GitHub 操作和示例 ESP32 项目，即使对于 ESP32 平台的新手来说，开始使用 esp_ghosta 也很容易。</p></div></div>    
</body>
</html>