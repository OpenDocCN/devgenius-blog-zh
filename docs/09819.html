<html>
<head>
<title>A Gentle Introduction to SQL Indexes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 索引简介</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sql-indexes-2aca38b6cf0a?source=collection_archive---------9-----------------------#2022-09-15">https://blog.devgenius.io/sql-indexes-2aca38b6cf0a?source=collection_archive---------9-----------------------#2022-09-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="41c6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在本文中，我们将对 SQL 索引做一个“温和”的介绍👾</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/763eb7ae7dc82c7719fdc897a741cbf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwJmx_wD0FYHWx42fKfrew.png"/></div></div></figure></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="c63c" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">💭了解索引</h1><p id="2fb5" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">索引用于对数据进行逻辑排序，以加快搜索和排序操作。想象一本书开头的索引，以便更好地理解索引。</p><p id="cb12" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">假设你希望在本书中找到单词<em class="mo">奶酪蛋糕</em>的每个实例。最简单的方法是从第一页开始，扫描每一页的每一行寻找匹配。虽然这可行，但显然不是一个可行的选择。</p><p id="d1db" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">虽然扫描几页文本是可能的，但扫描整本书是不可能的。随着要搜索的文本量的增长，查找所需信息所需的时间也在增长。</p><p id="8b82" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">这就是图书索引存在的原因。<em class="mo">索引是按字母顺序排列的单词列表，包括它们在书中出现的位置的参考。要搜索<em class="mo">芝士蛋糕</em>，在<strong class="lp io">索引</strong>中查找，看看它出现在哪些页面上。然后你去那些<em class="mo">特定页面</em>寻找你的匹配。</em></p><h2 id="5daf" class="mp kw in bd kx mq mr dn lb ms mt dp lf lw mu mv lh ma mw mx lj me my mz ll na bi translated">🥸:指数是如何工作的？</h2><p id="c62d" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">简单的说，就是事实，就是正确的<strong class="lp io">排序</strong>。在一本书里找单词的问题不是必须搜索的<em class="mo">内容</em>的数量；而是内容没有按单词排序。如果内容以字典的方式排序，则不需要索引(这就是字典没有索引的原因)。</p><p id="d40d" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><em class="mo">数据库索引</em>功能类似。主键数据总是按<strong class="lp io"/><strong class="lp io">排序</strong>；这是 DBMS 为您执行的操作。因此，通过主键检索特定的行总是一个快速有效的操作。</p><p id="4dbd" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">但是，在其他列中搜索值通常效率很低。例如，如果您想检索居住在某个州的所有客户机，该怎么办呢？因为表不是按州排序的，所以 DBMS 必须读取表中的每一行(从第一行开始)来寻找匹配，就像您试图在一本没有索引的书中发现单词一样。</p><p id="d898" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">解决方案是使用一个<strong class="lp io">索引</strong>。您可以在一个或多个列上创建一个索引，以保存一个排序的内容列表供您自己使用。定义索引后，DBMS 使用它的方式与使用图书索引的方式相同。它扫描已排序的索引以查找任何匹配，然后检索那些特定的行。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="9d7f" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">🫥什么是索引？</h1><p id="42f6" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated"><em class="mo">索引是基于各种字段对大量记录进行排序的方法</em>。当您在表中的字段上构造索引时，您创建了另一个数据结构，它包含字段值以及指向与之相关的记录的指针。然后这个索引结构被排序，使得二进制搜索成为可能。</p><blockquote class="nb"><p id="ff1e" class="nc nd in bd ne nf ng nh ni nj nk mi dk translated">井在“通用”索引中是一个<code class="fe nl nm nn no b">B-tree</code>或<code class="fe nl nm nn no b">Hash table</code>。</p></blockquote><p id="f3f1" class="pw-post-body-paragraph ln lo in lp b lq np jo ls lt nq jr lv lw nr ly lz ma ns mc md me nt mg mh mi ig bi translated">b 树是索引的最优选的数据结构，因为它们是时间高效的——查找、删除和插入都可以在对数时间内完成。B 树被更广泛使用的另一个重要原因是存储在 B 树中的数据可以被排序。通常，RDBMS 决定索引使用哪种数据结构。然而，使用一些 RDBMSs，您实际上可以在构建索引时选择希望数据库使用的任何数据结构。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="396f" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">↔️指数类型</h1><ol class=""><li id="6085" class="nu nv in lp b lq lr lt lu lw nw ma nx me ny mi nz oa ob oc bi translated"><strong class="lp io">聚集</strong>索引创建行的物理顺序(它只能是一行，通常也是一个主键——如果在数据库上创建一个主键，也要在那个表上构建一个聚集索引)。</li><li id="59e7" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated"><strong class="lp io">非聚集</strong>索引也是一个二叉树，但是它不创建行的物理顺序。所以非聚集索引的叶节点包含 PK(如果存在)或行索引。</li><li id="5298" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated"><strong class="lp io">唯一/非唯一</strong>索引是一种通过确保表中没有两行数据具有相同键值来帮助维护数据完整性的索引。<br/>唯一索引确保索引键列中的值是唯一的。<br/> <em class="mo">一个漂亮的信息:(当一个 unique 约束被创建时，一个相应的 unique 索引被自动创建在列上。)</em></li><li id="7c7a" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated"><strong class="lp io">分区和非分区索引<br/> </strong> <em class="mo">在分区表上构造非分区索引时，会创建一个</em> <strong class="lp io"> <em class="mo">单索引对象</em> </strong> <em class="mo">，使</em> <strong class="lp io"> <em class="mo">引用</em> </strong> <em class="mo">到表中的所有行。不管表数据分区是否跨越</em> <strong class="lp io"> <em class="mo">几个</em> </strong> <em class="mo">表空间，未分区的索引总是在单个</em><strong class="lp io"><em class="mo"/></strong><em class="mo">表空间中创建。</em></li><li id="a98f" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated"><strong class="lp io">双向索引</strong>允许正向和反向扫描。<br/> <em class="mo">当您在未指定任何关键字或 ASC 关键字的情况下对列构建索引时，数据库服务器会按升序保存键值。当指定 DESC 关键字时，数据库服务器按降序保存键值。</em></li><li id="ac68" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated"><strong class="lp io">基于表达式的索引(</strong>基于函数的索引)你可以创建一个包含表达式的索引。当 dbms 在相同的表达式上创建索引时，包含表达式的查询的性能会提高。<br/> <em class="mo">例如，您可以通过将函数 higher/lower 应用于 city 列来创建一个索引，以便快速、不区分大小写地查找城市名称。</em></li></ol></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h2 id="4672" class="mp kw in bd kx mq mr dn lb ms mt dp lf lw mu mv lh ma mw mx lj me my mz ll na bi translated">👾例如，我们想要运行一个查询来查找位于'<em class="oi">约旦</em>'的任何学校的所有详细信息？</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oj"><img src="../Images/b67fe24c777a2fd06afc62710e30347e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHcuLDkN5eWcb8YI_61K5A.png"/></div></div></figure><h2 id="867d" class="mp kw in bd kx mq mr dn lb ms mt dp lf lw mu mv lh ma mw mx lj me my mz ll na bi translated">🤨让我们考虑一下如果没有索引会发生什么。</h2><p id="9283" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">DBMS 必须检查学校数据库中的每一行，以确定该行的<em class="mo">位置</em>是否为“<em class="mo">约旦</em>”而且，因为我们希望每一行都有<em class="mo">位置</em> ' <em class="mo">约旦</em>'，所以我们不能在找到一行有<em class="mo">位置</em> ' <em class="mo">约旦</em>'时就停止查找，因为可能还有其他行有<em class="mo">位置约旦</em>。因此，必须搜索直到最后一行的每一行，这意味着数据库必须在这种情况下分析数千行，以发现具有<em class="mo">位置</em> ' <em class="mo">约旦</em>'的行这就是所谓的<strong class="lp io">全表扫描</strong>。</p><h2 id="83d1" class="mp kw in bd kx mq mr dn lb ms mt dp lf lw mu mv lh ma mw mx lj me my mz ll na bi translated">😶‍🌫️What 到底包含在一个 db 索引里面？</h2><p id="2700" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">现在您知道了数据库索引是在表中的一列上创建的，并且索引保存了该特定列中的值。然而，注意数据库索引<strong class="lp io">不存储同一个表的其他列中的值</strong>是很重要的。例如，如果我们在<em class="mo">位置</em>列上建立一个索引，其他列的值将不会保存在索引中。如果我们简单地将所有其他列存储在索引中，这与复制整个表是一样的，会占用太多的空间，造成浪费。</p><h2 id="dbe3" class="mp kw in bd kx mq mr dn lb ms mt dp lf lw mu mv lh ma mw mx lj me my mz ll na bi translated">😐数据库如何知道何时使用索引？</h2><p id="1519" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">当执行类似“<em class="mo">SELECT * FROM School WHERE location = ' Jordan '”</em>的查询时，数据库将检查所请求的列上是否有索引。假设<em class="mo">位置</em>列有一个索引，数据库必须评估利用索引查找被搜索的值是否有意义——因为在某些情况下，使用数据库索引实际上不如简单地扫描整个表有效。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="b68b" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">🫡创建指数</h1><p id="8f7d" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">这是基本的创建索引命令。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/6ef93586ab567d3c3af25ca565a51476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmuU06nuZvpUrnpBno6W0A.png"/></div></div></figure><p id="ba71" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">您可以创建一个唯一索引<strong class="lp io">来防止重复值被添加到表中。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/229b8b5a2090ce7564960424bc2a0ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwkfBQZtiJhUP9BV5j54Vw.png"/></div></div></figure><p id="69f8" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">您还可以创建一个<strong class="lp io">复合索引</strong>(一个表的两列或更多列)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/97efecaa2300de63b72b71564bfa3a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjISZPqGQHAH4FnWuq6V6g.png"/></div></div></figure><blockquote class="nb"><p id="ba41" class="nc nd in bd ne nf on oo op oq or mi dk translated">索引是用<code class="fe nl nm nn no b">CREATE INDEX</code>语句创建的(从一个 DBMS 到另一个 DBMS 有很大的不同)，所以我建议查看您的 DBMS 文档来创建索引。</p></blockquote></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="7659" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">⚠️指数警告⚠️</h1><ol class=""><li id="b8c4" class="nu nv in lp b lq lr lt lu lw nw ma nx me ny mi nz oa ob oc bi translated">索引提高了检索性能，同时降低了数据插入、修改和删除的性能。当执行这些操作时，DBMS 必须动态更新索引。</li><li id="3ef1" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated">索引数据会占用大量存储空间。</li><li id="8d4b" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated">并非所有数据都适合索引。不够唯一的数据(例如，州)不会像具有更多可能值(例如，名或姓)的数据那样从索引中受益。</li><li id="a241" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated">索引用于数据过滤和排序。如果您经常以特定的顺序排列数据，该数据可能适合索引。</li><li id="bbc5" class="nu nv in lp b lq od lt oe lw of ma og me oh mi nz oa ob oc bi translated">一个索引可以有多列(例如，地区和城市)。只有当数据按地区和城市分类时，这样的指数才有用。(如果你希望按城市排序，这个索引是没有用的。)</li></ol></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><blockquote class="nb"><p id="9983" class="nc nd in bd ne nf ng nh ni nj nk mi dk translated">我希望你觉得这篇文章很有趣！❤️</p></blockquote></div></div>    
</body>
</html>