<html>
<head>
<title>Designing Symfony Validator the TDD way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 TDD 方法设计 Symfony 验证器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/designing-a-symfony-validator-the-tdd-way-8cded85e88d1?source=collection_archive---------1-----------------------#2022-01-28">https://blog.devgenius.io/designing-a-symfony-validator-the-tdd-way-8cded85e88d1?source=collection_archive---------1-----------------------#2022-01-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e16e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何在 PHP 中应用测试驱动开发技术的实例。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/df428b90c6d01db9ee598c11c17f6e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z99nP-xLCrAUvrPxp8YysQ.jpeg"/></div></div></figure><p id="dc8c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你熟悉测试驱动开发吗？你们大多数人可能都是。著名的马丁·福勒在他的网站上对<em class="lk"> TDD </em>方法<a class="ae ll" href="https://martinfowler.com/bliki/TestDrivenDevelopment.html" rel="noopener ugc nofollow" target="_blank">有一个很好的定义:</a></p><blockquote class="lm ln lo"><p id="280f" class="ko kp lk kq b kr ks jo kt ku kv jr kw lp ky kz la lq lc ld le lr lg lh li lj ig bi translated">测试驱动开发(TDD)是一种构建软件的技术，它通过编写测试来指导软件开发。它是由 Kent Beck 在 20 世纪 90 年代后期开发的，是极限编程的一部分。本质上，你重复遵循三个简单的步骤:</p><p id="acf9" class="ko kp lk kq b kr ks jo kt ku kv jr kw lp ky kz la lq lc ld le lr lg lh li lj ig bi translated">1.为您想要添加的下一个功能编写一个测试。<br/> 2。编写功能代码，直到测试通过。<br/> 3。重构新旧代码，使其结构良好。</p></blockquote><p id="3a5b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你可能会问，这种技术实际上有用吗？确实是！总之在某些情况下。当我要写一段包含了大量输入数学运算的代码时，我个人总是遵循这个策略。</p><p id="770f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一个完美的例子是任何种类的计算器。例如，增值税计算器。我们可以从一个测试开始:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="0657" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了正确应用 TDD，我们应该:</p><ol class=""><li id="345c" class="lu lv in kq b kr ks ku kv kx lw lb lx lf ly lj lz ma mb mc bi translated">执行测试并确保它没有通过，</li><li id="ab35" class="lu lv in kq b kr md ku me kx mf lb mg lf mh lj lz ma mb mc bi translated">编写代码，让这个测试尽可能快地变绿</li><li id="18a1" class="lu lv in kq b kr md ku me kx mf lb mg lf mh lj lz ma mb mc bi translated">最后，重构它，使代码美观且易于理解</li></ol></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="525c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi mp translated">真正的交易！让我们改变一下，写点有用的东西吧。我们的产品负责人将一项任务放在了待办事项中。他说我们公司页面的注册表格很糟糕，因为每当有人想要注册，而他已经注册了，就会显示一个令人讨厌的错误页面。他想阻止这一点，而是描绘了一个错误，即“电子邮件地址已被占用”。</p><p id="7b98" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">由于用于注册的对象是一个表单使用的简单 DTO，我们将添加一个新的注释约束和一个伴随的验证器。让我们把这个约束叫做<em class="lk">EmailAddressNotRegistered</em>。</p><p id="da49" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们从一系列的单元测试开始，然后我们希望发生什么。由于验证器需要访问数据库，我们将模拟用户存储库并注入一个假对象——用户存储库的内存实现。要求以下功能:</p><ul class=""><li id="de04" class="lu lv in kq b kr ks ku kv kx lw lb lx lf ly lj my ma mb mc bi translated">它不能允许已经注册的电子邮件地址</li><li id="f3b6" class="lu lv in kq b kr md ku me kx mf lb mg lf mh lj my ma mb mc bi translated">它也不能允许已经注册的地址的别名</li><li id="198a" class="lu lv in kq b kr md ku me kx mf lb mg lf mh lj my ma mb mc bi translated">它必须允许未注册的电子邮件</li><li id="5cc5" class="lu lv in kq b kr md ku me kx mf lb mg lf mh lj my ma mb mc bi translated">它必须允许软删除用户的注册电子邮件</li></ul><p id="349d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">编写以下单元测试是为了确保该类符合这些要求。我使用了 Symfony 的<code class="fe mz na nb nc b">ConstraintValidatorTestCase</code>,它允许简单的验证器测试:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="974b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们执行了这个测试，结果失败了。果然，我们仍然没有约束和验证器:</p><pre class="kd ke kf kg gt nd nc ne nf aw ng bi"><span id="f9e8" class="nh ni in nc b gy nj nk l nl nm">PHPUnit 8.5.23 by Sebastian Bergmann and contributors.</span><span id="38d0" class="nh ni in nc b gy nn nk l nl nm">EEEE                                                                4 / 4 (100%)</span><span id="7dfe" class="nh ni in nc b gy nn nk l nl nm">Time: 34 ms, Memory: 4.00 MB</span></pre><p id="96c1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们需要约束:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="02cc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">和验证器来确保测试尽可能轻松地通过:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="9b99" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们现在运行测试套件时:</p><pre class="kd ke kf kg gt nd nc ne nf aw ng bi"><span id="8ba2" class="nh ni in nc b gy nj nk l nl nm">....                                                    4 / 4 (100%)</span><span id="bf92" class="nh ni in nc b gy nn nk l nl nm">Time: 34 ms, Memory: 4.00 MB</span><span id="9002" class="nh ni in nc b gy nn nk l nl nm">OK (4 tests, 6 asto easily test a validator:sertions)</span></pre><p id="51b0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们是绿色的！现在让我们也重构代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="06ff" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最终测试套件运行，以及…</p><pre class="kd ke kf kg gt nd nc ne nf aw ng bi"><span id="6098" class="nh ni in nc b gy nj nk l nl nm">....                                                   4 / 4 (100%)</span><span id="aa3c" class="nh ni in nc b gy nn nk l nl nm">Time: 37 ms, Memory: 4.00 MB</span><span id="229d" class="nh ni in nc b gy nn nk l nl nm">OK (4 tests, 6 assertions)</span></pre><p id="bc74" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，我们可以在注册 DTO 上安全地使用此约束，并将任务标记为完成。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="d208" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">希望这能让我们的产品负责人感到高兴。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8e115c6f8dc32ff69b4dab4df0327198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*z_q20zQItwP-JnaaqTAjig.jpeg"/></div></figure><p id="581f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">顺便说一下，代码发布在了 GitHub 的一个库上。如果你有 Docker，你可以立刻运行整个测试套件。编码快乐！</p><p id="c11c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">赞美诗我使用的编码技术在下面的出版物中有描述，请务必阅读:</p><div class="np nq gp gr nr ns"><a rel="noopener  ugc nofollow" target="_blank" href="/clean-code-tricks-in-php-everyone-should-follow-f9d7aa3abe44"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd io gy z fp nx fr fs ny fu fw im bi translated">PHP 中每个人都应该遵循的干净代码技巧</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">用这几个简单的技巧彻底改进你的代码。今天我想和你分享我的编码技术。</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">blog.devgenius.io</p></div></div><div class="ob l"><div class="oc l od oe of ob og km ns"/></div></div></a></div></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="d5a6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">快速提问:</strong>这个故事<em class="lk">对你有价值吗</em>？请留下<strong class="kq io">的掌声</strong>以示感谢，支持我的工作。谢谢你。</p></div></div>    
</body>
</html>