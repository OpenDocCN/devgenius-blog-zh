<html>
<head>
<title>How to use WebAssembly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 WebAssembly</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-webassembly-c021184c6834?source=collection_archive---------2-----------------------#2022-07-31">https://blog.devgenius.io/how-to-use-webassembly-c021184c6834?source=collection_archive---------2-----------------------#2022-07-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a14b2df355264f19c41c5af35be7fe19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cEyB_-1TFsEbheHI.png"/></div></div></figure><h1 id="69d6" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">目的</h1><p id="cec6" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">当我读了几篇关于 WebAssembly 可以取代 JavaScript 作为浏览器语言的文章时，我对这项技术很感兴趣，我将与您分享。</p><h1 id="5e89" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">什么是 WebAssembly？为什么这很有用？</h1><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="fb95" class="ma jw in lw b gy mb mc l md me">WebAssembly (abbreviated Wasm) is a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable target for compilation of high-level languages like C/C++/Rust, enabling deployment on the web for client and server applications.</span></pre><p id="5830" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">以上句子摘自官方指南。基本上这不是一种编程语言，而是一种二进制指令格式。正如这个定义所提到的，我们也可以在服务器应用程序上使用 Wasm，但是为了简单起见，我将重点放在客户端，尤其是浏览器上。</p><p id="1ce7" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">JavaScript 在浏览器上非常有用，但如今 web 开发变得越来越复杂，所以 Wasm 来了。例如，我们需要专注于视频、3d 游戏、浏览器上的图像识别。当然，JavaScript 也变得更快了，比如引入了即时方法，但是它们在处理编译类型方面也有一些缺点。从 2013 年开始，asm.js 作为 JavaScript 子集被 Mozilla 发明。该子集允许在调用本机代码之前编译本机代码，以便在浏览器上更快地运行本机代码。听起来很好，但 asm.js 使文件大小变得更大，这就是为什么 Wasm 是从 2015 年发明的。</p><p id="3093" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">由于 Wasm 被定义为一个低级模块，这就不受 JavaScript 函数的限制并充分利用 CPU 的能力。此外，这种格式不依赖于操作系统，所以这是工作在 Windows，Mac，Linux，以及移动正确。特别是在移动设备上，因为与 PC 相比，移动设备通常没有很好的 CPU 能力，如果您需要复杂但需要的 CPU 能力，Wasm 是一个很好的解决方案。这种格式的主要缺点是他们不能直接管理 DOM，尽管这种格式允许我们导入和使用它(在未来，这种情况是无法改变的)。</p><p id="21d7" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">那么，Wasm 会取代 JavaScript 吗？实际上不是，因为这种格式是为了赞美 JavaScript 而发明的，而不是为了取代它。一些公司试图用 Rust 替代 Wasm 中的 JavaScript，这并不是预期的结果，它比 JavaScript 快 10 倍。换句话说，JavaScript 对于基本、简单、普通的应用程序来说已经足够快了，因为 Wasm 不直接管理 DOM，所以 Wasm 应该多次接触 JavaScript，这需要很多时间。那么，Wasm 的用例是什么？例如，您需要相当丰富但必要的 CPU 能力，或者您需要通过浏览器上的机器学习来实现图像识别，或者您需要高性能来在浏览器上运行游戏代码。在谷歌，Wasm 用于谷歌地球和谷歌会议模糊背景。</p><p id="7d28" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">好了，这就足够解释 Wasm 的基本了。让我们深入一个例子来编译 Rust 的一些代码。如果你想了解 Rust 本身，我推荐你看《官方指南》(因为这是易读的好内容)。在安装和基础方面，你可以参考我过去关于 Rust 的文章，因为我简要解释了如何使用 Rust(包括如何设置路径)。</p><h1 id="2c70" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">示例(如何将现有 Rust app 编译成 Wasm)。</h1><h2 id="63fb" class="ma jw in bd jx mk ml dn kb mm mn dp kf le mo mp kj li mq mr kn lm ms mt kr mu bi translated">步伐</h2><ol class=""><li id="731a" class="mv mw in kv b kw kx la lb le mx li my lm mz lq na nb nc nd bi translated">准备一个 Rust app(通过官方指南或者我过去的文章或者任何其他的)。</li><li id="79ec" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq na nb nc nd bi translated">使用 cargo 安装 wasm-pack 作为附加工具</li></ol><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="9cf5" class="ma jw in lw b gy mb mc l md me">&gt; cargo install wasm-pack</span></pre><p id="2713" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">3.按货物创建新项目</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="5948" class="ma jw in lw b gy mb mc l md me">&gt; cargo new --lib hello-wasm // this name is up to you<br/>     Created library `hello-wasm` package</span></pre><p id="98dd" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">下面是项目的结构，你可以看到配置一的 lib.rs 和 Cargo.toml 文件。</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f67252e9d2dc3af872833775c51f5e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/0*ITypp0X428_BJ3gv.png"/></div></figure><p id="b796" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">4.将您的 lib.rs 代码更改为下面的代码。导入 wasm_binden 模块，提供 JavaScript 和 Rust 之间的桥梁，并使用它。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="7274" class="ma jw in lw b gy mb mc l md me">use wasm_bindgen::prelude::*;<br/></span><span id="840a" class="ma jw in lw b gy nk mc l md me">#[wasm_bindgen]<br/>extern {<br/>    pub fn alert(s: &amp;str);<br/>}<br/></span><span id="9ed2" class="ma jw in lw b gy nk mc l md me">#[wasm_bindgen]<br/>pub fn greet(name: &amp;str) {<br/>    alert(&amp;format!("Hello, {}!", name));</span></pre><p id="36f2" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">5.将您的 Cargo.toml 代码更改为以下代码。您也可以添加作者和 github 库，但这不是强制性的。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="7b20" class="ma jw in lw b gy mb mc l md me">[package]<br/>name = "hello-wasm"<br/>version = "0.1.0"<br/>description = "A sample project with wasm-pack"<br/>license = "MIT/Apache-2.0"<br/>edition = "2018"<br/></span><span id="abe6" class="ma jw in lw b gy nk mc l md me">[lib]<br/>crate-type = ["cdylib"]<br/></span><span id="b800" class="ma jw in lw b gy nk mc l md me">[dependencies]<br/>wasm-bindgen = "0.2</span></pre><p id="0439" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">6.使用下面的命令构建您的项目。将你的 Rust 文件编译成 Wasm 并生成一些文件。不要忘记移动您的项目(cd 您的项目名称)</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="f54f" class="ma jw in lw b gy mb mc l md me">wasm-pack build --target web</span></pre><p id="0da9" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">构建之后，您可以看到文件结构发生了变化。有很多像下面这样的文件。</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/97a6f63bc0ae3fbaf482f90260479a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/0*BE6g_HE6q5s2qWc9.png"/></div></figure><p id="c86c" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">7.在根目录下创建 index.html 文件。您可以在任何地方创建这个文件，但是您需要更改文件路径。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="f522" class="ma jw in lw b gy mb mc l md me">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;title&gt;hello-wasm example&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;script type="module"&gt;<br/>      import init, { greet } from "./pkg/hello_wasm.js";<br/>      init().then(() =&gt; {<br/>        greet("WebAssembly");<br/>      });<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="028e" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">8.在本地服务器上运行这个 index.html 文件。如果使用 VS 代码，可以使用 Live 服务器扩展。或者，您可以使用 python 服务器执行以下命令。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="88bc" class="ma jw in lw b gy mb mc l md me">&gt; python3 -m http.server<br/>Serving HTTP on :: port 8000 (http://[::]:8000/) ...</span></pre><p id="84eb" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">9.如果使用 python 服务器，需要访问“localhost:8000”。您无需自己编写任何 JavaScript 代码就可以看到警报代码。厉害！</p><figure class="lr ls lt lu gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/e58d348abd39fc65dfd48bcf35e3059b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HSnov_yatGz6zBSp.png"/></div></div></figure><h1 id="87c4" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="48c0" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">正如我提到的，WebAssembly 是在浏览器上编译本机代码的一种非常有用的格式。您不需要自己编写任何 JavaScript 代码，而且基本上比 JavaScript 快(这取决于您的环境和代码)。如果你想创建一些功能或应用程序，需要大量的 CPU 能力，如丰富的动画或浏览器上的图像识别，Wasm 会帮助你。</p><h1 id="5be2" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">参考</h1><ul class=""><li id="f960" class="mv mw in kv b kw kx la lb le mx li my lm mz lq nn nb nc nd bi translated">官方网站:<a class="ae no" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank">https://webassembly.org/</a></li><li id="8cc1" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq nn nb nc nd bi translated">https://developer.mozilla.org/en-US/docs/WebAssembly<a class="ae no" href="https://developer.mozilla.org/en-US/docs/WebAssembly" rel="noopener ugc nofollow" target="_blank"/></li><li id="663a" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq nn nb nc nd bi translated">将 Rust 编译成 web assembly:<a class="ae no" href="https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/web assembly/Rust _ to _ wasm</a></li><li id="286f" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq nn nb nc nd bi translated">什么是 WebAssembly？下一代网络平台讲解:<a class="ae no" href="https://www.infoworld.com/article/3291780/what-is-webassembly-the-next-generation-web-platform-explained.html" rel="noopener ugc nofollow" target="_blank">https://www . infoworld . com/article/3291780/what-is-web assembly-the-next-generation-we B- platform-explained . html</a></li><li id="09f2" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq nn nb nc nd bi translated">https://qiita.com/ShuntaShirai/items/3ac92412720789576f22<a class="ae no" href="https://qiita.com/ShuntaShirai/items/3ac92412720789576f22" rel="noopener ugc nofollow" target="_blank">webassemblyとは:</a></li><li id="6126" class="mv mw in kv b kw ne la nf le ng li nh lm ni lq nn nb nc nd bi">出来ることは計算だけ？ 「WebAssembly」は一体何が新しいのか？: <a class="ae no" href="https://mixil.mixi.co.jp/people/12242" rel="noopener ugc nofollow" target="_blank">https://mixil.mixi.co.jp/people/12242</a></li></ul><p id="f7c6" class="pw-post-body-paragraph kt ku in kv b kw mf ky kz la mg lc ld le mh lg lh li mi lk ll lm mj lo lp lq ig bi translated">感谢您的阅读！！</p></div></div>    
</body>
</html>