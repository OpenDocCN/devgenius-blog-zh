<html>
<head>
<title>MySQL Backup Tool You Have Never Heard About</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你从未听说过的 MySQL 备份工具</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mysql-backup-tool-you-have-never-heard-about-3df35f7f0b6d?source=collection_archive---------11-----------------------#2022-09-12">https://blog.devgenius.io/mysql-backup-tool-you-have-never-heard-about-3df35f7f0b6d?source=collection_archive---------11-----------------------#2022-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4fe4" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用这个工具可以高效地备份您的 MySQL 数据库，而不会出现任何停机</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/50e1bea2d9f70b9c6e3010fa57750a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ZHY1idP8YMn8NbKdAciNA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com/@diesektion" rel="noopener ugc nofollow" target="_blank">罗伯特·阿纳奇</a>在 Unsplash 上拍摄。编辑于<a class="ae ks" href="https://pixlr.com" rel="noopener ugc nofollow" target="_blank"> Pixlr </a></figcaption></figure><p id="1b43" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您是否曾经不得不备份您的 MySQL 服务器数据？如果是这样，您可能已经使用了流行的 mysqldump 实用程序。</p><p id="4b10" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天，我们将借助一款鲜为人知且完全免费的软件——<strong class="kv io">Percona xtra backup</strong>；来自著名的 MariaDB 数据库的制作者。</p></div><div class="ab cl lq lr hr ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ig ih ii ij ik"><p id="bb9b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">mysqldump 是一个简单的数据到文本的转储工具。除了以文本形式保存的表中的数据，该文件还将包含 DDL 操作(即“创建表”)和 DML 操作(“插入”)形式的 SQL 查询。</p><p id="4ed5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">mysqldump 可能适合小项目。<strong class="kv io">然而，在较大的应用程序中，事务处理的问题越来越多</strong>。</p><p id="6312" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">想象一个 SaaS 应用程序出售对它的访问权。有一个用于用户帐户的“用户”表，由会计域使用，还有一个用于支付域的“发票”表。当一个新客户注册时，一个账户被创建，并且在短暂的片刻之后一张发票被发出。</p><p id="75e1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们运行 mysqldump，是在半夜凌晨 3 点，这个时候应用的使用率最低。不幸的是(或者不是)，就在这个时候，一个新的客户在这个过程中注册了！</p><p id="51c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">可能会发生他的用户账号<strong class="kv io">不在【用户】表</strong>中，但是在【发票】表<strong class="kv io">中会有发票</strong>。</p><p id="8792" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“user”表中的数据已经被转储，但是注册发生在导出“invoice”表之前。</p><p id="63d7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这种事件的可能性随着时间的推移而增加。并且越频繁的数据写操作越有可能。试图从这样的转储中恢复数据库会导致错误。更不用说数据丢失了。</p><p id="4a58" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了避免事务错误，在用<code class="fe lx ly lz ma b">mysqldump</code>导出时，我们应该使用<code class="fe lx ly lz ma b">--single-transaction</code>标志(对于 InnoDB)。但是，使用此标志会在导出过程中阻止写操作。</p><p id="21b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于商业决策的原因，它的使用在某些时候可能是不可能的。毕竟，我们希望新客户随时注册。</p><h1 id="99e8" class="mb mc in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">制作更好的备份</h1><p id="c0e8" class="pw-post-body-paragraph kt ku in kv b kw mt jo ky kz mu jr lb lc mv le lf lg mw li lj lk mx lm ln lo ig bi translated">此时<a class="ae ks" href="https://docs.percona.com/percona-xtrabackup/2.4/backup_scenarios/full_backup.html#preparing-a-backup" rel="noopener ugc nofollow" target="_blank"> Percona XtraBackup </a>前来救援。它是一个允许您生成所谓的“热数据备份”的工具，而无需停止数据库或阻止表写入。</p><blockquote class="my"><p id="4914" class="mz na in bd nb nc nd ne nf ng nh lo dk translated">警告:目前<a class="ae ks" href="https://docs.percona.com/percona-xtrabackup/8.0/" rel="noopener ugc nofollow" target="_blank"> XtraBackup 由于 InnoDB 引擎的变化而无法与 MySQL 版本 8.0.20 </a>兼容</p></blockquote><p id="ee8f" class="pw-post-body-paragraph kt ku in kv b kw ni jo ky kz nj jr lb lc nk le lf lg nl li lj lk nm lm ln lo ig bi translated">它甚至可以动态生成增量备份、压缩和加密备份；它有很多其他方便的特性，我不打算在这里介绍。</p><p id="e492" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">自 2012 年以来，我一直使用这个工具来备份一个大型 MySQL 服务器，其中包含我所在公司的几十个大型客户数据库。它仍然工作，每天在 CRON 中运行。</p><p id="8727" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它可以在 Linux 下运行，但是也可以在其他平台上运行，比如 Docker / Windows WSL 等等。我不打算介绍该工具的所有特性，因为这需要专门的出版物。</p><h1 id="93a7" class="mb mc in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">演示应用程序</h1><p id="631c" class="pw-post-body-paragraph kt ku in kv b kw mt jo ky kz mu jr lb lc mv le lf lg mw li lj lk mx lm ln lo ig bi translated">我已经创建了一个演示操场知识库，并在 GitHub 上开源:<a class="ae ks" href="https://github.com/dotcom-poland/xtrabackup-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/dotcom-poland/xtrabackup-demo</a></p><blockquote class="my"><p id="7976" class="mz na in bd nb nc nd ne nf ng nh lo dk translated">演示假设您已经安装了<em class="nn"> Docker </em>。不使用<em class="nn"> Docker </em>的话就要开始了。相信我，这个决定<strong class="ak">会改变你的人生</strong>。</p></blockquote><p id="a67f" class="pw-post-body-paragraph kt ku in kv b kw ni jo ky kz nj jr lb lc nk le lf lg nl li lj lk nm lm ln lo ig bi translated">演示很简单。只有几个命令:</p><ol class=""><li id="9884" class="no np in kv b kw kx kz la lc nq lg nr lk ns lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make start</code>创建项目</li><li id="e05c" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make list_customers</code>将客户转储到控制台</li><li id="653f" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make backup</code>创建备份</li><li id="b04b" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make corrupt</code>损坏数据库！</li><li id="eaca" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make list_customers</code>试图再次甩掉顾客</li><li id="8680" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make restore</code>从备份中恢复数据库</li><li id="6999" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated"><code class="fe lx ly lz ma b">make list_customers</code>验证客户是否已恢复</li><li id="81c5" class="no np in kv b kw nx kz ny lc nz lg oa lk ob lo nt nu nv nw bi translated">停下来打扫一切</li></ol></div><div class="ab cl lq lr hr ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ig ih ii ij ik"><p id="ab82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你会尝试一下吗？这是值得的。该文件可在<a class="ae ks" href="https://docs.percona.com/percona-xtrabackup/2.4/" rel="noopener ugc nofollow" target="_blank">Percona.com</a>获得。如果你有任何问题，请给我留言。下次见。</p></div></div>    
</body>
</html>