<html>
<head>
<title>Laravel-Excel — P6: Batch Imports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">laravel-Excel-P6:批量导入</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-excel-p6-batch-imports-261c80e46448?source=collection_archive---------8-----------------------#2022-10-06">https://blog.devgenius.io/laravel-excel-p6-batch-imports-261c80e46448?source=collection_archive---------8-----------------------#2022-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7a7a673ea4981ff0a75d65932779b093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QzIs1B8RrZn9nTIg89N2eQ.jpeg"/></div></div></figure><p id="1041" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，当我们将 excel 表导入数据库时，我们所做的是为每一行创建一个导入:每次都会发生一个实际的插入查询。如果我们有 1000 行呢？没错:将会发生 1000 次插入查询。Laravel 允许批量插入，Laravel-Excel 支持这种形式的插入。如果将批处理大小设置为 100，这意味着只发生 10 次查询，而不是 1000 次。</p><p id="7ea7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">批量插入限制了查询次数，提高了速度。要在单个批处理中插入的行数将视具体情况而定。开始试验要导入的行数，看看什么有效。1000 行的批处理大小可能不是最终的解决方案。这实际上取决于多种因素，比如每行处理的数据量。</p><div class="kw kx gp gr ky kz"><a href="https://dinocajic.medium.com/laravel-excel-p5-importing-sheets-with-formulas-4016dcc68862" rel="noopener follow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">Laravel-Excel — P5:导入带有公式的工作表</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">在导入 excel 表格时要注意的最后一件事是，公式通常不会像您预期的那样运行…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">dinocajic.medium.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="521f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">实现批量插入</h1><p id="916e" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">要实现批量插入，Laravel-Excel 只需要<code class="fe mr ms mt mu b">WithBatchInserts</code>关注点和需要的方法<code class="fe mr ms mt mu b">batchSize</code>。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c33a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。Laravel-Excel 让它变得超级简单。让我们在我们的<code class="fe mr ms mt mu b">UserController</code>和我们的路线中创建方法，以便我们可以测试。我使用了下面的<a class="ae nb" href="https://gist.github.com/dinocajic/ba325bd291c79b8029628adaa2603bec" rel="noopener ugc nofollow" target="_blank">模拟数据</a>。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="605a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行导入产生了我们想要的结果。</p><h1 id="44dc" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">插入新的和更新现有的</h1><p id="073c" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们还可以实现导入新项目但更新现有项目的功能。例如，<code class="fe mr ms mt mu b">email</code>字段是<code class="fe mr ms mt mu b">users</code>表中的唯一字段。如果<code class="fe mr ms mt mu b">email</code>存在，更新该条目的内容，否则插入它。</p><p id="3f75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了获得这个功能，我们实现了<code class="fe mr ms mt mu b">WithUpserts</code>关注点，并指定哪个字段在<code class="fe mr ms mt mu b">uniqueBy</code>方法中是惟一的。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a3e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在不清除您的<code class="fe mr ms mt mu b">users</code>表的情况下，再次运行您的导入，并查看它是否没有中断。如果您更新了任何字段，如名字或姓氏，这些字段将被更新。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/dinocajic/package-laravel-excel" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-dinocajic/package-Laravel-Excel:显示了 Laravel Excel 的示例功能</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">Laravel 是一个 web 应用程序框架，具有丰富、优雅的语法。我们相信发展必须是令人愉快的…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="nc l lk ll lm li ln jw kz"/></div></div></a></div></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/63f574d211354528afd1c653ac542fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Ol-g28fnuBRf3Zy.jpeg"/></div></figure><p id="6461" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡伊奇目前是<a class="ae nb" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(生命周期生物科学公司)</a>、<a class="ae nb" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae nb" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae nb" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物</a>、<a class="ae nb" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae nb" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="e8c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae nb" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae nb" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae nb" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="15c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae nb" href="https://dinocajic.medium.com/membership" rel="noopener"> <em class="nl">阅读迪诺·卡吉克(以及媒体上成千上万其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。</em> </a></p></div></div>    
</body>
</html>