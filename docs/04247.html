<html>
<head>
<title>Gatsby.js — Custom RSS Feed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —自定义 RSS 源</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-custom-rss-feed-68ebb267a1d7?source=collection_archive---------6-----------------------#2021-02-15">https://blog.devgenius.io/gatsby-js-custom-rss-feed-68ebb267a1d7?source=collection_archive---------6-----------------------#2021-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/57609869a4285c901a41fd04e02da6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HrTyiDvfclAORnY1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@andriklangfield?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Andrik Langfield </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b9c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby 是一个基于 React 的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Gatsby 创建一个站点。</p><h1 id="502a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自定义 RSS 源</h1><p id="d396" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过在<code class="fe me mf mg mh b">gatsby-config.js</code>中添加更多插件选项来定制我们的 RSS 提要。</p><p id="cacc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="4c58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d83c" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [<br/>    `gatsby-transformer-remark`,<br/>    {<br/>      resolve: `gatsby-plugin-feed`,<br/>      options: {<br/>        query: `<br/>          {<br/>            site {<br/>              siteMetadata {<br/>                title<br/>                description<br/>                siteUrl<br/>                site_url: siteUrl<br/>              }<br/>            }<br/>          }<br/>        `,<br/>        feeds: [<br/>          {<br/>            serialize: ({ query: { site, allMarkdownRemark } }) =&gt; {<br/>              return allMarkdownRemark.edges.map(edge =&gt; {<br/>                return Object.assign({}, edge.node.frontmatter, {<br/>                  description: edge.node.excerpt,<br/>                  date: edge.node.frontmatter.date,<br/>                  url: site.siteMetadata.siteUrl + edge.node.fields.slug,<br/>                  guid: site.siteMetadata.siteUrl + edge.node.fields.slug,<br/>                  custom_elements: [{ "content:encoded": edge.node.html }],<br/>                })<br/>              })<br/>            },<br/>            query: `<br/>              {<br/>                allMarkdownRemark(<br/>                  sort: { order: DESC, fields: [frontmatter___date] },<br/>                ) {<br/>                  edges {<br/>                    node {<br/>                      excerpt<br/>                      html<br/>                      fields { slug }<br/>                      frontmatter {<br/>                        title<br/>                        date<br/>                      }<br/>                    }<br/>                  }<br/>                }<br/>              }<br/>            `,<br/>            output: "/rss.xml",<br/>            title: "Your Site's RSS Feed",<br/>          },<br/>        ],<br/>      },<br/>    },<br/>    {<br/>      resolve: `gatsby-source-filesystem`,<br/>      options: {<br/>        name: `content`,<br/>        path: `${__dirname}/src/content`,<br/>      },<br/>    },<br/>  ],<br/>  siteMetadata: {<br/>    siteUrl: `https://www.example.com`,<br/>  },<br/>}</span></pre><p id="6152" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要<code class="fe me mf mg mh b">siteMetadata.siteUrl</code>来生成 RSS 提要。</p><p id="75e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="582c" class="mq lc iq mh b gy mr ms l mt mu">const path = require("path")<br/>const _ = require("lodash")<br/>const { createFilePath } = require(`gatsby-source-filesystem`)</span><span id="3e4c" class="mq lc iq mh b gy mv ms l mt mu">exports.onCreateNode = ({ node, actions, getNode }) =&gt; {<br/>  const { createNodeField } = actions<br/>  if (node.internal.type === `MarkdownRemark`) {<br/>    const value = createFilePath({ node, getNode })<br/>    createNodeField({<br/>      name: `slug`,<br/>      node,<br/>      value,<br/>    })<br/>  }<br/>}</span><span id="f389" class="mq lc iq mh b gy mv ms l mt mu">exports.createPages = async ({ actions, graphql, reporter }) =&gt; {<br/>  const { createPage } = actions<br/>  const blogPostTemplate = path.resolve("src/templates/post.js")<br/>  const result = await graphql(`<br/>    {<br/>      postsRemark: allMarkdownRemark(<br/>        sort: { order: DESC, fields: [frontmatter___date] }<br/>        limit: 2000<br/>      ) {<br/>        edges {<br/>          node {<br/>            fields {<br/>              slug<br/>            }<br/>            frontmatter {<br/>              tags<br/>            }<br/>          }<br/>        }<br/>      }<br/>      tagsGroup: allMarkdownRemark(limit: 2000) {<br/>        group(field: frontmatter___tags) {<br/>          fieldValue<br/>        }<br/>      }<br/>    }<br/>  `)<br/>  if (result.errors) {<br/>    reporter.panicOnBuild(`Error while running GraphQL query.`)<br/>    return<br/>  }<br/>  const posts = result.data.postsRemark.edges<br/>  posts.forEach(({ node }) =&gt; {<br/>    const slug = node.fields.slug<br/>    createPage({<br/>      path: slug,<br/>      component: blogPostTemplate,<br/>      context: { slug },<br/>    })<br/>  })<br/>}</span></pre><p id="5ae6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/templates/post.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a027" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="b6fe" class="mq lc iq mh b gy mv ms l mt mu">export default function BlogPost({ data }) {<br/>  const post = data.markdownRemark<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;{post.frontmatter.title}&lt;/h1&gt;<br/>      &lt;div dangerouslySetInnerHTML={{ __html: post.html }} /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export const query = graphql`<br/>  query($slug: String!) {<br/>    markdownRemark(fields: { slug: { eq: $slug } }) {<br/>      html<br/>      frontmatter {<br/>        title<br/>      }<br/>    }<br/>  }<br/>`</span></pre><p id="17dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">gatsby-plugin-feed</code>插件添加到<code class="fe me mf mg mh b">gatsby-config.js</code>中。</p><p id="ed97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过运行以下命令来安装插件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d15a" class="mq lc iq mh b gy mr ms l mt mu">npm i gatsby-plugin-feed</span></pre><p id="b14f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在配置文件中添加了一些选项。<code class="fe me mf mg mh b">options.query</code>属性包含 GraphQL 查询获取站点元数据的字符串。</p><p id="a9a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">feeds</code>属性有<code class="fe me mf mg mh b">serialize</code>方法从查询中获取数据，并为检索到的每个条目返回一个对象。</p><p id="54de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">description</code>有帖子的描述。</p><p id="4ca8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">date</code>有发文的日期。</p><p id="803d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">url</code>有帖子的网址。</p><p id="17c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">guid</code>是我们生成的唯一 ID。</p><p id="4f50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">custom_elements</code>有我们想要包含在 RSS 提要中的额外元素。</p><p id="b1bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">feeds.query</code>已经查询得到的帖子。</p><p id="7a65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">output</code>具有 RSS 源文件的路径。</p><p id="f954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">title</code>有提要的标题。</p><p id="688e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">gatsby-node.js</code>中，我们使用 GraphQL 查询来获取 Markdown 帖子，并调用<code class="fe me mf mg mh b">createPage</code>来创建帖子。</p><p id="5482" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">post.js</code>通过从<code class="fe me mf mg mh b">data</code>道具中获取数据来显示帖子。</p><p id="ae94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们运行<code class="fe me mf mg mh b">npm run build</code>时，我们看到生成了<code class="fe me mf mg mh b">public/rss.xml</code>文件。</p><p id="323c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该看到<code class="fe me mf mg mh b">item</code>元素和<code class="fe me mf mg mh b">title</code>、<code class="fe me mf mg mh b">description</code>、<code class="fe me mf mg mh b">link</code>、<code class="fe me mf mg mh b">guid</code>、<code class="fe me mf mg mh b">pubDate</code>以及<code class="fe me mf mg mh b">content:encoded</code>元素。</p><h1 id="ad0a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="81b7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Gatsby 为我们的站点创建一个定制的 RSS 提要。</p></div></div>    
</body>
</html>