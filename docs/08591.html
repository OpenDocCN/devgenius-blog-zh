<html>
<head>
<title>Bringing Python to Browser for Doing Image Processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Python 引入浏览器进行图像处理</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/bringing-python-to-browser-for-doing-image-processing-c34f5bba9c1d?source=collection_archive---------12-----------------------#2022-06-26">https://blog.devgenius.io/bringing-python-to-browser-for-doing-image-processing-c34f5bba9c1d?source=collection_archive---------12-----------------------#2022-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/341a7f69c57b78c012dbd5639d3d6c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NNCF8fqrIUhE6zBp"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kc" href="https://unsplash.com/@remotarjobs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Remotar Jobs </a>拍摄的照片</figcaption></figure><p id="6f81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如今，应用程序或网络应用程序比桌面应用程序更受欢迎。你几乎可以在你的浏览器里做任何事情，不需要安装任何东西。任何用 Javascript 编写的网络应用程序都不需要安装任何额外的软件，这都要归功于 chrome 等应用程序强大的 V8 引擎。但是直到几个月前，只有 JavaScript 是可以用来编写 web 应用程序的语言。在机器学习或图像处理等用例的情况下，单独的服务器用于进行后端处理。在某些情况下，开发人员确实使用 TensorFlow JS 这样的框架来开发这样的应用程序，但 TensorFlow python 版本仍然更成熟，在社区中更受欢迎，因为 python 在该领域很受欢迎。在大多数情况下，API 通常部署在云中，这比完全的本地服务器成本更高，安全性更低。因此，如果我们有一种方法可以在浏览器中运行 python，那就太好了。</p><p id="63ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文解释了如何解决上述问题，我们可以在 Pyscript 的帮助下在浏览器中运行 python。在本文结束时，您将了解如何使用 pyscript 在浏览器中进行图像处理。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="eedb" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">PyScript</h1><p id="6481" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">PySript 是 anaconda 团队开发的一项技术，旨在 web 浏览器中运行 python。它利用 web 程序集来运行 python。我们用 python 写的代码被编译成 web 汇编，由我们的浏览器执行。PyScript 基于 py 碘化物，py 碘化物提供了 Python 的 web 程序集端口。Pyscript 以单个 JS 文件的形式出现，可以添加到网页中，从而加载整个 python 运行时。因为 pyscript 是基于 py 碘化物的，所以可以使用 py 碘化物中的大多数库。目前 pyscript 仍处于开发阶段，因此一些功能可能在未来的版本中无法工作，或者可能以不同的方式工作。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="1980" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">PyScript 的基础知识</h1><p id="ea57" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在开发实际的应用程序之前，让我们学习一些 PyScript 的基础知识。PyScript 可以被认为是一个包含 python 的 HTML 页面，由浏览器运行时环境执行。它是在 HTML 标签的帮助下实现的。</p><p id="ac02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">&lt;py-script&gt;标签</strong></p><p id="6df0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyscript 标签就像任何 HTML 标签一样，以<py-script>开始，以</py-script>结束。在这两者之间，我们编写所有希望在页面打开时执行的 python 代码。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="71c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">&lt;py-env&gt;标签</strong></p><p id="bab0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyscript 标签就像任何 HTML 标签一样，以<py-env>开始，以</py-env>结束。这个标签用于导入我们源代码中使用的外部库。它告诉 py 碘化物环境从源代码中加载列出的库。下面是一个例子，我们想导入外部库<em class="ml"> matplotlib，numpy，imageio 和 scipy。</em></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="e808" class="mv lj iq mr b gy mw mx l my mz">&lt;py-env&gt;<br/>    - matplotlib<br/>    - imageio<br/>    - numpy<br/>    - scipy<br/>&lt;/py-env&gt;</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="a4cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">PyScript 中的 DOM 操作</strong></p><p id="17d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PyScript 可以操作 HTML 文档/网页中的不同对象。python 解释器可以访问页面上的所有对象，如输入按钮、文本区域等。借助 PyScript 的 js 模块中的<em class="ml">元素和文档类，可以访问页面中的对象/元素。下面是一个使用 PyScript 的 DOM 操作功能的例子。</em></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="2b7f" class="mv lj iq mr b gy mw mx l my mz">&lt;py-script&gt;<br/>from js import document</span><span id="06f8" class="mv lj iq mr b gy na mx l my mz">def say_hello(*args,**kwargs):</span><span id="e19b" class="mv lj iq mr b gy na mx l my mz">  name_txt=Element('Name').value<br/>  message_field = document.getElementById("message_txt")<br/>  message_field.value="Hello "+name_txt</span><span id="613c" class="mv lj iq mr b gy na mx l my mz">&lt;/py-script&gt;</span></pre><p id="5eb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的函数中，我们得到了名为<em class="ml">“Name”和</em>的文本字段中包含的值，然后用它附加 hello。最后，我们在<em class="ml"> getElementById </em>的帮助下访问 id 为<em class="ml"> message_txt </em>的文本字段，并将其值设置为新文本。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="1c6d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">PyScript 中的图像处理</h1><p id="6d15" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">让我们先看看代码，然后再一点一点理解它。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2273" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">学分:这段代码中使用的 HTML-CSS 部分受到了 youtube 上 1littlecoder pyscript 教程的启发。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="4af0" class="mv lj iq bd lk nd ne dn lo nf ng dp ls ko nh ni lw ks nj nk ma kw nl nm me nn bi translated">代码说明</h2><ul class=""><li id="f67d" class="no np iq kf b kg mg kk mh ko nq ks nr kw ns la nt nu nv nw bi translated">在第 11-12 行，我们分别使用<em class="ml">链接</em>和<em class="ml">脚本</em>标签导入 pyscript CSS 和 pyscript 运行时环境。</li><li id="cb1d" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 13-18 行，我们借助于<em class="ml"> &lt; py-env &gt; </em>标记，在 PyScript 环境中导入外部库。</li><li id="ec60" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 22-53 行，我们编写了 CSS 代码，用于在 HTML 部分设置输入文本字段和下拉列表对象的样式。</li><li id="b0c5" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 57-74 行，我们使用基本的 HTML 来创建一个 HTML 标签。请注意，在表单标签中，我们将 onsubmit 属性设置为 false，这意味着我们不想通过单击提交按钮来切换页面。在 HTML 表单中，有三个对象，其中一个是用于输入要处理的图像的 URL 的文本字段，另一个对象是用于选择要执行的图像处理操作类型的下拉列表。最后一个对象是一个 submit 按钮，它调用我们的 python 函数来完成所有的处理。<em class="ml"> pys-onClick </em>属性是 pyscript 特有的属性，用于调用 pyscript 内部的 python 函数<em class="ml">子定义的</em>。在表单标签之外，我们可以注意到另外两个 div 标签，一个用于标签，另一个 div 元素包含一个<em class="ml"> img </em>标签，我们最终将操纵它来显示我们的图像。</li><li id="d7b2" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">从第 76–84 行，我们正在导入执行图像处理所需的库。可以观察到，我们也在导入异步模块和 py 碘化物模块，但在<py-env>标签中没有提到。原因是这些库是内部 python/pyscript 库。</py-env></li><li id="f736" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 86–110 行，我们用 numpy 和 scipy 编写了一些图像处理函数，因为 opencv 在 py 碘化物中还不可用。</li><li id="fd52" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 114 行，我们定义了一个名为 sub 的<em class="ml">异步</em>函数。</li><li id="72f2" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 115 和 116 行，我们正在访问图像 URL 文本字段和图像处理选择下拉列表的值。</li><li id="3ff9" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 117–119 行，我们使用 py 碘化物的 pyfetch 函数从 URL 获取图像，然后我们在<em class="ml"> BytesIO </em>的帮助下将响应中获得的字节转换为缓冲区，并在<em class="ml"> imread </em>函数的帮助下将其读取为图像。最后，我们将图像转换成 numpy 格式。</li><li id="9b0f" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">从第 120–137 行，我们根据我们在下拉列表中的选择调用函数。</li><li id="0bdc" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 141 行，我们正在初始化一个<em class="ml">字节缓冲区。在第 142 行，我们将我们的绘图保存到这个缓冲区。在第 143 行，我们指向缓冲区的开始。</em></li><li id="8b87" class="no np iq kf b kg nx kk ny ko nz ks oa kw ob la nt nu nv nw bi translated">在第 144–146 行，我们将图像编码为<em class="ml"> base64 </em>字符串。然后我们访问 img 标签，并用这个字符串设置它的<em class="ml"> src </em>属性。设置此项会将图像数据放置在 img 标签中，该标签由浏览器呈现，就像任何 img 标签一样。</li></ul><p id="a930" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以上代码可以保存为 HTML 文档，在 chrome 中打开。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3459" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">应用程序的输出</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/d1928ec0717962321da4b5f369f9fa65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wet-cXjxkReNBBfCxZ4srA.jpeg"/></div></div></figure><p id="e071" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以上是我们构建的 pyscript 应用程序的工作原理。imageurl 文本字段中的 url 是随机返回猫的图像的 URL。这里还有一点需要注意的是，浏览器中的 URL 直接指向我磁盘中的 HTML 文件，因为我已经将该文件保存为 html doc 并在 chrome 中打开了它。在一些教程中，他们首先创建一个前端服务器，然后运行应用程序。在这种情况下，我们可能能够直接访问系统的文件系统。但是创建一个服务器会涉及一些安装，这会损害 PyScript 的可移植性，因此我决定用不同的方式从 URL 读取图像。</p><h1 id="8048" class="li lj iq bd lk ll od ln lo lp oe lr ls lt of lv lw lx og lz ma mb oh md me mf bi translated">参考资料和进一步阅读</h1><div class="oi oj gp gr ok ol"><a href="https://github.com/pyscript/pyscript" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">GitHub - pyscript/pyscript:主页:https://pyscript.net 示例:https://pyscript.net/examples</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">PyScript 是 Scratch、JSFiddle 和其他“易于使用”的编程框架的 Pythonic 替代品，其目标是…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz jw ol"/></div></div></a></div></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="b061" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你到达这里，那么恭喜你刚刚学到了一个惊人的概念。如果你喜欢它，请考虑为这篇文章鼓掌，并点击关注按钮，以获得更多这样的博客。这样做会激励我继续研究和写博客。欢迎在评论区提出任何问题或疑问，我很乐意帮助你。</p></div></div>    
</body>
</html>