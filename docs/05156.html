<html>
<head>
<title>How to Deploy to Kubernetes &amp; Heroku using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Docker 部署到 Kubernetes &amp; Heroku</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-deploy-to-kubernetes-heroku-using-docker-c2556a9584df?source=collection_archive---------1-----------------------#2021-06-25">https://blog.devgenius.io/how-to-deploy-to-kubernetes-heroku-using-docker-c2556a9584df?source=collection_archive---------1-----------------------#2021-06-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ab69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 GitHub 操作部署到 Kubernetes 和 Heroku</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c5b4b25beb2e7906e2ecbe8de311657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3Y_zIDsgsOUiyLJ4Mw2Uw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://medium.com/monstar-lab-bangladesh-engineering/our-journey-from-heroku-to-kubernetes-part-1-116f4bdc44a4" rel="noopener">medium.com</a></figcaption></figure><blockquote class="kz la lb"><p id="0571" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io">先决条件</strong></p></blockquote><ul class=""><li id="a952" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated">按照<a class="ae ky" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">定位和设置</a>中的描述下载并安装 Docker 桌面。</li><li id="528e" class="lg lh in jm b jn lp jr lq jv lr jz ls kd lt kh ll lm ln lo bi translated">熟悉 Heroku PaaS、Orchestration、Kubernetes、Docker、NodeJS、GitHub、GitHub 操作</li></ul><blockquote class="kz la lb"><p id="87f2" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io">什么是编排？</strong></p></blockquote><p id="d0a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在系统管理中，<strong class="jm io"> <em class="lc">编制</em> </strong>是计算机系统和软件的自动配置、协调和管理。<strong class="jm io">云计算中的编排</strong>是配置基础设施供应的过程，包括安全性、权限和特定于域的设置，以便最终的编排元素可以使用。编排步骤通常随着环境的变化而发展，然后被设置为自动化。</p><p id="624b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有许多工具可以实现服务器配置和管理的自动化，包括 Ansible、Puppet、Salt、Terraform 和 AWS CloudFormation。</p><blockquote class="kz la lb"><p id="0bad" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io">什么是 Kubernetes？</strong></p></blockquote><p id="6d65" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Kubernetes 是一个开源的容器编排系统，用于自动化计算机应用程序的部署、扩展和管理。它最初是由谷歌设计的，现在由云原生计算基金会维护。</p><p id="e876" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Kubernetes 提供了许多工具来扩展、联网、保护和维护您的容器化应用程序，这些工具超越了容器本身的能力。</p><p id="8fa3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了验证我们的容器化应用程序在 Kubernetes 上运行良好，我们将使用 Docker Desktop 的内置 Kubernetes 环境，然后将它交付到生产中的完整 Kubernetes 集群上运行。</p><blockquote class="kz la lb"><p id="14a8" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io">重要提示:</strong>对于本演示，请确保您使用的是 kubernetes 中的 deckoer-desktop 上下文</p><p id="9ad1" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">一个<strong class="jm io">上下文</strong>是一组访问参数。每个<strong class="jm io">上下文</strong>包含一个<strong class="jm io"> Kubernetes </strong>集群、一个用户和一个名称空间。当前<strong class="jm io">上下文</strong>是当前<strong class="jm io"> kubectl </strong>的默认集群:所有<strong class="jm io"> kubectl </strong>命令都针对该集群运行。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/77d520b7bf7a541e7b199d2e2c56800a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-Pf_rPaakz_ALuVhbXPC9g.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 docker 桌面上启用 Kubernetes</figcaption></figure><p id="dd2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Docker Desktop 创建的 Kubernetes 环境是<em class="lc">全功能</em>，这意味着它拥有您的应用程序将在真实集群上享受的所有 Kubernetes 功能，可从您的开发机器方便地访问。</p><blockquote class="kz la lb"><p id="b6aa" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">Docker desktop 仅适用于 windows 和 Mac——对于 Linux，您可以使用 minukibe。</p></blockquote><p id="7f7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Minikube 是一个你可以<strong class="jm io">用来</strong>在你的本地机器上运行 Kubernetes (k8s)的工具。它创建一个包含在虚拟机(VM)中的单节点集群。这个集群允许您演示 Kubernetes 操作，而不需要耗费时间和资源安装成熟的 K8s。—更多信息请点击这里:【minikube.sigs.k8s.io/docs/start/ T4】</p></div><div class="ab cl lv lw hr lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ig ih ii ij ik"><h1 id="dac2" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">将 NodeJS docker 映像部署到 Kubernetes</h1><p id="9557" class="pw-post-body-paragraph jk jl in jm b jn na jp jq jr nb jt ju jv nc jx jy jz nd kb kc kd ne kf kg kh ig bi translated">对于这个演示，让我们使用我们在本教程中构建的 NodeJS 应用程序:</p><blockquote class="kz la lb"><p id="a399" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">* <a class="ae ky" href="https://blog.bitsrc.io/how-to-build-and-run-a-nodejs-app-with-docker-github-actions-59eb264dfef5" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="in">如何使用 Docker&amp;GitHub Actions</em></strong></a>构建并运行 NodeJS 应用</p><p id="bccd" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io"> <em class="in"> *在继续本演示之前完成它</em> </strong></p></blockquote><p id="5c28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上一个教程中，我们演示了 NodeJS 应用程序的各个组件，并展示了它如何作为独立的容器运行。现在让我们将这些容器设置为由 Kubernetes 这样的 orchestrator 来管理。</p><p id="d976" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们在项目的根文件夹中创建一个 Kubernetes 部署 YAML 文件。一个<strong class="jm io"> <em class="lc">部署</em> </strong>为<a class="ae ky" href="https://kubernetes.io/docs/concepts/workloads/pods/" rel="noopener ugc nofollow" target="_blank">容器</a>和<a class="ae ky" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank">复制集</a>提供声明性更新。你在一个部署中描述<em class="lc">期望状态</em>，部署<a class="ae ky" href="https://kubernetes.io/docs/concepts/architecture/controller/" rel="noopener ugc nofollow" target="_blank">控制器</a>以受控的速率将实际状态改变为期望状态—source:<a class="ae ky" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">kubernetes . io—Deployment</a></p><p id="f839" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是我为这个演示创建的 Kubernetes 部署 YAML 文件的副本(<strong class="jm io"> <em class="lc">阅读注释以了解关于 Kubernetes 部署的每个部分的详细信息)</em> </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak"> <em class="nh">阅读注释，了解 Kubernetes 部署</em> </strong>的各个部分的详细信息</figcaption></figure><p id="3a36" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们通过运行以下命令将 nodeJS 应用程序部署到 Kubernetes:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="79cd" class="nn md in nj b gy no np l nq nr">kubectl apply -f deploy.yml      # deploy <br/>watch -n 1 kubectl get pods      # watch the pods being created<br/>kubectl get all                  # see all the resources created</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/bd5da0c04801c3a308f4c07ea7285306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*M8sqcjKDwYI1n6kVgPv3MA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">部署到 Kubernetes</figcaption></figure><p id="e88e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要拆除您刚刚通过部署创建的所有资源，只需运行以下命令:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="3b9b" class="nn md in nj b gy no np l nq nr">kubectl delete -f deploy.yml      # delete all the resouces created<br/>kubectl get all                   # see all the resources remaining</span></pre><p id="afe3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">差不多就是这样了！！您已经准备好在本地 Kubernetes 上部署和运行您的应用程序。</p></div><div class="ab cl lv lw hr lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ig ih ii ij ik"><h1 id="9b1f" class="mc md in bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">将 NodeJS docker 映像部署到 Heroku</h1><p id="b036" class="pw-post-body-paragraph jk jl in jm b jn na jp jq jr nb jt ju jv nc jx jy jz nd kb kc kd ne kf kg kh ig bi translated">Heroku 现在允许用户部署 docker 容器。要使用这个特性，只需在项目中添加一个 docker 文件，并在 docker 文件的末尾添加一个<code class="fe nt nu nv nj b">CMD</code>命令。这是 Heroku 用来启动容器内部的 web 服务器的命令。所以，让我们从以下几点开始:</p><ul class=""><li id="d371" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated">登录您的 Heroku 帐户并创建您的应用程序</li><li id="b42f" class="lg lh in jm b jn lp jr lq jv lr jz ls kd lt kh ll lm ln lo bi translated">将以下秘密添加到您的 GitHub 项目 repo 设置中:HEROKU _ API _ KEY—HEROKU _ APP _ NAME—HEROKU _ EMAIL</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/01ed3a6092d42f941054816d53c21a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_M8o6jjdVvnful7UoC7kSA.gif"/></div></div></figure><blockquote class="kz la lb"><p id="7bff" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated"><strong class="jm io">添加 Github 操作作业，该作业会将您的 NodeJS 应用程序部署到 Heroku </strong></p></blockquote><p id="8f82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是一个非常简单的 GitHub 操作，允许您部署到 Heroku。详情可以在这里找到:<a class="ae ky" href="https://github.com/marketplace/actions/deploy-to-heroku" rel="noopener ugc nofollow" target="_blank">部署到 Heroku </a>。使用与 Docker 一起部署选项；现在我的 GitHub actions Jobs 看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d000" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们来看看代码，看看我们的 CI/CD 是如何工作的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/4090751bdbfa88597454347a78c1d8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*a6MwHA57os3aWSfdfMnt1w.gif"/></div></div></figure><p id="aacd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当使用 Kubernetes 将应用程序部署到云平台时。取决于你的云平台，是 AWS，谷歌云平台，Azure 等。还需要更多的配置和参数设置。</p><p id="cd69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是这仅仅是在 Kubernetes 部署中添加一些配置和项目参数——差不多就是这样！！</p><blockquote class="kz la lb"><p id="f655" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">余灿在我的<a class="ae ky" href="https://github.com/YannMjl/nodejs-demo-app" rel="noopener ugc nofollow" target="_blank"> github repo </a>上审查所有代码。我的演示应用可以在这里访问:<a class="ae ky" href="https://nodejs--demo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://nodejs-demo.herokuapp.com/</a></p><p id="820a" class="jk jl lc jm b jn jo jp jq jr js jt ju ld jw jx jy le ka kb kc lf ke kf kg kh ig bi translated">如果你喜欢这个，你可能也会喜欢这个 tuto 的下一个阶段:<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-provision-configure-deploy-to-google-cloud-platform-97dbbe36fcde">使用 Docker、Kubernetes、Terraform 和 GitHub 动作部署到 Google 云平台</a></p></blockquote><blockquote class="nw"><p id="f8f1" class="nx ny in bd nz oa ob oc od oe of kh dk translated">干杯！！！</p></blockquote></div></div>    
</body>
</html>