<html>
<head>
<title>Minesweeper on the command line is a good exercise for object-oriented design in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命令行扫雷是Java中面向对象设计的一个很好的练习</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/minesweeper-on-the-command-line-is-a-good-exercise-for-object-oriented-design-in-java-64d7f24b5237?source=collection_archive---------1-----------------------#2021-03-02">https://blog.devgenius.io/minesweeper-on-the-command-line-is-a-good-exercise-for-object-oriented-design-in-java-64d7f24b5237?source=collection_archive---------1-----------------------#2021-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3d9c30ee428f1a1c9c9a8aaa8a36b6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ql1Gxfhxo4V61rS7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">乔治·帕拉维西尼在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7e30" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Java初学者经常会要求好的项目，用这些项目来学习Java和面向对象设计的原理。游戏通常被作为一个答案。游戏的程序要求很容易解释，学生可以通过玩游戏获得对他们程序的即时反馈。</p><p id="8067" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我特别建议在命令行上进行扫雷，作为Java初学者学习面向对象编程和将内容与表示分离的好处的一个很好的练习。</p><p id="9f16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于著名的微软Windows扫雷游戏的主要目的是让用户熟悉鼠标左键和右键，以及如何使用它们来指示屏幕上的项目，大多数人只知道扫雷是一个具有图形用户界面(GUI)的游戏。</p><p id="03cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是当然可以用命令行界面来制作游戏，甚至是仅限于ASCII字符的界面。比如，“！”可以指示标记的位置，“X”可以指示引爆的地雷等。</p><p id="7524" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将快速描述一下GUI版本，以防你只是模糊地回忆起它，或者如果你从未玩过它。你会看到一个长方形的正方形。每个方格要么有地雷，要么没有，但在游戏开始时，你不知道哪个是哪个。</p><p id="b2e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我通常从左键点击角上的方块开始。它可以被开采，但通常不会。并且，在简单或中等设置中，地雷倾向于远离角落。在这种情况下，多个没有地雷的方块可能会同时出现。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/418f4dd579b5c16a39ceec3e61be779d.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*Q_2_x5INO_OxPZuItN5vlQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在扫雷游戏的早期。</figcaption></figure><p id="88b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个方块中的数字让我知道相邻方块中有多少个地雷(包括“对角线”邻居，它们只接触一个角而不是边缘)。</p><p id="4896" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本例中，我看到三个位置肯定有地雷，所以我通过右键单击它们来标记它们。我发现了一些我确信没有被开采的位置。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/b0b243b3edb02e96bd14266d6be76ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*KhfQS8VzG6BTWW52l8SCng.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在扫雷游戏的早期，在标记了三个位置后。</figcaption></figure><p id="ade9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事后看来，很容易看出我的下一步应该是什么。但在那一刻，我赌了一把，边缘附近没有地雷。这是一个错误，你可以在下面的截图中看到:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/b4cdc752bf6d5b716c180158e0be2cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*GBfd0x5Tc1aWVDC3kArKEA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">哎呀。</figcaption></figure><p id="7759" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一个滴答作响的时钟:如果你花的时间太长，地雷就会爆炸。也可能你只是一直玩下去，就看执行情况了。</p><p id="6784" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以标出每个位置。我想这是一种策略。但这并没有停止时钟。让我们现在不要担心时钟。</p><p id="7449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然有许多不同的方式来编写扫雷程序，它不一定是面向对象的。当然有可能用旧的BASIC来编写游戏，比如GW-BASIC或QBasic，用二维数组来记录所有的东西。</p><p id="d77a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是通过精心选择和设计的对象，我们可以创建一个游戏，它可以很容易地适应任何用户界面，并且，再多花一点力气，也可以适应不同的变体，比如用三角形瓷砖代替正方形瓷砖。</p><p id="a5e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想让你启动你最喜欢的集成开发环境(IDE)并创建一个新项目，名为MineSweeper。确保项目有一个源包文件夹(src)和一个测试包文件夹(Test)。</p><p id="3e7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在源码包中，确保有一个<code class="fe li lj lk ll b">minesweeper</code>包(或者如果你愿意，可以将其命名为<code class="fe li lj lk ll b">org.example.minesweeper</code>)和一个<code class="fe li lj lk ll b">ui</code>包(或者将其命名为<code class="fe li lj lk ll b">org.example.ui</code>)。</p><p id="4634" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe li lj lk ll b">ui</code>包中制作两个“子包”:<code class="fe li lj lk ll b">ui.graphical</code>和<code class="fe li lj lk ll b">ui.text</code>。在其中的每一个中创建一个<code class="fe li lj lk ll b">Game</code>类。这些只是暂时的占位符。我们将认真开始我们的工作。</p><p id="c3cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我来说，<code class="fe li lj lk ll b">minesweeper</code>包应该有一个<code class="fe li lj lk ll b">Mine</code>类，这似乎很明显。</p><pre class="lc ld le lf gt lm ll ln lo aw lp bi"><span id="0a2a" class="lq lr iq ll b gy ls lt l lu lv">package minesweeper;<br/><br/>public class Mine {<br/>    <br/>    private boolean detonated = false;<br/>    <br/>    public boolean hasBeenDetonated() {<br/>        return this.detonated;<br/>    }<br/>    <br/>    public void detonate() {<br/>        this.detonated = true;<br/>    }<br/><br/>    Mine() {<br/>        //<br/>    }</span><span id="906c" class="lq lr iq ll b gy lw lt l lu lv">}</span></pre><p id="4c1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想这是一个好的开始。我放入了一个“空”的包私有构造函数，因为我相信这个构造函数不应该在<code class="fe li lj lk ll b">minesweeper</code>包之外被调用。我以后会改变主意的。</p><p id="9a5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两次引爆地雷应该是不可能的。如果一个<code class="fe li lj lk ll b">Mine</code>实例已经调用了<code class="fe li lj lk ll b">detonate()</code>，那么第二次调用<code class="fe li lj lk ll b">detonate()</code>会导致一个异常，比如<code class="fe li lj lk ll b">IllegalStateException</code>。</p><p id="9013" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要只是把那个加进去，先写个测试。如果您使用的是JUnit 5，您可以使用<code class="fe li lj lk ll b">assertThrows()</code>来检查。</p><p id="b21c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，这不应该直接影响游戏。我认为显示几个相邻空间的能力与扫雷游戏更直接相关。</p><p id="e0cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎早期的扫雷舰游戏没有这个功能，揭示一个空方块会导致邻近的空方块也被揭示。现在它被认为是游戏的一个重要特征。</p><p id="0ffa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的插图跳过了两个中间步骤，但是它仍然应该让您对这个概念有一个很好的了解。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/dd16328d14d1f9c4393755eddaa56c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*PDfa3Lv1jWNQPIgy1KEOTg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">揭示一个空仓往往会导致其他空仓被揭示。</figcaption></figure><p id="0f92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用像QBasic这样的语言，这可以实现为一个二维数组。在Java中，我们可以将数组作为一个<code class="fe li lj lk ll b">Board</code>或<code class="fe li lj lk ll b">MineField</code>对象的字段(使用对您更有意义的名称)。</p><p id="f1f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但我认为这种方法将我们过多地束缚在游戏的方块版本上，并且要求我们传递成对的整数来引用棋盘上的位置。</p><p id="648d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我认为我们需要一个<code class="fe li lj lk ll b">Position</code>类，只负责描述一个职位。大概是这样开始的:</p><pre class="lc ld le lf gt lm ll ln lo aw lp bi"><span id="324a" class="lq lr iq ll b gy ls lt l lu lv">package minesweeper;</span><span id="977f" class="lq lr iq ll b gy lw lt l lu lv">public class Position {<br/>    <br/>    private final int coordX, coordY;<br/>    <br/>    public Position(int x, int y) {<br/>        this.coordX = x;<br/>        this.coordY = y;<br/>    }<br/>    <br/>}</span></pre><p id="75fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我认为提供一个<code class="fe li lj lk ll b">getNeighbors()</code>函数属于<code class="fe li lj lk ll b">Position</code>的单一职责，该函数提供一个实例的近邻列表。通过将这种逻辑移出<code class="fe li lj lk ll b">Board</code>(或<code class="fe li lj lk ll b">MineField</code>)，让游戏适应其他变体变得更加容易。</p><p id="d50b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您遵循正确的测试驱动开发(TDD)方法，JUnit将在您之前玩这个游戏。但是一般用非常简单的关卡，比如一个10 × 10的棋盘，所有的地雷都在第四列。</p><p id="d5fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果JUnit单击第一列或第二列中的任何方块，这两列都将显示为空，第三列也将显示为空，但其中有数字(大多数是3)。</p><p id="5995" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你让<code class="fe li lj lk ll b">minesweeper</code>包中的所有东西都正常工作了，就该做一个用户界面了。最好从命令行界面开始，因为您可能已经很好地理解了如何使用<code class="fe li lj lk ll b">System.out.println()</code>过程。</p><p id="9401" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不过，这里有一个小问题:根据操作系统和您使用的控制台程序，以不同的颜色写入控制台要么是使用ANSI重置代码的简单问题，要么是编写使您的程序不太容易移植的“本机方法”的复杂问题。</p><p id="b46e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只为我自己说，扫雷是一个非常困难的游戏，没有至少一点点颜色编码来指导我。</p><p id="4383" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现在Windows上，ANSI重置代码对命令提示符codes不起作用，但在Git Bash中却非常好用。下面是我尝试在cmd.exe上用ANSI重置代码玩游戏的截图:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/6abb16dd9a856ef29269e489e9040bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92Zx4hY_YGd00AabAFSmAQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Windows命令行上的扫雷游戏。获取颜色的ANSI重置代码按字面理解，对字体颜色没有影响。</figcaption></figure><p id="7314" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你可能已经猜到的，在标记E3之后，我没有坚持多久。</p><p id="2406" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，在Git Bash上，我不能责怪缺乏颜色编码导致游戏结束得太快。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/591ae250ccccf3303819444657bef8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Cv_yZslb8cIdsD8tDRe4w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Git Bash上的扫雷游戏。ANSI重置代码对字体颜色有影响。</figcaption></figure><p id="17bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我通常使用cmd.exe的Git，而不是Git Bash的，我注意到它显示了与Git Bash相同的颜色编码。我想弄清楚它是如何做到这一点的，但这对我来说并不重要。</p><p id="6033" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以目前我只是在<code class="fe li lj lk ll b">ui.text.Game</code>、“-colors”中放了一个命令行选项，除了“-easy”、“medium”或“-hard”之外，你还可以使用它来选择你想如何玩游戏。</p><pre class="lc ld le lf gt lm ll ln lo aw lp bi"><span id="ca0b" class="lq lr iq ll b gy ls lt l lu lv">package ui.text;</span><span id="4315" class="lq lr iq ll b gy lw lt l lu lv">import minesweeper.*;</span><span id="8ff9" class="lq lr iq ll b gy lw lt l lu lv">import java.util.Optional;<br/>import java.util.Scanner;</span><span id="7034" class="lq lr iq ll b gy lw lt l lu lv">public class Game {</span><span id="4c2f" class="lq lr iq ll b gy lw lt l lu lv">    private static boolean useANSIColors = false;<br/>    <br/>    private static final String ANSI_RESET = "\u001B\u005B0m";<br/>    private static final String ANSI_RED = "\u001B\u005B31m";<br/>    private static final String ANSI_GREEN = "\u001B\u005B32m";<br/>    private static final String ANSI_YELLOW = "\u001B\u005B33m";</span><span id="cec5" class="lq lr iq ll b gy lw lt l lu lv">    public static void main(String[] args) {<br/>        // ...<br/>        if (args.length &gt; 0) {<br/>            useANSIColors = args[0].startsWith("-c");<br/>        }<br/>        // ...<br/>    }</span><span id="75be" class="lq lr iq ll b gy lw lt l lu lv">}</span></pre><p id="b109" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，“-colors”(如果您愿意，也可以是“-c”)必须是第一个命令行选项。让它变得更灵活是我的第二要务。</p><p id="9954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你让游戏的命令行版本运行良好，GUI版本可能仍然令人望而生畏。但至少挑战将是与游戏引擎无关的GUI特有的问题。</p><p id="9e87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你发现自己被卡住了，请随意参考<a class="ae kc" href="https://github.com/Alonso-del-Arte/minesweeper" rel="noopener ugc nofollow" target="_blank">我的GitHub库</a>。看看我是怎么做的，可能会启发你想出一个更好的解决方案。我当然有兴趣看看你们是如何解决某些问题的，所以也请在评论中随意张贴GitHub链接。</p></div></div>    
</body>
</html>