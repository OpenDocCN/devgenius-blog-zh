<html>
<head>
<title>Enhancing HTML audio tag with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript增强HTML音频标签</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/enhancing-html-audio-tag-with-javascript-ff4b5fce1b55?source=collection_archive---------12-----------------------#2020-06-04">https://blog.devgenius.io/enhancing-html-audio-tag-with-javascript-ff4b5fce1b55?source=collection_archive---------12-----------------------#2020-06-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/05cfa641700ca51aec54567b00249a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OfmZainukdRRK62r"/></div></div><figcaption class="jz ka gk gi gj kb kc bd b be z dk translated">弗洛里安·奥利佛在<a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b663" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">HTML中的音频标签允许将音频嵌入到网页中，并根据它提供的功能提供一些选项。例如，您可以启用控件，以便用户可以更改音量、播放和暂停等。您可以让它自动播放，或者(假设控件已启用)由用户来播放。这是一件非常简单的事情。</p><p id="0c2c" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">通常你会在HTML中实现它，就像这样。</p><blockquote class="lc ld le"><p id="cfd9" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><audio controls=""> <br/> &lt;来源src = " media/song 1 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;/audio&gt;</audio></p></blockquote><p id="5cac" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">您还可以提供多个源标签，它将播放第一个有效的标签。</p><blockquote class="lc ld le"><p id="13d6" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><audio controls=""> <br/> &lt;源src = " media/song 1 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;源src = " media/song 2 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;源src = " media/song 3 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;/audio&gt;</audio></p></blockquote><p id="3776" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">在该示例中，如果歌曲1和歌曲2不存在，但歌曲3存在，则音频元素将加载歌曲3。如果歌曲1没有，但是歌曲2和歌曲3有，那么它将播放歌曲2。它只播放第一个有效的。</p><p id="d383" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">事实上，我们可以为一个音频标签指定多个源，这对于我们来说是一个优势，如果我们想增强音频控件的功能的话。</p><figure class="lk ll lm ln gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj lj"><img src="../Images/bcd11e3a8d8720c8a4c4fc0b4ed376fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a34FvjYGmSMTP_Ay"/></div></div><figcaption class="jz ka gk gi gj kb kc bd b be z dk translated">布鲁斯·马尔斯在<a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="34e5" class="lo lp ir bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">增强音频标签</h1><p id="8752" class="pw-post-body-paragraph ke kf ir kg b kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx mq kz la lb ik bi translated">因此，让我们利用多个源标签和一些简单的JavaScript来让音频标签播放我们提供的歌曲播放列表。</p><p id="1f4a" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">首先为您想要的可用音频设置带有多个源标签的音频标签。</p><blockquote class="lc ld le"><p id="66f0" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><audio controls=""> <br/> &lt;来源src = " media/song 1 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;来源src = " media/song 2 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;来源src = " media/song 3 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;来源src = " media/song 4 . MP3 " type = " audio/mpeg "&gt;<br/>&lt;来源src</audio></p></blockquote><p id="2ba3" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">在这个例子中，我有5首歌曲，但是如果你愿意，你可以有10首、20首或数百首。</p><p id="a463" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我们要做的是编写一个简单的脚本，这样一旦音频元素播放完音频，它就会自动移动到列表中的下一个。所以，它播放歌曲1，然后移动到歌曲2，3，4，5。一旦歌曲5结束，它将跳回起点，并再次从头开始。</p><p id="0d70" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">在out HTML中，就在</p><blockquote class="lc ld le"><p id="a9e0" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><script>&lt;br/&gt;var music sources = null；&lt;br/&gt;var music control = null；&lt;br/&gt;var music index = 0；&lt;/root&gt;</script></p></blockquote><p id="8475" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><em class="lf"> musicSources </em>将是我们在音频标签下的那些资源的数组。</p><p id="0a8d" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><em class="lf"> musicControl </em>将引用音频元素本身。</p><p id="723f" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">musicIndex将只是简单地指我们正在寻找的特定音乐来源。</p><p id="4e70" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，让我们创建一个函数，我们将在最后调用它来定义音频控件的行为。</p><blockquote class="lc ld le"><p id="65f8" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">函数SimpleMusicController() {</p></blockquote><p id="5a59" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然后我们将填充之前创建的变量。</p><blockquote class="lc ld le"><p id="5ad8" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">music sources = document . query selector all("音源")；<br/>music index = 0；<br/>music control = document . query select(" audio ")；</p></blockquote><p id="a412" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">这里，我们使用一个内置的JavaScript函数“querySelectorAll ”,该函数将返回一个数组，该数组包含它找到的作为音频标签的子元素的所有源对象。</p><p id="1e28" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我们将索引重置为从0开始。</p><p id="36ab" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然后我们使用“querySelector”来获取页面上的第一个音频标签。(是的，我们假设在这种情况下我们只有一个想要控制的。)</p><p id="031c" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，我们希望向音频标签添加一个事件侦听器，当正在播放的音频文件结束时，该事件侦听器将被触发。这可能是因为它已经结束播放，或者用户已经跳到结尾以强制它结束播放，或者因为脚本已经告诉它结束播放。然而，这不包括用户暂停音频。</p><p id="b49c" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">出于我们的目的，当音频结束时，我们希望获得列表中的下一个，并告诉它开始播放那个。</p><blockquote class="lc ld le"><p id="dd17" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">music control . addevent listener(' ended '，function(e)<br/>{<br/>music index++；<br/>if(music index&gt;music sources . length—1){<br/>music index = 0；<br/>}<br/><br/>var mSrc = music sources[music index]。src<br/>music control . src = mSrc；<br/>music control . play()；<br/> <br/> }，假)；</p></blockquote><p id="8a9b" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">正如您在上面的函数中看到的，我们添加了eventListener，并为它提供了一个在事件触发时运行的函数。</p><p id="51bf" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">在此范围内，我们从递增索引开始。</p><p id="ad22" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然后，我们检查索引是否走得太远，如果走得太远，我们将它设置回起点。零。</p><p id="160a" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">确定了新的指数。然后，我们从相关的源标签获取音频文件源，将其设置为音频标签的源，并告诉音频标签播放它。</p><p id="a51a" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">简单。</p><p id="3f06" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">如果我们关闭SimpleMusicController函数</p><blockquote class="lc ld le"><p id="c806" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi">}</p></blockquote><p id="7906" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">并在web浏览器中加载页面。假设所有的音频文件都可以访问，你应该可以播放它，跳到最后，然后看着它开始自动播放下一首歌。</p><p id="45f0" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">很好。</p><figure class="lk ll lm ln gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj lj"><img src="../Images/c1a3efe33ff7c352a0da175bb0c81048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P-2_q6yikuGDBv1a"/></div></div><figcaption class="jz ka gk gi gj kb kc bd b be z dk translated">由<a class="ae kd" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Markus Spiske </a>在<a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="dd6f" class="lo lp ir bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">但是更多呢？</h1><p id="0d0e" class="pw-post-body-paragraph ke kf ir kg b kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx mq kz la lb ik bi translated">更多？</p><p id="2e9d" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">哦好吧。再补充一点吧。</p><p id="1324" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">让它显示当前正在播放的歌曲，以及下一首正在播放的歌曲。</p><p id="e3ef" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">为此，我们需要在我们的<audio>标签下添加几个<div>标签。(或者任何适合你的页面的地方)。我们还需要利用源标签上的数据属性。</div></audio></p><p id="2c17" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">添加一个<div>标签来显示当前正在播放的内容。</div></p><blockquote class="lc ld le"><p id="45d1" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><div id="”now_playing”"> </div></p></blockquote><p id="fe7a" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我们现在只引用id。</p><p id="1eee" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">另一个是为了接下来的事。</p><blockquote class="lc ld le"><p id="ae36" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><div id="”up_next”"> </div></p></blockquote><p id="bfa3" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">布局，风格和id都可以由你决定。我们将在代码中引用id，所以如果您在此处更改了id，请确保进行更新。</p><p id="a3ce" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><strong class="kg is">什么是数据属性？</strong></p><p id="19d3" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">数据属性允许我们向HTML中添加额外的属性，这些属性可以很容易地在代码中使用，而实际上并没有脱离HTML标准。您可以在MDN 上阅读更多关于数据属性的内容。</p><p id="584b" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">使用数据属性，我们将添加内容，为我们提供歌曲标题和艺术家。(这假设您正在播放歌曲。如果没有，您可以调整它以适应您的使用情况。)所以我们的源标签看起来会更像这样。</p><blockquote class="lc ld le"><p id="5f31" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated"><source src="”music/song1.mp3&quot;" type="”audio/mpeg”" data-title="”Song" one="" data-artist="”John" doe=""><br/>&lt;source src = " music/Song 2 . MP3 " type = " audio/mpeg " data-title = " Song Two " data-artist = " Jane Doe "&gt;<br/>…等等…</source></p></blockquote><p id="f9f9" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">你可以看到非常有想象力的标题。使用这些数据属性，我们可以轻松地引用和显示我们之前创建的div中当前和下一首歌曲的艺术家和歌曲名称。</p><p id="95b6" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">让我们添加一个新的eventListener来监听“play”事件。我们将在结束之前在<em class="lf"> SimpleMusicController </em>函数中做这件事。</p><blockquote class="lc ld le"><p id="d106" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">music control . addevent listener(' play '，function(e) { <br/> //更新现在播放的标题和艺术家<br/>document . getelementbyid(' now _ playing ')。innerHTML = '正在播放:'+music sources[music index]. dataset . title+' by '+music sources[music index]. dataset . artist；<br/> <br/> //获取下一首要播放的歌曲的信息并显示<br/>tmpIndex = music index+1；<br/>if(tmpIndex&gt;music sources . length—1){<br/>tmpIndex = 0；<br/>}<br/>document . getelementbyid(' up _ next ')。innerHTML = '即将到来:'+music sources[tmp index]. dataset . title+' by '+music sources[tmp index]. dataset . artist；<br/> }，假)；</p></blockquote><p id="0124" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我们首先更新now_playing div中显示的HTML。将其设置为“正在播放:”然后通过引用这些数据属性添加歌曲标题和艺术家。</p><p id="28e3" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">您会注意到我们设置的数据属性是:</p><blockquote class="lc ld le"><p id="d2ae" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">data-title = " Song One "<br/>data-artist = "无名氏"</p></blockquote><p id="f676" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然而，在我们的代码中，我们是通过以下方式访问它的:</p><blockquote class="lc ld le"><p id="21d9" class="ke kf lf kg b kh ki kj kk kl km kn ko lg kq kr ks lh ku kv kw li ky kz la lb ik bi translated">music sources[music index]. dataset . title<br/>music sources[music index]. dataset . artist</p></blockquote><p id="4ec0" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">当使用JavaScript访问这些属性时，我们不需要使用“数据”位。这是扩展HTML标签的一种非常好的方式，可以包含额外的属性，这些属性可以很容易地通过代码中的名称来访问。</p><p id="b05e" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">设置完当前播放的歌曲后，我们创建一个临时索引来确定下一首歌曲。就像我们在“end”函数中做的一样，也检查我们是否已经过去，如果需要的话循环回到起点。</p><p id="c8e2" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然后我们更新“up _ next”div来显示下一首将要播放的歌曲的标题和艺术家。</p><p id="cb0e" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">调用页面上的SimpleMusicController函数，您应该会看到当您开始播放标题和艺术家节目时，以及下一首歌曲的标题和艺术家，当一首歌曲结束时，它会自动移动到下一首歌曲。</p><p id="8836" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">太好了！</p><h1 id="a5dc" class="lo lp ir bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">结论</h1><p id="25bd" class="pw-post-body-paragraph ke kf ir kg b kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx mq kz la lb ik bi translated">非常好。因此，我们采用了一个基本的HTML音频标签，并编写了一个非常简单的脚本来创建一个播放列表，并播放音频源列表。它现在非常简单，未来有很大的扩展空间。在不久的将来，我可能会做更多的工作，在此基础上进行扩展并添加额外的功能。比如显示播放列表的能力，随机播放歌曲的能力，在结束时停止而不是循环播放的能力等等。我们也可以看看一些更先进的控制和…我有一个很酷的想法，我们可以用它来变成一些额外的特殊，我会努力把它们放在一起。稍后会有更多细节。</p></div></div>    
</body>
</html>