<html>
<head>
<title>Gatsby.js — Pagination</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —分页</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-pagination-82bef53764cc?source=collection_archive---------3-----------------------#2021-02-13">https://blog.devgenius.io/gatsby-js-pagination-82bef53764cc?source=collection_archive---------3-----------------------#2021-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9efde8f2b707e981546e71136c53afab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1xedPptkRravskCI"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">真诚媒体</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="747f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby是一个基于React的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Gatsby创建一个站点。</p><h1 id="1050" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">页码</h1><p id="cec7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Gatsby为我们的页面添加分页。</p><p id="6a11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="33bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-config.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0e11" class="mq lc iq mh b gy mr ms l mt mu">module.exports = {<br/>  plugins: [<br/>    `gatsby-transformer-remark`,<br/>    {<br/>      resolve: `gatsby-source-filesystem`,<br/>      options: {<br/>        name: `content`,<br/>        path: `${__dirname}/src/content`,<br/>      },<br/>    },<br/>  ],<br/>}</span></pre><p id="483b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cfed" class="mq lc iq mh b gy mr ms l mt mu">const path = require("path")<br/>const { createFilePath } = require("gatsby-source-filesystem")<br/>exports.createPages = async ({ graphql, actions, reporter }) =&gt; {<br/>  const { createPage } = actions<br/>  const result = await graphql(<br/>    `<br/>      {<br/>        allMarkdownRemark(<br/>          sort: { fields: [frontmatter___date], order: DESC }<br/>          limit: 1000<br/>        ) {<br/>          edges {<br/>            node {<br/>              fields {<br/>                slug<br/>              }<br/>            }<br/>          }<br/>        }<br/>      }<br/>    `<br/>  )<br/>  if (result.errors) {<br/>    reporter.panicOnBuild(`Error while running GraphQL query.`)<br/>    return<br/>  }</span><span id="b77d" class="mq lc iq mh b gy mv ms l mt mu">const posts = result.data.allMarkdownRemark.edges<br/>  const postsPerPage = 6<br/>  const numPages = Math.ceil(posts.length / postsPerPage)<br/>  Array.from({ length: numPages }).forEach((_, i) =&gt; {<br/>    createPage({<br/>      path: i === 0 ? `/blog` : `/blog/${i + 1}`,<br/>      component: path.resolve("./src/templates/blog-list-template.js"),<br/>      context: {<br/>        limit: postsPerPage,<br/>        skip: i * postsPerPage,<br/>        numPages,<br/>        currentPage: i + 1,<br/>      },<br/>    })<br/>  })<br/>}<br/>exports.onCreateNode = ({ node, actions, getNode }) =&gt; {<br/>  const { createNodeField } = actions<br/>  if (node.internal.type === `MarkdownRemark`) {<br/>    const value = createFilePath({ node, getNode })<br/>    createNodeField({<br/>      name: `slug`,<br/>      node,<br/>      value,<br/>    })<br/>  }<br/>}</span></pre><p id="a741" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">src/templates/blog-list-template.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b404" class="mq lc iq mh b gy mr ms l mt mu">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="3b73" class="mq lc iq mh b gy mv ms l mt mu">export default class BlogList extends React.Component {<br/>  render() {<br/>    const posts = this.props.data.allMarkdownRemark.edges<br/>    return (<br/>      &lt;div&gt;<br/>        {posts.map(({ node }) =&gt; {<br/>          const title = node.frontmatter.title || node.fields.slug<br/>          return &lt;div key={node.fields.slug}&gt;{title}&lt;/div&gt;<br/>        })}<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}<br/>export const blogListQuery = graphql`<br/>  query blogListQuery($skip: Int!, $limit: Int!) {<br/>    allMarkdownRemark(<br/>      sort: { fields: [frontmatter___date], order: DESC }<br/>      limit: $limit<br/>      skip: $skip<br/>    ) {<br/>      edges {<br/>        node {<br/>          fields {<br/>            slug<br/>          }<br/>          frontmatter {<br/>            title<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>`</span></pre><p id="daa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了<code class="fe me mf mg mh b">gatsby-source-filesystem</code>插件来从文件系统中读取Markdown文件。</p><p id="b846" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用<code class="fe me mf mg mh b">gatsby-transformer-remark</code>插件将Markdown文件解析成HTML。</p><p id="685d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">gatsby-node.js</code>文件通过GraphQL查询获取Markdown帖子。</p><p id="376f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后创建一个长度为页数的数组。</p><p id="3c2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">forEach</code>遍历它们，并在回调中调用<code class="fe me mf mg mh b">createPage</code>来传递<code class="fe me mf mg mh b">blog-list-template</code>文件的路径以及上下文中的其他数据。</p><p id="c887" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">context</code>属性有更多我们传递到<code class="fe me mf mg mh b">blog-list-template</code>文件中的数据。</p><p id="e67c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括<code class="fe me mf mg mh b">postsPerPage</code>、要跳过的项目数、<code class="fe me mf mg mh b">numPages</code>即页数，以及<code class="fe me mf mg mh b">currentPage</code>。</p><p id="4c95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">blog-list-template.js</code>文件中，我们用<code class="fe me mf mg mh b">skip</code>和<code class="fe me mf mg mh b">limit</code>参数生成<code class="fe me mf mg mh b">blogListQuery</code>以从给定页面中获取项目。</p><p id="b824" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">BlogList</code>组件中，我们调用<code class="fe me mf mg mh b">posts</code>上的<code class="fe me mf mg mh b">map</code>来呈现文章标题。</p><p id="99d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">src/content</code>文件夹中读取降价文件。</p><p id="28a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们去<a class="ae kc" href="http://localhost:8000/blog" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/blog</a>的时候，我们看到的是第一页。</p><p id="fbc1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="http://localhost:8000/blog/2" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/blog</a>有第2页等等。</p><h1 id="8140" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ad82" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Gatsby轻松添加分页。</p></div></div>    
</body>
</html>