<html>
<head>
<title>Kubernetes Ingress With Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Nginx 的 Kubernetes 入口</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kubernetes-ingress-with-nginx-975e6867c617?source=collection_archive---------7-----------------------#2022-11-28">https://blog.devgenius.io/kubernetes-ingress-with-nginx-975e6867c617?source=collection_archive---------7-----------------------#2022-11-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f19b87d1c38edbc7e09a7d1933540644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGTiR1_UfGgAyTs_ti5gVA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">基础建筑</figcaption></figure><p id="5438" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你好，在这篇文章中，我们将看看 kubernetes 入口 nginx 控制器。</p><p id="720c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Ingress 是一个解决方案，它使我们能够将外部流量定向到集群中的 kubernetes 服务。</p><p id="a3ba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">入口 nginx 控制器工作在第 7 层，这意味着它给我们一个机会来做基于路径的路由选择。如果不使用 ingress，我们需要为每个应用使用单独的 loadbalancer，这很难管理，这也是 ingress 漂亮的另一部分。</p><p id="ffed" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">想知道 ingress 是怎么工作的，可以查:</strong><a class="ae kx" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/ingress/</a></p><p id="3b25" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">要安装 nginx 控制器，请点击这里:</strong><a class="ae kx" href="https://kubernetes.github.io/ingress-nginx/deploy/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.github.io/ingress-nginx/deploy/</a></p><p id="db96" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">当您安装 ingress-nginx 时，它会创建一个名称空间来存放由它创建的对象。Nginx 实际上是一个应该在集群中运行的应用程序。这就是它部署部署对象的原因。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/d7b97e2be95de5c682bb6c915b80b4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzKk6jAkM6KHQEU7WT76VA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由 ingress-nginx 创建的对象</figcaption></figure><p id="74ea" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">正如您所看到的，ingress-nginx-controller 创建了一个监听本地主机 80 和 443 端口的负载平衡器服务。</p></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="8944" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您已经安装了 nginx 入口控制器，让我们开始。如果我们看上面的示例架构，我们需要首先创建部署和服务。</p><p id="2f4a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注意:容器的映像只是监听端口 3000 的 express 应用程序，这没什么大不了的。</strong>票务应用程序已获取<strong class="kb io"> "/api/tickets/" </strong>的路由器，订单应用程序已获取<strong class="kb io"> "/api/orders/" </strong>的路由器，并且两者均以简单的“hello from &lt; app-name &gt;”响应。</p><p id="90a0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为票证和订单应用程序创建部署和服务对象；</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><pre class="kz la lb lc gt lm ln lo bn lp lq bi"><span id="17e6" class="lr ls in ln b be lt lu l lv lw">kubectl apply -f depl.yaml</span></pre><p id="a95c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">创建入口；</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><pre class="kz la lb lc gt lm ln lo bn lp lq bi"><span id="1c1d" class="lr ls in ln b be lt lu l lv lw">kubectl apply -f ingress-srv.yaml</span></pre><p id="e6f3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">rules 部分中的主机很重要，因为您可以在一个 kubernetes 集群中托管多个域。这就是这个主机属性的全部内容。</p><p id="c599" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">由于文件中的特定域属性，我们不能仅通过在浏览器上键入 localhost 来访问应用程序。要访问它们，我们将使用一个技巧。换句话说，每当我们试图连接 test.dev 时，它将连接到本地主机，而不是真正的 test.dev 域，由于我们的技巧，它可能存在于互联网上的某个地方。</p><p id="4552" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了应用这个技巧，我们将更改机器内部的主机配置文件。</p><p id="4236" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">主机配置文件的位置取决于操作系统；</p><pre class="kz la lb lc gt lm ln lo bn lp lq bi"><span id="65c2" class="lr ls in ln b be lt lu l lx lw">Windows: C:\Windows\System32\Drivers\hosts<br/>Mac&amp;Linux: /etc/hosts</span></pre><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/6b205b82a19c5fe4552467cf8036b5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWQwSOUWFkEoXmXSMX1OuQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">添加绑定到本地主机 ip 的 test.dev 的定义</figcaption></figure><p id="c846" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">快速注意:</strong>如果您正在使用 minikube，您应该使用您的 minikube ip 而不是 127.0.0.1(要了解您的 minikube ip，只需在您的终端上键入‘minikube IP ’)</p><p id="93f8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以让我们试试，打开浏览器，试着去 test.dev/api/tickets 和 test.dev/api/orders</p><p id="4f42" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你看到<strong class="kb io">不安全</strong>页面。只要在浏览器的某个地方输入“thisisunsafe”就行了。</p><p id="fc5e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我希望它有用。感谢您宝贵的时间。下期文章再见:)</p></div></div>    
</body>
</html>