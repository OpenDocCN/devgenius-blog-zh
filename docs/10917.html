<html>
<head>
<title>Linux — /proc/pid Directory Part One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux — /proc/pid 目录第一部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/linux-proc-directory-part-one-6a98dcf6363d?source=collection_archive---------0-----------------------#2022-12-07">https://blog.devgenius.io/linux-proc-directory-part-one-6a98dcf6363d?source=collection_archive---------0-----------------------#2022-12-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="b632" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">深入研究 Linux /proc/pid 目录</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj kg"><img src="../Images/2b2c149ec8218145a61a86d79cd69f94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*eWqVqAz64RJ2QNA-ZP_6Hw.png"/></div></figure><h1 id="6b66" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">什么是过程</h1><p id="5fe1" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">Linux 系统上的<code class="fe mc md me mf b">/proc</code>目录也是一个文件系统，但与其他常见的文件系统如<code class="fe mc md me mf b">/etc</code>、<code class="fe mc md me mf b">/var</code>……<code class="fe mc md me mf b">proc</code>不同的是，它是一个伪文件系统(即虚拟文件系统)，存储了一系列当前内核运行状态的特殊文件，通过这些文件，用户可以查看相关的系统硬件和当前正在运行的进程的信息，甚至可以通过改变其中的一些文件来改变内核的运行状态。</p><p id="6d66" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">基于<code class="fe mc md me mf b">/proc</code>文件系统的上述特殊性，其中的文件通常被称为<strong class="li is">虚拟文件</strong>，具有一些独特的特征。</p><p id="f276" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">例如，虽然其中一些文件在查看时会返回大量信息，但文件本身的大小显示为 0 字节。此外，这些特殊文件的时间和日期属性通常是当前系统时间和日期，这与它们随时被刷新(存储在 RAM 中)有关。</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="ee85" class="mp kp ir mf b be mq mr l ms mt">$ ls /proc<br/>...<br/>dr-xr-xr-x  4 root            root               0 Nov 13 22:13 bus<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 cgroups<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 cmdline<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 consoles<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 cpuinfo<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 crypto<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 devices<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 diskstats<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 dma<br/>dr-xr-xr-x  2 root            root               0 Nov 17 09:20 driver<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 execdomains<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 fb<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 filesystems<br/>dr-xr-xr-x  8 root            root               0 Nov 13 22:13 fs<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 interrupts<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 iomem<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 ioports<br/>dr-xr-xr-x 25 root            root               0 Nov 13 22:13 irq<br/>-r--r--r--  1 root            root               0 Nov 17 09:20 kallsyms<br/>...</span></pre><p id="a720" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">为了方便查看和使用，通常会将这些文件按照相关性分类存放在不同的目录甚至子目录中。例如，<code class="fe mc md me mf b">/proc/scsi</code>目录存储了当前系统上所有 SCSI 设备的相关信息，<code class="fe mc md me mf b">/proc/N</code>是系统当前运行进程的相关信息，其中 N 是运行进程 ID。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj mu"><img src="../Images/06a5ac3f1d63f403e8c9089e56fddebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2IpqystwHBZqFaxxitC0w.png"/></div></div></figure><p id="5b9f" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">大多数虚拟文件可以使用文件查看命令查看，如<code class="fe mc md me mf b">cat</code>、<code class="fe mc md me mf b">more</code>或<code class="fe mc md me mf b">less</code>。有些文件信息可以一目了然的表达出来，但有些文件信息可读性不是很强。然而，当使用一些命令如<code class="fe mc md me mf b">free</code>、<code class="fe mc md me mf b">lspci</code>或<code class="fe mc md me mf b">top</code>查看时，这些可读性较差的文件可以有很好的性能。</p><h1 id="939f" class="ko kp ir bd kq kr ks kt ku kv kw kx ky jx kz jy la ka lb kb lc kd ld ke le lf bi translated">进程中的 PID 目录</h1><p id="c620" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated"><code class="fe mc md me mf b">/proc</code>目录包含许多以数字命名的子目录。这些数字表示系统中当前运行的进程的进程号，其中包含与相应进程相关的多个信息文件。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj mz"><img src="../Images/c6a40668fd73f97143ae256909b38cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*lrvs-P2Ugbmis8Ms6T8dNA.png"/></div></figure><p id="8704" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">让我们来详细看看一个进程目录:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gi gj na"><img src="../Images/c41170e32e731beb961a78e6c1f62f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PiPjL3hfsVvIzwqVOJ9eA.png"/></div></div></figure><h2 id="d513" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /arch_status</pid></h2><p id="43a1" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">为给定的 Linux 进程公开特定于体系结构的信息的新接口。当<em class="nn">CONFIG _ PROC _ PID _ ARCH _ STATUS</em>启用时，将有这个新的<em class="nn"> arch_status </em>文件来公开给定任务的任何额外的架构特定信息。</p><h2 id="a25d" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /attr</pid></h2><p id="bae7" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">进程安全属性。</p><ul class=""><li id="01f6" class="no np ir li b lj mg lm mh lp nq lt nr lx ns mb nt nu nv nw bi translated"><strong class="li is"> exec </strong>:表示分配给流程的属性，这是支持角色/域转换所需要的</li><li id="61af" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated"><strong class="li is"> fscreate </strong>:表示为后续调用创建的文件赋值的属性— mkdir — symlink</li><li id="5a64" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated"><strong class="li is"> keycreate </strong>:如果/当一个进程将一个安全上下文写入这个文件时，所有先前的密钥都将被标记上这个上下文</li><li id="c0b4" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated"><strong class="li is">上一个</strong>:显示上一个值/过程/[PID]/属性/当前</li><li id="ba67" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated"><strong class="li is"> sockcreate </strong>:如果/当一个进程将安全上下文写入该文件时，所有先前创建的套接字将被标记上该上下文</li></ul><h2 id="f950" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /autogroup</pid></h2><p id="5828" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">流程的自动组(任务组)成员身份。例如:</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="4528" class="mp kp ir mf b be mq mr l ms mt">$ cat autogroup<br/>/autogroup-7430 nice 0</span></pre><p id="a733" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">该文件也可用于修改分配给自动组的 CPU 带宽<br/>。这是通过将“nice”<br/>范围内的一个数字写入文件来设置自动组的 nice 值来实现的。</p><h2 id="7ab2" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /auxv</pid></h2><p id="85ee" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">意思是辅助向量。这包含了在执行时传递给进程的 ELF 解释器信息的内容。<br/>这些值是操作系统作为启动信息传递给动态链接器的值。这些向量是向程序解释器(例如 ld)和进程传输一些操作系统特定信息的机制。</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="e709" class="mp kp ir mf b be mq mr l ms mt">$ hexdump -Cv auxv<br/>00000000  21 00 00 00 00 00 00 00  00 90 dd 50 fd 7f 00 00  |!..........P....|<br/>00000010  10 00 00 00 00 00 00 00  ff fb 8b 17 00 00 00 00  |................|<br/>00000020  06 00 00 00 00 00 00 00  00 10 00 00 00 00 00 00  |................|<br/>00000030  11 00 00 00 00 00 00 00  64 00 00 00 00 00 00 00  |........d.......|<br/>00000040  03 00 00 00 00 00 00 00  40 00 a0 3e 73 55 00 00  |........@..&gt;sU..|<br/>00000050  04 00 00 00 00 00 00 00  38 00 00 00 00 00 00 00  |........8.......|<br/>00000060  05 00 00 00 00 00 00 00  09 00 00 00 00 00 00 00  |................|<br/>00000070  07 00 00 00 00 00 00 00  00 b0 1e bf 60 7f 00 00  |............`...|<br/>00000080  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br/>00000090  09 00 00 00 00 00 00 00  50 6d a0 3e 73 55 00 00  |........Pm.&gt;sU..|<br/>000000a0  0b 00 00 00 00 00 00 00  e9 03 00 00 00 00 00 00  |................|<br/>000000b0  0c 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br/>000000c0  0d 00 00 00 00 00 00 00  e9 03 00 00 00 00 00 00  |................|<br/>000000d0  0e 00 00 00 00 00 00 00  e9 03 00 00 00 00 00 00  |................|<br/>000000e0  17 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  |................|<br/>000000f0  19 00 00 00 00 00 00 00  e9 3a da 50 fd 7f 00 00  |.........:.P....|<br/>00000100  1a 00 00 00 00 00 00 00  02 00 00 00 00 00 00 00  |................|<br/>00000110  1f 00 00 00 00 00 00 00  ea 5f da 50 fd 7f 00 00  |........._.P....|<br/>00000120  0f 00 00 00 00 00 00 00  f9 3a da 50 fd 7f 00 00  |.........:.P....|<br/>00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br/>00000140</span></pre><h2 id="8e1f" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /cgroup</pid></h2><p id="14bb" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">给定进程所属的组。文件<code class="fe mc md me mf b">cgroup</code>有零行或多行，格式为:</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="5b57" class="mp kp ir mf b be mq mr l ms mt">hierarchy_id:controller_list:cgroup_path</span></pre><p id="704f" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">该文件重新格式化的内容示例如下:</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="11f7" class="mp kp ir mf b be mq mr l ms mt">$ cat cgroup<br/>11:hugetlb:/<br/>10:net_cls,net_prio:/<br/>9:memory:/<br/>8:devices:/<br/>7:perf_event:/<br/>6:blkio:/<br/>5:freezer:/<br/>4:cpu,cpuacct,cpuset:/daemons<br/>3:cpuset:/<br/>2:pids:/<br/>1:name=systemd:/user.slice/user-1001.slice/session-2239.scope</span></pre><p id="713f" class="pw-post-body-paragraph lg lh ir li b lj mg js ll lm mh jv lo lp mi lr ls lt mj lv lw lx mk lz ma mb ik bi translated">以<code class="fe mc md me mf b">4:cpu,cpuacct,cpuset:/daemons</code>为例，冒号分隔的字段从左到右依次为:</p><ul class=""><li id="58d1" class="no np ir li b lj mg lm mh lp nq lt nr lx ns mb nt nu nv nw bi translated">对于 cgroups 版本 1 层次结构，该字段包含一个唯一的层次结构 ID 号，可以与<code class="fe mc md me mf b">/proc/cgroups</code>中的层次结构 ID 相匹配。对于 cgroups 版本 2 层次结构，该字段包含值 0。</li><li id="c6bf" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated">对于 cgroups 版本 1 层次结构，该字段包含绑定到该层次结构的控制器的逗号分隔列表。对于 cgroups 版本 2 层次结构，此字段为空。</li><li id="870e" class="no np ir li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated">此字段包含流程所属的层次结构中的控制组的路径名。该路径名相对于层次结构的装载点。</li></ul><h2 id="e162" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /clear_refs</pid></h2><p id="77c3" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">一个只写文件，只能由进程的所有者写，并且只有在<strong class="li is">CONFIG _ PROC _ PAGE _ MONITOR</strong>内核配置选项被启用时才存在。</p><h2 id="eee8" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /cmdline</pid></h2><p id="18ca" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">完成命令来启动当前进程，但是僵尸进程目录中的这个文件不包含任何信息。例如，流程<code class="fe mc md me mf b">sshd</code> cmdline 看起来像这样:</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="0237" class="mp kp ir mf b be mq mr l ms mt">$ cat cmdline<br/>/usr/sbin/sshd-D</span></pre><h2 id="3397" class="nb kp ir bd kq nc nd dn ku ne nf dp ky lp ng nh la lt ni nj lc lx nk nl le nm bi translated">/proc/ <pid> /comm</pid></h2><p id="2969" class="pw-post-body-paragraph lg lh ir li b lj lk js ll lm ln jv lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">该文件公开了进程的 comm 值，即与进程相关联的命令名。同一进程中的不同线程可能具有不同的<code class="fe mc md me mf b">comm</code>值。仍然用<code class="fe mc md me mf b">sshd</code>过程作为例子，它的<code class="fe mc md me mf b">comm</code>值看起来像:</p><pre class="kh ki kj kk gu ml mf mm bn mn mo bi"><span id="c828" class="mp kp ir mf b be mq mr l ms mt">$ cat comm<br/>sshd</span></pre></div></div>    
</body>
</html>