<html>
<head>
<title>Making Publication Quality Inset Maps in R using ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 ggplot2 在 R 中制作出版物质量的插图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-publication-quality-inset-maps-in-r-using-ggplot2-85359c492ac8?source=collection_archive---------4-----------------------#2022-08-24">https://blog.devgenius.io/making-publication-quality-inset-maps-in-r-using-ggplot2-85359c492ac8?source=collection_archive---------4-----------------------#2022-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9ba4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇博文中，我将展示我们如何使用<code class="fe ki kj kk kl b">ggplot2</code>包在 R 中制作出版物质量的插图。</p><p id="2975" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当在期刊上发表科学研究或在会议上介绍研究工作时，显示数据收集地点或实验地点的地图是关键的可视化之一。研究地点/位置的地图可以帮助观众和读者更好地理解数据。</p><p id="5a22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">制图听起来很奇特，但它需要大量的培训和技能来制作高质量的地图，这些地图对读者友好且具有视觉美感。有时，研究地点更加分散，易于在大的地理区域中可视化。然而，在某些情况下，研究站点是聚集的，这使得很难在更大的范围内显示它们。在这种情况下，插图有助于我们参照熟悉的地理区域来显示位置。</p><p id="3900" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">插图是与主地图显示在同一页面上的较小地图。传统上，插图以比主地图更大的比例(更小的区域)显示。通常，插图用作定位器地图，在更广泛、更熟悉的地理参照系中显示主地图的区域。</p><h1 id="590e" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">加载库</h1><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="5527" class="ls kn in kl b gy lt lu l lv lw"><strong class="kl io">library</strong>(tidyverse)<br/><strong class="kl io">library</strong>(readxl)<br/><strong class="kl io">library</strong>(ozmaps) <br/><strong class="kl io">library</strong>(grid)<br/><strong class="kl io">library</strong>(gt)</span></pre><h1 id="c11d" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">加载数据</h1><p id="08c2" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在这篇博文中，我将使用澳大利亚新南威尔士不同实验地点的地理坐标数据。这些地点包括对不同杂草的适应和示范试验。</p><h1 id="e413" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">实验坐标</h1><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="14a7" class="ls kn in kl b gy lt lu l lv lw"><em class="mc"># coordinates</em><br/>data &lt;- read.csv("https://raw.githubusercontent.com/MohsinRamay/sampledata/main/GPS_coordinates_for_map.csv") %&gt;% <br/>  select(-3)</span><span id="3446" class="ls kn in kl b gy md lu l lv lw">head(data)</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/0e98767b93d54d0a09637df81d8130c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ao8ie2Smu7k5G_f29mbS1w.png"/></div></div></figure><h1 id="6249" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">澳大利亚地图</h1><ul class=""><li id="7575" class="mm mn in jm b jn lx jr ly jv mo jz mp kd mq kh mr ms mt mu bi translated">我将使用<code class="fe ki kj kk kl b">ozmap</code>函数从<code class="fe ki kj kk kl b">ozmaps</code>包中提取澳洲地图。</li></ul><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="6377" class="ls kn in kl b gy lt lu l lv lw"><em class="mc"># Australia map</em><br/>sf_aus &lt;- ozmap("states")</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/f2e8228eedde29b9730932c003e5c587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xbcyskom-Yatgx-q.png"/></div></div></figure><h1 id="3be1" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">最近的城市名称</h1><p id="3361" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我将通过过滤每个分组城镇数据的第一行，从原始数据集中提取最近的城市名称及其坐标。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="a7df" class="ls kn in kl b gy lt lu l lv lw"><em class="mc"># cities </em><br/>town &lt;- data %&gt;% <br/>  arrange(Town) %&gt;% <br/>  group_by(Town) %&gt;% <br/>  filter(row_number()==1) %&gt;% <br/>  ungroup()</span><span id="c4ba" class="ls kn in kl b gy md lu l lv lw">gt(town)</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/2970c43c46a83320649055d38cc69e6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3ZuFCYNa0mcrx8alNqhCw.png"/></div></div></figure><p id="2061" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">地图</strong></p><p id="41e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我将创建一个简单的带有实验地点的澳大利亚全国地图。我会用不同的符号来表示网站类型，用不同的颜色来表示杂草。</p><h1 id="1d56" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">原始地图</h1><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="048d" class="ls kn in kl b gy lt lu l lv lw">data %&gt;% <br/>  ggplot() + <br/>  geom_sf(data = sf_aus) +<br/>  geom_point(aes(x = Longitude, y = Latitude, color = Weed.species, shape = Site)) +<br/>  xlim(112, 155) +<br/>  labs() +<br/>  theme_bw()</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/4d6755447052a5a62429576f68f93ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wO7MFnEqx7YIpNOb.png"/></div></div></figure><p id="bf02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如您所见，在全国比例地图上绘制时，研究地点是聚类的(在新南威尔士州)。但是，为了更好地了解研究地点与附近城市/城镇的关系，我们需要以集中的比例绘制它们。为此，我们首先需要确定研究地点的范围。</p><h1 id="d2b0" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">程度</h1><p id="56cb" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我将使用简单的水平线和垂直线来显示研究地点的范围。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="458a" class="ls kn in kl b gy lt lu l lv lw">data %&gt;% <br/>  ggplot() + <br/>  geom_sf(data = sf_aus) +<br/>  geom_point(aes(x = Longitude, y = Latitude, color = Weed.species, shape = Site)) +<br/>  xlim(112, 155) +<br/>  geom_hline(yintercept = -38, lty = 2, colour = "red") +<br/>  geom_hline(yintercept = -29, lty = 2, colour = "red") +<br/>  geom_vline(xintercept = 147, lty = 2, colour = "red") +<br/>  geom_vline(xintercept = 153, lty = 2, colour = "red") +<br/>  labs() +<br/>  theme_bw()</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/ea15956e72ba6ed96b751e5cd9a994f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*la6Lk4V06M8gMIZb.png"/></div></div></figure><p id="9e73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用之前地图中的<code class="fe ki kj kk kl b">min</code>和<code class="fe ki kj kk kl b">max</code>坐标值，我们可以在研究地点上绘制一个多边形，并查看此范围是否能最好地显示数据。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="f5b3" class="ls kn in kl b gy lt lu l lv lw">data %&gt;% <br/>  ggplot() + <br/>  geom_sf(data = sf_aus) +<br/>  geom_point(aes(x = Longitude, y = Latitude, color = Weed.species, shape = Site)) +<br/>  xlim(112, 155) +<br/>  geom_rect(aes(xmin = 147, xmax = 153, ymin = -38, ymax = -29), color = "red", fill = NA) +<br/>  labs() +<br/>  theme_bw()</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/87aed55e28f519db9f4fb8c319e2d861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*03viSqRgFhdlu_J9.png"/></div></div></figure><h1 id="47ed" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">焦点图</h1><p id="2db6" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">现在，我将使用在之前步骤中确定的范围坐标绘制研究地点的聚焦版本。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="5f6a" class="ls kn in kl b gy lt lu l lv lw">data %&gt;% <br/>  mutate(point_size = ifelse(Site == "Demonstration", 1, 0)) %&gt;% <br/>  ggplot() + <br/>  geom_sf(data = sf_aus) +<br/>  geom_point(aes(x = Longitude, y = Latitude, color = Weed.species, shape = Site, size = point_size &gt; 0), alpha = 0.75) +<br/>  scale_size_manual(values=c(2,3.5)) +<br/>  xlim(147, 153) +<br/>  ylim(-38, -30) +<br/>  theme_test() +<br/>  guides(size = "none")</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/351b54659a3adb9bb4742629f4e9f7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*acX3sVR0Gagejq8A.png"/></div></div></figure><p id="2ee3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与前一个版本相比，这个版本看起来更好。但是，我们需要补充一些信息，给它一个参考。此外，我们需要删除新南威尔士州南部的边界线。为此，我将使用库<code class="fe ki kj kk kl b">sf</code>的<code class="fe ki kj kk kl b">st_union</code>函数来溶解边界线。然后，我们将在后续的地图中使用溶解的多边形。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="bf07" class="ls kn in kl b gy lt lu l lv lw"><em class="mc"># Now the dissolve</em><br/><strong class="kl io">library</strong>(sf)</span><span id="36db" class="ls kn in kl b gy md lu l lv lw">AN = sf_aus %&gt;% <br/>  filter(NAME %<strong class="kl io">in</strong>% c("New South Wales", "Australian Capital Territory"))</span><span id="22e6" class="ls kn in kl b gy md lu l lv lw">NM &lt;- st_union(AN)</span><span id="245d" class="ls kn in kl b gy md lu l lv lw">plot(NM)</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/80a0be9fb3552e284004d429e365a3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1hR8cDAsJR040cE3.png"/></div></div></figure><h1 id="f511" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">添加地图元素</h1><p id="182c" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">专业地图也包括一些元素，如<code class="fe ki kj kk kl b">North Arrow</code>和<code class="fe ki kj kk kl b">scale</code>等。我们也将这些组件添加到我们的地图中。除此之外，我还会添加最近的城镇名称，并用<code class="fe ki kj kk kl b">lightblue</code>颜色填充非陆地区域，分别作为参考和区分。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="b62e" class="ls kn in kl b gy lt lu l lv lw">ss &lt;- data %&gt;% <br/>  mutate(point_size = ifelse(Site == "Demonstration", 1, 0)) %&gt;% <br/>  ggplot() + <br/>  geom_sf(data = NM) +<br/>  geom_point(aes(x = Longitude, y = Latitude, color = Weed.species, shape = Site, size = point_size &gt; 0), alpha = 0.75) +<br/>  scale_size_manual(values=c(2,3.5)) +<br/>  xlim(147, 153) +<br/>  ylim(-38, -30) +<br/>  ggrepel::geom_text_repel(aes(x = Longitude, y = Latitude, label = Town), data = town, nudge_y = 0.06, nudge_x = 0.06, size = 2) +<br/>  labs(color = "Weed species") +<br/>  theme_test() +<br/>  theme(panel.background = element_rect(fill = "lightblue")) +<br/>  guides(size = "none") +<br/>  ggsn::north(location = "topleft", scale = 0.8, symbol = 12,<br/>               x.min = 151.5, x.max = 152.5, y.min = -36, y.max = -38) +<br/>  ggsn::scalebar(location = "bottomleft", dist = 100,<br/>           dist_unit = "km", transform = TRUE, <br/>           x.min=150.5, x.max=152, y.min=-38, y.max=-30,<br/>           st.bottom = FALSE, height = 0.025,<br/>           st.dist = 0.05, st.size = 3)</span><span id="2de6" class="ls kn in kl b gy md lu l lv lw">ss</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/ec2d06137539bae3c2623baeb0092df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PRl69daQGLmmppLV.png"/></div></div></figure><h1 id="93cd" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">插页地图</h1><p id="7df5" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">现在，我将创建一个全比例的澳大利亚地图，用红色多边形显示研究地点的范围和重点地图。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="095a" class="ls kn in kl b gy lt lu l lv lw"><em class="mc"># Map of Australia</em><br/>inset &lt;- sf_aus %&gt;% <br/>  ggplot() + <br/>  geom_sf() +<br/>  <em class="mc">#geom_sf(data = NM) +</em><br/>  geom_rect(aes(xmin = 147, xmax = 153, ymin = -38, ymax = -30), color = "red", fill = NA) +<br/>  xlim(112, 155) +<br/>  labs(x = NULL, y = NULL) +<br/>  theme_test() + <br/>  theme(axis.text = element_blank(),<br/>        axis.ticks = element_blank(),<br/>        axis.ticks.length = unit(0, "pt"),<br/>        axis.title=element_blank(),<br/>        plot.margin = margin(0, 0, 0, 0, "cm"),<br/>        panel.background = element_rect(fill = "lightblue"))</span><span id="6016" class="ls kn in kl b gy md lu l lv lw">inset</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/bfeee3f9a8a4e9659324864e822c16ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nbi7NB6B94sNxW4u.png"/></div></div></figure><h1 id="6ba2" class="km kn in bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">最终地图</h1><p id="1ae9" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">现在，我将合并两张地图，在左上角插入澳大利亚地图。</p><pre class="lk ll lm ln gt lo kl lp lq aw lr bi"><span id="ad00" class="ls kn in kl b gy lt lu l lv lw">ss</span><span id="8361" class="ls kn in kl b gy md lu l lv lw"><em class="mc"># Combining both maps</em><br/>print(inset, vp = viewport(0.322, 0.859, width = 0.25, height = 0.25))</span></pre><figure class="lk ll lm ln gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/dd9dfde5fdb380a62d324a44dcd50766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uGbM0MZXP-YmcttG.png"/></div></div></figure><p id="7ef6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这张插图更好地显示了研究地点相对于国家和省份的位置，并且更加专业。</p><p id="eeeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">就是这样！</strong></p><p id="1ef6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你有任何问题，请随时联系我。</p></div></div>    
</body>
</html>