<html>
<head>
<title>ETL with Glue and other AWS services on [Amazon reviews dataset]- PART- I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在[Amazon reviews dataset]上使用 Glue 和其他 AWS 服务的 ETL 第一部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/etl-with-glue-and-other-aws-services-on-amazon-reviews-dataset-2e1f6b7580cf?source=collection_archive---------16-----------------------#2022-08-18">https://blog.devgenius.io/etl-with-glue-and-other-aws-services-on-amazon-reviews-dataset-2e1f6b7580cf?source=collection_archive---------16-----------------------#2022-08-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><pre class="jk jl jm jn gt jo jp jq jr aw js bi"><span id="0e5b" class="jt ju in jp b gy jv jw l jx jy">We are going to build end to end ETL pipeline using AWS Glue service. This post is a practical lab where any beginner can follow through to know more about Glue and associated services in AWS to create a ETL pipeline. There will be no theory and its mostly practical.</span></pre><p id="e8ae" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">源代码</p><p id="d65c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae kx" href="https://github.com/ramthulsi/glue-etl" rel="noopener ugc nofollow" target="_blank">https://github.com/ramthulsi/glue-etl</a></p><h1 id="7ff2" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">实验室介绍</h1><h1 id="72f5" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用的服务</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lv"><img src="../Images/81275b71b4aabadcd45b2783492104b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NHZc2YUU_-1N5Hb7KbjjiQ.png"/></div></div></figure><h1 id="34f4" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我们在这个实验室做什么？</h1><pre class="jk jl jm jn gt jo jp jq jr aw js bi"><span id="85e7" class="jt ju in jp b gy jv jw l jx jy">We are going to build end to end ETL pipeline using AWS Glue service</span></pre><h1 id="81eb" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">架构图</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi md"><img src="../Images/ae28ee0041579b9ea818e676c476f87d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ac8B6O9eXTOrZtAbdmxOHw.png"/></div></div></figure></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="af49" class="ky ju in bd kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu bi translated">让我们开始:</h1><h1 id="4fd8" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">01-S3:</h1><p id="4c48" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">我们将使用 S3 作为存储数据集的源</p><h1 id="66d5" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建 S3 存储桶来托管数据集</h1><blockquote class="mv mw mx"><p id="dcdc" class="jz ka my kb b kc kd ke kf kg kh ki kj mz kl km kn na kp kq kr nb kt ku kv kw ig bi translated">选择时段名称，并选择要创建时段的区域</p></blockquote><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/9ea2f74efe11c0b13532e3fbc58e2c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SKrxhiVDGPzcAnRODkwow.png"/></div></div></figure><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/918208f98867580e0388ee66fd2fc950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_slZgeLBX3PsTKZcMNLDQ.png"/></div></div></figure><h1 id="9850" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">查看详细信息并创建一个存储桶:</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/fac03becd4086cad4ff67e5ca9e92ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4ATfViwUjSSE1xdYDIuvw.png"/></div></div></figure><h1 id="c39b" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">下载数据集</h1><p id="6b7d" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">该数据集可通过以下链接获得:</p><div class="nd ne gp gr nf ng"><a href="https://s3.amazonaws.com/amazon-reviews-pds/readme.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd io gy z fp nl fr fs nm fu fw im bi translated">亚马逊客户评论数据集</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">亚马逊客户评论(又名产品评论)是亚马逊的标志性产品之一。在二十多年的时间里…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">s3.amazonaws.com</p></div></div></div></a></div><p id="1299" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们将数据复制到本地机器，然后复制到我们刚刚创建的 BUCKET</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi np"><img src="../Images/c2997575d9d416c6f2d7977dee21bb75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QOcW0G3KNJNEelbhlAwMg.png"/></div></div></figure><h1 id="be37" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">02 胶水:</h1><p id="a87b" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">本节进一步分为 3 个部分:</p><p id="a6fc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">a.胶粘履带车</p><p id="9ca2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">b.GlueStudio</p><p id="bb40" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">c.Glue-ETL-Labs</p><h2 id="8e61" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">a.胶水爬行器:</h2><p id="4223" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">Glue Crawler 用于从 S3 加载原始数据，然后我们可以转换数据并进行 ETL</p><h1 id="195d" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据转换和 ETL</h1><h2 id="8dd9" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">为原始数据加载创建粘合爬虫</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi ob"><img src="../Images/e46330875b53c67571a52360e569c813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfQNyawCFN7br-zu1XhmTA.png"/></div></div></figure><blockquote class="mv mw mx"><p id="cdc6" class="jz ka my kb b kc kd ke kf kg kh ki kj mz kl km kn na kp kq kr nb kt ku kv kw ig bi translated">在 AWS 粘附菜单上，选择爬网程序。</p></blockquote><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/27e4381efab67fd614ec6170a414a660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iF4m6pRGbG_EpTHqpbtq5Q.png"/></div></div></figure><ul class=""><li id="51c5" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">单击添加爬网程序。</li><li id="f15c" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">输入<em class="my"> amazon-glueetl-lab </em>作为初始数据加载的爬虫名称。</li><li id="af07" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">或者，输入描述。这也应该是描述性的，易于识别，然后单击下一步。</li></ul><h1 id="6be8" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">选择数据存储，搜索所有文件夹，然后单击下一步</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/444219fc27713f13378fbfaa79c50a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEYwgZqXQvaA8ecete1LyQ.png"/></div></div></figure><h2 id="a244" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在“添加数据存储”页面上，进行以下选择:</h2><ul class=""><li id="1d95" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">对于“选择数据存储”，单击下拉框并选择“S3”。</li><li id="47dc" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">对于在中对数据进行爬网，请选择“我的帐户”中的指定路径。</li><li id="a686" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">对于包含路径，浏览到存储 CSV 文件的目标文件夹，例如 S3://S3://Amazon-dataset-reviews-thulasi/analysis</li></ul><h2 id="c5cb" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">单击下一步</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/249c8cef23e34f9b8792c4d476774327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bDcVfU6JY8tmp8ioKlkLDA.png"/></div></div></figure><h2 id="49ae" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在“添加另一个数据存储”页面上，选择“否”,然后单击“下一步”。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/387c4a810ef7a57d343117ec3df863ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbLNMy4jT7uOSuS5Df0J0g.png"/></div></div></figure><h2 id="b4e9" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在“选择 IAM 角色”页面上，进行以下选择:</h2><p id="9fa5" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">选择选择现有的 IAM 角色。</p><p id="5531" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于“我是”角色，创建新的“我是”角色并为其命名。例如:“AWSGlueServiceRole-glue-ETL-role”</p><h2 id="df3e" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">单击下一步。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/ea66b0ec076e8e23bfa9bcd9742fa22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3JPoj9O_VCV33y98DAbjA.png"/></div></div></figure><h2 id="b241" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在“为此 crawler 创建调度”页上，对于频率，选择按需运行，然后单击下一步。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/b263182ebd6c29ec0ba3476c02fbf061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sd1eNIWqiVNqUmEkldRyUw.png"/></div></div></figure><h2 id="9db5" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在 Configure crawler 的输出页面上，单击 Add database 为我们的 Glue 目录创建一个新的数据库。</h2><p id="27e7" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">输入 glue-etl 作为您的数据库名称，然后单击 create</p><p id="d018" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于配置选项(可选)，选择“更新数据目录中的表定义”并保留其余的默认配置选项，然后单击 Next。</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/e2ed1c609147e39ac01aaea0f2286a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKiBbCiDKaWN3weVu9AOQg.png"/></div></div></figure><h2 id="c23e" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">查看摘要页面，记录包含路径和数据库输出，然后单击 Finish。爬虫现在准备运行。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/707b97965071acf60fdf8f2248f2112c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emW4tHQIH9RLtEWPRSWGmw.png"/></div></div></figure><h2 id="d265" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">勾选爬虫名称，点击运行爬虫按钮。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/af5956884ac16ec64f88aa8a6d9d35ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHZnKxF61PLM86Y3ndl3wg.png"/></div></div></figure><p id="f0a5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Crawler 会将状态从 starting 改为 stopping，等到 crawler 回到 ready 状态(这个过程需要几分钟)，可以看到它已经创建了 glue-etl 表，对于 1.2GB 的数据用了不到一分钟的时间。</p><h2 id="2cc8" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在 AWS Glue 导航窗格中，单击数据库&gt;表。您还可以单击 glue-etl 数据库来浏览这些表。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/56638784694cc4e3420fa329a8603d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lUXRNi1dw2XlhmHOTUPDg.png"/></div></div></figure><h1 id="8e1e" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据验证:</h1><h2 id="1a3d" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在 glue-etl 数据库的 Tables 部分，单击“analysis”表。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/26c09e39b2b92a1036d8a80d3c4d06d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqh3uP5qD4pzpolK8l5sxQ.png"/></div></div><figcaption class="ot ou gj gh gi ov ow bd b be z dk translated">您可以看到 Glue crawler 已经创建了我们从 S3 选择的数据集的模式。</figcaption></figure><h1 id="49d5" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">检查数据库模式详细信息</h1><ul class=""><li id="246b" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">点击左上角的编辑表格，你可以看到表格的所有细节，如大小，记录数等。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/d334e907461ac4bb64b71d3c0cb81af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_oIDrMa_UzMqigr9CMLgCg.png"/></div></div></figure><h1 id="482e" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">更改列的名称。</h1><ul class=""><li id="2c18" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">*点击你想要编辑的列并保存。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/92058af05adc28a48ca217b40777e0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bZhSxrsW_SrojnROCr4DA.png"/></div></div></figure><h1 id="86d7" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">添加额外的列</h1><ul class=""><li id="634d" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">单击右上角的 Edit Schema，您可以添加新列</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/3e9aca3f33f6fd3f74c40f92a7737523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqNXuR7iNb_4MXMm-nFTzA.png"/></div></div></figure><h1 id="2fb6" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">监视</h1><ul class=""><li id="9d66" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">一旦爬虫处于就绪状态，您就可以检查爬虫日志的状态</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/2625f70261f5a750fe2e24ed0d02be77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVcaFItmvn5eWqyVNxpsXQ.png"/></div></div></figure></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="b186" class="ky ju in bd kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu bi translated">b.GlueStudio:</h1><h2 id="4bd3" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">GlueStudio 练习</h2><p id="3359" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">先决条件为要保存的输出数据创建一个新的 s3 输出存储桶，或者在同一个初始存储桶中创建一个<code class="fe ox oy oz jp b">outputs</code>文件夹。在本实验中，我将使用同一个 S3 存储桶和输出文件夹来保存 Glue Studio 的输出数据。</p><p id="a27c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ox oy oz jp b">Bucket-Name: amazon-dataset-reviews-thulasi</code> <code class="fe ox oy oz jp b">output-Folder: outputs</code></p><h2 id="afb9" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">在左侧导航窗格中的 ETL 下，单击 AWS Glue Studio。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/55fd56162b09b3ff6e77595ba8ed1d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Htps37cJgAvT3dgrI_el_g.png"/></div></div></figure><h1 id="35de" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">点击查看工作</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/5f61333f42a12a493f363902ad5800ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrtzzSTwrq5ebdapXD0AqA.png"/></div></div></figure><ul class=""><li id="eb08" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">选择图表顶部的数据源— S3 存储桶。</li><li id="b4e5" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">在“数据源属性— S3”下的右侧面板中，从下拉列表中选择<code class="fe ox oy oz jp b">glue-etl</code>数据库。</li><li id="dbc9" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">对于表格，选择<code class="fe ox oy oz jp b">analysis</code>表格。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/89644a79c73120c68f179fd9ae9fddd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xD13YlLi1ebD9rV71Vk0g.png"/></div></div></figure><h2 id="3cf1" class="jt ju in bd kz nq nr dn ld ns nt dp lh kk nu nv ll ko nw nx lp ks ny nz lt oa bi translated">选择 ApplyMapping 节点。在右边的转换面板中，将下拉列表中<code class="fe ox oy oz jp b">customer_id</code>列的数据类型改为 double。</h2><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/5af5a58dc43bf61ea6398e5cb510f00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJhzvtGpXwXZRbfXGo9_Yg.png"/></div></div></figure><ul class=""><li id="7c7f" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">选择图形底部的数据目标——S3 时段节点，并在下拉列表中将格式更改为<code class="fe ox oy oz jp b">JSON</code>。请随意处理类型，删除转换输出的列等。</li><li id="afc4" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">在“S3 目标位置”下，选择“浏览 S3”浏览到“亚马逊-数据集-评论-thulasi”桶，选择“输出文件夹”项目，然后按“选择”。</li></ul><p id="f4b3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">或者添加存储桶路径</p><p id="4f2f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ox oy oz jp b">s3://amazon-dataset-reviews-thulasi/outputs/</code></p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/5f1f0418d2643311d137252bfae31f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gLdKUgld1gYlhn5QCsIbig.png"/></div></div></figure><ul class=""><li id="c6a0" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">最后，选择顶部的 Job details 选项卡。在名称下输入<code class="fe ox oy oz jp b">glue-etl-lab-studio</code>。</li><li id="c2f6" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">对于 IAM 角色，由于输出文件夹位于同一个 S3 存储桶中，所以我选择了与 Crawler 相同的角色。请随意创建具有新权限的新角色，或者使用新的 s3 存储桶更新相同的角色</li><li id="ff39" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">向下滚动页面，在作业书签下的下拉列表中选择禁用。</li></ul><p id="1209" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注 Glue ETL 根据作业中定义的工作线程数编写多部分上传输出文件。如果您需要大型文件，请保持较低的工作人员数量(最少 2 个)</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/5ff06cad67fcca67b031e507dcb04422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*skWLHSZeM5grY5-HgmDn7g.png"/></div></div></figure><p id="ffba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">按右上角的保存按钮创建作业。</p><p id="952a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在标题中看到成功创建作业的消息后，单击运行按钮启动作业。</p><p id="26d5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">从左侧的导航面板中选择作业，以查看您的作业列表。</p><p id="9fe8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">从左侧的导航面板中选择 Monitoring，以查看正在运行的作业、成功率/失败率和各种其他统计数据。</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/3561ef590fd0f24d2eafc51647ac0058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuDLnDQKh0-jhWqEucuojA.png"/></div></div></figure><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/24c161396e01a995bc170ba96836b0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_SU175bkVWPgS2fuyPV2NA.png"/></div></div></figure><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/8064daee3c53a6ed97cbb8e32287bfd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1cLdiK7BjnK-NRi6AbyzA.png"/></div></div></figure><h1 id="3db1" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">c.glue-ETL/实验室</h1><h1 id="2089" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">集合函数练习</h1><p id="f91c" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">先决条件为要保存的输出数据创建一个新的 s3 输出存储桶，或者在同一个初始存储桶中创建一个<code class="fe ox oy oz jp b">outputs</code>文件夹。在本实验中，我将使用同一个 S3 存储桶和输出文件夹来保存 Glue Studio 的输出数据。</p><p id="8f71" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ox oy oz jp b">Bucket-Name: amazon-dataset-reviews-thulasi</code> <code class="fe ox oy oz jp b">output-Folder: outputs</code></p><h1 id="e8b6" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><ul class=""><li id="6d6c" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">确保您已经完成了<code class="fe ox oy oz jp b">01-gluecrawler</code>实验，并将您的图书数据放在数据目录中</li><li id="e9ee" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">同样，为从<code class="fe ox oy oz jp b">Amazon Reviews Dataset</code>复制的服装数据集创建数据目录</li></ul><h1 id="586e" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建开发端点</h1><ul class=""><li id="dd88" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">在左侧窗格中选择“Dev Endpoints ”,然后单击“add endpoint”</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/16043d890c6b6bd4226aee10af619a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKFZB_tbC0VPigOzxDkwCA.png"/></div></div></figure><ul class=""><li id="4a26" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">为端点和角色赋予一个新的，然后单击 next eg: glue-etl-endpint，AWSGlueServiceRole-glue-ETL-role</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/1a198fe4b066dcdb6c60b2d838ae2130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-nor4P0ytmFmip3qcX559A.png"/></div></div></figure><ul class=""><li id="54a9" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">跳过网络配置，因为我们不会在本实验的 VPC 中运行笔记本电脑。单击下一步</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/d1acbf6bfd9872a87355465c583df038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lj6wldYpwrz56ZSrOeSSIg.png"/></div></div></figure><ul class=""><li id="688a" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">您可以上传您的本地机器 ssh 密钥以在本地访问它。出于本实验的考虑，我将跳过这一步，单击“Next”并创建 endpoinot</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/9fe975ebe019cae3bb5c676d9121da10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yOhBk2cHjH7ZFgIXX1-Eg.png"/></div></div></figure><ul class=""><li id="8f2d" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">终端准备就绪需要几分钟时间，它将显示为“PROVISIONING”</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/652008008053c4871927be7d2c93ff56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*We6MTQqMn7InzSsf-UyDbQ.png"/></div></div></figure><ul class=""><li id="df0b" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">就绪状态</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/b0acd0540999bb8dce309452dc3ab83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vm1SRHf4fDyGBNspMv32Eg.png"/></div></div></figure><ul class=""><li id="490e" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">选择已创建的端点，并在操作下拉列表中选择<code class="fe ox oy oz jp b">Create SageMaker Notebook</code></li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi ob"><img src="../Images/8661d3834fc7e21df3f8d281e4ab5c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEc9eYyQfF1dBGN9Yap1ww.png"/></div></div></figure><ul class=""><li id="0682" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">为笔记本和各自的角色命名(创建新角色或选择具有所需 S3 权限的现有角色)。跳过默认选项的其余部分，然后单击“Create”。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/a559d0ea631fb2cb94aa7c34faf285f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYFTJZf8FUCVt-7VXj38fw.png"/></div></div></figure><ul class=""><li id="45dd" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">等待，直到笔记本电脑从启动状态变为就绪状态</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/15dd3c093d68828e48bc170ece061f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*op8GkDQ6-_cXrgjmJKBOgg.png"/></div></div></figure><p id="2163" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就绪状态</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi pa"><img src="../Images/5ab04a28992c18033eec90540fd42784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kmax0gYrm0rzj-H_svSstg.png"/></div></div></figure><ul class=""><li id="75bf" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">转到 AWS Glue 控制台，单击左侧菜单中的笔记本选项，然后选择笔记本并单击打开笔记本按钮。</li><li id="0f72" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">在下一个弹出屏幕上，单击确定按钮。它将在新的浏览器窗口或标签中打开 jupyter 笔记本。在笔记本窗口中，点击新下拉菜单下的 Sparkmagic (PySpark)选项。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/d633fc015861c329cd681d54559f10e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBcyc1Ny_gZWmpwMeUmeQQ.png"/></div></div></figure><ul class=""><li id="8c60" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">将笔记本重命名为<code class="fe ox oy oz jp b">glue-pyspark-lab</code></li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/e9b2d51cb42bf9c40ae705245666a308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeKPoNS3r7egb77py7cPUQ.png"/></div></div></figure><ul class=""><li id="88b9" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">它将在新的浏览器窗口或选项卡中打开笔记本文件。将下面的 PySpark 代码片段复制并粘贴到笔记本单元格中，然后单击 Run。它将创建粘合上下文。Glue 上下文连接 Spark 会话，并提供对数据湖目录表的访问。</li></ul><pre class="jk jl jm jn gt jo jp jq jr aw js bi"><span id="032a" class="jt ju in jp b gy jv jw l jx jy">import sys<br/>from awsglue.transforms import *<br/>from awsglue.utils import getResolvedOptions<br/>from pyspark.context import SparkContext<br/>from awsglue.context import GlueContext<br/>from awsglue.job import Job<br/><br/>glueContext = GlueContext(SparkContext.getOrCreate())</span></pre><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/cc77fa3d2e8f17dc61065dc40d3237d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kodqV44YHxGk2KvNZcA5xw.png"/></div></div></figure><ul class=""><li id="bf13" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">启动 SparkSession 并获取 Glue 上下文需要一些时间。等待确认消息，说明 SparkSession 作为“spark”可用。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/b75350b4569aa1614f5fdbec8e1cc5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gm_3a3YVAI8jM2DcfjRpVw.png"/></div></div></figure><ul class=""><li id="dbe8" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">在 notebook 单元格中复制以下 PySpark 代码片段，然后单击 Run。等待执行完成。它将为数据库<code class="fe ox oy oz jp b">glue-etl</code>(图书评论数据集)中的数据目录表<code class="fe ox oy oz jp b">analysis</code>加载 dynamicframe</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/d7c50f457479c0ad864e6a3a018145cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_3XG926FaNxRgbH6ZeFUg.png"/></div></div></figure><ul class=""><li id="a1ab" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">您可以通过运行以下命令来检查模式</li></ul><p id="ef89" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ox oy oz jp b">booksDF.printSchema()</code></p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/a80024d43e84b367b27d078045327132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9iycNxD-qnCv7BO16VxIlw.png"/></div></div></figure><p id="01ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">booksDF.count()</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/af82a3cb8f1e2f00728ba5df7eb653db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ap4aFiSeQTSgKtU7qOl-yA.png"/></div></div></figure><h1 id="0e8a" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">形容</h1><ul class=""><li id="8a6e" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">您可以使用 describe 方法来查看特定列的统计信息。方法通常用于数字列或数字特征。运行以下 PySpark 代码片段来检查 product_title 列的统计信息。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/c923fe27d34b1121da8db86e0dd57854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMXFh65DUCojXwFZqByqsA.png"/></div></div></figure><p id="2fc7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您还可以将 groupby 方法用于特定列以及单独的聚合函数。运行以下 PySpark 代码片段，查看每个 star_rating 的计数。</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi pb"><img src="../Images/186c330c5a30b30ff091bb0ed680b909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWSQ3fsdjI79AQoRd_PbMg.png"/></div></div></figure><ul class=""><li id="7370" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">逐一运行以下 PySpark 代码片段，查看每个 product_title 的 customer_id 的最小值、最大值、平均值和总和。</li></ul><h1 id="de26" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">福建话</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/de463ba098518b6d70455c96b9e7cbef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZji7x5_ULXDcaj8VszbvA.png"/></div></div></figure><h1 id="9f0c" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最大</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/076e96d61d1974ba653385961bd2cb13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BULF1ucFW1HnUsx8O__dtA.png"/></div></div></figure><h1 id="4f07" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">平均</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/1402de1f331fe0b6f1af35b582777a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7UV4IlewfK8G6qevwWaEzg.png"/></div></div></figure><h1 id="9f11" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">总和</h1><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/9c9ca0736c51d22ae49a8c2fb64125a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_eIaPSiaqBVG7L_w43Nxkg.png"/></div></div></figure><h1 id="bbab" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Orderby</h1><p id="fdb3" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">可以使用 orderBy 方法按升序或降序对特定列的数据帧进行排序。逐一运行下面的 PySpark 代码片段，按照 total_votes 先升序或降序对 Dataframe 进行排序。</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/10c8a92b6e81c3a68c991b6e976f750f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vp7ynKmFmeHcDMHVwu7imA.png"/></div></div></figure><h1 id="f404" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据转换和 ETL</h1><h1 id="752a" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">连接</h1><h1 id="5b1c" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">合并和拆分练习</h1><p id="c91a" class="pw-post-body-paragraph jz ka in kb b kc mq ke kf kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw ig bi translated">先决条件为要保存的输出数据创建一个新的 s3 输出存储桶，或者在同一个初始存储桶中创建一个<code class="fe ox oy oz jp b">outputs</code>文件夹。在本实验中，我将使用同一个 S3 存储桶和输出文件夹来保存 Glue Studio 的输出数据。</p><p id="5903" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ox oy oz jp b">Bucket-Name: amazon-dataset-reviews-thulasi</code>T3】</p><h1 id="3a78" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><ul class=""><li id="7f86" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">确保您已经完成了<code class="fe ox oy oz jp b">01-gluecrawler</code>实验，并且在数据目录中有您的图书数据</li><li id="151f" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">同样，为从<code class="fe ox oy oz jp b">Amazon Reviews Dataset</code>复制的服装数据集创建数据目录</li></ul><h1 id="59c0" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建开发端点</h1><ul class=""><li id="de53" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">在左侧窗格中选择“Dev Endpoints ”,然后单击“add endpoint”</li></ul><p id="5a4c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您可以使用与聚合函数相同的 dev 端点。</p><h1 id="b3fa" class="ky ju in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">合并和分割数据集</h1><ul class=""><li id="d22d" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">当创建 ETL 作业时，通常会使用多个数据集，并使用它们进行转换。这种转换可能类似于将两个数据集合并在一起，或者将一个数据集拆分成两个或更多个数据集。在本任务中，您将学习合并和拆分数据集。</li><li id="747c" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">运行下面的 PySpark 代码片段，它从<code class="fe ox oy oz jp b">analysis</code>表中的<code class="fe ox oy oz jp b">appareldb</code>和<code class="fe ox oy oz jp b">glue-etl</code>数据库加载 Dynamicframe 中的数据。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/a96664c136565e38c48ab07f730356b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L6HVRiPCAyvm4pa9XBY5gA.png"/></div></div></figure><ul class=""><li id="205e" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">逐一运行下面的 PySpark 代码片段，检查两个 Dynamicframes 的模式。您会发现这些框架将 customer_id 作为公共键或字段。您可以根据 customer_id 字段连接 booksDFDF 和 apparelDF Dynamicframes。</li><li id="1fb7" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">运行以下 PySpark 代码片段，根据 customer_id 字段连接 booksDFDF 和 apparelDF Dynamicframes。使用 printSchema 方法和 count 方法检查合并框架的架构以及新的记录计数。</li></ul><p id="67b9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注意:如果数据的大小很大，您可能会在笔记本中得到内存限制超过错误。确保根据数据集的大小使用正确的笔记本实例。</p><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/186735ae5f3058a7957aafa1d046a9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7O86nsvki_CyDz_Hc8Y43Q.png"/></div></div></figure><ul class=""><li id="4062" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">如果您可以看到两列 customer_id 和。customer_id 应在键上加入。你可以使用 drop_fields 方法来删除。客户标识字段。</li><li id="f62e" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">您可以基于列垂直拆分 Dynamicframe。使用 SplitFields 方法将 Dynamicframe 拆分为 dynamic frame 的集合。运行下面的 PySpark 代码片段，将 booksDFDF 框架分成两个框架 productsDF 和 restDF。productsDF 有三列 customer_id、product_id 和 product_title。restDF 将拥有剩余的列。您可以使用 keys 方法来检查 Dynamicframe 集合 colwiseCollection 中 Dynamicframe 的创建。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi pc"><img src="../Images/0fa75c019117d2e53189dd92eee9ff27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*au9xcrupkAlGcpvBuwjwaw.png"/></div></div></figure><ul class=""><li id="c471" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">逐一运行下面的 PySpark 代码片段，检查两个 Dynamicframes productsDF 和 restDF 的模式。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/22a380d14f459c387490c58e31a3f3d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBG44vAwKjiZbymYuxNRkw.png"/></div></div></figure><ul class=""><li id="2a3b" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">与按列拆分类似，您可以基于行水平拆分 Dynamicframe。使用 SplitRows 方法，该方法根据为行指定的条件将 Dynamicframe 拆分为 dynamic frame 的集合。运行下面的 PySpark 代码片段，将 booksDF 框架分成两个框架，上面的评级为 3，下面的评级为 3。两个框架具有相同的列，但一个框架的评级值高于 3，另一个框架的评级值低于 3。您可以使用 keys 方法来检查 Dynamicframe 集合中 Dynamicframe 的创建</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/2495da5d79e932e260520101b98e2e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7b4-oXS1Ev0hDWuKtzRTg.png"/></div></div></figure><ul class=""><li id="98ee" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">逐一运行下面的 PySpark 代码片段，检查上面的两个 dynamic frame star_rating 和下面的 star _ rating 3 中 star _ rating 列的前 20 个值。</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/996d6aaca1e1f9074a1bbe1051659972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XC5qGBMvcXR6nXzl1DLDdw.png"/></div></div></figure><ul class=""><li id="b0f4" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">数数</li></ul><figure class="jk jl jm jn gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nc"><img src="../Images/9f693059726057fb815ceab6c257fef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSH8zFRYeO35EGKP5mPOnA.png"/></div></div></figure><ul class=""><li id="6062" class="oc od in kb b kc kd kg kh kk oe ko of ks og kw oh oi oj ok bi translated">到目前为止，您已经在研讨会中学习了如何在数据框架内和跨数据框架操作数据</li></ul></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="b58e" class="ky ju in bd kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu bi translated">在下一篇博客中，我们将讨论</h1><ul class=""><li id="7138" class="oc od in kb b kc mq kg mr kk oq ko or ks os kw oh oi oj ok bi translated">使用 Athena 进行分析，使用“QuickSight”进行可视化</li><li id="b919" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">Sagemaker</li><li id="8ea9" class="oc od in kb b kc ol kg om kk on ko oo ks op kw oh oi oj ok bi translated">数据布鲁</li></ul><p id="fd1e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢您的阅读。这是我的第一个博客，我知道我会犯错误，并总是欢迎反馈和纠正。</p></div></div>    
</body>
</html>