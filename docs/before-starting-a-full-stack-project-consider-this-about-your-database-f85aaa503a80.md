# 在开始一个全栈项目之前，考虑一下您的数据库

> 原文：<https://blog.devgenius.io/before-starting-a-full-stack-project-consider-this-about-your-database-f85aaa503a80?source=collection_archive---------16----------------------->

![](img/d9544f3bdc5ce34c079bdbc9906678b9.png)

照片由 [Iiris L](https://unsplash.com/@iiris_lepmets?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

你听说过数据库。一个保存所有骆驼(或普通人数据)的中心。也许你选择了 sqlite、PostgreSQL 或 Microsoft SQL。更好的是包含一个 [ORM](http://sqlalchemy.org) 或 [sql 元编译器](https://github.com/Masterminds/squirrel)，这样如果您的项目需求发生变化，您可以轻松地切换到另一个数据库。

等等，换到另一个数据库？你为什么要这么做？

很多原因。对于项目来说，在 NoSQL 数据库上开始时很强大，认为他们没有定义模式就飞得很高，然后当他们发现没有他们预期的那么高效时，让开发人员拔头发是很常见的。

或者，也许你正处于需要切换到数据库的痛苦之中，并且你现在喘不过气来。

这篇文章是写给那些还没到那一步的人的，但是如果你喘不过气来，喘口气，然后回来读这篇文章。可能还是有帮助的。

那么，您需要在与数据库相关的全栈应用中加入哪一项内容呢？

迁移！

# 为什么需要迁移？

如果您的项目就像许多处于起步阶段的项目一样，那么您可能没有过多考虑数据库。您可能看到了原始连接库，并认为在最初的应用程序连接上编写一堆数据库代码会很方便。

例如，考虑下面的代码片段:

到目前为止一切顺利。这正是客户想要的，所以我们点击了大的“部署”按钮，然后回家了。

但之后又说要更新产品。也许客户想要一个与他们的客户相关联的调色板(不仅仅是一种颜色)，并且他们想要说出他们最喜欢的颜色。

因此，现在我们需要对原始语句进行两处修改:

漂亮！就是好看！

![](img/31cb9d6533409d2bfd7e973f7417a26f.png)

或者也许不是？因为请记住，我们在第一次运行时执行这个启动代码，这意味着每次都会创建表。这对于`color`表来说很好，但是对于`user`表，特别是`favoriteColor`列来说呢？

永远不会被创造出来。

因此，我们有 3 个选择(好吧，包括第四个，这就是本文要讨论的):

1.  包含代码来`DROP`表，然后重新创建，这意味着所有数据都将丢失。这对于初始开发来说是没问题的，但是请记住，这些代码已经部署到生产中了。
2.  通知其他开发人员他们需要包含代码`UPDATE User ADD COLUMN favoriteColor CHAR(10)`。但是你也需要通知客户/用户。你创建了这个应用程序，这样用户*就不用*运行 SQL 代码了。
3.  在初始 sql 代码中包含#3 中的代码。这是最好的选择，因为它对已经存在的表有弹性，用户不必运行 sql 代码。

但是还有一个问题。如果程序重启了呢？我们遇到了一个逻辑问题:

*   表`users`已经存在。
*   列`favoriteColor`已经存在。
*   因此，如果我们再次尝试修改`users`来添加`favoriteColor`列，查询将会失败。
*   这意味着我们包含的任何其他 SQL 都不会执行。

就目前情况来看，这个问题只有一个解决方案:

不要把 SQL 查询包含在一个很长的字符串中，而是把它分解成一个数组。然后一次执行一条语句，忽略出现的任何错误。这是个坏主意！因为我们假设在列冲突中唯一的错误是。我们可能有一个语法错误，或者丢失了一个`CHAR`长度。

作为一般的经验法则，永远不要吞下错误。

相反，让我们跟踪变化。

# 迁移简介

坏消息是数据库中没有解决这个问题的方法。数据库的强大之处在于它能够快速索引和检索数据，而不是跟踪数据库的变化。

此外，我们可能会认为 SQLite 不够强大(它通常不够强大)，我们可能会决定改用 PostgreSQL。语法有很大的不同，我们不能用 PostgreSQL 连接器替换 SQLite 连接器并运行相同的 SQL 代码。

这个包通常使用一个 [ORM，或者对象关系映射器](https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping)来实现简单的模式创建。如果你还不熟悉 ORM，如果你在[duckduckgo.com](https://duckduckgo.com)搜索你的语言+“ORM ”,你应该能够找到一个与你的 SQL 数据库兼容的编程语言的 ORM(大多数试图覆盖 90%的用例，如 SQLite、MySQL、PostgreSQL、Microsoft SQL，甚至 Mongo！)

许多 ORM(对象关系模型)包包括迁移基础设施(或者您可能会发现一个针对特定架构的迁移包*)。以下是 Python 中的一个迁移示例:*

在这种情况下，您可以使用`alembic`命令升级/降级数据库。

但是 Alembic 如何知道应用什么迁移呢？

注意到文件顶部的`revision`和`down_revision`了吗？这些被 alembic 读取以构建修订的有向图。当前迁移的状态记录在数据库自己的表中，以便迁移器可以有效地应用`upgrade`或`downgrade`命令。

很整洁，是吧？

# 包括迁移策略！

因此，在您开始项目开发之旅之前，花一点时间为您的项目寻找一个好的迁移策略。

好消息是，你不是第一个使用你正在使用的技术堆栈的人。有人以前做过，也经历过那些烦人的事情。因此，人们创造了一种解决方案，让你我都更轻松！

我希望这篇文章对你有所帮助。请与你认为会从中发现价值的人分享。

**如果你的团队正在寻找团队领导或高级开发人员，请联系我。可以在**[https://damn good . tech](https://damngood.tech)预约免费咨询。