<html>
<head>
<title>Setting up Apache Airflow on Kubernetes with GitSync</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 GitSync 在 Kubernetes 上设置 Apache 气流</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-up-apache-airflow-on-kubernetes-with-gitsync-beaac2e397f3?source=collection_archive---------0-----------------------#2021-12-10">https://blog.devgenius.io/setting-up-apache-airflow-on-kubernetes-with-gitsync-beaac2e397f3?source=collection_archive---------0-----------------------#2021-12-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eae4f2e5f81b0acc92ffc1d26b0bd2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z5da1c33pDUyJwn6.png"/></div></div></figure><p id="ff35" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi kt translated">当我第一次开始学习数据工程时，我对运行数据管道所需的工具和技术感到不知所措。仅仅学习这些工具是不够的:对于每一个可用的工具，人们必须知道如何设置，这可能就像它看起来那样令人讨厌。</p><p id="14af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">获取正确的环境变量，以不会崩溃的方式匹配每个组件版本，不断更新您的。jars 文件和依赖项…嗯，这是一个可以马上吓到新人的任务。</p><p id="4c35" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是随着问题的出现，解决方案也随之出现。对我来说，解决方案是容器化的应用程序，更确切地说，是<strong class="jx io"> <em class="lc"> Kubernetes。</em> </strong>当我第一次开始学习 Kubernetes 的时候，我真的被设置一个应用程序并开始运行它是如此的简单所打动。</p><p id="476a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需<strong class="jx io">一行代码，</strong>你就可以安装和运行大量的应用程序，而不用担心环境变量和依赖性。一旦你开始使用它，你会想你过去怎么能做不同的事情。</p><p id="c3d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，今天，我想展示如何在 Kubernetes 集群中使用 GitSync 设置 airflow(数据管道的头号编排工具),这将使您能够将代码存储库(如 GitHub)中的 Dag 与 airflow 同步，这样您就不需要在每次更新或创建新 Dag 时构建一个 docker 映像。</p><h2 id="2b8f" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">安装舵和 Kubectl</h2><p id="bf2d" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">首先，您需要一个 Kubernetes 集群。对于这个演示，我使用的是<a class="ae mb" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank"> minikube </a>，但是您可以使用任何其他 Kubernetes 集群，比如<a class="ae mb" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> kind </a>、<a class="ae mb" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank"> micro k8s </a>，或者像 GKE 这样的基于云的集群。</p><p id="82c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第二，你需要两样东西:</p><ul class=""><li id="590c" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated">Kubectl CLI 与您的集群进行交互；</li><li id="3da0" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">掌舵管理您的图表，并以一种简单的方式安装气流。</li></ul><p id="9ddc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要在 Linux 上安装 kubectl，您可以在命令行中运行以下命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="492b" class="ld le in mv b gy mz na l nb nc">curl -LO "https://dl.k8s.io/release/<strong class="mv io">$(</strong>curl -L -s https://dl.k8s.io/release/stable.txt<strong class="mv io">)</strong>/bin/linux/amd64/kubectl"</span></pre><p id="d5e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在那之后:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="2f73" class="ld le in mv b gy mz na l nb nc">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span></pre><p id="21c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你运行的是 Windows 或者 Mac，可以在这里参考文档页<a class="ae mb" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="37f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要安装 helm，您可以简单键入:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="fdec" class="ld le in mv b gy mz na l nb nc">brew install helm</span></pre><p id="5620" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你没有安装 brew，我绝对推荐你安装！你可以在这里了解如何在 Linux <a class="ae mb" href="https://docs.brew.sh/Homebrew-on-Linux" rel="noopener ugc nofollow" target="_blank">上安装 brew。你也可以用不同的方式安装 helm，所以查看一下</a><a class="ae mb" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">文档</a>页面。</p><h2 id="a314" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">使用舵安装气流</h2><p id="5721" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">既然你安装了头盔，我们就安装气流！首先，您需要使用以下命令将 airflow helm 存储库添加到您的 helm repo 列表中:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="12a9" class="ld le in mv b gy mz na l nb nc">helm repo add apache-airflow https://airflow.apache.org</span></pre><p id="76a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了检查你添加的是否正确，使用命令<strong class="jx io"> <em class="lc"> helm repo list </em> </strong>来显示你拥有的所有库。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi gj"><img src="../Images/da68976055ebb0d24c6baa9a1eb4a636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1Ol6qdJqGjhPfzCdVXD6A.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">您可以检查您是否有如上所示的 apache-airflow 存储库。</figcaption></figure><p id="7ba8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在安装 airflow 之前，在您的 Kubernetes 集群中创建一个<strong class="jx io">名称空间</strong>来分隔您的部署是一个很好的实践。</p><blockquote class="nh ni nj"><p id="97a3" class="jv jw lc jx b jy jz ka kb kc kd ke kf nk kh ki kj nl kl km kn nm kp kq kr ks ig bi translated">在 Kubernetes 中，<em class="in">名称空间</em>提供了一种在单个集群中隔离资源组的机制。资源的名称在一个名称空间内需要是唯一的，但在不同的名称空间之间不需要。基于命名空间的作用域仅适用于命名空间对象<em class="in">(如部署、服务等)</em>，不适用于集群范围的对象<em class="in">(如存储类、节点、持久卷等)</em>。</p></blockquote><p id="a3ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用 kubectl CLI 创建一个名称空间:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="d7b8" class="ld le in mv b gy mz na l nb nc">kubectl create namespace airflow</span></pre><p id="868e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面的代码中，我创建了一个名为<em class="lc"> airflow </em>的名称空间，因此这个名称空间中的所有内容都与我的 airflow 部署相关。这样做有助于我们保持房子整洁。</p><p id="8172" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经创建了名称空间，是时候部署应用程序了。要在 Kubernetes 集群中部署气流，您只需键入:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="3156" class="ld le in mv b gy mz na l nb nc">helm install airflow apache-airflow/airflow --namespace airflow</span></pre><p id="9d33" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就这样，您安装了 airflow 及其运行所需的所有依赖项和变量！简单吧？</p><p id="2dae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只是解释一下语法，通常是这样的:helm install[name][chart][flags]。因此，在这种情况下，我们使用“apache-airflow”图表(我们刚刚安装的图表)和标签“airflow”安装了一个名为“airflow”的应用程序。我们还指定了名称空间“airflow ”,以将我们的部署组织到一个独立的组中。</p><p id="a3b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要检查气流是否正在运行，可以使用<strong class="jx io"><em class="lc">ku bectl get pods</em></strong><em class="lc"/>命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="ecda" class="ld le in mv b gy mz na l nb nc">kubectl get pods -n airflow</span></pre><p id="d691" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需记住指定您希望在哪个名称空间中获得 pod(使用-n)。如果安装正确，您会看到如下内容:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/007c47060fba2f1133e7b1de3aa365b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1ilpQkRvrX1UKSmP9GVQg.png"/></div></div></figure><p id="c5a1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在 Kubernetes 中使用 airflow 的神奇之处在于，每个 airflow 组件(如 Redis、scheduler、webserver 等)都有自己的 pod，并且已经配置好了。您不需要配置任何东西，它已经启动并运行了。</p><p id="aff3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您在 Kubernetes 上部署 airflow 时，您将 web 服务器作为一项服务部署在集群中。要检查您的服务，您可以使用<strong class="jx io"><em class="lc">kubectl get services</em></strong><em class="lc"/>命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="de12" class="ld le in mv b gy mz na l nb nc">kubectl get services -n airflow</span></pre><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/28bc038b9dfbb072ef0d44da5c41b258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egT9Aw5raYyDaRAMQ_L-jg.png"/></div></div></figure><p id="e11b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见，您有一个名为 airflow-webserver 的服务，它有一个 cluster-IP 并运行在端口 8080/TCP 上。要在浏览器中打开 airflow webserver，您可以使用<strong class="jx io"><em class="lc">ku bectl port-forward</em></strong>命令，并将 8080 端口绑定到本地主机中的一个端口:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="93c2" class="ld le in mv b gy mz na l nb nc">kubectl port-forward svc/airflow-webserver 8080:8080 -n airflow</span></pre><p id="7de7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您运行上面的命令时，您将转发连接<strong class="jx io">，该连接将锁定您的终端</strong>，如下所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/a45c549db74c37ddaea55d845d383b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIg1pepOi4Dc59hi2s0Nlg.png"/></div></div></figure><p id="4b5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你不想继续打开终端只是为了端口转发你的服务，有一个叫做<a class="ae mb" href="https://kube-forwarder.pixelpoint.io/" rel="noopener ugc nofollow" target="_blank"> Kube forwarder </a>的工具可以帮助你以一种简单的方式管理你的端口转发，所以别忘了看看！</p><p id="a35e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，您正在转发您的 airflow-web 服务器，您可以在您的<strong class="jx io"> <em class="lc"> localhost:8080/ </em> </strong>中访问它，并使用管理员/管理员用户和密码登录:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/7dbe8906f5d8fd3b09bca092660560a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4igu0CnJ77Oc3nDADmI9g.png"/></div></div></figure><p id="5ae8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！现在，您可以访问 Kubernetes 集群中运行的气流了！你开始掌握 Kubernetes 的力量了吗？</p><p id="5499" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你已经启动并运行了 airflow，接下来是最不可思议的部分:自动将代码库中的 DAG 同步到 airflow DAG 的文件夹<strong class="jx io">中</strong>。</p><h2 id="d875" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">创建私有 git 存储库并建立连接</h2><p id="9a7a" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">要同步您的 Dag，您需要创建一个代码存储库来存储您在本地工作的 Dag。你可以使用任何你想要的代码库，但是我将用 GitHub 展示它。</p><p id="6cbc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，创建一个私有存储库来存储您的 Dag。一旦完成，您将需要为您的存储库创建一个部署密钥，这样您就可以使用 SSH 来访问它。要创建 ssh 密钥，您需要使用 ssh-keygen，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="091c" class="ld le in mv b gy mz na l nb nc">ssh-keygen -t rsa -b 4096 -C "<em class="lc">your_email@example.com</em>"</span></pre><p id="bba6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦按下 enter 键，系统将提示您输入保存密钥的文件。写入的目录。ssh 文件夹(通常在/home/[用户名]/中)。ssh)并为您的密钥选择一个名称(在本例中为 airflowsshkey):</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/400ec04eb1484586720dcbe1dadb2ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxFkIGP73his_W2djt6pxg.png"/></div></div></figure><p id="9143" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你已经创建了你的 keygen，你需要进入你的 GitHub 库，点击设置并找到“部署密钥”:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/1535ca9f1ad0b7d888afae35dfbf57a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bI8tFz5Ec_-jqzA0lKd5gw.png"/></div></div></figure><p id="ce28" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要添加新的部署密钥，您将需要刚刚生成的 keygen 中的内容。它存储在<strong class="jx io"> <em class="lc"> /home/【用户名】/中。ssh/[您的密钥名称]。pub </em> </strong>。复制 pub 密钥并将其粘贴到 GitHub 中，以创建您的部署密钥:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/3ad3b8fd7dbaadb6ca0d61cc038ad55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mb8Ei-58isxhL6TelIMMYA.png"/></div></div></figure><p id="44f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确保勾选了“写权限”。创建部署密钥后，您需要在集群中创建一个 kubectl 秘密。为此，请运行以下命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="462b" class="ld le in mv b gy mz na l nb nc">kubectl create secret generic airflow-git-ssh-secret \<br/>  --from-file=gitSshKey=/path/to/.ssh/airflowsshkey \<br/>  --from-file=known_hosts=/path/to/.ssh/known_hosts \<br/>  --from-file=id_ed25519.pub=/path/to/.ssh/airflowsshkey.pub \<br/>  -n airflow</span></pre><p id="90c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行 create secret 命令后，您可以通过键入以下命令来检查您的机密:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/7c53d0ec06440f2646622c5273235fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nINikro7JHIBn84Q7WPJaA.png"/></div></div></figure><h2 id="4bf2" class="ld le in bd lf lg lh dn li lj lk dp ll kg lm ln lo kk lp lq lr ko ls lt lu lv bi translated">编辑气流舵 YAML 文件以配置 GitSync 功能</h2><p id="e877" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">现在，您已经使用 kubectl CLI 创建了一个带有 deploy 键和 Kubernetes 秘密的 git 存储库，是时候编辑用于配置气流部署的 YAML 文件了。</p><p id="5f6d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到您选择的文件夹，运行以下命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="249d" class="ld le in mv b gy mz na l nb nc">helm show values apache-airflow/airflow &gt; values.yaml</span></pre><p id="5172" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您执行该命令时，您将创建一个名为<strong class="jx io"> values </strong>的 YAML 文件，其中包含气流部署的所有信息。如果你愿意，你可以在这里定制很多东西。欲了解更多信息，请查阅气流的<a class="ae mb" href="https://airflow.apache.org/docs/helm-chart/stable/index.html" rel="noopener ugc nofollow" target="_blank">舵图表文件。</a></p><p id="390d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要做的是向下滚动文件的底部(使用您选择的任何代码编辑器),直到这一行:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7843b2bd5cec8af86efa90c2fc32b987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*Z58Bwpr70-ShBPaHq9vamw.png"/></div></figure><p id="4abd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要设置 GitSync，您需要将'<strong class="jx io">使能</strong>切换到<strong class="jx io">真</strong>，并更改回购和分支类型，如下所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/b4fcc42b64773771cc2ec41dbfc0aebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*vReY74zByTgkgFBp4EpwYw.png"/></div></figure><p id="7623" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如上图所示，您需要取消对<strong class="jx io"> credentialsSecret </strong>和<strong class="jx io"> sshKeySecret </strong>的注释。对于 sshKeySecret，只需输入您刚刚用 kubectl CLI 创建的秘密名称。</p><p id="60fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要应用更改，只需运行以下命令:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="e29b" class="ld le in mv b gy mz na l nb nc">helm upgrade --install airflow apache-airflow/airflow -n airflow -f values.yaml</span></pre><p id="328f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该命令将使用 values.yaml 文件中的配置设置来部署气流。</p><p id="7a7a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！每当您在本地更改 DAG 并提交到 git 存储库时，airflow 会自动应用 airflow DAGs 文件夹中的更改。漂亮的 CICD 就在这里！</p><p id="1d76" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Kubernetes 是一个非常棒的大数据工具，我真的希望你今天能意识到这一点。我将在这里张贴更多的文章，在 Kubernetes 中运行 bath 和流数据管道，所以我希望你喜欢它，并继续关注下一篇文章！</p></div></div>    
</body>
</html>