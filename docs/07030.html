<html>
<head>
<title>Setting up a simple CI/CD with Django, Gitea, Jenkins, and of course, Docker!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与 Django、Gitea、Jenkins，当然还有 Docker 一起建立一个简单的 CI/CD！</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setting-up-a-simple-ci-cd-with-django-gitea-jenkins-and-of-course-docker-ab883972efb5?source=collection_archive---------1-----------------------#2022-02-20">https://blog.devgenius.io/setting-up-a-simple-ci-cd-with-django-gitea-jenkins-and-of-course-docker-ab883972efb5?source=collection_archive---------1-----------------------#2022-02-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/b087c54e58c9eae431482e5144ef5528.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*zfXRuOy74WRuWs_nIZh0dA.png"/></div></figure><p id="9f0a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这是我努力定义一个最小项目和创建一个框架的第 2 部分，这个框架使我能够使用和学习一些 DevOps 工具。下面是第一部分的链接:<a class="ae kp" href="https://medium.com/@parsa.asgari3264/setting-up-a-simple-ci-cd-with-django-and-gitlab-80ac3492638c" rel="noopener">https://medium . com/@ parsa . asgari 3264/setting-a-simple-ci-CD-with-django-and-git lab-80ac 3492638 c</a></p><h1 id="ffa8" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">项目概述:</h1><p id="7bbd" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">这个小项目的范围是这样的:拥有一个 dockerized 的小 Django API，并让 Jenkins 通过将它提交给基于 Gitea 的 g it 服务器来构建它。仅此而已。</p><p id="ec2d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然而，为了帮助本教程独立存在，我将包括基础知识(像 Docker 的安装材料和任何被认为是这个范围的基础)</p><p id="71da" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请注意，我使用的环境是 Ubuntu 20.04。</p><h1 id="ef68" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装 Docker:</h1><p id="eba3" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">据<a class="ae kp" href="https://docs.docker.com/engine/install/ubuntu/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/install/ubuntu/</a>:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="6e59" class="mc kr in ly b gy md me l mf mg">#### prerequisites<br/>$ sudo apt-get update<br/>$ sudo apt-get install ca-certificates curl gnupg lsb-release#### setup docker apt repository<br/>curl -fsSL <a class="ae kp" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpgecho \<br/>  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] <a class="ae kp" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> \<br/>  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null#### install docker packages<br/>sudo apt-get update<br/>sudo apt-get install docker-ce docker-ce-cli containerd.io#### test your installation<br/>sudo docker run hello-world</span></pre><h1 id="4b15" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装 Gitea:</h1><p id="f14a" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">由于我们使用的是 Ubuntu 20.04，安装 Gitea 的一个直接方法是使用 Ubuntu 的内置软件交付服务 Snap。它安装应用程序，更新应用程序，为应用程序创建服务，并实现简单的管理。你可以使用 Snap 来安装 Gitea。注意，我们必须单独安装一个数据库(MySQL 或 PostgreSQL)。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="c333" class="mc kr in ly b gy md me l mf mg">snap install gitea</span></pre><p id="ad2b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请注意，您可以使用类似下面的命令来管理服务:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="c43a" class="mc kr in ly b gy md me l mf mg">sudo snap restart gitea.web</span></pre><p id="1b29" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">通过 Snap 安装 Gitea 时，Gitea 的配置文件存储在/var/Snap/Gitea/common/conf/app . ini。</p><p id="dc78" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后但同样重要的是，请注意您可以通过<a class="ae kp" href="http://localhost_or_your_local_ip:3000" rel="noopener ugc nofollow" target="_blank">http://localhost _ or _ your _ local _ IP:3000</a>访问 Gitea。<br/>(例如“http://192.168.1.140:3000”)</p><p id="d14d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后一步。为了使 Gitea 能够向 Jenkins 发送有关可能的代码更改的事件，我们必须将我们的 Jenkins IP 列入白名单。为此，我们必须打开下面的文件:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="f7cd" class="mc kr in ly b gy md me l mf mg">sudo nano /var/snap/gitea/common/conf/app.ini</span></pre><p id="4133" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">并将这些行添加到文件的末尾:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="b302" class="mc kr in ly b gy md me l mf mg">[webhook]<br/> ALLOWED_HOST_LIST = THE_IP_OF_YOUR_JENKINS_INSTANCE<br/> DISABLE_WEBHOOKS = false<br/></span></pre><p id="ee6a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">确保重启 Gitea:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="078a" class="mc kr in ly b gy md me l mf mg">sudo snap restart gitea.web</span></pre><h1 id="1a8d" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装 Postgresql 12:</h1><p id="0fdb" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">你可以使用 Ubuntu 20.04 的默认库来安装 PostgreSQL 12。对于任何其他版本，您可以访问 PostgreSQL 的网站<a class="ae kp" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank">并使用提供的文档进行安装。</a></p><p id="56c3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在我们还是坚持 Ubuntu 20.04 的 PostgreSQL 12。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="5c40" class="mc kr in ly b gy md me l mf mg">sudo apt install postgres-12</span></pre><p id="020a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，根据 Gitea 的<a class="ae kp" href="https://docs.gitea.io/en-us/database-prep/" rel="noopener ugc nofollow" target="_blank">数据库准备页面</a>，登录您的 PostgreSQL 安装并创建一个用户:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="6031" class="mc kr in ly b gy md me l mf mg">sudo <!-- -->su -c "psql" - postgres</span></pre><p id="9119" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">输入上面的命令后，您应该会看到以下提示:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="60fd" class="mc kr in ly b gy md me l mf mg">psql (10.19 (Ubuntu 10.19-0ubuntu0.18.04.1))</span><span id="de52" class="mc kr in ly b gy mh me l mf mg">Type "help" for help.</span><span id="f2f7" class="mc kr in ly b gy mh me l mf mg">postgres=#</span></pre><p id="4f23" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后，输入这两个命令。</p><p id="ee9f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">第一个创建一个名为“gitea”的数据库用户，密码为“gitea”。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="1ace" class="mc kr in ly b gy md me l mf mg">CREATE ROLE gitea WITH LOGIN PASSWORD 'gitea';</span></pre><p id="9782" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">第二个命令创建一个名为“giteadb”的数据库，以及一些关于编码、整理等的细节。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="8089" class="mc kr in ly b gy md me l mf mg">CREATE DATABASE giteadb WITH OWNER gitea TEMPLATE template0 ENCODING UTF8 LC_COLLATE 'en_US.UTF-8' LC_CTYPE 'en_US.UTF-8';</span></pre><p id="cee3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可以通过按 control-D 键或键入“\q”来退出提示。</p><p id="3a85" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，让我们导航到 PostgreSQL 12 的配置文件夹，帮助 Gitea 正确访问数据库。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="cfea" class="mc kr in ly b gy md me l mf mg">cd <strong class="ly io">/etc/postgresql/12/main</strong></span></pre><p id="13e1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们打开 postgres.conf:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="c7f5" class="mc kr in ly b gy md me l mf mg">sudo nano postgresql.conf</span></pre><p id="7197" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">并确保参数被指定为下面定义的值:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="129b" class="mc kr in ly b gy md me l mf mg">listen_addresses = 'localhost, 203.0.113.3'<br/>password_encryption = scram-sha-256</span></pre><p id="218e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后一点，访问和认证。让我们通过以下方式解决这个问题:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="673b" class="mc kr in ly b gy md me l mf mg">sudo nano postgresql.conf</span></pre><p id="4d1c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">那么让我们加上这一行:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0489" class="mc kr in ly b gy md me l mf mg">local    giteadb    gitea    scram-sha-256</span></pre><p id="00df" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">很好。Gitea 现在都准备好了。</p><h1 id="881f" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">从 Github 获取 Django 代码:</h1><p id="4861" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">我已经准备了一个 Django API 示例，它是基于 Dennis Ivy 出色而简洁的教程:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="fec7" class="mc kr in ly b gy md me l mf mg">cd /home/$USER<br/>git clone <a class="ae kp" href="https://github.com/VertigoX64/django_jenkins_gitea_cicd" rel="noopener ugc nofollow" target="_blank">https://github.com/VertigoX64/django_jenkins_gitea_cicd</a></span></pre><h1 id="c3e4" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">将 Django 代码输入 Gitea:</h1><p id="113a" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">1-登录到您为 Gitea 的基本 URL 输入的地址。(例如:“http://192.168.1.140:3000”)</p><p id="6d43" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">2-创建新的存储库。</p><p id="9d91" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">3-进入刚刚为 Django 代码克隆了 git 存储库的文件夹，运行以下命令:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="2de8" class="mc kr in ly b gy md me l mf mg">git remote set-url origin <a class="ae kp" href="http://192.168.100.140/YOUR_USERNAME/YOUR_REPOSITORY_NAME.git" rel="noopener ugc nofollow" target="_blank">http://192.168.100.140:3000/YOUR_USERNAME/YOUR_REPOSITORY_NAME.git</a></span><span id="8aec" class="mc kr in ly b gy mh me l mf mg">git push origin</span></pre><p id="6234" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了确保代码已经被成功地推送到 Gitea，请查看存储库页面。你应该看看里面的文件。</p><h1 id="ff4c" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装 Jenkins:</h1><p id="39f1" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">据 https://www.jenkins.io/doc/book/installing/linux/的<a class="ae kp" href="https://www.jenkins.io/doc/book/installing/linux/" rel="noopener ugc nofollow" target="_blank">:</a></p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0555" class="mc kr in ly b gy md me l mf mg">curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \<br/>  /usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null<br/>echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \<br/>  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \<br/>  /etc/apt/sources.list.d/jenkins.list &gt; /dev/null<br/>sudo apt-get update<br/>sudo apt-get install jenkins fontconfig openjdk-11-jre</span></pre><p id="0914" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">请注意，Jenkins 需要 Java 运行时环境(JRE)才能运行。您可以使用 Oracle 的 JRE 或 OpenJDK 的。在这里，我已经根据上面的 bash 脚本安装了 OpenJDK 11。</p><p id="2b09" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在你可以通过访问这个网址来访问 Jenkins:<a class="ae kp" href="http://192.168.1.52:8080" rel="noopener ugc nofollow" target="_blank">http://</a><a class="ae kp" href="http://localhost_or_your_local_ip:3000" rel="noopener ugc nofollow" target="_blank">localhost _ or _ your _ local _ IP</a><a class="ae kp" href="http://192.168.1.52:8080" rel="noopener ugc nofollow" target="_blank">:8080</a></p><p id="f3ad" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它会提示您找到它的秘密密码来解锁:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="4e37" class="mc kr in ly b gy md me l mf mg">sudo cat /var/lib/jenkins/secrets/initialAdminPassword</span></pre><p id="2de2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后，您可以选择<strong class="jt io">安装建议的插件。</strong>根据您的互联网连接，安装插件可能需要一些时间。</p><h1 id="3444" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">在 Jenkins 中配置基于 Gitea 的管道:</h1><p id="614c" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">将 Django 代码推送到本地 Gitea 之后，这一步的概述如下:</p><ul class=""><li id="1e46" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">在 Jenkins 中安装 Gitea 的插件</li><li id="b06b" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">在 Jenkins 中注册 Gitea，并确保 Gitea 的 webhook 功能正常工作，并且 Jenkins 正确管理这些功能。</li><li id="58c7" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">在詹金斯内部建立一个组织渠道。</li><li id="c344" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">通过对我们的存储库进行更改来测试管道。</li></ul><h2 id="fb3c" class="mc kr in bd ks mw mx dn kw my mz dp la kc na nb le kg nc nd li kk ne nf lm ng bi translated">在 Jenkins 中安装 Gitea 的插件:</h2><p id="3f9e" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">导航到<strong class="jt io">管理 Jenkins = &gt; </strong> <strong class="jt io">管理插件</strong>。</p><p id="d467" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">选择了可用的选项卡<strong class="jt io">后，在过滤区输入<em class="nh"> Gitea 插件</em>。点击<em class="nh">立即下载，重启后安装。</em></strong></p><p id="2e46" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">重启 Gitea 的服务:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="f9ce" class="mc kr in ly b gy md me l mf mg">sudo snap restart gitea.web</span></pre><h2 id="9fb0" class="mc kr in bd ks mw mx dn kw my mz dp la kc na nb le kg nc nd li kk ne nf lm ng bi translated">在詹金斯注册 Gitea:</h2><p id="9c85" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">导航至<strong class="jt io">管理詹金斯= &gt;配置詹金斯</strong>。</p><p id="b266" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">找到<strong class="jt io">吉泰服务器</strong>部分，然后添加一个新的吉泰服务器:</p><ul class=""><li id="bfa3" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">命名服务器(任何名称都可以)</li><li id="bbd5" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">您的本地 Gitea 服务器的网址</li><li id="a62b" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">检查管理挂钩的勾号。它会要求您提供 Gitea 凭据。您可以通过点击<strong class="jt io">添加</strong>按钮并选择<strong class="jt io">詹金斯</strong>来添加一个(这意味着它会自动将其定位到詹金斯— <a class="ae kp" href="https://www.jenkins.io/doc/book/using/using-credentials/" rel="noopener ugc nofollow" target="_blank">更多关于詹金斯证书定位</a>)。</li><li id="1159" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">如果您输入的凭据正确，Jenkins 应该能够显示您的 Gitea 版本。</li><li id="f464" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">在网页的最后，点击<strong class="jt io">应用</strong>和<strong class="jt io">保存</strong>完成这里的修改。</li></ul><h2 id="a688" class="mc kr in bd ks mw mx dn kw my mz dp la kc na nb le kg nc nd li kk ne nf lm ng bi translated">在詹金斯内部创建组织管道。</h2><p id="b4ac" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">导航至<strong class="jt io">管理詹金斯= &gt;新项目</strong>。然后:</p><ul class=""><li id="cefc" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">命名项目。</li><li id="627f" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">选择<strong class="jt io">组织文件夹。</strong></li><li id="068d" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">点击网页末尾的<strong class="jt io">确定</strong>。</li></ul><p id="a530" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">选择管道会将我们带到管道配置页面。要设置一个简单的<strong class="jt io">组织文件夹管道</strong>，您只需要将项目资源库的来源设置为<strong class="jt io"> Gitea 组织</strong>。然后:</p><ul class=""><li id="b1a5" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">确保您的 Gitea 服务器选择正确。检查它的 IP 和端口以匹配它的 URL。</li><li id="7450" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">选择您在上一步中创建的凭据(在 Jenkins 注册 Gitea)。</li><li id="ffdd" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">将<strong class="jt io">所有者</strong>设置为您的吉泰<em class="nh">用户名/吉泰组织名称</em>。<em class="nh"> </em>(警告:如果没有正确输入所有者姓名，管道将无法工作)</li><li id="df90" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">继续<strong class="jt io">应用</strong>和<strong class="jt io">保存。</strong></li></ul><p id="4077" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">好吧。所以，如果你进入你创建的组织文件夹(当然是通过点击<strong class="jt io">仪表盘</strong>中的名称！)并点击<strong class="jt io">扫描吉泰组织现在</strong> <em class="nh"> </em>按钮，那么魔法就发生了。您可以导航至<strong class="jt io">扫描吉泰组织日志</strong>查看其状态。如果是绿色的，你们都准备好了。</p><p id="c7ba" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可以进入管道，进入<strong class="jt io">状态</strong>=&gt;"<strong class="jt io">您的 _repository" </strong>。可以在管道页面中执行相同的扫描并查看日志操作。重点是确保 Jenkins 已经在您提供的 Gitea 存储库中找到了它的 Jenkinsfile。</p><p id="02dd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">此外，您可以进入管道，进入<strong class="jt io">状态</strong> == &gt; " <strong class="jt io">您的 _repository_branch" </strong>以检查 Jenkins 的上次构建状态。由于所提供的 Jenkins 文件包含两个阶段(构建和部署)，因此您应该看到两个阶段的成功状态。</p><p id="f315" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">以下是 Jenkinsfile 供参考:</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="c82c" class="mc kr in bd ks mw mx dn kw my mz dp la kc na nb le kg nc nd li kk ne nf lm ng bi translated">通过对存储库进行更改来测试管道:</h2><p id="7c66" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">继续对存储库中的一个文件进行更改。如果一切都设置正确，Gitea 应该通知 Jenkins 这个新的提交，因此，Jenkins 将尝试进行新的构建和部署。</p><p id="eccf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这个阶段唯一可能发生的情况是 Gitea(由于 webhook 不工作)不会通知 Jenkins 它的事件。如果这是问题所在:</p><ul class=""><li id="14c9" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">转到您的 Gitea 实例并访问您的存储库</li><li id="a80d" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">进入<strong class="jt io">设置</strong> == &gt; <strong class="jt io">网页挂钩</strong></li><li id="54a8" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">点击注册的 webhook 或者小笔打开 webhook 编辑页面(如果有注册的 webhook。如果没有，请继续阅读。)</li><li id="43ea" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">转到页面末尾，检查<strong class="jt io">最近交付的</strong>状态。如果它们是红色的，那么通过点击递送并查看响应及其错误来检查原因。</li></ul><p id="3ce9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">如果没有注册 webhooks，使用这些参数注册一个:</strong></p><ul class=""><li id="14d2" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">目标 URL:<a class="ae kp" href="http://192.168.100.146:8085/gitea-webhook/post" rel="noopener ugc nofollow" target="_blank">http://Jenkins-IP:Jenkins-Port/gitea-web hook/post</a></li><li id="29bb" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">HTTP 方法:POST</li><li id="5fd8" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">帖子内容类型:应用程序/JSON</li><li id="06fc" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">对于“开启触发器”,请参考此图像的设置参数:</li></ul><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="nl nm di nn bf no"><div class="gh gi nk"><img src="../Images/8991124e58845f37e8190ba6aa248b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ii1pnL8yKSMYCT8-g2IYg.png"/></div></div></figure><ul class=""><li id="a482" class="mi mj in jt b ju jv jy jz kc mk kg ml kk mm ko mn mo mp mq bi translated">分支过滤器:*</li><li id="90a0" class="mi mj in jt b ju mr jy ms kc mt kg mu kk mv ko mn mo mp mq bi translated">确保您已经正确配置了 ALLOWED_HOST_LIST(如上所述)。</li></ul><h1 id="d6b2" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结束了</h1><p id="0b1e" class="pw-post-body-paragraph jr js in jt b ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ls km kn ko ig bi translated">我希望这个指南能帮助揭开 Devops 工具的神秘面纱。关于你遇到的问题，请随意发表意见。</p></div></div>    
</body>
</html>