<html>
<head>
<title>How To Enable Powerful Full Text Search for Your Apps — MySQL vs Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为您的应用启用强大的全文搜索——MySQL与Elasticsearch</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-enable-powerful-full-text-search-for-your-apps-mysql-vs-elasticsearch-f35ac45f816e?source=collection_archive---------2-----------------------#2021-06-14">https://blog.devgenius.io/how-to-enable-powerful-full-text-search-for-your-apps-mysql-vs-elasticsearch-f35ac45f816e?source=collection_archive---------2-----------------------#2021-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7d11" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">MySQL和Elasticsearch全文搜索和比较的分步指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8829d0847ccb33ad9360ce092849f352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XKLq_TFdaY-EI9ktQMUfmg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">布鲁克·拉克在<a class="ae kv" href="https://unsplash.com/s/photos/color-shopping?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="011c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你是否曾经在超市或百货公司走来走去，却找不到你要找的东西？在网上购物时，你可能会有同样的经历。尽管大多数网站都是按类别排列产品，但如果你对目标产品的类别毫无头绪，浏览类别仍然是件苦差事。搜索栏节省了我们很多时间，因为我们可以简单地输入关键字或文本短语，然后它会显示所有相关的项目。毫无疑问，全文搜索是所有电子商务网站的基本功能。</p><p id="c9f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">全文搜索是一个受MySQL和Elasticsearch等许多数据库支持的流行功能。但是，MySQL和Elasticsearch在全文搜索能力方面有什么区别呢？如果您在寻找实现全文搜索的解决方案，不了解这些差异就无法做出正确的决定。在本文中，我将向您展示MySQL和Elasticsearch上的全文搜索的用法，并强调它们的区别。</p><h2 id="c352" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">什么是全文搜索？</h2><p id="c80e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果搜索引擎通过精确匹配来查找数据记录，你将很难得到任何搜索结果。例如，下面的SQL语句不太可能返回任何记录，因为可能不存在名称或描述与文本短语“鱼番茄罐头”完全相同的产品。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="34c4" class="ls lt iq mr b gy mv mw l mx my">SELECT *<br/>FROM products<br/>WHERE name = ‘canned food with fish and tomato’<br/>OR description = ‘canned food with fish and tomato’</span></pre><p id="7d12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们使用通配符' LIKE % '可能会有所帮助，但您将只收到在数据字段中包含精确文本短语的记录。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="4875" class="ls lt iq mr b gy mv mw l mx my">SELECT *<br/>FROM products<br/>WHERE name LIKE ‘%canned food with fish and tomato%’<br/>OR description LIKE ‘%canned food with fish and tomato%’</span></pre><p id="8091" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">全文搜索的思想是将文本短语分解成标记。上例中的文本短语被分成这些标记:“罐头”、“食品”、“with”、“鱼”、“and”和“番茄”。然后，搜索引擎查找匹配任何一个标记的所有记录。记录匹配的标记越多，它与文本短语的相关性就越大。因此，搜索引擎通过在搜索结果中分配分数来指示相关性。如果查询字符串中的标记包含常见单词(如“food ”),并且许多产品可能匹配一个或多个标记，您可能会收到包含大量记录的搜索结果。但是，您总是可以按分数过滤结果，以便获得最相关的记录。</p><p id="6c02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">全文搜索是一个受MySQL和Elasticsearch等许多数据库支持的流行功能。启用此功能的设置实际上非常简单明了。例如，您可以在MySQL上打开所选数据字段的全文搜索功能，而无需对表模式进行任何更改。说到Elasticsearch就更简单了，因为它默认支持全文搜索，不需要额外的配置。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="a930" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">全文搜索一览— MySQL与Elasticsearch</h1><p id="0339" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">简而言之，MySQL和Elasticsearch都有相似的全文搜索思想。它是通过将文本内容分解成记号来创建索引。然后，查询会将查询文本分解成标记，并与索引匹配。基于匹配结果，搜索引擎计算分数并分配给代表相关性的搜索结果。</p><p id="19c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关键区别在于固定解决方案和可配置解决方案之间的解决方案方法。MySQL在3种不同的模式下提供固定的全文搜索功能——自然语言、布尔和扩展查询。它几乎没有调整和微调的空间。</p><p id="261c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，Elasticsearch的设计是高度可配置的。令牌分解和查询执行的过程是基于分析器、令牌化器和过滤器的集合来执行的。这些组件可以定制并组合在一起，以实现更高级的功能。</p><p id="a782" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将一步一步地介绍MySQL和Elasticsearch上全文搜索的用法。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="2940" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">样本数据集</h1><p id="e108" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">全文搜索功能的演示基于一个样本数据集，它是一组图书馆图书记录。该模式相当简单，包含以下几列:id、title和publicationPlace。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/9da27e039fad83f3a3feffa3d31d39ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUYD9ZIoSSKofaX4pyLboA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">示例数据模式</figcaption></figure><h2 id="e54b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak"> MySQL </strong></h2><p id="deb1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">运行下面的SQL语句来创建图书馆图书表并导入示例数据。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="67ab" class="ls lt iq mr b gy mv mw l mx my">CREATE TABLE `library-book` (<br/>`id` int(11) NOT NULL,<br/>`title` text COLLATE utf8_unicode_ci,<br/>`publicationPlace` text COLLATE utf8_unicode_ci<br/>);</span><span id="da4c" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('1', 'How To Grow Your Own Fruit and Veg: A Week-by-week Guide to Wild-life Friendly Fruit and Vegetable Gardening - Recipes Of Natural Balance Gardening', 'London');</span><span id="5ecd" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('2', 'The Life of God in the Soul of the Church: The Root and Fruit of Spiritual Fellowship', 'Edinburgh');</span><span id="b949" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('3', 'Fruit and vegetable production in Africa - The important fruits are bananas, pineapples, dates, figs, olives, and citrus; the principal vegetables include tomatoes and onions', 'London');</span><span id="166e" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('4', 'Silver fruit upon silver trees', 'London');</span><span id="21e9" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('5', 'A life to live', 'New York');</span><span id="803b" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('6', 'The emergency medical services in Edinburgh', 'New York');</span><span id="a7e0" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('7', 'SIMPLE GREEN SUPPERS: A FRESH STRATEGY FOR ONE-DISH VEGETARIAN MEALS BY SUSIE MIDDLETON - Delicious Dishes And Unusual Herb Recipes', 'Auckland');</span><span id="e192" class="ls lt iq mr b gy ns mw l mx my">INSERT INTO `library-book` (`id`, `title`, `publicationPlace`) VALUES ('8', 'Good Food For Bad Days -  Tasty vegan meals really don''t have to take all the time in the world or grand ingredients', 'Edinburgh');</span></pre><p id="7710" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MySQL需要为全文搜索设置索引，运行下面的语句为“title”和“publicationPlace”创建一个全文索引，假设读者对基于这两个数据字段查找书籍感兴趣。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5f6b" class="ls lt iq mr b gy mv mw l mx my">ALTER <a class="ae kv" href="http://localhost:7080/url.php?url=https://dev.mysql.com/doc/refman/5.7/en/alter-table.html" rel="noopener ugc nofollow" target="_blank">TABLE</a> `library`.`books` ADD FULLTEXT `book_free_text_index` (`title`, `publicationPlace`);</span></pre><h2 id="ea60" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">弹性搜索</strong></h2><p id="6a0f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Elasticsearch的所有CRUD操作都是通过REST API调用来完成的。要将同一组样本图书记录加载到Elasticsearch中，请运行下面的curl命令，它会提交一个批量数据插入的POST请求。如果你想知道如何在你的本地机器上运行Elasticsearch和Kibana进行测试，请点击<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/how-to-build-a-marvelous-tech-stack-of-elasticsearch-798bae89b13c">这篇文章</a>，在docker上部署一个Elasticsearch节点。</p><p id="e9bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与MySQL不同，Elasticsearch是一个NoSQL数据库，可以在不事先创建表模式的情况下插入数据。Elasticsearch中的“Index”是指关系数据库中的数据库，如果请求中指定的“library-book”还不存在，它会自动创建一个索引。此外，不需要创建全文搜索索引，因为Elasticsearch在数据插入或更新过程中将文本内容分解为标记并存储在索引中。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="051b" class="ls lt iq mr b gy mv mw l mx my">curl --request POST \<br/>--url 'http://localhost:9200/_bulk?pretty=' \<br/>--header 'Content-Type: application/json' \<br/>--data '{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "1" } }<br/>{ "title" : "How To Grow Your Own Fruit and Veg: A Week-by-week Guide to Wild-life Friendly Fruit and Vegetable Gardening - Recipes Of Natural Balance Gardening", "publicationPlace": "London"}<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "2" } }</span><span id="570e" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "The Life of God in the Soul of the Church: The Root and Fruit of Spiritual Fellowship", "publicationPlace": "Edinburgh" }<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "3" } }</span><span id="5e5e" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "Fruit and vegetable production in Africa - The important fruits are bananas, pineapples, dates, figs, olives, and citrus; the principal vegetables include tomatoes and onions", "publicationPlace": "London"}<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "4" } }</span><span id="6f3a" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "Silver fruit upon silver trees", "publicationPlace": "London" }<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "5" } }</span><span id="46c6" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "A life to live", "publicationPlace": "New York" }<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "6" } }</span><span id="8504" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "The emergency medical services in Edinburgh", "publicationPlace": "New York" }<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "7" } }</span><span id="1ceb" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "SIMPLE GREEN SUPPERS: A FRESH STRATEGY FOR ONE-DISH VEGETARIAN MEALS BY SUSIE MIDDLETON - Delicious Dishes And Unusual Herb Recipes", "publicationPlace": "Auckland" }<br/>{ "index" : { "_index" : "library-book", "_type" : "_doc", "_id" : "8" } }</span><span id="b260" class="ls lt iq mr b gy ns mw l mx my">{ "title" : "Good Food For Bad Days -  Tasty vegan meals really don'\''t have to take all the time in the world or grand ingredients", "publicationPlace": "Edinburgh" }</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="92d0" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">简单关键字搜索</h1><p id="d721" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们从一个简单的搜索开始，假设我们搜索一个关键词‘爱丁堡’。</p><h2 id="c0cd" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak"> MySQL </strong></h2><p id="1539" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">要查找匹配该关键字的所有记录，请在MySQL中使用match()以布尔模式进行全文查询。运行此SQL语句来搜索“爱丁堡”。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="fe6a" class="ls lt iq mr b gy mv mw l mx my">SELECT id, title, publicationPlace,<br/>MATCH (title, publicationPlace) AGAINST ('edinburgh' IN BOOLEAN MODE) AS score<br/>FROM `library-book`<br/>ORDER BY score DESC</span></pre><p id="bac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">搜索结果给每条记录打分，是为了显示相关性。分数越高，记录与关键字的相关性越大。有3条记录得分&gt; 0，因为标题和出版地与关键字“爱丁堡”匹配，而其他记录与关键字不匹配，因此得分为零。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/21e9aa7892c880eb04e5e0d0206e1d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w51li5WLNff4_qBcY-N_hw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">MySQL —简单的关键字搜索结果</figcaption></figure><h2 id="3433" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">弹性搜索</strong></h2><p id="a238" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Elasticsearch支持多种查询方式，如关键字、文本短语、前缀等。在这个例子中，我们使用查询类型“multi_match”来搜索多个数据字段——“title”和“publicationPlace”。提交此帖子请求以搜索关键字“爱丁堡”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3568" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果与MySQL的结果一致。3条记录匹配关键字“爱丁堡”，但由于Elasticsearch中不同的相关性计算机制，分配的分数不相同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/38e651877abb39c01def79a1c9edfc38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-41obkS4psBE2usWdFzwaQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure><h2 id="98a6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">基于指定数据字段微调分数</h2><p id="4c7b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">对于某些用例，某些数据字段更重要，这些字段的关键字匹配应该得到更高的分数。虽然MySQL不提供这样的灵活性，但在Elasticsearch中，通过在数据字段中添加脱字符号“^”可以实现这一点。此处的示例将“标题”字段配置为重要3倍。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4f28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为“标题”更重要，所以“标题”字段与关键字匹配的记录会得到更高的分数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/6071ca15b769b33440b83cd0508b92c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFPIreGU0Zhq7o5V0j69YQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="6f1f" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">用逻辑条件搜索</h1><p id="7d9a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">您可能希望指定某些搜索标准，例如AND / OR / NOT。比方说，我们想要搜索与关键词“生活”和“生存”都匹配的书籍。为此，我们在每个关键字前面加上一个符号“+”，以表明它是一个“与”条件。</p><h2 id="936f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak"> MySQL </strong></h2><p id="132b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">MySQL提供的布尔模式支持带逻辑条件的查询。让我们搜索一下同时带有“生活”和“活着”两个关键词的书籍。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="c794" class="ls lt iq mr b gy mv mw l mx my">SELECT id, title, publicationPlace,<br/>MATCH (title, publicationPlace) AGAINST ('+life +live' IN BOOLEAN MODE) AS score<br/>FROM `library-book`<br/>ORDER BY score DESC;</span></pre><p id="d982" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在只有《活着的生活》这本书得分&gt; 0，而其余的书得分= 0。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/1a0d8df5b794c2f5cbf11f1b344bc4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVhWmQSmVR1SRy8eN858BQ.jpeg"/></div></div></figure><p id="a373" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">布尔模式不仅支持AND运算符(+)，还支持NOT (~)、higher relevance(&gt;)、lower relevance (  MySQL官方参考了解详情)等其他符号。</p><h2 id="a8cf" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">弹性搜索</strong></h2><p id="3cb1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">同样的一组符号可以应用于Elasticsearch。我们可以在POST请求中为带有逻辑条件的文本短语使用查询类型“simple_query_string”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f78c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果只显示了一条记录，这与MySQL的结果相同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/434f8b9fd0d29b1e0e68a67aafff30f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HxVARdqz2wb75nF74h16g.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="0001" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">文本短语搜索</h1><p id="ca31" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">说“<strong class="ky ir">美食菜谱</strong>”的文本短语的搜索结果是什么？因为文本短语被分解成小写的记号“recipes”、“of”、“a”、“delicious”、“and”、“tasty”和“meal”。记录匹配更多的标记，这意味着它与文本短语更相关。</p><p id="311d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">人们自然地用人类语言键入文本短语进行查询。考虑到人类语言，为了产生准确的结果，需要特殊的处理。例如，匹配那些在英语中出现频率高的单词，如“a”、“an”、“of”、“the”等。不可能产生有意义的结果。这些词被称为“停用词”，搜索引擎应该在文本短语查询中忽略它们。</p><h2 id="950e" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak"> MySQL </strong></h2><p id="4b27" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">MySQL支持自然语言模式，该模式会忽略“停用词”并运行不区分大小写的搜索。运行此查询语句来搜索文本短语。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="2cc7" class="ls lt iq mr b gy mv mw l mx my">SELECT id, title, publicationPlace, <br/><a class="ae kv" href="http://localhost:7080/url.php?url=https://dev.mysql.com/doc/refman/5.7/en/fulltext-search.html#function_match" rel="noopener ugc nofollow" target="_blank">MATCH</a> (title, publicationPlace) AGAINST ('Recipes Of A Delicious And Tasty Meal' <a class="ae kv" href="http://localhost:7080/url.php?url=https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#function_in" rel="noopener ugc nofollow" target="_blank">IN</a> NATURAL LANGUAGE MODE) AS score <br/>FROM `library-book` <br/>ORDER BY score DESC;</span></pre><p id="cc0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">得分最高的前3条记录匹配搜索文本短语中的大多数标记。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/b48255239cb4b2e1e3a8c9e19c279763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVmtB_b9eDLy2KkaDYefWw.jpeg"/></div></div></figure><h2 id="c56a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">弹性搜索</strong></h2><p id="ec38" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Elasticsearch的默认索引设置不具备MySQL提供的自然语言模式等功能。</p><p id="6545" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您将此帖子请求发送到Elasticsearch以搜索相同的文本短语时，您会看到不同的结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="e210" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认设置将停用词考虑在匹配和分数计算中。结果，具有匹配大多数停用词(例如“of ' '和“and ”)的最高分数的搜索结果显然是不相关的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/d96da43cd39a85445fb59153ed2195b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0wr_-5s1YahkToR-WlYPA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure><p id="484b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">别担心，Elasticsearch实际上是一个非常强大的搜索引擎，对自然语言搜索的支持可以通过在索引设置中为停用词配置令牌过滤器来完成。</p><p id="9be9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Elasticsearch提供了15个令牌化器和50多个令牌过滤器，适合各种用例。要实现类似MySQL的全文搜索，只需在分析器中添加停用词令牌过滤器即可。下图显示分析仪由以下组件组成:</p><ul class=""><li id="622a" class="oc od iq ky b kz la lc ld lf oe lj of ln og lr oh oi oj ok bi translated"><strong class="ky ir">标准分析器</strong> —将文本短语分解成标记</li><li id="2ada" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><strong class="ky ir">小写令牌过滤器</strong> —将令牌转换为小写以进行不区分大小写的搜索</li><li id="ea21" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><strong class="ky ir">停用词标记过滤器</strong> —去除常用词的标记，如“of”、“a”、“and”等。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/27e5f5282fab160f0eea19e87f17ab62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMCK8P68v0N1eFDk5oQcPQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—自然语言分析器</figcaption></figure><p id="bca3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分析器在索引设置中配置，并映射到数据字段“标题”和“发布位置”。</p><p id="21ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提交这个PUT请求，用新的analyzer配置和字段映射创建一个名为“library-book-text-phrase”(即Elasticsearch中的数据库)的新索引。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c522" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，提交这个POST请求，将数据从原始索引“图书馆-图书”复制到新创建的索引“图书馆-图书-文本-短语”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c1b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们对新索引“图书馆-书籍-文本-短语”运行相同的查询。这个结果现在更有意义了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/3b3ebb3ee66172e608217a62b6218081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_JaZeoruQSQl_nOy9BuM1Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure><h1 id="2391" class="ng lt iq bd lu nh os nj lx nk ot nm ma jw ou jx md jz ov ka mg kc ow kd mj nq bi translated">MySQL —扩展搜索标准</h1><p id="9d8a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">一个强大的搜索引擎不仅能够通过令牌匹配进行搜索，还能够理解关键字并扩展对具有类似含义的其他关键字的搜索。例如，当您搜索关键字“woods”时，搜索引擎应该查找与其他类似关键字(如“timber”、“lumber”和“trees”)匹配的记录。</p><p id="45d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MySQL能够使用“查询扩展”模式来猜测您正在寻找什么。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="58d8" class="ls lt iq mr b gy mv mw l mx my">SELECT id, title, publicationPlace,<br/>MATCH (title, publicationPlace) AGAINST ('green' WITH QUERY EXPANSION) AS score<br/>FROM `library-book`<br/>ORDER BY score DESC</span></pre><p id="d1b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们搜索关键词“绿色”时。将返回3条记录。第二和第三记录的标题字段实际上不包含关键字“绿色”，但是搜索引擎以某种方式猜测这些记录的内容与关键字“绿色”相关</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/0624e70cca302f5e9d83ac5f9dc72a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZW-OnlTrYjonZapykjW0A.jpeg"/></div></div></figure><p id="2c1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，当我们向搜索标准中添加更多的关键字时，搜索结果会包含更多的“噪音”。几乎所有的图书记录都在查询扩展模式下找到了文本短语“美好的生活”。</p><p id="1218" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你对搜索结果的准确性不满意，就没有办法对其进行微调。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/d616feef41913740d5dbaf9e7acc59e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*09BNU3Su2wyTgn6cErAbww.jpeg"/></div></div></figure><h1 id="fde5" class="ng lt iq bd lu nh os nj lx nk ot nm ma jw ou jx md jz ov ka mg kc ow kd mj nq bi translated">弹性搜索—使用同义词标记过滤器的广泛搜索</h1><p id="d5c3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Elasticsearch提供了许多方法来实现广泛的搜索，类似于MySQL支持的扩展模式。使用令牌过滤器不是提供固定的解决方案，而是可以实现高级全文搜索功能。</p><p id="5a98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们来看看同义词搜索的支持。我们配置令牌过滤器，使其将搜索扩展到同义词。我们使用一个免费的词汇数据库WordNet。一般来说，它存储超过20k个单词和到同义词的映射。</p><p id="5d80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">配置是为同义词添加新的令牌过滤器，过滤器从WordNet文件中读取同义词映射。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/4ddcc02b46b5694fd5936118702d7aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*WgmcM8pDXYD0ph0PeJQwXQ.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">带有WordNet同义词标记过滤器的Elasticsearch Analyzer</figcaption></figure><p id="773f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要启用新的索引设置，下载WordNet文件并复制到[elastic search folder]/config/analysis，然后提交这个PUT请求来创建一个名为“library-book-synonym-wordnet”的新索引</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ad3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，提交这个POST请求，将数据从原来的索引“library-book”复制到新创建的索引“library-book-synonym-wordnet”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在新索引中搜索关键字“green”。然后，您将获得与“green”的同义词匹配的记录列表。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9955" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/66814c5bf13ef1a1154635463f72f6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CN1Qo1P4Z5vY8T3m1QEsXw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure><h1 id="eafc" class="ng lt iq bd lu nh os nj lx nk ot nm ma jw ou jx md jz ov ka mg kc ow kd mj nq bi translated">使用自定义单词映射的Elasticsearch Token同义词过滤器</h1><p id="5fa2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果WordNet不能满足您的需求，Elasticsearch支持同义词的自定义映射。我们配置了一个同义词标记过滤器，它将关键字“水果”映射到一个关键字列表——“香蕉”、“菠萝”、“枣”、“无花果”、“橄榄”和“柑橘”。因此，搜索关键字“香蕉”将匹配任何带有“水果”的记录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/dc406063b11db8dc898915787d5bb525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*855OBH2BPxaaWOMjUFshTg.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">具有自定义同义词标记过滤器的Elasticsearch Analyzer</figcaption></figure><p id="d6e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提交这个PUT请求，创建一个新的索引和带有标记过滤器“synonym_filter”的定制分析器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c95f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将数据复制到新创建的索引后，将这个POST请求提交给关键字“banana”的搜索。然后，您将看到结果包含所有匹配“水果”关键字的记录。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8ba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/8b963300ebd281cba355f770a028d0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpIm1qu5c-uyRBpyRWr45Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索—搜索结果显示在基巴纳</figcaption></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="4d77" class="ng lt iq bd lu nh ni nj lx nk nl nm ma jw nn jx md jz no ka mg kc np kd mj nq bi translated">最后的想法</h1><p id="4358" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">MySQL和Elasticsearch都提供了强大的全文搜索功能。如果您的系统使用MySQL作为数据存储，可以通过为目标数据字段创建全文索引来快速启用全文搜索功能。该解决方案非常适合大多数用例，因为它为用户提供了一种快速搜索多个数据字段上的关键字和文本短语的方法。然而，当涉及到搜索结果的微调和定制时，MySQL中的选项是有限的。因此，Elasticsearch可能是高级功能和定制搜索行为的更好选择，因为该解决方案高度可配置且更加灵活。</p></div></div>    
</body>
</html>