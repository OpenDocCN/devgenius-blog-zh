# 分布式整体

> 原文：<https://blog.devgenius.io/distributed-monolith-1d2d9f86a68f?source=collection_archive---------4----------------------->

我认为分布式 Monolith 是我们通常在没有经验的情况下实现微服务架构的一个阶段。

![](img/8799479242d005c1f6fdd7272c56f2a1.png)

我在我工作过的一些组织中看到了一种模式，这种模式与微服务的奇特想法有关。由于在整个社区中传播的一些误解，软件中有许多术语已经失去了它们原来的意义。其中一个术语是微服务。

## 什么是分布式整体结构？

对于这个问题，我没有一个好的答案，但是我有一个很好的测试来检查你是否正在做一个:

*   对一个微服务的更改通常需要对其他微服务进行更改
*   部署一个微服务需要同时部署其他微服务
*   你的微服务太啰嗦了
*   相同的开发人员跨许多微服务工作
*   您的许多微服务共享一个数据存储
*   您的微服务共享许多相同的代码或模型

在这种情况下，你有一个分布式的整体。

## 微服务之路

当一个组织开始考虑用微服务取代其整体架构时，我们通常会提出以下优势:

*   改进的可扩展性
*   更好的故障隔离和更具弹性的应用
*   更快的上市时间和“面向未来”

在这个阶段，我们认为架构本身将帮助我们解决我们的可伸缩性问题，我们的长交付时间，我们的缺陷。只要改变架构的足迹，我们就会变得更好。

所以我们决定选择微服务，我们有了第一个二分法:

*   我们是从零开始吗？
*   我们是否重构我们的整体，并从中提取微服务？

第一个选项通常会将您直接带到分布式整体平台。我们通常认为微服务只是具有明确范围的小服务，就像我们整体中的层一样。因此，我们的服务在它们之间同步聊天，通常添加一个新功能时，一个开发人员需要更改所有层。

第二种选择是一种更好的方法，但在整体混乱的情况下，这种方法要困难得多。如果我们已经注意到了我们的 monolith 中的耦合和模块化，那么转向微服务的步骤就更容易了。但在这种情况下，在 monolith 中工作的痛苦会更少，并且更难跳到微服务(这不一定是个坏选择，为什么要使用更复杂的方法呢？).
所以通常我们决定去微服务，因为我们的整体很难扩展新的功能或适应不同的市场，因为他们缺乏好的设计(在最坏的情况下是 https://en.m.wikipedia.org/wiki/Big_ball_of_mud)。

## [康威定律](https://en.wikipedia.org/wiki/Conway%27s_law)

一个分布式的整体是我们应该从创造了这个混乱的整体的组织中期待的。同样的团队，同样的人，同样的工程实践，同样的沟通模式，我们将创造同样的混乱，但现在是分布式的。[你必须这么高才能使用微服务](https://martinfowler.com/bliki/MicroservicePrerequisites.html)。

> *随着整体系统变得太大而难以处理，许多企业开始将它们分解成微服务架构风格。这是一次值得的旅行，但并不容易。我们了解到，要做好这一点，我们需要从简单的服务开始，然后引出基于垂直功能的服务，这些垂直功能对业务很重要，并且会经常发生变化。这些服务一开始应该很大，并且最好不要依赖于剩余的整块。我们应该确保迁移的每一步都代表了对整体架构的原子级改进。* [https://Martin fowler . com/articles/break-monolith-into-micro services . html](https://martinfowler.com/articles/break-monolith-into-microservices.html)

微服务是一种允许组织在自治团队中成长的模式。开发公司的开发单位应该是团队，而不是人。如果你的文化非常关注个人而不是团队(很多团队)，结果将是开发人员和微服务之间的比率接近 1。你正在创造一个分布式的整体。

## 没有自主团队

例如，我曾见过一些公司在整体架构下工作，并在早期就决定采用微服务。因此，当他们是几个开发人员(在一个团队中)时，他们开始在微服务中拆分 monolith。努力实现 monolith 是一个很好的实践，但我们应该考虑垂直地做，而不是水平地做。

最资深的开发人员预先决定了架构，所以他们在他们的微服务中复制了公司中存在的通信模式。由于他们是一个小团队，即使他们创建了一堆或多或少独立的服务，他们仍然保持着迫使他们没有独立团队的做法。他们避免拥有微服务的代码，以允许任何开发人员实现任何功能，破坏了多个团队的想法。那些团队只是一群给系统添加功能的人，没有任何目标。如果在以前的小团队中，我们正在做代码评审，我们发现他们分享知识很好。当我们有更多的团队时，我们可能会陷入错误，因为我们的团队没有专注于问题的一部分，我们可以使用代码评审来共享知识。为什么不在团队之间进行代码评审，为什么不与所有组织开会解释我们在团队中做什么？。我们需要共享所有这些信息，以保持所有开发人员更新系统中所做的任何更改，因为一个开发人员将需要更改一堆服务，以将其功能放入产品中。
的确，这种方法在开始时有避免代码冲突的好处。由于我们周围有如此多的小代码库，它们之间的冲突没有显示出来。但是交付时间非常长，因为它需要整个组织(唯一一个真正的团队)之间的大量协调。新的结构似乎控制了团队之外的架构，部门的建立增加了更多的官僚主义，等等。
最后，我们只有一个团队(全部是开发人员)，所有不景气的团队共享一堆服务，创建新的部门，并且需要大量的沟通来完成这项工作。基本上，我们将我们整体中的问题转化为我们组织中的结构。代码很容易修改，但是官僚作风很难。[独立团队之间过多的协调是不好的。](/its-the-coordination-stupid-f3581bbf25cd?sk=644c395aad2747e8409c2f81d5917897)协调应该限制在团队、工作单位内部。

## 没有自主权的所有权

拥有自主团队需要拥有代码。但是一些公司给团队代码所有权，而不是自主权。如果微服务被认为是分层的，就会出现这种情况。
要做出改变，您需要创建不同的标签，由不同的团队完成，并协调所有团队，使您的功能发挥作用。我们把一个代码问题转化成一个计划问题，这是一个非常糟糕的想法，同样需要很长的准备时间。大量的协调，大量的时间浪费，大量的 e2e 测试来验证一切正常。

微服务架构需要自治团队，自治团队需要所有权。[要有一个真正自主的团队，除了其他的东西，还需要有一个团队使命，一个团队不仅仅是一群人一起工作](/software-teams-karate-421ff1ce5425?sk=35ae3ddbd707d5d86d681e1d8a08524b)。

所有这些阶段在公司发展的某一阶段都是有效的，但对你的下一阶段没有帮助。所以没有大爆炸去微服务，你不会结束，一旦你从 1 整块移动到 5 个服务。微服务不是那样工作的，它应该是一个框架，允许团队创建他们自己的服务来解决业务问题，尽可能独立于其他团队。

微服务是一种模式，用来创建一个由许多自治的、孤立的(尽可能多的)团队组成的公司。允许一个公司同时做很多事情而不陷入协调问题。存在权衡，你必须为微服务付费，自治团队意味着不同的解决方案，如果你不接受这一点，那就不要选择微服务。

**如果你不同时改变你的组织，你的工程实践，你的文化，分布式的整体是最有可能的事情。**