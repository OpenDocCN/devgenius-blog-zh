<html>
<head>
<title>Connecting Azure Data Studio To MS SQL Server Docker Version</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Azure Data Studio 连接到 MS SQL Server Docker 版本</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connecting-azure-data-studio-to-ms-sql-server-docker-version-8f9ce8786314?source=collection_archive---------5-----------------------#2022-11-24">https://blog.devgenius.io/connecting-azure-data-studio-to-ms-sql-server-docker-version-8f9ce8786314?source=collection_archive---------5-----------------------#2022-11-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a544" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 MS SQL Server、Azure Data Studio 和 Northwind 数据库</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0e17bc09d334fe34a47206932eba3737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QWQnKF-nOciFM3oK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://growtika.com/" rel="noopener ugc nofollow" target="_blank"> Growtika 开发商营销机构</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="3327" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从 MS SQL Server 2017 (14.x)开始，MS SQL Server 在所有支持的平台上都有相同的底层数据库引擎，包括 Linux 和容器(请参考<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-overview" rel="noopener ugc nofollow" target="_blank">[1]Linux 上的 Microsoft SQL Server</a>)。这篇文章探索了 SQL Server Docker 版本(参考<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker" rel="noopener ugc nofollow" target="_blank">[2]Docker</a>上的 Microsoft SQL Server)使用 MS Azure Data Studio(参考<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/azure-data-studio/download-azure-data-studio" rel="noopener ugc nofollow" target="_blank"> [3] MS Azure Data Studio </a>)和 SQLCMD 程序(参考<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-connect-to-the-database-engine" rel="noopener ugc nofollow" target="_blank"> [4]Microsoft SQLCMD </a>)来操作 SQL Server 的 Northwind 示例数据库(参考<a class="ae ky" href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql/linq/downloading-sample-databases" rel="noopener ugc nofollow" target="_blank">[5]Microsoft Get the north wind sample database</a>)。</p><h1 id="7c39" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">(1)设置 MS SQL Server Docker 版本</h1><p id="b768" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">(1.1)运行拉动命令<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-overview" rel="noopener ugc nofollow" target="_blank">【1】</a>。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="504d" class="mh la in md b be mi mj l mk ml">docker pull mcr.microsoft.com/mssql/server:2017-latest</span></pre><p id="1a50" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(1.2)保存图像(可选)。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="7508" class="mh la in md b be mi mj l mk ml">docker save -o mssql-2017-20221124.tar mcr.microsoft.com/mssql/server:2017-latest</span></pre><p id="bfe9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">保存的图像可以在以后加载到 Docker 中</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="eef1" class="mh la in md b be mi mj l mk ml">docker load -i mssql-2017-20221124.tar</span></pre><p id="f2e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(1.3)运行图像<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker" rel="noopener ugc nofollow" target="_blank">【2】</a>。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="40a6" class="mh la in md b be mi mj l mk ml">docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=P@ssw0rd" -p 1433:1433 --name sql1 --hostname sql1 -d mcr.microsoft.com/mssql/server:2017-latest</span></pre><p id="f081" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(1.4)运行 SQLCMD 命令。</p><p id="9aee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">进入容器的终端命令并找到 SQLCMD 程序。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="4e52" class="mh la in md b be mi mj l mk ml"># find . -name sqlcmd<br/>./opt/mssql-tools/bin/sqlcmd</span></pre><p id="f18a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用基本参数<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-connect-to-the-database-engine" rel="noopener ugc nofollow" target="_blank">【4】</a>运行程序。提示<code class="fe mm mn mo md b">1&gt;</code>表示 SQLCMD 正在运行并等待 SQL 命令输入。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="286a" class="mh la in md b be mi mj l mk ml"># ./opt/mssql-tools/bin/sqlcmd -S localhost -Usa -PP@ssw0rd<br/>1&gt;</span></pre><p id="cd92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尝试运行一些基本命令。参考 SqlShack.com 的<a class="ae ky" href="https://www.sqlshack.com/working-sql-server-command-line-sqlcmd/" rel="noopener ugc nofollow" target="_blank">中的例子和解释。</a></p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="92ab" class="mh la in md b be mi mj l mk ml">select DB_NAME()<br/>GO<br/>select name from sys.databases<br/>GO<br/>SELECT SERVERPROPERTY('COLLATION')<br/>GO<br/>SELECT SERVERPROPERTY('EDITION')<br/>GO<br/>SELECT SERVERPROPERTY('IsIntegratedSecurityOnly')<br/>GO<br/></span></pre><h1 id="16a3" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">(2)建立北风数据库</h1><p id="2ad9" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">从<a class="ae ky" href="https://github.com/microsoft/sql-server-samples/blob/master/samples/databases/northwind-pubs/instnwnd%20(Azure%20SQL%20Database).sql" rel="noopener ugc nofollow" target="_blank"> github </a>下载 Northwind 数据库，并将 sql 文件另存为<code class="fe mm mn mo md b">instnwnd.sql</code>。该文件不包含创建数据库的命令。必须添加以下命令。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="f155" class="mh la in md b be mi mj l mk ml">IF EXISTS (SELECT * FROM sys.databases WHERE name = 'northwind')<br/>BEGIN<br/>    DROP DATABASE northwind;  <br/>END;<br/>CREATE DATABASE northwind;<br/>GO<br/><br/>USE northwind<br/>GO</span></pre><p id="eb82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编辑文件<code class="fe mm mn mo md b">instnwnd.sql</code>。将上述代码添加到文件的顶部，如下所示。保存文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/9b88dfa3994a15b03753902147e6593b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8kU4xMzBxZ17UbLGdQNKQ.png"/></div></div></figure><p id="7669" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将文件复制到 docker 容器中。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="4354" class="mh la in md b be mi mj l mk ml">docker cp instnwnd.sql sql1:/opt/mssql-tools/bin</span></pre><p id="2523" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回到容器并转到 SQLCMD 文件夹</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="b0b8" class="mh la in md b be mi mj l mq ml"># cd "./opt/mssql-tools/bin/"</span></pre><p id="1908" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行 sqlCMD 以输入文件中的 SQL 命令。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="3ab4" class="mh la in md b be mi mj l mq ml"># ./sqlcmd -S localhost -Usa -PP@ssw0rd -i instnwnd.sql<br/>Changed database context to 'northwind'.</span></pre><p id="cb0c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行 SQLCMD 程序。检查 northwind 数据库是否已创建。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="da2a" class="mh la in md b be mi mj l mq ml"># ./sqlcmd -S localhost -Usa -PP@ssw0rd<br/>1&gt; select name from sys.databases<br/>2&gt; GO<br/>name                                                                                                                    <br/>--------------------------------------------------------------------------------------------------------------------------------<br/>master                                                                                                                  <br/>tempdb                                                                                                                  <br/>model                                                                                                                   <br/>msdb                                                                                                                    <br/><strong class="md io">northwind </strong>                                                                                                              <br/><br/>(5 rows affected)<br/>1&gt;</span></pre><h1 id="f390" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">(3)建立微软 Azure 数据工作室</h1><p id="1f4b" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">从<a class="ae ky" href="https://learn.microsoft.com/en-us/sql/azure-data-studio/download-azure-data-studio" rel="noopener ugc nofollow" target="_blank">官网【3】</a>下载 MS Azure Data Studio 并安装程序。运行程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/1a830ef0b8253565d5c9975b5a1405d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OwOM0J7R26xObyxvymD35w.png"/></div></div></figure><p id="c920" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">单击创建连接按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/5f5f0a4913a8881d203919112c51842b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5Q3L23CeHqoXDK0A5fxYw.png"/></div></div></figure><p id="3d8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在“连接详情”表单中，输入基本连接参数，即<code class="fe mm mn mo md b">Server</code>、<code class="fe mm mn mo md b">Authentication type</code>、<code class="fe mm mn mo md b">User name</code>、<code class="fe mm mn mo md b">Password</code>，点击<strong class="jm io">连接</strong>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/40b782ed0e73cf56a8f76faab7e690ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*vjiaP2o9OFqFuEgLBegjWg.png"/></div></figure><p id="03ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果弹出关于不可信连接的错误，请单击“启用信任服务器证书”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/8511cc58b58d887b4da405f80499fea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXdSSJ5y-bh88-w8EjJi_w.png"/></div></div></figure><p id="2e27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者，开发人员可以在如下所示的“连接详细信息”表单中指定端口号，例如<strong class="jm io"> Server = localhost，1433 </strong>和<strong class="jm io">Trust Server certificate = TRUE</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/bd734dad841ee3391aef67af5c4456d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*TJoLos--VbRtXdy74L1B8w.png"/></div></figure><p id="cd7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">成功登录后，Azure Data Studio 将显示到指定服务器的连接页面。单击主页按钮下的数据库按钮，检查包括 northwind 在内的数据库是否显示在主面板中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/7d253b59a9091c6f6648d1fbee8450e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Y3qgfY6-RgeV1x11l6jnQ.png"/></div></div></figure><p id="3703" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尝试运行一个命令来列出 northwind 数据库中的所有表。</p><pre class="kj kk kl km gt mc md me bn mf mg bi"><span id="a231" class="mh la in md b be mi mj l mk ml">SELECT<br/>  *<br/>FROM<br/>  northwind.INFORMATION_SCHEMA.TABLES;<br/>GO</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/4d75b3705e79b50818d046627b729481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNERB8vfBz26B4mThCHAuA.png"/></div></div></figure></div></div>    
</body>
</html>