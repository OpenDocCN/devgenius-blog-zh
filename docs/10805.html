<html>
<head>
<title>Setup nginx Ingress in cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在云中设置 nginx 入口</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-nginx-ingress-in-cloud-a829f617fab6?source=collection_archive---------3-----------------------#2022-12-01">https://blog.devgenius.io/setup-nginx-ingress-in-cloud-a829f617fab6?source=collection_archive---------3-----------------------#2022-12-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b8d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文描述了如何使用 kubectl 在 Kubernetes 集群中安装 NGINX 入口控制器。</p><h2 id="e7e8" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">什么是 Ingress？</h2><p id="02f7" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">Ingress 是 Kubernetes 的本地资源，如 pods、deployments 等。使用入口，您可以维护 DNS 路由配置。入口控制器通过从存储在 etcd 中的入口对象读取路由规则来执行实际路由。</p><h2 id="3b7a" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">在进入之前？</h2><p id="1317" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">在 Kubernetes 入口稳定之前，定制 Nginx 或 HAproxy kubernetes 部署将作为负载平衡器服务公开，用于将外部流量路由到内部集群服务。</p><h2 id="fd28" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">Kubernetes Ingress:它是如何工作的？</h2><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/2eb27df234cd86aeeea3646b03d9b155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0lRqJwyOR0Ww3xAwrkpBg.png"/></div></div></figure><p id="2951" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">实际进入依赖于两个概念</p><p id="2556" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">- Kubernetes Ingress 资源:Kubernetes Ingress 资源负责在集群中存储 DNS 路由规则。</p><p id="2ce3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">- Kubernetes 入口控制器:Kubernetes 入口控制器(Nginx/HAProxy 等。)通过访问通过入口资源应用的 DNS 规则来负责路由。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ls"><img src="../Images/89c169d11ae481e171336bcce7b12f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZx9EEu58sc7bKovceSdxA.png"/></div></div></figure><h2 id="1ae3" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">设置</h2><p id="eb74" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">首先，我们将通过使用 YAML 清单部署 Nginx 控制器来理解所有相关的 Kubernetes 对象。一旦我们有了理解，我们将使用 kubectl 部署它。</p><h2 id="587e" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">安装 NGINX 入口控制器</h2><p id="62a6" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">由于入口控制器是 Kubernetes 的核心组件，因此作为安装的一部分，它需要在集群级别执行特定的配置。NGINX 项目通过提供一个单一的部署 yaml 文件简化了这一过程，该文件捕获了集群配置所需的所有步骤:</p><pre class="lh li lj lk gt lt lu lv bn lw lx bi"><span id="5bae" class="ly kj in lu b be lz ma l mb mc">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml</span></pre><p id="0abf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">输出:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi md"><img src="../Images/9acb2ed3b2892aac5b4d104a0a49ef7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jf7B22bTxjuhRZzvlCQ0bA.png"/></div></div></figure><h2 id="f934" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">暴露 NGINX 入口控制器</h2><p id="4c5b" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">默认情况下，上述命令会将 NGINX 入口控制器暴露给外界，以允许它开始接收连接。</p><h2 id="4957" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">验证 NGINX 入口控制器</h2><pre class="lh li lj lk gt lt lu lv bn lw lx bi"><span id="fea4" class="ly kj in lu b be lz ma l mb mc">kubectl get pods --all-namespaces -l app.kubernetes.io/name=ingress-nginx<br/>kubectl get services ingress-nginx-controller --namespace=ingress-nginx</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi me"><img src="../Images/4d38003c1837a61420fb5d5de808206f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BELVC5tx9bpHXp3ulNGxdw.png"/></div></div></figure><h2 id="0270" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">使用 NGINX 入口控制器公开服务</h2><p id="e47c" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">现在我们将编写入口清单:</p><pre class="lh li lj lk gt lt lu lv bn lw lx bi"><span id="76bd" class="ly kj in lu b be lz ma l mb mc">apiVersion: networking.k8s.io/v1<br/>kind: Ingress<br/>metadata:<br/>  name: hello-world<br/>  annotations:<br/>    kubernetes.io/ingress.class: "nginx"<br/>    nginx.ingress.kubernetes.io/rewrite-target: /<br/>spec:<br/>  rules:<br/>    - http:<br/>        paths:<br/>          - pathType: Exact<br/>            path: /bookstore<br/>            backend:<br/>              service:<br/>                name: app1-svc<br/>                port:<br/>                  number: 80<br/>          - pathType: Exact<br/>            path: /library<br/>            backend:<br/>              service:<br/>                name: app2-svc<br/>                port:<br/>                  number: 80</span></pre><p id="470e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">测试事物:</p><p id="2be6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">部署我们的应用程序清单后:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mf"><img src="../Images/53a4cac4aa7e69905d02f28755b6dd28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YaLQqnBIq3iW7jPvMwLpdQ.png"/></div></div></figure><p id="a2f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用负载平衡器 IP 进行测试:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mg"><img src="../Images/15ef36e13e2e71363442f3a1441665ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObviPhB8nHDR0ldqLgW3DA.png"/></div></div></figure><p id="5dca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还有书店:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mh"><img src="../Images/48a119029bb1402bdffc93ae0cf47796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OH3JfgEr1dwM8jf3OBGBw.png"/></div></div></figure><p id="cb53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们演示了如何在 Azure Kubernetes 服务中成功部署入口控制器，并在集群中提供两个 ClusterIP 服务。</p></div></div>    
</body>
</html>