<html>
<head>
<title>OpenCV Face-Detection Explained With Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenCV人脸检测项目讲解</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/opencv-face-detection-explained-with-project-5c5f1d263cac?source=collection_archive---------2-----------------------#2021-07-12">https://blog.devgenius.io/opencv-face-detection-explained-with-project-5c5f1d263cac?source=collection_archive---------2-----------------------#2021-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f178" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">建立自己的人脸检测项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/52e0d96f059e3b3941f1d05c54783f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*adyglfPCd6_d4Ff5"/></div></div></figure><p id="5da9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">人脸检测</strong>是一种用于各种应用的计算机技术，可以从数字图像中强化人脸。人脸检测应用广泛，如人脸识别、运动检测、情感接口、摄影等。</p><p id="fc09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文将介绍如何通过网络摄像头或视频文件直接使用Python OpenCV进行人脸检测。</p><p id="e1cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先你需要安装OpenCV和Numpy。我们将使用完整的Python编程语言来完成本教程，所以让我们开始吧。</p><h1 id="9834" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">库设置</h1><p id="80f5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们将同时使用mediapipe和OpenCV。以下是关于这些库的更多信息。</p><h2 id="2a40" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">中间管道</h2><p id="5ed7" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">MediaPipe与研究和开发人员的解决方案和应用合作，用于移动、web应用、边缘计算等领域的机器学习。</p><p id="0f9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">MediaPipe Pose处理RGB图像，并返回检测到的最突出人物的姿势标志。请参考用法<a class="ae mw" href="https://solutions.mediapipe.dev/pose#python-solution-api" rel="noopener ugc nofollow" target="_blank">示例。</a></p><p id="2b96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">导入CV2、媒体管道和时间。</p><p id="bdc0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装mediapipe</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="4de6" class="mk lo iq my b gy nc nd l ne nf">pip install mediapipe</span></pre><h2 id="51b8" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak"> OpenCV </strong></h2><p id="7bde" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">OpenCV是一个图像处理库。它旨在解决计算机视觉问题。OpenCV是一个用Python扩展的C/C++库。</p><p id="a6d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是安装OpenCV的命令</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="9eb6" class="mk lo iq my b gy nc nd l ne nf">pip install opencv-python</span></pre><h1 id="d421" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">我们开始吧</h1><p id="9057" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现在创建faceDection.py。首先，导入我们在这里需要的库。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="1150" class="mk lo iq my b gy nc nd l ne nf">import cv2</span><span id="aaa6" class="mk lo iq my b gy ng nd l ne nf">import mediapipe as mp</span><span id="6f8a" class="mk lo iq my b gy ng nd l ne nf">import time</span></pre><p id="20d5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">time()</strong></code> <strong class="kt ir">函数</strong>接受浮点数并返回自纪元以来的当前时间(秒)。如果系统时钟提供，可能会出现几分之一秒。</p><h2 id="ebc5" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak"> cv2。视频捕获(视频路径)</strong></h2><p id="366e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">这个是视频路径的。如果您不想使用网络摄像头，那么您必须选择此选项。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="f9aa" class="mk lo iq my b gy nc nd l ne nf">cap = cv2.VideoCapture('/home/python/OpenCV/faceDetect/faceD1.mp4')</span></pre><p id="b534" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">如果您使用网络摄像头，则</strong></p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="3c84" class="mk lo iq my b gy nc nd l ne nf">cap = cv2.VideoCapture(0) #depends on your system 0 or 1</span></pre><h2 id="edf6" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak">设置帧速率</strong></h2><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="e060" class="mk lo iq my b gy nc nd l ne nf">pTime = 0</span><span id="ebb7" class="mk lo iq my b gy ng nd l ne nf">cTime = time.time() <em class="nk"># frame rate</em></span><span id="10f9" class="mk lo iq my b gy ng nd l ne nf">fps_rate = 1 / (cTime-pTime)</span><span id="42f3" class="mk lo iq my b gy ng nd l ne nf">pTime = cTime</span></pre><h2 id="1fb3" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak"> MediaPipe人脸检测。</strong></h2><p id="3759" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">MediaPipe面部检测处理RGB图像，并返回检测到的面部位置数据的列表。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="7827" class="mk lo iq my b gy nc nd l ne nf">mpFaceDect = mp.solutions.face_detection</span><span id="71ed" class="mk lo iq my b gy ng nd l ne nf">mpDrawing = mp.solutions.drawing_utils</span><span id="eef8" class="mk lo iq my b gy ng nd l ne nf">faceDetection = mpFaceDect.FaceDetection(0.75)</span></pre><p id="732a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">cv2.cvtColor(src, code[, dst[, dstCn]])</strong></code> <strong class="kt ir"> </strong>将图像从一个色彩空间转换到另一个色彩空间。该函数将输入图像从一个颜色空间转换到另一个颜色空间。以防变形。在RGB颜色空间<strong class="kt ir">、</strong>之间，应该明确指定通道的顺序<strong class="kt ir"> ( </strong> RGB或<strong class="kt ir"> ) </strong>。注意。OpenCV中的默认颜色格式通常被称为RGB，但它实际上是BGR<strong class="kt ir">(</strong><code class="fe nh ni nj my b">. </code>字节被颠倒<strong class="kt ir"> ) </strong>。</p><p id="c98a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b">faceDetection.<strong class="kt ir">process(self, image: np.ndarray) </strong></code> <strong class="kt ir">功能</strong>处理RGB图像并返回检测到的面部位置数据的列表。RGB图像表示为一个数字数组。</p><p id="3876" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">draw_detection(</strong>image, detection,keypoint_drawing_spec,bbox_drawing_spec<strong class="kt ir">)</strong> </code>功能在图像上绘制检测包围盒和关键点。</p><ol class=""><li id="adb3" class="nl nm iq kt b ku kv kx ky la nn le no li np lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">image</strong></code> <strong class="kt ir"> : </strong>表示为NumPy ndarray的三通道RGB图像。</li><li id="4060" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">detection</strong></code> <strong class="kt ir"> : </strong>要在图像上标注的检测原型消息。</li><li id="4d5d" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">keypoint_drawing_spec</strong></code> <strong class="kt ir"> : </strong>一个DrawingSpec对象，指定关键点绘图设置，如颜色、线条粗细和圆半径，如drawing spec = drawing spec(COLOR = RED _ COLOR)。</li><li id="cda3" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">bbox_drawing_spec</strong></code> <strong class="kt ir"> : </strong>指定边界框的DrawingSpec对象。绘图设置，如颜色和线条粗细，如DrawingSpec = DrawingSpec())。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="a497" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">cv2.putText(</strong>img<strong class="kt ir">,</strong> text<strong class="kt ir">,</strong> org<strong class="kt ir">,</strong> fontFace<strong class="kt ir">,</strong> fontScale<strong class="kt ir">,</strong> color[ <strong class="kt ir">,</strong> thickness[ <strong class="kt ir">,</strong> lineType[<strong class="kt ir">,</strong> bottomLeftOrigin]]]<strong class="kt ir">)</strong></code></p><h2 id="2df0" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">我们来讨论一下参数。</h2><ol class=""><li id="ac4c" class="nl nm iq kt b ku mf kx mg la ob le oc li od lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">img</strong></code> <strong class="kt ir"> : </strong>输入绘制文本字符串，</li><li id="5d82" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">text</strong></code> <strong class="kt ir"> : </strong>要绘制的文本字符串。</li><li id="bbd5" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">org</strong></code> <strong class="kt ir"> : </strong>图像中文本字符串的左下角。</li><li id="318a" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">fontFace</strong></code> <strong class="kt ir"> : </strong>字体类型<strong class="kt ir">，</strong></li><li id="497d" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">fontScale</strong></code> <strong class="kt ir"> : </strong>乘以特定字体基本大小的字体比例因子。</li><li id="dff4" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">color</strong></code> <strong class="kt ir"> : </strong>文字颜色。</li><li id="717d" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">thickness</strong></code> <strong class="kt ir"> : </strong>用于绘制文本的线条粗细。</li><li id="3444" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">lineType</strong></code> <strong class="kt ir"> : </strong>线型。</li><li id="832d" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b"><strong class="kt ir">bottomLeftOrigin</strong></code> <strong class="kt ir"> : </strong>当<strong class="kt ir">为真时，</strong>图像数据原点在左下角。否则<strong class="kt ir">，</strong>在左上角。</li></ol><h2 id="0562" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">使用<code class="fe nh ni nj my b"><strong class="ak">cv2.imshow()</strong></code> <strong class="ak"> </strong>功能显示图像</h2><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="023d" class="mk lo iq my b gy nc nd l ne nf">cv2.putText(img, <em class="nk">f</em>'FPS: {int(fps_rate)}', (20, 70), cv2.FONT_HERSHEY_PLAIN,3  ,(0, 255, 0), 2)</span><span id="45d5" class="mk lo iq my b gy ng nd l ne nf">cv2.imshow('Face Detection ', img)</span><span id="71fe" class="mk lo iq my b gy ng nd l ne nf">cv2.waitKey(1)</span></pre><h2 id="778e" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak">以下是完整代码:</strong></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0930" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以把它转换成一个模块，这样我们就可以很容易地使用这个值，创建一个像<strong class="kt ir"> </strong> <code class="fe nh ni nj my b"><strong class="kt ir">faceDetectModule.py</strong></code>这样的模块，然后复制你之前写的所有代码。</p><p id="3a47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后创建一个类。我们应该能够做的是，我们应该创建一个对象，并创建一个方法，允许我们检测姿势，并为我们找到所有这些点。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6a59" class="mk lo iq my b gy nc nd l ne nf"><strong class="my ir">Init function</strong>(self, min_detection_confidence=0.5, model_selection=0)</span></pre><p id="690c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码初始化了一个MediaPipe人脸检测对象。</p><h2 id="d746" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">参数:</h2><ol class=""><li id="b31c" class="nl nm iq kt b ku mf kx mg la ob le oc li od lm nq nr ns nt bi translated"><code class="fe nh ni nj my b">min_detection_confidence</code>:人脸检测成功的最小置信度值(【0.0，1.0】)。<a class="ae mw" href="https://solutions.mediapipe.dev/face_detection#min_detection_confidence." rel="noopener ugc nofollow" target="_blank">详见</a></li><li id="825b" class="nl nm iq kt b ku nu kx nv la nw le nx li ny lm nq nr ns nt bi translated"><code class="fe nh ni nj my b">model_selection</code> : 0或1。0表示选择最适合距离相机2米以内的人脸的短程模型，1表示最适合距离相机5米以内的人脸的全程模型。<a class="ae mw" href="https://solutions.mediapipe.dev/face_detection#model_selection." rel="noopener ugc nofollow" target="_blank">详见</a></li></ol><h2 id="8bbf" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated"><strong class="ak">完整代码在此</strong></h2><p id="6db8" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">下面是完整的代码，您可以根据需要使用和定制。请看一看。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="9ecf" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">以下是视频文件的输出</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/52e0d96f059e3b3941f1d05c54783f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*adyglfPCd6_d4Ff5"/></div></div></figure><h1 id="c5ba" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="66b5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在这篇文章中，我们讨论了一个完整的人脸检测项目。从这篇文章中，你可以了解人脸检测，也可以根据你的需要扩展这个项目。</p><p id="0107" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读。</p><p id="42fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">祝你愉快。</p></div></div>    
</body>
</html>