<html>
<head>
<title>Docker: Development and Production Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker:开发和生产环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/docker-development-and-production-environments-6f78e3e745ca?source=collection_archive---------11-----------------------#2020-06-07">https://blog.devgenius.io/docker-development-and-production-environments-6f78e3e745ca?source=collection_archive---------11-----------------------#2020-06-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6ff0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没有膨胀，unsplash 图像，有趣的 gif。这篇简洁的文章讲述了如何使用 Docker 来建立开发和生产环境。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/40b627f1dffb5dfba14485d8bba8dfba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V__2_A5w_TMC3BJt1V5Dmw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Docker 架构(图片来自<a class="ae ky" href="https://docs.docker.com/get-started/overview/" rel="noopener ugc nofollow" target="_blank">官方文件</a></figcaption></figure><p id="63ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本帖中，我们将尝试解释所有基本的 Docker 概念，使用以下结构设置 MERN 堆栈应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/3cbe166c23a13537a0ede987bb5e1d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Le_pfxE2O6M0dBtHlRV11Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">带有数据库管理客户端的 MERN (Mongo Express React Node)架构</figcaption></figure><h1 id="391c" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">基本 Docker 概念</h1><ul class=""><li id="800a" class="ly lz in jm b jn ma jr mb jv mc jz md kd me kh mf mg mh mi bi translated"><strong class="jm io"> Docker </strong>:将有依赖关系的应用打包到一个虚拟容器中。</li><li id="ad88" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">活动主机</strong>:安装了 Docker 且 Docker 守护进程运行在支持版本上的计算机。</li><li id="4014" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated">客户端:Docker 守护进程的主要用户界面，可以在独立的系统上运行，并通过套接字或 RESTful APIs 进行通信。</li><li id="9b81" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">容器</strong>:保存应用程序实例或实例组运行所需的一切(操作系统、依赖关系等)。</li><li id="b9a3" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Docker 守护进程</strong>:在主机上构建、运行和管理容器。</li><li id="be1e" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Image </strong>:用于创建容器的模板，该模板包含应用实例或实例组的安装及其软件、依赖项和启动容器时要运行的进程。</li><li id="0a11" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Docker registries </strong>:供用户上传或下载的图片库。公共 Docker 注册中心被称为 Docker Hub。</li></ul></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="d7c3" class="la lb in bd lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt mz lv lw lx bi translated">客户端:将 React 应用程序归档</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/7f9adcd3acd4f40f3d83b556ab7a9cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*wjErK6Ec7r1sEgeM6RXh-A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Dockerfile(用于开发)</figcaption></figure><blockquote class="nb nc nd"><p id="a66b" class="jk jl ne jm b jn jo jp jq jr js jt ju nf jw jx jy ng ka kb kc nh ke kf kg kh ig bi translated">第一行“FROM …”告诉 Docker 使用来自 Docker Hub 的某个图像(例如 node:12-alpine)作为创建该容器的起点。</p></blockquote><p id="eb19" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 React 应用程序的根目录下创建一个 docker 文件，如上图所示。您的 fullstack 应用程序应该有一个类似如下的文件夹树:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="e58a" class="nn lb in nj b gy no np l nq nr">root/<br/>|/client/<br/>  | Dockerfile<br/>  | Dockerfile.prod<br/>|/server/<br/>  | Dockerfile<br/>  | Dockerfile.prod<br/>|docker-compose.yml</span></pre><p id="9f62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您想将 React 应用作为独立应用进行测试，请运行以下命令:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="81d8" class="nn lb in nj b gy no np l nq nr"># Builds Image, -t tags it as 'react-app', Dockerfile is in .<br/>docker build -t react-app .<br/># Runs Container from Image 'react-app'<br/>docker run -it --rm -p 3000:3000 react-app</span></pre><p id="e2d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">去<a class="ae ky" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>查看你的 app。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="2901" class="nn lb in nj b gy no np l nq nr"># Other interesting commands<br/><strong class="nj io">docker images</strong> # lists images available on your machine<br/><strong class="nj io">docker ps</strong> # lists docker containers running</span></pre><h1 id="c0db" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">服务器:停靠 Express 服务器</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/496e78669323ddcfe8543af5b4294854.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*eu_YrLyI5kYegHUNN3jhmw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Dockerfile 文件</figcaption></figure><p id="003e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">构建和运行上面的 docker 文件将 Express 服务器作为一个独立的容器运行。</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><p id="7942" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…现在，最精彩的部分是:</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="f5fd" class="la lb in bd lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt mz lv lw lx bi translated">对接全栈 MERN 应用</h1><p id="b653" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv nt jx jy jz nu kb kc kd nv kf kg kh ig bi translated">介绍<a class="ae ky" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">docker-撰写</strong> </a> <strong class="jm io">。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">docker-compose.yml</figcaption></figure><p id="a87e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Docker-Compose 在一个更加用户友好的界面中为您提供了 Docker 的全部功能。通过配置这个 YML 文件，您可以避免过长的命令行指令。设置好该文件后，运行以下命令:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="abf3" class="nn lb in nj b gy no np l nq nr"># This will start all services described in the yml file.<br/>docker-compose up<br/># Run docker-compose down or press ctrl+c to stop the containers.<br/># The following options can be interesting<br/>docker-compose up [service] # starts just the services described<br/>docker-compose build [service] # rebuilds the images of the services</span></pre><ol class=""><li id="bd0d" class="ly lz in jm b jn jo jr js jv ny jz nz kd oa kh ob mg mh mi bi translated"><strong class="jm io">前端</strong> : <strong class="jm io"> </strong>从位于‘client’文件夹中的 Dockerfile 构建镜像，并在端口 3000 上运行。</li><li id="9a20" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><strong class="jm io">后端</strong>:与快递服务器相同</li><li id="d748" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><strong class="jm io">Mongo&amp;Mongo-Express</strong>:Docker Hub 给你大量服务的免费图片。其中 2 个是 MongoDB 和 MongoExpress。您不再需要在本地开发机器上安装数据库。20 行代码足以设置您的数据库和管理客户机。🤯</li></ol><p id="106d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对我来说，docker-compose 是 docker 隐藏的瑰宝💎。</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="6b5b" class="la lb in bd lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt mz lv lw lx bi translated">生产环境呢？</h1><p id="7529" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv nt jx jy jz nu kb kc kd nv kf kg kh ig bi translated">我不会在这里得到太多的细节，因为赌注相当高。本节的目标是指出在将该设置转化为生产时您应该做出的更改和应该关注的问题。</p><ol class=""><li id="2816" class="ly lz in jm b jn jo jr js jv ny jz nz kd oa kh ob mg mh mi bi translated"><strong class="jm io">前端</strong>:我使用了<a class="ae ky" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">创建-反应-应用</a>，所以代替<strong class="jm io">纱线开始</strong>，我应该使用<strong class="jm io">纱线构建</strong>，在这里详细描述了<a class="ae ky" href="https://create-react-app.dev/docs/deployment/" rel="noopener ugc nofollow" target="_blank">的多种方式。</a></li><li id="74f1" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><strong class="jm io">后端</strong>:很多可能性...一个想法是用 NGINX 创建一个 web 服务器来服务后端和前端。也许<a class="ae ky" href="https://hub.docker.com/_/nginx" rel="noopener ugc nofollow" target="_blank"> Docker Hub 的 NGINX </a>？。</li><li id="084a" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><strong class="jm io">数据库</strong>:是否应该在容器中运行生产数据库是一个有点两极分化的话题。鉴于这一点以及我不是专业的数据库经理或容器专家的事实，我不知道。</li></ol></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="0120" class="la lb in bd lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt mz lv lw lx bi translated">资源</h1><ol class=""><li id="6a11" class="ly lz in jm b jn ma jr mb jv mc jz md kd me kh ob mg mh mi bi translated"><a class="ae ky" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank">正式备案文件</a></li><li id="65b2" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><a class="ae ky" href="https://dev.to/softchris/5-part-docker-series-beginner-to-master-3m1b?wt.mc_id=personal-blog-chnoring" rel="noopener ugc nofollow" target="_blank">克里斯·诺林的 5 部 Docker 系列</a> <em class="ne"> ( </em>🔥<em class="ne">比 docs 好)</em></li><li id="0291" class="ly lz in jm b jn mj jr mk jv ml jz mm kd mn kh ob mg mh mi bi translated"><a class="ae ky" href="https://mherman.org/blog/dockerizing-a-react-app/" rel="noopener ugc nofollow" target="_blank">迈克尔·赫尔曼斯的 Dockerize a React App 文章</a> <em class="ne"> ( </em>🔥<em class="ne">另一种方法)</em></li></ol></div></div>    
</body>
</html>