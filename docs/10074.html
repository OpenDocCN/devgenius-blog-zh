<html>
<head>
<title>Laravel-Excel — P5: Importing Sheets with Formulas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel-Excel — P5:导入带有公式的工作表</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-excel-p5-importing-sheets-with-formulas-4016dcc68862?source=collection_archive---------3-----------------------#2022-10-05">https://blog.devgenius.io/laravel-excel-p5-importing-sheets-with-formulas-4016dcc68862?source=collection_archive---------3-----------------------#2022-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/997d7b67706ed9a94a3a28263018e3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QrQxa8drCHkwtkPmZqOow.jpeg"/></div></div></figure><p id="101f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于导入 excel 表格，最后要注意的一点是，公式的行为通常不符合您的预期。如果您开始收到错误，请查看 excel 表格本身，并找出其中是否隐藏了任何公式。</p><div class="kw kx gp gr ky kz"><a href="https://dinocajic.medium.com/laravel-excel-p4-importing-multiple-sheets-conditional-loading-d70db3ae1409" rel="noopener follow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">laravel-Excel-P4:导入多张工作表条件加载</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">使用 Laravel Excel 可以解决多个工作表导入的一些问题。如果创作者改变了…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">dinocajic.medium.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><p id="e54e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看一个例子，其中一个公式引用了正在导入的工作表中的数据。</p><h1 id="1a22" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">进口单上的公式</h1><p id="9c29" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们将看到的 excel 表格包含以下几列</p><ul class=""><li id="9ccc" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated"><code class="fe na nb nc nd b">first_name</code></li><li id="a10f" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">last_name</code></li><li id="d289" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">email</code></li><li id="3362" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">password</code></li><li id="b3fa" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">full_name</code></li></ul><p id="ae96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">前四列包含静态数据，但最后一列由第一列和第二列组合生成:<code class="fe na nb nc nd b">=A2&amp;” “&amp;B2</code>。</p><p id="7c28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们创建一个导入，看看这是什么样子。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0dbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的<code class="fe na nb nc nd b">User</code>模型需要一个名称，我们将用它来传递我们的<code class="fe na nb nc nd b">full_name</code>公式字段，而不是<code class="fe na nb nc nd b">$row['first_name'] . " " . $row['last_name']</code>。</p><p id="561e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要在我们的<code class="fe na nb nc nd b">UserController</code>中添加一个方法，并创建一个能够调用这个导入程序的路由。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="163e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您查看您的<code class="fe na nb nc nd b">users</code>表，您会看到类似这样的内容</p><pre class="nj nk nl nm gt np nd nq nr aw ns bi"><span id="6d18" class="nt lp iq nd b gy nu nv l nw nx">{<br/>    "id":1,<br/>    "name":"=A2&amp;\"\"&amp;B2",<br/>    "email":"pspinnace0@nsw.gov.au",<br/>    "email_verified_at":null,<br/>    "created_at":"2022-10-05T23:17:08.000000Z",<br/>    "updated_at":"2022-10-05T23:17:08.000000Z"<br/>}</span></pre><p id="e71a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该名称包含公式，而不是实际名称。那我们怎么解决呢？与<code class="fe na nb nc nd b">WithCalculatedFormulas</code>有关。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2193" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次运行代码，您应该会得到想要的结果。</p><pre class="nj nk nl nm gt np nd nq nr aw ns bi"><span id="2dac" class="nt lp iq nd b gy nu nv l nw nx">{<br/>    "id":1,<br/>    "name":"Frank Jackson",<br/>    "email":"pspinnace0@nsw.gov.au",<br/>    "email_verified_at":null,<br/>    "created_at":"2022-10-05T23:22:03.000000Z",<br/>    "updated_at":"2022-10-05T23:22:03.000000Z"<br/>}</span></pre><p id="7c8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您导入多个工作表，而公式来自另一个工作表时，会发生什么情况？让我们看看我们是否能让它工作。</p><h1 id="bc47" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">另一张纸上的公式</h1><p id="fc73" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">对于这个例子，我们将有一个包含两个工作表的 excel 文档。它们都有相同的标题:</p><ul class=""><li id="6113" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated"><code class="fe na nb nc nd b">first_name</code></li><li id="5e3e" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">last_name</code></li><li id="1022" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">email</code></li><li id="ec40" class="mr ms iq ka b kb ne kf nf kj ng kn nh kr ni kv mw mx my mz bi translated"><code class="fe na nb nc nd b">password</code></li></ul><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/26b4bf87ee1571b40e82fc0b2bcfa7e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*5bzlTpCdsXvJwk0qS3vboA.png"/></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">用户数据 1</figcaption></figure><p id="7634" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的第二个工作表<code class="fe na nb nc nd b">user_data_2</code>，将是<code class="fe na nb nc nd b">user_data_1</code>的一个副本，但是将为所有电子邮件添加一个+1，使它们变得独一无二。即<code class="fe na nb nc nd b">dino@gmail.com</code>现在将是<code class="fe na nb nc nd b">dino+1@gmail.com</code>。我们将在<code class="fe na nb nc nd b">user_data_2</code>的 Excel 文档中使用的公式是<code class="fe na nb nc nd b">=SUBSTITUTE(user_data_1!C3, “@”, “+1@”)</code>。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/f6553a14a3242426c4c42a70ee99f39d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*VMAmbyk3kXS2u-3QOn4b2g.png"/></div></figure><p id="9fdb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="oe">我为什么选择这个公式？因为我不想创建另一个表，这似乎是用我们已经定义的 users 表来说明导入的最快方法。继续前进。</em></p><p id="a33b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要首先创建我们的多表导入器，它可以导入每一张表。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="18b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们来看看<code class="fe na nb nc nd b">FirstSheetWithNoFormulaImporter</code>长什么样。记住，这个导入器将导入<code class="fe na nb nc nd b">user_data_1</code>，它不包含任何公式。然而，其他工作表引用了它，所以我们需要添加一个<code class="fe na nb nc nd b">HasReferencesToOtherSheets</code>关注点来明确地向 Laravel Excel 声明其他工作表将引用它。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="24d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的第二个进口商，<code class="fe na nb nc nd b">SecondSheetWithFormulaImporter</code>，在<code class="fe na nb nc nd b">user_data_2</code>有一个新的 email 字段的公式。我们只需要实现<code class="fe na nb nc nd b">WithCalculatedFormulas</code>关注点，Laravel Excel 将知道如何处理其余的。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="f2fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剩下的就是在我们的<code class="fe na nb nc nd b">UserController</code>和路线中创建我们的方法，然后我们就可以准备测试了。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="5693" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到的结果是:</p><pre class="nj nk nl nm gt np nd nq nr aw ns bi"><span id="497c" class="nt lp iq nd b gy nu nv l nw nx">{<br/>    "id":39,<br/>    "name":"Frank Jackson",<br/>    "email":"pspinnace0@nsw.gov.au",<br/>    "email_verified_at":null,<br/>    "created_at":"2022-10-05T23:52:27.000000Z",<br/>    "updated_at":"2022-10-05T23:52:27.000000Z"<br/>},</span><span id="21c3" class="nt lp iq nd b gy of nv l nw nx">...,</span><span id="6a27" class="nt lp iq nd b gy of nv l nw nx">{<br/>    "id":58,<br/>    "name":"Frank Jackson",<br/>    "email":"pspinnace0+1@nsw.gov.au",<br/>    "email_verified_at":null,<br/>    "created_at":"2022-10-05T23:52:28.000000Z",<br/>    "updated_at":"2022-10-05T23:52:28.000000Z"<br/>},</span><span id="4e9f" class="nt lp iq nd b gy of nv l nw nx">...</span></pre><p id="9d8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们期待的结果！如果我们忘记实现<code class="fe na nb nc nd b">HasReferenceToOtherSheets</code>关注点怎么办？嗯，它坏了。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/c052481687f3c10215c8a7eab80392e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nHkIhlnvKYVECl5owvyBZQ.png"/></div></div></figure><p id="b2d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，我们知道为了避免这个问题我们必须实现什么。</p><p id="533e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想我已经正式结束了对多工作表工作簿中各种不同情况的讨论。让我们在下一篇文章中继续讨论 Laravel Excel 中其他一些令人兴奋的特性。</p></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/85b0f60aaeae7be8e7b87fdcd3f8671f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0Qbz22xd5r76szL6.jpeg"/></div></figure><p id="4a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡希奇目前是<a class="ae op" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae op" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae op" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae op" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物科技</a>、<a class="ae op" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae op" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank">艾阿尔法</a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="13da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae op" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae op" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae op" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="7163" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读迪诺·卡吉克(以及媒体上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。T9】</p></div></div>    
</body>
</html>