<html>
<head>
<title>How storage works in Prometheus, and why is this important?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">存储在Prometheus中是如何工作的，为什么这很重要？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-storage-works-in-prometheus-and-why-is-this-important-1882c340fee2?source=collection_archive---------1-----------------------#2020-11-15">https://blog.devgenius.io/how-storage-works-in-prometheus-and-why-is-this-important-1882c340fee2?source=collection_archive---------1-----------------------#2020-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7ef5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解Prometheus的基础，它是监控您的工作负载的绝佳解决方案，并将其用于您自己的利益。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b1edb79b7fcdcd444e983cfc7220dba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fO0vWWfMAgqrMkTe"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">文森特·博塔在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6733" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Prometheus是当今云架构中的关键系统之一。这是继Kubernetes之后，云计算原生计算基金会(CNCF)的第二个毕业项目，它是在Kubernetes上运行的大多数工作负载的卓越监控解决方案。</p><p id="96cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您已经使用过Prometheus一段时间，您会知道它依赖于时间序列数据库，并且它是关键元素之一。根据普罗米修斯官方网页上他们自己的话:</p><div class="ls lt gp gr lu lv"><a href="https://prometheus.io/docs/prometheus/latest/storage/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">储存；储备</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">Prometheus包括一个本地磁盘时间序列数据库，但也可以选择与远程存储系统集成…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">普罗米修斯</p></div></div></div></a></div><p id="4ccc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个时间序列都由其度量名称和可选的键-值对(称为标签)唯一标识，该序列类似于关系模型中的表。在每个系列中，我们都有与元组相似的样本。每个样本都包含一个浮点值和一个毫秒精度的时间戳。</p><h2 id="bc61" class="me mf iq bd mg mh mi dn mj mk ml dp mm lf mn mo mp lj mq mr ms ln mt mu mv mw bi translated">默认磁盘方法</h2><p id="8882" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">默认情况下，Prometheus使用本地存储方法将所有这些样本存储在磁盘上。这些数据分布在不同的文件和文件夹中，对不同的数据块进行分组。</p><p id="21fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们用文件夹来创建这些组，默认情况下，它们是一个两小时的块，可以包含一个或多个文件，具体取决于该时间段内接收的数据量，因为每个文件夹都包含该特定时间线的所有样本。</p><p id="1d61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，每个文件夹还有某种元数据文件，帮助定位每个数据文件的指标。</p><p id="4a37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当块结束时，文件以完整的方式保持持久，在此之前，它保留在内存中，并使用预写日志技术来恢复数据，以防Prometheus服务器崩溃。</p><p id="135b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，从高层次来看，Prometheus服务器的数据目录的目录结构如下所示:</p><h2 id="12d7" class="me mf iq bd mg mh mi dn mj mk ml dp mm lf mn mo mp lj mq mr ms ln mt mu mv mw bi translated">远程存储集成</h2><p id="2c26" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">默认的磁盘存储很好，但在可伸缩性和耐用性方面有一些限制，即使考虑到最新版本的TSDB的性能改进。因此，如果我们想探索存储这些数据的其他选项，Prometheus提供了一种与远程存储位置集成的方法。</p><p id="6b96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它提供了一个API，允许将获取的样本写入远程URL，同时能够读回该远程URL的样本数据，如下图所示:</p><p id="aa3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与任何与Prometheus相关的东西一样，使用这种模式创建的适配器数量是巨大的，这可以在下面的详细链接中看到:</p><div class="ls lt gp gr lu lv"><a href="https://prometheus.io/docs/operating/integrations/#remote-endpoints-and-storage" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">集成</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">除了客户端库和导出器以及相关的库，还有许多其他的通用集成…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">普罗米修斯</p></div></div></div></a></div><h2 id="fe0f" class="me mf iq bd mg mh mi dn mj mk ml dp mm lf mn mo mp lj mq mr ms ln mt mu mv mw bi translated">摘要</h2><p id="3ad1" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">了解Prometheus的存储工作原理对于了解我们如何优化其使用以提高监控解决方案的性能并提供经济高效的部署至关重要。</p><p id="50fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在以下帖子中，我们将介绍如何优化该存储层的使用，确保只存储重要的指标和样本，以及如何分析哪些指标使用了大部分时间序列数据库，以便能够做出正确的决策，决定哪些指标应该丢弃，哪些应该保留。</p><p id="5c2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，请继续关注下一篇文章，关于我们如何能和普罗米修斯一起过上更好的生活，而不是在尝试中死去。</p></div></div>    
</body>
</html>