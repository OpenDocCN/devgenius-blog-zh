<html>
<head>
<title>Microservices [Part 2] — With Maven, Spring Boot, And Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务[第二部分] —与 Maven、Spring Boot 和 Docker 合作</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/microservices-part-2-with-maven-spring-boot-and-docker-a9e9745180bd?source=collection_archive---------3-----------------------#2022-02-23">https://blog.devgenius.io/microservices-part-2-with-maven-spring-boot-and-docker-a9e9745180bd?source=collection_archive---------3-----------------------#2022-02-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/7d28453c96c682b5e01e1eb9f92a2467.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*RBGu9dLC3gZU7KqWgK91uQ.gif"/></div></figure><p id="7da2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">使用<strong class="jt io"> <em class="kp"> Maven、Spring Boot 和 Docker </em> </strong>构建微服务的系列课程仍在进行中。你可以在第一篇博客<a class="ae kq" href="https://medium.com/dev-genius/microservices-part-1-with-maven-spring-boot-and-docker-4888a6bd05b5" rel="noopener"> <strong class="jt io"> <em class="kp">这里</em> </strong> </a>中看到一个关于设置 Maven 项目和创建一个非常简单的微服务<strong class="jt io"> <em class="kp">学生</em> </strong>的分步教程，这个微服务连接到一个运行在 Docker 容器中的 PostgreSQL 数据库。</p><p id="92f4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们在这部分建立第二个名为<strong class="jt io"> <em class="kp">抄袭</em> </strong>的微服务。它将与学生微服务进行交流，并验证学生是否抄袭。</p><p id="d640" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">到<strong class="jt io"> <em class="kp">源代码库</em> </strong>的链接将在本教程的末尾添加。</p><h2 id="0062" class="kr ks in bd kt ku kv dn kw kx ky dp kz kc la lb lc kg ld le lf kk lg lh li lj bi translated">抄袭微服务</h2><p id="8058" class="pw-post-body-paragraph jr js in jt b ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko ig bi translated">让我们首先为<code class="fe lp lq lr ls b"><strong class="jt io">Plagiarism</strong></code>创建一个新模块，这将是一个<strong class="jt io"> <em class="kp"> Maven 项目</em> </strong>:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lt"><img src="../Images/151f874ea2f060ff1e7121747f2c2607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HaC5aOKo-G943r8l7y7e-Q.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">抄袭微服务的新模块</figcaption></figure><p id="9f62" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，在<code class="fe lp lq lr ls b"><strong class="jt io">pom.xml</strong></code>文件的<strong class="jt io"> <em class="kp">依赖项段</em> </strong>中添加<code class="fe lp lq lr ls b"><strong class="jt io">Spring Boot Starter Web</strong></code>:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="a9ac" class="kr ks in ls b gy mk ml l mm mn">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="0127" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可能已经注意到，我们的新微服务已经被配置为引用其父服务— <code class="fe lp lq lr ls b"><strong class="jt io">anitaservices</strong></code>:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mo"><img src="../Images/8b3809a16937c6478717864867cef136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7fXnNitkXZwt9-Z_pPyFQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">抄袭微服务的 pom.xml 中的父节</figcaption></figure><p id="cd38" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们还可以导航到父文件的<code class="fe lp lq lr ls b"><strong class="jt io">pom.xml</strong></code>中，看到新的抄袭模块也被添加到<strong class="jt io"> <em class="kp">模块部分</em> </strong>中:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mp"><img src="../Images/d011c6ebce7358ab8c6778cfda0c3500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qqQeHhXmTvtIKUxiQpSSg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">父项目的 pom.xml 中的 Modules 部分</figcaption></figure><p id="cace" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在<code class="fe lp lq lr ls b"><strong class="jt io">src/main/java</strong></code>文件夹中创建一个名为<code class="fe lp lq lr ls b"><strong class="jt io">com.anita.plagiarism</strong></code>的新包，并在那里添加主类<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismApplication</strong></code>:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="52cf" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">org.springframework.boot.SpringApplication</em>;<br/>import <em class="kp">org.springframework.boot.autoconfigure.SpringBootApplication</em>;<br/><br/><em class="kp">@SpringBootApplication<br/></em>public class <em class="kp">PlagiarismApplication </em>{<br/><br/>    public static void main(<em class="kp">String</em>[] <em class="kp">args</em>) {<br/>        <em class="kp">SpringApplication</em>.<em class="kp">run</em>(<em class="kp">PlagiarismApplication</em>.class, <em class="kp">args</em>);<br/>    }<br/><br/>}</span></pre><p id="fbca" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在<code class="fe lp lq lr ls b"><strong class="jt io">resources</strong></code>文件夹中为抄袭模块创建一个<code class="fe lp lq lr ls b"><strong class="jt io">application.yml</strong></code>文件，并粘贴以下关于<em class="kp">应用程序名称</em>和<em class="kp">服务器端口的信息(w </em> e 正在指定一个不同的端口而不是默认端口，因为我们不希望两个应用程序同时运行时在同一个端口上启动):</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="a476" class="kr ks in ls b gy mk ml l mm mn">server:<br/>  port: 8081<br/><br/>spring:<br/>  application:<br/>    name: plagiarism</span></pre><p id="638e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果你愿意，你也可以添加一个自定义的<code class="fe lp lq lr ls b"><strong class="jt io">banner.txt</strong></code>文件。</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mq"><img src="../Images/e54ab940229534de6782722f18de4208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*296FzQj18V7IKxVE7kYo_g.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">自定义横幅. txt 文件</figcaption></figure><p id="384e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">之后，启动两个应用程序，以确保一切顺利运行。此外，不要忘记启动 Docker 容器，以便学生微服务可以毫无问题地连接到数据库。</p><p id="835e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">接下来，我们为抄袭微服务添加一个数据库。</p><h2 id="797c" class="kr ks in bd kt ku kv dn kw kx ky dp kz kc la lb lc kg ld le lf kk lg lh li lj bi translated">数据库设置</h2><p id="de09" class="pw-post-body-paragraph jr js in jt b ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko ig bi translated">在典型的<strong class="jt io"><em class="kp"/></strong>微服务架构中，您通常希望每个微服务 有一个<strong class="jt io"> <em class="kp">数据库。但是，出于本教程的目的，我们只使用同一个数据库实例，并在其中添加一个数据库:</em></strong></p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mr"><img src="../Images/4c703e5b30ddd5eef19d88231da525a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVtGsx8_0uDSv5i5djGkAA.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">创建一个新的数据库——剽窃</figcaption></figure><p id="c7ff" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">将以下<strong class="jt io"> <em class="kp">数据源配置</em> </strong>添加到<code class="fe lp lq lr ls b"><strong class="jt io">application.yml</strong></code>文件中:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="753b" class="kr ks in ls b gy mk ml l mm mn">server:<br/>  port: 8081<br/><br/>spring:<br/>  application:<br/>    name: plagiarism<br/>  datasource:<br/>    username: 'postgres'<br/>    url: jdbc:postgresql://localhost:5432/plagiarism<br/>    password: 'postgres'<br/>  jpa:<br/>    properties:<br/>      hibernate:<br/>        dialect: org.hibernate.dialect.PostgreSQLDialect<br/>        format_sql: 'true'<br/>    hibernate:<br/>      ddl-auto: update<br/>    show-sql: 'true'</span></pre><p id="0d8a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">打开剽窃申请的<code class="fe lp lq lr ls b"><strong class="jt io">pom.xml</strong></code>文件，添加<code class="fe lp lq lr ls b"><strong class="jt io">spring boot data JPA</strong></code>和<code class="fe lp lq lr ls b"><strong class="jt io">PostgreSQL</strong></code>依赖项。</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="e6c9" class="kr ks in ls b gy mk ml l mm mn">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>    &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>    &lt;scope&gt;runtime&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="e0ba" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在我们的主包中添加一个新的 Java 类<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismCheckHistory</strong></code>:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="bf0e" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">lombok.AllArgsConstructor</em>;<br/>import <em class="kp">lombok.Builder</em>;<br/>import <em class="kp">lombok.Data</em>;<br/>import <em class="kp">lombok.NoArgsConstructor</em>;<br/><br/>import <em class="kp">javax.persistence.</em>*;<br/>import <em class="kp">java.time.LocalDateTime</em>;<br/><br/><em class="kp">@Data<br/>@Builder<br/>@AllArgsConstructor<br/>@NoArgsConstructor<br/>@Entity<br/></em>public class <em class="kp">PlagiarismCheckHistory </em>{<br/>    <em class="kp">@Id<br/>    @SequenceGenerator</em>(<br/>            name = "plagiarism_id_sequence",<br/>            sequenceName = "plagiarism_id_sequence"<br/>    )<br/>    <em class="kp">@GeneratedValue</em>(<br/>            strategy = <em class="kp">GenerationType</em>.SEQUENCE,<br/>            generator = "plagiarism_id_sequence"<br/>    )<br/>    private <em class="kp">Long </em>id;<br/>    private <em class="kp">Long </em>studentId;<br/>    private <em class="kp">Boolean </em>isPlagiarist;<br/>    private <em class="kp">LocalDateTime </em>createdAt;<br/>}</span></pre><p id="6743" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">重启抄袭微服务，确保一切正常。您也可以在<code class="fe lp lq lr ls b"><strong class="jt io">port 5050</strong></code>上查看<code class="fe lp lq lr ls b"><strong class="jt io">pgadmin</strong></code>中的顺序和表格:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ms"><img src="../Images/39c23130ffd69905fdfdd0102641d22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9s7z0TMNbNe39raNBNrheg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">最近创建的序列和剽窃数据库中的一个表</figcaption></figure><p id="9892" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在此之后，让我们继续构建控制器、服务和存储库。</p><h2 id="0a94" class="kr ks in bd kt ku kv dn kw kx ky dp kz kc la lb lc kg ld le lf kk lg lh li lj bi translated">控制器、服务和存储库</h2><p id="0302" class="pw-post-body-paragraph jr js in jt b ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko ig bi translated">首先，创建一个<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismCheckHistoryRepository</strong></code>:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="3b1b" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">org.springframework.data.jpa.repository.JpaRepository</em>;<br/><br/>public interface <em class="kp">PlagiarismCheckHistoryRepository </em>extends <em class="kp">JpaRepository</em>&lt;<em class="kp">PlagiarismCheckHistory</em>, <em class="kp">Long</em>&gt; {<br/>}</span></pre><p id="0a55" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后，创建一个<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismCheckService </strong></code>，此时它将始终返回 false，但这肯定会根据实际的业务逻辑而改变:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="2b50" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">lombok.AllArgsConstructor</em>;<br/>import <em class="kp">org.springframework.stereotype.Service</em>;<br/><br/>import <em class="kp">java.time.LocalDateTime</em>;<br/><br/><em class="kp">@Service<br/>@AllArgsConstructor<br/></em>public class <em class="kp">PlagiarismCheckService </em>{<br/>    private final <em class="kp">PlagiarismCheckHistoryRepository </em>plagiarismCheckHistoryRepository;<br/>    <br/>    public boolean isPlagiaristStudent(<em class="kp">Long studentId</em>) {<br/>        plagiarismCheckHistoryRepository.save(<br/>                <em class="kp">PlagiarismCheckHistory</em>.<em class="kp">builder</em>()<br/>                        .studentId(<em class="kp">studentId</em>)<br/>                        .isPlagiarist(false)<br/>                        .createdAt(<em class="kp">LocalDateTime</em>.<em class="kp">now</em>()).build()<br/>        );<br/>        return false;<br/>    }<br/>}</span></pre><p id="9ae2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">创建一个<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismCheckResponse</strong></code>类。我们目前只包括一个布尔值，但您可以在将来添加任何想要的信息:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="d2de" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">lombok.AllArgsConstructor</em>;<br/>import <em class="kp">lombok.Getter</em>;<br/>import <em class="kp">lombok.NoArgsConstructor</em>;<br/>import <em class="kp">lombok.Setter</em>;<br/><br/><em class="kp">@Getter<br/>@Setter<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/></em>public class <em class="kp">PlagiarismCheckResponse </em>{<br/>    private <em class="kp">Boolean </em>isPlagiarist;<br/>}</span></pre><p id="88ec" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后，创建一个简单的<code class="fe lp lq lr ls b"><strong class="jt io">PlagiarismController</strong></code>,其方法将返回学生是否抄袭的信息:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="5512" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.plagiarism</em>;<br/><br/>import <em class="kp">lombok.AllArgsConstructor</em>;<br/>import <em class="kp">lombok.extern.slf4j.Slf4j</em>;<br/>import <em class="kp">org.springframework.web.bind.annotation.GetMapping</em>;<br/>import <em class="kp">org.springframework.web.bind.annotation.PathVariable</em>;<br/>import <em class="kp">org.springframework.web.bind.annotation.RequestMapping</em>;<br/>import <em class="kp">org.springframework.web.bind.annotation.RestController</em>;<br/><br/><em class="kp">@RestController<br/>@RequestMapping</em>("api/v1/plagiarism-check")<br/><em class="kp">@AllArgsConstructor<br/>@Slf4j<br/></em>public class <em class="kp">PlagiarismController </em>{<br/><br/>    private final <em class="kp">PlagiarismCheckService </em>plagiarismCheckService;<br/><br/>    <em class="kp">@GetMapping</em>(path = "{studentId}")<br/>    public <em class="kp">PlagiarismCheckResponse </em>isPlagiarist(<em class="kp">@PathVariable</em>("studentId") <em class="kp">Long studentId</em>) {<br/>        boolean isPlagiaristStudent = plagiarismCheckService.isPlagiaristStudent(<em class="kp">studentId</em>);<br/>        log.info("Plagiarism check request for student {}", <em class="kp">studentId</em>);<br/>        return new PlagiarismCheckResponse(isPlagiaristStudent);<br/>    }<br/>    <br/>}</span></pre><p id="9de8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">配置完这些部分后，我们现在可以继续看微服务 之间的<strong class="jt io"> <em class="kp">通信是如何工作的。</em></strong></p><h2 id="0531" class="kr ks in bd kt ku kv dn kw kx ky dp kz kc la lb lc kg ld le lf kk lg lh li lj bi translated">通过 RestTemplate 通信</h2><p id="f4ae" class="pw-post-body-paragraph jr js in jt b ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko ig bi translated">微服务之间的通信可以通过多种方式实现。让我们在本教程中讨论一下<code class="fe lp lq lr ls b"><strong class="jt io">RestTemplate</strong></code>解决方案，把<code class="fe lp lq lr ls b"><strong class="jt io">Service Discovery</strong></code>配置留给下一个。</p><p id="0b40" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">一个学生微服务现在运行在<code class="fe lp lq lr ls b"><strong class="jt io">port 8080</strong></code>上，一个抄袭微服务现在运行在<code class="fe lp lq lr ls b"><strong class="jt io">port 8081</strong></code>上。我们希望学生提交一份抄袭请求，以确定某个已注册的学生是否是抄袭者。</p><p id="d222" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">打开<code class="fe lp lq lr ls b"><strong class="jt io">StudentService</strong></code>类，在<code class="fe lp lq lr ls b"><strong class="jt io">register</strong></code>方法中修改我们在上一部分留下的 todos:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="f3a8" class="kr ks in ls b gy mk ml l mm mn"><em class="kp">@Service<br/></em>public record <em class="kp">StudentService</em>(<em class="kp">StudentRepository </em>studentRepository) {<br/>    public void registerStudent(<em class="kp">StudentRegistrationRequest request</em>) {<br/>        <em class="kp">Student </em>student = <em class="kp">Student</em>.<em class="kp">builder</em>()<br/>                .firstName(<em class="kp">request</em>.firstName())<br/>                .lastName(<em class="kp">request</em>.lastName())<br/>                .email(<em class="kp">request</em>.email())<br/>                .build();<br/><br/>        <em class="kp">// TODO: Validate Request<br/>        // TODO: Check if plagiarist<br/>        </em>studentRepository.save(student);<br/>        <em class="kp">// TODO: Send notification<br/>    </em>}<br/>}</span></pre><p id="d71b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">然后创建一个新的<code class="fe lp lq lr ls b"><strong class="jt io">StudentConfig</strong></code>类来返回一个 rest 模板:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="3341" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.student</em>;<br/><br/>import <em class="kp">org.springframework.context.annotation.Bean</em>;<br/>import <em class="kp">org.springframework.context.annotation.Configuration</em>;<br/>import <em class="kp">org.springframework.web.client.RestTemplate</em>;<br/><br/><em class="kp">@Configuration<br/></em>public class <em class="kp">StudentConfig </em>{<br/><br/>    <em class="kp">@Bean<br/>    </em>public <em class="kp">RestTemplate </em>restTemplate() {<br/>        return new RestTemplate();<br/>    }<br/><br/>}</span></pre><p id="0d3c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">将这个配置注入我们的<code class="fe lp lq lr ls b"><strong class="jt io">StudentService</strong></code>:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="525f" class="kr ks in ls b gy mk ml l mm mn">package <em class="kp">com.anita.student</em>;<br/><br/>import <em class="kp">org.springframework.stereotype.Service</em>;<br/>import <em class="kp">org.springframework.web.client.RestTemplate</em>;<br/><br/><em class="kp">@Service<br/></em>public record <em class="kp">StudentService</em>(<em class="kp">StudentRepository </em>studentRepository, <em class="kp">RestTemplate </em>restTemplate) {<br/>    public void registerStudent(<em class="kp">StudentRegistrationRequest request</em>) {<br/>        <em class="kp">Student </em>student = <em class="kp">Student</em>.<em class="kp">builder</em>()<br/>                .firstName(<em class="kp">request</em>.firstName())<br/>                .lastName(<em class="kp">request</em>.lastName())<br/>                .email(<em class="kp">request</em>.email())<br/>                .build();</span><span id="52c9" class="kr ks in ls b gy mt ml l mm mn">        <em class="kp">// TODO: Validate Request<br/>        // TODO: Check if plagiarist<br/>        </em>studentRepository.save(student);<br/>        <em class="kp">// TODO: Send notification<br/>    </em>}<br/>}</span></pre><p id="f15e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在这个类中，我使用了 Java 的新特性— <code class="fe lp lq lr ls b"><strong class="jt io">record</strong></code>，这是一种声明类型的方式。如果你有兴趣的话，你可以在这里  详细阅读这个以及所有其他添加到 Java 12 到 Java 17 <a class="ae kq" href="https://medium.com/p/7e1152f86829" rel="noopener"> <strong class="jt io"> <em class="kp">最新版本中的很酷的特性。</em></strong></a></p><p id="feb3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">要查看一个学生是否抄袭，我们需要他或她的 ID，只有当这个学生被保存到数据库中时才可以使用。因此，我们将使用<code class="fe lp lq lr ls b"><strong class="jt io"> saveAndFlush</strong></code>在过程结束前捕捉 ID:</p><pre class="lu lv lw lx gt mg ls mh mi aw mj bi"><span id="3d3f" class="kr ks in ls b gy mk ml l mm mn">public void registerStudent(<em class="kp">StudentRegistrationRequest request</em>) {<br/>    <em class="kp">Student </em>student = <em class="kp">Student</em>.<em class="kp">builder</em>()<br/>            .firstName(<em class="kp">request</em>.firstName())<br/>            .lastName(<em class="kp">request</em>.lastName())<br/>            .email(<em class="kp">request</em>.email())<br/>            .build();<br/><br/>    <em class="kp">// TODO: Validate Request<br/>    </em>studentRepository.saveAndFlush(student);<br/>    <em class="kp">PlagiarismCheckResponse </em>plagiarismCheckResponse = restTemplate.getForObject(<br/>            "http://localhost:8081/api/v1/plagiarism-check/{studentId}",<br/>            <em class="kp">PlagiarismCheckResponse</em>.class,<br/>            student.getId()<br/>    );<br/>    if (plagiarismCheckResponse.isPlagiarist()) {<br/>        throw new IllegalStateException("Student is a plagiarist!");<br/>    }<br/>    <em class="kp">// TODO: send notification<br/></em>}</span></pre><h2 id="8d70" class="kr ks in bd kt ku kv dn kw kx ky dp kz kc la lb lc kg ld le lf kk lg lh li lj bi translated">测试微服务之间的 HTTP 通信</h2><p id="359d" class="pw-post-body-paragraph jr js in jt b ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko ig bi translated">测试我们的应用程序的时候到了！</p><p id="7700" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">重启两个微服务，打开<code class="fe lp lq lr ls b"><strong class="jt io">Postman</strong></code>向学生微服务发送请求。您将收到一个<code class="fe lp lq lr ls b"><strong class="jt io">200 status code</strong></code>:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mu"><img src="../Images/d5ba4cd0e4d4afacc95f7b62d963b2cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bbx9ZgG-zcF1g13C8Gpeg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">测试来自邮递员的更改</figcaption></figure><p id="00b0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">打开<code class="fe lp lq lr ls b"><strong class="jt io">pgadmin</strong></code>并检查数据库:</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mv"><img src="../Images/c88acc6876f6ecca86c1cdcbc24554e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVSdvfJWDTFmKr_QQmx2mg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">学生数据库</figcaption></figure><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/28322be0d906425e785584f89bfecdf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*s_1cIVYckeBN0q0wRsPOjw.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">抄袭数据库</figcaption></figure><p id="c5b4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">就是这个！我们已经成功地修改了项目，添加了新的微服务，并实施了必要的逻辑来建立应用程序之间的通信。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><p id="5f1e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果你错过了什么，所有代码都可以在我的<a class="ae kq" href="https://github.com/anitalakhadze/microservices_practice" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> <em class="kp"> GitHub 资源库</em> </strong> </a>上找到。</p><p id="6d5f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><code class="fe lp lq lr ls b"><strong class="jt io">RestTemplate</strong></code>对于本教程来说可能是一个很好的解决方案，但是，当我们有几个应用程序实例正在运行，微服务必须知道每个实例的网络信息才能连接时，它就不适合这些情况。</p><p id="50b5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将不再处理端口，而是用<code class="fe lp lq lr ls b"><strong class="jt io">Eurika Server</strong></code>集中处理，让它负责微服务之间的请求负载平衡。<strong class="jt io"> <em class="kp">所以，敬请期待，不要错过！</em>T5】</strong></p><p id="3b6c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">此外，请在下面评论您希望在以下博客中看到的内容。</p><p id="1799" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> <em class="kp">快乐编码！</em>T9】</strong></p></div></div>    
</body>
</html>