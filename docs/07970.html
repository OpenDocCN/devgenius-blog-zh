<html>
<head>
<title>K8s — Ingress Demo in AWS EKS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">k8s—AWS EKS 站的入口演示</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/k8s-ingress-demo-in-aws-eks-2be7d6d8ea95?source=collection_archive---------4-----------------------#2022-05-07">https://blog.devgenius.io/k8s-ingress-demo-in-aws-eks-2be7d6d8ea95?source=collection_archive---------4-----------------------#2022-05-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="126a" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">日常一点 K8s 知识！</h2></div><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div class="ab gv cl kl"><img src="../Images/5afd26f4d0a23bb84aa46027b56a15e5.png" data-original-src="https://miro.medium.com/v2/format:webp/0*QHYRbqYwP63UIqIn.png"/></div></figure><p id="6e39" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">在我的上一篇文章中我谈到了 K8s <code class="fe lk ll lm ln b">Ingress Resource</code>、<code class="fe lk ll lm ln b">Ingress Class</code>和<code class="fe lk ll lm ln b">Ingress Controller</code>概念(<a class="ae lo" href="https://tonylixu.medium.com/k8s-ingress-ingress-class-and-controller-b278396e94d9" rel="noopener">https://tonylixu . medium . com/K8s-ingress-ingress-class-and-controller-b 278396 e 94d 9</a>)，让我们在本文中做一些实践。</p><h1 id="d8a6" class="lp lq ir bd lr ls lt lu lv lw lx ly lz jx ma jy mb ka mc kb md kd me ke mf mg bi translated">安装 Nginx 入口</h1><p id="30cc" class="pw-post-body-paragraph ko kp ir kq b kr mh js kt ku mi jv kw kx mj kz la lb mk ld le lf ml lh li lj ik bi translated">要安装 Nginx 入口控制器:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="4275" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.0/deploy/static/provider/cloud/deploy.yaml</span></pre><p id="c4b8" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">输出将类似于:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="1ea7" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl apply -f <a class="ae lo" href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.0/deploy/static/provider/cloud/deploy.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.0/deploy/static/provider/cloud/deploy.yaml</a><br/>namespace/ingress-nginx created<br/>serviceaccount/ingress-nginx created<br/>serviceaccount/ingress-nginx-admission created<br/>role.rbac.authorization.k8s.io/ingress-nginx created<br/>role.rbac.authorization.k8s.io/ingress-nginx-admission created<br/>clusterrole.rbac.authorization.k8s.io/ingress-nginx created<br/>clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created<br/>rolebinding.rbac.authorization.k8s.io/ingress-nginx created<br/>rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created<br/>clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created<br/>clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created<br/>configmap/ingress-nginx-controller created<br/>service/ingress-nginx-controller created<br/>service/ingress-nginx-controller-admission created<br/>deployment.apps/ingress-nginx-controller created<br/>job.batch/ingress-nginx-admission-create created<br/>job.batch/ingress-nginx-admission-patch created<br/>ingressclass.networking.k8s.io/nginx created<br/>validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span></pre><p id="df3a" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">让我们检查 Nginx <code class="fe lk ll lm ln b">Ingress Controller</code>的状态</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="e55b" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl get po -n ingress-nginx<br/>NAME                                        READY   STATUS      RESTARTS   AGE<br/>ingress-nginx-admission-create-5mmd6        0/1     Completed   0          5m29s<br/>ingress-nginx-admission-patch-fk7zs         0/1     Completed   0          5m29s<br/>ingress-nginx-controller-5849c9f946-qrxpv   1/1     Running     0          5m29s</span></pre><p id="7b57" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">和服务:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="8e21" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl get svc -n ingress-nginx<br/>NAME                                 TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE<br/>ingress-nginx-controller             LoadBalancer   10.100.234.130   xxxx.us-east-1.elb.amazonaws.com   80:31293/TCP,443:30989/TCP   6m26s<br/>ingress-nginx-controller-admission   ClusterIP      10.100.233.17    &lt;none&gt;                                                                    443/TCP                      6m26s</span></pre><p id="ffd0" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">和<code class="fe lk ll lm ln b">IngressClass</code>资源:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="eb9d" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl get ingressClass nginx -o yaml<br/>apiVersion: networking.k8s.io/v1<br/>kind: IngressClass<br/>metadata:<br/>  annotations:<br/>    kubectl.kubernetes.io/last-applied-configuration: |<br/>      {"apiVersion":"networking.k8s.io/v1","kind":"IngressClass","metadata":{"annotations":{},"labels":{"app.kubernetes.io/component":"controller","app.kubernetes.io/instance":"ingress-nginx","app.kubernetes.io/name":"ingress-nginx","app.kubernetes.io/part-of":"ingress-nginx","app.kubernetes.io/version":"1.2.0"},"name":"nginx"},"spec":{"controller":"k8s.io/ingress-nginx"}}<br/>  creationTimestamp: "2022-05-06T20:31:26Z"<br/>  generation: 1<br/>  labels:<br/>    app.kubernetes.io/component: controller<br/>    app.kubernetes.io/instance: ingress-nginx<br/>    app.kubernetes.io/name: ingress-nginx<br/>    app.kubernetes.io/part-of: ingress-nginx<br/>    app.kubernetes.io/version: 1.2.0<br/>  managedFields:<br/>  - apiVersion: networking.k8s.io/v1<br/>    fieldsType: FieldsV1<br/>    fieldsV1:<br/>      f:metadata:<br/>        f:annotations:<br/>          .: {}<br/>          f:kubectl.kubernetes.io/last-applied-configuration: {}<br/>        f:labels:<br/>          .: {}<br/>          f:app.kubernetes.io/component: {}<br/>          f:app.kubernetes.io/instance: {}<br/>          f:app.kubernetes.io/name: {}<br/>          f:app.kubernetes.io/part-of: {}<br/>          f:app.kubernetes.io/version: {}<br/>      f:spec:<br/>        f:controller: {}<br/>    manager: kubectl-client-side-apply<br/>    operation: Update<br/>    time: "2022-05-06T20:31:26Z"<br/>  name: nginx<br/>  resourceVersion: "2089"<br/>  uid: 2247255c-b36f-476e-b99d-1ebed234ecfd<br/>spec:<br/>  controller: k8s.io/ingress-nginx</span></pre><h1 id="2414" class="lp lq ir bd lr ls lt lu lv lw lx ly lz jx ma jy mb ka mc kb md kd me ke mf mg bi translated">安装 Pod 和服务</h1><p id="b75c" class="pw-post-body-paragraph ko kp ir kq b kr mh js kt ku mi jv kw kx mj kz la lb mk ld le lf ml lh li lj ik bi translated">现在让我们创建测试<code class="fe lk ll lm ln b">Pod</code>和<code class="fe lk ll lm ln b">Service</code>。定义以下 YAML:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="f58b" class="mq lq ir ln b gz mr ms l mt mu">---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: nginx-deploy<br/>  namespace: default<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: nginx-demo<br/>      release: canary<br/>  template:<br/>    metadata:<br/>      name: my-nginx<br/>      labels:<br/>        app: nginx-demo<br/>        release: canary<br/>    spec:<br/>      containers:<br/>      - name: my-nginx<br/>        image: nginx<br/>        imagePullPolicy: IfNotPresent<br/>        ports:<br/>        - name: http<br/>          containerPort: 80</span><span id="9cc0" class="mq lq ir ln b gz mv ms l mt mu">---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: nginx-svc<br/>  namespace: default<br/>spec:<br/>  selector:<br/>    app: nginx-demo<br/>    release: canary<br/>  ports:<br/>  - name: http<br/>    port: 80<br/>    targetPort: 80</span></pre><p id="41f8" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">让我们运行<code class="fe lk ll lm ln b">kubectl create -f nginx-demo.yml</code>:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="554e" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl create -f nginx-demo.yml<br/>deployment.apps/nginx-deploy created<br/>service/nginx-svc created</span></pre><p id="a41d" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">检查盒:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="17ba" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl get pod <br/>NAME                            READY   STATUS    RESTARTS   AGE nginx-deploy-549cb5c7ff-65fbb   1/1     Running   0          21s</span></pre><h1 id="cd92" class="lp lq ir bd lr ls lt lu lv lw lx ly lz jx ma jy mb ka mc kb md kd me ke mf mg bi translated">安装 Nginx 入口</h1><p id="872d" class="pw-post-body-paragraph ko kp ir kq b kr mh js kt ku mi jv kw kx mj kz la lb mk ld le lf ml lh li lj ik bi translated">现在我们来定义 Nginx <code class="fe lk ll lm ln b">Ingress</code>:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="707c" class="mq lq ir ln b gz mr ms l mt mu">apiVersion: networking.k8s.io/v1<br/>kind: Ingress<br/>metadata:<br/>  name: ingress-nginx<br/>  annotations:<br/>    nginx.ingress.kubernetes.io/rewrite-target: /<br/>spec:<br/>  ingressClassName: nginx<br/>  rules:<br/>  - host: <br/>    http:<br/>      paths:<br/>      - path: /test <br/>        pathType: Prefix<br/>        backend:<br/>          service:<br/>            name: nginx-svc<br/>            port:<br/>              number: 80</span></pre><p id="f05f" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">然后创建入口:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="01ef" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl create -f nginx-ingress.yml<br/>ingress.networking.k8s.io/ingress-nginx create</span></pre><p id="8c27" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">现在检查我们刚刚创建的入口的状态:</p><pre class="kg kh ki kj gu mm ln mn mo aw mp bi"><span id="a09d" class="mq lq ir ln b gz mr ms l mt mu">$ kubectl describe ingresses ingress-nginx<br/>Name:             ingress-nginx<br/>Namespace:        default<br/>Address:<br/>Default backend:  default-http-backend:80 (&lt;error: endpoints "default-http-backend" not found&gt;)<br/>Rules:<br/>  Host        Path  Backends<br/>  ----        ----  --------<br/>  *<br/>              /test   nginx-svc:80 (192.168.35.217:80)<br/>Annotations:  nginx.ingress.kubernetes.io/rewrite-target: /<br/>Events:<br/>  Type    Reason  Age   From                      Message<br/>  ----    ------  ----  ----                      -------<br/>  Normal  Sync    10s   nginx-ingress-controller  Scheduled for sync</span></pre><p id="8e98" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">最后，您可以访问我们在<code class="fe lk ll lm ln b">rules</code>(使用外部 IP)中定义的 Nginx HTTP(s)端点<code class="fe lk ll lm ln b">/test</code>:</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gi gj mw"><img src="../Images/e260a1d1e70d667c7ce871d4e74ec1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2v0feDewtsNc-EI8zVOyIQ.png"/></div></div></figure></div></div>    
</body>
</html>