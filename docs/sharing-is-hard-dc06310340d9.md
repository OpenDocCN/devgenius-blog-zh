# 分享很难

> 原文：<https://blog.devgenius.io/sharing-is-hard-dc06310340d9?source=collection_archive---------3----------------------->

## 但是不分享更难

![](img/8866747aeb3f0e51e7bcafee747e3c78.png)

照片由[加布·皮尔斯](https://unsplash.com/@gaberce?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/children-playing?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍摄

我们都是从小学会分享的，为什么开发者就这么难呢？每个人都说 DRY(不要重复自己)，但是两个开发人员会写多少次重复的代码呢？让我们面对它，有很多非常湿的开发者在那里。我们必须接受共享代码很难的事实。

共享代码很难的原因有很多。人们并不总是信任其他人的代码，开发者喜欢开发，或者我们甚至没有意识到代码已经在其他地方可用。但最大的原因可能是我们没有有效共享所必需的基础设施。

基础设施的一部分是将共享代码从使用它的代码中分离出来。有两种共享代码的方式，通过连接的存储库或 mono-repo 共享代码，或者通过二进制存储库共享二进制代码。因为我的大部分专业知识是 Java，所以我将专注于通过二进制存储库共享 jar 文件。但是你可以用 JavaScript 或 Python 和许多现代语言来做同样的事情。

共享代码必须进行版本控制。可以预见的是，没有人希望突然发现他们的代码因为共享代码的变化而被破坏。Maven 有`SNAPSHOT`版本的概念，如果你使用的是`SNAPSHOT`版本，你应该预料到事情偶尔会出错。解决方法是不要使用`SNAPSHOT`版本，除非你想成为一名 beta 测试者。一个好的二进制存储库不允许一个已发布的(非`SNAPSHOT`)版本发生变化，所以你可以相信它一直是相同的，直到你改变了版本。

共享代码必须经过严格的测试。没有人喜欢调试别人的代码。如果发布的代码有一个 bug，并且发布周期不够快，那么代码很可能会被复制和修复，这与尝试共享的目的背道而驰。每当我使用一个公共库时，我首先关注的事情之一就是代码覆盖率，如果它在库中被标记的话。

![](img/932b437698ab4b6250cb5505bbf28489.png)

85%的代码覆盖率！

如果你的构建管道可以在你的自述文件上加一个徽章，那么共享将更有可能被采用。

分享不应该是事后的想法！如果代码共享没有从一开始就考虑好，你将会得到重复但略有不同的代码。现在，如果你想分享它，你必须调和所有这些差异。如果你的依赖是一团乱麻，你需要镊子来解开它们。当你意识到你被重复的代码压得喘不过气来，需要开始共享时，你可能也会被更多的功能要求压得喘不过气来。

分享要深思熟虑。共享代码代表可能特定于您的组织的模式。如果它们是常见的模式，那么可能已经有一个库可供您使用。考虑一下您的组织使用的对象和功能，您将能够确定哪些属于共享库，哪些不属于。

使用像接口、泛型和 lambdas 这样的东西会让你的共享代码更加灵活。我知道仍然有很多面向对象的人喜欢使用抽象类之类的东西，但是我发现函数式编程会给你更多的灵活性。取你的抽象类，把代码放到一个委托类中，任何抽象函数都可以作为 lambdas 传递给使用它们的函数。现在您有了一个接口，一个灵活的实现，并且您不必猜测您的抽象函数是从哪里被调用的，或者哪些函数被覆盖。

如果使用容器，还可以在容器级别共享。将认证或登录之类的事情放在边车图像中。任何可以被隔离的横切关注点都可以按照自己的映像运行。您最终得到的应该看起来像是无服务器的功能，但是更灵活，更适合您组织的需求。

所以早点分享，经常分享。你将得到更少的代码和更多的可交付成果。这需要努力和一定程度的自律，没有人应该认为这是一项容易的任务。但是这种努力是值得的，并且可以培养良好的干燥习惯。