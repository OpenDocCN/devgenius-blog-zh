<html>
<head>
<title>Docker:PHP/PDO + MySQL.. How to?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker:PHP/PDO + MySQL..如何？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/docker-php-pdo-mysql-how-to-8c0aee437539?source=collection_archive---------2-----------------------#2020-05-29">https://blog.devgenius.io/docker-php-pdo-mysql-how-to-8c0aee437539?source=collection_archive---------2-----------------------#2020-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1c04cc46557b2d3db082eb5a6c947eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M3yu0LqgNR8irzvm"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@fabioha?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">法比奥</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6cdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">上下文</strong>:一个PHP服务器和一个MySQL数据库。这是一个非常常见的设置。你必须创建一个与数据库交互PHP脚本，但是你不能访问服务器，因为由于防火墙安全限制，只有来自本地主机的脚本才能工作。</p><p id="586e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">问题:</strong>要测试您的脚本，您必须打开一个FTP客户端，上传。php脚本到服务器并测试它。每次php文件改变时，你都必须重复这个过程，不考虑在生产中尝试是一个非常糟糕的做法。</p><blockquote class="lb lc ld"><p id="4613" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kf ir">解决方案:Docker </strong>可以帮助开发人员在几个步骤中创建一个类似于生产环境的环境。这甚至允许开发人员在本地环境中测试他们代码，而不用担心犯错误！</p></blockquote><p id="0636" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有现成的容器用于PHP和MySQL，许多教程和在线资源告诉我们如何在有和没有docker-compose的情况下将它们放在一起。我发现<a class="ae kc" href="https://alysivji.github.io/php-mysql-docker-containers.html" rel="noopener ugc nofollow" target="_blank">这个</a>使用docker-compose非常有用，而<a class="ae kc" href="https://severalnines.com/database-blog/mysql-docker-containers-understanding-basics" rel="noopener ugc nofollow" target="_blank">这个</a>没有使用它，但是<strong class="kf ir">我努力尝试使用PHP+PDO来简单地打开一个与我的MySQL数据库的连接，只阅读这些文章</strong>。我使用PDO的原因是MySQLi扩展已经被否决了，正如W3C所说的。</p><p id="3762" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">环境配置问题(我写这篇文章的原因):</strong>从主机到MySQL容器的通信正常，但是从PHP容器到MySQL容器的通信不正常。</p><blockquote class="li"><p id="8ce7" class="lj lk iq bd ll lm ln lo lp lq lr la dk translated">docker-compose和适当的变量赋值。php文件是解决这个问题的关键</p></blockquote><p id="b46b" class="pw-post-body-paragraph kd ke iq kf b kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw lw ky kz la ij bi translated">这是我的docker-compose:</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="81a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到db image保持原样(mysql:5.7)，但web image没有，因为我们必须将PDO扩展安装到基本PHP映像中。请注意，这两个容器都通过端口8100(对于PHP容器)和9906(对于MySQL数据库)向主机公开:这样，我们可以从主机终端使用类似下面的命令通过<a class="ae kc" href="https://dev.mysql.com/doc/refman/8.0/en/mysql.html" rel="noopener ugc nofollow" target="_blank"> mysql-cli </a>连接到它:</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="c6bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中-P代表“端口”,必须与docker-compose中定义的hots-exposed相匹配。-p代表“密码”，-u代表“用户”。</p><p id="0c12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在文档下面</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="46ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一行安装所需的扩展。</p><p id="40b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，这是我的MySQL PHP连接脚本:</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="8927" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意两件重要的事情:</p><ul class=""><li id="3f05" class="md me iq kf b kg kh kk kl ko mf ks mg kw mh la mi mj mk ml bi translated">$servername被设置为docker-compose.yml中的<em class="le"> mysql服务名</em>，因为docker-compose允许在<em class="le"> docker-compose.yml </em>中声明的容器通过服务名相互通信。不用担心IP地址</li><li id="cc3a" class="md me iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">$port设置为网络内端口，其中“网络内”是由“docker-compose up”运行时由docker-compose自动创建的端口</li><li id="6f82" class="md me iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">浏览http://localhost:8100 ，你会看到消息:“连接成功”</li></ul><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/d07395083f11856012cd785baae91ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kr2BA_beNBLGf9la"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@wesleyeland?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">韦斯利·埃兰</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="abf7" class="ms mt iq bd mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np bi translated">感谢阅读:)</h1></div></div>    
</body>
</html>