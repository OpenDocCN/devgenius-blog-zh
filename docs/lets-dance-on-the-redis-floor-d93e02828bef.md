# è®©æˆ‘ä»¬åœ¨â€œçº¢è‰²åœ°æ¿â€ä¸Šè·³èˆ

> åŸæ–‡ï¼š<https://blog.devgenius.io/lets-dance-on-the-redis-floor-d93e02828bef?source=collection_archive---------4----------------------->

ä½ å¥½ã€‚ï¼åœ¨å½“ä»Šä¸–ç•Œï¼Œä¸€åˆ‡éƒ½æ˜¯åŠ¨æ€çš„ï¼Œè¿™æ„å‘³ç€æ•°æ®æ— å¤„ä¸åœ¨ï¼Œå¹¶ä¸”åœ¨å¿«é€Ÿå¢é•¿ã€‚ä¸ºäº†ç®¡ç†è¿™ç§å¿«é€Ÿçš„æ­¥ä¼ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥åŒæ ·çš„é€Ÿåº¦å¤„ç†å®ƒï¼Œè¿™å°±æ˜¯â€œRedisâ€æ˜¯æˆ‘ä»¬ç”¨æ•°æ®åšè‡ªç”±å¼å¿«é€Ÿç§»åŠ¨çš„èˆæ± çš„åœ°æ–¹ã€‚

å‰å‡ å¤©ï¼Œæˆ‘åœ¨ç”¨æ–‡æ¡£æ•°æ®åº“åšä¸€äº›æ•°æ®å·¥ç¨‹ä»»åŠ¡

> **ä½•æ—¶â€¦**
> 
> **æŸ¥ç†Â·æ™®æ–¯ pinged æˆ‘:**
> 
> **è¿™ç§æƒ…å†µæŒç»­å¤šä¹…äº†ï¼Ÿ:(**
> 
> **ç„¶åâ€¦â€¦**
> 
> **è‚–æ©Â·è’™å¾·å…¹å›ç­”é“:**
> 
> **æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æŒ¡ä½ å›å»ä½¿ç”¨**[**Redis**](https://redis.com/)**:)**

äºæ˜¯æˆ‘æ”¾äº†åŒä¸€é¦–æ­Œï¼Œè®¾äº†é«˜ä½éŸ³ï¼Œåœ¨ Redis èˆæ± é‡Œè·³äº†èµ·æ¥ã€‚æ•°æ®ä»¥å¿«èŠ‚å¥ç‹‚èˆï¼Œåœ°æ¿æ˜¯è¿™æ ·çš„â€¦

![](img/7c591bd6bfb5bcbb496919bf2ceeff25.png)

å—¯ï¼Œä¸€æ—¦ä½ ä½¿ç”¨ Redisï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯éå¸¸æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿™äº›äº‹æƒ…æ˜¯æ€ä¹ˆå‘ç”Ÿçš„å‘¢ï¼Ÿ**ä¸ºä»€ä¹ˆ** ğ‘ğğğ¢ğ¬ **é‚£ä¹ˆğŸğšğ¬ğ­ï¼Ÿ**

å› æ­¤ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç©¶è§£é‡Š Redis çš„ **Fast** word çš„äº‹å®ã€‚ä½†åœ¨é‡ç‚¹è®¨è®ºè¿™ä¸€éƒ¨åˆ†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯· Redis ä»‹ç»ä¸€ä¸‹è‡ªå·±:

![](img/b7aace763bcbe505bf6bf4a5c347d5b2.png)

[**å®˜æ–¹æ ‡å¿—:Redis**](https://redis.com/)

> **é›·è¿ªæ–¯:**
> 
> æˆ‘æ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œæˆ‘å¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚
> 
> **æˆ‘æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆæˆ– ZSet å’ŒèŒƒå›´æŸ¥è¯¢ã€ä½å›¾ã€è¶…å¯¹æ•°å’Œåœ°ç†ç©ºé—´ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚å¸¸è§çš„æ•°æ®ç»“æ„ç±»å‹æœ‰å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€æ•£åˆ—å’Œ ZSetã€‚**
> 
> **æˆ‘å†…ç½®äº†å¤åˆ¶(replication)ã€LUA è„šæœ¬(LUA scripting)ã€LRU é©±åŠ¨äº‹ä»¶(LRU é©±é€)ã€äº‹åŠ¡(transactions)å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…åŒ–(persistence)ï¼Œå¹¶é€šè¿‡ Redis å“¨å…µå’Œè‡ªåŠ¨åˆ†åŒº(Cluster)æä¾›é«˜å¯ç”¨æ€§ã€‚**
> 
> æˆ‘è¿˜æä¾›äº†æŒä¹…åŒ–çš„é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å…è®¸ç”¨æˆ·å°†ä»–ä»¬çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šè¿›è¡Œå­˜å‚¨ã€‚æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥åœ¨æŸä¸ªæ—¶é—´å°†æ•°æ®é›†å¯¼å‡ºåˆ°ç£ç›˜(å¿«ç…§)ï¼Œæˆ–è€…è¿½åŠ åˆ°å‘½ä»¤æ—¥å¿—ä¸­(AOF åªè¿½åŠ æ–‡ä»¶)ï¼Œæˆ‘ä¼šåœ¨æ‰§è¡Œå†™å‘½ä»¤çš„æ—¶å€™å°†æ‰§è¡Œçš„å†™å‘½ä»¤å¤åˆ¶åˆ°ç¡¬ç›˜ä¸Šã€‚ä¹Ÿå¯ä»¥å…³é—­æŒä¹…åŒ–ï¼Œå°† me ä½œä¸ºé«˜æ•ˆçš„ç½‘ç»œæ•°æ®ç¼“å­˜åŠŸèƒ½ã€‚
> 
> **æˆ‘ä¸ä½¿ç”¨è¡¨ï¼Œä»–çš„æ•°æ®åº“ä¹Ÿä¸ä¼šé¢„å®šä¹‰æˆ–å¼ºåˆ¶ç”¨æˆ·å…³è”å­˜å‚¨åœ¨æˆ‘è¿™é‡Œçš„ä¸åŒæ•°æ®ã€‚**

ç°åœ¨è®©æˆ‘ä»¬è°ˆè°ˆå®ƒçš„å¿«é€Ÿå¤„ç†ï¼Œæˆ–è€…è¯•ç€æ‰¾å‡ºè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆ:ä¸ºä»€ä¹ˆğ‘ğğğ¢ğ¬å¦‚æ­¤ğŸğšğ¬ğ­ï¼Ÿ

***è¿™é‡Œæˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹:***

æ•°æ®åº“çš„å·¥ä½œæ¨¡å¼å¯ä»¥åˆ†ä¸ºç¡¬ç›˜æ•°æ®åº“å’Œå†…å­˜æ•°æ®åº“ã€‚Redis å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™æ•°æ®æ—¶ä¸å—ç¡¬ç›˜ I / O é€Ÿåº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥é€Ÿåº¦æå¿«ã€‚

> *æ‰€ä»¥æˆ‘ä»¬æœ‰ 3 ä¸ªéƒ¨åˆ†æ¥æŠ¥é“è¿™ä¸ªæ•…äº‹:*
> 
> **Redis æœ‰å¤šå¿«ï¼Ÿ**
> 
> **è¯¦ç»†è¯´æ˜ Redis ä¸šç»©é«˜çš„åŸå› ã€‚**
> 
> **å½±å“ Redis ä¸šç»©çš„å› ç´ ã€‚**

# Redis æœ‰å¤šå¿«:

è¦äº†è§£ Redis çš„å‘å±•é€Ÿåº¦ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªè¯„ä¼°å·¥å…·ã€‚å…¶æ¬¡ï¼ŒRedis éœ€è¦ä¸€äº›å¹³å°ç»éªŒæ•°æ®æ¥è¯„ä¼° Redis åœ¨æ•°é‡çº§ä¸Šçš„æ€§èƒ½ã€‚å¥½åœ¨ Redis æä¾›äº†è¿™æ ·ä¸€ä¸ªå·¥å…·ï¼Œå¹¶ç»™å‡ºäº†ä¸€äº›å¸¸ç”¨ç¡¬ä»¶å¹³å°çš„ä½“éªŒæ•°æ®ã€‚

ä¸‹é¢æ˜¯ä¸€ç¯‡é•¿æ–‡ï¼Œæ ¸å¿ƒè§‚ç‚¹å¦‚ä¸‹:

1.  Redis åŸºå‡†å¯ä»¥ç”¨æ¥è¯„ä¼° Redis çš„æ€§èƒ½ã€‚å‘½ä»¤è¡Œæä¾›äº†åœ¨æ­£å¸¸/ç®¡é“æ¨¡å¼å’Œä¸åŒå‹åŠ›ä¸‹è¯„ä¼°ç‰¹å®šå‘½ä»¤æ€§èƒ½çš„åŠŸèƒ½ã€‚
2.  Redis æ€§èƒ½ä¼˜å¼‚ã€‚ä½œä¸ºé”®å€¼ç³»ç»Ÿï¼Œæœ€å¤§è´Ÿè½½æ°´å¹³ä¸º 10W / sï¼Œset å’Œ get è€—æ—¶æ°´å¹³åˆ†åˆ«ä¸º 10ms å’Œ 5msã€‚ä½¿ç”¨ç®¡é“å¯ä»¥æé«˜ Redis æ“ä½œçš„æ€§èƒ½ã€‚

å¦‚æœä¸å…³å¿ƒå…·ä½“æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°ç¬¬äºŒéƒ¨åˆ†äº†è§£ Redis è¡¨ç°ä¼˜å¼‚çš„åŸå› ã€‚

# Redis ç»©æ•ˆè¯„ä¼°å·¥å…·:

Redis åŒ…æ‹¬ Redis benchmark å®ç”¨ç¨‹åºï¼Œå¯ä»¥æ¨¡æ‹Ÿ n ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€ total queries çš„ m ä¸ªè¿è¡Œå‘½ä»¤(ç±»ä¼¼ Apache AB å®ç”¨ç¨‹åº)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Redis åŸºå‡†æ¥è¯„ä¼° Redis çš„æ€§èƒ½ã€‚

æ”¯æŒä»¥ä¸‹é€‰é¡¹:

```
Usage: redis-benchmark [-h <host>] [-p <port>] [-c <clients>] [-n <requests]> [-k <boolean>]

 -H < hostname > server hostname (default 127.0.0.1) -P < port > server port (default 6379) -S < socket > server socket (covering host and port) -A < password > server authentication key -C < clients > number of clients started (parallelism) (default 50) -N < requests > total requests (default 100000) -D < size > get and set request data size (default 2 bytes) --DB number selected by dbnum < DB > (default 0) -K < Boolean > 1 = keep alive 0 = connect (default 1) -R < keyspacelen > use random key value in set / get / incr and random VA in Sadd -P < numreq > the number of requests contained in a pipeline. The default value is 1 (pipeline is not used) -Q quiet mode. Only show QPS value --CSV output in CSV format -L generate loop to execute test permanently -T < tests > make the command of test command, and the command list is separated by commas -I idle mode, only open n idle connections and wait
```

åœ¨å¼€å§‹åŸºå‡†æµ‹è¯•ä¹‹å‰ï¼Œæ‚¨éœ€è¦æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Redis å®ä¾‹ã€‚æˆ‘å°è¯•äº†ä¸€ä¸ªå¸¦æœ‰é»˜è®¤å‚æ•°çš„ä¾‹å­:

```
D:\data\soft\redis-windows>redis-benchmark.exe
.....
====== SET ======
  100000 requests completed in 0.81 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

99.90% <= 1 milliseconds
99.93% <= 2 milliseconds
99.95% <= 78 milliseconds
99.96% <= 79 milliseconds
100.00% <= 79 milliseconds
123609.39 requests per second

====== GET ======
  100000 requests completed in 0.70 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

100.00% <= 0 milliseconds
142045.45 requests per second

====== INCR ======
  100000 requests completed in 0.71 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

99.95% <= 1 milliseconds
99.95% <= 2 milliseconds
100.00% <= 2 milliseconds
140252.45 requests per second
.....
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œset / get / incr çš„æµ‹è¯•ç»“æœè¢«æˆªå–ã€‚

æµ‹è¯•ç»“æœåŒ…æ‹¬æµ‹è¯•çš„ç¯å¢ƒå‚æ•°(è¯·æ±‚æ•°é‡ã€å®¢æˆ·ç«¯æ•°é‡ã€æœ‰æ•ˆè´Ÿè½½)å’Œè¯·æ±‚æ—¶é—´çš„ TP å€¼ã€‚

> **é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis åŸºå‡†æµ‹è¯•ä½¿ç”¨ 100000 ä¸ªè¯·æ±‚ã€50 ä¸ªå®¢æˆ·ç«¯å’Œ 3 ä¸ªå­—èŠ‚çš„æœ‰æ•ˆè´Ÿè½½è¿›è¡Œæµ‹è¯•ã€‚**
> 
> **è¿”å›çš„ç»“æœæ˜¾ç¤ºï¼Œset /get / incr å‘½ä»¤åœ¨ 100000 æ¬¡è¯·æ±‚ä¸‹çš„æ€»è¯·æ±‚æ—¶é—´å°äº 0.1sã€‚ä»¥ QPS = 10W ä¸ºä¾‹ï¼Œè®¡ç®—å‡ºçš„å¹³å‡æ—¶é—´çº¦ä¸º 2ms (1 / (10W / 50))ã€‚**

Redis çš„æ€§èƒ½ä¸è®¸å¤šå› ç´ æœ‰å…³ï¼Œè¿™äº›å› ç´ å°†åœ¨ç¬¬ä¸‰éƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚æ¯”å¦‚å®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶æ€ï¼Œæ˜¯å¦ä½¿ç”¨æµæ°´çº¿ï¼Œé“¾æ¥çš„å®¢æˆ·ç«¯ã€‚ä¸ºäº†å±•ç¤º Redis çš„é€Ÿåº¦æœ‰å¤šå¿«ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Redis benchmark åœ¨å…¶å®˜ç½‘ä¸Šæµ‹è¯•çš„ä¸€ç»„æ•°æ®ã€‚

> ***è­¦å‘Š:*** *è¯·æ³¨æ„ï¼Œä¸ä»Šå¤©çš„æ ‡å‡†ç›¸æ¯”ï¼Œä»¥ä¸‹å¤§å¤šæ•°åŸºå‡†æµ‹è¯•éƒ½æ˜¯å‡ å¹´å‰ä½¿ç”¨è¾ƒæ—§çš„ç¡¬ä»¶è·å¾—çš„ã€‚é¡µé¢åº”è¯¥ä¼šæ›´æ–°ï¼Œä½†åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ç¡¬ä»¶çŠ¶æ€ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ä¸¤å€çš„æ•°å­—ã€‚æ­¤å¤–ï¼Œåœ¨è®¸å¤šå·¥ä½œè´Ÿè½½ä¸­ï¼Œredis 4.0 æ¯” 2.6 æ›´å¿«*

## ç¡¬ä»¶ç¯å¢ƒå’Œè½¯ä»¶é…ç½®:

```
The test was done by 50 clients executing 2 million requests at the same time.All tests are run on redis 2.6.14.The test was performed using the loopback address (127.0.0.1).Perform the test using a million key space.Perform tests with and without a pipeline (16 command pipelines).
Intel(R) Xeon(R) CPU E5520 @ 2.27GHz
```

## Redis ç³»ç»Ÿè´Ÿè½½:

1.  ***æ— ç®¡é“æµ‹è¯•ç»“æœ:***

```
$ ./redis-benchmark -r 1000000 -n 2000000 -t get,set,lpush,lpop -qSET: 122556.53 requests per second
GET: 123601.76 requests per second
LPUSH: 136752.14 requests per second
LPOP: 132424.03 requests per second
```

***2ã€‚ä½¿ç”¨ç®¡é“æµ‹è¯•ç»“æœ:***

```
$ ./redis-benchmark -r 1000000 -n 2000000 -t get,set,lpush,lpop -q -P 16SET: 195503.42 requests per second
GET: 250187.64 requests per second
LPUSH: 230547.55 requests per second
LPOP: 250815.16 requests per second
```

> ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒRedis ä½œä¸ºä¸€ä¸ªå…³é”®å€¼ç³»ç»Ÿï¼Œå…¶è¯»å†™è´Ÿè½½çº¦ä¸º 10W + QPSã€‚
> 
> ä½¿ç”¨æµæ°´çº¿æŠ€æœ¯å¯ä»¥æ˜¾è‘—æé«˜è¯»å†™æ€§èƒ½ã€‚

## è€—æ—¶(æ²¡æœ‰ç®¡é“çš„æµ‹è¯•ç»“æœ):

```
$ redis-benchmark -n 100000

====== SET ======
  100007 requests completed in 0.88 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

58.50% <= 0 milliseconds
99.17% <= 1 milliseconds
99.58% <= 2 milliseconds
99.85% <= 3 milliseconds
99.90% <= 6 milliseconds
100.00% <= 9 milliseconds
114293.71 requests per second

====== GET ======
  100000 requests completed in 1.23 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

43.12% <= 0 milliseconds
96.82% <= 1 milliseconds
98.62% <= 2 milliseconds
100.00% <= 3 milliseconds
81234.77 requests per second
....
```

> **æ‰€æœ‰ set æ“ä½œåœ¨ 10ms å†…å®Œæˆï¼Œget æ“ä½œå°äº 5msã€‚**

# Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«:

Redis æ˜¯ä¸€ä¸ªå•çº¿ç¨‹åº”ç”¨ç¨‹åºï¼Œè¿™æ„å‘³ç€ Redis ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä½†æ˜¯ä¸èƒ½ç”¨å•çº¿ç¨‹çš„æ–¹å¼ä½¿ç”¨å¤šæ ¸ CPU æ€§èƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨ä¸€å°æœºå™¨ä¸Šæ‰“å¼€å¤šä¸ª Redis å®ä¾‹æ¥æé«˜ï¼

# **Redis é«˜æ€§èƒ½çš„åŸå› :**

å—¯ï¼Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªä¸»è¦çš„åŸå› è®© Redis å¿«é€Ÿå’Œæ„¤æ€’:

1.  åœ¨å­˜å‚¨å™¨ä¸­
2.  IO å¤šè·¯å¤ç”¨å’Œå•çº¿ç¨‹å®æ–½
3.  ä¼˜åŒ–çš„ä½å±‚æ•°æ®ç»“æ„

æ‰€ä»¥è®©æˆ‘ä»¬æ·±å…¥çœ‹çœ‹è¿™ä¸‰ä¸ªåŸå› :

# **å†…å­˜å­˜å‚¨:**

![](img/6d0d8d6e7d9dbc642344cd07920fd838.png)

**Redis ä¸­çš„å†…å­˜å­˜å‚¨è¯´æ˜(Credit: ByteByteGo)**

Redis å¾ˆå¿«ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ã€‚å†…å­˜è®¿é—®æ¯”éšæœºç£ç›˜ I/O å¿«å‡ ä¸ªæ•°é‡çº§ã€‚çº¯å†…å­˜è®¿é—®æä¾›é«˜è¯»å†™ååé‡å’Œä½å»¶è¿Ÿã€‚ä»£ä»·æ˜¯æ•°æ®é›†ä¸èƒ½å¤§äºå†…å­˜ã€‚å°±ä»£ç è€Œè¨€ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„ä¹Ÿæ¯”ç£ç›˜ä¸Šçš„æ•°æ®ç»“æ„æ›´å®¹æ˜“å®ç°ã€‚è¿™ä½¿å¾—ä»£ç ç®€å•ï¼Œå¹¶ä¸”æœ‰åŠ©äº Redis åšå¦‚ç£çŸ³çš„ç¨³å®šæ€§ã€‚

# IO å¤šè·¯å¤ç”¨å’Œå•çº¿ç¨‹å®æ–½:

Redis å¿«é€Ÿçš„å¦ä¸€ä¸ªåŸå› æœ‰ç‚¹ä¸ç›´è§‚ã€‚å®ƒä¸»è¦æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™å¸¦æ¥äº†ä¸€äº›é—®é¢˜ã€‚

ä¸ºä»€ä¹ˆå•çº¿ç¨‹è®¾è®¡ä¼šå¸¦æ¥é«˜æ€§èƒ½ï¼Ÿå¦‚æœå®ƒä½¿ç”¨çº¿ç¨‹æ¥åˆ©ç”¨æ‰€æœ‰çš„ CPU å†…æ ¸ï¼Œä¸æ˜¯ä¼šæ›´å¿«å—ï¼Ÿ

å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºéœ€è¦é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œä»–ä»¬å¾ˆéš¾è®²é“ç†ã€‚åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œå¢åŠ çš„å¤æ‚æ€§å®¹æ˜“å¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”ç‰ºç‰²äº†ç¨³å®šæ€§ï¼Œå› æ­¤å¾ˆéš¾è¯æ˜æ€§èƒ½æå‡çš„åˆç†æ€§ã€‚å¯¹äº Redisï¼Œå•çº¿ç¨‹ä»£ç è·¯å¾„å¾ˆå®¹æ˜“ç†è§£ã€‚

å•çº¿ç¨‹ä»£ç åº“å¦‚ä½•åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡çš„ä¼ å…¥è¯·æ±‚å’Œä¼ å‡ºå“åº”ï¼Ÿçº¿ç¨‹åœ¨å•ç‹¬ç­‰å¾…æ¯ä¸ªè¯·æ±‚å®Œæˆæ—¶ä¸ä¼šè¢«é˜»å¡å—ï¼Ÿ

![](img/041f292a6ae0d7a905180ea675a9d40d.png)

è¿™å°±æ˜¯ I/O å¤šè·¯å¤ç”¨å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚é€šè¿‡ I/O å¤šè·¯å¤ç”¨ï¼Œæ“ä½œç³»ç»Ÿå…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç­‰å¾…å¤šä¸ªå¥—æ¥å­—è¿æ¥ã€‚ä¼ ç»Ÿä¸Šï¼Œè¿™æ˜¯é€šè¿‡é€‰æ‹©æˆ–è½®è¯¢ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆçš„ã€‚å½“æœ‰æˆåƒä¸Šä¸‡ä¸ªè¿æ¥æ—¶ï¼Œè¿™äº›ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ã€‚åœ¨ Linux ä¸Šï¼ŒEpoll æ˜¯ I/O å¤šè·¯å¤ç”¨çš„ä¸€ä¸ªé«˜æ€§èƒ½å˜ä½“ï¼Œå®ƒåœ¨æ’å®šæ—¶é—´å†…æ”¯æŒæˆåƒä¸Šä¸‡ä¸ªè¿æ¥ã€‚è¿™ç§å•çº¿ç¨‹è®¾è®¡çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå®ƒä¸èƒ½åˆ©ç”¨ç°ä»£ç¡¬ä»¶ä¸­æ‰€æœ‰å¯ç”¨çš„ CPU å†…æ ¸ã€‚å¯¹äºæŸäº›å·¥ä½œè´Ÿè½½ï¼Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ª Redis å®ä¾‹ä»¥åˆ©ç”¨æ›´å¤š CPU å†…æ ¸çš„æƒ…å†µå¹¶ä¸å°‘è§ã€‚

![](img/017193fe1921827b8f1117a045c031ea.png)

**IO å¤ç”¨å›¾è§£&å•çº¿ç¨‹æ‰§è¡Œ(Credit: ByteByteGo)**

è®©æˆ‘ä»¬çœ‹çœ‹ Redis æ˜¯å¦‚ä½•å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„ã€‚

ä¸€èˆ¬æ¥è¯´ï¼ŒRedis ä½¿ç”¨ä¸€ä¸ªååº”å™¨è®¾è®¡æ¨¡å¼ï¼Œå°è£…äº†å¤šä¸ªå®ç°(selectã€epollã€kqueue ç­‰ã€‚)æ¥å¤šè·¯å¤ç”¨ IO ä»¥å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚

![](img/d8a85bce9f922236f83ec65ee629381c.png)

**å¤ç”¨ååº”å †æ¨¡å¼ç¤ºæ„å›¾**

ååº”å™¨è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå®ç°äº‹ä»¶é©±åŠ¨ã€‚æ­¤å¤–ï¼ŒRedis å°è£…äº†ä¸åŒçš„åº“ï¼Œç”¨äºåœ¨ä¸åŒå¹³å°ä¸Šå¤ç”¨ ioã€‚æµç¨‹å¦‚ä¸‹:

![](img/edf6baf50bc17fd8e21ddd24a0d6ba25.png)

**Redis**ä¸­å¤ç”¨ I / O ä¸åŒåº“çš„å°è£…ç¤ºæ„å›¾

å› ä¸º Redis éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œä¸ºäº†æœ€å¤§åŒ–æ‰§è¡Œçš„æ•ˆç‡å’Œæ€§èƒ½ï¼Œä¼šæ ¹æ®ä¸åŒçš„ç¼–è¯‘å¹³å°é€‰æ‹©ä¸åŒçš„ I / O å¤ç”¨å‡½æ•°ä½œä¸ºå­æ¨¡å—ã€‚

Redis ä¼šä¼˜å…ˆé€‰æ‹©æ—¶é—´å¤æ‚åº¦ä¸º O (1)çš„ I / O å¤ç”¨å‡½æ•°ä½œä¸ºåº•å±‚å®ç°ï¼ŒåŒ…æ‹¬ Solaris 10 ä¸­çš„ evportï¼ŒLinux ä¸­çš„ epollï¼ŒMac OS / FreeBSD ä¸­çš„ kqueueã€‚è¿™äº›å‡½æ•°éƒ½ä½¿ç”¨å†…æ ¸çš„å†…éƒ¨ç»“æ„ï¼Œå¯ä»¥æœåŠ¡äºæˆåƒä¸Šä¸‡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚

ä½†æ˜¯ï¼Œå¦‚æœå½“å‰çš„ç¼–è¯‘ç¯å¢ƒä¸å…·å¤‡ä¸Šè¿°åŠŸèƒ½ï¼Œå°†é€‰æ‹© select ä½œä¸ºæ›¿ä»£ã€‚ç”±äºå®ƒåœ¨ä½¿ç”¨æ—¶ä¼šæ‰«ææ‰€æœ‰è¢«ç›‘æ§çš„æè¿°ç¬¦ï¼Œæ—¶é—´å¤æ‚åº¦è¾ƒå·® o (n)ï¼ŒåŒæ—¶åªèƒ½æœåŠ¡ 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä½œä¸ºç¬¬ä¸€ç§æ–¹æ¡ˆä½¿ç”¨ã€‚

# ä¼˜åŒ–çš„åº•å±‚æ•°æ®ç»“æ„:

Redis æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„å’Œä¸åŒåœºæ™¯ä¸‹çš„ä¸åŒå®ç°ã€‚

Redis æ˜¯ä¸€ä¸ªå…³é”®çš„ä»·å€¼ç³»ç»Ÿã€‚ä¸åŒç±»å‹çš„é”®å¯¹åº”ä¸åŒçš„æ“ä½œï¼Œæˆ–è€…æ“ä½œå¯¹åº”ä¸åŒçš„å®ç°ã€‚åŒä¸€ä¸ªé”®ä¹Ÿä¼šæœ‰ä¸åŒçš„å®ç°ã€‚Redis å¯¹ key è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šæ£€æŸ¥ç±»å‹ï¼Œè°ƒç”¨ä¸åŒçš„å®ç°ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒRedis å»ºç«‹äº†è‡ªå·±ç±»å‹çš„ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬:

Redisobject å¯¹è±¡ã€‚
åŸºäºé‡å¯¹è±¡çš„ç±»å‹æ£€æŸ¥ã€‚
åŸºäº redisobject å¯¹è±¡çš„æ˜¾å¼å¤šæ€å‡½æ•°ã€‚
å†è´´ç°çš„åˆ†é…ã€å…±äº«å’Œé”€æ¯æœºåˆ¶ã€‚

```
/*
 *Redis object
 */
typedef struct redisObject {

    //Type
    unsigned type:4;

    //Alignment bit
    unsigned notused:2;

    //Coding method
    unsigned encoding:4;

    //LRU time (relative to server.lruclock )
    unsigned lru:22;

    //Reference count
    int refcount;

    //Value to object
    void *ptr;

} robj;
```

> **ç±»å‹ã€ç¼–ç å’Œ PTR æ˜¯ä¸‰ä¸ªæœ€é‡è¦çš„å±æ€§ã€‚Redis åˆ†åˆ«æ”¯æŒ 4 ç§ç±»å‹å’Œ 8 ç§ç¼–ç :**

ä½¿ç”¨ redisobjectï¼Œå¯ä»¥è½»æ¾å®ç°ç‰¹å®šé”®çš„æ“ä½œè¿‡ç¨‹:

![](img/cac89fff55d45932f94de1152721163d.png)

**é«˜æ•ˆä½å±‚æ•°æ®ç»“æ„çš„è¯´æ˜(Credit: ByteByteGo)**

æˆ‘ä»¬æåˆ°äº† Redis é€Ÿåº¦å¿«çš„ç¬¬ä¸‰ä¸ªåŸå› ã€‚ç”±äº Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå®ƒå¯ä»¥åˆ©ç”¨å‡ ç§æœ‰æ•ˆçš„ä½çº§æ•°æ®ç»“æ„ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¦‚ä½•æœ‰æ•ˆåœ°å°†å®ƒä»¬æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šâ€”â€”é“¾è¡¨ã€è·³è¡¨å’Œå“ˆå¸Œè¡¨å°±æ˜¯ä¸€äº›ä¾‹å­ã€‚ç¡®å®æœ‰äººè¯•å›¾å®ç°æ–°çš„ Redis å…¼å®¹æœåŠ¡å™¨ï¼Œä»¥ä»å•ä¸ªæœåŠ¡å™¨ä¸­æŒ¤å‡ºæ›´å¤šçš„æ€§èƒ½ã€‚å‡­å€Ÿ Redis çš„æ˜“ç”¨æ€§ã€åšå¦‚ç£çŸ³çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œæˆ‘ä»¬è®¤ä¸º Redis ä»ç„¶æä¾›äº†å¸‚åœºä¸Šæœ€ä½³çš„æ€§èƒ½å’Œç¨³å®šæ€§æƒè¡¡ã€‚

> **Redis é™¤äº†æä¾›ä¸°å¯Œé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œè¿˜æä¾› hyperloglogã€geo index ç­‰é«˜æ•ˆç®—æ³•ã€‚**

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒRedis æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å†…å­˜æ•°æ®åº“ã€‚å®ƒåšå¦‚ç£çŸ³ï¼Œæ˜“äºä½¿ç”¨ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«ã€‚æ ¹æ® Stack Overflow çš„å¹´åº¦å¼€å‘äººå‘˜è°ƒæŸ¥ï¼Œè¿™äº›å±æ€§è§£é‡Šäº†ä¸ºä»€ä¹ˆå®ƒæ˜¯æœ€å—æ¬¢è¿çš„æ•°æ®åº“ä¹‹ä¸€

è¿™æ„å‘³ç€â€¦

**â€œè®©æˆ‘ä»¬åœ¨ Redis åœ°æ¿ä¸Šè·³èˆâ€**æ„æ€æ˜¯...

**â€œä¸ºæˆ‘è·³èˆï¼Œä¸ºæˆ‘è·³èˆï¼Œä¸ºæˆ‘è·³èˆï¼Œå“¦ï¼Œå“¦ï¼Œå“¦ï¼!"**

æˆ‘ä»¬çŸ¥é“ Redis å¿«é€Ÿæ€§èƒ½çš„å¼¦ç†è®º(å—¯ï¼Œæˆ‘ä»¬å·²ç»æ¢ç´¢äº† WH è¯çš„æ‰€æœ‰ 10 ä¸ªç»´åº¦)ï¼Œæ‰€ä»¥**â€œä¸è¦å¿˜è®°å°è¯•**[**Redis**](http://redis.com)**â€**å¹¶ç»§ç»­å…³æ³¨å³å°†åˆ°æ¥çš„æ–‡ç« ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ª**æ¶æ„â€”â€”ä¹˜å Redis çš„è¿‡å±±è½¦**ï¼ï¼

ä¸å’š:è¿™ç¯‡æ–‡ç« æ˜¯ä¸ Redis åˆä½œçš„ã€‚

# çœ‹åˆ°ä¸€äº›å¾ˆé…·çš„å‚è€ƒ:)

*   [å…è´¹è¯•ç”¨ Redis äº‘](https://redis.info/3NBGJRT)
*   [è§‚çœ‹æ­¤è§†é¢‘ï¼Œäº†è§£ Redis äº‘ç›¸å¯¹äºå…¶ä»– Redis æä¾›å•†çš„ä¼˜åŠ¿](https://redis.info/3Ga9YII)
*   [Redis å¼€å‘è€…ä¸­å¿ƒâ€”â€”å…³äº Redis çš„å·¥å…·ã€æŒ‡å—å’Œæ•™ç¨‹](https://redis.info/3LC4GqB)
*   [RedisInsight æ¡Œé¢å›¾å½¢ç”¨æˆ·ç•Œé¢](https://redis.info/3wMR7PR)

éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒã€‚å†è§ï¼ï¼