<html>
<head>
<title>How To Get Cookies From WKWebView and UIWebView in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Swift 中从 WKWebView 和 UIWebView 获取 Cookies</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-get-cookies-from-wkwebview-and-uiwebview-in-swift-46e1a072a606?source=collection_archive---------0-----------------------#2019-11-27">https://blog.devgenius.io/how-to-get-cookies-from-wkwebview-and-uiwebview-in-swift-46e1a072a606?source=collection_archive---------0-----------------------#2019-11-27</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="97fd" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">学习如何从 WebView 获取 cookies 的简单指南</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/17908b9a80f02f473df8a8d6331ecf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s6xmFdyjem7KeXYC"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0194" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天，在本教程中，您将学习如何创建一个<code class="fe lt lu lv lw b">WebView</code>，在其中加载一个网站，然后从该页面获取所有 cookies。然后，您可以解析它们或将它们保存在本地以备将来的请求。</p></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="082a" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">入门指南</h1><p id="568a" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">首先，打开<a class="ae kw" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode </a>并创建一个新项目。选择<em class="nb">单视图 App </em>。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nc"><img src="../Images/276df2e34f91de5cbfa014d346e635d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lrmfh36gYG3FE2V0lsN_Zg.png"/></div></div></figure><p id="03fc" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">转到<code class="fe lt lu lv lw b">Main.storyboard</code>并创建一个名为<code class="fe lt lu lv lw b">WebViewVC</code>的新<code class="fe lt lu lv lw b">ViewController</code>。在这里，我们将添加我们的<code class="fe lt lu lv lw b">WebView</code>,我们将从其中获得所有的 cookies。</p><p id="42f5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后，在第一个<code class="fe lt lu lv lw b">ViewController</code>(我称之为<code class="fe lt lu lv lw b">HomeVC</code>)中添加一个新按钮，并创建一个到<code class="fe lt lu lv lw b">WebViewVC</code>控制器的 segue。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nd"><img src="../Images/1b90700cc1daa60b3fae2210067ab877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wHolGH3R0kV2Va2r8fJlKA.png"/></div></div></figure></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="a68c" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">履行</h1><p id="afa7" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">现在，进入<code class="fe lt lu lv lw b">WebViewVC.swift</code>文件并声明以下两个变量:</p><pre class="kh ki kj kk gu ne lw nf ng aw nh bi"><span id="dde6" class="ni mf ir lw b gz nj nk l nl nm">var webView: WKWebView!<br/>var oldWebView: UIWebView!</span></pre><p id="63ce" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">第一个是 iOS 11+系统用的，第二个是之前 iOS 版本用的。</p><p id="876d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">基于版本，我们需要创建一个<code class="fe lt lu lv lw b">UIWebView</code>或<code class="fe lt lu lv lw b">WKWebView</code>，所以用下面的代码覆盖<code class="fe lt lu lv lw b">loadView</code>方法:</p><pre class="kh ki kj kk gu ne lw nf ng aw nh bi"><span id="d786" class="ni mf ir lw b gz nj nk l nl nm">override func loadView() {<br/>        <br/>        if #available(iOS 11, *) {<br/>            let preferences = WKPreferences()<br/>            let webConfiguration = WKWebViewConfiguration()<br/>            webConfiguration.preferences = preferences<br/>            <br/>            webView = WKWebView(frame: .zero, configuration: webConfiguration)<br/>            <br/>            let userAgentValue = "Chrome/56.0.0.0 Mobile"<br/>            webView.customUserAgent = userAgentValue<br/>            webView.autoresizingMask = [.flexibleWidth, .flexibleHeight]<br/>            webView.uiDelegate = self<br/>            view = webView<br/>            <br/>        } else {<br/>            oldWebView = UIWebView()<br/>            oldWebView.frame =  CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height)<br/>            oldWebView.delegate = self<br/>            view = oldWebView<br/>        }<br/>        <br/>    }</span></pre><p id="e1e2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后，我们需要在我们的<code class="fe lt lu lv lw b">WebView</code>中加载一个网站，在您的<code class="fe lt lu lv lw b">viewDidLoad</code>方法中添加下面的代码:</p><pre class="kh ki kj kk gu ne lw nf ng aw nh bi"><span id="e344" class="ni mf ir lw b gz nj nk l nl nm">let myURL = URL(string: "https://www.medium.com")<br/>let myRequest = URLRequest(url: myURL!)<br/>        <br/>if #available(iOS 11, *) {<br/>  webView.load(myRequest)<br/>  webView.navigationDelegate = self<br/>} else {<br/>  oldWebView.loadRequest(myRequest)<br/>  oldWebView.delegate = self<br/>}</span></pre><p id="6c83" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">最后，我们可以从页面中获得我们的 cookies！</p><p id="109f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为此，添加以下代码，当我们点击 back 按钮并返回第一个控制器时，将触发该代码:</p><pre class="kh ki kj kk gu ne lw nf ng aw nh bi"><span id="fe04" class="ni mf ir lw b gz nj nk l nl nm">override func viewWillDisappear(_ animated: Bool) {<br/>        if #available(iOS 11, *) {<br/>            let dataStore = WKWebsiteDataStore.default()<br/>            dataStore.httpCookieStore.getAllCookies({ (cookies) in<br/>                print(cookies)<br/>            })<br/>        } else {<br/>            guard let cookies = HTTPCookieStorage.shared.cookies else {<br/>                return<br/>            }<br/>            print(cookies)<br/>        }<br/>        <br/>    }</span></pre></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><h1 id="4e1e" class="me mf ir bd mg mh mi mj mk ml mm mn mo jx mp jy mq ka mr kb ms kd mt ke mu mv bi translated">试验</h1><p id="37b9" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">我们已准备好测试您的应用程序！</p><p id="6b4e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">运行模拟器，点击按钮，当页面加载后，点击后退按钮。在控制台中，您将看到所有 cookies 的信息:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nd"><img src="../Images/39da04fe9f09abf68192a985eb21d97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5e_uRRz2mxI_bc9LZ_X3gA.png"/></div></div></figure></div><div class="ab cl lx ly hv lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj nn"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><h1 id="dd5b" class="me mf ir bd mg mh no mj mk ml np mn mo jx nq jy mq ka nr kb ms kd ns ke mu mv bi translated">完整代码</h1><p id="4f9f" class="pw-post-body-paragraph kx ky ir kz b la mw js lc ld mx jv lf lg my li lj lk mz lm ln lo na lq lr ls ik bi translated">你可以在<a class="ae kw" href="https://github.com/domeniconicoli/SaveCookiesExample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的代码。</p><p id="665e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">感谢您的阅读。如果你有任何问题或建议，请在评论中告诉我。</p></div></div>    
</body>
</html>