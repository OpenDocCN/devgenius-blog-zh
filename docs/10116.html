<html>
<head>
<title>Create a serverless REST API on Cloudflare for FREE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">免费在 Cloudflare 上创建一个无服务器 REST API</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-a-serverless-rest-api-on-cloudflare-for-free-763169ac855b?source=collection_archive---------6-----------------------#2022-10-08">https://blog.devgenius.io/create-a-serverless-rest-api-on-cloudflare-for-free-763169ac855b?source=collection_archive---------6-----------------------#2022-10-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5790" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在本文中，我将向您展示为什么您应该为您的下一个 REST API 项目使用无服务器框架，为什么您应该使用 Cloudflare 来部署您的后端，以及如何完全免费地完成它！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/37205dc6687fbf6a4fa1ee7dcf758932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wH401zvZ2h7miixX"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">照片由<a class="ae ks" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="8d14" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">本教程将涵盖的内容</h1><p id="2082" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我将向您展示使用 Cloudflare 的免费 Cloudflare workers 和 KV store 设置无服务器 REST API 的一步一步的过程，包括 CRUD 操作和数据库。</p><h1 id="678e" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">你需要什么</h1><p id="3bb8" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">您只需创建一个 cloudflare 帐户(不需要信用卡)即可享受免费选项。</p><ul class=""><li id="e8a2" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">在这里创建你的账户:<a class="ae ks" href="https://dash.cloudflare.com/login" rel="noopener ugc nofollow" target="_blank">https://dash.cloudflare.com/login</a></li></ul><h1 id="ce93" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我们开始吧</h1><h2 id="f790" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">1.创建服务</h2><ul class=""><li id="e687" class="mh mi in ln b lo lp lr ls lu ne ly nf mc ng mg mo mp mq mr bi translated">导航到左侧导航栏上的“工作人员”,然后单击“创建服务”</li><li id="0770" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">为您的服务取一个合适的名称，确保选择了 HTTP handler，然后单击“创建服务”</li></ul><h2 id="5bb6" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">2.建立基础</h2><ul class=""><li id="e0ce" class="mh mi in ln b lo lp lr ls lu ne ly nf mc ng mg mo mp mq mr bi translated">点击“快速编辑”</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/9280d72dd51689d350fb899f3da66fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sg_9-3Xf8lekirDg.png"/></div></div></figure><ul class=""><li id="3029" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">您应该会看到一个浏览器编辑器。左边是代码，右边是测试 API 的工具。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/2798900fc2ee0d138c6cfafbbf80e90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PLECXrKEFkhBXJza.png"/></div></div></figure><ul class=""><li id="0dc2" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">在代码的顶部，您应该会看到:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="5999" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">将<code class="fe nq nr ns nt b">env</code>作为参数添加到<code class="fe nq nr ns nt b">handleRequest</code>中。它现在应该看起来像这样</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><blockquote class="nu nv nw"><p id="2abe" class="ll lm nx ln b lo mj jo lq lr mk jr lt ny nz lw lx oa ob ma mb oc od me mf mg ig bi translated">在本教程的后面部分，这是访问我们的数据库所必需的</p></blockquote><ul class=""><li id="1605" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">接下来，<code class="fe nq nr ns nt b">handleRequest</code>函数是我们将拥有 API 逻辑的地方。让我们从删除该函数中的所有内容开始，我们将从头开始。</li><li id="85f1" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">为了创建我们的 CRUD REST API，我们需要区分 GET、POST、PUT 和 DELETE。我们将利用<code class="fe nq nr ns nt b">request</code>参数中的<code class="fe nq nr ns nt b">method</code>来确定我们的 API 调用是什么。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="f87f" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">现在，如果我们单击右侧工具上的“发送”,我们应该会得到一个 200 OK 响应，其主体为“get”。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/97e17ae8a7a57d035bc293e0183c5ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/0*C8iWPY6aG7M3m73H.png"/></div></figure><ul class=""><li id="198c" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">如果我们将方法改为 POST，如果我们再次尝试 API 调用，我们应该得到一个 POST 而不是 get。</li></ul><blockquote class="nu nv nw"><p id="c89a" class="ll lm nx ln b lo mj jo lq lr mk jr lt ny nz lw lx oa ob ma mb oc od me mf mg ig bi translated">如果 API 没有按预期工作，几秒钟后再试一次。有时更改需要几秒钟才能重新加载。</p></blockquote><ul class=""><li id="6bdf" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">既然我们已经有了区分 4 种 HTTP 方法的方法，让我们将它们放在一个 switch 案例中，以便在调用 API 时执行不同的事情。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="f44c" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">如果我们再次测试我们的 API 调用，我们应该得到相同的主体，但是响应状态现在应该根据被调用的方法而不同。</li></ul><blockquote class="nu nv nw"><p id="9e55" class="ll lm nx ln b lo mj jo lq lr mk jr lt ny nz lw lx oa ob ma mb oc od me mf mg ig bi translated">如果您想知道为什么我们对 GET 和 PUT 使用 200，对 POST 使用 201，对 DELETE 使用 204，这些是不同方法的典型响应代码。(200 表示 OK，201 表示已创建，204 表示无内容)</p></blockquote><h2 id="ee12" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">3.设置数据库</h2><p id="6d94" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们现在的下一步是创建一个数据库。我们可以利用 Cloudflare 的 KV(键值存储)来存储我们的数据。</p><ul class=""><li id="3801" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">保存并部署您当前的代码，因为我们稍后将回到它。</li><li id="b817" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">单击页面左上角的后退按钮，返回您的控制面板。</li><li id="646f" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">在您员工的仪表板左侧导航栏中，点击“员工”下拉按钮，然后点击 KV</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi of"><img src="../Images/cb70422fc8763130ed239a2f081c40d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/0*MfKIfDDk2v29kGg4.png"/></div></figure><ul class=""><li id="d682" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">点击“创建名称空间”,给你的数据库取一个合适的名字</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/2fc687823aa96259b75a290066197137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9xnvT6IY5PnlHYQu.png"/></div></div></figure><ul class=""><li id="d590" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">回到您员工的仪表板，导航到“设置”选项卡，点击“变量”部分</li><li id="e0ee" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">向下滚动到“KV 名称空间绑定”部分，并选择您新创建的 KV 名称空间</li><li id="8d9e" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">为您的命名空间提供一个变量名，您将使用它来访问数据。最好是像“DB”这样的缩写</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oh"><img src="../Images/c4f6865a70ecbeb1e746d8bd5c2ac7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y4cEhxY0kryvpI00.png"/></div></div></figure><ul class=""><li id="0d47" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">点击“保存”，让我们回到我们的代码(工人的仪表板&gt;快速编辑)</li></ul><h2 id="21bd" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.创建 CRUD 操作</h2><p id="1f4b" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">回到我们的代码，我们能够通过刚才设置的变量名来访问 KV 名称空间。对于本教程的其余部分，我将使用' DB '来访问我的 KV 名称空间，因为这是我定义的变量名，但它可以是您设置的任何名称。</p><p id="6013" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">由于 KV 是一个键值对存储，我们将使用键作为我们的表名(例如“todos”、“users”等)，值作为 JSON 数组(例如[“one”、“two”、“three”])。这意味着在我们的 KV 名称空间中，我们可以为更复杂的应用程序提供多个表。</p><p id="8647" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">让我们从让我们的 API 为一组用户执行 CRUD 操作开始。</p><h2 id="0691" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.1.发布请求</h2><p id="f346" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在我们的 POST 请求中，我们希望接收一个包含用户数据的有效 JSON 负载，并将其存储在“users”键值对中。</p><ul class=""><li id="37a9" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">让我们创建一个新的函数来处理 post 请求:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="638c" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">为了在 POST 请求中获得 JSON 有效负载，我们可以使用<code class="fe nq nr ns nt b">const payload = await request.json()</code></li><li id="7e3d" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">接下来，我们将获取“users”键的值，将有效负载附加到“users”数据的末尾，并将数据保存回“users”键。我们可以使用<code class="fe nq nr ns nt b">await env.DB.get(key)</code>和<code class="fe nq nr ns nt b">await env.DB.put(key, value)</code>与我们的数据库交互。注意，由于“用户”数据存储为字符串，我们还必须执行一些<code class="fe nq nr ns nt b">JSON.stringify / JSON.parse</code>操作</li><li id="62f8" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">post 的最终代码如下:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><blockquote class="nu nv nw"><p id="7498" class="ll lm nx ln b lo mj jo lq lr mk jr lt ny nz lw lx oa ob ma mb oc od me mf mg ig bi translated">注意，我已经添加了一个额外的检查，如果键“users”不存在，<code class="fe nq nr ns nt b">dataStr</code>将为空，我们希望将它设置为一个空数组，以便可以推送和设置新的有效载荷，从而将数据初始化为一个数组。</p></blockquote><ul class=""><li id="ba66" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">现在，让我们更新开关的情况来调用这个函数</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="e7eb" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.2 获取请求</h2><p id="8710" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在我们的 GET 请求中，让我们从“users”键中检索 JSON 数组并返回它。</p><ul class=""><li id="009a" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">让我们创建一个新函数来处理 GET 请求:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="7af0" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">这个逻辑实际上已经在<code class="fe nq nr ns nt b">handlePost</code>函数中实现了，所以让我们重用它们</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="538e" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">让我们更新开关的情况</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4871" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">现在我们有了创建新用户并查看他们的方法。让我们测试一下</p><ul class=""><li id="c692" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">在右边，将 HTTP 方法改为 POST，让我们定义我们的有效负载<code class="fe nq nr ns nt b">{"id": 1, "firstname": "John", "lastname": "Smith"}</code></li><li id="9a4d" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">当我们发送请求时，我们应该看到:</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/5541b97cf0cc60480dd2a12a69b5211c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dUdWDzPCRfgoUS-I.png"/></div></div></figure><ul class=""><li id="8706" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">正如所料，我们的 POST api 返回了我们发送的有效载荷，并以 201 作为响应。</li><li id="e324" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">现在，让我们尝试 GET 请求，看看我们的新用户是否已被保存。</li><li id="6aeb" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">将 HTTP 方法更改为 GET，然后单击“Send ”,我们应该会看到以下内容:</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oj"><img src="../Images/9814bfe4c93f358cc68d5f69efad380d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NMpAjhTHzYpKg--5.png"/></div></div></figure><ul class=""><li id="183f" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">万岁！我们的 GET 方法在一个数组中返回我们新添加的用户。</li><li id="8d0c" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">现在尝试再添加一个用户，看看它是否被保存。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/12640cc4075c34b0c293fa12b35117f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CKmZRI-zxvbJlwW4.png"/></div></div></figure><ul class=""><li id="4c5c" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">厉害！现在我们可以创建和读取我们的 API</li></ul><p id="8d30" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">在这个阶段，您的代码应该如下所示</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/c2ed9c736b14d44faa787b890260eafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Xqh7IvQO0an3GYR-_XJhw.png"/></div></div></figure><h2 id="95e3" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.3.买一个</h2><p id="6925" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在继续上传和删除之前，我们需要首先找到一种方法来查询 DB 中的单个对象。这样我们就可以在数组中获取一个对象，更新和删除它。</p><p id="a68f" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">为此，我们将向我们的 API 调用(例如<code class="fe nq nr ns nt b">https://serverless-demo.kevc.workers.dev/?id=1</code>)添加一个查询，并使用它来查找我们的对象。</p><ul class=""><li id="3b4a" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">让我们修改我们的<code class="fe nq nr ns nt b">handleRequest</code>函数来获得 id。</li><li id="984d" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">在<code class="fe nq nr ns nt b">const { method } = request</code>中，添加<code class="fe nq nr ns nt b">url</code>作为我们想从请求对象中获取的附加对象。(<code class="fe nq nr ns nt b">const { method, url } = request</code>)</li><li id="e323" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">使用<code class="fe nq nr ns nt b">url</code>，添加<code class="fe nq nr ns nt b">const { searchParams } = new URL(url)</code>来获得 URL 的查询。</li><li id="23de" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">要获得 id，我们可以使用<code class="fe nq nr ns nt b">const id = searchParams.get('id')</code>。</li><li id="0abf" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">您的前 3 行<code class="fe nq nr ns nt b">handleRequest</code>现在应该看起来像这样</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="no np l"/></div></figure><ul class=""><li id="2dad" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">有了这个<code class="fe nq nr ns nt b">id</code>，让我们把它作为第三个参数传递给我们的<code class="fe nq nr ns nt b">handleGet</code>函数。<code class="fe nq nr ns nt b">case "GET": return await handleGet(request, env, id)</code></li><li id="99d4" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">在<code class="fe nq nr ns nt b">handleGet</code>函数中，我们希望返回与 id 匹配的特定项目，如果没有提供 id，我们希望返回全部，如果找不到 id，我们希望返回 404 not found。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/a0c6d253978cfb2cb59e386381156694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbWwsI9K84gixvmDgGA3iA.png"/></div></div></figure><ul class=""><li id="9696" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">现在，如果您尝试 id 为(<code class="fe nq nr ns nt b">https://serverless-demo.kevc.workers.dev/?id=1</code>)的 GET 请求，您应该得到单个对象。</li></ul><h2 id="f460" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.4.上传请求</h2><ul class=""><li id="4d70" class="mh mi in ln b lo lp lr ls lu ne ly nf mc ng mg mo mp mq mr bi translated">对于 PUT 请求，我们需要一个 ID 和一个有效负载，我们将使用它来覆盖数据库中的匹配对象。</li><li id="35f4" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">所以我们需要来自<code class="fe nq nr ns nt b">searchParams</code>的 ID，来自<code class="fe nq nr ns nt b">request.json()</code>的 json 有效负载</li><li id="b535" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated">我们获取“users”JSON 数组，找到与 ID 匹配的相应对象，用有效负载中的对象替换该对象，保存更改，并将有效负载返回给用户。</li><li id="b71b" class="mh mi in ln b lo nh lr ni lu nj ly nk mc nl mg mo mp mq mr bi translated"><code class="fe nq nr ns nt b">handlePut</code>函数应该是这样的:</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/7236f070455c10c567d1d4bbedd4c1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_IWDWoIQ5XHl4d93rctpQ.png"/></div></div></figure><h2 id="f46e" class="ms ku in bd kv mt mu dn kz mv mw dp ld lu mx my lf ly mz na lh mc nb nc lj nd bi translated">4.5.删除请求</h2><ul class=""><li id="826b" class="mh mi in ln b lo lp lr ls lu ne ly nf mc ng mg mo mp mq mr bi translated">对于 delete，它类似于 PUT，但是不是替换，而是使用<code class="fe nq nr ns nt b">splice</code>方法从数组中删除该元素，并返回拼接的元素作为响应</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/55cc6562485e2328b4c4a7c2fc078689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_sLO_1CXghnI9F6vX0mgQ.png"/></div></div></figure><ul class=""><li id="1e6d" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">现在，您应该能够通过使用查询参数(<code class="fe nq nr ns nt b">https://serverless-demo.kevc.workers.dev/?id=1</code>)来删除使用 ID 作为标识符的元素了</li></ul><h1 id="03e4" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">最终代码</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/e57529b53174234a316f81582cf19514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SR8FEpLOGwVDtPvBbo-MFw.png"/></div></div></figure><p id="0466" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">正如你所看到的，有很多地方代码是重复的，但是我特意把它留在这里，这样你就能理解函数的逻辑。下面是更优化的代码版本:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/8d6998ed6fdf6e328d5a65e5aaa5f18c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdHQNKJCCPxDp45nt0GAYw.png"/></div></div></figure><p id="d1cb" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu nz lw lx ly ob ma mb mc od me mf mg ig bi translated">我希望你已经从本教程中学到了一些东西，如果你面临任何问题，请随时发表评论，并让我知道你下一步想学什么！</p></div></div>    
</body>
</html>