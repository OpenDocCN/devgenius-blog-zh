<html>
<head>
<title>Jasmine — Custom Spies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">茉莉花-海关间谍</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/jasmine-custom-spies-9022b163530a?source=collection_archive---------0-----------------------#2020-11-12">https://blog.devgenius.io/jasmine-custom-spies-9022b163530a?source=collection_archive---------0-----------------------#2020-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9ab255b2400d240a150160bf21eedea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EFK0vkIPObWPV2Wp"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">沃洛德梅尔·赫里先科在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="bef0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试是JavaScript的一个重要部分。</p><p id="6eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何创建自定义间谍。</p><h1 id="fca4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">海关间谍</h1><p id="02e3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">jasmine.setDefaultSpyStrategy</code>来创造一个做我们想做的事情的间谍。</p><p id="ccd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f1de" class="mq lc iq mh b gy mr ms l mt mu">describe("spy tests", function () {<br/>  beforeEach(function () {<br/>    jasmine.setDefaultSpyStrategy(and =&gt; and.returnValue("Hello World"));<br/>  });</span><span id="4630" class="mq lc iq mh b gy mv ms l mt mu">  it('calls custom spy', function () {<br/>    const spy = jasmine.createSpy();<br/>    expect(spy()).toEqual("Hello World");<br/>  });<br/>});</span></pre><p id="4b6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用返回<code class="fe me mf mg mh b">'Hello World'</code>值的回调函数调用了<code class="fe me mf mg mh b">setDefaultSpyStrategy</code>。</p><p id="e9b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们这样做了，我们的间谍就会返回<code class="fe me mf mg mh b">'Hello world'</code>。</p><p id="81f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以当我们调用<code class="fe me mf mg mh b">spy</code>时，它返回<code class="fe me mf mg mh b">'Hello World'</code>。</p><p id="748d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以不带参数地调用<code class="fe me mf mg mh b">setDefaultSpyStrategy</code>来删除一个定制的默认值。</p><p id="09b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="dac6" class="mq lc iq mh b gy mr ms l mt mu">describe("spy tests", function () {<br/>  beforeEach(function () {<br/>    jasmine.setDefaultSpyStrategy(and =&gt; and.returnValue("Hello World"));<br/>  });</span><span id="1abe" class="mq lc iq mh b gy mv ms l mt mu">  it('calls custom spy', function () {<br/>    const spy = jasmine.createSpy();<br/>    expect(spy()).toEqual("Hello World");<br/>  });</span><span id="8246" class="mq lc iq mh b gy mv ms l mt mu">  it("throws if you call any methods", function () {<br/>    jasmine.setDefaultSpyStrategy(and =&gt; and.throwError(new Error("Do Not Call Me")));<br/>    const program = jasmine.createSpyObj(['start']);<br/>    jasmine.setDefaultSpyStrategy();</span><span id="2dc3" class="mq lc iq mh b gy mv ms l mt mu">    expect(() =&gt; {<br/>      program.start();<br/>    }).toThrowError("Do Not Call Me");<br/>  });<br/>});</span></pre><p id="f132" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在第二个测试中调用了<code class="fe me mf mg mh b">createSpyObj</code>，在<code class="fe me mf mg mh b">porgram</code> spy对象中包含了一个<code class="fe me mf mg mh b">'start'</code>方法。</p><p id="56c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过调用<code class="fe me mf mg mh b">start</code>来检查是否抛出了错误。</p><h1 id="378f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">窥探财产</h1><p id="5dce" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">spyOnProperty</code>方法对属性进行spu。</p><p id="ec82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="28da" class="mq lc iq mh b gy mr ms l mt mu">describe("property spy test", function () {<br/>  let someObject = {<br/>    get myValue() {<br/>      return 1<br/>    }<br/>  };</span><span id="9372" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(function () {<br/>    this.propertySpy = spyOnProperty(someObject, "myValue", "get").and.returnValue(1);<br/>  });</span><span id="2ccf" class="mq lc iq mh b gy mv ms l mt mu">  it("lets you change the spy strategy later", function () {<br/>    this.propertySpy.and.returnValue(3);<br/>    expect(someObject.myValue).toEqual(3);<br/>  });<br/>});</span></pre><p id="5959" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">myValue</code> getter创建了一个<code class="fe me mf mg mh b">someObject</code>来返回一些东西。</p><p id="1406" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">beforeEach</code>钩子中，我们调用<code class="fe me mf mg mh b">spyOnPropoerty</code>窥探对象，返回我们想要的嘲讽值。</p><p id="c1eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的测试中，我们调用了<code class="fe me mf mg mh b">returnValue</code>让getter返回另一个值。</p><p id="cf4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以检查刚刚设置的返回值。</p><p id="367a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过传入一个属性散列来窥探一个具有多个属性的对象。</p><p id="1966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2c45" class="mq lc iq mh b gy mr ms l mt mu">describe("property spy test", function () {<br/>  it("lets you change the spy strategy later", function () {<br/>    const obj = jasmine.createSpyObj("myObject", {}, { x: 3, y: 4 });<br/>    expect(obj.x).toEqual(3);</span><span id="6889" class="mq lc iq mh b gy mv ms l mt mu">    Object.getOwnPropertyDescriptor(obj, "x").get.and.returnValue(7);<br/>    expect(obj.x).toEqual(7);<br/>  });<br/>});</span></pre><p id="0b4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建一个具有一些属性的间谍对象。</p><p id="790d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它具有<code class="fe me mf mg mh b">x</code>和<code class="fe me mf mg mh b">y</code>属性。</p><p id="0a00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以检查<code class="fe me mf mg mh b">obj.x</code>并返回我们想要的值。</p><p id="0584" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以检查一下。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/f1355f26f488c7d79249b9c528309268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3gf3NwG0axVE1hVE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@richwilliamsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">里奇·史密斯</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="696b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="da4f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">窥探对象和返回值有不同的方法。</p><p id="3a63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以创建间谍对象并将间谍策略设置为我们想要的。</p></div></div>    
</body>
</html>