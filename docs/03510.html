<html>
<head>
<title>Vue 3 — Mixin Merging and Directives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue 3 — Mixin 合并和指令</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/vue-3-mixin-merging-and-directives-886d09e403f7?source=collection_archive---------5-----------------------#2020-11-13">https://blog.devgenius.io/vue-3-mixin-merging-and-directives-886d09e403f7?source=collection_archive---------5-----------------------#2020-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/516897b4c6ffb4319e4efbbc6afcf88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*44RNfKH99-Hgs2Cn"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">艾伦·尼格伦在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="eb64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> Vue 3 处于测试阶段，可能会有变化。</strong></p><p id="d5d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue 3 是 Vue 前端框架的最新版本。</p><p id="1584" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它建立在 Vue 2 的普及性和易用性之上。</p><p id="577f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何改变 mixin 合并策略和定制指令。</p><h1 id="40ae" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自定义选项合并策略</h1><p id="6966" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以改变 Vue 实例选项合并策略。</p><p id="1e88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="583a" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p&gt;app&lt;/p&gt;<br/>    &lt;/div&gt;</span><span id="9d23" class="mn lc iq mj b gy ms mp l mq mr">    &lt;script&gt;<br/>      const app = Vue.createApp({<br/>        foo: "bar"<br/>      });</span><span id="1cf2" class="mn lc iq mj b gy ms mp l mq mr">      app.config.optionMergeStrategies.foo = (toVal, fromVal) =&gt; {<br/>        return toVal || fromVal;<br/>      };</span><span id="b2c9" class="mn lc iq mj b gy ms mp l mq mr">      app.mixin({<br/>        foo: "baz",<br/>        created() {<br/>          console.log(this.$options.foo);<br/>        }<br/>      });</span><span id="4d37" class="mn lc iq mj b gy ms mp l mq mr">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="fce2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更改<code class="fe mt mu mv mj b">foo</code>属性的选项合并属性。</p><p id="945c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果存在的话，我们返回<code class="fe mt mu mv mj b">toVal</code>。<code class="fe mt mu mv mj b">toVal</code>是 mixin 的值。</p><p id="018b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们返回<code class="fe mt mu mv mj b">fromVal</code>。<code class="fe mt mu mv mj b">fromVal</code>是组件的值。</p><p id="3e11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，<code class="fe mt mu mv mj b">created</code>方法中的控制台日志会显示<code class="fe mt mu mv mj b">'baz'</code>。</p><p id="14db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">this.$options.foo</code>有 Vue 组件选项。</p><p id="0d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Mixins 是 Vue 2 中提取应用程序可重用部分的主要工具。</p><p id="6d56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是它们容易发生冲突，可重用性有限。</p><p id="65da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不能向 mixin 传递任何参数来改变逻辑，这会降低它们的灵活性。</p><h1 id="e6d1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">指令</h1><p id="b97d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Directives 是让我们直接操作 DOM 的 Vue 代码。</p><p id="6e24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue 有很多内置的指令，比如<code class="fe mt mu mv mj b">v-model</code>和<code class="fe mt mu mv mj b">v-show</code>，让我们可以做很多事情。</p><p id="a8da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以创建自己的指令，让我们做我们想做的事情。</p><p id="72ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8214" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;input v-focus /&gt;<br/>    &lt;/div&gt;</span><span id="b485" class="mn lc iq mj b gy ms mp l mq mr">    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="501f" class="mn lc iq mj b gy ms mp l mq mr">      app.directive("focus", {<br/>        mounted(el) {<br/>          el.focus();<br/>        }<br/>      });</span><span id="e18b" class="mn lc iq mj b gy ms mp l mq mr">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2ce1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个<code class="fe mt mu mv mj b">focus</code>指令，让我们在安装组件时关注它所应用的元素。</p><p id="acbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">el</code>是指令应用到的元素的 DOM element 对象。</p><p id="b7d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须在模板中添加前缀<code class="fe mt mu mv mj b">v-</code>，这样我们就可以使用它了。</p><p id="6d86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这避免了与其他属性的冲突。</p><h1 id="06eb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">钩子函数</h1><p id="42d6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Vue 指令有各种钩子函数。</p><p id="15b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">beforeMount</code>当指令第一次绑定到元素时，在装载父组件之前调用。</p><p id="c0e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们进行初始化的地方。</p><p id="1dd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当绑定元素的父组件被挂载时，调用<code class="fe mt mu mv mj b">mounted</code>。</p><p id="62a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在包含组件的 VNode 更新之前调用<code class="fe mt mu mv mj b">beforeUpdate</code>。</p><p id="bcfb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当包含组件的 VNode 及其子组件的 VNode 被更新时，调用<code class="fe mt mu mv mj b">updated</code>。</p><p id="b255" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在卸载绑定元素的父组件之前调用<code class="fe mt mu mv mj b">beforeUnmount</code>。</p><p id="38f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当指令与元素解除绑定并且父元素的组件被卸载时，调用<code class="fe mt mu mv mj b">unmounted</code>。</p><p id="3dbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">指令可以接受参数。</p><p id="0d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a122" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;p v-size="50"&gt;foo&lt;/p&gt;<br/>    &lt;/div&gt;</span><span id="00a0" class="mn lc iq mj b gy ms mp l mq mr">    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="6675" class="mn lc iq mj b gy ms mp l mq mr">      app.directive("size", {<br/>        mounted(el, binding) {<br/>          el.style.fontSize = `${binding.value}px`;<br/>        }<br/>      });</span><span id="0f0a" class="mn lc iq mj b gy ms mp l mq mr">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="342c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建<code class="fe mt mu mv mj b">size</code>指令来设置内容的字体大小。</p><p id="2d58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">binding.value</code>具有我们传递到指令中的值。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/731e5d87ac2db5118c03124441800670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_9EmqsOrDAArYGKB"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@mahiruysal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马希尔·云萨尔</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="d349" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="a584" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Mixin 合并行为可以改变。</p><p id="8d08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以创建新的指令来直接操作 DOM 元素。</p></div></div>    
</body>
</html>