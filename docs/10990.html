<html>
<head>
<title>MEAN stack with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 Docker 的平均堆栈</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mean-stack-with-docker-904dfef68606?source=collection_archive---------8-----------------------#2022-12-12">https://blog.devgenius.io/mean-stack-with-docker-904dfef68606?source=collection_archive---------8-----------------------#2022-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4f7f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里，我如何实现<strong class="jm io">意味着</strong>栈与<strong class="jm io"> Docker </strong>，意味着代表 MongoDb、ExpressJs、Angular 和 NodeJs。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2aec3c3bbe5ab5ee1d1418dbe206e250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgxgVuVwrt9JuiXCXyTvZw.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="81b7" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">什么是 Docker…？</h2><p id="344a" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">Docker 是一个开发、发布和运行应用程序的开放平台。它提供了在松散隔离的环境(称为容器)中打包和运行应用程序的能力。容器非常适合持续集成和持续交付(CI/CD)工作流。</p><p id="50da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更多信息请参考:<a class="ae lz" href="https://docs.docker.com/get-started/overview/#the-docker-platform" rel="noopener ugc nofollow" target="_blank">https://docs . docker . com/get-started/overview/# the-docker-platform</a></p><h2 id="7a9e" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">实现框图</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/9836eb955aee9bd08a841ab11bec9120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*m5I93Bp41qfeXGIxhP4uBw.jpeg"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="e106" class="mb lc in bd ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr bi translated">所以我们开始吧！！</h1><h2 id="35b3" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">安装和运行 Docker</h2><p id="33e8" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">我的笔记本电脑安装了 ubuntu 20.04 操作系统，所以我只安装了 docker 引擎:<a class="ae lz" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/install/</a></p><p id="2bce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们也可以试试桌面版的 linux 或者 windows 或者 MAC:<a class="ae lz" href="https://docs.docker.com/desktop/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/desktop/</a></p><p id="0962" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要检查安装，请键入:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="8db4" class="mx lc in mt b be my mz l na nb">$ sudo docker info<br/> Client:<br/>  Context:    default<br/>  Debug Mode: false<br/>  Plugins:<br/>  ...<br/> Server:<br/>   Containers: 3<br/>   Running: 2<br/>   Paused: 0...<br/><br/>##.....some useful command...##<br/>$ docker image ls   #-&gt; will display all available images<br/>$ docker container ls #-&gt; will diplay all active containers<br/>$ docker image rm &lt;ImageId&gt; #-&gt; will remove image<br/>$ docker container (stop or rm) #-&gt; will stop or remove container</span></pre><p id="1a07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Docker 以 root 权限安装，去掉 sudo 跟随链接:<a class="ae lz" href="https://docs.docker.com/install/linux/linux-postinstall/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/install/linux/linux-postinstall/</a></p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="5f28" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">通过 Docker 运行 MongoDB 服务器映像</h2><p id="f45a" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">从 docker 官方页面拉蒙哥图片:<a class="ae lz" href="https://hub.docker.com/_/mongo" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/_/mongo</a></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="f894" class="mx lc in mt b be my mz l na nb">$ docker pull mongo  #-&gt; will pull mongo image <br/>$ docker image ls<br/>   ...<br/>   mongo               latest    0850fead9327   2 days ago      700MB<br/>   hello-world         latest    feb5d9fea6a5   14 months ago   13.3kB<br/><br/>## Run the container..<br/>$ docker run --name mongo_container -p 3000:27017 -v ./mongoData:/data/db mongo<br/>  ...<br/>  2022-12-07T16:14:46.306+0000 I CONTROL  [main] Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols 'none'<br/>  2022-12-07T16:14:46.311+0000 I CONTROL  [initandlisten] MongoDB starting : pid=1 port=27017 dbpath=/data/db 64-bit host=0b26e5b03843<br/>  2022-12-07T16:14:47.677+0000 I CONTROL  [initandlisten] <br/>  ...</span></pre><p id="3981" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">论据详情:</strong></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="b7d7" class="mx lc in mt b be my mz l nc nb">" --name " -&gt; Name of the container<br/>" -p " -&gt;     Host machine mapping port : Container expose port<br/>" -v " -&gt; Host machine mount point path : Container data folder path</span></pre><p id="b397" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以用端口<strong class="jm io"> 3000 从<strong class="jm io">主机</strong> <strong class="jm io">机器</strong>连接 mongo Db 连接。</strong>它还将用户信息存储在<strong class="jm io">【用户】</strong>集合中，例如:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="efec" class="mx lc in mt b be my mz l na nb">{<br/>  "nickname":"&lt;string&gt;",<br/>  "username":"&lt;string&gt;",<br/>  "password":"&lt;string&gt;"<br/>}</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="c567" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">运行 Nodejs 服务器映像</h2><p id="1bee" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">我已经为 node app 创建了一个<strong class="jm io"> Dockerfile </strong>。Docker 文件看起来像:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="4cdc" class="mx lc in mt b be my mz l nc nb">FROM node:16.18.1       #-&gt; Pull node:16.18.1 image from docker-hub repo<br/>RUN mkdir -p /usr/src/app #-&gt; Create folder in container<br/>COPY . /usr/src/app/    #-&gt; Copy all code from host machine current path to container folder<br/>WORKDIR /usr/src/app<br/>RUN ls -al<br/>RUN npm install    #-&gt; install all node package in container<br/>EXPOSE 4000        #-&gt; Expose the port 4000 of container<br/>CMD ["node", "index.js"]   #-&gt; Run the command in container</span></pre><p id="5df8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">节点 app </strong>的所有代码都在<strong class="jm io">节点-服务器</strong>文件夹下的<a class="ae lz" href="https://github.com/rohitCodeRed/mean-stack-docker-image" rel="noopener ugc nofollow" target="_blank"><em class="nd">https://github.com/rohitCodeRed/mean-stack-docker-image</em></a>中。</p><p id="8469" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用于构建节点服务器应用程序映像的命令。</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="b47f" class="mx lc in mt b be my mz l na nb">$ docker build -t node_server_image .  #-&gt; assuming you are folder "node-server"<br/>  ...  <br/>  Sending build context to Docker daemon 29.58 MB<br/>  Step 1/6 : FROM node:14.15.4<br/>  8: Pulling from library/node<br/>  Digest: sha256:3422df4f7532b26b55275ad7b6dc17ec35f77192b04ce22e62e43541f3d28eb3<br/>  Status: Downloaded newer image for node:16.18.1<br/>   ---&gt; 8198006b2b57<br/>  ...</span></pre><p id="3df9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">让我们运行容器</strong></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="46d4" class="mx lc in mt b be my mz l na nb">$ docker run --rm --name node_server_container -p 4000:4000 node_server_image<br/>  Example app listening on port: 4000<br/>  Mongo DB connection error: </span></pre><p id="e099" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在 Nodejs 服务器运行在<a class="ae lz" href="http://localhost:3001/" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>4000/</p><p id="a88e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的示例中，由于“<strong class="jm io"> mongo_container </strong>”未与“<strong class="jm io"> node_server_container”链接，导致 mongoDb 连接错误。</strong>让链接它，运行它。</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="97af" class="mx lc in mt b be my mz l na nb">$ docker run --rm --name node_server_container -p 4000:4000 --link=mongo_container:db node_server_image<br/>  Example app listening on port: 4000<br/><br/>  **-----------MongoDB connection established------------**<br/>   DB: Chart <br/>   Host: db <br/>   Port: 27017</span></pre><p id="8c54" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参数详细信息:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="7d1f" class="mx lc in mt b be my mz l nc nb">" --link " -&gt; Container name which link to : with hostname of container<br/><br/>node_server_container can connect to mongo_container with hostname="db"</span></pre><p id="d4cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在带有 Express framework 的节点服务器运行在<a class="ae lz" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank"> http://localhost:4000 </a>上，并连接了 mongodb 连接。</p><p id="dc2c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它为<strong class="jm io">主页</strong> <strong class="jm io">页面</strong>提供静态服务器信息，例如机器名称、cpu 数量、硬件信息等。</p><p id="33be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">也有用户<strong class="jm io">注册</strong>、<strong class="jm io">登录</strong>和<strong class="jm io">注销</strong>的端点:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="3066" class="mx lc in mt b be my mz l na nb">'http://localhost:4000/api/user/loggedIn'<br/>'http://localhost:4000/api/user/loggedOut'<br/>'http://localhost:4000/api/user/register'<br/></span></pre><h2 id="b460" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">节点服务器的快照</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/bfd5cb43fa4acb55737bab8f0449b84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WuCBnq1LbXC1OaWU-pk7Qw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/86d72f9adecb4e9ccc25a7a580c7ee06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2lAOgVay9-C8MjjGei_HRg.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="91d9" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">运行角度应用程序映像</h2><ul class=""><li id="03ec" class="nf ng in jm b jn lu jr lv jv nh jz ni kd nj kh nk nl nm nn bi translated">用<strong class="jm io"> angular:15 </strong>创建了一个简单的 angular app，里面有<strong class="jm io">登录页面</strong>和总览页面<strong class="jm io">动态线图</strong>和一个<strong class="jm io">甜甜圈。</strong></li><li id="6917" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">为了认证用户，将调用 REST API "<strong class="jm io">/API/user/logged in</strong>"，进行注册:"<strong class="jm io"> /api/user/register </strong>"</li></ul><p id="1db2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">代码回购:<a class="ae lz" href="https://github.com/rohitCodeRed/mean-stack-docker-image" rel="noopener ugc nofollow" target="_blank"><em class="nd">https://github.com/rohitCodeRed/mean-stack-docker-image</em></a>文件夹名称:-“<strong class="jm io">angular-app</strong>”。</p><p id="4439" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有关安装指南，请遵循:<a class="ae lz" href="https://angular.io/guide/setup-local" rel="noopener ugc nofollow" target="_blank">https://angular.io/guide/setup-local</a></p><p id="798f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">docker 文件创建</strong></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="ab84" class="mx lc in mt b be my mz l na nb">FROM nginx           #-&gt; pull nginx image for docker hub<br/>COPY nginx.conf /etc/nginx/conf.d/default.conf    #-&gt; Copy nginx.conf from current folder "angular-app" to container<br/>COPY dist/angular-app/ /usr/share/nginx/html     #-&gt; Copy all build files from folder "dist/angular-app/" to container<br/>EXPOSE 80</span></pre><p id="3315" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> nginx 配置</strong>文件看起来像:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="ff9f" class="mx lc in mt b be my mz l na nb">server {<br/>    listen 80;<br/>    location / {<br/>        root /usr/share/nginx/html;<br/>        index index.html index.htm;<br/>        try_files $uri $uri/ /index.html =404;<br/>    }<br/>}</span></pre><p id="83af" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在构建图像之前构建<strong class="jm io">角度应用</strong>:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="659b" class="mx lc in mt b be my mz l na nb">$ ng build<br/>  ...<br/>   ...<br/><br/>#-&gt; it will create folder ./dist/angular-app/ put all build file into this</span></pre><p id="bdd9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">构建角度应用程序图像:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="b33d" class="mx lc in mt b be my mz l na nb">$ docker build -t angular_app_image .         #-&gt; from current dirctory "angular-app"<br/>  ..<br/>  ..<br/><br/>#Run the container with build image<br/>$ docker run --rm --name angular_app_container -p 5000:80 angular_app_image  </span></pre><ul class=""><li id="4cc8" class="nf ng in jm b jn jo jr js jv nt jz nu kd nv kh nk nl nm nn bi translated">实际上这里的<strong class="jm io"> -p </strong>指定了端口<strong class="jm io">主机</strong> : <strong class="jm io">容器</strong>的映射。</li><li id="dc8d" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">这里我们不需要链接<strong class="jm io"> nodejs 容器</strong>，因为我们正在从主机的<strong class="jm io">网络浏览器</strong>运行 angular app。</li></ul><p id="861a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在运行在<a class="ae lz" href="http://localhost:4200/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>上。</p><h2 id="0c7f" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">Angular 应用的快照</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/c9a7811bc60486d35b448a73346c20e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhuXp1-YAejPpta3v7LQlg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/b3a098953f36a6e185a5f7ee3bc02a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kj_JuFFAtoVItlMI9jL6Ig.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/adb5531f89c5cf37f104b9d0924feeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m0w9iB1e6m2Vk9UqNsdR3Q.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="28f5" class="mb lc in bd ld mc md me lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr bi translated">从单个脚本构建映像并运行容器</h1><ul class=""><li id="e343" class="nf ng in jm b jn lu jr lv jv nh jz ni kd nj kh nk nl nm nn bi translated">创建了映像构建脚本，文件名:<strong class="jm io"> buildImage.sh </strong></li></ul><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="3939" class="mx lc in mt b be my mz l na nb"><br/>#!/bin/sh<br/><br/># Install docker, docker-compose and Node.<br/><br/># go to node server folder.<br/>cd node-server<br/><br/>## build the image with docker file<br/>docker build -t node_server_image .<br/><br/>cd ..<br/><br/><br/>#-----------Angular build started------------<br/>cd angular-app<br/><br/>npm install<br/><br/>##build angular project<br/>npx -p @angular/cli@15.0.3 ng build<br/><br/>## build the image with docker file<br/>docker build -t angular_app_image .<br/><br/>cd ..<br/><br/><br/>##create folder for data mount point<br/>mkdir ./dbData<br/><br/><br/><br/>##remove folder to clean space<br/>rm -rf angular-app/<br/><br/>rm -rf node-server/<br/><br/></span></pre><ul class=""><li id="cce2" class="nf ng in jm b jn jo jr js jv nt jz nu kd nv kh nk nl nm nn bi translated">创建了<strong class="jm io"> docker-compose.yml </strong>文件，更多信息如下:<a class="ae lz" href="https://docs.docker.com/compose/gettingstarted/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/compose/gettingstarted/</a></li></ul><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="ae66" class="mx lc in mt b be my mz l na nb">version: "3.3"<br/>services:<br/>  server:<br/>    container_name: node<br/>    image: node_server_image<br/>    restart: always<br/>    ports:<br/>      - "4000:4000"<br/>    depends_on:<br/>      - db<br/>  <br/>  db:<br/>    container_name: mongo<br/>    image: mongo<br/>    ports:<br/>      - "3000:27017"<br/>    volumes:<br/>      - ./dbData:/data/db<br/>  <br/>  web:<br/>    container_name: angular<br/>    image: angular_app_image<br/>    restart: always<br/>    ports:<br/>      - "5000:80"<br/>    depends_on:<br/>      - server</span></pre><ul class=""><li id="c11b" class="nf ng in jm b jn jo jr js jv nt jz nu kd nv kh nk nl nm nn bi translated">上面有三个服务<strong class="jm io">服务器</strong>、<strong class="jm io"> db 和 web，web </strong>服务依赖<strong class="jm io">服务器</strong>和<strong class="jm io">服务器</strong>服务<strong class="jm io"> </strong>依赖<strong class="jm io"> db 服务。</strong></li><li id="925e" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">所有三个服务都可以通过<strong class="jm io">缺省网络(&lt;项目目录&gt; _default) </strong>与它们的服务名相互通信。</li><li id="9a0c" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">默认网络由<strong class="jm io"> docker-compose up </strong>命令自动创建。https://docs.docker.com/compose/networking/<a class="ae lz" href="https://docs.docker.com/compose/networking/" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="7824" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建了<strong class="jm io"> startContainer.sh </strong>脚本，该脚本一次构建映像并运行容器:</p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="6d79" class="mx lc in mt b be my mz l na nb">#!/bin/sh<br/><br/>#run build image script<br/>sh buildImage.sh<br/><br/>## Finally run deployment script...<br/>docker-compose up</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="8959" class="lb lc in bd ld le lf dn lg lh li dp lj jv lk ll lm jz ln lo lp kd lq lr ls lt bi translated">在一个 o 中运行三个容器的步骤:</h2><p id="df63" class="pw-post-body-paragraph jk jl in jm b jn lu jp jq jr lv jt ju jv lw jx jy jz lx kb kc kd ly kf kg kh ig bi translated">克隆存储库:</p><ul class=""><li id="03b1" class="nf ng in jm b jn jo jr js jv nt jz nu kd nv kh nk nl nm nn bi translated">git 克隆<a class="ae lz" href="https://github.com/rohitCodeRed/mean-stack-docker-image/" rel="noopener ugc nofollow" target="_blank">https://github.com/rohitCodeRed/mean-stack-docker-image/</a></li><li id="5315" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">cd 均值-堆栈-docker-图像</li><li id="3fd8" class="nf ng in jm b jn no jr np jv nq jz nr kd ns kh nk nl nm nn bi translated">开始容器</li></ul><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="5898" class="mx lc in mt b be my mz l na nb">$ sh startContainer.sh<br/><br/>  Sending build context to Docker daemon  117.2kB<br/>  Step 1/8 : FROM node:16.18.1<br/>   ---&gt; 993a4cf9c1e8<br/>  Step 2/8 : RUN mkdir -p /usr/src/app<br/>   ---&gt; Running in d7f7d4a8c493<br/>  Removing intermediate container d7f7d4a8c493<br/>   ---&gt; 98faa00c2313<br/>  Step 3/8 : COPY . /usr/src/app/<br/>   ---&gt; 353e763a2703<br/>  ...<br/>  ..<br/>  Successfully built d845a572d1c2<br/>  Successfully tagged node_server_image:latest<br/>  ..<br/>  Removing intermediate container 7a0b063132a8<br/>   ---&gt; 60604dd294d2<br/>  Successfully built 60604dd294d2<br/>  Successfully tagged angular_app_image:latest<br/><br/>  ..<br/>  Creating mongo ... done<br/>  Creating node  ... done<br/>  Creating angular ... done<br/>  Attaching to mongo, node, angular<br/>  mongo     | {"t":{"$date":"2022-12-10T14:12:24.714+00:00"},"s":"I",  "c":"NETWORK",  "id":4915701, "ctx":"-","msg":"Initialized wire specificati<br/>  ...<br/>  angular   | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration  <br/>  ..<br/>  node      | <br/>  node      | **-----------MongoDB connection established------------**<br/>  node      |  DB: Chart <br/>  node      |  Host: db <br/>  node      |  Port: 27017<br/>  ..</span></pre><p id="addf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">图像列表:</strong></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="e9dc" class="mx lc in mt b be my mz l na nb">$ docker image ls<br/><br/>  REPOSITORY          TAG       IMAGE ID       CREATED         SIZE<br/>  angular_app_image   latest    60604dd294d2   46 hours ago    143MB<br/>  node_server_image   latest    d845a572d1c2   46 hours ago    939MB<br/>  mongo               latest    0850fead9327   3 days ago      700MB<br/>  node                16.18.1   993a4cf9c1e8   6 days ago      910MB<br/>  nginx               latest    ac8efec875ce   6 days ago      142MB<br/></span></pre><p id="e370" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">集装箱清单:</strong></p><pre class="kj kk kl km gt ms mt mu bn mv mw bi"><span id="29ce" class="mx lc in mt b be my mz l na nb">$ docker container ls<br/><br/>CONTAINER ID   IMAGE               COMMAND                  CREATED          STATUS          PORTS                                         NAMES<br/>491169cec5a3   angular_app_image   "/docker-entrypoint.…"   13 seconds ago   Up 13 seconds   0.0.0.0:5000-&gt;80/tcp, :::5000-&gt;80/tcp         angular<br/>23d875e998ba   node_server_image   "docker-entrypoint.s…"   14 seconds ago   Up 13 seconds   0.0.0.0:4000-&gt;4000/tcp, :::4000-&gt;4000/tcp     node<br/>370b8c448411   mongo               "docker-entrypoint.s…"   14 seconds ago   Up 14 seconds   0.0.0.0:3000-&gt;27017/tcp, :::3000-&gt;27017/tcp   mongo<br/></span></pre><p id="40af" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于所有代码，去我的 git 回购:<a class="ae lz" href="https://github.com/rohitCodeRed/mean-stack-docker-image/" rel="noopener ugc nofollow" target="_blank">https://github.com/rohitCodeRed/mean-stack-docker-image/</a></p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="902e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望这篇文章能对大家有所帮助。</p><p id="f642" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢阅读。</p></div></div>    
</body>
</html>