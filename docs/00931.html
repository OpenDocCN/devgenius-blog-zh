<html>
<head>
<title>Your custom build configurations and Cocoapods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您的定制构建配置和 Cocoapods</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/your-custom-build-configurations-and-cocoapods-86d4e2a17633?source=collection_archive---------0-----------------------#2020-06-20">https://blog.devgenius.io/your-custom-build-configurations-and-cocoapods-86d4e2a17633?source=collection_archive---------0-----------------------#2020-06-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="150a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于一个新的 iOS 项目，它提供了两个默认的构建配置调试和发布，但有时你需要更多。例如，在我的例子中，我想要一个用于临时分发的构建配置和一个测试构建配置来防止测试代码编译到其他构建中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/daaedff3a88706b30f2ed3bb4436dc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VsPoWwVvbJdn8sgyVEfYVQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在 swift 中测试宏</figcaption></figure><p id="b6d3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">示例:</p><p id="55cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我有宏控制来用一个假的实例替换实际的分析实例。</p><p id="726a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的应用程序特性被分解到由 Cocoapods 管理的多个框架中，在我的整个项目中有类似这样的测试宏。</p><p id="f323" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我开始运行集成到托管应用程序或目标应用程序的测试时，问题开始浮出水面，要么是编译失败，要么是使用了错误的构建设置或错误的实例。例如，测试性设置没有打开，单元测试失败。</p><p id="6d84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我和我的团队将<code class="fe ky kz la lb b">post_install</code>添加到 force 以启用可测试性，后来我们有了缓慢的构建时间，我们使用<code class="fe ky kz la lb b">post_install</code>来更改 SWIFT_OPTIMIZATION_LEVEL 设置。在几个<code class="fe ky kz la lb b">post_install</code>补丁之后，它似乎稳定了下来。然后我面临另一个 SWIFT _ ACTIVE _ COMPILATION _ CONDITIONS 的问题；它是空的，我的 QA 版本无法完成测试。现在我认为是时候了解发生了什么以及如何解决它。</p><h1 id="59a6" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">学习之旅</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/44bfd542e31eded820b05c0a6dcf6f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vlzwU2FPcHG_dGY7"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">帕特里克·托马索在<a class="ae mb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0084" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我试着在 google 上搜索关于使用 Cocoapods 的定制构建配置，但是没有多少。在阅读了几篇博客文章和 Cocoapods Github repo 问题以及没完没了地阅读 Cocoapods <a class="ae mb" href="https://guides.cocoapods.org/syntax/podfile.html" rel="noopener ugc nofollow" target="_blank"> Podfile 语法参考</a>之后，我终于发现了我所面临的问题。在 Podfile 语法参考中，它说</p><blockquote class="mc"><p id="7a8f" class="md me in bd mf mg mh mi mj mk ml kh dk translated">还可以指定您的定制构建配置的构建设置是否应该在发布或调试预置之后建模。为此，您需要指定一个散列，其中每个构建配置的名称都与<code class="fe ky kz la lb b">:release</code>或<code class="fe ky kz la lb b">:debug</code>相关联。</p></blockquote><p id="d53e" class="pw-post-body-paragraph jk jl in jm b jn mm jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd mq kf kg kh ig bi translated">我面临的问题是，Cocoapods 使用了<code class="fe ky kz la lb b">:release</code>配置，因为我没有在 Podfile 中指定它。显然，<code class="fe ky kz la lb b">:release</code>构建配置禁用了可测试性，优化设置为整个模块，等等。</p><p id="3bf5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我发现的另一个片段，我认为在这里值得一提。</p><blockquote class="mr ms mt"><p id="fd00" class="jk jl mu jm b jn jo jp jq jr js jt ju mv jw jx jy mw ka kb kc mx ke kf kg kh ig bi translated">为了使这个过程顺利运行，很明显，pod 和我们的项目必须以相同的方式配置。如果不是这样，我们可以在项目中调用库的方法，期望代码以某种方式运行，但是实际的代码会不同。</p><p id="9dfd" class="jk jl mu jm b jn jo jp jq jr js jt ju mv jw jx jy mw ka kb kc mx ke kf kg kh ig bi translated">👍经验法则是<strong class="jm io">pod 和我们的目标必须有相同的预处理器宏设置</strong>。</p><p id="9d8e" class="jk jl mu jm b jn jo jp jq jr js jt ju mv jw jx jy mw ka kb kc mx ke kf kg kh ig bi translated">Podfile 中的 Cocoapod 设置无法改变目标应用程序配置。</p></blockquote><p id="3b11" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我的例子中，我有测试和特别定制构建配置；我需要指定安装 pod 时，它应该在哪个构建设置后建模。所以我决定将调试映射到测试，将发布映射到临时。</p><p id="7631" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一个问题突然出现在我的脑海中，我如何随着时间的推移将我定制的调试或发布与测试和临时同步？那么另一个问题，我会自定义 pod 的调试或者发布设置吗？我将不得不把它留到下次，因为我需要解决我现在的问题。</p><h1 id="c87e" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">随身行李</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="90d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我知道了我的问题，也知道了解决办法。这是一个简单的修复，对不对？。让我们开始吧。</p><p id="b71e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我用托管应用程序做了一个新的 Cocoapods 库来测试。在我的测试 pod 文件中，我放置了推荐的设置<br/> <code class="fe ky kz la lb b">project 'BuildSettingDefault', 'Adhoc' =&gt; :release, 'Test' =&gt; :debug<br/></code>我运行 pod 安装，然后验证设置是否设置为正确的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/b38b3321ef3d8638a27ce32212b29d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W30nCOKQw6_9FpjAfd71Sg.png"/></div></div></figure><p id="1efa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我对我的项目做了同样的事情，但是它不起作用。😱</p><h2 id="5c6e" class="nb ld in bd le nc nd dn li ne nf dp lm jv ng nh lq jz ni nj lu kd nk nl ly nm bi translated">陷阱#1</h2><p id="d65b" class="pw-post-body-paragraph jk jl in jm b jn nn jp jq jr no jt ju jv np jx jy jz nq kb kc kd nr kf kg kh ig bi translated">如果在 Pod 文件的根级别有多个目标，那么请确保将项目设置放入每个目标块中。或者您可以将该行放在根位置，Podfile 的顶部，否则它将不起作用。</p><p id="f47c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我不记得为什么我和我的团队把所有的测试目标都放在外面，而不是像 Cocoapods 默认的那样嵌套在应用目标中。</p><h2 id="4882" class="nb ld in bd le nc nd dn li ne nf dp lm jv ng nh lq jz ni nj lu kd nk nl ly nm bi translated">陷阱#2</h2><p id="df50" class="pw-post-body-paragraph jk jl in jm b jn nn jp jq jr no jt ju jv np jx jy jz nq kb kc kd nr kf kg kh ig bi translated">现在我把项目设置放在根目录或正确的地方，我把 pod 和我所有的应用程序和框架重新整合并安装。当我检查设置(视觉)时，我发现了另一个陷阱。即使使用项目设置，也不能解决我的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5e5eab8a37fb13c7d7152b02b3049711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44lHyau0BrSpaIoqGTDZNw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">空设置</figcaption></figure><p id="be75" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">SWIFT _ ACTIVE _ COMPILATION _ CONDITIONS，GCC_PREPROCESSOR_DEFINITIONS 设置仍然没有设置正确的值。当安装包和某些值不在默认预设中时，调试或发布构建设置值。我仍然需要使用<code class="fe ky kz la lb b">post_install</code>来设置构建设置，它将是跨多个 Podfiles 的多个<code class="fe ky kz la lb b">post_install</code>。</p><p id="193f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此时，我想知道我之前提到的同一个问题，如何跨不同的框架应用构建设置。</p><p id="886c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将 post_install 函数复制粘贴到所有的 pod 文件中。在 6 个 pod 文件上运行 pod 解集成和 pod 安装是一个繁琐的过程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/cb9697682f84bdd88e31ce4e4b2b28a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2o6ztyYyBEceB-fZhmqWA.png"/></div></div></figure><h2 id="8838" class="nb ld in bd le nc nd dn li ne nf dp lm jv ng nh lq jz ni nj lu kd nk nl ly nm bi translated">陷阱#3</h2><p id="a477" class="pw-post-body-paragraph jk jl in jm b jn nn jp jq jr no jt ju jv np jx jy jz nq kb kc kd nr kf kg kh ig bi translated">运行 pod install 后，我再次检查该值，发现 post_install 从不应用 Pods-BuildSettingDefault _ Example，但是所有子项目的构建设置都设置正确。<strong class="jm io">注:</strong>我从 Cocoapods 1.8 开始开启了<code class="fe ky kz la lb b">multiple_pod_projects</code>和<code class="fe ky kz la lb b">incremental_installation</code>。</p><p id="51ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我认为<code class="fe ky kz la lb b">pod_target_subprojects</code>应该可以工作，因为我以前在某个地方见过它，也是我复制和使用它的原因😛</p><p id="74b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我想知道为什么，并开始另一轮阅读，然后我在评论区发现了另一颗宝石。</p><p id="afdc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于<code class="fe ky kz la lb b">multiple_pod_projects</code>和<code class="fe ky kz la lb b">incremental_installation</code>选项，我应该用<code class="fe ky kz la lb b">generated_projects</code>代替。</p><p id="d336" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作者的另一个提示:</p><blockquote class="mr ms mt"><p id="714f" class="jk jl mu jm b jn jo jp jq jr js jt ju mv jw jx jy mw ka kb kc mx ke kf kg kh ig bi translated"><em class="in">所以对于您的后安装钩子示例，用</em> <code class="fe ky kz la lb b"><em class="in">installer.generated_projects</em></code> <em class="in">替换</em> <code class="fe ky kz la lb b"><em class="in">installer.pods_project</em></code> <em class="in">应该可以防止任何异常。还值得注意的是，由于增量安装的性质，后安装挂钩可能不会应用于所有目标，因为我们只安装自上次安装以来发生更改的一组目标。因此，当添加一个新的 post install 挂钩，并希望立即应用于项目中的所有目标时，您应该将</em> <code class="fe ky kz la lb b"><em class="in">--clean-install</em></code> <em class="in">标志传递给</em> <code class="fe ky kz la lb b"><em class="in">pod install</em></code> <em class="in">或</em> <code class="fe ky kz la lb b"><em class="in">pod update</em></code> <em class="in">。</em></p></blockquote></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><p id="f36f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我将所有的知识应用到我的 Podfile 中；它像预期的那样工作。</p><ol class=""><li id="cda4" class="ob oc in jm b jn jo jr js jv od jz oe kd of kh og oh oi oj bi translated">将项目设置添加到 Podfile 的目标或根</li><li id="10ff" class="ob oc in jm b jn ok jr ol jv om jz on kd oo kh og oh oi oj bi translated">添加 post_install 函数，但使用 generated_projects。</li><li id="2f10" class="ob oc in jm b jn ok jr ol jv om jz on kd oo kh og oh oi oj bi translated">使用全新安装标志</li></ol><p id="b9b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望漫长的旅程即将结束。我找到了我的问题的答案，但同时在我的清单上添加了更多要解决的问题。回顾一下我在这个帖子中学到的东西，并没有那么难但是有很多粗心的错误。不管怎样，我享受积累知识和将小知识应用到工作中的每一刻。</p><h1 id="300c" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">参考文献</strong></h1><div class="op oq gp gr or os"><a href="https://www.mokacoding.com/blog/cocoapods-and-custom-build-configurations/" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd io gy z fp ox fr fs oy fu fw im bi translated">CocoaPods 和定制构建配置</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">如果你浏览一下这个博客里的帖子，你会发现我是椰子恐龙的忠实粉丝和拥护者。这真是一个…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">www.mokacoding.com</p></div></div></div></a></div><div class="op oq gp gr or os"><a href="https://github.com/CocoaPods/CocoaPods/issues/8739#issuecomment-487384110" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd io gy z fp ox fr fs oy fu fw im bi translated">将 generate_multiple_pod_projects 设置为 true 后，转换 post_install 挂钩问题#8739 …</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">解散 GitHub 是超过 5000 万开发者的家园，他们一起工作来托管和审查代码，管理项目，以及…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">github.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><div class="op oq gp gr or os"><a href="https://tworingsoft.com/blog/2018/02/15/cocoapods-custom-build-configurations.html" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd io gy z fp ox fr fs oy fu fw im bi translated">双环软件% Blog % CocoaPods 和定制构建配置% 15 2018 年 2 月</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">问题:我有一个应用程序的 Xcode 项目，除了调试和发布之外，还有许多自定义构建配置…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">tworingsoft.com</p></div></div></div></a></div></div></div>    
</body>
</html>