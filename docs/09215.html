<html>
<head>
<title>C# Code to Read Data from Sharepoint Online Lists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Sharepoint Online 列表读取数据的 C#代码</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/c-code-to-read-data-from-sharepoint-online-lists-9cea80032710?source=collection_archive---------5-----------------------#2022-08-07">https://blog.devgenius.io/c-code-to-read-data-from-sharepoint-online-lists-9cea80032710?source=collection_archive---------5-----------------------#2022-08-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/26d41e9888c5233a06e97b76423d8b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x5WVoe32noUX0cW9"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">图拉格摄影在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="1494" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Sharepoint 客户端库可用于读取、修改和删除 Sharepoint online 中的数据。尽管微软有关于如何使用代码示例库的优秀文档，但在 Sharepoint 上，数据可能是不同的格式，因此需要基于数据类型的不同读取方式。这些信息可以在文档中找到，但这需要一些时间和精力来找到它，还需要 Sharepoint 客户端库中不同类的先验知识。如果您只是想访问 Sharepoint 数据，而不了解 Sharepoint 客户端类是如何工作的，本文可能会节省一些时间。</p><div class="ky kz gp gr la lb"><a href="https://docs.microsoft.com/en-us/sharepoint/dev/sp-add-ins/complete-basic-operations-using-sharepoint-client-library-code" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">使用 SharePoint 客户端库代码完成基本操作</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">您可以使用 SharePoint 客户端对象模型(CSOM)来检索、更新和管理 SharePoint 中的数据。SharePoint…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">docs.microsoft.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jt lb"/></div></div></a></div><p id="710b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我将介绍 Sharepoint 列表最常用的数据类型，以及如何使用 Microsoft Sharepoint 客户端库读取它们。</p><p id="2d57" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">连接和认证</strong></p><p id="7f2a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将使用 PnP。使用 Sharepoint 进行连接和身份验证的框架。关于通过 PnP 框架连接的不同方式的更多信息可以在这里找到。</p><div class="ky kz gp gr la lb"><a href="https://github.com/pnp/pnpframework/blob/dev/docs/MigratingFromPnPSitesCore.md" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">PNP framework/migrating frompnpsitescore . MD at dev PNP/PNP framework</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">PnP 站点核心已经存档，不再维护，但是 PnP 框架包含了几乎所有的 PnP 站点…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">github.com</p></div></div><div class="lk l"><div class="lq l lm ln lo lk lp jt lb"/></div></div></a></div><p id="6491" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于认证，我将只使用应用程序认证(最新版本的认证)以及证书。更多信息可以在我之前的文章中找到。</p><div class="ky kz gp gr la lb"><a href="https://medium.com/@sujaykhandek/connect-to-sharepoint-online-using-azure-app-only-authentication-through-ssis-package-fbffce0d6365" rel="noopener follow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">通过 SSIS 包连接到 Sharepoint Online。</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">有不同的方法通过 SSIS 连接到 sharepoint，使用 sharepoint 列表源，使用 ODATA 源。但是…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">medium.com</p></div></div><div class="lk l"><div class="lr l lm ln lo lk lp jt lb"/></div></div></a></div><p id="3dde" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">连接/认证代码</strong></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="84e3" class="mb mc in lx b gy md me l mf mg">var cc = new PnP.Framework.AuthenticationManager("SharePointClientID","SharePointCertPath", "SharePointPassword",<br/>"SharePointDomain").GetContext("SharePointSiteURL");</span><span id="abd1" class="mb mc in lx b gy mh me l mf mg">List CMS = cc.Web.Lists.GetByTitle("SharePointList");</span></pre><p id="0744" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，您将需要“”中上述代码中的所有信息。所有的信息都可以在之前关于连接和认证的文章中找到。</p><p id="a507" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">从列表中读取所有行/字段</strong></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="a729" class="mb mc in lx b gy md me l mf mg">// Load all rows from the target list<br/>CamlQuery query = CamlQuery.CreateAllItemsQuery();<br/>ListItemCollection items = CMS.GetItems(query);<br/>cc.Load(items);<br/>cc.ExecuteQuery();</span><span id="d13a" class="mb mc in lx b gy mh me l mf mg">// Find all fields in the target list<br/>FieldCollection myFields = CMS.Fields;<br/>cc.Load(myFields);<br/>cc.ExecuteQuery();</span></pre><p id="cba1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述代码加载 sharepoint 特定列表类 items 和字段类 myFields 中的所有行。</p><p id="974c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了访问 Sharepoint 数据中的每一行，我将使用 for 循环。请不要忘记，下面循环的所有代码都应该在循环内部运行。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="51e5" class="mb mc in lx b gy md me l mf mg">foreach (ListItem listItem in items) {</span></pre><p id="480b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">在 SSIS 脚本中访问字符串/日期时间/双精度/布尔型字段并分配给变量。</strong></p><p id="64c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我使用 SSIS 从 Sharepoint 列表中读取数据，因此我将把从 Sharepoint 列表中读取的值赋给脚本组件的 SSIS 输出变量。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="a16c" class="mb mc in lx b gy md me l mf mg">Output0Buffer.outputStringVariable = Convert.ToString(listItem["string FieldName on sharepoint"]);</span><span id="69d6" class="mb mc in lx b gy mh me l mf mg">Output0Buffer.outputDatetimeVariable = Convert.ToDateTime(listItem["datetime FieldName on sharepoint"]);</span><span id="6889" class="mb mc in lx b gy mh me l mf mg">Output0Buffer.outputBooleanVariable = Convert.ToBoolean(listItem["boolean FieldName on sharepoint"]);</span><span id="b3ea" class="mb mc in lx b gy mh me l mf mg">Output0Buffer.outputDoubleVariable = Convert.ToDouble(listItem["Double FieldName on sharepoint"]);</span></pre><p id="535b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">访问字符串变量是最简单的，只需要将 listitem 转换成字符串。</p><p id="8ab2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">重要提示:</strong>如果你想访问包含空值的 float、boolean、datetime 类型的变量，那么，首先将它们转换为 string，然后显式地将它们转换为 cast 会更容易，因为使用 ToDatetime 或 ToDouble 会将空值转换为相应数据类型的默认值。</p><p id="fffa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">访问特殊的 Sharepoint 数据类型</strong></p><p id="4c02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">sharepoint 中有一些特殊的数据类型需要在访问它们之前进行显式转换，例如 FieldLookupValue[]、FieldLookupValue、FieldUserValue。这段代码应该适用于大多数特殊的数据类型。</p><p id="b8e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果是这种特殊数据类型的列表，即 FieldLookupValue[]，则</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="1ef7" class="mb mc in lx b gy md me l mf mg">public string GetLookupValue(ListItem listItem, string Name)<br/>    {<br/>        List&lt;string&gt; LookupField = new List&lt;string&gt;();<br/>        var LookupIdField = listItem[Name] as FieldLookupValue[];<br/><br/>        foreach (FieldLookupValue lookupValue in LookupIdField as FieldLookupValue[])<br/>        {<br/>            LookupField.Add(Convert.ToString(lookupValue.LookupId));<br/>            LookupField.Add(lookupValue.LookupValue);<br/>        }<br/>        string result = String.Join(";#", LookupField);<br/>        return result;<br/>    }</span><span id="33e6" class="mb mc in lx b gy mh me l mf mg">// this code will join loopupId and loopupvalue with ;# separator</span><span id="9cae" class="mb mc in lx b gy mh me l mf mg">// Inside the for loop above<br/>Output0Buffer.outputStringVariable = GetLookupValue(listItem, "FieldLookupValue FieldName on sharepoint");</span></pre><p id="ef89" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当它是单个特殊数据类型时，例如 FieldLookupValue，则</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="c6b2" class="mb mc in lx b gy md me l mf mg">public string GetSingleLookupValue(ListItem listItem, string Name)<br/>    {<br/>        string result = "";<br/>        var c = (FieldLookupValue)listItem[Name];<br/>        result = c.LookupId + ";#" + c.LookupValue;<br/>        return result;<br/>    }</span><span id="90ad" class="mb mc in lx b gy mh me l mf mg">// this code will join loopupId and loopupvalue with ;# separator</span><span id="7276" class="mb mc in lx b gy mh me l mf mg">// Inside the for loop above<br/>Output0Buffer.outputStringVariable = GetSingleLookupValue(listItem, "FieldLookupValue FieldName on sharepoint");</span></pre><p id="7cb8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于不同的数据类型，你只需要替换下面一行代码。例如，要访问 FieldUserValue 类型的数据而不是 FieldLookupValue 类型的数据，请在上面的代码块中使用这一行代码。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="6509" class="mb mc in lx b gy md me l mf mg">var c = (FieldUserValue)listItem[Name];</span></pre><p id="7506" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要了解不同的特殊数据类型，可以参考文档。</p><div class="ky kz gp gr la lb"><a href="https://docs.microsoft.com/en-us/previous-versions/office/sharepoint-csom/ee540961%28v=office.15%29" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">FieldLookupValue 类(Microsoft。SharePoint.Client)</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">升级到 Microsoft Edge 以利用最新的功能、安全更新和技术支持。</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">docs.microsoft.com</p></div></div><div class="lk l"><div class="mi l lm ln lo lk lp jt lb"/></div></div></a></div><p id="1a86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望这对某人有帮助。我知道这是一个非常具体的话题，但微软目前还没有一个 sharepoint online connector 支持他们在 SSIS 的最新身份验证方法，所以我花了一些时间和阅读了多个文档，才开始使用这个和我以前的文章创建一个新的 sharepoint online connector，所以希望这可以为试图做同样事情的人节省时间。</p><p id="c4fc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果有任何问题，请随时到 sujaykhandek@gmail.com 找我。</p></div></div>    
</body>
</html>