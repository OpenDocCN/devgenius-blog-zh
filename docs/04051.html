<html>
<head>
<title>WP_Mock or Brain Monkey? Which is the better Mocking Library for WordPress?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WP_Mock还是脑猴？WordPress的嘲讽库哪个比较好？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/wp-mock-or-brain-monkey-which-is-the-better-mocking-library-for-wordpress-48fd89f321fd?source=collection_archive---------2-----------------------#2021-01-20">https://blog.devgenius.io/wp-mock-or-brain-monkey-which-is-the-better-mocking-library-for-wordpress-48fd89f321fd?source=collection_archive---------2-----------------------#2021-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9640943f17d254c4c6336e817d1baec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IaX3CJz9DsoJ4uSv"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@picsbyjameslee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">李中清</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="1211" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们先说清楚:我将使用脑猴向前推进。如果你想知道为什么，请继续阅读。</p><h1 id="8d2b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是嘲讽库？</h1><p id="f886" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果你不知道什么是嘲讽库，你可能没有做足够的测试。在此不做过多的详细介绍，我在此寻求解决的具体用例是为WordPress插件创建一个测试套件，它不需要启动整个WordPress应用程序。</p><p id="35de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两个库都允许你“模仿”WordPress的功能，这允许你在一个封闭的环境中测试你自己的代码。因此，你不用依赖于在整个WordPress核心中运行你的代码，而是孤立地测试你的代码，并且你确信如果有任何错误不是你的代码造成的。</p><h1 id="69e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">那么，这两者之间如何抉择呢？</h1><p id="da3a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我很幸运，因为我在一个新项目刚开始时就想到了这个问题。因此，我的决策过程很简单:我安装了这两个软件，并开始对它们进行测试。</p><blockquote class="me mf mg"><p id="8cf4" class="kd ke mh kf b kg kh ki kj kk kl km kn mi kp kq kr mj kt ku kv mk kx ky kz la ij bi translated">注意:如果你这样做，确保你将那些用WP_Mock创建的测试和那些用Brain Monkey创建的测试分组。那是因为用WP_Mock模拟的方法不能被Brain Monkey重新模拟，反之亦然。</p></blockquote><h1 id="68de" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">名声</h1><p id="a75a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在选择这样的框架时，我首先考虑的是声誉。在这方面，WP_Mock显然是赢家。他们享有很高的声誉，并且有一群经验丰富的开发人员作为后盾，这些开发人员在社区中很受信任— <a class="ae kc" href="https://10up.com/" rel="noopener ugc nofollow" target="_blank"> 10up </a>。</p><p id="48d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">脑猴更新，但有一些伟大的评论。它由Giuseppe mazza pica维护，这是另一个成功的例子，因为唯一的维护者有时会阻碍开发。</p><h1 id="e46b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">焦点/用法</h1><p id="0890" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">WP模拟仅限于此。严格来说，它是PHPUnit和WordPress的模仿库。如果我要使用它，我只能在WordPress项目中使用它，并且只有当我继续使用PHPUnit作为我的测试框架时。</p><p id="118c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这没什么大不了的，因为我可能会继续做这两件事。也就是说，我也在WordPress之外做开发，所以能够在我所有的项目中继续使用我知道的框架会很好。</p><p id="074e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Brain Monkey也主要专注于WordPress，但它并不局限于WordPress。</p><p id="9e87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这两种情况下，都依赖于幕后的嘲弄，这意味着在任何非WordPress项目中直接使用嘲弄。所以对于这种情况，我会给两者相等的分数。</p><h1 id="127f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">功能</h1><p id="7288" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是我改用脑猴的地方。</p><p id="a279" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于测试最重要的事情之一是在测试之间保持一致的状态。一个测试不应该改变任何其他测试。嘲讽框架的问题在于，在完成我们要求的工作过程中，它必须操纵全局状态。</p><p id="a0d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我什么意思？当你模仿一个函数时，这个函数从不存在变成存在。你不能让它回到不存在的状态。(有很多方法，但我不想深入探讨，因为大多数方法都涉及对PHPUnit执行方式的根本性改变。)</p><p id="e28a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我最初遇到这个问题是在我上面提到的情况下。如果我在WP_mock和Brain Monkey中为相同的函数创建一个Mock，我会得到一个致命的错误。函数已经定义。</p><p id="28b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是有道理的，但是我之后开始测试的是对你的测试的影响。</p><p id="ccf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面我们来举个例子:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/d9513057c6fbfdad0fef6f19a3a8dfda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nZacPmzKzWstdPLm"/></div></div></figure><p id="b6ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，您会看到我将这段代码严格限制在\WP_Mock方法中，这是任何文件中唯一的模拟调用。</p><p id="0c2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们一起运行这些测试时，两个测试都通过了。这意味着SecondTest也返回true。</p><p id="5aee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们向运行<code class="fe mq mr ms mt b">\WP_Mock::tearDown()</code>的FirstTest添加一个tearDown方法，我们将会以第二个测试失败而告终，但是失败是因为它不能断言<code class="fe mq mr ms mt b">null is equal to true</code>。</p><p id="e107" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那是什么意思？这意味着<code class="fe mq mr ms mt b">wp_remote_get</code>保持定义。除此之外，一旦我们运行tearDown，它开始返回一个缺省的null值。如果与null是有效返回值的WordPress方法一起使用，这将很快成为一个问题。</p><p id="43e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行完全相同的代码，但是用WP_Mock替换Brain Monkey，记住要包含Brain Monkey的拆卸代码时，我们通过了第一个测试，但是第二个测试没有通过。</p><p id="1fb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和WP_Mock一模一样吧？</p><p id="4391" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不对。</p><p id="1411" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，第二个测试失败，并显示以下错误:<code class="fe mq mr ms mt b">"wp_remote_get" is not defined nor mocked in this test.</code>这比默认的空值有用得多。</p><h1 id="f9f7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么这样更好？</h1><p id="17a2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我前面提到过这一点，但是null对于某些方法来说是一个有效的返回值。正因为如此，将被拆除的模拟函数默认为空意味着我们将它们默认为有效状态。</p><p id="cb42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大脑猴采取了不同的方法。它没有将它们默认为有效状态，而是将它们默认为“已定义，但不是真正定义”的状态，其中引用在内存中，但库模拟未定义的状态。</p><p id="b34a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且未定义的<em class="mh">是模拟</em>的有效状态。</p><h1 id="0833" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最后</h1><p id="3c44" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">因此，这就是为什么我将使用大脑猴，而不是WP模拟我的项目前进。WP Mock仍然是一个很棒的框架，如果我发现Brain Monkey的一些问题现在还不明显，我可能会使用它。</p><p id="601e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是现在，我更喜欢Brain Monkey的API，以及它处理分解方法的方式。为此，我将使用大脑猴。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><p id="5070" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你对这篇文章感兴趣，你会爱上我的Twitter上的技术意识流。 <a class="ae kc" href="https://twitter.com/n00bJackleCity" rel="noopener ugc nofollow" target="_blank"> <em class="mh">头那边，给我跟着</em> </a> <em class="mh">。你不会失望的。</em></p></div></div>    
</body>
</html>