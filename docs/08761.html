<html>
<head>
<title>Reproducibility with Nix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nix 的再现性</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/reproducibility-with-nix-991ad466c92e?source=collection_archive---------4-----------------------#2022-07-08">https://blog.devgenius.io/reproducibility-with-nix-991ad466c92e?source=collection_archive---------4-----------------------#2022-07-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0d826c098099a38819a16551bf080dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*rW1ErwrOCjfR4AUkbuQ6Gw.png"/></div></div></figure><p id="5453" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过这篇文章，我想:</p><ul class=""><li id="e569" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">解释为什么可再现性是构建软件的核心</li><li id="de74" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">解释 Nix 如何帮助您开发本地可再生的开发环境</li><li id="1ff0" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">解释 Nix 如何帮助您实现自动化。点文件，配置，开发人员计算机</li><li id="f1c7" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">解释集装箱短缺的原因</li><li id="f11f" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">为你进一步的 Nix 研究分享资源</li></ul><p id="db66" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我的主要目的是通过告诉你它能为你带来什么样的魔力来把你拖入学习 Nix</p><h1 id="86b4" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">为什么再现性在软件工程中很重要？</h1><p id="e9cf" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">对于软件构建者来说，可再现性涉及到我们工作的一切。当再现性不存在时，我们会沮丧地挠头:</p><blockquote class="mk ml mm"><p id="188f" class="jv jw mn jx b jy jz ka kb kc kd ke kf mo kh ki kj mp kl km kn mq kp kq kr ks ig bi translated">“为什么这对我不起作用？”。</p></blockquote><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/e8bc6947f33af28b9170e2244d50b0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKKYq_n53THDD-duVjsCgg.png"/></div></div></figure><p id="850a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我可以举出几个再现性很重要的地方:</p><ul class=""><li id="a30e" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">能够管理你的同事一直在做的项目</li><li id="6176" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">给定相同的输入，能够生成相同的二进制文件(或任何工件)</li><li id="0f54" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">能够设置一个本地环境，以便您可以开始开发一个新项目。</li><li id="c739" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">在更高的层次上:我们希望我们的部署是可重复的</li><li id="5e9d" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">在数据相关领域，即:机器学习。我们希望能够跟踪代码和数据，相同的代码和相同的数据应该生成相同的机器学习模型。成为一个有效的机器学习团队的很大一部分是能够驯服重复性。</li></ul><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/e24f67447b477d28abc6dd6f772706c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlgpcltDX0KdTgGffNjBfQ.png"/></div></div></figure><p id="70ad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我认为，作为软件开发人员，我们的大部分时间都花在了驯服可重复性上。那就是:为一项新工作做准备，试着让你的新笔记本电脑为编码做好准备，安装你想要工作的 OSS 项目的依赖项。我们还花了大量的时间来确保我们有适当的 CI 和指令，其他人可以遵循，以达到相同的结果(即:能够有一个本地开发环境)</p><p id="af3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们都记得我们新工作的第一天，遵循一些关于如何设置我们将要进行的项目的复杂指令。碰到过时的指南和奇怪的线路。当你开始一份新工作时，通常会在头几周做好准备。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/82835b0fa6dfaae33b3a535ce03ce525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82l9Rn5X4haH0Zj8KBJY4Q.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">本地安装说明:复杂且过时😱​</figcaption></figure><p id="63af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们遇到的一些常见陷阱:</p><h2 id="b84a" class="nc li in bd lj nd ne dn ln nf ng dp lr kg nh ni lv kk nj nk lz ko nl nm md nn bi translated">全系统依赖性难题</h2><p id="2d67" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">您有使用 1.0 版 RubberDuck 库的项目 1。<br/>稍后您将设置使用 RubberDuck Lib 版的 Project2】您无法在不破坏一个项目的情况下编译另一个项目。在最坏的情况下，您的系统库可能会被破坏。</p><h2 id="bf6b" class="nc li in bd lj nd ne dn ln nf ng dp lr kg nh ni lv kk nj nk lz ko nl nm md nn bi translated">复杂工具空间:Python 环境工具</h2><p id="18f4" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">几个月前，我指导的一个人问我关于如何隔离 python 环境的工具。答案并不简单，因为 Python 库可以依赖于 C，而且有很多工具。</p><p id="c180" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我在下面分享了这个矩阵，它将特性映射到 Python 的环境工具。下图显示了这个主题有多复杂。</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/52488c4aca062030f6b37d18e45f13f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Dpg09J0uSf5iMk8_cs0Nw.png"/></div></div></figure><h1 id="d1a8" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">尼克斯坐在哪里？</h1><p id="da2c" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">Nix 是一个包管理器，它解决了我刚刚提到的关于可再现性的问题。</p><p id="b87f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">简而言之，Nix 允许您做以下事情(但不限于这些):</p><ul class=""><li id="d627" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated"><strong class="jx io">隔离环境</strong> : Nix 允许您创建一个隔离的“外壳”,其中只有您指定的依赖项才可用。把它想象成一个“可以访问你的文件系统的容器”。</li></ul><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/2f604229a8df6c7919d88b757c9e7c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9usK1NGBizH-me9SD71g6w.gif"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">独立 Nix shell 中的 Python3.10 + awscli</figcaption></figure><ul class=""><li id="57f2" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated"><strong class="jx io">包构建/项目构建</strong>:把 Nix 想象成一种描述你的项目的依赖以及如何构建你的项目的方式。Nix 提供了一种方法来确保相同的输入(代码、依赖项)产生完全相同的输出。</li><li id="0699" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><strong class="jx io">开发环境:</strong>提供 Nix 文件的项目，通常也会提供一个开发环境。对于在机器上运行 Nix 的人来说，这些环境是通过一个命令设置的。当你第一次发现一个 OSS 项目，并且在你开始工作之前，你挣扎着设置需要的依赖项时，没有更多的麻烦。使用 Nix 开始一个项目就像在您的终端进入项目文件夹一样简单，然后在一个隔离的 shell 中安装所有需要的东西。</li><li id="9723" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">开发者机器设置:作为一名开发者，我打赌你有一套脚本/点文件，用来设置你的笔记本电脑。使用 Nix，您可以描述您的设置和自动化。<br/>您可以描述应该在您的开发人员机器上安装什么依赖/配置(即:电池策略)。一旦你写好了，你就可以把它带到你的下一台机器上。这比我迄今为止见过的任何东西都更强大，因为如果你犯了一个错误，你实际上可以扰乱你的环境并逆转。许多使用 Nix 的开发人员正在自动化他们的设置。一些开发者正在替换他们的。用 Nix 脚本生成所需的点文件。点文件</li><li id="838d" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><strong class="jx io">容器图像构建器:</strong> Nix 可以用来以声明的方式构建 docker 图像。这带来了强大的优势，如超级微小的容器图像。它还具有可再生容器映像构建的优势。</li></ul><h2 id="8ff0" class="nc li in bd lj nd ne dn ln nf ng dp lr kg nh ni lv kk nj nk lz ko nl nm md nn bi translated">为什么容器图片不够？</h2><p id="41ab" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">容器是一个很棒的工具。然而，容器并不是真正可复制的，今天构建一个映像，一年后再构建一次。很可能结果会不同。</p><p id="cf5f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是因为容器没有解决如何构建软件工件的问题。另一方面，Nix 确保软件以可追踪和幂等的方式构建:相同的输入产生相同的输出。</p><p id="cec1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一个有趣的点是，容器图像是建立在命令式语言上的，我们告诉我们的容器生成器工具在每一步做什么，每一步都是一层。另一方面，Nix 是声明性的，通过使用 Nix 和容器映像，我们可以将容器映像描述为 Nix 包的声明性列表。尼克斯会找出我们到底需要什么，而我们不需要什么。只留下实际需要的准系统。</p><h2 id="46e1" class="nc li in bd lj nd ne dn ln nf ng dp lr kg nh ni lv kk nj nk lz ko nl nm md nn bi translated">深入 Nix 下一步去哪里？</h2><ul class=""><li id="ea98" class="kt ku in jx b jy mf kc mg kg nq kk nr ko ns ks ky kz la lb bi translated">这篇精彩的博客文章是领略 https://christine.website/blog/nix-flakes-1-2022-02-21 风情的最佳入门指南</li><li id="1372" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated"><a class="ae nt" href="https://nixos.org/guides/nix-pills/" rel="noopener ugc nofollow" target="_blank"> Nix Pills </a>是深入研究如何编写 NixFiles 的一个极好的方法</li><li id="19ca" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">如果您对 Nix 感兴趣，可以替代您的。dotfiles 和管理您的开发人员机器(即:有一个可重现的脚本，您可以运行它来设置您的开发人员机器)。<a class="ae nt" href="https://www.youtube.com/watch?v=1dzgVkgQ5mE" rel="noopener ugc nofollow" target="_blank">这个视频很好地指导了如何在 OSX 做这件事</a></li><li id="2654" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">使用 Nix<a class="ae nt" href="https://github.com/LnL7/nix-darwin" rel="noopener ugc nofollow" target="_blank">https://github.com/LnL7/nix-darwin</a>自动化您的 OSX 机器设置</li><li id="e166" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">我乱七八糟的学习笔记。也许对你有用:<a class="ae nt" href="https://github.com/dav009/nix-learning-notes" rel="noopener ugc nofollow" target="_blank">https://github.com/dav009/nix-learning-notes</a></li></ul></div></div>    
</body>
</html>