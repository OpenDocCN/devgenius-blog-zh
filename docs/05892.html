<html>
<head>
<title>React Bootstrap: Creating Controlled Forms to Add and Update Data with a Flexible Number of Inputs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Bootstrap:创建受控表单，通过灵活的输入数量来添加和更新数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-bootstrap-creating-controlled-forms-to-add-and-update-data-with-a-flexible-number-of-inputs-6d2e4e6977c7?source=collection_archive---------1-----------------------#2021-11-17">https://blog.devgenius.io/react-bootstrap-creating-controlled-forms-to-add-and-update-data-with-a-flexible-number-of-inputs-6d2e4e6977c7?source=collection_archive---------1-----------------------#2021-11-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="45f8" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">摘要</h1><p id="1571" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">本文描述了如何使用 React Bootstrap 在一个受控表单中创建输入组。在使用下拉列表的地方，选项是从 API 获取的。每个输入组中的数据都被格式化为一个对象，其中每个输入都是对象中某个键的值。使用 useState 钩子将对象添加到对象数组中，并通过回调传递给父窗体。当在后端处理多对多关系以及使用嵌套数组或嵌套对象数组的 API 时，这非常有用。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/977e23d58c509892219fbae1346e5b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MrNRRCJo6cnP4oIWSnBZaQ.gif"/></div></div></figure></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><h1 id="d173" class="jk jl in bd jm jn lz jp jq jr ma jt ju jv mb jx jy jz mc kb kc kd md kf kg kh bi translated">介绍</h1><p id="7cdd" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">自从我在熨斗学校开始编程以来，我一直想创建一个输入数量灵活的表单。例如，在我以前的项目中，我创建了一个表单，用户可以在其中创建一个游戏任务。我希望他们能够通过从游戏中选择角色来增加一个以上的角色，但是我不知道怎么做。在这个项目中，我正在为我妻子的公司<a class="ae me" href="https://www.lovely-nutrition.com/" rel="noopener ugc nofollow" target="_blank">可爱的营养</a>制作一个膳食跟踪应用程序。她使用糖尿病交换列表，类似于减肥中心的积分系统，来帮助她的客户简化饮食，并帮助他们实现目标。当我开始使用交易所创建一个膳食追踪应用程序时，我知道我必须想出一种方法，让他们能够在食谱中添加配料，并更新这些配料的数量。</p><h1 id="03a5" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建表单</h1><p id="ce15" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">首先，我创建了一个组件<code class="fe mf mg mh mi b">AddMealForm</code>，并从 React 导入了<a class="ae me" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank"> useState </a>钩子，为表单设置状态。我还从<a class="ae me" href="https://react-bootstrap.github.io/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> React Bootstrap </a>中导入了我使用的组件。你不需要使用 Bootstrap，没有它也一样。在这个例子中，Bootstrap 只为表单提供样式。这里是 GitHub 上<a class="ae me" href="https://github.com/jsnidar/lovely-meal-tracker" rel="noopener ugc nofollow" target="_blank">回购的链接。</a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mj"><img src="../Images/792991dbf1601e6c3b8dfb43d3827cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLsWBPk-e9aseUmD2-4uUg.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/56a00e14e893a9ac3174b2a7421866bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*mwMdooQQmYGcarz3y05F6w.png"/></div></figure><p id="4e43" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated"><code class="fe mf mg mh mi b">meal_ingredients: []</code>将保存包含饭菜中每种配料信息的对象数组。其他值很简单。</p><h1 id="c507" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">服务器和 API 上下文</h1><p id="12e6" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">后端<a class="ae me" href="https://github.com/jsnidar/phase-3-sinatra-react-project" rel="noopener ugc nofollow" target="_blank">是用 Ruby 构建的。我将从一个使用</a><a class="ae me" href="https://guides.rubyonrails.org/active_record_basics.html" rel="noopener ugc nofollow" target="_blank">活动记录</a>的数据库设置的<a class="ae me" href="http://sinatrarb.com/" rel="noopener ugc nofollow" target="_blank"> Sinatra API </a>中获取数据。这是数据库的 ERD。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mq"><img src="../Images/f2f35b7b1f9a2ce45ec85ff49a0d3109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xd2fCzey9bz0evsJ23KAfA.png"/></div></div></figure><p id="1cbe" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">如您所见,<code class="fe mf mg mh mi b">meal_ingredients</code>是一顿饭的关联记录的连接表。它储存了一顿饭中每种配料的数量。配料表存储了每种配料的信息，如份量单位、数量和常量营养素类型。</p><p id="7a26" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">GET 请求被设置为返回一顿饭及其配料的所有数据。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/a3206a8092a4fc65cc0b63610eb7fe7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*wdUVozdzPKYU9dpYX3L2ng.png"/></div></figure><h1 id="968a" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">固定输入与可变输入</h1><p id="eca8" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我在这里定义了一个<strong class="kk io">固定输入</strong>作为一个将被渲染固定次数的输入。我将一个<strong class="kk io">变量输入</strong>定义为一个可以被创建可变次数的输入。我不会详细介绍我是如何创建固定输入的，因为这些更简单。</p><h1 id="f845" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">设置可变输入</h1><p id="281a" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">下面是我如何为表单编写变量输入。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/139b14deb542ecaef14e1856f869c838.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*3XiZ06imxWa-L43EaJzeyA.png"/></div></figure><p id="9b60" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我为每个输入的标签创建了一个<code class="fe mf mg mh mi b">Col</code>,为删除按钮的位置创建了一个<code class="fe mf mg mh mi b">Col</code>。这样，标签只会在添加的所有成分上面显示一次。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/98945925c023d13bcf024af05b4fcba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*4PZoRih1LSO9KydKDBQ9Qw.png"/></div></figure><p id="25df" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我设置了一个状态变量<code class="fe mf mg mh mi b">listId</code>。当没有其他信息被添加到一个成分中时，我将它用作该成分的引用，当我在呈现组件时映射成分时，我将它用作一个键。React 要求当您通过循环创建多个组件时，每个组件都有一个唯一的键。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/7e41d5ea922a47699918c4a3771bbdcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*pnaQZgpxCVAlRCjukcO7bg.png"/></div></figure><p id="13dd" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我创建了一个<code class="fe mf mg mh mi b">addIngredient()</code>函数，该函数用默认值更新带有膳食成分对象的<code class="fe mf mg mh mi b">formData</code>，并为<code class="fe mf mg mh mi b">listId</code>设置状态以确保没有重复值。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/dfd96090b945d4cfca8849ab8a385cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*qfCyidARRQMAblefb7XQmg.png"/></div></figure><p id="212e" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我声明了一个变量<code class="fe mf mg mh mi b">renderIngredients</code>来为<code class="fe mf mg mh mi b">formData.meal_ingredients</code>对象数组中的每个对象创建一个<code class="fe mf mg mh mi b">&lt;AddIngredient/&gt;</code>组件。对于<code class="fe mf mg mh mi b">listId</code>,我通过了<code class="fe mf mg mh mi b">listId -1</code>,因为自从它被赋值后就一直递增。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mw"><img src="../Images/765f3a5e612a4274c0957b9ab1b84720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H2UpbRf5pkDtic4VxYWtiQ.png"/></div></div></figure><p id="2442" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">接下来，我创建了一个<code class="fe mf mg mh mi b">AddIngredient</code>组件，它接收这些道具，并使用期望的输入进行渲染。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mx"><img src="../Images/cad35f66422b7ea4d32a50bea4435eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPJq1dynohShDy2jZwvxpA.png"/></div></div></figure><p id="133f" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">它呈现:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi my"><img src="../Images/be5bb271f061be2d21d363e13b3d7223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*gnSC8kEPa_9pMzt7YIxw_A.png"/></div></figure><p id="a251" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我使用在<code class="fe mf mg mh mi b">AddMealForm</code>中声明的<code class="fe mf mg mh mi b">updateIngredient</code>回调函数声明了处理每个输入变化的函数。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mz"><img src="../Images/7c6f685c0462c079c9df99589ffe6481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11XYpIaJjJoyLl7Bs5DUQw.png"/></div></div></figure><p id="3250" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">这里是<code class="fe mf mg mh mi b">AddMealForm</code>组件中的<code class="fe mf mg mh mi b">updateIngredient()</code>函数。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi na"><img src="../Images/38b7c22768a63c883091f012ec1ff282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2z2wbejmJxua25zHJwVXw.png"/></div></div></figure><p id="62e6" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">该功能接收更新后的<code class="fe mf mg mh mi b">ingredientObj</code>，使用地图更新修改后的配料，并用更新后的信息设置<code class="fe mf mg mh mi b">formData</code>。</p><p id="b281" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">我为宏和成分创建了下拉组件，并将它们导入到<code class="fe mf mg mh mi b">AddIngredient</code>组件中。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/00c18cbb3734cf39948b48f98056d169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*k1PeCVuzMyfiMxI3em40ZQ.png"/></div></figure><p id="9edc" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated"><code class="fe mf mg mh mi b">MacrosDropdown</code>看起来是这样的:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nc"><img src="../Images/84b37c2c19e892d6ac2b2f3404fab476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8CtbuvrObAMtwdYn20U8Q.png"/></div></div></figure><p id="b8d8" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">它为<code class="fe mf mg mh mi b">macros</code>属性中的每个宏渲染一个<code class="fe mf mg mh mi b">&lt;option&gt;</code>，并将默认值设置为传递下来的<code class="fe mf mg mh mi b">macro</code>属性。<code class="fe mf mg mh mi b">selectMacro</code>回调更新<code class="fe mf mg mh mi b">AddIngredient</code>实例中的<code class="fe mf mg mh mi b">mealIngredient</code>，并使用<code class="fe mf mg mh mi b">updateIngredient</code>回调为<code class="fe mf mg mh mi b">formData</code>设置状态。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ac31b02ec605f3fd3d4b8431b8ebe977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*4jyPmit6lhIJ8HjInTLstQ.png"/></div></figure><p id="292f" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated"><code class="fe mf mg mh mi b">IngredientsDropdown</code>组件以类似的方式更新成分。</p><h1 id="31dc" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">回顾</h1><ul class=""><li id="c2a8" class="ne nf in kk b kl km kp kq kt ng kx nh lb ni lf nj nk nl nm bi translated">在<code class="fe mf mg mh mi b">AddMealForm</code>组件中设置<code class="fe mf mg mh mi b">formData</code>、<code class="fe mf mg mh mi b">listId</code>和<code class="fe mf mg mh mi b">ingredients</code>的状态。</li></ul><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/b6faebf8ccc296fa592d5a56f93abf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*wAIwQPKIG0I7STH9voIaVw.png"/></div></figure><ul class=""><li id="037f" class="ne nf in kk b kl ml kp mm kt no kx np lb nq lf nj nk nl nm bi translated"><code class="fe mf mg mh mi b">AddIngredient</code>是<code class="fe mf mg mh mi b">AddMealForm</code>的子节点，它保存每种添加成分的输入。添加的配料带有一个<code class="fe mf mg mh mi b">listId</code>，因为配料中没有其他数据可用作关键字。</li><li id="9c9f" class="ne nf in kk b kl nr kp ns kt nt kx nu lb nv lf nj nk nl nm bi translated">一旦添加了配料，所有对配料的更新都用于通过回调来更新<code class="fe mf mg mh mi b">formData</code>。当<code class="fe mf mg mh mi b">formData</code>被更新时，表格再次显示更新后的信息。</li></ul><p id="e2d9" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">当用户完成创建他们的食物时，<code class="fe mf mg mh mi b">formData</code>包含这样的数据，可以用来通过 API 向服务器发送 POST 或 PATCH 请求。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nw"><img src="../Images/56429d3616e41b74370a1018d9936d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mDB_U5BlrCBFLv0aMpXHvQ.png"/></div></div></figure><p id="cf70" class="pw-post-body-paragraph ki kj in kk b kl ml kn ko kp mm kr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">希望这能帮助你创建一个像这样的表单，因为你也在学习编程！</p></div></div>    
</body>
</html>