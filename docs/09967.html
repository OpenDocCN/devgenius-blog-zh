<html>
<head>
<title>Install airflow locally in 5 min</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 5 分钟内局部安装气流</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/install-airflow-locally-in-5-min-a03b09b98eeb?source=collection_archive---------7-----------------------#2022-09-26">https://blog.devgenius.io/install-airflow-locally-in-5-min-a03b09b98eeb?source=collection_archive---------7-----------------------#2022-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/513b2f282ba1f6836f8afefe322b7ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zk6I56JF-48qdlT1Qpz2kQ.jpeg"/></div></div></figure><p id="3cf8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，您将看到如何在本地机器上快速安装 airflow 并运行您的第一个 DAG。在进入这个话题之前，让我简单解释一下什么是气流。</p><p id="1bd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Apache airflow 是 Airbnb 在 2014 年开发的基于 python 的开源编排工具。它用于调度和监控工作流，最近几年在开发数据管道的数据工程师中流行起来。</p><p id="672b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw"> 1:安装 Astro CLI。<br/> </em> </strong> Astro CLI 是构建在 Apache Airflow 之上的命令行界面和开源工具。在本地运行 Apache airflow 是最简单的方法。<br/>先决条件<br/> 1。对于 Mac - &gt;自制:<a class="ae kx" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">https://brew.sh/</a>T10】2。对于 Mac/ Linus - &gt; Docker 桌面:<a class="ae kx" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/get-docker/</a></p><p id="e7ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在 Mac Os 上安装 Astro CLI，打开您的终端并运行以下命令。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b08f" class="lh li iq ld b gy lj lk l ll lm">brew install astro</span></pre><p id="ed6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在 Linux 上安装 Astro CLI。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="740a" class="lh li iq ld b gy lj lk l ll lm">curl -sSL install.astronomer.io | sudo bash -s</span></pre><p id="8fa5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查 Astro CLI 是否安装正确。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="0b8c" class="lh li iq ld b gy lj lk l ll lm">astro version<br/>------------Output------------</span><span id="e27e" class="lh li iq ld b gy ln lk l ll lm">Astro CLI Version: 1.5.1</span></pre><p id="7c84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是时候创建一个文件夹了，您可以在其中找到有关创建项目并在本地气流环境中运行它的信息。我在 Documents 目录下创建了一个名为 Astro-Airflow 的文件夹(你可以用任何名字创建这个文件夹)。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="89c9" class="lh li iq ld b gy lj lk l ll lm">mkdir Astro-Airflow &amp;&amp; cd Astro-Airflow</span></pre><p id="95f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在检查您当前的目录。应该是“太空气流”</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="e08b" class="lh li iq ld b gy lj lk l ll lm">pwd<br/>----output------</span><span id="f353" class="lh li iq ld b gy ln lk l ll lm">/Users/khushboo.purohit/Documents/Astro-Airflow</span></pre><p id="fd73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止一切顺利，现在从最近创建的文件夹中调用 init 方法。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="71ba" class="lh li iq ld b gy lj lk l ll lm">astro dev init<br/>-----output-----------------------</span><span id="90a8" class="lh li iq ld b gy ln lk l ll lm">Initializing Astro project</span><span id="9e07" class="lh li iq ld b gy ln lk l ll lm">Pulling Airflow development files from Astro Runtime 6.0.0</span><span id="67f3" class="lh li iq ld b gy ln lk l ll lm">Initialized empty Astro project in /Users/ayush.pareek/Documents/Astro-Airflow</span></pre><p id="73e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到在该目录中创建了以下文件。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="93aa" class="lh li iq ld b gy lj lk l ll lm">--Dockerfile  <br/>--README.md <br/>--airflow_settings.yaml <br/>--dags   <br/>--include  <br/>--packages.txt  <br/>--plugins   <br/>--requirements.txt <br/>--tests</span></pre><p id="4589" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在启动 Docker-Desktop 并运行下面的命令在本地构建项目。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="fa76" class="lh li iq ld b gy lj lk l ll lm">astro dev start</span></pre><p id="8e14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令构建您的项目，并在您的机器上旋转 4 个 Docker 容器，每个容器用于不同的气流组件:</p><ul class=""><li id="bbeb" class="lo lp iq ka b kb kc kf kg kj lq kn lr kr ls kv lt lu lv lw bi translated">Postgres: Airflow 的元数据数据库</li><li id="d000" class="lo lp iq ka b kb lx kf ly kj lz kn ma kr mb kv lt lu lv lw bi translated">Webserver:负责呈现气流 UI 的气流组件</li><li id="22a2" class="lo lp iq ka b kb lx kf ly kj lz kn ma kr mb kv lt lu lv lw bi translated">调度器:负责监控和触发任务的气流组件</li><li id="7ed0" class="lo lp iq ka b kb lx kf ly kj lz kn ma kr mb kv lt lu lv lw bi translated">Triggers:气流组件负责运行触发器，并在条件满足时发出任务恢复的信号。触发器专门用于使用可推迟操作符运行的任务。</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/a3a4c811626853f52b133607ce5327cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oaI19ZwVg0ln3MeC8bc2Ug.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">Docker 桌面仪表板</figcaption></figure><p id="bd10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时你可能会得到一个错误，如端口繁忙或使用，在这种情况下，你需要检查 docker-desktop 仪表板，如果已经有运行 Astro 集群，你需要删除它。</p><p id="f293" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是时候在你的本地机器上打开气流 UI 了。转到 URL<a class="ae kx" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a>并使用用户名和密码<code class="fe mh mi mj ld b">admin</code>登录。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/d46139cfadadd6e24172433a50c30d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgXzvrhXDWfaG4ZTP-qo6Q.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">安装气流的第一瞥。</figcaption></figure><p id="de80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw"> 2:创建第一个气流 DAG 并在本地运行。<br/> </em> </strong>这里我们将创建一个名为 list_multiplier 的简单 DAG，它将一个预定义的列表乘以 2，并每天打印出来。下面是相同的代码，并将其保存在前面步骤中创建的<code class="fe mh mi mj ld b">Astro-Airflow</code>目录下的<code class="fe mh mi mj ld b">dag</code>文件夹中。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b04c" class="lh li iq ld b gy lj lk l ll lm">from airflow.decorators import task<br/>from airflow.operators.dummy import DummyOperator<br/>from airflow import DAG<br/>from datetime import datetime</span><span id="32a5" class="lh li iq ld b gy ln lk l ll lm">with DAG(<br/>    dag_id='list_multiplier',<br/>    schedule_interval="@daily",<br/>    start_date=datetime(2021, 1, 1),<br/>    catchup=False,<br/>    default_args={</span><span id="36a6" class="lh li iq ld b gy ln lk l ll lm">    "retries": 2, # If a task fails, it will retry 2 times.</span><span id="1593" class="lh li iq ld b gy ln lk l ll lm">    },<br/>    tags=['First Local Dag']<br/>    ) as dag:</span><span id="75da" class="lh li iq ld b gy ln lk l ll lm">    start = DummyOperator(task_id='start')</span><span id="030e" class="lh li iq ld b gy ln lk l ll lm">    end  = DummyOperator(task_id='end')</span><span id="749c" class="lh li iq ld b gy ln lk l ll lm">    @task<br/>    def list_multiplier():<br/>        lst=[1,2,3,4,5]<br/>        print([i*2 for i in lst])<br/>    list_multiplier_task=list_multiplier()</span><span id="4ccb" class="lh li iq ld b gy ln lk l ll lm">    start &gt;&gt; list_multiplier_task &gt;&gt; end</span></pre><p id="eb5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在停止项目，并重新启动它与下面的命令，然后你将能够看到新创建的 DAG 在气流用户界面。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="ddae" class="lh li iq ld b gy lj lk l ll lm">astro dev stop<br/>astro dev start</span></pre><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/a4872199e5ac20c33453cdfc220b53f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb904q3wBfk18XyyXV55og.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">第一个本地 dag 创建。</figcaption></figure><p id="4697" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw">总结:</em> </strong>在本文中，您已经了解了我们如何快速地在本地设置 Airflow，如何从您的本地机器部署和运行 Dag，<br/>以及 Astro CLI 对于快速创建开发环境是多么有用。如果你认为这篇文章信息丰富，对你有所帮助，那么请鼓掌并关注我的媒体账户(<br/><a class="ae kx" href="https://datageeks.medium.com/" rel="noopener">datageeks.medium.com</a>)，如果你对这个话题有任何疑问，请随意在评论中写下。</p><p id="80c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过注册成为会员(<a class="ae kx" href="https://datageeks.medium.com/membership" rel="noopener">https://datageeks.medium.com/membership</a>)，你可以阅读每一个故事，并帮助媒体上的作者。</p></div></div>    
</body>
</html>