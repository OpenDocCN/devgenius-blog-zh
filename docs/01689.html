<html>
<head>
<title>Swift CALayer: 3D looking animated Globe🌍 with CALayer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift CALayer: 3D动画地球仪🌍带CALayer</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/swift-3d-looking-animated-globe-with-calayer-307942174caf?source=collection_archive---------15-----------------------#2020-07-09">https://blog.devgenius.io/swift-3d-looking-animated-globe-with-calayer-307942174caf?source=collection_archive---------15-----------------------#2020-07-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4f1b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建一个旋转的3D地球，只需使用CALayer和2组图像视图。输出如下图所示<strong class="jm io"> <em class="ki">。gif </em> </strong>文件与无故障动画，相信我😎。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/467d4df6bfff46663278160d86fceeb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*ATiD3EmZGCLKMlOkXMqfqw.gif"/></div></figure><p id="c210" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">核心动画框架支持CALayer，它可以帮助你在屏幕上绘制、管理和动画显示可视内容。根据苹果的<a class="ae kr" href="https://developer.apple.com/documentation/quartzcore/calayer" rel="noopener ugc nofollow" target="_blank">文档</a>，layer还保存了关于其内容的几何信息(如位置、大小和变换)，用于在屏幕上呈现该内容。</p><p id="2b27" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">说够了😎。让我们开始烹饪我们的项目🥘。本项目所需的配料如下。</p><h2 id="f721" class="ks kt in bd ku kv kw dn kx ky kz dp la jv lb lc ld jz le lf lg kd lh li lj lk bi translated">关键成分:</h2><ul class=""><li id="572c" class="ll lm in jm b jn ln jr lo jv lp jz lq kd lr kh ls lt lu lv bi translated">1 <code class="fe lw lx ly lz b">CAShapeLayer</code>实例</li><li id="356a" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">1个<code class="fe lw lx ly lz b">CAGradientLayer</code>实例</li><li id="793d" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">1幅世界地图图像🗺️(如果可能的话，使用真实的图像)</li><li id="7eb4" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">2 <code class="fe lw lx ly lz b">ImageView</code></li><li id="e369" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">2 <code class="fe lw lx ly lz b">UIView</code></li><li id="c37e" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">1 <code class="fe lw lx ly lz b">UIImageView</code>扩展，用于在将AspectFit内容类型分配给图像后计算图像高度</li><li id="9958" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">1 <code class="fe lw lx ly lz b">CGAffineTransform</code>向UIView提供动画</li><li id="ef6b" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">1张黑色/蓝色天空图像，由您选择🌌(用于浇头😉)</li></ul><h2 id="c5ca" class="ks kt in bd ku kv kw dn kx ky kz dp la jv lb lc ld jz le lf lg kd lh li lj lk bi translated">烹饪Procedure🧑‍🍳：</h2><ul class=""><li id="5e5c" class="ll lm in jm b jn ln jr lo jv lp jz lq kd lr kh ls lt lu lv bi translated">在你的故事板中拖动<strong class="jm io"> UIView </strong>(名为<em class="ki"> tempView </em>)。将其与屏幕的垂直和水平中心对齐。设置<strong class="jm io"> 300x300的宽度和高度。</strong>同样，在ViewController文件中创建该视图的<strong class="jm io"> IBOutlet </strong>及其高度约束。</li><li id="dd33" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">在<em class="ki"> tempView </em>中，取另一个视图(名为<em class="ki"> vwImgContainer </em>)相对于超级视图(即<em class="ki"> tempView)分配尾部、底部和顶部约束。</em>提供<strong class="jm io"> 600的<strong class="jm io">宽度</strong>。C </strong>也为这个UIView创建ViewController文件中的<strong class="jm io"> IBOutlet </strong>。</li><li id="cfb4" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">现在<em class="ki"> vwImgContainer </em>将有两个<strong class="jm io"> UIImageView </strong>在里面，但是是并排的。第一个图像视图(名为<em class="ki"> imgFirst </em>)将具有顶部、底部、尾部、中心等约束，相对于超级视图(即<em class="ki"> vwImgContainer </em>)垂直对齐，并将具有<strong class="jm io"> 300的<strong class="jm io">宽度</strong>。第二个</strong>图像视图(名为<em class="ki"> imgSecond </em>)将有约束，如前导、底部、顶部、<strong class="jm io">尾随</strong>到<strong class="jm io"> <em class="ki"> imgFirst、</em> </strong> <em class="ki">和</em>垂直居中对齐。您还需要 ViewController文件中<em class="ki"> imgFirst的<strong class="jm io"> IBOutlet </strong>。此外，将世界地图图像分配给两个图像视图，并赋予它们内容类型<code class="fe lw lx ly lz b">AspectFit</code></em></li><li id="ae1b" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">在完成上述步骤后，你的半熟的项目和视图的层次结构应该看起来像下图所示</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/e70eca733308ab7908e05d3ace3e1258.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*DW86_O6KBZUmMwBglBoWAg.png"/></div></figure><ul class=""><li id="2149" class="ll lm in jm b jn jo jr js jv mg jz mh kd mi kh ls lt lu lv bi translated">现在移动到ViewController文件，创建如下的<code class="fe lw lx ly lz b">CAShapeLayer</code>和<code class="fe lw lx ly lz b">CAGradientLayer</code>的实例。</li></ul><pre class="kk kl km kn gt mj lz mk ml aw mm bi"><span id="d82d" class="ks kt in lz b gy mn mo l mp mq"><strong class="lz io">let</strong> circularMaskLayer = CAShapeLayer()<br/><strong class="lz io">let</strong> gradient = CAGradientLayer()</span></pre><ul class=""><li id="5945" class="ll lm in jm b jn jo jr js jv mg jz mh kd mi kh ls lt lu lv bi translated">创建一个函数<code class="fe lw lx ly lz b">setUpMaskAndGradientLayer</code>，我们将在<code class="fe lw lx ly lz b">viewDidAppear</code>中调用它。现在我们将在<em class="ki"> tempView </em>的中心创建一个圆形<code class="fe lw lx ly lz b">UIBezierPath</code>，它的宽度和高度等于<em class="ki"> imgFirst的</em>图像的高度，将其内容类型设置为<code class="fe lw lx ly lz b">AspectFit</code>。将BezierPath分配给<code class="fe lw lx ly lz b">circularMaskLayer</code>，进一步将<code class="fe lw lx ly lz b"><em class="ki">circularMaskLayer</em></code>分配给<em class="ki"> tempViews </em>图层的蒙版属性。</li></ul><blockquote class="mr ms mt"><p id="afc0" class="jk jl ki jm b jn jo jp jq jr js jt ju mu jw jx jy mv ka kb kc mw ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong>需要计算高度，因为我们的<strong class="jm io">世界地图图像</strong>是矩形的，而我们的<strong class="jm io"> imgFirst </strong>是方形的，当您将内容类型设置为AspectFit时，图像完全适合图像视图的水平方向，但在顶部和底部留有空白。</p></blockquote><p id="bca3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在设置<em class="ki">渐变</em>的框架等于<em class="ki"> UIBezierPath </em>变量<em class="ki">的边界。</em>设置渐变类型为<code class="fe lw lx ly lz b"><strong class="jm io">radial</strong></code>。我们希望我们的颜色从圆心向圆的边缘移动。同样，将渐变的第一种颜色(中心颜色)设置为<strong class="jm io">透明</strong>，将第二种颜色(朝向圆边缘的颜色)设置为<strong class="jm io"> HSB </strong>，如下图所示。</p><pre class="kk kl km kn gt mj lz mk ml aw mm bi"><span id="9aea" class="ks kt in lz b gy mn mo l mp mq">gradient.colors = [UIColor.clear.cgColor, UIColor(hue: 0.60 , saturation: 1, brightness: 0.90, alpha: 0.7).cgColor]</span></pre><p id="64ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将在圆的边缘产生模糊的<strong class="jm io"> <em class="ki">蓝色</em> </strong>色调，使我们的地球看起来更加真实和3D。添加<em class="ki">渐变</em>作为<em class="ki"> tempViews </em>图层<em class="ki"> </em>属性的子层。</p><ul class=""><li id="6f67" class="ll lm in jm b jn jo jr js jv mg jz mh kd mi kh ls lt lu lv bi translated">现在，为了给地球提供旋转动画，创建一个名为<code class="fe lw lx ly lz b">animateTheWorld</code>的函数，调用UIView的animate函数，持续时间为10，带有重复选项。对于旋转动画，我们将使用函数<code class="fe lw lx ly lz b">CGAffineTransform(translationX:)</code>。所以基本上地球不是在旋转😜但是我们正在以重复的方式从左到右移动我们的容器，这导致了通过圆形遮罩层看到的旋转的错觉。你的函数看起来如下，你将在<code class="fe lw lx ly lz b">setUpMaskAndGradientLayer</code>结束时调用它。</li></ul><blockquote class="mr ms mt"><p id="2aea" class="jk jl ki jm b jn jo jp jq jr js jt ju mu jw jx jy mv ka kb kc mw ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong>设置<strong class="jm io"> translationX </strong>值与vwImgContainer的宽度相同，y值为<strong class="jm io"> 0 </strong>，因为我们只想水平移动视图。</p></blockquote><pre class="kk kl km kn gt mj lz mk ml aw mm bi"><span id="e92f" class="ks kt in lz b gy mn mo l mp mq"><strong class="lz io">func</strong> animateTheWorld() {<br/>     UIView.animate(withDuration: 10,<br/>                    delay: 0,<br/>                    options: [.repeat, .curveLinear],<br/>                    animations: {<br/>                        <strong class="lz io">self</strong>.vwImgContainer.transform = CGAffineTransform(translationX: 300, y: 0)<br/>     }, completion: <strong class="lz io">nil</strong>)<br/>}</span></pre><ul class=""><li id="e072" class="ll lm in jm b jn jo jr js jv mg jz mh kd mi kh ls lt lu lv bi translated">现在最后一步是添加一些顶层，即添加任何与天空或星系相关的图像作为背景图像。</li><li id="9cb1" class="ll lm in jm b jn ma jr mb jv mc jz md kd me kh ls lt lu lv bi translated">现在我们的食物准备好了😋。我的意思是这个项目已经可以测试了。点击“运行”按钮，享受美食。</li></ul><h1 id="1bec" class="mx kt in bd ku my mz na kx nb nc nd la ne nf ng ld nh ni nj lg nk nl nm lj nn bi translated"><strong class="ak">结论:</strong></h1><p id="3eb6" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv no jx jy jz np kb kc kd nq kf kg kh ig bi translated">在本教程中，我们学习了使用CALayer创建圆形、径向渐变和图层蒙版。我们还看到了如何使用CGAffineTransform将视图从一个位置转换到另一个位置。</p></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="4810" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完整的项目可以在下面的Github repo中找到。</p><div class="ny nz gp gr oa ob"><a href="https://github.com/DharmeshRathod712/3DGlobeAnimation.git" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd io gy z fp og fr fs oh fu fw im bi translated">dharmeshrathod 712/3d globe animation</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">苹果允许你使用CALayer创建不同的形状、渐变和遮罩效果。这个项目试图利用…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op kp ob"/></div></div></a></div><p id="a490" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">享受…🙌🏻快乐编码… 🥳</p></div></div>    
</body>
</html>