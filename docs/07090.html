<html>
<head>
<title>Send BLE sensor data over MQTT using Javascript MQTT.js and BleuIO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Javascript MQTT.js 和 BleuIO 通过 MQTT 发送 BLE 传感器数据</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/send-ble-sensor-data-over-mqtt-using-javascript-mqtt-js-and-bleuio-5a3e81639aa6?source=collection_archive---------5-----------------------#2022-02-24">https://blog.devgenius.io/send-ble-sensor-data-over-mqtt-using-javascript-mqtt-js-and-bleuio-5a3e81639aa6?source=collection_archive---------5-----------------------#2022-02-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/0cc7d9d31bb4ea64084020aafcf440e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/0*GXHLm1V3_gQunpK-.jpg"/></div></figure><p id="f3a1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们生活在互联设备的世界里。物联网帮助我们更智能地生活和工作，并完全控制我们的生活。物联网的最新技术进步之一是 MQTT 网关，它充当云和物联网平台之间的中介。</p><p id="c189" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">MQTT 代表消息队列遥测传输。它是物联网设备和本地网络的关键通信协议之一。这是智能设备之间通信或机器对机器通信的理想协议。</p><h1 id="1550" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">什么是 MQTT 网关？</h1><p id="fb35" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">通常，MQTT 网关可以被定义为任何物联网平台和传感器之间的中介。它的工作原理是从这些传感器或智能设备获取数据，并将其转化为 MQTT。然后，它将数据传输到物联网平台或 MQTT 代理。</p><h1 id="144b" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">发布/订阅模式</h1><p id="13df" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">发布/订阅模式(也称为发布/订阅)为传统的客户机-服务器体系结构提供了一种替代方案。在客户端-服务器模型中，客户端直接与端点通信。发布/订阅模型将发送消息的客户端(发布者)与接收消息的客户端(订阅者)分离开来。发布者和订阅者从不直接联系。事实上，他们甚至没有意识到对方的存在。它们之间的连接由第三个组件(代理)处理。代理的工作是过滤所有传入的消息，并将它们正确地分发给订阅者。</p><h1 id="6ed4" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">MQTT 代理</h1><p id="09ec" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">在 MQTT 技术中，代理帮助处理客户。它可以一次管理数百、数千或数百万个相连的 MQTT 客户机，这取决于实现。其主要职能是:</p><ul class=""><li id="1b5e" class="ls lt in jt b ju jv jy jz kc lu kg lv kk lw ko lx ly lz ma bi translated">接收信息</li><li id="798e" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">解码和过滤接收到的消息</li><li id="093b" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">确定哪个客户端对哪个消息感兴趣</li><li id="985d" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">根据客户的兴趣将这些消息发送给他们</li></ul><h1 id="2569" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">该项目</h1><p id="b7bc" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">让我们做一个简单的 BLE 2 MQTT 项目，它从一个名为 hibo Air 的 BLE <a class="ae mg" href="https://www.hibouair.com/" rel="noopener ugc nofollow" target="_blank">空气质量监控设备收集传感器数据，并将其发送给一个免费的公共 MQTT 代理。</a></p><p id="e8e6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">对于这个项目，我们将使用 Flespi。您可以随意选择任何公共或私有 MQTT 代理。</p><p id="46bc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">步骤</strong></p><p id="252d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">要求</strong></p><ul class=""><li id="2b35" class="ls lt in jt b ju jv jy jz kc lu kg lv kk lw ko lx ly lz ma bi translated">一个<a class="ae mg" href="https://www.bleuio.com/" rel="noopener ugc nofollow" target="_blank">蓝色的</a>电子狗。</li><li id="e23d" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">一种<a class="ae mg" href="https://www.hibouair.com/" rel="noopener ugc nofollow" target="_blank">空气质量监测装置 hibo air</a>。</li><li id="9b9f" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">公共 MQTT 代理(Flepsi 令牌)<a class="ae mg" href="https://flespi.com/mqtt-broker" rel="noopener ugc nofollow" target="_blank">https://flespi.com/mqtt-broker</a></li><li id="78db" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">BleuIO Javascript 库。<a class="ae mg" href="https://www.npmjs.com/package/bleuio" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/bleuio</a></li><li id="1b65" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">一个 Javascript 的构建工具(包裹)【https://parceljs.org/docs/ T2</li></ul><p id="3a26" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">获得 Flespi 令牌</strong></p><ul class=""><li id="4c7d" class="ls lt in jt b ju jv jy jz kc lu kg lv kk lw ko lx ly lz ma bi translated">在 Flespi 创建一个帐户。</li><li id="142e" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">登录到 Flespi 仪表板。</li><li id="d793" class="ls lt in jt b ju mb jy mc kc md kg me kk mf ko lx ly lz ma bi translated">复制令牌</li></ul><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mh"><img src="../Images/898e7a56ac721dcb39929df61cc31c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PXn-C94bp_oR8dYN.png"/></div></div></figure><p id="fef1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">下载源文件</strong></p><p id="aaa8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">从<a class="ae mg" href="https://github.com/smart-sensor-devices-ab/ble2mqtt_bleuio.git" rel="noopener ugc nofollow" target="_blank">https://github . com/smart-sensor-devices-ab/ble2 mqtt _ bleuio . git</a>获取源文件</p><p id="0ab6" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">并运行<strong class="jt io"> npm 安装</strong></p><p id="470f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在根文件夹中，我们将看到两个名为 index.html 和 subscribe.html 的 Html 文件和两个名为 pub.js 和 sub.js 的 js 文件</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/05b1b2c564ed35d91057296c6b13ea76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/0*3lJBqCRDpeIgsC5G.png"/></div></figure><p id="243c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Index.html 文件在 BleuIO 的帮助下，从 BLE 空气质量监测设备 HibouAir 收集传感器数据。</p><p id="3ef7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">收集广告数据后，我们试图对其进行解码，并获得有意义的空气质量数据，包括二氧化碳、压力、温度、湿度和光照值。然后，我们使用主题名 HibouAirTopic 将数据发布到 Flepsi broker</p><p id="dee3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Subscribe.html 文件作为订户工作，从代理读取传感器数据并显示在屏幕上。</p><p id="9da4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">要运行 index.html，我们只需键入</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="a048" class="mw kq in ms b gy mx my l mz na">parcel index.html</span></pre><p id="2741" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">项目视频</strong></p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div></div>    
</body>
</html>