# Node.js 最佳实践—生产环境

> 原文：<https://blog.devgenius.io/node-js-best-practices-production-environment-b0c38065c783?source=collection_archive---------5----------------------->

![](img/ff705d3750eb57f0ce3eba66fa9fb123.png)

照片由[凯勒·伍兹](https://unsplash.com/@caleb_woods?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。

否则，我们以后会遇到各种各样的问题。

在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。

# 从节点中获取前端资产

我们的节点应用程序不应该服务器前端资产。

相反，我们可以使用专用的中间件来做到这一点。

当处理许多静态文件时，节点性能并不好，因为它是单线程的。

# 无国籍

我们的应用应该是无状态的。

这意味着我们应该将应用程序中的任何状态存储在外部数据存储中。

我们可以定期关闭我们的服务器，或者使用 AWS Lambda 这样的无服务器平台来实施无状态行为。

这样，我们可以在不停机的情况下关闭服务器。

# 使用自动检测漏洞的工具

任何包都可能有漏洞，使我们的应用程序处于危险之中。

这可以使用社区和商业工具来检查它们。

这样，我们可以尽快修补它们。

我们不想一直手动执行这项繁琐的任务。

# 为每个日志语句分配一个事务 ID

为每个日志语句分配一个事务 ID，可以方便地找到它们。

这是因为节点应用程序有很多异步代码，所以如果没有每个条目的唯一 ID，就很难知道记录的顺序。

没有 id，很难区分什么先来什么后来。

# 设置 NODE _ ENV =生产

我们可以将`NODE_ENV`设置为`production`，以便在生产中激活生产优化。

许多 NPM 软件包为生产优化了它们的代码。

例如，如果我们在生产中忘记将`NODE_ENV`设置为`production`，Express 将会慢 3 倍。

# 自动化、原子化和零停机部署

自动化部署至关重要。

他们让我们部署东西没有麻烦或风险。

它们还必须是原子性的，以便我们可以在出现任何问题时轻松逆转部署。

任何手动步骤都有很大的风险。

如果我们手动部署，那么我们部署的频率就会降低，这意味着更大的风险。

# 使用 Node.js 的 LTS 版本

通过错误修复、安全更新和性能改进，Node.js 的 LTS 版本得到了更长时间的支持。

因此，我们应该使用它们，这样我们就可以不断获得更新，而不必一直升级到新版本。

如果我们不保持我们的节点版本是最新的，那么我们就要冒有漏洞的风险。

# 不要在应用程序中路由日志

日志目的地不应该由开发人员硬编码，而应该由他们运行的执行环境来定义。

这样，我们的应用程序可以根据运行环境登录到不同的位置。

# 用`npm ci`安装包

使用`npm ci`，软件包将安装来自`package-lock.json`的版本。

我们每次运行时都会进行全新安装。

这样，我们就不用担心包裹差异了。

# Linter 安全规则

Linter 安全规则帮助我们快速捕捉节点应用的安全性。

[eslint-plugin-security](https://github.com/nodesecurity/eslint-plugin-security) 是一个 eslint 插件，帮助我们在瞬间捕捉到这些。

通过这种方式，我们可以立即修复发现的安全问题。

![](img/f8664a85e3c64cb86ff62e7376b65da5.png)

保罗·花冈在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 结论

我们在生产时应该遵循一些指导方针。

它们会让我们的生活更轻松，并以各种方式降低风险。