<html>
<head>
<title>Browser Automation with Python and Selenium — 3: Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Selenium 实现浏览器自动化— 3:架构</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/browser-automation-with-python-and-selenium-3-architecture-fa01f7d0763a?source=collection_archive---------3-----------------------#2020-12-16">https://blog.devgenius.io/browser-automation-with-python-and-selenium-3-architecture-fa01f7d0763a?source=collection_archive---------3-----------------------#2020-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bed0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">硒应用的鸟瞰图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1a5b453ff930bf506a1cddd0bfb5c808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YuBGTqKiy9f2mOPMbWg2QA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">伦敦经济学院图书馆在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="14ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://codenineeight.medium.com/browser-automation-with-python-and-selenium-2-getting-started-708a6c17f2a3" rel="noopener">之前的文章</a>中，我们看了一个简单完整的例子。在本文中，我将尝试解释 Selenium 应用程序的高级架构。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9d63" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">主要构件</h1><ul class=""><li id="ea5d" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated">Selenium 客户端库: Selenium 客户端库或 Selenium 语言绑定允许我们用自己选择的语言编写自动化脚本，如 Python、Ruby、Java 等。</li><li id="dd68" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><strong class="ky ir"> JSON Wire 协议:</strong> JSON Wire 协议是一个基于 REST 的 API，负责 selenium 脚本和浏览器驱动程序之间的通信。</li><li id="5f47" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><strong class="ky ir">浏览器驱动:</strong> Selenium 脚本通过相关的浏览器驱动与实际浏览器通信。浏览器驱动负责控制真正的浏览器。驱动程序与浏览器运行在同一系统上。由于有了驱动程序，Selenium framework 不需要知道不同 web 浏览器的实现细节。</li><li id="8cb3" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><strong class="ky ir">浏览器:</strong>这些是执行所需自动化任务的实际浏览器。它们从驱动程序接收命令，并调用各自的方法来完成任务。执行命令后，它们通过相同的路由返回响应。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/e3d04e896adfed3c196c19352671c23b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkTPOqeOh2JYlxD5tfKteQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者用 Inkscape 绘制</figcaption></figure><h1 id="59de" class="lz ma iq bd mb mc ni me mf mg nj mi mj jw nk jx ml jz nl ka mn kc nm kd mp mq bi translated">通信类型</h1><p id="70c3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">Selenium WebDriver 以两种不同的方式与浏览器对话:直接和远程。</p><h2 id="9996" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">1.直接交流</h2><p id="0d23" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">WebDriver 通过驱动程序与浏览器对话。在这种类型的通信中，web 驱动程序、浏览器驱动程序和真正的浏览器在同一个系统上。WebDriver 通过相同的路由传递命令和接收响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/e7418bedde932ecf8c2c7690d421eb4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*rMPBlNoH73h8PMKNiFlR1g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者用 Inkscape 绘制</figcaption></figure><h2 id="d16a" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">2.远程通信</h2><p id="33a7" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">也可以通过 Selenium 服务器或 RemoteWebDriver 进行远程通信。在这种情况下，RemoteWebDriver 与驱动程序和浏览器运行在同一系统上。通过远程 webdriver 发送和接收命令。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/4abd1c34a9b79f9d8efe99c9a3a0d4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Wdn4tQHD_A0pFtCXpdlnsQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者用 Inkscape 绘制</figcaption></figure><p id="c8a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">远程通信的另一种方式是通过 Selenium 服务器或 Selenium 网格组件。它们与主机系统上的浏览器驱动程序对话。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/82afe40e0918e4667454f6af13fc5fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*KFWDmSlWDCK7YzPk_CBBgg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者用 Inkscape 绘制</figcaption></figure><p id="d652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如<a class="ae kv" href="https://www.selenium.dev/documentation/en/webdriver/understanding_the_components/" rel="noopener ugc nofollow" target="_blank">官方文件</a>所述</p><blockquote class="oe"><p id="453a" class="of og iq bd oh oi oj ok ol om on lr dk translated">" WebDriver 有一个任务并且只有一个任务:通过上面的任何一种方法与浏览器通信."</p></blockquote></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cbf1" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">沟通的步骤</h1><pre class="kg kh ki kj gt oo op oq or aw os bi"><span id="1d1f" class="nq ma iq op b gy ot ou l ov ow">driver = Chrome()<br/>driver.get("https://www.python.org")</span></pre><p id="6ef4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">执行上面的代码片段会发生什么？</strong></p><ul class=""><li id="ec84" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr my mz na nb bi translated">Selenium WebDriver 首先启动特定于浏览器的服务器。</li><li id="7ebe" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">使用 HTTP 上的 JSON Wire 协议创建一个 HTTP 请求并发送给浏览器驱动程序(在本例中为 chromedriver)。</li><li id="8ef6" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器驱动程序接收 HTTP 请求。</li><li id="11ad" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器驱动程序通过 HTTP 服务器将请求发送给真正的浏览器(Chrome)。</li><li id="189b" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">该命令在浏览器上执行。</li><li id="bf32" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器将响应发送回浏览器驱动程序，浏览器最终将响应发送回自动化脚本。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4ca7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">通过示例进行更详细的解释</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pa pb l"/></div></figure><ol class=""><li id="8e19" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr pc mz na nb bi translated">在这一步中，我们将创建一个 Firefox WebDriver 实例。通过这个实例，我们将调用 api 来在真实的浏览器上运行一些操作。</li></ol><ul class=""><li id="7c52" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr my mz na nb bi translated">Selenium WebDriver 首先启动特定于浏览器的服务器。</li><li id="b854" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">这通过对<code class="fe pd pe pf op b">/session</code> <a class="ae kv" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#session" rel="noopener ugc nofollow" target="_blank">端点</a>进行<code class="fe pd pe pf op b">POST</code>调用来创建一个新会话。</li><li id="e94c" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">这里使用的实际类是<a class="ae kv" href="https://github.com/SeleniumHQ/selenium/blob/trunk/py/selenium/webdriver/firefox/webdriver.py" rel="noopener ugc nofollow" target="_blank">selenium . web driver . Firefox . web driver . web driver</a></li></ul><p id="a6e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.在创建了一个驱动实例之后，我们正在进行<code class="fe pd pe pf op b">get</code> api 调用。</p><ul class=""><li id="1256" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr my mz na nb bi translated">首先，创建一个 HTTP 请求发送给浏览器驱动程序。</li><li id="d696" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器驱动程序(在本例中是 geckodriver)通过 HTTP 服务器接收 HTTP 请求。</li><li id="03fe" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">Selenium WebDriver API 将在 JSON Wire 协议的帮助下，将从语言级绑定中取出的命令发送给浏览器驱动程序。</li><li id="95e6" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">这个<code class="fe pd pe pf op b">get</code>方法向<code class="fe pd pe pf op b"><a class="ae kv" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#sessionsessionidurl" rel="noopener ugc nofollow" target="_blank">/session/:sessionId/url</a></code>端点发出一个<code class="fe pd pe pf op b">POST</code>请求，指示浏览器打开给定的 url。</li><li id="cca9" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器驱动程序通过 HTTP 服务器向真正的浏览器(Firefox)发送请求。</li><li id="4d1a" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">浏览器将响应发送到浏览器驱动程序，然后以相同的路线发送到自动化脚本。</li></ul><p id="d89c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.在这一步中，我们使用 webdriver 接口的<code class="fe pd pe pf op b"><a class="ae kv" href="https://github.com/SeleniumHQ/selenium/blob/f8d557d94788ebd12165aa36d2b6122ea0c42d88/py/selenium/webdriver/remote/webdriver.py#L365" rel="noopener ugc nofollow" target="_blank">title</a></code>属性查询页面的标题。</p><ul class=""><li id="c5ff" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr my mz na nb bi translated">一个<code class="fe pd pe pf op b">GET</code>请求被发送到<code class="fe pd pe pf op b"><a class="ae kv" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#sessionsessionidtitle" rel="noopener ugc nofollow" target="_blank">/session/:sessionId/title</a></code>端点。</li></ul><p id="ab53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.最后一步，我们通过调用 webdriver 接口的<code class="fe pd pe pf op b"><a class="ae kv" href="https://github.com/SeleniumHQ/selenium/blob/f8d557d94788ebd12165aa36d2b6122ea0c42d88/py/selenium/webdriver/remote/webdriver.py#L779" rel="noopener ugc nofollow" target="_blank">quit</a></code>方法退出浏览器。</p><ul class=""><li id="82a2" class="mr ms iq ky b kz la lc ld lf ox lj oy ln oz lr my mz na nb bi translated">该方法通过第 2 项中提到的步骤向<code class="fe pd pe pf op b"><a class="ae kv" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#sessionsessionid" rel="noopener ugc nofollow" target="_blank">/session/:sessionId</a></code>端点发出<code class="fe pd pe pf op b">DELETE</code>请求。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="4204" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">要记住的事情</h2><ul class=""><li id="5023" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated">Selenium 客户端库或 Selenium 语言绑定允许我们用不同的语言编写自动化脚本。它们通过使用 JSON Wire 协议的浏览器驱动程序发送命令，在真实的浏览器上执行一些操作。</li><li id="d484" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">Selenium WebDriver 以两种不同的方式与浏览器对话:直接和远程通信。</li><li id="ba9a" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">WebDriver 有一个工作，也只有一个工作:与浏览器通信。</li></ul><p id="5461" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一篇文章中，我将讲述如何在网页上定位元素并与之交互。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="97d7" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">参考</h2><ol class=""><li id="dfd1" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr pc mz na nb bi translated"><a class="ae kv" href="https://www.selenium.dev/documentation/en/webdriver/understanding_the_components/" rel="noopener ugc nofollow" target="_blank">https://www . selenium . dev/documentation/en/web driver/understanding _ the _ components/</a></li><li id="cf44" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr pc mz na nb bi translated"><a class="ae kv" href="https://www.lambdatest.com/blog/automated-browser-testing-with-opera-and-selenium-in-python/" rel="noopener ugc nofollow" target="_blank">https://www . lambdatest . com/blog/automated-browser-testing-with-opera-and-selenium-in-python/</a></li><li id="84a5" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr pc mz na nb bi translated"><a class="ae kv" href="https://w3c.github.io/webdriver/#endpoints" rel="noopener ugc nofollow" target="_blank">https://w3c.github.io/webdriver/#endpoints</a></li><li id="f950" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr pc mz na nb bi translated"><a class="ae kv" href="https://artoftesting.com/selenium-webdriver-architecture" rel="noopener ugc nofollow" target="_blank">https://artoftesting.com/selenium-webdriver-architecture</a></li><li id="83f6" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr pc mz na nb bi translated"><a class="ae kv" href="https://www.journaldev.com/25698/selenium-webdriver-architecture" rel="noopener ugc nofollow" target="_blank">https://www . journal dev . com/25698/selenium-web driver-architecture</a></li><li id="d899" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr pc mz na nb bi translated"><a class="ae kv" href="http://makeseleniumeasy.com/2017/03/03/architecture-of-selenium-webdriver/" rel="noopener ugc nofollow" target="_blank">http://makeseleniumeasy . com/2017/03/03/architecture-of-selenium-web driver/</a></li></ol><p id="ad5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢你的时间。</p></div></div>    
</body>
</html>