<html>
<head>
<title>Tutorial: Build Serverless functions with C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:用 C#构建无服务器函数</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/tutorial-build-serverless-functions-with-c-f8dac135a674?source=collection_archive---------4-----------------------#2021-11-23">https://blog.devgenius.io/tutorial-build-serverless-functions-with-c-f8dac135a674?source=collection_archive---------4-----------------------#2021-11-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="eea1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一种叫做无服务器计算的解决方案彻底改变了云计算的世界。对于开发者来说，使用它绝对是一种享受。</p><p id="cfea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这项创新之前，开发人员不得不担心为他们的代码提供动力的资源。自从无服务器计算推出以来，开发人员对操作系统和硬件架构的关注已经成为过去。它处理所有的服务器管理，同时专注于您擅长的事情——编写高质量的代码。</p><p id="a4ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本文将解释如何在主要的云提供商服务上构建无服务器功能:Azure 和 AWS。</p><blockquote class="ki kj kk"><p id="4bd3" class="jk jl kl jm b jn jo jp jq jr js jt ju km jw jx jy kn ka kb kc ko ke kf kg kh ig bi translated">如果您是无服务器计算的新手，或者需要深入了解无服务器的起源和发展，请查看这篇<a class="ae kp" href="https://dashbird.io/blog/origin-of-serverless/" rel="noopener ugc nofollow" target="_blank">文章</a>。</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/d977e575b5b08c1e591d920b42590694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8uain6mF_RZ-wGd7OPnFQ.png"/></div></div></figure><h1 id="7381" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将 C#与 Azure 函数结合使用</h1><p id="5613" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">使用 C#构建无服务器 Azure Functions 应用程序需要满足两个基本的先决条件:</p><ol class=""><li id="e94e" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated">拥有有效的 Microsoft Azure 订阅。如果你还没有，你可以<a class="ae kp" href="https://azure.microsoft.com/en-us/free/" rel="noopener ugc nofollow" target="_blank">创建一个免费账户</a>。</li><li id="dc30" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">获取 Azure 存储帐户。如果你没有存储帐户，可以通过登录<a class="ae kp" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">Azure 门户</a>来创建。</li></ol><p id="1266" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一名 C#开发人员，您已经熟悉了用于构建应用程序的各种工具，包括 Visual Studio 代码和 Visual Studio IDE。这两个工具都有助于创建具有 Azure 功能的应用程序，这取决于你最喜欢哪一个。让我们更深入地研究一下这两个工具。</p><h1 id="6728" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Visual Studio 代码</h1><p id="3f7f" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">Visual Studio Code 是一个轻量级但功能强大的代码编辑器，有不同的版本可用于 Windows、Linux 和 macOS。</p><p id="84a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要为 Azure 函数构建应用程序，您需要获得 Azure Tools for Visual Studio 代码，它将为您提供直接从 VS 代码编辑器访问或创建资源的便捷命令。</p><p id="c704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要设置 Azure 工具，通过启动编辑器并导航到左侧菜单上的扩展市场来安装<a class="ae kp" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.vscode-azureextensionpack" rel="noopener ugc nofollow" target="_blank"> Azure 扩展包</a>。VS 代码中的扩展市场接口应该如下所示:</p><p id="3eac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您完成了 Azure for VS 代码的设置后，通过使用命令<strong class="jm io"> CTRL+Shift+P </strong>启动命令面板，并在出现的文本字段中键入“<strong class="jm io"> Azure: Login </strong>”，从代码编辑器登录 Azure。单击出现的相应结果，编辑器将生成一个代码，其中包含如何完成该过程的说明。</p><p id="0d2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你要用 VS 代码用 C#开发，另一个重要的扩展是 Visual Studio 代码的<a class="ae kp" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp" rel="noopener ugc nofollow" target="_blank"> C#。在撰写本文时，该扩展支持基本的调试功能，关于</a><a class="ae kp" href="http://aka.ms/vscclrdebugger" rel="noopener ugc nofollow" target="_blank">的全部细节可以在这里找到</a>。</p><h1 id="f10d" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Visual Studio 2017 IDE</h1><p id="770b" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">从 15.5 版本开始，Azure 开发工作负载与 Azure Functions 工具捆绑在一起。这意味着如果你计划安装 Visual Studio 2019 的最新版本，你需要在你的安装过程中包括 Azure 开发工作负载。</p><p id="4af7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装完成后，在 Visual Studio 中登录到您的 Microsoft 帐户，并创建一个新的 Azure Functions 项目，您就可以开始工作了。</p><p id="512d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">既然我们已经强调了如果你想用 Azure functions 在 C#中构建无服务器功能，你需要知道什么，让我们转到讨论你需要什么来开始在 AWS Lambda 无服务器框架上运行无服务器应用</p><h1 id="43ec" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将 C#与 AWS Lambda 一起使用</h1><p id="ecae" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">AWS Lambda 是 AWS 无服务器架构的计算部分，几乎不需要管理。这是最受欢迎的无服务器选项之一，尽管 AWS 在 2014 年推出了它，但在 2018 年，AWS 宣布正式支持<a class="ae kp" href="https://aws.amazon.com/about-aws/whats-new/2018/01/aws-lambda-supports-c-sharp-dot-net-core-2-0/" rel="noopener ugc nofollow" target="_blank"> a .NET Core 2.0 运行时</a>，并在<a class="ae kp" href="https://aws.amazon.com/blogs/compute/announcing-aws-lambda-supports-for-net-core-3-1/" rel="noopener ugc nofollow" target="_blank"> 2020 年支持 3.1 版本</a>。理解这一点至关重要。NET 核心不同于。以下是 AWS 选择的几个原因。NET 核心。NET 框架</p><ul class=""><li id="7d8b" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mt ml mm mn bi translated">。NET Core 是最新重新设计的。NET，它专注于更现代的应用程序，尤其是支持云的应用程序，这在编写 Lambda 函数时有很大的好处</li><li id="937f" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">。NET Core 是用模块化设计设计的，这意味着你只能包含。NET 你将需要当你写你的 Lambda 函数。这导致更少的内存使用，因为 Lambda 对内存使用收费，函数对内存的需求越少，使用 AWS Lambda 的成本就越低。</li><li id="3625" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">。NET Core 是开源的，并根据 Amazon Linux 进行了验证，Amazon Linux 是 AWS Lambda 的底层平台，这使得 AWS 可以应对使用它可能出现的安全问题。</li><li id="19ac" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">与。NET 核心，你现在可以在任何平台上编写你的 C#代码，而不是早期的。NET，在那里你可以只在 Windows 环境下编写 C#代码。</li></ul><p id="e443" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要开始使用 Visual Studio 在 C#中构建 Lambda 函数，您需要了解 AWS Lambda 有一个现成的模式来为您的 Lambda 函数创作代码。该模式包括以下概念:</p><ul class=""><li id="a25a" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mt ml mm mn bi translated"><strong class="jm io">处理程序</strong> —处理程序函数是由 AWS Lambda 调用的函数，用于开始执行您的 Lambda 函数。AWS Lambda 将任何输入数据作为第一个参数传递给该函数，并将一个上下文对象作为第二个参数传递。</li><li id="2639" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated"><strong class="jm io">上下文对象</strong> —是传递给处理函数的第二个参数，它提供了代码与 AWS Lambda 交互的信息。</li><li id="2d1e" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated"><strong class="jm io">记录</strong> —声音记录系统是编写良好的功能的重要组成部分。AWS Lambda 将这些日志写入 CloudWatch 日志。</li><li id="79f9" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated"><strong class="jm io">异常</strong></li></ul><p id="7cf2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们知道了为 AWS Lambda 编写的框架，让我们看看所有这些是如何一起工作的。</p><h1 id="c7a6" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">用 Visual Studio 编写 AWS Lambda 的 C#代码</h1><p id="8b9d" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">开始为 Lambda 函数编写代码需要一些先决条件:</p><ul class=""><li id="9197" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mt ml mm mn bi translated">如果你没有，你可以<a class="ae kp" href="https://portal.aws.amazon.com/billing/signup?nc2=h_ct&amp;src=header_signup&amp;redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start" rel="noopener ugc nofollow" target="_blank">在这里</a>创建一个 AWS 账户</li><li id="a4a4" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated"><a class="ae kp" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank">下载</a>并安装 Visual Studio IDE 2019。</li><li id="3731" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated"><a class="ae kp" href="https://marketplace.visualstudio.com/items?itemName=AmazonWebServices.AWSToolkitforVisualStudio2017" rel="noopener ugc nofollow" target="_blank">下载</a>并安装 AWS Toolkit for Visual Studio</li></ul><p id="d6c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦您安装了所有的先决条件，打开 Visual Studio 并在 Start Page 选项卡旁边显示的 AWS Toolkit for Visual Studio 窗口的<strong class="jm io">上填写 AWS 凭证。可以按照窗口中的说明获取凭证(访问密钥和秘密密钥)。</strong></p><p id="5a96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一切就绪后，让我们继续构建 Lambda 项目。</p><ul class=""><li id="a1d0" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mt ml mm mn bi translated">创建一个. NET 核心 Lambda 项目</li><li id="2835" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">打开 Visual Studio IDE，然后转到“文件”&gt;“新建”&gt;“项目”</li><li id="d2fd" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">在“已安装”窗格上，单击 Visual C#，然后单击 AWS Lambda 项目(。NET Core)如下图所示:</li><li id="2f6a" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">用您选择的名称填写项目名称，并单击 OK，保留默认值，然后继续选择您想要构建的 Lambda 项目的类型。</li><li id="9427" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">单击 Finish 创建项目，并查看项目代码和结构。</li></ul><p id="319e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用项目创建的一个关键文件是<code class="fe mu mv mw mx b">aws-lambda-tools-defaults.json</code>文件，您可以在其中设置函数处理程序和其他选项。</p><p id="d37b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该文件的内容应该如下所示:</p><pre class="kr ks kt ku gt my mx mz na aw nb bi"><span id="a4de" class="nc ld in mx b gy nd ne l nf ng">{<br/>  "Information": [<br/>    "This file provides default values for the deployment wizard inside Visual Studio, and the AWS Lambda commands added to the .NET Core CLI.",<br/>    "To learn more about the Lambda commands with the .NET Core CLI execute the following command at the command line in the project root directory.",<br/>    "dotnet lambda help",<br/>    "All the command line options for the Lambda command can be specified in this file."<br/>  ],<br/>  "profile": "default",<br/>  "region": "us-east-2",<br/>  "configuration": "Release",<br/>  "framework": "netcoreapp3.1",<br/>  "function-runtime": "dotnetcore3.1",<br/>  "function-memory-size": 256,<br/>  "function-timeout": 30,<br/>  "function-handler": "AWSLambda1::AWSLambda1.Function::FunctionHandler"<br/>}</span></pre><h1 id="3153" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">发布到 AWS Lambda</h1><p id="2743" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在 AWS Lambda 上运行我们的代码的下一步是发布它。这是在代码已经被审查并且你确信它是好的之后进行的。下面的步骤概述了发布代码需要做的事情。</p><ul class=""><li id="9337" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mt ml mm mn bi translated">在右边，你可以看到这个项目。在解决方案资源管理器中，单击“发布到 AWS Lambda”。</li><li id="53c8" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">接下来，在出现的上传到 AWS Lambda 窗口中填写函数名。此时，您可以为您的函数指定任何喜欢的名称。完成后，单击下一步。</li><li id="499e" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">在“高级功能详细信息”页面上，使用与您的 AWS 帐户相关联的角色填写“角色名称”部分。这是一个必填字段，需要在进入上传流程的下一阶段之前提供。其他部分包括 VPC 部分(仅当您的功能将访问亚马逊 VPC 上的资源时适用)和环境部分。</li><li id="87c9" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">一旦您的函数开始上传，将显示一个显示上传状态的窗口，之后将显示一个函数视图页面，您可以在其中分别测试您的函数和查看日志。</li><li id="e2b5" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mt ml mm mn bi translated">Invoke 按钮开始测试函数，同时日志输出显示测试的输出。这些日志也保存在 AWS 中的 CloudWatch 日志中，在那里可以查看日志的更多细节。</li></ul><h1 id="d59c" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="7020" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">现在，您已经快速了解了使用强大的 C#编程语言构建和发布无服务器应用程序所需的知识，尽管在<a class="ae kp" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>上，我们更倾向于 AWS Lambda，但没有什么可以阻止您探索 Microsoft Azure 函数和 AWS Lambda 选项，为您的应用程序获得无服务器基础架构。</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><p id="68a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kl">延伸阅读:</em></p><p id="eab0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kp" href="https://dashbird.io/blog/how-to-get-overview-c-lambdas/" rel="noopener ugc nofollow" target="_blank">如何获得 C# Lambda 函数的概述</a></p><p id="f7b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kp" href="https://dashbird.io/blog/aws-vs-azure/" rel="noopener ugc nofollow" target="_blank"> AWS vs Azure，快速对比</a></p><p id="5d6d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae kp" href="https://dashbird.io/observability/serverless-observability-real-time-debugging/" rel="noopener ugc nofollow" target="_blank">无服务器可观察性和实时故障排除</a></p></div></div>    
</body>
</html>