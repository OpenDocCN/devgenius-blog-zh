<html>
<head>
<title>Data and File Storage in Hadoop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hadoop 中的数据和文件存储</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/data-and-file-storage-in-hadoop-4659eb3b28a6?source=collection_archive---------9-----------------------#2022-10-06">https://blog.devgenius.io/data-and-file-storage-in-hadoop-4659eb3b28a6?source=collection_archive---------9-----------------------#2022-10-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/060e2e75886ff82c42d085121f9bf362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fc7z7k_ejVECneSlXjI8YA.png"/></div></div></figure><h2 id="9173" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Hadoop 存储格式是什么？</h2><blockquote class="kr ks kt"><p id="9d17" class="ku kv kw kx b ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><!-- -->存储格式定义了信息如何存储在文件或数据库中。文件的扩展名表明了这一点。不同的大数据堆栈使用不同的数据/文件格式，包括 Spark、Hadoop、Hive 等。本文将概述不同的 Hadoop 存储格式。</p></blockquote><h2 id="3d94" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">标准 Hadoop 存储文件格式</h2><p id="811b" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">一些标准文件格式是文本文件(CSV、XML)或二进制文件(图像)。</p><p id="e301" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io">文本数据— </strong>这些数据以 CSV 或非结构化数据(如 twitters)的形式出现。常用于在 Hadoop 和外部系统之间交换数据的 CSV 文件。</p><p id="a5f2" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io">结构化文本数据— </strong>这是一种更加专门化的文本文件形式，比如 XML 或 JSON。JSON 处理比 XML 更具挑战性，因为在 JSON 中没有标记来标记记录的开始或结束。</p><p id="e8fe" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io">序列文件— </strong>这些文件以二进制格式存储数据，结构类似于 CSV。序列文件只存储数据。序列文件支持块压缩。</p><h2 id="242a" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Hadoop 存储序列化格式</h2><p id="0740" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">序列化是将数据结构转换成字节流以便存储或通过网络传输的过程。反序列化是将字节流转换为数据结构的过程。可写是 Hadoop 使用的主要序列化格式。可写程序快速而简洁，但是很难从 Java 之外的语言中扩展或使用。一些序列化框架正在 Hadoop 生态系统中使用。</p><p id="5032" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io"> Thrift — </strong>为实现服务的跨语言接口而开发。它使用 IDL 文件来生成存根代码，用于执行跨编程语言无缝通信的 RPC 客户端和服务器。它支持 MapReduce。</p><p id="a7e8" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io">协议缓冲区(protobuf) — </strong>它提供了在用不同语言编写的服务之间交换数据的工具。也是通过类似节俭的 IDL 定义的。它既不可分割，不可压缩，也不支持像节俭的 MapReduce。</p><p id="de9c" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io"> Avro 文件— </strong>它是一个语言中立的数据序列化系统。Avro 将元数据数据与数据一起存储。Avro 支持 MapReduce。Avro 数据文件被阻止压缩和分裂。Avro 文件支持模式进化，这使得 Avro 比序列文件更好。</p><h2 id="9336" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">分栏格式</h2><p id="5ea0" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">对于最近现代大数据应用有用的柱状数据格式。与面向行的数据库相比，列格式有几个优点。当需要访问列的一个很小的子集时，那么使用列格式的数据库，但是当需要获得许多列时，那么面向行的数据库更可取。</p><p id="3f1f" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated">有一些分栏文件格式——</p><p id="9c05" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io"> RC 文件— </strong>这是 Hadoop 中使用的第一种柱状文件格式。RCFile 格式是为 MapReduce 应用程序提供高效处理而开发的。开发它是为了提供快速的数据加载、快速的查询处理和高效的存储空间利用。RC 文件适合查询，但是编写 RC 文件比非列式文件格式需要更多的内存和计算。它不支持模式进化。</p><p id="ff7c" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io"> ORC 文件— </strong> ORC 文件由 HortonWorks 发明，用于优化 Hive 中的性能。ORC 文件与 RC 文件具有相同的优点和局限性，只是在 Hadoop 上做得更好。ORC 文件比 RC 文件压缩得更好，支持更快的查询。它也不支持模式进化。专为 Hive 设计的 ORC 不能与 Pig 或 Java 或 Impala 等非 Hive MapReduce 接口一起使用。它包含一组称为条带的行数据。</p><p id="9b86" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated"><strong class="kx io"> Parquet 文件— </strong>是一种柱状数据格式，适用于 Java、Hive、Pig 等不同的 MapReduce 接口。它也非常适合其他处理引擎，如 Impala 和 Spark。Parquet 在性能上与 RC 和 ORC 相当，但是编写其他列格式时速度较慢。Parquet 支持模式进化。拼花支持在结构末端添加新列的功能。目前，Hive 和 Impala 支持 query 添加新列，但 Pig 等其他工具可能会面临挑战。</p><h1 id="1437" class="ly jw in bd jx lz ma mb ka mc md me kd mf mg mh kh mi mj mk kl ml mm mn kp mo bi translated">为什么调整 Hadoop 存储格式很重要？</h1><p id="f34d" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">对于 Spark 和 MapReduce 等支持 HDFS 的应用程序来说，一个巨大的瓶颈是在特定位置找到相关数据并将数据写回到另一个位置所花费的时间。管理大型数据集的困难加剧了问题，例如不断变化的存储约束或模式。这里是一些用例中涉及的各种文件格式，作为缓解这些问题的一种方式。</p><p id="417e" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated">以下是选择适当文件格式的一些重要好处——</p><ul class=""><li id="446f" class="mp mq in kx b ky kz lc ld ke mr ki ms km mt ls mu mv mw mx bi translated">更快的读取时间</li><li id="481d" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">更快的写入时间</li><li id="bd70" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">可拆分文件</li><li id="c16d" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">模式进化支持</li><li id="02e2" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">高级压缩支持</li></ul><p id="05f0" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated">有些文件格式是为一般用途而设计的(如 Spark 或 MapReduce)，有些是为更具体的用例而设计的，还有一些是为特定的数据特征而设计的。所以有很多选择。</p><h2 id="584b" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">如何采用文件格式？</h2><p id="2018" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">选择文件格式时，有三种性能需要考虑。</p><ul class=""><li id="64f7" class="mp mq in kx b ky kz lc ld ke mr ki ms km mt ls mu mv mw mx bi translated">写入性能—如何快速写入数据。</li><li id="f533" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">部分读取性能—如何读取文件中的各个列。</li><li id="3e48" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">完整读取性能—如何读取文件中的每个数据元素。</li></ul><p id="7d1e" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated">一种列式压缩文件格式，如 ORC 或 Parquet，用于部分和全部读取性能，但这些格式的写入性能代价很高。未压缩的 CSV 文件写入速度快，但缺少列方向，压缩速度慢读取速度慢。</p><p id="737c" class="pw-post-body-paragraph ku kv in kx b ky kz la lb lc ld le lf ke lh li lj ki ll lm ln km lp lq lr ls ig bi translated">许多选项可用于存储数据。如果需要存储 MapReduce 作业之间的中间数据，那么序列文件是首选。如果查询性能是最重要的，那么 ORC 或 Parquet 是最佳选择，但是这些文件需要更长的时间来编写。如果模式会随着时间而改变，那么 Avro 是最好的，但是查询性能会比 ORC 或 Parquet 慢。如果从 Hadoop 中提取数据并批量加载到数据库中，CSV 文件是最佳选择。</p><h2 id="0f37" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">选择正确存储格式的好处</h2><ul class=""><li id="03b7" class="mp mq in kx b ky lt lc lu ke nd ki ne km nf ls mu mv mw mx bi translated">更快的读取时间</li><li id="d9bb" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">更快的写入时间</li><li id="9c96" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">分割文件</li><li id="249f" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">模式进化支持(允许您更改数据集中的字段)。</li><li id="c530" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">高级压缩支持(使用压缩编解码器压缩文件，而不牺牲这些功能)。</li></ul><h2 id="c808" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Hadoop 文件存储的最佳实践</h2><ul class=""><li id="bdde" class="mp mq in kx b ky lt lc lu ke nd ki ne km nf ls mu mv mw mx bi translated">当只需要访问一个很小的列的子集时，就使用列数据格式。</li><li id="4459" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">当需要获得许多列时，就使用面向行的数据库，而不是列数据库。</li><li id="8ae8" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">如果模式随时间变化，那么使用 Avro 而不是 ORC 或 Parquet。</li><li id="e590" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">如果需要执行查询，则使用 ORC 或 Parquet，而不是 Avro。</li><li id="e08a" class="mp mq in kx b ky my lc mz ke na ki nb km nc ls mu mv mw mx bi translated">如果需要执行列添加操作，则使用 Parquet 而不是 ORC。</li></ul><h1 id="94ac" class="ly jw in bd jx lz ma mb ka mc md me kd mf mg mh kh mi mj mk kl ml mm mn kp mo bi translated">结束文件存储</h1><p id="5e13" class="pw-post-body-paragraph ku kv in kx b ky lt la lb lc lu le lf ke lv li lj ki lw lm ln km lx lq lr ls ig bi translated">对 Hadoop 生态系统上著名存储技术的评估表明，Apache Avro 是结构化数据的快速通用编码器。由于非常高效的序列化和反序列化，这种格式保证了在需要同时访问记录的所有属性(数据传输、暂存区等)时的出色性能。Apache Parquet 和 Apache Kudu 在快速数据接收、快速随机数据查找和可扩展数据分析之间提供了出色的灵活性，同时确保了系统的简单性——仅使用一种技术来存储数据。当 Parquet 优于更快的数据扫描和摄取时，Kudu 优于更快的随机查找。</p></div></div>    
</body>
</html>