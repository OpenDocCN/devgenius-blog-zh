<html>
<head>
<title>Beginners Guide to React’s Custom Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 的自定义钩子初学者指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-custom-hooks-in-react-to-fetch-data-2862c8e417f5?source=collection_archive---------8-----------------------#2022-06-09">https://blog.devgenius.io/how-to-use-custom-hooks-in-react-to-fetch-data-2862c8e417f5?source=collection_archive---------8-----------------------#2022-06-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jk jl jm jn"><div class="bz fp l di"><div class="jo jp l"/></div></figure><p id="ac15" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">在这篇博客中，我们将学习如何开始使用 React 中的定制钩子。</p><p id="caba" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们将首先使用以下命令创建一个 React 应用程序:</p><figure class="ko kp kq kr gt jn"><div class="bz fp l di"><div class="ks jp l"/></div></figure><p id="a8c7" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">一旦脚本执行完毕，您希望将目录更改为<strong class="js io"> my-app </strong>并运行<strong class="js io"> npm run start </strong>或者如果您使用 yarn 作为包管理器，请运行 yarn start，这将打开<a class="ae kt" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">T5 上的开发服务器。</a></p><p id="15e1" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们将在编写任何代码之前进行一些清理，您想要删除 logo，从<strong class="js io"> App.css </strong>中删除全部内容，从<strong class="js io"> index.css </strong>中删除全部内容，从<strong class="js io"> App.js </strong>中的 header 标记中删除<strong class="js io"> jsx </strong>并删除<strong class="js io"> App.js 中的所有 import 语句。</strong>最后删除<strong class="js io"> React。来自<strong class="js io"> index.js </strong>文件的 StrictMode </strong>代码。现在你应该有更清晰的代码来完成工作了。现在你想安装<strong class="js io"> axios </strong>来帮助我们使用公共 API 获取数据。</p><figure class="ko kp kq kr gt jn"><div class="bz fp l di"><div class="ks jp l"/></div></figure><p id="a00d" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们将在<strong class="js io"> src </strong>下创建一个<strong class="js io"> hooks </strong>目录，并创建一个名为<strong class="js io"> useFetchData.js. </strong>的文件，在该文件中我们将有以下代码。我稍后会解释我们正在做什么。</p><figure class="ko kp kq kr gt jn"><div class="bz fp l di"><div class="ks jp l"/></div></figure><p id="c333" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">自定义钩子只是 javascript 函数，函数名以<strong class="js io">开头，使用</strong>。<strong class="js io">使用</strong>的目的是让 React 知道这不是一个常规函数，但它需要被视为钩子，然后允许 React 控制该函数的使用，以遵循钩子的标准和规则。现在我们知道了什么是定制钩子，让我们探索一下使用定制钩子的一些好处。</p><p id="4ad1" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">定制钩子允许我们在函数中使用内置钩子，而不需要功能组件，它帮助我们将业务逻辑从组件中抽象出来，使组件的代码更加清晰可读，显然使用定制钩子还有很多好处。</p><p id="d4db" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">让我们研究一下我们之前添加的代码，以了解发生了什么。</p><p id="7461" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">场景:我们正在尝试从公共 API 中获取数据，在那里我们将获得随机的狗图像，这些图像将用于在 UI 中显示。</p><p id="1115" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated"><strong class="js io">执行:</strong>在第 4–6 行中，我们设置状态来管理我们的<strong class="js io">加载</strong>、<strong class="js io">成功</strong>和<strong class="js io">失败</strong>状态。</p><p id="8f27" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们将创建一个依赖于<strong class="js io"> url </strong>的<strong class="js io"> useEffect </strong>钩子，每次组件调用这个定制钩子并且 url 改变时，我们将获取数据。</p><p id="d453" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">在运行 axios 获取数据之前，我们将<em class="ku"> loading </em>状态设置为 true，这意味着我们即将发出请求或者我们处于请求周期的中间。如果请求成功，我们将进入第 12 行的程序块，其中将把<em class="ku">加载</em>状态设置为<em class="ku">假</em>，并将<strong class="js io">数据</strong>设置为<em class="ku">数据</em>状态。如果出现某种网络错误或请求没有通过，我们将在<strong class="js io"> catch </strong>块中处理错误，并在第 31 行设置错误消息，同时将<em class="ku">加载</em>状态设置为<em class="ku"> false </em>。</p><p id="a088" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们正在定义一个名为<strong class="js io"> fetchMoreData </strong>的函数，它与<strong class="js io"> useEffect </strong>具有相同的内容，这个函数的目的是当我们的组件中有<em class="ku"> onClick </em>事件时触发 fetch，我们将在后面的博客中探讨。</p><p id="fb5b" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">现在，在我们的定制钩子上唯一未完成的任务是导出一个带有<em class="ku"> loading </em>、<em class="ku"> data </em>、<em class="ku"> error 和 fetchMoreData </em>函数的对象，我们将在我们的组件中使用这些函数。现在，我们已经完成了我们的定制钩子，我们可以继续对<strong class="js io"> App.js </strong>文件进行修改。</p><p id="4be1" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">这就是我们将要添加到我们的<strong class="js io"> App.js </strong>文件中的内容。稍后我会解释这是怎么回事。</p><figure class="ko kp kq kr gt jn"><div class="bz fp l di"><div class="ks jp l"/></div></figure><p id="f204" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">在<strong class="js io"> App.js </strong>中，我们正在导入我们之前构建的定制钩子。在第 4 行，我们将请求 url 作为参数传递给我们的自定义钩子。由于这个钩子返回了一个对象，我们正在对进行<em class="ku">析构，以获得<em class="ku">正在加载</em>、<em class="ku">数据</em>、<em class="ku">错误</em>和<em class="ku"> fetchMoreData </em>来管理我们 UI 中的各种状态。</em></p><p id="5c72" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我们的<em class="ku"> html </em>非常简单，我们有一个带有<em class="ku"> onClick </em>的按钮，在这里我们调用<em class="ku"> fetchMoreData </em>，这将在我们每次点击按钮时触发 API 调用。如果<em class="ku">加载</em>状态为<em class="ku">真</em>，我们显示<em class="ku"> h2 </em>标签和加载…文本，如果有<em class="ku">数据</em>我们通过从<em class="ku">数据</em>对象中获取消息数据字段来显示图像，如果有<em class="ku">错误</em>我们在 h2 标签内显示<em class="ku">错误</em>。</p><p id="75d2" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">这就是使用定制钩子获取数据所需的全部内容。祝贺您，您已经成功创建了一个自定义挂钩。</p><p id="9bcf" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">如果你喜欢博客，请在<a class="ae kt" href="https://github.com/sudiparyal185" rel="noopener ugc nofollow" target="_blank"> github </a>上关注我。</p><p id="85a6" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">您可以在以下网址找到完整的源代码:</p><div class="kv kw gp gr kx ky"><a href="https://github.com/sudiparyal185/custom-hook-to-fetch-data" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab fo"><div class="la ab lb cl cj lc"><h2 class="bd io gy z fp ld fr fs le fu fw im bi translated">GitHub-sudiparyal 185/custom-hook-to-fetch-data:这使用自定义钩子从公共…</h2><div class="lf l"><h3 class="bd b gy z fp ld fr fs le fu fw dk translated">这个项目是用 Create React App 引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="lg l"><p class="bd b dl z fp ld fr fs le fu fw dk translated">github.com</p></div></div><div class="lh l"><div class="li l lj lk ll lh lm ln ky"/></div></div></a></div><p id="b19a" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">请关注我更多编程博客。谢谢你。</p></div></div>    
</body>
</html>