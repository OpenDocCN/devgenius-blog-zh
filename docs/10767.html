<html>
<head>
<title>How to Automatically Transcribe a Notion MP3 File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自动转录一个想法 MP3 文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-automatically-transcribe-a-notion-mp3-file-37d32cb23701?source=collection_archive---------16-----------------------#2022-11-27">https://blog.devgenius.io/how-to-automatically-transcribe-a-notion-mp3-file-37d32cb23701?source=collection_archive---------16-----------------------#2022-11-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f762" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">自然语言处理</h2><div class=""/><div class=""><h2 id="ebb3" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用您自己的云 NLP 来转录一个概念文件</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/67624a51ed9b6ac6d18f2729e94e49b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rg_5uu1qMorHM8bIxTv37g.png"/></div></div></figure><p id="ae9b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">时间超级宝贵。如果我们可以每天从重复的任务中节省几分钟或几个小时，我们就可以把节省下来的时间花在我们喜欢的活动上。作为程序员，我们可以自动化一些重复的任务，回到我们想要的生活。</p><p id="fc79" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">让我们来看看如何创建一个应用程序来实现这一点。让我们用 Python 创建一个应用程序，将流行的生产力工具<a class="ae lw" href="https://www.notion.so/" rel="noopener ugc nofollow" target="_blank">概念</a>与新兴的自然语言处理(NLP)包管理器<a class="ae lw" href="https://www.steamship.com/" rel="noopener ugc nofollow" target="_blank">轮船</a>连接起来。我们的应用程序将把一个 mp3 文件放入 opinion，通过 Steamship audio-markdown 包运行它，并将 markdown 返回到与初始 mp3 文件相同的页面。点击这里查看 GitHub 。</p><p id="5dd4" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在本帖中，我们将介绍:</p><ul class=""><li id="8fbe" class="lx ly iq lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated">Notin 简介</li><li id="9525" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">如何以编程方式使用概念</li><li id="e74d" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">激活您的概念 API</li><li id="5a33" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">使用概念 API 检索音频数据</li><li id="a280" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">将转录的文本返回到概念</li><li id="813e" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">介绍 Steamship，为我们管理云基础设施的 NLP 包</li><li id="8632" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">创建一个轮船包来转录一个概念块中的 MP3 文件</li><li id="3ada" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">转录我们的音频文件</li><li id="1f6e" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">公开 API 端点</li><li id="8250" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">如何在 idea 中自动转录 MP3 文件的总结</li></ul><h1 id="a5af" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">什么是观念</h1><p id="dc42" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">概念是一个项目管理软件平台，旨在帮助组织管理他们的效率和生产力。您可以配置页面来保存您需要的任何信息。每页可以有任意多的“块”,以有组织的方式存储数据。</p><p id="f3ec" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">一个块可以是一个表格、一段文本、一幅图像，或者是任何一种 content 接受的内容类型。在我们的例子中，我们创建了一个保存 mp3 文件的块。然后，我们将我们的概念块连接到 Steamship audio-markdown 包来转录音频。</p><h1 id="f893" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">概念相关函数</h1><p id="6520" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">我们要做的第一组函数与概念有关。<code class="fe ni nj nk nl b">notion.py</code>文件包含检索和返回放在我们的概念工作空间中的 mp3 文件数据的代码。在下面的照片中，你可以看到我们的工作空间和我们保存的 mp3 文件。mp3 文件的名称是<code class="fe ni nj nk nl b"><em class="nm">cows_crows.mp3</em></code>。这个档案里有我说“牛抓不到乌鸦”的录音。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/6e37b96637d7cd711da74adfe7d2910b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ra3ovhfmzIYgdT5Y"/></div></div></figure><h2 id="f58f" class="no mm iq bd mn np nq dn mr nr ns dp mv lj nt nu mx ln nv nw mz lr nx ny nb iw bi translated">激活您的概念 API</h2><p id="0fa4" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">要开始使用概念 API，请访问他们的<a class="ae lw" href="https://developers.notion.com/" rel="noopener ugc nofollow" target="_blank">开发者门户</a>并开始使用 API。从那里，只需创建您的 API 集成并复制您的 API 密钥。保存您的概念 API 键，因为我们稍后将使用它来连接概念和 Steamship。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/71d181d33b440c9af32dc1f3b605a1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D3rXwzeWP-cQf_f7"/></div></div></figure><p id="e3e3" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如下所示调整您的 API 设置——它应该能够读取和更新内容。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/fb41d18930549cfa4b1317db00697fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jjg50D1DuOR3_BQW.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/195025372ad46751400a87ff68173dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7F7W6yQoWsPV39NN"/></div></div></figure><p id="51dd" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在使用页面上的 API 之前，您需要转到您的概念页面的右上角，并单击这三个点。下拉菜单应该如下图所示。单击“更多”按钮，添加您之前创建的概念集成。在这种情况下，我把我的称为“用轮船测试”。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/cfbf9d2dba275d5e33fd7a3ba5c5b6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xk9sXdDcgaGLNEaM"/></div></div></figure><p id="b393" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">一旦您设置了应用程序集成并复制了 API 密钥，它就可以包含在头文件代码中。该头还声明了当前版本的概念，以及期望和接受的内容类型都将是 json 格式。</p><h2 id="d4fc" class="no mm iq bd mn np nq dn mr nr ns dp mv lj nt nu mx ln nv nw mz lr nx ny nb iw bi translated">使用概念 API 检索音频数据</h2><p id="0c34" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">我们通过导入必要的库来启动 Python 脚本:<code class="fe ni nj nk nl b">Dict</code>、<code class="fe ni nj nk nl b">requests</code>和<code class="fe ni nj nk nl b">json</code>。我们使用<code class="fe ni nj nk nl b">Dict</code>指定传入字典的键和值对的预期类型，<code class="fe ni nj nk nl b">requests</code>发送 URL 请求，<code class="fe ni nj nk nl b">json</code>解析 JSON 响应。</p><p id="7a22" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，我们编写一个名为<em class="nm">的函数来导入概念的基本头信息。为了正确的应用程序连接，我们需要使用为我们的开发人员应用程序提供的 API 关键概念。这个函数接受一个参数，我们的 API 键，并返回一个字典，必要的头。</em></p><p id="797e" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，我们创建一个函数来检索存放 mp3 文件的路径。根据概念开发者 API <a class="ae lw" href="https://developers.notion.com/" rel="noopener ugc nofollow" target="_blank">文档</a>，我们可以使用他们提供的端点直接连接到我们的工作空间。我们使用前面导入的请求库向概念端点发送一个 HTTP GET 请求，以 json 格式返回我们的数据。</p><p id="85aa" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe ni nj nk nl b">notion_get</code>函数有两个参数，一个块的路径和我们的 API 键。我们在函数中做的第一件事是生成 URL，我们可以通过概念 API 从该 URL 获取我们的块。接下来，我们发送一个请求，并传递我们之前创建的带有 API 密钥的头，以进行身份验证。在返回响应之前，我们将其转换为 JSON 格式。在这个例子中，为了清晰和调试，我们还打印出了响应文本和 JSON 格式的响应文本。</p><pre class="kp kq kr ks gt ob nl oc bn od oe bi"><span id="65cc" class="of mm iq nl b be og oh l oi oj">from typing import Dict<br/>import requests<br/>import json<br/><br/>def notion_headers(api_key: str) -&gt; dict:<br/>    return {<br/>        'authorization': f"Bearer {&lt;YOUR API KEY HERE&gt;}",<br/>        'Content-Type': 'application/json',<br/>        'Notion-Version': '2022-06-28',<br/>        "accept": "application/json",<br/>    }<br/><br/>def notion_get(path: str, api_key: str):<br/>    url = f"https://api.notion.com/v1/{path}"<br/>    response = requests.get(url, headers=notion_headers(api_key))<br/>    print(response.text)<br/>    res_json = json.loads(response.text)<br/>    print(res_json)<br/>    return res_json</span></pre><p id="28b5" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">前两个函数将在我们的 API 脚本的开头执行，检索用于转录的初始 mp3 文件数据。下面两个函数将在我们的应用程序结束时执行，以将音频降价返回到概念。由于<a class="ae lw" href="https://pythonalgos.com/python-single-responsibility-principle/" rel="noopener ugc nofollow" target="_blank">模块化编程</a>的好处，我们将它们写在同一个 Python 脚本文件中。现在让我们来看看将 markdown 文件返回到 Notion 的函数。</p><h2 id="48d9" class="no mm iq bd mn np nq dn mr nr ns dp mv lj nt nu mx ln nv nw mz lr nx ny nb iw bi translated">将转录的文本返回到概念</h2><p id="4440" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">我们编写一个名为<em class="nm">的函数，将 mp3 音频块的路径、JSON 格式的内容和 API 键作为参数。它调用头部信息和 HTTP 请求补丁方法，将我们的 JSON 数据连接到概念 API 端点。<a class="ae lw" href="https://developers.notion.com/reference/patch-page" rel="noopener ugc nofollow" target="_blank">概念 API 文档</a>概述了如何正确定义它们的块对象类型。<em class="nm"> add_markdown() </em>函数将概念页面的 ID、markdown 转录和 API 键作为参数。该函数模拟了他们的文档，并定义了音频降价文本数据的特定段落块对象内容。这个补丁请求将向我们的概念工作区添加一个新块，其中包括我们的音频降价。</em></p><pre class="kp kq kr ks gt ob nl oc bn od oe bi"><span id="a742" class="of mm iq nl b be og oh l oi oj">def notion_patch(path: str, content: Dict, api_key: str):<br/>    url = f"https://api.notion.com/v1/{path}"<br/>    response = requests.patch(url, json=content, headers=notion_headers(api_key))<br/>    res_json = response.json()<br/>    return res_json<br/> <br/>def add_markdown(page_id: str, markdown: str, api_key: str):<br/>    add_text_block = {<br/>        "children":<br/>            [{<br/>                "object": "block",<br/>                "type": "paragraph",<br/>                "paragraph": {<br/>                    "rich_text": [{<br/>                        "type": "text",<br/>                        "text": {<br/>                            "content": markdown,<br/>                        }<br/>                    }]<br/>                }<br/>            }]<br/>    }<br/>    return notion_patch(f"blocks/{page_id}/children", add_text_block, api_key)</span></pre><h1 id="c877" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">什么是轮船</h1><p id="b3c2" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">Steamship 是一款尖端的自然语言处理软件，旨在让您快速轻松地将语言 AI 添加到您的软件中。Steamship 包像标准 Python 模块一样导入到您的代码中，但是它们运行在云中自己的自动管理的堆栈上。因为它们在云中运行在为自然语言处理而设计的自动管理堆栈上，所以您可以根据需要快速扩展许多单独的实例，而无需管理繁重的基础架构。</p><p id="1dd9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们的应用程序将这两个应用程序无缝地融合在一起，让我们远离重复的任务，回到我们的生活中。为了开始使用 Steamship，我们安装了<a class="ae lw" href="https://docs.steamship.com/configuration/cli.html" rel="noopener ugc nofollow" target="_blank"> Steamship CLI </a>和<a class="ae lw" href="https://docs.steamship.com/configuration/clients.html" rel="noopener ugc nofollow" target="_blank"> Python 库</a>。</p><h1 id="dc0f" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">创建一个轮船包来转录一个概念块中的 MP3 文件</h1><p id="75d9" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">一旦我们安装了 Steamship CLI 和 Python 库，我们就可以开始创建一种自动化的方式来转录 Steamship 的音频文件。第一步是<a class="ae lw" href="https://docs.steamship.com/packages/developing/index.html" rel="noopener ugc nofollow" target="_blank">创建一个轮船包</a>。一旦我们创建了一个包，我们将会看到一个如下所示的文件夹结构。</p><p id="7c8a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们对默认包所做的主要改变在<code class="fe ni nj nk nl b">/src</code>文件夹中。我们的<code class="fe ni nj nk nl b">/src</code>文件夹包含四个重要文件:<em class="nm"> init.py </em>、<em class="nm"> api.py </em>、<em class="nm">signature . py、</em>和一个<em class="nm">transcripte . py</em>文件。虽然我们可以将所有函数存储在一个文件中，但最好的做法是创建模块化代码，并将所有函数拆分到适当命名的文件中。下图显示了我们的<code class="fe ni nj nk nl b">examples</code>、<code class="fe ni nj nk nl b">src</code>和<code class="fe ni nj nk nl b">tests</code>文件夹的样子。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/896e6db9118988cfe19375f3834ca1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jLV0UC7zCd8ZiI9O"/></div></div></figure><p id="1077" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们使用<code class="fe ni nj nk nl b">__init__.py</code>文件将一个目录标记为 Python 包。每个包含作为 Python 包的所需导入代码的目录都必须包含一个<code class="fe ni nj nk nl b">__init__.py</code>。一个<code class="fe ni nj nk nl b">__init__.py</code>文件可以是空的，在我们的例子中就是这样。对于我们的应用程序，这个文件必须是空的。我们没有任何特定的用例要求我们在该文件中包含代码。一个空的<code class="fe ni nj nk nl b">__init__.py</code>文件通常是默认的。</p><h1 id="a456" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">转录我们的音频文件</h1><p id="9ae1" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">音频减价包是轮船公司目前提供的四个捆绑包之一。他们提供了很棒的<a class="ae lw" href="https://docs.steamship.com/" rel="noopener ugc nofollow" target="_blank">文档</a>和最新的<a class="ae lw" href="https://github.com/steamship-packages/audio-markdown/" rel="noopener ugc nofollow" target="_blank"> Github </a>，在那里他们编写了我们可以直接放入应用程序的代码。和以前一样，我们总是从导入所需的模块开始。</p><p id="eeb3" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们通过定义名为<em class="nm">transcripte _ audio</em>的函数来完成 Python 脚本。这个函数有两个参数，音频文件的 URL 和一个 Steamship 对象。我们从使用 Steamship 来启动<code class="fe ni nj nk nl b">audio-markdown</code>包的一个实例开始。然后我们<code class="fe ni nj nk nl b">invoke</code>实例来转录我们的文件。</p><p id="75f1" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">被调用的代码将在 Steamship NLP 指定的云基础设施上执行，并返回我们的音频降价。如果请求不成功，我们将收到一条状态消息，告诉我们原因。该代码还将重试次数限制为 100 次，以防止程序挂起。在我们的 while 循环中有 break 子句也很重要，这样它们就不会无限地运行并可能使我们的机器崩溃。</p><pre class="kp kq kr ks gt ob nl oc bn od oe bi"><span id="24e1" class="of mm iq nl b be og oh l oi oj">import time<br/>from steamship import Steamship, TaskState<br/><br/>def transcribe_audio(audio_url: str, ship: Steamship):<br/>    instance = ship.use("audio-markdown", "audio-markdown-crows")<br/>    transcribe_task = instance.invoke("transcribe_url", url=audio_url)<br/>    task_id = transcribe_task["task_id"]<br/>    status = transcribe_task["status"]<br/>    # Wait for completion<br/>        retries = 0<br/>        while retries &lt;= 100 and status != TaskState.succeeded:<br/>            response = instance.invoke("get_markdown", task_id=task_id)<br/>            status = response["status"]<br/>            if status == TaskState.failed:<br/>                print(f"[FAILED] {response}['status_message']")<br/>                break<br/> <br/>            print(f"[Try {retries}] Transcription {status}.")<br/>            if status == TaskState.succeeded:<br/>                break<br/>            time.sleep(2)<br/>            retries += 1<br/> <br/>        # Get Markdown<br/>        markdown = response["markdown"]<br/>        return markdown</span></pre><h1 id="54bc" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">公开我们的 API 端点</h1><p id="0bbc" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">在我们的<em class="nm"> api.py </em> Python 文件中，代码将我们创建的子程序混合在一起。我们创建类来将上面创建的每个函数导入到它们各自的位置，最终返回我们的 markdown 文件。首先导入运行脚本所需的模块。我们还通过名字从其他 Python 脚本中导入函数。</p><pre class="kp kq kr ks gt ob nl oc bn od oe bi"><span id="516e" class="of mm iq nl b be og oh l oi oj">from typing import Type<br/>from steamship.invocable import Config, create_handler, post, PackageService<br/> <br/>from notion import notion_get, add_markdown<br/>from transcribe import transcribe_audio</span></pre><p id="6975" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们定义了一个名为<code class="fe ni nj nk nl b"><em class="nm">NotionAutoTranscribeConfig()</em></code>的类，它存储了我们之前收到的用于概念 API 集成的安全 API 密钥。这是连接到我们的概念集成应用程序所需的配置功能。</p><p id="adee" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来我们编写<code class="fe ni nj nk nl b">NotionAutoTranscribe()</code>类。类对象合并了我们之前编写的 Python 脚本。我们的类对象从我们的配置类对象中调用所需的 API 键来访问概念集成。然后它执行我们编写的<code class="fe ni nj nk nl b"><em class="nm">notion_get()</em></code>函数来获取 mp3 文件块的路径。</p><p id="05f0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在解析返回的信息以识别到 mp3 音频数据的路径指定的 url 之后，<code class="fe ni nj nk nl b"><em class="nm">transcribe_audio()</em></code>函数调用 Steamship 来转录给定的音频数据。转录后的文本“母牛抓不到乌鸦”，使用我们的<code class="fe ni nj nk nl b"><em class="nm">add_markdown()</em></code>函数打印到一个新的概念块对象。</p><pre class="kp kq kr ks gt ob nl oc bn od oe bi"><span id="45ee" class="of mm iq nl b be og oh l oi oj">class NotionAutoTranscribeConfig(Config):<br/>    """Config object containing required parameters to initialize a NotionAutoTranscribe instance."""<br/> <br/>    notion_key: str  # Required<br/> <br/> <br/>class NotionAutoTranscribe(PackageService):<br/>    """Example steamship Package."""<br/> <br/>    config: NotionAutoTranscribeConfig<br/> <br/>    def config_cls(self) -&gt; Type[Config]:<br/>        """Return the Configuration class."""<br/>        return NotionAutoTranscribeConfig<br/> <br/>    @post("transcribe")<br/>    def transcribe(self, url: str = None) -&gt; str:<br/>        """Transcribe the audio in the first Notion block of the page at `url` and append to the page.<br/> <br/>        This uses the API Key provided at configuration time to fetch the Notion Page, transcribe the<br/>        attached audio file, and then post the transcription results back to Notion as Markdown Text.<br/>        """<br/> <br/>        # Parse the Block ID from the Notion URL<br/>        block_id = url.split("#")[1]<br/> <br/>        # Get the Notion page<br/>        print(f"Getting notion block {block_id}")<br/>        notion_page = notion_get(f"blocks/{block_id}", self.config.notion_key)<br/> <br/>        # Get the Page ID and Audio URL from the Notion File JSON<br/>        audio_url = notion_page['audio']['file']['url']<br/>        page_id = notion_page['parent']['page_id']<br/> <br/>        print(f"Audio url: {audio_url}")<br/>        print(f"Page ID: {page_id}")<br/> <br/>        # Transcribe the file into Markdown<br/>        markdown = transcribe_audio(audio_url, self.client)<br/> <br/>        print(f"Markdown: {markdown}")<br/> <br/>        # Add it to Notion<br/>        res_json = add_markdown(page_id, markdown, self.config.notion_key)<br/> <br/>        print(f"Res JSON: {res_json}")<br/> <br/>        return res_json<br/> <br/>handler = create_handler(NotionAutoTranscribe)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/0ade78cd2915afefd225f5b4a3d51a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*26JGuFiAWt8_yJ5t"/></div></div></figure><h1 id="37a0" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">摘要</h1><p id="3b06" class="pw-post-body-paragraph la lb iq lc b ld nd ka lf lg ne kd li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">在这篇文章中，我们自动转录了一个 mp3 文件。我们编写了我们的定制应用程序来连接项目管理工具、概念和 NLP 包管理器 Steamship。我们的应用程序找到我们放在项目工作区中的 mp3 音频文件，部署为处理我们的音频文件而设计的 Steamship 包，然后将完整的音频减价直接返回到我们的概念工作区。</p><h1 id="f7d0" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">进一步阅读</h1><ul class=""><li id="dbf2" class="lx ly iq lc b ld nd lg ne lj ol ln om lr on lv mc md me mf bi translated"><a class="ae lw" href="https://pythonalgos.com/nested-lists-in-python/" rel="noopener ugc nofollow" target="_blank">Python 中的嵌套列表</a></li><li id="fd8f" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><a class="ae lw" href="https://pythonalgos.com/build-a-recurrent-neural-network-from-scratch-in-python-3/" rel="noopener ugc nofollow" target="_blank">用 Python 从零开始构建神经网络</a></li><li id="a18b" class="lx ly iq lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><a class="ae lw" href="https://pythonalgos.com/the-best-way-to-do-named-entity-recognition-ner/" rel="noopener ugc nofollow" target="_blank">Python 中的命名实体识别(NER)</a></li></ul><p id="92e8" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你喜欢这篇文章，请在 Twitter 上分享！为了无限制地访问媒体文章，今天就注册成为<a class="ae lw" href="https://www.medium.com/@ytang07/membership" rel="noopener">媒体会员</a>！别忘了关注我，<a class="ae lw" href="https://www.medium.com/@ytang07" rel="noopener">唐</a>，获取更多关于增长、技术等方面的文章！</p></div></div>    
</body>
</html>