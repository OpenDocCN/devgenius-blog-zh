<html>
<head>
<title>Different Behaviors of Javascript Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript 函数的不同行为</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/different-behaviors-of-javascript-functions-7e2e07d52351?source=collection_archive---------2-----------------------#2020-11-30">https://blog.devgenius.io/different-behaviors-of-javascript-functions-7e2e07d52351?source=collection_archive---------2-----------------------#2020-11-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="212c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">看看箭头和关键字对“这个”做了什么</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2407bd5130bb6bd820571d72ff123d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s4NlaKFgdtpE23fR2t69og.jpeg"/></div></div></figure><p id="032e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在熨斗学校学习软件工程项目期间，我一直认为用<code class="fe ku kv kw kx b">function</code>关键字声明的函数和箭头函数的行为是一样的，箭头函数只是一种更高级的编写方式。直到我犯了一个懒错误(这是最好的学习方法)才意识到这两种声明函数的方式对<code class="fe ku kv kw kx b">this</code>关键字的影响是不同的。</p><p id="2af8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看看下面的两个函数，以及调用它们时会发生什么:</p><pre class="kj kk kl km gt ky kx kz la aw lb bi"><span id="eb30" class="lc ld in kx b gy le lf l lg lh">function sayMyName () {<br/>  name = "Travis"<br/>  return this.name<br/>}</span><span id="dc5e" class="lc ld in kx b gy li lf l lg lh">sayMyName() // =&gt; "Travis"</span><span id="102c" class="lc ld in kx b gy li lf l lg lh"><br/>sayMyName = () =&gt; {<br/>  name = "Travis"<br/>  return this.name<br/>}</span><span id="b81b" class="lc ld in kx b gy li lf l lg lh">sayMyName() // =&gt; "Travis"</span></pre><p id="3013" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如您所见，这两个函数在被调用时都返回<code class="fe ku kv kw kx b">“Travis”</code>。在这两种情况下，<code class="fe ku kv kw kx b">this</code>都在这两个函数的范围之内，而<code class="fe ku kv kw kx b">this.name</code>指的是那个函数的 name 属性。</p><p id="ca26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我们试图在一个对象上调用这些函数时，行为发生了变化。让我们只考虑<code class="fe ku kv kw kx b">function</code>关键字版本，看看当我们在一个具有名称键/值对和函数引用的对象上调用它时会发生什么:</p><pre class="kj kk kl km gt ky kx kz la aw lb bi"><span id="2b3a" class="lc ld in kx b gy le lf l lg lh">function sayMyName () {<br/>  name = "Travis"<br/>  return this.name<br/>}</span><span id="2377" class="lc ld in kx b gy li lf l lg lh">let catt = {<br/>  name: "Catt",<br/>  sayMyName: sayMyName<br/>}</span><span id="4ff8" class="lc ld in kx b gy li lf l lg lh">let scott = {<br/>  name: "Scott",<br/>  sayMyName: sayMyName<br/>}</span><span id="72d7" class="lc ld in kx b gy li lf l lg lh">sayMyName() // =&gt; "Travis"<br/>catt.sayMyName() // =&gt; "Catt"<br/>scott.sayMyName() // =&gt; "Scott"</span></pre><p id="9a76" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如你在上面看到的，调用使用<code class="fe ku kv kw kx b">function</code>关键字的函数会改变<code class="fe ku kv kw kx b">this</code>所指的内容。在这种情况下，<code class="fe ku kv kw kx b">this</code>指的是调用函数的对象，或者是<code class="fe ku kv kw kx b">catt</code>对象，或者是<code class="fe ku kv kw kx b">scott</code>对象。</p><p id="d106" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们来看看箭头函数版本:</p><pre class="kj kk kl km gt ky kx kz la aw lb bi"><span id="9712" class="lc ld in kx b gy le lf l lg lh">sayMyName = () =&gt; {<br/>  name = "Travis"<br/>  return this.name<br/>}</span><span id="701c" class="lc ld in kx b gy li lf l lg lh">let catt = {<br/>  name: "Catt",<br/>  sayMyName: sayMyName<br/>}</span><span id="c3fc" class="lc ld in kx b gy li lf l lg lh">let scott = {<br/>  name: "Scott",<br/>  sayMyName: sayMyName<br/>}</span><span id="b3e9" class="lc ld in kx b gy li lf l lg lh">sayMyName() // =&gt; "Travis"<br/>catt.sayMyName() // =&gt; "Travis"<br/>scott.sayMyName() // =&gt; "Travis"</span></pre><p id="0f64" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这种情况下，它每次都返回<code class="fe ku kv kw kx b">“Travis”</code>,因为当<code class="fe ku kv kw kx b">this</code>在一个箭头函数中使用时，它被绑定到该函数的作用域中，因此无论在什么对象上调用该函数，都将<code class="fe ku kv kw kx b">this.name</code>绑定到<code class="fe ku kv kw kx b">“Travis”</code>的值。</p><p id="aed8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这种对范围动作的绑定正是我们在 React.js 中总是希望在基于类的组件中使用箭头函数的原因。</p><pre class="kj kk kl km gt ky kx kz la aw lb bi"><span id="6543" class="lc ld in kx b gy le lf l lg lh"><em class="lj">class</em> Button extends React.Component {<br/>  state = { greeting: "Hello World!" }</span><span id="b06f" class="lc ld in kx b gy li lf l lg lh">  clickHandler ()  {<br/>    this.setState({greeting: "Goodnight World!"})<br/>  }</span><span id="c44c" class="lc ld in kx b gy li lf l lg lh">  render() {<br/>    return (<br/>      &lt;&gt;<br/>        &lt;h1&gt;{this.state.greeting}&lt;/h1&gt;<br/>        &lt;button onClick={this.clickHandler}&gt;Click Me&lt;/button&gt;<br/>      &lt;/&gt;<br/>    )<br/>  }<br/>}</span><span id="9a12" class="lc ld in kx b gy li lf l lg lh">export default Button</span></pre><p id="07c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里的预期操作是将屏幕上的文本从“Hello World！”当按钮被按下时，“晚安世界”。然而，当按下按钮时，我们得到一个错误<code class="fe ku kv kw kx b">Cannot read property ‘setState’ of undefined</code>。因为我们使用了 function 关键字，所以<code class="fe ku kv kw kx b">this</code>的值被绑定到我们调用它的对象上，在这个例子中这个对象是空的，这使得它是未定义的。</p><p id="5de8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要实现这一点，只需将<code class="fe ku kv kw kx b">clickHandler</code>函数的格式改为箭头即可！</p><pre class="kj kk kl km gt ky kx kz la aw lb bi"><span id="3bd9" class="lc ld in kx b gy le lf l lg lh"><em class="lj">class</em> Button extends React.Component {<br/>  state = { greeting: "Hello World!" }</span><span id="f59c" class="lc ld in kx b gy li lf l lg lh">clickHandler = () =&gt; {<br/>    this.setState({greeting: "Goodnight World!"})<br/>  }</span><span id="9f09" class="lc ld in kx b gy li lf l lg lh">render() {<br/>    return (<br/>      &lt;&gt;<br/>        &lt;h1&gt;{this.state.greeting}&lt;/h1&gt;<br/>        &lt;button onClick={this.clickHandler}&gt;Click Me&lt;/button&gt;<br/>      &lt;/&gt;<br/>    )<br/>  }<br/>}</span><span id="a72a" class="lc ld in kx b gy li lf l lg lh">export default Button</span></pre><p id="692c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，<code class="fe ku kv kw kx b">this</code>关键字被绑定到它所在的函数的范围内，从而可以访问内置于“反应”中的<code class="fe ku kv kw kx b">setState</code>函数。</p></div></div>    
</body>
</html>