<html>
<head>
<title>PHP — P96: MySQL Primary and Foreign Keys</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P96: MySQL 主键和外键</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p96-mysql-primary-and-foreign-keys-c087310cfb62?source=collection_archive---------6-----------------------#2022-11-17">https://blog.devgenius.io/php-p96-mysql-primary-and-foreign-keys-c087310cfb62?source=collection_archive---------6-----------------------#2022-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/427850245e670c191bd5c3daaadf0884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-4KZsVTKh8GbA3zOzlMZw.jpeg"/></div></div></figure><p id="704c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们谈到了规范化，但从未完全涵盖主键和外键。这并不是 MySQL 独有的，但却是你经常听到的:主键和外键。在以前的 MySQL 文章中，我们已经看到了一个这样的例子，但是我想进一步阐述一下。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/php-p93-mysql-normalization-7e9a9809311e"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">PHP — P93: MySQL 规范化</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">我们将触及最后一个话题，今天就讲到 MySQL。最后一个话题是正常化。对…意味着什么</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="8c99" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">SQL 中的主键是什么？</h1><p id="ba99" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">它只是表中的一列或列的组合，对于表中的每个条目都是唯一的。一个简单的例子是一个人的社会保险号。对于政府，你的主键是你的 SSN。只有你是独一无二的。如果我们向表中添加个人，SSN 可以用作主键。</p><p id="fc6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不需要像那样具体的东西。它可以是任意数字。最常见的情况是，为每条记录分配一个 ID 列。每次添加新条目时，ID 列都会增加。这意味着每条记录的 ID 列都有一个唯一的值，使其成为主键的主要候选项。因此，主键对于每条记录必须是唯一的，不能是<code class="fe mr ms mt mu b">null</code>。</p><h1 id="26c3" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是外键？</h1><p id="9348" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">这是关系数据库中关系开始兴盛的地方。外键用于定义表之间的关系。在继续之前，让我们看一个例子。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/03d9a0a573eb1632d4b4a6155b1e31cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RLpt4PN6tqNiWfUn.png"/></div></figure><p id="b570" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在数据库中创建了三个表:</p><ul class=""><li id="8f2f" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated"><code class="fe mr ms mt mu b">users</code></li><li id="f49b" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><code class="fe mr ms mt mu b">customers</code></li><li id="23d5" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><code class="fe mr ms mt mu b">customer_types</code></li></ul><p id="c681" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的<code class="fe mr ms mt mu b">users</code>表包含一个主键<code class="fe mr ms mt mu b">id</code>。我们的<code class="fe mr ms mt mu b">customer_types</code>桌也是如此。<code class="fe mr ms mt mu b">customers</code>表还包含一个主键<code class="fe mr ms mt mu b">id</code>。但是它还包含两个附加字段。第一个字段<code class="fe mr ms mt mu b">user_id</code>是外键。外键表示在另一个表中有一个主键与该外键的值相匹配。通过查看<code class="fe mr ms mt mu b">user_id</code>列，我们可以快速判断出这个外键指向<code class="fe mr ms mt mu b">users</code>表中的<code class="fe mr ms mt mu b">id</code>主键。这就是允许将一个表链接到另一个表的原因。我们现在可以将我们的<code class="fe mr ms mt mu b">customers</code>表链接到<code class="fe mr ms mt mu b">users</code>表。</p><p id="8956" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还可以将我们的<code class="fe mr ms mt mu b">customers</code>表链接到我们的<code class="fe mr ms mt mu b">customer_types</code>表。<code class="fe mr ms mt mu b">customer_type_id</code>外键将指向<code class="fe mr ms mt mu b">customer_types</code>表中的<code class="fe mr ms mt mu b">id</code>主键。</p><p id="6793" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能会看到外键不必是唯一的。例如，我们的<code class="fe mr ms mt mu b">customers</code>表可能将一个用户链接到多个客户类型。例如，一个用户可能是分销商客户，也可能是直接向消费者发货的客户。</p><p id="a020" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，用户不应多次属于分销商客户类型。我们可以通过将<code class="fe mr ms mt mu b">user_id</code>和<code class="fe mr ms mt mu b">customer_type_id</code>的组合作为主键来限制这一点。既然我们有了主键组合，我们可以从<code class="fe mr ms mt mu b">customers</code>表中删除<code class="fe mr ms mt mu b">id</code>列，因为我们将有我们的主键。</p><p id="1c46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住，外键将数据从一个表链接到另一个表。</p><h1 id="d3e9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">使多个列充当主键</h1><p id="3cea" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们需要修改我们的表，使多个字段作为主字段。我们可以用下面的命令来实现:</p><pre class="mw mx my mz gt no mu np bn nq nr bi"><span id="a5b3" class="ns lp iq mu b be nt nu l nv nw">ALTER TABLE `customers` ADD PRIMARY KEY(`user_id`, `customer_type_id`);</span></pre><p id="f5c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，我们可以通过 phpMyAdmin 来实现。</p><ul class=""><li id="5e07" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated">打开 phpMyAdmin</li><li id="df07" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">去你的桌子。在这种情况下，它是<code class="fe mr ms mt mu b">customers</code></li><li id="9f77" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">单击“结构”选项卡</li><li id="9fa9" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择两列，然后单击主要按钮</li></ul><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/dc729de7a63fa04080a9b689f2e260e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hM6B-Ks30OLdgS_UgSKE0A.png"/></div></div></figure><p id="6738" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到主 keyname 被添加到底部的 indexes 下。</p><h1 id="6cb9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">外键约束</h1><p id="84b5" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">除了引用表之外，还可以添加外键约束。我们将在下面解决这两个问题。我们希望限制删除和更新。这意味着，如果我们删除或更新父表中的值，这将阻止它，因为有一个约束。</p><p id="46fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以将约束条件更改为:</p><ul class=""><li id="9173" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated">无操作:如果我们对父对象进行了更改，操作会失败</li><li id="b978" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">级联:如果父表中的某行被删除或修改，那么子表中与该表相关联的所有行也会被删除</li><li id="249c" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">Set Null:如果在父表中删除或修改，则在子表中将所有值设置为<code class="fe mr ms mt mu b">null</code></li><li id="8c8b" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">Restrict:不允许删除或修改父记录，除非先删除所有相关记录。</li></ul><p id="16cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以通过 SQL 添加关系。</p><pre class="mw mx my mz gt no mu np bn nq nr bi"><span id="9e6f" class="ns lp iq mu b be nt nu l nv nw">ALTER TABLE `customers` <br/>    ADD CONSTRAINT `user_FK` <br/>    FOREIGN KEY (`user_id`) <br/>    REFERENCES `users`(`id`) <br/>    ON DELETE RESTRICT <br/>    ON UPDATE RESTRICT;</span></pre><p id="5d03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者我们可以通过 phpMyAdmin 来实现。</p><ul class=""><li id="6435" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated">打开 phpMyAdmin</li><li id="cad2" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择要添加外键约束的表。</li><li id="ec69" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择“结构”选项卡</li><li id="8b74" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">单击关系视图</li><li id="4780" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">添加一个约束名称，如<code class="fe mr ms mt mu b">user_FK</code></li><li id="0e15" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择列:<code class="fe mr ms mt mu b">user_id</code></li><li id="419e" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择数据库:<code class="fe mr ms mt mu b">dino_test_db</code></li><li id="5e99" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择<code class="fe mr ms mt mu b">user_id</code>指向的表格:<code class="fe mr ms mt mu b">users</code></li><li id="2b2b" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">选择<code class="fe mr ms mt mu b">users</code>表中指向的列:<code class="fe mr ms mt mu b">id</code></li><li id="a59b" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated">单击保存</li></ul><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/48a86c011477bdded0bcf427b0b6cb79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsscRZgRZyGPWitZJPCM_g.png"/></div></div></figure><p id="f35a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以为<code class="fe mr ms mt mu b">customer_type_id</code>重复这个过程。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/4140e39b533b3d1758e7e1e25c1fa6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vhzVSEHN0eGOgz0Y4RpZZw.png"/></div></div></figure><p id="123f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的关键是外键指向主键。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b5d9b7eb095dea11540a49a6c27e6b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xgAYxOaserob73Xf.jpeg"/></div></figure><p id="f9ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dino Cajic 目前是<a class="ae oh" href="http://absolutebiotech.com/" rel="noopener ugc nofollow" target="_blank"> Absolute Biotech </a>的 IT 主管，该公司是<a class="ae oh" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae oh" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank"> Absolute 抗体</a>、<a class="ae oh" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae oh" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank"> Everest BioTech </a>、<a class="ae oh" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank"> Nordic MUbio </a>和<a class="ae oh" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的母公司。他还担任我的自动系统的首席执行官。他拥有计算机科学学士学位，辅修生物学，并拥有十多年的软件工程经验。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="6b90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae oh" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae oh" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae oh" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="e858" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。 </p></div></div>    
</body>
</html>