<html>
<head>
<title>SOC implementation with TheHive, Cortex &amp; Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助HEV、Cortex和Elasticsearch实现SOC</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/soc-implementation-with-thehive-cortex-elasticsearch-672e89219f0c?source=collection_archive---------1-----------------------#2022-01-17">https://blog.devgenius.io/soc-implementation-with-thehive-cortex-elasticsearch-672e89219f0c?source=collection_archive---------1-----------------------#2022-01-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/257a44931ac7d1149bd4f4886ee4db6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nK-H83Yw0EdqoyZy.png"/></div></div></figure><h1 id="b001" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">目录页</h1><p id="26fc" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><a class="ae lr" href="#e0c8" rel="noopener ugc nofollow">什么是足球？</a><br/>∘<a class="ae lr" href="#0c47" rel="noopener ugc nofollow">the hive</a><br/>∘<a class="ae lr" href="#5b50" rel="noopener ugc nofollow">cortex</a><br/><a class="ae lr" href="#08ca" rel="noopener ugc nofollow">the hive安装</a> <br/> ∘ <a class="ae lr" href="#dc5a" rel="noopener ugc nofollow">安装java虚拟机</a> <br/> ∘ <a class="ae lr" href="#7870" rel="noopener ugc nofollow">安装Cassandra数据库</a> <br/> ∘ <a class="ae lr" href="#b18b" rel="noopener ugc nofollow"> Cassandra配置</a> <br/> ∘ <a class="ae lr" href="#eb3e" rel="noopener ugc nofollow"> Thehive安装步骤</a> <br/> ∘ <a class="ae lr" href="#1fbe" rel="noopener ugc nofollow">索引引擎</a> <br/> ∘ <a class="ae lr" href="#aef3" rel="noopener ugc nofollow">文件存储 以及对elastic search</a><br/><a class="ae lr" href="#88ca" rel="noopener ugc nofollow">Cortex安装</a> <br/> ∘ <a class="ae lr" href="#dcec" rel="noopener ugc nofollow">安装分析器</a> <br/> ∘ <a class="ae lr" href="#6fba" rel="noopener ugc nofollow">启用滥用IP </a> <br/> <a class="ae lr" href="#95c7" rel="noopener ugc nofollow">将hive与cortex连接</a> <br/> <a class="ae lr" href="#a62c" rel="noopener ugc nofollow">运行演示</a></p><h1 id="e0c8" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">什么是足球？</h1><p id="4d8d" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">安全运营中心(SOC)是一个包含信息安全团队的结构，该团队负责持续监控和评估组织的安全状况。SOC团队的目的是使用技术解决方案和一套强大程序的组合来识别、评估和响应网络安全问题。安全分析师、工程师和管理安全运营的经理通常在安全运营中心工作。SOC的工作人员与组织的事故响应团队密切合作，以确保安全漏洞一经发现即得到处理。</p><p id="7e1b" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">网络、服务器、端点、数据库、应用程序、网站和其他系统由安全运营中心监控和分析，安全运营中心检查可能表明安全事件或违规的异常行为。SOC负责正确识别、分析、防御、调查和报告可能的安全事件。</p><p id="6219" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">在这篇博客中，我计划使用3个基本的开源工具来实现一个简单的SOC环境，这3个工具分别叫做Thehive、Cortex和Elasticsearch。在我们动手之前，让我们先了解一下这些工具</p><h2 id="0c47" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">TheHive</h2><p id="dbcc" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">hive是一个可扩展的、开源的、免费的安全事件响应平台，与MISP(恶意软件信息共享平台)紧密集成，旨在让SOC、CSIRTs、CERTs以及任何处理需要快速调查和响应的安全事件的信息安全从业者的生活更加轻松。</p><h2 id="5b50" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">皮质</h2><p id="13d0" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">如果您使用Cortex，就不必在每次想要利用服务或工具来评估可观察的事物并帮助调查案件或遏制风险时都重新发明轮子。使用它丰富的分析器选项，或者用任何支持Linux的编程语言编写自己的分析器或响应器，并与您的团队或者更好的是整个社区共享。您也可以同时查询几个MISP实例。</p><p id="9a31" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在让我们安装所有必要的工具来实现示例SOC</p><h1 id="08ca" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">蜂巢装置</h1><h2 id="dc5a" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">正在安装java虚拟机</h2><p id="7bdd" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在本次演示中，我将使用CentOS 8安装Hive。作为安装的第一步，我们需要使用以下命令导入GPG密钥</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f482" class="lx jw in mo b gy ms mt l mu mv">sudo rpm --import https://raw.githubusercontent.com/TheHive-Project/TheHive/master/PGP-PUBLIC-KEY</span></pre><p id="0105" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在我们需要为配置单元安装一些依赖项。以有序的方式运行以下命令</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="23f1" class="lx jw in mo b gy ms mt l mu mv">yum install -y java-1.8.0-openjdk-headless.x86_64 echo JAVA_HOME="/usr/lib/jvm/jre-1.8.0" &gt;&gt; /etc/environment export JAVA_HOME="/usr/lib/jvm/jre-1.8.0"</span></pre><p id="88ff" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">有时可能会应用这个命令，有时不会使用这个命令来使java 1.8 open jdk默认</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="fbe8" class="lx jw in mo b gy ms mt l mu mv">update-java-alternatives --list</span></pre><p id="6534" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后选择版本1.8并运行</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d68f" class="lx jw in mo b gy ms mt l mu mv">sudo update-java-alternatives --set /path/to/java/version 1.8</span></pre><h2 id="7870" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">安装Cassandra数据库</h2><p id="b92a" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">Apache Cassandra是一个可伸缩的高可用性数据库。该版本支持Cassandra的最新稳定版本<strong class="kv io"> 3.11.x </strong>。</p><p id="86f0" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后让我们将Cassandra添加到repo来安装</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="87d7" class="lx jw in mo b gy ms mt l mu mv">vim /etc/yum.repos.d/cassandra.repo</span></pre><p id="e848" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后粘贴以下内容</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="42ea" class="lx jw in mo b gy ms mt l mu mv">[cassandra] <br/>name=Apache Cassandra baseurl=https://downloads.apache.org/cassandra/redhat/311x/ gpgcheck=1 <br/>repo_gpgcheck=1 <br/>gpgkey=https://downloads.apache.org/cassandra/KEYS</span></pre><p id="e67c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">那就跑</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ecd0" class="lx jw in mo b gy ms mt l mu mv">yum install -y cassandra</span></pre><h2 id="b18b" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">卡珊德拉构型</h2><p id="31b7" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">为此，如果你的电脑没有运行python 2，我们需要安装python 2</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5f9e" class="lx jw in mo b gy ms mt l mu mv">yum install python2</span></pre><p id="2618" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后我们需要启动卡森德拉服务</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f21a" class="lx jw in mo b gy ms mt l mu mv">service cassendra start </span></pre><p id="edeb" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后启动下面的命令，通过</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="18aa" class="lx jw in mo b gy ms mt l mu mv">cqlsh localhost 9042</span></pre><p id="3441" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated"><strong class="kv io">如果在执行该命令时</strong>出现错误，运行以下命令</p><p id="bcf6" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">首先找到cqlshlib所在的路径</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="b285" class="lx jw in mo b gy ms mt l mu mv">find /usr/lib/ -name cqlshlib</span></pre><p id="f445" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">使用下面的变量名导出路径</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="6316" class="lx jw in mo b gy ms mt l mu mv">export PYTHONPATH=/usr/lib/python2.7/site-packages/</span></pre><p id="1161" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">在这两步之后，再次运行前一个命令，它应该可以工作了</p><p id="39ab" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后获取cassendra数据库并运行以下查询</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="2279" class="lx jw in mo b gy ms mt l mu mv">cqlsh&gt; UPDATE system.local SET cluster_name = 'thp' where key='local';</span><span id="920d" class="lx jw in mo b gy mw mt l mu mv">cqlsh&gt; exit</span></pre><p id="a32d" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">退出并运行</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="b2f9" class="lx jw in mo b gy ms mt l mu mv">nodetool flush</span></pre><p id="3a44" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后转到位于/etc/cassandra/cassandra.yaml这个位置的Cassandra配置文件</p><p id="5cee" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">将以下详细信息添加到该文件中</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7a8b" class="lx jw in mo b gy ms mt l mu mv"># content from /etc/cassandra/cassandra.yaml</span><span id="b782" class="lx jw in mo b gy mw mt l mu mv">cluster_name: 'thp'<br/>listen_address: 'xx.xx.xx.xx' # address for nodes<br/>rpc_address: 'xx.xx.xx.xx' # address for clients<br/>seed_provider:<br/>        - class_name:org.apache.cassandra.locator.SimpleSeedProvider<br/>          parameters:<br/>              # Ex: "&lt;ip1&gt;,&lt;ip2&gt;,&lt;ip3&gt;"<br/>              - seeds: 'xx.xx.xx.xx' # self for the first node</span><span id="0bbd" class="lx jw in mo b gy mw mt l mu mv">data_file_directories:</span><span id="4bf4" class="lx jw in mo b gy mw mt l mu mv">- '/var/lib/cassandra/data'<br/>commitlog_directory: '/var/lib/cassandra/commitlog'<br/>saved_caches_directory: '/var/lib/cassandra/saved_caches'</span><span id="3944" class="lx jw in mo b gy mw mt l mu mv">hints_directory:<br/>   <!-- -->  - '/var/lib/cassandra/hints'</span></pre><p id="85c8" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后通过运行以下命令重新启动该服务</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4209" class="lx jw in mo b gy ms mt l mu mv">systemctl daemon-reload <br/>service cassandra start <br/>chkconfig cassandra on</span></pre><p id="c59b" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在让我们安装直升机</p><h2 id="eb3e" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">六个安装步骤</h2><p id="561e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">然后我们需要创建RPM存储库来安装驱动程序。在这里，我打算使用稳定版本的HEV。下面你可以找到这个阶段的必要命令</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="926f" class="lx jw in mo b gy ms mt l mu mv">vim /etc/yum.repos.d/thehive-project.repo</span></pre><p id="bd50" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">将以下详细信息粘贴到创建的文件中</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d529" class="lx jw in mo b gy ms mt l mu mv">[thehive-project]<br/>enabled=1 <br/>priority=1 <br/>name=TheHive-Project RPM repository <br/>baseurl=https://rpm.thehive-project.org/stable/noarch <br/>gpgcheck=1</span></pre><p id="f1d0" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">要安装run</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="114d" class="lx jw in mo b gy ms mt l mu mv">sudo <!-- -->yum install thehive</span></pre><p id="5b6a" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">安装好硬盘后，我们需要创建一些目录来存储所有的数据索引。</p><h2 id="1fbe" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">索引引擎</h2><p id="5dd9" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">创建一个专用于存放文件索引的文件夹</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="dfce" class="lx jw in mo b gy ms mt l mu mv">mkdir /opt/thp/thehive/index</span><span id="72a2" class="lx jw in mo b gy mw mt l mu mv">chown thehive:thehive -R /opt/thp/thehive/index</span></pre><h2 id="aef3" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">文件存储器</h2><p id="1ed2" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">要在本地文件系统上存储文件，首先选择专用文件夹:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="6b97" class="lx jw in mo b gy ms mt l mu mv">mkdir -p /opt/thp/thehive/files</span></pre><p id="87d1" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">该路径将用于车辆的配置。向该路径授予以下权限</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ce06" class="lx jw in mo b gy ms mt l mu mv">chown -R thehive:thehive /opt/thp/thehive/files</span></pre><p id="fa4a" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">要使用Cassandra数据库，必须使用以下行编辑和更新有效配置文件(<code class="fe mx my mz mo b">/etc/thehive/application.conf</code>):</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="62ec" class="lx jw in mo b gy ms mt l mu mv">db {<br/>  provider: janusgraph<br/>  janusgraph {<br/>    storage {<br/>      backend: cql<br/>      hostname: ["127.0.0.1"] # seed node ip addresses<br/>      cql {<br/>        cluster-name: thp       # cluster name<br/>        keyspace: thehive           # name of the keyspace<br/>        local-datacenter: datacenter1   # name of the datacenter where TheHive runs (relevant only on multi datacenter setup)<br/>        # replication-factor: 2 # number of replica<br/>        read-consistency-level: ONE<br/>        write-consistency-level: ONE      }<br/>    }<br/>  }<br/>}</span><span id="919d" class="lx jw in mo b gy mw mt l mu mv">update data storage part </span><span id="c51c" class="lx jw in mo b gy mw mt l mu mv">db {<br/>  provider: janusgraph<br/>  janusgraph {<br/>    storage {<br/>      [..]<br/>    }<br/>    ## Index configuration<br/>    index.search {<br/>      backend : lucene<br/>      directory:  /opt/thp/thehive/index<br/>    }<br/>  }<br/>}</span></pre><h2 id="007d" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">文件系统</h2><p id="b41d" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">如果您选择在本地文件系统上存储文件:</p><p id="0483" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">确保文件夹的权限</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="56e4" class="lx jw in mo b gy ms mt l mu mv">chown -R thehive:thehive /opt/thp/thehive/files</span></pre><p id="83ca" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">将以下几行添加到Hive配置文件(<code class="fe mx my mz mo b">/etc/thehive/application.conf</code>)</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f35d" class="lx jw in mo b gy ms mt l mu mv">## Storage configuration <br/>storage { <br/>provider = localfs <br/>localfs.location = /opt/thp/thehive/files <br/>}</span></pre><p id="dd3a" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">保存对配置文件所做的所有更改并运行</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="6035" class="lx jw in mo b gy ms mt l mu mv">service thehive start</span></pre><p id="0490" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后打开浏览器，通过以下链接登录系统</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="24f5" class="lx jw in mo b gy ms mt l mu mv">http://YOUR_SERVER_ADDRESS:9000/</span></pre><p id="0e21" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">当你得到那个网址时，你可能会得到一个如下所示的网页</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/a9857e964a3568835eae40381ae6a3f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_zKQOI2Q1RRpftzGWS7vQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">活跃的登录页面</figcaption></figure><p id="d4a2" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated"><strong class="kv io"> <em class="nf">登录:admin@thehive.local </em> </strong></p><p id="bf54" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated"><strong class="kv io"> <em class="nf">密码:秘密</em> </strong></p><h1 id="15cb" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">弹性搜索装置</h1><p id="ddb4" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在所有这些实施后，我计划整合wazuh经理。因此，我将安装wazuh推荐的elasticsearch opendisro版本，它与普通的elasticsearch没有太大区别。</p><p id="b735" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">安装安装所需的软件包:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9f4c" class="lx jw in mo b gy ms mt l mu mv">yum install curl unzip wget</span></pre><p id="3210" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">导入GPG密钥:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="76f6" class="lx jw in mo b gy ms mt l mu mv">rpm --import <a class="ae lr" href="https://packages.wazuh.com/key/GPG-KEY-WAZUH" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/key/GPG-KEY-WAZUH</a></span></pre><p id="f06f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">添加存储库:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f3bd" class="lx jw in mo b gy ms mt l mu mv">cat &gt; /etc/yum.repos.d/wazuh.repo &lt;&lt; EOF<br/>[wazuh]<br/>gpgcheck=1<br/>gpgkey=<a class="ae lr" href="https://packages.wazuh.com/key/GPG-KEY-WAZUH" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/key/GPG-KEY-WAZUH</a><br/>enabled=1<br/>name=EL-\$releasever - Wazuh<br/>baseurl=<a class="ae lr" href="https://packages.wazuh.com/4.x/yum/" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/4.x/yum/</a><br/>protect=1<br/>EOF</span></pre><p id="dcee" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">安装Elasticsearch的开放发行版:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="963c" class="lx jw in mo b gy ms mt l mu mv">yum install opendistroforelasticsearch</span></pre><p id="9c5c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后转到/etc/elastic search/elastic search . yml文件，编辑下面的详细信息</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f73f" class="lx jw in mo b gy ms mt l mu mv"># ------------------------------ Network --------------------------</span><span id="ba1b" class="lx jw in mo b gy mw mt l mu mv">network.host: 192.168.0.1</span><span id="4173" class="lx jw in mo b gy mw mt l mu mv">http.port: 9200</span></pre><p id="4fc2" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">在“网络”下，删除“收件人”中的哈希标记，并重新启动服务</p><p id="c74f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated"><strong class="kv io"> <em class="nf">这部分不是必须的，除非你想在通信之间有SSL连接。如果出于测试目的，则不需要它；如果出于某种生产目的，则需要启用安全性。</em> </strong></p><p id="8512" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">安装Elasticsearch后，下载预配置的配置文件:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="54a9" class="lx jw in mo b gy ms mt l mu mv">curl -so /etc/elasticsearch/elasticsearch.yml <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/7.x/elasticsearch.yml" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/7.x/elasticsearch.yml</a></span></pre><h2 id="6f63" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">弹性搜索角色和用户</h2><p id="c0ae" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">您需要添加用户和角色才能正确使用Wazuh Kibana插件。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9cdb" class="lx jw in mo b gy ms mt l mu mv">curl -so /usr/share/elasticsearch/plugins/opendistro_security/securityconfig/roles.yml <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/roles.yml" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/roles.yml</a><br/>curl -so /usr/share/elasticsearch/plugins/opendistro_security/securityconfig/roles_mapping.yml <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/roles_mapping.yml" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/roles_mapping.yml</a><br/>curl -so /usr/share/elasticsearch/plugins/opendistro_security/securityconfig/internal_users.yml <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/internal_users.yml" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/elasticsearch/roles/internal_users.yml</a></span></pre><h2 id="f009" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">为Elasticsearch创建和部署证书</h2><p id="2976" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">删除演示证书:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7582" class="lx jw in mo b gy ms mt l mu mv">rm /etc/elasticsearch/esnode-key.pem /etc/elasticsearch/esnode.pem /etc/elasticsearch/kirk-key.pem /etc/elasticsearch/kirk.pem /etc/elasticsearch/root-ca.pem -f</span></pre><p id="03cb" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">生成并部署证书:</p><p id="1af9" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">a.下载<code class="fe mx my mz mo b">wazuh-cert-tool.sh</code>创建证书:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d1a4" class="lx jw in mo b gy ms mt l mu mv">curl -so ~/wazuh-cert-tool.sh <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/tools/certificate-utility/wazuh-cert-tool.sh" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/tools/certificate-utility/wazuh-cert-tool.sh</a><br/>curl -so ~/instances.yml <a class="ae lr" href="https://packages.wazuh.com/resources/4.2/open-distro/tools/certificate-utility/instances.yml" rel="noopener ugc nofollow" target="_blank">https://packages.wazuh.com/resources/4.2/open-distro/tools/certificate-utility/instances.yml</a></span></pre><p id="2a05" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">b.编辑<code class="fe mx my mz mo b">~/instances.yml</code>并用相应的名称和IP地址替换值<code class="fe mx my mz mo b">&lt;node-name&gt;</code>和<code class="fe mx my mz mo b">node-IP</code>。根据需要添加任意数量的节点字段:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="90b9" class="lx jw in mo b gy ms mt l mu mv"># Elasticsearch nodes<br/>elasticsearch-nodes:<br/>  - name: &lt;node-name&gt;<br/>    ip:<br/>      - node-IP</span><span id="0e5d" class="lx jw in mo b gy mw mt l mu mv"># Wazuh server nodes<br/>wazuh-servers:<br/>  - name: &lt;node-name&gt;<br/>    ip:<br/>      - node-IP</span><span id="5f00" class="lx jw in mo b gy mw mt l mu mv"># Kibana node<br/>kibana:<br/>  - name: &lt;node-name&gt;<br/>    ip:<br/>      - node-IP</span></pre><p id="4674" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">c.运行<code class="fe mx my mz mo b">wazuh-cert-tool.sh</code>创建证书:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="b93d" class="lx jw in mo b gy ms mt l mu mv">bash ~/wazuh-cert-tool.sh</span></pre><p id="0c9b" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">d.将<code class="fe mx my mz mo b">elasticsearch-node-name</code>替换为您的Elasticsearch节点名称，与在<code class="fe mx my mz mo b">instances.yml</code>中创建证书时使用的名称相同，并将证书移动到相应的位置</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="14b3" class="lx jw in mo b gy ms mt l mu mv">node_name=elasticsearch-node-name</span><span id="e5bf" class="lx jw in mo b gy mw mt l mu mv">mkdir /etc/elasticsearch/certs/<br/>mv ~/certs/$node_name* /etc/elasticsearch/certs/<br/>mv ~/certs/admin* /etc/elasticsearch/certs/<br/>cp ~/certs/root-ca* /etc/elasticsearch/certs/<br/>mv /etc/elasticsearch/certs/$node_name.pem /etc/elasticsearch/certs/elasticsearch.pem<br/>mv /etc/elasticsearch/certs/$node_name-key.pem /etc/elasticsearch/certs/elasticsearch-key.pem</span></pre><p id="77a0" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">e.压缩要发送到所有实例的所有必要文件:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7006" class="lx jw in mo b gy ms mt l mu mv">cd ~/certs/<br/>tar -cvf certs.tar *<br/>mv ~/certs/certs.tar ~/</span></pre><p id="5d70" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">启用并启动Elasticsearch服务:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f467" class="lx jw in mo b gy ms mt l mu mv">mkdir -p /etc/elasticsearch/jvm.options.d<br/>echo '-Dlog4j2.formatMsgNoLookups=true' &gt; /etc/elasticsearch/jvm.options.d/disabledlog4j.options<br/>chmod 2750 /etc/elasticsearch/jvm.options.d/disabledlog4j.options<br/>chown root:elasticsearch /etc/elasticsearch/jvm.options.d/disabledlog4j.options</span></pre><p id="fcc7" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">配置后，重新加载服务</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c20e" class="lx jw in mo b gy ms mt l mu mv">systemctl daemon-reload<br/>systemctl enable elasticsearch<br/>systemctl start elasticsearch</span></pre><p id="7d36" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">安装和配置Elasticsearch后，现在我们可以安装Cortex了。</p><h1 id="88ca" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Cortex安装</h1><p id="73ec" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">如果您使用的是安装了的同一个实例或机器，必须安装Cortex。你必须进口GPG钥匙</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="b057" class="lx jw in mo b gy ms mt l mu mv">sudo rpm --import <a class="ae lr" href="https://raw.githubusercontent.com/TheHive-Project/TheHive/master/PGP-PUBLIC-KEY" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/TheHive-Project/TheHive/master/PGP-PUBLIC-KEY</a></span></pre><p id="2682" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">稳定存储库是一个遗留存储库，包含不支持elastic search 7 . x版但支持6.x版的Cortex 3.0.1包。</p><p id="64bb" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">设置您的系统以连接RPM存储库。创建并编辑文件<code class="fe mx my mz mo b">/etc/yum.repos.d/thehive-project.repo</code>:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="e255" class="lx jw in mo b gy ms mt l mu mv">[thehive-project]<br/>enabled=1<br/>priority=1<br/>name=TheHive-Project RPM repository<br/>baseurl=<a class="ae lr" href="https://rpm.thehive-project.org/stable/noarch" rel="noopener ugc nofollow" target="_blank">https://rpm.thehive-project.org/stable/noarch</a><br/>gpgcheck=1</span></pre><p id="6352" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后，您将能够使用<code class="fe mx my mz mo b">yum</code>安装Cortex 3.0.1包:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="913b" class="lx jw in mo b gy ms mt l mu mv">yum install cortex</span></pre><p id="7ced" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后转到/etc/cortex/application.conf文件并编辑以下内容</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/e4c6950b46f5388230fab88cd21bb5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gj9_GrXIGl03QS14Q8XuwQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">/etc/cortex/应用程序. conf</figcaption></figure><p id="457f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">将URI更改为Elasticsearch IP ex-<a class="ae lr" href="http://127.0.0.1:9200" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:9200</a><strong class="kv io"><em class="nf">如果您在elastic search中启用了</em> </strong>认证，您可能需要进行第二个红色框中给出的认证。</p><p id="87a3" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在我们需要cortex服务器的密钥，现在让我们导入该密钥</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="e1c0" class="lx jw in mo b gy ms mt l mu mv">sudo mkdir /etc/cortex<br/>(cat &lt;&lt; _EOF_<br/># Secret key<br/># ~~~~~<br/># The secret key is used to secure cryptographics functions.<br/># If you deploy your application to several instances be sure to use the same key!<br/>play.http.secret.key="$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 64 | head -n 1)"<br/>_EOF_<br/>) | sudo tee -a /etc/cortex/application.conf</span></pre><p id="0062" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">这将生成密钥并将该密钥添加到application.conf文件中。</p><p id="fdd6" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后启动服务</p><p id="a71f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">并转到</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d74a" class="lx jw in mo b gy ms mt l mu mv">http://YOUR_SERVER_ADDRESS:9001/</span></pre><p id="fe1a" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">它会将你重定向到一个像这样的页面点击更新数据库，它会显示一个页面来创建登录信息。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2c19b29e804f79f92b373d5b87de8172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*DlbQCLHdyC1Kq0oZDI6ALA.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae lr" href="http://127.0.0.1:9001/index.html#!/maintenance" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:9001/index . html #！/维护</a></figcaption></figure><p id="4ab5" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后你会看到一个如下所示的登录页面</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/3319873ef876cdbe93f9a1a4b9aefba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-V0rDW4xOiYeiDB8rhQ71g.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">cortex登录页面</figcaption></figure><p id="476d" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后，您可能会看到如下页面</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/ce3955b4719ff28f6d7583bd3e4a758f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IkzXtpkpOLZ8VzkjWYUrjQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">管理仪表板</figcaption></figure><h2 id="dcec" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">安装分析仪</h2><p id="453f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">你可能需要安装Python的<code class="fe mx my mz mo b">setuptools</code>，更新pip/pip3:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9640" class="lx jw in mo b gy ms mt l mu mv">sudo pip install -U pip setuptools &amp;&amp; sudo pip3 install -U pip setuptools</span></pre><p id="116b" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">完成后，在您选择的目录中克隆Cortex-analyzer存储库:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9e0e" class="lx jw in mo b gy ms mt l mu mv">git clone <a class="ae lr" href="https://github.com/TheHive-Project/Cortex-Analyzers" rel="noopener ugc nofollow" target="_blank">https://github.com/TheHive-Project/Cortex-Analyzers</a></span></pre><p id="bdb1" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">每个分析仪都有自己的pip兼容<code class="fe mx my mz mo b">requirements.txt</code>文件。您可以使用以下命令安装所有需求:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3ed2" class="lx jw in mo b gy ms mt l mu mv">for I in $(find Cortex-Analyzers -name 'requirements.txt'); do sudo -H pip2 install -r $I; done &amp;&amp; \<br/>for I in $(find Cortex-Analyzers -name 'requirements.txt'); do sudo -H pip3 install -r $I || true; done</span></pre><p id="6242" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">接下来，您需要告诉Cortex在哪里可以找到分析器。分析器可能位于不同的目录中，如Cortex配置文件(<code class="fe mx my mz mo b">application.conf</code>)的虚拟示例所示:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c457" class="lx jw in mo b gy ms mt l mu mv">analyzer {<br/>  # Directory that holds analyzers<br/>  path = [<br/>    "/path/to/default/analyzers",<br/>    "/path/to/my/own/analyzers"<br/>  ]</span><span id="dfa6" class="lx jw in mo b gy mw mt l mu mv">fork-join-executor {<br/>    # Min number of threads available for analyze<br/>    parallelism-min = 2<br/>    # Parallelism (threads) ... ceil(available processors * factor)<br/>    parallelism-factor = 2.0<br/>    # Max number of threads available for analyze<br/>    parallelism-max = 4<br/>  }<br/>}</span><span id="a64d" class="lx jw in mo b gy mw mt l mu mv">responder {<br/>  # Directory that holds responders<br/>  path = [<br/>    "/path/to/default/responder",<br/>    "/path/to/my/own/responder"<br/>  ]</span><span id="7a8d" class="lx jw in mo b gy mw mt l mu mv">fork-join-executor {<br/>    # Min number of threads available for analyze<br/>    parallelism-min = 2<br/>    # Parallelism (threads) ... ceil(available processors * factor)<br/>    parallelism-factor = 2.0<br/>    # Max number of threads available for analyze<br/>    parallelism-max = 4<br/>  }<br/>}</span></pre><p id="0ed5" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后让我们重新启动服务</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7206" class="lx jw in mo b gy ms mt l mu mv">sudo systemctl restart cortex</span></pre><p id="640d" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后登录到创建的帐户，在此之前您可能看不到任何响应者和分析者，因为我们首先需要创建组织</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/358eb71abb7c0e1caf3c14bdc3e23b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AN1DyD96hcFlgwIYoM0QsQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">创建cortex组织</figcaption></figure><p id="983c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">单击组织并输入要创建和保存的详细信息</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/babd5a6373b0706ef6c4748174275e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYX4xqnk9Y4WGMMbW6-gEw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">创建用户</figcaption></figure><p id="e8fe" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">添加一个用户，然后使用该用户登录到cortex</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/04fd22a41f8dd61afec2585c96359620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBzacL7Zr4_yR9nWox0iBQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">用户仪表板</figcaption></figure><p id="6e8c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在，您可以看到分析器和响应器选项卡，使用它们，我们需要启用分析器</p><p id="e382" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">为此，请转到“组织”,然后单击“分析器”。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/46beab55830b57ddaaae329d389e2024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yIJKBAiNUWq8XAUKrrDRLg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">分析器</figcaption></figure><p id="94ed" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">这些分析器大多是由其他供应商提供的独立第三方服务。</p><h2 id="6fba" class="lx jw in bd jx ly lz dn kb ma mb dp kf le mc md kj li me mf kn lm mg mh kr mi bi translated">启用滥用IP</h2><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/174230c50010e1db015e9612fc22fd99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MaapAS9VDaPhiwrid03xuw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">滥用IP授权</figcaption></figure><p id="af7d" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">首先单击AbuseIPDB_1_0上的enable，它要求api密钥<br/>现在我们需要转到<a class="ae lr" href="https://www.abuseipdb.com/account" rel="noopener ugc nofollow" target="_blank">https://www.abuseipdb.com/account</a>站点，创建一个帐户并获取API密钥</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/8b5ae12597a483e37ecba5ae9bdb8581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qw4r_8-Z_81IeGtmnhU2Rg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">滥用IP仪表板</figcaption></figure><p id="38b5" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">按create API，复制密钥并放入其中，然后启用分析器</p><p id="978c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">来测试它</p><p id="738c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">转到如下所示的新案例，然后按“开始”,它可能会开始运行扫描</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/9c0aef0f879e23c0ac0375078edd44e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCw8GESm3RSmgkottAM08Q.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">运行分析仪</figcaption></figure><p id="4ee8" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后它显示如下</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/d21de1d8cea667611906d0d588873a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1B0aFb8XcKNSVN_KgcLxJw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">扫描结果</figcaption></figure><p id="de56" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后，如果您按下查看，它会显示如下结果</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/043274b894849b4200f1b068bb05a25f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6MZyKS4g7qjdH34e2lqLg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">abuseIP的结果</figcaption></figure><p id="786f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">我们可以用肝脏做同样的事情，因为我们需要连接肝脏和大脑皮层</p><h1 id="95c7" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">连接肝脏和大脑皮层</h1><p id="1aa4" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">首先，我们需要以管理员身份登录到cortex，并获得我们创建的组织(在我的例子中是它的测试)</p><p id="843f" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后我们需要为车辆生成一个API密钥</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/168d44024ebb29d31933958b5d28fe5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ch3EH12M023Wb8Zhf5a9SA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">为Hive创建API</figcaption></figure><p id="b88e" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后转到/etc/thehive/application.conf文件并编辑以下内容</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/9aa69da70ffa417d1a015d2da5c7833f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vIOG4YtfG4jIdiba8px0dQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">etc/thehive/application.conf</figcaption></figure><p id="13fc" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后重新启动高速服务</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="faf0" class="lx jw in mo b gy ms mt l mu mv">sudo systemctl restart Thehive</span></pre><p id="d459" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后登录到手机</p><p id="1b7c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">当你点击这个图标，你会看到如下的内容</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/c1480101b6abdb8101781e64fd869a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrPlQ7EuagucWKxQ-4P1Jg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">与皮层相连</figcaption></figure><p id="542c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">这意味着肝脏和大脑皮层成功连接。</p><h1 id="a62c" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">运行演示</h1><p id="d45f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">就像在大脑皮层中一样，我们也需要为此创建一个组织</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/2d0410bff8c6f24d8c4f1a5bc4bb4241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*he_IksUG0PoBHj4UdlkkDA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">创建配置单元组织</figcaption></figure><p id="0143" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后在那下面我们需要创建用户</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/6fb44534709cb9836cd53a36e3b0a1bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVdsR4RUGCarRWbiThUaDg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">创建用户</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/dce8e40b8fb6d66afb0ade6ed92cd37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClMYhf_7JvvC8RkA5sn1TQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">正在为用户添加密码</figcaption></figure><p id="f898" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后使用创建的用户登录到车辆</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/cfd1c802ef7e6c45731dca4554d1ed6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ck_AZgfFDD6VQrvmUjmCbA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">配置单元用户的仪表板</figcaption></figure><p id="6af1" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">现在创建一个新案例</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/ad6eaf4cd0c70bd795d53649aa4286bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNK0qzn3YF8yK6WAEwCd9Q.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">创建新案例</figcaption></figure><p id="3656" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后它会把你重定向到这样一个页面</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/b554bb7f4330bd38ee8e51af63426e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvli0zzpefu8l9VA1bS79g.png"/></div></div></figure><p id="4fee" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">前往observables</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/ecd8c5359d7a54620a2a4925b955da4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18upjgIxDFYBHWHIghbnPQ.png"/></div></div></figure><p id="3acc" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">在这里给信息，就像上面提到的，我计划看到一个IP 8.8.8.8</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/656fc849304ce0bafd4f51ff45d6c914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHiTHMyUb19Jw_ya_QQSYA.png"/></div></div></figure><p id="35ed" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后选择创建的可观察值，点击1选择的可观察值并运行分析仪。它可能弹出一个窗口来选择分析器，选择AbuseIPDB并运行它</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/54043ffb12241b58135849b795304aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XY9E7o2H3g82PXq0ZQXVIA.png"/></div></div></figure><p id="068c" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">然后，它将生成类似如下的报告</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/926906d74f944aae19d3d0dec2514b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rg_MCJNUinxWbniI7m5JCw.png"/></div></div></figure><p id="73c3" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">我将在这里附上另一篇博客，介绍如何通过使用Nginx revers代理启用SSL来确保这些系统的安全</p><p id="3013" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">我会在另一个博客里看到你。</p><p id="720a" class="pw-post-body-paragraph kt ku in kv b kw ls ky kz la lt lc ld le lu lg lh li lv lk ll lm lw lo lp lq ig bi translated">再见…..</p><h1 id="f1ad" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">依赖</h1><div class="od oe gp gr of og"><a href="https://thehive-project.org/" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">高等教育项目</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">Hive4py允许分析师从电子邮件或SIEM等不同来源创建案例。例如，SOC可能会问…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">thehive-project.org</p></div></div><div class="op l"><div class="oq l or os ot op ou jt og"/></div></div></a></div><div class="od oe gp gr of og"><a href="https://github.com/TheHive-Project/CortexDocs" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">GitHub-the hive-Project/CortexDocs:Cortex的文档</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">Cortex解决了SOC、CSIRTs和安全研究人员在研究过程中经常遇到的两个问题</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="ov l or os ot op ou jt og"/></div></div></a></div><div class="od oe gp gr of og"><a href="https://documentation.wazuh.com/current/installation-guide/open-distro/distributed-deployment/step-by-step-installation/elasticsearch-cluster/elasticsearch-single-node-cluster.html#elasticsearch-single-node-cluster" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">弹性搜索单节点集群-弹性搜索集群</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">在单节点集群上安装Elasticsearch。Elasticsearch开放发行版是一个开源发行版…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">documentation.wazuh.com</p></div></div><div class="op l"><div class="ow l or os ot op ou jt og"/></div></div></a></div></div></div>    
</body>
</html>