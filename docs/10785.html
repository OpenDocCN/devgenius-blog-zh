<html>
<head>
<title>Connecting Android App To MS SQL Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Android 应用程序连接到 MS SQL Server</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connecting-android-app-to-ms-sql-server-2d50e999396b?source=collection_archive---------0-----------------------#2022-11-29">https://blog.devgenius.io/connecting-android-app-to-ms-sql-server-2d50e999396b?source=collection_archive---------0-----------------------#2022-11-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9a31" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用 AndroidX 库和 jTDS JDBC 驱动程序</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d9b7dd513f7477bfa6dcfe43d62f3a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*el6h6GZl-GUwhFQ4"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">扎卡里·斯坦尼斯在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="857f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这篇文章是上一篇文章的延续，即“<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/develop-android-app-directly-from-android-mobile-device-using-java-or-kotlin-language-958d6365dc5a">使用 Java 或 Kotlin 语言</a>在 Android 移动设备上直接开发 Android 应用”。AndroidX 是对原有 Android 支持库的重大改进，不再维护(参考<a class="ae ks" href="https://developer.android.com/jetpack/androidx" rel="noopener ugc nofollow" target="_blank"> AndroidX 概述</a>)。jTDS 是一款开源的 100%纯 Java JDBC 3.0 驱动程序，适用于微软 SQL Server 和 Sybase Adaptive Server Enterprise，目前被认为是这些服务器上最快的生产就绪 JDBC 驱动程序(参见<a class="ae ks" href="https://jtds.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> jTDS 项目</a>)。这个帖子的灵感来自帖子“<a class="ae ks" href="https://medium.com/@nahomdesta61/connect-android-application-to-database-71975ce87b4a" rel="noopener">将 Android 应用程序连接到数据库</a>”。虽然可以将 Android 应用程序直接连接到数据库服务器，但请注意，这种方法可能仅适用于开发和探索目的，而不适用于最终产品(阅读<a class="ae ks" href="https://idiallo.com/blog/dont-connect-directly-to-your-database" rel="noopener ugc nofollow" target="_blank">不要将您的应用程序连接到您的数据库—不仅仅是安全性</a>)。在尝试以下步骤之前，按照<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/develop-android-app-directly-from-android-mobile-device-using-java-or-kotlin-language-958d6365dc5a">上一篇文章在 Android 设备</a>上设置 Android Assist。</p><h1 id="89d4" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">(1)创建 AndroidX 项目</h1><p id="4005" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">点击 AndroidX 项目模板。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/d6a3e982e9e2229273a169cbfb7fd8d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/0*o-Eb6q3KKxovy92p.png"/></div></figure><p id="7c4a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">输入项目的以下详细信息，并点击<strong class="kv io">创建</strong>按钮。代码助手将创建项目，然后显示编辑器窗口。</p><pre class="kd ke kf kg gt mn mo mp bn mq mr bi"><span id="c724" class="ms lq in mo b be mt mu l mv mw">App name = My Connection<br/>Package name = com.example.myconnection<br/>Save location = (accept the default value)<br/>Language = Java<br/>Minimum SDK = API 16 ... (or any minimum SDK listed in the Android Device)</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/edc2e3ab5fee6cb8b2b9070258f9c3a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*HUtlCqsjjfRJNm6S3yf-zg.png"/></div></figure><p id="1c1e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">建议开发人员在编辑代码之前先运行这个引导项目。检查应用程序是否可以编译和运行(文本 Hello World！应该出现在屏幕的中央)。</p><p id="d789" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击编辑器侧菜单以显示项目文件夹/文件列表。需要编辑以下文件:<br/> (1) app/build.gradle <br/>(注意代码辅助需要使用它们的库管理器添加依赖项。这将在后面的步骤中解释。)<br/>(2)app/src/Android manifest . XML<br/>(3)app/src/main/Java/…/main activity . Java<br/>(4)app/src/main/RES/layout/activity _ main . XML</p><blockquote class="my mz na"><p id="a8bc" class="kt ku nb kv b kw kx jo ky kz la jr lb nc ld le lf nd lh li lj ne ll lm ln lo ig bi translated">对于 Android 开发的新开发人员，建议您在编辑完上面列表中的每个文件后立即编译并运行项目。这是为了确保在进入后续步骤之前，您确定每个文件都已被正确编辑。此外，它避免了在后期修复代码错误的麻烦。</p></blockquote><p id="70d8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">每次编辑文件时，点击文件夹图标，然后点击弹出菜单中的“保存”项。</p><p id="f287" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击文件名关闭文件，然后点击弹出菜单中的“关闭”项。</p><p id="7508" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击运行图标编译并运行项目。在弹出菜单中选择“构建调试 APK”项，以便调试功能可用。</p><p id="6563" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(1.1)编辑 app/build.gradle</p><pre class="kd ke kf kg gt mn mo mp bn mq mr bi"><span id="292f" class="ms lq in mo b be mt mu l nf mw">plugins {<br/>    id 'com.android.application'<br/>}<br/><br/>android {<br/>    compileSdk 31<br/><br/>    defaultConfig {<br/>        applicationId "com.example.myconnection"<br/>        minSdk 16<br/>        targetSdk 31<br/>        versionCode 1<br/>        versionName "1.0"<br/>    }<br/><br/>    buildTypes {<br/>        release {<br/>            minifyEnabled false<br/>            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'<br/>        }<br/>    }<br/>    compileOptions {<br/>        sourceCompatibility JavaVersion.VERSION_1_8<br/>        targetCompatibility JavaVersion.VERSION_1_8<br/>    }<br/>}<br/><br/>dependencies {<br/> // NOTE: use the CodeAssist library manager to update dependencies<br/>implementation 'net.sourceforge.jtds:jtds:1.3.1'<br/><br/>}</span></pre><p id="e7fc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(1.2)编辑 app/src/AndroidManifest.xml</p><pre class="kd ke kf kg gt mn mo mp bn mq mr bi"><span id="d5a5" class="ms lq in mo b be mt mu l nf mw">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br/>    package="com.example.myconnection"<br/>    android:versionCode="1"<br/> android:versionName="1.0"&gt;<br/><br/>    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;<br/> &lt;uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/&gt;<br/> &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;<br/> <br/>    &lt;uses-sdk android:minSdkVersion="16" android:targetSdkVersion="31"/&gt;<br/><br/>    &lt;application<br/>        android:allowBackup="true"<br/>        android:icon="@mipmap/ic_launcher"<br/>        android:label="@string/app_name"<br/>        android:roundIcon="@mipmap/ic_launcher_round"<br/>        android:supportsRtl="true"<br/>        android:theme="@style/Theme.MyApplication"&gt;<br/>        &lt;activity<br/>            android:name=".MainActivity"<br/>            android:exported="true"&gt;<br/>            &lt;intent-filter&gt;<br/>                &lt;action android:name="android.intent.action.MAIN" /&gt;<br/><br/>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br/>            &lt;/intent-filter&gt;<br/>        &lt;/activity&gt;<br/>    &lt;/application&gt;<br/><br/>&lt;/manifest&gt;</span></pre><p id="41b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(1.3)编辑 app/src/main/Java/…/main activity . Java</p><pre class="kd ke kf kg gt mn mo mp bn mq mr bi"><span id="2cb9" class="ms lq in mo b be mt mu l nf mw">package com.example.myconnection;<br/><br/><br/>import android.Manifest;<br/>import android.content.pm.PackageManager;<br/>import androidx.core.app.ActivityCompat;<br/>import androidx.appcompat.app.AppCompatActivity;<br/>import android.os.StrictMode;<br/>import android.os.Bundle;<br/>import android.view.View;<br/>import android.widget.Toast;<br/><br/>import java.sql.Connection;<br/>import java.sql.DriverManager;<br/>import java.sql.SQLException;<br/><br/>public class MainActivity extends AppCompatActivity {<br/> <br/> private static String host = "yourdbname.mssql.somee.com";<br/> private static String port = "1433";<br/> private static String Classes = "net.sourceforge.jtds.jdbc.Driver";<br/> private static String database = "yourdbname";<br/> private static String username = "yourname_SQLLogin_1";<br/> private static String password = "xxxxxxxxxx";<br/> //private static String url = "jdbc:jtds:sqlserver://"+host+":"+port+"/"+database;<br/> private static String url = "jdbc:jtds:sqlserver://"+host+"/"+database;<br/> <br/> private Connection connection = null;<br/> <br/> <br/> @Override<br/> protected void onCreate(Bundle savedInstanceState) {<br/>  super.onCreate(savedInstanceState);<br/>  setContentView(R.layout.activity_main);<br/>  <br/> }<br/> <br/> public void startConn(View view) {<br/>  ActivityCompat.requestPermissions(this,new String[]{Manifest.permission.INTERNET}, PackageManager.PERMISSION_GRANTED);<br/>  <br/>  StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();<br/>  StrictMode.setThreadPolicy(policy);<br/>  try {<br/>   Class.forName(Classes);<br/>   connection = DriverManager.getConnection(url, username,password);<br/>   Toast.makeText(this, "Connected", Toast.LENGTH_SHORT).show();<br/>   } catch (ClassNotFoundException e) {<br/>   e.printStackTrace();<br/>   Toast.makeText(this, "Class fail", Toast.LENGTH_SHORT).show();<br/>   } catch (SQLException e) {<br/>   e.printStackTrace();<br/>   Toast.makeText(this, "Connected no", Toast.LENGTH_SHORT).show();<br/>  }<br/> }<br/>}</span></pre><p id="58d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(1.4)编辑 app/src/main/RES/layout/activity _ main . XML</p><pre class="kd ke kf kg gt mn mo mp bn mq mr bi"><span id="1731" class="ms lq in mo b be mt mu l nf mw">&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>xmlns:tools="http://schemas.android.com/tools"<br/>android:layout_width="match_parent"<br/>android:layout_height="match_parent"<br/>android:orientation="horizontal"<br/>tools:context=".MainActivity" &gt;<br/><br/>&lt;Button<br/>android:id="@+id/send_message"<br/>android:layout_width="wrap_content"<br/>android:layout_height="wrap_content"<br/>android:text="start"<br/>android:onClick="startConn"<br/>/&gt;<br/>&lt;/LinearLayout&gt;</span></pre><h1 id="3ccd" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">(2)向代码辅助库添加依赖关系</h1><p id="b142" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">点击主编辑器窗口中的文件夹图标。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/4973783971032f6611930d3ed7e4af1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*SHMAKdqkyZgIda0ULnkvoQ.png"/></div></figure><p id="e539" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击弹出菜单中的“库管理器”项。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/480300b0963938525d76c795b96c4745.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*V7FAFwjRi6dhtsRkycORsg.png"/></div></figure><p id="c763" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">轻按 3 点按钮以显示弹出菜单。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c75242f094c8d19274b200f2537de27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*mljwPOYxgcaq4cayWgQm1A.png"/></div></figure><p id="b5ea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">轻按弹出式菜单中的“从 build.gradle 添加库”项目。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ca6241660db05a6df41451734d6f7616.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*ibWPOap0SuMUlc9cXmmduQ.png"/></div></figure><p id="062c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，列表将包括 jtds 驱动程序，如下所示。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a083ad3c11c8a4d45f3ad7c62f390682.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*hbLPSRiTEFV1NGVK04Xu2g.png"/></div></figure><p id="f03b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">回到主窗口。</p><p id="290c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要确保所有必需的资源都已相应更新，请再次点击文件夹图标，然后点击刷新模块。</p><h1 id="1ff6" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">(3)运行应用程序</h1><p id="a687" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">当应用程序出现在 Android 移动屏幕上时，点击开始按钮，然后等待 toast 消息出现。如果一切正常，应用程序将显示 toast 消息“已连接”。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/47a6e4de7466212f0c7fe0555130b343.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*NEPG_-pd3iFp5B9ukrr80g.png"/></div></figure></div></div>    
</body>
</html>