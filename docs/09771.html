<html>
<head>
<title>Custom sorting and filtering for Angular material table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度材料表的自定义排序和过滤</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/custom-sorting-and-filtering-for-angular-material-table-f18840fb188f?source=collection_archive---------1-----------------------#2022-09-12">https://blog.devgenius.io/custom-sorting-and-filtering-for-angular-material-table-f18840fb188f?source=collection_archive---------1-----------------------#2022-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4483" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我将介绍如何为<a class="ae ki" href="https://material.angular.io/components/table/overview" rel="noopener ugc nofollow" target="_blank">角度材料表</a>创建自定义过滤和排序。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/503ed79fdff6373884bc4540f7d1a8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xpod16KC6uEGgXxiMq22AA.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">最终产品—角度材料表</figcaption></figure><p id="f5c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我假设你已经知道 Angular 和 JavaScript 的基础知识。如果没有，请浏览一遍，稍后再回到本文。</p><ul class=""><li id="eecd" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated"><a class="ae ki" href="https://angular.io/docs" rel="noopener ugc nofollow" target="_blank">https://angular.io/docs</a></li><li id="1d82" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated"><a class="ae ki" href="https://javascript.info/" rel="noopener ugc nofollow" target="_blank">https://javascript.info/</a></li></ul><p id="01ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好吧，让我们开始吧。</p><h1 id="690a" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">需求讨论</h1><p id="d82d" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们将创建一个学生数据的材料表，我们将对每一列排序，并将按主题过滤。</p><h2 id="25bd" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">学生界面</h2><p id="0f2f" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们的学生界面将有名字，班级，部分，科目和分数。这里需要注意的一点是，主题和标记是数组，而其他的是原始数据类型。</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="391e" class="mq lo in nd b gy nh ni l nj nk">export interface Student {<br/>  name: string;<br/>  subjects: string[];<br/>  marks: number[];<br/>  class: string;<br/>  section: string;<br/>}</span></pre><h2 id="ba1e" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">过滤要求</h2><p id="737f" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们应该有一个过滤器，在类型它应该过滤学生的科目。例如，如果我们开始搜索<em class="nl">“MAT”</em>，那么它将返回所有子字符串为<em class="nl">“MAT”</em>的学生。</p><h2 id="d42d" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">分类要求</h2><p id="9e64" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">对于原始数据类型列，我们将进行普通的字符串比较。但是对于科目分类，我们将与学生拥有的科目数量进行比较。对于分数，我们将与分数的平均值进行比较。</p><h1 id="c828" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">履行</h1><p id="ee54" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">好的，让我们从实现开始。</p><p id="9350" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先让我们创建一个没有过滤和排序的简单表格。</p><h2 id="c0a2" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">首先是打字稿部分</h2><ul class=""><li id="f0ee" class="kz la in jm b jn ml jr mm jv nm jz nn kd no kh le lf lg lh bi translated">我们将为学生创建界面。</li><li id="00b9" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">然后我们将定义<code class="fe np nq nr nd b">displayedColumns</code>，它是我们将要在模板中显示的键</li><li id="01db" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">然后我们定义<code class="fe np nq nr nd b">columns</code>，它将包含我们每一列的<code class="fe np nq nr nd b">columnDef</code>、<code class="fe np nq nr nd b">header</code>和<code class="fe np nq nr nd b">cell</code>。这里需要注意的是<code class="fe np nq nr nd b">cell</code>，在这里你可以按照你想要在模板中显示的方式来格式化你的数据。</li><li id="9f61" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">然后我们有了<code class="fe np nq nr nd b">dataSource</code>，一旦你得到数据，你就可以更新<code class="fe np nq nr nd b">dataSource</code>。这里我们使用常量，所以我们只能在<code class="fe np nq nr nd b">ngOnIntit</code>中更新它。</li></ul><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="8531" class="mq lo in nd b gy nh ni l nj nk">import { Component, OnInit } from '<a class="ae ki" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { MatTableDataSource } from '<a class="ae ki" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/table';</span><span id="3794" class="mq lo in nd b gy ns ni l nj nk">export interface Student {<br/>  name: string;<br/>  subjects: string[];<br/>  marks: number[];<br/>  class: string;<br/>  section: string;<br/>}</span><span id="7d6b" class="mq lo in nd b gy ns ni l nj nk">const ELEMENT_DATA: Student[] = [<br/>  {<br/>    name: 'Tony',<br/>    subjects: ['MATH', 'PHY', 'CHEM'],<br/>    marks: [90, 95, 97],<br/>    class: '12',<br/>    section: 'A',<br/>  },<br/>  {<br/>    name: 'Rita',<br/>    subjects: ['MATH', 'PHY', 'BIO'],<br/>    marks: [97, 92, 96],<br/>    class: '12',<br/>    section: 'A',<br/>  },<br/>  {<br/>    name: 'Monty',<br/>    subjects: ['MATH', 'PHY', 'BIO'],<br/>    marks: [80, 99, 100],<br/>    class: '12',<br/>    section: 'B',<br/>  },<br/>  {<br/>    name: 'Pintu',<br/>    subjects: ['GEOLOGY', 'HISTORY'],<br/>    marks: [90, 95],<br/>    class: '12',<br/>    section: 'C',<br/>  },<br/>  {<br/>    name: 'Sarah',<br/>    subjects: ['PAINTING', 'DANCE'],<br/>    marks: [97, 100],<br/>    class: '12',<br/>    section: 'C',<br/>  },<br/>];</span><span id="b7ab" class="mq lo in nd b gy ns ni l nj nk"><a class="ae ki" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'table-filtering-example',<br/>  styleUrls: ['table-filtering-example.css'],<br/>  templateUrl: 'table-filtering-example.html',<br/>})<br/>export class TableFilteringExample implements OnInit{<br/>  displayedColumns: string[] = [<br/>    'name',<br/>    'class',<br/>    'section',<br/>    'subjects',<br/>    'marks',<br/>  ];</span><span id="27e2" class="mq lo in nd b gy ns ni l nj nk">columns = [<br/>    {<br/>      columnDef: 'name',<br/>      header: 'Name',<br/>      cell: (element: Student) =&gt; `${element.name}`,<br/>    },<br/>    {<br/>      columnDef: 'class',<br/>      header: 'Class',<br/>      cell: (element: Student) =&gt; `${element.class}`,<br/>    },<br/>    {<br/>      columnDef: 'section',<br/>      header: 'Section',<br/>      cell: (element: Student) =&gt; `${element.section}`,<br/>    },<br/>    {<br/>      columnDef: 'subjects',<br/>      header: 'Subjects',<br/>      cell: (element: Student) =&gt; `${element.subjects.join(', ')}`,<br/>    },<br/>    {<br/>      columnDef: 'marks',<br/>      header: 'Marks',<br/>      cell: (element: Student) =&gt; `${element.marks.join(', ')}`,<br/>    },<br/>  ];</span><span id="a2c7" class="mq lo in nd b gy ns ni l nj nk">dataSource: MatTableDataSource&lt;Student&gt;;</span><span id="6959" class="mq lo in nd b gy ns ni l nj nk">ngOnInit() {<br/>    this.dataSource = new MatTableDataSource(ELEMENT_DATA);<br/>  }<br/>}</span></pre><h2 id="6595" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">现在模板</h2><ul class=""><li id="2d1e" class="kz la in jm b jn ml jr mm jv nm jz nn kd no kh le lf lg lh bi translated">因为我们已经在 typescript 文件中定义了<code class="fe np nq nr nd b">columns</code>，所以我们不需要在这里特别定义所有的列。我们可以使用<code class="fe np nq nr nd b">*ngFor</code>来处理所有的列。</li><li id="6a57" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">除此之外，它非常简单。</li></ul><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="cf88" class="mq lo in nd b gy nh ni l nj nk">&lt;table mat-table [dataSource]="dataSource" class="mat-elevation-z8"&gt;<br/>  &lt;ng-container<br/>    *ngFor="let column of columns"<br/>    [matColumnDef]="column.columnDef"<br/>  &gt;<br/>    &lt;th mat-header-cell *matHeaderCellDef &gt;{{column.header}}&lt;/th&gt;<br/>    &lt;td mat-cell *matCellDef="let row"&gt;{{column.cell(row)}}&lt;/td&gt;<br/>  &lt;/ng-container&gt;</span><span id="28c6" class="mq lo in nd b gy ns ni l nj nk">&lt;tr mat-header-row *matHeaderRowDef="displayedColumns"&gt;&lt;/tr&gt;<br/>  &lt;tr mat-row *matRowDef="let row; columns: displayedColumns;"&gt;&lt;/tr&gt;<br/>&lt;/table&gt;</span></pre><h2 id="6ad7" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">自定义过滤</h2><p id="c5b7" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">角度材料已经允许有正常的过滤，我们可以通过一个关键，它将过滤所有行的数据，然后返回结果。但是对于像我们这样的复杂数据或者像我们这样的特殊功能，它就不起作用了。</p><p id="39d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要覆盖角度材质的过滤方法，我们可以通过自己的函数覆盖<code class="fe np nq nr nd b">dataSource</code>的<code class="fe np nq nr nd b">filterPredicate</code>。</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="7c72" class="mq lo in nd b gy nh ni l nj nk">ngOnInit() {<br/>    // In the ngOnInit we can override the filterPredicate<br/>    // by our function<br/>    this.dataSource.filterPredicate = this.filterBySubject();<br/>}</span><span id="cc18" class="mq lo in nd b gy ns ni l nj nk">// This is the method which get called from your filter input<br/>applyFilter(event: Event) {<br/>    const filterValue = (event.target as HTMLInputElement).value;<br/>    this.dataSource.filter = filterValue.trim().toUpperCase();<br/>}</span><span id="3c7e" class="mq lo in nd b gy ns ni l nj nk">// This is our filter method. <br/>// It has to return a function<br/>// Method of the function should be <br/>// (data: InterfaceName, filter: string): boolean <br/>filterBySubject() {<br/>    let filterFunction = <br/>        (data: Student, filter: string): boolean =&gt; {<br/>          if (filter) {<br/>            const subjects = data.subjects;<br/>            for (let i = 0; i &lt; subjects.length; i++) {<br/>              if (subjects[i].indexOf(filter) != -1) {<br/>                return true;<br/>              }<br/>            }<br/>            return false;<br/>          } else {<br/>            return true;<br/>          }<br/>       };</span><span id="24a9" class="mq lo in nd b gy ns ni l nj nk">    return filterFunction;<br/>}</span></pre><p id="1f8e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在模板中，我们可以用搜索词调用<code class="fe np nq nr nd b">applyFilter</code>。</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="05e4" class="mq lo in nd b gy nh ni l nj nk">&lt;mat-form-field appearance="standard"&gt;<br/>    &lt;mat-label&gt;<br/>        Filter by subject<br/>    &lt;/mat-label&gt;<br/>    &lt;input <br/>        matInput <br/>        (keyup)="applyFilter($event)" <br/>        placeholder="Filter by subject" <br/>        #input <br/>    /&gt;<br/>&lt;/mat-form-field&gt;</span><span id="6f87" class="mq lo in nd b gy ns ni l nj nk">&lt;/mat-form-field&gt;</span></pre><h2 id="0fcc" class="mq lo in bd lp mr ms dn lt mt mu dp lx jv mv mw mb jz mx my mf kd mz na mj nb bi translated">自定义排序</h2><p id="10a2" class="pw-post-body-paragraph jk jl in jm b jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">与过滤类似，有角度的材料允许通过一些简单的步骤进行正常的分类。但是对于特殊情况和复杂数据，这是行不通的。为此，我们必须用自己的函数覆盖<code class="fe np nq nr nd b">dataSource</code>的<code class="fe np nq nr nd b">sortData</code>方法。</p><pre class="kk kl km kn gt nc nd ne nf aw ng bi"><span id="4b9d" class="mq lo in nd b gy nh ni l nj nk"><a class="ae ki" href="http://twitter.com/ViewChild" rel="noopener ugc nofollow" target="_blank">@ViewChild</a>(MatSort) sort: MatSort;</span><span id="c180" class="mq lo in nd b gy ns ni l nj nk">ngOnInit() {<br/> // here we override the sortData with our custom sort function<br/> this.dataSource.sortData = this.sortData();<br/>}</span><span id="2693" class="mq lo in nd b gy ns ni l nj nk">// datasource sort has to be updated with the <br/>// template's sort.<br/>ngAfterViewInit() {<br/> this.dataSource.sort = this.sort;<br/>}</span><span id="bf6e" class="mq lo in nd b gy ns ni l nj nk">// custom sort function<br/>sortData() {<br/> let sortFunction = <br/> (items: Student[], sort: MatSort): Student[] =&gt;  {<br/>   if (!sort.active || sort.direction === '') {<br/>     return items;<br/>   }</span><span id="a669" class="mq lo in nd b gy ns ni l nj nk">  return items.sort((a: Student, b: Student) =&gt; {<br/>    let comparatorResult = 0;<br/>    switch (sort.active) {<br/>      case 'name':<br/>       comparatorResult = a.name.localeCompare(b.name);<br/>       break;<br/>      case 'class':<br/>       comparatorResult = a.class.localeCompare(b.class);<br/>       break;<br/>      case 'section':<br/>       comparatorResult = a.section.localeCompare(b.section);<br/>       break;<br/>      case 'subjects':<br/>       comparatorResult = a.subjects.length - b.subjects.length;<br/>       break;<br/>      case 'marks':<br/>       comparatorResult =<br/>        a.marks.reduce((prev, curr) =&gt; prev + curr) / a.marks.length<br/>        -<br/>        b.marks.reduce((prev, curr) =&gt; prev + curr) / b.marks.length;<br/>        break;<br/>      default:<br/>        comparatorResult = a.name.localeCompare(b.name);<br/>        break;<br/>    }<br/>    return comparatorResult * (sort.direction == 'asc' ? 1 : -1);<br/>   });<br/> };</span><span id="877d" class="mq lo in nd b gy ns ni l nj nk"> return sortFunction;<br/>}</span></pre></div><div class="ab cl nt nu hr nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ig ih ii ij ik"><p id="0c4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想浏览整个源代码并查看工作预览，你可以在这里查看</p><ul class=""><li id="3e94" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated"><a class="ae ki" href="https://stackblitz.com/edit/angular-n4s7nc?file=src/app/table-filtering-example.html" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/edit/angular-n4s7nc?file = src/app/table-filtering-example . html</a></li></ul></div></div>    
</body>
</html>