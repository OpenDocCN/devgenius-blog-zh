<html>
<head>
<title>Building a REST API using aiohttp framework python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用aiohttp框架python构建REST API</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/building-a-rest-api-using-aiohttp-framework-python-a2f298c92ad4?source=collection_archive---------8-----------------------#2020-06-07">https://blog.devgenius.io/building-a-rest-api-using-aiohttp-framework-python-a2f298c92ad4?source=collection_archive---------8-----------------------#2020-06-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="3895" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">异步应用程序编程一直是应用程序开发领域的最新热点，由于异步应用程序可以同时执行多个工作单元，这可以极大地提高应用程序的响应能力，因此它逐渐受到企业及其应用程序开发人员的青睐。</em></p><p id="7495" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">最近，人们更加关注增强用户体验，围绕业务能力和云技术构建应用程序，推动微服务和无服务器架构的适应，重新定义应用程序的构建方式，异步应用程序将成为未来的发展方向。</em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/dc896aafe20e8cd016c887fe246bf553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7-dzS0rSC7zt-FEh"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@marius?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马里乌斯·马萨拉尔</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6aa2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">应用编程接口(API)标准化了应用程序相互交互的方式，而不考虑它们的实现，现在更难想象不使用API就能构建任何微服务应用。</p><p id="f32b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将使用aiohttp框架在python中构建一个简单的异步REST API。Aiohttp是流行的异步框架之一，它使用非阻塞套接字，并基于python的asyncio库。除了用作服务器web框架之外，它还可以用作基于客户端的框架。</p><p id="33e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你仍然想知道什么是异步编程，我已经写了另一篇文章详细介绍了同步和异步概念，同样可以在这里阅读<a class="ae kz" href="https://medium.com/analytics-vidhya/asynchronous-async-programming-untangled-c05de24a428" rel="noopener"><strong class="jm io"/></a><strong class="jm io">。</strong>没有任何未来，让我们从实施方面开始。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h2 id="efdf" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">REST API —实现</h2><p id="c7c5" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在本节中，我们将使用异步aiohttp框架实现以下REST API端点。</p><ul class=""><li id="9dd5" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated"><strong class="jm io"> <em class="ki"> /health </em> </strong> <em class="ki">使用GET方法—显示应用程序的状态。</em></li><li id="8bb0" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><strong class="jm io"><em class="ki">/v1/crypto/info</em></strong><em class="ki">使用POST方法——使用coin gecko的API获取加密货币信息。</em></li></ul><p id="b471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用aiohttp框架实现上述端点的实际代码如下所示。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae kz" href="https://gist.github.com/parithy86/15085a2093e3455822da439f521070c4" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/parithy 86/15085 a 2093 e 3455822 da 439 f 521070 C4</a></figcaption></figure><p id="7101" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回顾上面的实现，我们自己可以看到，只用几行代码(准确地说是28行)就可以启动并运行API，这真正展示了这些API可以构建和扩展的速度和规模。</p><p id="552e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你可能已经注意到了，我们在函数定义之前使用了<strong class="jm io"> async </strong>关键字，这指定python这个函数是一个异步方法，可以异步执行。整个实现可以分为以下三个主要功能。</p><h2 id="9dfd" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">async def init() —初始化应用程序和服务端点。</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/fb11f4ec537b149930a72af29531b9d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*QxHEiexqdf8JmtAsw60wmw.png"/></div></figure><p id="e146" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是一个init函数，用于初始化我们的web应用程序，并定义了两个端点，使用<strong class="jm io"> <em class="ki"> router.add_get </em> </strong>实现get方法，使用<strong class="jm io"> <em class="ki"> router.add_post </em> </strong>实现post方法。</p><p id="91bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">端点<strong class="jm io">/v1/crypto/info</strong>和<strong class="jm io"> <em class="ki"> /health </em> </strong>及其各自的函数<strong class="jm io"><em class="ki">get _ crypto _ info</em></strong>和<strong class="jm io"> <em class="ki"> health </em> </strong>在端点被访问时必须执行，这些函数也在这个init函数中定义。</p><h2 id="4662" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">async get_crypto_info(请求)—处理API请求。</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mw"><img src="../Images/16636ef5d8f9b7a864b14aa94248b492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7dTI1ALugf9T1_wsDPXTg.png"/></div></div></figure><p id="a861" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该函数包含端点<strong class="jm io">(<em class="ki">/v1/crypto/info</em>)</strong>的实际实现逻辑，在这里，我们访问coin gecko提供的API来检索加密货币(在本例中为比特币)的信息，并将详细信息以json格式返回给消费者。</p><p id="d446" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">按理说，我们应该将它实现为GET方法，但我们有意选择将其实现为POST方法，只是为了演示如何使用这个异步框架实现不同的HTTP动词(GET、POST、PUT、DELETE等)。</p><h2 id="de1b" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">异步定义运行状况(请求)—运行状况检查。</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/95aa7c5eee8bd791535d0d9754724cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*8V_vRvpv6AvC7t4Ti_6XPA.png"/></div></figure><p id="6d29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个函数是<strong class="jm io"> <em class="ki"> /health </em> </strong>端点的实际实现，它返回应用程序的健康状态。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h2 id="7f3d" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">试验结果</h2><p id="60b6" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">我们使用postman测试这些API端点，输出如下所示。下面的屏幕截图提供了使用POST方法对"/<strong class="jm io"><em class="ki">【v1/crypto/info】</em></strong>的执行结果。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/1560f11401b25cd26e8af02cd4fda3fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqC_T1NCIh8GXe75-zoA_g.png"/></div></div></figure><p id="44ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面的屏幕截图提供了使用GET方法对"/<strong class="jm io"><em class="ki">【health】</em></strong>的执行结果。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/dfd8e3389175d51cc6ab8fcafa5c4336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*N5O99RzHRWhUGVWGIuXQZw.png"/></div></figure></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h1 id="fb31" class="na li in bd lj nb nc nd lm ne nf ng lp nh ni nj ls nk nl nm lv nn no np ly nq bi translated"><strong class="ak">总结</strong></h1><blockquote class="nr ns nt"><p id="5994" class="jk jl ki jm b jn jo jp jq jr js jt ju nu jw jx jy nv ka kb kc nw ke kf kg kh ig bi translated">API彻底改变了计算机应用程序相互交互的方式，而另一方面，Async已经成为构建并发应用程序的潜在推动者，通过结合这两种技术，为我们提供了无限的可能性和机会，这些可能性和机会仅限于我们的想象。</p><p id="15dd" class="jk jl ki jm b jn jo jp jq jr js jt ju nu jw jx jy nv ka kb kc nw ke kf kg kh ig bi translated">异步实现的API不仅可以并发执行，还可以将它的并发特性扩展到它的用户，从而大大缩短响应时间。</p><p id="1475" class="jk jl ki jm b jn jo jp jq jr js jt ju nu jw jx jy nv ka kb kc nw ke kf kg kh ig bi translated">也就是说，像任何其他框架一样，async也有自己的缺点，可能会导致性能下降，这取决于应用程序的性质，如果用于正确的用例，async也可以成为真正的游戏规则改变者。</p><p id="27c0" class="jk jl ki jm b jn jo jp jq jr js jt ju nu jw jx jy nv ka kb kc nw ke kf kg kh ig bi translated">希望我们已经启发你开始以异步方式构建你的应用。</p></blockquote><p id="b56e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下次见…阅读愉快..</p><h1 id="b0fc" class="na li in bd lj nb nx nd lm ne ny ng lp nh nz nj ls nk oa nm lv nn ob np ly nq bi translated">参考</h1><ul class=""><li id="ab7e" class="mf mg in jm b jn ma jr mb jv oc jz od kd oe kh mk ml mm mn bi translated"><a class="ae kz" href="https://docs.aiohttp.org/en/stable/" rel="noopener ugc nofollow" target="_blank">https://docs.aiohttp.org/en/stable/</a></li><li id="45f9" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae kz" href="https://medium.com/analytics-vidhya/asynchronous-async-programming-untangled-c05de24a428" rel="noopener">https://medium . com/analytics-vid hya/asynchronous-async-programming-untangled-c05de 24 a 428</a></li><li id="3f93" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">【https://geekflare.com/python-asynchronous-web-frameworks/ T4】</li><li id="3842" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae kz" href="https://gist.github.com/parithy86/15085a2093e3455822da439f521070c4" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/parithy 86/15085 a 2093 e 3455822 da 439 f 521070 C4</a></li></ul></div></div>    
</body>
</html>