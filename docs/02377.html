<html>
<head>
<title>React Tips — styled-components, Batch Updates, Child Validation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 提示—样式化组件、批量更新、子验证</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-tips-styled-components-batch-updates-child-validation-e49930b881d7?source=collection_archive---------11-----------------------#2020-07-31">https://blog.devgenius.io/react-tips-styled-components-batch-updates-child-validation-e49930b881d7?source=collection_archive---------11-----------------------#2020-07-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3dd21b3cf9804c0a58aeb3548307b73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*08rXUul1aGz1ry6i"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">托马斯·博罗夫斯基在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1360" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React 是一个用于创建 web 应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的 React 应用程序的技巧。</p><h1 id="87e3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用钩子反应批处理状态更新批处理</h1><p id="510c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果状态改变并且异步触发，那么它们不会被批处理。</p><p id="6495" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，如果它们被直接触发，那么它们将被批量处理。</p><p id="3427" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们在一个承诺中调用多个状态改变函数，那么它们不会被批处理:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eb2f" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="afca" class="mn lc iq mj b gy ms mp l mq mr">function Component() {<br/>  const [foo, setFoo] = useState('a');<br/>  const [bar, setBar] = useState('b');</span><span id="3045" class="mn lc iq mj b gy ms mp l mq mr">  const handleClickPromise = () =&gt; {<br/>    Promise.resolve().then(() =&gt; {<br/>      setFoo('aa');<br/>      setBar('bb');<br/>    });<br/>  }</span><span id="d104" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;&gt;<br/>      &lt;button onClick={handleClickPromise}&gt;<br/>        click me<br/>      &lt;/button&gt;<br/>      &lt;p&gt;{foo} {bar}&lt;/p&gt;<br/>   &lt;/&gt;<br/>  );<br/>}</span></pre><p id="6508" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果状态改变函数在一个承诺中被调用，就像我们在<code class="fe mt mu mv mj b">then</code>回调中所做的那样，那么它们不会被批处理。</p><p id="cd45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d2d5" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="f712" class="mn lc iq mj b gy ms mp l mq mr">function Component() {<br/>  const [foo, setFoo] = useState('a');<br/>  const [bar, setBar] = useState('b');</span><span id="5915" class="mn lc iq mj b gy ms mp l mq mr">  const handleClick = () =&gt; {<br/>    setFoo('aa');<br/>    setBar('bb');<br/>  }</span><span id="c01d" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;&gt;<br/>      &lt;button onClick={handleClick}&gt;<br/>        click me<br/>      &lt;/button&gt;<br/>      &lt;p&gt;{foo} {bar}&lt;/p&gt;<br/>   &lt;/&gt;<br/>  );<br/>}</span></pre><p id="80a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后他们会被分批。</p><p id="fcaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它们是批处理的，那么更新会立即显示出来。</p><h1 id="e081" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">样式化组件中的条件呈现</h1><p id="11f0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了用样式化组件创建的组件有条件地呈现某些内容，我们可以用 props 作为参数将函数传入字符串。</p><p id="66e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="57ee" class="mn lc iq mj b gy mo mp l mq mr">const Button = styled.button`<br/>  width: 100%;<br/>  outline: 0;<br/>  border: 0;<br/>  height: 100%;<br/>  justify-content: center;<br/>  align-items: center;<br/>  line-height: 0.2;</span><span id="d067" class="mn lc iq mj b gy ms mp l mq mr">  ${({ active }) =&gt; active &amp;&amp; `<br/>    background: green;<br/>  `}<br/>`;</span></pre><p id="d74c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有很多静态风格。</p><p id="1734" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们有一个带<code class="fe mt mu mv mj b">active</code>道具的函数。</p><p id="c12f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们返回的<code class="fe mt mu mv mj b">'background: green'</code>跟<code class="fe mt mu mv mj b">active</code>就是<code class="fe mt mu mv mj b">true</code>。</p><p id="2268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">styled.button</code>模板标签是一个将样式字符串转换成带有样式的组件的函数。</p><p id="5e7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后可以通过书写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dbb4" class="mn lc iq mj b gy mo mp l mq mr">&lt;Button active={this.state.active}&gt;&lt;/Button&gt;</span></pre><p id="9400" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过编写以下代码向现有组件添加条件样式:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="623f" class="mn lc iq mj b gy mo mp l mq mr">const StyledFoo = styled(Foo)`<br/>  background: ${props =&gt; props.active ? 'blue' : 'green'}<br/>`</span></pre><p id="c0f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe mt mu mv mj b">styled</code>函数，它接受一个组件并返回一个模板标签。</p><p id="9d34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建一个字符串，其中插入了一个函数，该函数接受属性并根据属性是否为 T10 返回 T7 或 T8。</p><h1 id="25d2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">React 组件中只允许特定类型的子组件</h1><p id="2ddd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了在 React 组件中允许特定类型的子组件，我们可以遍历<code class="fe mt mu mv mj b">children</code>的每个条目，然后在看到我们不想要的东西时抛出一个错误。</p><p id="4fe6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以在对象中创建一个定制的验证函数，并将其设置为<code class="fe mt mu mv mj b">propTypes</code>属性的值。</p><p id="83a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eff7" class="mn lc iq mj b gy mo mp l mq mr">class ItemGroup extends Component {<br/>  render() {<br/>    return (<br/>      &lt;div&gt;{this.props.children}&lt;/div&gt;<br/>    )<br/>  }<br/>}</span><span id="b2f0" class="mn lc iq mj b gy ms mp l mq mr">ItemGroup.propTypes = {<br/>  children(props, propName, componentName) {<br/>    const prop = props[propName]<br/>    let error = null<br/>    React.Children.forEach(prop, (child) =&gt; {<br/>      if (child.type !== Item) {<br/>        error = new Error(`${componentName} children should be Items`);<br/>      }<br/>    })<br/>    return error;<br/>  }<br/>}</span></pre><p id="8e6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了自己的道具验证方法来验证<code class="fe mt mu mv mj b">children</code>道具。</p><p id="569e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到所有带有<code class="fe mt mu mv mj b">React.children</code>的子节点，并在其上调用<code class="fe mt mu mv mj b">forEach</code>来循环每个项目。</p><p id="b193" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回调中，我们得到了正在循环的<code class="fe mt mu mv mj b">child</code>元素，我们可以用<code class="fe mt mu mv mj b">type</code>属性检查它的类型。</p><p id="143e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它没有返回类型为<code class="fe mt mu mv mj b">Item</code>的东西，我们设置<code class="fe mt mu mv mj b">error</code>并返回它。</p><h1 id="7a67" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用 React 防止多次按键</h1><p id="1286" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了防止 React 多次按下按钮，我们可以在单击按钮后使用<code class="fe mt mu mv mj b">disabled</code>道具禁用按钮。</p><p id="2672" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="15bc" class="mn lc iq mj b gy mo mp l mq mr">class App extends React.Component {<br/>  this.state = {<br/>    disabled : false<br/>  };</span><span id="2508" class="mn lc iq mj b gy ms mp l mq mr">  handleClick = (event) =&gt; {<br/>    if (this.state.disabled) {<br/>      return;<br/>    }<br/>    this.setState({ disabled: true }); <br/>  }</span><span id="ddad" class="mn lc iq mj b gy ms mp l mq mr">  render() {<br/>    return (<br/>     &lt;button onClick={this.handleClick} disabled={this.state.disabled}&gt;<br/>      {this.state.disabled ? 'Sending...' : 'Send'}<br/>     &lt;button&gt;<br/>    );<br/>}</span></pre><p id="617a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有检查<code class="fe mt mu mv mj b">disabled</code>状态的<code class="fe mt mu mv mj b">handleClick</code>方法。</p><p id="eeeb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果是<code class="fe mt mu mv mj b">true</code>，我们什么都不做。</p><p id="60a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们将<code class="fe mt mu mv mj b">disabled</code>状态设置为<code class="fe mt mu mv mj b">true</code>，按钮将被禁用，因为我们将该值传递给了<code class="fe mt mu mv mj b">disabled</code>属性。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/858ea22cc9a6a56fbe901beee874dbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-dVccN8wLoLRjMyR"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安德鲁·斯潘塞在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="f95a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="cfab" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">disabled</code>道具禁用点击按钮。</p><p id="f002" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果状态更新在函数组件中被同步调用，那么它们是批处理的。</p><p id="a234" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以有条件地使用样式化组件进行样式化。</p></div></div>    
</body>
</html>