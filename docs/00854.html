<html>
<head>
<title>Multiple Databases In Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django的多个数据库</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/multiple-databases-in-django-925ca821bdd0?source=collection_archive---------0-----------------------#2020-06-18">https://blog.devgenius.io/multiple-databases-in-django-925ca821bdd0?source=collection_archive---------0-----------------------#2020-06-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/492012e01a9034a152befb8916070740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s4vGmd_RHyv5uC1T"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">费萨尔·米在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl ka kb hr kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ig ih ii ij ik"><p id="27fc" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">大家好，希望你们都好。</p><p id="aca4" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">在本教程中，我们将看到如何在django中使用多个数据库。在本教程中，我们使用了<strong class="kj io"> django 3.0 </strong>，但它将适用于django 3.0以上的所有版本。</p><p id="8c1c" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">让我们首先为这个项目创建一个目录并设置虚拟环境。我在这个项目中使用python 3.6和Django 3.0。</p><p id="8262" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">转到您想要创建项目的文件夹，安装django和其他所需的东西。(如果您在虚拟环境中创建项目会更好，它会将该项目与您的其他项目分开)。</p><p id="04f0" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">创建名为<strong class="kj io"> checkingdb </strong>的项目</p><p id="991f" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"> <em class="lf"> django-admin开始项目检查db </em> </strong></p><p id="8386" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">cd检查b</p><p id="fa73" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"><em class="lf">python manage . py startapp contenter，python manage . py startapp customer，python manage . py startapp user checking</em></strong></p><p id="57de" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在在settings.py文件中配置数据库，但是如果使用postgres，首先启动pgAdmin并创建新的数据库。在这里，我创建了名为<strong class="kj io"> contentdb、usersdb、customerdb </strong>的3个db，其中contentdb是默认的，另外两个是额外的db，您可以将它们用于其他目的。</p><p id="d110" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">首先在INSTALLED_APPS中添加所有应用程序，现在让我们配置数据库_路由器。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="8b01" class="lp lq in ll b gy lr ls l lt lu">DATABASE_ROUTERS = ['contenter.router.CheckerRouter']  # it consists the path where your router.py file reside. in my case it is in contenter app.</span></pre><p id="0932" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在让我们在设置中配置数据库</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="ba39" class="lp lq in ll b gy lr ls l lt lu">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'NAME': 'contentdb',<br/>        'USER': 'postgres',<br/>        'PASSWORD': 'admin1234',<br/>        'HOST': 'localhost',<br/>        'PORT': '5432'<br/>    },<br/>    'usersdb': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'NAME': 'usersdb',<br/>        'USER': 'postgres',<br/>        'PASSWORD': 'admin1234',<br/>        'HOST': 'localhost',<br/>        'PORT': '5432'<br/>    },<br/>    'customerdb': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'NAME': 'customerdb',<br/>        'USER': 'postgres',<br/>        'PASSWORD': 'admin1234',<br/>        'HOST': 'localhost',<br/>        'PORT': '5432'<br/>    }<br/><br/>}</span></pre><p id="a925" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">我已经在contenter app中创建了<strong class="kj io"> router.py </strong>文件。下面是<strong class="kj io"> router.py </strong>文件的代码。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="09ed" class="lp lq in ll b gy lr ls l lt lu">class CheckerRouter:<br/><br/>    def db_for_read(self, model, **hints):<br/>        if model._meta.app_label == 'customers':<br/>            return 'customerdb'<br/>        elif model._meta.app_label == 'userchecking':<br/>            return 'usersdb'<br/>        return 'default'<br/><br/>    def db_for_write(self, model, **hints):<br/>        if model._meta.app_label == 'customers':<br/>            return 'customerdb'<br/>        elif model._meta.app_label == 'userchecking':<br/>            return 'usersdb'<br/>        return 'default'<br/><br/>    def allow_relation(self, obj1, obj2, **hints):<br/>        if obj1._meta.app_label == 'customers' or obj2._meta.app_label == 'customers':<br/>            return True<br/>        elif 'customers' not in [obj1._meta.app_label, obj2._meta.app_label]:<br/>            return True<br/>        elif obj1._meta.app_label == 'userchecking' or obj2._meta.app_label == 'userchecking':<br/>            return True<br/>        elif 'userchecking' not in [obj1._meta.app_label, obj2._meta.app_label]:<br/>            return True<br/>        return False<br/><br/>    def allow_migrate(self, db, app_label, model_name=None, **hints):<br/>        if app_label == 'customers':<br/>            return db == 'customerdb'<br/>        elif app_label == 'userchecking':<br/>            return db == 'usersdb'<br/>        return None</span></pre><p id="c473" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在需要在所有应用程序的models.py中做一些更改，我们可以开始了。</p><p id="e0b8" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">contenter\models.py</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="a1a4" class="lp lq in ll b gy lr ls l lt lu">from django.db import models<br/><br/><br/>class Content(models.Model):<br/>    app_name = models.CharField(max_length=100)<br/>    language = models.CharField(max_length=100)<br/><br/>    def __str__(self):<br/>        return self.app_name</span></pre><p id="6364" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">客户\模型. py</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="d0cf" class="lp lq in ll b gy lr ls l lt lu">from django.db import models<br/><br/><br/>class CustomerChecker(models.Model):<br/>    customer_name = models.CharField(max_length=100)<br/><br/>    class Meta:<br/>        # app_label helps django to recognize your db<br/>        app_label = 'customers'<br/><br/>    def __str__(self):<br/>        return self.customer_name</span></pre><p id="a833" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">userchecking \ models.py</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="5e18" class="lp lq in ll b gy lr ls l lt lu">from django.db import models<br/><br/><br/>class UserChecker(models.Model):<br/>    user_name = models.CharField(max_length=100)<br/>    age = models.IntegerField()<br/><br/>    class Meta:<br/>        app_label = 'userchecking'  # name of app<br/><br/>    def __str__(self):<br/>        return self.user_name</span></pre><p id="5b90" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">不要忘记在admin.py文件中包含您的模型。</p><p id="8b6f" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">毕竟这些需要迁移所有的应用程序</p><p id="5144" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"><em class="lf">python manage . py migrate—database = customer db</em></strong></p><p id="ea9b" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"><em class="lf">python manage . py migrate—database = users db</em></strong></p><p id="d140" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"> <em class="lf"> python manage.py迁移</em> </strong></p><p id="3b9a" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">然后使用<strong class="kj io"><em class="lf">python manage . py runserver</em></strong>运行服务器，并转到浏览器</p><p id="2e6f" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">键入<strong class="kj io"> localhost:8000/admin </strong>，登录并在您的模型中添加数据，然后签入您的db。</p><p id="49ea" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">注意:-当您更改模型中的任何内容时，不要忘记使用<strong class="kj io"><em class="lf">Python manage . py make migrations。</em> </strong></p><p id="75fe" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">以下是该项目的github链接</p><div class="lv lw gp gr lx ly"><a href="https://github.com/dj221ai/multiple-databases-in-django.git" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd io gy z fp md fr fs me fu fw im bi translated">DJ 221 ai/django多数据库</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">这是一个简短的项目，展示了我们如何在django3.0中使用多个数据库</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm jt ly"/></div></div></a></div><p id="a548" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">如果你有什么建议，请告诉我。</p><p id="dac1" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">谢谢你的时间。</p></div></div>    
</body>
</html>