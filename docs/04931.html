<html>
<head>
<title>Retrieve Vaccine Slots in your locality (Python Web-Scrapping)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">检索您所在地区的疫苗槽(Python Web-screwing)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/retrieve-vaccine-slots-in-your-locality-python-web-scrapping-e0005c42c5b0?source=collection_archive---------4-----------------------#2021-05-23">https://blog.devgenius.io/retrieve-vaccine-slots-in-your-locality-python-web-scrapping-e0005c42c5b0?source=collection_archive---------4-----------------------#2021-05-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/76790714a3322b680c6c449c6089db6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*qmiOz5lVPPbT1U8Ep12KNQ.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk translated">丹尼尔·施鲁迪在<a class="ae jv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="240a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我知道很难买到疫苗。在过去的两周里，我一直在努力争取一个职位；仍然没有得到它。因此，我决定创建一个 python 脚本来通知我关于疫苗接种时段的信息。</p><p id="d7c6" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">为此，我们将使用印度政府提供的 API，并废弃该页面。如果您尝试向服务器发出大量请求，您的 IP 地址可能会被阻止。当心！！！！！！！！！！！</p><h1 id="085f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">什么是网页抓取</strong></h1><p id="8182" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated"><strong class="jy io">网页抓取</strong>是使用机器人从网站提取内容和数据的过程。</p><h1 id="fc0c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak"> Cowin-API </strong></h1><p id="0c41" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">您可以从这个页面检查 API。(<a class="ae jv" href="https://apisetu.gov.in/public/marketplace/api/cowin#/Appointment%20Availability%20APIs/calendarByPin" rel="noopener ugc nofollow" target="_blank">链接</a>)</p><p id="45f9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">让我们来看看我们将要对网络做出的响应。我们必须创建一个模型来提取这些信息。</p><p id="fd2f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">演示 API 调用:<a class="ae jv" href="https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode=110001&amp;date=23-05-2021" rel="noopener ugc nofollow" target="_blank">https://cdn-API . co-vin . in/API/v2/appointment/sessions/public/calendar bypin？pin code = 110001&amp;date = 23-05-2021</a></p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lx"><img src="../Images/ce662f3256849cef0db6268921d6a01a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqVgXl6bLD2OeNKitY4VZA.jpeg"/></div></div></figure><p id="42e4" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我们必须为每个中心的每个会议找到<code class="fe mg mh mi mj b">available_capacity</code>字段。</p><h1 id="1aba" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">编码部分</strong></h1><p id="3b58" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">首先，安装<code class="fe mg mh mi mj b">requests</code>和<code class="fe mg mh mi mj b">plyer</code>库。</p><p id="9dc7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><code class="fe mg mh mi mj b">pip install requests</code>和<code class="fe mg mh mi mj b">pip install plyer</code></p><p id="159d" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">导入这些库，它们将是必需的。<code class="fe mg mh mi mj b">requests</code>用于发出 HTTP 请求，<code class="fe mg mh mi mj b">plyer</code>用于发送桌面通知。<code class="fe mg mh mi mj b">time</code>和<code class="fe mg mh mi mj b">datetime</code>用于处理日期时间相关的事情，需要将它们转换成合适的格式。</p><pre class="ly lz ma mb gt mk mj ml mm aw mn bi"><span id="282a" class="mo kv in mj b gy mp mq l mr ms">import requests<br/>import time<br/>from datetime import datetime,timedelta<br/>from plyer import notification</span></pre><p id="97db" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在，我们将定义一些用于搜索的参数。你必须输入年龄，密码和你想搜索的天数。API 允许我们搜索未来 7 天的可用性。</p><pre class="ly lz ma mb gt mk mj ml mm aw mn bi"><span id="fc2a" class="mo kv in mj b gy mp mq l mr ms">user_age = 55<br/>pincodes=["782411","782410"]<br/>num_days = 6</span></pre><p id="0f94" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">我们还必须将日期转换成合适的格式，以便我们可以进行 API 调用。我们从<code class="fe mg mh mi mj b">datetime</code>中提取今天的日期，并相应地转换下一个<code class="fe mg mh mi mj b">num_days</code>。</p><pre class="ly lz ma mb gt mk mj ml mm aw mn bi"><span id="c6fa" class="mo kv in mj b gy mp mq l mr ms">actual = datetime.today()<br/>list_format = [actual + timedelta(days=i) for i in range(num_days)]<br/>actual_dates = [i.strftime("%d-%m-%Y") for i in list_format]</span></pre><p id="2600" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在是主要部分。我们必须搜索所有给定日期的所有密码。此外，需要对所有会议的所有中心进行搜索。如果满足任何条件，我们将打印结果。该结果将作为通知发送到桌面。搜索完成后，我们将等待 5 分钟(使用睡眠功能)并再次继续搜索。</p><pre class="ly lz ma mb gt mk mj ml mm aw mn bi"><span id="ebc5" class="mo kv in mj b gy mp mq l mr ms">while(True) :<br/>    availbleCenters = 0<br/><br/>    #We have to search for all pincodes for all the given dates<br/>    for pincode in pincodes:<br/>        for date in actual_dates:<br/>            #The API to hit for our operation<br/>            URL = f"https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode={pincode}&amp;date={date}"<br/>            header = {<br/>                'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36'}<br/><br/>            result = requests.get(URL, headers=header)<br/>            #If the response is 200 then proceed<br/>            if result.ok:<br/>                response_json = result.json()<br/>                #We have to search for available capacity in each session for each center<br/>                for center in response_json['centers']:<br/>                    for session in center['sessions']:<br/>                        #If the condition is satisfied like the available capacity is not zero and age limit is also satisfied then print them<br/>                        if (session['available_capacity']&gt;0 and session['min_age_limit']&lt;=user_age and session["date"] == date ):<br/>                            availbleCenters = availbleCenters+1<br/>                            print('Center Name : ' , center['name'])<br/>                            print('Available slots : ' , session['available_capacity'])<br/>                            print('Pincode : ' , pincode)<br/>                            print('Vaccine Name : ' , session['vaccine'])<br/>                            print('Date : ', session['date'])<br/>                            print('----------------------------------')<br/><br/>                            centerName = center['name']<br/>                            availbleSlots = session['available_capacity']<br/>                            dateOfSlot = session['date']<br/>                            vaccineName = session['vaccine']<br/>                            #plyer is used here to notify people in desktop.<br/>                            notification.notify(<br/>                                title="Vaccine Slots Availble",<br/>                                # the body of the notification<br/>                                message=f"Center Name : {centerName} \n Availble slots : {availbleSlots} \n Vaccine Name : {vaccineName} \n Date : {dateOfSlot}",<br/>                                #You can add a icon here also in the .ico format<br/>                                # the notification stays for 5sec<br/>                                timeout=5<br/>                            )<br/><br/><br/>            else:<br/>                print("No Response")<br/><br/>    if availbleCenters==0:<br/>        print("No availble slots in these areas...")<br/>        notification.notify(<br/>            title="No Vaccine Slots are available",<br/>            # the body of the notification<br/>            message="Sorry, there is no available slot in your area",<br/>            # You can add a icon here also in the .ico format<br/>            # the notification stays for 5sec<br/>            timeout=5<br/>        )<br/>    else:<br/>        print(f"Hurray. Found {availbleCenters} results...")<br/>    #The process will resume after 300 seconds. That means we will make the APi call again after 5 minutes.<br/>    time.sleep(300)<br/>    print("Waited for 5 minutes. Start searching again")</span></pre><p id="2fb1" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">运行此脚本后，如果您所在的区域有任何可用的插槽，您将每 5 分钟收到一次通知。万岁！！！！！我们已经完成了工作。</p><p id="906b" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">通知会像这样显示。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/ec8d5de88bb90e0853920c172ba00f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*-A72drZD0pHBpcuxd_aKhA.png"/></div></figure><p id="90f5" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">结果也会像这样打印在控制台上。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mu"><img src="../Images/c635012bb38aa5a82b775b577e6137fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XtaC06X2bvgwTC7MBe88w.png"/></div></div></figure><p id="a335" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">如果这些 pin 码中没有可用的插槽，您将在控制台上收到“无响应”。您将收到通知，说明没有可用的疫苗槽。您可以轻松调整通知时间、密码和天数。去玩吧。</p><p id="bf63" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">完整的作品可以在这里找到。</p><div class="mv mw gp gr mx my"><a href="https://github.com/sksaikia/Cowin-Notifier" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd io gy z fp nd fr fs ne fu fw im bi translated">sksaikia/Cowin-通知程序</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">这是一个 python 脚本，它可以通知您可用的疫苗接种位置。它使用 CoWIN 提供的 API 和…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">github.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jp my"/></div></div></a></div></div></div>    
</body>
</html>