<html>
<head>
<title>Training model with Jenkins using docker: MLOPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 docker: MLOPS 的 Jenkins 训练模型</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/training-model-with-jenkins-using-docker-mlops-b18579ddb677?source=collection_archive---------10-----------------------#2022-12-18">https://blog.devgenius.io/training-model-with-jenkins-using-docker-mlops-b18579ddb677?source=collection_archive---------10-----------------------#2022-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2487d967f1d70aa4ab21515a11850c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aTxA0gRjRWWBJfYqB6Xsg.png"/></div></div></figure><p id="21f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在训练机器或深度学习模型时，最常见的问题是我们需要多次改变层，以找到最佳精度的模型。这需要大量的手工工作和时间。</p><p id="66ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过集成 Jenkins 和 docker，我们只需设置一次 Jenkins，然后将您的程序推送到 GitHub，就可以找到最佳精度的模型。詹金斯会做剩下的工作。</p><p id="43d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">假设:</strong></p><ol class=""><li id="e1ac" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">Docker 和 Jenkins 安装在 BaseOS 中。</li><li id="7f5b" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">用户拥有一个 GitHub 帐户并创建了一个回购。</li><li id="5653" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">Jenkins 被添加到 sudoers 文件中以启用权限。</li></ol><p id="3694" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将从创建一个安装了 python3 和所需库的容器映像开始。</p><h1 id="46c8" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">码头工人:</h1><p id="2759" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">下面是创建 docker 文件以训练序列模型的屏幕截图:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/e963f9f876c556f1d003f0ae0a8ea305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbWFooc_PZP_2w9VJZ08DQ.png"/></div></div></figure><p id="8c80" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以 Dockerfile 的名称保存该文件，并构建一个映像:</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="7976" class="mu li in mq b be mv mw l mx my">docker build -t &lt;IMAGE_NAME&gt;:&lt;VERSION&gt; path/to/Dockerfile<br/> e.g docker build -t Sequential:v1 /root/cnn/</span></pre><p id="e88c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为线性回归模型创建另一个容器图像:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/6b63d0333f48c80a5c5a6e0c249406d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEbns01QLqXEf8gHxk_ftQ.png"/></div></div></figure><p id="6d63" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用上面的命令保存并构建另一个图像用于线性回归。</p><p id="c883" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用 docker images 命令检查您的图像:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/8b2996c739f1cd45c7c23e5b71e03a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kZ05eZ1BeiB37tvzqPh_tg.png"/></div></div></figure><h1 id="7ad5" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">詹金斯:</h1><p id="71ef" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">现在是时候通过创造就业机会来安置 Jenkins 了:</p><p id="f003" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">job1:从 GitHub 复制代码并放入一个目录中:</p><p id="df0b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下面的截图中，我们提供了我们的 GitHub 链接，Jenkins 将从那里复制代码，并使用“sudo cp -vrf /mlops-ws”命令将我们的代码文件复制到 mlops-ws 目录中。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/a7e2fcba9a883e00d997bc0b8d3f05bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpfGEv8nUpbY2w9INxSUhw.png"/></div></div></figure><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/cab85760a83f4656e5f17ec87330ec02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slEhd4Pn28NFrRx3cW1vdg.png"/></div></div></figure><p id="ef28" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> job2: </strong>检查代码是线性回归还是序列回归，据此我们需要启动安装了那些库的容器映像。</p><p id="c769" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我只考虑线性回归和序列问题。</p><p id="6c24" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要检查文件的顺序或回归，下面是命令 check:</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="3eff" class="mu li in mq b be mv mw l mx my">grep -Rw 'path/to/file.py' -e 'Sequential/Regression'</span></pre><p id="61c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们需要运行我们的映像，并将 mlops-ws <dir>与 root <dir>连接起来，使我们的程序在容器内部可用。</dir></dir></p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="7125" class="mu li in mq b be mv mw l mx my">sudo docker run -di -v /mlops-ws/:/root/ --name &lt;NAME&gt; &lt;IMAGE_NAME&gt;<br/>sudo docker exec -w /root -i &lt;NAME&gt; python3 &lt;FILENAME.py&gt;</span></pre><p id="7608" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是 job2 的外壳截图:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/030568da4e0ea7d4bcd6d90e6ce445a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShDARvC_mDZMuCAS7YUmSQ.png"/></div></div></figure><p id="5f92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这张截图里有很多东西我没有讲，让我们一个一个来理解:</p><p id="4beb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ne">为什么循环？</em></p><p id="26f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果模型没有给出更好的精度，我们就使用这个循环来一次又一次地运行我们的程序，每次我们都会应用一个不同的层模式，我们将在程序中看到。</p><p id="59aa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ne">为什么传递 env 变量？</em></p><p id="dec3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在容器映像内部传递 env 变量，这样我们的 python 程序就可以使用该变量</p><p id="0b69" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一个例子:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/c2331849a9ab7809a4877e0fb0a6c123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HInrIe0jp7o7G6dATluGQ.png"/></div></div></figure><p id="8a79" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ne">为什么是“如果”条件？</em></p><p id="7d44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">“if 条件”是检查包含程序准确性的输出文件。即<em class="ne">如果小于 0.85，模型将再次训练，并使用另一层配置。</em></p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/71649ef599e48a0eaf5b9f228360eade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzYZiSykIYZWTUOqmFCJZA.png"/></div></div></figure><p id="a3d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> job3: </strong>最好的模型做好了就给开发人员发邮件。</p><p id="f299" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于邮件，我们将创建另一个安装了 python 的映像，只需运行该映像，它就会为我们发送邮件。</p><p id="5cee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">邮件操作系统的 Docker 文件:</p><pre class="ml mm mn mo gt mp mq mr bn ms mt bi"><span id="65b3" class="mu li in mq b be mv mw l mx my">FROM centos<br/>RUN yum -y install python36<br/>CMD python3 /root/mail.py</span></pre><p id="d9d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ne">你可以从我的 GitHub repo 获得邮件的 python 程序。</em></p><p id="ae71" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是我得到的输出:</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/f86c9ae1aebcba63f659ea4260430b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuJJlwRsPQE-OXir7kPdLw.png"/></div></div></figure><p id="1d7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> job4: </strong>监视我们的容器是否失败，如果失败，该作业将再次启动。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/583d20ee2a7bcb59c0cebf7511982e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCNCkF_5SH8Hto0yZsqEgQ.png"/></div></div></figure><p id="d676" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你在这篇文章中发现任何错误或者任何我应该修改的地方，请随时联系我。</p><p id="4066" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">电子邮件:Abhaypratapsingh3008@gmail.com</p></div></div>    
</body>
</html>