# 软件中的阿波罗 13 号

> 原文：<https://blog.devgenius.io/apollo-13-in-software-9b0d02f054e2?source=collection_archive---------6----------------------->

当我们在生产中遇到一个严重的错误时该怎么办？

![](img/91f21a14a1469f40562404096776b70b.png)

[https://unsplash.com/es/fotos/gnTI0R9N0vA](https://unsplash.com/es/fotos/gnTI0R9N0vA)

> 在这次任务的一系列戏剧性事件中，飞行近 56 小时后，一个氧气罐爆炸，迫使机组人员放弃了所有登上月球的想法。飞船受损，但在返回指挥舱进行令人不适的溅落之前，机组人员能够在返回地球的旅程中在登月舱中寻求狭窄的庇护。https://www.space.com/17250-apollo-13-facts.html

当我们在生产中发现一个使我们赔钱的关键错误时，没有人想做出反应，但是当这种情况发生时，什么有效，什么通常是一个大错误？。

## 安静

先冷静一下，恐慌就是灾难的代名词。如果你不是能够解决问题的人，压力是没有用的。请不要落在看屏幕的人后面。唯一的影响是促使人们犯错误，甚至更糟的是不做任何决定。

## 与利益相关者沟通

这一步大大减轻了管理者、利益相关者和一般人的压力，这些人对此感到担忧，但又无力解决。告诉他们我们正在努力，当我们有更多的信息时，我们会告诉他们更多的就足够了。定期沟通也很重要，在这种情况下，透明度非常重要。花几分钟时间定期解释 bug 的情况是一件好事。
但我们不可能与每个人都交谈，让一名发言人负责与利益相关方的沟通是一个好的做法。

## 理解问题

为了能够解决我们需要理解的任何问题，我们必须理解正在发生的事情。因此，我们需要与发现错误的人交谈，试图了解重现错误的步骤和期望的行为。
了解彼此的最佳方式是面对面的交谈，如果可能的话，和其他开发人员一起去，这样你们可以稍后讨论你们的理解。我们需要能够重现问题，找出解决问题的方法。
接下来的事情是，如果 bug 很紧急很重要，就要止血。不紧急或不重要意味着一切照常。

## 如果可能，回滚

如果问题不容易解决，我们已经确定了有问题的代码版本，我们可以接受丢失该版本中提供的功能，然后回滚您的版本。你能轻松回答这些问题吗？。
您能轻松回滚到以前的版本吗？。
做这件事有多难？。
这是你希望拥有的时刻之一:
-切换到位，一次点击，功能关闭
-快速管道
-对已发货的产品有很好的了解。
DevOps 文化可以提供帮助，[你建立它，你运行它。](https://queue.acm.org/detail.cfm?id=1142065)

## 创建一个测试来验证 bug 是否已解决

一旦我们理解了问题，并且知道如何重现它，我们需要编写能够探测 bug 的最低级别的自动测试。
这个测试需要失败，在测试失败之前不要写任何产品代码。只有当系统中发生了期望的行为时，测试才通过。
失败的测试表明正在发生 bug。一旦测试失败，我们可以编写产品代码来使它通过。一旦测试通过，我们就修复了这个错误。

## 将您的修复部署到生产环境中

最好的方法是使用您的正常流程部署到生产环境中，如果您不能这样做，是因为您的生产路径太复杂了。想想看，如何解决这个问题，你的 prod 路径应该足够快，以便在紧急情况下使用它。

## 评估如何管理 bug 造成的影响

考虑 bug 的影响，如何计算损害，以及如何将这些影响最小化。
有时候生产中的一个 bug 意味着修复整个状态的一致性。因此，可能有些事件没有被处理，所以其他服务或系统没有在它们之间同步。
追踪计划如果损失更大，要解决这个问题，这可能意味着要与客户沟通并说声抱歉。

## 准备妥当

要想很好地解决生产中的问题，我们需要做好准备。我们需要了解我们的问题，4k 关键指标可以在这方面帮助我们。
平均恢复时间和部署频率是将生产中的错误成本降至最低的关键。

> 平均恢复时间:当中断发生时，从有人被自动或手动寻呼到中断被解决的时间。
> 
> 部署频率:是一个简单的计数器，每当有人启动一个部署和一个提供的时间窗口时，它就会增加。

平均恢复时间与良好的监控系统密切相关，监控系统能够在客户端受到影响之前向我们发出警告。对可观察性的投资是值得的。
部署频率也是衡量我们对部署流程熟悉程度的重要标准。
熟能生巧，因此定期部署将有助于我们了解我们必须做什么，还将有助于我们部署小功能，并为我们提供更多关于哪个部署有问题的提示。

## 学习

从事件中吸取教训是关键。无可指责的尸检在这方面很有帮助，但它们必须是无可指责的 T2。请不要责备，责备只会造成一种环境，让人害怕改变制度。
关于 bug 没有零风险，我们可以做一些事情将它们减少到一个可笑的水平，但是这些做法需要无所畏惧:

*   无情地重构
*   更频繁地部署
*   编写自动测试

bug 就像代码的味道，它们只是在提醒我们可能有问题。我们的工作是倾听他们来解决我们真正的问题。