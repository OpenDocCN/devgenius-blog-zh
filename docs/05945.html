<html>
<head>
<title>Create Your Own API Manager Without Using Alamofire in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无需在Swift中使用Alamofire，即可创建自己的API管理器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-your-own-service-manager-without-using-alamofire-in-swift-1af5d5440461?source=collection_archive---------0-----------------------#2021-11-26">https://blog.devgenius.io/create-your-own-service-manager-without-using-alamofire-in-swift-1af5d5440461?source=collection_archive---------0-----------------------#2021-11-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="16a9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">调用swift-iOS项目中任何API的简单方法，无需使用第三方库</h2></div><p id="f9e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从简单开始，稍后我们会添加所有的东西来完善我们的库。首先我们需要创建我们的类。在本教程中，我们将它命名为“ServiceManager ”,它应该是一个单例。创建新文件后，我们需要创建第一个名为“callService”的函数，它应该只提供发出请求所需的对象。</p><p id="788f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是这个类开始时的样子</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/ae920a6f730ec67d5a613fcf7180a588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0ujUWQ6Oa6meiznFQU-Xg.png"/></div></div></figure><p id="1274" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的函数将接受一个urlString作为输入，它可能是类似“https://www.google.com”或您需要调用的API。</p><p id="21d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用<strong class="kh ir"> URLSession </strong>和<strong class="kh ir"> URLRequest </strong>来创建我们的经理。URLSession是一个简单的singleton，而URLRequest是我们需要为请求添加所有值的那个。目前我们只设置了httpMethod to GET(这意味着我们还不能发送任何httpbody ),我们添加了一个简单的头“Accept ”,值为“application/json ”(这是您需要添加的最常见的头之一)</p><p id="d559" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您需要发布一些数据，您应该更改<strong class="kh ir"> GET to POST </strong>并使用request.httpBody = &lt;您的数据对象&gt;</p><p id="f596" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<strong class="kh ir"> session.dataTask </strong>我们的请求被发送，我们将得到数据作为响应。</p><p id="a577" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们以口袋妖怪API(<a class="ae ln" href="https://pokeapi.co/" rel="noopener ugc nofollow" target="_blank">https://pokeapi.co/</a>)为例，尝试我们的第一个简单函数调用</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lo"><img src="../Images/a0264efa0be9522ade019a5815637dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lz3qlPXh1LcbGVSU6utlQ.png"/></div></div></figure><p id="5bc2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是我们的ViewController调用ServiceManager的样子。在运行之后，我们从服务器得到这个消息"<strong class="kh ir"> 1417字节"</strong>，这意味着我们有1417字节的数据要处理。但是让我们看看我们收到的实际字符串，而不是数据的维度。在打印数据之前，添加以下行:</p><blockquote class="lp lq lr"><p id="6bfc" class="kf kg ls kh b ki kj jr kk kl km ju kn lt kp kq kr lu kt ku kv lv kx ky kz la ij bi translated"><strong class="kh ir">设</strong> str = String(解码:数据，as: UTF8。<strong class="kh ir">自我</strong></p><p id="433a" class="kf kg ls kh b ki kj jr kk kl km ju kn lt kp kq kr lu kt ku kv lv kx ky kz la ij bi translated">print(str) //这里您将看到从服务器接收到的json</p></blockquote><p id="1bed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行我们的应用程序后，我们可以在日志中看到:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lw"><img src="../Images/805cac818767fe4bd275742cc56a559f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sz_RCPMVkvsMxbt40LFUwg.png"/></div></div></figure><p id="5273" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们拿到了口袋妖怪的名单！！！</p><p id="9233" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建我们的模型，看看如何让我们的函数解析可解码的模型。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lx"><img src="../Images/9014aad089c7dca93f26e3b878d1313d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdRTxk94GHw0FzlGX7oEbQ.png"/></div></div></figure><p id="92fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们的模型，我们将对其响应进行解码。现在我们需要的是解析这个模型的json响应，我们应该告诉视图控制器刷新数据，或者提醒它请求成功。</p><p id="a9db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">函数的声明应该如下所示:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ly"><img src="../Images/faaf4ea81eef121692201a817b57d3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5yhX3heu-aLSfQjujFqpw.png"/></div></div></figure><p id="f93b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用泛型“T”意味着我们的函数将在成功块中返回一个对象，并在出错时调用失败块。让我们在函数中添加解析部分，并调用成功/失败块。这就是我们的函数现在的样子</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lz"><img src="../Images/23901f696c662ff968b88b20582e3953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fYH0TlSsOSNBbZvO1TvXQ.png"/></div></div></figure><p id="db19" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JSONDecoder将完成解析工作。现在让我们创建一个名为ApiManager的新文件，我们将所有的API调用放在那里。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ma"><img src="../Images/138ece31dc50dacdfc14ab48f25a519f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdeIYw9q066eqGDFQBVzjQ.png"/></div></div></figure><p id="e13d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在ApiManager中，您可以放置您的服务。对于这个例子，我们将只使用一个名为retrievePokemons的服务。现在让我们在ViewController中更改我们的代码</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mb"><img src="../Images/bfc91c12e5e625b5498ca8ed3320b546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIMTmMdPTvujSJZagol8lQ.png"/></div></div></figure><p id="1cd0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您现在看到的，我们使用ApiManager来调用我们的服务。在成功的情况下，我们将只打印我们之前看到的模型中口袋妖怪的第一个名字。</p><p id="3ad6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想在调用这个API时添加一个加载器，请阅读我的文章:</p><div class="mc md gp gr me mf"><a href="https://simaspavlos.medium.com/loader-with-rotating-image-in-swift-bce24abc1512" rel="noopener follow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">Swift中带有旋转UIImage的加载程序</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">如何在不扩展UIViewController的情况下创建一个覆盖加载器并在每个类中使用它</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">simaspavlos.medium.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt ll mf"/></div></div></a></div><p id="a113" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，让我们看看我们的调试器，看看打印了什么:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mu"><img src="../Images/f2a26848bfb46177e7e28486e6c62faa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lMSqbTZN2U16SzyFTZNFA.png"/></div></div></figure><p id="a0a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">布尔巴瑟尔是你的POKEMON！</p><p id="e324" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>