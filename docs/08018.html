<html>
<head>
<title>Handling Bad Records and Files in Databricks Using “badRecordsPath”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“badRecordsPath”处理数据块中的坏记录和文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/handling-bad-records-and-files-in-databricks-using-badrecordspath-c2d879648efc?source=collection_archive---------3-----------------------#2022-05-11">https://blog.devgenius.io/handling-bad-records-and-files-in-databricks-using-badrecordspath-c2d879648efc?source=collection_archive---------3-----------------------#2022-05-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="1dfb" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么是“badRecordsPath”选项</h1><p id="e0dc" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">当<strong class="kk io"> <em class="lg">读取数据</em> </strong>来自一个<strong class="kk io"> <em class="lg">基于文件的数据源</em></strong><strong class="kk io"><em class="lg">Apache Spark SQL</em></strong>面临<strong class="kk io"> <em class="lg">两个</em> </strong>典型<strong class="kk io"> <em class="lg">错误案例</em> </strong> -</p><blockquote class="lh li lj"><p id="8482" class="ki kj lg kk b kl lk kn ko kp ll kr ks lm ln kv kw lo lp kz la lq lr ld le lf ig bi translated"><strong class="kk io"> <em class="in">首先是</em> </strong>，<strong class="kk io"> <em class="in">文件</em> </strong>可能<strong class="kk io"/>不是<strong class="kk io"> <em class="in">可读</em> </strong>(例如，<strong class="kk io"> <em class="in">文件</em> </strong>可能是<strong class="kk io"> <em class="in">丢失</em> </strong>，<strong class="kk io"> <em class="in">无法访问</em> </strong>或<strong class="kk io"> <em class="in">损坏</em></strong></p><p id="8b6a" class="ki kj lg kk b kl lk kn ko kp ll kr ks lm ln kv kw lo lp kz la lq lr ld le lf ig bi translated"><strong class="kk io"> <em class="in">其次</em> </strong>，<strong class="kk io"> <em class="in">即使</em></strong><strong class="kk io"><em class="in">文件</em> </strong>是<strong class="kk io"><em class="in"/></strong>可处理的，有些<strong class="kk io"> <em class="in">记录</em> </strong>可能<strong class="kk io"> <em class="in">不是</em> </strong>是<strong class="kk io"> <em class="in">可解析的</em></strong></p></blockquote><p id="4d38" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated"><strong class="kk io"><em class="lg">Azure Databricks</em></strong><strong class="kk io"><em class="lg">提供了</em></strong><strong class="kk io"><em class="lg">统一接口</em> </strong>用于<strong class="kk io"> <em class="lg">处理</em></strong><strong class="kk io"><em class="lg">不良记录</em></strong><strong class="kk io"><em class="lg">不良文件</em></strong><strong class="kk io"><em class="lg">无需中断火花作业</em> </strong>。它是<strong class="kk io"> <em class="lg">可能</em></strong><strong class="kk io"><em class="lg">获取</em><strong class="kk io"><em class="lg">异常记录/文件</em></strong><strong class="kk io"><em class="lg">检索</em></strong><strong class="kk io"><em class="lg">异常原因</em> </strong>从<strong class="kk io"> <em class="lg">异常日志</em> </strong>，通过<strong class="kk io"> <em class="lg">设置</em></strong><strong class="kk io"><strong class="kk io"><em class="lg">badRecordsPath</em></strong>指定一个<strong class="kk io"> <em class="lg">路径</em> </strong>来存储<strong class="kk io"> <em class="lg">异常文件</em> </strong>用于<strong class="kk io"> <em class="lg">记录</em></strong><strong class="kk io"><em class="lg">信息</em> </strong>关于-</strong></strong></p><ul class=""><li id="2252" class="ls lt in kk b kl lk kp ll kt lu kx lv lb lw lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg">不良记录</em> </strong>为<strong class="kk io"> <em class="lg"> CSV </em> </strong>和<em class="lg"> JSON </em>  <strong class="kk io"> <em class="lg">来源</em> </strong>。</li><li id="a493" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg">坏文件</em> </strong>为<strong class="kk io"> <em class="lg">所有</em></strong><strong class="kk io"><em class="lg">基于文件的内置源文件</em> </strong>，就像——<strong class="kk io"><em class="lg">拼花</em> </strong>。</li></ul><h1 id="dfb8" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">“badRecordsPath”选项的限制</h1><p id="3bae" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="kk io"> <em class="lg">使用</em></strong><strong class="kk io"><em class="lg">badRecordsPath</em></strong><strong class="kk io"><em class="lg">选项</em> </strong>在基于<strong class="kk io"> <em class="lg">文件的数据源</em> </strong>中有几个重要的<strong class="kk io"> <em class="lg">限制</em> </strong></p><p id="839b" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated"><strong class="kk io"> <em class="lg"> A) </em> </strong>它是<strong class="kk io"> <em class="lg">非事务性的</em> </strong>并且会<strong class="kk io"> <em class="lg">导致</em></strong><strong class="kk io"><em class="lg">不一致的结果</em> </strong>。</p><p id="4194" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated"><strong class="kk io"> <em class="lg"> B)当读取文件</em> </strong>，<strong class="kk io"><em class="lg"/></strong>，<strong class="kk io"> <em class="lg">网络连接异常</em>，<strong class="kk io"> <em class="lg"> IO 异常</em> </strong>等等，可能<strong class="kk io"> <em class="lg">发生</em> </strong>。这些<strong class="kk io"> <em class="lg">错误</em> </strong>被<strong class="kk io"> <em class="lg">忽略</em> </strong>，而<strong class="kk io"/>下的<strong class="kk io"><em class="lg">badRecordsPath</em></strong>，以及<strong class="kk io"> <em class="lg"> Apache Spark </em> </strong>将<strong class="kk io"> <em class="lg">继续</em> </strong>到<strong class="kk io"> <em class="lg">运行</em></strong><strong class="kk io"/></strong></p><h1 id="e505" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">错误文件(丢失文件)的“badRecordsPath”选项示例</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/1401b5d2717f426aa6f05c8ad810dc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4m2A6ECenAkXxfpW2lddQ.png"/></div></div></figure><p id="e039" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated">输出-</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ms"><img src="../Images/6b4862ba13b4935366f8dcddc10b6513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0OuOtvvrcFr9lFPlWUGFw.png"/></div></div></figure><p id="ea29" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated">在上面的例子中，由于"<strong class="kk io"> <em class="lg"> df.show() </em> </strong>"是<strong class="kk io"> <em class="lg">无法</em> </strong>到<strong class="kk io"> <em class="lg">找到</em></strong><strong class="kk io"><em class="lg">输入文件</em> </strong>，<strong class="kk io"> <em class="lg"> Apache Spark 创建了一个</em><strong class="kk io"><em class="lg">异常文件</em>在本例中，<strong class="kk io"> <em class="lg">为</em></strong><strong class="kk io"><em class="lg">缺少输入文件</em> </strong>，<strong class="kk io"> <em class="lg">路径</em></strong><strong class="kk io"><em class="lg">生成</em></strong><strong class="kk io"><em class="lg">异常文件</em> </strong>为<strong class="kk io"><em class="lg">【mnt/bad-records-Path-folder/</em></strong></strong></strong></p><ul class=""><li id="40ed" class="ls lt in kk b kl lk kp ll kt lu kx lv lb lw lf lx ly lz ma bi translated">“<strong class="kk io"> <em class="lg">异常文件</em> </strong>”即“<strong class="kk io"><em class="lg">part-00000-a9 b 05 b 0e-75ba-4797-a319–4c 82 f 6 C2 da 1 a</em></strong>”是<strong class="kk io"> <em class="lg">中存在的指定的<strong class="kk io"><em class="lg">badRecordsPath</em></strong></em></strong></li><li id="73fc" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"><em class="lg">20220103t 174849</em></strong>是显示的“<strong class="kk io"><em class="lg">data frame reader</em></strong>”中的“<strong class="kk io"> <em class="lg">创建时间</em> </strong>”。</li><li id="39a0" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg">【坏 _ 档】</em> </strong>是<strong class="kk io"> <em class="lg">异常类型</em> </strong>。</li><li id="f0e5" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg">异常文件</em> </strong>，即<strong class="kk io"><em class="lg">part-00000-a9 b 05 b 0e-75ba-4797-a319–4c 82 f 6 C2 da 1 a</em></strong>是<strong class="kk io"> <em class="lg">文件</em> </strong>即<strong class="kk io"> <em class="lg">包含</em> </strong>一<strong class="kk io"> <em class="lg"> JSON 记录</em> </strong></li></ul><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/88fe63c4d00345747fcbdcffe823fcb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDhXEYdCJt43bC_VJZZ7Mw.png"/></div></div></figure><h1 id="5b04" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">针对不良记录的“badRecordsPath”选项示例</h1><p id="162e" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="kk io"> <em class="lg"> CSV 文件</em> </strong>、<strong class="kk io"> <em class="lg">中的<strong class="kk io"> <em class="lg">记录</em> </strong>，包括</em> </strong>的损坏记录，如下-</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/4d32c4dd0f69b0792619329c300aea77.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*-BtH3o9gauaNOK-DXQgbjw.png"/></div></figure><p id="a002" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated"><strong class="kk io"> <em class="lg">代码</em> </strong>到<strong class="kk io"> <em class="lg">读作</em></strong><strong class="kk io"><em class="lg">显示</em></strong><strong class="kk io"><em class="lg">记录</em><strong class="kk io"><em class="lg">CSV 文件</em> </strong>如下-</strong></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/92fd4434ae19b4298175b92a43fd052f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHOZAUnJ1Njp1OPYXg5z6Q.png"/></div></div></figure><p id="c3f7" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated">输出-</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/287b54b1481a118a5904534c6fba9662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*E-uwqwurnlYO4EmnvOU01w.png"/></div></figure><p id="85e6" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated">在这个例子中，<strong class="kk io"> <em class="lg"> DataFrame 只包含了</em></strong><strong class="kk io"><em class="lg">三条记录</em> </strong>、<strong class="kk io"> <em class="lg">匹配</em> </strong>提供的<strong class="kk io"> <em class="lg">模式</em> </strong>。</p><p id="2359" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated">对于<strong class="kk io"> <em class="lg">两个</em> </strong> <strong class="kk io"> <em class="lg">坏记录</em></strong><strong class="kk io"><em class="lg">未</em> </strong> <strong class="kk io"> <em class="lg">匹配</em> </strong>所提供的<strong class="kk io"> <em class="lg">模式</em> </strong>，将<strong class="kk io"> <em class="lg">路径</em> </strong>的<strong class="kk io"> <em class="lg">生成</em></strong></p><ul class=""><li id="bd6a" class="ls lt in kk b kl lk kp ll kt lu kx lv lb lw lf lx ly lz ma bi translated">“<strong class="kk io"> <em class="lg">异常文件</em> </strong>”，即“<strong class="kk io"><em class="lg">part-00000-f 0 eeb7c 2–7049–4 f72–9 b04–6 ad 87 e 348398</em></strong>”是<strong class="kk io"> <em class="lg">中存在的指定的<strong class="kk io"> <em class="lg"> badRecordsPath </em></strong></em></strong></li><li id="da42" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated">“<strong class="kk io"> <em class="lg"> 20220103T184743 </em> </strong>”是显示的“<strong class="kk io"><em class="lg">data frame reader</em></strong>”的“<strong class="kk io"> <em class="lg">创建时间</em> </strong>”。</li><li id="43b9" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg"> bad_records </em> </strong>是<strong class="kk io"> <em class="lg">异常类型</em> </strong>。</li><li id="5136" class="ls lt in kk b kl mb kp mc kt md kx me lb mf lf lx ly lz ma bi translated"><strong class="kk io"> <em class="lg">异常文件</em> </strong>，即<strong class="kk io"><em class="lg">part-00000-f0eeb7c 2–7049–4f 72–9b 04–6a d87e 348398</em><em class="lg">JSON</em></strong><strong class="kk io"><em class="lg">文件</em> </strong>即<strong class="kk io"> <em class="lg">包含- </em> </strong></li></ul><blockquote class="lh li lj"><p id="c3fe" class="ki kj lg kk b kl lk kn ko kp ll kr ks lm ln kv kw lo lp kz la lq lr ld le lf ig bi translated">1.<strong class="kk io"> <em class="in">不良记录</em> </strong>。</p><p id="e7b4" class="ki kj lg kk b kl lk kn ko kp ll kr ks lm ln kv kw lo lp kz la lq lr ld le lf ig bi translated">2.<strong class="kk io"> <em class="in">路径下的</em><em class="in">输入文件</em></strong><strong class="kk io"><em class="in">包含</em></strong><strong class="kk io"><em class="in">不良记录</em> </strong>。</p><p id="33c4" class="ki kj lg kk b kl lk kn ko kp ll kr ks lm ln kv kw lo lp kz la lq lr ld le lf ig bi translated">3.<strong class="kk io"> <em class="in">异常</em> </strong>或<strong class="kk io"> <em class="in">原因</em></strong><strong class="kk io"><em class="in">消息</em> </strong>。</p></blockquote><p id="7d52" class="pw-post-body-paragraph ki kj in kk b kl lk kn ko kp ll kr ks kt ln kv kw kx lp kz la lb lr ld le lf ig bi translated"><strong class="kk io"> <em class="lg">后</em></strong><strong class="kk io"><em class="lg">异常文件</em> </strong>是<strong class="kk io"> <em class="lg">位于</em> </strong>，一个<strong class="kk io"> <em class="lg"> JSON Reader </em> </strong>可以被<strong class="kk io"> <em class="lg">使用</em> </strong>到<strong class="kk io"> <em class="lg">进程</em></strong><strong class="kk io"/></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/a20f83a811e391894d5644cf47b9acd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5oMhQrgMtfNobCAeUrKMw.png"/></div></div></figure></div></div>    
</body>
</html>