# MySQL:MySQL äº‹ä»¶è°ƒåº¦å™¨ç®€ä»‹

> åŸæ–‡ï¼š<https://blog.devgenius.io/mysql-brief-introduction-to-mysql-event-scheduler-1035219694dd?source=collection_archive---------1----------------------->

![](img/cef03a85f732c0be606dee6a3986e815.png)

åœ¨ [Unsplash](https://unsplash.com/) ä¸Šç”± [Boitumelo Phetla](https://unsplash.com/@writecodenow) æ‹æ‘„çš„ç…§ç‰‡

æœ¬æ–‡å°†åˆ©ç”¨ MySQL äº‹ä»¶è°ƒåº¦å™¨æ¥åˆ›å»ºä¸€äº›è´Ÿè´£å®ŒæˆæŸäº›ä»»åŠ¡çš„äº‹ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒ Cronjob(ä¸€ä¸ªç”¨äºç±»ä¼¼ Unix çš„è®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„è½¯ä»¶å·¥å…·)å’Œ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºã€‚

> **æ³¨æ„**:å¦‚æœé˜…è¯»è®©ä½ æ˜æ˜æ¬²ç¡ï¼Œå…ˆæ‹¿èµ·ä½ çš„å’–å•¡æ¯ï¼Œç„¶åç»§ç»­ã€‚*ğŸ˜ƒ*

# å…ˆå†³æ¡ä»¶

1.  MySQL å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Š
2.  MySQL æ•°æ®åº“èƒŒæ™¯
3.  èƒ½å¤Ÿç®€åŒ–æ€»æ˜¯ä¸€ä¸ªä¼˜åŠ¿ğŸ˜ƒ

# ä»€ä¹ˆæ˜¯ MySQL äº‹ä»¶è°ƒåº¦å™¨ï¼Ÿ

MySQL äº‹ä»¶è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªç®¡ç†äº‹ä»¶çš„è°ƒåº¦å’Œæ‰§è¡Œçš„å·¥å…·ï¼Œè¿™äº›äº‹ä»¶å°±æ˜¯æ‰€è°“çš„æ ¹æ®æ—¶é—´è¡¨è¿è¡Œçš„ä»»åŠ¡ã€‚MySQL åœ¨ç‰ˆæœ¬ 5.1.6 ä¸­å¼•å…¥äº†äº‹ä»¶è°ƒåº¦å™¨ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª SQL è¯­å¥çš„å‘½åæ•°æ®åº“å¯¹è±¡ï¼Œè¿™äº› SQL è¯­å¥ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªå›ºå®šçš„æ—¶é—´é—´éš”æ‰§è¡Œï¼Œåœ¨ç‰¹å®šçš„æ—¥æœŸå’Œæ—¶é—´å¼€å§‹å’Œç»“æŸã€‚è¿™ä¸ªäº‹ä»¶è°ƒåº¦å™¨çš„æƒ³æ³•ç±»ä¼¼äºUnix **crontab** (ä¹Ÿç§°ä¸ºâ€œcronjobâ€)æˆ– **Windows ä»»åŠ¡è°ƒåº¦å™¨**çš„æƒ³æ³•ã€‚

# ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ MySQL äº‹ä»¶è°ƒåº¦å™¨ï¼Ÿ

å‡è®¾æ‚¨ç®¡ç†ç”±ä¸¤ä¸ªè¡¨ç»„æˆçš„æ•°æ®åº“ã€‚ä¸€ä¸ªè¡¨åŒ…å«ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„æ•°æ®ï¼Œå¦‚å§“åã€å¹´é¾„ã€å‡ºç”Ÿæ—¥æœŸã€æ€§åˆ«ç­‰ã€‚åœ¨å¦ä¸€ä¸ªè¡¨ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯å¤©åªè¾“å…¥ä¸€æ¬¡æ•°æ®ï¼Œåœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œæˆ‘ä»¬æ¨é€æ¯å¤©åˆ›å»ºçš„ç”¨æˆ·æ¡ç›®æ•°ã€‚

é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜é™ˆè¿°å¯¹ä½ æ¥è¯´çœ‹èµ·æ¥å¾ˆç®€å•ï¼è®©æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ cronjob æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥è·å–æ¯å¤©åˆ›å»ºçš„æ‰€æœ‰ç”¨æˆ·æ¡ç›®ï¼Œå¹¶å°†ç»“æœæ’å…¥åˆ°å¦ä¸€ä¸ªè¡¨ä¸­ã€‚æˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨ crontab è¡¨è¾¾å¼è®¾ç½®è®¡åˆ’æ—¶é—´æ¥ä½¿ç”¨ cronjob æ‰§è¡Œæˆ‘ä»¬çš„è„šæœ¬ã€‚

![](img/25b9ad600aa5056b17320fcb699ca099.png)

ä½†æ˜¯ç­‰ç­‰ï¼è®©æˆ‘ä»¬é‡å¤ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•ã€‚

*   æˆ‘ä»¬å¿…é¡»ç¼–å†™å¤„ç†ä¸šåŠ¡é€»è¾‘çš„ä»£ç å—ã€‚
*   ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª cronjobï¼Œå®ƒå°†ä»¥ç‰¹å®šçš„æ—¶é—´é—´éš”è§¦å‘æˆ‘ä»¬çš„è„šæœ¬ã€‚
*   ç°åœ¨æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ä¸¤å°æœºå™¨ï¼Œä¸€å°åœ¨æ•°æ®åº“ä¸­ï¼Œå¦ä¸€å°æ˜¯æˆ‘ä»¬è®¾ç½® cronjob çš„æœºå™¨ã€‚

> ä½ ä¸è®¤ä¸ºè¿™æ˜¯èµ„æºçš„æµªè´¹å—ï¼Ÿæˆ‘ä»¬èƒ½ç”¨å•å°æœºå™¨åšå®ƒå—ï¼Ÿæ„Ÿè°¢ MySQL ä»»åŠ¡è°ƒåº¦ç¨‹åºï¼

å½“æˆ‘ä»¬çš„ä»»åŠ¡å®Œå…¨ä»¥æ•°æ®ä¸ºä¸­å¿ƒæˆ–è€…è¡¥å……å·²ç»å†…ç½®åˆ°æ•°æ®åº“ä¸­çš„åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªäº‹ä»¶è°ƒåº¦å™¨è¿›è¡Œæ•°æ®æ¸…ç†ã€è®°å½•æŸäº›äº‹ä»¶ã€èšåˆæŸäº›æ•°æ®ç­‰ã€‚

# CronJob ä¸Šçš„ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åº

åœ¨ä¸€äº›ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºè€Œä¸æ˜¯ Cronjobã€‚ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½åŸºäºè¿™äº›ç”¨ä¾‹åšå‡ºå†³å®šï¼Œå¹¶å£°æ˜å“ªä¸€ä¸ªæ˜¯æœ€å¥½çš„ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬ä½¿ç”¨ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºçš„ä¼˜åŠ¿:

*   æ˜¯ç›´æ¥ç”¨ MySQL æœåŠ¡å™¨å†™çš„ã€‚
*   è¿™æ˜¯ç‹¬ç«‹äºå¹³å°çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ˜¯ç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„éƒ½æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ MySQLã€‚
*   æ¯å½“éœ€è¦å®šæœŸæ›´æ–°æˆ–æ¸…ç†æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§äº‹ä»¶è°ƒåº¦æ–¹æ³•ã€‚
*   æ²¡æœ‰å¿…è¦æ¯æ¬¡éƒ½ç¼–è¯‘æŸ¥è¯¢ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ã€‚

# MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºé…ç½®

MySQL ä½¿ç”¨ä¸€ä¸ªåä¸º**äº‹ä»¶è°ƒåº¦å™¨çº¿ç¨‹**çš„ç‰¹æ®Šçº¿ç¨‹æ¥æ‰§è¡Œæ‰€æœ‰è°ƒåº¦çš„äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹äº‹ä»¶è°ƒåº¦ç¨‹åºçº¿ç¨‹çš„çŠ¶æ€:

```
SHOW PROCESSLIST;
```

![](img/7a4c75618b169a6e3d98e1ce744303d3.png)

å¦‚æœæœªå¯ç”¨äº‹ä»¶è°ƒåº¦ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†äº‹ä»¶è°ƒåº¦ç¨‹åºç³»ç»Ÿå˜é‡è®¾ç½®ä¸ºå¯ç”¨å¹¶å¯åŠ¨å®ƒ:

```
SET GLOBAL event_scheduler = ON;
```

![](img/95c744efdc01f948c8cb0526bf2fe837.png)

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹ä»¶è°ƒåº¦ç¨‹åºçº¿ç¨‹çš„çŠ¶æ€:

![](img/be62263d7fafe6c3b08134c803f4d628.png)

# åˆ›å»ºæ–°çš„ MySQL äº‹ä»¶è¯­æ³•

è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„åŸºæœ¬è¯­æ³•åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª MySQL äº‹ä»¶:

```
CREATE EVENT [IF NOT EXIST] event_name 
ON SCHEDULE schedule 
DO event_body
```

åœ¨æ­¤è¯­æ³•ä¸­:

é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨â€œCREATE EVENTâ€å…³é”®å­—æŒ‡å®šæƒ³è¦åˆ›å»ºçš„äº‹ä»¶çš„åç§°ã€‚**äº‹ä»¶åç§°åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚**å…¶æ¬¡ï¼Œåœ¨â€œON SCHEDULEâ€å…³é”®å­—åæŒ‡å®šä¸€ä¸ªæ—¥ç¨‹è¡¨ã€‚

å¦‚æœäº‹ä»¶æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•:

```
AT timestamp [+ INTERVAL]
```

å¦‚æœäº‹ä»¶æ˜¯é‡å¤å‘ç”Ÿçš„äº‹ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ EVERY å­å¥:

```
EVERY interval STARTS timestamp [+INTERVAL] ENDS timestamp [+INTERVAL]
```

ç¬¬ä¸‰ï¼Œå°† SQL è¯­å¥æ”¾åœ¨ DO å…³é”®å­—ä¹‹åã€‚æˆ‘ä»¬å¯ä»¥åœ¨äº‹ä»¶ä½“å†…è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚å¦‚æœæˆ‘ä»¬æœ‰å¤åˆè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ä¸€ä¸ªâ€œBEGIN ENDâ€å—ä¸­ã€‚

# ä¸ºæˆ‘ä»¬çš„ç”¨ä¾‹å®ç° MySQL äº‹ä»¶

è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯(å¦‚å§“åã€å¹´é¾„ã€æ€§åˆ«ã€å‡ºç”Ÿæ—¥æœŸ)çš„è¡¨:

```
CREATE TABLE USERS ( 
id INT PRIMARY KEY AUTO_INCREMENT,
Name VARCHAR(20) NOT NULL,      
Gender VARCHAR(1) NOT NULL, 
AGE INT NOT NULL, 
CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, 
UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE  CURRENT_TIMESTAMP 
);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå¦ä¸€ä¸ªè¡¨æ¥å­˜å‚¨æ¯å¤©çš„ç”¨æˆ·æ¡ç›®æ•°ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯¥è¡¨:

```
CREATE TABLE USERS_COUNT_DAY_WISE (
id INT PRIMARY KEY AUTO_INCREMENT,
USER_ENTRIES_ON DATETIME,
COUNT INT
);
```

æˆ‘ä»¬çš„ MySQL äº‹ä»¶è°ƒåº¦ç¨‹åºçš„æ—¶é—´åˆ°äº†ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œä»â€œUSERSâ€è¡¨ä¸­è·å–æ¯å¤©çš„ç”¨æˆ·æ¡ç›®æ•°ï¼Œå¹¶å°†ç»“æœæ’å…¥åˆ°â€œUSERS_COUNT_DAY_WISEâ€è¡¨ä¸­ã€‚æˆ‘ä»¬å°†æ¯å¤©æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªä»»åŠ¡ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ­¤äº‹ä»¶ï¼Œå¹¶ä¸ºå…¶å®‰æ’ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´é—´éš”:

```
CREATE EVENT USERS_ENTRY_COUNT
ON SCHEDULE EVERY 1 DAY 
STARTS (TIMESTAMP(CURRENT_DATE) + INTERVAL 1 DAY + INTERVAL 1 HOUR)
DO
INSERT INTO USERS_COUNT_DAY_WISE (USER_ENTRIES_ON, COUNT) SELECT NOW(), COUNT(*) FROM USERS WHERE CREATED_AT >= DATE_SUB(NOW(), INTERVAL 1 DAY);
```

è¦æ£€æŸ¥æˆ‘ä»¬æ‰§è¡Œçš„äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:

```
SELECT event_schema, event_definition, status, starts, last_executed FROM INFORMATION_SCHEMA.EVENTS
```

# é—®å€™ï¼ğŸ¥³

*æˆ‘ä»¬å·²ç»æˆåŠŸåœ°åˆ›å»ºäº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª MySQL äº‹ä»¶ï¼Œå®ƒå°†è´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨ç‰¹å®šçš„æ—¶é—´é—´éš”å†…æ¿€æ´»è¿™ä¸ªä»»åŠ¡ã€‚*

ä½œä¸ºèƒœåˆ©çš„ä¸€é¡µï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬é¢„å®šçš„äº‹ä»¶æ˜¯å¦è¢«æ·»åŠ åˆ°è¿›ç¨‹åˆ—è¡¨ä¸­ã€‚

![](img/e9f0cc4075f274bac27c9ef3f7f346ce.png)![](img/5bc9333237a86fd0d4f822e9fc0c79bd.png)

# æ‘˜è¦

ä¸ºäº†è¿™ç¯‡æ–‡ç« çš„å®Œæ•´æ€§ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€å­¦çš„å†…å®¹ã€‚

*   ä»€ä¹ˆæ˜¯ MySQL äº‹ä»¶è°ƒåº¦å™¨ï¼Ÿ
*   æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¯ä»¥åœ¨ Cronjob ä¸Šä½¿ç”¨å®ƒï¼Ÿ
*   MySQL äº‹ä»¶è°ƒåº¦å™¨çš„åŸºæœ¬å‘½ä»¤

> å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œåˆ«å¿˜äº†ç»™å®ƒä¸€ä¸ªæŒå£°ï¼

![](img/a7d8c1ca5201216f8856b10e902b2fba.png)

è¯·éšæ—¶åœ¨ [**Linkedin**](https://www.linkedin.com/in/shubham-kaushik-temp/) ä¸Š ping æˆ‘ï¼Œæ•¬è¯·æœŸå¾…ä¸‹ä¸€æœŸï¼

# å‚è€ƒ

[1] MySQL å®˜æ–¹æ–‡æ¡£[https://dev.mysql.com/doc/](https://dev.mysql.com/doc/)

[2] MySQL æ•™ç¨‹ç½‘ç«™[http://mysqltutorial.org/](http://mysqltutorial.org/)