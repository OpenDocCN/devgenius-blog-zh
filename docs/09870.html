<html>
<head>
<title>Deploy Presto With multiple workers using docker compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 docker compose 快速部署多个工作人员</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploy-presto-with-multiple-workers-using-docker-compose-166ffefcd45?source=collection_archive---------4-----------------------#2022-09-19">https://blog.devgenius.io/deploy-presto-with-multiple-workers-using-docker-compose-166ffefcd45?source=collection_archive---------4-----------------------#2022-09-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5cc1" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">更快的分析和查询执行</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/6d9cb2482ce7967d3feac98ca69abf32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rL_sXMjUE6878AtN"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated"><a class="ae ks" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3a37" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://prestodb.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> Presto </strong> </a>是分布式 SQL 引擎，主要用于查询大型数据集。Presto 快速、可靠且可扩展。</p><p id="61c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Presto 在 2013 年由<strong class="kv io">脸书</strong>开源。Presto 不是数据库，它充当的是 Hive、<a class="ae ks" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> Kafka </a>、<a class="ae ks" href="https://cassandra.apache.org/_/index.html" rel="noopener ugc nofollow" target="_blank"> Cassandra </a>、<a class="ae ks" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> Postgres </a>、MySQL 等关系数据库和 NOSQL 数据库的计算层。</p><p id="ffa4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">presto 的典型部署需要一个 presto 协调器和几个 Presto 工作器。</p><p id="2a4d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> Presto-Coordinator </strong> —用于提交查询和调度查询执行。它还管理所有的工人。</p><p id="144c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> Presto-Workers </strong> —它用于处理查询和拆分查询，以便更快地执行。</p><p id="3fd9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们可以看到如何使用 docker compose 用 6 个工人部署 Presto。</p><p id="0a7b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">1)拉 Docker 图像。</p><p id="5b81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">2)编写自定义 Docker 编写文件。</p><p id="309f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">3)使用 Docker compose 部署它。</p><p id="3a08" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以从 https://github.com/pranav1699/prestodb-docker-compose 那里得到密码。</p><h1 id="7e1f" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">调出 Docker 图像</h1><p id="62d1" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">这里我们将使用由<a class="ae ks" href="https://ahana.io/getting-started/" rel="noopener ugc nofollow" target="_blank"> ahanaio </a>提供的<a class="ae ks" href="https://hub.docker.com/r/ahanaio/prestodb-sandbox" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">prestodb-sandbox</strong></a>Docker 映像</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="1334" class="mr lq in mn b gy ms mt l mu mv">docker pull ahanaio/prestodb-sandbox</span></pre><h1 id="2a01" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">编写自定义 Docker 编写文件</h1><p id="9668" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在创建自定义 Docker 合成文件之前，我们需要为协调器和工作器创建配置属性文件。</p><p id="efd0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建名为<strong class="kv io"> config.properties </strong>的属性文件</p><p id="b3dd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">协调器的<a class="ae ks" href="https://github.com/pranav1699/prestodb-docker-compose/blob/master/config.properties" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">config . properties</strong></a>文件如下所示:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="099c" class="mr lq in mn b gy ms mt l mu mv">coordinator=true<br/>node-scheduler.include-coordinator=true<br/>http-server.http.port=8080<br/>discovery-server.enabled=true<br/>discovery.uri=http://localhost:8080</span></pre><p id="5edc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里我们必须将<strong class="kv io">协调人</strong>属性设置为<code class="fe mw mx my mn b">true</code>，因为这是针对协调人的。</p><p id="54c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您希望协调器也充当工作者，那么将<strong class="kv io">节点调度器的值设置为<code class="fe mw mx my mn b">true</code>。</strong></p><p id="e27b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">worker 的<a class="ae ks" href="https://github.com/pranav1699/prestodb-docker-compose/blob/master/config.properties" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">config . properties</strong></a>文件如下所示:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="9f46" class="mr lq in mn b gy ms mt l mu mv">coordinator=false<br/>http-server.http.port=8083 #different port for different workers<br/>discovery.uri=http://coordinator:8080</span></pre><p id="ded1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个文件中，我们需要将<strong class="kv io">协调员</strong>属性设置为<code class="fe mw mx my mn b">false</code>，因为这是为工人设置的。</p><p id="97be" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们必须为将要部署的每个工作人员更改<strong class="kv io"> http-server.http-port </strong>。</p><p id="3c7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">并将<strong class="kv io"> discovery.uri </strong>设置为部署协调器的 uri。</p><p id="f7b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如图所示，为每个员工创建单独的文件夹</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/262f4a227c6c0398bb2b1a674d6b35bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*9M077Bt9M0dXRydMJ9I71g.png"/></div></figure><p id="90fd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">开始创建<a class="ae ks" href="https://github.com/pranav1699/prestodb-docker-compose/blob/master/docker-compose.yaml" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">docker-compose . YAML</strong></a>文件</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="bd5f" class="mr lq in mn b gy ms mt l mu mv">version: '3'</span><span id="9812" class="mr lq in mn b gy na mt l mu mv">services:<br/>  coordinator:<br/>    image: ahanaio/prestodb-sandbox<br/>    ports:<br/>      - "8080:8080"<br/>    container_name: "coordinator"<br/>    volumes:<br/>      - ./config.properties:/opt/presto-server/etc/config.properties<br/>      - ./local_postgres.properties:/opt/presto-server/etc/catalog/local_postgres.properties<br/>    <br/>  worker:<br/>    image: ahanaio/prestodb-sandbox<br/>    container_name: "worker0"<br/>    ports:<br/>      - "8083:8083"<br/>    volumes:<br/>      - ./worker/config.properties:/opt/presto-server/etc/config.properties<br/>    depends_on:<br/>      - coordinator<br/>  workerone:<br/>    image: ahanaio/prestodb-sandbox<br/>    container_name: "worker1"<br/>    ports:<br/>      - "8084:8084"<br/>    volumes:<br/>      - ./worker1/config.properties:/opt/presto-server/etc/config.properties<br/>    depends_on:<br/>      - coordinator<br/>  workertwo:<br/>    image: ahanaio/prestodb-sandbox<br/>    container_name: "worker2"<br/>    ports:<br/>      - "8085:8085"<br/>    volumes:<br/>      - ./worker3/config.properties:/opt/presto-server/etc/config.properties<br/>    depends_on:<br/>      - coordinator</span><span id="3652" class="mr lq in mn b gy na mt l mu mv">workerthree:<br/>    image: ahanaio/prestodb-sandbox<br/>    container_name: "worker3"<br/>    ports:<br/>      - "8092:8092"<br/>    volumes:<br/>      - ./worker4/config.properties:/opt/presto-server/etc/config.properties<br/>    depends_on:<br/>      - coordinator<br/>      <br/>  workerfour:<br/>    image: ahanaio/prestodb-sandbox<br/>    container_name: "worker4"<br/>    ports:<br/>      - "8093:8093"<br/>    volumes:<br/>      - ./worker5/config.properties:/opt/presto-server/etc/config.properties<br/>    depends_on:<br/>      - coordinator</span></pre><h1 id="81ee" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">使用 docker compose 部署它</h1><p id="664e" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在 cli 中使用 docker compose 命令部署它</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="95d5" class="mr lq in mn b gy ms mt l mu mv">docker-compose up -d</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nb"><img src="../Images/30d14d893a63513c6199f93c58f16bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUcWc1iZocmksb43xvvr3Q.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/6f3b38c45067877d2c256a6d835bb36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EC3uckunIldA5aSu6uM1tA.png"/></div></div></figure><p id="e3df" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在码头集装箱开始运行。</p><p id="b2f4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后去<a class="ae ks" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> localhost:8080 </a>看看 presto UI。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/5292edeb5ed15d4c83faec5491f9424f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OoLHeUPqD97lY9GXOWAnxQ.png"/></div></div></figure><h1 id="f4fc" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">摘要</h1><p id="b1db" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在这篇博客中，我们已经看到了如何使用 docker compose 部署多个 workers 的 presto。你也可以增加工人的数量，工人的数量越多分析速度越快。</p><h1 id="97ba" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">还好奇？</h1><p id="3faf" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">如果你想探索更多关于普雷斯托，这个页面提供了一个很好的选择:<a class="ae ks" href="https://github.com/prestodb/presto" rel="noopener ugc nofollow" target="_blank">https://github.com/prestodb/presto</a></p></div></div>    
</body>
</html>