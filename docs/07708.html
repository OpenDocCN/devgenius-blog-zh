<html>
<head>
<title>Using AWS CLI to launch an EC2 Webserver with Apache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS CLI 通过 Apache 启动 EC2 服务器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/using-aws-cli-to-launch-an-ec2-webserver-with-apache-e6f0c56a99e3?source=collection_archive---------9-----------------------#2022-04-17">https://blog.devgenius.io/using-aws-cli-to-launch-an-ec2-webserver-with-apache-e6f0c56a99e3?source=collection_archive---------9-----------------------#2022-04-17</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/1bca2b25cf830e755568c476316af66b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-o7mUeMI6YFxAq86eb5ReQ.png"/></div></div></figure><p id="b4ef" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">在这个项目中，我们将尝试创建一个 EC2 web 服务器，仅使用<em class="kx">AWS CLI 运行 Apache。我们将尝试用一个命令来完成它。</em></p><p id="aa17" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">也就是说，我们需要先完成一些准备/信息收集步骤。</p><ul class=""><li id="0168" class="ky kz ir kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">我们需要创建一个安全组并向其添加规则。</li><li id="f551" class="ky kz ir kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">我们需要为实例创建一个密钥对。</li><li id="50a4" class="ky kz ir kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">(可选)为引导脚本创建一个文本文件。否则，你可以直接“内联”它。</li><li id="c813" class="ky kz ir kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">我们需要将要使用的图像的 AMI ID。</li></ul><p id="c493" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我喜欢从零开始我的项目，所以我们只基于一个假设:</p><ul class=""><li id="8700" class="ky kz ir kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">您已经在工作站上安装并配置了 AWS CLI。(我用的是 Windows 终端)如果你不知道，你可以看看 AWS 关于安装和配置 AWS CLI 的很棒的文档，它会让你在几分钟内启动并运行。</li></ul><p id="1ba3" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">既然我们都准备好了，让我们开始吧！</p><h1 id="67b3" class="lm ln ir bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">安全组</h1><p id="3ca1" class="pw-post-body-paragraph jz ka ir kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ik bi translated">我们要做的第一件事是确保我们的实例和后续的 web 服务器能够与我们对话。为此，我们将使用以下命令:</p><p id="b377" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><code class="fe mp mq mr ms b">aws ec2 create-security-group --group-name oneshot_sg --description "allows SSH and HTTP traffic"</code></p><p id="2539" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">一旦我们运行这个命令，它就会显示“GroupId”。抓住这只小狗，把它放在记事本什么的里面，因为我们马上就要用到它了。<em class="kx">如果您错过了，可以随时使用</em> <code class="fe mp mq mr ms b">aws ec2 describe-security-groups</code> <em class="kx">来列出您所有的安全组。</em></p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mt"><img src="../Images/97befb068a6f371e44449c6f33db6b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tud7B5LOo6djWUhuO2StIg.png"/></div></div></figure><p id="6d51" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">让我们添加 SSH 和 HTTP 的规则:<br/> <code class="fe mp mq mr ms b">aws ec2 authorize-security-group-ingress --group-id sg-09cd014f67e9b5cc0 --protocol tcp --port 22 --cidr 0.0.0.0/0</code> <br/> <code class="fe mp mq mr ms b">aws ec2 authorize-security-group-ingress --group-id sg-09cd014f67e9b5cc0 --protocol tcp --port 80 --cidr 0.0.0.0/0</code></p><p id="9ddb" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">验证我的两个规则显示如下:<br/> <code class="fe mp mq mr ms b">aws ec2 describe-security-groups --group-ids sg-09cd014f67e9b5cc0</code></p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div class="gi gj my"><img src="../Images/b05507f14096c851857b8c0eb878bd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*SwO4Em-jUU7i3wiQNMOlEQ.png"/></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">让所有人进来。非常适合测试。对生产来说没那么多。</figcaption></figure><h1 id="cc74" class="lm ln ir bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">密钥对</h1><p id="1e3d" class="pw-post-body-paragraph jz ka ir kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ik bi translated">我们的下一步设置是创建一个密钥对。该命令将创建对，然后将对输出到我当前目录下的. pem 文件:<br/> <code class="fe mp mq mr ms b">aws ec2 create-key-pair --key-name letmein_kp --query 'KeyMaterial' --output text | out-file -encoding ascii -filepath letmein_kp.pem</code></p><p id="89f2" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">该命令不向终端提供任何输出，但我们可以通过检查下载文件夹来验证文件是否已成功创建:</p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div class="gi gj nd"><img src="../Images/a70eca49002f96e09bc5cc82d7bbc60f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*LATFQHtI2ttA27ePN0R_Lw.png"/></div></figure><h1 id="dee6" class="lm ln ir bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">AMI ID</h1><p id="4ad2" class="pw-post-body-paragraph jz ka ir kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ik bi translated">最后一个设置步骤是找到我们将用于发布的准确的 Amazon 机器映像 ID (AMI ID)。这个 ID 是特定于地区的，所以我们将使用一个命令来列出所有符合我们标准的 AMI。</p><p id="5aa1" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><code class="fe mp mq mr ms b">aws ec2 describe-images --owners amazon --filters "Name=name, Values=amzn2-ami-hvm-2.0.????????.?-x86_64-gp2" "Name=state, Values=available" --query "reverse(sort_by(Images, &amp;Name))[:1].ImageId" --region us-east-1 --output text<br/></code> <em class="kx">注意:由于复制/粘贴添加了新行，命令将不得不手动键入</em></p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ne"><img src="../Images/a9e23a38d42da0b570a388df2edda2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QoUjqWeq1APirnGQpsuhDQ.png"/></div></div><figcaption class="mz na gk gi gj nb nc bd b be z dk translated">用 ami-______ 抓取钻头。我们需要这个。</figcaption></figure><p id="1403" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">现在我们所有的设置都已完成，我们可以将所有的部分放在一起启动这个实例了！</p><h1 id="3620" class="lm ln ir bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">发射命令</h1><p id="6b3b" class="pw-post-body-paragraph jz ka ir kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ik bi translated">首先，让我们看看这个野兽！记下我们收集的所有不同组件？</p><p id="2c9b" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><code class="fe mp mq mr ms b">aws ec2 run-instances --image-id ami-0a3c14e1ddbe7f23c --count 1 --instance-type t2.micro --key-name letmein_kp --security-group-ids sg-09cd014f67e9b5cc0 --user-data file://bootstrap06.txt</code></p><p id="250a" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我引用的 bootstrap 只是一个文本文件，我在其中包含了一些 bash 脚本和 html 代码，因此我们得到了一些有趣的输出，表明我们成功地完成了项目。主要部分是下面的代码:</p><p id="1f42" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><code class="fe mp mq mr ms b">#!/bin/bash <br/>yum update -y <br/>yum install httpd -y <br/>service httpd start <br/>chkconfig httpd on</code></p><p id="2c09" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">运行启动命令后，我们应该会看到如下输出:</p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div class="gi gj nf"><img src="../Images/97d86b1e27eadea85dd571e027026208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj9Gih-6eEfBSq6KrtNVcg.png"/></div></figure><p id="a7a3" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">在我们给它几分钟的时间来完成所有的命令和更新之后，我们获取公共 IP，然后！我们有了自己的网络服务器！</p><figure class="mu mv mw mx gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ng"><img src="../Images/0c4fd66796b335b6551f2bff19989e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*05yKpH6_fBT3ltz1_Oy7QQ.jpeg"/></div></div></figure><h1 id="5e78" class="lm ln ir bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">精益求精！</h1></div></div>    
</body>
</html>