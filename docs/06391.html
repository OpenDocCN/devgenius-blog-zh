<html>
<head>
<title>Kubernetes on Local Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">本地机器上的Kubernetes</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kubernetes-on-local-machine-e061a30a2bbe?source=collection_archive---------9-----------------------#2022-01-04">https://blog.devgenius.io/kubernetes-on-local-machine-e061a30a2bbe?source=collection_archive---------9-----------------------#2022-01-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/efb72517e9391fb251655d74d829ce56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGFEDxKI_wgNOnidxAnTVg.png"/></div></div></figure><p id="480d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Kubernetes已经成为容器编排事实上的标准。所有主要的云提供商都有一个Kubernetes平台，团队可以使用它来托管他们的应用程序。根据一个人对容器开发和操作环境的熟悉程度，学习Kubernetes可能是在公园散步或爬一座陡峭的小山。</p><p id="ab98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我个人喜欢GKE(谷歌Kubernetes引擎)，因为它有许多安全性，可观察性和开箱即用的扩展功能。然而，对于日常开发来说，使用它可能会更昂贵。</p><p id="6ff2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有许多Kubernetes产品可以安装在本地开发者机器上，例如Minikube、Kind、MicroK8s、K3s等。在本文中，我将记录使用K3s创建Kubernetes集群所需的步骤。</p><p id="08cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://k3s.io" rel="noopener ugc nofollow" target="_blank"> K3s </a>是一款面向物联网和边缘电脑的轻量级Kubernetes发行版。它也可以安装在基于ARM的机器上(例如raspberry pi)。</p><p id="fc81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除非您已经有了一组Raspberry Pis来在您的网络中创建Kubernetes集群，否则您将在您的个人工作站上创建它。人们可以使用各种虚拟机技术来创建一组虚拟机，例如VirtualBox、Qemu等。然而，在本文中，我将使用<a class="ae kt" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank">多通道</a>。通过Multipass，用户可以在任何工作站上按需获得Ubuntu虚拟机。</p><p id="9e73" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于本文，我假设您使用的是Linux或Mac机器。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="c86f" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装多通道</h1><p id="6312" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">位于<a class="ae kt" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank"> https://multipass.run </a>的站点有关于在各种机器上安装multipass的说明。</p><p id="ebc7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在基于Ubuntu的机器上执行下面的命令来安装multipass。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="23dd" class="mn lc in mj b gy mo mp l mq mr">sudo snap install multipass</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="d8de" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为K8s集群创建节点</h1><p id="0745" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我们将使用两个节点构建我们的集群。其中一个节点将充当主平面或控制平面。另一个将充当辅助节点或代理节点。可以将多个代理节点添加到集群中。</p><p id="2c8f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建控制平面:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7681" class="mn lc in mj b gy mo mp l mq mr">multipass launch --name k3s-nd1 --cpus 2 --mem 4096M --disk 10G 21.10</span></pre><p id="0d46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面的命令将创建一个具有2个CPU、4GB内存和10G空间的虚拟机。虚拟机中使用的操作系统将是<code class="fe ms mt mu mj b">Ubuntu 21.10</code>。您可以执行<code class="fe ms mt mu mj b">multipass find</code>来查看VM可用的其他映像。</p><p id="bc17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建代理节点:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1da7" class="mn lc in mj b gy mo mp l mq mr">multipass launch --name k3s-nd2 --cpus 2 --mem 4096M --disk 10G 21.10</span></pre><p id="b310" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过执行命令<code class="fe ms mt mu mj b">multipass list</code>，检查所有虚拟机是否准备就绪。您应该会看到如下内容。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="445a" class="mn lc in mj b gy mo mp l mq mr">Name            State             IPv4             Image<br/>k3s-nd1         Running           192.168.64.22    Ubuntu 21.10<br/>k3s-nd2         Running           192.168.64.23    Ubuntu 21.10</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="70d9" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在控制面板上安装K3s</h1><p id="528f" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">登录控制面板。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3dfe" class="mn lc in mj b gy mo mp l mq mr">multipass shell k3s-nd1</span></pre><p id="4b4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要在这个节点上安装k3s，并使它成为“控制平面”节点。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0400" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=&lt;&lt;channel&gt;&gt; INSTALL_K3S_VERSION=&lt;&lt;version&gt;&gt; INSTALL_K3S_EXEC="server" sh -s -</span></pre><p id="c44c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">频道可能是<code class="fe ms mt mu mj b">stable</code>或<code class="fe ms mt mu mj b">latest</code>。</p><p id="e52f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该版本应该是https://github.com/k3s-io/k3s/releases<a class="ae kt" href="https://github.com/k3s-io/k3s/releases" rel="noopener ugc nofollow" target="_blank">的发布版本之一</a></p><p id="5ae7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一个示例命令是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5b24" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=stable INSTALL_K3S_VERSION=v1.21.8+k3s1 INSTALL_K3S_EXEC="server" sh -s -</span></pre><p id="158f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果一切顺利，您可以通过在<code class="fe ms mt mu mj b">k3s-nd1</code>中执行下面的命令来验证Kubernetes正在运行。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89ee" class="mn lc in mj b gy mo mp l mq mr">sudo kubectl get node -o wide</span></pre><p id="1734" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它应该显示如下内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="295c" class="mn lc in mj b gy mo mp l mq mr">NAME      STATUS   ROLES                  AGE   VERSION<br/>k3s-nd1   Ready    control-plane,master   69s   v1.21.8+k3s1</span></pre><p id="27af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">很好，控制飞机已经启动并运行了。现在，我们已经运行了控制面板，我们可以创建代理节点并添加群集。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="c191" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在代理节点上安装K3s</h1><p id="ce40" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">在您机器的终端中执行以下命令，从<code class="fe ms mt mu mj b">k3s-nd1</code>节点获取令牌:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9264" class="mn lc in mj b gy mo mp l mq mr">multipass exec k3s-nd1 -- sudo cat /var/lib/rancher/k3s/server/node-token</span></pre><p id="f78f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该得到如下所示的令牌:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="25b6" class="mn lc in mj b gy mo mp l mq mr">K10700a2d30d94e34c12f3a43cb7bea731d787a213fce3ace5913ec3c043ce896ae::server:1dfe37384fa47c28b1cc4a319f5dadf5</span></pre><p id="c3c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">保存该令牌，因为创建代理节点时需要它。</p><p id="3d92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，通过执行以下命令，登录到代理节点<code class="fe ms mt mu mj b">k3s-nd2</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ce44" class="mn lc in mj b gy mo mp l mq mr">multipass shell k3s-nd2</span></pre><p id="582c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行以下命令在代理节点上安装K3s:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="35f2" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=&lt;&lt;channel&gt;&gt; INSTALL_K3S_VERSION=&lt;&lt;version&gt;&gt; INSTALL_K3S_EXEC="agent" K3S_URL=https://&lt;&lt;ip_address_of_k3s-nd1&gt;&gt;:6443 K3S_TOKEN=&lt;&lt;token from k3s-nd1&gt;&gt; sh -s -</span></pre><p id="379e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意，该命令类似于控制平面节点中的安装，但需要控制平面URL和令牌的其他值来加入群集。通过执行命令<code class="fe ms mt mu mj b">multipass list</code>可以看到控制平面的IP地址。</p><p id="4b16" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">代理节点<code class="fe ms mt mu mj b">k3s-nd2</code>的示例命令是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1caa" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=stable INSTALL_K3S_VERSION=v1.21.8+k3s1 K3S_URL=https://192.168.64.22:6443 INSTALL_K3S_EXEC="agent" K3S_TOKEN=K10700a2d30d94e34c12f3a43cb7bea731d787a213fce3ace5913ec3c043ce896ae::server:1dfe37384fa47c28b1cc4a319f5dadf5 sh -s -</span></pre><p id="08b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过在您的机器上的<code class="fe ms mt mu mj b">k3s-nd2</code>之外执行命令，验证代理节点是否已经成功加入Kubernetes集群:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6872" class="mn lc in mj b gy mo mp l mq mr">multipass exec k3s-nd1 -- sudo kubectl get nodes</span></pre><p id="0cce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该会看到类似下面的内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5bdd" class="mn lc in mj b gy mo mp l mq mr">NAME      STATUS   ROLES                  AGE    VERSION<br/>k3s-nd1   Ready    control-plane,master   12m    v1.21.8+k3s1<br/>k3s-nd2   Ready    &lt;none&gt;                 100s   v1.21.8+k3s1</span></pre><p id="10fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你！您的机器上有一个Kubernetes集群。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="674e" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">更新集群</h1><p id="662b" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">鉴于这是本地群集，即非生产群集，用户可以删除并使用更新的二进制文件创建一个新群集。然而，有些情况下你不想这么做。也许你正在把它当作你家庭网络中的国内生产集群。或者实际上您已经进一步更新了您的集群，并使其达到了生产级别。</p><h2 id="e23d" class="mn lc in bd ld mv mw dn lh mx my dp ll kg mz na lp kk nb nc lt ko nd ne lx nf bi translated">更新控制平面</h2><p id="661e" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">通过执行以下命令登录到节点<code class="fe ms mt mu mj b">k3s-nd1</code>。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7683" class="mn lc in mj b gy mo mp l mq mr">multipass shell k3s-nd1</span></pre><p id="b43a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行以下命令来安装所需版本的k3s。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dded" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=&lt;&lt;channel&gt;&gt; INSTALL_K3S_VERSION=&lt;&lt;version&gt;&gt; sh</span></pre><p id="fa23" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可能已经注意到安装和更新的命令是相同的。这是因为<code class="fe ms mt mu mj b">k3s</code>是单个二进制，更新就像更新二进制文件一样简单。</p><p id="8554" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为更新命令的示例，k3s更新到版本“v1.22.5+k3s1”的情况是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="db56" class="mn lc in mj b gy mo mp l mq mr">curl -sfL https://get.k3s.io | INSTALL_K3S_CHANNEL=stable INSTALL_K3S_VERSION=v1.22.5+k3s1 sh</span></pre><p id="e5f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，执行命令来验证所使用的k3s版本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2a91" class="mn lc in mj b gy mo mp l mq mr">sudo kubectl get nodes</span></pre><p id="c0f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该会看到类似下面的内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="45e1" class="mn lc in mj b gy mo mp l mq mr">NAME      STATUS   ROLES                  AGE   VERSION<br/>k3s-nd2   Ready    &lt;none&gt;                 10m   v1.21.8+k3s1<br/>k3s-nd1   Ready    control-plane,master   21m   v1.22.5+k3s1</span></pre><p id="c3c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将看到控制平面更新为“v1.22.5+k3s1”。</p><p id="8667" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们更新代理节点。</p><h2 id="7533" class="mn lc in bd ld mv mw dn lh mx my dp ll kg mz na lp kk nb nc lt ko nd ne lx nf bi translated">更新代理节点</h2><p id="751e" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">更新代理节点的步骤类似于安装新的代理节点。</p><p id="9ba2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">登录到代理节点<code class="fe ms mt mu mj b">k3s-nd2</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="56b3" class="mn lc in mj b gy mo mp l mq mr">multipass shell k3s-nd2</span></pre><p id="44ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行以下命令，将代理节点上的K3s更新到所需版本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ba45" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=&lt;&lt;channel&gt;&gt; INSTALL_K3S_VERSION=&lt;&lt;version&gt;&gt; K3S_URL=https://&lt;&lt;ip_address_of_k3s-nd1&gt;&gt;:6443 K3S_TOKEN=&lt;&lt;token from k3s-nd1&gt;&gt; sh</span></pre><p id="47d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">非常重要的是要注意必须传递<code class="fe ms mt mu mj b">K3S_URL</code>和<code class="fe ms mt mu mj b">K3S_TOKEN</code>，否则脚本将在节点中有一个新的控制平面，而不是更新代理节点。</p><p id="012d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用于将代理节点更新到与主节点相同的版本，即“v1.22.5+k3s1”的示例命令将是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9bc2" class="mn lc in mj b gy mo mp l mq mr">curl -sfL <a class="ae kt" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | INSTALL_K3S_CHANNEL=stable INSTALL_K3S_VERSION=v1.22.5+k3s1 K3S_URL=https://192.168.64.22:6443 K3S_TOKEN=K10700a2d30d94e34c12f3a43cb7bea731d787a213fce3ace5913ec3c043ce896ae::server:1dfe37384fa47c28b1cc4a319f5dadf5 sh</span></pre><p id="9e2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过执行以下命令验证更新是否成功:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="83e2" class="mn lc in mj b gy mo mp l mq mr">multipass exec k3s-nd1 -- sudo kubectl get nodes</span></pre><p id="0e01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该会看到类似下面的内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c7cd" class="mn lc in mj b gy mo mp l mq mr">NAME      STATUS   ROLES                  AGE   VERSION<br/>k3s-nd1   Ready    control-plane,master   27m   v1.22.5+k3s1<br/>k3s-nd2   Ready    &lt;none&gt;                 16m   v1.22.5+k3s1</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="ff39" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">访问<code class="fe ms mt mu mj b">k3s</code> Kubernetes集群</h1><p id="0d93" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">虽然群集是在机器上创建的，但用户必须登录到承载控制面板的节点才能访问群集。对开发者不友好。</p><p id="d131" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们想通过简单地在终端上发出<code class="fe ms mt mu mj b">kubectl</code>命令来访问集群。</p><p id="0416" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">基于K3s的集群会将Kubernetes的配置保存在一个文件中，该文件位于承载控制平面的节点中的“/etc/rancher/k3s/k3s.yaml”位置。</p><p id="4952" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从我们的控制平面节点<code class="fe ms mt mu mj b">k3s-nd1</code>执行下面的命令来显示它的内容。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cf06" class="mn lc in mj b gy mo mp l mq mr">multipass exec k3s-nd1 -- sudo cat /etc/rancher/k3s/k3s.yaml</span></pre><p id="c9f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该文件的内容类似于下面的内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a65c" class="mn lc in mj b gy mo mp l mq mr">apiVersion: v1<br/>clusters:<br/>- cluster:<br/>    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyTkRFek1EZzVPVEl3SGhjTk1qSXdNVEEwTVRVd09UVXlXaGNOTXpJd01UQXlNVFV3T1RVeQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyTkRFek1EZzVPVEl3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTMTRsU0R3cDJWRXkvZjBjYVJqQTJzRnQxZ0p1UGhYV1o3Mi9EQWJMM1IKNmFieHZScG1Oa1VDSUFLcCtNU0dVVUZuL2RNRzV2UWlSOUczd2lnTk5vd1NvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVUNyQU5DeldKUVZ4T0IwYWloUzBiClJacy96bXd3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnTzl1VWhCTGVWUFhKMXg4Y0lBbFNpaEd2SXA2dkhRV1kKMFVUV2NaaENjcjRDSUhBQ1ZtY0dYeTRyTkswYnd4dFQ2Rld4SWhiVHlYMmloYzhGTW1RSFphTGkKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=<br/>    server: <a class="ae kt" href="https://127.0.0.1:6443" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:6443</a><br/>  name: default<br/>contexts:<br/>- context:<br/>    cluster: default<br/>    user: default<br/>  name: default<br/>current-context: default<br/>kind: Config<br/>preferences: {}<br/>users:<br/>- name: default<br/>  user:<br/>    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJR0MzMm12dFllZTR3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOalF4TXpBNE9Ua3lNQjRYRFRJeU1ERXdOREUxTURrMU1sb1hEVEl6TURFdwpOREUxTURrMU1sb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJCUFFjY293dkZqS0czRkkKR2VEektyMm9yeWxaR2IrcXNZcGRnM2NSSmR2SSs4bjA5aXpwUDZQcHQxRjZubjlvSmpORkdHZ1Fhd1prRXdCMQpCejJZU1RlalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCU09ScCtrcGNYaE1zZkJiWEZOcTgzZ3lDeUJ6VEFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQStaUGo3K1g1YlpUQ2pncU9aMHRZYWJ4dEpzejhkYjNkaTQvcU0wdDJEOUlDSUM5Q2lTb0ZQWnZmYXBVSQpXajdrQXpCWUd2YUNmNDNaZEFNY0RzUXRwNjA5Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyTkRFek1EZzVPVEl3SGhjTk1qSXdNVEEwTVRVd09UVXlXaGNOTXpJd01UQXlNVFV3T1RVeQpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyTkRFek1EZzVPVEl3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFUcHJTU0RSQVZjMDJuWG55dUJtcklpVndqN0ZYZGp0RGR6NFhYMEcwYmcKeWpEUU9hYXh2cFJ1L25Pd05iRXdNYVYyanJndGdCTEUrY2NTWXhvRWRhTk1vMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWprYWZwS1hGNFRMSHdXMXhUYXZOCjRNZ3NnYzB3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQU85Wk5OdGhkWkJYTTU4Q0EvNHg4TEI0RmVnZWxzMnUKS0JQOUsrdnhYTGZPQWlBbDlDclV2Qkwvd3hEVkc2a2JJK291MFhPbytxM2R0enBuTXkzbTRMS1Vsdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K<br/>    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUpLeDk4ejhmMzk4RlVncEppU3JRZ0swOHZHdEFIZkJGcG04YTB5NEF5UXZvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFRTlCeHlqQzhXTW9iY1VnWjRQTXF2YWl2S1ZrWnY2cXhpbDJEZHhFbDI4ajd5ZlQyTE9rLwpvK20zVVhxZWYyZ21NMFVZYUJCckJtUVRBSFVIUFpoSk53PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=</span></pre><p id="3959" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您需要更新位置<code class="fe ms mt mu mj b">~/.kube/config</code>处的Kubernetes配置文件，并为其添加一个新条目。</p><p id="525e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的示例<code class="fe ms mt mu mj b">~/.kube/config</code>文件包含来自上面的<code class="fe ms mt mu mj b">k3s.yaml</code>文件的内容，访问上下文在<code class="fe ms mt mu mj b">k3s</code>下声明。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6648" class="mn lc in mj b gy mo mp l mq mr">apiVersion: v1<br/>clusters:<br/>- cluster:<br/>    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyTkRFek1EZzVPVEl3SGhjTk1qSXdNVEEwTVRVd09UVXlXaGNOTXpJd01UQXlNVFV3T1RVeQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyTkRFek1EZzVPVEl3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTMTRsU0R3cDJWRXkvZjBjYVJqQTJzRnQxZ0p1UGhYV1o3Mi9EQWJMM1IKNmFieHZScG1Oa1VDSUFLcCtNU0dVVUZuL2RNRzV2UWlSOUczd2lnTk5vd1NvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVUNyQU5DeldKUVZ4T0IwYWloUzBiClJacy96bXd3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnTzl1VWhCTGVWUFhKMXg4Y0lBbFNpaEd2SXA2dkhRV1kKMFVUV2NaaENjcjRDSUhBQ1ZtY0dYeTRyTkswYnd4dFQ2Rld4SWhiVHlYMmloYzhGTW1RSFphTGkKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=<br/>    server: <a class="ae kt" href="https://192.168.64.22:6443" rel="noopener ugc nofollow" target="_blank">https://192.168.64.22:6443</a><br/>  name: k3s<br/>- cluster:<br/>    ......<br/>contexts:<br/>- context:<br/>    cluster: k3s<br/>    user: k3s<br/>  name: k3s<br/>- context:<br/>    ......<br/>......<br/>users:<br/>- name: k3s<br/>  user:<br/>    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJR0MzMm12dFllZTR3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOalF4TXpBNE9Ua3lNQjRYRFRJeU1ERXdOREUxTURrMU1sb1hEVEl6TURFdwpOREUxTURrMU1sb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJCUFFjY293dkZqS0czRkkKR2VEektyMm9yeWxaR2IrcXNZcGRnM2NSSmR2SSs4bjA5aXpwUDZQcHQxRjZubjlvSmpORkdHZ1Fhd1prRXdCMQpCejJZU1RlalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCU09ScCtrcGNYaE1zZkJiWEZOcTgzZ3lDeUJ6VEFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQStaUGo3K1g1YlpUQ2pncU9aMHRZYWJ4dEpzejhkYjNkaTQvcU0wdDJEOUlDSUM5Q2lTb0ZQWnZmYXBVSQpXajdrQXpCWUd2YUNmNDNaZEFNY0RzUXRwNjA5Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyTkRFek1EZzVPVEl3SGhjTk1qSXdNVEEwTVRVd09UVXlXaGNOTXpJd01UQXlNVFV3T1RVeQpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyTkRFek1EZzVPVEl3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFUcHJTU0RSQVZjMDJuWG55dUJtcklpVndqN0ZYZGp0RGR6NFhYMEcwYmcKeWpEUU9hYXh2cFJ1L25Pd05iRXdNYVYyanJndGdCTEUrY2NTWXhvRWRhTk1vMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWprYWZwS1hGNFRMSHdXMXhUYXZOCjRNZ3NnYzB3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQU85Wk5OdGhkWkJYTTU4Q0EvNHg4TEI0RmVnZWxzMnUKS0JQOUsrdnhYTGZPQWlBbDlDclV2Qkwvd3hEVkc2a2JJK291MFhPbytxM2R0enBuTXkzbTRMS1Vsdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K<br/>    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUpLeDk4ejhmMzk4RlVncEppU3JRZ0swOHZHdEFIZkJGcG04YTB5NEF5UXZvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFRTlCeHlqQzhXTW9iY1VnWjRQTXF2YWl2S1ZrWnY2cXhpbDJEZHhFbDI4ajd5ZlQyTE9rLwpvK20zVVhxZWYyZ21NMFVZYUJCckJtUVRBSFVIUFpoSk53PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=<br/>- name: yantra-prod-euwst1-gke-01<br/>  .......<br/>.......</span></pre><blockquote class="ng nh ni"><p id="d0ef" class="jv jw nj jx b jy jz ka kb kc kd ke kf nk kh ki kj nl kl km kn nm kp kq kr ks ig bi translated">编辑之前，不要忘记备份<code class="fe ms mt mu mj b">~/.kube/config</code>文件。如果文件构造不正确，将导致现有集群的访问被拒绝。</p></blockquote><p id="62f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在执行下面的命令来使用名为<code class="fe ms mt mu mj b">k3s</code>的集群:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="84dd" class="mn lc in mj b gy mo mp l mq mr">kubectl config set-context k3s</span></pre><p id="fd99" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将为在您的计算机上创建的k3s集群设置上下文，您执行了如下命令:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1bb1" class="mn lc in mj b gy mo mp l mq mr">kubectl cluster-info</span></pre><p id="90d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你！使用<code class="fe ms mt mu mj b">k3s</code>，您在本地机器上有一个工作集群。</p><p id="9a25" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">按照本文中的步骤，用户将作为Kubernetes集群管理员访问集群。开发可以，生产不行。我将撰写另一篇关于如何使用身份/认证服务器认证集群的文章。</p></div></div>    
</body>
</html>