<html>
<head>
<title>Parse CSV files as JSON objects in Azure Logic Apps and Power Automate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Azure Logic 应用程序和 Power Automate 中将 CSV 文件解析为 JSON 对象</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/parse-csv-files-as-json-objects-in-azure-logic-apps-and-power-automate-4d99d23306f7?source=collection_archive---------1-----------------------#2022-07-19">https://blog.devgenius.io/parse-csv-files-as-json-objects-in-azure-logic-apps-and-power-automate-4d99d23306f7?source=collection_archive---------1-----------------------#2022-07-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2958" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据最近的调查，Azure 是世界上第二受欢迎的云计算服务和环境。微软 Azure 提供的可用资源之一是逻辑应用。Azure Logic Apps 是一个基于云的平台，用于创建和管理自动化工作流，这是一系列定义在触发后执行的流程或任务的步骤。</p><p id="759f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您使用 Azure Logic 应用程序构建工作流时，您可以使用连接器来快速访问和转换数据。逻辑应用连接器基本上是一个 API 的包装器，底层服务使用它与 Azure 逻辑应用进行通信。在消费逻辑应用中，连接器根据定价级别分为标准连接器和企业连接器。</p><p id="f1f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">存储数据或配置表的一种流行方式是 CSV 文件。在 Azure Logic 应用中，虽然您可以获取/导入 CSV 文件，但没有本机内置连接器来解析/读取 CSV 文件。唯一可用的连接器需要进一步订阅，如 Encodian 和 Plumsail 文档。在本文中，我介绍了一种在 Azure Logic Apps 中解析任何 CSV 文件的本机方法，并将 Power Automate 作为 JSON 对象。对于本例，我将使用“使用路径获取文件内容”连接器从 SharePoint 读取一个 CSV 文件。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/b2616825e67231ac56143024d7aa557b.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*EZx5_WoWhpatAC--57FSCw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">用于演示的 CSV 文件</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="db08" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第一步</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/2e2fb59eeba4b0bb499dfc3930c6be75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*RnGSII4HpakeML3JpkBbDg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">SharePoint 连接器并为每一行拆分 CSV</figcaption></figure><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="420b" class="mg ld in mc b gy mh mi l mj mk">split(base64ToString(outputs('Get_file_content_using_path')?['body']?['$content']), decodeUriComponent('%0D%0A'))</span></pre><p id="8ef8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一步中，我们将 CSV 文件中每一新行的内容拆分成一个数组。</p><p id="5dab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">合成动作:</strong>使用这个动作设计一个云流。</p><p id="7859" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用的功能:</strong></p><p id="99aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> split </strong>:根据原始字符串中指定的分隔符，返回包含子字符串的数组，子字符串之间用逗号分隔。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="79bd" class="mg ld in mc b gy mh mi l mj mk">split('&lt;text&gt;', '&lt;delimiter&gt;')</span></pre><p id="e1e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">base64 字符串</strong>:返回 base64 编码字符串的字符串版本，有效地解码 base64 字符串。请使用此函数，而不要使用不推荐使用的<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/logic-apps/workflow-definition-language-functions-reference#decodeBase64" rel="noopener ugc nofollow" target="_blank"> decodeBase64() </a>。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="fb5e" class="mg ld in mc b gy mh mi l mj mk">base64ToString('&lt;value&gt;')</span></pre><p id="25e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> ['体']？['$content'] </strong>:通过 SharePoint 连接器返回文件主体的所有内容。</p><p id="b7a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> decodeUriComponent </strong>:返回一个字符串，用解码后的版本替换转义字符。%0D%0A 是 ANSI 编码文件用于其线闸的内容。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="a87d" class="mg ld in mc b gy mh mi l mj mk">decodeUriComponent('&lt;value&gt;')</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/1dde34a24cc35c219fb4d30a4326d6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*zbQ80qG-gngJ__j677OOgQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第一步输出</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="115a" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第二步</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/273a4bb81c13d1d5fe0664e408ff655b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*SyaEdLzO1caWmNCYa8W7wg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">为步骤 2 撰写操作</figcaption></figure><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="caad" class="mg ld in mc b gy mh mi l mj mk">take(outputs('splitByLines'),add(length(outputs('splitByLines')),<br/>-1))</span></pre><p id="c093" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一步中，我们将删除上一步生成的数组的最后一行。</p><p id="0be5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">编写动作</strong>:使用这个动作设计一个云流。</p><p id="1f6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用的功能</strong>:</p><p id="da13" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">拿走</strong>:从收藏的最前面退回物品。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="0f3d" class="mg ld in mc b gy mh mi l mj mk">take('&lt;collection&gt;', &lt;count&gt;)</span></pre><p id="13d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">相加</strong>:返回两个数相加的结果。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="ac6c" class="mg ld in mc b gy mh mi l mj mk">add(&lt;summand_1&gt;, &lt;summand_2&gt;)</span></pre><p id="8b48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> length </strong>:返回集合中的项目数。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="3c8c" class="mg ld in mc b gy mh mi l mj mk">length('&lt;collection&gt;')</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/bda4c03622ea16523104fe4b35b18cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*TBq4WCLMxSzh0zrCNSMcdg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第二步输出</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="dac3" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第三步</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/f8f1440662212d8024440daafc57551c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*YAznMepioif7l56bzVrBpg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">为步骤 3 撰写操作</figcaption></figure><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="55c0" class="mg ld in mc b gy mh mi l mj mk">split(first(outputs('splitByLines')), ',')</span></pre><p id="992d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一步中，我们在分隔符上拆分每一行，在这种情况下是逗号，然后获取数组的元素来检索 CSV 文件的标题或字段。</p><p id="1da4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">合成动作</strong>:使用这个动作设计一个云流。</p><p id="9d7d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用的功能</strong>:</p><p id="ede8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> first </strong>:返回字符串或数组的第一项。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="ad3b" class="mg ld in mc b gy mh mi l mj mk">first('&lt;collection&gt;')</span></pre><p id="6d05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> split </strong>:根据原始字符串中指定的分隔符，返回包含子字符串的数组，子字符串之间用逗号分隔。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="f83c" class="mg ld in mc b gy mh mi l mj mk">split('&lt;text&gt;', '&lt;delimiter&gt;')</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/c9b6aa54998114952426585cffb2513a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*r_xQeLg3eOPwwNUxLtJARQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第三步输出</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="e1e2" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第四步</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/3e97b05b8596372b4731a06919a80f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*Wa88UNp-7_a5i79M9IID_A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">为步骤 4 选择操作</figcaption></figure><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="9df1" class="mg ld in mc b gy mh mi l mj mk">From:</span><span id="3810" class="mg ld in mc b gy mq mi l mj mk">skip(outputs('removedLastLine'), 1)</span><span id="e70c" class="mg ld in mc b gy mq mi l mj mk">Map:</span><span id="2377" class="mg ld in mc b gy mq mi l mj mk">outputs('fieldNames')[0]   ||||||||||||   split(item(), ',')?[0]</span><span id="9d51" class="mg ld in mc b gy mq mi l mj mk">outputs('fieldNames')[1]   ||||||||||||   split(item(), ',')?[1]</span></pre><p id="4128" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一步中，我们正在转换前面数组的形状，因此我们用相应的值(key-value)映射每个头。</p><p id="0430" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">选择动作</strong>:使用该动作变换数组中对象的形状。例如，您可以添加、移除或重命名数组中每个对象的元素。</p><p id="cb2d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">使用的功能</strong>:</p><p id="3cc4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> split </strong>:根据原始字符串中指定的分隔符，返回包含子字符串的数组，子字符串之间用逗号分隔。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="08e8" class="mg ld in mc b gy mh mi l mj mk">split('&lt;text&gt;', '&lt;delimiter&gt;')</span></pre><p id="2dd8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">跳过</strong>:移除收藏前面的物品，返回<em class="mr">所有其他</em>物品。</p><pre class="kk kl km kn gt mb mc md me aw mf bi"><span id="23ad" class="mg ld in mc b gy mh mi l mj mk">skip([&lt;collection&gt;], &lt;count&gt;)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/d6a2605b962ca43ef972645d489932a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*B11kLcQMaLqFiGTjELXGEA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第四步输出</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h1 id="7c27" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第五步</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a548461916e6a6cbc3b453e4295b8201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*Zmwaa0vwIoojfU9bX1ScaA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">解析步骤 5 的 JSON 操作</figcaption></figure><p id="dd85" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一步中，我们解析步骤 4 中的数组，并将其转换成 JSON。为了获得 JSON 的模式，执行从步骤 1 到步骤 4 的工作流，并使用示例 JSON 输出来生成该步骤的模式。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/52e636a1455e1b486f7fa42f81e02e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ZwBRovJ7MFRcFo7aaAPW7w.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第五步输出</figcaption></figure></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="5b88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参考资料:</p><p id="fb16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Microsoft Logic Apps 函数文档:<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/logic-apps/workflow-definition-language-functions-reference" rel="noopener ugc nofollow" target="_blank">表达式函数参考指南—Azure Logic Apps | Microsoft Docs</a></p><p id="aa83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Power Automate 的数据操作:<a class="ae ki" href="https://docs.microsoft.com/en-us/power-automate/data-operations" rel="noopener ugc nofollow" target="_blank">使用 Power Automate(包含视频)中的数据操作—Power Automate | Microsoft Docs</a></p><p id="bce8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">CSV 文件解析的类似教程:<a class="ae ki" href="https://www.youtube.com/watch?v=rNTEOk0cq4k" rel="noopener ugc nofollow" target="_blank">如何在 Microsoft Power Automate Flow for Azure Logic Apps 中解析/读取 CSV 文件— YouTube </a></p></div></div>    
</body>
</html>