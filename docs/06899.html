<html>
<head>
<title>Spring Cloud Gateway — Securing Services with API Key</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring 云网关——使用 API 密钥保护服务</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/spring-cloud-gateway-securing-services-with-api-key-9c39836fc097?source=collection_archive---------0-----------------------#2022-02-10">https://blog.devgenius.io/spring-cloud-gateway-securing-services-with-api-key-9c39836fc097?source=collection_archive---------0-----------------------#2022-02-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cbc3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个故事中，我将探索如何使用 Spring Cloud Gateway 用 API 密钥实现 API 安全性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/27528d3688a9475c57c77bfc69b4f20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hvoykilQoOMeB4Nv"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">尼古拉斯·皮卡德在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="37f4" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">概观</h1><p id="dbf9" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在微服务架构中，不同 API 服务之间数据传递的安全性变得至关重要。因此，为了提高这些服务之间不同交换的安全性，设置几个级别是很重要的。</p><p id="7478" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是为什么基于<a class="ae ky" href="https://martinfowler.com/articles/richardsonMaturityModel.html" rel="noopener ugc nofollow" target="_blank">理查森成熟度模型</a>的 API 安全模型，描述了安全级别不断增加的 API 安全性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/145b9b3405ebee2f725240a9ebda148b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CjI38gufGZB6PfH8.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">API 安全成熟度模型</figcaption></figure><p id="857a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个模型中，每一级的安全性和信任度都在不断提高。它有四个级别:</p><ul class=""><li id="5c17" class="md me in jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">0 级:<strong class="jm io"> API 密钥和基本认证</strong></li><li id="8f8a" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">第 1 级:<strong class="jm io">基于令牌的认证</strong></li><li id="28fb" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">第 2 级:<strong class="jm io">基于令牌的授权</strong></li><li id="f277" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">第三级:<strong class="jm io">集中信托使用债权</strong></li></ul><p id="e0f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个故事中，我们将关注通过 Spring Cloud Gateway 实现的 0 级(API Keys)。</p><p id="0533" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Spring Cloud Gateway 为在 Spring 和 Java 之上构建 API 网关提供了一个库。它提供了一种基于大量标准的灵活的请求路由方式，并关注安全性、弹性和监控等跨领域问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/ecb72506aa9b3037e9c22e49f621fe70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tcLV9-Rz3F__pk0BF1DMRw.png"/></div></div></figure><p id="d065" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据上面的体系结构，对服务(A 或 B)的访问将取决于对密钥的验证，该密钥将在请求的报头中发送。</p><h1 id="d304" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">项目设置</h1><p id="e877" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">从<a class="ae ky" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> start.spring.io </a>创建一个简单的 Spring Boot 项目，包含以下依赖项:Lombok、spring cloud gateway、spring data redis。</p><h2 id="753b" class="ms la in bd lb mt mu dn lf mv mw dp lj jv mx my ln jz mz na lr kd nb nc lv nd bi translated">项目结构</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/37200ce149f9ccc004030900513c6dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*S0ZOi7BlQfQeH5ShdJctww.png"/></div></figure><p id="f5db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的架构包含三个主要的包:c <em class="nf">配置</em>，<em class="nf">过滤器</em>，<em class="nf">域</em></p><p id="9b31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为 API 网关中定义的每个路由执行全局过滤器。在我们的例子中，我们将创建一个定制的预过滤器。这个过滤器代码在 Spring Cloud Gateway 将请求路由到目的地 web 服务端点之前执行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1695" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于客户端发出的每个调用，redis 都会进行检查，以确认客户端有权使用所请求的服务。</p><p id="26dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们有了一个自定义路由配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="386f" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">测试</h1><p id="f321" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我们可以运行我们的网关和服务。</p><ul class=""><li id="0947" class="md me in jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">当客户端未被授权使用其 api 密钥消费服务时</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/623a22aa0a57032294a1ad48e5944d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NItdC3iCGuvs9AtyRYxtXA.png"/></div></div></figure><ul class=""><li id="c89d" class="md me in jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">当客户被授权消费服务时</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/bfe783b79d6d0c95f54f55bd34365308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3rddcSNFRw82glwiNCytg.png"/></div></div></figure><h1 id="f1bd" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">摘要</h1><p id="bf57" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在大型解决方案中使用时，有必要使用现有的 API 网关解决方案，这些解决方案提供已经实现的安全服务，如<a class="ae ky" href="https://github.com/Kong/kong" rel="noopener ugc nofollow" target="_blank">孔 API 网关</a>、<a class="ae ky" href="https://github.com/TykTechnologies/tyk" rel="noopener ugc nofollow" target="_blank"> Tyk </a>等。</p><p id="d68c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所有源代码都可以在<a class="ae ky" href="https://github.com/anicetkeric/gateway-api-key.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="1c9a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参考</p><ul class=""><li id="0ea7" class="md me in jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated"><a class="ae ky" href="https://curity.io/resources/learn/the-api-security-maturity-model/" rel="noopener ugc nofollow" target="_blank">https://curity . io/resources/learn/the-API-security-maturity-model/</a></li><li id="73c0" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated"><a class="ae ky" href="https://nordicapis.com/introducing-the-api-security-maturity-model/" rel="noopener ugc nofollow" target="_blank">https://nordicapis . com/introducing-the-API-security-maturity-model/</a></li></ul></div></div>    
</body>
</html>