<html>
<head>
<title>Update React Query Cache with the setQueryData Method</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用setQueryData方法更新React查询缓存</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/update-react-query-cache-with-the-setquerydata-method-95533be3c407?source=collection_archive---------4-----------------------#2021-07-01">https://blog.devgenius.io/update-react-query-cache-with-the-setquerydata-method-95533be3c407?source=collection_archive---------4-----------------------#2021-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eeba9d840338806d164ed679e71372db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LKZCzB3hd7axuwlV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">莎伦·麦卡琴在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d97d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能希望更新React查询缓存，以便在客户端更新用于呈现HTML的数据，从而显示最新的数据，而无需再次从服务器获取数据。</p><p id="0759" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query的<code class="fe lb lc ld le b">setQueryData</code>方法在客户端更新查询缓存数据。</p><h1 id="13d1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用setQueryData方法更新发出请求时缓存的数据</h1><p id="c14e" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用React查询的<code class="fe lb lc ld le b">queryClient</code>的<code class="fe lb lc ld le b">setQueryData</code>方法来更新来自HTTP请求的缓存响应数据。</p><p id="3db7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="d554" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">index.js</code></p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="3a1d" class="mq lg iq le b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";</span><span id="1479" class="mq lg iq le b gy mv ms l mt mu">import App from "./App";<br/>export const queryClient = new QueryClient();</span><span id="bf3b" class="mq lg iq le b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;StrictMode&gt;<br/>    &lt;QueryClientProvider client={queryClient}&gt;<br/>      &lt;App /&gt;<br/>    &lt;/QueryClientProvider&gt;<br/>  &lt;/StrictMode&gt;,<br/>  rootElement<br/>);</span></pre><p id="05fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">App.js</code></p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="8248" class="mq lg iq le b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>import { queryClient } from "./index";</span><span id="5c6f" class="mq lg iq le b gy mv ms l mt mu">export default function App() {<br/>  const { data } = useQuery("yesno", () =&gt; axios.get("https://yesno.wtf/api"));</span><span id="b6be" class="mq lg iq le b gy mv ms l mt mu">const setData = () =&gt; {<br/>    queryClient.setQueryData("yesno", (data) =&gt; {<br/>      return {<br/>        data: {<br/>          ...data.data,<br/>          answer: data.data.answer === "yes" ? "no" : "yes"<br/>        }<br/>      };<br/>    });<br/>  };</span><span id="1528" class="mq lg iq le b gy mv ms l mt mu">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={setData}&gt;toggle&lt;/button&gt;<br/>      &lt;div&gt;{data?.data?.answer}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="a078" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lb lc ld le b">index.js</code>中，我们创建了一个与<code class="fe lb lc ld le b">QueryClientProvider</code>组件一起使用的新的<code class="fe lb lc ld le b">QueryClient</code>实例，这样我们就可以使用React查询钩子来发出请求。</p><p id="50c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">App.js</code>中，我们使用<code class="fe lb lc ld le b">useQuery</code>钩子来发出请求。</p><p id="5299" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将查询的名称作为第一个参数传入。</p><p id="d268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是一个函数，它通过HTTP请求响应返回一个承诺。</p><p id="2130" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回对象的<code class="fe lb lc ld le b">data</code>属性有响应数据。</p><p id="e969" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lb lc ld le b">setData</code>函数中，我们用传递给<code class="fe lb lc ld le b">useQuery</code>第一个参数的我们想要更新的请求的标识符来调用<code class="fe lb lc ld le b">queryClient.setQueryData</code>。</p><p id="efe0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是一个回调，它使用第一个参数中的标识符获取请求的缓存响应数据，我们返回的对象将是使用给定标识符缓存的项目的新值。</p><p id="124b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe lb lc ld le b">setData</code>中的响应切换<code class="fe lb lc ld le b">data.data.answer</code>的值。</p><p id="1377" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们点击切换按钮时，我们称之为。</p><p id="6f2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，当我们点击切换按钮时，我们应该看到<code class="fe lb lc ld le b">data.data.answer</code>值在<code class="fe lb lc ld le b">'yes'</code>和<code class="fe lb lc ld le b">'no'</code>之间切换。</p><p id="d11c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为我们用传入第一个参数<code class="fe lb lc ld le b">sertQueryData</code>的标识符来更新请求的查询缓存数据条目，这是我们在客户端想要的。</p><h1 id="5350" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="216b" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用React Query的查询客户端的<code class="fe lb lc ld le b">setQueryData</code>方法在客户端更新缓存的响应数据。</p></div></div>    
</body>
</html>