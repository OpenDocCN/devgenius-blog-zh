<html>
<head>
<title>PHP — P77: Basics of File Uploading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP — P77:文件上传基础</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/php-p77-basics-of-file-uploading-ba377da3d072?source=collection_archive---------14-----------------------#2022-10-19">https://blog.devgenius.io/php-p77-basics-of-file-uploading-ba377da3d072?source=collection_archive---------14-----------------------#2022-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dc1ac716f821491258926545cc3e1d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBzuCQbXINM6ivQ9SxsiIQ.jpeg"/></div></div></figure><p id="8bee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PHP 初学者最容易误解的话题之一。有人如何上传文件？当你点击上传时会发生什么？它通向哪里？让我们揭开这个过程的神秘面纱，用 PHP 处理文件。比你想象的简单。</p><h1 id="8136" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">配置</h1><p id="4383" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您使用代码示例附带的 docker 容器，那么首先需要做一件事，那就是更改权限。我们在这里要做的事情并不建议在您的生产服务器上使用，但是它确实为我们提供了一种快速简单的方法来上传文件。</p><div class="lz ma gp gr mb mc"><a href="https://github.com/dinocajic/php-youtube-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">GitHub-dinocajic/PHP-YouTube-tutorials:PHP YouTube 教程的代码</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">PHP YouTube 教程的代码确保你已经安装了 Docker。克隆回购。运行以下命令…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">github.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq jw mc"/></div></div></a></div><p id="b3bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像平常一样运行 docker 命令来启动 docker 容器。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="5e5b" class="na kx iq mw b gy nb nc l nd ne">docker run -i -t -p "80:80" -v ${PWD}/app:/app -v ${PWD}/mysql:/var/lib/mysql mattrayner/lamp:latest</span></pre><p id="7b6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开 Docker Dashboard 并点击您刚刚启动的 Docker 容器。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/d75ef6613cc7710bb01bd3b3c33c408b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mZaRWK_dW6Dm72iUaa4o6Q.png"/></div></div></figure><p id="6a5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击 CLI 按钮打开终端。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/a957ebfef79f36d0afc4c4c36eaf9636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBptoDfJ0w76Da1UJADv1w.png"/></div></div></figure><p id="1b5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">导航到<code class="fe nh ni nj mw b">var/www</code>文件夹:<code class="fe nh ni nj mw b">cd var/www</code></p><p id="02cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">执行<code class="fe nh ni nj mw b">chmod</code>功能:<code class="fe nh ni nj mw b">chmod -R 777 html</code></p><p id="afc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以将文件上传到该目录。</p><h1 id="6909" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">HTML 表单</h1><p id="92c1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">是时候创建我们的表单了。这是用户将与之交互的表单。您已经看到了文件选择器按钮，它允许用户选择一个文件，然后单击上传按钮来处理上传。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="101a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">表单本身有几个需要分析的地方。</p><ul class=""><li id="88a3" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated">有一种新型的<code class="fe nh ni nj mw b">input type</code>，那就是<code class="fe nh ni nj mw b">file</code>。谁能想到呢。这就是给我们的按钮，当点击时，允许我们浏览我们的计算机上的文件。</li></ul><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/84d8ad758f3b2bcbbf2812c0a4382168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_H3TQMSWq8jmlF9Dkb52NA.png"/></div></div></figure><ul class=""><li id="7b16" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">method</code>仍然设置为<code class="fe nh ni nj mw b">post</code>，我们将创建一个<code class="fe nh ni nj mw b">upload.php</code>文件来处理我们的文件上传。</li><li id="8a5f" class="nm nn iq ka b kb nw kf nx kj ny kn nz kr oa kv nr ns nt nu bi translated">另外增加的是<code class="fe nh ni nj mw b">enctype=”multipart/form-data”</code>。这告诉 PHP 我们将要上传文件。如果省略<code class="fe nh ni nj mw b">enctype</code>，文件上传将无法进行。</li></ul><p id="efec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止很简单。接下来让我们创建我们的<code class="fe nh ni nj mw b">upload.php</code>文件，这将允许文件被上传。</p><h1 id="541e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">正在处理文件上传</h1><p id="6454" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您还记得我们以前的文章，我们提到过<code class="fe nh ni nj mw b">$_FILES</code>预定义变量。让我们通过将内容转储到我们的<code class="fe nh ni nj mw b">uploads.php </code>文件中来看看当我们单击 submit 时它包含了什么。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2fa2" class="na kx iq mw b gy nb nc l nd ne">var_dump($_FILES);</span><span id="3102" class="na kx iq mw b gy ob nc l nd ne"><strong class="mw ir">array</strong> <em class="oc">(size=1)</em><br/>  'file_name' =&gt; <br/>    <strong class="mw ir">array</strong> <em class="oc">(size=5)</em><br/>      'name' =&gt; string '75-Get-vs-Post.jpg' <em class="oc">(length=18)</em><br/>      'type' =&gt; string 'image/jpeg' <em class="oc">(length=10)</em><br/>      'tmp_name' =&gt; string '/tmp/phpFMpvdR' <em class="oc">(length=14)</em><br/>      'error' =&gt; int 0<br/>      'size' =&gt; int 133821</span></pre><p id="173f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击提交后，我们看到<code class="fe nh ni nj mw b">$_FILES</code>只是一个数据数组。它用我们的<code class="fe nh ni nj mw b">input name="file_name"</code>创建了一个名为<code class="fe nh ni nj mw b">file_name</code>的密钥。该键获得一个数据数组:<code class="fe nh ni nj mw b">name, type, tmp_name, error, size</code>。所以如果你<code class="fe nh ni nj mw b">echo $_FILES['file_name']['name']</code>你就会得到<code class="fe nh ni nj mw b">75-Get-vs-Post.jpg</code>。</p><ul class=""><li id="757e" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">name</code>给出了您刚刚上传的文件的原始名称。</li><li id="995d" class="nm nn iq ka b kb nw kf nx kj ny kn nz kr oa kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">type</code>给出了文件类型。在这种情况下，我上传了一个图像，所以它知道这是一个图像，并存储其类型。</li><li id="e4ab" class="nm nn iq ka b kb nw kf nx kj ny kn nz kr oa kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">tmp_name</code>是人们迷路的地方。我的文件放在哪里？嗯，在这种情况下，它进入<code class="fe nh ni nj mw b">/tmp</code>目录。它还会获得一个随机的临时名称<code class="fe nh ni nj mw b">phpFMpvdR</code>。这很重要，因为我们以后必须将这个文件移动到一个可访问的目录中。</li><li id="9ce7" class="nm nn iq ka b kb nw kf nx kj ny kn nz kr oa kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">error</code>将返回一个布尔值:如果没有错误，返回<code class="fe nh ni nj mw b">0</code>，如果有错误，返回<code class="fe nh ni nj mw b">1</code>。</li><li id="9c6a" class="nm nn iq ka b kb nw kf nx kj ny kn nz kr oa kv nr ns nt nu bi translated"><code class="fe nh ni nj mw b">size</code>给出图像的大小。这是<code class="fe nh ni nj mw b">bytes</code>中的尺寸。</li></ul><p id="1cc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经有了上传文件所需的所有数据。我们可以用一行代码做到这一点，但是为了可读性，我们将它分成 3 行代码。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4593" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有一个临时文件位置。我们需要将它移动到我们当前的目录中，并希望它与我们原来的文件名完全相同。我们使用<code class="fe nh ni nj mw b">move_uploaded_file</code>函数将文件从临时位置移动到当前目录。去你的目录，你会在那里看到它。</p><p id="2e2c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想把它移到像<code class="fe nh ni nj mw b">uploads/</code>这样的子目录中呢？我们只需要创建目录并把它附加到我们的<code class="fe nh ni nj mw b">target_file</code>名中。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="0e05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和成功。我们的文件现在被上传到我们的<code class="fe nh ni nj mw b">uploads</code>子目录中。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="4ff6" class="na kx iq mw b gy nb nc l nd ne">var/<br/>   www/<br/>      html/<br/>         76-file-uploads/<br/>            index.html<br/>            upload.php<br/>            uploads/<br/>                some-image.jpg</span></pre><h1 id="3645" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h1><p id="6c37" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">说到上传文件就是这样。其他一切都只是错误处理和验证。例如，当文件太大时会发生什么？如何限制用户只能上传 PDF？接下来我们将看看更高级的表单处理。你不应该让你的文件处理暴露在外。</p><div class="lz ma gp gr mb mc"><a href="https://github.com/dinocajic/php-youtube-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">GitHub-dinocajic/PHP-YouTube-tutorials:PHP YouTube 教程的代码</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">PHP YouTube 教程的代码确保你已经安装了 Docker。克隆回购。运行以下命令…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">github.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq jw mc"/></div></div></a></div></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/bcd293369e904b4bc9f6c31a07a003db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eVc9S6cR2r5tbDIz.jpeg"/></div></figure><p id="7e0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡伊奇目前是<a class="ae ol" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(生命周期生物科学公司)</a>、<a class="ae ol" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae ol" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae ol" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物</a>、<a class="ae ol" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae ol" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="a21b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae ol" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae ol" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae ol" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体出版物</a>。</p><p id="720b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ol" href="https://dinocajic.medium.com/membership" rel="noopener"> <em class="oc">阅读迪诺·卡吉克(以及媒体上成千上万其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。</em> </a></p></div></div>    
</body>
</html>