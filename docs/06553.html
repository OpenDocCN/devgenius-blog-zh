<html>
<head>
<title>Ingesting Reddit memes into Elasticsearch using node.js: Locally and on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用node.js将Reddit迷因吸收到Elasticsearch中:本地和谷歌云</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ingesting-reddit-memes-into-elasticsearch-using-node-js-locally-and-on-google-cloud-d9ec61ccba95?source=collection_archive---------8-----------------------#2022-01-16">https://blog.devgenius.io/ingesting-reddit-memes-into-elasticsearch-using-node-js-locally-and-on-google-cloud-d9ec61ccba95?source=collection_archive---------8-----------------------#2022-01-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0e09f448c66bce48483fa95365a6b7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nD6dbSJh5DLE0EVysqy5OA.png"/></div></div></figure><p id="151c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是一个相对较新的开源搜索引擎，世界上任何人都可以使用！它速度惊人，而且是用java编写的！它使用<code class="fe kt ku kv kw b">JSON</code>格式来存储可以通过各种<code class="fe kt ku kv kw b">HTTP</code>方法访问的数据。这项服务也是可扩展的，是大型科技公司的完美选择。目前，像优步、网飞、Slack和微软这样的公司使用<code class="fe kt ku kv kw b">Elasticsearch</code>将搜索功能集成到他们的产品中。<code class="fe kt ku kv kw b">Elasticsearch</code>最近改变了它的开源许可，导致亚马逊发布了<code class="fe kt ku kv kw b">OpenSearch</code>，一个通过分叉<code class="fe kt ku kv kw b">Elasticsearch</code>创建的搜索引擎。</p><p id="aa81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe kt ku kv kw b">Elasticsearch</code>使用一个叫做<code class="fe kt ku kv kw b">index</code>的东西来存储所有的信息。引用文件-</p><blockquote class="kx ky kz"><p id="3a45" class="jv jw la jx b jy jz ka kb kc kd ke kf lb kh ki kj lc kl km kn ld kp kq kr ks ig bi translated">索引就像关系数据库中的“数据库”。它有一个定义多种类型的映射。</p><p id="9abe" class="jv jw la jx b jy jz ka kb kc kd ke kf lb kh ki kj lc kl km kn ld kp kq kr ks ig bi translated">最简单、最熟悉的布局复制了您对关系数据库的期望。你可以(非常粗略地)把索引想象成一个数据库。</p><p id="ea75" class="jv jw la jx b jy jz ka kb kc kd ke kf lb kh ki kj lc kl km kn ld kp kq kr ks ig bi translated">MySQL = &gt; Databases = &gt; Tables = &gt; Columns/Rows<br/>elastic search =&gt;indexes =&gt;Types =&gt;带属性的文档</p><p id="cede" class="jv jw la jx b jy jz ka kb kc kd ke kf lb kh ki kj lc kl km kn ld kp kq kr ks ig bi translated">一个Elasticsearch集群可以包含多个索引(数据库)，而索引又包含多个类型(表)。这些类型包含多个文档(行)，每个文档都有属性(列)。</p></blockquote><p id="a86c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">总结文档，我们需要一个<code class="fe kt ku kv kw b">index</code>在<code class="fe kt ku kv kw b">Elasticsearch</code>中存储任何类型的数据。可以有多个<code class="fe kt ku kv kw b">indeces</code>，然后可以存储不同的数据。</p><p id="cd0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，<code class="fe kt ku kv kw b">Elasticsearch</code>还附带了一系列与其无缝集成的其他产品。这个家族的最初成员是<code class="fe kt ku kv kw b">Logstash</code>和<code class="fe kt ku kv kw b">Kibana</code>，他们一起创造了著名的<code class="fe kt ku kv kw b">ELK</code>栈！</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi le"><img src="../Images/03629079f7c79c4989d82a30ef94538c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/0*LaU4LXMBasjVhmFW.png"/></div></figure><p id="ba2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2015年，<code class="fe kt ku kv kw b">Elastic</code>想出了一个新的家族成员，叫做<code class="fe kt ku kv kw b">Beats</code>，但遗憾的是，这个新栈没有正式名称:(本文我们不会涉及这些家族成员，但我们可能会在最后触及<code class="fe kt ku kv kw b">kibana</code>；)</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h1 id="ecf3" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">启动弹性搜索(局部)</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/94351b7c89881be22edc37df8f853e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/0*7dwP5sAGpE5Yonyh.jpg"/></div></figure><p id="6550" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们从本地启动<code class="fe kt ku kv kw b">Elasticsearch</code>开始，使用我们经典的命令提示符-</p><ol class=""><li id="1c0a" class="mp mq in jx b jy jz kc kd kg mr kk ms ko mt ks mu mv mw mx bi translated">如果你还没有从<a class="ae my" href="https://www.elastic.co/downloads/elasticsearch" rel="noopener ugc nofollow" target="_blank">这里安装<code class="fe kt ku kv kw b">Elasticsearch</code></a>。</li><li id="8928" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">导航到下载的文件，如果需要，将其解压缩。</li><li id="896c" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">在下载的文件中打开命令提示符或终端，运行<code class="fe kt ku kv kw b">bin/elasticsearch</code>启动<code class="fe kt ku kv kw b">Elasticsearch</code>服务。</li></ol><p id="51d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该服务将在<code class="fe kt ku kv kw b"><a class="ae my" href="http://localhost:9200/" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/</a></code>或您的命令提示符/终端中提到的端口上开始运行！</p><h1 id="06eb" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">新的node.js项目</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/8fce28b1ed1a085c3708f16d5d2ccc8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*98WUyZT7fRL1-3oc.jpg"/></div></figure><p id="7ba4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在可以创建一个新的<code class="fe kt ku kv kw b">node.js</code>项目来编码我们的服务器-</p><ol class=""><li id="da67" class="mp mq in jx b jy jz kc kd kg mr kk ms ko mt ks mu mv mw mx bi translated">创建一个新的空文件夹。我将把它命名为<code class="fe kt ku kv kw b">node_elastic</code>。</li><li id="cba9" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">运行<code class="fe kt ku kv kw b">npm init</code>并选择您的配置。我将把我的<code class="fe kt ku kv kw b">entry point</code>设为<code class="fe kt ku kv kw b">server.js</code>，而不是默认的<code class="fe kt ku kv kw b">index.js</code>。</li><li id="3e96" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">这将在当前目录下创建一个<code class="fe kt ku kv kw b">package.json</code>文件。在我的例子中，<code class="fe kt ku kv kw b">package.json</code>文件看起来像这样</li></ol><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="06b4" class="no lr in kw b gy np nq l nr ns">{<br/>  "name": "node_elastic",<br/>  "version": "1.0.0",<br/>  "description": "Scraping and ingesting Reddit memes into Elasticsearch using node.js",<br/>  "main": "server.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "author": "Saransh-cpp",<br/>  "license": "ISC"<br/>}</span></pre><p id="cfa8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为最后一步，让我们添加一个新的<code class="fe kt ku kv kw b">script</code>来使开发过程更加顺利</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="7cf9" class="no lr in kw b gy np nq l nr ns">"start": "node server.js"</span></pre><p id="c39b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完整的<code class="fe kt ku kv kw b">json</code>文件现在——</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="15d2" class="no lr in kw b gy np nq l nr ns">{<br/>  "name": "node_elastic",<br/>  "version": "1.0.0",<br/>  "description": "Scraping and ingesting Reddit memes into Elasticsearch using node.js",<br/>  "main": "server.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",<br/>    "start": "node server.js"<br/>  },<br/>  "author": "Saransh-cpp",<br/>  "license": "ISC"<br/>}</span></pre><h1 id="a911" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">创建弹性搜索客户端</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/6dfc0c9dbd32b1a041900d8662e41872.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/0*1mNxPsWy-er1XbeD.jpg"/></div></figure><p id="d44e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用名为<code class="fe kt ku kv kw b">elasticsearch</code>的<code class="fe kt ku kv kw b">javascript</code>库与我们的本地部署<code class="fe kt ku kv kw b">Elasticsearch</code>进行交互。让我们将它安装在我们的工作目录中-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="ce76" class="no lr in kw b gy np nq l nr ns">npm i elasticsearch</span></pre><p id="1f9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以创建一个<code class="fe kt ku kv kw b">Client</code>对象，通过它我们将能够访问各种<code class="fe kt ku kv kw b">HTTP</code>方法。在这里，我创建了一个名为<code class="fe kt ku kv kw b">client_local.js</code>的新的<code class="fe kt ku kv kw b">javascript</code>文件(如果您的部署在不同的端口号上，请替换<code class="fe kt ku kv kw b">"host"</code>值)</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="9240" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">创建索引</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/3423d035578bc0fda57f04809e5ebb36.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*w1cAPYoLH2pmJAFL.jpg"/></div></figure><p id="0004" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在可以使用上面创建的<code class="fe kt ku kv kw b">client</code>来创建一个索引。让我们编写一个新文件<code class="fe kt ku kv kw b">create.js</code></p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="42b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<code class="fe kt ku kv kw b">node create.js</code>运行上面编码的文件应该会在<code class="fe kt ku kv kw b">Elasticsearch</code>的本地部署中创建一个新的<code class="fe kt ku kv kw b">index</code>，并且不会给出任何输出。如果第一次运行代码时出现错误，那么您的部署可能不正确，或者您可能已经关闭了本地部署。再次运行该文件应该会给出一个错误消息</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="4288" class="no lr in kw b gy np nq l nr ns">index [memes/&lt;index_uuid&gt;] already exists</span></pre><p id="fd7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这证实了我们的索引已经创建！您也可以通过简单地将<code class="fe kt ku kv kw b">create.js</code>文件中的<code class="fe kt ku kv kw b">create</code>替换为<code class="fe kt ku kv kw b">delete</code>来删除创建的索引。</p><h1 id="0e5e" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">从Reddit获取迷因</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/2b76f5ef5d439184b7172ca181166809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BjS1WXBwOzn2BcGo.jpeg"/></div></div></figure><p id="31ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在将我们的迷因数据吸收到<code class="fe kt ku kv kw b">Elasticsearch</code>之前，我们实际上需要一些数据。让我们通过Reddit的开放API和另一个名为<code class="fe kt ku kv kw b">axios</code>的<code class="fe kt ku kv kw b">javascript</code>库获取一个迷因的URL。让我们快速安装库-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="a0b8" class="no lr in kw b gy np nq l nr ns">npm i axios</span></pre><p id="d0ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将通过URL — <code class="fe kt ku kv kw b"><a class="ae my" href="https://reddit.com/r/memes.json." rel="noopener ugc nofollow" target="_blank">https://reddit.com/r/memes.json</a></code> <a class="ae my" href="https://reddit.com/r/memes.json." rel="noopener ugc nofollow" target="_blank">向Reddit的<code class="fe kt ku kv kw b">meme</code>子编辑发送一个<code class="fe kt ku kv kw b">http</code> <code class="fe kt ku kv kw b">get</code>请求。</a>在深入研究(你可以使用任何流行的chrome扩展来美化<code class="fe kt ku kv kw b">json</code>)这个网址上显示的大量<code class="fe kt ku kv kw b">json</code>之后，我发现一个meme的网址出现在-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="312b" class="no lr in kw b gy np nq l nr ns">["data"]["children"][num]["data"]["url_overridden_by_dest"]</span></pre><p id="d554" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">迷因的名称出现在-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="741f" class="no lr in kw b gy np nq l nr ns">["data"]["children"][num]["data"]["title"]</span></pre><p id="a338" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">其中<code class="fe kt ku kv kw b">num</code>是小于所显示的迷因的最大数量的任何正整数。我们现在可以创建一个新的<code class="fe kt ku kv kw b">js</code>文件来抓取meme的URL和标题-</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="421c" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">将我们的数据纳入Elasticsearch</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/3d500d62c2ad9c49e8a928d6b7291867.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*wnNOqwYdhf4EZ3x5.jpg"/></div></figure><p id="4db2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将上面编码的所有内容组合起来创建<code class="fe kt ku kv kw b">server.js</code>，它将把搜集到的meme数据吸收到我们本地部署的<code class="fe kt ku kv kw b">Elasticsearch</code>中。我们将抓取100个这样的URL和标题，并将它们存储在索引<code class="fe kt ku kv kw b">memes</code>(我们在上面创建的)。</p><p id="9e7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以使用客户端的<code class="fe kt ku kv kw b">index</code>方法将数据追加到关联的<code class="fe kt ku kv kw b">index</code>中</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="660d" class="no lr in kw b gy np nq l nr ns">client.index({  <br/>     index: 'memes',<br/>     body: {<br/>         url: memeURL,<br/>         title: memeTitle<br/>     }<br/>}, (err, resp, status) =&gt; {<br/>     console.log(resp);<br/>});</span></pre><p id="f39c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在代码中，我还将在接收发生之前清除(使用<code class="fe kt ku kv kw b">deleteByQuery</code>并将<code class="fe kt ku kv kw b">match_all</code>设置为<code class="fe kt ku kv kw b">{}</code>)索引，以确保我们没有存储任何旧数据。</p><p id="236d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最终代码(<code class="fe kt ku kv kw b">limit</code>在URL中查询的是我们想要的模因数)—</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1c13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你还记得，我们在创建<code class="fe kt ku kv kw b">npm</code>项目的时候创建了一个<code class="fe kt ku kv kw b">“start”</code>脚本。让我们用它来运行我们的服务器-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="dc93" class="no lr in kw b gy np nq l nr ns">npm start</span></pre><p id="0729" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦运行这个命令，您应该会看到大约100条记录被打印到您的终端上，当它们被附加到您的索引体中时！我们终于向本地<code class="fe kt ku kv kw b">Elasticsearch</code>部署添加了一些数据！万岁！</p><p id="12e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行以下代码-</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b11e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">应该会给你一个肯定的输出(因为我们正在搜索索引<code class="fe kt ku kv kw b">memes</code>中的所有内容)</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="6a23" class="no lr in kw b gy np nq l nr ns">{<br/>  took: 60,<br/>  timed_out: false,<br/>  _shards: { total: 1, successful: 1, skipped: 0, failed: 0 },<br/>  hits: {<br/>    total: { value: 100, relation: 'eq' },<br/>    max_score: 1,<br/>    hits: [<br/>      [Object], [Object],<br/>      [Object], [Object],<br/>      [Object], [Object],<br/>      [Object], [Object],<br/>      [Object], [Object]<br/>    ]<br/>  }<br/>}</span></pre><p id="d5f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们完了！现在我们可以在任何地方使用这些数据！</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h1 id="b40b" class="lq lr in bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">在Google Cloud上部署和接收数据</h1><figure class="lf lg lh li gt jo gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/68198e49bf3ec278efa64d067dbeff99.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/0*_LyroUKVhp285hJk"/></div></figure><p id="d41e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在处于最后阶段了！让我们在<code class="fe kt ku kv kw b">Google Cloud</code>上部署<code class="fe kt ku kv kw b">Elasticsearch</code></p><ol class=""><li id="a611" class="mp mq in jx b jy jz kc kd kg mr kk ms ko mt ks mu mv mw mx bi translated">前往<code class="fe kt ku kv kw b"><a class="ae my" href="https://www.elastic.co/pricing/" rel="noopener ugc nofollow" target="_blank">https://www.elastic.co/pricing/</a></code>，选择14天免费试用(注意:将显示的ID和密码保存在安全的地方)。</li><li id="e026" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">选择“独自探索”选项。</li></ol><p id="9eb3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将被重定向到类似于以下内容的屏幕</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/d0650460d5c0209e462f0d3d161ddcbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRN5XxA3DxTNMY2VwVPkdQ.png"/></div></div></figure><p id="1d2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，单击汉堡包图标并选择“管理此部署”。您应该会被重定向到包含<code class="fe kt ku kv kw b">Elasticsearch</code>的端点和您的<code class="fe kt ku kv kw b">"Cloud ID"</code>的屏幕。把这两个都复制存储起来！</p><p id="22cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们准备编写一些<code class="fe kt ku kv kw b">javascript</code>来接收<code class="fe kt ku kv kw b">Google Cloud</code>部署的<code class="fe kt ku kv kw b">Elasticsearch</code>中的数据</p><ol class=""><li id="8216" class="mp mq in jx b jy jz kc kd kg mr kk ms ko mt ks mu mv mw mx bi translated">将<code class="fe kt ku kv kw b">Cloud ID</code>、<code class="fe kt ku kv kw b">username</code>和<code class="fe kt ku kv kw b">password</code>分别存储在名为<code class="fe kt ku kv kw b">CLOUD_ID</code>、<code class="fe kt ku kv kw b">USERNAME</code>和<code class="fe kt ku kv kw b">PASSWORD</code>的环境变量中。</li><li id="43ad" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">转到您的<code class="fe kt ku kv kw b">Elasticsearch</code>端点，确保您能够使用复制的<code class="fe kt ku kv kw b">username</code>和<code class="fe kt ku kv kw b">password</code>登录。</li><li id="c9b1" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">创建一个新的<code class="fe kt ku kv kw b">javascript</code>文件<code class="fe kt ku kv kw b">client_cloud.js</code></li></ol><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="268a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:URL应该是你的<code class="fe kt ku kv kw b">Elasticsearch</code>的端点。</p><p id="8699" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">万岁！我们的客户机现在可以创建索引和接收数据了。运行上面的代码应该不会出现错误。</p><p id="92db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在可以替换我们的陈述-</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="4854" class="no lr in kw b gy np nq l nr ns">var client = require('./client_local.js');</span></pre><p id="2165" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">到</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="8c3f" class="no lr in kw b gy np nq l nr ns">var client = require('./client_cloud.js');</span></pre><p id="31d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe kt ku kv kw b">create.js</code>和<code class="fe kt ku kv kw b">server.js</code>中。</p><p id="8dd6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要创建一个新的索引，只需运行<code class="fe kt ku kv kw b">create.js</code>中的代码，然后嘣！我们现在有了一个全新的索引！我们可以使用<code class="fe kt ku kv kw b">kibana</code>来检查我们的索引是否创建成功。一个完整的<code class="fe kt ku kv kw b">kibana</code>教程将超出这个博客的范围，但我们仍然可以触及它；) -</p><ol class=""><li id="151b" class="mp mq in jx b jy jz kc kd kg mr kk ms ko mt ks mu mv mw mx bi translated">打开<code class="fe kt ku kv kw b">Elasticsearch</code>部署中的汉堡菜单。</li><li id="874c" class="mp mq in jx b jy mz kc na kg nb kk nc ko nd ks mu mv mw mx bi translated">导航到管理并点击<code class="fe kt ku kv kw b">devtools</code>。</li></ol><p id="94db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你应该被重定向到一个屏幕，看起来像这样-</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/bcab69f7eda137374994bbf31ee8eba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AIAeSmMUSbHbr-rUb4uBYw.png"/></div></div></figure><p id="c28a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在左侧面板中添加以下行并点击run -</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="014c" class="no lr in kw b gy np nq l nr ns">GET memes/_search<br/>{<br/>  "query": {<br/>    "match_all": {}<br/>  }<br/>}</span></pre><p id="1fdd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">右边面板上的输出应该是这样的</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="d76f" class="no lr in kw b gy np nq l nr ns">{<br/>  "took" : 0,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 1,<br/>    "successful" : 1,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  }<br/>}</span></pre><p id="50b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">没有错误！您可以通过<code class="fe kt ku kv kw b">kibana</code>的文档探索更多这样的命令！</p><p id="223f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们通过编辑<code class="fe kt ku kv kw b">require</code>语句来运行我们的<code class="fe kt ku kv kw b">server.js</code>。你应该再次看到大约100个meme URLs和标题被打印在你的终端上，然后被摄入<code class="fe kt ku kv kw b">Elasticsearch</code>！</p><p id="54d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe kt ku kv kw b">kibana</code>中再次运行相同的查询，现在应该会得到前10个迷因的摄取数据！</p><pre class="lf lg lh li gt nk kw nl nm aw nn bi"><span id="0b1d" class="no lr in kw b gy np nq l nr ns">{<br/>  "took" : 89,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 1,<br/>    "successful" : 1,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 100,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 1.0,<br/>    "hits" : [<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "DtBrWn4B1NYkqWeI3ZWx",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/b6rraassqnb81.gif" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/b6rraassqnb81.gif</a>",<br/>          "title" : "The sword will not cut"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "FdBrWn4B1NYkqWeI3ZXI",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/vxp1izvzfob81.jpg" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/vxp1izvzfob81.jpg</a>",<br/>          "title" : "that's my first post here, hope you like It :)"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "z3xrWn4BGc7VZGO83X6t",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/b12i54rfgmb81.gif" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/b12i54rfgmb81.gif</a>",<br/>          "title" : "Very sadge"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "0nxrWn4BGc7VZGO83X6w",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/tpor5kmpjmb81.gif" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/tpor5kmpjmb81.gif</a>",<br/>          "title" : "Its always clickbait"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "JdBrWn4B1NYkqWeI3pUZ",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/1cw59ws6qmb81.gif" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/1cw59ws6qmb81.gif</a>",<br/>          "title" : "He's here to raise hell and grab some candles"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "JtBrWn4B1NYkqWeI3pUb",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/r3y9o89tiob81.jpg" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/r3y9o89tiob81.jpg</a>",<br/>          "title" : "best feeling in the world"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "6XxrWn4BGc7VZGO83n4g",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/o5qoysvw2pb81.jpg" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/o5qoysvw2pb81.jpg</a>",<br/>          "title" : "You wanna know how I got these scars?"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "KNBrWn4B1NYkqWeI3pUk",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/fbcr779kznb81.png" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/fbcr779kznb81.png</a>",<br/>          "title" : "If I disappear soon you'll know why"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "J9BrWn4B1NYkqWeI3pUj",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/wfa8jks39mb81.png" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/wfa8jks39mb81.png</a>",<br/>          "title" : "Literally happens everyday"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "memes",<br/>        "_type" : "_doc",<br/>        "_id" : "63xrWn4BGc7VZGO83n4l",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "url" : "<a class="ae my" href="https://i.redd.it/98dhrdna3nb81.jpg" rel="noopener ugc nofollow" target="_blank">https://i.redd.it/98dhrdna3nb81.jpg</a>",<br/>          "title" : "Wait, what?"<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="4007" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，您可以通过参考官方文档来更多地处理这些查询。</p><p id="3bbf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">耶！一切正常！这个部署将在接下来的14天内保持活跃，因此，您可以尽情地玩它！</p><h1 id="a287" class="lq lr in bd ls lt ne lv lw lx nf lz ma mb ng md me mf nh mh mi mj ni ml mm mn bi translated">快速回顾一下</h1><p id="c39e" class="pw-post-body-paragraph jv jw in jx b jy ob ka kb kc oc ke kf kg od ki kj kk oe km kn ko of kq kr ks ig bi translated">我们开始熟悉<code class="fe kt ku kv kw b">Elasticsearch</code>并在本地托管它。然后我们学习了如何通过<code class="fe kt ku kv kw b">javascript</code>与本地部署交互，并在其中摄取了一些随机的meme数据！接下来，我们决定在<code class="fe kt ku kv kw b">Google Cloud</code>举办这个活动，让它更上一层楼。最后，我们使用我们的<code class="fe kt ku kv kw b">javascript</code>代码与这个<code class="fe kt ku kv kw b">Google Cloud</code>部署进行了交互！作为奖励，我们还快速看了一下<code class="fe kt ku kv kw b">kibana</code>的能力以及它如何补充<code class="fe kt ku kv kw b">Elasticsearch</code>的部署！</p><p id="8ead" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">谢谢你坚持到最后！希望你喜欢它！</p><p id="94a0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Psst，完整的代码可以在这里找到—<a class="ae my" href="https://github.com/Saransh-cpp/elastic-node-reddit" rel="noopener ugc nofollow" target="_blank">https://github.com/Saransh-cpp/elastic-node-reddit</a></p></div></div>    
</body>
</html>