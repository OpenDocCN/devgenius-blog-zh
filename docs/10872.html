<html>
<head>
<title>Ceph — Install Single Node Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ceph —安装单节点集群</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ceph-install-single-node-cluster-55b21e6fdaa2?source=collection_archive---------3-----------------------#2022-12-05">https://blog.devgenius.io/ceph-install-single-node-cluster-55b21e6fdaa2?source=collection_archive---------3-----------------------#2022-12-05</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="fae5" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">在 AWS EC2 上安装 Ceph 集群</h2></div><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div class="ab gv cl kl"><img src="../Images/b993a9db230f9ac3d58a6c705d9ca53e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Vaut_OBsJAQhUhycjjnm2Q.png"/></div></figure><p id="b15a" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">在我上一篇 ceph 文章<a class="ae lk" href="https://medium.com/dev-genius/ceph-next-gen-cloud-storage-system-1ee91fbbeca4" rel="noopener"> Ceph 简介</a>中，我谈到了什么是 Ceph，它的历史，核心组件和核心服务。让我们做一个实验，在 AWS EC2 Linux 服务器上安装一个单节点 Ceph 集群。</p><p id="2889" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">安装 Ceph 有几种不同的方法，例如:</p><ul class=""><li id="8ca2" class="ll lm ir kq b kr ks ku kv kx ln lb lo lf lp lj lq lr ls lt bi translated">Cephadm :使用容器和 systemd 安装和管理 Ceph 集群，与 CLI 和仪表板 GUI 紧密集成。</li><li id="2359" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is"> Rook </strong>:部署和管理在 K8s 中运行的 Ceph 集群，同时还支持通过 K8s APIs 管理存储资源和供应。</li><li id="1663" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is"> ceph-ansible </strong>:使用 ansible 部署和管理 ceph 集群。</li><li id="d2aa" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is"> ceph-salt </strong>:使用 salt 和 cephadm 安装 ceph。</li><li id="b078" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is">jaas.ai/ceph-mon</strong>:使用 Juju 安装 Ceph。</li><li id="59fc" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is">github.com/openstack/puppet-ceph</strong>:通过傀儡安装 Ceph。</li><li id="00f2" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated"><strong class="kq is">手动</strong> : Ceph 也可以手动安装。</li></ul><p id="0b53" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">如果想单机安装 Ceph 集群，推荐的方式是<strong class="kq is"> Cephadm </strong>，如果想在 K8s 中安装 Ceph 集群，那么<strong class="kq is"> Rook </strong>是推荐的方式。</p><p id="0220" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">为了演示和简单起见，我将使用<strong class="kq is"> Cephadm </strong>作为我的演示 Ceph 集群。有关其他方法的详细信息，请访问<a class="ae lk" href="https://docs.ceph.com/en/quincy/install/" rel="noopener ugc nofollow" target="_blank">https://docs.ceph.com/en/quincy/install/</a></p><h1 id="89fa" class="lz ma ir bd mb mc md me mf mg mh mi mj jx mk jy ml ka mm kb mn kd mo ke mp mq bi translated">Cephadm</h1><p id="4fb5" class="pw-post-body-paragraph ko kp ir kq b kr mr js kt ku ms jv kw kx mt kz la lb mu ld le lf mv lh li lj ik bi translated"><code class="fe mw mx my mz b">Cephadm</code>是一个用于管理 Ceph 集群的实用程序。它不依赖于外部配置工具，如<code class="fe mw mx my mz b">Ansible</code>、<code class="fe mw mx my mz b">Rook</code>或<code class="fe mw mx my mz b">Salt</code>。但是，这些外部配置工具可以用来自动执行不是由 cephadm 本身执行的操作。</p><p id="c706" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated"><code class="fe mw mx my mz b">Cephadm</code>管理 Ceph 集群的整个生命周期。这包括通过在单个节点上创建一个小型 Ceph 集群，然后扩展集群，添加主机并提供 Ceph 守护程序和服务的引导过程。这个生命周期的管理可以通过 Ceph 命令行界面(CLI)或仪表板(GUI)来执行。</p><h1 id="08c3" class="lz ma ir bd mb mc md me mf mg mh mi mj jx mk jy ml ka mm kb mn kd mo ke mp mq bi translated">Ceph 集群安装</h1><h2 id="ccb9" class="na ma ir bd mb nb nc dn mf nd ne dp mj kx nf ng ml lb nh ni mn lf nj nk mp nl bi translated">要求:</h2><ul class=""><li id="ec40" class="ll lm ir kq b kr mr ku ms kx nm lb nn lf no lj lq lr ls lt bi translated">Python 3</li><li id="0933" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">系统 d</li><li id="aa97" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">搬运集装箱的搬运工或码头工人</li><li id="73a1" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">时间同步(如 chrony 或 NTP)</li><li id="b2cf" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">LVM2 用于配置存储设备</li></ul><h2 id="967a" class="na ma ir bd mb nb nc dn mf nd ne dp mj kx nf ng ml lb nh ni mn lf nj nk mp nl bi translated">下载 cephadm</h2><p id="850e" class="pw-post-body-paragraph ko kp ir kq b kr mr js kt ku ms jv kw kx mt kz la lb mu ld le lf mv lh li lj ik bi translated">安装<code class="fe mw mx my mz b">cephadm</code>有两种方式:</p><ul class=""><li id="9b26" class="ll lm ir kq b kr ks ku kv kx ln lb lo lf lp lj lq lr ls lt bi translated">基于 curl 的安装</li><li id="1e96" class="ll lm ir kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">特定于发行版的安装<br/>我们将在这里使用基于 curl 的安装:<br/>下载 cephadm</li></ul><pre class="kg kh ki kj gu np mz nq bn nr ns bi"><span id="0127" class="nt ma ir mz b be nu nv l nw nx">$ curl --silent --remote-name --location https://github.com/ceph/ceph/raw/quincy/src/cephadm/cephadm</span></pre><p id="78c5" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">将其移动到<code class="fe mw mx my mz b">/usr/local/bin</code>，确保该路径在您的环境＄PATH 中</p><pre class="kg kh ki kj gu np mz nq bn nr ns bi"><span id="c17a" class="nt ma ir mz b be nu nv l nw nx">$ mv cephadm /usr/local/bin/<br/>$ which cephadm<br/>/usr/local/bin/cephadm</span></pre><h2 id="97c9" class="na ma ir bd mb nb nc dn mf nd ne dp mj kx nf ng ml lb nh ni mn lf nj nk mp nl bi translated">引导新的 ceph 集群</h2><p id="deca" class="pw-post-body-paragraph ko kp ir kq b kr mr js kt ku ms jv kw kx mt kz la lb mu ld le lf mv lh li lj ik bi translated">创建新的 Ceph 集群的第一步是在 Ceph 集群的第一台主机上运行 cephadm bootstrap 命令。<code class="fe mw mx my mz b">--mon-ip</code>是主机 IP:</p><pre class="kg kh ki kj gu np mz nq bn nr ns bi"><span id="2577" class="nt ma ir mz b be nu nv l nw nx">$ cephadm bootstrap --mon-ip 10.221.36.156 --allow-fqdn-hostname</span></pre><p id="3ede" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">我们必须在这里允许<code class="fe mw mx my mz b">feqn-hostname</code>，因为默认情况下 AWS EC2 的主机名是<code class="fe mw mx my mz b">ip-10-221-36-156.ec2.internal</code>。否则，您将遇到以下错误:</p><pre class="kg kh ki kj gu np mz nq bn nr ns bi"><span id="b426" class="nt ma ir mz b be nu nv l nw nx">ERROR: hostname is a fully qualified domain name (ip-10-221-36-156.ec2.internal); either fix (e.g., "sudo hostname ip-10-229-36-156" or similar) or pass --allow-fqdn-hostname</span></pre><p id="b37c" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">命令运行输出:</p><pre class="kg kh ki kj gu np mz nq bn nr ns bi"><span id="df82" class="nt ma ir mz b be nu nv l nw nx">$ cephadm bootstrap --mon-ip 10.221.36.156 --allow-fqdn-hostname<br/>Verifying podman|docker is present...<br/>Verifying lvm2 is present...<br/>Verifying time synchronization is in place...<br/>...<br/>Pulling container image quay.io/ceph/ceph:v17...<br/>Ceph version: ceph version 17.2.5 (98318ae89f1a893a6ded3a640405cdbb33e08757) quincy (stable)<br/>Extracting ceph user uid/gid from container image...<br/>...<br/>Ceph Dashboard is now available at:<br/>             URL: https://ip-10-221-36-156.ec2.internal:8443/<br/>            User: admin<br/>        Password: ehpzvrbf9z<br/>Enabling client.admin keyring and conf on hosts with "admin" label<br/>Saving cluster configuration to /var/lib/ceph/0e7905be-61ff-11ed-86b2-12a743769881/config directory<br/>Enabling autotune for osd_memory_target<br/>You can access the Ceph CLI as following in case of multi-cluster or non-default config:<br/>        sudo /usr/local/bin/cephadm shell --fsid 0e7905be-61ff-11ed-86b2-12a743769881 -c /etc/ceph/ceph.conf -k /etc/ceph/ceph.client.admin.keyring<br/>Or, if you are only running a single cluster on this host:<br/>        sudo /usr/local/bin/cephadm shell<br/>Please consider enabling telemetry to help improve Ceph:<br/>        ceph telemetry on<br/>For more information see:<br/>        https://docs.ceph.com/docs/master/mgr/telemetry/</span></pre><p id="10b1" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">现在你应该可以从上面的网址访问 Ceph UI:<code class="fe mw mx my mz b">https://ip-10-221-36-156.ec2.internal:8443/</code></p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj ny"><img src="../Images/83eda5d3e76e4afc89b8189161150e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCV8sQof7DNipkEbeWH_Hg.png"/></div></div></figure><p id="b4e6" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">它会要求您在首次登录时更新默认密码，一旦您更新密码并重新登录，您应该会看到以下界面:</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj od"><img src="../Images/a819b9b1a62f2e3df8d025d7fab2cdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHxifWuXtOR5damLLtTbrg.png"/></div></div></figure><p id="ce9e" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">着陆仪表板应该看起来像这样:</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj oe"><img src="../Images/65df5a705f8efd26a17f13355c558afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3AAQ-uBLbulXJK-GKDOCQ.png"/></div></div></figure><p id="35e6" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">由于我们只有一个节点，运行状况实际上显示为黄色。</p><p id="eb39" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">您可以检查集群中的主机数量:</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj of"><img src="../Images/305ea795d7343b9a402259642f41860f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbUT_jObzCsAnUbQP8pVtw.png"/></div></div></figure><p id="d199" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">检查服务:</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj og"><img src="../Images/f0874dbf02d5f9e8b34e94575f126be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E89uGVM7vQycNoFc5GX0mg.png"/></div></div></figure><p id="f155" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">检查监视器</p><figure class="kg kh ki kj gu kk gi gj paragraph-image"><div role="button" tabindex="0" class="nz oa di ob bf oc"><div class="gi gj oh"><img src="../Images/d3b2abab28c9521a4ffba3c8ad52e6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dB4x4wux0iX_l-dD5h866Q.png"/></div></div></figure><p id="354e" class="pw-post-body-paragraph ko kp ir kq b kr ks js kt ku kv jv kw kx ky kz la lb lc ld le lf lg lh li lj ik bi translated">恭喜你！至此，您已经成功安装了一个单节点 Ceph 集群！下一篇文章我们将学习如何通过添加更多节点来扩展集群。</p></div></div>    
</body>
</html>