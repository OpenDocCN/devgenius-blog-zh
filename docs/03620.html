<html>
<head>
<title>Political Views by Age Group per Election with Python and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 和 Plotly 按年龄组划分的每次选举的政治观点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/political-views-by-age-group-per-election-f9f175f8b8ba?source=collection_archive---------4-----------------------#2020-11-25">https://blog.devgenius.io/political-views-by-age-group-per-election-f9f175f8b8ba?source=collection_archive---------4-----------------------#2020-11-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9c4fc0cabf4bff3526465b759a27c920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvtJnNIha6z8HZjmnpQDUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">按年龄组分列的政治观点，以及每年左倾与右倾的百分比差异</figcaption></figure><h1 id="7c4e" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">这些数据从何而来？</h1><p id="8227" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这些数据的来源有几个地方。我无法找到包含这些数据的完整列表的网站/来源，所以我从几个来源提取并编辑了这些数据:</p><ul class=""><li id="1afe" class="lv lw in kz b la lx le ly li lz lm ma lq mb lu mc md me mf bi translated"><a class="ae mg" href="https://www.washingtonpost.com/wp-srv/politics/interactives/independents/data-year-by-year.html" rel="noopener ugc nofollow" target="_blank">https://www . Washington post . com/WP-SRV/politics/interactives/independents/data-year-by-year . html</a></li><li id="0636" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated"><a class="ae mg" href="https://www.statista.com/statistics/1184426/presidential-election-exit-polls-share-votes-age-us/" rel="noopener ugc nofollow" target="_blank">https://www . statista . com/statistics/1184426/presidential-election-exit-polls-share-votes-age-us/</a></li><li id="7278" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated"><a class="ae mg" href="https://www.pewresearch.org/politics/2018/08/09/an-examination-of-the-2016-electorate-based-on-validated-voters/" rel="noopener ugc nofollow" target="_blank">https://www . pewresearch . org/politics/2018/08/09/an-examination-of-the-2016-electromises-based-on-validated-voters/</a></li><li id="6011" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated"><a class="ae mg" href="https://www.statista.com/statistics/245884/voter-turnout-of-the-exit-polls-of-the-2012-elections-by-age/" rel="noopener ugc nofollow" target="_blank">https://www . statista . com/statistics/245884/2012 年投票率-按年龄统计的投票率/ </a></li><li id="f9f8" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated"><a class="ae mg" href="https://www.pewresearch.org/2008/11/13/young-voters-in-the-2008-election/" rel="noopener ugc nofollow" target="_blank">https://www . pewresearch . org/2008/11/13/young-voters-in-the-2008-election/</a></li></ul><h1 id="54a3" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">这段代码在哪里？</h1><p id="9419" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">英寸我的。<a class="ae mg" href="https://github.com/maxwellbade/political_views" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p><h1 id="befb" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">从这张图表中可以看出什么？</h1><ul class=""><li id="fb96" class="lv lw in kz b la lb le lf li mm lm mn lq mo lu mc md me mf bi translated">越来越多 18-29 岁的人投票给民主党</li><li id="e023" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">从 80 年代中期到 2004 年，人们的投票相当中立</li><li id="8605" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">这些年来，保守党内 18-29 岁的人没有太大变化</li><li id="02d3" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">你越老，越保守</li><li id="6ba3" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">2016 年见证了 18-29 岁的民主党和共和党选民之间最大的<strong class="kz io">百分比差异</strong></li><li id="73b9" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">我们已经看到 18-29 岁的民主党和共和党选民之间的巨大差异；<strong class="kz io">每次选举的平均百分比差异为 25% </strong></li><li id="6606" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">在任何一年中，只有少数年龄组投票给多数党共和党人；在这些人中，大部分是 60 岁以上的人</li><li id="e0bd" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">自 20 世纪 70 年代以来，45-59 岁年龄组的共和党投票率稳步上升；然而，2020 年，这一年龄组的民主党投票略高于共和党投票</li></ul><h1 id="4bb6" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">等等，密码在哪里？</h1><p id="c57d" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">好吧，好吧。复制并粘贴。我用的是阿纳康达的<a class="ae mg" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> jupyter 笔记本。如果你需要的话，代码被注释了一些细节。基本上:</a></p><ul class=""><li id="a8cd" class="lv lw in kz b la lx le ly li lz lm ma lq mb lu mc md me mf bi translated">从 github 链接下载</li><li id="60cb" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">下载并安装 jupyter 笔记本</li><li id="c255" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">在下载 github 包的地方打开 jupyter 和 cd</li><li id="db90" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">复制下面这些废话，然后点击 shift+enter</li><li id="c880" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">您可能需要在 jupyter 笔记本中安装 plotly: run: <code class="fe mp mq mr ms b">!pip install plotly</code></li><li id="d055" class="lv lw in kz b la mh le mi li mj lm mk lq ml lu mc md me mf bi translated">就是这样——下面的代码将生成上面的图像</li></ul><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="3719" class="nb ka in ms b gy nc nd l ne nf">#import plotly, pandas, numpy<br/>import plotly.graph_objects as go<br/>import pandas as pd<br/>from datetime import datetime<br/>from plotly.subplots import make_subplots<br/>import numpy as np</span><span id="0d27" class="nb ka in ms b gy ng nd l ne nf">#create dfs based on sheets within one excel file<br/>xls = pd.ExcelFile('/Users/mdawg/Downloads/political_ages.xlsx')<br/>df1 = pd.read_excel(xls, 'Sheet1')<br/>df2 = pd.read_excel(xls, 'Sheet2')<br/>df3 = pd.read_excel(xls, 'Sheet3')<br/>df4 = pd.read_excel(xls, 'Sheet4')</span><span id="df02" class="nb ka in ms b gy ng nd l ne nf">#add color column if you want to change negative values to red<br/>#change the first color parameter to red or whatever color for negative values<br/>#i chose not to use this for now<br/>df1["Color"] = np.where(df1["dem percent gap"]&lt;0, 'darkcyan', 'darkcyan')<br/>df2["Color"] = np.where(df2["dem percent gap"]&lt;0, 'yellow', 'yellow')<br/>df3["Color"] = np.where(df3["dem percent gap"]&lt;0, 'black', 'black')<br/>df4["Color"] = np.where(df4["dem percent gap"]&lt;0, 'mediumpurple', 'mediumpurple')</span><span id="9be6" class="nb ka in ms b gy ng nd l ne nf"># Create figure with secondary y-axis<br/>fig = make_subplots(specs=[[{"secondary_y": True}]])</span><span id="d8c2" class="nb ka in ms b gy ng nd l ne nf">#create lines/traces for democrat columns<br/>fig.add_trace(go.Scatter(x=df1['year'], y=df1['dem'],<br/>                    mode='lines',<br/>                    name='dem 18-29',<br/>                    line=dict(color="Blue", width=2),))<br/>fig.add_trace(go.Scatter(x=df2['year'], y=df2['dem'],<br/>                    mode='lines',<br/>                    name='dem 30-44',<br/>                    opacity=.2,<br/>                    line=dict(color="slateblue", width=2),))<br/>fig.add_trace(go.Scatter(x=df3['year'], y=df3['dem'],<br/>                    mode='lines',<br/>                    name='dem 45-59',<br/>                    opacity=.2,<br/>                    line=dict(color="skyblue", width=2),))<br/>fig.add_trace(go.Scatter(x=df4['year'], y=df4['dem'],<br/>                    mode='lines',<br/>                    name='dem 60+',<br/>                    opacity=.2,<br/>                    line=dict(color="darkblue", width=2),))</span><span id="0246" class="nb ka in ms b gy ng nd l ne nf">#create lines/traces for republican columns<br/>fig.add_trace(go.Scatter(x=df1['year'], y=df1['rep'],<br/>                    mode='lines',<br/>                    name='rep 18-29',<br/>                    line=dict(color="Red", width=2),))<br/>fig.add_trace(go.Scatter(x=df2['year'], y=df2['rep'],<br/>                    mode='lines',<br/>                    name='rep 30-44',<br/>                    opacity=.2,<br/>                    line=dict(color="mediumvioletred", width=2),))<br/>fig.add_trace(go.Scatter(x=df3['year'], y=df3['rep'],<br/>                    mode='lines',<br/>                    name='rep 45-59',<br/>                    opacity=.2,<br/>                    line=dict(color="maroon", width=2),))<br/>fig.add_trace(go.Scatter(x=df4['year'], y=df4['rep'],<br/>                    mode='lines',<br/>                    name='rep 60+',<br/>                    opacity=.2, <br/>                    line=dict(color="darkRed", width=2),))</span><span id="3aa5" class="nb ka in ms b gy ng nd l ne nf">#create lines/traces for dem percent gap columns<br/>fig.add_trace(go.Bar(x=df1['year'], y=df1['dem percent gap']<br/>                    , opacity=.7<br/>                    , marker_color=df1['Color']<br/>                    , text=df1['dem percent gap']<br/>                    , textposition='outside'<br/>                    , name='dem percent gap 18-29',),secondary_y=True)<br/>#                     bar=dict(color="green", width=1),),secondary_y=True)<br/>fig.add_trace(go.Bar(x=df2['year'], y=df2['dem percent gap']<br/>                    , opacity=.7<br/>                    , marker_color=df2['Color']<br/>#                     , text=df2['dem percent gap']<br/>                    , name='dem percent gap 30-44',),secondary_y=True)<br/>#                     bar=dict(color="teal", width=1),),secondary_y=True)<br/>fig.add_trace(go.Bar(x=df3['year'], y=df3['dem percent gap']<br/>                    , opacity=.7<br/>                    , marker_color=df3['Color']<br/>#                     , text=df3['dem percent gap']<br/>                    , name='dem percent gap 45-59',),secondary_y=True)<br/>#                     bar=dict(color="limegreen", width=1),),secondary_y=True)<br/>fig.add_trace(go.Bar(x=df4['year'], y=df4['dem percent gap']<br/>                    , opacity=.7<br/>                    , marker_color=df4['Color']<br/>#                     , text=df4['dem percent gap']<br/>                    , name='dem percent gap 60+',),secondary_y=True)<br/>#                     bar=dict(color="darkgreen", width=1),),secondary_y=True)</span><span id="4de7" class="nb ka in ms b gy ng nd l ne nf">#update layout<br/>fig.update_layout(title="&lt;b&gt;Political Views by Age Group&lt;/b&gt;"<br/>                 , height = 900<br/>                 , width = 1650<br/>                 , xaxis_title='&lt;b&gt;Date&lt;/b&gt;'<br/>                 , yaxis_title='Percentage'<br/>                 , template = "plotly" #['ggplot2', 'seaborn', 'simple_white', 'plotly', 'plotly_white', 'plotly_dark']<br/>                 )</span><span id="fe68" class="nb ka in ms b gy ng nd l ne nf">fig.update_traces(texttemplate = "%{percent}")</span><span id="b869" class="nb ka in ms b gy ng nd l ne nf">#update x and y axes<br/>fig.update_yaxes(title_text="&lt;b&gt;Dem Percent Difference&lt;/b&gt;"<br/>                , range=[-.15,2]<br/>#                 , tickformat = "%"<br/>                , secondary_y=True<br/>                )<br/>fig.update_yaxes(title_text="&lt;b&gt;Percent of Party&lt;/b&gt;"<br/>                , range=[0.05,.7]<br/>                , tickformat = "%"<br/>                , secondary_y=False<br/>                )</span><span id="b0a6" class="nb ka in ms b gy ng nd l ne nf">#update legend<br/>fig.update_layout(<br/>    legend=dict(<br/>        orientation="h",<br/>        yanchor="bottom",<br/>        y=1,<br/>        xanchor="right",<br/>        x=.9)<br/>    , title={<br/>        'y':.865,<br/>        'x':0.455,<br/>        'xanchor': 'center',<br/>        'yanchor': 'top'}<br/>)</span><span id="95b7" class="nb ka in ms b gy ng nd l ne nf">#print it<br/>fig.show()</span></pre><h1 id="4ce2" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="e015" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这不是一篇详尽的文章。它没有给出那么多信息。但是，在我看来，人们可以重用的代码越多越好。看到趋势走向也很好。显然，共和党人需要在年轻群体中加强他们的游戏。也许找更保守的教授？只是一个想法。</p><p id="c2f2" class="pw-post-body-paragraph kx ky in kz b la lx lc ld le ly lg lh li nh lk ll lm ni lo lp lq nj ls lt lu ig bi translated">马克斯</p></div></div>    
</body>
</html>