<html>
<head>
<title>Database Change Management Tool: SchemaChange with Snowflake Overview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库变更管理工具:雪花模式变更概述</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/database-change-management-tool-schemachange-with-snowflake-overview-b62dec744e0a?source=collection_archive---------1-----------------------#2021-08-15">https://blog.devgenius.io/database-change-management-tool-schemachange-with-snowflake-overview-b62dec744e0a?source=collection_archive---------1-----------------------#2021-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9f607464629fd1239eb6bf82f1746e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdnNYYDL_E3ox7-Ii9Ieog.png"/></div></div></figure><p id="97bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博客中，我们将讨论如何利用数据库变更管理工具 SchemaChange 在雪花中部署数据库对象和 dml 脚本。这可以通过多种方式和市场上的多种工具来实现。您还可以开发自己定制工具来实现一定级别的管理</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="5481" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">schema change 的简要背景</strong></p><p id="3ac7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Schemachange 是一个简单的基于 python 的工具，用来管理你所有的<a class="ae ld" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">雪花</a>对象。它遵循一种命令式的数据库变更管理(DCM)方法，并受到了<a class="ae ld" href="https://flywaydb.org/" rel="noopener ugc nofollow" target="_blank"> Flyway 数据库迁移工具</a>的启发。当与版本控制系统和 CI/CD 工具相结合时，数据库变更可以通过使用现代软件交付实践的管道来批准和部署。因此，schemachange 在实现数据库(或数据)开发中起着关键作用。</p><p id="a41a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">DCM 工具(也称为数据库迁移、模式变更管理或模式迁移工具)遵循两种方法之一:声明式或命令式。关于数据库 DevOps 的背景，包括关于声明式和命令式方法之间的差异的讨论，请阅读由 Jeremiah Hansen<a class="ae ld" href="https://www.snowflake.com/blog/authors/jeremiah-hansen/" rel="noopener ugc nofollow" target="_blank">撰写的</a><a class="ae ld" href="https://www.snowflake.com/blog/embracing-agile-software-delivery-and-devops-with-snowflake/" rel="noopener ugc nofollow" target="_blank">拥抱敏捷软件交付和带有雪花的 devo PS</a>博客文章。</p><p id="c0b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看对 schemachange 所做更改的完整列表，请查看<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange/blob/master/CHANGELOG.md" rel="noopener ugc nofollow" target="_blank">变更日志</a>。</p><p id="d5ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">请注意，schemachange 是一个社区开发的工具，而不是官方的雪花产品。它没有支持或保修。</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="6b37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要方案变更指针:</strong></p><p id="1010" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与<strong class="ka ir">项目结构</strong>相关的细节可以在这里阅读<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#project-structure" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6bfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于<strong class="ka ir">改变脚本</strong>的细节你可以在这里阅读<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#change-scripts" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f840" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于<strong class="ka ir">可重复脚本命名</strong>变更的详细信息可以在这里阅读<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#repeatable-script-naming" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="66bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于<strong class="ka ir">认证</strong>的细节可以在这里找到<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#authentication" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="b535" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">运行脚本:</h2><p id="d819" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">Schemachange 是位于<a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange/blob/master/schemachange/cli.py" rel="noopener ugc nofollow" target="_blank"> schemachange/cli.py </a>的单个 python 脚本。它可以按如下方式执行:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b57f" class="le lf iq mh b gy ml mm l mn mo">python schemachange/cli.py [-h] [-f ROOT_FOLDER] -a SNOWFLAKE_ACCOUNT -u SNOWFLAKE_USER -r SNOWFLAKE_ROLE -w SNOWFLAKE_WAREHOUSE [-d SNOWFLAKE_DATABASE] [-c CHANGE_HISTORY_TABLE] [--vars VARS] [--create-change-history-table] [-ac] [-v]</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="59b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">模式改变有什么前提条件吗？</strong></p><p id="b2fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的，可以从 SchemaChange GitHub <a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#readme" rel="noopener ugc nofollow" target="_blank">自述文件</a>中找到。</p><p id="3e7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">先决条件</strong> <br/>为了运行 schemachange，您必须具备以下条件:</p><ol class=""><li id="c344" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">你需要安装最新版本的<strong class="ka ir"> python 3 </strong>。</li><li id="9ec5" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">您需要安装最新的<strong class="ka ir">雪花 Python 驱动程序</strong><br/>您需要在雪花中创建 schemachange 使用的变更历史表。</li><li id="65d2" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">首先，您需要创建一个数据库(元数据)来存储您的变更历史表(schemachange 不会在这方面帮助您)。</li><li id="1617" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">其次，您需要创建变更历史模式和表。您可以手动完成此操作，也可以通过使用— create-change-history-table 参数运行 schemachange 来创建它们(只需确保运行 schemachange 的雪花用户拥有在该数据库中创建模式和表的权限)。</li><li id="6686" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">您需要创建(或选择)一个用户帐户，该帐户有权应用您的更改脚本中的更改。</li><li id="e812" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">不要忘记，该用户还需要对变更历史表具有 SELECT 和 INSERT 权限</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="023b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">来个快速演示怎么样？</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="cde4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何下载或克隆 SchemaChange？</p><blockquote class="nf ng nh"><p id="3847" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">https://github.com/Snowflake-Labs/schemachange.git</p></blockquote><p id="ff00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者</p><p id="4d76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">去 https://github.com/Snowflake-Labs/schemachange.git</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/8289c0f19fcfd508421330fc72f7a33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JqB20-UzyRe8YMkgCKKJw.png"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="e955" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">对于 SchemaChange，哪些参数是必需的？</strong></p><blockquote class="nf ng nh"><p id="91d1" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">以下两个参数都需要在环境变量中预先设置。如果没有设置 belwo，Schemachange 将在执行过程中失败。</p><p id="701b" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><strong class="ka ir">雪花 _ 私有 _ 密钥 _ 路径<br/>雪花 _ 密码</strong></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="95ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我可以在哪里存储我的 CLI 参数值？</strong></p><p id="e7d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用环境变量(Windows)来存储所有 SnowChange CLI 参数。如果您在管道中使用，那么您可以将其存储为机密或库。我在本地笔记本电脑上运行这个程序，所以我选择将它们存储为一个环境变量</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/10e0d2ca69a8c6136c767b5e32624e84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJq9d7qpe8iIoyrzQwn0aQ.png"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="4982" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用 SchemaChange 需要任何安装吗？</p><p id="758a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不需要，你只需要从 GitHub repo 下载 zip 文件夹或将 GitHub repo 克隆到你的本地目录，就可以使用了。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="30fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何查看 Snowchange CLI 命令的帮助？</p><blockquote class="nf ng nh"><p id="923c" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python cli.py <strong class="ka ir"> -h </strong></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="c701" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如何提供我的自定义数据库修改脚本路径？</strong></p><blockquote class="nf ng nh"><p id="2b5d" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">-f ROOT_FOLDER，— root-folder ROOT_FOLDER: <em class="iq">(可选)</em>数据库更改脚本的根文件夹。默认为当前目录。</p><p id="3460" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py<strong class="ka ir">-f C:\ Rajiv \ schema change \ demo \ Citi bike</strong>-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _DATABASE% —创建-更改-历史-表</p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="3838" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我们可以从 SnowChange CLI 创建 CHANGE_HISTORY(在默认数据库/模式中)表吗？</strong></p><blockquote class="nf ng nh"><p id="2931" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">—创建-变更-历史-表格:<em class="iq">(可选)</em>如果变更历史表格不存在，则创建该表格。默认值为“False”。</p><p id="8c7a" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %<strong class="ka ir">—create-change-history-table</strong></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="a904" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如何在 Schemachange 中部署时生成详细日志？</strong></p><blockquote class="nf ng nh"><p id="e7ad" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">-v，— verbose: <em class="iq">(可选)</em>在执行过程中显示详细的调试细节。默认值为“False”。</p><p id="671c" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %—create-change-history-table<strong class="ka ir">-v</strong></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="b3ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如何使用 Schemachange 在雪花中创建初始 DDL？</strong></p><ol class=""><li id="a1a4" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">在工作目录中添加初始 DDL 脚本。(以下脚本是 Schemachange git 回购示例 citybike 演示的一部分)</li></ol><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/7d2e301e82062bec2e74ca6e764d8e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryvPFpWKLuuCXV27O-mKqw.png"/></div></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a33d2d2443584254c9f234a01eeb4f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*h2iH7dFCSl2q7SnnXKik3Q.png"/></div></figure><p id="5212" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在命令下运行。</p><blockquote class="nf ng nh"><p id="8252" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _DATABASE% —创建-更改-历史-表</p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="df83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我的脚本包含 DML 语句，我想从 CLI 提交，该怎么办？</p><ol class=""><li id="7c2e" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">在工作目录中添加 DML 脚本。(以下脚本是 Schemachange git 回购示例 citybike 演示的一部分)</li></ol><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/8cf020072508c5c446300fa398f22be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UD1BgzD0HsPE5Dsr4xTkVQ.png"/></div></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/bfb032429fd8e3305b4c08c65b7bbb81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*uHEbZO0g0Yd603BBORR1yA.png"/></div></figure><blockquote class="nf ng nh"><p id="7281" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">-ac，—自动提交:<em class="iq">(可选)</em>为 DML 命令启用自动提交功能。默认值为“False”。</p><p id="102b" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %—create-change-history-table<strong class="ka ir">-AC</strong></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="e232" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何使用我的脚本中定义的动态变量进行部署？</p><ol class=""><li id="bd42" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">在工作目录中添加带有动态变量代码的 DDL 脚本。</li></ol><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/e05b95f6630e7fa3c6fb5f7a0a436ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPdQZ05LLgGjnLYrdV7WUQ.png"/></div></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/08288104e5202e3fcac3acd12d304b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*neEhBVL32Bt3sGSuODbhdA.png"/></div></figure><blockquote class="nf ng nh"><p id="2238" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">—变量 VARS: <em class="iq">(可选)</em>定义要在更改脚本中替换的变量的值，以 JSON 格式给出(例如' {"variable1": "value1 "，" variable2": "value2"} ')</p><p id="fa96" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">注意:在将键值作为参数传递时，我们必须使用两次双邀请逗号，否则它将开始抱怨"<strong class="ka ir">schema change:error:argument-vars:invalid loads Value:' { DB:METADATA，SCH: SCHEMACHANGE} </strong>' "。</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/c7e0a34ac27084bee35852ea519e3ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOo34u9KKLumGeV1fuJ2kQ.png"/></div></div></figure><blockquote class="nf ng nh"><p id="a53d" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %—vars " { " " DB " ":" METADATA " "，" " SCH " ":" schema change " " }-v-AC</p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="30de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我可以用我的自定义表名覆盖 Change_History 表名吗？</strong></p><p id="5b57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的，你可以。看看下面你如何能达到同样的效果。</p><blockquote class="nf ng nh"><p id="c92e" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">-c CHANGE_HISTORY_TABLE，—CHANGE-HISTORY-TABLE CHANGE _ HISTORY _ TABLE:<em class="iq">(可选)</em>用于覆盖变更历史表的默认名称(即元数据。SCHEMACHANGE.CHANGE_HISTORY)</p></blockquote><p id="55f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注:</strong></p><p id="6e44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">确保在创建历史记录表之前预先创建了默认数据库&amp; Schema。除了"-c "参数，您还必须传递"--create-change-history-table "，这样它将复制历史表结构并使用您提供的名称作为 CLI 参数。</p><blockquote class="nf ng nh"><p id="26a5" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %—vars " { " " DB " ":" METADATA " "，" " SCH " ":" schema change " " } "—create-change-HISTORY-table-C "雪花 _HISTORY "</p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="c531" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我们能否试运行一下，看看将要部署的文件列表以及部署顺序，而不是实际部署？</strong></p><p id="aba0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的，我们可以通过使用—模拟运行参数来实现。</p><blockquote class="nf ng nh"><p id="2324" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">—空运行:<em class="iq">(可选)</em>在空运行模式下运行 schemachange。默认值为“False”。</p><p id="baf1" class="jy jz ni ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">python CLI . py-f C:\ Rajiv \ schema change \ demo \ Citi bike-a %雪花 _ ACCOUNT %-u %雪花 _ USER %-r %雪花 _ ROLE %-w %雪花 _ WAREHOUSE %-d %雪花 _ DATABASE %-v-AC—vars " { " " DB " ":" " METADATA " "，" " SCH:" " schema change " " } "—模拟运行</p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="398e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> SchemaChange 关键观察:</strong></p><ol class=""><li id="0306" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">Schema change 是一个轻量级的、非常简单的基于 Python 的工具，旨在管理雪花对象&amp;只管理 dml 脚本。</li><li id="22fc" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">目前除了雪花之外，它不支持任何其他数据库。</li><li id="85e2" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">早先，SchemaChange 被称为 SnowChange。</li><li id="3303" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">这是一个社区开发的工具，而不是官方的雪花产品。此外，它没有支持或保修。</li><li id="68f1" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">它只支持应用非常广泛的 SQL 脚本。</li><li id="5488" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">因为 Schemachange 是用 Python 编写的，所以它可以很容易地包含在 CI/CD 管道中。所有流行的 CI/CD 工具都提供安装了 Python 的托管代理(或运行程序),因此不需要创建自托管代理或容器来运行 Snowchange。</li><li id="f777" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">不需要复杂的安装。下载使用即可。只要你满足所有先决条件。</li><li id="7081" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">变更文件也很容易管理，您可以在根文件夹下创建任意数量子目录。</li><li id="40b8" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">Schemachange 支持<a class="ae ld" href="https://docs.snowflake.com/en/user-guide/python-connector-example.html#connecting-using-the-default-authenticator" rel="noopener ugc nofollow" target="_blank">口令认证</a>和<a class="ae ld" href="https://docs.snowflake.com/en/user-guide/python-connector-example.html#using-key-pair-authentication" rel="noopener ugc nofollow" target="_blank">私钥认证</a>。</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="22e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这篇博客能帮助你了解<strong class="ka ir"> SchemaChange，一个数据库变更管理工具</strong>。如果你对此有任何疑问，欢迎在评论区提问。如果你喜欢这个博客，请鼓掌。保持联系，看到更多这样的酷东西。谢谢你的支持。</p><p id="fee6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">可以找我:</strong></p><p id="03ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">跟我上媒:</strong><a class="ae ld" href="https://rajivgupta780184.medium.com/" rel="noopener">https://rajivgupta780184.medium.com/</a></p><p id="bf93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在推特上关注我:</strong><a class="ae ld" href="https://twitter.com/RAJIVGUPTA780" rel="noopener ugc nofollow" target="_blank">https://twitter.com/RAJIVGUPTA780</a></p><p id="5b86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在 LinkedIn 联系我:</strong><a class="ae ld" href="https://www.linkedin.com/in/rajiv-gupta-618b0228/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/rajiv-gupta-618b0228/</a></p><p id="cd15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">订阅我的 YouTube 频道:【https://www.youtube.com/channel/UC8Fwkdf2d6-hnNvcrzovktg】T22</strong></p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/82c15a8d0bc24e8323235caa58bd2518.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/0*t7M16BkabVce5Hqe.png"/></div></figure><p id="16c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">#坚持学习#坚持分享#每天学习。</p><h1 id="1273" class="nw lf iq bd lg nx ny nz lj oa ob oc lm od oe of lp og oh oi ls oj ok ol lv om bi translated">参考资料:-</h1><ul class=""><li id="8084" class="mp mq iq ka b kb lx kf ly kj on kn oo kr op kv oq mv mw mx bi translated"><a class="ae ld" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">https://www.snowflake.com/</a></li><li id="2a79" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv oq mv mw mx bi translated"><a class="ae ld" href="https://github.com/Snowflake-Labs/schemachange#readme" rel="noopener ugc nofollow" target="_blank">https://github.com/Snowflake-Labs/schemachange#readme</a></li></ul></div></div>    
</body>
</html>