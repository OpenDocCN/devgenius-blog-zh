<html>
<head>
<title>Server-Side Development with Hapi.js — User-Agent, Payload, Semantic Version, and Sorting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Hapi.js 进行服务器端开发——用户代理、有效负载、语义版本和排序</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/server-side-development-with-hapi-js-user-agent-payload-semantic-version-and-sorting-ec554cd1b7a0?source=collection_archive---------1-----------------------#2021-03-03">https://blog.devgenius.io/server-side-development-with-hapi-js-user-agent-payload-semantic-version-and-sorting-ec554cd1b7a0?source=collection_archive---------1-----------------------#2021-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/68b616305bfbe60006d69e50a27b6c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uhzo2_VbQlEjgRzi"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@brookecagle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁克·卡吉尔</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3fdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Hapi.js 是一个用于开发后端 web 应用程序的小型节点框架。</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Hapi.js 创建后端应用程序。</p><h1 id="b6cc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取用户代理信息</h1><p id="ebcb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/scooter</code>模块从请求中获取用户代理信息。</p><p id="81ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用它，我们写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b857" class="mq lc iq mh b gy mr ms l mt mu">const Hapi = require('@hapi/hapi');<br/>const Scooter = require('@hapi/scooter');</span><span id="9abd" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  const server = new Hapi.Server({<br/>    port: 3000,<br/>    host: '0.0.0.0'<br/>  });</span><span id="dfdc" class="mq lc iq mh b gy mv ms l mt mu">  server.route({<br/>    method: 'GET',<br/>    path: '/',<br/>    config: {<br/>      handler(request, h) {<br/>        return request.plugins.scooter;<br/>      },<br/>    }<br/>  });<br/>  await server.register(Scooter);<br/>  await server.start();  <br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="6d40" class="mq lc iq mh b gy mv ms l mt mu">process.on('unhandledRejection', (err) =&gt; {<br/>  console.log(err);<br/>  process.exit(1);<br/>});</span><span id="147c" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="b406" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">await server.register(Scooter);</code>来注册 Scooter 插件。</p><p id="8a70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">request.plugins.scooter</code>来返回用户代理对象。</p><h1 id="f7ce" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">语义版本控制</h1><p id="e630" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">@hapi/somever</code>模块来处理语义版本号。</p><p id="7d70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4a8a" class="mq lc iq mh b gy mr ms l mt mu">const Hapi = require('@hapi/hapi');<br/>const somever = require('@hapi/somever');</span><span id="f4d9" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  const server = new Hapi.Server({<br/>    port: 3000,<br/>    host: '0.0.0.0'<br/>  });</span><span id="d233" class="mq lc iq mh b gy mv ms l mt mu">  server.route({<br/>    method: 'GET',<br/>    path: '/',<br/>    config: {<br/>      handler(request, h) {<br/>        return somever.compare('1.2.3', '1.2.5');<br/>      },<br/>    }<br/>  });<br/>  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="c91b" class="mq lc iq mh b gy mv ms l mt mu">process.on('unhandledRejection', (err) =&gt; {<br/>  console.log(err);<br/>  process.exit(1);<br/>});</span><span id="8eb3" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="ffba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<code class="fe me mf mg mh b">somever.compare</code>法比较 2 个版本号。</p><p id="a7c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到-1，因为第一个版本号比第二个版本号早。</p><p id="8d57" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用<code class="fe me mf mg mh b">match</code>方法比较版本:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e8d5" class="mq lc iq mh b gy mr ms l mt mu">const Hapi = require('@hapi/hapi');<br/>const somever = require('@hapi/somever');</span><span id="d22a" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  const server = new Hapi.Server({<br/>    port: 3000,<br/>    host: '0.0.0.0'<br/>  });</span><span id="9cce" class="mq lc iq mh b gy mv ms l mt mu">  server.route({<br/>    method: 'GET',<br/>    path: '/',<br/>    config: {<br/>      handler(request, h) {<br/>        return somever.match('1.2.x', '1.2.5');<br/>      },<br/>    }<br/>  });<br/>  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};</span><span id="84e5" class="mq lc iq mh b gy mv ms l mt mu">process.on('unhandledRejection', (err) =&gt; {<br/>  console.log(err);<br/>  process.exit(1);<br/>});</span><span id="6a0a" class="mq lc iq mh b gy mv ms l mt mu">init();</span></pre><p id="3585" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为<code class="fe me mf mg mh b">'1.2.x'</code>包含<code class="fe me mf mg mh b">'1.2.5'</code>，所以我们得到<code class="fe me mf mg mh b">true</code>。</p><h1 id="9b3f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解析 HTTP 负载</h1><p id="70eb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/subtext</code>模块解析 HTTP 负载。</p><p id="0a18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5c2d" class="mq lc iq mh b gy mr ms l mt mu">const Http = require('http');<br/>const Subtext = require('@hapi/subtext');</span><span id="c033" class="mq lc iq mh b gy mv ms l mt mu">Http.createServer(async (request, response) =&gt; {<br/>  const { payload, mime } = await Subtext.parse(request, null, { parse: true, output: 'data' });<br/>  response.writeHead(200, { 'Content-Type': 'text/plain' });<br/>  response.end(`Payload contains: ${JSON.stringify(payload)}`);</span><span id="b70f" class="mq lc iq mh b gy mv ms l mt mu">}).listen(1337, '0.0.0.0');</span><span id="d3bf" class="mq lc iq mh b gy mv ms l mt mu">console.log('Server running/');</span></pre><p id="7f83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">request</code>对象调用<code class="fe me mf mg mh b">Subtext.parse</code>来解析它。</p><p id="97a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个带有带有<code class="fe me mf mg mh b">payload</code>和<code class="fe me mf mg mh b">mime</code>属性的对象的承诺。</p><p id="547e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">payload</code>有效载荷已发送。</p><p id="d9ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">mime</code>具有 MIME 类型。</p><h1 id="1e84" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">排序文本</h1><p id="b2cd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/topo</code>模块对文本进行排序。</p><p id="6190" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用它，我们写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1330" class="mq lc iq mh b gy mr ms l mt mu">const Hapi = require('@hapi/hapi');<br/>const Topo = require('@hapi/topo');</span><span id="5b34" class="mq lc iq mh b gy mv ms l mt mu">const morning = new Topo.Sorter();</span><span id="e314" class="mq lc iq mh b gy mv ms l mt mu">morning.add('Nap', { after: ['breakfast', 'prep'] });<br/>morning.add([<br/>  'Make toast',<br/>  'Pour juice'<br/>], { before: 'breakfast', group: 'prep' });<br/>morning.add('Eat breakfast', { group: 'breakfast' });</span><span id="3e81" class="mq lc iq mh b gy mv ms l mt mu">const init = async () =&gt; {<br/>  const server = new Hapi.Server({<br/>    port: 3000,<br/>    host: '0.0.0.0'<br/>  });<br/>  server.route({<br/>    method: 'GET',<br/>    path: '/',<br/>    config: {<br/>      handler(request, h) {<br/>        return morning.nodes;<br/>      },<br/>    }<br/>  });<br/>  await server.start();<br/>  console.log('Server running at:', server.info.uri);<br/>};<br/>process.on('unhandledRejection', (err) =&gt; {<br/>  console.log(err);<br/>  process.exit(1);<br/>});<br/>init();</span></pre><p id="5f52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">Topo.Sorter</code>构造函数创建了<code class="fe me mf mg mh b">morning</code>对象。</p><p id="7889" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">morning.add</code>来添加我们想要排序的项目。</p><p id="df18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">属性指定了第一个参数中项目之后的项目。</p><p id="4eab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">group</code>让我们将物品分组。</p><p id="8032" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe me mf mg mh b">morning.nodes</code>属性得到排序后的项目。</p><h1 id="b90a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d50c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">@hapi/topo</code>模块对物品进行分类。</p><p id="25dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">@hapi/subtext</code>模块让我们解析请求负载。</p><p id="ba17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">@hapi/scooter</code>返回用户代理信息。</p><p id="b384" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们比较语义版本字符串。</p></div></div>    
</body>
</html>