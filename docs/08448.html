<html>
<head>
<title>MongoDB Replication on Ubuntu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ubuntu 上的 MongoDB 复制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/mongodb-replication-on-ubuntu-40d9c81714ac?source=collection_archive---------8-----------------------#2022-06-15">https://blog.devgenius.io/mongodb-replication-on-ubuntu-40d9c81714ac?source=collection_archive---------8-----------------------#2022-06-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c592d78b661d7c26e074af996eafc65e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gfhm--I0fZGRLIo1AVCToQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank">https://www.mongodb.com/</a></figcaption></figure><p id="c448" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">副本<strong class="kc io"> </strong>集是一个实现主从复制的 MongoDB 数据库服务器集群。副本集的最低建议配置是三成员副本集，具有三个数据承载成员:一个主要成员和两个辅助成员。</p><p id="e64f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">主节点是副本集中接收写操作的唯一成员。辅助节点维护主节点数据集的副本。</p><p id="d9d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">辅助节点可以成为主节点。如果当前的主服务器变得不可用，副本集将举行一次选举，选择哪个辅助服务器成为新的主服务器。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/b0331cb79c772f539b510f11b809650d.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*6wFiOiGMczNZBxdt8WOOFg.png"/></div></figure><p id="a5a5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">MongoDB 复制要求集群中至少有 3 个节点，在我的例子中，我有以下节点。</p><ul class=""><li id="4cc2" class="ld le in kc b kd ke kh ki kl lf kp lg kt lh kx li lj lk ll bi translated">127.0.0.0 服务器 1 IP</li><li id="9f58" class="ld le in kc b kd lm kh ln kl lo kp lp kt lq kx li lj lk ll bi translated">服务器 2-ip</li><li id="3076" class="ld le in kc b kd lm kh ln kl lo kp lp kt lq kx li lj lk ll bi translated">服务器 3-ip</li></ul><h2 id="3089" class="lr ls in bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">在您将使用的每台服务器上安装 MongoDB:</h2><div class="mk ml gp gr mm mn"><a href="https://www.mongodb.com/docs/v4.4/tutorial/install-mongodb-on-ubuntu/" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd io gy z fp ms fr fs mt fu fw im bi translated">在 Ubuntu 上安装 MongoDB 社区版</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">MongoDB Atlas 是一个托管在云中的 MongoDB 服务选项，不需要安装开销，并提供免费的…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">www.mongodb.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb jt mn"/></div></div></a></div><h1 id="450a" class="nc ls in bd lt nd ne nf lw ng nh ni lz nj nk nl mc nm nn no mf np nq nr mi ns bi translated">部署步骤</h1><ol class=""><li id="cb74" class="ld le in kc b kd nt kh nu kl nv kp nw kt nx kx ny lj lk ll bi translated">为每台服务器配置/etc/mongod.conf 文件</li><li id="6844" class="ld le in kc b kd lm kh ln kl lo kp lp kt lq kx ny lj lk ll bi translated">重新启动 mongod.service</li><li id="986e" class="ld le in kc b kd lm kh ln kl lo kp lp kt lq kx ny lj lk ll bi translated">初始化副本集</li></ol><h1 id="3597" class="nc ls in bd lt nd ne nf lw ng nh ni lz nj nk nl mc nm nn no mf np nq nr mi ns bi translated">1.在所有服务器上配置配置文件</h1><p id="f9a5" class="pw-post-body-paragraph ka kb in kc b kd nt kf kg kh nu kj kk kl nz kn ko kp oa kr ks kt ob kv kw kx ig bi translated">使用以下命令打开 mongod.conf 文件:</p><blockquote class="oc od oe"><p id="7f68" class="ka kb of kc b kd ke kf kg kh ki kj kk og km kn ko oh kq kr ks oi ku kv kw kx ig bi translated">$ <em class="in">须藤纳米/etc/mongod.conf </em></p></blockquote><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="1b11" class="lr ls in ok b gy oo op l oq or"># mongod.conf</span><span id="10ad" class="lr ls in ok b gy os op l oq or"># for documentation of all options, see:<br/>#   <a class="ae jz" href="http://docs.mongodb.org/manual/reference/configuration-options/" rel="noopener ugc nofollow" target="_blank">http://docs.mongodb.org/manual/reference/configuration-options/</a></span><span id="44c9" class="lr ls in ok b gy os op l oq or"># Where and how to store data.<br/>storage:<br/>  dbPath: /var/lib/mongodb<br/>  journal:<br/>    enabled: true<br/>#  engine:<br/>#  mmapv1:<br/>#  wiredTiger:</span><span id="791e" class="lr ls in ok b gy os op l oq or"># where to write logging data.<br/>systemLog:<br/>  destination: file<br/>  logAppend: true<br/>  path: /var/log/mongodb/mongod.log</span><span id="7cc4" class="lr ls in ok b gy os op l oq or"># network interfaces<br/>net:<br/>  port: 27017<br/>  bindIp: &lt;bindIp&gt;         #write ip of server</span><span id="a6a5" class="lr ls in ok b gy os op l oq or"># how the process runs<br/>processManagement:<br/>  timeZoneInfo: /usr/share/zoneinfo</span><span id="8c31" class="lr ls in ok b gy os op l oq or">#security:</span><span id="4915" class="lr ls in ok b gy os op l oq or">#operationProfiling:</span><span id="b45c" class="lr ls in ok b gy os op l oq or">#replication:<br/>replication:<br/>  replSetName: "&lt;replsetname&gt;"   #example ReplSet</span><span id="c907" class="lr ls in ok b gy os op l oq or">#sharding:</span><span id="21e0" class="lr ls in ok b gy os op l oq or">## Enterprise-Only Options:</span><span id="e5da" class="lr ls in ok b gy os op l oq or">#auditLog:</span><span id="7c32" class="lr ls in ok b gy os op l oq or"><br/>#snmp:</span></pre><p id="f024" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更改以下几行:</p><p id="9bae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> replSetName </strong>:对于 replSetName，对作为副本成员的所有服务器使用相同的<strong class="kc io"> <em class="of"> replsetname </em> </strong>。我用了<strong class="kc io"> ReplSet。</strong></p><p id="ce17" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，保存并关闭文件。</p><h1 id="7f1c" class="nc ls in bd lt nd ne nf lw ng nh ni lz nj nk nl mc nm nn no mf np nq nr mi ns bi translated">2.在每台服务器上重新启动 mongod.service</h1><p id="1ea5" class="pw-post-body-paragraph ka kb in kc b kd nt kf kg kh nu kj kk kl nz kn ko kp oa kr ks kt ob kv kw kx ig bi translated">重启 MongoDB</p><blockquote class="oc od oe"><p id="c017" class="ka kb of kc b kd ke kf kg kh ki kj kk og km kn ko oh kq kr ks oi ku kv kw kx ig bi translated">$ sudo systemctl 重新启动 mongod.service</p></blockquote><p id="6423" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">验证 MongoDB 已经成功启动</p><blockquote class="oc od oe"><p id="84ab" class="ka kb of kc b kd ke kf kg kh ki kj kk og km kn ko oh kq kr ks oi ku kv kw kx ig bi translated">$ sudo 系统状态 mongod.service</p></blockquote><h1 id="bf2e" class="nc ls in bd lt nd ne nf lw ng nh ni lz nj nk nl mc nm nn no mf np nq nr mi ns bi translated">3.启动副本集</h1><p id="b70d" class="pw-post-body-paragraph ka kb in kc b kd nt kf kg kh nu kj kk kl nz kn ko kp oa kr ks kt ob kv kw kx ig bi translated">选择一台服务器启动副本集并连接到 mongo。我选择了服务器 1。</p><blockquote class="oc od oe"><p id="1dd8" class="ka kb of kc b kd ke kf kg kh ki kj kk og km kn ko oh kq kr ks oi ku kv kw kx ig bi translated">$ mongo 服务器 1-ip:27017</p></blockquote><p id="1730" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令的结果将如下图所示:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ot"><img src="../Images/8f509b4f78ef5cab223100727bdbf934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqIf0jaEy3b2eow-EXXXiA.png"/></div></div></figure><p id="40d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过运行以下命令初始化服务器 1 上的副本集:</p><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="e41e" class="lr ls in ok b gy oo op l oq or">rs.initiate({   _id : "ReplSet",   <br/>members: [{ _id: 0, host: "server1-ip:27017" },      <br/>          { _id: 1, host: "server2-ip:27017" }, <br/>          { _id: 2, host: "server3-ip:27017" }]})</span></pre><p id="58e1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你看到<strong class="kc io">“ok”:1</strong>，说明你安装成功。</p></div></div>    
</body>
</html>