<html>
<head>
<title>Gatsby.js — Scroll Position, Dynamic Navigation, and Link States</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —滚动位置、动态导航和链接状态</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/gatsby-js-scroll-position-dynamic-navigation-and-link-states-c272d7696112?source=collection_archive---------3-----------------------#2021-02-17">https://blog.devgenius.io/gatsby-js-scroll-position-dynamic-navigation-and-link-states-c272d7696112?source=collection_archive---------3-----------------------#2021-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/703e7385373903099f3b3310c4b41bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-HDW9vLtrSgt8R1y"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="269a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby是一个基于React的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Gatsby创建一个站点。</p><h1 id="9ae7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">卷轴修复</h1><p id="024b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用盖茨比恢复刷新后的滚动位置。</p><p id="7870" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7ab5" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import { useScrollRestoration } from "gatsby"</span><span id="cf43" class="mn lc iq mj b gy ms mp l mq mr">const IndexPage = () =&gt; {<br/>  const ulScrollRestoration = useScrollRestoration(`page-component-ul-list`)</span><span id="3956" class="mn lc iq mj b gy ms mp l mq mr">return (<br/>    &lt;ul style={{ height: 200, overflow: `auto` }} {...ulScrollRestoration}&gt;<br/>      {Array(100).fill().map((_, i) =&gt; i).map(n =&gt; (<br/>        &lt;li key={n}&gt;{n}&lt;/li&gt;<br/>      ))}<br/>    &lt;/ul&gt;<br/>  )<br/>}</span><span id="bd42" class="mn lc iq mj b gy ms mp l mq mr">export default IndexPage</span></pre><p id="29f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用带有<code class="fe mt mu mv mj b">'page-component-ul-list'</code>参数的<code class="fe mt mu mv mj b">useScrollRestoration</code>钩子来创建一个对象来恢复滚动位置。</p><p id="1794" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将该对象的属性作为<code class="fe mt mu mv mj b">ul</code>的道具，让我们恢复滚动位置。</p><h1 id="62af" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">道具的位置数据</h1><p id="f325" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以从道具中获取位置数据。</p><p id="df18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="c456" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">gatsby-config.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c4bb" class="mn lc iq mj b gy mo mp l mq mr">module.exports = {<br/>  siteMetadata: {<br/>    siteURL: 'http://example.com'<br/>  }<br/>}</span></pre><p id="1c75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/pages/foo.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d64d" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="0aa7" class="mn lc iq mj b gy ms mp l mq mr">const FooPage = ({ location, data }) =&gt; {<br/>  const canonicalUrl = data.site.siteMetadata.siteURL + location.pathname<br/>  return &lt;div&gt;The URL of this page is {canonicalUrl}&lt;/div&gt;<br/>}</span><span id="38f6" class="mn lc iq mj b gy ms mp l mq mr">export const query = graphql`<br/>  query PageQuery {<br/>    site {<br/>      siteMetadata {<br/>        siteURL<br/>      }<br/>    }<br/>  }<br/>`</span><span id="1840" class="mn lc iq mj b gy ms mp l mq mr">export default FooPage</span></pre><p id="9188" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过GraphQL查询从<code class="fe mt mu mv mj b">gatsby-config.js</code>中获得<code class="fe mt mu mv mj b">siteMetadata.siteURL</code>。</p><p id="e3c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们获取<code class="fe mt mu mv mj b">location</code>道具的<code class="fe mt mu mv mj b">pathname</code>属性来获取<code class="fe mt mu mv mj b">FooPage</code>的路径。</p><p id="7467" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们应该看到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c237" class="mn lc iq mj b gy mo mp l mq mr">The URL of this page is http://example.com/foo</span></pre><p id="e12c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们转到<a class="ae kc" href="http://localhost:8000/foo" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/foo</a>时显示。</p><h1 id="3fb0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">向链接组件提供状态</h1><p id="7a77" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以向一个<code class="fe mt mu mv mj b">Link</code>组件提供状态。</p><p id="52a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们写道:</p><p id="7516" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/pages/index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="78ae" class="mn lc iq mj b gy mo mp l mq mr">import { Link } from "gatsby"<br/>import React from "react"</span><span id="bf26" class="mn lc iq mj b gy ms mp l mq mr">const IndexPage = () =&gt; {<br/>  return &lt;&gt;<br/>    &lt;div&gt;hello world&lt;/div&gt;<br/>    &lt;Link<br/>      to={'/foo'}<br/>      state={{ id: 1 }}<br/>    &gt;<br/>      go to foo<br/>    &lt;/Link&gt;<br/>  &lt;/&gt;<br/>}</span><span id="3924" class="mn lc iq mj b gy ms mp l mq mr">export default IndexPage</span></pre><p id="0b34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/pages/foo.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6122" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"</span><span id="8a4b" class="mn lc iq mj b gy ms mp l mq mr">const FooPage = ({ location }) =&gt; {<br/>  const { state = {} } = location<br/>  const { id } = state<br/>  return &lt;div&gt;id: {id}&lt;/div&gt;<br/>}</span><span id="c45c" class="mn lc iq mj b gy ms mp l mq mr">export default FooPage</span></pre><p id="1a4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将一个对象传递到<code class="fe mt mu mv mj b">state</code>道具中。</p><p id="a225" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mt mu mv mj b">FooPage</code>中，我们获取<code class="fe mt mu mv mj b">location</code>道具的<code class="fe mt mu mv mj b">state.id</code>属性来获取我们传递给<code class="fe mt mu mv mj b">state</code>道具的<code class="fe mt mu mv mj b">id</code>属性。</p><h1 id="c179" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">动态导航</h1><p id="a9ba" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Gatsby动态添加导航。</p><p id="8db3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2cc4" class="mn lc iq mj b gy mo mp l mq mr">module.exports = {<br/>  siteMetadata: {<br/>    title: 'Gatsby Starter',<br/>    menuLinks: [<br/>      {<br/>        name: 'home',<br/>        link: '/'<br/>      },<br/>      {<br/>        name: 'foo',<br/>        link: '/foo'<br/>      }<br/>    ]<br/>  },<br/>  plugins: []<br/>}</span></pre><p id="2b9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/components/layout.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3261" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>const { StaticQuery, Link } = require("gatsby");</span><span id="6649" class="mn lc iq mj b gy ms mp l mq mr">const Header = ({ siteTitle, menuLinks }) =&gt; (<br/>  &lt;header<br/>    style={{<br/>      background: "green",<br/>      marginBottom: "1.45rem",<br/>    }}<br/>  &gt;<br/>    &lt;div&gt;<br/>      &lt;h1 style={{ margin: 5, flex: 1 }}&gt;<br/>        &lt;Link<br/>          to="/"<br/>          style={{<br/>            color: "white",<br/>            textDecoration: "none",<br/>          }}<br/>        &gt;<br/>          {siteTitle}<br/>        &lt;/Link&gt;<br/>      &lt;/h1&gt;<br/>      &lt;div&gt;<br/>        &lt;nav&gt;<br/>          &lt;ul style={{ display: "flex", flex: 1 }}&gt;<br/>            {menuLinks.map(link =&gt; (<br/>              &lt;li<br/>                key={link.name}<br/>                style={{<br/>                  listStyleType: `none`,<br/>                  padding: `1rem`,<br/>                }}<br/>              &gt;<br/>                &lt;Link style={{ color: `white` }} to={link.link}&gt;<br/>                  {link.name}<br/>                &lt;/Link&gt;<br/>              &lt;/li&gt;<br/>            ))}<br/>          &lt;/ul&gt;<br/>        &lt;/nav&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/header&gt;<br/>)</span><span id="e84c" class="mn lc iq mj b gy ms mp l mq mr">const Layout = ({ children }) =&gt; (<br/>  &lt;StaticQuery<br/>    query={graphql`<br/>        query SiteTitleQuery {<br/>          site {<br/>            siteMetadata {<br/>              title<br/>              menuLinks {<br/>                name<br/>                link<br/>              }<br/>            }<br/>          }<br/>        }<br/>      `}<br/>    render={data =&gt; (<br/>      &lt;&gt;<br/>        &lt;Header menuLinks={data.site.siteMetadata.menuLinks} siteTitle={data.site.siteMetadata.title} /&gt;<br/>        &lt;div<br/>          style={{<br/>            margin: '0 auto',<br/>            maxWidth: 960,<br/>            padding: '0px 1.0875rem 1.45rem',<br/>            paddingTop: 0,<br/>          }}<br/>        &gt;<br/>          {children}<br/>        &lt;/div&gt;<br/>      &lt;/&gt;<br/>    )}<br/>  /&gt;<br/>)</span><span id="43cc" class="mn lc iq mj b gy ms mp l mq mr">export default Layout;</span></pre><p id="6ff9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/pages/index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="09bd" class="mn lc iq mj b gy mo mp l mq mr">import { Link } from "gatsby"<br/>import React from "react"<br/>import Layout from "../components/layout"</span><span id="8f02" class="mn lc iq mj b gy ms mp l mq mr">const IndexPage = () =&gt; {<br/>  return &lt;&gt;<br/>    &lt;Layout&gt;<br/>      &lt;div&gt;hello world&lt;/div&gt;<br/>    &lt;/Layout&gt;<br/>  &lt;/&gt;<br/>}</span><span id="d90d" class="mn lc iq mj b gy ms mp l mq mr">export default IndexPage</span></pre><p id="5394" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">src/pages/foo.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2d04" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import Layout from "../components/layout"</span><span id="d3d1" class="mn lc iq mj b gy ms mp l mq mr">const FooPage = () =&gt; {<br/>  return &lt;div&gt;<br/>    &lt;Layout&gt;<br/>      &lt;div&gt;foo&lt;/div&gt;<br/>    &lt;/Layout&gt;<br/>  &lt;/div&gt;<br/>}</span><span id="d2c0" class="mn lc iq mj b gy ms mp l mq mr">export default FooPage</span></pre><p id="e1a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">menuLinks</code>数组添加到<code class="fe mt mu mv mj b">gatsby-config.js</code>中，为链接添加数据。</p><p id="54d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mt mu mv mj b">layout.js</code>中，我们获取链接数据，然后渲染它们。</p><p id="60e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">Header</code>组件接受<code class="fe mt mu mv mj b">siteTitle</code>和<code class="fe mt mu mv mj b">menuLinks</code>道具，并将数据呈现到HTML中。</p><p id="8632" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">siteTitle</code>拥有站点的标题。</p><p id="45fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">menuLinks</code>是我们从<code class="fe mt mu mv mj b">gatsby-config.js</code>的<code class="fe mt mu mv mj b">menuLinks</code>属性中得到的一组数据。</p><p id="8017" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mt mu mv mj b">Layout</code>组件中，我们添加了<code class="fe mt mu mv mj b">StaticQuery</code>组件来查询菜单链接数据。</p><p id="a429" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">render</code>属性在<code class="fe mt mu mv mj b">data</code>参数中有查询的结果。</p><p id="2b08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">Header</code>组件呈现链接和标题。</p><p id="39b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">div</code>拥有我们在<code class="fe mt mu mv mj b">Layout</code>组件标签中拥有的子组件。</p><h1 id="85f8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2fb8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用盖茨比刷新后恢复滚动位置。</p><p id="1f59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另外，我们可以从道具中获取位置数据。</p><p id="aa71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从网站的元数据中动态创建链接。</p></div></div>    
</body>
</html>