<html>
<head>
<title>Getting started with Azure Synapse Analytics for beginners(Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初学者的 Azure Synapse 分析入门(第 3 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/getting-started-with-azure-synapse-analytics-for-beginners-part-3-6c90d5be2d1?source=collection_archive---------8-----------------------#2022-11-23">https://blog.devgenius.io/getting-started-with-azure-synapse-analytics-for-beginners-part-3-6c90d5be2d1?source=collection_archive---------8-----------------------#2022-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ae9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure 教程</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b84ed61da67bbfcbfa9c37bab1754758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hvdMeKoRAR84Vxd8.png"/></div></div></figure><p id="edc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，您将学习:</p><ul class=""><li id="502c" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">如何创建 blob 存储？</li><li id="1773" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">使用 python 脚本在 Postgres 上创建一个新的数据库。</li><li id="94b5" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">在 Synapse 上为 Postgres 创建链接服务。</li></ul><h1 id="62e1" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">先决条件:</h1><p id="27fb" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">要完成本教程中的步骤，您需要满足下面给出的先决条件</p><ul class=""><li id="c1be" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">你可以通过这个<a class="ae mo" href="https://azure.microsoft.com/en-us/free/" rel="noopener ugc nofollow" target="_blank">链接</a>创建一个免费账户。</li><li id="6397" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">synapse workspace，可以找到创建 synapse 的步骤。工作区<a class="ae mo" href="https://medium.com/@ansam.yousry/getting-started-with-azure-synapse-analytics-for-beginners-part-1-1822a9015586" rel="noopener">这里</a>。</li><li id="f9e4" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">专用的 SQL 池，你可以在这里找到步骤<a class="ae mo" href="https://medium.com/@ansam.yousry/getting-started-with-azure-synapse-analytics-for-beginners-part-1-1822a9015586" rel="noopener"/>。</li><li id="df5b" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">PostgreSQL，用数据创建 DB 和表，这里可以找到步骤<a class="ae mo" href="https://medium.com/@ansam.yousry/getting-started-with-azure-synapse-analytics-for-beginners-part-2-1cc188239131" rel="noopener">。</a></li></ul></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="371e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建 blob 存储:</strong></p><p id="9422" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择您的订阅和资源组</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/30d2b021bf5ebec199b2dbc14220c156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wt90eOEzyekm1TC-xly1AA.png"/></div></div></figure><p id="2d49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为存储帐户提供一个唯一的名称，并选择离您最近的地区。</p><p id="fdc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择本地冗余，因为它比全局冗余更便宜，并且在我们的教程中，本地冗余将满足我们的要求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/f0f4570bc877dd1b6805becea93001bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7Jr_nEv8C_VEJfGynx84g.png"/></div></div></figure><p id="38ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启用“分层名称空间”选项，并将其余选项保持为默认设置，如“仅创建”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/75e35d8d4add780eff3cd766dd55c57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuDtGwf8v1TNV0Z33M_Pmw.png"/></div></div></figure><h1 id="4f46" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">blob 存储的链接服务:</h1><p id="a3a0" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">现在，我们需要为 blob 存储创建链接服务，因此转到“管理”选项卡，并在(<strong class="jp ir">外部连接</strong>部分，<strong class="jp ir">链接服务</strong>)中，单击“新建”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/84523fbd942efa4a12ef22885281b8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3101gB3Ggmbh0oCg1yqs8w.png"/></div></div></figure><p id="2107" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索 blob 存储，如图所示</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi na"><img src="../Images/557e26ce4bdbfab40e257f9a4c7db1e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*Ka3L5KuZ-IgfBJ-yueQTZQ.png"/></div></figure><p id="97ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择您的订阅和存储帐户，并测试连接。如果成功，请单击“创建”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/aecb4537854b4c5253c5897e86d940e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*CRM5Ed1lzXzayeDHXmW96g.png"/></div></figure><p id="d0bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有 4 个链接的服务，如果有什么遗漏，请查看<a class="ae mo" href="https://medium.com/@ansam.yousry/getting-started-with-azure-synapse-analytics-for-beginners-part-1-1822a9015586" rel="noopener">教程第 1 部分</a>和<a class="ae mo" href="https://medium.com/@ansam.yousry/getting-started-with-azure-synapse-analytics-for-beginners-part-2-1cc188239131" rel="noopener">教程第 2 部分</a>。</p><h1 id="7344" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用 Azure Synapse 创建临时表:</h1><p id="7ceb" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在“管理”选项卡和“SQL 池”下，确保您的专用 SQL 池处于在线状态。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/e88d0e63a17a7751f4d66dbdde21fb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5bC-cPJBLOE1XJNrom8oA.png"/></div></div></figure><p id="1f67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后转到 data 选项卡，在 External tables 下，您可以上传想要加载到 Azure SQL DB 中的文件。在本教程中，我们上传了 CSV 文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/861dfbf255e7a1d1176016bb7def2248.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YK_T1FIh2_PFFp5r3Y1cGg.png"/></div></div></figure><p id="1e96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，我们上传了 riders.csv</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi na"><img src="../Images/aca2ca1cb8d47a0c49b57d68619dc48b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*lxK4hoLhMacjdjYa4Z0ysA.png"/></div></figure><p id="b4b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们想创建一个外部表，将 CSV 文件的数据加载到其中。因此，在“数据”选项卡和“链接”部分，您可以创建一个外部表，如下所示。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/bfc841fc6954cbeb8da0056ae8d34790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZBIoqWio_cxkVMb-bXYd-A.png"/></div></div></figure><p id="bb9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择 SQL 池和数据库，并为外部表命名，然后点击打开脚本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/f8326a1d8524e511970ff684e482c44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*drMjQAhUBiLo9BQgTEgCow.png"/></div></figure><p id="670d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如下所示，脚本是自动创建的，您可以对其进行一些更改。在本教程中，我们将更改列名和一些列的数据类型。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/6992038b8951f81e32f651143ac12ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*wqSp9frf0PQanb3NIDwWog.png"/></div></figure><p id="ca97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们使用的 SQL 脚本，注意我们编写了<strong class="jp ir">创建外部表</strong>，并更改了列名和数据类型。</p><pre class="km kn ko kp gt nh ni nj bn nk nl bi"><span id="1af6" class="nm lm iq ni b be nn no l np nq">IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseDelimitedTextFormat') <br/> CREATE EXTERNAL FILE FORMAT [SynapseDelimitedTextFormat] <br/> WITH ( FORMAT_TYPE = DELIMITEDTEXT ,<br/>        FORMAT_OPTIONS (<br/>    FIELD_TERMINATOR = ',',<br/>    USE_TYPE_DEFAULT = FALSE<br/>   ))<br/><br/>GO<br/><br/>IF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'datalakefile_datalakeacc2_dfs_core_windows_net') <br/> CREATE EXTERNAL DATA SOURCE [datalakefile_datalakeacc2_dfs_core_windows_net] <br/> WITH (<br/>  LOCATION = 'abfss://datalakefile@datalakeacc2.dfs.core.windows.net', <br/>  TYPE = HADOOP <br/> )<br/>GO<br/><br/>CREATE EXTERNAL TABLE staging_riders (<br/> [rider_id] bigint,<br/> [first_name] nvarchar(4000),<br/> [last_name] nvarchar(4000),<br/> [address] nvarchar(4000),<br/> [birthdate] varchar(50),<br/> [account_start_date] varchar(50),<br/> [account_end_date] varchar(50),<br/> [is_member] varchar(50)<br/> )<br/> WITH (<br/> LOCATION = 'riders.csv',<br/> DATA_SOURCE = [datalakefile_datalakeacc2_dfs_core_windows_net],<br/> FILE_FORMAT = [SynapseDelimitedTextFormat]<br/> )<br/>GO<br/><br/><br/>SELECT TOP 100 * FROM dbo.staging_riders<br/>GO</span></pre><p id="b767" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行上述脚本后的结果看起来不错。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/3d37a6af84d7a0e7c7a87f989377c0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bUWb8Q1Sn1eKZSegZpJnQ.png"/></div></div></figure><p id="5d70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您转到工作区并在外部表下，您会发现表已创建。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f8b32e044216f5025fdf760cf04b7e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*679T5JCXBw4XxUs7KL-JTw.png"/></div></figure><p id="e4bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们需要做一些转换并把它加载到一个新表中。我们可以转到开发选项卡并创建一个新的 SQL 脚本。并使用您想要进行的更改编写一个新脚本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/6419772108ffe01e087e15cfaca63399.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*uCfoWucniT4lDkqiAmgTZw.png"/></div></figure><p id="46f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在这里看到的，我们用新的数据类型创建了一个新表。将转换后的数据插入到新表中(将数据类型 birthdate、account_start_date 和 account_end_date 从 varchar 转换为 date)</p><pre class="km kn ko kp gt nh ni nj bn nk nl bi"><span id="4d5c" class="nm lm iq ni b be nn no l np nq">CREATE table rider (<br/>    account_number integer<br/>    ,first_name varchar(50)<br/>    ,last_name varchar(50)<br/>    ,adress varchar(50)<br/>    ,birthday date<br/> ,is_member bit <br/>    ,account_start_date DATE<br/>    ,account_end_date DATE<br/>)<br/><br/>GO;<br/><br/>insert into rider (account_number,first_name,last_name,adress,birthday,is_member,account_start_date,account_end_date)<br/>select rider_id,first_name,last_name,address,try_convert(date,left(birthdate,10))as birthday  ,is_member,try_convert(date,left(account_start_date,10)) as account_start_date ,try_convert(date,left(account_end_date,10)) as account_end_date<br/>from staging_riders<br/><br/>GO;<br/><br/>select top 100 * from rider<br/><br/>GO;</span></pre><p id="cc58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行脚本后，我们将得到下面的结果，我们可以检查它，以确保一切正常。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/3e0f6e8e70f77635af25d03c9ea06b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zlNOJQTltj4BAHlerjaKYQ.png"/></div></div></figure><h1 id="a4b6" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">包扎</h1><p id="3d48" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在本教程中，您学习了如何:</p><ul class=""><li id="ba02" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">创建 blob 存储。</li><li id="28d6" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">使用 python 脚本在 Postgres 上创建一个新的数据库。</li><li id="ad7d" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">在 Synapse 上为 Postgres 创建链接服务。</li></ul><p id="a024" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢阅读这篇文章，并发现它内容丰富。。请随意添加您的评论、想法或反馈，不要忘记联系<a class="ae mo" href="https://www.linkedin.com/in/ansam-yousry-34b32b116/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或关注我的媒体账户以保持更新。</p></div></div>    
</body>
</html>