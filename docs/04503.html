<html>
<head>
<title>Create Voronoi Diagrams with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Visx 库创建 Voronoi 图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-graphics-with-voronoi-diagram-with-the-visx-library-27fc1b4ddf67?source=collection_archive---------5-----------------------#2021-03-25">https://blog.devgenius.io/create-graphics-with-voronoi-diagram-with-the-visx-library-27fc1b4ddf67?source=collection_archive---------5-----------------------#2021-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7d8af8dd529e36e188100c9e9dca92f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h8Jh5selSj9kq93f"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">约翰·西门子在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="cc78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx 是一个库，让我们可以轻松地将图形添加到 React 应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Voronoi 图是由平面中的分区组成的图。</p><p id="5429" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何使用它来添加 Voronoi 图到我们的 React 应用程序中。</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/clip-path @visx/event @visx/gradient @visx/group @visx/responsive @visx/voronoi </span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="4761" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建图表</h1><p id="04ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加模块提供的项目来创建图表。</p><p id="7bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用来自<code class="fe ms mt mu mj b">@visx/mock-data</code>模块的数据。</p><p id="7fee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建 Voronoi 图，我们写下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="57ba" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState, useMemo, useRef } from "react";<br/>import { Group } from "@visx/group";<br/>import { GradientOrangeRed, GradientPinkRed } from "@visx/gradient";<br/>import { RectClipPath } from "@visx/clip-path";<br/>import { voronoi, VoronoiPolygon } from "@visx/voronoi";<br/>import { localPoint } from "@visx/event";</span><span id="add3" class="mn lc iq mj b gy mv mp l mq mr">const data = new Array(150).fill(null).map(() =&gt; ({<br/>  x: Math.random(),<br/>  y: Math.random(),<br/>  id: Math.random().toString(36).slice(2)<br/>}));</span><span id="8fa2" class="mn lc iq mj b gy mv mp l mq mr">const neighborRadius = 75;</span><span id="2daf" class="mn lc iq mj b gy mv mp l mq mr">const defaultMargin = {<br/>  top: 0,<br/>  left: 0,<br/>  right: 0,<br/>  bottom: 76<br/>};</span><span id="de11" class="mn lc iq mj b gy mv mp l mq mr">const Example = ({ width, height, margin = defaultMargin }) =&gt; {<br/>  const innerWidth = width - margin.left - margin.right;<br/>  const innerHeight = height - margin.top - margin.bottom;</span><span id="56c6" class="mn lc iq mj b gy mv mp l mq mr">const voronoiLayout = useMemo(<br/>    () =&gt;<br/>      voronoi({<br/>        x: (d) =&gt; d.x * innerWidth,<br/>        y: (d) =&gt; d.y * innerHeight,<br/>        width: innerWidth,<br/>        height: innerHeight<br/>      })(data),<br/>    [innerWidth, innerHeight]<br/>  );</span><span id="7a28" class="mn lc iq mj b gy mv mp l mq mr">const polygons = voronoiLayout.polygons();<br/>  const svgRef = useRef(null);<br/>  const [hoveredId, setHoveredId] = useState(null);<br/>  const [neighborIds, setNeighborIds] = useState(new Set());</span><span id="1f64" class="mn lc iq mj b gy mv mp l mq mr">  return width &lt; 10 ? null : (<br/>    &lt;svg width={width} height={height} ref={svgRef}&gt;<br/>      &lt;GradientOrangeRed id="voronoi_orange_red" /&gt;<br/>      &lt;GradientPinkRed id="voronoi_pink_red" /&gt;<br/>      &lt;RectClipPath<br/>        id="voronoi_clip"<br/>        width={innerWidth}<br/>        height={innerHeight}<br/>        rx={14}<br/>      /&gt;<br/>      &lt;Group<br/>        top={margin.top}<br/>        left={margin.left}<br/>        clipPath="url(#voronoi_clip)"<br/>        onMouseMove={(event) =&gt; {<br/>          if (!svgRef.current) return;</span><span id="5a92" class="mn lc iq mj b gy mv mp l mq mr">const point = localPoint(svgRef.current, event);<br/>          if (!point) return;</span><span id="b9ce" class="mn lc iq mj b gy mv mp l mq mr">const closest = voronoiLayout.find(point.x, point.y, neighborRadius);<br/>          if (closest &amp;&amp; closest.data.id !== hoveredId) {<br/>            const neighbors = new Set();<br/>            const cell = voronoiLayout.cells[closest.index];<br/>            if (!cell) return;</span><span id="55b7" class="mn lc iq mj b gy mv mp l mq mr">cell.halfedges.forEach((index) =&gt; {<br/>              const edge = voronoiLayout.edges[index];<br/>              const { left, right } = edge;<br/>              if (left &amp;&amp; left !== closest) neighbors.add(left.data.id);<br/>              else if (right &amp;&amp; right !== closest) neighbors.add(right.data.id);<br/>            });</span><span id="d384" class="mn lc iq mj b gy mv mp l mq mr">setNeighborIds(neighbors);<br/>            setHoveredId(closest.data.id);<br/>          }<br/>        }}<br/>        onMouseLeave={() =&gt; {<br/>          setHoveredId(null);<br/>          setNeighborIds(new Set());<br/>        }}<br/>      &gt;<br/>        {polygons.map((polygon) =&gt; (<br/>          &lt;VoronoiPolygon<br/>            key={`polygon-${polygon.data.id}`}<br/>            polygon={polygon}<br/>            fill={<br/>              hoveredId &amp;&amp;<br/>              (polygon.data.id === hoveredId ||<br/>                neighborIds.has(polygon.data.id))<br/>                ? "url(#voronoi_orange_red)"<br/>                : "url(#voronoi_pink_red)"<br/>            }<br/>            stroke="#fff"<br/>            strokeWidth={1}<br/>            fillOpacity={<br/>              hoveredId &amp;&amp; neighborIds.has(polygon.data.id) ? 0.5 : 1<br/>            }<br/>          /&gt;<br/>        ))}<br/>        {data.map(({ x, y, id }) =&gt; (<br/>          &lt;circle<br/>            key={`circle-${id}`}<br/>            r={2}<br/>            cx={x * innerWidth}<br/>            cy={y * innerHeight}<br/>            fill={id === hoveredId ? "fuchsia" : "#fff"}<br/>            fillOpacity={0.8}<br/>          /&gt;<br/>        ))}<br/>      &lt;/Group&gt;<br/>    &lt;/svg&gt;<br/>  );<br/>};</span><span id="157e" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="40d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe ms mt mu mj b">data</code>数组为图表创建数据。</p><p id="e99e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">x</code>和<code class="fe ms mt mu mj b">y</code>属性用于分区的 x 和 y 坐标。</p><p id="a062" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe ms mt mu mj b">id</code>是每个分区的唯一 ID。</p><p id="a3b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">neighborhoodRadius</code>具有当我们将鼠标悬停在一个分区上时高亮显示的分区的半径。</p><p id="02b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">defaultMargin</code>具有图表的默认边距。</p><p id="2945" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Example</code>组件有 Voronoi 图。</p><p id="b851" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过计算图表的<code class="fe ms mt mu mj b">innerWidth</code>和<code class="fe ms mt mu mj b">innerHeight</code>来计算图表的显示面积。</p><p id="db9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">voronoiLayout</code>变量根据图的维度计算分区布局。</p><p id="607d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">polygons</code>变量包含分区的多边形。</p><p id="a819" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们添加<code class="fe ms mt mu mj b">GradientOrangeRed</code>来突出显示我们悬停的分区。</p><p id="2579" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">GradientPinkRed</code>具有分区的正常颜色渐变。</p><p id="031c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">Group</code>组件中，我们通过<code class="fe ms mt mu mj b">polygons.map</code>调用创建分区多边形。</p><p id="6fb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">onMouseMove</code>处理程序中，我们检查是否有任何带有<code class="fe ms mt mu mj b">closest</code>变量的相邻多边形，该变量由<code class="fe ms mt mu mj b">voronoiLayout.find</code>调用生成。</p><p id="774f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用它来生成<code class="fe ms mt mu mj b">cell</code>变量，我们用它来向<code class="fe ms mt mu mj b">neighbord</code>对象添加多边形来突出显示相邻的分区。</p><p id="4ae7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回带有填充颜色的 ID 的<code class="fe ms mt mu mj b">VoronoiPolygon</code>组件。</p><p id="a3ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe ms mt mu mj b">x</code>和<code class="fe ms mt mu mj b">y</code>坐标在每个多边形的中心显示一个点。</p><h1 id="7fcc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="dcc4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用 Visx 库在 React 应用程序中轻松创建 Voronoi 图。</p></div></div>    
</body>
</html>