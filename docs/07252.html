<html>
<head>
<title>[Golang] What is init() in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Golang]Golang 中的 init()是什么</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/what-is-init-in-golang-b806caa52822?source=collection_archive---------6-----------------------#2022-03-09">https://blog.devgenius.io/what-is-init-in-golang-b806caa52822?source=collection_archive---------6-----------------------#2022-03-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="21ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">顾名思义,<code class="fe ki kj kk kl b">init()</code>用于用程序生命周期中可能需要的东西来初始化你的程序。<code class="fe ki kj kk kl b">init()</code>可用于各种用例。其中一些可能是</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/5dcc3f8adf8ff1a1d7dc9161a00cda4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cCMMMAKWxbf3e2kDpvlJCQ.png"/></div></div></figure><h2 id="fab2" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated">例如:</h2><ol class=""><li id="743d" class="lr ls in jm b jn lt jr lu jv lv jz lw kd lx kh ly lz ma mb bi translated"><em class="mc">建立数据库连接</em></li><li id="7267" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated"><em class="mc">导出云凭据</em></li><li id="022a" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated"><em class="mc">获取一些静态配置文件供您的程序使用</em></li><li id="692c" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated"><em class="mc">为你的程序设置一些环境变量</em></li><li id="6431" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated"><em class="mc">为你的程序定义一些全局的东西要用</em><strong class="jm io"><em class="mc"/></strong><code class="fe ki kj kk kl b"><strong class="jm io"><em class="mc">package</em></strong></code></li><li id="af47" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated"><em class="mc">初始化</em>T3 的日志和日志级别</li></ol><p id="04f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在你的程序中使用<code class="fe ki kj kk kl b">init()</code>会有更多的用例。以上只是我能想到的几个例子。</p><h2 id="7b40" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><code class="fe ki kj kk kl b">init()</code>功能的一些关键属性:</h2><ol class=""><li id="91a1" class="lr ls in jm b jn lt jr lu jv lv jz lw kd lx kh ly lz ma mb bi translated">范围仅限于<strong class="jm io">包块</strong></li><li id="43e3" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated">只能调用<strong class="jm io">一次</strong></li><li id="cc73" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated">如果需要，根据<strong class="jm io">封装基础</strong>定义<code class="fe ki kj kk kl b">init()</code></li><li id="4500" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated">Go 支持同一个<strong class="jm io">包</strong>内的多个<code class="fe ki kj kk kl b">init()</code>功能，但是，执行的顺序是<strong class="jm io">计算出来的</strong></li><li id="9f29" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated">Go 为我们隐式地处理了<code class="fe ki kj kk kl b">init()</code>函数的执行</li><li id="bca4" class="lr ls in jm b jn md jr me jv mf jz mg kd mh kh ly lz ma mb bi translated">这个函数既不接受参数也不返回任何值</li></ol></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="2c2e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mc">根据定义</em> <code class="fe ki kj kk kl b"><em class="mc">init()</em></code> <em class="mc">可以用来定义或初始化</em> <strong class="jm io"> <em class="mc">包内的任何东西。</em> </strong> <em class="mc">通常，</em> <strong class="jm io"> <em class="mc">事情</em> </strong> <em class="mc">在你的程序的生命周期中需要或者将要需要一次</em></p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="af90" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可能已经注意到，我一直在用<strong class="jm io">粗体</strong>说明<strong class="jm io">在包装内</strong>。背后的原因是，任何初始化的、建立的东西都是在包的范围内导出的，它们不能在包之外被访问。要了解关于 Go 包初始化的更多信息，请参考<a class="ae mp" href="https://go.dev/ref/spec#Package_initialization" rel="noopener ugc nofollow" target="_blank">官方文档</a></p><p id="da56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这意味着我们可以在我们的程序中分别为每个<strong class="jm io">包</strong>定义<code class="fe ki kj kk kl b">init()</code>函数，如果我们看到需求和<code class="fe ki kj kk kl b">init()</code>函数将被调用一次，不管这个包被导入了多少次。<code class="fe ki kj kk kl b">init()</code>可以在包中的任何<code class="fe ki kj kk kl b">Go</code>文件中定义，<code class="fe ki kj kk kl b">Go</code>会自动运行。</p><h2 id="3d28" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated">多重<code class="fe ki kj kk kl b">init()</code>功能</h2><p id="0a78" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated">可以在一个文件或<strong class="jm io">包</strong>中定义多个<code class="fe ki kj kk kl b">init()</code>功能。执行顺序将决定为<code class="fe ki kj kk kl b">init()</code>函数的声明顺序。</p><p id="bd3e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据<a class="ae mp" href="https://golang.org/ref/spec#Package_initialization" rel="noopener ugc nofollow" target="_blank">包初始化</a>的 Go 语言规范，当一个包中遇到多个文件时，按字母顺序处理。因此，如果你在包内的多个文件中定义了多个<code class="fe ki kj kk kl b">init()</code>函数，那么<strong class="jm io">要注意文件名。</strong></p><p id="ab17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">例如:</strong></p><pre class="kn ko kp kq gt mt kl mu mv aw mw bi"><span id="c04f" class="ky kz in kl b gy mx my l mz na">package main</span><span id="012d" class="ky kz in kl b gy nb my l mz na">import (<br/>    "fmt"<br/>)</span><span id="b46f" class="ky kz in kl b gy nb my l mz na">var Var1 string<br/>var Var2 string</span><span id="d6a9" class="ky kz in kl b gy nb my l mz na">func init(){<br/>    fmt.Println("First Init Function Called")<br/>    Var1 = initialize()<br/>}</span><span id="cf42" class="ky kz in kl b gy nb my l mz na">func init(){<br/>    fmt.Println("Second Init Function Called")<br/>    Var2 = Var1<br/>}</span><span id="57f9" class="ky kz in kl b gy nb my l mz na">func main(){<br/>    fmt.Printf("Going by the order and printing value of Var2: [%s]\n", Var2)<br/>}</span><span id="c01b" class="ky kz in kl b gy nb my l mz na">func initialize() string {<br/>    var e string<br/>    e = "Executed by Init Function"<br/>    return e<br/>}</span></pre><p id="1b62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结果:</strong></p><pre class="kn ko kp kq gt mt kl mu mv aw mw bi"><span id="44fd" class="ky kz in kl b gy mx my l mz na">&gt; go run initFunctions.go<br/>First Init Function Called<br/>Second Init Function Called<br/>Going by the order and printing value of Var2: [Executed by Init Function]</span></pre><h1 id="b2d8" class="nc kz in bd la nd ne nf ld ng nh ni lg nj nk nl lj nm nn no lm np nq nr lp ns bi translated">使用<code class="fe ki kj kk kl b">init()</code>治疗副作用</h1><p id="273c" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated">有时我们只需要包处于某个特定的状态，然而，我们可能无论如何都不会在程序中使用包的其余部分。这种类型的导入被称为<em class="mc">副作用导入。</em></p><p id="355a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"><em class="mc">TL；dr:可能你是因为它的</em> </strong> <code class="fe ki kj kk kl b"><strong class="jm io"><em class="mc">init()</em></strong></code> <strong class="jm io"> <em class="mc">功能</em> </strong>才导入的</p><pre class="kn ko kp kq gt mt kl mu mv aw mw bi"><span id="bb8e" class="ky kz in kl b gy mx my l mz na">import <!-- -->_ "github.com/go-sql-driver/mysql"</span></pre><p id="4f95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Go 非常严格，不允许引用未使用的包。然而，您执行<code class="fe ki kj kk kl b">init()</code>的需求需要导入该包来进行一些<strong class="jm io">初始化。</strong>这就是我们使用<a class="ae mp" href="https://golang.org/ref/spec#Blank_identifier" rel="noopener ugc nofollow" target="_blank">空白标识符</a>(即<code class="fe ki kj kk kl b">_</code>)来解决这个问题的地方。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="08e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">软件包的<code class="fe ki kj kk kl b">init()</code>功能是一个方便的工具，有时是必要的，但不应该过度使用。有时需要重新初始化，不能重新调用<code class="fe ki kj kk kl b">init()</code>。</p><p id="5d0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以应该总是尝试使用显式调用，这样可以为你初始化一些东西，但是要知道有<code class="fe ki kj kk kl b">init()</code>可以用于一些琐碎的事情</p><h1 id="bc1d" class="nc kz in bd la nd ne nf ld ng nh ni lg nj nk nl lj nm nn no lm np nq nr lp ns bi translated">编码快乐！！</h1></div></div>    
</body>
</html>