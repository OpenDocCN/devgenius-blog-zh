<html>
<head>
<title>Apache Storm on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">库伯内特岛上的阿帕奇风暴</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/apache-storm-on-kubernetes-b0cda6b39546?source=collection_archive---------5-----------------------#2022-06-05">https://blog.devgenius.io/apache-storm-on-kubernetes-b0cda6b39546?source=collection_archive---------5-----------------------#2022-06-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="7817" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如今，当您谈到开源流处理技术时，大多是 Apache Spark、Apache Flink 或 Apache Beam。然而，在过去，有一种叫做 Apache Storm 的技术，许多企业今天仍在使用这种技术，你不能一下子把它们全部转换过来。这项技术是遗留的，似乎主要的云提供商没有很好地提供支持(Azure HDInsight 3.6 <a class="ae ki" href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-36-component-versioning" rel="noopener ugc nofollow" target="_blank"> storm </a>(仅 1.1 版本)，在<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/hdinsight/storm/migrate-storm-to-spark" rel="noopener ugc nofollow" target="_blank"> HDInsight 4.0 </a>、<a class="ae ki" href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hadoop.html" rel="noopener ugc nofollow" target="_blank">甚至没有提到 AWS EMR 上的 Storm </a>和 GCP <a class="ae ki" href="https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/cluster-properties" rel="noopener ugc nofollow" target="_blank"> Dataproc </a>上的 Apache storm。)而 Kubernetes 上的<a class="ae ki" href="https://github.com/kubernetes/examples/blob/master/staging/storm/README.md" rel="noopener ugc nofollow" target="_blank">部署</a>是 2018 年才更新的。</p><p id="e5cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么开发人员需要如何在 Apache Storm 上快速入门学习环境呢？我将在这篇文章中展示我的发现。</p><h1 id="b1fe" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">阿帕奇风暴</h1><div class="lh li gp gr lj lk"><a href="https://www.simplilearn.com/tutorials/big-data-tutorial/apache-strom" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">Apache Storm:数据模型、架构和组件</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">Apache Storm 是一个实时流处理系统，在这个 Apache Storm 教程中，您将了解到它的全部内容…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">www.simplilearn.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly lz lk"/></div></div></a></div><div class="lh li gp gr lj lk"><a href="https://docs.microsoft.com/en-us/azure/hdinsight/storm/apache-storm-overview" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">什么是 Apache Storm - Azure HDInsight</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">Apache Storm 允许您实时处理数据流。Azure HDInsight 允许您轻松创建 Storm…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">docs.microsoft.com</p></div></div><div class="lt l"><div class="ma l lv lw lx lt ly lz lk"/></div></div></a></div><h1 id="9e43" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">成分</h1><p id="7763" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">Apache Storm 中的主要组件有:</p><p id="aa99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">光轮:主节点</p><p id="7a84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">主管:员工/执行者节点</p><p id="fb72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">动物园管理员:Nimbus 和管理员之间的所有协调都是通过动物园管理员集群完成的</p><p id="fb2e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">UI:像 Spark UI 一样，您可以看到拓扑、节点</p><p id="a72d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">拓扑:拓扑是计算的图形(像<a class="ae ki" href="https://data-flair.training/blogs/dag-in-apache-spark/" rel="noopener ugc nofollow" target="_blank"> Spark DAG </a>)</p><h1 id="2b70" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">部署风暴</h1><p id="2f03" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">有一个非官方的阿帕奇风暴舵图。我选择 OpenShift (RedHat 企业版 Kubernetes)部署 Storm。</p><p id="74e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">掌舵图不是为 OpenShift 构建的，所以容器映像使用的是 root 用户。因为默认情况下，OpenShift 不允许任何 serviceaccount 运行特权容器，所以我们必须<a class="ae ki" href="https://docs.openshift.com/container-platform/3.11/admin_guide/manage_scc.html" rel="noopener ugc nofollow" target="_blank">禁用它</a>。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="4c41" class="mp kk in ml b gy mq mr l ms mt">oc adm policy add-scc-to-user privileged system:serviceaccount:mystorm:default</span></pre><h2 id="b2ec" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">安装舵图</h2><p id="91ce" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">由于一些优秀的人已经花时间有一个掌舵图表，部署是容易的。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="f2ba" class="mp kk in ml b gy mq mr l ms mt">helm repo add gresearch <a class="ae ki" href="https://g-research.github.io/charts" rel="noopener ugc nofollow" target="_blank">https://g-research.github.io/charts</a><br/>helm install my-storm gresearch/storm -n mystorm</span></pre><h1 id="8222" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">运行基本风暴拓扑</h1><p id="fc0d" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">我们将运行一些示例风暴拓扑。我们需要先编译编写 Storm 拓扑的 Java 程序。</p><h2 id="6ead" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">安装 Java</h2><div class="lh li gp gr lj lk"><a href="https://developers.redhat.com/blog/2018/12/10/install-java-rhel8" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">如何在红帽企业版 Linux 8 |红帽开发者上安装 Java 8 和 11</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">Red Hat Enterprise Linux (RHEL) 8 将支持 Java 的两个主要版本:Java 8 和 Java 11。在这个…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">developers.redhat.com</p></div></div><div class="lt l"><div class="nf l lv lw lx lt ly lz lk"/></div></div></a></div><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="c13b" class="mp kk in ml b gy mq mr l ms mt">sudo yum install java-11-openjdk-devel</span></pre><h2 id="cd95" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">安装 Maven</h2><div class="lh li gp gr lj lk"><a href="https://maven.apache.org/install.html" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">安装 Apache Maven</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">Apache Maven 的安装是一个简单的过程，提取归档文件并添加带有 mvn 的 bin 文件夹…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">maven.apache.org</p></div></div></div></a></div><p id="e310" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">设置 Maven 环境</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="9589" class="mp kk in ml b gy mq mr l ms mt">export JAVA_HOME=/usr/lib/jvm/java-11-openjdk<br/>export PATH=/tmp/apache-maven-3.8.5/bin:$PATH</span></pre><p id="1d11" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，最新版本 Maven 禁用外部 http repo。</p><div class="lh li gp gr lj lk"><a href="https://stackoverflow.com/questions/67001968/how-to-disable-maven-blocking-external-http-repositories" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">如何禁用 maven 阻塞外部 HTTP 仓库？</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">我找到了一个解决方案，通过检查 Maven git 存储库中的提交，它负责默认的…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">stackoverflow.com</p></div></div><div class="lt l"><div class="ng l lv lw lx lt ly lz lk"/></div></div></a></div><p id="3a31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">解决方法是</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="0828" class="mp kk in ml b gy mq mr l ms mt">&lt;mirror&gt;<br/> &lt;id&gt;maven-default-http-blocker&lt;/id&gt;<br/> &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;<br/> &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;<br/> &lt;url&gt;<a class="ae ki" href="http://0.0.0.0/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0/</a>&lt;/url&gt;<br/>&lt;/mirror&gt;<br/>Comment out above line</span></pre><h2 id="9064" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">在本地运行 Storm 拓扑</h2><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="9d5b" class="mp kk in ml b gy mq mr l ms mt">wget <a class="ae ki" href="https://dlcdn.apache.org/storm/apache-storm-2.3.0/apache-storm-2.3.0.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dlcdn.apache.org/storm/apache-storm-2.3.0/apache-storm-2.3.0.tar.gz</a></span><span id="0c74" class="mp kk in ml b gy nh mr l ms mt"># compile<br/>mvn clean install -DskipTests=true</span><span id="e66a" class="mp kk in ml b gy nh mr l ms mt"># local run<br/>cd examples/storm-starter/<br/># Example 1: Run the ExclamationTopology in local mode (LocalCluster)<br/>~/apache-storm-2.3.0/bin/storm jar target/storm-starter-*.jar org.apache.storm.starter.WordCountTopology -local</span></pre><h2 id="cdf8" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">在远程集群中运行拓扑</h2><p id="782c" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">事实证明，您需要连接到 Storm nimbus 主机才能远程提交拓扑。因此，我只需将拓扑远程复制到 apache storm cluster supervisor 节点，以连接到 nimbus 主机。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="af6f" class="mp kk in ml b gy mq mr l ms mt"># copy to supervisor node<br/>oc rsync ./target pod/my-storm-supervisor-754f6b4dbf-5qj74:/tmp -c supervisor</span><span id="7d35" class="mp kk in ml b gy nh mr l ms mt"># ssh to supervisor node<br/>oc rsh -c supervisor my-storm-supervisor-754f6b4dbf-5qj74<br/>storm jar target/storm-starter-*.jar</span></pre><h2 id="c141" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">奔跑</h2><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="d5fe" class="mp kk in ml b gy mq mr l ms mt"># Example 2: Run the RollingTopWords in remote/cluster mode<br/>org.apache.storm.starter.WordCountTopology WordCount -c nimbus.host=my-storm-nimbus</span></pre><h2 id="1936" class="mp kk in bd kl mu mv dn kp mw mx dp kt jv my mz kx jz na nb lb kd nc nd lf ne bi translated">删除拓扑</h2><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="e4a2" class="mp kk in ml b gy mq mr l ms mt">storm kill WordCount -c nimbus.host=my-storm-nimbus</span></pre><p id="c7f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Apache Storm 始终支持多层拓扑，例如 Python。下面是一个例子:</p><div class="lh li gp gr lj lk"><a href="https://github.com/apache/storm/blob/v2.4.0/examples/storm-starter/src/jvm/org/apache/storm/starter/WordCountTopology.java" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">2.4.0 版的 storm/word count topology . Java Apache/storm</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">此文件包含双向 Unicode 文本，其解释或编译可能与下面显示的不同…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">github.com</p></div></div><div class="lt l"><div class="ni l lv lw lx lt ly lz lk"/></div></div></a></div><p id="6cd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">主要代码是使用 python 来运行 python 拓扑</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="78e2" class="mp kk in ml b gy mq mr l ms mt">public static class SplitSentence extends ShellBolt implements IRichBolt {</span><span id="216b" class="mp kk in ml b gy nh mr l ms mt">public SplitSentence() {<br/>            super("python", "splitsentence.py");<br/>        }</span></pre><p id="3aa4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">示例 Python 拓扑</p><div class="lh li gp gr lj lk"><a href="https://github.com/apache/storm/tree/v2.4.0/examples/storm-starter/multilang/resources" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">storm/examples/storm-starter/multilang/resources at v 2 . 4 . 0 Apache/storm</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">阿帕奇风暴之镜。在 GitHub 上创建一个帐户，为 apache/storm 开发做贡献。</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">github.com</p></div></div><div class="lt l"><div class="nj l lv lw lx lt ly lz lk"/></div></div></a></div><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="f94c" class="mp kk in ml b gy mq mr l ms mt">import storm</span><span id="960c" class="mp kk in ml b gy nh mr l ms mt">class SplitSentenceBolt(storm.BasicBolt):<br/>    def process(self, tup):<br/>        words = tup.values[0].split(" ")<br/>        for word in words:<br/>          storm.emit([word])</span><span id="5924" class="mp kk in ml b gy nh mr l ms mt">SplitSentenceBolt().run()</span></pre><p id="81a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果想在 Azure Kubernetes 服务上部署 Apache Storm，可以参考我之前的文章<a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/increased-developer-productivity-with-kubernetes-virtual-cluster-7e478870d7aa">置备 AKS </a>，然后部署 helm chart。</p><h1 id="03af" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">附录</h1><div class="lh li gp gr lj lk"><a href="https://storm.apache.org/releases/current/Tutorial.html" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">辅导的</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">在本教程中，您将学习如何创建 Storm 拓扑并将它们部署到 Storm 集群。Java 将是主要的…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">storm.apache.org</p></div></div><div class="lt l"><div class="nk l lv lw lx lt ly lz lk"/></div></div></a></div><figure class="mg mh mi mj gt nl"><div class="bz fp l di"><div class="nm nn l"/></div></figure><div class="lh li gp gr lj lk"><a href="https://storm.apache.org/releases/2.4.0/Common-patterns.html" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">常见的拓扑模式</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">本页列出了风暴拓扑中的各种常见模式。批处理基础螺栓内存缓存+字段…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">storm.apache.org</p></div></div></div></a></div><div class="lh li gp gr lj lk"><a href="https://hub.docker.com/_/storm" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd io gy z fp lp fr fs lq fu fw im bi translated">暴风-官方图片|码头中心</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">Apache Storm 是一个免费的开源分布式实时计算系统。</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">hub.docker.com</p></div></div></div></a></div><p id="0deb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">https://livebook.manning.com/book/storm-applied<a class="ae ki" href="https://livebook.manning.com/book/storm-applied" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>