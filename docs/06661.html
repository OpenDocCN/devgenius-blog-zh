<html>
<head>
<title>Android CI/CD using Bitbucket pipeline and deploy to Microsoft App Center</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Bitbucket 管道的 Android CI/CD，并部署到 Microsoft 应用中心</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/android-ci-cd-using-bitbucket-pipeline-and-deploy-to-microsoft-app-center-d2a1074bfb67?source=collection_archive---------2-----------------------#2022-01-24">https://blog.devgenius.io/android-ci-cd-using-bitbucket-pipeline-and-deploy-to-microsoft-app-center-d2a1074bfb67?source=collection_archive---------2-----------------------#2022-01-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/485fe38449f3604f1032961789b2066c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAGHLoKsUr7EZc9SNpDm4g.png"/></div></div></figure><h1 id="7700" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">先决条件</h1><blockquote class="kt ku kv"><p id="9802" class="kw kx ky kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">关于 CI/CD、<br/> app center 账户的知识。</p></blockquote><h1 id="9dd3" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">动机</h1><p id="43b3" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated"><strong class="kz io">对于像我这样拥有低配置 PC/笔记本电脑并且需要大量时间来生成构建的人(开玩笑)。</strong></p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/7a3adddc3d36b49ecc7cb245c0b947f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*HPy_K_GbL7afJGsi.jpg"/></div></figure><p id="cb54" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">所有其他平台，如后端、web 前端，都使用 CI/CD 与服务器集成。为了部署到产品中，我们需要通过一些单元测试、lint 警告检查、UI 测试等。我们可以通过自动化流程来完成，并且可以将构建分发到任何分发系统，包括 google play 商店。有关 CI/CD 的更多信息，请访问<a class="ae mi" href="https://www.infoworld.com/article/3271126/what-is-cicd-continuous-integration-and-continuous-delivery-explained.html" rel="noopener ugc nofollow" target="_blank">此</a>链接。</p><p id="9efd" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">可以手动<strong class="kz io">做</strong>。<br/>做了很多年。我认为自动化节省的时间无法弥补建立工作管道的努力。我错了。自动化不仅节省了时间，还使流程更加可靠，更不容易出错(人为错误),并鼓励更频繁地部署/发布。总的来说，开发周期加快了，不仅仅是 bug 修复，还有特性发布。</p><p id="c453" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">市场上还有其他一些工具。<a class="ae mi" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz io">【浪子】</strong></a><a class="ae mi" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io">詹金斯</strong></a><a class="ae mi" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io">切尔莱西</strong></a><a class="ae mi" href="https://www.travis-ci.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io">特拉维斯 CI</strong></a><a class="ae mi" href="https://www.jetbrains.com/teamcity/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io">team city</strong></a><strong class="kz io">。</strong></p><h1 id="2eb2" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">概观</h1><p id="26f7" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">设置管道有一些步骤:</p><ol class=""><li id="107e" class="mj mk in kz b la lb le lf lx ml lz mm mb mn lu mo mp mq mr bi translated">在位存储库中启用管道。请转到</li></ol><pre class="me mf mg mh gt ms mt mu mv aw mw bi"><span id="3df2" class="mx jw in mt b gy my mz l na nb"> repository &gt; Repository Settings  &gt;Find pipeline section on left menu &gt; goto settings of pipeline section&gt;Enable it.</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/9b1d091ccd7b30af0b4f9e582b7c303b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQCMw74Oz6CpAZlwI8u0pA.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">管道启用</figcaption></figure><p id="14f1" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated"><em class="ky">或</em>您可以从管道部分启用它。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/5530ade04713380ff64c78427e55557b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujYc_-Rjmc5Qt0vgZ4orgQ.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">正在创建管道文件</figcaption></figure></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="9e09" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">2.您可以通过此设置配置您的<strong class="kz io">bit bucket-pipelines . yml</strong>文件，也可以在 android studio 中手动创建您的<strong class="kz io">bit bucket-pipelines . yml</strong>文件。<strong class="kz io">bit bucket-pipelines . yml</strong>文件必须位于根包中。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/030a8506b5e1598deaae87b8f935bfb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*0V1cfrhA_TbpRCcI5pPUlA.png"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">管道文件放置</figcaption></figure></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="4ff0" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">3.配置管道文件。</p><p id="5b54" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">为了配置<strong class="kz io"> bitbucket-pipelines.yml </strong>文件，我们需要使用特殊的关键字概念来编写脚本和命令。点击<a class="ae mi" href="https://chrisfrewin.medium.com/the-last-bitbucket-pipelines-tutorial-youll-ever-need-mastering-ci-and-cd-28a027fc5e40" rel="noopener">这个</a>链接了解更多详情。所以在这个项目中，我们将使用默认的<strong class="kz io">管道。我们将分两步走。第一步是构建 apk 工件，第二步是将 apk 发布到微软应用中心。</strong></p><h2 id="fe47" class="mx jw in bd jx nq nr dn kb ns nt dp kf lx nu nv kj lz nw nx kn mb ny nz kr oa bi translated">步骤 1.0</h2><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="9c13" class="mx jw in bd jx nq nr dn kb ns nt dp kf lx nu nv kj lz nw nx kn mb ny nz kr oa bi translated">步骤 1.5</h2><p id="a091" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">在执行步骤之前，我们必须获得一个 app center 用户令牌。请转到</p><pre class="me mf mg mh gt ms mt mu mv aw mw bi"><span id="71b2" class="mx jw in mt b gy my mz l na nb"> Account Settings &gt; User API tokens &gt; New Token </span></pre><p id="3bea" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">或者访问<a class="ae mi" href="https://docs.microsoft.com/en-us/appcenter/api-docs/#creating-an-app-center-user-api-token" rel="noopener ugc nofollow" target="_blank">此</a>链接，了解 app center 应用程序/用户令牌的更多详细信息。然后将令牌保存在安全的地方。</p><h2 id="6213" class="mx jw in bd jx nq nr dn kb ns nt dp kf lx nu nv kj lz nw nx kn mb ny nz kr oa bi translated">第 2.0 步</h2><p id="943b" class="pw-post-body-paragraph kw kx in kz b la lv lc ld le lw lg lh lx ly lk ll lz ma lo lp mb mc ls lt lu ig bi translated">附上第二步。</p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="1e77" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">所以我将详细说明第 2 步的最后一行。</p><pre class="me mf mg mh gt ms mt mu mv aw mw bi"><span id="8b14" class="mx jw in mt b gy my mz l na nb">- appcenter distribute release — group Collaborators — file “app/build/outputs/apk/debug/app-debug.apk” — release-notes ‘Test release Notes’ — app organization_name_or_your_account_name/app_name — token “your_token” — quiet</span></pre><p id="2da1" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">这个单行命令有六个不同的命令。</p><pre class="me mf mg mh gt ms mt mu mv aw mw bi"><span id="cb3d" class="mx jw in mt b gy my mz l na nb">1. appcenter distribute release — group Collaborators<br/>// means the group those can access the app</span><span id="87fe" class="mx jw in mt b gy od mz l na nb">2. file “app/build/outputs/apk/debug/app-debug.apk”<br/>//indicating the file to upload</span><span id="8298" class="mx jw in mt b gy od mz l na nb">3. release-notes ‘Test release Notes’<br/>//adding test notes when you upload is finished.</span><span id="fcde" class="mx jw in mt b gy od mz l na nb">4. app organization_name_or_your_account_name/app_name<br/>//indicate the app repository and organization name where you want //to upload.If your app is not under any organization then just //use your username as organization.</span><span id="af95" class="mx jw in mt b gy od mz l na nb">5. token “your_token”<br/>// your user api token that you created earlier.</span><span id="4a57" class="mx jw in mt b gy od mz l na nb">6. quiet<br/>//for quiting.</span></pre><p id="e982" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">因此，让我们具体化这两个步骤并最终确定我们的。yml 文件。</p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/9b6d7a4ccecc484e3bd292ef6ab530ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4P9s7EOCDI6OOJnXsYr-3A.jpeg"/></div></div></figure><p id="353e" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">仅此而已。现在，您可以构建您的应用程序，而无需您的机器来完成这项工作。所有的构建过程现在都由 docker 和 bitbucket 处理。</p><p id="49e9" class="pw-post-body-paragraph kw kx in kz b la lb lc ld le lf lg lh lx lj lk ll lz ln lo lp mb lr ls lt lu ig bi translated">感谢阅读。</p><h1 id="edff" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">编码快乐！</h1></div></div>    
</body>
</html>