<html>
<head>
<title>Extending Angular CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩展角度CLI</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/extending-angular-cli-f8b1abeb612a?source=collection_archive---------8-----------------------#2021-12-23">https://blog.devgenius.io/extending-angular-cli-f8b1abeb612a?source=collection_archive---------8-----------------------#2021-12-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b362" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在enterprise Angular中，工具通常不仅仅是Angular CLI。许多公司运行代码生成器、模拟服务器和定制的构建管道。</p><p id="0002" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通常是<code class="fe ki kj kk kl b">package.json</code>脚本将这个工具添加到Angular CLI之上。但是<code class="fe ki kj kk kl b">package.json</code>脚本遗漏了Angular CLI必须提供的许多东西。</p><ul class=""><li id="e753" class="km kn in jm b jn jo jr js jv ko jz kp kd kq kh kr ks kt ku bi translated">他们对可观察的建筑商感到尴尬，比如对<code class="fe ki kj kk kl b">ng serve</code>。</li><li id="0422" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">他们看不懂<code class="fe ki kj kk kl b">BuilderOptions</code>。</li><li id="7749" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">他们无法对棱角分明的CLI建设者的<code class="fe ki kj kk kl b">BuilderOutput</code>做出反应。</li><li id="0ed2" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">它们不是Angular CLI <code class="fe ki kj kk kl b">--help</code>文档的一部分。</li></ul><p id="bd7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">解决方案很简单，停止依赖<code class="fe ki kj kk kl b">package.json</code>脚本，转而扩展Angular CLI。这听起来工作量很大，但是在<code class="fe ki kj kk kl b">@angular-devkit/build-angular</code>中添加了一些新的东西，实际上非常简单。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi la"><img src="../Images/262b2b9e16bf55bae0cacb8227c66604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PEHmxVcqlQI4so-U6r9eA.png"/></div></figure><h1 id="9274" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Angular CLI的node.js API</h1><p id="9a98" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">谷歌一下，你只会得到少得可怜的19次点击。对于一个极其有用的Angular API来说，这实在是太低了。</p><p id="a5f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从名字就能猜到，<code class="fe ki kj kk kl b">executeDevServerBuilder</code>只是<code class="fe ki kj kk kl b">ng serve</code>的node.js API。事实上，大多数Angular CLI命令都有一个API。</p><ul class=""><li id="d0e5" class="km kn in jm b jn jo jr js jv ko jz kp kd kq kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeBrowserBuilder</code>是<code class="fe ki kj kk kl b">ng build</code></li><li id="daa1" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeDevServerBuilder</code>是<code class="fe ki kj kk kl b">ng serve</code></li><li id="1c9b" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeNgPackagrBuilder</code>是图书馆里的<code class="fe ki kj kk kl b">ng build</code></li><li id="c03e" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeExtractI18nBuilder</code>是<code class="fe ki kj kk kl b">ng i18n</code></li><li id="0e2b" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeKarmaBuilder</code>是<code class="fe ki kj kk kl b">ng test</code></li><li id="8f48" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated"><code class="fe ki kj kk kl b">executeProtractorBuilder</code>是<code class="fe ki kj kk kl b">ng e2e</code></li></ul><p id="ae99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这为什么有用？这些API使得Angular CLI易于扩展！你所要做的就是创建一个<a class="ae ml" href="https://angular.io/guide/cli-builder" rel="noopener ugc nofollow" target="_blank"> Angular CLI构建器</a>，然后交给一个本地构建器API。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="fa88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里，我们只是打印<code class="fe ki kj kk kl b">Hello world!</code>，但可能性是无穷的。</p><ul class=""><li id="9034" class="km kn in jm b jn jo jr js jv ko jz kp kd kq kh kr ks kt ku bi translated">你可以在<code class="fe ki kj kk kl b">ng serve</code>上启动一个模拟服务器。</li><li id="debc" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">您可以在运行<code class="fe ki kj kk kl b">ng build</code>之前运行代码生成器。</li></ul><h1 id="e1bc" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">向现有构建器添加新选项</h1><p id="e6aa" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">扩展任何CLI的很大一部分都是为了添加新的CLI选项。如果<code class="fe ki kj kk kl b">ng serve</code>要启动一个模拟服务器，用户可能想要一个<code class="fe ki kj kk kl b">--no-mock-server</code>选项。</p><p id="6cd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上例中<code class="fe ki kj kk kl b">extendedServeBuilder</code>的参数包含了<code class="fe ki kj kk kl b">executeDevServerBuilder</code>的所有选项。但是这些选项从何而来？它们是每个Angular CLI生成器声明的JsonSchema的一部分。这意味着如果你想给<code class="fe ki kj kk kl b">ng serve</code>添加新的选项，那么你必须将一个模式合并到Angular CLI模式中。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="dfcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ki kj kk kl b">postinstall</code>钩子是进行这种合并的完美地方。这将确保生成的模式与Angular CLI的本地版本相匹配。</p><h1 id="7051" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">使用扩展的构建器库</h1><p id="7179" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">实现了扩展构建器并列出其选项后，是时候重新路由命令了。Angular CLI使用<code class="fe ki kj kk kl b">angular.json</code>来查找在什么命令上调用什么构建器。要让<code class="fe ki kj kk kl b">ng serve</code>调用新的扩展构建器，只需更新<code class="fe ki kj kk kl b">angular.json</code>中的serve <code class="fe ki kj kk kl b">builder</code>属性。</p><pre class="lb lc ld le gt mo kl mp mq aw mr bi"><span id="74f2" class="ms lj in kl b gy mt mu l mv mw">{ "builder": "@angular-devkit/build-angular:dev-server" }</span></pre><p id="d9fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">成为</p><pre class="lb lc ld le gt mo kl mp mq aw mr bi"><span id="f063" class="ms lj in kl b gy mt mu l mv mw">{ "builder": "your-builder-library:your-builder-name" }</span></pre><h1 id="af87" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">把所有的放在一起</h1><ul class=""><li id="3bdf" class="km kn in jm b jn mg jr mh jv mx jz my kd mz kh kr ks kt ku bi translated">创建一个使用node.js API和任何扩展的新构建器函数。</li><li id="41da" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">在<code class="fe ki kj kk kl b">postinstall</code>钩子中生成模式。</li><li id="357b" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">用<code class="fe ki kj kk kl b">builder.json</code>创建一个构建器库，导出构建器实现及其模式。</li><li id="75a6" class="km kn in jm b jn kv jr kw jv kx jz ky kd kz kh kr ks kt ku bi translated">更新angular.json以使用新的构建器库。</li></ul><h1 id="440f" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">将所有内容放在一起(惰性版本)</h1><p id="5409" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">我创建了一个库，它包装了所有本机Angular CLI生成器，并将它们的模式与您的模式合并。你要做的就是实现钩子。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="a95e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ml" href="https://hooks.albinberglund.com" rel="noopener ugc nofollow" target="_blank">https://hooks.albinberglund.com</a><br/><a class="ae ml" href="https://github.com/blidblid/berglund/tree/main/projects/angular-cli-hooks" rel="noopener ugc nofollow" target="_blank">https://github . com/blid blid/Berg Lund/tree/main/projects/angular-CLI-hooks</a><br/><a class="ae ml" href="https://www.npmjs.com/package/@berglund/angular-cli-hooks" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/@berglund/angular-cli-hooks</a></p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="c2b6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nh">最初发布于https://</em>albinberglund.com/extending-angular-cli</p></div></div>    
</body>
</html>