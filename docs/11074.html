<html>
<head>
<title>CI/CD pipeline with Jenkins and Argo CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 Jenkins 和 Argo CD 的 CI/CD 管道</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/ci-cd-pipeline-with-jenkins-and-argo-cd-65b48f76b62a?source=collection_archive---------0-----------------------#2022-12-17">https://blog.devgenius.io/ci-cd-pipeline-with-jenkins-and-argo-cd-65b48f76b62a?source=collection_archive---------0-----------------------#2022-12-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a161" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">概述:</h2></div><p id="a390" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你好，在这篇文章中，我们将从头开始构建一个 CI/CD 管道，我们将讨论其中的每个组件。</p><p id="4987" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我们的管道:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/a27281ccbf50db0710e9b92db09ad41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Azvr5MKmYd8DzrghPLWjPw.png"/></div></div></figure><h2 id="6a83" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">詹金斯:</h2><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi md"><img src="../Images/3e9b7a3cd3501fe2b734d6c77b47de9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:240/0*BUk9Yc1Dhs7DrRxk"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">詹金斯</figcaption></figure><p id="972a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">詹金斯是什么，它是用来做什么的？</p><p id="6a6b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Jenkins 是一个用 Java 编程语言编写的开源持续集成/持续交付和部署(CI/CD)自动化软件 DevOps 工具。它用于<strong class="ke io">实现 CI/CD 工作流，称为管道</strong>。</p><h2 id="2f06" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">管道:</h2><p id="91c8" class="pw-post-body-paragraph kc kd in ke b kf mi jo kh ki mj jr kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">让我们讨论一下什么是 CI/CD 管道。</p><p id="5a4b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">持续集成和持续部署(CI/CD)管道是为了交付软件的新版本而必须执行的一系列步骤。CI/CD 管道是一种专注于通过自动化在整个软件开发生命周期中改进软件交付的实践。</p><p id="b0c1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">在 Windows 上安装詹金斯:</strong></p><p id="6d37" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要安装 Jenkins，我们直接进入其官方网站并下载。msi 文件，我们安装它:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/35d7c478df53d00dffca8fb7af1d5f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eT0GJ20ItAoLSYH7B9ojmA.png"/></div></div></figure><p id="e115" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是设置凭证的时候了。</p><p id="db7f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">国书:</strong></p><p id="44cd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要让 Jenkins 访问我的存储库，我需要为我的 github 帐户配置凭证:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/bd804ee50ddecafe3caa55ad7f04bc2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryrFHxldBE8-gRtt4L9YZg.png"/></div></div></figure><p id="a03e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，我必须将 azure 凭证配置到我的 azure 容器注册表，以便它可以将图像推送到那里:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/e424dbaacf4732e7741af1a6f8ffccd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fRM8slInyFNvK7TeJaJ3g.png"/></div></div></figure><p id="8a60" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">我的詹金斯文件:</strong></p><pre class="kz la lb lc gt mn mo mp bn mq mr bi"><span id="147e" class="ms ll in mo b be mt mu l mv mw">pipeline{<br/>  agent any<br/>  environment{<br/>    AZURE_REPO='myprivaterepo.azurecr.io'<br/>  }<br/>  stages{<br/>    stage("build image"){<br/>      steps{<br/>        sh "docker build -t myprivaterepo.azurecr.io/library-management-api ./api/" <br/>        echo "image built successfully"<br/>      }     <br/>    }<br/>    stage("push image to ACR"){<br/>      steps{<br/>        echo "pushing to ACR stage"<br/>        withCredentials([usernamePassword(credentialsId: 'azure-credentials', passwordVariable: 'PASS', usernameVariable: 'USER')]){<br/>          sh "echo $PASS | docker login ${AZURE_REPO} --username $USER --password-stdin"<br/>          sh "nslookup myprivaterepo.azurecr.io"<br/>          sh "docker push myprivaterepo.azurecr.io/library-management-api"<br/>        }<br/>        echo "image pushed successfully to azure container registry"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1130" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我得到了这个错误:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/e5e6755250f04ae2a8b0e5309c33ac3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77hZT545K2J4PDsai_1QGQ.png"/></div></div></figure><p id="4d31" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个错误是通过将 sh.exe 添加到我的路径中解决的。</p><p id="cc74" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们的管道成功运行，它由分支提交触发，每次都重建 docker 映像并将其推送到 Azure 容器注册表:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/91d4872c7a89dafecebaf0124e71319d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n8KbgOCWOZZPsh3np6ofuw.png"/></div></div></figure><h2 id="5dad" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">Azure MySQL 数据库:</h2><p id="5794" class="pw-post-body-paragraph kc kd in ke b kf mi jo kh ki mj jr kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们所有的应用程序数据都保存在 Azure 数据库中。对于 MySQL 数据库，Azure 在特定条件下免费为我们提供这项服务:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/58120dfdf86d7a1e5d66a3c6466705b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dnjz_7or09GMK_dSd0x3fg.png"/></div></div></figure><p id="4a65" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建灵活的服务器:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/36c7c3e0cb325e154eb6a9ce486d5306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uyxdG352qac0kbvwIaxaQ.png"/></div></div></figure><p id="115f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建新数据库:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/3cadba2f3596795186b136c700249acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ud_IGz7hDDAZWW21_3upjw.png"/></div></div></figure><p id="cffb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一切都准备好了。还有一点要说的是持续部署。</p><h2 id="73e3" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">阿尔戈光盘:</h2><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/80f5bfcf53ff94207296a8e19476d6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*PydwW6ZxkZ63DrHS.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">阿尔戈光盘</figcaption></figure><p id="21a3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Argo CD 是一个 Kubernetes-native 连续部署(CD)工具。与只支持基于推送的部署的外部 CD 工具不同，Argo CD 可以从 Git 存储库中提取更新的代码，并将其直接部署到 Kubernetes 资源中。它使开发人员能够在一个系统中管理基础架构配置和应用程序更新。</p><h2 id="5be4" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">带有 Argo CD 的 GitOps:</h2><p id="4dd8" class="pw-post-body-paragraph kc kd in ke b kf mi jo kh ki mj jr kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">GitOps 是一种软件工程实践，它使用 Git 存储库作为其唯一的事实来源。团队将声明性配置提交到 Git 中，这些配置用于创建持续交付过程所需的环境。不需要手动设置环境，也不需要使用独立的脚本——一切都是通过 Git 存储库定义的。</p><p id="4905" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GitOps 过程的一个基本部分是拉请求。配置的新版本通过 pull request 引入，与 Git 存储库中的主分支合并，然后新版本被自动部署。Git 存储库包含所有变更的完整记录，包括流程每个阶段的所有环境细节。</p><p id="5531" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们建立了一个新项目，将它链接到我们的 git 存储库，并指定 k8s 清单的位置:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/dd2c06ca81ff4024e3f17e1c0ccf5306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEfhuusB3c5TheioAe4eIA.png"/></div></div></figure><p id="155f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们可以看到我们的资源成功部署到 Azure Kubernetes 集群:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/20328be4c4738412f743480de554d4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRANH4ZifzrGU-wrcuResg.png"/></div></div></figure><blockquote class="my mz na"><p id="b96e" class="kc kd nb ke b kf kg jo kh ki kj jr kk nc km kn ko nd kq kr ks ne ku kv kw kx ig bi translated">提醒一下，ArgoCD 安装在集群本身上，并作为负载平衡器类型的服务运行</p></blockquote><h2 id="2b62" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">测试:</h2><p id="8425" class="pw-post-body-paragraph kc kd in ke b kf mi jo kh ki mj jr kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">测试我们的外部 api:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/dc1625d6aad7fb75efb3f622e29093b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMScL5YIau6wjZuI7_FFFg.png"/></div></div></figure><p id="4228" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们测试书籍是否已设置:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/24fdbe5ecdbf344cf5ecdf953308e65e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rq9JjkuhITWC7eZbu_VxPQ.png"/></div></div></figure><p id="8fb4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们检查用户:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/b770e7101ec38631d8d966bd538d331c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_5-iqf6fd4OO3hQdLMuUA.png"/></div></div></figure><p id="1db4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，我们找不到它们，因为我们还没有添加。</p></div><div class="ab cl nf ng hr nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ig ih ii ij ik"><p id="0c27" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总之，在本文中，我们了解了 pipelines 和 GitOps，部署 pipelines 和 GitOps 的方法以及所需的工具。</p><p id="1ddd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这有帮助吗？迷惑？如有疑问，欢迎在下方评论！如果你对类似的内容感兴趣，并想和我一起学习，一定要关注 Linkedin:<a class="ae nm" href="https://www.linkedin.com/in/malekzaag/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/malekzaag/</a>和 github:<a class="ae nm" href="https://github.com/Malek-Zaag" rel="noopener ugc nofollow" target="_blank">https://github.com/Malek-Zaag</a>！</p></div></div>    
</body>
</html>