<html>
<head>
<title>Analyse and Visualise Happiness with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 分析和想象幸福</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/analyse-and-visualise-happiness-with-r-9464ba125d81?source=collection_archive---------10-----------------------#2022-04-05">https://blog.devgenius.io/analyse-and-visualise-happiness-with-r-9464ba125d81?source=collection_archive---------10-----------------------#2022-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ec960b3fc41690194e8dff8c39d381a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R4F8Hz88bWNrH--C.jpg"/></div></div></figure><h1 id="b1e9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="1da6" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">原来幸福是可以衡量的。一个由著名科学家组成的团队找到了一种方法，可以在近 150 个国家进行无处不在的调查，以确定世界上最快乐的人。我们将分析他们研究得出的数据，并试图回答一个非常重要的问题:幸福是否与金钱有关？</p><h1 id="22ac" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">先决条件</h1><p id="a72a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们从熟悉 WHR 2021 官方<a class="ae lu" href="https://worldhappiness.report/ed/2021/" rel="noopener ugc nofollow" target="_blank">网站</a>的研究开始。</p><p id="fe39" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">接下来，下载<a class="ae lu" href="https://github.com/Vice10/datasets/blob/main/whr_2021.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>并准备编码。</p><h1 id="56b6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">特征</h1><p id="6e6c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">数据集中有七个数字列:</p><ol class=""><li id="bebd" class="ma mb iq ky b kz lv ld lw lh mc ll md lp me lt mf mg mh mi bi translated">阶梯分数(阶梯)</li><li id="57ac" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">记录的人均国内生产总值</li><li id="42ac" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">社会保障</li><li id="efcb" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">健康预期寿命(HLE)</li><li id="744e" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">做出生活选择的自由</li><li id="244d" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">慷慨(G)</li><li id="1b1e" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated">对腐败的看法</li></ol><p id="1e9e" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">注意，这些特征描述了发展，因此包含了负值。例如，芬兰人与前一年相比变得更加贪婪。下面来看看吧。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/47d47bf44c307fa520f1e4f9a10b9d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*jCXg5pqjqJScWfn7JGMxTg.png"/></div></figure><h1 id="d19a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">超散点图</h1><p id="7ae1" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">直方图、核密度函数、微型散点图、皮尔逊相关系数——都可以放入一个超级散点图中。还有比这更好的吗？</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/32c64444fd429115376dcb4b34471b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GMvj5O816EcS2RFe08_u4A.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">超散点图</figcaption></figure><h1 id="206b" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">相关热图</h1><p id="134e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">下面是一种呈现相关矩阵的智能方法:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="afeb" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我们使用了分层聚类算法来创建热组。很奇特，不是吗？</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/ab08e7e69d3c26d9f0c06250ce060c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PsWPthZMnJ4lG0uZz4_eAA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">相关热图</figcaption></figure><h1 id="84f2" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">相关图表</h1><p id="e305" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">你也可以做一些拓扑魔术，把上面的数值结果转移到二维空间。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5e00beafc0814d0a056983fb2c1b8a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ojhwaDQaLOvbU_152LSww.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">相关图表</figcaption></figure><h1 id="0760" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">比较相关系数(CC)</h1><p id="9ad3" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Pearson CC 使用参数方法来估计变量之间的关联强度。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/3b9fa70fee2beed0a5f10971b2a9462a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g5oy1LcSMy3RiCNtVfIuwA.png"/></div></figure><p id="1248" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">Spearman 和 Kendall 引入了排序来比较连续变量或分类变量。</p><p id="06e7" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">Pearson CC 估计点(沿线)的分组程度，其他两个检查单调性。</p><div class="mo mp mq mr gt ab cb"><figure class="nb jr nc nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/d5a45fcb1e368e1d8c3d68beff912d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*scc6WPmTggrVAZnj0DioGw.png"/></div></figure><figure class="nb jr nc nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/200e4d79c543cb1fda27fd37f524d526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Jq7XGm4_5DOia2p_PlGFkg.png"/></div></figure></div><h1 id="6b28" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">皮尔逊相关检验</h1><p id="3713" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们来找两个变量的皮尔逊 CC:阶梯(阶梯分数)和 SS(社会保障)。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/115146e2d9693513c3e6c8180984e037.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*nTx4DSSyGZ8lgAmKMsDrJA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">试验结果</figcaption></figure><p id="5977" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">事实上，<em class="ni">“95%置信区间”</em>背后的数学原理并不简单。我们来分解一下。</p><h1 id="d5a5" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">95%置信区间背后的数学</h1><p id="c8b3" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">与均值周围的置信区间不同，Pearson CC 周围的置信区间(为简便起见，我们将其表示为<em class="ni"> r </em>)是不对称的。这是因为<em class="ni"> r </em>的分布是偏斜的。例如，假设<em class="ni"> r </em> = 0.95，那么实际的人口相关性不能高于 1.0，但是它可以低得多。</p><p id="388c" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">围绕<em class="ni"> r </em>的置信区间基于费希尔的 z 变换。具体来说，假设 n 个 xᵢ-yᵢ对的样本产生某个值<em class="ni"> r </em>。考虑到这种转变</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b1f8771e18382e0384be5a68fd8ee401.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/0*WV6Ncx7BLXi6NONj"/></div></figure><p id="0183" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">这里，<em class="ni"> z </em>近似正态分布，期望值等于</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ad950c43791b1cc4cdf82f789fa64d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:272/0*1bcLFOLs5oUq_QtI"/></div></figure><p id="6bac" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">其中<em class="ni"> ρ </em>是总体相关性，r 是估计值。<em class="ni"> z </em>的标准偏差等于</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/6522220a8d17057e4c8b869097842b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/0*bhtBAZFk17ZtF3KQ"/></div></figure><p id="124c" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">置信区间可以在<em class="ni"> z </em>空间中构造为</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b007ccebfeec507b0a424290555986bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/0*icBE9cF8mpFbOj25"/></div></figure><p id="e9a6" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">其中，ф(<em class="ni">z</em>)对应于期望的置信水平(在 95%置信区间的情况下为 1.96)，定义为</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/f533f3be62f9652c8e895dbe5a5368a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/0*-_uS3vtRfV_1vVit"/></div></figure><p id="65e4" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在正态累积分布函数情况下。置信区间的上下<em class="ni">z</em>-极限将被转换回上下<em class="ni">r</em>-极限。</p><p id="6dee" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在我们的例子中，n=149，<em class="ni"> r </em> =0.756，我们正在寻找 95%的置信区间。让我们来计算一下<em class="ni"> z </em>:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b861a12374d40459c7e0358682f7608f.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/0*G80cexhvtzgxHmLP"/></div></figure><p id="617a" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">它的分布标准偏差等于</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/bd24f6032efb8173b69208805c34281e.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/0*NM8uprpIDdQLun7t"/></div></figure><p id="6234" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">因此，<em class="ni"> z </em>空间中的置信区间上限和下限为</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/aeaaf75423cea5ffaafe95ee5a1bd6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/0*30S1bzw87S1WzOFO"/></div></figure><p id="5e0a" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">和</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ad1e78514cd5ff5cb863026a6ff77fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/0*oz1E_QF3StDK7JWD"/></div></figure><p id="cb12" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">为了将<em class="ni">z</em>-空间转换回<em class="ni">r</em>-空间，我们必须找到费希尔<em class="ni"> z </em>变换的反函数。显而易见，这种倒置会产生</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/adc7cc2f2df02581aada711a3657ffac.png" data-original-src="https://miro.medium.com/v2/resize:fit:254/0*pkcqfxrnNyrqXO1e"/></div></figure><p id="a73a" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">然后可以使用上面的等式计算区间上限和下限:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/06cfefe7ab79d7ae82cf957e13d15d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/0*tZJ5MowJbh_5v39F"/></div></figure><p id="a3d7" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">和</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/17deabb38b9148bbd0fcb337c1bf20e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*RXPn5A5KH3SyEyEK"/></div></figure><p id="9399" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">因此，<em class="ni"> r= </em> 0.756 的 95%置信区间的范围是从 0.68 到 0.815，这正是我们一直在寻找的(我们的计算并不十分精确，所以它们与测试结果的差异可以忽略不计)。</p><h1 id="09a0" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="646c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这篇文章简要概述了一个简单而强大的统计工具来分析和可视化数据——相关性。它还解释了 Pearson CC 置信区间背后的数学原理。</p><p id="9137" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">不，幸福不仅仅与金钱有关。</p><p id="3944" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ni">本文的源代码可从</em> <a class="ae lu" href="https://github.com/Vice10/ds_notebooks/blob/main/whr_src.r" rel="noopener ugc nofollow" target="_blank"> <em class="ni">这里</em> </a> <em class="ni">。</em></p></div></div>    
</body>
</html>