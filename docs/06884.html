<html>
<head>
<title>A Convenient Way to Run PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">运行 PySpark 的便捷方式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/a-convenient-way-to-run-pyspark-4e84a32f00b7?source=collection_archive---------7-----------------------#2022-02-09">https://blog.devgenius.io/a-convenient-way-to-run-pyspark-4e84a32f00b7?source=collection_archive---------7-----------------------#2022-02-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="898c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 Jupyter Notebook 在本地计算机上运行 Pyspark，同时连接到 Linux 托管的 Apache Spark 独立集群</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9cc85598d80d947dd94f7a5453a789dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fu-pixuOPInkha9rdByDuQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@andrewruiz" rel="noopener ugc nofollow" target="_blank"> Andrew Ruiz </a></figcaption></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="84c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本指南中，我将向您展示如何跨 Linux 虚拟机设置 Apache Spark 独立集群。然后，我将向您展示如何在您的本地计算机上将该集群连接到 Jupyter 笔记本 PySpark 会话。</p><p id="8ec1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个示例假设您已经在 Linux 虚拟机上下载并安装了 Apache Spark 3.1.2。此外，它还假设您的 Linux 虚拟机和本地计算机上都有 Jupyter Notebook、Python 3 和任何其他依赖项。</p><p id="fba9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">建立独立集群</strong></p><ol class=""><li id="6b9c" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated">在 Linux 虚拟机的命令提示符下，转到%SPARK_HOME%\bin 文件夹，并运行:</li></ol><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="8379" class="lu lv in lq b gy lw lx l ly lz">spark-class org.apache.spark.deploy.master.Master </span></pre><p id="b849" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这段代码的结果将启动主节点，并给出一个“spark://ip:port”形式的 URL。</p><p id="0108" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.在另一个终端窗口中，最好是一个<a class="ae ky" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> tmux </a>窗口，转到%SPARK_HOME%\bin 文件夹并运行:</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="7486" class="lu lv in lq b gy lw lx l ly lz"> spark-class org.apache.spark.deploy.worker.Worker spark://ip:port</span></pre><p id="3cdc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这段代码将设置 worker 节点并将其连接到主节点。您可以对想要连接到集群的任何其他工作执行相同的步骤。确保您使用在步骤 2 中获得的 URL。</p><p id="fb53" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:我喜欢在单独的<a class="ae ky" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> tmux </a>窗口中执行步骤 2 和 3。这样，您可以从 VM 和终端窗口中分离出来，并且您的 Spark 集群将保持在线。否则，只要与虚拟机的连接关闭，您就必须重新启动集群。</p><p id="0d80" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">设置 Jupyter 笔记本</strong></p><ol class=""><li id="559a" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated">在 Linux 虚拟机上的另一个 tmux 窗口或终端窗口中运行:</li></ol><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="3059" class="lu lv in lq b gy lw lx l ly lz">jupyter notebook --no-browser </span></pre><p id="01e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您应该可以看到任何启动的 Jupyter 笔记本会话的标准输出，只是不会出现浏览器。</p><p id="1ad4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> SSH 隧道到 Jupyter 笔记本</strong></p><p id="c665" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们将您的本地计算机连接到正在运行的 Jupyter 笔记本会话。</p><ol class=""><li id="9491" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated">在本地笔记本电脑上，打开 tmux/终端窗口并运行:</li></ol><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="6537" class="lu lv in lq b gy lw lx l ly lz">ssh -N -L 8888:localhost:8888 username@hostname<br/>#the username and hostname are your username to the Linux VM and the hostname of the Linux VM. </span></pre><p id="2520" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来它会要求您输入密码。一旦输入，如果输入正确，你不会得到回应。如果使用 tmux，保持此窗口运行或分离。</p><p id="cda4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.接下来，打开互联网浏览器并运行:</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="2575" class="lu lv in lq b gy lw lx l ly lz">http://localhost:8888</span></pre><p id="517c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这应该能调出 Jupyter 笔记本会话。如果这是您第一次以这种方式连接，它会要求您输入令牌或密码。您可以从启动 Jupyter 笔记本会话的终端窗口的输出中获得令牌。一旦您登录，只要您在每个 Jupyter 笔记本会话中使用相同的 Linux VM 主机，它就不会再次要求您提供令牌。</p><p id="718a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果“http://localhost:8888”不起作用，请咨询您的 IT 团队，让 8888 端口允许 web 流量通过防火墙。</p><p id="dab6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这种方法的一个好处是，在 Jupyter Notebook 会话中，您还应该能够看到 Linux VM 上可用的文件。对于 Linux VM 上的文件结构的 GUI 视图来说，这是一个方便的端口。</p><p id="e4a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将 Jupyter 笔记本连接到 Spark 集群。</p><p id="4110" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，让我们连接到正在运行的 Spark 集群。</p><p id="39ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">1.在 Jupyter Notebook 中打开 Python3 内核并运行:</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="96a3" class="lu lv in lq b gy lw lx l ly lz">import pyspark<br/>import findspark<br/>from pyspark import SparkConf, SparkContext<br/>from pyspark.sql import SQLContext<br/>from pyspark.sql.types import *<br/>from pyspark import SparkConf, SparkContext</span><span id="f77c" class="lu lv in lq b gy ma lx l ly lz">findspark.init('/path_to_spark/spark-3.1.2-bin-hadoop3.2') <br/>#The key here is putting the path to the spark download on your Linux VM.</span><span id="3c6a" class="lu lv in lq b gy ma lx l ly lz">sc=pyspark.SparkContext(master='spark://ip:port',appName='test')<br/>#Use the same 'spark://ip:port' from starting the master node and connecting the worker(s). <br/>spark = SQLContext(sc)<br/>spark</span></pre><p id="50f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太好了！您应该连接到您的 Linux 虚拟机上运行的 Apache Spark 独立集群。方便的是，现在可以在 Jupyter Notebook 会话中使用 PySpark 编码，类似于任何其他 Python 会话。更好的是，它现在使用你运行的独立集群，有希望比你的本地计算机拥有更多的内存和 CPU。</p></div></div>    
</body>
</html>