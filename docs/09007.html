<html>
<head>
<title>Data Engineering Practice 1 — Downloading files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程实践 1 —下载文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/data-engineering-practice-1-downloading-files-efe90deca751?source=collection_archive---------9-----------------------#2022-07-24">https://blog.devgenius.io/data-engineering-practice-1-downloading-files-efe90deca751?source=collection_archive---------9-----------------------#2022-07-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/cebd323856e8646f82929fc4bb0f41d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MikWPB-FBWu2PGV-"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated"><a class="ae ja" href="https://unsplash.com/es/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><div class=""/><p id="4f5b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为数据工程师，你需要很多不同的技术技能来提高日常工作的效率。当你刚开始学习它们时，有时会感到不知所措。如果你一直在努力寻找开始学习和实施事情的方法，那么这篇文章就是为你写的。</p><p id="bed4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">数据无处不在，构建任何数据管道的第一步是从不同的来源获取数据。</p><p id="d124" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是数据工程实践系列的第 1 部分，我们将看看如何能够从一个<code class="fe ky kz la lb b">HTTP</code>源下载多个文件并解压缩它们，用<code class="fe ky kz la lb b">Python</code>将它们存储在本地。</p><p id="2c7f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我发现这个 github 库很有帮助，里面有所有的练习题，我将在这篇文章和接下来的文章中分享我的解决方案。</p><div class="im in gp gr io lc"><a href="https://github.com/danielbeach/data-engineering-practice" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd je gy z fp lh fr fs li fu fw jc bi translated">GitHub-Daniel beach/数据工程实践:数据工程实践问题</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">数据工程的主要障碍之一是大量和各种各样的技术技能，可以要求在一个</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">github.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq iu lc"/></div></div></a></div><h2 id="d903" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">问题</h2><p id="379d" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">我们得到了一些 URL，我们必须将这些 URL 下载到本地的一个<em class="mp">下载</em>文件夹中。下载的内容是一个 zip 文件，我们必须从这个 zip 文件中提取 csv 文件并删除这个 zip 文件。</p><p id="da8b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">初始代码</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="7d92" class="lr ls jd lb b gy my mz l na nb">import requests</span><span id="a7da" class="lr ls jd lb b gy nc mz l na nb">download_uris = [<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2018_Q4.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2018_Q4.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q1.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q1.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q2.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q2.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q3.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q3.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q4.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q4.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2020_Q1.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2020_Q1.zip'</a><br/>]</span><span id="0068" class="lr ls jd lb b gy nc mz l na nb">def main():<br/>    # your code here<br/>    pass</span><span id="89bd" class="lr ls jd lb b gy nc mz l na nb">if __name__ == '__main__':<br/>    main()</span></pre><h2 id="f843" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">步骤 1 —在本地创建一个下载文件夹。</h2><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="54c9" class="lr ls jd lb b gy my mz l na nb">import os </span><span id="3d87" class="lr ls jd lb b gy nc mz l na nb">def main():<br/>    directory = "downloads"<br/>    os.mkdir(directory)</span><span id="5ae9" class="lr ls jd lb b gy nc mz l na nb">    os.chdir(directory)<br/>    </span><span id="ce31" class="lr ls jd lb b gy nc mz l na nb">if __name__ == '__main__':<br/>    main()</span></pre><p id="91d6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了创建一个目录，我们使用 python 的 os 模块，<br/> <em class="mp"> os.mkdir </em>来创建一个目录，然后我们需要使用<em class="mp"> os.chdir. <br/>将当前目录更改为指向这个位置，如果目录已经存在，将会抛出一个错误。</em></p><h2 id="80cd" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">步骤 2 —从 URL 获取内容</h2><p id="dc63" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">我们使用 requests HTTP 库并使用 get()方法发送 get 请求。get 方法返回一个 requests.response 对象。</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="d76a" class="lr ls jd lb b gy my mz l na nb">import os</span><span id="9c04" class="lr ls jd lb b gy nc mz l na nb">def main():<br/>    directory = "downloads"<br/>    os.mkdir(directory)</span><span id="0dee" class="lr ls jd lb b gy nc mz l na nb">    os.chdir(directory)<br/>    for uri in download_uris:<br/>        response = requests.get(uri)</span><span id="4abb" class="lr ls jd lb b gy nc mz l na nb">if __name__ == '__main__':<br/>    main()</span></pre><h2 id="c3c9" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">步骤 3-获取文件名</h2><p id="1f1b" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">为了从 URL 中提取文件名，我们创建了一个名为 get_file_name 的独立函数，并将 URL 传递给它。</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="94ce" class="lr ls jd lb b gy my mz l na nb">file_name = get_file_name(uri)</span></pre><p id="f7f1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个函数首先将 URL 字符串分成两部分，并用斜线分开。<br/>rsplit 的语法</p><blockquote class="nd ne nf"><p id="bf86" class="ka kb mp kc b kd ke kf kg kh ki kj kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated"><em class="jd">字符串</em>。rsplit( <em class="jd">分隔符，最大拆分</em>)</p></blockquote><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="03f4" class="lr ls jd lb b gy my mz l na nb">def get_file_name(url):<br/>    li = url.rsplit("/",1)[1]<br/>    file_name = li.split(".")[0]<br/>    return file_name</span></pre><p id="b4a1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">rsplit 的第一个参数是一个斜杠，这意味着它必须根据找到斜杠的时间进行拆分，我们只是对字符串的最后一部分感兴趣，以获得文件名，因此我们将它拆分为两部分。这种拆分的结果将存储在一个列表中，我们需要从这个列表中取出第二个元素。<br/>第一阶段后的输出为</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="29e9" class="lr ls jd lb b gy my mz l na nb"><a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2018_Q4.zip'" rel="noopener ugc nofollow" target="_blank">Divvy_Trips_2018_Q4.zip</a></span></pre><p id="eb4f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还删除了。因此，我们再次根据点分隔符分割这个字符串，并返回文件名。</p><h2 id="fa77" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">步骤 4 —将 csv 文件写入本地</h2><p id="fed7" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">为了在本地写内容，我们使用 open 方法，其中我们指定第一个参数作为文件名，第二个参数是模式。这里，“w”代表写入，“b”代表字节。</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="dcc4" class="lr ls jd lb b gy my mz l na nb">open(file_name+'.zip','wb').write(response.content)</span></pre><h2 id="d4b7" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">步骤 5 —从 zip 文件中提取 CSV 文件</h2><p id="f14c" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">Python 提供了一个<strong class="kc je"> zipfile </strong>模块。</p><p id="b252" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc je"> zipfile </strong>模块具有根据条件解压单个或多个文件的全部功能。</p><p id="287c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们首先获取 zip 对象中所有文件名的列表，并循环每个文件名。<br/>接下来，我们检查文件名是否以'结尾。csv '扩展名，如果是，我们提取该文件。</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="3713" class="lr ls jd lb b gy my mz l na nb">with ZipFile(file_name+'.zip', 'r') as zipObject:<br/>           listOfFileNames = zipObject.namelist()<br/>           for fileName in listOfFileNames:<br/>               if fileName.endswith('.csv'):<br/>                   # Extract a single file from zip<br/>                   zipObject.extract(file_name+'.csv')</span></pre><h2 id="d743" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">第 6 步—删除 zip</h2><p id="879f" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">最后，我们通过使用 remove 函数删除所有 zip 文件来清理本地文件。</p><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="4dff" class="lr ls jd lb b gy my mz l na nb">if os.path.exists(file_name+'.zip'):<br/>        os.remove(file_name+'.zip')</span></pre><h2 id="8378" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">完整的代码—</h2><pre class="mq mr ms mt gt mu lb mv mw aw mx bi"><span id="132c" class="lr ls jd lb b gy my mz l na nb">import requests<br/>import os<br/>from zipfile import ZipFile</span><span id="9db7" class="lr ls jd lb b gy nc mz l na nb">download_uris = [<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2018_Q4.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2018_Q4.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q1.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q1.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q2.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q2.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q3.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q3.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q4.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q4.zip'</a>,<br/>    '<a class="ae ja" href="https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2020_Q1.zip'" rel="noopener ugc nofollow" target="_blank">https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2020_Q1.zip'</a><br/>]</span><span id="e147" class="lr ls jd lb b gy nc mz l na nb">def get_file_name(url):<br/>    li = url.rsplit("/",1)[1]<br/>    file_name = li.split(".")[0]<br/>    return file_name</span><span id="6903" class="lr ls jd lb b gy nc mz l na nb">def main():<br/>    directory = "downloads"<br/>    os.mkdir(directory)</span><span id="eaa3" class="lr ls jd lb b gy nc mz l na nb">    os.chdir(directory)<br/>    for uri in download_uris:<br/>        response = requests.get(uri)</span><span id="4e61" class="lr ls jd lb b gy nc mz l na nb">        file_name = get_file_name(uri)</span><span id="18c9" class="lr ls jd lb b gy nc mz l na nb">        open(file_name+'.zip','wb').write(response.content)</span><span id="c7d0" class="lr ls jd lb b gy nc mz l na nb">        with ZipFile(file_name+'.zip', 'r') as zipObject:<br/>           listOfFileNames = zipObject.namelist()<br/>           for fileName in listOfFileNames:<br/>               if fileName.endswith('.csv'):<br/>                   zipObject.extract(file_name+'.csv')<br/>        <br/>        if os.path.exists(file_name+'.zip'):<br/>            os.remove(file_name+'.zip')<br/></span><span id="31df" class="lr ls jd lb b gy nc mz l na nb">if __name__ == '__main__':<br/>    main()</span></pre><h2 id="66d9" class="lr ls jd bd lt lu lv dn lw lx ly dp lz kl ma mb mc kp md me mf kt mg mh mi mj bi translated">结论</h2><p id="fe9a" class="pw-post-body-paragraph ka kb jd kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">我们学习了如何使用 Python 中的请求库，并使用 get 方法获取给定 URL 的内容。我们讲述了操作系统模块的基础知识，它帮助我们执行创建、更改和删除目录和文件等任务。我们还提到了 python 提供的帮助我们提取某些文件的 zipfile 模块。</p><p id="22a5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">练习 1 的参考链接</p><div class="im in gp gr io lc"><a href="https://github.com/danielbeach/data-engineering-practice/tree/main/Exercises/Exercise-1" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd je gy z fp lh fr fs li fu fw jc bi translated">数据工程实践/练习/练习-1 在主丹尼尔海滩/数据工程实践</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">在第一个练习中，您将练习 Python 技能，并了解一个非常常见的任务...正在下载…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">github.com</p></div></div><div class="ll l"><div class="nj l ln lo lp ll lq iu lc"/></div></div></a></div><p id="0664" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">数据工程实践—第二部分—<a class="ae ja" href="https://medium.com/@sameekshabhatia6/data-engineering-practice-ii-webscraping-and-file-downloading-with-python-cc2b89554d0f" rel="noopener">https://medium . com/@ sameekshabhatia 6/data-Engineering-practice-ii-web scraping-and-file-download-with-python-cc2b 89554 d0f</a></p><p id="dcad" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢👋🏻</p></div></div>    
</body>
</html>