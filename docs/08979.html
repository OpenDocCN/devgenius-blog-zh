<html>
<head>
<title>Automated Work Item Creation on pipeline failure in Azure DevOps Yaml Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps Yaml 管道中管道故障时的自动化工作项创建</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/create-work-item-on-pipeline-failure-in-azure-devops-yaml-pipeline-973bd175166?source=collection_archive---------5-----------------------#2022-07-22">https://blog.devgenius.io/create-work-item-on-pipeline-failure-in-azure-devops-yaml-pipeline-973bd175166?source=collection_archive---------5-----------------------#2022-07-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/34f3c7a984dd8c792af71c8d4b4b7d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPin7BCH_7ohH2h7XzqplQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">流动</figcaption></figure><p id="427a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我将解释如何创建一个像 Bug 这样的工作项，并将其分配给一个管道失败的人。</p><p id="ea37" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">作为本活动的一部分，我们将创建一个可重用的作业，该作业将添加到您现有的作业中，并在实际作业失败时被触发。</p><p id="79cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">先决条件:</strong></p><ol class=""><li id="c1b2" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">您有一个活跃的 Azure DevOps 项目</li><li id="c525" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">如果您使用的是自托管代理，则代理中会安装 Azure CLI</li></ol><div class="ll lm gp gr ln lo"><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd io gy z fp lt fr fs lu fu fw im bi translated">如何安装 Azure 命令行界面</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">Azure CLI 可安装在 Windows、macOS 和 Linux 环境中。它也可以在码头工人…</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">docs.microsoft.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc jt lo"/></div></div></a></div><h1 id="8202" class="md me in bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">步骤:</h1><p id="0926" class="pw-post-body-paragraph jz ka in kb b kc nb ke kf kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ig bi translated">作为实现的一部分，我们将创建 2 个 yaml 文件</p><ul class=""><li id="f15e" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw ng ld le lf bi translated">可重用作业 yaml 来创建工作项</li><li id="7758" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw ng ld le lf bi translated">执行活动的实际管道 yaml</li></ul><ol class=""><li id="c3b6" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated"><strong class="kb io">创建可重用作业</strong></li></ol><p id="671e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">转到您的 Azure DevOps 项目和存储库，并根据以下配置添加一个文件 workitem.yml。</p><blockquote class="nh ni nj"><p id="90bc" class="jz ka nk kb b kc kd ke kf kg kh ki kj nl kl km kn nm kp kq kr nn kt ku kv kw ig bi translated">请根据项目流程创建工作项。如果特定的工作项在项目中不可用，您将会得到错误。</p></blockquote><figure class="np nq nr ns gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/d3238f8221480c14f652ded8ae5248ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDV_cs2VqHRJ3CwbcjX4aQ.png"/></div></div></figure><figure class="np nq nr ns gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/164df994ffc404c6e8d8c01ed63c4d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgQVRMMLGhn7HPcX7nNNNw.png"/></div></div></figure><pre class="np nq nr ns gt nu nv nw nx aw ny bi"><span id="8909" class="nz me in nv b gy oa ob l oc od">parameters:<br/>  - name: AssignedToUser<br/>steps:<br/>  - task: CmdLine@2<br/>    displayName: Install Azure DevOps Extension<br/>    inputs:<br/>      script: 'az extension add --name azure-devops'<br/>  - task: CmdLine@2<br/>    displayName: Configure Default Settings<br/>    inputs:<br/>      script: |<br/>       <br/>        az devops configure --defaults organization=$(System.CollectionUri) project=$(System.TeamProject)<br/>  - task: CmdLine@2<br/>    displayName: Create Work Item<br/>    inputs:<br/>      script: 'az boards work-item create --title "Build $(Build.BuildNumber) failed" --type "Issue" --assigned-to ${{parameters.AssignedToUser}}  --description "Build failure.&lt;div&gt;Pipeline Name - $(Build.DefinitionName)"'<br/>    env:<br/>      AZURE_DEVOPS_EXT_PAT: $(System.AccessToken)<br/># &lt;div&gt; has been added to introduce new line in the description field</span></pre><p id="180a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.<strong class="kb io">使用以下 yaml 配置创建新管道</strong></p><blockquote class="nh ni nj"><p id="76b3" class="jz ka nk kb b kc kd ke kf kg kh ki kj nl kl km kn nm kp kq kr nn kt ku kv kw ig bi translated">工作项-onfailure.yml</p></blockquote><p id="9459" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">用有效的 Azure DevOps 用户更新变量用户</p><pre class="np nq nr ns gt nu nv nw nx aw ny bi"><span id="df9c" class="nz me in nv b gy oa ob l oc od">trigger:<br/>- master</span><span id="e2a9" class="nz me in nv b gy oe ob l oc od">pool:<br/>  vmImage: ubuntu-latest<br/>parameters:<br/>  - name: User<br/>variables:<br/>  - name: User<br/>    value: '<a class="ae of" href="mailto:user@abc.com" rel="noopener ugc nofollow" target="_blank">user@abc.com</a>'<br/>#Replace the User value with a valid azure devops user<br/>stages:<br/>  - stage: fail<br/>    jobs:<br/>      - job: fail<br/>        steps:<br/>          - publish: '$(System.IncorrectPath)'<br/>      - job: createTask<br/>        displayName: Create Bug On Failure<br/>        dependsOn: fail<br/>        condition: failed()<br/>        steps:<br/>          - template: workitem.yml<br/>            parameters:<br/>              AssignedToUser: $(User)</span></pre><p id="1862" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.<strong class="kb io">触发/执行管道检查结果</strong></p><figure class="np nq nr ns gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/2c6224c1a3997981f4519e930ecf915c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGW7gc_7dTeAJ5Z_GCne0Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">管道</figcaption></figure><figure class="np nq nr ns gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/2583bdd316383ba57d05d6ffaaa08373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83kmZgU5nOfyITkanUZl4Q.png"/></div></div></figure></div><div class="ab cl oi oj hr ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ig ih ii ij ik"><p id="0002" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">其他资源:</strong></p><div class="ll lm gp gr ln lo"><a href="https://docs.microsoft.com/en-us/azure/devops/boards/work-items/guidance/choose-process?view=azure-devops&amp;tabs=agile-process" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd io gy z fp lt fr fs lu fu fw im bi translated">为您的 Azure DevOps 项目选择一个流程-Azure board</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">在创建项目的任何时候，您都必须根据为…选择的流程模型来选择流程或流程模板</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">docs.microsoft.com</p></div></div><div class="lx l"><div class="op l lz ma mb lx mc jt lo"/></div></div></a></div><div class="ll lm gp gr ln lo"><a href="https://docs.microsoft.com/en-us/cli/azure/boards/work-item?view=azure-cli-latest" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd io gy z fp lt fr fs lu fu fw im bi translated">az 板工作项</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">az 板工作项创建创建工作项。az boards 工作项创建-标题-类型[ -区域] [ -分配给]…</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">docs.microsoft.com</p></div></div><div class="lx l"><div class="oq l lz ma mb lx mc jt lo"/></div></div></a></div></div><div class="ab cl oi oj hr ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ig ih ii ij ik"><p id="e902" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我希望你喜欢阅读本文，随意添加你的评论、想法或反馈，不要忘记在<a class="ae of" href="https://www.linkedin.com/in/babulaparida/" rel="noopener ugc nofollow" target="_blank"> linkedin </a>上联系。</p></div></div>    
</body>
</html>