<html>
<head>
<title>How to login with Twitter on Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django上登录Twitter</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-login-with-twitter-on-django-cdc11c8b470a?source=collection_archive---------5-----------------------#2022-01-17">https://blog.devgenius.io/how-to-login-with-twitter-on-django-cdc11c8b470a?source=collection_archive---------5-----------------------#2022-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="42bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Django已经提供了一个不可思议的开箱即用的认证机制，但是如果我们想将login与Twitter集成在一起呢？嗯，很简单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4bb1ceed196aefcbb3521d195d9a5bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l5Cluihz9-aToc3u"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">亚历山大·沙托夫在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a42c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数人使用Twitter阅读最新新闻，关注名人八卦，分享他们对时事的看法。</p><p id="d36c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是您也可以将它用于您的Django项目！</p><p id="ccb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Twitter已经成为近年来最受欢迎的社交媒体网站之一。</p><p id="db0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">据统计，Twitter是互联网上增长最快的网站，每月有超过2亿人使用它。</p><p id="7154" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文将向您展示如何创建一个Django项目，该项目可以用于Twitter的登录系统进行身份验证。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="ec7a" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">设置Twitter开发者账户</h1><p id="4acb" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">第一步是在Twitter开发人员门户中设置我们的应用程序，因为我们需要几个密钥来识别和连接我们的应用程序到Twitter，并允许其他用户使用我们的应用程序登录。</p><p id="86da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设你已经有一个Twitter帐户，如果不是这样，那么首先创建一个Twitter帐户，然后回到这里。</p><p id="0976" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要注册开发者帐户:</p><ol class=""><li id="a82e" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">登录Twitter，验证您的电子邮件地址和电话号码</li><li id="6330" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">去developer.twitter.com的<a class="ae lb" href="https://developer.twitter.com/en/portal/petition/essential/basic-info.html" rel="noopener ugc nofollow" target="_blank">用你的基本名字、位置和用例细节注册</a></li><li id="abe2" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">审查并接受<a class="ae lb" href="https://developer.twitter.com/en/developer-terms/agreement.html" rel="noopener ugc nofollow" target="_blank">开发者协议</a></li><li id="ba88" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">现在，您应该可以访问开发人员门户，以创建具有基本访问权限的新应用程序和项目</li></ol><p id="6fa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成注册过程并创建项目和应用程序后，您可以访问<a class="ae lb" href="https://developer.twitter.com/en/portal/dashboard" rel="noopener ugc nofollow" target="_blank">仪表板</a>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/b16d5b282ac17327690f8deeae2e83ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GChzUrJRz5Sakv3CEsnKxg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Twitter开发者门户——作者截图</figcaption></figure><p id="3c6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要导航到“项目和应用程序”来访问我们新创建的应用程序，然后导航到“密钥和令牌”:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/a17394dbdfa686b70ba02b94e240b196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7_1m8NdoCkjqZSi8_kugA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Twitter开发者门户—应用密钥和令牌—作者截图</figcaption></figure><p id="bd15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了允许其他用户通过我们的应用程序登录，我们需要以下一组密钥:</p><ul class=""><li id="8450" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">消费者密钥，这些是我们的应用程序密钥:API密钥和API密钥秘密</li><li id="3435" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">OAuth 2.0密钥，这些是我们的认证密钥:ClientID和Client secret</li></ul><p id="9811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不需要我们的身份验证令牌，因为这些令牌将被用来在API上标识我们自己，我们没有这样做，我们希望标识为其他人。</p><p id="cb75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个配置需求是OAuth的回调URL，为此您需要导航到您的应用程序，然后是“用户验证设置”,然后在“常规验证设置”下填写必要的信息:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ac904a6c9066cc71145020c842973ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*QlssaAajrWcnMgR4-ehi1w.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Twitter开发者门户OAuth应用程序设置上填充回调URL作者截屏</figcaption></figure><p id="77cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让我们作为不同的用户(登录到我们的应用程序的那个用户)使用API，我们需要请求许可，这意味着让那个用户登录Twitter。</p><p id="2ee8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个过程被称为三脚OAuth，它遵循一个独特的流程。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/cc470d92d3a9f5b15fccba2158493dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Yv_Q24-D8FyvG27R.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">三条腿OAuth流程——来源于Twitter开发人员文档</figcaption></figure><p id="290d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该流程由以下步骤组成:</p><ol class=""><li id="411f" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">为我们的应用程序创建一个请求，以获得一个请求令牌，这将为我们提供一个URL，我们将用户重定向到该URL，以便在Twitter上进行身份验证；</li><li id="66cd" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">然后用户进行身份验证，并向我们的应用程序发送一个请求令牌；</li><li id="21c2" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">我们将请求令牌转换成一组可用的用户访问令牌，这些令牌不会过期，这意味着我们可以重用它们；</li></ol><p id="0529" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息可以在Twitter开发者文档中查看。</p><h1 id="6d93" class="lj lk iq bd ll lm nf lo lp lq ng ls lt lu nh lw lx ly ni ma mb mc nj me mf mg bi translated">设置Django项目</h1><p id="a4b1" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">在本文中，我将使用PyCharm作为我们的IDE，因为我非常喜欢它，但是您可以自由地使用任何其他IDE。</p><p id="20d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在PyCharm上创建了一个新项目(带有一个虚拟环境)，让我们称之为“TwitterLogin”。</p><p id="4e6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建项目后，让我们用以下代码安装Django:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="9e30" class="np lk iq nl b gy nq nr l ns nt">$ pip install django</span></pre><p id="5aa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们创建Django项目:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="6a00" class="np lk iq nl b gy nq nr l ns nt">$ django-admin startproject TwitterLogin</span></pre><p id="24db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们创建授权应用程序:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="b90a" class="np lk iq nl b gy nq nr l ns nt">$ cd TwitterLogin<br/>$ python manage.py startapp authorization</span></pre><p id="b73a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们可以编辑项目的“settings.py”文件，以包含新创建的应用程序，并更改默认登录URL:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">settings.py</figcaption></figure><p id="ef85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还改变了我们读取Django的一些标准设置的方式，以便能够从a '读取它们。env '，如下所述。</p><p id="007f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了保存我们的API密钥和秘密，我们将创建一个。env '文件以更安全的方式存储它们:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">。包封/包围（动词envelop的简写）</figcaption></figure><p id="5188" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">能够读懂我们的。我们将安装“python-decouple”包:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="5dbf" class="np lk iq nl b gy nq nr l ns nt">$ pip install python-decouple</span></pre><p id="7837" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就结束了我们的TwitterLogin应用程序的基本Django项目设置，接下来我们将编写代码来执行Twitter登录。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="2cf5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">用Twitter实现我们的Django登录</h1><p id="ae08" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">现在让我们来看看应用程序的核心，它能够让一个用户用Twitter登录，然后在Django中创建一个用户，我们可以用这个用户作为普通用户来检查访问。</p><p id="5c25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了与Twitter API交互，我们将使用优秀的Tweepy库，而不是手动编写请求，我们可以使用:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="c51b" class="np lk iq nl b gy nq nr l ns nt">$ pip install git+<a class="ae lb" href="https://github.com/tweepy/tweepy.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tweepy/tweepy.git</a></span></pre><p id="a032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在使用Tweepy的最新开发版本，因为我想使用一些最新版本(撰写本文时为4.4.0)中尚未提供的特性。</p><p id="447c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关Tweepy的更多信息，请访问:</p><div class="nw nx gp gr ny nz"><a href="https://github.com/tweepy/tweepy" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">GitHub-tweepy/tweepy:Python的Twitter！</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">从PyPI安装最新版本的最简单方法是使用pip:您也可以使用Git来克隆存储库…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kv nz"/></div></div></a></div><h2 id="7b50" class="np lk iq bd ll oo op dn lp oq or dp lt jy os ot lx kc ou ov mb kg ow ox mf oy bi translated">创建模型</h2><p id="45cd" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">第一步是实现我们的模型。</p><p id="54c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些模型将用于存储在三分支oauth流程中使用的oauth_token，以及最终的访问令牌和来自Twitter的用户信息:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">authorization/models.py</figcaption></figure><h2 id="24fe" class="np lk iq bd ll oo op dn lp oq or dp lt jy os ot lx kc ou ov mb kg ow ox mf oy bi translated">创建Twitter API接口</h2><p id="0278" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">接下来，我们创建了与Twitter API接口的文件，我们将创建一个名为“twitter_api”的新文件夹，并在该文件夹中创建一个名为“twitter_api”的新文件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">twitter_api/twitter_api.py</figcaption></figure><p id="6c2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件内容的简短描述:</p><ul class=""><li id="478d" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">函数' __init__ '，我们从'中读取设置。“环境”文件</li><li id="9c02" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">函数' twitter_login '，我们用Twitter API验证我们的应用程序，并请求一个登录URL。我们还返回访问令牌，以便以后存储它们。</li><li id="f61c" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">函数' twitter_callback '，用户成功登录后twitter调用的回调。我们确认收到的令牌，并获得我们的最终访问令牌</li><li id="7adf" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">函数“get_me”，返回Twitter用户的基本资料信息</li></ul><h2 id="dd80" class="np lk iq bd ll oo op dn lp oq or dp lt jy os ot lx kc ou ov mb kg ow ox mf oy bi translated">创建授权和装饰助手文件</h2><p id="05c3" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">接下来，我们创建一个“authorization.py”文件，其中包含一些帮助函数来帮助我们完成授权过程:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">授权/authorization.py</figcaption></figure><p id="bb17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件内容的简短描述:</p><ul class=""><li id="47f3" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">函数“create _ update _ user _ from _ Twitter”接收一个TwitterUser(来自我们的模型)，并确定它是否需要创建或更新一个新的Django用户和TwitterUser。它还将最终令牌与创建的用户相关联。</li><li id="c88c" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">函数“check_token_still_valid”用于确定用户在Twitter上的会话是否有效</li></ul><p id="0772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们要创建的最后一个(新的)文件是“decorators.py”，在这里我们将创建一个Django decorator，帮助我们检查用户是否有一个有效的Twitter会话:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">authorization/decorators.py</figcaption></figure><p id="4295" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件内容的简短描述:</p><ul class=""><li id="5296" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">我们基本上创建了一个装饰器，它检查前面描述的“check_token_still_valid ”,以允许用户访问页面或注销并将用户重定向到登录页面</li><li id="09f4" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">当Twitter会话不再有效时，注销是清除Django日志会话的安全措施</li></ul><h2 id="6e2d" class="np lk iq bd ll oo op dn lp oq or dp lt jy os ot lx kc ou ov mb kg ow ox mf oy bi translated">创建我们的URL和视图文件</h2><p id="5429" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我们在授权应用程序文件夹中创建我们的“urls.py ”:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">authorization/urls.py</figcaption></figure><p id="8599" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要更改主“urls.py”文件，以便它可以包含我们的应用程序URL:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">urls.py</figcaption></figure><p id="513a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经准备好了URL，我们需要创建相应的视图:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">authorization/views.py</figcaption></figure><p id="5b9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们文件内容的简短描述:</p><ul class=""><li id="2a0b" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">查看“twitter_login”，我们从TwitterAPI获取一个URL，并将用户重定向到该URL。我们还存储了oauth_token和oauth_token_secret，以便能够在回调视图中使用它们</li><li id="7c6b" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">视图' twitter_callback '，成功登录后twitter调用的视图。我们首先确定我们的访问是否被拒绝，并显示相应的错误页面。如果我们有一个登录，那么我们验证并获得最终的令牌，检索基本的配置文件数据，并调用前面描述的函数来创建我们的Django用户。</li><li id="c2c0" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">查看“索引”，我们的主页。这里没有逻辑，所有的逻辑都在HTML模板和登录装饰器中。</li><li id="5dc4" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">查看“twitter_logout”，在这里我们执行一个普通的Django用户注销。如果没有Django用户登录，我们需要再次运行Twitter登录来验证用户。</li></ul><h2 id="0492" class="np lk iq bd ll oo op dn lp oq or dp lt jy os ot lx kc ou ov mb kg ow ox mf oy bi translated">创建我们的HTML模板</h2><p id="ba8a" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">最后一步是创建非常简单的HTML模板来显示一些基本信息，以检查登录过程是否成功(或者查看任何错误消息)。</p><p id="0a9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们在“授权”项目文件夹中名为“模板/授权”的目录下创建“home.html”文件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">授权/模板/授权/home.html</figcaption></figure><p id="803d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们创建“error_page.html”模板文件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">授权/模板/授权/错误页面. html</figcaption></figure><p id="0a49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经准备好运行我们的项目和执行Twitter登录了。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="69e4" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">演示和源代码</h1><p id="afc6" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">在运行我们的项目之前，我们需要为我们的模型和初始迁移执行迁移:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="89ea" class="np lk iq nl b gy nq nr l ns nt">$ python manage.py makemigrations<br/>$ python manage.py migrate</span></pre><p id="1bc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要运行我们的项目，我们需要的是典型的:</p><pre class="km kn ko kp gt nk nl nm nn aw no bi"><span id="f060" class="np lk iq nl b gy nq nr l ns nt">$ python manage.py runserver</span></pre><p id="3220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，我们的Twitter登录是通过我们拥有一个回调视图来工作的，Twitter自己会调用这个回调视图来向我们返回信息。</p><p id="9390" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着我们的URL必须是可公开访问的，而不仅仅是在本地主机上运行。</p><p id="4321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，我安装了一个NGINX反向代理，将对我的域名的调用重定向到我的本地机器。</p><p id="5d28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也就是说，让我们看看Twitter登录应用程序的运行情况:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oz"><img src="../Images/a69aea333480669944c010b9d27ebcf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-juFIFp2bJ_Amv7a3E4yPQ.gif"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Twitter登录演示—作者提供的GIF</figcaption></figure><p id="0f3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有用！！！</p><p id="db69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然代码乍一看似乎很复杂，但实际上尽管有不同的文件集，在Twitter上登录一个用户并在Django中创建该用户所需的逻辑非常简单。</p><p id="6132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目的完整源代码可在以下网址找到:</p><div class="nw nx gp gr ny nz"><a href="https://github.com/nunombispo/TwitterLogin/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">GitHub - nunombispo/TwitterLogin:用Django登录Twitter</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="pa l ok ol om oi on kv nz"/></div></div></a></div></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="3611" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="1a09" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">使用第三方身份验证提供者进行日志记录给Django应用程序带来了一些好处:</p><ul class=""><li id="e3e3" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk nc ms mt mu bi translated">不需要注册表格</li><li id="8340" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">无需验证电子邮件地址</li><li id="2a1a" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk nc ms mt mu bi translated">没有恢复密码流</li></ul><p id="646e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除此之外，根据您的应用，这可能是合理的选择，也是唯一允许的方法。</p><p id="f0ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，我用Twitter和Django实现了这个登录，因为我正在构建的SaaS项目是用于Twitter工具的，所以用户用Twitter登录是完全有意义的。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="a7f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在推特上关注我:<a class="ae lb" href="https://twitter.com/DevAsService" rel="noopener ugc nofollow" target="_blank">https://twitter.com/DevAsService</a></p><p id="66f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看我的网站:【https://developer-service.io/ T2】</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="f2a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看您可能感兴趣的其他文章:</p><div class="nw nx gp gr ny nz"><a href="https://python.plainenglish.io/the-easy-way-to-import-export-data-from-django-admin-fe17ecd012fb" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">如何从Django Admin导入或导出数据</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">向Django Admin添加导入/导出功能的指南。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">python .平原英语. io</p></div></div><div class="oi l"><div class="pb l ok ol om oi on kv nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://medium.com/geekculture/django-shorts-password-validators-95285c0936de" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">Django Shorts —密码验证器</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">Django默认有一套很好的密码验证器，但是如果您想添加自己的密码验证器呢？超级简单。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="pc l ok ol om oi on kv nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://medium.com/geekculture/django-shorts-user-authentication-and-lockout-8f7164f88938" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">Django Shorts —用户认证和锁定</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">Django已经提供了很好的开箱即用的用户安全性，但是如果您想添加帐户锁定怎么办呢？然后…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="pd l ok ol om oi on kv nz"/></div></div></a></div><p id="3e06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢读这篇文章，并且觉得它很有用，你可以通过注册一个中级会员来支持我。你每月只需花费5美元——这将使你能够访问所有的媒体报道！(我会收到一小笔佣金)</p><p id="4536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除此之外，如果你想在我发布新文章时保持更新，你可以<a class="ae lb" href="https://blog.developer-service.io/subscribe" rel="noopener ugc nofollow" target="_blank">注册我的免费简讯</a>！</p></div></div>    
</body>
</html>