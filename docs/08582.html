<html>
<head>
<title>Write systemD Service file in Linux(centos and ubuntu)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Linux 中编写 systemD 服务文件(centos 和 ubuntu)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/write-systemd-service-file-in-linux-centos-and-ubuntu-6accf1dc1109?source=collection_archive---------3-----------------------#2022-06-26">https://blog.devgenius.io/write-systemd-service-file-in-linux-centos-and-ubuntu-6accf1dc1109?source=collection_archive---------3-----------------------#2022-06-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="121c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">什么是服务…？</p><p id="dc5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">各种服务在 Linux 背景下持续运行，比如网络和系统服务。运行在 Linux 上的服务也被称为守护进程，指的是一组在后端工作的进程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3c6d68e7df2496df2539ee320a4b1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_2U6zixa5Zh1BhEymmMVw.jpeg"/></div></div></figure><p id="0299" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<strong class="jm io"> Linux </strong>中，<em class="ku"> Systemctl </em>是一个实用程序，负责管理和控制 systemd 系统。<em class="ku"> systemctl </em>命令可用于列出 Linux 中的所有<strong class="jm io">服务</strong>。</p><p id="60a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一些<em class="ku"> systemctl </em>命令的列表:</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="b2c0" class="la lb in kw b gy lc ld l le lf">$ systemctl list-units --type=service --all</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lg"><img src="../Images/5504def8450ebaf6fc494036aed14d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Td3IuuWRONlKoxIdM9TT5Q.png"/></div></div></figure><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="f7d4" class="la lb in kw b gy lc ld l le lf">$ systemctl list-units --type=service --state=running</span></pre><p id="6f78" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的命令显示了正在运行的服务列表..</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="02e3" class="la lb in kw b gy lc ld l le lf">$ systemctl status cron.service</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lh"><img src="../Images/54aabf022f58a249fa7fec16587e692f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-EH09qcRI1fRLPk9akySw.png"/></div></div></figure><p id="641b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有关更多命令详细信息，请访问:</p><p id="0d71" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae li" href="https://www.tecmint.com/list-all-running-services-under-systemd-in-linux/" rel="noopener ugc nofollow" target="_blank">https://www . tecmint . com/list-all-running-services-under-systemd-in-Linux/</a></p><h1 id="b9d9" class="lj lb in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">在 Linux 中哪里可以找到 Systemd 服务文件</h1><p id="cb4b" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">通常主要有两个地方(第三名是<strong class="jm io"> /lib/systemd/system/ </strong>)</p><p id="3445" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们在哪里可以找到服务文件:</p><ol class=""><li id="8fe4" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated"><code class="fe mu mv mw kw b">/etc/systemd/system</code>中的<strong class="jm io">/etc/systemd/system/</strong>:-<strong class="jm io"/>文件由系统的操作员或管理员手动放置在此，用于非软件包形式的临时软件安装。</li><li id="aaf6" class="ml mm in jm b jn mx jr my jv mz jz na kd nb kh mq mr ms mt bi translated"><strong class="jm io">/usr/lib/systemd/system/</strong>:-<strong class="jm io"/>只包含由包管理器放在那里的 systemd 单元文件(YUM/DNF/RPM/APT/etc)。</li></ol><p id="a757" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更多详情请点击链接:<a class="ae li" href="https://unix.stackexchange.com/questions/206315/whats-the-difference-between-usr-lib-systemd-system-and-etc-systemd-system" rel="noopener ugc nofollow" target="_blank">https://UNIX . stack exchange . com/questions/206315/what-the-difference-usr-lib-systemd-system-and-etc-systemd-system</a></p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="1ccb" class="lj lb in bd lk ll nj ln lo lp nk lr ls lt nl lv lw lx nm lz ma mb nn md me mf bi translated">Systemd 服务文件看起来像什么！</h1><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="cdd1" class="la lb in kw b gy lc ld l le lf">[Unit]<br/>Description=Foo<br/><br/>[Service]<br/>ExecStart=/usr/sbin/foo-daemon<br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="508b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用命令创建和附加权限:</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="fab1" class="la lb in kw b gy lc ld l le lf">$ sudo touch /etc/systemd/system/foo-daemon.service<br/>$ sudo chmod <strong class="kw io">664</strong> /etc/systemd/system/foo-daemon.service</span></pre><p id="d478" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本控制命令:</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="9771" class="la lb in kw b gy lc ld l le lf">$ sudo systemctl start foo-daemon<br/>$ sudo systemctl stop foo-daemon<br/>$ sudo systemctl restart foo-daemon<br/>$ systemctl status foo-daemon</span></pre><h1 id="09ad" class="lj lb in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Systemd 服务文件选项</h1><p id="eeb5" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">Systemd 服务文件通常由三部分组成。</p><p id="d454" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通用配置项在通用<code class="fe mu mv mw kw b">[Unit]</code>和<code class="fe mu mv mw kw b">[Install]</code>部分进行配置。</p><p id="a9d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">服务特定配置选项在<code class="fe mu mv mw kw b">[Service]</code>部分进行配置。</p><p id="2c73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以通过命令找到更多细节:</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="c6f3" class="la lb in kw b gy lc ld l le lf">$ <strong class="kw io">man systemd.unit</strong></span><span id="cda1" class="la lb in kw b gy no ld l le lf"><strong class="kw io">[UNIT]</strong> SECTION OPTIONS<br/>       ....</span><span id="5c01" class="la lb in kw b gy no ld l le lf">Description=<br/>           A human readable name for the unit. This is used by systemd (and other UIs) as the label for the unit, so this string<br/>           should identify....</span><span id="cc83" class="la lb in kw b gy no ld l le lf"><strong class="kw io">[INSTALL]</strong> SECTION OPTIONS<br/>       ......</span><span id="1dcc" class="la lb in kw b gy no ld l le lf">Alias=<br/>           A space-separated list of additional names this unit shall be installed under. The names listed here must have the same<br/>           suffix (i.e. type)...</span></pre><p id="8e47" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">对于服务部分:</strong></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="d6e5" class="la lb in kw b gy lc ld l le lf">$ <strong class="kw io">man systemd.service</strong></span><span id="2f70" class="la lb in kw b gy no ld l le lf"><strong class="kw io">OPTIONS</strong><br/>       Service files must include a "[Service]" section, which carries information about the service and the process it supervises.<br/>      ...</span><span id="26ce" class="la lb in kw b gy no ld l le lf">Type=<br/>           Configures the process start-up type for this service unit. One of simple, exec, forking, oneshot, dbus, notify or idle:</span><span id="16ca" class="la lb in kw b gy no ld l le lf">•   If set to si......</span></pre></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="ff23" class="lj lb in bd lk ll nj ln lo lp nk lr ls lt nl lv lw lx nm lz ma mb nn md me mf bi translated">创建我们自己的服务文件</h1><p id="6f3a" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">为了演示，将创建服务文件“<strong class="jm io"> node_server.service </strong>，并使用已经创建的“<strong class="jm io"> mongodb.service </strong>”，它是在 linux 机器上安装<strong class="jm io"> mongodb </strong>数据库软件后自动创建的。</p><h1 id="80b6" class="lj lb in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">mongodb.service</h1><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="898b" class="la lb in kw b gy lc ld l le lf">Description=MongoDB Database Server<br/>Documentation=<a class="ae li" href="https://docs.mongodb.org/manual" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.org/manual</a><br/>After=network-online.target<br/>Wants=network-online.target</span><span id="2051" class="la lb in kw b gy no ld l le lf">[Service]<br/>User=mongodb<br/>Group=mongodb<br/>EnvironmentFile=-/etc/default/mongod<br/>ExecStart=/usr/bin/mongod --config /etc/mongod.conf<br/>PIDFile=/var/run/mongodb/mongod.pid<br/># file size<br/>LimitFSIZE=infinity<br/># cpu time<br/>LimitCPU=infinity<br/># virtual memory size<br/>LimitAS=infinity<br/># open files<br/>LimitNOFILE=64000<br/># processes/threads<br/>LimitNPROC=64000<br/># locked memory<br/>LimitMEMLOCK=infinity<br/># total threads (user+kernel)<br/>TasksMax=infinity<br/>TasksAccounting=false</span><span id="9d40" class="la lb in kw b gy no ld l le lf"># Recommended limits for mongod as specified in<br/># <a class="ae li" href="https://docs.mongodb.com/manual/reference/ulimit/#recommended-ulimit-settings" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.com/manual/reference/ulimit/#recommended-ulimit-settings</a></span><span id="b2fe" class="la lb in kw b gy no ld l le lf">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="c888" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">启用服务:</strong></p><p id="e70f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mu mv mw kw b">$ sudo systemctl enable mongodb.service</code></p><p id="afd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装<strong class="jm io"> mongodb </strong>请参考:<a class="ae li" href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/" rel="noopener ugc nofollow" target="_blank">https://www . MongoDB . com/docs/manual/tutorial/install-MongoDB-on-Ubuntu/</a></p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="8b1e" class="lj lb in bd lk ll nj ln lo lp nk lr ls lt nl lv lw lx nm lz ma mb nn md me mf bi translated">node_server.service</h1><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="da12" class="la lb in kw b gy lc ld l le lf">$ sudo touch /etc/systemd/system/<strong class="kw io">node_server</strong>.service<br/>$ sudo chmod <strong class="kw io">664</strong> /etc/systemd/system/<strong class="kw io">node_server</strong>.service</span></pre><p id="abc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用于使用指定的<strong class="jm io">端口</strong>在<strong class="jm io"> localhost </strong>运行<strong class="jm io">节点</strong>服务器，例如在<strong class="jm io"/><a class="ae li" href="http://localhost:4001/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">http://localhost:4001/</strong></a><strong class="jm io"/>连接<strong class="jm io"> mongodb </strong>数据库并显示<strong class="jm io">数据库</strong>信息<strong class="jm io">。</strong></p><p id="64d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该服务文件中的主要部分是之后的<strong class="jm io">和<strong class="jm io">想要的</strong>字段。它清楚地提到它依赖于<strong class="jm io"> mongodb.service. </strong>每次我们重启机器<strong class="jm io"> node_server.service </strong>总是在<strong class="jm io"> mongodb.service. </strong>之后运行</strong></p><h2 id="fbef" class="la lb in bd lk np nq dn lo nr ns dp ls jv nt nu lw jz nv nw ma kd nx ny me nz bi translated"><strong class="ak">【服务】标签</strong></h2><p id="0b91" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">增加了<strong class="jm io">类型</strong> = <em class="ku">简单</em>(根据需要我们也可以使用<strong class="jm io">通知</strong>或<strong class="jm io">分叉</strong>)</p><p id="35b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们也可以指定<strong class="jm io">用户</strong>和<strong class="jm io">组</strong>来运行进程。</p><p id="5cb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">增加了<strong class="jm io">环境</strong> =" <em class="ku">端口=4001 </em>，也在<strong class="jm io"> ExecStart 中调用。</strong>了解更多信息<strong class="jm io">:</strong><a class="ae li" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Environment" rel="noopener ugc nofollow" target="_blank">https://www . freedesktop . org/software/systemd/man/systemd . exec . html # Environment</a></p><p id="d81e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">增加了<strong class="jm io">ExecStart</strong>=<em class="ku">/usr/bin/node/opt/node _ server/app . js $ { PORT }。</em>其中/usr/bin/node 代表 nodejs 二进制命令，它将运行带有参数<strong class="jm io"> ${PORT} </strong>的<strong class="jm io"> app.js </strong>脚本</p><p id="3573" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还增加了<strong class="jm io">标准输出</strong>=文件:/opt/node_server/ <strong class="jm io">输出 _ 日志</strong>。日志和<br/> <strong class="jm io">标准错误</strong>= file:/opt/node _ server/<strong class="jm io">error _ log</strong>. log .了解更多信息:<a class="ae li" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#StandardOutput=" rel="noopener ugc nofollow" target="_blank">https://www . freedesktop . org/software/systemd/man/systemd . exec . html # standard output =</a></p><p id="73de" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">也可以为此进程配置 ulimit，check out:<a class="ae li" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Process%20Properties" rel="noopener ugc nofollow" target="_blank">https://www . freedesktop . org/software/systemd/man/systemd . exec . html # Process % 20 properties</a></p><p id="5863" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">增加了<strong class="jm io">重启</strong>=总是，当进程意外中断时会重启服务。</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="9531" class="la lb in kw b gy lc ld l le lf"><strong class="kw io">Description</strong>=NodeJs Server<br/><strong class="kw io">Documentation</strong>=<a class="ae li" href="https://nodejs.org/en/docs/" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.org/manual</a><br/><strong class="kw io">After</strong>=<strong class="kw io">mongodb.service</strong><br/><strong class="kw io">Wants</strong>=<strong class="kw io">mongodb.serivce</strong></span><span id="0cbc" class="la lb in kw b gy no ld l le lf">[<strong class="kw io">Service</strong>]<br/><strong class="kw io">Type</strong>=simple</span><span id="3cdf" class="la lb in kw b gy no ld l le lf">#User="we can also specify any user by which process will run"<br/>#Group="we can also specify any group"</span><span id="4344" class="la lb in kw b gy no ld l le lf"><strong class="kw io">Environment</strong>="PORT=4001"</span><span id="ddfe" class="la lb in kw b gy no ld l le lf"><strong class="kw io">ExecStart</strong>=/usr/bin/<strong class="kw io">node</strong> /opt/node_server/<strong class="kw io">app.js</strong> ${<strong class="kw io">PORT</strong>}</span><span id="6c25" class="la lb in kw b gy no ld l le lf"><strong class="kw io">StandardOutput</strong>=file:/opt/node_server/<strong class="kw io">output_log</strong>.log<br/><strong class="kw io">StandardError</strong>=file:/opt/node_server/<strong class="kw io">error_log</strong>.log</span><span id="dcbf" class="la lb in kw b gy no ld l le lf"><strong class="kw io">Restart</strong>=always</span><span id="beab" class="la lb in kw b gy no ld l le lf">[<strong class="kw io">Install</strong>]<br/>WantedBy=multi-user.target</span></pre><p id="e5ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">启动服务:</strong></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="52d1" class="la lb in kw b gy lc ld l le lf">$ sudo systemctl <strong class="kw io">start</strong> node_server.service<br/>$ sudo systemctl <strong class="kw io">status</strong> node_server.service</span><span id="d56f" class="la lb in kw b gy no ld l le lf">node_server.service<br/> Loaded: loaded (/etc/systemd/system/node_server.service; disabled; vendor preset: enabled)<br/> Active: active (running) since Sun 2022–06–26 11:08:51 UTC; 12s ago<br/> Main PID: 1500 (node)<br/> Tasks: 11 (limit: 2274)<br/> Memory: 18.1M<br/> CGroup: /system.slice/node_server.service<br/> └─1500 /usr/bin/node /opt/node_server/app.js 4001</span></pre><p id="93df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">启用服务:</strong></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="6cba" class="la lb in kw b gy lc ld l le lf">$ sudo systemctl <strong class="kw io">enable</strong> node_server.service</span></pre><p id="72c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">重新启动机器:</strong></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="9aac" class="la lb in kw b gy lc ld l le lf">$ sudo shutdown -r now</span></pre><p id="5870" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">重启后，你会看到<strong class="jm io"> mongodb.service </strong>和<strong class="jm io"> node_server.service </strong>都在运行</p><p id="2225" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<a class="ae li" href="http://localhost:4001/" rel="noopener ugc nofollow" target="_blank"> http://localhost:4001/ </a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/006fbd2e3b030b72d7a4d754a19eb9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*CBh48PHBbHgRHswi32VdNw.png"/></div></figure></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="70f4" class="la lb in bd lk np nq dn lo nr ns dp ls jv nt nu lw jz nv nw ma kd nx ny me nz bi translated">app.js 脚本</h2><p id="82e4" class="pw-post-body-paragraph jk jl in jm b jn mg jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd mk kf kg kh ig bi translated">路径:/opt/node _ server/<strong class="jm io">app . js</strong></p><p id="74e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">运行命令:</strong></p><ol class=""><li id="4d35" class="ml mm in jm b jn jo jr js jv mn jz mo kd mp kh mq mr ms mt bi translated">npm 安装 MongoDB-保存</li><li id="6afd" class="ml mm in jm b jn mx jr my jv mz jz na kd nb kh mq mr ms mt bi translated">node app.js</li></ol><p id="5082" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mu mv mw kw b">$ node app.js 4001<br/>Server is running on <a class="ae li" href="http://localhost:4001" rel="noopener ugc nofollow" target="_blank">http://localhost:4001</a></code></p><p id="483d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> app.js </strong>的代码片段:</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="0cb3" class="la lb in kw b gy lc ld l le lf">const http = require("http");<br/>const {MongoClient} = require('mongodb');<br/>const <strong class="kw io">SERVER_PORT</strong> = process.argv[2] || 4001;</span><span id="6441" class="la lb in kw b gy no ld l le lf">const DB_USER="admin";<br/>const DB_PASSWORD="admin@123"<br/>const DB_HOST_NAME="127.0.0.1"<br/>const DB_PORT="27017"<br/>const DATABASE="admin"</span><span id="68c5" class="la lb in kw b gy no ld l le lf">const <strong class="kw io">uri</strong> = `mongodb://${<strong class="kw io">DB_USER</strong>}:${encodeURIComponent(<strong class="kw io">DB_PASSWORD</strong>)}@${<strong class="kw io">DB_HOST_NAME</strong>}:${<strong class="kw io">DB_PORT</strong>}/${<strong class="kw io">DATABASE</strong>}`;</span><span id="5744" class="la lb in kw b gy no ld l le lf">const <strong class="kw io">client</strong> = new MongoClient(uri);</span><span id="032c" class="la lb in kw b gy no ld l le lf">async function startDbConnection(){<br/> try {<br/>   //Connect to the MongoDB cluster<br/>  await client.connect();</span><span id="d1ad" class="la lb in kw b gy no ld l le lf">} catch (e) {<br/>   console.error(e);<br/>}</span><span id="ebfb" class="la lb in kw b gy no ld l le lf">//start db connection<br/><strong class="kw io">startDbConnection();</strong></span><span id="d87e" class="la lb in kw b gy no ld l le lf">const <strong class="kw io">requestListener</strong> = function (req, res) {<br/>   res.setHeader("Content-Type", "text/html");<br/>   res.writeHead(200);<br/>   <strong class="kw io">sendDbDetails(req,res);</strong><br/>};</span><span id="6f3e" class="la lb in kw b gy no ld l le lf">async function <strong class="kw io">sendDbDetails</strong>(req,res){<br/>   let dbDetail = await getDbDetails();<br/>   <strong class="kw io">res</strong>.end(`&lt;html&gt;&lt;body&gt;<br/>            &lt;h1&gt;DB Connection Details&lt;/h1&gt;<br/>            &lt;pre style="background-color:#DCDCDC;<br/>            color:#333;"&gt;<br/>                <strong class="kw io">${JSON.stringify(dbDetail,undefined,2)}</strong><br/>             &lt;/pre&gt;<br/>             &lt;/body&gt;&lt;/html&gt;`);<br/>}</span><span id="77aa" class="la lb in kw b gy no ld l le lf"><br/>async function <strong class="kw io">getDbDetails</strong>(){<br/>    databasesList = await client.db().admin().listDatabases();<br/>    return databasesList.databases;<br/>}</span><span id="8543" class="la lb in kw b gy no ld l le lf">const <strong class="kw io">server</strong> = http.createServer(requestListener);</span><span id="4b12" class="la lb in kw b gy no ld l le lf"><strong class="kw io">server</strong>.listen(<strong class="kw io">SERVER_PORT</strong>, () =&gt; {<br/>  console.log(`Server is running on <a class="ae li" href="http://localhost:${SERVER_PORT}`);" rel="noopener ugc nofollow" target="_blank">http://localhost:${SERVER_PORT}`);</a></span><span id="b7f7" class="la lb in kw b gy no ld l le lf">});</span><span id="e068" class="la lb in kw b gy no ld l le lf"><strong class="kw io"><br/>process</strong>.on('SIGTERM', () =&gt; {<br/>  <strong class="kw io">properlyCloseConnection</strong>()<br/>});</span><span id="65fd" class="la lb in kw b gy no ld l le lf"><strong class="kw io">process</strong>.on('SIGTINT', () =&gt; {<br/> <strong class="kw io">properlyCloseConnection</strong>()<br/>});</span><span id="5580" class="la lb in kw b gy no ld l le lf"><strong class="kw io">process</strong>.on("uncaughtException",(e)=&gt;{<br/>  console.log(e);<br/>  <strong class="kw io">properlyCloseConnection</strong>()<br/>});</span><span id="39a0" class="la lb in kw b gy no ld l le lf"><strong class="kw io">process</strong>.on('exit', function () {<br/>  console.log("process is exited..")<br/>});</span><span id="a2fa" class="la lb in kw b gy no ld l le lf">function <strong class="kw io">properlyCloseConnection</strong>(){<br/>    <strong class="kw io">client</strong>.close(()=&gt;{<br/>        console.log('DB client closed');<br/>    });</span><span id="a738" class="la lb in kw b gy no ld l le lf">    <strong class="kw io">server</strong>.close(() =&gt; {<br/>        console.log('Process terminated');<br/>     });<br/>}</span></pre></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="223d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望这篇文章对在 Linux 中编写服务文件有所帮助。所有代码都在 Linux 操作系统中测试过(Centos 和 Ubuntu)</p><p id="6280" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢阅读。</p></div></div>    
</body>
</html>