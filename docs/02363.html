<html>
<head>
<title>React Tips — Test Buttons, Form Validation, and 404 Routes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React提示—测试按钮、表单验证和404路线</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/react-tips-test-buttons-form-validation-and-404-routes-80e39e074f57?source=collection_archive---------16-----------------------#2020-07-30">https://blog.devgenius.io/react-tips-test-buttons-form-validation-and-404-routes-80e39e074f57?source=collection_archive---------16-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/570ce76c47b0c93723cd7354ec1ce1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_scLH1_55vmuRH65"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@mnemotechnikon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Piotr Stefański </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="7dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="d75e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">开玩笑地模拟按钮点击</h1><p id="f17b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了用Jest模拟按钮点击，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9b79" class="mn lc iq mj b gy mo mp l mq mr">import React from 'react';<br/>import { shallow } from 'enzyme';<br/>import Button from './Button';</span><span id="18e8" class="mn lc iq mj b gy ms mp l mq mr">describe('Test button', () =&gt; {<br/>  it('Test click event', () =&gt; {<br/>    const mockOnClick = jest.fn();<br/>    const button = shallow((&lt;Button onClick={mockOnClick}&gt;click me&lt;/Button&gt;));<br/>    button.find('button').simulate('click');<br/>    expect(mockOnClick.mock.calls.length).toEqual(1);<br/>  });<br/>});</span></pre><p id="4050" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用创建一个模拟函数，并把它传递给我们的按钮组件。</p><p id="2fbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到按钮，用参数<code class="fe mt mu mv mj b">'click'</code>调用<code class="fe mt mu mv mj b">simulate</code>来模拟一次点击。</p><p id="97e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以检查最后是否调用了<code class="fe mt mu mv mj b">mockOnClick</code>函数。</p><p id="105c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，我们可以在Sinon测试中编写类似的代码。</p><p id="be60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="34bc" class="mn lc iq mj b gy mo mp l mq mr">import React from 'react';<br/>import { shallow } from 'enzyme';<br/>import sinon from 'sinon';</span><span id="6795" class="mn lc iq mj b gy ms mp l mq mr">import Button from './Button';</span><span id="7d54" class="mn lc iq mj b gy ms mp l mq mr">describe('Test Button component', () =&gt; {<br/>  it('simulates click events', () =&gt; {<br/>    const mockOnClick = sinon.spy();<br/>    const button = shallow((&lt;Button onClick={mockOnClick}&gt;click me&lt;/Button&gt;));</span><span id="3cb2" class="mn lc iq mj b gy ms mp l mq mr">    button.find('button').simulate('click');<br/>    expect(mockOnClick).toHaveProperty('callCount', 1);<br/>  });<br/>});</span></pre><p id="5595" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">sinon.spy()</code>创建一个模拟函数。</p><p id="5c9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将它传递给<code class="fe mt mu mv mj b">onClick</code>回调函数。</p><p id="cede" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe mt mu mv mj b">'click'</code>参数调用<code class="fe mt mu mv mj b">simulate</code>来模拟点击。</p><p id="35cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以直接从道具中调用我们的<code class="fe mt mu mv mj b">onClick</code>函数。</p><p id="33f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0907" class="mn lc iq mj b gy mo mp l mq mr">wrapper.find('Button').prop('onClick')()</span></pre><h1 id="fd91" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何向Redux添加多个中间件</h1><p id="89b7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">applyMiddleware</code>方法给Redux添加多个中间件。</p><p id="4405" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7b1b" class="mn lc iq mj b gy mo mp l mq mr">const createStoreWithMiddleware = applyMiddleware(ReduxThunk, logger)(createStore);</span></pre><p id="fae2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是将它们直接传递给<code class="fe mt mu mv mj b">applyMiddleware</code>函数。</p><p id="73dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以将它们全部放入一个数组中，并将它们分散到<code class="fe mt mu mv mj b">applyMiddleware</code>中:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eae4" class="mn lc iq mj b gy mo mp l mq mr">const middlewares = [ReduxThunk, logger];<br/>applyMiddleware(...middlewares)</span></pre><h1 id="5d2c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在React中加载DOM时回调</h1><p id="0e4e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">componentDidMount</code>是加载DOM时调用的回调函数。</p><p id="6a6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3c33" class="mn lc iq mj b gy mo mp l mq mr">class Comp1 extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.handleLoad = this.handleLoad.bind(this);<br/>  }</span><span id="5704" class="mn lc iq mj b gy ms mp l mq mr">  componentDidMount() {<br/>    window.addEventListener('load', this.handleLoad);<br/>  }</span><span id="02b2" class="mn lc iq mj b gy ms mp l mq mr">  componentWillUnmount() { <br/>    window.removeEventListener('load', this.handleLoad)  <br/>  }</span><span id="c755" class="mn lc iq mj b gy ms mp l mq mr">  handleLoad() {<br/>    //...<br/>  }</span><span id="a383" class="mn lc iq mj b gy ms mp l mq mr">  render() {<br/>    //...<br/>  }<br/>}</span></pre><p id="68e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有作为<code class="fe mt mu mv mj b">componentDidMount</code>中的<code class="fe mt mu mv mj b">load</code>事件的监听器添加的<code class="fe mt mu mv mj b">handleLoad</code>方法。</p><p id="2454" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">componentWillUnmount</code>中，当组件卸载时，我们移除事件监听器。</p><h1 id="87cd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用React正确验证输入值</h1><p id="47ce" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了简化表单验证，我们可以使用react-hook-form库。</p><p id="04c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c601" class="mn lc iq mj b gy mo mp l mq mr">import React from 'react'<br/>import useForm from 'react-hook-form'</span><span id="9eef" class="mn lc iq mj b gy ms mp l mq mr">function App() {<br/>  const { register, handleSubmit, errors } = useForm() <br/>  const onSubmit = (data) =&gt; { console.log(data) } </span><span id="7652" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;form onSubmit={handleSubmit(onSubmit)}&gt;<br/>      &lt;input name="firstname" ref={register} /&gt;</span><span id="918c" class="mn lc iq mj b gy ms mp l mq mr">      &lt;input name="lastname" ref={register({ required: true })} /&gt; <br/>      {errors.lastname &amp;&amp; 'last name is required'} {</span><span id="338f" class="mn lc iq mj b gy ms mp l mq mr">      &lt;input name="age" ref={register({ pattern: /\d+/ })} /&gt;<br/>      {errors.age &amp;&amp; 'invalid age.'}</span><span id="caf3" class="mn lc iq mj b gy ms mp l mq mr">      &lt;input type="submit" /&gt;<br/>    &lt;/form&gt;<br/>  )<br/>}</span></pre><p id="55cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用包装附带的<code class="fe mt mu mv mj b">useForm</code>挂钩。</p><p id="3e31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用钩子返回的函数和对象来检查有效的输入并显示错误消息。</p><p id="87e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">register</code>让我们用react-hook-form注册输入字段，并添加验证规则。</p><p id="4f55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注册该字段将使它在我们运行提交处理程序时可用。</p><p id="2ef2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以传递一个带有验证规则的对象，就像我们在姓氏和年龄输入中所做的那样。</p><p id="cd18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们对姓氏字段应用了<code class="fe mt mu mv mj b">required</code>规则。</p><p id="8805" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe mt mu mv mj b">age</code>字段中为有效格式设置了一个正则表达式。</p><p id="1b1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">onSubmit</code>函数中，我们有<code class="fe mt mu mv mj b">data</code>参数，它有填充值。</p><p id="d3ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它只在所有字段都有效的情况下运行。</p><p id="c800" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">errors</code>在某一领域有错误。</p><h1 id="dea3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用React路由器添加未找到的页面</h1><p id="46cf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加一个没有路径的<code class="fe mt mu mv mj b">Router</code>组件来添加一个没有找到的页面。</p><p id="1b24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6788" class="mn lc iq mj b gy mo mp l mq mr">&lt;Switch&gt;<br/>  &lt;Route exact path="/"&gt;<br/>    &lt;Home /&gt;<br/>  &lt;/Route&gt;<br/>  &lt;Route path="/will-match"&gt;<br/>    &lt;WillMatch /&gt;<br/>  &lt;/Route&gt;<br/>  &lt;Route path="*"&gt;<br/>     &lt;NoMatch /&gt;<br/>  &lt;/Route&gt;<br/>&lt;/Switch&gt;</span></pre><p id="bffc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一项:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="11e6" class="mn lc iq mj b gy mo mp l mq mr">&lt;Route path="*"&gt;<br/>  &lt;NoMatch /&gt;<br/>&lt;/Route&gt;</span></pre><p id="e13d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是当URL与列出的任何其他内容都不匹配时加载的通配符路由。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/2b9f2ec79b5dcacd95a2d79c2c3e7285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8a2dMiDq7uNu7joh"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@dienyportinanni?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Dieny Portinanni </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="b99b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="426f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用React路由器创建不匹配的路由。</p><p id="3fbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用模拟函数来模拟按钮点击。</p><p id="15d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简化表单验证，我们应该使用一个包。</p><p id="b479" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用React-Redux添加多个中间件。</p></div></div>    
</body>
</html>