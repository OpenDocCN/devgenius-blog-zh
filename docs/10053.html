<html>
<head>
<title>Laravel-Excel — P3: Importing Multiple Sheets and Handling Unknown Defined Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">P3:导入多个工作表并处理未知的已定义工作表</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/laravel-excel-p3-importing-multiple-sheets-and-handling-unknown-defined-sheets-749dbc1ec089?source=collection_archive---------10-----------------------#2022-10-03">https://blog.devgenius.io/laravel-excel-p3-importing-multiple-sheets-and-handling-unknown-defined-sheets-749dbc1ec089?source=collection_archive---------10-----------------------#2022-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fd06eaea59e357392b15ed31cc0df0e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gio8muoFHWMibilZChM7iQ.jpeg"/></div></div></figure><p id="b6a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">理想情况下，您会收到格式正确的 Excel 表，创建导入脚本是小菜一碟，但什么时候会这样呢？你总是有怪癖，你必须想出办法来处理这些怪癖。幸运的是，Laravel-Excel 已经想到了相当多的这些怪癖，并提供了处理它们的好方法。这是多页基础的延续。</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-excel-p2-importing-multiple-sheets-basics-2d20994770b"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">P2:导入多张工作表基础知识</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">Excel 表将自动用 Laravel-Excel 导入。第 1 页到第 N 页将以完全相同的方式处理…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">blog.devgenius.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="9eef" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">跳过未知工作表</h1><p id="6b2e" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">当您收到一个包含多个工作表的 Excel 工作簿时，您可能会为每个工作表设计导入功能，但是如果您需要知道其中一个工作表何时丢失，该怎么办呢？您是希望整个导入崩溃，还是希望更优雅地处理它，而只是得到一个通知，说您期望的工作表不在那里？</p><p id="370a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Laravel-Excel 具有<code class="fe mr ms mt mu b">SkipsUnknownSheets</code>关注点，允许您实现<code class="fe mr ms mt mu b">onUnknownSheet</code>方法。将<code class="fe mr ms mt mu b">$sheetName</code>传递给该方法，以便您可以记录它。</p><p id="7232" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于本例，我们的工作簿将包含以下工作表。</p><ul class=""><li id="b87e" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">user_data_1</code></li><li id="9ffc" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated"><code class="fe mr ms mt mu b">user_data_2</code></li></ul><p id="7e7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的进口商将认识到这些，并能够进口它们。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b4b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了实现已定义但缺失的表的日志功能，我们需要实现<code class="fe mr ms mt mu b">SkipsUnknownSheets</code>关注点。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b880" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本例中，我们定义了一个<code class="fe mr ms mt mu b">user_data_3</code>工作表，但是在我们的工作簿中，我们没有列出它。我们的<code class="fe mr ms mt mu b">onUnknownSheet</code>方法将识别并记录该错误。让我们创建我们的路由并向我们的<code class="fe mr ms mt mu b">UserController</code>类添加一个方法，然后运行导入并检查<code class="fe mr ms mt mu b">app/storage/logs/laravel.log</code>中的日志文件。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="6b09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们调用该路由后，我们记录了以下错误，这是我们所期望的，因为我们的 Excel 工作簿不包含 user_data_3 表。</p><pre class="nj nk nl nm gt np mu nq nr aw ns bi"><span id="b616" class="nt lp iq mu b gy nu nv l nw nx">[2022-10-03 20:08:21] <em class="ny">local.ERROR</em>: Sheet user_data_3 was skipped from import.</span></pre><h1 id="857e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">跳过特定的工作表，让其他工作表不及格</h1><p id="90a9" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">如果有些床单比其他的更重要呢？换句话说，您希望在某些表失败时停止代码执行，并静默处理其他不太重要的表。Laravel-Excel 再次覆盖了您。</p><p id="875b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在前面的例子中，我们在多表选择器类上实现了<code class="fe mr ms mt mu b">SkipsUnknownSheets</code>关注点，但是这次我们将在一个特定的导入上实现它。</p><p id="9a58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将创建一个新的多页选择器。这一次，它不会有<code class="fe mr ms mt mu b">SkipsUnknownSheets</code>的顾虑。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="4cb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要创建我们的<code class="fe mr ms mt mu b">ThirdSheetImporter</code>类。这个进口商会有<code class="fe mr ms mt mu b">SkipsUnknownSheets</code>顾虑。而<code class="fe mr ms mt mu b">FirstSheetImporter</code>和<code class="fe mr ms mt mu b">SecondSheetImporter</code>不会。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="6ede" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们现在运行此代码，并且<code class="fe mr ms mt mu b">user_data_1</code>或<code class="fe mr ms mt mu b">user_data_2</code>页丢失，代码将会中断。如果<code class="fe mr ms mt mu b">user_data_3</code>丢失，Laravel-Excel 将用<code class="fe mr ms mt mu b">onUnknownSheet</code>方法处理它并记录到文件中。是时候在我们的<code class="fe mr ms mt mu b">UserController</code>中创建新的路线、方法和测试了。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们省略<code class="fe mr ms mt mu b">user_data_3</code>，我们会得到同样的错误消息。</p><pre class="nj nk nl nm gt np mu nq nr aw ns bi"><span id="5af0" class="nt lp iq mu b gy nu nv l nw nx">[2022-10-03 20:44:31] <em class="ny">local.ERROR</em>: Sheet user_data_3 was skipped from import.</span></pre><p id="0f1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe mr ms mt mu b">user_data_1</code>丢失，我们抛出<code class="fe mr ms mt mu b">out of bounds</code>异常。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/c124fb3e0975c007131145b8bd47cbea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7MJIs6V9LKiGHVBFkUvuQ.png"/></div></div></figure></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/cb65cb0a5e82117cc085254ce8ffd784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K5X752sbkWgH1njM.jpeg"/></div></figure><p id="5bc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迪诺·卡希奇目前是<a class="ae oi" href="https://www.lsbio.com/" rel="noopener ugc nofollow" target="_blank"> LSBio(寿命生物科学公司)</a>、<a class="ae oi" href="https://absoluteantibody.com/" rel="noopener ugc nofollow" target="_blank">绝对抗体</a>、<a class="ae oi" href="https://www.kerafast.com/" rel="noopener ugc nofollow" target="_blank"> Kerafast </a>、<a class="ae oi" href="https://everestbiotech.com/" rel="noopener ugc nofollow" target="_blank">珠穆朗玛生物科技</a>、<a class="ae oi" href="https://www.nordicmubio.com/" rel="noopener ugc nofollow" target="_blank">北欧 MUbio </a>和<a class="ae oi" href="https://www.exalpha.com/" rel="noopener ugc nofollow" target="_blank"> Exalpha </a>的 IT 主管。他还担任我的自动系统的首席执行官。他有十多年的软件工程经验。他拥有计算机科学学士学位，辅修生物学。他的背景包括创建企业级电子商务应用程序、执行基于研究的软件开发，以及通过写作促进知识的传播。</p><p id="eda0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae oi" href="https://www.linkedin.com/in/dinocajic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，在<a class="ae oi" href="https://instagram.com/think.dino" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上关注他，或者<a class="ae oi" href="https://dinocajic.medium.com/subscribe" rel="noopener">订阅他的媒体刊物</a>。</p><p id="e808" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读 Dino Cajic(以及 Medium 上成千上万的其他作家)的每一个故事。你的会员费直接支持迪诺·卡吉克和你阅读的其他作家。你也可以在媒体上看到所有的故事。 </p></div></div>    
</body>
</html>