<html>
<head>
<title>Testing Vue 3 Apps — Apps with Vuex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试 Vue 3 应用——使用 Vuex 的应用</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/testing-vue-3-apps-apps-with-vuex-85b5e8285ca4?source=collection_archive---------4-----------------------#2021-02-01">https://blog.devgenius.io/testing-vue-3-apps-apps-with-vuex-85b5e8285ca4?source=collection_archive---------4-----------------------#2021-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2ef2ccc1761f1cb15f1da46ae224510c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wcezf1gixCHb1J2v"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@anikolleshi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ani Kolleshi </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6540" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着应用程序变得越来越复杂，自动测试它们变得非常重要。我们可以通过单元测试做到这一点，然后我们就不必手动测试所有的东西了。</p><p id="ca81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过编写一个简单的应用程序并测试它来看看如何测试 Vue 3 应用程序。</p><h1 id="01e3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试 Vuex</h1><p id="72f5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过 Vuex 商店测试应用程序。</p><p id="fdf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有以下应用程序:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d553" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'<br/>import { createStore } from 'vuex'</span><span id="9931" class="mn lc iq mj b gy ms mp l mq mr">const store = createStore({<br/>  state() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>  mutations: {<br/>    increment(state) {<br/>      state.count += 1<br/>    }<br/>  }<br/>})</span><span id="a5f8" class="mn lc iq mj b gy ms mp l mq mr">const App = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;button @click="increment" /&gt;<br/>      Count: {{ count }}<br/>    &lt;/div&gt;<br/>  `,<br/>  computed: {<br/>    count() {<br/>      return this.$store.state.count<br/>    }<br/>  },<br/>  methods: {<br/>    increment() {<br/>      this.$store.commit('increment')<br/>    }<br/>  }<br/>}</span><span id="b838" class="mn lc iq mj b gy ms mp l mq mr">const app = createApp(App)<br/>app.use(store)</span></pre><p id="291a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用真正的 Vuex 商店来测试。</p><p id="8806" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过编写以下内容来添加测试:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="88c0" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'<br/>import { createApp } from 'vue'<br/>import { createStore } from 'vuex'</span><span id="1e70" class="mn lc iq mj b gy ms mp l mq mr">const store = createStore({<br/>  state() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>  mutations: {<br/>    increment(state) {<br/>      state.count += 1<br/>    }<br/>  }<br/>})</span><span id="0696" class="mn lc iq mj b gy ms mp l mq mr">const App = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;button @click="increment" /&gt;<br/>      Count: {{ count }}<br/>    &lt;/div&gt;<br/>  `,<br/>  computed: {<br/>    count() {<br/>      return this.$store.state.count<br/>    }<br/>  },<br/>  methods: {<br/>    increment() {<br/>      this.$store.commit('increment')<br/>    }<br/>  }<br/>}</span><span id="1a7b" class="mn lc iq mj b gy ms mp l mq mr">const app = createApp(App)<br/>app.use(store)</span><span id="7629" class="mn lc iq mj b gy ms mp l mq mr">test('vuex', async () =&gt; {<br/>  const wrapper = mount(App, {<br/>    global: {<br/>      plugins: [store]<br/>    }<br/>  })<br/>  await wrapper.find('button').trigger('click')<br/>  expect(wrapper.html()).toContain('Count: 1')<br/>})</span></pre><p id="1673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将我们的<code class="fe mt mu mv mj b">store</code>传递到为<code class="fe mt mu mv mj b">plugins</code>属性设置的数组中。</p><p id="4b65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们点击<code class="fe mt mu mv mj b">App</code>中的按钮时，真实商店的状态被更新。</p><h1 id="e3ba" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用模拟商店进行测试</h1><p id="f1a6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以用模拟商店来测试应用程序。</p><p id="d904" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0c05" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'<br/>import { createApp } from 'vue'<br/>import { createStore } from 'vuex'</span><span id="9240" class="mn lc iq mj b gy ms mp l mq mr">const store = createStore({<br/>  state() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>  mutations: {<br/>    increment(state) {<br/>      state.count += 1<br/>    }<br/>  }<br/>})</span><span id="8d55" class="mn lc iq mj b gy ms mp l mq mr">const App = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;button <a class="ae kc" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="increment" /&gt;<br/>      Count: {{ count }}<br/>    &lt;/div&gt;<br/>  `,<br/>  computed: {<br/>    count() {<br/>      return this.$store.state.count<br/>    }<br/>  },<br/>  methods: {<br/>    increment() {<br/>      this.$store.commit('increment')<br/>    }<br/>  }<br/>}</span><span id="668b" class="mn lc iq mj b gy ms mp l mq mr">const app = createApp(App)<br/>app.use(store)</span><span id="5864" class="mn lc iq mj b gy ms mp l mq mr">test('vuex using a mock store', async () =&gt; {<br/>  const $store = {<br/>    state: {<br/>      count: 25<br/>    },<br/>    commit: jest.fn()<br/>  }<br/>  const wrapper = mount(App, {<br/>    global: {<br/>      mocks: {<br/>        $store<br/>      }<br/>    }<br/>  })<br/>  expect(wrapper.html()).toContain('Count: 25')<br/>  await wrapper.find('button').trigger('click')<br/>  expect($store.commit).toHaveBeenCalled()<br/>})</span></pre><p id="35b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用作为模拟函数的<code class="fe mt mu mv mj b">commit</code>方法创建我们的<code class="fe mt mu mv mj b">$store</code>对象。</p><p id="82b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到渲染状态。</p><p id="4a80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们点击按钮，检查是否调用了<code class="fe mt mu mv mj b">$store.commit</code>。</p><p id="a6aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很方便，因为我们在挂载的组件中没有任何外部依赖。</p><p id="afe7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，如果我们打破了 Vuex 商店，那么我们没有任何警告。</p><h1 id="95d7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2ba4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Vue 3 的 Vue 测试工具测试连接到 Vuex 商店的组件。</p></div></div>    
</body>
</html>