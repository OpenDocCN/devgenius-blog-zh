<html>
<head>
<title>Interactive data visualization with Plotly and Dash (Part 3) — Adding subplots with Plotly Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Plotly 和 Dash 实现交互式数据可视化(第 3 部分)——用 Plotly Express 添加支线图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/interactive-data-visualization-with-plotly-and-dash-part-3-adding-subplots-with-plotly-express-43f263d4b166?source=collection_archive---------4-----------------------#2022-09-27">https://blog.devgenius.io/interactive-data-visualization-with-plotly-and-dash-part-3-adding-subplots-with-plotly-express-43f263d4b166?source=collection_archive---------4-----------------------#2022-09-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9ffaffcb57f1d2e5862508ab38bb92c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTt4AjMkfJhrcYjiTmHwwA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@goumbik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae jz" href="https://unsplash.com/s/photos/data-dashboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="9cee" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">概述</h1><p id="3f74" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在第 1 部分中，我看了如何用<a class="ae jz" href="https://dash.plotly.com/" rel="noopener ugc nofollow" target="_blank">破折号和</a>开始跑步。如果您从未使用过这些库，这可能是一个不错的起点。教程的第一部分介绍了为什么以及如何启动和运行。为了让事情尽可能简单，我检查了数据收集和转换过程，向 Dash 应用程序添加了一个简单的聚合线图，并创建了一个回调，允许用户选择要检查的时间范围。</p><p id="fefa" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">第 2 部分使用了一些诡计来为应用程序增加重要的交互洞察力。Dash 允许将子元素从应用回调传递到应用布局中的 HTML 元素。我利用这个功能来创建包含百分比值和类别的文本块，从而为用户生成关键的洞察力。</p><p id="8a34" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">第三部分也是最后一部分将根据我在第二部分中画的草图利用支线剧情来完成这个应用。</p><h1 id="044d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">警告</h1><p id="22f7" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">这将会很有趣:</p><p id="5f28" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">“目前，Plotly Express 不支持创建具有任意混合支线剧情的人物，即具有不同类型支线剧情的人物。Plotly Express 只支持<a class="ae jz" href="https://plotly.com/python/facet-plots/" rel="noopener ugc nofollow" target="_blank">小面剧情</a>和<a class="ae jz" href="https://plotly.com/python/marginal-plots/" rel="noopener ugc nofollow" target="_blank">边缘分布支线剧情</a>。要制作带有混合支线剧情的图形，结合使用<code class="fe mb mc md me b"><a class="ae jz" href="https://plotly.com/python/subplots/" rel="noopener ugc nofollow" target="_blank">make_subplots()</a></code>功能和<a class="ae jz" href="https://plotly.com/python/graph-objects/" rel="noopener ugc nofollow" target="_blank">图形对象</a>——<a class="ae jz" href="https://plotly.com/python/mixed-subplots/" rel="noopener ugc nofollow" target="_blank">见文档</a></p><p id="7398" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">有一种方法可以让支线剧情和 Plotly express 一起工作。既不好看也不超级实用。</p><p id="7378" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">那么，为什么我要在本教程中加入一种黑客的做事方式呢？</p><p id="7a72" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">对我来说，失败是学习的一部分。通过实现文档中所说的不可能实现的东西，我学到了很多关于 Plotly 和 Dash 的不同特性是如何一起工作的(以及局限性在哪里)。</p><h1 id="8e2d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">让我们用“错误的”方式做事:-)</h1><p id="8bc9" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">第 2 部分中的草图展示了将添加到应用程序中的三种不同的可视化效果，用户可以选择一个州(瑞士联邦成员国的瑞士名称)来查看有关数据的更多细节。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/0bb532f4ca869544c17781d657f97241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCwSKCoakKktuA1b2j_IQQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">应用程序应该是什么样子</figcaption></figure><p id="b345" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">以防你错过，这是目前为止的代码:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="7e13" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">该应用程序底部的想法是包括三个支线剧情，可以根据用户的选择进行更新。</p><p id="8d8b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">瑞士有 26 个州。因为有这么多，我决定有一个可搜索的下拉菜单来输入选择。选择州的单个框释放了大量的屏幕空间，尤其是与单选按钮相比。默认情况下，Dash 下拉列表(来自 Dash core components)是可搜索的，并且只允许单个选择(这可以通过在初始化 dcc 时设置<em class="mm"> multi=True </em>来更改)。下拉菜单)。</p><p id="5ea8" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">对于用户可以选择的选项，通过迭代数据集的唯一值来传递字典(并按名称排序)。从这个迭代开始，第一个值被设置为默认值。</p><p id="898c" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">然后，第二个范围滑块被添加到应用程序布局中。与第一个滑块(在应用程序的顶部)相反，这个滑块最初只允许通过传递一个值来选择一个值。</p><p id="5b96" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">最后一个 dcc。图形对象完成了应用程序的布局。这个最终的对象将接收一个基于用户输入的图形，该图形具有三个子图形。因为这个图形将处理支线剧情，所以在布局中不需要定义更多的东西。</p><p id="805f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">应用程序下半部分的布局代码:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="12a0" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">情节紧凑的支线剧情(或不要做什么)</h1><p id="3c73" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">首先需要做的是导入支线剧情:</p><pre class="mg mh mi mj gt mn me mo mp aw mq bi"><span id="40ed" class="mr kb in me b gy ms mt l mu mv">from plotly.subplots import make_subplots</span></pre><p id="f83c" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">导入完成后，可以定义用于生成图形的回调。输入将从我刚才添加到布局的用户选择。所有内容都被计算出来，并作为一个数字传递给回调输出。</p><p id="6996" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">制作支线剧情时，需要定义支线剧情的规格。这是通过向 specs 参数传递一个字典数组来实现的。在子情节初始化中，也可以指定不同子情节的标题。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="b8a0" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">Plotly express 抽象出了许多创建情节的复杂性。另一方面，Make_subplots()使用较低级别的图形对象来创建支线剧情。“由 Plotly Python 库创建、操作和渲染的图形是由树状数据结构表示的<a class="ae jz" href="https://plotly.com/python/figure-structure/" rel="noopener ugc nofollow" target="_blank">，这些数据结构被自动序列化到 JSON 以供 Plotly.js JavaScript 库渲染。这些树由称为“属性”的命名节点组成，其结构由 Plotly.js 图形模式定义，该模式以</a><a class="ae jz" href="https://raw.githubusercontent.com/plotly/plotly.js/master/dist/plot-schema.json" rel="noopener ugc nofollow" target="_blank">机器可读形式</a>提供。<code class="fe mb mc md me b">plotly.graph_objects</code>模块(通常作为<code class="fe mb mc md me b">go</code>导入)包含一个自动生成的 Python 类的<a class="ae jz" href="https://plotly.com/python-api-reference/plotly.graph_objects.html#graph-objects" rel="noopener ugc nofollow" target="_blank">层次结构，该层次结构表示该图模式中的非叶节点。术语“图形对象”指的是这些类的实例。</a></p><p id="28e2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">在<code class="fe mb mc md me b">plotly.graph_objects</code>模块中定义的主要类是<code class="fe mb mc md me b"><a class="ae jz" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html" rel="noopener ugc nofollow" target="_blank">Figure</a></code>和一个兼容<code class="fe mb mc md me b"><a class="ae jz" href="https://plotly.com/python/figurewidget/" rel="noopener ugc nofollow" target="_blank">ipywidgets</a></code> <a class="ae jz" href="https://plotly.com/python/figurewidget/" rel="noopener ugc nofollow" target="_blank">的名为</a> <code class="fe mb mc md me b"><a class="ae jz" href="https://plotly.com/python/figurewidget/" rel="noopener ugc nofollow" target="_blank">FigureWidget</a></code>的变体，它们都表示完整的图形。这些类的实例有许多方便的方法，用于 python 化地<a class="ae jz" href="https://plotly.com/python/creating-and-updating-figures/" rel="noopener ugc nofollow" target="_blank">操作它们的属性</a>(例如<code class="fe mb mc md me b">.update_layout()</code>或<code class="fe mb mc md me b">.add_trace()</code>，它们都接受<a class="ae jz" href="https://plotly.com/python/creating-and-updating-figures/#magic-underscore-notation" rel="noopener ugc nofollow" target="_blank">“神奇下划线”符号</a>)以及<a class="ae jz" href="https://plotly.com/python/renderers/" rel="noopener ugc nofollow" target="_blank">呈现它们</a>(例如<code class="fe mb mc md me b">.show()</code>)和<a class="ae jz" href="https://plotly.com/python/static-image-export/" rel="noopener ugc nofollow" target="_blank">导出它们到各种格式</a>(例如<code class="fe mb mc md me b">.to_json()</code>或<code class="fe mb mc md me b">.write_image()</code>或<code class="fe mb mc md me b">.write_html()</code>)。”— <a class="ae jz" href="https://plotly.com/python/graph-objects/" rel="noopener ugc nofollow" target="_blank">来自文档</a></p><p id="9b2e" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated"><strong class="la io">文档还告诉我们，用 Plotly Express 创建的可视化将它们的图形对象存储在一个. data 属性中…有趣… </strong></p><p id="3511" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">所以如果我遍历。数据属性，并将存储的图形对象作为轨迹添加到子情节中，条形图会显示在子情节中吗？</p><p id="ce67" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">简而言之，是的</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="dad0" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">同样的想法被用来在应用程序的底部添加一个饼图和一个折线图:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="aecd" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">为什么不用这个？</h1><p id="fc6b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">主要原因是清晰度。上面的最后一行代码</p><pre class="mg mh mi mj gt mn me mo mp aw mq bi"><span id="a917" class="mr kb in me b gy ms mt l mu mv">fig.update_layout(showlegend=False)</span></pre><p id="6d36" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">关闭支线剧情中的所有图例。这使得可视化比必要的更难阅读。打开图例时，图例被分组并像单个图例一样阅读。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/aac5453b748cfa468c8db9a2cfd514de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ob6VT_7C1Y9BE7xyfcEHIA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">打开图例的应用程序</figcaption></figure><p id="1d8f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这可以通过将图例分组并为每个支线剧情使用不同的颜色来部分缓解。这些解决方法似乎不是最佳的，特别是因为修复这个问题可能需要更少的代码。</p><h1 id="638b" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">简单的解决办法</h1><p id="0ccb" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">简单的解决办法是创建三种不同的 html。每个可视化的 Div 元素。根据样式，这将减少所需的代码量(在本例中)。</p><h1 id="e4e3" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">收尾工作</h1><p id="0f42" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">该应用程序在本地计算机上应该是这样的:</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/c7239fdb2d507757d6fb295066afa75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUbg2ZWszJjMBm7tcWXreQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">最终应用的屏幕截图</figcaption></figure><p id="0bbd" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">完整的代码，如果你想自己玩的话:</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="48ae" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">本教程系列到此为止。</p><p id="483d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我希望你有美好的一天。</p></div></div>    
</body>
</html>