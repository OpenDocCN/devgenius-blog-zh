<html>
<head>
<title>Kubernetes CI/CD with CircleCI and ArgoCD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 CircleCI 和 ArgoCD 的 Kubernetes CI/CD</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/kubernetes-ci-cd-with-circleci-and-argocd-6473b0acdc1a?source=collection_archive---------0-----------------------#2020-09-29">https://blog.devgenius.io/kubernetes-ci-cd-with-circleci-and-argocd-6473b0acdc1a?source=collection_archive---------0-----------------------#2020-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b2d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个端到端的设置，使用 GitOps 原则将应用程序声明性地部署到 Kubernetes。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/95b99650df819fb92a4403c95cd77585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s72K3dV1dMbUndFFkjN0_A.png"/></div></div></figure><p id="e9d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">近年来，DevOps 的一个主要趋势是在 Kubernetes 上采用 GitOps 来管理基础设施代码(IaC)和云原生应用程序。GitOps 最初是由<a class="ae kx" href="https://www.weave.works/" rel="noopener ugc nofollow" target="_blank"> WeaveWorks </a>引入的，作为一种通过 Git 声明性地配置和管理基础设施和应用程序的方式。虽然 GitOps 是一种自以为是的 CI/CD 流程方法，但 IaC 背后的基本思想和 Kubernetes 的融合特性与 GitOps 非常契合。在本帖中，我们将查看端到端 CI/CD 管道的演示设置，并根据您的团队规模、角色和需求讨论一些重要的考虑事项。</p><p id="4dd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">注:本指南使用 CircleCI 和 ArgoCD，但工具可以互换，以建立 GitOps 驱动的 CI/CD 管道(如 JenkinsX、Spinnaker) </em></p><div class="kz la gp gr lb lc"><a href="https://www.weave.works/technologies/gitops/" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd ir gy z fp lh fr fs li fu fw ip bi translated">GitOps 您需要知道的内容</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">GitOps 是 Kubernetes 集群管理和应用交付的一种方式。它通过使用 Git 作为单一来源来工作…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">www.weave.works</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq kv lc"/></div></div></a></div><h1 id="7826" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">端到端 CI/CD 体系结构</h1><p id="3ec8" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">总体而言，CI/CD 渠道将涵盖以下步骤:</p><ol class=""><li id="c6fd" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated">开发人员将代码提交给 Git repo(例如 Github/Bitbucket/Gitlab)。</li><li id="5ef7" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">CircleCI 贯穿 CI 工作流程的各个步骤(即安全审计、林挺、测试等)。</li><li id="15eb" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">Docker 容器被创建并被推送到容器注册处(例如，GCR 的 Docker Hub，ECR)。</li><li id="f322" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">Kubernetes 清单被生成并提交给 ArgoCD 监视的一个单独的 repo。</li><li id="9554" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">ArgoCD 检测变化，并向已配置的 Kubernetes 集群部署新的应用程序/基础设施。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/2ab578febb419fcacaaa438855027c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wjlOd0JA3xSTtkd_.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/operator-manual/architecture/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><h1 id="00e5" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">CI 注意事项</h1><p id="a97e" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">为了使本指南适用于其他 CI 工具，而不是关注特定于 CircleCI 的语法，我将为 CI 管道提供一些重要的考虑因素，以适应 GitOps CD 操作。使用 CircleCI 的具体例子，可以跟着这个<a class="ae kx" href="https://www.virtualthoughts.co.uk/2020/06/24/end-to-end-automation-with-circleci-and-argocd-part-2-circleci-configuration/" rel="noopener ugc nofollow" target="_blank">优秀指南</a>作者<a class="ae kx" href="https://github.com/David-VTUK/" rel="noopener ugc nofollow" target="_blank"> David-VTUK </a>。</p><p id="b263" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的 CI 管道首先要考虑的是如何分离源代码/应用程序代码和基础设施。ArgoCD 建议保留两个独立的 repos :一个用于应用程序代码，另一个用于清单。使用单独的 Git 存储库的好处是:</p><ol class=""><li id="0e1f" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated">应用程序和配置代码之间有明确的分离。当您希望仅修改清单(例如，添加新的 env 变量或更改配置映射)时，这可以防止整个 CI 构建运行，这可能需要很长时间。</li><li id="b866" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">如果您有一个单独的生产工程/SRE 团队负责部署，您可以分离访问权限，并拥有一个更清晰的审核日志。</li><li id="1200" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">有些应用程序可能作为一个单元部署，或者具有独立的组件(例如 ELK stack、Prometheus + Grafana)。独立的配置回购允许多个应用程序回购独立地推送更改，但允许 CD 工具监控单个回购并同时部署所有组件。</li></ol><p id="a536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，确切的分离点取决于您的团队的组成和用于打包 Kubernetes 清单的工具(例如 Helm、Kustomize、Ksonnet 等)。在 Leverege，我们没有专门的 SRE 团队负责部署。每个开发人员负责使用内部工具创建 Helm 模板，以基于本地配置文件引导清单。在我们的例子中，CircleCI 构建 Docker 映像，打包 Helm 文件，并将其推送到我们的私有 ChartMuseum 实例。另一个 mono-repo 存储每个环境/集群的<code class="fe nn no np nq b">values.yaml</code>文件，并触发部署过程。拥有专用 sre 的大型团队可以选择在每个团队或产品的专用存储库中跟踪配置文件，Helm 文件也在该存储库中。</p><p id="464b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，尽管 GitOps 的目标之一是不变性，但为必要的更改留一些自由也是很重要的。在 Kubernetes 上，这通常与动态值有关(即水平自动缩放或资源请求的副本数量)。例如，如果您依赖垂直 Pod Autoscaler 来动态更改 CPU/内存请求和限制，请不要通过 Git 跟踪这些字段，否则应用程序将会持续不同步。这类似于在 Terraform 中忽略所需的节点数，以允许集群自动伸缩来响应 Kubernetes 工作负载。</p><h1 id="d5fd" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">设置 ArgoCD</h1><p id="da79" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">ArgoCD 是一个流行的云原生 CD 工具，被 Intuit、New Relic、NVIDIA 和更多的 T2 使用。随着去年来自 WeaveWorks 的 Flux CD 与 ArgoCD 的联手，ArgoCD 成为不需要 Spinnaker 所有健壮功能的用户的一个很好的工具。</p><h2 id="bdc8" class="nr ls iq bd lt ns nt dn lx nu nv dp mb jy nw nx mf kc ny nz mj kg oa ob mn oc bi translated">装置</h2><p id="17ab" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">安装 ArgoCD 非常简单。使用 Github 上的<a class="ae kx" href="https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml" rel="noopener ugc nofollow" target="_blank">清单或者社区维护的</a><a class="ae kx" href="https://github.com/argoproj/argo-helm/tree/master/charts/argo-cd" rel="noopener ugc nofollow" target="_blank">舵图</a>:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="d9f2" class="nr ls iq nq b gy oh oi l oj ok">$ kubectl create namespace argocd <br/>$ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</span></pre><p id="3feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 GKE 上，需要一个额外的管理员角色来创建新的集群角色:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="e787" class="nr ls iq nq b gy oh oi l oj ok">$ kubectl create clusterrolebinding cluster-admin-binding --clusterrole=cluster-admin --user="$(gcloud config get-value account)"</span></pre><p id="1c79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要与 ArgoCD 服务器交互，您需要首先下载 CLI(使用<code class="fe nn no np nq b">brew</code>或<a class="ae kx" href="https://github.com/argoproj/argo-cd/releases" rel="noopener ugc nofollow" target="_blank">直接从 GitHub </a>下载):</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="8d7c" class="nr ls iq nq b gy oh oi l oj ok">$ brew install argocd</span></pre><h2 id="e0cd" class="nr ls iq bd lt ns nt dn lx nu nv dp mb jy nw nx mf kc ny nz mj kg oa ob mn oc bi translated">初始设置</h2><p id="5558" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">ArgoCD 服务器公开 gRPC(用于 CLI)和 HTTPS(用于 UI)。要访问服务器，您可以通过入口端口转发或配置 ArgoCD:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="c57d" class="nr ls iq nq b gy oh oi l oj ok">$ kubectl port-forward svc/argocd-server -n argocd 8080:443</span></pre><p id="bf37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们将 Traefik 与 Cert Manager 一起使用，因此我们部署了以下 IngressRoute，并在<code class="fe nn no np nq b">argocd-server</code>部署中添加了<code class="fe nn no np nq b">insecure</code>标志(<em class="ky">重要提示:如果您使用 Traefik，请在更新部署之前记录 argocd-server 的初始 pod 名称，因为这是默认密码</em>):</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="47fc" class="nr ls iq nq b gy oh oi l oj ok">apiVersion: traefik.containo.us/v1alpha1<br/>kind: IngressRoute<br/>metadata:<br/>  name: argocd-server<br/>  namespace: argocd<br/>spec:<br/>  entryPoints:<br/>    - websecure<br/>  routes:<br/>    - kind: Rule<br/>      match: Host(`argocd.example.com`)<br/>      priority: 10<br/>      services:<br/>        - name: argocd-server<br/>          port: 80<br/>    - kind: Rule<br/>      match: Host(`argocd.example.com`) &amp;&amp; Headers(`Content-Type`, `application/grpc`)<br/>      priority: 11<br/>      services:<br/>        - name: argocd-server<br/>          port: 80<br/>          scheme: h2c<br/>  tls:<br/>    secretName: &lt;my-wildcard-cert&gt;</span></pre><p id="ffda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">注:ArgoCD 还支持</em><a class="ae kx" href="https://argoproj.github.io/argo-cd/operator-manual/ingress/#kubernetesingress-nginx" rel="noopener ugc nofollow" target="_blank"><em class="ky">ingress-nginx</em></a><em class="ky">和</em><a class="ae kx" href="https://argoproj.github.io/argo-cd/operator-manual/ingress/#aws-application-load-balancers-albs-and-classic-elb-http-mode" rel="noopener ugc nofollow" target="_blank"><em class="ky">AWS ALB/ELB</em></a></p><p id="5951" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦服务器通过入口暴露或转发到本地主机，获取自动生成的密码:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="7abf" class="nr ls iq nq b gy oh oi l oj ok">$ kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2</span></pre><p id="3d79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并使用用户名<code class="fe nn no np nq b">admin</code>登录(如果你的 ingress 不支持 HTTPS/gRPC，添加以下标志<code class="fe nn no np nq b">--grpc-web</code>):</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="328f" class="nr ls iq nq b gy oh oi l oj ok">$ argocd login &lt;server&gt;</span></pre><p id="c9bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，通过以下方式更新默认密码:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="38cf" class="nr ls iq nq b gy oh oi l oj ok">$ argocd account update-password</span></pre><h2 id="225a" class="nr ls iq bd lt ns nt dn lx nu nv dp mb jy nw nx mf kc ny nz mj kg oa ob mn oc bi translated">添加集群</h2><p id="1e69" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">由于 ArgoCD 很可能安装在一个实用集群上(在 Leverege，它运行在托管 Vault、Chart Museum 和 Prometheus/Grafana 的同一个集群上)，ArgoCD 首先需要访问外部集群。ArgoCD 将服务帐户(<code class="fe nn no np nq b">argocd-manager</code>)安装到<code class="fe nn no np nq b">kube-system</code>名称空间中，并绑定到管理集群角色:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="fcc1" class="nr ls iq nq b gy oh oi l oj ok">$ argocd cluster add &lt;context-name&gt; </span></pre><p id="b0dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于内部集群，Kubernetes API 服务器地址可以设置为<code class="fe nn no np nq b"><a class="ae kx" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a></code>，而不必绑定服务帐户。通过重复此步骤，您可以添加 ArgoCD 有权部署的所有集群。目前，多集群部署(即将同一应用部署到一个管道中的多个集群)尚未得到支持，但正在<a class="ae kx" href="https://github.com/argoproj-labs/applicationset" rel="noopener ugc nofollow" target="_blank"> ApplicationSet CRD </a>的积极开发中。</p><h2 id="4c6b" class="nr ls iq bd lt ns nt dn lx nu nv dp mb jy nw nx mf kc ny nz mj kg oa ob mn oc bi translated">连接到 Git Repo</h2><p id="a3e3" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">除非包含清单的存储库是公共的，否则 ArgoCD 需要首先向私有存储库进行身份验证。</p><p id="9874" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为您的 Git 托管服务生成令牌:</p><ul class=""><li id="d126" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk ol na nb nc bi translated"><a class="ae kx" href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line" rel="noopener ugc nofollow" target="_blank"> Github </a></li><li id="3799" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://docs.gitlab.com/ee/user/project/deploy_tokens/" rel="noopener ugc nofollow" target="_blank"> Gitlab </a></li><li id="70d1" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html" rel="noopener ugc nofollow" target="_blank">比特桶</a></li></ul><p id="6135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后通过 CLI 添加回购:</p><pre class="km kn ko kp gt od nq oe of aw og bi"><span id="ec83" class="nr ls iq nq b gy oh oi l oj ok">$ argocd repo add https://github.com/argoproj/argocd-example-apps --username &lt;username&gt; --password &lt;token&gt;</span></pre><p id="abe2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者通过 UI: <code class="fe nn no np nq b">Settings/Repositories &gt; Connect Repo using HTTPS</code></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi om"><img src="../Images/520ba762e0db325181af5fc42ddfc784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qoDee6oieg9388Js.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/user-guide/private-repositories/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><h2 id="4033" class="nr ls iq bd lt ns nt dn lx nu nv dp mb jy nw nx mf kc ny nz mj kg oa ob mn oc bi translated">创建 ArgoCD 应用程序</h2><p id="ca71" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">最后，我们可以部署我们的应用程序。如果您没有准备好测试的应用程序或 Git repo，您可以从 ArgoCD 的示例应用程序中进行选择:</p><ul class=""><li id="a041" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk ol na nb nc bi translated"><a class="ae kx" href="https://github.com/argoproj/argocd-example-apps/blob/master/guestbook" rel="noopener ugc nofollow" target="_blank">平原 YAML </a></li><li id="7ecc" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://github.com/argoproj/argocd-example-apps/blob/master/ksonnet-guestbook" rel="noopener ugc nofollow" target="_blank"> Ksonnet </a></li><li id="ce77" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://github.com/argoproj/argocd-example-apps/blob/master/helm-guestbook" rel="noopener ugc nofollow" target="_blank">舵</a></li><li id="61c6" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://github.com/argoproj/argocd-example-apps/blob/master/jsonnet-guestbook" rel="noopener ugc nofollow" target="_blank"> Jsonnet </a></li><li id="efb4" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk ol na nb nc bi translated"><a class="ae kx" href="https://github.com/argoproj/argocd-example-apps/blob/master/kustomize-guestbook" rel="noopener ugc nofollow" target="_blank">草泽</a></li></ul><p id="f271" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，从用户界面点击<code class="fe nn no np nq b">New App</code>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi on"><img src="../Images/829d8c4b272a5ddf619d55078ec73785.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/0*kg-ky4cqonbTMneF.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/getting_started/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><p id="c194" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">给应用命名，选择<code class="fe nn no np nq b">Default</code>项目，并选择同步策略(自动或手动)。对于生产集群，您还可以创建一个单独的项目(通过<code class="fe nn no np nq b">Settings &gt; Projects</code>)来限制对集群资源和名称空间的访问。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/4446a16b92c189f7c31af317fa28eefe.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/0*IZf-LdVWIFmPjj81.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/getting_started/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><p id="b024" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，用 Git 存储库 URL 和路径配置<code class="fe nn no np nq b">Source</code>,以及选择要部署到的集群和名称空间的<code class="fe nn no np nq b">Destination</code>。</p><p id="ffa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦配置了应用程序，就可以同步(部署)应用程序了。在用户界面中，点击<code class="fe nn no np nq b">Sync</code>，ArgoCD 会将更改应用到集群中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi op"><img src="../Images/594955bb01f57994e78177009ba1a6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hf8tr8Vz7QH4sjlj.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/getting_started/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><p id="97d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当同步成功时，应用程序会将其状态从<code class="fe nn no np nq b">OutOfSync</code>更改为<code class="fe nn no np nq b">Healthy</code>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/c6e9b61affcca37fad817ec3288204c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rt9_PgnU4ZFIMw6i.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图片来源:<a class="ae kx" href="https://argoproj.github.io/argo-cd/getting_started/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a></figcaption></figure><p id="7088" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您喜欢视频演示，您可以观看 10 分钟的快速演示(在 1:04 到 9:57 之间):</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="or os l"/></div></figure><h1 id="4a35" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">其他考虑</h1><p id="19be" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">尽管 CircleCI 和 ArgoCD 为您的 CI/CD 管道提供了大量功能，但与任何软件一样，随着使用量的增加，还有一些其他考虑事项需要与您的团队讨论:</p><ol class=""><li id="4879" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated">不要依靠部署失败来验证清单。至少，在 CI 过程中使用林挺工具(例如<code class="fe nn no np nq b">helm lint</code>)测试配置代码。开发人员也可以使用<code class="fe nn no np nq b">helm template</code>等工具手动验证正确的值。</li><li id="2c0a" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">当涉及到 GitOps 时，秘密管理是棘手的。ArgoCD 与最流行的解决方案(例如<a class="ae kx" href="https://github.com/bitnami-labs/sealed-secrets" rel="noopener ugc nofollow" target="_blank"> Bitnami Sealed Secrets </a>、<a class="ae kx" href="https://github.com/godaddy/kubernetes-external-secrets" rel="noopener ugc nofollow" target="_blank">go daddy Kubernetes External Secrets</a>、<a class="ae kx" href="https://github.com/ContainerSolutions/externalsecret-operator" rel="noopener ugc nofollow" target="_blank"> External Secrets Operator </a>、<a class="ae kx" href="https://www.vaultproject.io/" rel="noopener ugc nofollow" target="_blank"> Hashicorp Vault </a>、<a class="ae kx" href="https://github.com/banzaicloud/bank-vaults" rel="noopener ugc nofollow" target="_blank"> Banzai Cloud Bank-Vaults </a>、<a class="ae kx" href="https://github.com/futuresimple/helm-secrets" rel="noopener ugc nofollow" target="_blank"> Helm Secrets </a>、<a class="ae kx" href="https://github.com/kubernetes-sigs/kustomize/blob/fd7a353df6cece4629b8e8ad56b71e30636f38fc/examples/kvSourceGoPlugin.md#secret-values-from-anywhere" rel="noopener ugc nofollow" target="_blank">Kustomize secret generator plugins</a>、<a class="ae kx" href="https://github.com/mumoshu/aws-secret-operator" rel="noopener ugc nofollow" target="_blank"> aws-secret-operator </a>、<a class="ae kx" href="https://github.com/viaduct-ai/kustomize-sops#argo-cd-integration" rel="noopener ugc nofollow" target="_blank"> KSOPS </a>)一起工作</li><li id="547a" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">随着应用数量的增长，引导新集群成为一项挑战。ArgoCD 通过应用模式  <strong class="jp ir"> </strong>的<a class="ae kx" href="https://argoproj.github.io/argo-cd/operator-manual/cluster-bootstrapping/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">应用提供解决方案，其中一个 ArgoCD 应用包含子应用。如果有一个逻辑分组，这种模式非常有效。否则，在支持多集群部署之前，您必须编写一些脚本来通过 CLI 以编程方式创建管道。</strong></a></li><li id="9f22" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">最后，别忘了备份 ArgoCD 数据。即使所有的配置都被登记到 Git 中，如果 ArgoCD 关闭，从备份导入然后运行所有管道来重新创建会更容易。</li></ol></div></div>    
</body>
</html>