<html>
<head>
<title>Flutter Localizations Using Cubit and Built in flutter sdk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Cubit 和内置的颤振 sdk 进行颤振定位</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/flutter-localizations-using-bloc-pattern-cubit-and-without-any-packages-296aa57d7a23?source=collection_archive---------2-----------------------#2022-12-05">https://blog.devgenius.io/flutter-localizations-using-bloc-pattern-cubit-and-without-any-packages-296aa57d7a23?source=collection_archive---------2-----------------------#2022-12-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/45591424ee27eb26e37a91ce2d829f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*giuVEFaXg3BQ9l2WUKk6gQ.png"/></div></div></figure><p id="b0a6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">了解如何在 flutter 应用程序上添加本地化，并使用 bloc 或 cubit 来本地化您的应用程序</p><blockquote class="kt ku kv"><p id="857a" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">在使用任何技术的移动应用程序开发中，将应用程序本地化是最重要的功能之一，在 flutter 中有许多方法或途径和软件包可以帮助您完成这一任务，但我将首先讨论两个我更喜欢的方法，即使用 flutter sdk 本身，另一个使用 bloc</p></blockquote><p id="1875" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们首先通过获取当前的应用程序语言来使用 flutter sdk</p><p id="ade1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将创建一个具有简单 ui 的简单 flutter 项目</p><p id="015b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在 lib 文件夹中创建一个新文件<strong class="jx io"> home_screen.dart，</strong>，然后添加下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="c035" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/><br/>class HomeScreen extends StatelessWidget {<br/>  const HomeScreen({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        leading: Icon(Icons.home),<br/>      ),<br/>      body: Column(<br/>        children: [],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="06ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后返回到你的<strong class="jx io"> main.dart </strong>文件，它应该看起来像下面这样</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="b354" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/><br/>import 'home_screen.dart';<br/><br/>void main() {<br/>  runApp(const MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  const MyApp({super.key});<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Localization in flutter example ',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.blue,<br/>      ),<br/>      home: HomeScreen(),<br/>    );<br/>  }<br/>}</span></pre><p id="d2af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你的 MaterialApp 里面，有一个名为<strong class="jx io">的属性支持 Locales : </strong></p><p id="bf13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接受一个本地人列表</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="d642" class="lj lk in lf b be ll lm l ln lo">return MaterialApp(<br/>  title: 'Localization in flutter example ',<br/>  theme: ThemeData(<br/>    primarySwatch: Colors.blue,<br/>  ),<br/>  supportedLocales: [],<br/>  home: HomeScreen(),<br/>);</span></pre><p id="a253" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">区域设置有两个参数，<strong class="jx io">语言代码</strong>这是这个应用程序的任何国家代码的 iso 代码，我们将使用英语和阿拉伯语区域设置，你可以在这里找到你的国家代码<a class="ae lp" href="https://countrycode.org" rel="noopener ugc nofollow" target="_blank"/>和<strong class="jx io">国家</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="ed73" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/><br/>import 'home_screen.dart';<br/><br/>void main() {<br/>  runApp(const MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  const MyApp({super.key});<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Localization in flutter example ',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.blue,<br/>      ),<br/>      supportedLocales: [<br/>        Locale('en', "US"),<br/>        Locale("ar", ""),<br/>      ],<br/>      home: HomeScreen(),<br/>    );<br/>  }<br/>}</span></pre><p id="2e63" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，您可以将国家代码留空，这是可选的，因此它支持任何国家的语言</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="8bc9" class="lj lk in lf b be ll lm l ln lo">supportedLocales: [<br/>  Locale('en', ""),<br/>  Locale("ar", ""),<br/>],</span></pre><p id="4e32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在在你的根项目文件夹中创建一个名为"<strong class="jx io"> assets </strong>的新文件夹，在里面创建一个新文件夹"<strong class="jx io"> lang </strong>，然后创建两个 json 文件<strong class="jx io"> ar。Json en。Json </strong>，这些将包含我们要翻译的字符串</p><p id="dc5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么我们应该提到 pubsbec.yaml 中的那些文件</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="0086" class="lj lk in lf b be ll lm l ln lo">assets:<br/>  - assets/lang/ar.json<br/>  - assets/lang/en.json</span></pre><p id="954a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还需要在依赖项下添加 flutter sdk 本地化包</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="76cb" class="lj lk in lf b be ll lm l ln lo">flutter_localizations:<br/>  sdk: flutter</span></pre><p id="11e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">再次回到你的 MaterialApp，导入包</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="53a9" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter_localizations/flutter_localizations.dart';</span></pre><p id="a712" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们应该添加删除项，</p><blockquote class="kt ku kv"><p id="86c6" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">delegets -&gt;处理应用程序和所有部件的方向性，并且在鼠标悬停在某些按钮上时翻译相应部件中的一些无用文本</p></blockquote><p id="2272" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的 materialApp 内添加以下内容</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="d81a" class="lj lk in lf b be ll lm l ln lo">localizationsDelegates: [<br/>  GlobalMaterialLocalizations.delegate,<br/>  GlobalWidgetsLocalizations.delegate,<br/>  GlobalCupertinoLocalizations.delegate,<br/>],</span></pre><p id="631f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，您的整个 main.dart 文件应该如下所示</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="7e91" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/>import 'package:flutter_localizations/flutter_localizations.dart';<br/>import 'home_screen.dart';<br/><br/>void main() {<br/>  runApp(const MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  const MyApp({super.key});<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Localization in flutter example ',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.blue,<br/>      ),<br/>      supportedLocales: [<br/>        Locale('en', ""),<br/>        Locale("ar", ""),<br/>      ],<br/>      localizationsDelegates: [<br/>        GlobalMaterialLocalizations.delegate,<br/>        GlobalWidgetsLocalizations.delegate,<br/>        GlobalCupertinoLocalizations.delegate,<br/>      ],<br/>      home: HomeScreen(),<br/>    );<br/>  }<br/>}</span></pre><p id="7ece" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要让应用程序知道应用程序的本地，也是你的 materialApp 的内部，在<strong class="jx io">localeListResolutionCallback</strong>中:我们将添加获取应用程序的区域设置的方法</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="8265" class="lj lk in lf b be ll lm l ln lo">      localeResolutionCallback: (currentLocal, supportedLocales) {<br/>        for (var locale in supportedLocales) {<br/>          if (currentLocal != null &amp;&amp;<br/>              currentLocal.languageCode == locale.languageCode) {<br/>            return currentLocal;<br/>          }<br/>        }<br/>        return supportedLocales.first;<br/>      },<br/>home: HomeScreen(),</span></pre><p id="320b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们运行应用程序后，默认情况下，它的本地将是英语，所以，请注意应用程序中图标的方向</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/2240b74fe8590f46ec7f993f3beeadff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdnJTmUfBQMwaDunfG1u5g.png"/></div></div></figure><p id="3e03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我现在将应用程序的区域设置更改为阿拉伯语，并打开应用程序，看看它是否工作</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/dfcb90707bb0b7e5136f7b5674d3bb53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bPniJKAq6oHU6KMIfnSTUA.png"/></div></div></figure><p id="31ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意，它现在工作的应用程序的方向已经改变到 RTL</p><p id="9c8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将创建负责本地化的类</p><p id="6e73" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个新文件<strong class="jx io"> app_local.dart </strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="1eb3" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/><br/>class AppLocalizations {<br/>  final Locale? locale;<br/>  AppLocalizations({this.locale});<br/>}</span></pre><p id="84f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们创建了一个类，它在构造函数中使用 local，这是应用程序将使用的区域设置，现在我们想通知应用程序哪个类将负责本地化，只要我们将在整个应用程序中使用这个类，我们将创建一个函数，只为它返回这个类 static</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="f814" class="lj lk in lf b be ll lm l ln lo">static AppLocalizations? of(BuildContext context) {<br/>  return Localizations.of&lt;AppLocalizations&gt;(context, AppLocalizations);<br/>}</span></pre><p id="4af6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们创建一个映射来处理 json 文件中的字符串</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a0c3" class="lj lk in lf b be ll lm l ln lo">late Map&lt;String ,String &gt;_localStrings;</span></pre><p id="8102" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，我们需要加载携带应用程序字符串的 json 文件，因此这将是一个未来的方法，它将加载文件，以便应用程序可以加载当前应用程序区域设置的字符串，然后将这些文件添加到<strong class="jx io"> _localStrings </strong>映射，以使用此映射</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="e9e5" class="lj lk in lf b be ll lm l ln lo">Future loadJsonFiles() async {}</span></pre><p id="0921" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后声明一个私有字符串，该字符串应携带 json 文件的根路径</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="661c" class="lj lk in lf b be ll lm l ln lo">  static const String _path = 'assets/lang/';</span></pre><p id="c109" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后让我们加载文件</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="bea9" class="lj lk in lf b be ll lm l ln lo">Future loadJsonFiles() async {<br/>    String enocedString =<br/>        await rootBundle.loadString("${_path}${locale!.languageCode}.json")<br/>    Map&lt;String, dynamic&gt; jsonMap = jsonDecode(enocedString);<br/>    _localStrings =<br/>        jsonMap.map((key, value) =&gt; MapEntry(key, value.toString()));;}</span></pre><p id="72a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，在我们将文件解码成映射后，我们将它添加到包含字符串的映射中</p><p id="d6ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们需要在我们的地图上绘制通用电气公司的价值</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a554" class="lj lk in lf b be ll lm l ln lo">String translate(String key) {<br/>  return _localStrings[key] ?? '';<br/>}</span></pre><p id="fb50" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们创建我们的自定义委托</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="28bc" class="lj lk in lf b be ll lm l ln lo">class _AppLocalDelegate extends LocalizationsDelegate&lt;AppLocalizations&gt; {<br/>  @override<br/>  bool isSupported(Locale locale) {<br/>    return ['en', 'ar'].contains(locale.languageCode);  }<br/><br/>  @override<br/>  Future&lt;AppLocalizations&gt; load(Locale locale) async {<br/>    AppLocalizations appLocal = AppLocalizations(locale: locale);<br/>    await appLocal.loadJsonFiles();<br/>    return appLocal;<br/>  }<br/><br/>  @override<br/>  bool shouldReload(covariant LocalizationsDelegate&lt;dynamic&gt; old) {<br/>    return false;<br/>  }<br/>}</span></pre><p id="e718" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将连接到物料应用程序的代表</p><p id="8c52" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">isSupported →返回支持的局部变量，</p><p id="a748" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">load -&gt;加载保存数据的类</p><p id="add5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">shouldReload -&gt;意味着我们需要在每次重建时加载语言文件吗</p><p id="7854" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们应该将这个类添加到我们的应用程序化类中</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="b033" class="lj lk in lf b be ll lm l ln lo">static LocalizationsDelegate&lt;AppLocalizations&gt; delegate = _AppLocalDelegate();</span></pre><p id="f2c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们将在 material 应用程序的代表列表中调用这个代表</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="58cf" class="lj lk in lf b be ll lm l ln lo">localizationsDelegates: [<br/>  AppLocalizations.delegate,<br/>  GlobalMaterialLocalizations.delegate,<br/>  GlobalWidgetsLocalizations.delegate,<br/>  GlobalCupertinoLocalizations.delegate,<br/>],</span></pre><p id="289a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们添加一些文本，看看它是否工作，现在在 ar.json 中添加这个地图</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a012" class="lj lk in lf b be ll lm l ln lo">{<br/>  "title": "انا احب البرمجة"<br/>}</span></pre><p id="008f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是在 en.json 上</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="efa5" class="lj lk in lf b be ll lm l ln lo">{<br/>  "title": "I Love Programming"<br/>}</span></pre><p id="3add" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们改进 ui，并将这个字符串添加到一个文本小部件中</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="6ad4" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/>import 'package:flutter_localization/app_local.dart';<br/><br/>class HomeScreen extends StatelessWidget {<br/>  const HomeScreen({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        leading: Icon(Icons.home),<br/>      ),<br/>      body: Column(<br/>        mainAxisAlignment: MainAxisAlignment.center,<br/>        children: [<br/>          Center(<br/>            child: Text(<br/>              AppLocalizations.of(context)!.translate("title"),<br/>              style: TextStyle(fontWeight: FontWeight.bold, fontSize: 26),<br/>            ),<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="5297" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在重新启动应用程序，让我们在两个地方看到它</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/27ea5b83b75719a055ca1b801a950e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLQ5P0k7CbK_Phfjph3BSg.png"/></div></div></figure><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lq"><img src="../Images/9cd659bba34dcdb7b7aa338ff8815ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFpsPeX95zMcoSdcWk8Sdg.png"/></div></div></figure><p id="0ed0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，它与当前的电话语言一起工作，让我们现在只改变应用程序语言，无论应用程序语言是使用块和肘</p><p id="67b8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是让我们首先添加最后一件事情，它将使应用程序更容易，</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="edcf" class="lj lk in lf b be ll lm l ln lo">AppLocalizations.of(context)!.translate("title"),</span></pre><p id="513b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面的行是我们将在应用程序中的每个要翻译的字符串上使用的，我们可以使它更容易，因为应用程序有更多的字符串，我们将使用 dart 扩展使它越来越容易翻译</p><p id="01ad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将在 string 类上做一个扩展，这样可以帮助我们更容易地翻译 string</p><p id="126a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本地化文件中添加这个扩展方法</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="5d38" class="lj lk in lf b be ll lm l ln lo">extension TranslateString on String {<br/>  String tr(BuildContext context) {<br/>    return AppLocalizations.of(context)!.translate(this);<br/>  }<br/>}</span></pre><p id="1251" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后回到屏幕，让我们使用我们创建的字符串扩展</p><p id="ea0c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">而不是下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a2d3" class="lj lk in lf b be ll lm l ln lo">Center(<br/>  child: Text(<br/>    AppLocalizations.of(context)!.translate("title"),<br/>    style: TextStyle(fontWeight: FontWeight.bold, fontSize: 26),<br/>  ),<br/>)</span></pre><p id="62b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让它像下面这样简单多了</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="e27d" class="lj lk in lf b be ll lm l ln lo">Center(<br/>  child: Text(<br/>    'title'.tr(context),<br/>    style: TextStyle(fontWeight: FontWeight.bold, fontSize: 26),<br/>  ),<br/>)</span></pre><p id="f991" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们转到下一部分，我们将使用<strong class="jx io">腕尺</strong>状态管理</p><p id="9b2d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个<strong class="jx io">肘</strong>文件夹将文件给了</p><p id="e971" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> cubit.dart - &gt; </strong>将具有改变地区的功能</p><p id="760d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">state.dart - &gt; 将保存我们将按顺序发出的状态，以便更改地点</p><p id="09c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在在你的 lib 文件夹中，创建一个名为<strong class="jx io"> cubit </strong>的新文件夹</p><p id="d674" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后给它添加两个新文件<strong class="jx io"> local_state.dart </strong>，<strong class="jx io"> local_cubit.dart </strong></p><p id="7139" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在将 bloc 包添加到您的<strong class="jx io"> pubsbec.yaml </strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="863a" class="lj lk in lf b be ll lm l ln lo">flutter_bloc: ^8.1.1</span></pre><p id="43e3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们创建我们的状态类</p><p id="c226" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在 local_state.dart 中，添加以下代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="bf31" class="lj lk in lf b be ll lm l ln lo">abstract class LocalState {}<br/>class LocalInitState extends LocalState {}</span></pre><blockquote class="kt ku kv"><p id="6a6a" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">LocalState{}类是 cubit 将用来发出其类型状态的状态，因此我们创建了一个扩展该状态的初始状态，以便成为相同的类型</p></blockquote><p id="f87c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在转到 local_cubit.dart，添加以下代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="6c15" class="lj lk in lf b be ll lm l ln lo">class LocalCubit extends Cubit&lt;LocalState&gt; {<br/>  LocalCubit() : super(LocalInitState());<br/>}</span></pre><p id="eaae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要获取应用程序应该处理的当前语言代码，但是每次应用程序都将在默认的语言环境下启动，而不是用户选择的语言环境，所以我们需要首先缓存代码</p><p id="cda5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了缓存它，我们将使用 sharedPrefrences 包，所以也将该包添加到<strong class="jx io"> pubsbec.yaml </strong>中</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="1c56" class="lj lk in lf b be ll lm l ln lo">shared_preferences: ^2.0.15</span></pre><p id="f05c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们创建一个处理缓存的类，在你的 lib 文件夹中创建一个名为<strong class="jx io"> cache_helper.dart </strong>的新文件，然后添加下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="cf6f" class="lj lk in lf b be ll lm l ln lo">import 'package:shared_preferences/shared_preferences.dart';<br/><br/>class CacheHelper {<br/>  static late SharedPreferences prefs;<br/><br/>  static Future&lt;void&gt; init() async {<br/>    prefs = await SharedPreferences.getInstance();<br/>  }<br/><br/>  static const String _cachedCode = "cachedCode";<br/><br/>  static String getCachedLanguage() {<br/>    final code = prefs.getString(_cachedCode);<br/>    if (code != null) {<br/>      return code;<br/>    } else {<br/>      return 'en';<br/>    }<br/>  }<br/><br/>  static Future&lt;void&gt; cacheLanguage(String code) async {<br/>    await prefs.setString(_cachedCode, code);<br/>  }<br/>}</span></pre><p id="bfd0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">偏好</strong> →是共享偏好包中的对象</p><p id="60ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> _cachedCode </strong> →缓存代码的键</p><p id="2b97" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">getCachedLanguage()</strong>-&gt;如果被缓存，将返回语言代码，否则默认返回 en</p><p id="505a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> cacheLanguage() </strong> - &gt;会缓存语言代码</p><p id="2a84" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们在 cubit 中调用这个类，首先我们需要创建一个状态来改变语言，所以在<strong class="jx io"> local_state.dart </strong>中添加下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="b4d2" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/><br/>abstract class LocalState {}<br/><br/>class LocalInitState extends LocalState {}<br/><br/>class ChangeLocalState extends LocalState {<br/>  final Locale locale;<br/>  ChangeLocalState({required this.locale});<br/>}</span></pre><p id="c840" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每次我们更改本地应用程序时，这个状态都会与它的本地状态一起发出，我们将使用 cubit 来获取缓存的本地代码，然后将它添加到那个 lcoale，因此返回到 cubit 并添加下面的函数</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a5c3" class="lj lk in lf b be ll lm l ln lo">void getSavedLanguage() {<br/>    final cachedLanguageCode = CacheHelper.getCachedLanguage();<br/>    emit(ChangeLocalState(locale: Locale(cachedLanguageCode)));<br/>  }<br/>}</span></pre><p id="d9b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个方法将从缓存中获取语言代码，然后将代码提供给州区域设置中的区域设置，现在我们还需要更改语言，所以添加下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="90a3" class="lj lk in lf b be ll lm l ln lo">Future&lt;void&gt; changeLanguage(String languageCode) async {<br/>  await CacheHelper.cacheLanguage(languageCode);<br/>  emit(ChangeLocalState(locale: Locale(languageCode)));<br/>}</span></pre><p id="773c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经完成了 cubit 的创建，所以现在我们需要初始化缓存助手，并在块提供程序中提供这个 cubit</p><p id="3613" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先初始化主文件中的缓存</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="eb44" class="lj lk in lf b be ll lm l ln lo">void main() async {<br/>  WidgetsFlutterBinding.ensureInitialized();<br/>  await CacheHelper.init();<br/>  runApp(const MyApp());<br/>}</span></pre><p id="93d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后用 bloc builder 包装 material 应用程序，然后在 buidler 内部返回 material 应用程序，如果状态是 ChangeLocale state，则返回 chceck</p><p id="bdef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果是 teturn material app 并将 state.locale 传递给 material app 属性 locale:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="0868" class="lj lk in lf b be ll lm l ln lo">class MyApp extends StatelessWidget {<br/>  const MyApp({<br/>    super.key,<br/>  });<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return BlocProvider(<br/>        create: (BuildContext context) =&gt; LocalCubit(),<br/>        child: BlocBuilder&lt;LocalCubit, LocalState&gt;(<br/>          builder: (context, state) {<br/>            if (state is ChangeLocalState) {<br/>              return MaterialApp(<br/>                locale: state.locale,<br/>                title: 'Localization in flutter example ',<br/>                theme: ThemeData(<br/>                  primarySwatch: Colors.blue,<br/>                ),<br/>                supportedLocales: [<br/>                  Locale('en', ""),<br/>                  Locale("ar", ""),<br/>                ],<br/>                localizationsDelegates: [<br/>                  AppLocalizations.delegate,<br/>                  GlobalMaterialLocalizations.delegate,<br/>                  GlobalWidgetsLocalizations.delegate,<br/>                  GlobalCupertinoLocalizations.delegate,<br/>                ],<br/>                localeResolutionCallback: (currentLocal, supportedLocales) {<br/>                  for (var locale in supportedLocales) {<br/>                    if (currentLocal != null &amp;&amp;<br/>                        currentLocal.languageCode == locale.languageCode) {<br/>                      return currentLocal;<br/>                    }<br/>                  }<br/>                  return supportedLocales.first;<br/>                },<br/>                home: HomeScreen(),<br/>              );<br/>            }<br/>            return SizedBox();<br/>          },<br/>        ));<br/>  }<br/>}</span></pre><p id="1640" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要确保应用程序在初始化时发出该状态，以返回材质应用程序而不是大小合适的盒子</p><p id="5254" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在使用..运算符(cascade operator)我们将在返回我们的 cubit 后调用 getLanguage()函数</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="5cdd" class="lj lk in lf b be ll lm l ln lo">Widget build(BuildContext context) {<br/>  return BlocProvider(<br/>      create: (BuildContext context) =&gt; LocalCubit()..getSavedLanguage(),<br/>      child: BlocBuilder&lt;LocalCubit, LocalState&gt;(<br/>        builder: (context, state) {</span></pre><p id="92b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们现在运行应用程序</p><p id="4cf8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，应用程序工作正常后，我们需要添加一个极简的 ui 设计来改变语言的逻辑，回到我们之前创建的屏幕，添加下面的代码</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="60e7" class="lj lk in lf b be ll lm l ln lo">import 'package:flutter/material.dart';<br/>import 'package:flutter_bloc/flutter_bloc.dart';<br/>import 'package:flutter_localization/app_local.dart';<br/>import 'package:flutter_localization/cubit/local_cubit.dart';<br/>import 'package:flutter_localization/cubit/local_state.dart';<br/><br/>class HomeScreen extends StatelessWidget {<br/>  const HomeScreen({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        leading: Icon(Icons.home),<br/>      ),<br/>      body: Column(<br/>        mainAxisAlignment: MainAxisAlignment.center,<br/>        children: [<br/>          BlocBuilder&lt;LocalCubit, LocalState&gt;(builder: (context, state) {<br/>            if (state is ChangeLocalState) {<br/>              return Row(<br/>                mainAxisAlignment: MainAxisAlignment.center,<br/>                children: [<br/>                  TextButton(<br/>                      onPressed: () {<br/>                        BlocProvider.of&lt;LocalCubit&gt;(context)<br/>                            .changeLanguage('en');<br/>                      },<br/>                      child: Text(<br/>                        'en',<br/>                        style: TextStyle(<br/>                          color: Colors.blue,<br/>                          fontSize: 16,<br/>                        ),<br/>                      )),<br/>                  TextButton(<br/>                      onPressed: () {<br/>                        BlocProvider.of&lt;LocalCubit&gt;(context)<br/>                            .changeLanguage('ar');<br/>                      },<br/>                      child: Text(<br/>                        'ar',<br/>                        style: TextStyle(<br/>                          color: Colors.blue,<br/>                          fontSize: 16,<br/>                        ),<br/>                      )),<br/>                ],<br/>              );<br/>            }<br/>            return SizedBox();<br/>          }),<br/>          Center(<br/>            child: Text(<br/>              'title'.tr(context),<br/>              style: TextStyle(fontWeight: FontWeight.bold, fontSize: 26),<br/>            ),<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="cd9c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们添加了两个按钮来更改语言，在 bloc builder 中，我们知道它在状态下重建小部件，我们调用 cubit 中的函数来更改语言，material app 也会在此状态下更改本地语言，现在一切正常，即使我们重新启动 app，它也会从缓存中获取缓存的语言。</p><p id="b3b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">本文到此为止，感谢您的阅读</strong></p><p id="5073" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">如果这篇文章对你有帮助就鼓掌</strong></p><p id="a813" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">github-&gt;<a class="ae lp" href="https://github.com/mohaberabi/flutter_local_cubit_flutter_sdk" rel="noopener ugc nofollow" target="_blank">https://github . com/mohaberabi/flutter _ local _ cubit _ flutter _ SDK</a></p></div></div>    
</body>
</html>