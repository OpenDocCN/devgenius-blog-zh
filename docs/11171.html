<html>
<head>
<title>Untangling Database : SQL Tables: COPY</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解开数据库:SQL 表:复制</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/untangling-database-sql-tables-copy-ccf50cb50c9f?source=collection_archive---------6-----------------------#2022-12-22">https://blog.devgenius.io/untangling-database-sql-tables-copy-ccf50cb50c9f?source=collection_archive---------6-----------------------#2022-12-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="09e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我一直在学习使用关系数据库进行数据摄取、数据探索和分析的许多不同方法。本系列将涵盖这些课程。有这么多帖子涵盖了详细的教程。这些帖子将分享想法、工具和流程概述。在此基础上，您可以通过查找教程或文档来进一步深入研究。</p><h1 id="e5f6" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">目标:数据摄取</h1><p id="1eb2" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">将文本、csv 和 tsv 文件中的数据加载到数据库中可能会遇到意想不到的问题。当数据库管理的新加入者面临这些挑战时，他们可能会止步不前。让我们给你一些非正统的工具。首先，让我们创建表。</p><h1 id="008e" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">测量数据:</strong></h1><p id="963a" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">我们需要通过代码获得提供给我们的文件的以下信息。您想到了哪种工具</p><p id="af8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">a)文件中有多少列？他们的名字。</p><p id="1758" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">b)根据您使用的数据库服务器，每列的变量类型是什么。</p><p id="d1e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">c)列是否有空值？他们是如何表现的。</p><p id="5e43" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">d)文件中有多少条记录？</p><p id="f40f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最有可能是 python 的操作系统模块。还有更强大的替代品。</p><h1 id="65ec" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak"> Linux Shell 命令:</strong></h1><p id="e8a5" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">以上问题可以通过查看文件头来回答。您还可以找到文件中的记录/行数</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="e561" class="lu kj in lq b be lv lw l lx ly">$ cat filename.csv | head (or use) head filename.csv<br/> <br/>user_first_name,user_last_name,user_email_id,user_role,created_dt<br/>Gordan,Bradock,gbradock0@barnesandnoble.com,Actor,2020-01-10<br/>Tobe,Lyness,tlyness1@paginegialle.it,User,2020-02-10<br/>Addie,Mesias,amesias2@twitpic.com,User,2020-03-05<br/>#### Data truncated ####<br/><br/>$ wc -l filename.csv<br/><br/>1507886 filename</span></pre><pre class="lz lp lq lr bn ls lt bi"><span id="ce87" class="lu kj in lq b be lv lw l lx ly"># Find if column 'user_role' in above file has null values <br/><br/>$ cat filename.csv | cut -d ',' -f4 | sort -u # this will provide <br/>Actor<br/>Null &lt;&lt; Yep<br/>User<br/>Promoter</span></pre><p id="5219" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，您一定已经看到了 Bash 工具的强大功能。它们比文本编辑器效率高得多。cat，sed，awk，cut，grep 然后 Vim 是我的最爱。</p><p id="dc8d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一些列有空格，另一些列有带" "的空格，有问题的列用字符串" null "代替空格。最后一个是当你把数据推进“数据库表”时最头疼的问题。</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="1e30" class="lu kj in lq b be lv lw l lx ly">$ cat part-00000.csv | head #The file is truncated with head<br/>24000.00 null null 90<br/>17000.00 null 100 90<br/>17000.00 null 100 90<br/>9000.00 null 102 60<br/>6000.00 null 103 60<br/>4800.00 null 103 60<br/>4800.00 null 103 60<br/>4200.00 null 103 60<br/>12000.00 null 101 100<br/>9000.00 null 108 100<br/><br/># How to find out if the 1st column also has Nulls? Use cut -f and Uniq<br/><br/>$ cat part-00000.csv | cut -f 3| sort -u<br/>90<br/>60<br/>" " &lt;&lt; That was not expected!!!<br/>30<br/>50<br/>80<br/>null &lt;&lt; There you go!!!<br/>80<br/>50<br/>--- &lt;&lt; How did that even get there??<br/>20<br/>40<br/>70<br/>110</span></pre><h1 id="5aa0" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">用 DuckDB 扩充 Bash:</h1><p id="44eb" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">如果您认为 bash 命令具有超能力，那么您就可以享受了。我只是像前面解释的那样介绍 DuckDB 的用法。</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="b351" class="lu kj in lq b be lv lw l lx ly">$ duckdb # will start the duckdb instance<br/><br/>D #that is prompt of duckdb<br/><br/>D SELECT * FROM read_csv_auto('filename.csv') <br/><br/>┌─────────────────┬────────────────┬──────────────────────────────┬───────────┬────────────┐<br/>│ user_first_name │ user_last_name │        user_email_id         │ user_role │ created_dt │<br/>│     varchar     │    varchar     │           varchar            │  varchar  │    date    │<br/>├─────────────────┼────────────────┼──────────────────────────────┼───────────┼────────────┤<br/>│ Gordan          │ Bradock        │ gbradock0@barnesandnoble.com │ A         │ 2020-01-10 │<br/>│ Tobe            │ Lyness         │ tlyness1@paginegialle.it     │ U         │ 2020-02-10 │<br/>│ Addie           │ Mesias         │ amesias2@twitpic.com         │ U         │ 2020-03-05 │<br/>│ Corene          │ Kohrsen        │ ckohrsen3@buzzfeed.com       │ U         │ 2020-04-15 │<br/>│ Darill          │ Halsall        │ dhalsall4@intel.com          │ U         │ 2020-10-10 │<br/>└─────────────────┴────────────────┴──────────────────────────────┴───────────┴────────────┘</span></pre><p id="3a62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">是的……它读取 csv 文件并从中创建了一个数据库表。让我们试试更酷的东西。获取上表的模式怎么样？我求助于 python 的 Pandas / Pyspark 库来获得这个模式，然后用它来创建表。DuckDB 让您粘在 Bash shell 上…甚至不需要启动 python 解释器。</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="fd20" class="lu kj in lq b be lv lw l lx ly"># inside DuckDB<br/><br/>D CREATE TABLE civ AS SELECT * FROM read_csv_auto('civilizations.csv');<br/>D .schema<br/>CREATE TABLE civ(civilization VARCHAR, "start" INTEGER, "end" INTEGER, "startLabel" VARCHAR, "endLabel" VARCHAR, region VARCHAR, timeline VARCHAR);</span></pre><h1 id="bfb1" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">创建数据库表:</h1><p id="3c96" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">现在，在数据库中创建表就像在公园里散步一样简单。没有必要键入所有这些列名和单独的数据类型。如果 DuckDB 提供了一个不同的数据类型，这不是您的数据库所固有的，那么在 Bash shell 中使用 echo 和 sed 工具，如下所示</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="57c9" class="lu kj in lq b be lv lw l lx ly">#Creating table<br/><br/>database=# CREATE TABLE civ("start" INTEGER, "end" INTEGER, "startLabel" VARCHAR,);<br/># kept the number of columns purposefully less...</span></pre><pre class="lz lp lq lr bn ls lt bi"><span id="92d0" class="lu kj in lq b be lv lw l lx ly"># use echo and sed in bash<br/><br/>$ echo 'CREATE TABLE civ("start" INTEGER, "end" INTEGER, "startLabel" VARCHAR,)' | sed 's/INTEGER/REAL/g'<br/># INTEGER changed to REAL <br/>CREATE TABLE civ("start" REAL, "end" REAL, "startLabel" VARCHAR)</span></pre><h1 id="6ec3" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">有没有减少打字/鼠标点击的 GUI？</h1><p id="38c3" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">是的，我在探索 DuckDB 的时候发现的。它叫做<a class="ae ma" href="https://dbeaver.io/download/" rel="noopener ugc nofollow" target="_blank"> D-Beaver。</a>神奇的工具。比起 GUI，我更喜欢命令行，因为它减少了大量的鼠标点击。我将直接讨论将数据导入到 dbeaver 内部的“表”中。</p><figure class="ll lm ln lo gt mc gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/bfefcf62abad8b9ba99ec2b1da8b7fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*eWVhkX1mbEgp7DH4H2oQjw.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">这个导入向导会拉入数据，即使这些数据是杂乱的。尝试了 100K 记录数据</figcaption></figure><p id="912f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当导入向导完成时，您的表将立即准备好进行查询。今天我已经<strong class="jm io">摄取了大约 25 个 csv 文件，记录数量</strong>从几十万到几十万不等。DBeaver 像疯了一样给了他们高分。DBeaver 中还有其他漂亮的特性，我将在本系列的后面部分介绍。但请随意探索。</p><h1 id="4937" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">想获得即时仪表板吗？</h1><p id="a44d" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated"><a class="ae ma" href="https://docs.rilldata.com/using-rill/install" rel="noopener ugc nofollow" target="_blank">进入小溪</a></p><p id="c03e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当你说 Rill 启动时，rill 在 localhost:9009 打开一个 web 服务器。需要进行一些设置。rill setup 试图从 https://github.com/hhllcks/snldb/tree/master/output<a class="ae ma" href="https://github.com/hhllcks/snldb/tree/master/output" rel="noopener ugc nofollow" target="_blank"/>提取的样本数据文件是周六夜现场展示的一个惊人的数据库。</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="ec82" class="lu kj in lq b be lv lw l lx ly">$ rill start<br/><br/># After that, you see the following dashboards...</span></pre><figure class="ll lm ln lo gt mc"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="6464" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你现在一定已经猜到了。Rill 和一个名为<a class="ae ma" href="https://www.tadviewer.com/" rel="noopener ugc nofollow" target="_blank"> tadviewer </a>的命令行工具有助于查看 csv/ parquet 文件，它们都由底层的 DuckDB 提供支持。</p><h1 id="d1c3" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">如果您必须只使用您的数据库服务器，该怎么办？</h1><p id="7685" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">每个服务器都有一个命令行选项。对于 Postgres，它是 psql-h localhost-U Postgres，对于 mysql，它是 mysql -u root -p 命令。一旦进入 DB 服务器，就可以使用 SQL 查询启动命令行 fu。</p><p id="e8ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所有这些讨论都集中在 csv、tsv 和文本文件上，它们大多是表格。一旦创建了表，就可以将 CSV/TSV 文件的内容复制到上面创建的表中。</p><pre class="ll lm ln lo gt lp lq lr bn ls lt bi"><span id="b7db" class="lu kj in lq b be lv lw l lx ly"># for postgres db, it works this ways<br/><br/>mdy_db=# COPY my_new_table(col1, col2, col3...) FROM (/path/to/csv) DELIMITER \<br/>',' CSV HEADER;</span></pre><p id="ea29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">CSV 文件中的数据必须在表中，并且您可以开始处理这些数据。下一个重要任务是数据建模。很快就会回来…</p></div></div>    
</body>
</html>