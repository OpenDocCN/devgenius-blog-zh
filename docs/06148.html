<html>
<head>
<title>Deploying a Scalable SQL Cluster on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上部署可伸缩的SQL集群</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/deploying-a-scalable-sql-cluster-on-kubernetes-d7907cb1605e?source=collection_archive---------1-----------------------#2021-12-17">https://blog.devgenius.io/deploying-a-scalable-sql-cluster-on-kubernetes-d7907cb1605e?source=collection_archive---------1-----------------------#2021-12-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1ddf4e446435ee195248c0c456f8f434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPFdQ00FoVmJnD9hoqTRFg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@orenarypaladin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">铃木</a>在<a class="ae jz" href="https://unsplash.com/s/photos/digital-ocean?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="618e" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="8248" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在本文中，我们将了解如何在Kubernetes上部署可伸缩的SQL集群。在我们开始之前，了解Kubernetes是什么以及围绕它的一些细节是很重要的。如果你不知道基本知识，我建议你看一下这个链接开始学习。</p><div class="lw lx gp gr ly lz"><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd io gy z fp me fr fs mf fu fw im bi translated">什么是Kubernetes？</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Kubernetes是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，它…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">kubernetes.io</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn jt lz"/></div></div></a></div><p id="bae7" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">为了部署一个可扩展的MySQL结构，我们可以将其分为3个部分:</p><blockquote class="mt mu mv"><p id="65dd" class="ky kz mw la b lb mo ld le lf mp lh li mx mq ll lm my mr lp lq mz ms lt lu lv ig bi translated">在数字海洋上创建Kubernetes集群</p><p id="d20c" class="ky kz mw la b lb mo ld le lf mp lh li mx mq ll lm my mr lp lq mz ms lt lu lv ig bi translated">设置MySQL操作符和数据库</p><p id="7b96" class="ky kz mw la b lb mo ld le lf mp lh li mx mq ll lm my mr lp lq mz ms lt lu lv ig bi translated">测试集群功能并进行试验</p></blockquote><h1 id="7bf0" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">在数字海洋上创建Kubernetes集群</h1><p id="e62c" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">从DigitalOcean的控制面板中，创建一个新的Kubernetes集群。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/3beda9b0af3c3ff4902a9e31fb390b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9I7MWf2AeKNfOgTY5Fcyw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">从下拉列表中选择Kubernetes以创建K8s集群</figcaption></figure><p id="e030" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我选择我的数据中心区域为Bangalore (BLR1)，但是您可以选择任何区域。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/66fa2a7b473c6e2b862858790946720e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wSnO3Oxyjkpfy0Oe7_akA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">选择数据中心区域</figcaption></figure><p id="396d" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">在创建集群的过程中，除了我设置为<code class="fe ng nh ni nj b">sql-k8s-cluster</code>的名称之外，我没有更改任何其他内容。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/041d8d5ab69666f762763d58d51bea82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTzGtTmxOZHEPxGNTjnoBA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">更改集群的名称</figcaption></figure><p id="e7b8" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">之后，点击“创建”,我们就可以开始了！</p><p id="89d8" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">设置集群需要5分钟，在此期间，您可以下载集群的配置文件并将其添加到您正在工作的目录中。我的配置文件叫做<code class="fe ng nh ni nj b">sql-k8s-cluster-kubeconfig.yaml</code>。一旦集群开始运行，我们运行以下命令。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="a276" class="no kb in nj b gy np nq l nr ns">cd ~/.kube &amp;&amp; kubectl --kubeconfig="sql-k8s-cluster-kubeconfig.yaml" get nodes</span></pre><p id="e2b2" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">这将显示节点及其详细信息。输出如下所示。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/528f3b9b0ec4a9c2188b9919c8c4abde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIkBDf4KhmdPTa_P6mCyTQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">获取集群中的节点</figcaption></figure><p id="2eda" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">下一步是设置MySQL操作符和我们的数据库。</p><h1 id="31ef" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">设置MySQL操作符和数据库</h1><p id="f82a" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">为了理解MySQL操作符是什么，我们需要理解Kubernetes中的操作符是什么。一个<strong class="la io">操作员</strong>打包、部署和管理一个Kubernetes应用程序。</p><h2 id="990b" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated"><strong class="ak"> MySQL操作符</strong></h2><p id="7eeb" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">MySQL操作员管理Kubernetes集群中的MySQL InnoDB集群设置。操作员处理整个生命周期，包括设置和维护应用程序—自动升级和备份。</p><blockquote class="mt mu mv"><p id="8a2d" class="ky kz mw la b lb mo ld le lf mp lh li mx mq ll lm my mr lp lq mz ms lt lu lv ig bi translated"><strong class="la io">注意</strong>:Kubernetes的MySQL操作器目前处于预览状态。不要在生产中使用—<em class="in">GitHub上的MySQL操作符</em>。</p></blockquote><h2 id="a777" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated">InnoDB是什么？</h2><p id="d88b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">MySQL参考手册说:</p><blockquote class="mt mu mv"><p id="280b" class="ky kz mw la b lb mo ld le lf mp lh li mx mq ll lm my mr lp lq mz ms lt lu lv ig bi translated">InnoDB是一个<strong class="la io">通用存储引擎</strong>，它平衡了高可靠性和高性能。在MySQL 5.6中，InnoDB是默认的MySQL存储引擎。</p></blockquote><p id="2507" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">基本上，它是一个MySQL软件组件，处理SQL操作，如表的创建、读取、更新和删除。</p><p id="095d" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我们首先从这里的<a class="ae jz" href="https://github.com/mysql/mysql-operator" rel="noopener ugc nofollow" target="_blank">安装MySQL操作符</a>，并执行下面的命令。为了让它工作，确保安装了Helm(一个运行在K8s之上的包管理器)。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="8bcd" class="no kb in nj b gy np nq l nr ns">helm install mysql-operator helm/mysql-operator --namespace mysql-operator --create-namespace --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><p id="94c8" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">输出应该是这样的。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/2c5a22d4c71ea8eef05479c8b20b2b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0h15e4EugtnKSQyXXTIDGQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">通过Helm安装MySQL操作器</figcaption></figure><h2 id="f27a" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated">名称空间</h2><p id="05ea" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在Kubernetes中，名称空间允许在单个集群中隔离资源。资源名在一个名称空间中应该是唯一的，但在不同的名称空间中则不是。</p><p id="d281" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">接下来，我们通过执行下面的命令创建一个名为<code class="fe ng nh ni nj b">sql-cluster</code>的名称空间。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="c604" class="no kb in nj b gy np nq l nr ns">kubectl create namespace sql-cluster --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/545df2e6cf8984f0200b18023062ee3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3e11m-ny0NmF0jAQcVzQgQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">创建名称空间</figcaption></figure><p id="94a6" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">为了使用<code class="fe ng nh ni nj b">kubectl</code>创建MySQL InnoDB集群，我们需要创建一个包含凭证的秘密。在您的终端中执行以下命令，并设置您选择的密码。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="df74" class="no kb in nj b gy np nq l nr ns">kubectl create secret generic mypwds \<br/>        --from-literal=rootUser=root \<br/>        --from-literal=rootHost=% \<br/>        --from-literal=rootPassword="your secret password, REPLACE ME"</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/86179608947c55dd6f11dca7b7f22909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWz178hmE4EDVM7O5sG3fQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">为我们的群集设置凭据</figcaption></figure><p id="c810" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">下一步是编写我们的集群的配置。我们创建一个名为<code class="fe ng nh ni nj b">config.yaml</code>的文件，并输入以下细节。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="ec28" class="no kb in nj b gy np nq l nr ns">apiVersion: mysql.oracle.com/v2alpha1</span><span id="567d" class="no kb in nj b gy of nq l nr ns">kind: InnoDBCluster</span><span id="b9a7" class="no kb in nj b gy of nq l nr ns">metadata:</span><span id="3d81" class="no kb in nj b gy of nq l nr ns">    name: sql-cluster</span><span id="04d9" class="no kb in nj b gy of nq l nr ns">    namespace: sql-cluster</span><span id="b581" class="no kb in nj b gy of nq l nr ns">spec:</span><span id="59cb" class="no kb in nj b gy of nq l nr ns">    secretName: mypwds</span><span id="cde7" class="no kb in nj b gy of nq l nr ns">    instances: 3</span><span id="dfac" class="no kb in nj b gy of nq l nr ns">    router:</span><span id="4796" class="no kb in nj b gy of nq l nr ns">        instances: 1</span></pre><p id="e8e7" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">保存文件后，运行以下命令将配置应用到我们的MySQL集群。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="ba7d" class="no kb in nj b gy np nq l nr ns">kubectl apply -f config.yaml --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/76a9a759c4f85fc8eb4a77564275ec3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WH_nBcvgyMar24CWWBZ5g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">在我们的终端中运行上述命令后</figcaption></figure><p id="27ac" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">为了查看我们集群的状态，并了解pod是如何启动的，我们执行以下命令并见证奇迹。这需要将近5分钟，所以去喝杯咖啡吧！☕️</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="f59f" class="no kb in nj b gy np nq l nr ns">kubectl get innodbcluster --watch --namespace sql-cluster --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/b38a227d8c7437f8f52f7df9c2ef8b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJlIVfJB2nOcbQoSqZrAhg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">豆荚点火了</figcaption></figure><p id="bede" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">为了获得服务细节并查看我们的MySQL集群在哪个端口上是可访问的，运行下面的命令就可以了。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="cb7c" class="no kb in nj b gy np nq l nr ns">kubectl get service sql-cluster  --namespace sql-cluster --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span><span id="dae3" class="no kb in nj b gy of nq l nr ns">kubectl describe service sql-cluster  --namespace sql-cluster --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/69e3870f1fbcfdc39b24fed5095d21e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*76icVc0Bg0r4wPE-o0bIZA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">我们的MySQL集群的服务详情</figcaption></figure><p id="65d7" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">为了访问MySQL集群，我们将它转发到一个端口，并通过命令行访问它。我们也可以使用MySQL客户端，比如DataGrip或PHPMyAdmin。我们运行以下命令，注意到可以从端口6446访问群集。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="2f96" class="no kb in nj b gy np nq l nr ns">kubectl port-forward service/sql-cluster mysql  --namespace sql-cluster --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/d9d26b1a0ce4e87ad9768b5d8db9138a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rofeijSnb4AU54v5HqXfEA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">可以通过端口6446访问集群</figcaption></figure><p id="d118" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我们现在可以通过执行下面给出的命令来访问端口6446上的集群。系统会提示我们输入之前设置的密码。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="552e" class="no kb in nj b gy np nq l nr ns">mysql -h127.0.0.1 -P6446 -uroot -p</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/f63e894dbb91c5454992ea9df5745f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWEuKrVszURw3iHhidSkvQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">连接到MySQL集群</figcaption></figure><p id="50c8" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">至此，我们已经使用MySQL operator成功创建了MySQL集群。现在，我们来看看添加数据和测试我们的Kubernetes集群的功能。</p><h1 id="8db9" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">测试集群功能并进行试验</h1><p id="e1cf" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">为了了解我们的集群的弹性和可伸缩性，我们需要一些数据。</p><p id="3f3c" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我们创建了一个名为<code class="fe ng nh ni nj b">students</code>的表，它存储了学生的<code class="fe ng nh ni nj b">id</code>、<code class="fe ng nh ni nj b">name</code>和<code class="fe ng nh ni nj b">department</code>。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="a2d8" class="no kb in nj b gy np nq l nr ns">CREATE TABLE students (id INT(3) PRIMARY KEY, name VARCHAR(20) NOT NULL, dept VARCHAR(5) NOT NULL);</span><span id="c4be" class="no kb in nj b gy of nq l nr ns">INSERT INTO user (1, "Anjaneya", "CSE");</span><span id="7b18" class="no kb in nj b gy of nq l nr ns">SELECT * FROM students;</span></pre><p id="0cb7" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">执行后，我们得到以下内容。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/74a30f13972b405b0d564c8d8dc294b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RF9aVa5f-Ntk3yfMntAReg.png"/></div></div></figure><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/22fd69be0ca7a77e57f4779bc811555e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dnou2gr16XNAYBojEbu_rA.png"/></div></div></figure><p id="a324" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">现在，我们的数据库中已经有了一些数据，让我们看看当我们删除存储数据的pod时，我们的集群的情况如何。</p><h2 id="9284" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated">弹性</h2><p id="5a16" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">我们首先需要确定存储上表的pod。我们通过确定MySQL中哪个变量的变量名设置为<code class="fe ng nh ni nj b">hostname</code>来识别它。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="8be7" class="no kb in nj b gy np nq l nr ns">SHOW VARIABLES WHERE Variable_name = 'hostname';</span></pre><p id="b9ad" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我得到的回应是<code class="fe ng nh ni nj b">sql-cluster-3</code>，但这因用户而异。如果你取了别的名字也不用担心。</p><p id="e6ea" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">现在，我们通过执行以下命令(在另一个终端窗口中)来删除这个pod。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="b25c" class="no kb in nj b gy np nq l nr ns">kubectl delete -n sql-cluster pod sql-cluster-3</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oh"><img src="../Images/7136c79876078d2ad72a4b5fbc4939ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47pXQBcp6pgyqWTcUqd43Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">删除包含我们数据的pod</figcaption></figure><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/d8e2a9315a2437a80b6e8fbb70766c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HEvX9hYbEmvZy77gND6Kwg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="http://memegenerator.net" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="ea85" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">在我们之前的终端窗口中，我们可以实时观察变化。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/75a50eac9ae7a20744b68be360faaad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obkw8KrESXmMVRvXb9u15w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">简直是魔法</figcaption></figure><p id="1325" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">我们可以看到MySQL服务器失去连接，确定连接丢失，然后重新连接到另一个实例，并向我们显示我们的数据，就像什么也没发生一样。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/cad1883108466bee8710e5c01d58cf01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*vMzeqLw4Gx52oKHX__5ZFQ.jpeg"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="http://makeameme.org" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><h2 id="9efe" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated">可量测性</h2><p id="f92d" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">为了确定我们的集群是否是可伸缩的，我们需要修改配置文件(<code class="fe ng nh ni nj b">config.yaml</code>)。</p><p id="5a59" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">让我们将实例的数量从3个改为4个。</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="5eec" class="no kb in nj b gy np nq l nr ns">apiVersion: mysql.oracle.com/v2alpha1</span><span id="bea6" class="no kb in nj b gy of nq l nr ns">kind: InnoDBCluster</span><span id="3b6f" class="no kb in nj b gy of nq l nr ns">metadata:</span><span id="236d" class="no kb in nj b gy of nq l nr ns">    name: sql-cluster</span><span id="4357" class="no kb in nj b gy of nq l nr ns">    namespace: sql-cluster</span><span id="7d9f" class="no kb in nj b gy of nq l nr ns">spec:</span><span id="9cd3" class="no kb in nj b gy of nq l nr ns">    secretName: mypwds</span><span id="9dc6" class="no kb in nj b gy of nq l nr ns">    instances: 4</span><span id="fb8a" class="no kb in nj b gy of nq l nr ns">    router:</span><span id="1337" class="no kb in nj b gy of nq l nr ns">        instances: 1</span></pre><p id="9a60" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">现在，让我们看看kubernetes集群是如何产生新实例的。它意识到实际状态与期望状态不同，并立即开始努力实现期望状态。</p><p id="6aaa" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">请确保在观看之前应用更改！</p><pre class="nb nc nd ne gt nk nj nl nm aw nn bi"><span id="462a" class="no kb in nj b gy np nq l nr ns">kubectl apply -f config.yaml --kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span><span id="5aa7" class="no kb in nj b gy of nq l nr ns">kubectl get innodbcluster --watch  --namespace sql-cluster kubeconfig ~/.kube/sql-k8s-cluster-kubeconfig.yaml</span></pre><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/5f8ef24f2416315970d8836ed0c08d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJXds5pJcCBPTktZHl94Hg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">可扩展集群</figcaption></figure><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/4cfc73e7f3c769ded949991dd4da0dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*QrbJAko1X4iSfxQR-M0gwg.jpeg"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://memegenerator.net/instance/73892688/rain-man-scalable-definitely-scalable" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="db5f" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated">也就是说，我们已经成功部署了我们的MySQL集群，并确保它具有弹性和可伸缩性！</p></div><div class="ab cl ol om hr on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ig ih ii ij ik"><div class="nb nc nd ne gt lz"><a href="https://github.com/AnjaneyaTripathi/k8s-mysql" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd io gy z fp me fr fs mf fu fw im bi translated">GitHub-AnjaneyaTripathi/k8s-MySQL</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">在数字海洋上创建Kubernetes集群，设置MySQL数据库和MySQL操作员测试集群…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="os l mk ml mm mi mn jt lz"/></div></div></a></div><p id="ce4c" class="pw-post-body-paragraph ky kz in la b lb mo ld le lf mp lh li lj mq ll lm ln mr lp lq lr ms lt lu lv ig bi translated"><code class="fe ng nh ni nj b">config.yaml</code>可以在GitHub资源库上找到。</p></div><div class="ab cl ol om hr on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ig ih ii ij ik"><h2 id="57a0" class="no kb in bd kc nu nv dn kg nw nx dp kk lj ny nz ko ln oa ob ks lr oc od kw oe bi translated">资源</h2><div class="lw lx gp gr ly lz"><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd io gy z fp me fr fs mf fu fw im bi translated">Kubernetes |数字海洋简介</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Kubernetes是一个强大的开源系统，最初由Google开发，用于管理容器化的应用程序</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">www.digitalocean.com</p></div></div><div class="mi l"><div class="ot l mk ml mm mi mn jt lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a href="https://github.com/mysql/mysql-operator" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd io gy z fp me fr fs mf fu fw im bi translated">GitHub-mysql/MySQL-Operator:Kubernetes的MySQL操作员</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">MYSQL Operator for Kubernetes是一个用于管理MySQL InnoDB集群设置的Kubernetes操作员</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="ou l mk ml mm mi mn jt lz"/></div></div></a></div><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="ov ow l"/></div></figure></div></div>    
</body>
</html>