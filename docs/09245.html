<html>
<head>
<title>How to build CLI tool with Go and Cobra</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Go 和 Cobra 构建 CLI 工具</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-build-cli-tool-with-go-and-cobra-31d5761937ed?source=collection_archive---------1-----------------------#2022-08-09">https://blog.devgenius.io/how-to-build-cli-tool-with-go-and-cobra-31d5761937ed?source=collection_archive---------1-----------------------#2022-08-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e9ce4c8e71d797af80c5c17343e69d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PqHiDb9IeOFCcDSd"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">照片由<a class="ae jz" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0a05" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi ky translated">这篇博客的目的是为了帮助那些对围棋有初步了解但之前没有使用过 CLI 应用程序的人。因此，不再拖延，让我们建立我们的第一个 CLI 工具。</p><p id="22f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们深入项目之前，让我们快速地看一下命令行。</p><h2 id="0ec3" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">什么是命令行界面</h2><p id="d478" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">命令行界面(CLI)是执行程序的基于文本的界面。CLI 接受界面中的文本输入(即命令),并以同样的方式做出响应。今天，大多数软件除了图形用户界面(GUI)之外，还提供了 CLI。CLIs 的典型用户是开发人员、项目支持成员和系统管理员。在 Mac 或 Linux 中，它被称为终端。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/9b3326bdca12305bf9a43279f3a7249a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vd0uKBHNTcNQu4Quk9EwOA.png"/></div></div></figure><p id="d652" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的 npm(节点程序包管理器)CLI 示例中，它提供了安装、测试和运行功能(即子命令)。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="cdb6" class="mr li in bd lj ms mt mu lm mv mw mx lp my mz na ls nb nc nd lv ne nf ng ly nh bi translated">我们在建造什么？</h1><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/28967e613c1af823cae4ea07c55af60b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPhaLCoDOx0Fbp3mEucOog.png"/></div></div></figure><p id="9448" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个项目中，我们有三个组成部分-</p><ul class=""><li id="8974" class="nj nk in kc b kd ke kh ki kl nl kp nm kt nn kx no np nq nr bi translated">my-todo 后端:已经在 nodeJs 中开发。</li><li id="7a59" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">我的待办事项门户(UI):已经用 Angular 编写了。</li><li id="d269" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated"><strong class="kc io"> <em class="nx"> todoctl CLI:我们将在这个项目中使用 Go Cobra 包来开发它。</em> </strong></li></ul><p id="c3f6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的目标是开发一个应用程序来管理来自 CLI 的任务，而不需要进入面向技术用户(如开发人员)的门户。todoctl 将能够做以下事情</p><ul class=""><li id="5906" class="nj nk in kc b kd ke kh ki kl nl kp nm kt nn kx no np nq nr bi translated">创建待办事项:开发自定义命令“待办事项创建”</li><li id="2ec1" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">查看所有待办事项:开发一个自定义命令“待办事项视图”</li></ul></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h2 id="2311" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">构建我们的应用程序所需的包</h2><p id="39ba" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">我们将使用“cobra-cli”包来构建我们的应用程序</p><div class="ny nz gp gr oa ob"><a href="https://github.com/spf13/cobra-cli" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd io gy z fp og fr fs oh fu fw im bi translated">GitHub - spf13/cobra-cli:用于生成应用程序和命令的 Cobra CLI 工具</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">Cobra 提供了自己的程序，可以创建您的应用程序并添加您想要的任何命令。这是最简单的方法…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op jt ob"/></div></div></a></div></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="fde7" class="mr li in bd lj ms mt mu lm mv mw mx lp my mz na ls nb nc nd lv ne nf ng ly nh bi translated">让我们建立我们的工具</h1><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oq"><img src="../Images/912430747c8bf04d2eda60496e959e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edDzNRCDGwL7MdMkjC0Fzg.png"/></div></div></figure><p id="04e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如前所述，todoctl 将提供创建、查看。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi or"><img src="../Images/20b01bb1a9ebe39da28ecfc5dad31d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ap_BhRvehGhxiUM8hCA4Jw.png"/></div></div></figure><p id="e90c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，用下面的命令安装 cobra 生成器</p><p id="c20f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe os ot ou ov b">$ go install github.com/spf13/cobra-cli@latest</code></p><p id="91a9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Go 会自动将它安装到您的<code class="fe os ot ou ov b">$GOPATH/bin</code>目录中，这个目录应该在您的 PATH 中。一旦安装完毕，你应该可以使用<code class="fe os ot ou ov b">cobra-cli</code>命令。通过在命令行键入<code class="fe os ot ou ov b">cobra-cli</code>进行确认。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ow"><img src="../Images/e85c11c3247f1361d114b3ed8c224cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KE22NQE2K9R2XUZuWOumvA.png"/></div></div></figure><h2 id="8b14" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">初始化模块</h2><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/815888e4c2bec0c9dacb408a05d13731.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*g4_QoqRwNR0gzOo-gxnORQ.png"/></div></figure><ul class=""><li id="17d1" class="nj nk in kc b kd ke kh ki kl nl kp nm kt nn kx no np nq nr bi translated">创建新目录</li><li id="b40b" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated"><code class="fe os ot ou ov b">cd</code>进入目录</li><li id="fa05" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">运行<code class="fe os ot ou ov b">go mod init &lt;MOD_NAME&gt;</code></li></ul><p id="5129" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="517a" class="lh li in ov b gy pc pd l pe pf">$ cd $HOME/code <br/>$ mkdir todoctl<br/>$ cd todoctl<br/>$ go mod init github.com/&lt;user_name&gt;/todoctl</span></pre><h2 id="2c2f" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">初始化 Cobra CLI 应用程序</h2><p id="ebbe" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">在 go 模块中运行<code class="fe os ot ou ov b">cobra-cli init</code>。这将创建一个新的准系统项目供您编辑。</p><p id="25f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该能够立即运行您的新应用程序。用<code class="fe os ot ou ov b">go run main.go</code>试试。</p><p id="e90e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="f2bd" class="lh li in ov b gy pc pd l pe pf">$ cd $HOME/code/todoctl<br/>$ cobra-cli init<br/>$ go run main.go</span></pre><p id="81e8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Cobra 生成如下所示的文件夹结构</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="57a1" class="lh li in ov b gy pc pd l pe pf">$ todoctl/<br/>   cmd/<br/>     root.go<br/>   main.go<br/>   go.mod<br/>   go.sum</span></pre><p id="edf6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">main.go 是入口点。在 main.go 内部，它调用 cmd/root.go 的 execute 函数。</p><p id="0311" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">cmd/root.go 是 cobra CLI 工具的基本命令。CLI 中的所有其他命令都将是 rootCmd 的子命令。您可以根据需要修改 cmd/root.go 文件。</p><h2 id="ab9c" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">命令结构必须知道属性</h2><p id="fb36" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">有几个与 cobra 命令结构相关的属性是我们必须知道的</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="d860" class="lh li in ov b gy pc pd l pe pf">Use: Command name, we will use this name to execute the command</span><span id="2803" class="lh li in ov b gy pg pd l pe pf">Short: Short description of our command</span><span id="f575" class="lh li in ov b gy pg pd l pe pf">Long: Long description of our command</span><span id="df06" class="lh li in ov b gy pg pd l pe pf">Run: This function executes when we run any command. We can omit this if we don't have any action to perform. In our case, when we run todoctl root command we don't have any action to perform.</span></pre><p id="b6b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，我们在每个命令文件(例如 root.go)中都有 init 函数来定义我们所有的标志和配置设置。</p><h2 id="3876" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">修改根命令</h2><p id="080b" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">我们将在 root.go 文件中修改上述属性，以更改短描述和长描述。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ph pi l"/></div></figure><h2 id="ed46" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">构建并运行命令</h2><p id="b615" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">转到项目目录，通过运行命令来构建它</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="3177" class="lh li in ov b gy pc pd l pe pf">$ go install</span></pre><p id="a767" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令将在<br/> $GOPATH/bin 文件夹中生成项目的可执行文件。现在我们可以在终端中运行“todoctl”。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pj"><img src="../Images/7a2af460c6e18b7e5974609ee1e67df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OC2oOm1-CDE03W3L96NnNA.png"/></div></div></figure><p id="e3a2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nx">在对源代码进行任何修改后，您需要重新构建您的项目。</em></p><blockquote class="pk pl pm"><p id="09e5" class="ka kb nx kc b kd ke kf kg kh ki kj kk pn km kn ko po kq kr ks pp ku kv kw kx ig bi translated">因为它保存在 bin 文件夹中，所以您不必为此设置环境变量。如果出现任何类似“找不到命令”的错误，那么您的执行路径就没有设置。您可以通过执行以下操作来解决这个问题</p><p id="994b" class="ka kb nx kc b kd ke kf kg kh ki kj kk pn km kn ko po kq kr ks pp ku kv kw kx ig bi translated">打开终端 rc 文件(对于 zsh 终端 its。zshrc)并在下面添加行</p><p id="3dee" class="ka kb nx kc b kd ke kf kg kh ki kj kk pn km kn ko po kq kr ks pp ku kv kw kx ig bi translated"><em class="in">导出 GOBIN=$GOPATH/bin <br/>导出路径=$PATH:$GOBIN </em></p></blockquote><h2 id="3db5" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">后端 API 的快速信息</h2><p id="75fd" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">我们的<code class="fe os ot ou ov b">my-todos</code>后端节点服务有以下 API，这些 API 将从创建和查看命令中调用。</p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pq"><img src="../Images/fb74d12b7404026329415d976e675588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn-W7DpYlX8Yr2ZCA9fPOw.png"/></div></div></figure><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pq"><img src="../Images/68b24202cd2028356cbb6afa0a964a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYeBsYbQPDdP9tKf5wkmPg.png"/></div></div></figure><h2 id="10bc" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">开发创建子命令</h2><p id="f931" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">现在，我们将开发创建任务命令。我们可以通过下面的命令在 cobra 中添加一个子命令</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="d599" class="lh li in ov b gy pc pd l pe pf">$ cobra-cli add &lt;sub_command_name&gt;<br/>e.g <br/>$ cobra-cli add create</span></pre><p id="0446" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将在 cmd 文件夹中创建一个 create.go 文件。</p><p id="347e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要创建一个任务，我们需要从用户那里获取一些输入，如任务标题、描述、任务负责人、截止日期等。所有这些输入都可以通过 cobra 中的标志来获取。</p><p id="0c83" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更多信息，有两种类型的标志</p><ul class=""><li id="f453" class="nj nk in kc b kd ke kh ki kl nl kp nm kt nn kx no np nq nr bi translated"><strong class="kc io">持久标志:</strong>标志可以是持久的，这意味着该标志将可用于它所分配到的命令以及该命令下的每个命令。对于全局标志，指定一个标志作为根上的永久标志。</li><li id="2666" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated"><strong class="kc io">本地标志:</strong>一个标志也可以被本地分配，它只适用于那个特定的命令。</li></ul><p id="7a75" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将在这里使用当地的旗帜。init()函数中添加了所有必要的标志。在 Run()函数中，我们通过 API 执行了与后端(my-todos)服务对话的操作，以将任务保存在 DB 中。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="1725" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">修改 create.go 文件后，请在执行 create 命令前构建应用程序。</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="8cbd" class="lh li in ov b gy pc pd l pe pf">$ cd <!-- -->$HOME/code/todoctl<br/>$ go install</span></pre><p id="a3d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在执行下面的创建命令时，应该会显示输出</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="1377" class="lh li in ov b gy pc pd l pe pf">$ todoctl create --help<br/>This command will create a task</span><span id="e900" class="lh li in ov b gy pg pd l pe pf">Usage:<br/>  todoctl create [flags]</span><span id="c64b" class="lh li in ov b gy pg pd l pe pf">Flags:<br/>  -d, --description string   specify task description<br/>  -h, --help                 help for create<br/>  -t, --title string         specify task title / heading</span></pre><p id="6362" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们创建一个任务</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="a5dd" class="lh li in ov b gy pc pd l pe pf">$ todoctl create — title “completed todoctl tool” — description “we have finished developing our todoctl cli tool” </span><span id="57a2" class="lh li in ov b gy pg pd l pe pf">Output :</span><span id="f261" class="lh li in ov b gy pg pd l pe pf">Creating task {Title:completed todoctl tool Description:we have finished developing our todoctl cli tool}<br/>Task created with ID: 12</span></pre><p id="917a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nx">万岁！你执行了你的第一个命令。恭喜你！！</em></p><h2 id="95c6" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">开发视图命令</h2><p id="b6bc" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">是时候开发 view 命令来显示终端中的所有任务了。</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="55cd" class="lh li in ov b gy pc pd l pe pf">$ cobra-cli add view</span><span id="9267" class="lh li in ov b gy pg pd l pe pf">This will create a file view.go in cmd folder.</span></pre><p id="330d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将调用后端“列表”api 从数据库获取所有的任务。</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="c84b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们重建我们的应用程序</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="a550" class="lh li in ov b gy pc pd l pe pf">$ cd <!-- -->$HOME/code/todoctl<br/>go install</span></pre><p id="6ea0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在执行 view 命令时，它将列出所有任务</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="84ee" class="lh li in ov b gy pc pd l pe pf">$ todoctl view<br/>{Title:Create my-todo cli tool Description:Create my-todo cli tool in go using cobra}<br/>{Title:plan next content for recording Description:plan all the details about next content and date of recording}<br/>{Title:completed todoctl tool Description:we have finished developing our todoctl cli tool}</span></pre><h2 id="9aa8" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">使用毒蛇和眼镜蛇</h2><p id="e606" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">Viper 广泛用于以非常灵活的方式管理应用程序的配置。我们可以使用 viper 来配置 cobra flag 的值。让我们考虑下面的场景。</p><p id="08f8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在根命令中有一个标志“server_url”。它的值将按以下顺序设置</p><ul class=""><li id="16d9" class="nj nk in kc b kd ke kh ki kl nl kp nm kt nn kx no np nq nr bi translated">如果用户在命令中提供值，那么我们将首先考虑它。</li><li id="1ed4" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">如果用户没有在命令中提供，那么我们将从配置文件中读取。</li><li id="339d" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">如果两者(在命令和配置文件中)都缺失，那么我们将考虑 flag 的默认值。</li></ul><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="a918" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们修改了 init()来添加标志和初始化 viper。我们还添加了 Run()来根据我们的优先级设置标志值。</p><p id="6f2f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们重新构建我们的应用程序并运行 todoctl 命令</p><pre class="mg mh mi mj gt oy ov oz pa aw pb bi"><span id="057e" class="lh li in ov b gy pc pd l pe pf">$ cd <!-- -->$HOME/code/todoctl<br/>go install</span><span id="2ed2" class="lh li in ov b gy pg pd l pe pf">$ todoctl -u <a class="ae jz" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank">http://localhost:4000</a><br/>server url is: <a class="ae jz" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank">http://localhost:4000</a><br/>[Explanation : Flag value is provided in command using -u]</span><span id="6d73" class="lh li in ov b gy pg pd l pe pf">$ todoctl<br/>server url is: <a class="ae jz" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a> <br/>[Explanation : server_url from app.env file is getting printed as its not provided in command]</span><span id="2028" class="lh li in ov b gy pg pd l pe pf">$ todoctl<br/>server url is: <a class="ae jz" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a><br/>[Explanation : Flag's default value will be printed if we don't provide in command and server_url in app.env file]</span></pre><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/3e921b6e1335a2d47211e29dc56d8fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*TuX4Orx3OULtds8hZNOqWQ.png"/></div></figure></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h2 id="43ed" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">后续步骤</h2><p id="03b6" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">🎉祝贺您，我们已经构建了第一个 CLI 工具。我希望这能让您了解如何在 Go 中创建一个简单的命令行应用程序。</p><p id="966b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">🔥你可以得到源代码👇并添加更多功能。</p><h2 id="52b8" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">源代码</h2><ul class=""><li id="4b42" class="nj nk in kc b kd ma kh mb kl ps kp pt kt pu kx no np nq nr bi translated">我的待办事项后端服务:<a class="ae jz" href="https://github.com/Sofiukl/my-todos/tree/master" rel="noopener ugc nofollow" target="_blank">https://github.com/Sofiukl/my-todos/tree/master</a></li><li id="b44f" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">todoctl go CLI 工具:【https://github.com/Sofiukl/todoctl/tree/master T2】</li></ul><h2 id="e298" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">youtube 上的完整对话</h2><p id="d1e6" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">试着阅读，你可以在 youtube 上看完整的讲座</p><figure class="mg mh mi mj gt jo"><div class="bz fp l di"><div class="pv pi l"/></div></figure><h2 id="8731" class="lh li in bd lj lk ll dn lm ln lo dp lp kl lq lr ls kp lt lu lv kt lw lx ly lz bi translated">参考</h2><ul class=""><li id="d43d" class="nj nk in kc b kd ma kh mb kl ps kp pt kt pu kx no np nq nr bi translated">眼镜蛇—【https://github.com/spf13/cobra-cli T4】</li><li id="227d" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">毒蛇—<a class="ae jz" href="https://github.com/spf13/viper" rel="noopener ugc nofollow" target="_blank">https://github.com/spf13/viper</a></li><li id="6ff1" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">去—<a class="ae jz" href="https://go.dev/" rel="noopener ugc nofollow" target="_blank">https://go.dev/</a></li><li id="fe86" class="nj nk in kc b kd ns kh nt kl nu kp nv kt nw kx no np nq nr bi translated">其他 CLI 软件包—<a class="ae jz" href="https://github.com/thatisuday/commando" rel="noopener ugc nofollow" target="_blank">https://github.com/thatisuday/commando</a></li></ul></div></div>    
</body>
</html>