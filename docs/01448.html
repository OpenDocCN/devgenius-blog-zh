<html>
<head>
<title>Interacting with InfluxDB v2 from Mathematica via the Wolfram Language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Wolfram语言从Mathematica与InfluxDB v2交互</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/interacting-with-influxdb-v2-from-mathematica-via-the-wolfram-language-f335de30beaf?source=collection_archive---------20-----------------------#2020-07-03">https://blog.devgenius.io/interacting-with-influxdb-v2-from-mathematica-via-the-wolfram-language-f335de30beaf?source=collection_archive---------20-----------------------#2020-07-03</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="aed0" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">有时候，当你接近危险边缘，并且有稀疏或相当简洁的文档时，你所需要的只是一点点推动…</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/f3f51b726bf2a488af1a8d71668404c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hor57pXvQR42QmW-mIS5ew.jpeg"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">照片由来自<a class="ae lc" href="https://www.pexels.com/photo/black-and-white-business-chart-computer-241544/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae lc" href="https://www.pexels.com/@lorenzocafaro?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Lorenzo </a>拍摄</figcaption></figure><h1 id="fae5" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">灵活的数据争论</h1><p id="d54f" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">我使用<a class="ae lc" href="https://www.wolfram.com/mathematica/" rel="noopener ugc nofollow" target="_blank"> Mathematica </a>已经有几年了，有时可能是因为这种语言的范围太广，或者是因为有大量的内置函数可用，有时很难准确找到我需要的。</p><p id="b549" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我经常会发现，经过一段时间的研究后，我会找到一个完全符合我要求的函数，但通常简洁的可用文档并不总能给我提供足够的信息。</p><p id="0001" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">有时是参数，有时是返回值，但主要是缺乏具体用例的具体例子。文档是全面的，但由于经常有大量的排列，根本没有空间来包括一切！</p><p id="7179" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在这种情况下，我通常会前往Mathematica 本身的<a class="ae lc" href="https://stackoverflow.com" rel="noopener ugc nofollow" target="_blank"> Stack Overflow </a>或<a class="ae lc" href="https://mathematica.stackexchange.com" rel="noopener ugc nofollow" target="_blank"> Stack Exchange并进行搜索，但由于相对小众的用户群和/或很少有人做同样的事情，通常情况下，我没有太多可继续的东西——特别是如果它接近出血边缘。</a></p><p id="bcca" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">最近，我一直在用内置了<a class="ae lc" href="https://www.influxdata.com/products/flux/" rel="noopener ugc nofollow" target="_blank"> Flux </a>语言的<a class="ae lc" href="https://v2.docs.influxdata.com/v2.0/" rel="noopener ugc nofollow" target="_blank"> InfuxDB v2 </a>进行工作，我发现这是一个梦想——再加上Mathematica和Wolfram语言用于原型开发的灵活性和速度，这很快就成为了一个数据争论的梦想工具集。</p><p id="64fe" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我找不到任何人这样做的例子或文章，所以我整理了几个有用的Mathematica Wolfram语言函数，用于连接InfluxDB v2及其line协议，可以很容易地为您所用。</p><h1 id="2716" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">写入InfluxDB</h1><p id="d19e" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">以<a class="ae lc" href="https://v2.docs.influxdata.com/v2.0/reference/syntax/line-protocol/" rel="noopener ugc nofollow" target="_blank">行协议</a>格式准备一些文本数据，并将其存储在一个字符串中，每一行通常以一个\n结尾。举个例子，</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="2d0b" class="ml le ir mh b gz mm mn l mo mp">"measurementdata,SID=194,SID=5755 w1=7900 1593523543000000000\measurementdata,SID=194,SID=5755 w1=7905 1593523555000000000\n"</span></pre><p id="d241" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在将它传递给下面的示例函数，该函数在准备好的HTTPRequest[]上调用URLExecute[]，该准备好的http request[]包含与InfluxDB v2的API交互的必要信息。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="fbdc" class="ml le ir mh b gz mm mn l mo mp">postToInflux[textdata_]:=Module[<br/>{result},<br/>result = URLExecute @ HTTPRequest[<br/>         "YOUR-MACHINE-LOCATION:9999/api/v2/write",<br/>        &lt;| <br/>        "Method" -&gt; "POST",<br/>        "Headers" -&gt; {"Authorization" -&gt; "Token YOUR-ACCESS-TOKEN"},<br/>        "Query" -&gt; {"org"-&gt;"YOUR-ORG","bucket"-&gt;"YOUR-BUCKET"},<br/>        "Body" -&gt; textdata<br/>        |&gt;<br/>        ];<br/>Return[result];<br/>]</span></pre><p id="4c53" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">确保在默认的InfluxDB UI左上角的Load Data -&gt; Tokens下插入您的特定身份验证令牌。此外，关于认证令牌的更多细节可以在<a class="ae lc" href="https://v2.docs.influxdata.com/v2.0/security/tokens/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="a71e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">通常可以成功地批量处理几千个条目，我通常使用一个驱动函数来调用postToInflux[]，它会传递大约4000个条目，这取决于有多少个标签和值。这由你决定。</p><h1 id="3bab" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">从InfluxDB读取DB</h1><p id="ee08" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">在InfluxDB上执行查询是一个类似的操作，下面是一个计算特定桶中测量次数的示例。</p><pre class="kn ko kp kq gu mg mh mi mj aw mk bi"><span id="1e7f" class="ml le ir mh b gz mm mn l mo mp">countItems[]:=Module[<br/>{result},<br/>result = URLExecute @ HTTPRequest[<br/>    "YOUR-MACHINE-LOCATION:9999/api/v2/query",<br/>    &lt;| "Method" -&gt; "POST",<br/>       "Headers" -&gt; {"Authorization" -&gt; "Token YOUR-ACCESS-TOKEN",<br/>                     "Accept"        -&gt; "application/csv",<br/>                     "Content-type"  -&gt; "application/vnd.flux"},<br/>       "Query" -&gt; {"org"-&gt;"YOUR-ORG","bucket"-&gt;"YOUR-BUCKET"},<br/>       "Body" -&gt; "from(bucket: \"YOUR-BUCKET\") |&gt; range(start: -30d) |&gt; count(column: \"_value\")"<br/>    |&gt;];</span><span id="82ec" class="ml le ir mh b gz mq mn l mo mp">Return[result];<br/>]</span></pre><p id="edf1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">函数体可以包含任何查询，我将让您根据自己的情况修改函数。<a class="ae lc" href="https://v2.docs.influxdata.com/v2.0/reference/flux/" rel="noopener ugc nofollow" target="_blank"> Flux语言</a>本身非常强大，但是这个函数应该允许您传递几乎任何查询，并允许您适当地处理结果。</p><p id="53d3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我希望它们对你有用。</p></div></div>    
</body>
</html>