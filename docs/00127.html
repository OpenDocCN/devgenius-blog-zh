<html>
<head>
<title>Configure SSH Key and Git Integration With Windows 10 Native Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配置 SSH 密钥和 Git 与 Windows 10 原生方式的集成</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/set-up-ssh-key-and-git-integration-in-windows-10-native-way-c9b94952dd2c?source=collection_archive---------0-----------------------#2020-03-08">https://blog.devgenius.io/set-up-ssh-key-and-git-integration-in-windows-10-native-way-c9b94952dd2c?source=collection_archive---------0-----------------------#2020-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b9a3dfb5ddcc3f167bcbfbe393c6897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6_cbOfB7M6qz6WUN.jpg"/></div></div></figure><p id="3b45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你知道 Windows 10 自带 OpenSSH 客户端吗？</p><p id="c965" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从 Windows 10 秋季创建者更新(1709)开始，OpenSSH 客户端作为 Windows 附加组件包含在内。然而，人们很容易误解它是由不同于 Linux 的不熟悉的用法提供的，或者它仍然没有得到适当的支持。</p><p id="09f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将看看如何设置 Windows 10 内置的 OpenSSH，并给你一些有用的提示。</p><h1 id="2b1d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">配置 Windows OpenSSH</h1><p id="9552" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">以管理员身份启动 PowerShell，并使用下面的 PowerShell 命令添加 Windows 组件。</p><p id="e7a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">微软目前安装的 OpenSSH 是一个附加包，按需提供功能，而不是经典控制面板<code class="fe lz ma mb mc b">control.exe</code>的<code class="fe lz ma mb mc b">Add/Remove Windows Components</code>对话框中的一个项目。您只能使用以下命令来安装它:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="341d" class="ml kx iq mc b gy mm mn l mo mp">$OpenSSHClient = Get-WindowsCapability -Online | ? Name -like ‘OpenSSH.Client*’<br/>Add-WindowsCapability -Online -Name $OpenSSHClient.Name</span></pre><p id="65d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通常，安装后不需要重启系统。</p><p id="a9ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成安装后，您可以启用 ssh-agent 服务。这项服务以前每次注册都不要求 SSH 密钥密码。最初，该服务被禁用和停止，因此将该服务设置为自动启动并立即启动。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="f064" class="ml kx iq mc b gy mm mn l mo mp">$SSHAgentSvc = Get-Service -Name ‘ssh-agent’<br/>Set-Service -Name $SSHAgentSvc.Name -StartupType Automatic<br/>Start-Service -Name $SSHAgentSvc.Name</span></pre><p id="666c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您应该在管理员模式下关闭 PowerShell 窗口，并在 PowerShell 窗口照常打开的情况下工作。</p><p id="2f72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们正在设置一个新系统，所以让我们创建一个新的 SSH 密钥。OpenSSH 客户机包中添加了一些标准实用程序。运行<code class="fe lz ma mb mc b">ssh-keygen</code>命令并回答问题。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="6d58" class="ml kx iq mc b gy mm mn l mo mp">ssh-keygen</span></pre><p id="c244" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令从<code class="fe lz ma mb mc b">$HOME\.ssh\id_rsa</code>文件和<code class="fe lz ma mb mc b">$HOME\.ssh\id_rsa.pub</code>文件创建一个密钥对。</p><p id="3262" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行 ssh-add 命令，将这个密钥对添加到 ssh-agent 服务中。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="c11e" class="ml kx iq mc b gy mm mn l mo mp">ssh-add</span></pre><p id="5de4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它会自动注册<code class="fe lz ma mb mc b">$HOME\.ssh\id_rsa</code>密钥对，现在您可以使用该密钥对进行身份验证。</p><blockquote class="mq mr ms"><p id="bb8f" class="jy jz mt ka b kb kc kd ke kf kg kh ki mu kk kl km mv ko kp kq mw ks kt ku kv ij bi translated"><em class="iq">注意:有时系统可能安装了多个</em> <code class="fe lz ma mb mc b"><em class="iq">ssh.exe</em></code> <em class="iq">二进制文件，并且</em> <code class="fe lz ma mb mc b"><em class="iq">ssh.exe</em></code> <em class="iq">二进制路径可能在</em> <code class="fe lz ma mb mc b"><em class="iq">PATH</em></code> <em class="iq">环境变量中重复。要调试此问题，请查看</em> <code class="fe lz ma mb mc b"><em class="iq">path</em></code> <em class="iq">命令或</em> <code class="fe lz ma mb mc b"><em class="iq">PATH</em></code> <em class="iq">环境变量的内容，并更改包含要首先使用的</em> <code class="fe lz ma mb mc b"><em class="iq">ssh.exe</em></code> <em class="iq">二进制文件的文件夹路径，或者只保留一个。</em></p></blockquote><h1 id="eba6" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在 Github 上注册 SSH 密钥</h1><p id="b36f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您需要将这个 SSH 密钥对的公钥注册到 Github 或您的 Git 存储库中。</p><p id="d83b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入以下 PowerShell 命令复制公共 SSH 密钥值以注册其他系统。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="fa08" class="ml kx iq mc b gy mm mn l mo mp">Get-Content -Path $HOME\.ssh\id_rsa.pub | Set-Clipboard</span></pre><p id="68ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用这个命令，公钥自动输入到剪贴板上。</p><p id="b842" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后输入以下命令打开 GitHub 配置页面。(或者，您可以直接在首选浏览器而不是默认浏览器中打开下面的 URL。)</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="c5a1" class="ml kx iq mc b gy mm mn l mo mp">Start-Process ‘https://github.com/settings/ssh/new'</span></pre><p id="2b40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，从剪贴板粘贴公钥，并通过添加密钥的清晰描述来注册它。</p><h1 id="5a7e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">安装 Git 客户端和 SSH 客户端</h1><p id="3593" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">安装 Git 客户端的方法有很多，但是我推荐使用 Chocolatey 包管理器，这是最直观、最简单的方法。</p><p id="4907" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">官方的 Git 客户端安装包公开了许多可能导致副作用的选项，因此如果安装不正确，可能会由于意外的功能而遇到困难。</p><p id="24c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，安装 Chocolatey 软件包管理器(如果它不存在的话)。因为这是软件的系统级添加，所以请允许管理员花几分钟时间打开一个新的 PowerShell 窗口。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="b02a" class="ml kx iq mc b gy mm mn l mo mp">Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(‘https://chocolatey.org/install.ps1'))</span></pre><p id="6193" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在输入命令来安装 Git for Windows 客户端。</p><blockquote class="mq mr ms"><p id="9a07" class="jy jz mt ka b kb kc kd ke kf kg kh ki mu kk kl km mv ko kp kq mw ks kt ku kv ij bi translated"><em class="iq">注意:通常情况下，如果 Chocolatey.org 网站进入定期检查期，安装可能无法正常进行。在这种情况下，请检查 Chocolatey.org 网站，稍后再试。</em></p></blockquote><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="347a" class="ml kx iq mc b gy mm mn l mo mp">choco install git -y</span></pre><p id="bf27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到常规的 PowerShell 窗口，设置 GIT_SSH 环境变量。您必须指定这个环境变量，以便 Git 客户机能够正确识别 Windows 10 上的 SSH 客户机。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="80cf" class="ml kx iq mc b gy mm mn l mo mp">$SSHPath = (Get-Command -Name ‘ssh.exe’).Source<br/>[Environment]::SetEnvironmentVariable(‘GIT_SSH’, $SSHPath, ‘User’)</span></pre><h1 id="1443" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">用 oh-my-posh 驱动 PowerShell</h1><p id="4eb2" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">顾名思义，oh-my-posh 是目前在 macOS 和 Linux 上流行的 oh-my-zsh 的 Windows PowerShell 版本。有趣的是，它支持 oh-my-zsh 提供的一些特性。</p><p id="daaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，运行 oh-my-posh 安装脚本。它列在 PowerShell 的官方模块库中，所以命令并不复杂和简单。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="787e" class="ml kx iq mc b gy mm mn l mo mp">Install-Module posh-git -Scope CurrentUser<br/>Install-Module oh-my-posh -Scope CurrentUser</span></pre><p id="cf2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在 PowerShell Core 6 上，您需要运行以下命令。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="794a" class="ml kx iq mc b gy mm mn l mo mp">Install-Module -Name PSReadLine -AllowPrerelease -Scope CurrentUser -Force -SkipPublisherCheck</span></pre><p id="2362" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编辑配置文件，以便在 PowerShell 启动时可以加载 oh-my-posh shell。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="65b2" class="ml kx iq mc b gy mm mn l mo mp">if (!(Test-Path -Path $PROFILE )) { New-Item -Type File -Path $PROFILE -Force }<br/>notepad.exe $PROFILE</span></pre><p id="fc67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在脚本的末尾添加以下代码并保存。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="166f" class="ml kx iq mc b gy mm mn l mo mp">Import-Module posh-git<br/>Import-Module oh-my-posh<br/>Set-PoshPrompt Paradox</span></pre><p id="2989" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一个旁注，使用电力线修补的编程字体看起来很漂亮，不会破坏字形。在提升的 PowerShell 中重新运行以下命令，并使用 D2 编码字体更新控制台窗口的字体设置。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="7bc1" class="ml kx iq mc b gy mm mn l mo mp">Import-Module posh-git<br/>Import-Module oh-my-posh<br/>Set-PoshPrompt Paradox</span></pre><p id="6b41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当所有的设置都被应用时，您将看到类似下图的内容，如果您将目录移动到 Git 存储库，您将看到分支名称看起来不错。😎</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/1b0957a96ce79a7254d0251c01b1a9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LnXVXEjaWIKdqAeU.png"/></div></div></figure><h1 id="9a9a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">附录 1:安装 Windows 终端应用程序</h1><p id="548b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您可以通过在 PowerShell 中运行以下命令直接进入 Windows 终端应用商店页面:众所周知，使用 Windows 终端可以获得现代 CLI 开发环境的所有好处。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="4dac" class="ml kx iq mc b gy mm mn l mo mp">Start-Process 'https://www.microsoft.com/store/productId/9N0DX20HK701'</span></pre><p id="4179" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装后可以直接用<code class="fe lz ma mb mc b">wt.exe</code>或者<code class="fe lz ma mb mc b">wt</code>快捷键启动 Windows 终端 app。也就是在 Windows 上，记住<code class="fe lz ma mb mc b">wt</code>而不是<code class="fe lz ma mb mc b">cmd</code>、<code class="fe lz ma mb mc b">powershell</code>或者<code class="fe lz ma mb mc b">pwsh</code>。😏</p><h1 id="2a3d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">附录 2:对于源代码树</h1><p id="7bf6" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">不幸的是，SourceTree 使用的 Git 客户机不能与 Windows 提供的 SSH 代理服务一起工作。相反，您可以使用自己创建的密钥。</p><p id="9848" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在 SourceTree 选项窗口中，将 SSH 客户端更改为 OpenSSH，如下所示。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/24d25b9f88c5c45d131c81027c587de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/0*BxddhKnJ1H4gK0E0.png"/></div></figure><p id="26f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，验证 SSH 密钥是否与$HOME 相同。在上一步中创建的 ssh\id_rsa 文件。如果不同，请再次指定。<br/>完成后，按下确定按钮保存设置。</p><h1 id="2159" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">附录 3:与 Visual Studio 代码集成</h1><p id="cf19" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果正确注册了 GIT_SSH 环境变量，集成就完成了，没有任何特殊的设置。但是，即使您已经完成了配置，如果在执行 git pull 时仍然没有任何消息，您可以运行 ssh-add -l 命令内置终端来检查 ssh-agent 服务的连接状态。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/rkttu"><div class="gh gi mz"><img src="../Images/6d60b235fcc46a4bd696b90e886419ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*Dpw8-hNGI2fDmosV4E8DVQ.png"/></div></a></figure></div></div>    
</body>
</html>