<html>
<head>
<title>Going TypeStack with NX Monorepo and Docker (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 NX Monorepo 和 Docker 进行排版(第 1 部分)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/going-typestack-with-nx-monorepo-and-docker-part-1-d5ff257981f2?source=collection_archive---------2-----------------------#2022-05-26">https://blog.devgenius.io/going-typestack-with-nx-monorepo-and-docker-part-1-d5ff257981f2?source=collection_archive---------2-----------------------#2022-05-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9995" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你好，</p><p id="72a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇(长)教程中，我将展示如何使用由<a class="ae ki" href="https://nx.dev/" rel="noopener ugc nofollow" target="_blank"> NX </a>和<a class="ae ki" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>提供的架构来实现一个完整的项目(api、app、故事书、数据库)。</p><p id="e2b5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这只是第一部分，请继续关注。</p><p id="fa39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们集思广益:</p><ul class=""><li id="834f" class="kj kk in jm b jn jo jr js jv kl jz km kd kn kh ko kp kq kr bi translated">（同 nonexpendable）非消耗品</li><li id="122d" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">PNPM(包装经理)</li><li id="19d6" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">码头工人</li><li id="2813" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">以打字打的文件</li><li id="ffe8" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">NodeJS/Express(后端)</li><li id="b553" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">反应+故事书+顺风 CSS(前端)</li><li id="313b" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">数据库(MySQL、Redis)</li><li id="2352" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">Nginx</li><li id="9b18" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">工具:Prisma、Typedocs</li><li id="dbfe" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">弹性搜索和基巴纳</li></ul><p id="9eb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将构建一个 api，它使用两个数据源(数据和缓存)，包括所有关于安全性和设计模式的最佳实践，在代理后面充当负载平衡器。此外，到最后，我们将在 React 中构建一个使用我们的 api 的应用程序。</p><p id="7ea9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里的目标是如何复制一个完全响应、高效和健康的 monorepo，把应用程序本身放在一边。</p><p id="92d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 monorepo 是一个重大决定，因为我们必须在运行任何长流程(构建、部署等)时确保编码的灵活性和性能。).我曾经与 lerna 一起工作了很长时间，但是一旦项目开始达到一个规模或依赖循环的状态，图像已经建立，观察者正在运行，这时你就会意识到你花在等待上的时间比行动上的时间还要多。</p><p id="5b1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，几天后，我决定 NX 是最好的解决方案。又过了几天，事实证明我是对的。20 多个项目在几秒钟内完成。17 使用 docker 图像。那是天堂。</p><p id="9ad4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是并不是所有的事情都是好消息，而且出现了很多错误，所以经过几天的研究，我决定分享最终的骨骼。</p><p id="2817" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设您已经安装了 node 和 docker，这是我当前对本教程的说明:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/6072916e865a7b3090f1dc997831ff60.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*r6yG_FdJiWK88wVzL0Cv8w.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">基本堆栈</figcaption></figure><p id="beda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">都包好了，让我们开始吧。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lj lk l"/></div></figure></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="ac9a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们打算让 PNPM 做我们的包装经理。如果你愿意，你可以使用 npm 或者 yarn，但是 npm 在处理大量的包和泛滥的 node_modules 时更有效。因为我们在处理 monorepos，我们当然希望尽可能少的依赖，而 pnpm(对我来说)是最适合这项工作的。</p><blockquote class="ls lt lu"><p id="cf79" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated">npm i -g pnpm@next-7</p></blockquote><p id="ca6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启动新的 nx 应用程序。让我们称我们的为“类型堆栈”:</p><blockquote class="ls lt lu"><p id="1a1b" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated">npx create-NX-workspace @ latest—preset = react-express—package manager = pnpm—name = typestack</p></blockquote><p id="8fb2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Nx 会问你是否想连接他们的云，这完全取决于你。你可以在这里了解更多关于<a class="ae ki" href="https://nx.app/docs/add-nx-cloud-to-workspace" rel="noopener ugc nofollow" target="_blank">的信息。现在，我们可以选择否</a></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/cd5227a7d9495501e816b7a0e58629ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pzrew15NGxQkGRMJrz-VnQ.png"/></div></div></figure></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="95aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们可以打开我们的编辑器，从这里开始做一些代码。我使用的是 Visual Studio 代码，但是您也可以使用自己喜欢的代码。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi me"><img src="../Images/1e38c20adc5c1bea3c6a3326018c4dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ty1XFdOQc8KtGYRDjjLEew.png"/></div></div></figure><p id="2bd5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，Nx 附带我们的源的默认配置:</p><ul class=""><li id="5582" class="kj kk in jm b jn jo jr js jv kl jz km kd kn kh ko kp kq kr bi translated">。/libs—我们的包和库所在的位置；</li><li id="cada" class="kj kk in jm b jn ks jr kt jv ku jz kv kd kw kh ko kp kq kr bi translated">。/apps——我们的应用程序/api 的生命所在；</li></ul><p id="ba47" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果需要，您可以通过编辑<code class="fe mf mg mh mi b">nx.json</code>文件来修改它。现在，我们将使用缺省值。还有，在这里休息一下，看看<a class="ae ki" href="https://nx.dev/configuration/packagejson" rel="noopener ugc nofollow" target="_blank"> nx.json 文档</a>。</p></div><div class="ab cl ll lm hr ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ig ih ii ij ik"><p id="e926" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一步，让我们设置我们的前端应用程序。我们将使用 react，因此需要从 webpack 和 babel 安装一些依赖项:</p><blockquote class="ls lt lu"><p id="8ca7" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated">pnpm install—save-dev web pack<a class="ae ki" href="http://twitter.com/babel/core" rel="noopener ugc nofollow" target="_blank">@ babel/core</a>babel-loader<a class="ae ki" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@ babel/preset-env</a></p></blockquote><p id="70e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">额外收获:Nx 为我们提供了一个 VSCode 的<a class="ae ki" href="https://marketplace.visualstudio.com/items?itemName=nrwl.angular-console" rel="noopener ugc nofollow" target="_blank">插件，我们可以从一个非常友好的 UI 运行所有可用的命令，而不是从我们的终端运行所有的 cli 命令:</a></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mj"><img src="../Images/640652e7a7fe736f440fe065f2e79d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVI71XX1raGH4cQzEQHmsQ.png"/></div></div></figure><p id="82bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在屏幕截图中，我们可以看到 react 应用程序的生成器正在运行:当我们在 UI 中修改属性时，我们得到了一个模拟执行输出，显示了项目中将要更改的所有内容。在本例中，我们创建了一个名为“app”的新应用程序，使用“scss”作为我们的样式处理器，添加了 react 中的路由模块，只是为了这个(已经太长了)教程，我们不打算使用 e2e。</p><p id="1daf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我们在这个配置中得到的最后一个命令:</p><blockquote class="ls lt lu"><p id="5ad8" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated">pnpm exec NX generate<a class="ae ki" href="http://twitter.com/nrwl/react" rel="noopener ugc nofollow" target="_blank">@ nrwl/react</a>:应用 app—style = scss—e2eTestRunner = none—routing</p></blockquote><p id="2128" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">过程完成后，你应该有一个“应用程序”文件夹在里面。/应用程序。</p><p id="b3bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此时，我们已经有了一个功能性的 react 应用程序。</p><p id="b910" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以通过 VSCode 或命令行使用插件运行应用程序:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mj"><img src="../Images/de393ed872891edc96e2ed66bbfa6fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RnspEVdRmKvixFuJ6NC8Ow.png"/></div></div></figure><blockquote class="ls lt lu"><p id="4cdd" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated">nx serve 应用程序</p></blockquote><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mk"><img src="../Images/2f7870197cb23bfd732e8f0de4b1b054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDlbKL5Kq2_IGbjhRXMDFQ.png"/></div></div></figure><p id="db05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">恭喜，您刚刚使用 Nx 提供了一个新的 react 应用程序。</p><p id="28cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下一篇文章中，我们将探索并在我们的应用中设置<a class="ae ki" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> Tailwind CSS </a>。Tailwind 是一个实用至上的 CSS 框架，里面有像<code class="fe mf mg mh mi b">flex</code>、<code class="fe mf mg mh mi b">pt-4</code>、<code class="fe mf mg mh mi b">text-center</code>和<code class="fe mf mg mh mi b">rotate-90</code>这样的类，可以直接在你的标记中构建任何设计。</p><p id="2159" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，对于我们的前端，我们将配置<a class="ae ki" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank"> Storybook </a>，这是一个用于独立构建 UI 组件和页面的开源工具。</p><p id="79a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们将在应用程序和我们的 API 之间建立连接。</p><p id="4040" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢你到达终点。这是我的第一篇帖子，我希望能给大家带来一些新的或者有用的东西。</p><p id="0adf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">干杯。</p><p id="29a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" rel="noopener ugc nofollow" target="_blank" href="/going-typestack-with-nx-monorepo-and-docker-part-2-f66c543c7d8f">第二部分在这里</a></p></div></div>    
</body>
</html>