<html>
<head>
<title>NodeJS— Make Full Authentication API — The Complete Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeJS—制作完整的身份验证 API —完整指南</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/nodejs-make-full-authentication-api-the-complete-guide-76ef3215ed68?source=collection_archive---------0-----------------------#2020-07-17">https://blog.devgenius.io/nodejs-make-full-authentication-api-the-complete-guide-76ef3215ed68?source=collection_archive---------0-----------------------#2020-07-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/233929c36a1b715e745e70807a15c9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ypHx4g0h8aLtQoskUN9MoQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">NodeJS —完全身份验证—完整指南</figcaption></figure><p id="b482" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">嗨朋友们，让我们再来谈谈 NodeJS。</p><p id="6e13" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我们谈论我们的主要话题之前，我上周刚刚写了一篇文章，也谈到了 NodeJS。实际上，我推荐你阅读这篇文章，因为我们要实现文章中的代码，好吗？以下是链接:</p><div class="kx ky gp gr kz la"><a href="https://medium.com/dev-genius/nodejs-make-your-api-response-nicely-f562f78cb67" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd io gy z fp lf fr fs lg fu fw im bi translated">NodeJS——让您的 API 响应更加完美</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">嗨，朋友们，自从一年前我写了一篇关于 Laravel API 的文章已经有一段时间了，下面是这篇文章，我写于…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jt la"/></div></div></a></div><p id="b0d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是如果你不读那篇文章，我将在这篇文章中解释一下那篇文章。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="971e" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">遵循这篇文章的要求</h1><ol class=""><li id="5ad1" class="mu mv in kb b kc mw kg mx kk my ko mz ks na kw nb nc nd ne bi translated">非常基础的 JavaScript。</li><li id="e1f1" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">非常基础的 NodeJS / ExpressJS。</li><li id="44cf" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">非常基础的 API。</li><li id="7632" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">非常基础的 MongoDB。</li><li id="1a90" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">非常基础的 MVC 模式(常用 JavaScript)。你不需要知道。</li></ol><h1 id="6aed" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">跟随这篇文章的必备工具</h1><h2 id="9324" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">1.NodeJS</h2><p id="b9ab" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">重要的是<strong class="kb io"> NodeJS </strong>本身，你可以在这里下载(【https://nodejs.org/en】T2)。我推荐安装<strong class="kb io"> LTS </strong>版本，我目前用的是 v12.2.0 <em class="of">。</em></p><h2 id="55f7" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">2.邮递员</h2><p id="c8e8" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">Postman 是一个强大而友好的用户界面应用程序，可以在这里下载(<a class="ae oe" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">https://www.postman.com</a>)。</p><h2 id="6190" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">3.文字编辑器</h2><p id="228a" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">有很多文本编辑器，我更喜欢使用可以在这里下载的<strong class="kb io">vs code</strong>(<a class="ae oe" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank">https://code.visualstudio.com</a>)。<br/>如果你想使用像<strong class="kb io"> Sublime Text </strong>或<strong class="kb io"> Atom 这样的文本编辑器，没关系，</strong>只需选择适合你的工具。</p><h2 id="fb3f" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">4.MongoDB</h2><p id="b34b" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">MongoDB 是一个 NoSQL 数据库，我使用它是因为它更适合于 ExpressJS，并且开发速度更快，尤其是当你与数据库本身交互时。你可以在这里下载 MongoDB(<a class="ae oe" href="https://www.mongodb.com/try/download/community" rel="noopener ugc nofollow" target="_blank">https://www.mongodb.com/try/download/community</a>)。只是想让你知道，我们只是把它用于本地开发。</p><h2 id="83c3" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">5.MongoDB 指南针(可选)</h2><p id="d00a" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">MongoDB Compass 只是用于管理我们的 MongoDB 的 GUI，因为有了 GUI，它与用户的交互更加友好。但是，如果你想使用其他工具，这很好。你可以在这里下载(【https://www.mongodb.com/products/compass】T21)。但对你来说是完全可以选择的。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="2ae8" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">主要事物</h1><blockquote class="og"><p id="4b9f" class="oh oi in bd oj ok ol om on oo op kw dk translated">首先，这篇文章将会又长又复杂，但是它的每一步都会被解释，所以你可以完全理解发生了什么。</p><p id="be28" class="oh oi in bd oj ok ol om on oo op kw dk translated">但是鉴于这篇文章的复杂性，我想让这篇文章更简洁，更容易理解和实现。</p><p id="6b03" class="oh oi in bd oj ok ol om on oo op kw dk translated">我将使用<strong class="ak"> MVC </strong>模式制作这个 ExpressJS 项目，但是这个 MVC 模式不会是一个类，它将是一个普通的 JavaScript。所以，如果你不知道什么是 MVC，不要担心，我会在这篇文章中解释。</p><p id="14bf" class="oh oi in bd oj ok ol om on oo op kw dk translated">如果你想知道什么是 MVC，MVC 是<strong class="ak">模型视图控制器</strong>，<strong class="ak"> </strong>是一种设计模式，使我们的代码更加结构化和更加可读，但是，在本文中，我们不会使用<strong class="ak">视图</strong>，因为我们只是要制作 API，而 API 不需要<strong class="ak">视图。</strong></p><p id="8ef2" class="oh oi in bd oj ok ol om on oo op kw dk translated">事实上，我要为这篇文章做一本电子书，但是，我只是在媒体上做。</p><p id="d8d4" class="oh oi in bd oj ok ol om on oo op kw dk translated">希望你喜欢阅读这篇文章！</p></blockquote></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="85a6" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">我为什么写这篇文章</h1><p id="bc46" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">老实说，我只是想为 NodeJS 或 ExpressJS 做一个入门或样板。这样我就不会重新创建一个新的项目，也不会像之前的项目那样重新编写相同的代码。</p><p id="71bc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我写这篇文章的另一个原因是为了节省时间。为什么？因为如果你想用相同的文件夹结构和相同的流程开始一个新项目，你只需要克隆或下载启动项目，并在那里开始编写你自己的东西。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="b850" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">读完这篇文章你会得到什么</h1><p id="2aa8" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">当然，完全认证 API 包含:</p><ol class=""><li id="5e6d" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw nb nc nd ne bi translated">注册。</li><li id="a73e" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">验证帐户。</li><li id="504a" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">登录。</li><li id="e7e3" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">重新发送新的验证令牌。</li><li id="85c2" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">获取经过身份验证的用户。</li><li id="b31d" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">忘记密码。</li><li id="6438" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">重置密码。</li></ol><p id="9511" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">通过阅读这篇文章，你将得到 6 个主要的东西，我们将使它在我们的代码中更容易实现。有趣吧？让我们跳！</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="afb9" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">我们开始吧</h1><p id="6df4" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我假设你已经安装了我提到的 5 个工具。好吧，让我们编码！</p><h2 id="4369" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">1.制作项目文件夹</h2><p id="a1cf" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我将通过创建一个名为<strong class="kb io"> BE_FULL_AUTH_EXPRESS </strong>的文件夹来开始这个项目，这是我命名文件夹的方式，它代表<strong class="kb io">后端完全认证 ExpressJS </strong>。实际上这并不重要，这取决于你。并转到您的项目文件夹。</p><h2 id="5f37" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated"><strong class="ak"> 2。Init package.json </strong></h2><p id="be41" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">什么是<strong class="kb io"> package.json？</strong>简单来说，<strong class="kb io"> </strong>就是一个包含你的 app 信息的文件。要初始化<strong class="kb io"> package.json </strong>，只需在您的终端/ CMD 中键入以下代码:</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="ab37" class="np lx in oy b gy pc pd l pe pf">npm init -y</span></pre><h2 id="a9bd" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">3.安装依赖项</h2><p id="7703" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在这里，我们将为我们的项目安装一些依赖项，为此只需运行以下代码:</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="bdf7" class="np lx in oy b gy pc pd l pe pf">npm i -S express config jsonwebtoken bcryptjs mongoose express-validator</span></pre><p id="d719" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们迭代将要安装包。</p><ul class=""><li id="e8cb" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated"><strong class="kb io"> express </strong>是 Node.js 的 web 应用框架。</li><li id="429e" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">config 是一个包，用来处理我们内置的 JSON 数据，或者处理我们的私有数据。</li><li id="32b5" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">jsonwebtoken 是一个包，用于处理我们的令牌，以便对服务器进行身份验证，并对某个服务器进行身份验证。如需进一步阅读，请点击这里(【https://jwt.io/】T2)。</li><li id="8401" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io"> bcryptjs </strong>是一个用于散列我们的纯文本密码的包，使它更加安全。</li><li id="9b9b" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">mongose 是一个 ORM，用于以一种简单的方式与我们的 MongoDB 交互。</li><li id="5881" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">express-validator 是一个用于处理我们身体反应的包，在其中进行一些验证。</li></ul><h2 id="0d8b" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">4.安装开发依赖项</h2><p id="5eb2" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">安装完依赖项后，我们将安装开发依赖项。好吧，那有什么区别？<strong class="kb io">开发依赖关系</strong>和<strong class="kb io">依赖关系</strong>位于<strong class="kb io">开发</strong>字处，很明显<strong class="kb io">开发依赖关系</strong>只是针对我们的开发环境，不会在我们将应用程序部署到实际服务器时安装，希望这是有意义的。要安装开发依赖项，我们只需键入:</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="c3c1" class="np lx in oy b gy pc pd l pe pf">npm install -D nodemon</span></pre><p id="a9c7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们迭代将要安装的包。</p><ul class=""><li id="f072" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">nodemon 是一个用于处理我们的 ExpressJS 服务器的包，如果我们的服务器代码有任何变化，将会自动重新启动服务器。</li></ul><h2 id="aba1" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">5.准备文件夹结构</h2><p id="04cd" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们将准备我们的文件夹结构，所以，文件夹结构将看起来像这样。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/0f3c05ce15b317969bc152cd3f38f3c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*5ESIJ9x2oHMfQJb_RzTzlA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">文件夹结构</figcaption></figure><p id="fb19" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我会解释那些文件夹的。</p><ul class=""><li id="6cd4" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated"><strong class="kb io"> app </strong>一个<strong class="kb io"> </strong>文件夹包含我们的主要应用文件夹。</li><li id="d912" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io">控制器</strong>一个用于处理我们的控制器的文件夹。</li><li id="5bb2" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io">助手</strong>一个文件夹来制作可重复使用的功能。</li><li id="54a3" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">为我们的应用程序制作中间件的文件夹。</li><li id="3b01" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io"> models </strong>一个文件夹，包含与数据库交互的模型。</li><li id="e7a6" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用于处理我们私有凭证的文件夹。</li><li id="5deb" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io"> routes </strong>包含我们的应用程序路由的文件夹。</li></ul><h2 id="2edc" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">6.配置 package.json 文件</h2><p id="b694" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">转到<strong class="kb io"> package.json </strong>用下面的代码复制并替换"<strong class="kb io">脚本</strong>"对象:</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">package.json 的主要配置</figcaption></figure><h2 id="d44b" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">7.在 server.js 文件中编写代码</h2><p id="4797" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在<strong class="kb io"> server.js </strong>文件中，键入以下代码:</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">server.js，应用的核心。</figcaption></figure><p id="5c4f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">通过键入以下命令运行服务器:</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="b9fd" class="np lx in oy b gy pc pd l pe pf">// if you configuring package.json in step 5, you can<br/>npm run server</span><span id="c154" class="np lx in oy b gy pk pd l pe pf">// or if you do not, you can simply<br/>nodemon server</span></pre><p id="256c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是结果，这意味着，服务器正在运行。很好。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/d2b2b800af1c92fea6190497b84ce6d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/0*gdpzqFcpL2TDJaRk.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">服务器正在运行</figcaption></figure><h2 id="b0ed" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">8.生成 responseApi.js 文件</h2><p id="25a8" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我将为这个项目制作<strong class="kb io"> responseApi.js </strong>文件，并将它放在<strong class="kb io"> <em class="of"> app/helpers </em> </strong>文件夹<em class="of">中。</em><strong class="kb io">response Api . js<em class="of"/></strong>是我们未来 API 的一个帮手，让它更加一致。这是代码。我正在写一篇关于这个的文章，我放在这篇文章顶部的链接。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">responseApi.js，让我们的应用程序更加一致。</figcaption></figure><h2 id="f42b" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">9.正在连接到 MongoDB</h2><p id="04e0" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在我们跳转到<strong class="kb io"> MVC </strong>之前，我们将建立一个到 MongoDB 的连接，在这种情况下，我们将使用 mongoose 进行交互。我将文件放在<strong class="kb io"><em class="of">config</em></strong><em class="of"/>文件夹中，并将其命名为<strong class="kb io"> db.js </strong>。<strong class="kb io"> </strong>代码会是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">db.js，用于连接 MongoDB</figcaption></figure><p id="829e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在根文件夹中更新您的<strong class="kb io"> server.js </strong>文件，您的<strong class="kb io"> server.js </strong>文件应该如下所示。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">更新了 server.js，第一部分。</figcaption></figure><p id="4a30" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">并且检查你的终端，你的终端日志会是这样的。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/35ca235894047d28931635aea26d1c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*D_0wsEgo5eG1C-vUkDuLxQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">连接到 MongoDB</figcaption></figure><p id="1c59" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这意味着，您的应用程序已经连接到 MongoDB，非常好。</p><h2 id="6cf7" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">10.制作 User.js 模型</h2><p id="74ff" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">因此，我们要制作的第一个模型是<strong class="kb io"> User.js </strong>，我将把它放在<strong class="kb io"><em class="of">app/models/user . js</em></strong><em class="of">中。这个模型将与 MongoDB 交互。代码将如下所示。</em></p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">用户模型</figcaption></figure><h2 id="5606" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">11.制作 Verification.js 模型</h2><p id="30f4" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们将制作一个验证模型，这个验证模型将包含<strong class="kb io">令牌、类型、用户 Id、</strong>和<strong class="kb io">创建日期</strong>。所以，你想知道一个<strong class="kb io">令牌</strong>、<strong class="kb io">用户 Id </strong>和<strong class="kb io">类型</strong>是什么？</p><ul class=""><li id="bd51" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated"><strong class="kb io">令牌</strong>代表一个唯一的密钥，用于验证我们的帐户，或者可能用于重置帐户密码。</li><li id="e570" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io"> userId </strong>代表将要进行验证的用户的 Id。</li><li id="3b18" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io">类型</strong>，在本文中，该类型将用于分隔我们的验证流程，我们将要构建的验证流程是为了在用户尝试登录时验证我们的帐户或验证用户重置密码。</li></ul><p id="8db8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有道理吗？我将它命名为<strong class="kb io"> Verification.js </strong>，并将其放在<strong class="kb io"> <em class="of"> app/models </em> </strong>文件夹中。<strong class="kb io"> <em class="of"> </em> </strong>代码会是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">验证模型</figcaption></figure><h2 id="ee99" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">12.制作 AuthController.js</h2><p id="8169" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在我们开始制作控制器之前，让我们先为控制器制作一些助手。我将把这个文件命名为<strong class="kb io"> common.js </strong>，并将它放在<strong class="kb io"><em class="of">app/helpers</em></strong><em class="of"/>文件夹中。代码将如下所示。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">助手功能</figcaption></figure><p id="eb51" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上面的代码中，我们只是做了一些函数来为我们的验证令牌生成一些随机字符串，简单吧？让我们继续前进！</p><p id="a3de" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对我们的注册端点进行验证。我将在<strong class="kb io"><em class="of">app/middleware</em></strong>文件夹中创建名为<strong class="kb io"> auth.js </strong>的验证中间件。代码会是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">认证中间件，用于验证注册端点</figcaption></figure><p id="86db" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为什么我要进行验证？因为我们将在<strong class="kb io"> AuthController.js </strong>中定义一个验证。那我们就做控制器吧。</p><p id="cd6c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，我们要构建的第一个控制器是<strong class="kb io"> AuthController.js </strong>，我将把它放在<strong class="kb io"><em class="of">app/controllers/API/auth controller . js</em></strong>。它将包含我们应用程序的完整认证流程，我们要做的第一个方法是<strong class="kb io">注册</strong>。<strong class="kb io"> </strong>临时代码是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">AuthController，第一部分</figcaption></figure><p id="29d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">寄存器</strong>的方法不言自明，其中:</p><ul class=""><li id="f400" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">用于注册新用户。</li><li id="c667" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">POST</strong>at(<strong class="kb io"><em class="of">API/auth/register)</em></strong>。</li><li id="f504" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问它。</li></ul><p id="31d7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这就是控制器，暂时它只包含注册方法，但我们将来会做得更复杂。</p><h2 id="59c0" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">13.制作 auth.js 路线</h2><p id="3531" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">为了使控制器工作，我们必须制定一个路线，并在路线中实现我们的中间件。我将在<strong class="kb io"> <em class="of"> routes/api </em> </strong>文件夹中创建一个名为<strong class="kb io"> auth.js </strong>的文件。代码会是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div></figure><p id="c93d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们只是在解构我们的控制器和中间件，并将导出的函数传递给路由。</p><p id="8e19" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">最后一件事，更新<strong class="kb io"> server.js </strong>文件。<strong class="kb io"> server.js </strong>文件会是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">server.js，第二部分。</figcaption></figure><h1 id="7210" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试我们的注册端点</h1><p id="a68e" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">所以，我们只是做了一个<strong class="kb io">寄存器的</strong>端点对吗？所以，我们要测试它是否真的有效。</p><p id="e20a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我将使用<strong class="kb io"> Postman </strong>和<strong class="kb io"> MongoDB Compass </strong>来测试这一点。我将首先使用<strong class="kb io"> Postman </strong>点击<strong class="kb io"> register </strong>端点，并确保您的 MongoDB 连接到您的本地机器。</p><p id="f796" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">确保你的<strong class="kb io">邮递员</strong>中的所有<strong class="kb io">头</strong>都是这样的。<strong class="kb io">Content-Type/Application/JSON</strong>头用于发送带有 Json 的请求，并且只接受 Json。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pn"><img src="../Images/aa4ff981c78566c68da090e1d1cb7d00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7pwINxRvtx95gvugkansg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">邮递员邮件头</figcaption></figure><p id="f0f8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，在设置了这些头之后，我转向了<strong class="kb io">主体</strong>，并用它们填充请求主体。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi po"><img src="../Images/b65fa255e6ef052af7bd7eedcad4817d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LQkuWWuHXj-S3-a-9o3AQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">注册工艺路线主体。</figcaption></figure><p id="8d1b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我点击<strong class="kb io"> Postman 中的<strong class="kb io"> Send </strong>之后，</strong>的响应会是这样的。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pp"><img src="../Images/9ef7e2e22d9ce9c57cab01eae5054e71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMnMEgXoYenPZVDhF5MfKA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">注册路线结果。</figcaption></figure><p id="4a91" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">看到了吗？令人惊奇的是，我们刚刚得到了我们请求的结果，这里的主要内容是，我们得到了<strong class="kb io">用户</strong>对象和<strong class="kb io">验证</strong>对象，因为这是这里的主要内容。如果我们看一下<strong class="kb io"> MongoDB Compass </strong>，数据应该也在那里。如果您查看 MongoDB，您的密码应该被散列为一个随机字符串。</p><p id="135f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">那么，我们谈论的<strong class="kb io">验证</strong>怎么样呢？所以，这是结果。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pq"><img src="../Images/d2b6c0af79392ff6d26b037d3651f666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ckj4-Rqa_ajbzRbW1cFEpw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">注册验证路线</figcaption></figure><p id="6482" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">看，厉害！你也得到了认可，客人呢？如果你用相同的电子邮件地址注册，你会得到相同的验证响应，但是，它与来自<strong class="kb io"> express-validator </strong>包的原始错误响应略有不同。让我们继续前进！</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="2001" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">制定验证路线</h1><p id="0000" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">现在，我们将为验证未验证的帐户创建一个验证路径。</p><h2 id="93f7" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">14.制定验证路线</h2><p id="9b55" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">将这段代码添加到您的<strong class="kb io"> AuthController.js </strong>中，放在导出的<strong class="kb io"> register </strong>方法的下面。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">验证端点。</figcaption></figure><p id="bd03" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">验证</strong>方法有一目了然的地方，其中:</p><ul class=""><li id="f9e2" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">验证将要激活帐户的用户。</li><li id="f548" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">在(<strong class="kb io"><em class="of">API/auth/verify/:token)</em></strong>处获取</strong>。</li><li id="af94" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问。</li><li id="d74d" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">有一个必需的参数请求，即<strong class="kb io">令牌</strong>。</li></ul><p id="b55c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">上面的代码是在我们的应用程序中验证未验证帐户的方法，代码很简单，端点方法是 GET，它里面有 param，称为<strong class="kb io">令牌</strong>。</p><p id="0a25" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">所以重点是，每次有新用户时，用户必须点击这个端点来验证他们的帐户。</strong></p><p id="4d4f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，可以在<strong class="kb io"><em class="of">routes/API/auth . js</em></strong><em class="of"/>文件中更新路线。将代码更新成这样。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">验证帐户途径</figcaption></figure><h1 id="f2c3" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试验证帐户路由</h1><p id="b8b2" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">照例可以打开<strong class="kb io">邮差</strong>进行测试。所以下面是如何查看那个<strong class="kb io">验证</strong>端点的结果。</p><blockquote class="pr ps pt"><p id="539d" class="jz ka of kb b kc kd ke kf kg kh ki kj pu kl km kn pv kp kq kr pw kt ku kv kw ig bi translated">所以，事情是这样的，当你在<strong class="kb io">注册</strong>端点注册账户后，你得到里面的<strong class="kb io">验证</strong>数据的对象，我建议你复制那个验证<strong class="kb io">令牌</strong>开始验证账户。或者，您可以检查您的 MongoDB。</p></blockquote><p id="9281" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以我将验证令牌传递给了 params，让我们看看下面的结果。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi px"><img src="../Images/9d205cf9f9137395fc5e5c2b949c4a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFoCjDLY-pfT7qZl3W9D0A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">验证帐户途径</figcaption></figure><p id="322a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就这么简单，你的账户就被激活了。如果您不确定数据是否已经更新，您当然可以在 MongoDB 中检查您的数据，但是，我非常确定，自从我们在<strong class="kb io"> Postman </strong>中点击这个<strong class="kb io"> verify </strong> endpoint <strong class="kb io"> </strong>以来，数据已经更新。它还应该从数据库中删除验证令牌。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="6eb6" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建登录路径</h1><p id="8eb5" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">所以，在这里，我们要用 JWT 登录！会有多兴奋。我们走吧！</p><h2 id="3106" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">15.创建登录路径</h2><p id="10ce" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在我们再次跳转到<strong class="kb io"> AuthController.js </strong>之前，我们要先设置我们的 JWT。首先，我们将制作一个<strong class="kb io"> JWT 密钥</strong>用于与<strong class="kb io"> JWT </strong>交互，我们将把它放在我们的<strong class="kb io"> <em class="of"> config </em> </strong>文件夹中。因此，我们将在<strong class="kb io"> <em class="of"> config </em> </strong>文件夹中创建一个名为<strong class="kb io"> default.json </strong>的文件。代码应该是这样的。</p><blockquote class="pr ps pt"><p id="ea9d" class="jz ka of kb b kc kd ke kf kg kh ki kj pu kl km kn pv kp kq kr pw kt ku kv kw ig bi translated">你可以用你自己定制的字符串来<strong class="kb io"> JWT 秘钥。</strong></p></blockquote><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="83eb" class="np lx in oy b gy pc pd l pe pf">{</span><span id="b773" class="np lx in oy b gy pk pd l pe pf">   "jwtSecret": "thiIsJWTSecretKeyThatUserDoesntKnow"</span><span id="6f32" class="np lx in oy b gy pk pd l pe pf">}</span></pre><p id="a960" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这只是一个简单的代码，但是你可以在 JSON 中添加更多的键，例如，你与数据库的连接，或者你可以存储用户名或密码，用于将来的默认开发，或者更多。所以别瞎折腾了。但是对于这篇文章，我只是用它来存储<strong class="kb io"> JWT 密钥</strong>。</p><p id="4814" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了使用这个文件，我们称之为已经安装的<strong class="kb io">配置</strong>包。让我们在<strong class="kb io"> AuthController.js </strong>中调用这个。代码会是这样的。</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="ebd1" class="np lx in oy b gy pc pd l pe pf">const config = require('config');</span></pre><p id="1a54" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">将其放在<strong class="kb io"> AuthController.js </strong>的顶行。我们以后会用到它。</p><h2 id="ee47" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">16.对登录路径进行验证</h2><p id="d2f9" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我将把它放在<strong class="kb io"><em class="of">app/middleware</em></strong>文件夹内的<strong class="kb io"> auth.js </strong> <em class="of"> </em>文件中，并在<strong class="kb io"> </strong>代码中添加一个名为<strong class="kb io"> loginValidation </strong>的新导出代码，如下所示。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">登录的验证途径</figcaption></figure><h2 id="5509" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">17.更新授权路线</h2><p id="a918" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">更新<em class="of"/><strong class="kb io"><em class="of">routes/API</em></strong>文件夹内的<strong class="kb io">auth . js<em class="of"/></strong>route，代码应该是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">更新路线。</figcaption></figure><p id="dd09" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这就是更新的路线，只是简单的更新。</p><h2 id="f505" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">18.更新授权控制器</h2><p id="4ef2" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">所以，让我们更新我们的控制器，简单地添加这个新的导出方法，代码应该是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">更新的 AuthController</figcaption></figure><p id="50d3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">登录</strong>方法有不言自明的地方:</p><ul class=""><li id="cb9d" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">将要登录的用户必须首先经过验证。</li><li id="3ccf" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">在(<strong class="kb io"> <em class="of"> api/auth/login) </em> </strong>发布</strong>。</li><li id="a965" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问。</li><li id="9a39" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">有两个必需的正文请求，即<strong class="kb io">电子邮件</strong>和<strong class="kb io">密码</strong>。</li><li id="100c" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io"> JWT </strong>令牌过期 1 小时，在那里是 3600 毫秒。</li></ul><p id="d837" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">上面的代码是一个在我们的应用程序中登录用户帐户的方法，代码很简单，但它更复杂，因为我们在那里做了一些逻辑，但是，我在那里做了一个注释，所以你可以理解那个方法在做什么。</p><h1 id="22e9" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试登录路径</h1><p id="5b61" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">现在，我将在<strong class="kb io"> Postman </strong>中测试<strong class="kb io">登录</strong>路线，我将以我在<strong class="kb io"> register </strong>路线中创建的用户身份登录，结果如下。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi py"><img src="../Images/dbf47962911fa3b40e34a2244c88df7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O01B4Vc31gxBkZbJLPkYLw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">测试登录路由。</figcaption></figure><p id="aaf7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在你点击发送之后，你会得到这样的回复。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pz"><img src="../Images/80c29f7983c2d066c6d2a70e012a3849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mO4qGFf9FF1fRLqgta-H9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">登录路线结果。</figcaption></figure><p id="260d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们刚刚登录。现在，看看上面的响应，我们首先使用激活的帐户登录，我们在主体中输入数据，发出请求，然后嘣！那是我们的认证令牌。如果你想在你的前端应用程序中使用这个令牌，那就太好了。但在本文中，我将只对一个端点使用该令牌，即<strong class="kb io">获得认证用户</strong>路由，我们将在未来创建该路由。</p><p id="8c03" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您想要使用尚未验证的帐户登录，您将会收到此错误消息。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qa"><img src="../Images/4ab59b0762bdf275a92576dd87b3e1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cWfaz9ojXjfjEML5pwKHXA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">未验证的帐户错误</figcaption></figure><p id="f72e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，这是用户尚未激活时的错误消息。验证响应与往常一样。你可以自己去查。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="cca7" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">重新发送新的验证令牌</h1><p id="354b" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们为什么要做这个？所以，我以前遇到过这样的问题，当用户开始注册他们的帐户，但有时用户忘记了他有激活帐户的令牌，然后，用户用新的电子邮件地址创建了一个新帐户，对吗？在这种情况下，我们只是为<strong class="kb io">做这个端点以防万一。但是，它将来会有用的。希望有意义，让我们编码吧！</strong></p><h2 id="4aae" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">19.AuthController 中的上次更新</h2><p id="3eb2" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">实际上，这是我们要在<strong class="kb io"> AuthController.js </strong>中构建的最后一个方法。所以将这段代码添加到您的<strong class="kb io"> AuthController.js </strong>中。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">重新发送验证方法</figcaption></figure><p id="7763" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> resendVerification </strong>方法有不言自明的地方，其中:</p><ul class=""><li id="6f18" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">向想要激活帐户的用户重新发送新的验证数据。</li><li id="4be8" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">在(<strong class="kb io"><em class="of">API/auth/verify/resend)</em></strong>发布</strong>。</li><li id="730c" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问。</li><li id="13a2" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">有一个必需的正文请求，即<strong class="kb io">电子邮件</strong>。</li></ul><p id="d757" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">上面的代码用于在用户忘记在第一次注册后获得的第一个数据的情况下，向用户重新发送新的验证数据以激活帐户。正如我所说，这种方法是<strong class="kb io">以防将来</strong>发生，但它也会对未来产生重大影响。</p><h2 id="4e78" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">20.更新 auth.js 路线</h2><p id="ac49" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">为了使<strong class="kb io"> resendVerification </strong>工作，我们将把路由添加到<strong class="kb io"> <em class="of"> routes/api </em> </strong>文件夹中的<strong class="kb io"> auth.js </strong>中。实际上我会在 gist 中写完整的代码，所以这里是完整的<strong class="kb io">auth . js</strong>route<strong class="kb io">T15】代码。</strong></p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">完整验证</figcaption></figure><h1 id="51e5" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试重新发送验证路由</h1><p id="412d" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">现在，我将在<strong class="kb io"> Postman </strong>中测试<strong class="kb io"> resendVerification </strong>路线，我将以我在<strong class="kb io"> register </strong>路线中创建的用户身份登录，结果如下。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qb"><img src="../Images/29164b1446485211fcfaa1535c6e3c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BrPzs2PEw9BzDhNLz0TbHg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">重新发送验证路由</figcaption></figure><p id="e6b9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你按下回车键，你会得到这样的回应。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qc"><img src="../Images/e057fba2ada168aa6ebdb82c84efc37f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9z4SVqjt7TpyAdx5pd4vsw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">重新发送验证结果</figcaption></figure><p id="acf1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">看到结果了吗？没错，我们正在制作新的验证数据，并替换以前的数据(如果有的话)。如果验证数据不存在，它将创建一个新的。这里有一个令牌，你可以用它来再次验证你的帐户，就这么简单。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="020e" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">使获得认证的用户</h1><h2 id="e7ce" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">21.更新 auth.js 中间件</h2><p id="2237" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">首先，我们要制作一些中间件来检查 JWT 令牌是否有效，为此我们只需在位于<strong class="kb io">app/middleware</strong>文件夹中的<strong class="kb io"> auth.js </strong>内制作一个新的导出函数。下面是<strong class="kb io"> auth.js </strong>中间件的完整代码。我只是在这里添加了一个名为<strong class="kb io"> auth </strong>的新导出函数以及一些注释和新的包。顺便说一下，代码是不言自明的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">完全授权中间件</figcaption></figure><h2 id="51aa" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated"><strong class="ak"> 22。AuthController.js 中的最后更新</strong></h2><p id="54d5" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们在这里进入了<strong class="kb io"> AuthController </strong>的结尾。在这里，我们将使用用户登录时获得的<strong class="kb io"> JWT </strong>令牌来创建一个获得认证用户的方法。我要让它变得非常简单，这是代码。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">获取经过身份验证的用户方法</figcaption></figure><p id="a0f2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> getAuthenticatedUser </strong>方法有一个不言自明的说明:</p><ul class=""><li id="db40" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">获取令牌的基于数据的有效负载。</li><li id="315c" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">获取</strong>at(<strong class="kb io"><em class="of">【API/auth】</em></strong>)。</li><li id="896c" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户不能公开访问。</li><li id="5fca" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户必须拥有访问该方法的令牌。</li></ul><h2 id="a317" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated"><strong class="ak"> 23。auth.js </strong>路线中的最后更新</h2><p id="f0f2" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">让我们更新我们的<strong class="kb io"> auth.js </strong>路线，这是路线的完整代码。我只是添加了一个新的中间件，我们只是在那里，并在其中添加了一个新的路由。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">完整的授权路径。</figcaption></figure><p id="1a1e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如何使用那个<strong class="kb io"> getAuthenticatedUser </strong>？我们再滚动一次。</p><h1 id="dbf6" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试获取经过身份验证的用户路由</h1><p id="26ec" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">现在，我将在<strong class="kb io"> Postman </strong>中测试<strong class="kb io"> getAuthenticatedUser </strong>路由，并且我将以我在<strong class="kb io"> register </strong> route 中创建的用户身份登录，因此，我将使用这些凭证。确保你有自己的用户数据。</p><ul class=""><li id="ba0e" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated"><strong class="kb io">电子邮件</strong>:huda@gmail.com。</li><li id="7303" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated"><strong class="kb io">密码</strong>:密码。</li></ul><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qd"><img src="../Images/fac5a72659ff6037fc349140abaf8757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Ckf5HR8pfSFMOrqAllDUA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">登录路由结果。</figcaption></figure><p id="28d4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">好的，我成功登录了。在那里，我们看到了令牌对象，对吗？我建议你复制并按照这个步骤使用它。</p><h2 id="18bb" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">1.请确保将您的标题请求更新为此。</h2><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qe"><img src="../Images/e4f151d5f515bcccb0e94093765dd5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkTYN11z0oB9NhwoOfReiQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">获取经过验证的用户标题配置</figcaption></figure><h2 id="f144" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">2.从以前的登录响应中复制您的令牌。</h2><p id="5f02" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">从登录响应中复制该令牌后，在您的授权值中复制它，应该是这样的。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qf"><img src="../Images/0b509b05c8220c093e7e7fb599e11cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4rmfLfVVU2OqPceZkW2xw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">经过验证的标头配置</figcaption></figure><p id="290e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是你必须仔细看的东西。</p><blockquote class="pr ps pt"><p id="35d2" class="jz ka of kb b kc kd ke kf kg kh ki kj pu kl km kn pv kp kq kr pw kt ku kv kw ig bi translated">在<strong class="kb io">授权</strong>中，<strong class="kb io">持有人</strong>必须首字母大写，并且<strong class="kb io">必须</strong>包含<strong class="kb io">一个空格</strong>作为<strong class="kb io">令牌</strong>的值。</p></blockquote><p id="f8bc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你必须做的最后一件事，就是点击<strong class="kb io">邮递员</strong>中的<strong class="kb io">发送</strong>按钮，你应该会得到这样的回复。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qg"><img src="../Images/e6a20dd5b939879e8fe083b137e3c94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuwIcTcllKbdOHxDfi54bA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">获取经过身份验证的用户结果</figcaption></figure><p id="b781" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">看到了吗？我们的数据在里面。酷！</p><p id="732b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们是在<strong class="kb io"> AuthController </strong>的边缘制作的。很有趣不是吗？如果你仍然不明白那里发生了什么，确保你在讨论中写下。让我们继续前进！</p><h2 id="c6d5" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated"><strong class="ak">授权控制器的结论</strong></h2><p id="bf7b" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们做到了！我们正在制作具有全部功能的完整的<strong class="kb io">授权控制器</strong>。所以，下面是<strong class="kb io"> AuthController.js </strong>的完整代码。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Full AuthController.js</figcaption></figure><blockquote class="og"><p id="da0a" class="oh oi in bd oj ok qh qi qj qk ql kw dk translated">准备好继续生活了吗？我希望你还和我在一起。我们走吧！</p></blockquote></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="f19a" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">忘记并重置密码</h1><p id="4191" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我们在这里几乎到达文章的结尾！好吧，我来解释一下<strong class="kb io">忘记</strong>和<strong class="kb io">重置</strong>密码的区别。下面是一些简单的术语。</p><p id="656b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">忘记了密码，我们将像<strong class="kb io">验证我们刚刚在那里创建的</strong>端点一样进行验证，并获得<strong class="kb io">重置</strong>密码的令牌。</p><p id="1a34" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">并且<strong class="kb io">重置</strong>密码，在我们从<strong class="kb io">获得忘记</strong>密码的令牌后，我们将获得该令牌并使用该令牌让<strong class="kb io">重置</strong>密码。</p><p id="c03c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有道理吗？让我们跳到代码。我们将首先让<strong class="kb io">忘记</strong>密码。</p><h2 id="77bf" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">24.制作 ForgotPasswordController.js</h2><p id="ac9c" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">首先，我们将制作一个名为<strong class="kb io">forgotpasswordcontroller . js</strong>的新品牌控制器，我将把它放在<strong class="kb io"><em class="of">app/controllers/API</em></strong><em class="of"/>文件夹中。代码就是这样的。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">ForgotPasswordController，第一种方法</figcaption></figure><p id="a436" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">好的，让我们重复上面发生的事情。</p><ul class=""><li id="155e" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">发送忘记密码的验证数据。</li><li id="0064" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">POST</strong>at(<strong class="kb io"><em class="of">API/密码/忘记)</em> </strong>。</li><li id="b764" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问。</li><li id="8e74" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">端点具有名为<strong class="kb io">电子邮件</strong>的正文请求。</li></ul><p id="7d5e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">实际上，上面的代码类似于<strong class="kb io"> AuthController.js </strong>中的<strong class="kb io"> verify </strong>方法，但是，我会让你更容易理解。你也许可以更新代码，让一个函数像助手一样在单独的控制器中被调用，对吗？我真的很鼓励你这么做。</p><h2 id="9bf7" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">25.制作 forgotPassword.js 路线</h2><p id="4213" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">在这里，我们也要创建一个新的路由，我将它命名为<strong class="kb io"> forgotPassword.js </strong>，我将把它放在<strong class="kb io"> <em class="of"> routes/api </em> </strong>文件夹中。代码应该像这样简单。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">忘记密码路线，第一次接近</figcaption></figure><p id="cede" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我想你能读懂这些代码，对吗？这就很好解释了。好了，我们继续吧！</p><h2 id="b207" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">26.更新 server.js 文件</h2><p id="b5cc" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">要使这些工作，最后一件事是更新根文件夹中的<strong class="kb io"> server.js </strong>文件，如下所示。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">更新的 server.js</figcaption></figure><p id="4e21" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我只是顺便在<strong class="kb io"> auth </strong>路线下面增加新的<strong class="kb io"> app.use() </strong>。</p><h1 id="1836" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试<strong class="ak">忘记密码</strong>端点</h1><p id="8636" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">和往常一样，我在<strong class="kb io">邮递员</strong>上测试这个，所以我要像这样填充身体反应。</p><p id="bafc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我正在使用我的电子邮件，请确保您使用的电子邮件属于您并已在 MongoDB 中注册。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qm"><img src="../Images/649528663975c93c08b03fc823dec707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YeR_rXD86zPPVJ6S0Dg1NA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">忘记密码正文</figcaption></figure><p id="f21f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在你填写完你的电子邮件后，点击<strong class="kb io">发送</strong>按钮就可以看到结果了。对了，结果是这样的。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qn"><img src="../Images/6c2319e99843cc13890ba10ca3f7398c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JrCTqFzgG-J4JrAzbHbaqw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">忘记密码结果</figcaption></figure><p id="b155" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">好的，和<strong class="kb io">验证</strong>一样。区别在于<strong class="kb io">型</strong>键，也就是<strong class="kb io">忘记密码</strong>。同样，该响应的令牌将用于<strong class="kb io">重置密码。</strong></p><p id="8859" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就像我说的，你可以做一个可重用的函数来提高效率，但是，我这么做是为了让你简单理解。代码非常简单明了。</p><p id="ee72" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我们继续<strong class="kb io">之前，请确保您复制了忘记密码响应</strong>中的令牌。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="72c9" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">设置重置密码</h1><p id="1ee5" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">好了，我们到达了最后一个终点，多么激动啊！正如上面的标题，我们要做一个<strong class="kb io">重置密码</strong>。</p><h2 id="e5cd" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">27.更新 ForgotPasswordController.js</h2><p id="3e73" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">我还在我们刚刚制作的<strong class="kb io">forgotpasswordcontroller . js</strong>中，我将把这段代码添加到下面导出的<strong class="kb io">忘记了</strong>方法中。</p><p id="8452" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">首先，你必须先导入<strong class="kb io"> bcrypt </strong>包，把它放在这行的顶部</p><pre class="ot ou ov ow gt ox oy oz pa aw pb bi"><span id="5e6e" class="np lx in oy b gy pc pd l pe pf">const bcrypt = require("bcryptjs");</span></pre><p id="3be5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您可以开始编写<strong class="kb io"> reset </strong>方法代码。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">忘记密码控制器，最后一次进场。</figcaption></figure><p id="105f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">好的，让我们重复上面发生的事情。</p><ul class=""><li id="c46a" class="mu mv in kb b kc kd kg kh kk oq ko or ks os kw pg nc nd ne bi translated">发送忘记密码的验证数据。</li><li id="616a" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">方法是<strong class="kb io">POST</strong>at(<strong class="kb io"><em class="of">API/密码/重置)</em> </strong>。</li><li id="0d18" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">用户可以公开访问。</li><li id="10d8" class="mu mv in kb b kc nf kg ng kk nh ko ni ks nj kw pg nc nd ne bi translated">端点有一个名为<strong class="kb io">令牌</strong>和<strong class="kb io">密码</strong>的主体请求。</li></ul><p id="73f2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">而且实际上，应该说流程类似于<strong class="kb io">验证</strong>。但这是为了重置密码，方法是<strong class="kb io"> POST </strong>。希望这有意义。</p><h2 id="b0cc" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">28.更新 forgotPassword.js 路线</h2><p id="c4b4" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">当然，为了让控制器工作，我们必须更新我们的路线。这是代码。顺便贴一下完整的<strong class="kb io"> forgotPassword.js </strong>路线。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">忘记密码路线</figcaption></figure><h1 id="0091" class="lw lx in bd ly lz nk mb mc md nl mf mg mh nm mj mk ml nn mn mo mp no mr ms mt bi translated">测试重置密码</h1><p id="256d" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">还是用<strong class="kb io">邮差</strong>，下面是测试结果。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qo"><img src="../Images/de636a74b1212d558c573178f0ef330f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSrBct3AN0rFZ52bbobKIg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">重置密码正文</figcaption></figure><p id="860a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如您所见，您必须从<strong class="kb io">忘记密码</strong>端点复制验证令牌，并将令牌粘贴到那里，您也可以在那里传递您的新密码。</p><p id="0662" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，只需点击<strong class="kb io">发送</strong>按钮，结果如下。</p><figure class="ot ou ov ow gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi qp"><img src="../Images/3bb4b8f3b35126e7657a5a75a2391767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXPmcjoobTR7_u5bTPyVmw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">重置密码结果</figcaption></figure><p id="20e3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">还有就是，你最后更新你的密码，你可以用新密码登录。</p><p id="6204" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">其实这里是<strong class="kb io">forgotpasswordcontroller . js</strong>的完整代码。</p><figure class="ot ou ov ow gt jo"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">完整的 ForgotPasswordController.js</figcaption></figure><h2 id="a614" class="np lx in bd ly nq nr dn mc ns nt dp mg kk nu nv mk ko nw nx mo ks ny nz ms oa bi translated">ForgotPasswordController 的结论</h2><p id="12bb" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">好的，顺便说一下，在<strong class="kb io">中，ForgotPasswordController </strong>是不言自明的。但是<strong class="kb io"> ForgotPassword </strong>的核心概念仅仅是重置你的账户密码而已。</p><p id="3a6a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我在代码中加入了很多注释，这样你就能明白发生了什么。当然，如果你愿意，你可以删除那些评论。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="4bfb" class="lw lx in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated"><strong class="ak">结论</strong></h1><p id="beb7" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk ob km kn ko oc kq kr ks od ku kv kw ig bi translated">就是这样，多好玩啊！我希望你一直陪着我，直到这篇文章结束。</p><p id="8cf1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">阅读完本文后，您应该理解身份验证是如何工作的。</p><p id="b20b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">顺便问一下，为什么我不创建<strong class="kb io">注销</strong>？那是因为我们用的是<strong class="kb io"> JWT </strong>，JWT 不能显式过期！为了处理这个问题，我将 JWT 的寿命设置为 3600 毫秒，也就是 1 小时。你可以看到位于<strong class="kb io">登录</strong>方法末尾的<strong class="kb io"> AuthController.js </strong>中的代码。</p><p id="a267" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你想让这个样板/启动程序更灵活、更容易使用，你可以在这里给我的 repo 投稿。</p><div class="kx ky gp gr kz la"><a href="https://github.com/hudaprs/be_full_auth_express" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd io gy z fp lf fr fs lg fu fw im bi translated">hudaprs/be_full_auth_express</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">使用 expressJS 进行完全认证。通过在…上创建帐户，为 hudaprs/be_full_auth_express 开发做出贡献</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">github.com</p></div></div><div class="lj l"><div class="qq l ll lm ln lj lo jt la"/></div></div></a></div><p id="279e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就这样吧，希望大家喜欢，喜欢就留个掌声。如果你有一些问题，请不要犹豫，写在讨论中。下一篇文章再见。</p></div></div>    
</body>
</html>