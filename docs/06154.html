<html>
<head>
<title>React 18: Automatic Batching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ååº” 18:è‡ªåŠ¨é…æ–™</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/react-18-automatic-batching-2f5d691b4f19?source=collection_archive---------7-----------------------#2021-12-17">https://blog.devgenius.io/react-18-automatic-batching-2f5d691b4f19?source=collection_archive---------7-----------------------#2021-12-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7cab3006c472776de3dc954a1eec822c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J3_GUEixVspgxT63.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">ååº” 18:è‡ªåŠ¨é…æ–™</figcaption></figure><p id="06c2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">æˆ‘ç›¸ä¿¡æ‚¨è¿‡å»å¬è¯´è¿‡â€œååº”æ‰¹å¤„ç†â€è¿™ä¸ªæœ¯è¯­ï¼Œå¯èƒ½æ‚¨(å’Œæˆ‘ä¸€æ ·)å¯¹å®ƒçš„å«ä¹‰å’Œå®é™…ç”¨é€”æ„Ÿåˆ°å›°æƒ‘ã€‚</p><p id="4a71" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">åœ¨ç»§ç»­è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨æŸ¥çœ‹äº†æˆ‘çš„ä¸ªäººç½‘ç«™ï¼Œå¹¶è®¢é˜…äº†æˆ‘çš„åšå®¢ï¼Œæˆ‘ä¼šåœ¨é‚£é‡Œå‘å¸ƒæ›´å¤šç±»ä¼¼è¿™æ ·çš„å†…å®¹:<a class="ae ky" href="https://tasoskakour.com/" rel="noopener ugc nofollow" target="_blank"><em class="kx">https://tasoskakour.com</em></a><em class="kx">ã€‚</em></p><p id="b519" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä¸€èˆ¬æ¥è¯´ï¼Œå•è¯<em class="kx">æ‰¹å¤„ç†</em>å¯ä»¥ä»¥å¤šç§æ–¹å¼ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬çš„ç”¨ä¾‹æœ‰æ„ä¹‰çš„ä¸€èˆ¬å®šä¹‰å¯ä»¥è¡¨è¾¾ä¸º:</p><blockquote class="kz la lb"><p id="0026" class="jz ka kx kb b kc kd ke kf kg kh ki kj lc kl km kn ld kp kq kr le kt ku kv kw ig bi translated"><em class="in">ä½œä¸ºè®¡ç®—æœºå¤„ç†å•å…ƒçš„ä¸€ç»„ä½œä¸šã€æ•°æ®æˆ–ç¨‹åºã€‚</em></p><p id="8a42" class="jz ka kx kb b kc kd ke kf kg kh ki kj lc kl km kn ld kp kq kr le kt ku kv kw ig bi translated"><em class="in">(æ‰¹å¤„ç†)æ•°æ®å¤„ç†çš„ä¸€ç§å½¢å¼ï¼Œåœ¨åŒä¸€æœºå™¨è¿è¡ŒæœŸé—´ï¼Œè®¸å¤šè¾“å…¥ä½œä¸šè¢«åˆ†ç»„å¤„ç†ã€‚</em></p></blockquote><h1 id="9491" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ä»€ä¹ˆæ˜¯ååº”é…æ–™</h1><p id="9bb1" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">åŸºæœ¬ä¸Šï¼Œå½“ React åº”ç”¨â€œæ‰¹å¤„ç†â€æ—¶ï¼Œè¿™æ„å‘³ç€å®ƒ<strong class="kb io">å°†å¤šä¸ªçŠ¶æ€æ›´æ–°ç»„åˆæˆä¸€ä¸ªå•ä¸€çš„é‡æ–°æ¸²æŸ“</strong>ä¸»è¦æ˜¯ä¸ºäº†æ›´å¥½çš„æ€§èƒ½ã€‚</p><p id="1f17" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">åœ¨ React 17 å’Œä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒReact åªåœ¨ React äº‹ä»¶å¤„ç†ç¨‹åºä¸­è‡ªåŠ¨æ‰¹å¤„ç†ä»»ä½•çŠ¶æ€æ›´æ–°<strong class="kb io">(å°±åƒ<em class="kx">ç‚¹å‡»</em>æˆ–<em class="kx">æ”¹å˜</em>)ã€‚</strong></p><p id="1174" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼ŒçŒœçŒœ<code class="fe mi mj mk ml b">handleClick</code>å‡½æ•°ä¼šå¯¼è‡´å¤šå°‘æ¬¡é‡æ–°æ¸²æŸ“ï¼Ÿ</p><p id="66a6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä¹Ÿä¸ç”¨æ‹…å¿ƒ<code class="fe mi mj mk ml b">useRenderCount</code>åŠŸèƒ½ã€‚è¿™åªæ˜¯ä¸€ä¸ªç”¨æ¥è®¡ç®—é‡æ¸²æŸ“æ¬¡æ•°çš„è‡ªå®šä¹‰é’©å­:-)</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="a470" class="mu lg in ml b gy mv mw l mx my">const useRenderCount = () =&gt; {<br/>  const renderCounter = useRef(0); <br/>  useLayoutEffect(() =&gt; {<br/>    renderCounter.current++;<br/>  });<br/>  return renderCounter.current;<br/>};</span></pre><p id="fc00" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å®é™…æ¼”ç¤º:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="8e85" class="mu lg in ml b gy mv mw l mx my">const Demo1 = () =&gt; {<br/>    const renderCount = useRenderCount(); // we use this to count re-renders<br/>    const [countUp, setCountUp] = useState(0);<br/>    const [countDown, setCountDown] = useState(0);<br/><br/>    const handleClick = () =&gt; {<br/>        setCountUp((cUp) =&gt; cUp + 1);<br/>        setCountDown((cDown) =&gt; cDown - 1);<br/>    };<br/><br/>    return (<br/>        &lt;div style={{ textAlign: "center" }}&gt;<br/>            &lt;h4&gt;Demo 1 (Batching)&lt;/h4&gt;<br/>            &lt;button onClick={handleClick}&gt;Click me&lt;/button&gt;<br/>            &lt;h2&gt;Count up: {countUp}&lt;/h2&gt;<br/>            &lt;h2&gt;Count down: {countDown}&lt;/h2&gt;<br/>            &lt;div&gt;Number of rerenders: {renderCount}&lt;/div&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/93fecaccba5c74bb0d61ba2206a4099f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cVErzMYoIg7_P_tf.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">æ¼”ç¤º 1: React äº‹ä»¶å¤„ç†ç¨‹åºè¢«æˆåŠŸæ‰¹å¤„ç†ã€‚</figcaption></figure><p id="9d90" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">æ²¡é”™ï¼Œå®ƒåªä¼šå¯¼è‡´<strong class="kb io">ä¸€ä¸ª</strong>é‡æ–°æ¸²æŸ“ï¼Œå› ä¸º React ä¼šæŠŠä¸¤ä¸ªçŠ¶æ€æ›´æ–°<code class="fe mi mj mk ml b">setCountUp</code>å’Œ<code class="fe mi mj mk ml b">setCountDown</code>æ‰¹å¤„ç†æˆä¸€ä¸ªï¼</p><p id="efba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">å¾ˆé…·å§ï¼ŸReact å°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬å¤„ç†è¿™äº›é—®é¢˜ï¼Œå¹¶é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œè¿™å¯¹æ€§èƒ½éå¸¸å¥½ï¼æ­¤å¤–ï¼Œå®ƒå°†é˜²æ­¢æˆ‘ä»¬çš„ç»„ä»¶å‘ˆç°â€œåŠæˆå“â€çŠ¶æ€ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡è¢«æ›´æ–°ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚</p><h1 id="c564" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">âœ‹:ä½†æ˜¯â€¦â€¦æœ‰ä¸€ä¸ªé—®é¢˜</h1><p id="374b" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated"><strong class="kb io"> React(ç‰ˆæœ¬ 18 ä¹‹å‰)åªä¼šæ‰¹é‡ React äº‹ä»¶å¤„ç†ç¨‹åºã€‚å®ƒä¸ä¼šæ‰¹é‡æ›´æ–° promisesã€setTimeoutã€æœ¬æœºäº‹ä»¶å¤„ç†ç¨‹åºæˆ–ä»»ä½•å…¶ä»–äº‹ä»¶ã€‚</strong></p><p id="c206" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæœ‰è®¸å¤šç”¨ä¾‹éœ€è¦æ›´æ–° React ä¸èƒ½æ‰¹å¤„ç†çš„å¤„ç†ç¨‹åºä¸­çš„å¤šä¸ªçŠ¶æ€ã€‚</p><p id="d673" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¸€äº›ä¾‹å­ï¼ŒReact ä¸ä¼šæ‰¹é‡æ›´æ–°ï¼Œå®ƒä¼šå¯¼è‡´å¤šæ¬¡é‡æ–°æ¸²æŸ“ã€‚</p><h2 id="87dc" class="mu lg in bd lh na nb dn ll nc nd dp lp kk ne nf lt ko ng nh lx ks ni nj mb nk bi translated">setTimeout å†…éƒ¨çš„æ›´æ–°</h2><p id="367e" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">åœ¨ä¸‹é¢çš„æ¼”ç¤ºä¸­ï¼Œ<code class="fe mi mj mk ml b">setCountUp</code>å’Œ<code class="fe mi mj mk ml b">setCountDown</code>å°†å¯¼è‡´<strong class="kb io">ä¸¤ä¸ª</strong>é‡æ–°æ¸²æŸ“ï¼Œå› ä¸º React æ— æ³•åœ¨<code class="fe mi mj mk ml b">setTimeout</code>å›è°ƒä¸­æ‰¹é‡å¤„ç†å¤šä¸ªæ›´æ–°ã€‚</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="dcca" class="mu lg in ml b gy mv mw l mx my">const Demo2 = () =&gt; {<br/>  const renderCount = useRenderCount();<br/>  const [countUp, setCountUp] = useState(0);<br/>  const [countDown, setCountDown] = useState(0);<br/><br/>  const handleClick = () =&gt; {<br/>    setTimeout(() =&gt; {<br/>      setCountUp((cUp) =&gt; cUp + 1);<br/>      setCountDown((cDown) =&gt; cDown - 1);<br/>    }, 500);<br/>  };<br/><br/>  return (<br/>    &lt;div className="Demo"&gt;<br/>      &lt;h4&gt;Demo 2 (setTimeout)&lt;/h4&gt;<br/>      &lt;button onClick={handleClick}&gt;Click me&lt;/button&gt;<br/>      &lt;h2&gt;Count up: {countUp}&lt;/h2&gt;<br/>      &lt;h2&gt;Count down: {countDown}&lt;/h2&gt;<br/>      &lt;div&gt;Number of rerenders: {renderCount}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/e0044c6c42e39b4e791ae463473e2cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tuDiLt65CWXeFVKt.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">æ¼”ç¤º 2:ååº”(&lt;17) is not able to batch setTimeout callbacks.</figcaption></figure><h2 id="bd83" class="mu lg in bd lh na nb dn ll nc nd dp lp kk ne nf lt ko ng nh lx ks ni nj mb nk bi translated">2) Updates inside a promise</h2><p id="8a51" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">In the example below we fetch a random cat image when the button is clicked. React cannot batch the multiple state updates thatâ€™s after the  ã€T0ã€‘  fetch call, specifically the  ã€T1ã€‘  and  ã€T2ã€‘ .</p><p id="8633" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">However, it successfully batches the first two calls before the await:  ã€T3ã€‘  and  ã€T4ã€‘ .</p><p id="c786" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">So in total the  ã€T5ã€‘  function will cause 3 re-renders.</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="83fa" class="mu lg in ml b gy mv mw l mx my">const Demo3 = () =&gt; {<br/>  const renderCount = useRenderCount();<br/>  const [loading, setLoading] = useState(false);<br/>  const [cat, setCat] = useState(null);<br/><br/>  const handleClick = async () =&gt; {<br/>    // these two below will be batched<br/>    setLoading(true);<br/>    setCat(null);<br/>    const response = await fetch("https://thatcopy.pw/catapi/rest/");<br/>    if (response.ok) {<br/>      const json = await response.json();<br/>      setCat(json.url); // cannot batch<br/>    }<br/>    setLoading(false); // cannot batch<br/>  };<br/><br/>  return (<br/>    &lt;div className="Demo"&gt;<br/>      &lt;h4&gt;Demo 3 (Promise)&lt;/h4&gt;<br/>      &lt;button onClick={handleClick}&gt;Click me&lt;/button&gt;<br/>      &lt;h2&gt;Loading: {String(loading)}&lt;/h2&gt;<br/>      &lt;h2<br/>        style={{<br/>          display: "flex",<br/>          justifyContent: "center",<br/>          alignItems: "center"<br/>        }}<br/>      &gt;<br/>        Cat:{" "}<br/>        {cat ? (<br/>          &lt;img<br/>            alt="cat"<br/>            width="35"<br/>            height="35"<br/>            src={cat}<br/>            style={{ marginLeft: "8px" }}<br/>          /&gt;<br/>        ) : (<br/>          ""<br/>        )}<br/>      &lt;/h2&gt;<br/>      &lt;div&gt;Number of rerenders: {renderCount}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/eb77395de1b485cd9888d6e985cb3e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NnXOo-WX6aWIi_de.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">Demo 3: React (&lt;17) is not able to batch promises.</figcaption></figure><h2 id="6abd" class="mu lg in bd lh na nb dn ll nc nd dp lp kk ne nf lt ko ng nh lx ks ni nj mb nk bi translated">3) Updates inside a native event handler</h2><p id="35d8" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">In the example below we use a native event handler by attaching a  ã€T6ã€‘  listener to our button. React is not able to batch these multiple state updates as well.</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="4ad7" class="mu lg in ml b gy mv mw l mx my">const Demo4 = () =&gt; {<br/>  const renderCount = useRenderCount();<br/>  const [countUp, setCountUp] = useState(0);<br/>  const [countDown, setCountDown] = useState(0);<br/><br/>  useEffect(() =&gt; {<br/>    const handleClick = () =&gt; {<br/>      setCountUp((cUp) =&gt; cUp + 1);<br/>      setCountDown((cDown) =&gt; cDown - 1);<br/>    };<br/><br/>    const element = document.querySelector("#my-button");<br/>    element.addEventListener("click", handleClick);<br/><br/>    return () =&gt; {<br/>      element.removeEventListener('click', handleClick);<br/>    };<br/>  }, []);<br/><br/>  return (<br/>    &lt;div className="Demo"&gt;<br/>      &lt;h4&gt;Demo 4 (Native event handler)&lt;/h4&gt;<br/>      &lt;button id="my-button"&gt;Click me&lt;/button&gt;<br/>      &lt;h2&gt;Count up: {countUp}&lt;/h2&gt;<br/>      &lt;h2&gt;Count down: {countDown}&lt;/h2&gt;<br/>      &lt;div&gt;Number of rerenders: {renderCount}&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/5613a83250a39c07910e93517a0047c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D3Jf8UL1_kDYl865.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">React (&lt;17) is not able to batch native event handlers.</figcaption></figure><h2 id="eb93" class="mu lg in bd lh na nb dn ll nc nd dp lp kk ne nf lt ko ng nh lx ks ni nj mb nk bi translated">ğŸ’¡ Quick fix to the above scenarios</h2><p id="3f0c" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">Obviously, a fix to the above scenarios would be to store all the â€œindividualâ€ states to a big state (or use a useReducer).</p><p id="e87a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">For example, the Demo with the fetch promise could be written as shown below in order to prevent unwanted re-renders:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="4a1f" class="mu lg in ml b gy mv mw l mx my">const Demo3Fix = () =&gt; {<br/>  const renderCount = useRenderCount();<br/>  const [state, setState] = useState({<br/>    loading: false,<br/>    cat: null<br/>  }); // a single state object<br/><br/>  const handleClick = async () =&gt; {<br/>    setState({<br/>      loading: true,<br/>      cat: null<br/>    }); // 1st re-render<br/>    const response = await fetch("https://thatcopy.pw/catapi/rest/");<br/>    if (response.ok) {<br/>      const json = await response.json();<br/>      setState((s) =&gt; ({ cat: json.url, loading: false })); // 2nd re-render<br/>    } else {<br/>      setState((s) =&gt; ({ ...s, loading: false })); // or this 2nd re-render<br/>    }<br/>  };<br/><br/>  const { cat, loading } = state;<br/><br/>  return (<br/>    ...<br/>  );<br/>};</span></pre><p id="c546" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">â¡ï¸ All the previous React 17 demos are available in this CodeSandbox: <a class="ae ky" href="https://codesandbox.io/s/cranky-mccarthy-g5ntm" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/cranky-mccarthy-g5ntm</a></p><h1 id="161b" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">å¯¹æ•‘æ´åšå‡ºååº” 18ğŸ‰</h1><p id="8f34" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">React 18 ä¸ºæ‰€æœ‰ç”¨ä¾‹æ·»åŠ äº†è‡ªåŠ¨æ‰¹å¤„ç†ï¼Œä»¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤š<a class="ae ky" href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html" rel="noopener ugc nofollow" target="_blank"/>ã€‚å®ƒä»å¤„äºæµ‹è¯•é˜¶æ®µã€‚</p><p id="4a95" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">è¿™æ„å‘³ç€å¯¹äºæˆ‘ä»¬ä¹‹å‰æ‰€æœ‰ä¾‹å­ä¸­çš„<strong class="kb io">æ¥è¯´ï¼ŒReact (18)ä¼šè‡ªåŠ¨å°†å¤šä¸ªçŠ¶æ€æ›´æ–°æ‰¹å¤„ç†æˆä¸€ä¸ªæ›´æ–°ã€‚</strong></p><p id="1e8b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä¸ºäº†è¯æ˜ï¼Œçœ‹çœ‹ä¸‹é¢çš„<em class="kx"> setTimeout </em>æ¼”ç¤ºï¼Œæˆ‘ä»¬å”¯ä¸€æ”¹å˜çš„æ˜¯ React åˆ° 18 çš„ç‰ˆæœ¬å’Œ<code class="fe mi mj mk ml b">index.js</code>å†…çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨é‚£é‡ŒæŒ‡ç¤º React å¦‚ä½•åŠ è½½æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚å…·ä½“æ¥è¯´ï¼Œä¸ºäº†è®© React 18 åˆ©ç”¨è¿™äº›æ–°ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨<code class="fe mi mj mk ml b">createRoot</code> apiã€‚</p><p id="1767" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mi mj mk ml b">index.js</code>åœ¨ React 17:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="bb83" class="mu lg in ml b gy mv mw l mx my">import { render } from "react-dom";<br/>import App from "./App";<br/><br/>render(&lt;App /&gt;, document.getElementById("root"));</span></pre><p id="b083" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mi mj mk ml b">index.js</code>åœ¨ React 18:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="0b5c" class="mu lg in ml b gy mv mw l mx my">import { createRoot } from "react-dom";<br/>import App from "./App";<br/><br/>createRoot(document.getElementById("root")).render(&lt;App /&gt;);</span></pre><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/69629564be1cb314a1f7ed97b61be789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pYC0RvtsFVqO6sMx.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">React 18:å®ƒè‡ªåŠ¨æ‰¹å¤„ç† setTimeout å›è°ƒï¼</figcaption></figure><p id="48f5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ä»¥ä¸‹æ˜¯ React 18 çš„æ‰€æœ‰å®éªŒä»£ç :<a class="ae ky" href="https://codesandbox.io/s/objective-elbakyan-6u76m" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/objective-elbakyan-6u76m</a></p><h1 id="d0f5" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ä¸æƒ³æ‰¹æ€ä¹ˆåŠï¼Ÿ</h1><p id="6d6b" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">å¯èƒ½æœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸å¸Œæœ› React æ‰¹é‡æ›´æ–°(å°½ç®¡é€šå¸¸è®¤ä¸ºæ‰¹å¤„ç†æ˜¯å®‰å…¨çš„)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„<code class="fe mi mj mk ml b">flushSync</code>å‡½æ•°æ¥å®ç°:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="c94b" class="mu lg in ml b gy mv mw l mx my">import { flushSync } from 'react-dom'; <br/><br/>const handleClick = () =&gt; {<br/>  flushSync(() =&gt; {<br/>    setCountUp((cUp) =&gt; cUp + 1);  // 1st re-render <br/>  })<br/>  flushSync(() =&gt; { <br/>    setCountDown((cDown) =&gt; cDown - 1); // 2nd re-render<br/>  })  <br/>};</span></pre><p id="be41" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ React 18 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å¦‚ä¸‹æœªè®°å½•çš„ API <code class="fe mi mj mk ml b">unstable_batchedUpdates</code>æ¥å¼ºåˆ¶æ‰¹å¤„ç† React äº‹ä»¶å¤„ç†ç¨‹åºä¹‹å¤–çš„çŠ¶æ€æ›´æ–°:</p><pre class="mm mn mo mp gt mq ml mr ms aw mt bi"><span id="6255" class="mu lg in ml b gy mv mw l mx my">unstable_batchedUpdates(() =&gt; {<br/>  // these 2 below will be batched<br/>  setCountUp((cUp) =&gt; cUp + 1);<br/>  setCountDown((cDown) =&gt; cDown - 1);<br/>});</span></pre><p id="d7c7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">æ ¹æ®æ–‡æ¡£ï¼Œè¿™ä¸ª API åœ¨ 18 ä¸­ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å·²ç»æ²¡æœ‰å¿…è¦äº†ï¼Œå› ä¸ºæ‰¹å¤„ç†æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå®ƒä¹Ÿå¯èƒ½è¢«åˆ é™¤ã€‚</p><h1 id="e1c2" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç»“æŸäº†</h1><p id="6260" class="pw-post-body-paragraph jz ka in kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ig bi translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå›å¤´è§ï¼ğŸ˜ƒ</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><p id="7c5b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="kx">æœ€åˆå‘è¡¨äº</em><a class="ae ky" href="https://tasoskakour.com/blog/react-18-automatic-batching" rel="noopener ugc nofollow" target="_blank">T5ã€https://tasoskakour.comã€‘</a><em class="kx">ã€‚</em></p></div></div>    
</body>
</html>