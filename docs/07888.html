<html>
<head>
<title>Adding a Graphql endpoint to an existing RESTful NodeJs [express] Backend with Multiple Database —</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Graphql 终结点添加到现有 RESTful 节点 Js [express]具有多个数据库的后端——</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/adding-a-graphql-endpoint-to-an-existing-restful-nodejs-express-backend-with-multiple-databases-b7cd309b84e9?source=collection_archive---------7-----------------------#2022-04-30">https://blog.devgenius.io/adding-a-graphql-endpoint-to-an-existing-restful-nodejs-express-backend-with-multiple-databases-b7cd309b84e9?source=collection_archive---------7-----------------------#2022-04-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/827b01e9800655a6a694800131ccdf07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxU_uBEwj1CbTbyLDdZZUA.png"/></div></div></figure><p id="c453" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你正在阅读这篇文章，它的意思是，你正在研究 POC(概念证明)或试图实现这一点…</p><p id="f2ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在实现它的情况下，我假设您已经了解了 Graphql 中 typeDefs 和解析器的非常基本的概念，可以更改与 JS 相关的源代码以适应您的需求，最后为下面列出的 npm 包选择适当的版本以支持您的节点版本、开发环境等</p><blockquote class="kt ku kv"><p id="1329" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">我喜欢把事情做得尽可能的短，所以恰到好处的部分你需要重点关注…</p></blockquote></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h2 id="8542" class="lh li in bd lj lk ll dn lm ln lo dp lp kg lq lr ls kk lt lu lv ko lw lx ly lz bi translated">简而言之，这是直接和可能的，假设你对我正在使用的包是 OK 的，或者可以根据你的特定包/要求来编辑代码——</h2><ol class=""><li id="4f47" class="ma mb in jx b jy mc kc md kg me kk mf ko mg ks mh mi mj mk bi translated">GraphQL 服务器</li></ol><ul class=""><li id="3e8f" class="ma mb in jx b jy jz kc kd kg ml kk mm ko mn ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/apollo-server-express" rel="noopener ugc nofollow" target="_blank"><em class="kw">Apollo-server-express</em></a><em class="kw">(</em><a class="ae mp" href="https://www.apollographql.com/docs/apollo-server/integrations/middleware#basic-usage" rel="noopener ugc nofollow" target="_blank"><em class="kw">也有其他的根据你的使用情况</em> </a> <em class="kw"> ) </em></li></ul><p id="9bd8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.Graphql 本身</p><ul class=""><li id="e5b8" class="ma mb in jx b jy jz kc kd kg ml kk mm ko mn ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/graphql" rel="noopener ugc nofollow" target="_blank"> <em class="kw"> graphql </em> </a></li><li id="15a6" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/graphql-parse-fields" rel="noopener ugc nofollow" target="_blank"><em class="kw">graphql-parse-field</em></a><em class="kw">(可选)</em></li></ul><p id="92ad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.一个 ORM(与 ORM 或 DB 相关的东西可能因人而异+有可能你必须修改旅游源代码来满足你的需求)。这些将在你的依赖套件挖掘的情况下起作用</p><ul class=""><li id="688c" class="ma mb in jx b jy jz kc kd kg ml kk mm ko mn ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/sequelize" rel="noopener ugc nofollow" target="_blank"> <em class="kw">续</em> </a></li><li id="c5c3" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/sequelize-auto" rel="noopener ugc nofollow" target="_blank"><em class="kw">sequelize-auto</em></a><em class="kw">(可选)</em></li><li id="8d63" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/sequelize-cli" rel="noopener ugc nofollow" target="_blank"><em class="kw">sequelize-CLI</em></a><em class="kw">(可选)——使用它自动生成代码，创建所有基于 sequelize 的表目标代码(我们管它叫什么，因为我现在不记得了)</em></li></ul><p id="3304" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">4.因为我使用 mysql 作为数据库(你可能不需要它)</p><ul class=""><li id="9964" class="ma mb in jx b jy jz kc kd kg ml kk mm ko mn ks mo mi mj mk bi translated"><a class="ae mp" href="https://www.npmjs.com/package/mysql2" rel="noopener ugc nofollow" target="_blank">MySQL 2</a>(sex Elize 依赖于此)</li></ul></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h2 id="3d01" class="lh li in bd lj lk ll dn lm ln lo dp lp kg lq lr ls kk lt lu lv ko lw lx ly lz bi translated">步骤和诀窍(简介)—</h2><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/fd325c360202d3d9f85a1db840ddd847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BT60RdO4JbEmEAwnE4cKvg.png"/></div></div></figure><ol class=""><li id="8783" class="ma mb in jx b jy jz kc kd kg ml kk mm ko mn ks mh mi mj mk bi translated">我们需要建立一个 ORM，尽管这不是必需的，它将极大地帮助我们进行代码抽象，从而帮助我们提高代码的可读性</li><li id="bb74" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mh mi mj mk bi translated">我们正在遵循这个文件夹格式，以帮助我们目前的可伸缩性，这有助于我们与不同的 graphql 端点专用于不同的数据库</li><li id="af10" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mh mi mj mk bi translated">初始化 graphql 服务器并将不同的类型定义、解析器、上下文附加到每个特定的数据库</li><li id="a37f" class="ma mb in jx b jy mq kc mr kg ms kk mt ko mu ks mh mi mj mk bi translated">向查询调用添加 auth，因为我们不想公开这些</li></ol></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h1 id="bcb5" class="na li in bd lj nb nc nd lm ne nf ng lp nh ni nj ls nk nl nm lv nn no np ly nq bi translated">设置 ORM(您可以跳过这一步，但是一定要回来继续，以便修改 apollo 初始化函数来适应您的需求)</h1><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/c25ba8dfdda9340e530f76e84baee145.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*iYN9FHti7AUJa2KsVbg4lQ.png"/></div></figure><blockquote class="kt ku kv"><p id="9da9" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">这是我们当前的结构，帮助我们初始化更多的数据库/模型/表，并在代码库中用每个数据库/模型/表的一个 ApolloServer 水平地(逻辑地)扩展它们</p></blockquote><p id="f806" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">/序列化</strong></p><p id="dac8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">……/config</strong><br/>……/config . database 1 . js<br/>……/config。&lt;你的数据库名&gt;。射流研究…</p><p id="51c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">……/helpers</strong><br/>……/resolvers . js(我正在使用的通用解析器代码，如果您已经创建了所有必要的 db 调用，您可能不需要这个特定的代码)</p><p id="427b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">……/models</strong>(特定于 sequelize)<br/><strong class="jx io">……/&lt;YOUR DATABASE _ 1 NAME&gt;</strong><br/>………/index . js(init function-same-要包含在每个数据库文件夹中)<br/> ………/init-models(特定于 sequelize)<br/>……/&lt;另一个表名&gt;。js <br/> <strong class="jx io"> ……/ &lt;你的数据库 _2 名称&gt;</strong><br/>………/index . js<br/>………/init-models<br/>………/&lt;表名&gt;。射流研究…</p><h2 id="caa8" class="lh li in bd lj lk ll dn lm ln lo dp lp kg lq lr ls kk lt lu lv ko lw lx ly lz bi translated">有点简短-</h2><p id="f6d8" class="pw-post-body-paragraph jv jw in jx b jy mc ka kb kc md ke kf kg ns ki kj kk nt km kn ko nu kq kr ks ig bi translated">我们使用 index.js 文件(对于每个数据库文件夹都是一样的)来导入所有 js 文件并初始化 sequelize 对象。因此<strong class="jx io">require('/sequel ize/models/&lt;database 1&gt;')</strong>将返回一个 DB 对象，其中包含<strong class="jx io"> database1 </strong>的所有表。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h1 id="91ce" class="na li in bd lj nb nc nd lm ne nf ng lp nh ni nj ls nk nl nm lv nn no np ly nq bi translated">设置 GraphQL 相关的东西</h1><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e794b25f1692f368e34a79ed475a21fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*nGBr4bLNwCmjmxc9BYYYcA.png"/></div></figure><h2 id="84ef" class="lh li in bd lj lk ll dn lm ln lo dp lp kg lq lr ls kk lt lu lv ko lw lx ly lz bi translated">首先是文件夹结构</h2><blockquote class="kt ku kv"><p id="dc7c" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">这是我们当前的结构，帮助我们初始化更多的 typedef/resolver，并使用 ApolloServer 在代码库中对每个数据库/模型/表进行水平(逻辑)扩展</p></blockquote><p id="2d2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> /graphql </strong></p><p id="37c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">……/&lt;您的数据库名称&gt;</strong><br/><strong class="jx io">……/解析器</strong><br/>……/&lt;表 1 &gt;。js<br/>…………/&lt;表 2 &gt;。js<strong class="jx io"><br/>……/typeDefs</strong><br/>……/&lt;表 1 &gt;。图表 QL<br/>…………/&lt;表 2 &gt;。graphql</p><h2 id="faef" class="lh li in bd lj lk ll dn lm ln lo dp lp kg lq lr ls kk lt lu lv ko lw lx ly lz bi translated">简要描述</h2><p id="6f3d" class="pw-post-body-paragraph jv jw in jx b jy mc ka kb kc md ke kf kg ns ki kj kk nt km kn ko nu kq kr ks ig bi translated">我还分享了这段代码，它支持<br/>——嵌套查询，在嵌套部分有额外的参数(使用/sequel ize/helper/resolvers . js)<br/>——避免过度提取列</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/fbe459ccdabee00b6253ab286834a729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAxbZqziw9ujuGoFeTYIYw.png"/></div></div></figure><p id="08b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">—供参考的类型定义</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/3926ff1348d1b3c0112e510f7fb138ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*3mBqP5PIdMVCsNzHTStUeg.png"/></div></figure><p id="94f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">—安慰 apolloserver 初始化过程</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/2a6563705ede9400f2b523b83a362735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*taYW2qpRBbsdGoVgTngaAw.png"/></div></div></figure><p id="390f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">—已执行内部 sql 查询</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/844e59122879c99140b1add4f1d78ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6L8MOV5DrY1NgoWwi8Fc5A.png"/></div></div></figure></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><h1 id="302b" class="na li in bd lj nb nc nd lm ne nf ng lp nh ni nj ls nk nl nm lv nn no np ly nq bi translated">现在简单地理解—</h1><p id="b2ca" class="pw-post-body-paragraph jv jw in jx b jy mc ka kb kc md ke kf kg ns ki kj kk nt km kn ko nu kq kr ks ig bi translated"><a class="ae mp" href="https://github.com/ahrenpradhan/addGraphqlToExistingRestfulNodeJsBackend" rel="noopener ugc nofollow" target="_blank">GITHUB REPO—https://GITHUB . com/ahrenpradhan/addgraphqltoexistingrestfulnodejsback end</a></p><p id="dd99" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在/ <strong class="jx io"> app.js </strong>中，我们导入 apollo 初始化器，并将 app 对象作为参数传递。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/ccecaf0f179e389676bf5d9445e6b8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*AUJaEOTb6dzugy51TWEQBw.png"/></div></div></figure><p id="870d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在在<strong class="jx io"> /graphql/init.js </strong>中，我使用 fs 和 path 模块来导入所有的 typeDef、解析器和 sequelized DB 对象，根据它们各自的入门指南进行一些处理，并在 apollo 服务器函数中传递它们，以公开它(不同的 DB)自己的端点。我使用目录名来跟踪数据库名，文件名可以是除了分隔类型定义、解析器和它们的特定名称之外的任何名称。我只是使用<strong class="jx io"> /graphql/authenticate.js </strong>中的 verifyToken 函数来认证不记名令牌，按照你的要求编辑它。</p><p id="aa95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在只需按照文件夹结构添加新的数据库/表，而无需查看/编辑主初始化器。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><blockquote class="kt ku kv"><p id="2591" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">这不是最好的方法，我 100%确定有比我的更好的实现，并且可能覆盖所有你必须自己处理的用例。但我觉得我还是应该这样做，因为这是我的逻辑，我控制着它能做的一切。</p></blockquote></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><blockquote class="ob"><p id="f97a" class="oc od in bd oe of og oh oi oj ok ks dk translated">以上是我的观点，你可以随意问我任何你喜欢的问题，如果我有足够的经验，我一定会尽力帮助你。</p></blockquote></div></div>    
</body>
</html>