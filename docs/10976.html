<html>
<head>
<title>Layer-4 Load Balancers and Layer-7 Load Balancers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第 4 层负载平衡器和第 7 层负载平衡器</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/layer-4-load-balancers-and-layer-7-load-balancers-4be18abfa47b?source=collection_archive---------12-----------------------#2022-12-11">https://blog.devgenius.io/layer-4-load-balancers-and-layer-7-load-balancers-4be18abfa47b?source=collection_archive---------12-----------------------#2022-12-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="dc68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇博客讨论了第 4 层负载平衡器和第 7 层负载平衡器之间的区别。在阅读本文之前，理解网络的基本概念至关重要。</p><blockquote class="ki kj kk"><p id="6c61" class="jk jl kl jm b jn jo jp jq jr js jt ju km jw jx jy kn ka kb kc ko ke kf kg kh ig bi translated"><strong class="jm io">负载平衡</strong>指的是在一组后端服务器上有效地分配传入的网络流量，也称为<em class="in">服务器群</em>或<em class="in">服务器池</em>。现代高流量网站必须以快速、可靠的方式处理来自用户或客户端的数十万甚至数百万的并发请求，并返回正确的文本、图像、视频或应用程序数据。现代计算最佳实践通常需要添加更多服务器进行扩展，以经济高效地满足这些高容量需求。一个<strong class="jm io">负载平衡器</strong>充当您的服务器前的“交通警察”,在所有服务器之间路由客户端请求，能够以最大化速度和容量利用率的方式满足这些请求，并确保没有一个服务器超负荷工作，从而降低性能。如果一台服务器出现故障，负载平衡器会将流量重定向到其余的在线服务器。当新服务器添加到服务器组时，负载平衡器会自动发送请求。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/028cc0ab1d003cd825372e999972fd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BN3WyxHwigDwbTI7m8jGRQ.png"/></div></div></figure><p id="739f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">负载平衡器是反向代理的一个例子，其中实现了平衡逻辑。第 4 层是<a class="ae lb" href="https://www.geeksforgeeks.org/layers-of-osi-model/" rel="noopener ugc nofollow" target="_blank"> OSI 模型</a>中的传输层，第 7 层是应用层。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/b47da7b853ac7b080d3c8e88aac662a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*P6AQzxikOGgy-y-Ddy5UIA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">OSI 模型</figcaption></figure><h2 id="10f8" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated"><strong class="ak">第四层负载均衡器</strong></h2><p id="1a44" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">第 4 层负载平衡器与后端建立了连接，并将数据发送到特定请求的专用后端，并获得响应。正如我们从 OSI 模型中了解到的那样，第 4 层的端口、IP 地址和数据只是不应被触及的数据段。因此，这就像中间的一跳，根据路由请求所用的算法将请求发送到后端。这里的所有连接都是 TCP 连接，客户端连接到负载平衡器，负载平衡器连接到后端。</p><p id="ed72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">优点<br/> </strong> a)简单负载均衡:不查数据；只有端口和 IP 地址。因为它转发请求，没有数据查找，所以效率更高。更安全:同样，由于没有数据查找，它比第 7 层更安全。c)适用于任何协议:因为它不看内容，所以它是不可知的。也就是说，它发送数据并接收响应。</p><p id="c595" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> CONS </strong> : <br/> a)没有智能负载平衡:没有智能负载平衡，因为我们不看数据。任何基于数据的明智决策，比方说，对具有多个 API(其中一个 API)的后端的任何请求都是非常繁重和耗时的；它不能被隔离为一个单独的后端。<br/> b)无缓存:无数据查找，无缓存。<br/> c)它必须是粘性的，因为它是有状态协议。当建立连接时，它被发送到一个后端服务器。通过这种连接，每个数据包都被发送到一台服务器。下一个连接将根据算法选择不同的服务器。<br/> d)微服务架构实施变得非常困难。</p><h2 id="c2d2" class="lh li in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">第七层负载平衡器</h2><p id="3f03" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在第 7 层负载平衡器的情况下，负载平衡器变成特定于协议的。当客户端连接到负载平衡器时，它会尝试理解请求。所有这些都发生在 OSI 模型的第 7 层；因此，完整的请求模块是可用的。</p><blockquote class="ki kj kk"><p id="2ddf" class="jk jl kl jm b jn jo jp jq jr js jt ju km jw jx jy kn ka kb kc ko ke kf kg kh ig bi translated"><strong class="jm io">第 7 层负载平衡</strong>在高层<em class="in">应用</em>层运行，处理每条消息的实际内容。HTTP 是互联网上网站流量的主要第 7 层协议。第 7 层负载平衡器路由网络流量的方式比第 4 层负载平衡器复杂得多，尤其适用于基于 TCP 的流量，如 HTTP。第 7 层负载平衡器终止网络流量并读取其中的消息。它可以根据邮件内容(例如，URL 或 cookie)做出负载平衡决定。然后，它与选定的上游服务器建立新的 TCP 连接(或通过<a class="ae lb" href="https://www.nginx.com/blog/http-keepalives-and-web-performance/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">HTTP keepalives</strong></a>重用现有的连接)，并将请求写入服务器。</p></blockquote><p id="be43" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">优点</strong> : <br/> a)智能负载平衡:因为我们这里有最终数据，所以我们可以相应地了解负载平衡。比如我们要去/v1/posts，就去后端那个；如遇/v1/评论，去后端二；而在/v1/messages 的情况下，转到后端三。<br/> b)缓存:由于数据可用<br/> c)非常适合微服务<br/> d)认证或 API 网关逻辑可以在负载平衡器中完成。</p><p id="9cec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">CONS  : <br/> a)贵(看数据):因为它做的工作多。又是缓冲，又是读取，又是解密，所以更多，更贵。解密并因此终止 TLS。因此，需要将 SSL 证书存储在负载平衡器上。再次，它必须共享一个 TLS 证书。d)需要了解协议。</p><p id="35d3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lb" href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">举个例子:</strong> </a> <strong class="jm io"> <br/> </strong>我们来看一个简单的例子。用户访问高流量网站。在用户会话过程中，他们可能会请求静态内容(如图像或视频)、动态内容(如新闻提要),甚至是交易信息(如订单状态)。第 7 层负载平衡允许负载平衡器根据请求中的信息(如请求的内容类型)来路由请求。所以现在，对图像或视频的请求可以被路由到存储它的服务器，并且被高度优化以提供多媒体内容。对交易信息(比如折扣价格)的请求可以被路由到负责管理定价的应用服务器。借助第 7 层负载平衡，网络和应用架构师可以创建高度调整和优化的服务器基础设施或<a class="ae lb" href="https://www.nginx.com/resources/glossary/application-delivery/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">应用交付</strong> </a>网络，该网络既可靠又可高效扩展以满足需求。</p><h1 id="96dd" class="mf li in bd lj mg mh mi lm mj mk ml lp mm mn mo ls mp mq mr lv ms mt mu ly mv bi translated">负载平衡算法(额外)</h1><p id="4ad1" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">不同的负载平衡算法提供不同的好处；负载平衡方法的选择取决于您的需求:</p><ul class=""><li id="9cd0" class="mw mx in jm b jn jo jr js jv my jz mz kd na kh nb nc nd ne bi translated">循环调度—请求按顺序分布在服务器组中。</li><li id="8fde" class="mw mx in jm b jn nf jr ng jv nh jz ni kd nj kh nb nc nd ne bi translated">最少连接—新请求发送到当前与客户端连接最少的服务器。每台服务器的相对计算能力是决定哪台服务器连接最少的因素。</li><li id="589c" class="mw mx in jm b jn nf jr ng jv nh jz ni kd nj kh nb nc nd ne bi translated">IP 哈希—客户端的 IP 地址用于确定哪个服务器接收请求。</li><li id="30c9" class="mw mx in jm b jn nf jr ng jv nh jz ni kd nj kh nb nc nd ne bi translated">URL 哈希—这确保对特定 URL 的客户端请求总是发送到同一个后端服务器。</li></ul><p id="4624" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了更好地理解负载平衡器或后端，我在这里列出了一些资源:<br/> a) <a class="ae lb" href="https://www.nginx.com/resources/glossary/layer-4-load-balancing/" rel="noopener ugc nofollow" target="_blank">第 4 层</a> <br/> b) <a class="ae lb" href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/#:~:text=Layer%207%20load%20balancing%20allows,to%20serve%20up%20multimedia%20content." rel="noopener ugc nofollow" target="_blank">第 7 层</a> <br/> c) <a class="ae lb" href="https://www.youtube.com/@hnasr" rel="noopener ugc nofollow" target="_blank"> Youtube 后端工程频道</a> <br/> d) <a class="ae lb" href="https://cloud.google.com/load-balancing/docs/ssl-certificates" rel="noopener ugc nofollow" target="_blank"> SSL 证书</a><br/>e)<a class="ae lb" href="https://docs.nginx.com/nginx/admin-guide/load-balancer/" rel="noopener ugc nofollow" target="_blank">https://docs.nginx.com/nginx/admin-guide/load-balancer/</a><br/>f)<a class="ae lb" href="https://medium.com/@itIsMadhavan/what-is-load-balancer-and-how-it-works-f7796a230034" rel="noopener">负载平衡器</a><br/>g)<a class="ae lb" href="https://www.udemy.com/course/nginx-crash-course/" rel="noopener ugc nofollow" target="_blank">nginjx 简介【T2</a></p><p id="c6d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢阅读；我希望它有帮助。<br/>如有任何疑问，欢迎通过<a class="ae lb" href="https://www.linkedin.com/in/manav-garg-b00963182/" rel="noopener ugc nofollow" target="_blank"><em class="kl">LinkedIn</em></a>/<a class="ae lb" href="https://www.instagram.com/manav_706/" rel="noopener ugc nofollow" target="_blank"><em class="kl">insta gram</em></a>联系。</p></div></div>    
</body>
</html>