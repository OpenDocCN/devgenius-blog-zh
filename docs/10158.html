<html>
<head>
<title>GitHub Actions 101 with Azure App Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Azure 应用服务的 GitHub Actions 101</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/github-actions-101-with-azure-app-service-24b19c093c25?source=collection_archive---------2-----------------------#2022-10-11">https://blog.devgenius.io/github-actions-101-with-azure-app-service-24b19c093c25?source=collection_archive---------2-----------------------#2022-10-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="529a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇博客中，我将介绍 GitHub 动作的基本概念及其用例。为了更好地理解这些概念，我将在我的存储库中实现一个 GitHub 操作管道，并在 Microsft Azure 上的 Azure App Service (PaaS)上部署一个示例 Python 应用程序。2018 年，GitHub 宣布了一个新的 CI/CD 平台，用于自动化工作流程并缩短开发周期，名为<strong class="jm io"> GitHub Actions </strong>。所以让我们简单地从理解什么是 GitHub Actions 和一些相关的技术术语开始。</p><p id="8b1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">什么是 GitHub Actions？</strong></p><p id="48f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GitHub Actions 是一个现代化的自动化工具，用于实现 CI(持续集成)和 CD(持续交付/部署)管道。它充当驻留在 GitHub 存储库中的应用程序代码和应用程序将部署到的目标服务器之间的代理。服务器可以是任何东西——虚拟机、Kubernetes 集群、无服务器平台等。GitHub Actions 将执行一系列步骤，如构建、测试、推送到工件注册表，然后将代码工件部署到服务器。有一种系统化的方法来定义这一系列的任务，这样 GitHub Actions 就能理解哪一步必须按照什么顺序来执行。让我们看看 GitHub Actions 是如何理解这些步骤的。</p><ol class=""><li id="9dd8" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated"><strong class="jm io">事件:</strong>代码库中发生的任何事情都是 GitHub 动作的事件。事件可以简单到推送到一个分支、创建一个分支、提出一个拉请求或者检查和关闭一个拉请求。可以定义这些事件来触发 GitHub 操作管道工作流。</li><li id="b187" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">工作流:</strong>工作流是保存在<strong class="jm io">中的 YAML 文件。github/工作流</strong>。该文件包含 GitHub Actions 将作为管道的一部分执行的作业。</li><li id="eb9b" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">作业:</strong>作业是一系列由事件触发后在工作流中执行的任务。工作流并行运行多个作业。将作业视为任务的超集。例如，一个名为 build 的作业将会有这样的任务—签出您的存储库，设置运行时，然后为代码库构建工件。</li><li id="2247" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">步骤:</strong>作业的最小单位是一个步骤。这是一项独立的任务。例如，运行一个 shell 脚本或者它可以只是安装包。动作也是步骤，但用于执行复杂的任务。假设它是预定义的预建功能或模块，例如，发送电子邮件通知、部署到无服务器平台等。</li><li id="e1cb" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">运行者:</strong>无论我们上面讨论了什么，都是自动化管道的组件。但是这条自动化管道通向哪里呢？它在跑步者身上跑。每个运行者执行一个给定的任务。Runners 是无服务器的，托管在云中，但也可以在定制的云环境中自托管。</li></ol><p id="a06d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们想象一下，我们上面提到的。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kw"><img src="../Images/c25e719e018fb6abea2746e765bf332b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4394xHDId_tkM-zDez4kQ.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">GitHub 动作组件</figcaption></figure><p id="3815" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">至此，我们已经介绍了 GitHub 动作的基本理论，让我们从实现开始，彻底理解它。在我们实现之前，让我们看看架构。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lm"><img src="../Images/8839cd915ac2162cfc33f892c6a42cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRqs67v54MgZtqHx9kl4EA.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">应用程序部署的端到端流程</figcaption></figure><p id="d37d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第一步:创建应用服务</strong></p><p id="50c5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">登录 Azure 门户并导航到 Azure 应用服务。创建新的应用服务。配置资源组名称和应用服务名称，选择运行时为 Python 3.9(因为我们正在部署 Flask 应用程序)，并选择您选择的区域。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ln"><img src="../Images/b992224723e3c40894c898fc7bd0def3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oQ5IlzKSOiTsErkivbfQ4w.png"/></div></div></figure><p id="090a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">选择基于 Linux 的应用服务计划，让 SKU 实例成为 F1(免费)第一层，你会在开发/测试部分找到。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lo"><img src="../Images/01679c9ef6a2d6270feaeec6177283e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBsOEVZROPi-vUcfztXEpA.png"/></div></div></figure><p id="220b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击查看并创建和创建 Web 应用程序。Web 应用程序需要几分钟才能准备好。准备就绪后，记下资源组名称和 Web 应用程序的公共端点 URL。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lp"><img src="../Images/7d0d6079e463a87651e0598ed61633d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxdD0B-KW6x7Hp2hplsJXg.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">应用服务概述</figcaption></figure><p id="703b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤 2:准备 Python Flask 应用程序</strong></p><p id="5383" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们正在 App Service 上部署一个基于 Flask 的应用程序。我写了一个简单的 Flask 应用程序，只有两条路线。将应用程序代码命名为<code class="fe lq lr ls lt b">app.py</code></p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="e86d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">写下将包含要安装的烧瓶包的<code class="fe lq lr ls lt b">requirements.txt</code>。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="d248" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确保<code class="fe lq lr ls lt b">app.py</code>和<code class="fe lq lr ls lt b">requirements.txt</code>在同一个目录下。将您的代码推送到您个人的 GitHub 存储库中。例如，我的工作存储库:</p><p id="f7dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae lw" href="https://github.com/anm237/gha-azure-app-service" rel="noopener ugc nofollow" target="_blank">https://github.com/anm237/gha-azure-app-service</a></p><p id="8ba3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤 3:生成部署凭证</strong></p><p id="2c67" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要用 Azure App Service 认证 GitHub 动作。只有这样，操作才能部署到应用程序服务。针对 GitHub 操作向 Azure App Services 进行身份验证的推荐方法是使用发布配置文件。我们也可以使用服务主体或开放 ID 连接(OIDC 令牌),但这个过程需要更多的步骤。通过从概览门户下载来生成发布配置文件。一个文件将被下载到您的本地机器上。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lx"><img src="../Images/e35d977737964092a8bb67d26b916ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*leMuOqc1Q-8zuANcPqCIFQ.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">下载发布配置文件</figcaption></figure><p id="6b38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤 4:在 GitHub Secret 中保存发布配置文件</strong></p><p id="86bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将您的发布配置文件凭据或服务主体另存为<strong class="jm io"> GitHub 机密</strong>以通过 Azure 进行身份验证。您将在工作流程中访问这个秘密。转到您的工作 GitHub 库。选择设置- &gt;秘密(在左窗格)- &gt;动作。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ly"><img src="../Images/f6a3c1aeb9a7ad24b33754e6a8a5aebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6CpYY5Kx709FTNTzUI7VoA.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">创建 GitHub 秘密</figcaption></figure><p id="7ede" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">选择新的存储库密码。创建一个名为<strong class="jm io">AZURE _ web app _ PUBLISH _ PROFILE 的秘密。</strong>将下载文件的内容粘贴为该密码的值。添加秘密。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lz"><img src="../Images/5cf38069500cab89161dcb4a229fa0f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQxjOsD0ad_-eTfY1Nt5TA.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">发布个人资料机密</figcaption></figure><p id="2c21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第五步:添加工作流文件</strong></p><p id="b0e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在知道，需要一个工作流 YAML 文件，以便当事件发生时，它将触发 GitHub 操作的工作流。这个工作流文件驻留在我们 GitHub 的根工作目录下的文件夹<code class="fe lq lr ls lt b"><strong class="jm io">.github/workflows</strong></code> <strong class="jm io"> </strong>中，我们将我们的工作流文件命名为<code class="fe lq lr ls lt b">azure-webapps-python.yml</code>将以下内容粘贴到您的工作流 YAML 文件中。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="19eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们花一分钟来理解工作流文件。</p><ol class=""><li id="7542" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated"><strong class="jm io">名称:</strong>工作流的名称</li><li id="f066" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">on:</strong>GitHub 存储库上的事件。我们将代码<code class="fe lq lr ls lt b">push</code>带到仓库。</li><li id="7851" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io"> env: </strong>我们可以在工作流文件中的任何地方使用的环境或替代变量。AZURE_WEBAPP_NAME 是应用服务名称，AZURE_WEBAPP_PACKAGE_PATH 是添加 python 文件和需求文件的工件的位置，它只是根工作目录。</li><li id="e05c" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">作业:</strong>我们将作业名称设为<code class="fe lq lr ls lt b">build</code>，在它下面我们将定义一系列的任务和动作。</li><li id="3c0e" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io"> runs-on: </strong>云托管的无服务器运行程序的名称，特定的任务或动作将在其上运行。我们要带<code class="fe lq lr ls lt b">ubuntu-latest</code>号去跑步。</li><li id="a359" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated"><strong class="jm io">步骤:</strong>下面定义了一个任务列表。每个连字符“-”都是一个单独的任务。它有一个<code class="fe lq lr ls lt b">uses</code>部分，利用预先构建的动作，例如签出存储库和设置 Python 环境。在构建应用程序和部署到目标 Azure 应用服务的情况下，它也使用 Azure 模块。在上面的例子中，我们还使用<code class="fe lq lr ls lt b">run</code>运行了一个简单的 shell 脚本</li></ol><p id="e3f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第六步:触发工作流</strong></p><p id="e455" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">向您的存储库推送一些更改。导航到操作，您可以看到您的工作流管道被触发。您可以看到触发工作流的提交。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ma"><img src="../Images/c9c2a8431f298d55baa25cd00efd7a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZQG7jovEkIZZ1OSL1aWYHA.png"/></div></div></figure><p id="4ed2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">单击您的工作流程，您将能够看到您的工作中定义的每个步骤的日志。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mb"><img src="../Images/2dbe78a9c3945e162f18fd58b07168ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dpndp-K7UwH4ngt-7IdKVA.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">作业步骤的控制台输出</figcaption></figure><p id="bf99" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第七步:在应用服务上测试你的网络应用</strong></p><p id="ebe4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们成功构建并部署了应用 Python 代码到应用服务。导航到您的 Web 应用程序的公共 URL 并验证输出。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/72a3c64ccb2881cbcb130394b4611cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*mws3tS10p91dfgAFtzWtKg.png"/></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">/上的输出 1</figcaption></figure><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi md"><img src="../Images/e5b3c5946f926e307d807b8fa45d4d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*RCZA9pMrOQdjbMoRvL4bMw.png"/></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">输出 2 开/安</figcaption></figure><p id="6a50" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">跟随我的存储库来实现本教程:</p><p id="c3d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">GitHub:</strong>T27】https://github.com/anm237/gha-azure-app-service</p><p id="0906" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论:</strong></p><p id="6568" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们用 Azure App Service 实现了一个简单的 GitHub 动作管道。GitHub Actions 是一个新的现代工具，用于设计和实现软件供应链管理的 CI/CD 管道。它是 GitHub 的原生产品，这使得开发人员和 DevOps 团队可以轻松地将存储库和分支与操作管道集成在一起。在<a class="ae lw" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">市场</strong> </a>中已经有多个样本可用于工作流。用户只需获取模板，并修改和配置 CI/CD 流程所需的步骤。像 Microsoft Azure、Google Cloud 等云提供商已经在市场上准备好了他们的官方动作模板，这增加了对该工具的更多社区支持。这就是我这篇文章的内容。非常欢迎提出建议。</p></div></div>    
</body>
</html>