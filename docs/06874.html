<html>
<head>
<title>Easy Filter Mongo(ose) Documents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松过滤蒙古文(ose)文档</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/easy-filter-mongo-ose-documents-b1d1232eba31?source=collection_archive---------16-----------------------#2022-02-08">https://blog.devgenius.io/easy-filter-mongo-ose-documents-b1d1232eba31?source=collection_archive---------16-----------------------#2022-02-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="391a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">嘿大家好！</p><p id="b951" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天，我想分享我在为 API 调用编写过滤方法时是如何使用可重用代码的！具体来说，我想分享我是如何用 mongose/Mongo 用几行代码实现一些非常高级的过滤的！</p><p id="4c8a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">目标很简单:</p><p id="d147" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki">客户端应该有一个标准化和类型化的策略，从连接到 Mongo DB(使用 Mongoose)的 API 请求过滤后的文档。</em>T13】</strong></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/94bb5b467b1f1906f47b9e144a088211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkVbsDdph-V4ePi2gsCmpg.png"/></div></div></figure><h1 id="4559" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">在几分钟内将过滤添加到 API 中！</h1><h2 id="81a8" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated">文件</h2><p id="e3b2" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">首先，看一个示例模式。我们可以在整篇文章中引用这一点。</p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="a696" class="lt kw in ml b gy mp mq l mr ms">const ProductSchema = new Schema(<br/>  {<br/>    name: {<br/>      type: String,<br/>      required: true,<br/>      lowercase: true,<br/>      unique: true,<br/>    },<br/>    rating: {<br/>      type: Number,<br/>      required: true,<br/>    },<br/>    active: {<br/>      type: Boolean,<br/>      default: true,<br/>      required: true,<br/>    },<br/>    allergies: [<br/>      {<br/>        type: String,<br/>      },<br/>    ],<br/>  },<br/>  { timestamps: true }<br/>);</span></pre><p id="1c7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个模式是一个很好的例子，因为我们可以通过几种不同的类型进行过滤— <code class="fe mt mu mv ml b">string</code>、<code class="fe mt mu mv ml b">boolean</code>、<code class="fe mt mu mv ml b">array</code>、<code class="fe mt mu mv ml b">object id</code>和<code class="fe mt mu mv ml b">number</code>！</p><h2 id="4e11" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated">为预期的请求创建类型</h2><p id="b5a9" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">客户端将向 API 发送请求，以便接收过滤后的文档。正如我们在本文开头的目标中所讨论的，我们希望客户拥有一个标准化的、类型化的策略来请求文档。</p><p id="6206" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为此，我们需要输入我们期望从客户端收到的请求。然后，我们可以与客户端共享该类型，这将在前端工作时启用自动完成。</p><h2 id="5585" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated">安装 Mongo 过滤器生成器</h2><p id="0b93" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">首先，安装包<code class="fe mt mu mv ml b">@the-devoyage/mongo-filter-generator</code>！此包提供了可用于形成请求正文的类型。</p><p id="63fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请记住——如果您发现自己正在使用该软件包，并想送上一份小礼物表示感谢，您可以通过我们的<a class="ae mw" href="https://basetools.io/checkout/vyOL9ATx" rel="noopener ugc nofollow" target="_blank"> Basetools 付费墙来完成！</a></p><p id="fba8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从您的项目的根目录，运行以下命令登录到 NPM Github 注册表，将<code class="fe mt mu mv ml b">@the-devoyage</code>范围添加到您的。npmrc，并安装软件包。</p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="4cf3" class="lt kw in ml b gy mp mq l mr ms">npm login --registry=https://npm.pkg.github.com</span><span id="27d5" class="lt kw in ml b gy mx mq l mr ms">echo @the-devoyage:registry=<a class="ae mw" href="https://npm.pkg.github.com" rel="noopener ugc nofollow" target="_blank">https://npm.pkg.github.com</a> &gt;&gt; .npmrc</span><span id="4ddd" class="lt kw in ml b gy mx mq l mr ms">npm i @the-devoyage/mongo-filter-generator</span></pre><h2 id="9c75" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated">创建请求正文类型</h2><p id="da86" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">现在您已经安装了 MFG 包，使用它提供的<code class="fe mt mu mv ml b">fieldFilter</code>类型来键入请求体。</p><p id="d4fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">提示:使每个字段可选，以允许客户端对请求有更多的控制。</em></p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="b7d0" class="lt kw in ml b gy mp mq l mr ms">import {<br/>  StringFieldFilter,<br/>  IntFieldFilter, <br/>  BooleanFieldFilter, <br/>  StringArrayFilter <br/>} from "@the-devoyage/mongo-filter-generator";</span><span id="03fa" class="lt kw in ml b gy mx mq l mr ms">export interface GetProducts {<br/>  _id?: StringFieldFilter;<br/>  name?: StringFieldFilter;<br/>  rating?: IntFieldFilter;<br/>  active?: BooleanFieldFilter;<br/>  allergies?: StringArrayFilter;<br/>}</span></pre><h2 id="3df4" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated">解析过滤器并找到文档</h2><p id="5689" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">差不多了——接下来，用从 MFG 包导出的<code class="fe mt mu mv ml b">GenerateMongo</code>函数解析过滤器。这将采取过滤器，并将其转换为 Mongo 过滤器。</p><p id="66ba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用标准 Mongo 风格的滤镜，带<code class="fe mt mu mv ml b">model.find()</code>。</p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="c8ef" class="lt kw in ml b gy mp mq l mr ms">import { GenerateMongo } from "@the-devoyage/mongo-filter-generator";<br/>import { ProductModel } from "models";<br/>import { GetProducts } from "types";</span><span id="5d5c" class="lt kw in ml b gy mx mq l mr ms">app.post("/products", async (req, res) =&gt; {<br/>  const fieldFilters: GetProducts = req.body;</span><span id="b38e" class="lt kw in ml b gy mx mq l mr ms">  const { filters } = GenerateMongo(fieldFilters);</span><span id="eece" class="lt kw in ml b gy mx mq l mr ms">  const products = await ProductModel.find(filters);</span><span id="5063" class="lt kw in ml b gy mx mq l mr ms">  res.json(products);<br/>});</span></pre><p id="7bbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！编码完成！您的 API 现在可以返回超级过滤的结果。</p><p id="b88d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们来看一些示例查询！从客户端，我们现在可以要求一些产品。</p><h1 id="2f30" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">五个示例查询</h1><p id="555e" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">不要忘记与客户端共享您为请求主体创建的类型，因为它可以提供自动完成功能，这对前端团队或您自己来说非常好！</p><h2 id="5cac" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated"><strong class="ak">查找所有准确名称为“印度淡色麦酒”的产品。</strong></h2><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="b675" class="lt kw in ml b gy mp mq l mr ms">import { GetProducts } from 'types';</span><span id="c7a0" class="lt kw in ml b gy mx mq l mr ms">// ...</span><span id="37d1" class="lt kw in ml b gy mx mq l mr ms">const query: GetProducts = {<br/>  name: {<br/>    string: "India Pale Ale",<br/>    filterBy: "MATCH",<br/>  },<br/>};</span><span id="7d91" class="lt kw in ml b gy mx mq l mr ms">const response = await fetch("/products", {<br/>  method: "POST",<br/>  body: JSON.stringify(query),<br/>});</span><span id="44e6" class="lt kw in ml b gy mx mq l mr ms">const products = await response.json();</span></pre><h2 id="7f29" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated"><strong class="ak">查找部分名称为“Ale”的所有产品。</strong></h2><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="d9aa" class="lt kw in ml b gy mp mq l mr ms">import { GetProducts } from 'types';</span><span id="8318" class="lt kw in ml b gy mx mq l mr ms">// ...</span><span id="757f" class="lt kw in ml b gy mx mq l mr ms">const query: GetProducts = {<br/>  name: {<br/>    string: "Ale",<br/>    filterBy: "REGEX",<br/>  },<br/>};</span><span id="0fd2" class="lt kw in ml b gy mx mq l mr ms">// ...</span></pre><h2 id="1801" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated"><strong class="ak">查找评分高于数字 3 的所有产品。</strong></h2><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="da13" class="lt kw in ml b gy mp mq l mr ms">import { GetProducts } from 'types';</span><span id="c532" class="lt kw in ml b gy mx mq l mr ms">// ...</span><span id="9fc4" class="lt kw in ml b gy mx mq l mr ms">const query: GetProducts = {<br/>  rating: {<br/>    int: 3,<br/>    filterBy: "GT",<br/>  },<br/>};</span><span id="62ec" class="lt kw in ml b gy mx mq l mr ms">// ...</span></pre><h2 id="b736" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated"><strong class="ak">查找对象 ID 与“12345”匹配的所有产品。</strong></h2><p id="eced" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">对象 id 是字符串过滤器的一部分。在过滤之前，对象 ID <code class="fe mt mu mv ml b">filterBy</code> param 会将字符串转换为服务器端的对象 ID。</p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="2d59" class="lt kw in ml b gy mp mq l mr ms">import { GetProducts } from 'types';</span><span id="ac36" class="lt kw in ml b gy mx mq l mr ms">// ...</span><span id="0bd3" class="lt kw in ml b gy mx mq l mr ms">const query: GetProducts = {<br/>  _id: {<br/>    string: "12345",<br/>    filterBy: "OBJECTID",<br/>  },<br/>};</span><span id="138a" class="lt kw in ml b gy mx mq l mr ms">// ...</span></pre><h2 id="c37f" class="lt kw in bd kx lu lv dn lb lw lx dp lf jv ly lz lj jz ma mb ln kd mc md lr me bi translated"><strong class="ak">查找排除过敏“小麦”的所有产品。</strong></h2><p id="4f96" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">字符串数组过滤器可以在指定的数组中查找包含或排除查询字符串的文档。</p><pre class="kk kl km kn gt mk ml mm mn aw mo bi"><span id="ec3d" class="lt kw in ml b gy mp mq l mr ms">import { GetProducts } from 'types';</span><span id="2db4" class="lt kw in ml b gy mx mq l mr ms">// ...</span><span id="96ae" class="lt kw in ml b gy mx mq l mr ms">const query: GetProducts = {<br/>  allergy: {<br/>    string: "wheat",<br/>    filterBy: "MATCH",<br/>    arrayOptions: "NIN",<br/>  },<br/>};</span><span id="d488" class="lt kw in ml b gy mx mq l mr ms">// ...</span></pre><h1 id="8e6c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">包装东西</h1><p id="8e2d" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">嘿，我希望<code class="fe mt mu mv ml b">@the-devoyage/mongo-filter-generator</code>包能让你的前端和服务器端代码都变得简单一点！</p><p id="3ae3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你认为会的话，送去一些爱。你的资金将直接用于我带狗狗去卖美味 IPA 的狗狗公园。是的，这是一个酷狗公园！</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/d10fe190e9ccc0c815835e01303dd3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtdcjUpbOa49vxGSNy2BDg.jpeg"/></div></div></figure><p id="ca12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">MFG 包提供的不仅仅是简单的过滤，我今天有机会向您展示了—分页选项、默认搜索选项、覆盖值、嵌套过滤和/或操作符过滤…仅举几个例子，我还会不断添加更多！</p><p id="6bf0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想了解更多关于这个包的内容，可以看看我的文章，<a class="ae mw" href="https://thedevoyage.medium.com/instant-api-pagination-and-filtering-with-mongo-filter-generator-228a57182116" rel="noopener">即时 API 分页和使用 Mongo-Filter-Generator 过滤</a>！</p></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><p id="54b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">嘿！我的名字是 Nick——我是一名来自德克萨斯州达拉斯的开发人员，非常高兴有机会在 Medium 上分享我的一些作品。如果你喜欢啤酒、狗、javascript 或狗，一定要点击<strong class="jm io"> <em class="ki">跟随按钮</em>。</strong></p><p id="c4e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">谢谢，</p><p id="f7ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">缺口</p></div></div>    
</body>
</html>