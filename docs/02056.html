<html>
<head>
<title>Integrating Google Sign-In into Android App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Google登录集成到Android应用程序中</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/integrating-google-sign-in-into-android-app-70d582f4eed8?source=collection_archive---------0-----------------------#2020-07-18">https://blog.devgenius.io/integrating-google-sign-in-into-android-app-70d582f4eed8?source=collection_archive---------0-----------------------#2020-07-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9aa2c9a73f47c87b0ac01717d9868bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qFhV-NoOY0m04ymu"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">由<a class="ae jz" href="https://unsplash.com/@pathum_danthanarayana?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pathum Danthanarayana </a>在<a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a628" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">几乎每个Android应用程序都需要用户登录，原因有很多。它可以用于验证用户凭证、用户身份验证、获取用户的基本配置文件细节等..我们不必为注册编写自己的实现代码，我们可以使用Google登录按钮，享受Google登录API提供的功能。</p><p id="9171" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将看到Google Sign-In的基本实现，它让用户登录，并在验证用户身份后将用户带到下一个屏幕。本文使用的编程语言是Kotlin。</p><h2 id="9f90" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">添加梯度依赖关系</strong></h2><p id="14a6" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">在您的应用程序级<code class="fe lw lx ly lz b">build.gradle</code>文件中，将Google Play服务声明为依赖项</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b7f7" class="ky kz in lz b gy mi mj l mk ml"><br/>    dependencies {<br/>        implementation 'com.google.android.gms:play-services-auth:18.0.0'<br/>    }</span></pre><h2 id="4cd9" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">认证客户端并配置Google API控制台项目</strong></h2><p id="11e5" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">Google Play服务要求我们提供签名证书的SHA-1，以便Google可以为我们的应用程序创建OAuth2客户端和API密钥。使用此<a class="ae jz" href="https://developers.google.com/identity/sign-in/android/start-integrating#configure_a_project" rel="noopener ugc nofollow" target="_blank">链接</a>并点击配置项目。输入项目名称，选择和id，输入包名称和SHA-1证书。</p><p id="a348" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">去安卓工作室找SHA-1。</p><ol class=""><li id="4ce1" class="mm mn in kc b kd ke kh ki kl mo kp mp kt mq kx mr ms mt mu bi translated">打开Android Studio</li><li id="acbd" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">打开您的项目</li><li id="0811" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">点击Gradle(从右侧面板，您会看到Gradle栏)</li><li id="07b6" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">点击刷新(点击Gradle栏中的刷新，您将看到您的项目的列表Gradle脚本)</li><li id="c5ea" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">单击您的项目(您的项目名称表单列表(根))</li><li id="ee34" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">点击任务</li><li id="0693" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">点击安卓</li><li id="70d5" class="mm mn in kc b kd mv kh mw kl mx kp my kt mz kx mr ms mt mu bi translated">双击signingReport(你会在运行栏中得到SHA1和MD5(有时会在控制台中))</li></ol><h2 id="a233" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">配置Google登录和GoogleSignInClient对象</h2><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/7148dfd69cd77da753b747df9999213e.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*45lD9PXhwKCK7zaG-BdkGw.png"/></div></figure><p id="3a49" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在你的应用布局中添加一个“登录”按钮，启动登录流程，并注册你的按钮的<code class="fe lw lx ly lz b">OnClickListener</code>以在点击时登录用户。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><ol class=""><li id="8c16" class="mm mn in kc b kd ke kh ki kl mo kp mp kt mq kx mr ms mt mu bi translated">在登录活动的<code class="fe lw lx ly lz b">onCreate</code>方法中，要配置Google登录来请求用户的ID和基本配置文件信息，创建一个带有<code class="fe lw lx ly lz b">DEFAULT_SIGN_IN</code>参数的<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInOptions.Builder#GoogleSignInOptions.Builder()" rel="noopener ugc nofollow" target="_blank">GoogleSignInOptions</a></code>对象。要请求用户的电子邮件地址，使用<code class="fe lw lx ly lz b">requestEmail</code>选项创建<code class="fe lw lx ly lz b">GoogleSignInOptions</code>对象。</li></ol><p id="11e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.用你指定的选项创建一个<code class="fe lw lx ly lz b">GoogleSignInClient</code>对象。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="164d" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">检查现有的登录用户</strong></h2><p id="0a0a" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">在登录活动的<code class="fe lw lx ly lz b">onStart</code>方法中，检查用户是否已经使用Google登录了您的应用程序</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="70ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果<code class="fe lw lx ly lz b">account != null</code>，用户已经用Google登录了你的应用。使用如下所示的意图启动您的UserProfile活动。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="ff3c" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">启动登录流程</h2><p id="5167" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">如果<code class="fe lw lx ly lz b">account == null</code>，用户尚未使用Google登录您的应用程序。现在，用户必须点击谷歌登录按钮登录。处理登录活动上的登录按钮点击。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="e1fe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过调用<code class="fe lw lx ly lz b">signIn()</code>，我们使用通过调用<em class="nd">Google sign client</em>对象上的<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInClient#getSignInIntent()" rel="noopener ugc nofollow" target="_blank">getSignInIntent</a></code>方法获得的意图启动登录屏幕，并通过调用<code class="fe lw lx ly lz b">startActivityForResult</code>启动登录</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="ma mb mc md gt jo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/2f6a5c36e6e581b9e438730f58c5aaa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*8r54XTaqjXmHqaewFc-HAg.png"/></div></figure><p id="bb6f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">意向提示用户选择一个Google账户登录。</p><p id="5e57" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用户登录后，我们可以在活动的<code class="fe lw lx ly lz b">onActivityResult</code>方法中为用户获取一个<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInAccount" rel="noopener ugc nofollow" target="_blank">GoogleSignInAccount</a></code>对象。</p><p id="f202" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lw lx ly lz b">GoogleSignInAccount</code>对象(account)包含登录用户的信息，比如用户名。我们还可以通过<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInAccount#getEmail()" rel="noopener ugc nofollow" target="_blank">getEmail</a></code>获得用户的电子邮件地址，通过<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInAccount#getId()" rel="noopener ugc nofollow" target="_blank">getId</a></code>获得用户的Google ID(供客户端使用)，通过<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInAccount#getIdToken()" rel="noopener ugc nofollow" target="_blank">getIdToken</a>.</code>获得用户的ID令牌，以获得ID令牌并通过后端服务器进行认证，请参考<a class="ae jz" href="https://developers.google.com/identity/sign-in/android/backend-auth" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="c9ad" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">获取配置文件信息</h2><p id="5d7c" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">现在，我们通过intent导航到UserProfile活动，我们还可以传递<code class="fe lw lx ly lz b">GoogleSignInAccount</code>对象“帐户”来检索UserProfile活动中的用户详细信息，或者我们可以通过检查现有登录用户并在UserProfile活动的XML布局文件中创建的TextView字段中显示用户详细信息来再次获取<code class="fe lw lx ly lz b">GoogleSignInAccount</code>对象，如下所示。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="ee6b" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">注销用户:</h2><p id="4837" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">在UserProfile活动的XML文件中创建一个注销按钮，并配置<code class="fe lw lx ly lz b">onClick</code>方法来调用<code class="fe lw lx ly lz b"><a class="ae jz" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInClient#signOut()" rel="noopener ugc nofollow" target="_blank">signOut</a></code>，这将清除连接到应用程序的帐户，要再次登录，用户必须再次选择他们的帐户。使用intent导航回SignInActivity并完成当前活动。</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div></div>    
</body>
</html>