<html>
<head>
<title>Setup Supabase with Nest.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Nest.js 设置 Supabase</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/setup-supabase-with-nest-js-85041b03ec3a?source=collection_archive---------7-----------------------#2022-07-11">https://blog.devgenius.io/setup-supabase-with-nest-js-85041b03ec3a?source=collection_archive---------7-----------------------#2022-07-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="6dd1" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">如何在 Nest.js 应用中使用 Supabase 的 Auth 和 Client</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9495cee9e437ea0076d63ba4a3001a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CU5Wf0xbrzr0qWoEVR2tjg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Nest.js 设置 Supabase</figcaption></figure><h1 id="ff8b" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">⚠️免责声明</h1><p id="bfed" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">这篇文章是为 Supabase <strong class="la io"> v1 </strong>创建的，由于某些<strong class="la io"> auth </strong>方法的贬值，似乎无法与<strong class="la io"> v2 </strong>一起工作。我将为<strong class="la io"> v2 </strong>创建一篇新文章，并放在这里。如果你已经找到了解决方案，请在评论中告诉我！谢谢！</p><h2 id="2e15" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">🤓我对你的期望</h2><ul class=""><li id="d8d0" class="mi mj in la b lb lc lf lg lj mk ln ml lr mm lv mn mo mp mq bi translated">你知道 Supabase 是什么吗</li><li id="a183" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">你知道 Nest.js 框架</li><li id="dc80" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">如果需要的话，你可以谷歌一下本教程之外的内容</li></ul><h1 id="eca6" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">🤔我在 Nest.js 中使用 Supabase 的用例</h1><p id="5c96" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">我需要一个每 1 秒钟运行一次并执行一些操作的轮询机制。作为 Auth 和 DB，我选择了使用 Supabase，因为我看到了一些教程，想尝试一下。</p><p id="8e0d" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">起初，我想通过 Cron Jobs 使用 Next.js 和函数来完成这些操作，但恰好 Github(作为最容易访问的 Cron 提供者)的 Cron Job 的最小时间范围只有每 5 分钟一次。</p><p id="ccc7" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">所以我转而考虑用 Nest.js 开发一个服务器(完整)应用程序</p><h1 id="26d7" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">🧑‍💻如何使用 Supabase 和 Nest.js</h1><p id="f9f2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">有一个例子可以说明如何使用 Supabase 作为 Nest.js 应用程序的身份验证库，但是:</p><ul class=""><li id="85f7" class="mi mj in la b lb mw lf mx lj nc ln nd lr ne lv mn mo mp mq bi translated">对我来说，这似乎并不简单(实际实现)，我也不想使用外部包</li><li id="2c47" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">它不像我希望的那样工作——它没有从 lib 中暴露 Supabase 客户端</li></ul><p id="90c9" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">如果你从未使用过 Passport 并且需要一个例子，这仍然是一个很好的条目——它帮助我理解在我的代码中应该做什么，所以谢谢*hiro1107 </em>:)</p><p id="4f85" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">📑例子:<a class="ae nb" href="https://supabase.com/docs/guides/examples" rel="noopener ugc nofollow" target="_blank">supabase.com/docs/guides/examples</a></p><p id="991d" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">🧑‍💻github:<a class="ae nb" href="https://github.com/hiro1107/nestjs-supabase-auth" rel="noopener ugc nofollow" target="_blank">github.com/hiro1107/nestjs-supabase-auth</a></p><p id="5902" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">所以我决定为 Auth 和 Client 实现我的方法。</p><h2 id="6ba3" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">我们可以在 Node.js 后端使用 Supabase 吗？</h2><p id="0f87" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">一般来说，像 Firebase 一样，Supabase 是一个客户端工具，它通过为“匿名”用户提供行级安全策略来从客户端工作，但它不会强迫我们只在客户端使用 Supabase。</p><p id="65f6" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">通过一些规则，我们可以在 Node.js 服务器中自由地利用 Supabase 的能力。</p><h1 id="7298" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">🍴Supabase 基本设置</h1><p id="d120" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在编写代码之前，我想提到几个关键点。</p><h2 id="f2c5" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">RLS 政策</h2><p id="9a2b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">创建表时启用它</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/a1329b5a0964e538a7858c0a032f4eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PWAOUYZL1uZV3T97"/></div></div></figure><p id="7c76" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">我建议默认创建两个:</p><p id="e975" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">为了使您的应用程序与以前的策略一起工作，不要忘记在您使用的每个表上创建<code class="fe nh ni nj nk b">user_id</code>列:它应该是自动生成的<code class="fe nh ni nj nk b">auth.uid()</code>字段，所以这样一来，Supabase 将总是将正确的用户追加到一行中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/623a21a16dbbefec157772a8534774de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qhqmiZKROPVjQ7j3"/></div></div></figure><p id="7c4c" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">如果需要，您可以使用服务密钥绕过 RLS，但要小心。</p><h1 id="46b1" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">🐱Nest.js 应用程序</h1><h2 id="3f4e" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">安装</h2><p id="9744" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">为了实现这一点，除了 Supabase 之外，我们还需要添加一些库:</p><pre class="kj kk kl km gt nm nk nn no aw np bi"><span id="a21c" class="lw jl in nk b gy nq nr l ns nt">npm i passport passport-jwt @nestjs/passport @supabase/supabase-js</span></pre><p id="3c67" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">passport——处理与 Auth 相关的所有事情，它有没有魔力，我们不需要关心</p><p id="fc2f" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">passport-jwt-为 jwt 认证提供了现成的策略</p><p id="05ef" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><a class="ae nb" href="https://hashnode.com/@nestjs" rel="noopener ugc nofollow" target="_blank">@ nestjs</a>/passport—nest . js 的 Passport 的模块</p><h2 id="3202" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">JWT 认证如何与护照</h2><p id="b9cd" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">JWT Auth 如何工作超出了本文的范围，但是在 Nest.js 中使用 Passport 和 passport-jwt 有很多解释，你可以从检查 Nest.js 的<a class="ae nb" href="https://docs.nestjs.com/security/authentication" rel="noopener ugc nofollow" target="_blank">认证</a>开始。</p><p id="0a2f" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">对于我们的案例，我们需要知道的是:Supabase 是一个基于 JWT 的授权机构，负责处理它这边的所有事情。在我们这边，我们需要正确的<code class="fe nh ni nj nk b">SUPABASE_JWT_SECRET</code>，用于解码 jwt。(位于设置- &gt; API)</p><h2 id="40b0" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">超级文件夹</h2><p id="dd4b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">🔗<a class="ae nb" href="https://github.com/andriishupta/nestjs-supabase-setup/tree/main/src/common/supabase" rel="noopener ugc nofollow" target="_blank">将</a>链接到文件夹</p><p id="7992" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">这是你可以复制到你的代码库的主要代码，它将会工作。该模块是一个常规的 Nest.js 模块。其他文件值得深入研究。</p><h2 id="12f0" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">战略</h2><blockquote class="nu nv nw"><p id="7eac" class="ky kz nf la b lb mw ld le lf mx lh li nx my ll lm ny mz lp lq nz na lt lu lv ig bi translated"><em class="in"> Passport 拥有丰富的战略生态系统，可实现各种身份验证机制。虽然在概念上很简单，但你可以选择的护照策略非常多，而且种类繁多</em></p></blockquote><p id="f83a" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">如 Supabase 是 JWT，我们将使用现成的 passport-jwt 策略，为我们做所有的解码和其他事情。</p><p id="e20f" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">在这段代码中，我们用 JWT 策略扩展了 PassportStrategy，并在<code class="fe nh ni nj nk b">super</code>调用中传递配置。</p><p id="c0ab" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">奇怪的“扩展”</em> <code class="fe nh ni nj nk b"><em class="nf">PassportStrategy(Strategy)</em></code> <em class="nf">是打字稿 Mixins </em></p><p id="b78c" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">🔗<a class="ae nb" href="https://github.com/andriishupta/nestjs-supabase-setup/blob/main/src/common/supabase/supabase.strategy.ts" rel="noopener ugc nofollow" target="_blank">源代码</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/623c6cd06616e5c9dfad7b83e87216c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c0XEyg_L7YET9cln"/></div></div></figure><h2 id="63a2" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">防护装置</h2><p id="fdd4" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">有了这个防护，我通过在 app.module.ts 中提供<code class="fe nh ni nj nk b">APP_GUARD</code>来保护整个应用程序——一种全局防护方式。你可以使用<code class="fe nh ni nj nk b">UseGuard</code>来保护那些需要保护的路线。</p><p id="8aee" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">这里，我们用<code class="fe nh ni nj nk b">jwt</code>策略扩展了 AuthGuard(这是 passport-jwt 如何在幕后命名策略的)。简单。</p><p id="2962" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">🔗<a class="ae nb" href="https://github.com/andriishupta/nestjs-supabase-setup/blob/main/src/common/supabase/supabase.guard.ts" rel="noopener ugc nofollow" target="_blank">源代码</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/4af6e73e88d74340bd7bd060fbb49510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qUt1aF38xGbW480b"/></div></div></figure><h2 id="6ae0" class="lw jl in bd jm lx ly dn jq lz ma dp ju lj mb mc jy ln md me kc lr mf mg kg mh bi translated">服务:<code class="fe nh ni nj nk b">Scope.REQUEST</code></h2><p id="4df9" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">该服务将为每个请求提供<code class="fe nh ni nj nk b">createClient</code>和<code class="fe nh ni nj nk b">setAuth</code>，因此我们将在所有后续服务呼叫中拥有正确的用户。代码以“单例”方式实现，因此我们将在同一请求的不同位置获得相同的实例。</p><p id="9440" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">🔗<a class="ae nb" href="https://github.com/andriishupta/nestjs-supabase-setup/blob/main/src/common/supabase/supabase.ts" rel="noopener ugc nofollow" target="_blank">源代码</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b242221d1086526c488080e4cc3f1797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kBZrtlHUhmQ_p-cq"/></div></div></figure><p id="5144" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">为什么？</p><p id="b336" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">这里有一个有趣的部分，它发生在保存客户端状态的不同库上:</p><p id="649f" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">如果我们在像 Next.js 这样的服务器或 SSR 应用上使用保存每个用户状态的客户端库，我们需要小心这些，例如当我们创建一个库的实例时，它可能对调用服务器/SSR 应用的每个人都可用。</p><p id="4025" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">这就是为什么必须使用<code class="fe nh ni nj nk b">@Injectable({ scope: Scope.REQUEST })</code>的原因，这样我们的 Supabase <code class="fe nh ni nj nk b">createClient</code>将根据请求创建，我们将正确设置 auth。</p><p id="10bc" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">再比如:<a class="ae nb" href="https://react-query-v3.tanstack.com/guides/ssr#using-hydration" rel="noopener ugc nofollow" target="_blank"> Next.js &amp;带 react-query 的 SSR</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/e0ed359f69c952c5d0fa52915424e67f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3jhIOgXfBIB04dgV"/></div></div></figure><p id="945d" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">免责声明:我还没有对多个用户进行测试，但是我很确定。</em>我还没有找到通过直接将<code class="fe nh ni nj nk b">access_token</code> - only <code class="fe nh ni nj nk b">setAuth</code>附加到客户端来与文档中的一个客户端传递 Auth 的其他方法。</p><p id="12e2" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">可能的解决方案</em> : Supabase 可以调整认证流程，通过独特的设置，我们可以在每个请求中传递用户。有了 Passport，我们就有了<code class="fe nh ni nj nk b">req.user</code>中的用户，并且仍然可以访问<code class="fe nh ni nj nk b">access_token</code>的授权头。</p><h1 id="09de" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">📭邮递员测试</h1><p id="61d0" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">一切都结束后，让我们试着给我们的服务器打电话。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/279040b807b30b22e5d5793b9f423fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pikMp6vBJdz4aEix"/></div></div></figure><p id="d6d3" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">不出所料，我们得到了一个 401 代码——这是<em class="nf">护照。js </em>它在我们的<strong class="la io"> SupabaseGuard </strong>中检查了 JWT 吗</p><p id="0921" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">现在让我们得到一个有效的<code class="fe nh ni nj nk b">access_token</code>并重复调用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/108a9d96a524bea396fad63323e11379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wSAFuurSn0nAwTSy"/></div></div></figure><p id="d1a0" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi">💪 💪 💪</p><p id="b092" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">用户登录后可用的访问令牌。在我的例子中，我刚刚发送了“神奇链接”，并从 URL </em>中获得了 <code class="fe nh ni nj nk b"><em class="nf">acces_token</em></code> <em class="nf"/></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d8735b5803f611bf49fabfa2b757631d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*89Elo_ev6HSNK6_I"/></div></div></figure><h1 id="a914" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">📋summary—TL；DR；</h1><ul class=""><li id="fb74" class="mi mj in la b lb lc lf lg lj mk ln ml lr mm lv mn mo mp mq bi translated">安装所需的依赖项</li><li id="7625" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">将<strong class="la io"> supabase </strong>文件夹复制到你的项目中</li><li id="db9a" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">添加 3 个 SUPABASE_*变量到。包封/包围（动词 envelop 的简写）</li><li id="48fd" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">导入<em class="nf">supabase . module</em>:in app . module/<a class="ae nb" href="https://hashnode.com/@Global" rel="noopener ugc nofollow" target="_blank">@ Global</a>()auth . module/等。</li><li id="a0a8" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">提供全局<code class="fe nh ni nj nk b">APP_GUARD</code>或使用<code class="fe nh ni nj nk b">UseGuard</code>在需要的地方使用它</li><li id="a352" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">使用<code class="fe nh ni nj nk b">this.supabase.getClient()</code>提供的其他服务中的<em class="nf"> supabase.ts </em>进行 supabase 通话</li></ul><h1 id="4a57" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">🔗链接</h1><ul class=""><li id="9d63" class="mi mj in la b lb lc lf lg lj mk ln ml lr mm lv mn mo mp mq bi translated">github:<a class="ae nb" href="https://github.com/andriishupta/nestjs-supabase-setup" rel="noopener ugc nofollow" target="_blank">github.com/andriishupta/nestjs-supabase-setup</a></li><li id="614a" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">Nest.js 的<a class="ae nb" href="https://docs.nestjs.com/security/authentication" rel="noopener ugc nofollow" target="_blank">认证</a>，包括带 Passport.js 的 JWT</li><li id="eecf" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">如何在 Nest.js 中使用<a class="ae nb" href="https://docs.nestjs.com/guards" rel="noopener ugc nofollow" target="_blank">守卫</a></li><li id="f92b" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">Supabase 的 Auth <a class="ae nb" href="https://github.com/hiro1107/nestjs-supabase-auth" rel="noopener ugc nofollow" target="_blank">带有 Nest.js 的示例应用</a></li><li id="a041" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated"><a class="ae nb" href="https://supabase.com/docs/reference" rel="noopener ugc nofollow" target="_blank"> Supabase 的文件</a></li></ul><p id="367b" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">感谢阅读！</p></div><div class="ab cl oh oi hr oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ig ih ii ij ik"><p id="e8b2" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nf">原载于</em><a class="ae nb" href="https://andriishupta.dev/setup-supabase-with-nestjs" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://blog . andriishupta . dev</em></a><em class="nf">。</em></p></div></div>    
</body>
</html>