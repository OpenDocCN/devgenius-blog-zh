<html>
<head>
<title>TIL: Python sqlite3 â€” using placeholders to bind values in SQL statements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TIL: Python sqlite3 â€”ä½¿ç”¨å ä½ç¬¦ç»‘å®š SQL è¯­å¥ä¸­çš„å€¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.devgenius.io/til-python-sqlite3-using-placeholders-to-bind-values-in-sql-statement-62d10338cb6b?source=collection_archive---------5-----------------------#2022-08-25">https://blog.devgenius.io/til-python-sqlite3-using-placeholders-to-bind-values-in-sql-statement-62d10338cb6b?source=collection_archive---------5-----------------------#2022-08-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><p id="0c7a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="kp"> TIL(â€œä»Šå¤©æˆ‘å­¦åˆ°äº†â€)æ˜¯ä¸€äº›æ›´çŸ­ã€ç ”ç©¶æ›´å°‘çš„å¸–å­ï¼Œæˆ‘é€šå¸¸ä¼šå†™è¿™äº›å¸–å­æ¥å¸®åŠ©ç»„ç»‡æˆ‘çš„æƒ³æ³•ï¼Œå·©å›ºæˆ‘åœ¨å·¥ä½œä¸­å­¦åˆ°çš„ä¸œè¥¿ã€‚æˆ‘æŠŠå®ƒä»¬è´´åœ¨è¿™é‡Œä½œä¸ºä¸ªäººæ¡£æ¡ˆï¼Œå½“ç„¶ä¹Ÿè®©å…¶ä»–äººå¯èƒ½ä»ä¸­å—ç›Šã€‚</em></p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/48c20b07971beabf995411ed385fa708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vZ8aVhHbwaYFtmdj"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><a class="ae lg" href="https://unsplash.com/@davidclode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å¤§å«Â·å…‹æ´›å¾·</a>åœ¨<a class="ae lg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</figcaption></figure><h1 id="7ee9" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">SQL è¯­å¥ä¸­çš„å ä½ç¬¦</h1><p id="6c5b" class="pw-post-body-paragraph jr js in jt b ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko ig bi translated">æ­£å¦‚<a class="ae lg" href="https://docs.python.org/3/library/sqlite3.html#using-placeholders-to-bind-values-in-sql-queries" rel="noopener ugc nofollow" target="_blank"> Python sqlite3 æ–‡æ¡£</a>æ‰€è§£é‡Šçš„:</p><blockquote class="mk ml mm"><p id="44d8" class="jr js kp jt b ju jv jw jx jy jz ka kb mn kd ke kf mo kh ki kj mp kl km kn ko ig bi translated">SQL æ“ä½œé€šå¸¸éœ€è¦ä½¿ç”¨ Python å˜é‡çš„å€¼ã€‚ç„¶è€Œï¼Œè¦å°å¿ƒä½¿ç”¨ Python çš„å­—ç¬¦ä¸²æ“ä½œæ¥ç»„è£…æŸ¥è¯¢ï¼Œå› ä¸ºå®ƒä»¬å®¹æ˜“å—åˆ°<a class="ae lg" href="https://en.wikipedia.org/wiki/SQL_injection" rel="noopener ugc nofollow" target="_blank"> SQL æ³¨å…¥æ”»å‡»</a></p></blockquote><p id="ae8a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">åƒè¿™æ ·ç»„è£…å­—ç¬¦ä¸²æ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="59e4" class="mv li in mr b gy mw mx l my mz"><em class="kp"># Never do this -- insecure!</em><br/>symbol = 'RHAT'<br/>cur.execute("SELECT * FROM stocks WHERE symbol = '<strong class="mr io">%s</strong>'" % symbol)</span></pre><p id="71a3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æˆ–è€…ç”¨ f å¼¦ã€‚</p><p id="384d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æ–‡æ¡£å»ºè®®ä½¿ç”¨<em class="kp">é—®å·</em>æˆ–<em class="kp">å‘½åçš„</em>æ ·å¼:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="89f1" class="mv li in mr b gy mw mx l my mz"><em class="kp"># This is the qmark style:</em><br/>cur.execute("insert into lang values (?, ?)", ("C", 1972))<br/><br/><em class="kp"># And this is the named style:</em><br/>cur.execute("select * from lang where date=:year", {"year": 1972})</span></pre><h1 id="b282" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">é—®é¢˜</h1><p id="006b" class="pw-post-body-paragraph jr js in jt b ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko ig bi translated">ç„¶è€Œï¼Œå½“æˆ‘å°è¯•åè€…æ—¶ï¼Œæˆ‘é‡åˆ°äº†éº»çƒ¦:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="3064" class="mv li in mr b gy mw mx l my mz">params = {"table": table, "identifier": identifier}<br/>query = "select * from :table where identifier=:identifier"<br/>cur.execute("query")</span></pre><p id="1150" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä¸€ä¸ªå°æ—¶çš„æ•£å¼¹æªè°ƒè¯•ä¹‹åï¼Œæˆ‘æ„è¯†åˆ°è¿™ä¸èµ·ä½œç”¨ï¼Œå› ä¸º DB-API çš„å‚æ•°æ›¿æ¢åªé€‚ç”¨äºè¡¨è¾¾å¼ï¼Œè€Œä¸é€‚ç”¨äºè¡¨åæˆ– SQL è¯­æ³•çš„å…¶ä»–éƒ¨åˆ†ã€‚</p><p id="da1a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">å¦ä¸€æ–¹é¢ï¼Œè¿™æ ·åšå¾ˆå¥½:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="a570" class="mv li in mr b gy mw mx l my mz">params = {"table": table, "identifier": identifier}<br/>query = f"select * from {table} where identifier=:identifier"<br/>cur.execute("query")</span></pre><p id="9474" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ç„¶è€Œï¼Œè¿™ä¸ª f å¼¦å¯¹ SQL æ³¨å…¥æ¥è¯´ä»ç„¶æ˜¯ä¸å®‰å…¨çš„:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="3551" class="mv li in mr b gy mw mx l my mz">table = "users; DROP TABLE users;"<br/>params = {"table": table, "identifier": identifier}<br/>query = f"select * from {table} where identifier=:identifier"<br/>cur.execute("query")</span></pre><p id="8f30" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æˆ‘çœ‹åˆ°æœ‰äººå£°ç§°(ä¾‹å¦‚åœ¨<a class="ae lg" href="https://stackoverflow.com/questions/31277027/how-to-use-placeholders-for-the-column-and-table-names-in-sqlite3-statements-wh" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>ä¸Š)API ä¼šå‡€åŒ–è¿™æ ·çš„è¾“å…¥ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰ã€‚æœç„¶ï¼Œæ‚¨å¾—åˆ°ä¸€ä¸ªé”™è¯¯:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="f5b5" class="mv li in mr b gy mw mx l my mz">Traceback (most recent call last):<br/>  File "test.py", line 11, in &lt;module&gt;<br/>    cur.execute(f"select * from {table} where identifier=:identifier", params)<br/>sqlite3.OperationalError: no such table: users</span></pre><p id="b912" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä½†è¿™æ˜¯å› ä¸ºè¡¨<code class="fe na nb nc mr b">users</code>å®é™…ä¸Šå·²ç»åœ¨æ‰§è¡Œè¯­å¥çš„è¿‡ç¨‹ä¸­è¢«åˆ é™¤äº†ã€‚</p><h1 id="6a09" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">è§£å†³åŠæ³•</h1><p id="86c9" class="pw-post-body-paragraph jr js in jt b ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko ig bi translated">å°±æˆ‘æ‰€è§ï¼Œå¯¹æ­¤æ²¡æœ‰æ˜ç¡®çš„è§£å†³æ–¹æ¡ˆã€‚å› æ­¤ï¼Œå¦‚æœè¡¨åå¯èƒ½æ¥è‡ªç”¨æˆ·è¾“å…¥ï¼Œé‚£ä¹ˆå”¯ä¸€è¦åšçš„å°±æ˜¯åœ¨å°†ç”¨æˆ·è¾“å…¥é›†æˆåˆ° SQL è¯­å¥ä¹‹å‰æµ‹è¯•å…¶å®‰å…¨æ€§:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="a92e" class="mv li in mr b gy mw mx l my mz">table = input("Please enter a table")<br/>identifier = input("Please enter an identifier")<br/>if table in ["users", "admins", "groups"]: # specify tables<br/>    params = {"table": table, "identifier": identifier}<br/>    query = f"select * from {table} where identifier=:identifier"<br/>    cur.execute("query")</span></pre><p id="5f93" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">æ›´å¥½çš„åŠæ³•æ˜¯é‡å†™åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œé¿å…ä½¿ç”¨åŠ¨æ€è¡¨åæˆ–æ˜¾å¼ç”¨æˆ·è¾“å…¥â€¦</p><p id="6ae4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªä»£ç æ°”å‘³è‚¯å®šï¼</p></div><div class="ab cl jk jl hr jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ig ih ii ij ik"><p id="c51e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">ä½ å¥½ï¼ğŸ‘‹<em class="kp">æˆ‘æ˜¯æ±¤å§†ã€‚æˆ‘æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆã€æŠ€æœ¯ä½œå®¶å’Œ IT å€¦æ€ æ•™ç»ƒã€‚å¦‚æœæƒ³å–å¾—è”ç³»ï¼Œå¯ä»¥æŸ¥çœ‹</em><a class="ae lg" href="https://tomdeneire.github.io/" rel="noopener ugc nofollow" target="_blank"><em class="kp">https://tomdeneire . github . io</em></a></p></div></div>    
</body>
</html>