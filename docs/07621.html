<html>
<head>
<title>How to increase the volume of an audio file with C.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 c 增加一个音频文件的音量？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-increase-volume-of-an-audio-file-with-c-6d23e04a03a6?source=collection_archive---------5-----------------------#2022-04-11">https://blog.devgenius.io/how-to-increase-volume-of-an-audio-file-with-c-6d23e04a03a6?source=collection_archive---------5-----------------------#2022-04-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/db141630bd6189e3584bd6d8505095e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2Q9ygJkKJAxjiGdosGqZw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">米盖尔·Á。帕德里纳恩恩<a class="ae jz" href="https://www.pexels.com/es-es/foto/disco-de-vinilo-negro-167092/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a></figcaption></figure><p id="5952" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是 CS50 的第四个实验，我正在努力解决这些看似简单的问题，它们并没有那么简单，哈哈。我很难理解这一点。</p><p id="9eb1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里我们需要增加。WAV 文件，由 44 个无符号整数字节的头文件组成，头文件包含文件本身的信息和样本，这些样本是音频文件的“<em class="ky">音频</em>”部分，我们可以通过将它们乘以一个数字来改变音量。</p><p id="1bd5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了解决这个问题，我们使用了三个头文件:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d46a" class="li lj in le b gy lk ll l lm ln">#include &lt;stdint.h&gt;</span><span id="3d08" class="li lj in le b gy lo ll l lm ln">#include &lt;stdio.h&gt;</span><span id="9f84" class="li lj in le b gy lo ll l lm ln">#include &lt;stdlib.h&gt;</span></pre><p id="6c9a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，在 main 之前，我们声明。WAV 文件和一个数据类型 BYTE，其中 uint8 字节用于读取头，BYTE2 字节具有 int16 字节值，用于读取每个样本。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="24e9" class="li lj in le b gy lk ll l lm ln">const int HEADER_SIZE = 44;</span><span id="9bae" class="li lj in le b gy lo ll l lm ln">typedef uint8_t BYTE;</span><span id="a82e" class="li lj in le b gy lo ll l lm ln">typedef int16_t BYTE2;</span></pre><p id="167a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要运行程序，我们需要用户输入有 4 个命令行参数，如果不符合，我们返回。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8b31" class="li lj in le b gy lk ll l lm ln">int main(int argc, char *argv[])</span><span id="37f5" class="li lj in le b gy lo ll l lm ln">{</span><span id="e5d8" class="li lj in le b gy lo ll l lm ln">// Check command-line arguments</span><span id="4d8e" class="li lj in le b gy lo ll l lm ln">if (argc != 4)</span><span id="940f" class="li lj in le b gy lo ll l lm ln">{</span><span id="987d" class="li lj in le b gy lo ll l lm ln"> printf("Usage: ./volume input.wav output.wav factor\n");</span><span id="460a" class="li lj in le b gy lo ll l lm ln"> return 1;</span><span id="8294" class="li lj in le b gy lo ll l lm ln">}</span></pre><p id="e962" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们需要打开文件，文件在 C 中有它们自己的数据类型，所以在我们打开它之前，我们用一个文件数据类型声明输入变量，<code class="fe lp lq lr le b">input</code>指向内存中存储文件的地址，<code class="fe lp lq lr le b">fopen</code>接受用户在命令行上传递的文件名，<code class="fe lp lq lr le b">“r”</code>表示“只读取这个文件”。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="1fa8" class="li lj in le b gy lk ll l lm ln">// Open files and determine scaling factor</span><span id="525d" class="li lj in le b gy lo ll l lm ln">FILE *input = fopen(argv[1], "r");</span><span id="b15c" class="li lj in le b gy lo ll l lm ln">if (input == NULL)</span><span id="8c6f" class="li lj in le b gy lo ll l lm ln">{</span><span id="da1a" class="li lj in le b gy lo ll l lm ln">printf("Could not open file.\n");</span><span id="5850" class="li lj in le b gy lo ll l lm ln">return 1;</span><span id="78a0" class="li lj in le b gy lo ll l lm ln">}</span></pre><p id="ae8e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们需要用用户输入的第二个文件名创建输出文件，<code class="fe lp lq lr le b">fopen</code>也可以通过向它传入<code class="fe lp lq lr le b">“w”</code>参数来创建文件，这是为了读取和写入，<code class="fe lp lq lr le b">output</code>指向存储变量第一个字符的地址。</p><p id="1bce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建文件后，我们需要修改音频文件音量的因子，这是用户需要输入的第三个参数，命令行参数是字符串，所以我们需要用<code class="fe lp lq lr le b">atof</code>将其转换为 int，并存储在<code class="fe lp lq lr le b">factor</code>中</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="ff38" class="li lj in le b gy lk ll l lm ln">FILE *output = fopen(argv[2], "w");</span><span id="03ee" class="li lj in le b gy lo ll l lm ln">if (output == NULL)</span><span id="b73f" class="li lj in le b gy lo ll l lm ln">{</span><span id="246e" class="li lj in le b gy lo ll l lm ln"> printf("Could not open file.\n");</span><span id="bdf4" class="li lj in le b gy lo ll l lm ln"> return 1;</span><span id="39c3" class="li lj in le b gy lo ll l lm ln">}</span><span id="c88f" class="li lj in le b gy lo ll l lm ln">float factor = atof(argv[3]);</span></pre><p id="8452" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们需要读取我们打开的文件，首先我们创建一个变量，其数据类型为我们之前创建的 BYTE，即 44 字节长，称为<code class="fe lp lq lr le b">header</code>，该变量在内存中腾出空间来存储原始文件的头信息并复制到输出文件中。</p><p id="bf77" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我们读取带有<code class="fe lp lq lr le b">fread</code>的文件头，它有 4 个参数:1-读取数据的第一个内存字节的地址，2-将占用内存的字节大小(这将是我们的<code class="fe lp lq lr le b">HEADER_SIZE </code>常量)3-一次读取多少个该类型的文件，4-由<code class="fe lp lq lr le b">fopen</code>返回的文件的指针。然后用带有相同参数的<code class="fe lp lq lr le b">fwrite</code>,我们将头文件复制到输出文件。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d1f2" class="li lj in le b gy lk ll l lm ln">BYTE header[HEADER_SIZE];</span><span id="b439" class="li lj in le b gy lo ll l lm ln">fread(header, HEADER_SIZE, 1, input);</span><span id="78bf" class="li lj in le b gy lo ll l lm ln">fwrite(header, HEADER_SIZE, 1, output);</span></pre><p id="e73f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们需要将样本乘以<code class="fe lp lq lr le b">factor</code>来修改我们文件的容量，我们创建一个变量<code class="fe lp lq lr le b">sample</code>，其数据类型为我们之前创建的字节 2。</p><p id="9d4e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lp lq lr le b">fread</code>函数返回到目前为止它能够成功读取的字节数，我们将它用作 while 循环参数。因此，在 while 循环中，我们读取每个<code class="fe lp lq lr le b">int_16</code>直到没有为止，在每个循环中，我们将当前的<code class="fe lp lq lr le b">sample</code>乘以<code class="fe lp lq lr le b">factor</code>来修改音量，并将该值写入输出文件，在循环完成后，我们关闭文件。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8c3a" class="li lj in le b gy lk ll l lm ln">BYTE2 sample;</span><span id="e2ca" class="li lj in le b gy lo ll l lm ln">while(fread(&amp;sample, sizeof(BYTE2), 1, input))</span><span id="466a" class="li lj in le b gy lo ll l lm ln">{</span><span id="89d3" class="li lj in le b gy lo ll l lm ln"> sample *= factor;</span><span id="16e5" class="li lj in le b gy lo ll l lm ln"> fwrite(&amp;sample, sizeof(BYTE2), 1, output);</span><span id="df0a" class="li lj in le b gy lo ll l lm ln">}</span><span id="a2d5" class="li lj in le b gy lo ll l lm ln">// Close files</span><span id="3cd3" class="li lj in le b gy lo ll l lm ln">fclose(input);</span><span id="fbf1" class="li lj in le b gy lo ll l lm ln">fclose(output);</span><span id="a38e" class="li lj in le b gy lo ll l lm ln">}</span></pre></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><h1 id="15d1" class="lz lj in bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">完整的代码要点。</h1><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5f4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读，请鼓掌别忘了关注我:)。</p></div></div>    
</body>
</html>