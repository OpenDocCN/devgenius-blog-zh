<html>
<head>
<title>How to Write an ESLint Rule?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何写一个ESLint规则？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-write-a-es-lint-rule-2abdd9bfd327?source=collection_archive---------1-----------------------#2020-10-18">https://blog.devgenius.io/how-to-write-a-es-lint-rule-2abdd9bfd327?source=collection_archive---------1-----------------------#2020-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">软件工程师每天都在生产类似的代码。当我们计划更新这些重复的逻辑时，一个普通的工程师可能会将常见的逻辑提取到一个接口中。但是，一个杰出的工程师会采取额外的步骤:<strong class="jp ir">替换现有的用法，并阻止以这种方式编写的新代码</strong>。</p><p id="8959" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现这种预防，像<a class="ae ku" href="https://github.com/facebook/codemod" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> CodeMod </strong> </a>和Linter这样的工具开始发挥作用。在这篇文章中，我将与你分享建立一个电子邮件规则的基本步骤。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/8757195da175b470687079b84dfe89dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ggircq6A35oarfMWkWflcw.jpeg"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">来自<a class="ae ku" href="https://www.intercom.com" rel="noopener ugc nofollow" target="_blank">对讲机</a>的Img</figcaption></figure><h1 id="9225" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">什么是Linter？</h1><p id="6a66" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><strong class="jp ir">“To lint”</strong>就是对代码做静态分析，发现风格问题，潜在bug等。</p><p id="5810" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">linter是一个执行“林挺”并报告关于这种风格问题和错误的警告的程序。</p><blockquote class="mo"><p id="4045" class="mp mq iq bd mr ms mt mu mv mw mx kk dk translated">lint警告的一个例子是一行代码超过80个字符。</p></blockquote><h1 id="b91e" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw my ly lz ma mz mc md me na mg mh mi bi translated">ESLint是什么？</h1><p id="afc5" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">ESLint是JavaScript和<a class="ae ku" href="http://flow.org" rel="noopener ugc nofollow" target="_blank">流</a>的开源linter。它使用一个解析器将原始代码转换成<a class="ae ku" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" rel="noopener ugc nofollow" target="_blank">抽象语法树(AST) </a>。</p><h2 id="02de" class="nb lm iq bd ln nc nd dn lr ne nf dp lv jy ng nh lz kc ni nj md kg nk nl mh nm bi translated">大西洋时间</h2><p id="6f68" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">ESLint使用的AST表示称为<a class="ae ku" href="https://github.com/estree/estree/" rel="noopener ugc nofollow" target="_blank"> ESTree </a>。如果您以前从未见过AST是什么样子，它只是一个对象树，这些对象一起表示代码的结构。可视化和检查AST的最佳工具是<a class="ae ku" href="https://astexplorer.net/" rel="noopener ugc nofollow" target="_blank">AST Explorer</a>——这个工具将允许您输入任意代码并查看完整的AST。</p><h2 id="4532" class="nb lm iq bd ln nc nd dn lr ne nf dp lv jy ng nh lz kc ni nj md kg nk nl mh nm bi translated">ESLint是如何工作的？</h2><p id="f710" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">ESLint允许通过插件系统轻松定义自定义规则。这意味着我们可以用高性能的、精确的基于AST的规则替换所有基于正则表达式的规则。</p><p id="b48d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的lint规则将简单地返回一组“<strong class="jp ir">选择器</strong>”，ESLint将在AST遍历时对其进行分析和匹配。</p><p id="00c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择器可以像AST节点的名称一样简单(如<strong class="jp ir"><em class="nn">variable declaration</em></strong>)，也可以是类似于CSS选择器的无限复杂的匹配器。当选择器匹配时，ESLint将调用回调并传入与选择器匹配的节点。</p><h1 id="80da" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">编写一个ESLint规则</h1><p id="0a4c" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在这个例子中，如果一个函数有超过5个参数，我们将警告开发者。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi no"><img src="../Images/823a2ac0d65b235072b434e000887428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*D79xr7bfPWBqz1CfMzYVuA.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">Lint规则示例</figcaption></figure><p id="cddc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们告诉ESLint，对于每个<strong class="jp ir"> CallExpression </strong>，我们都要调用。节点<strong class="jp ir">是一个AST对象。</strong></p><p id="a22b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ESLint <a class="ae ku" href="http://eslint.org/docs/developer-guide/working-with-rules#the-context-object" rel="noopener ugc nofollow" target="_blank">为报告提供了一个上下文对象</a>，它还包含一些强大的实用函数，用于遍历令牌、评估范围和检查注释。</p><h2 id="8302" class="nb lm iq bd ln nc nd dn lr ne nf dp lv jy ng nh lz kc ni nj md kg nk nl mh nm bi translated">测试您的规则</h2><p id="4ac2" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">一旦我们完成了规则的定义，就该使用<a class="ae ku" href="https://github.com/eslint/eslint-tester" rel="noopener ugc nofollow" target="_blank"> eslint-tester </a>来测试有效和无效的情况了。请参见下面的示例。</p><p id="ea85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我们可以将这个测试集成到整体测试框架中，就像<a class="ae ku" href="http://jestjs.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> jest </strong> </a> <strong class="jp ir">一样。</strong></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi np"><img src="../Images/04edc7692efa40b7345025c2b1efe6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNC0JjiInXM7h5Q3pVz-Pg.png"/></div></div></figure><h1 id="8126" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">固定器</h1><p id="2e6f" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">理想情况下，lint规则应该附带一个单击修复程序，可以自动修复它报告的lint错误。</p><p id="afe0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得工程师更容易遵守lint规则，并为将来作为自动格式化的一部分自动修复lint错误打开了大门。</p><p id="0bde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于实现Fixer的细节，我将留给你在<a class="ae ku" href="https://eslint.org/docs/developer-guide/working-with-rules#applying-fixes" rel="noopener ugc nofollow" target="_blank"> ESLint官方指南</a>中探索。</p><h1 id="786f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结局</h1><p id="cea3" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">我们工作的本质是寻找模式，并通过编码将它们自动化。为了加速这个过程，我们需要杠杆，而Lint恰好是一个方便的工具。</p></div></div>    
</body>
</html>