<html>
<head>
<title>Map Reduce Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地图缩小示例</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/map-reduce-example-89bd529e4277?source=collection_archive---------10-----------------------#2022-11-03">https://blog.devgenius.io/map-reduce-example-89bd529e4277?source=collection_archive---------10-----------------------#2022-11-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4dd4582f147cbaf42c717ae593c0d107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SVFImkHHxPiB3So0cPoEQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">我是来拯救🦸‍♀️的</figcaption></figure><p id="9d64" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上一篇<a class="ae kx" href="https://medium.com/@prikshitsingla78/map-reduce-48f75605a299" rel="noopener">文章</a>中，我们了解了什么是 Map Reduce 及其阶段，还了解到它将一个键、值对作为输入，并将一个键、值对作为输出。该潜水了🌊深入地图，缩小和理解它，这样它会感觉更接近我们的心💖。</p><p id="64c4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们将借助一个例子来理解 Map Reduce。我们将<strong class="kb io">在一个大文件中统计每个词的频率</strong>📁使用 Map Reduce 编程模型。</p><h1 id="51b9" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">统计文件中每个单词的出现频率</strong></h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/38cd7f3cd6e45da14b9c0ca736efe509.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*qvrmKkhAryh0byp4glsmhQ.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">有这么多单词😵🔄</figcaption></figure><p id="02ab" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">假设我们有一个 500 MB 的文件(这个文件很大，只是为了计算，我们保持它很小🤭).</p><p id="771a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">文件预览</strong></p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/d44e41d413ee4d1ddec6d8098bf8f68f.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*ltEayK2Nloy7H7zXOjNFrg.png"/></div></figure><p id="228d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，如果我们只是手动操作，而忽略大小写的敏感性。解决方案将是</p><blockquote class="mc md me"><p id="fe05" class="jz ka mf kb b kc kd ke kf kg kh ki kj mg kl km kn mh kp kq kr mi kt ku kv kw ig bi translated">嗨:3</p><p id="0636" class="jz ka mf kb b kc kd ke kf kg kh ki kj mg kl km kn mh kp kq kr mi kt ku kv kw ig bi translated">你好:3</p><p id="ca3f" class="jz ka mf kb b kc kd ke kf kg kh ki kj mg kl km kn mh kp kq kr mi kt ku kv kw ig bi translated">如何:2</p><p id="6f5d" class="jz ka mf kb b kc kd ke kf kg kh ki kj mg kl km kn mh kp kq kr mi kt ku kv kw ig bi translated">分别是:1</p><p id="d3df" class="jz ka mf kb b kc kd ke kf kg kh ki kj mg kl km kn mh kp kq kr mi kt ku kv kw ig bi translated">你:2</p></blockquote><p id="ed6c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">手动操作的话，你必须检查每一个单词，并计算它在文件中出现的次数。在这里，我们只是在预览中看到文件的一部分，如果这个文件有<strong class="kb io">100 万字</strong>并且它太大(大约几 Pb 大小)以至于你的机器装不下它。然后你将如何计算其中每个单词的频率。假设你懂编程，你编写程序来计算频率，即使这样也要花很多时间才能得到结果，因为文件太大了😣。</p><p id="8a87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">地图缩小是我们的救星。让我们看看👀它将如何计算这个文件中每个单词的频率。</p><p id="efe7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Hadoop 默认的块大小是<strong class="kb io"> 128 MB </strong>。所以，我们将得到 500 MB /128 MB = <strong class="kb io"> 4 个块。</strong></p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/c69c9cd0a6f6bc0279970edd3229d3e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*fEBqZPPvNc4iUqttRaVSwA.png"/></div></figure><p id="3685" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们已经知道 Map Reduce 对键值对起作用，但是如果我们看到我们的<strong class="kb io">输入记录</strong>是 file.txt，它没有(key，value)对形式的数据。所以，我们必须使它们成为(键，值)对。这项工作可以在<strong class="kb io">记录阅读器的帮助下完成。</strong></p><h1 id="6b2f" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">唱片阅读器</h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/e2e45a5387ccaf081a44396eb9683d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVUVWjw-EfN1KvN1Ih0z2g.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">不要担心原始数据<strong class="bd la">记录阅读器</strong>会把你的地图还原回来🤣🤩</figcaption></figure><p id="ee74" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">记录读取器的作用是将每个输入行转换成适合映射器读取的(键，值)对。它将生成随机地址作为密钥🔑并以全线为价值。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/be4775141b9e7702ec73d8610aa5021c.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*rjLtSPY04mj-4OetMSK4yg.png"/></div></figure><p id="1fcb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，这个输入应该转到 mapper。映射器逻辑现在应该由开发人员编写。</p><p id="83bd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这些键与我们的逻辑相关吗？</p><p id="9adc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">不，所以我们应该只关注值的逻辑，应该忽略键，但只是为了逻辑的目的。因此，对于频率计数，首先要做的是，我们应该根据空间分割每个单词。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/d3532d976797917bb5e5244ae5d9bf5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*uCDv-7LcEy0WPoKp04-KXg.png"/></div></figure><p id="4888" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">正如我们所看到的，输出有分裂的词，每个词被计算一次。所以，到目前为止，我们并不关心这个单词是出现了 2 次还是 3 次，我们只是对每个单词进行计数，并将其计数为 1。我们将在<strong class="kb io"> Reduce 阶段完成这个聚合部分。</strong></p><p id="4065" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因为我们有<strong class="kb io"> 4 个数据块</strong>，所以运行的映射器数量应该是 4。<strong class="kb io">映射器的数量=数据块的数量。</strong>映射器的数量总是等于数据块的数量。但是，对于减速器来说，情况并非如此。</p><p id="f9c8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">假设我们有一个 4 节点集群。每台机器都会给我们类似的结果，如上图所示。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/97081b1cf27383e351586c142eab7568.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*oxwjrEMKShfRN58nAx7uQw.png"/></div></figure><p id="dbc4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你看，在上面的图中，我改变了上面例子中的单词。没什么好困惑的，只要想想这些是文件中的单词。如上图所示，我们只是看到了文件预览。现在，我们已经得到了所有映射器的映射器输出，现在是时候进入<strong class="kb io">减少阶段</strong>并最终得到我们的答案了。</p><h1 id="9544" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">洗牌和排序(简化阶段)</h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/d82b8e2fb6453950b2f175badcbad34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kS7u2oGqWFCYAy_NmmHobA.png"/></div></div></figure><p id="7550" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所有<strong class="kb io">映射器</strong>的输出到达另一个节点或 4 个节点之一。</p><p id="69f1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">映射器的输出从映射器到缩减器的移动被称为洗牌。</strong>洗牌是一个耗时的过程。因此，每当我们执行地图缩减工作时，我们会尽可能地避免洗牌，或者我们会尽量保持它不占用太多时间。甚至，有些任务不需要 reduce 部分，因此取消了洗牌。洗牌后，所有键值对都将在一台机器上</p><p id="622d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">洗牌后将会有<strong class="kb io">排序</strong>。排序将发生在 Reducer 机器上(运行 Reducer 逻辑的机器，这里是节点 5)。排序将按升序对键进行排序。</p><p id="e4f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这将作为减速器的输入。</p><p id="b02f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">(是，{1，1，1，1，1})</p><p id="0f6d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">(你好，{1，1，1})</p><p id="7aaa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">(怎么，{1，1，1})</p><p id="b98e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">(是，{1，1，1，1})</p><p id="f926" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">经过<strong class="kb io">排序</strong>后，所有相同的钥匙将会在一起。无序排序由 Map Reduce 框架本身负责。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/65dae9a837ce0a5a3bce527850bd5334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*Ytg0yMN7uKWw2B33WSP39w.png"/></div></figure><p id="54c9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">缩减器逻辑必须由开发人员编写。</p><p id="f18e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Reducer 逻辑→迭代列表和总结</p><h1 id="e782" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/29280d87e0b8df48358f8f62f689ce94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zxRbbk-LBK_g0yahcuaew.png"/></div></div></figure><p id="fe2d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">映射器提供并行性</p><p id="159c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">减速器聚集并给出最终输出</p><h1 id="378c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">下一步是什么…</h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/0fc7ffa2fe02c33ef27be8ff443a3dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WX0PBrb8jZnETWiBfAXATQ.jpeg"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">🤩🤩</figcaption></figure><p id="eedb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">瞧啊。💯我们刚刚使用<strong class="kb io"> Map Reduce </strong>逻辑解决了一个问题，并且我们能够一步一步地完成它。最初，我们在不同的机器上分离我们的数据，然后我们聚合它以得到答案。我希望你喜欢它。</p><p id="1e6a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下一次，我们将使用另一个例子，也将增加减速器的数量，问题将比这个更难。将来我们会编码👩🏻‍💻这种映射逻辑减少了词频工作。在那之前，玩得开心，享受你的一天😊。</p><p id="527a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们结束这个博客吧🤗暂时的！</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/8b59bd34472a3c7b9aaee762ed78ec4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emcKs7HqgjRaz3CfYLTvlg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">直到下次我们 meet🥰🥰</figcaption></figure><p id="d240" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">干杯🤗读者们，如果你们已经走了这么远..</p><p id="207e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">谢谢！为了阅读。</strong></p><p id="56d2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">如果你喜欢这个博客，请鼓掌回应👏</strong></p><p id="98fa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">跟随..☺️ </strong> <a class="ae kx" href="https://medium.com/@prikshitsingla78" rel="noopener"> <strong class="kb io">我</strong> </a> <strong class="kb io">更多这样有见地的 articles✍️ </strong></p><p id="1245" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">在评论中分享你的想法，并请分享对需要改进的部分的反馈，以便我下次改进。</strong></p><p id="849d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">祝大家愉快！</strong></p></div></div>    
</body>
</html>