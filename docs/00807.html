<html>
<head>
<title>How to generate a PDF document in a React Native project?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 React 原生项目中生成 PDF 文档？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-generate-a-pdf-document-in-a-react-native-project-b184e46ef67f?source=collection_archive---------1-----------------------#2020-06-17">https://blog.devgenius.io/how-to-generate-a-pdf-document-in-a-react-native-project-b184e46ef67f?source=collection_archive---------1-----------------------#2020-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c107" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">不久前，UppLabs 正在进行一个</em> <a class="ae km" href="https://upplabs.com/upplabs-created-healthcare-app-for-preventing-hair-loss/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">项目</em> </strong> </a> <em class="kl">该项目的关键功能包括在手机上生成 PDF。在这个由</em><a class="kn ko ep" href="https://medium.com/u/396872d0cc2f?source=post_page-----b184e46ef67f--------------------------------" rel="noopener" target="_blank"><em class="kl">Pavlo Ihnatiev</em></a><em class="kl">编写的材料中，我们将分享一些关于如何使用 React Native 生成 PDF 文档的技巧。</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/37babe0977dc598e76c9a1d9de91a26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8tHM3EZnuWId0PafVu_hA.png"/></div></div></figure><p id="9c5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初这份材料发表在<a class="ae km" href="https://upplabs.com/blog/how-to-generate-a-pdf-document-in-a-react-native-project/" rel="noopener ugc nofollow" target="_blank"> UppLabs 的博客</a>上。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="213b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">基础</h1><p id="ee3f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在 React 原生项目中创建 PDF 文档的最简单方法包括使用<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/print" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Expo Print </strong> </a>插件。</p><p id="b68e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是用应该在我们的 PDF 中的内容样本编写 HTML。您可以在标记中插入 CSS 样式、自定义字体、图像、链接等。</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="b265" class="mq lj iq mm b gy mr ms l mt mu">const htmlContent = `<br/>    &lt;!DOCTYPE html&gt;<br/>    &lt;html lang="en"&gt;<br/>    &lt;head&gt;<br/>        &lt;meta charset="UTF-8"&gt;<br/>        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>        &lt;title&gt;Pdf Content&lt;/title&gt;<br/>        &lt;style&gt;<br/>            body {<br/>                font-size: 16px;<br/>                color: rgb(255, 196, 0);<br/>            }</span><span id="f34d" class="mq lj iq mm b gy mv ms l mt mu">            h1 {<br/>                text-align: center;<br/>            }<br/>        &lt;/style&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;h1&gt;Hello, UppLabs!&lt;/h1&gt;<br/>    &lt;/body&gt;<br/>    &lt;/html&gt;<br/>`;</span></pre><p id="df19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您应该编写函数，使用定义的 HTML 标记创建 PDF 文档:</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="2d02" class="mq lj iq mm b gy mr ms l mt mu">import * as Print from 'expo-print';</span><span id="e101" class="mq lj iq mm b gy mv ms l mt mu">const htmlContent = `<br/>....<br/>`;</span><span id="daed" class="mq lj iq mm b gy mv ms l mt mu">const createPDF = async (html) =&gt; {<br/>    try {<br/>        const { uri } = await Print.printToFileAsync({ html });<br/>        return uri;<br/>    } catch (err) {<br/>        console.error(err);<br/>    }<br/>};</span></pre><p id="72f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意事项</strong>:</p><p id="f510" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此功能将创建一个 PDF 文件，并将其保存到应用程序缓存文件夹中。所以如果想替换或者复制这个文件，可以使用<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/filesystem" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Expo 文件系统</strong> </a>。如果想保存到设备上的图库，可以使用 Android 平台的<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/media-library" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Expo 媒体库</strong> </a>和 IOS 平台的<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Expo 分享</strong> </a>。</p><p id="3eb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">允许您创建 PDF 并将其保存到图库的函数示例:</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="11df" class="mq lj iq mm b gy mr ms l mt mu">import * as Print from "expo-print";<br/>import * as MediaLibrary from "expo-media-library";<br/>import * as Sharing from "expo-sharing";<br/></span><span id="a8ff" class="mq lj iq mm b gy mv ms l mt mu">....</span><span id="c2d2" class="mq lj iq mm b gy mv ms l mt mu">const createAndSavePDF = async (html) =&gt; {<br/>  try {<br/>    const { uri } = await Print.printToFileAsync({ html });<br/>    if (Platform.OS === "ios") {<br/>      await Sharing.shareAsync(uri);<br/>    } else {<br/>      const permission = await MediaLibrary.requestPermissionsAsync();</span><span id="999e" class="mq lj iq mm b gy mv ms l mt mu">      if (permission.granted) {<br/>        await MediaLibrary.createAssetAsync(uri);<br/>      }<br/>    }</span><span id="b22e" class="mq lj iq mm b gy mv ms l mt mu">  } catch (error) {<br/>    console.error(error);<br/>  }<br/>};</span></pre><p id="45b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在 React 本地组件中使用该功能，如果您需要创建一个包含简单内容的快速 PDF 文档，这就足够了。</p><h1 id="4ff5" class="li lj iq bd lk ll mw ln lo lp mx lr ls lt my lv lw lx mz lz ma mb na md me mf bi translated">高级案例</h1><h2 id="1f24" class="mq lj iq bd lk nb nc dn lo nd ne dp ls jy nf ng lw kc nh ni ma kg nj nk me nl bi translated">PDF 页面边距</h2><p id="9a84" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果您使用函数<strong class="jp ir">print . printtofilesync</strong>，生成的 PDF 文档可能包含页边距(取决于 WebView 引擎)。它们由<strong class="jp ir"> @page </strong>样式块设置，您可以在您的 HTML 内容代码中覆盖它们:</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="df70" class="mq lj iq mm b gy mr ms l mt mu">&lt;style&gt; <br/>   @page { margin: 20px; } <br/>&lt;/style&gt;</span></pre><h2 id="de88" class="mq lj iq bd lk nb nc dn lo nd ne dp ls jy nf ng lw kc nh ni ma kg nj nk me nl bi translated">避免破坏内容</h2><p id="ea7f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果您在 HTML 标记中插入几个内容部分，它们可能无法放在同一个文档页面上。在这种情况下，第二节的内容会中断，其中一部分内容会放到文档的下一页。但是当您希望避免破坏内容部分时，有时这种方法是不可接受的。</p><p id="4bf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了控制一些 HTML 元素的中断，你可以在你的 HTML 切片中使用<a class="ae km" href="https://css-tricks.com/almanac/properties/b/break-inside/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">【break-inside】</strong></a>CSS 属性。</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="23c0" class="mq lj iq mm b gy mr ms l mt mu">section {<br/>  break-inside: avoid;<br/>}</span></pre><p id="a70f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果两个部分不能放在同一个页面上，第二个部分将被放置在文档的下一页上而不会断开。</p><h2 id="f032" class="mq lj iq bd lk nb nc dn lo nd ne dp ls jy nf ng lw kc nh ni ma kg nj nk me nl bi translated">在 PDF 中使用字体、图像和其他资源</h2><p id="838e" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果它被远程放置，您可以在 HTML 中使用自定义字体、图像或其他资源，没有任何麻烦。但如果你想使用 React 原生应用资产中的图像，这可能是一个问题，因为当你的 React 原生应用为生产而构建时，这样的图像不能被加载到你的文档中。在这种情况下，您应该首先将文件从 assets 复制到应用程序的缓存目录中。不幸的是，在 IOS 平台上，本地文件也不能加载到 PDF，所以你应该将本地文件转换成<strong class="jp ir"> base64 </strong>字符串。之后，你可以在你的 HTML 标记中使用复制文件的 URL(Android 平台上)或者<strong class="jp ir"> base64 </strong>字符串(IOS 平台上)。</p><p id="bada" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，可以使用<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/asset/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Expo Asset </strong> </a>和<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/imagemanipulator" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Expo image manipulator</strong></a>。</p><p id="bb4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 PDF 文档中使用之前，从资产中复制图像并将其转换为 IOS 平台的<strong class="jp ir"> base64 </strong>的代码示例:</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="e83d" class="mq lj iq mm b gy mr ms l mt mu">import { Platform } from "react-native";<br/>import { Asset } from "expo-asset";<br/>import * as ImageManipulator from "expo-image-manipulator";<br/></span><span id="c1c3" class="mq lj iq mm b gy mv ms l mt mu">....</span><span id="8498" class="mq lj iq mm b gy mv ms l mt mu">const copyFromAssets = async (asset) =&gt; {<br/>  try {<br/>    await Asset.loadAsync(asset);<br/>    const { localUri } = Asset.fromModule(asset);</span><span id="9249" class="mq lj iq mm b gy mv ms l mt mu">    return localUri;<br/>  } catch (error) {<br/>    console.log(error);<br/>    throw err;<br/>  }<br/>};<br/></span><span id="1845" class="mq lj iq mm b gy mv ms l mt mu">const processLocalImageIOS = async (imageUri) =&gt; {<br/>  try {<br/>    const uriParts = imageUri.split(".");<br/>    const formatPart = uriParts[uriParts.length - 1];<br/>    let format;</span><span id="bedb" class="mq lj iq mm b gy mv ms l mt mu">    if (formatPart.includes("png")) {<br/>      format = "png";<br/>    } else if (formatPart.includes("jpg") || formatPart.includes("jpeg")) {<br/>      format = "jpeg";<br/>    }</span><span id="9ff1" class="mq lj iq mm b gy mv ms l mt mu">    const { base64 } = await ImageManipulator.manipulateAsync(<br/>      imageUri,<br/>      [],<br/>      { format: format || "png", base64: true }<br/>    );</span><span id="39ba" class="mq lj iq mm b gy mv ms l mt mu">    return `data:image/${format};base64,${base64}`;<br/>  } catch (error) {<br/>    console.log(error);<br/>    throw error<br/>  }<br/>};</span><span id="2fbe" class="mq lj iq mm b gy mv ms l mt mu">....</span><span id="fc0c" class="mq lj iq mm b gy mv ms l mt mu">const htmlContent = async () =&gt; {<br/>    try {<br/>        const asset = require('./assets/logo.png');<br/>        let src = await copyFromAssets(asset);<br/>        if(Platform.OS === 'ios') {<br/>            src = await processLocalImageIOS(src);<br/>        }</span><span id="9e0d" class="mq lj iq mm b gy mv ms l mt mu">        return `&lt;img src="${src}" alt="Logo" /&gt;`<br/>    } catch (error) {<br/>        console.log(error);<br/>    }<br/>}</span></pre><p id="d1b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，调用此代码后，您可以在 PDF 文档中使用资产图像的返回 URL。</p><h2 id="bcac" class="mq lj iq bd lk nb nc dn lo nd ne dp ls jy nf ng lw kc nh ni ma kg nj nk me nl bi translated">大型图像的优化</h2><p id="bbef" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果您想要在 PDF 文档中放置大图像，您应该先对其进行优化。它可以大大减小您的 PDF 文档的大小。当您想要插入使用设备摄像头拍摄的图像时，优化图像非常有用。要优化图像，您可以使用<a class="ae km" href="https://docs.expo.io/versions/latest/sdk/imagemanipulator" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Expo image manipulator</strong></a>。</p><p id="2a9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong>:这个插件只能处理本地设备上的图片。你需要先下载图像。</p><p id="4e4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">优化大型图像的函数示例:</p><pre class="kq kr ks kt gt ml mm mn mo aw mp bi"><span id="24b2" class="mq lj iq mm b gy mr ms l mt mu">import * as ImageManipulator from 'expo-image-manipulator';<br/></span><span id="a8ec" class="mq lj iq mm b gy mv ms l mt mu">....</span><span id="d926" class="mq lj iq mm b gy mv ms l mt mu">const optimizeImage = async (imageUri) =&gt; {<br/>  try {<br/>      const { uri } = await ImageManipulator.manipulateAsync(<br/>        imageUri,<br/>          [<br/>              {<br/>                  resize: {<br/>                      width: 600,<br/>                  },<br/>              },<br/>          ],<br/>          { compress: 0.1 },<br/>      );</span><span id="de1c" class="mq lj iq mm b gy mv ms l mt mu">      return uri;<br/>  } catch (error) {<br/>      console.log(error);<br/>      return imageUri;<br/>  }<br/>};</span></pre><h2 id="7a86" class="mq lj iq bd lk nb nc dn lo nd ne dp ls jy nf ng lw kc nh ni ma kg nj nk me nl bi translated">查例子！</h2><div class="nm nn gp gr no np"><a href="https://expo.io/@upplabs/upplabs-pdf-example" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">博览会上的 Upplabs PDF</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">描述扫描使用 Android 手机打开，您可以使用 Expo 移动应用程序扫描此二维码以加载此…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">世博会</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kz np"/></div></div></a></div><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="ca77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看案例研究:</p><div class="nm nn gp gr no np"><a href="https://upplabs.com/portfolio/hairmax/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">毛发学家防止脱发的手机应用程序。UppLabs</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">HairMax 是为毛发学家开发的移动应用程序，用于防止客户脱发。当客户…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">upplabs.com</p></div></div><div class="ny l"><div class="og l oa ob oc ny od kz np"/></div></div></a></div><p id="c02d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们希望这篇文章是有用的！你可以在我们的网站上阅读更多关于<a class="ae km" href="https://upplabs.com/expertise/mobile-development/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">移动开发</strong> </a>和<a class="ae km" href="https://upplabs.com/contacts/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">向 UppLabs 寻求帮助</strong> </a>开发你的移动应用。</p></div></div>    
</body>
</html>