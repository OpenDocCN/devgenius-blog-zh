<html>
<head>
<title>Complete Laravel 8 Authentication Using Laravel Fortify and Bootstrap 4 — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Laravel Fortify 和 Bootstrap 4 完成 Laravel 8 认证—第 2 部分</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/complete-laravel-8-authentication-using-laravel-fortify-and-bootstrap-4-part-2-d62ce4ed7577?source=collection_archive---------17-----------------------#2022-07-18">https://blog.devgenius.io/complete-laravel-8-authentication-using-laravel-fortify-and-bootstrap-4-part-2-d62ce4ed7577?source=collection_archive---------17-----------------------#2022-07-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/a407f43ff57d0d19dec766f4c8bd4805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Iz_MmI_sO2WZ8eL8"/></div></div></figure><div class=""/><p id="8417" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文的第 1 部分 中，我们使用 Laravel fortify 和 bootstrap 作为我们的前端框架，查看了注册和登录特性。</p><p id="0626" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文的第 2 部分，我们将深入研究身份验证系统的其余特性。</p><p id="08ed" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">让我们开始吧！</strong></p><p id="9547" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将目录更改为我们以前的项目，并为应用程序提供服务</p><p id="9ee5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">CD laravel 8 _ fortify _ with _ bootstrap</strong><strong class="jx iz">PHP artisan serve</strong></p><p id="3dd1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你最喜欢的编辑器上打开代码库，进入 fortify.php 文件</p><p id="8e07" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看电子邮件验证功能..取消注释 fortify.php 文件中电子邮件验证方法的功能</p><p id="a74a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">功能::emailVerification()，</strong></p><p id="606a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它会自动添加三个邮件验证路径(发送、通知和验证)</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ku"><img src="../Images/13793c3d32cd2d020ac63589cbd9e6f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mEtCp_swzMvoviK8"/></div></div></figure><p id="222a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来转到 Models 文件夹下的 User.php 模型，通过实现 MustVerifyEmail 接口来修改它</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="2c24" class="le lf iy la b gy lg lh l li lj">implements MustVerifyEmail</span></pre><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lk"><img src="../Images/59d3f1b31e5eeb656905537de9940754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9IP0UFTyZ2yGxki1"/></div></div></figure><p id="4af3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，配置您的首选电子邮件驱动程序，将电子邮件验证链接发送到用户邮件。</p><p id="afc1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">出于测试目的，您可以在<a class="ae kt" href="http://mailtrap.io" rel="noopener ugc nofollow" target="_blank"> mailtrap.io </a>上创建一个帐户，并在上配置邮件设置。环境文件</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="418c" class="le lf iy la b gy lg lh l li lj">MAIL_DRIVER=smtp <br/>MAIL_HOST=smtp.mailtrap.io <br/>MAIL_PORT=2525 <br/>MAIL_USERNAME= <br/>MAIL_PASSWORD= <br/>MAIL_ENCRYPTION=tls <br/>MAIL_FROM_ADDRESS="your@gmail.com" <br/>MAIL_FROM_NAME="${APP_NAME}"<!-- --> </span></pre><p id="b306" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，在 web.php 文件中指定在用户通过验证之前不可访问的路由</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="d858" class="le lf iy la b gy lg lh l li lj">Route::middleware(['auth',  'verified'])-&gt;group(function () {<br/>    Route::view('home', 'home')-&gt;name('home');<br/>});</span></pre><p id="3f37" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，在 fortify 服务提供者内部，实例化在成功注册后返回验证视图的方法</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="c280" class="le lf iy la b gy lg lh l li lj">Fortify::verifyEmailView(function () {<br/>        return view('auth.verify'); <br/>   });</span></pre><p id="46cc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">接下来刷新浏览器。注册成为用户。检查 mailtrap 收件箱以查看用于验证电子邮件的邮件。</strong></p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ll"><img src="../Images/05ef73618c38e2ecd27698e489964392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k89wzKNbjIqUGWkE"/></div></div></figure><p id="14b8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">全部工作！！</strong>让我们继续重置密码功能</p><p id="7e20" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">浏览器上的登录视图没有忘记密码链接，因为该功能已被禁用</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lm"><img src="../Images/b2da42fe45607d9b46a775bdbf74a643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tw4j2qc6Po1v0m48"/></div></div></figure><p id="79ff" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">取消 fortify.php 文件中重置密码特性</strong>的注释</p><p id="046c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">刷新您的浏览器，您将在视图中看到忘记密码链接</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ln"><img src="../Images/d02e8131e7487f1dfcff9138fd3691fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HNz9WDxHxAUJPVjU"/></div></div></figure><blockquote class="lo lp lq"><p id="4e70" class="jv jw lr jx b jy jz ka kb kc kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ks ig bi translated"><em class="iy">如果路由有 password.request 链接，显示重置密码的链接。</em></p></blockquote><p id="5ed3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，让我们定义 FortifyServiceProvider.php 文件中的密码重置视图</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="1716" class="le lf iy la b gy lg lh l li lj">Fortify::requestPasswordResetLinkView(function () {<br/>        return view('auth.passwords.email');<br/>   });</span></pre><p id="d3b0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在 auth/passwords 文件夹中创建一个新的文件 email.blade.php。对<strong class="jx iz">email.blade.php</strong>文件的看法是在<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank">上<strong class="jx iz"> Github 回购</strong>上</a></p><p id="41bc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">进入浏览器，刷新并点击忘记密码链接</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lv"><img src="../Images/c32b379a71cc8a4de8213bebc87c87e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oEAGEPYzoysBE-W8"/></div></div></figure><p id="cf50" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">输入电子邮件并点击发送密码重置链接。检查邮件陷阱收件箱，查看重置密码的邮件。</strong></p><p id="64ca" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来定义在邮件中单击重置链接时密码重置视图的方法</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="478c" class="le lf iy la b gy lg lh l li lj">Fortify::resetPasswordView(function ($request) {<br/>      return view('auth.passwords.reset', ['request' =&gt; $request]);<br/>   });</span></pre><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lw"><img src="../Images/19525697ec58cd2a6c9d9c852e0327d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xuQC2tAUsvdZuIqr"/></div></div></figure><p id="1262" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建 reset.blade.php 文件，并使用 bootstrap 对所需的视图进行编码，但是如果您打算继续，请从<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>中获取视图</p><p id="13ca" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">重置密码到此为止。出于定制的目的，您可以查看 laravel 文档。</p><p id="0c19" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看更新密码功能..取消对 fortify.php 上更新密码功能的注释</p><p id="56c3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">功能::更新密码()，</strong></p><blockquote class="lo lp lq"><p id="acf2" class="jv jw lr jx b jy jz ka kb kc kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ks ig bi translated"><em class="iy">定义查看密码更新的路线</em></p></blockquote><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="3ddf" class="le lf iy la b gy lg lh l li lj">Route::middleware(['auth',  'verified'])-&gt;group(function () {<br/>    Route::view('home', 'home')-&gt;name('home');<br/>    Route::view('password/update', 'auth.passwords.update')-&gt;name('passwords.update');<br/>});</span></pre><p id="3ef7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">update.blade.php 视图在<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>上可用</p><p id="d62a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到您的浏览器并刷新。填写当前密码、所需的新密码并提交。</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lx"><img src="../Images/72802b2b7804de70189826ce8e5c4fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F86uCJcfybyTs9Jd"/></div></div></figure><p id="cb16" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来是 2FA —双因素身份认证，这是我们将在本教程中实施的最后一项功能。</p><p id="8556" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">取消注释 fortify.php 文件中的 twoFactorAuthentication 方法</p><p id="2090" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">特性::two factor authentic ation([' confirm password ' =&gt;true，])，</strong></p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/fdf746f57f90cb11a5c4e8b41f814953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/0*mmCgMDMZSaDPa0oq"/></div></figure><p id="6507" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们不希望用户在 2FA 期间输入他们的密码，我们可以将 confirmPassword 值设置为 false</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="df06" class="le lf iy la b gy lg lh l li lj">Features::twoFactorAuthentication([ 'confirmPassword' =&gt; false, ]),<!-- --> </span></pre><p id="c978" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，为了实现 2FA，我们需要将特征添加到用户模型中</p><p id="9f15" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意:laravel 的一个优点是，您可以根据自己的需要决定修改我们的 code a 特性，而不必像框架所提供的那样做。它可以用于除用户模型之外的任何模型。重要的是在表中定义将要使用的字段。</p><p id="7daa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开用户模型文件以添加 2FA 特征</p><blockquote class="lo lp lq"><p id="e2e6" class="jv jw lr jx b jy jz ka kb kc kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ks ig bi translated"><em class="iy">两个可认证的工厂</em></p></blockquote><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lz"><img src="../Images/ad47930370cca52e228335d45da60032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u9A3Dsav5kE9qgJp"/></div></div></figure><p id="8b42" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们取消 fortify.php 文件中 2FA 特性的注释时，已经定义了执行 2FA 时表单提交的路径。运行“管线列表 artisan”命令查看已定义的管线。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ef01" class="le lf iy la b gy lg lh l li lj">php artisan route:list</span></pre><blockquote class="lo lp lq"><p id="9267" class="jv jw lr jx b jy jz ka kb kc kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ks ig bi translated"><em class="iy">这是路由/用户/双因素认证，用于 2FA 确认 post 请求</em></p></blockquote><p id="0e07" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用户表有两列，称为双因素保密和双因素恢复代码，它们指定用户是否做了 2FA。</p><p id="f45d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我们将检查 2FA 是禁用还是启用，并创建一个表单来根据用户的需要切换 2FA 的状态。</p><p id="a102" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将为 2FA 禁用/启用功能修改我们的 home.blade.php 视图文件，这可以在<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>上找到</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="2172" class="le lf iy la b gy lg lh l li lj">&lt;form method="post" action="/user/two-factor-authentication"&gt;<br/>        <a class="ae kt" href="http://twitter.com/csrf" rel="noopener ugc nofollow" target="_blank">@csrf</a><br/>        <a class="ae kt" href="http://twitter.com/if" rel="noopener ugc nofollow" target="_blank">@if</a> (auth()-&gt;user()-&gt;two_factor_secret)<br/>        <a class="ae kt" href="http://twitter.com/method" rel="noopener ugc nofollow" target="_blank">@method</a>('DELETE')<br/>        &lt;div class="pb-3"&gt;<br/>        {!! auth()-&gt;user()-&gt;twoFactorQrCodeSvg() !!}                                <br/>        &lt;/div&gt;<br/>        &lt;button class="btn btn-danger"&gt;<br/>        Disable<br/>        &lt;/button&gt;<br/>        <a class="ae kt" href="http://twitter.com/else" rel="noopener ugc nofollow" target="_blank">@else</a><br/>        &lt;button class="btn btn-success"&gt;<br/>        Enable<br/>        &lt;/button&gt;<br/>        <a class="ae kt" href="http://twitter.com/endif" rel="noopener ugc nofollow" target="_blank">@endif</a><br/>       &lt;/form&gt;</span></pre><p id="f40b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是重新加载页面后用户仪表板的图像</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ma"><img src="../Images/d897bf48c56af1ac552876544c2ea55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QNA0HpEqATrrSUdU"/></div></div></figure><p id="8ee6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击“enable”按钮后，它会询问用户密码。因为我们将“confirm password”设置为 true，所以我们需要定义“confirm password”的视图，以确保启用它的是帐户的所有者，方法是在 Fortify service provider 中实例化该方法，并在“views”文件夹中创建 confirm-password.blade.php 文件。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="7274" class="le lf iy la b gy lg lh l li lj">Fortify::confirmPasswordView(function () {<br/>       return view('auth.password-confirm'); <br/>   });</span></pre><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mb"><img src="../Images/c71bb711b58935468a1687a4bdb14967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ibVSk9Jycmi1S_Y"/></div></div></figure><p id="b051" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">成功启用 2FA 后，它会返回并显示两个密码。</p><p id="fbcb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以使用<strong class="jx iz"> twoFactorQrCodeSvg() </strong>显示二维码，供用户使用 QR scanner app 扫描，并在登录时启用 2FA 进行后续认证后获取密码。</p><p id="f020" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将检查 2FA 启用或禁用时来自服务提供商的会话消息，并通知用户</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="9c78" class="le lf iy la b gy lg lh l li lj"><a class="ae kt" href="http://twitter.com/if" rel="noopener ugc nofollow" target="_blank">@if</a> (session('status') == "two-factor-authentication-disabled")<br/>       &lt;div class="alert alert-danger" role="alert"&gt;<br/>       Two factor authentication has been disabled<br/>        &lt;/div&gt;<br/>        <a class="ae kt" href="http://twitter.com/endif" rel="noopener ugc nofollow" target="_blank">@endif</a></span><span id="d964" class="le lf iy la b gy mc lh l li lj"><a class="ae kt" href="http://twitter.com/if" rel="noopener ugc nofollow" target="_blank">@if</a> (session('status') == "two-factor-authentication-enabled")<br/>        &lt;div class="alert alert-success" role="alert"&gt;<br/>        Two factor authentication has been enabled<br/>        &lt;/div&gt;<br/>        <a class="ae kt" href="http://twitter.com/endif" rel="noopener ugc nofollow" target="_blank">@endif</a></span></pre><p id="0d3b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">启用 2FA 后，它会显示下图</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi md"><img src="../Images/b5ebec9a50670ae579ad6cdf5aee64ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*of-FUy1FE9fy_dkg"/></div></div></figure><p id="8834" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们注销并再次尝试登录时，它会要求 QR 扫描仪提供 2FA 密码</p><p id="ceed" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当启用了 2FA 的用户想要登录时，我们需要在服务提供者中定义方法来返回我们将创建的视图。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="bc0f" class="le lf iy la b gy lg lh l li lj">Fortify::twoFactorChallengeView(function () {<br/>            return view('auth.two-factor-challenge'); <br/>        });</span></pre><p id="a9d8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">two-factor-challenge.blade.php 文件查看详见<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank"> Github 回购</a></p><p id="e054" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为我们使用的是密码，所以我们需要显示一个表单来验证用户，登录后在 two-factor-challenge.blade.php 中询问密码。</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi me"><img src="../Images/600a4075af777ca84eee75725260cbe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iasonwUXeOh0RivZ"/></div></div></figure><p id="6a6b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当用户输入密码并点击登录时，它会验证用户是否正确，或者将他们重定向到登录页面。</p><p id="9dfb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，在我们没有扫描二维码的设备的情况下，让我们显示恢复码，供用户存储在安全的地方。</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mf"><img src="../Images/f38bd059da89daff2a37922f9449c500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nyHayeVQ1OI9TR6G"/></div></div></figure><p id="e6f3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">数据库中存储的双因子恢复码可以被解密，然后解码成数组供用户复制..</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="f9d7" class="le lf iy la b gy lg lh l li lj">json_decode(decrypt(auth()-&gt;user()-&gt;two_factor_recovery_codes)</span></pre><p id="98d6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">修改 home.blade.php 以显示恢复代码</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="9c2c" class="le lf iy la b gy lg lh l li lj">&lt;div class="mt-4"&gt;<br/>&lt;h3&gt;Recovery Codes&lt;/h3&gt;<br/>&lt;ul class="list-group mb-2"&gt;<br/>    <a class="ae kt" href="http://twitter.com/foreach" rel="noopener ugc nofollow" target="_blank">@foreach</a> (json_decode(decrypt(auth()-&gt;user()-&gt;two_factor_recovery_codes)) as $code)<br/>    &lt;li class="list-group-item"&gt;{{ $code }}&lt;/li&gt;<br/>    <a class="ae kt" href="http://twitter.com/endforeach" rel="noopener ugc nofollow" target="_blank">@endforeach</a><br/>&lt;/ul&gt;<br/>&lt;/div&gt;</span></pre><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mg"><img src="../Images/252dc2ef77d961b14a1860f1bc15d1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V9vsmJM0IhWzUmPE"/></div></div></figure><p id="596f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">刷新浏览器并启用了 2FA</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mh"><img src="../Images/88851593d8cc0453dc6aece2499c5997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uz4GfFyZKMtOZtFm"/></div></div></figure><p id="b4bb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将修改 app.blade.php 文件，为自定义脚本和 home.blade.php 文件添加一个 yield 方法，以允许用户切换双因素代码来提交身份验证。</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mi"><img src="../Images/60aa34051df379e51b4f65f9af5887bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kRfyU5bolOYCFtVK"/></div></div></figure><p id="4689" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来编写脚本，根据用户请求隐藏或显示表单</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/2e414f15002ae037f6687d1e7a4c2c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MKgnZDJ6GvePNDWn"/></div></div></figure><p id="dbca" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">更新后的 home.blade.php 视图可在<a class="ae kt" href="https://github.com/RaphAlemoh/laravel8_fortify_with_bootstrap" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>上获得</p><p id="5b25" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">请注意，您不能使用两次密码或恢复码</strong></p><blockquote class="lo lp lq"><p id="67f0" class="jv jw lr jx b jy jz ka kb kc kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ks ig bi translated"><em class="iy">刷新浏览器选择首选的 2FA 认证选项并登录</em></p></blockquote><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mk"><img src="../Images/c27c9e2d58e7f192bac675f69faa114d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sH4eH0oj-4rKhD6o"/></div></div></figure><p id="f0f6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击“使用恢复代码”以显示提交恢复代码的表格</p><figure class="kv kw kx ky gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ml"><img src="../Images/da252c7f104395caaafa9d7459ad7642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SQI7FOaLMUsMEqBg"/></div></div></figure><p id="601e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输入密码或恢复码，2FA 认证就完成了！！赞成</p><p id="886e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜我们使用 Laravel Fortify 和 Bootstrap 4 完成了 Laravel 8 中的认证系统！！！</p><p id="44b8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是<a class="ae kt" href="https://raphealenike.medium.com/complete-laravel-8-authentication-using-laravel-fortify-and-bootstrap-4-part-1-87234225979d" rel="noopener"> <strong class="jx iz">第 1 部分</strong> </a>的链接</p><p id="035d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您阅读这篇文章。请随意在评论区提问、回答和投稿。</p><p id="38a3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你喜欢这篇文章，请在 twitter 上关注我</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><p id="50f5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lr">原发布于</em><a class="ae kt" href="https://alemsbaja.hashnode.dev/complete-laravel-8-authentication-using-laravel-fortify-and-bootstrap-4-part-2" rel="noopener ugc nofollow" target="_blank"><em class="lr">https://alemsbaja . hashnode . dev</em></a><em class="lr">。</em></p></div></div>    
</body>
</html>