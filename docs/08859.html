<html>
<head>
<title>Big Data File formats</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大数据文件格式</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/big-data-file-formats-d980f5d07e44?source=collection_archive---------3-----------------------#2022-07-15">https://blog.devgenius.io/big-data-file-formats-d980f5d07e44?source=collection_archive---------3-----------------------#2022-07-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/a96685b0cf9542013ca6471ad6db590b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QlD4utNjjEOUQYiWhe9hkw.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">照片由<a class="ae ja" href="https://unsplash.com/@alfonsmc10?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿尔方斯·莫拉莱斯</a>在<a class="ae ja" href="https://unsplash.com/s/photos/library?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><div class=""/><p id="74d7" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">文件格式规定了如何记录信息，使用正确的格式可以很容易地找到相关数据。</p><blockquote class="ky"><p id="aa61" class="kz la jd bd lb lc ld le lf lg lh kx dk translated"><em class="li">文件格式是一种组织数据集文件的方式，将它们呈现为单个“表格”。</em></p></blockquote><p id="daee" class="pw-post-body-paragraph ka kb jd kc b kd lj kf kg kh lk kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx ig bi translated">多年来，新的文件格式不断发展，填补了旧格式的空白。下图显示了多年来新文件格式创建的进展。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lo"><img src="../Images/d2f0c9bf14ddccb64df2c1fdf3773571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zzavqXD287CyyqhO9TKU7g.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">不同的文件格式</figcaption></figure><p id="dfa8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于数据工程师来说，选择正确的文件格式是至关重要的决定之一。主要关注的是减少从其位置找到相关数据所需的时间。做出此决定时，需要考虑以下各个方面:</p><blockquote class="lt lu lv"><p id="6213" class="ka kb lw kc b kd ke kf kg kh ki kj kk lx km kn ko ly kq kr ks lz ku kv kw kx ig bi translated">读写吞吐量<br/>压缩能力和因素<br/>模式演变<br/>文件的可分割性<br/>互操作性<br/> ACID 支持<br/>使用模式，如 OLAP 扫描<br/>文本与二进制</p></blockquote><p id="27db" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据数据在磁盘上的存储方式，文件格式分为两大类。</p><h2 id="80d7" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated">面向行</h2><p id="0b37" class="pw-post-body-paragraph ka kb jd kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">逐行写入数据<strong class="kc je">，即一行中所有列一个接一个。这些都是写</strong>非常<strong class="kc je">高效的。它提供了水平分区，非常适合需要一整行增量更新的 OLTP 工作负载。</strong></p><h2 id="3617" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated">面向列</h2><p id="07ad" class="pw-post-body-paragraph ka kb jd kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">数据被一列接一列地写入<strong class="kc je">。因此，如果我们需要选择某些列，这种文件格式在读取选择性数据时非常有效。但是，写得慢。由于相似的数据被写在一起，它提供了一个<strong class="kc je">更高的压缩级别</strong>。提供数据的垂直分区。非常适合需要整列的 OLAP 工作负载。</strong></p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi my"><img src="../Images/1817d1ba05c91fd6b175ea91b43753bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2EITsZA1cYkkTFYFlr9i8w.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">行和列文件格式中的数据组织</figcaption></figure><p id="2042" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lw">注意:ORC 和 parquet 的较新实现通过使用行组概念使用磁盘存储的混合方法。因此，数据被垂直和水平分割。</em></p><p id="9da1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，基于文件上的数据格式，格式可以分为两类二进制或文本。机器读取的文件格式是以二进制格式编写的，而 JSON 和 CSV 等格式是以人类可读的文本形式存储的。</p><p id="99e2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将看看流行的和相对较新的，即 Avro，ORC，拼花地板</p><h2 id="bf63" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><a class="ae ja" href="https://avro.apache.org/docs/1.2.0/#intro" rel="noopener ugc nofollow" target="_blank"> AVRO </a></h2><p id="c5a4" class="pw-post-body-paragraph ka kb jd kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">Avro 是一种基于行的存储格式，广泛用于序列化。它将模式作为 JSON 存储在文件头中。数据以二进制格式保存，从而最小化文件大小并优化性能。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mz"><img src="../Images/a50172c4fd0873ccd268ff9119601a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xkqwnKqg44joXSluYWxMg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">AVRO 的文件结构</figcaption></figure><pre class="lp lq lr ls gt na nb nc bn nd ne bi"><span id="78b9" class="nf mb jd nb b be ng nh l ni nj">from fastavro import writer, reader, parse_schema<br/>avro_records = []<br/><br/>with open('customers.avro', 'rb') as fa:<br/>    avro_reader = reader(fa)<br/>    for record in avro_reader:<br/>        avro_records.append(record)<br/>        <br/>df_avro = pd.DataFrame(avro_records)</span></pre><h2 id="5953" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><a class="ae ja" href="https://parquet.apache.org/docs/file-format/" rel="noopener ugc nofollow" target="_blank">镶木地板</a></h2><p id="5b31" class="pw-post-body-paragraph ka kb jd kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">Parquet 是一种开源的、面向列的数据文件格式。拼花文件是自描述的。拼花文件由行组、页眉和页脚组成。每个行组包含来自相同列的数据。相同的列一起存储在每个行组中。拼花文件将模式存储在页脚中。页脚还包括每个行组的详细信息(总大小、行数、最小/最大统计信息、每列的空值数量)。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nk"><img src="../Images/33014188371c55c0268c960603889b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQfkVeqRjYFYaoEIaIIEjg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">拼花地板的文件结构</figcaption></figure><blockquote class="lt lu lv"><p id="8abd" class="ka kb lw kc b kd ke kf kg kh ki kj kk lx km kn ko ly kq kr ks lz ku kv kw kx ig bi translated">行组— 128Mb <br/>页面— 1Mb</p></blockquote><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/72526ff32b182b5e037c2730a1256f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*2iE50LWPHC6CgzJNLGCIgw.png"/></div></figure><p id="fe9b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">拼花文件使用不同的编码技术(如游程编码、字典编码、位打包和增量编码)和压缩来优化存储。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/44f4d6ad46f99ba3f47ff9cb7768f3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*ciNy8N7RBTEJuaMFxMynug.jpeg"/></div></figure><pre class="lp lq lr ls gt na nb nc bn nd ne bi"><span id="c0f7" class="nf mb jd nb b be ng nh l ni nj">import pyarrow.parquet as pq<br/>df = pq.read_table('customers.parquet')<br/>pq.write_table(df, 'customers.parquet')</span></pre><h2 id="242b" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated"><a class="ae ja" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC" rel="noopener ugc nofollow" target="_blank">优化的行柱状(ORC) </a></h2><p id="249d" class="pw-post-body-paragraph ka kb jd kc b kd mt kf kg kh mu kj kk kl mv kn ko kp mw kr ks kt mx kv kw kx ig bi translated">这种格式旨在克服其他 Hive 文件格式的限制。当 Hive 读取、写入和处理数据时，使用 ORC 文件可以提高性能。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nn"><img src="../Images/f213cfda139f2431d1a4cad24a93bbfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9h9Cqaktsw-K69I9R5I-6w.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk translated">ORC 的文件结构</figcaption></figure><p id="3d6f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在 ORC 文件格式中，我们有条带，它是行组的集合。条带大小为 250 MB，每个行组包含 10K 行。</p><p id="8efd" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种格式也有多级索引。因此，它在读取时非常快，并跳过不必要的数据。</p><h2 id="ba71" class="ma mb jd bd mc md me dn mf mg mh dp mi kl mj mk ml kp mm mn mo kt mp mq mr ms bi translated">摘要</h2><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/ea7bf05433e0aa8f97397f1c5ec9ca34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHidDSnMysrUqoiWTVQegw.png"/></div></div></figure><p id="4ab3" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">快乐阅读！！</p></div></div>    
</body>
</html>