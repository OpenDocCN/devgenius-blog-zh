<html>
<head>
<title>How to Handle Errors Gracefully in Our Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何优雅地处理应用程序中的错误</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-handle-errors-gracefully-in-our-apps-31fbfd3f68c5?source=collection_archive---------36-----------------------#2020-06-14">https://blog.devgenius.io/how-to-handle-errors-gracefully-in-our-apps-31fbfd3f68c5?source=collection_archive---------36-----------------------#2020-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cf1b8f2c6d7d108454edd48230b470f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pq2Tn1zdfG5YL-pJ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">约翰·西门子在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="28b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的应用程序中优雅地处理错误，确保故障会很快被注意到，这样用户或开发人员就可以修复出现的问题。</p><p id="2068" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何以一种优雅的方式处理错误，使修复它们变得更容易。</p><h1 id="66aa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提前崩溃</h1><p id="50e3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的程序应该尽早崩溃，这样我们就可以尽早发现问题。</p><p id="c236" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们不应该让程序继续向数据库写入无效数据，而是应该检查数据是否被写入并在写入之前抛出错误。</p><p id="9e5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，用户可以正确地重新输入数据，然后将其保存到数据库中。</p><p id="dc81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦它在数据库中，那么我们将不得不去数据库修复它，这是非常困难的。</p><p id="c5bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果很多人输入了无效数据，而我们却让他们保存这些数据，那么很可能无法快速修复，这对每个人来说都是一场噩梦。</p><p id="591b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大多数语言中，我们可以抛出异常来抛出错误。那么我们马上就会发现这个错误。</p><h1 id="8fc4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">断言编程</h1><p id="3814" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们不允许发生的事情不能发生，我们应该使用断言。</p><p id="fe92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们不允许某个东西被<code class="fe me mf mg mh b">null</code>，那么我们应该在程序或函数继续运行之前检查它。</p><p id="5e01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就不会让无效值在我们的系统中传播。</p><h1 id="347e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">保持断言打开</h1><p id="a2fc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">断言不会增加代码的开销。此外，我们不应该假设断言仅仅是由代码中的错误触发的。</p><p id="b934" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它也可以由用户错误触发。因此，我们应该在任何环境下都让它们开着。</p><p id="ffa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，关闭它们不会为我们节省任何资源，但会给我们带来很多问题。</p><p id="6581" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不应该有有副作用的断言。这样，我们就知道我们要检查的正是我们要检查的。</p><p id="7f3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在运行断言时产生副作用，那么我们可能会做一些我们没有预料到的事情，并检查副作用，即使我们检查了它们，我们也会遇到问题。</p><h1 id="e6e0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">何时使用异常</h1><p id="67c2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">只要有可能，就应该使用异常。例如，<code class="fe me mf mg mh b">try...catch</code>块比使用<code class="fe me mf mg mh b">if</code>和<code class="fe me mf mg mh b">else</code>来检查不同函数返回的状态代码要干净得多。</p><p id="9530" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果这些函数抛出异常，而不是返回错误值，那么如果我们捕捉到它们，然后优雅地处理它们，就会使我们的代码更加整洁。</p><p id="cd68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当运行的代码可能出现错误时，我们应该使用它们。例如，如果一个函数在检查文件是否存在时抛出一个异常，那么我们需要捕捉错误并处理它。</p><p id="3984" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果文件必须在那里，那么我们可以在它不在那里的时候捕捉异常。如果它是可选的，那么我们可以检查文件是否存在，如果存在就运行一些代码。</p><p id="fb18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在任何地方抛出和捕捉异常的程序都会遇到可读性和可维护性问题，因为当抛出异常时，它们会从一个地方跳到另一个地方。</p><p id="1671" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，封装被破坏了，因为它们通过处理异常更紧密地耦合在一起。</p><h1 id="0e29" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">错误处理程序是一种替代方法</h1><p id="e0bc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以编写错误处理函数来优雅地处理错误，而不是到处抛出和捕捉异常。</p><p id="ec59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在任何语言中使用它们，因为它们只是常规函数。</p><p id="f099" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们可以在一个中心位置处理所有的错误。我们可以只写一个错误处理程序，并在任何地方使用它们。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/002a9fab2c2ec557ebf688fb713aa204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M65s-viO4dmUPkCD"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Jacob Mejicanos 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="e5f1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">清理资源</h1><p id="942c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的程序应该在需要的时候自我清理。例如，如果我们的程序将临时文件写入文件系统，那么我们应该在程序完成时清理它们。</p><p id="4cc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也包括当错误发生时程序结束的情况。我们必须确保在这种情况下释放资源。</p><p id="b708" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，在我们的程序运行多次后，我们就不会有很多未使用的临时文件。</p><p id="71d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，如果我们程序的顶层结构负责清理资源，那么我们应该让他们去做。</p><p id="0f3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有，那么我们的代码应该为他们做这件事。</p><h1 id="f040" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e96c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的程序应该优雅地处理错误，并在使用后清理资源。</p><p id="1806" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，错误应该尽早显示出来，以便相关人员可以更快地采取行动。</p></div></div>    
</body>
</html>