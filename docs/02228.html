<html>
<head>
<title>Making an Accessible Exchange Rate Ticker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作一个可访问的汇率报价机</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-an-accessible-exchange-rate-ticker-1645a9671ece?source=collection_archive---------10-----------------------#2020-07-24">https://blog.devgenius.io/making-an-accessible-exchange-rate-ticker-1645a9671ece?source=collection_archive---------10-----------------------#2020-07-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6801" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为这是正确的选择。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e183c9d95d95627840c82653810e2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*McqcL7JdHq2j5sImxvv1lQ.gif"/></div></div></figure><p id="799d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ku" href="https://medium.com/dev-genius/exchange-rate-ticker-for-ios-b7e279b35c8f" rel="noopener">之前</a>我们讨论了如何设计和开发一个股票交易所。在这里，我们将使用动态文本和画外音使我们的 ticker 易于访问。</p><h1 id="c827" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">动态文本</h1><p id="a550" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">动态文本是操作系统的辅助功能，允许用户在整个操作系统中控制文本的大小。</p><blockquote class="ly lz ma"><p id="c0f6" class="jk jl mb jm b jn jo jp jq jr js jt ju mc jw jx jy md ka kb kc me ke kf kg kh ig bi translated">更改操作系统字体的大小。转到<em class="in">设置</em> app，然后转到<br/> <em class="in">辅助功能</em>-&gt;-<em class="in">显示&amp;文字</em>-&gt;-<em class="in">大图文字。</em> <br/>底部的滑块允许您更改文本大小。向右滑动以查看文本变化。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/d1d7488779e279471d14b23fccf3beda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mr4qJ7wleOny-KC0XW_YaA.jpeg"/></div></div></figure><p id="9f60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先让我们开始更新我们的字体来使用<code class="fe mg mh mi mj b">UIFontMetrics</code>。转到<strong class="jm io"> CurrencyView.swift </strong>，在<code class="fe mg mh mi mj b">commonInit()</code>中添加以下调用<code class="fe mg mh mi mj b">configureAccessibility()</code>。该方法的定义是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="737d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行该项目将呈现以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/f6ab69cf4b6caf64727907e7a35d2254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6KqFcWixjr-tUWQ307qsSQ.jpeg"/></div></div></figure><p id="3cfb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">利率已经消失了！旗帜看起来模糊不清，有些旗帜比其他的大。让我们首先处理旗帜图像。标志模糊是由于使用位图而不是矢量图形造成的。当<code class="fe mg mh mi mj b">CurrencyView</code>扩展时，标志图像视图上的约束被设置为扩展。<code class="fe mg mh mi mj b">CurrencyView</code>当比率或代码标签没有足够的空间显示其文本时展开。<br/>为了修复模糊，正如前面提到的，我们应该使用 pdf 而不是 png 图像。我们没有旗帜的 pdf 文件。因此，我们将限制标志可以扩展的最大数量。</p><p id="ab36" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<strong class="jm io"> CurrencyView.xib </strong>中，从<strong class="jm io">文档轮廓</strong>中选择<em class="mb">标志图像视图</em>，向右打开<strong class="jm io">检查器</strong>窗格中的<strong class="jm io">尺寸检查器</strong>，将两个水平约束(尾随和前导)的优先级更改为 750。将<strong class="jm io">尾随空格的关系改为:</strong>的值改为<strong class="jm io">≥</strong>,<strong class="jm io">前导空格与</strong>的关系改为<strong class="jm io"> ≤ </strong>。<br/>打开对齐约束面板，在容器中水平勾选<strong class="jm io">，最后添加一个值为 50 的宽度约束，并使其关系<strong class="jm io"> ≤ </strong>。<em class="mb">标志图像视图</em>约束应该是这样的。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/b45cecdc57efa1f964a91e44508f2bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IotpICzGM2KR0SPpOUtH5A.jpeg"/></div></div></figure><p id="6c79" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">关于<em class="mb">费率标签</em>，较大的文本改变了我们<em class="mb">当前视图的</em>高度。充当 ticker 的父视图控制器的主视图控制器正在裁剪标签。因此，我们需要让父视图控制器知道动态文本的大小已经改变。我们通过实现<code class="fe mg mh mi mj b">traitCollectionDidChange(_:)</code>来实现这一点，只要操作系统的界面环境发生变化，视图控制器就会调用这个方法。<br/>在我们调整滚动条的大小之前，父母需要知道如何与滚动条交流。</p><p id="8b57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转至<strong class="jm io"> Main.storyboard </strong>。在<strong class="jm io">文档轮廓</strong>中展开<em class="mb">视图控制器场景</em>并选择<strong class="jm io">嵌入 Segue 到“跑马灯视图控制器”</strong>。打开右侧<em class="mb">检查器</em>面板中的<strong class="jm io">属性检查器</strong>，将 segue 的标识符设置为<strong class="jm io"> ticker </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/0cdd7321909a4d90ce473cf3c06c22a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eWMOV3Y4mv_TMmmeS4Pm3Q.jpeg"/></div></div></figure><p id="5143" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们为容器视图的高度约束添加一个<code class="fe mg mh mi mj b">IBOutlet</code>。在<strong class="jm io"> ViewController.swift </strong>中添加以下内容，并在<em class="mb">界面构建器</em>中连接出口。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="1eb6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<strong class="jm io"> ViewController.swift </strong>中添加一个属性来存储<code class="fe mg mh mi mj b">tickerViewController</code>的实例，该实例将通过实现<code class="fe mg mh mi mj b">prepare(for:, sender:)</code>来检索。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="cf6c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有了对<code class="fe mg mh mi mj b">tickerViewController</code>的引用，每当动态文本改变时，让我们继续更新它的高度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="062a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还会给<code class="fe mg mh mi mj b">viewDidLoad()</code>加上<code class="fe mg mh mi mj b">updateTickerViewLayout()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="68d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mg mh mi mj b">TickerViewController</code>中的属性<code class="fe mg mh mi mj b">recommendedHeight</code>检查滚动视图的内容高度并返回它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="5ccc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在动态文本设置为最大值的情况下运行项目将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e183c9d95d95627840c82653810e2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*McqcL7JdHq2j5sImxvv1lQ.gif"/></div></div></figure><h1 id="cf33" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">画外音</h1><p id="13c9" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">Voice Over 是 iOS 屏幕阅读器，你可以在这里阅读更多关于如何在你的应用中支持 VoiceOver 的信息<a class="ae ku" href="https://developer.apple.com/documentation/uikit/accessibility_for_ios_and_tvos/supporting_voiceover_in_your_app" rel="noopener ugc nofollow" target="_blank">。<br/>启用 VoiceOver 最快最简单的方法就是使用 Siri，说“VoiceOver on”显然要关闭，要求 Siri“关闭 VoiceOver”或者“VoiceOver off”。</a></p><p id="d5d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">启用 VoiceOver 并启动 ticker，没有任何反应！为什么？原因这么多，先从加载内容开始吧。<br/>当我们的 ticker 启动时，它的视图是空的，ticker 正忙于从服务中获取价格。同时，VoiceOver 会查看我们的视图，并相应地设置其结构。因此，我们需要通知画外音我们的跑马灯已经改变，并重新评估布局。这是通过发布一个<code class="fe mg mh mi mj b">UIAccessibility.post(notification: .layoutChanged, argument: nil)</code>实现的。</p><p id="1a09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mg mh mi mj b">TickerViewController</code>中，我们将通过张贴通知来更新我们的<code class="fe mg mh mi mj b">currencies</code>房产观察者。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="f579" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">跑马灯的动画也阻止了 VoiceOver 正确关注任何内容。因此，我们将在启用 VoiceOver 时禁用动画。</p><p id="508f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mg mh mi mj b">TickerViewController</code>中，我们将更新<code class="fe mg mh mi mj b">startAnimationTimer()</code>来检查画外音是否激活。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="7bbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当 VoiceOver 打开或关闭时，操作系统会发布通知。在<code class="fe mg mh mi mj b">TickerViewController</code>中，通过添加通知观察者来更新<code class="fe mg mh mi mj b">commonInit()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="28a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的观察者<code class="fe mg mh mi mj b">voiceOverStatusChanged()</code>检查画外音的状态，并相应地启动/停止计时器。</p><p id="8d4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mg mh mi mj b">CurrencyView</code>上，我们想让这个视图可访问。我们将通过将标签分组到一个可访问性元素中来简化信息。<br/>转到<strong class="jm io"> CurrencyView.xib </strong>，选择货币代码标签<strong class="jm io"> shift </strong>选择汇率标签。打开右侧<strong class="jm io">检查器</strong>窗格中的<strong class="jm io">身份检查器</strong>。在<strong class="jm io">无障碍</strong>部分，取消勾选<strong class="jm io">无障碍</strong>的<strong class="jm io">启用</strong>复选框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/5bdf38b8a80d1d806fdf2db7abe156f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHCMQCosnGTSo6Vh8ruxlg.jpeg"/></div></div></figure><p id="6727" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转到项目导航器并选择<strong class="jm io">货币视图</strong>组，添加一个新的 Cocoa Touch 类文件，将其命名为<strong class="jm io">CurrencyViewAccessibilityElement</strong>，并使其成为<code class="fe mg mh mi mj b">UIAccessibilityElement</code>的子类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/36f12b4562309f3d50db2c2c67d1101c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nRDz3jdqP3_3ypg5ncUStA.jpeg"/></div></div></figure><p id="08e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mg mh mi mj b">CurrencyViewAccessibilityElement</code>看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="0d33" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们用一个可访问性容器初始化这个类，这里容器将是<code class="fe mg mh mi mj b">CurrencyView</code>的实例，并传递<code class="fe mg mh mi mj b">Currency</code>模型对象。遗憾的是，我们使用的服务不提供货币名称。因此，让我们在模型上创建一个新属性，它将返回货币名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="fa8a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用此属性为 VoiceOver 提供一个辅助功能标签，向用户读出我们试图传达的信息。在<code class="fe mg mh mi mj b">CurrencyViewAccessibilityElement</code>对<code class="fe mg mh mi mj b">acccessibilityLabel</code>的实现中，我们简化了视图中包含的信息。</p><p id="c5ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回到<code class="fe mg mh mi mj b">CurrencyView</code>。当货币被设置在<code class="fe mg mh mi mj b">CurrencyView</code>的属性上时，它的观察者调用<code class="fe mg mh mi mj b">update()</code>方法。我们将在<code class="fe mg mh mi mj b">update()</code>中添加一个新方法<code class="fe mg mh mi mj b">configureAccessibilityElement()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="fe2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要设置这个元素的框架。我们在<code class="fe mg mh mi mj b">TickerViewController</code>的<code class="fe mg mh mi mj b">configureCurrenyViews()</code>中这样做。一旦我们完成了填充滚动视图，我们将强制它布局它的视图，然后我们将能够设置货币视图的元素框架。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="25ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有了以上所有内容，运行项目并使用 VoiceOver 导航货币，用户将获得他们需要的所有信息。</p><p id="2fdf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让你的观点变得容易理解并不困难，这也是正确的做法。我希望你喜欢这篇文章。</p><p id="43f3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">和往常一样，你可以从<a class="ae ku" href="https://github.com/h4yder/ExchangeRateTicker" rel="noopener ugc nofollow" target="_blank"> github </a>下载代码。</p></div></div>    
</body>
</html>