<html>
<head>
<title>Sharing code between ReactJS and React Native using Nx.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Nx 在 ReactJS 和 React Native 之间共享代码。</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/sharing-code-between-reactjs-and-react-native-using-nx-9b22751f5a39?source=collection_archive---------1-----------------------#2022-05-23">https://blog.devgenius.io/sharing-code-between-reactjs-and-react-native-using-nx-9b22751f5a39?source=collection_archive---------1-----------------------#2022-05-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="3a40" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Monorepo 是维护大型项目和在多个项目之间共享公共代码/逻辑的一种方便而有用的技术。</p><p id="55a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将使用 Nx 工具创建 monorepo。</p><p id="589e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 ReactJS 和 React Native 内共享代码的第一步是创建一个工作区。</p><p id="876f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建 nx 工作空间的命令是</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="da3d" class="kr ks in kn b gy kt ku l kv kw">npx create-nx-workspace name-of-the-workspace</span></pre><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/abb7769a408d84f6cd5eb7e50794da01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*jYTUmwOEt9VqzWbQolNqwA.png"/></div></figure><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lb"><img src="../Images/4b6ca8e4b3c85988edac285a66a9e479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zVoWP3f62PSFNExezLZpMw.png"/></div></div></figure><p id="0af0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下一步中，我们将获得一个选项来选择我们希望在工作区中使用的应用程序类型。我首先创建一个 React 本地项目，然后将创建一个 ReactJS 项目。</p><p id="74bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">选择应用程序时，它会询问应用程序的名称。我将 React-native 应用程序命名为“移动”，将 ReactJS 应用程序命名为“web”。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lg"><img src="../Images/c4ec9c24b0727bd8af9145434558a42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfFEOsifcSQ7C2IGEaCdDA.png"/></div></div></figure><p id="b750" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">工作区现在创建完毕。在下图中，我们可以看到名为 monorepo-nx 的工作区，其中包含一个应用程序文件夹。我们将把 React-native 和 ReactJS 项目放在 apps 文件夹下，并将公共代码放在 libs 文件夹中。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/37b930397f5294a9a23c732223bff591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*7CnkZ42TQX-XaVuS7Km4HQ.png"/></div></figure><p id="905e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，是时候创建我们的<strong class="jm io"> ReactJS </strong>应用程序了。命令是</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="ef58" class="kr ks in kn b gy kt ku l kv kw">npx nx g @nrwl/react:app name-of-reactjs-app</span></pre><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi li"><img src="../Images/75e447199a64d4ee197fa28afdf5db89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*R3LNG0x-T78ahxF6JVgf_g.png"/></div></figure><p id="1580" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，它将在我们工作区的 apps 文件夹下创建一个名为 web 的<strong class="jm io"> ReactJS </strong>应用程序。我们也可以使用 NX 控制台来实现这一点。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/4531a78694f118c23a54fad04899a3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*_h_MmzkofQYbl5vFunFLnw.png"/></div></figure><p id="1aa3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了简化使用 Nx workspace 的工作，我们可以做的下一件事是安装 Nx Console extension for Visual Studio 代码。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/c5ae0d7409a1ebe108ab4bedc0fffbb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*BOcXCXKetY22wUFpXzI5XQ.png"/></div></figure><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ll"><img src="../Images/9e501cc6577da6bb3904f6e894db225d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TpZOyKKNGKiQL1ZU94C-ww.png"/></div></div></figure><p id="c2bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用 NX 控制台，我们可以轻松地运行、构建、服务和部署我们的代码，而无需记住确切的命令。</p><p id="e6d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以使用 NX 控制台轻松运行我们的 web 或移动应用程序，只需右键单击项目名称，然后从提供的选项中选择 Nx run。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lm"><img src="../Images/4c28f9022f435c0e35092670fe20eec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Snbw3yNS5oCsM3eo4-gkrQ.png"/></div></div></figure><p id="a439" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以选择是构建还是服务于我们的项目。在这里，我选择了 serve 来执行命令<strong class="jm io"> nx run web:serve </strong>。请注意，我们也可以从我们的终端运行命令<strong class="jm io"> nx run web:serve </strong>。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ln"><img src="../Images/1f6d0bdb39b1d46791a85c85571be703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xgna53zcM1wmni9_9jerZg.png"/></div></div></figure><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lo"><img src="../Images/c8b0df295de121ddae0604c8dcafbccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nInQ7rpLfXoN2sSeUhUgaA.png"/></div></div></figure><p id="bb02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的 web 应用程序现在运行在<a class="ae lp" href="http://localhost:4200/." rel="noopener ugc nofollow" target="_blank"> http://localhost:4200/。以同样的方式，我们可以运行我们的 react 本地应用程序。</a></p><p id="0a13" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们将创建一个库来保存我们的公共代码。</p><p id="d564" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了创建一个库，我再次使用 NX 控制台。点击 generate，它会给我们提供一个我们可以生成的东西的列表。从这里开始，我要选择@nrwl/react — library。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lq"><img src="../Images/6675a9ffd81f5348480086cfec10c541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2mOtZeRkq-jsrKSENYx_Q.png"/></div></div></figure><p id="4eef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦我们选择了库选项，我们将得到一个表单来填写关于我们想要创建的库的信息，如库的名称，使用的样式，linter 等。我已经将我的库命名为 shared，并提供了导入路径<a class="ae lp" href="http://twitter.com/nx/shared" rel="noopener ugc nofollow" target="_blank"> @nx/shared </a>。此名称(<a class="ae lp" href="http://twitter.com/nx/shared" rel="noopener ugc nofollow" target="_blank"> @nx/shared </a>)将用于导入 web 和移动应用中的共享代码。</p><p id="01a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 libs 文件夹下，我们现在可以看到我们新创建的库“共享”。我们现在将对<strong class="jm io"> shared.tsx </strong>进行修改，并将该代码用于 ReactJS 和 React Native app。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/751ed26cbafcc0c6faaac684767529f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*PrYNuCRZNi1LIW1HWnlBFg.png"/></div></figure><p id="6da6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我选择使用 monorepo 的一个主要原因是为了在 ReactJS 和 React Native app 之间共享 API 调用代码。</p><p id="97fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在例子中使用的是 https://jsonplaceholder.typicode.com/posts/1<a class="ae lp" href="https://jsonplaceholder.typicode.com/posts/1" rel="noopener ugc nofollow" target="_blank">的</a> api。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ls"><img src="../Images/646194d66a841057492589cfe4437488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvpmbgA3AfBlS-vQhwAL1g.png"/></div></div></figure><p id="e315" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们创建一个 getPosts() api 调用函数来调用 https://jsonplaceholder.typicode.com/posts/1 的<a class="ae lp" href="https://jsonplaceholder.typicode.com/posts/1" rel="noopener ugc nofollow" target="_blank"/>。一旦我们的函数准备就绪，我们现在将在 React Native 和 ReactJS 应用程序中导入该函数。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lt"><img src="../Images/ed2575f1d983a42b8f64af900ce6ec3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BOGf2FlFQ_uZ7fCBxZ2unQ.png"/></div></div></figure><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lu"><img src="../Images/46d90d146a031646746f649193175e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7a_Xi5cLmubuFHm-jj5zPQ.png"/></div></div></figure><p id="d61b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以看到，我们正在使用 import {getPosts}从“@nx/shared”导入共享库中的 getPosts 函数。</p><p id="a15d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，如果我们运行 web 和移动应用程序，我们将在两者中看到相同的输出。</p><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lv"><img src="../Images/1496bdddc282027fe345cc86a5ee4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oiXBosbgPU8Q5ydrTugSxw.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">ReactJS 应用</figcaption></figure><figure class="ki kj kk kl gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ma"><img src="../Images/cefd77e8c81fe2287ff3cb325ebf11d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ki6tG_GRpPKroUhIyFRy1g.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">React 本机应用程序</figcaption></figure><p id="3916" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样。</p></div></div>    
</body>
</html>