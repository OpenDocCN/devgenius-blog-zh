<html>
<head>
<title>How One Developer Recreated AirDrop Using Just JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个开发人员如何只用JavaScript重现隔空投送</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-one-developer-recreated-airdrop-using-just-javascript-d2d979551c51?source=collection_archive---------2-----------------------#2020-12-20">https://blog.devgenius.io/how-one-developer-recreated-airdrop-using-just-javascript-d2d979551c51?source=collection_archive---------2-----------------------#2020-12-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/02edddf498c6341f58c5f20a3cf678a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nbtonbnt_tAd-NAStxLaUA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">SnapDrop.net</figcaption></figure><p id="fc87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你在iPhone或Mac上用过隔空投送吗？</p><p id="48e3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">好吧，如果你还没有，那么你能想象在手机或笔记本电脑之间通过点击一个按钮无缝共享文件吗？</p><p id="ca34" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">罗宾·莱纳斯创造的SnapDrop.net让你可以在任何装有浏览器的设备之间直接分享文件。不管是在iPhone和Android之间，还是在平板电脑和PC之间。</p><p id="a973" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">也不需要上传到云端或者从云端下载。😲</p><p id="a2d3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">那么<em class="ky">它到底是怎么工作的？</em></p><p id="94b4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在一行一行的分析之后，我弄明白了它辉煌的架构。在这篇文章中，我将向你展示它是如何工作的。</p><h1 id="5617" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">使用这项新技术</h1><p id="3a0c" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">了解这项技术可以让你从那些还没有探索过这项技术的工程师中脱颖而出。</p><p id="7eba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这种令人敬畏的技术是WebRTC (Web实时通信),它是几年前才出现的。它的数据通道使SnapDrop能够发送字节(甚至音频和视频！)直接从一个对等体到另一个对等体。</p><p id="e1a4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">(将对等体视为一种设备，就像您的电话或笔记本电脑一样)</p><p id="7d6a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是，如果没有一些帮助，WebRTC无法连接两个用户。它需要一个信令服务器，换句话说，它需要发现其他对等点，并告诉它如何连接。</p><h1 id="7ada" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">没有这个，WebRTC是不可能使用的</h1><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/f373aace0bfef873e081d901b6f1647b.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*g4H3PUZHdq6HvOri7Ypwog.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">网络架构</figcaption></figure><p id="2e37" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">ICE(Interactive Connectivity Establishment)是一台计算机在没有公共IP地址的情况下，如何绘制从互联网到自身的地图。这是因为您的路由器和计算机之间发生了NAT(网络地址转换)。</p><p id="5798" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一旦地图制作完成，你必须找到某种方法让这两个设备互相共享它们的地图。SnapDrop通过NodeJS服务器实现这一点，NodeJS服务器使用WebSockets在每个对等点之间进行通信，这是另一个很棒的协议。</p><p id="0064" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在你可能在想，这安全吗？</p><h1 id="cf29" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">好吧，但是你怎么保护这东西？</h1><p id="230e" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">默认情况下，WebRTC in transit会加密其数据。这很酷，但你也可能不想与随机的人共享文件。</p><p id="8385" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">SnapDrop只在两台具有相同IP地址的计算机之间共享ICE，这意味着它们在同一个网络/wifi上。</p><p id="0a26" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">它通过为每个IP地址创建空间来做到这一点，并通过生成唯一的id来区分设备。</p><figure class="md me mf mg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="b85c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你可能不想在公共WiFi上使用此应用程序，因为任何人都可以向你发送文件。但是在这个疫情，谁会出去呢？🤷‍♀️</p><p id="3994" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">上面的代码片段做出了一个有趣的选择，将对等体存储在服务器类的一个对象中。通常你会期望使用数据库，但这可能是为了简化事情，应用程序可能没有太多的流量。</p><h1 id="4387" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">熟悉的用户界面和用户体验</h1><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/dc970773f46b8e2f9076c9b3ae14c340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*EzNX5xXvtksOIH5zLZf1MA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">快照图标</figcaption></figure><p id="8f5e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">风格几乎完全像隔空投送。每台设备都有一个有趣的名称和一个图标，以帮助区分每个对等设备。不仅如此，它还是一个进步的网络应用程序，提供了一些不错的功能，如:</p><ul class=""><li id="efa1" class="mk ml in kb b kc kd kg kh kk mm ko mn ks mo kw mp mq mr ms bi translated">感觉像是原生应用</li><li id="2019" class="mk ml in kb b kc mt kg mu kk mv ko mw ks mx kw mp mq mr ms bi translated">通知</li><li id="ae37" class="mk ml in kb b kc mt kg mu kk mv ko mw ks mx kw mp mq mr ms bi translated">实时更新</li></ul><h1 id="9a7b" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设备不支持WebRTC怎么办？</h1><p id="9709" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">到目前为止，大多数设备/浏览器都支持WebRTC，但如果它们不支持，SnapDrop还有一个后备方案！在这种情况下，它使用已经建立的WebSocket连接来发送文件数据。</p><p id="84d1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是，这种方法效率较低，安全性较差，因为数据需要先到达服务器，然后才能到达最终目的地。</p><figure class="md me mf mg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><h1 id="526d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">事件驱动的代码风格</h1><p id="7a1a" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">代码库完全是事件驱动的。当您希望将服务相互分离并允许在动作发生时进行处理时，可以使用这种风格。</p><p id="26fd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是对WebRTC和WebSockets的补充，因为它们也是事件驱动的。当一个消息进来，或者一个新的对等体加入，或者一个文件想要被发送，这就是一个事件。</p><p id="e3a3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一开始真的很难理解，因为这不是一个线性过程。这是注册和触发事件的类。</p><figure class="md me mf mg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><h1 id="fbb1" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">自己检查代码</h1><p id="9ad8" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">我希望你今天学到了一些东西！如果你想自己探索代码，这里有github库。</p><p id="5b11" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">创建者也很友好地创建了一个docker compose文件，这样您就可以自己运行和托管它了。我想知道有多少人在运行他们自己的SnapDrop实例？</p><p id="f2b9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢您的阅读，我会在下一篇中赶上您！</p></div></div>    
</body>
</html>