<html>
<head>
<title>Object-Oriented JavaScript — Closures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向对象的JavaScript——闭包</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/object-oriented-javascript-closures-33941b42d055?source=collection_archive---------7-----------------------#2020-09-30">https://blog.devgenius.io/object-oriented-javascript-closures-33941b42d055?source=collection_archive---------7-----------------------#2020-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0f81afb1ea0e137a32131f4252b293b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B2xpr8IAstjTxAOB"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@framemily?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">画框哈里拉克</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="f6bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript部分是面向对象的语言。</p><p id="7b04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要学习JavaScript，我们必须学习JavaScript的面向对象部分。</p><p id="6eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看函数。</p><h1 id="e6c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">返回函数的函数</h1><p id="440b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">函数可以返回函数。</p><p id="c94e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f169" class="mn lc iq mj b gy mo mp l mq mr">function a() {<br/>  console.log('foo');<br/>  return function() {<br/>    console.log('bar');<br/>  };<br/>}</span></pre><p id="c34f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们返回一个函数，然后我们可以调用我们返回的函数。</p><p id="724e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2f73" class="mn lc iq mj b gy mo mp l mq mr">a()();</span></pre><p id="788d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后首先调用<code class="fe ms mt mu mj b">a</code>，所以<code class="fe ms mt mu mj b">'foo'</code>被记录。</p><p id="5d7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用第二个圆括号调用返回的函数，这样我们就记录了<code class="fe ms mt mu mj b">'bar'</code>。</p><h1 id="c63f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自我重写的功能</h1><p id="fd6d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该意识到函数可以自我重写。</p><p id="5a08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4022" class="mn lc iq mj b gy mo mp l mq mr">function a() {<br/>  console.log('foo');<br/>  a = function() {<br/>    console.log('bar');<br/>  };<br/>}</span></pre><p id="18b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe ms mt mu mj b">'foo'</code>日志。</p><p id="7715" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行第一个控制台日志，然后重新分配该功能。</p><p id="fdf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不应该这样做，如果我们这样做，棉绒会提醒我们。</p><h1 id="a03e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">关闭</h1><p id="a168" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">闭包是内部有其他函数的函数。</p><p id="034e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">内部函数可以访问外部函数的范围。</p><p id="2b05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a4b2" class="mn lc iq mj b gy mo mp l mq mr">function outer() {<br/>  let outerLocal = 2;</span><span id="c014" class="mn lc iq mj b gy mv mp l mq mr">  function inner() {<br/>    let innerLocal = 3;<br/>    return outerLocal + innerLocal;<br/>  }<br/>  return inner();<br/>}</span></pre><p id="fe37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带变量的<code class="fe ms mt mu mj b">inner</code>函数。</p><p id="c386" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这仅在<code class="fe ms mt mu mj b">inner</code>功能中可用。</p><p id="90a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还可以访问<code class="fe ms mt mu mj b">outer</code>函数的<code class="fe ms mt mu mj b">outerLocal</code>变量。</p><p id="c35e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很有用，因为我们希望在代码中有私有变量。</p><p id="abf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe ms mt mu mj b">outerLocal</code>和<code class="fe ms mt mu mj b">innerLocal</code>只有<code class="fe ms mt mu mj b">inner</code>才有。</p><p id="275b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">outer</code>无法访问<code class="fe ms mt mu mj b">inner</code>的变量。</p><p id="8c64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们对这些功能有不同的隐私级别。</p><h1 id="826f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">循环中的闭包</h1><p id="bd78" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们有一个如下所示的循环:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d93a" class="mn lc iq mj b gy mo mp l mq mr">function foo() {<br/>  var arr = [],<br/>    i;<br/>  for (i = 0; i &lt; 3; i++) {<br/>    arr[i] = () =&gt; i<br/>  }<br/>  return arr;<br/>}</span></pre><p id="d6f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们称之为:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="623f" class="mn lc iq mj b gy mo mp l mq mr">const arr = foo();<br/>for (const a of arr){<br/> console.log(a());<br/>}</span></pre><p id="d1f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从所有控制台日志中得到3。</p><p id="3be9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为当我们将添加的函数分配给<code class="fe ms mt mu mj b">arr</code>时<code class="fe ms mt mu mj b">i</code>是3。</p><p id="f76f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">var</code>不是块范围的，所以我们将得到<code class="fe ms mt mu mj b">i</code>的最后一个值，而不是循环中的值。</p><p id="b8af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了从我们分配的函数的循环标题中得到<code class="fe ms mt mu mj b">i</code>的值，我们写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0b28" class="mn lc iq mj b gy mo mp l mq mr">function foo() {<br/>  var arr = [],<br/>    i;<br/>  for (i = 0; i &lt; 3; i++) {<br/>    ((j) =&gt; {<br/>      arr[i] = () =&gt; j<br/>    })(i)<br/>  }<br/>  return arr;<br/>}</span></pre><p id="702d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到0，1，和2，如我们所料。</p><p id="4e55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以用<code class="fe ms mt mu mj b">let</code>替换<code class="fe ms mt mu mj b">var</code>，使<code class="fe ms mt mu mj b">i</code>成为块范围的，从而避免这个问题。</p><h1 id="e36f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Getter和Setter</h1><p id="85b4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Getter函数返回值，setter函数设置值。</p><p id="f23d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以把getter和setter函数放在一个闭包里，这样我们就可以保持它们的私有性。</p><p id="5dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d470" class="mn lc iq mj b gy mo mp l mq mr">let getValue, setValue;<br/>(() =&gt; {<br/>  let secretVal = 0;<br/>  getValue = () =&gt; {<br/>    return secretVal;<br/>  };</span><span id="da1d" class="mn lc iq mj b gy mv mp l mq mr">  setValue = (v) =&gt; {<br/>    if (typeof v === "number") {<br/>      secretVal = v;<br/>    }<br/>  };<br/>}());</span></pre><p id="70e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们运行一个函数来给<code class="fe ms mt mu mj b">getValue</code>和<code class="fe ms mt mu mj b">setValue</code>函数赋值。</p><p id="3d7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">getValue</code>返回<code class="fe ms mt mu mj b">secretVal</code>的值，<code class="fe ms mt mu mj b">setValue</code>设置它。</p><p id="ce92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就能保守<code class="fe ms mt mu mj b">secretVal</code>的秘密。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/32244ccc944f754d4da306244c8955a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sYsDEpFeC5QVm-DW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@picsbyjameslee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">李中清</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="0f82" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="29d1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">闭包适用于各种应用程序。</p><p id="d5eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这主要是为了保持变量私有，我们也可以用它们按照我们期望的方式绑定变量值。</p></div></div>    
</body>
</html>