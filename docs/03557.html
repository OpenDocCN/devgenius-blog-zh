<html>
<head>
<title>Object-Oriented JavaScript — Async Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向对象的 JavaScript —异步编程</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/object-oriented-javascript-async-programming-975250f63ba8?source=collection_archive---------5-----------------------#2020-11-17">https://blog.devgenius.io/object-oriented-javascript-async-programming-975250f63ba8?source=collection_archive---------5-----------------------#2020-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d4dc90aa1181cde9e0103f96a3af3df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lOsc18TdsjgjDnQM"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@berkaygumustekin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Berkay Gumustekin </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="e4a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript 部分是面向对象的语言。</p><p id="7b04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要学习 JavaScript，我们必须学习 JavaScript 的面向对象部分。</p><p id="6eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究 JavaScript 异步编程。</p><h1 id="7bcb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">异步编程</h1><p id="39b6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">异步编程是 JavaScript 应用程序的重要组成部分。</p><p id="015d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它不同于替代模式，后者是同步编程。</p><p id="4dae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同步编程是我们逐行运行代码的地方。</p><p id="7582" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">异步编程是我们运行一些代码，然后等待结果。</p><p id="285e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们等待结果时，我们让队列中的其他代码段运行。</p><p id="f0fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦得到结果，我们就运行等待结果的代码。</p><p id="fec2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是不同的，因为我们不是一行一行地运行任何东西。</p><p id="9fb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将代码排队并初始化它们。</p><p id="0165" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦计算出结果，我们就返回运行初始化的代码。</p><p id="54a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当代码等待时，延迟是不可预测的。</p><p id="32da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们不能只运行代码，然后等待结果，而不让其他代码运行。</p><h1 id="2ea4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">JavaScript 调用堆栈</h1><p id="f651" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">调用堆栈是从最近到最早调用的函数的记录。</p><p id="db7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="295f" class="mn lc iq mj b gy mo mp l mq mr">function c(val) {<br/>  console.log(new Error().stack);<br/>}</span><span id="d0be" class="mn lc iq mj b gy ms mp l mq mr">function b(val) {<br/>  c(val);<br/>}</span><span id="d82e" class="mn lc iq mj b gy ms mp l mq mr">function a(val) {<br/>  b(val);<br/>}<br/>a(1);</span></pre><p id="11d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2a88" class="mn lc iq mj b gy mo mp l mq mr">Error<br/>    at c ((index):37)<br/>    at b ((index):41)<br/>    at a ((index):45)<br/>    at (index):47</span></pre><p id="43a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从控制台日志中。</p><p id="82fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到<code class="fe mt mu mv mj b">a</code>首先被调用，然后是<code class="fe mt mu mv mj b">b</code>，然后是<code class="fe mt mu mv mj b">c</code>。</p><p id="12a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当<code class="fe mt mu mv mj b">c</code>返回时，栈顶弹出。</p><p id="6fd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后返回时弹出<code class="fe mt mu mv mj b">b</code>。</p><p id="f0da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后弹出<code class="fe mt mu mv mj b">a</code>。</p><h1 id="d52d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">事件循环</h1><p id="436e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">浏览器选项卡在单个线程中运行。</p><p id="50e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它在事件循环中运行。</p><p id="89c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">循环不断地从消息队列中挑选消息，并运行与之相关的回调。</p><p id="65a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当其他流程将任务添加到消息队列时，事件循环不断地从消息队列中挑选任务。</p><p id="4833" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像计时器和事件处理程序这样的进程并行运行，并将任务添加到队列中。</p><h1 id="00ce" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">定时器</h1><p id="d519" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">setTimeout</code>函数创建一个定时器并等待它触发。</p><p id="eb33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当计时器运行时，一个任务被添加到消息队列中。</p><p id="001f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要一个回调和以毫秒为单位的持续时间。</p><p id="4229" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦达到持续时间，就会运行回调。</p><p id="dd78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当回调运行时，浏览器中的其他交互将被阻止。</p><h1 id="f47a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">复试</h1><p id="5c29" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Node 推广了自己的回调风格。</p><p id="4a07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回调采用一个<code class="fe mt mu mv mj b">err</code>和<code class="fe mt mu mv mj b">data</code>参数。</p><p id="a32a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">err</code>有错误对象。</p><p id="5ea4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">data</code>有结果数据。</p><p id="294e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="076a" class="mn lc iq mj b gy mo mp l mq mr">fs.readFile('/foo.txt', (err, data) =&gt; {<br/>  if (err) throw err;<br/>  console.log(data);<br/>});</span></pre><p id="d14b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有一个带有<code class="fe mt mu mv mj b">err</code>和<code class="fe mt mu mv mj b">data</code>的回调。</p><p id="9c03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">fs.readFile</code>异步读取文件并获取内容。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/fef3bf50c1c5601cbbe614353185a88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fXQMU0Apu2MDfJ0a"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@marliesebrandsma?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">摄于<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>的马莉斯·斯特里兰</a></figcaption></figure><h1 id="c776" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="bd62" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript 需要大量的异步代码，因为它只在一个线程上运行。</p><p id="f2b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要将任务排队，然后异步运行。</p><p id="5216" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样就不会耽误主线了。</p></div></div>    
</body>
</html>