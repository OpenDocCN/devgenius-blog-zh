<html>
<head>
<title>REST API design best practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">REST API 设计最佳实践</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/rest-api-design-best-practices-1a1d5cd6ff48?source=collection_archive---------6-----------------------#2020-06-12">https://blog.devgenius.io/rest-api-design-best-practices-1a1d5cd6ff48?source=collection_archive---------6-----------------------#2020-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3e80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为 RESTful API 进行设计是我们作为 web 开发人员已经习惯的事情，有时我们会蒙着眼睛去做。但是 REST APIs 不仅仅是一个简单的 200 JSON 体响应。</p><p id="194e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你看，当我们学习 REST 时，我们明确地发现我们可以使用 HTTP 方法(动词)来表达不同的操作，但是有一些细节会使你的 API 更容易理解，更现代，更企业级。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6b9477f02d5a12d8ed0677da75441042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JSthYIluWPhXsL7z.png"/></div></div></figure><h1 id="0cd2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">回到基础:HTTP</h1><p id="232b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了更好的设计 REST API，你最好了解 HTTP 协议基础知识，可以查看这个<a class="ae ma" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多。下面是设计 REST API 之前必须知道的一些事情:</p><ul class=""><li id="5de8" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">HTTP 有<strong class="jp ir">动词</strong>(或方法):GET、POST、PUT、PATCH 和 DELETE 是最常见的。</li><li id="e6b8" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">REST 是<strong class="jp ir">面向资源的</strong>，一个资源用一个<strong class="jp ir"> URI </strong> : <code class="fe mp mq mr ms b">/articles/</code>来表示。</li><li id="238c" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">端点</strong>是动词和 URI 的组合，例如<code class="fe mp mq mr ms b">GET: /articles/</code>。</li><li id="0715" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">端点可以被解释为对资源的<strong class="jp ir">动作。例如，<code class="fe mp mq mr ms b">POST: /articles/</code>可能意味着“创造一篇新文章”。</strong></li><li id="67e6" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">在高层次上，<strong class="jp ir">动词映射到 CRUD 操作</strong> : <code class="fe mp mq mr ms b">GET</code>表示<code class="fe mp mq mr ms b">Read</code> , <code class="fe mp mq mr ms b">POST</code>表示<code class="fe mp mq mr ms b">Create</code> , <code class="fe mp mq mr ms b">PUT</code>和<code class="fe mp mq mr ms b">PATCH</code>表示<code class="fe mp mq mr ms b">Update</code>,<code class="fe mp mq mr ms b">DELETE</code>表示...嗯，<code class="fe mp mq mr ms b">Delete</code>。</li><li id="17c0" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">响应的状态由其<strong class="jp ir">状态代码</strong>指定:<code class="fe mp mq mr ms b">1xx</code>表示信息，<code class="fe mp mq mr ms b">2xx</code>表示成功，<code class="fe mp mq mr ms b">3xx</code>表示重定向，<code class="fe mp mq mr ms b">4xx</code>表示客户端错误，<code class="fe mp mq mr ms b">5xx</code>表示服务器错误。</li></ul><p id="3e10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，您可以使用 HTTP 协议为 REST API 设计提供的任何东西，但是我认为这些是您需要记住的基本内容。</p><h1 id="a8c6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">避免纯文本</h1><p id="b777" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">它显然不是 REST 架构风格强加的，但它们大多使用 JSON 作为数据格式。</p><p id="f3c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你认为只返回普通数据就够了，那你就错了，你必须把<code class="fe mp mq mr ms b"><strong class="jp ir">Content-Type</strong></code>头也指定为！必须将其设置为值<code class="fe mp mq mr ms b"><strong class="jp ir">application/json</strong></code>。</p><h1 id="b60a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">URIs 工艺</h1><p id="d6fb" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">永远不要在 URIs 使用动词，因为你知道 HTTP 方法是动词，所以在你的 URI 中使用动词会显得很尴尬。确保你遵循面向资源的 REST 原则。</p><p id="99e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 HTTP 协议动词来描述在 URI 中定义的所需资源上的操作。</p><h1 id="5c0d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">复数名词</h1><p id="d329" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">设计 RESTful API 时，避免使用单数名词来描述资源。请始终将 URI 中的资源视为包含一个或多个相同类型资源的存储库。所以一定要使用复数名词(例如:<strong class="jp ir"> <em class="mt"> /articles/{id} </em> </strong>而不是<strong class="jp ir">/article/{ id }</strong>)。</p><h1 id="0fc7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">总结你的回答</h1><p id="53d8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">将您返回的响应包装在一个标准模型中，这将使客户能够在出现问题时知道哪里出错了，并确保您的基线模型结构在数据改变时不会改变。</p><p id="c65c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，当使用分页时，使用定义偏移量和页面大小的模型。始终确保您的数据可以通过相同的字段访问，例如:</p><p id="14dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">For GET:/articles？offset=40&amp;limit=10 我们得到:</p><pre class="km kn ko kp gt mu ms mv mw aw mx bi"><span id="c36f" class="my ky iq ms b gy mz na l nb nc">{<br/>  "error": null,<br/>  "didError": false,<br/>  "model": [{<br/>    "title": "I am a test data",<br/>     ...,<br/>  }],<br/>  "offset": 40,<br/>  "limit": 10,<br/>}</span></pre><p id="082e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取:/articles/156</p><pre class="km kn ko kp gt mu ms mv mw aw mx bi"><span id="2e5b" class="my ky iq ms b gy mz na l nb nc">{<br/>  "error": null,<br/>  "didError": false,<br/>  "model": {<br/>    "title": "I am a test data",<br/>  }<br/>}</span></pre><p id="b2eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于 PUT: /articles/156</p><pre class="km kn ko kp gt mu ms mv mw aw mx bi"><span id="e7bc" class="my ky iq ms b gy mz na l nb nc">{<br/>  "error": null,<br/>  "didError": false,<br/>  "model": {<br/>    "title": "I am a test data",<br/>  }<br/>}</span></pre><p id="c262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以看到，第一个模型将在所有分页列表响应中使用，而另一个模型将在所有单条目响应中使用。</p><h1 id="1135" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">状态码是你的朋友</h1><p id="2bb9" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这非常重要，因为所有 HTTP 客户端都依赖于此，请确保您正确使用标准 HTTP 状态代码范围。这意味着您可以使用授权的范围，最重要的是根据用例来使用它们。</p><p id="ab9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 REST API 设计中，建议您将这些代码用于不同的操作:</p><pre class="km kn ko kp gt mu ms mv mw aw mx bi"><span id="998a" class="my ky iq ms b gy mz na l nb nc">GET: 200 OK<br/>POST: 201 Created<br/>PUT: 200 OK<br/>PATCH: 200 OK<br/>DELETE: 204 No Content</span></pre><h1 id="3631" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">避免资源嵌套</h1><p id="a5ba" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">REST APIs 处理资源，检索资源的列表或单个实例非常简单。这在使用关系时很常见，当你得到一个 id=1 的用户的文章列表时，你想到的第一件事就是使用这样的 URI“/authors/1/articles”。实际上不建议这样做，因为您的第一意图是返回由用户 1 创作的文章，由此我们可以推断它是一个过滤器。我的朋友，过滤器总是在查询字符串中传递。</p><p id="6216" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以你最终的 URI 会是这样的？authorId=1。</p><h1 id="94e5" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">过滤和分页</h1><p id="06ae" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我想更深入地了解细节，因为我可以给出一篇<a class="ae ma" href="https://www.moesif.com/blog/technical/api-design/REST-API-Design-Filtering-Sorting-and-Pagination/" rel="noopener ugc nofollow" target="_blank">文章</a>,通过示例和最重要的不同方法及其优缺点来明智地解决这个特性。</p><p id="f8b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想让你知道的是，分页和过滤总是在查询字符串中完成。</p><h1 id="d76c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">HTTP 中的警察</h1><p id="89af" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">当处理 API 中的安全错误时，很容易混淆错误是与<strong class="jp ir">认证</strong>还是<strong class="jp ir">授权</strong>(也称为许可)相关，这种情况在我身上经常发生。</p><p id="fc38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我的备忘单，让你知道我根据具体情况在处理什么:</p><ul class=""><li id="b1d9" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">用户是否没有提供身份验证凭据？它们无效吗？👉<code class="fe mp mq mr ms b">401 Unauthorized</code>。</li><li id="57a0" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">用户的身份验证是否正确，但他们没有访问资源所需的权限？👉<code class="fe mp mq mr ms b">403 Forbidden</code>。</li></ul><h1 id="6210" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用 202 进行未来处理</h1><p id="b3e5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我发现<code class="fe mp mq mr ms b">202 Accepted</code>是<code class="fe mp mq mr ms b">201 Created</code>的一个非常方便的替代品。它基本上意味着:</p><p id="b22f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我，服务器，已经理解了你的要求。我还没有创建资源，但这很好。</p><p id="e920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种情况我觉得<code class="fe mp mq mr ms b">202 Accepted</code>特别适合:</p><ul class=""><li id="e2c6" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">如果资源将作为未来处理的结果而创建，例如在作业完成之后。</li><li id="cf1f" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">如果资源已经以某种方式存在，但是这不应该被解释为错误。</li></ul><h1 id="6060" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="4bf0" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在本文中，我们只讨论了 REST API 设计中的基础知识，您可以在 google 中找到更好的资源，这些资源通过更多的示例甚至是示例项目来深入探讨这个主题。</p><p id="bfde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">享受设计一个采用良好语义、常识和简单性的 API 的乐趣。</p><h1 id="cdab" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">参考</h1><div class="nd ne gp gr nf ng"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">HTTP 概述</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">HTTP 是网络上任何数据交换的基础，它是一个客户机-服务器协议，这意味着请求是…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">developer.mozilla.org</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kv ng"/></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://www.moesif.com/blog/technical/api-design/REST-API-Design-Filtering-Sorting-and-Pagination/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">REST API 设计:过滤、排序和分页</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">无论 API 是公共的还是内部使用的，API 设计正在成为 API 产品策略的核心支柱。很好…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.moesif.com</p></div></div><div class="np l"><div class="nv l nr ns nt np nu kv ng"/></div></div></a></div></div></div>    
</body>
</html>