<html>
<head>
<title>Add geo-information to Heartbeat monitors and create a heatmap dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向心跳监视器添加地理信息，并创建热图仪表板</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/add-observer-metadata-processor-add-geo-information-to-heartbeat-monitors-and-create-a-heatmap-3436749341f4?source=collection_archive---------6-----------------------#2022-09-11">https://blog.devgenius.io/add-observer-metadata-processor-add-geo-information-to-heartbeat-monitors-and-create-a-heatmap-3436749341f4?source=collection_archive---------6-----------------------#2022-09-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e33093fe3e7b489d03450e3453c0a287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VzEc7cHSY3IN2IpUzIOgXA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated"><a class="ae jz" href="https://unsplash.com/@claybanks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae jz" href="https://unsplash.com/s/photos/heatmap?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="77b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">欢迎回到关于弹性堆栈的这个系列😊，今天我们将了解更多关于添加 Heartbeat 生成的事件的地理信息。</p><p id="9010" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们开始之前，我推荐阅读这篇关于 Heartbeat 及其安装的文章，以便跟上讨论。我们将使用<em class="ky">处理器</em>来包含心跳生成事件的地理信息。</p><p id="3a69" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如最近看到的，<em class="ky">处理器</em>提供了一种在边缘处理事件的简单方法，所以所有的处理都发生在 Heartbeat 将事件发送到配置的输出之前。这里我们将使用名为<strong class="kc io">的特定处理器添加观察者元数据</strong>。让我们看看如何！</p><h2 id="492f" class="kz la in bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">配置处理器</h2><p id="8365" class="pw-post-body-paragraph ka kb in kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">在<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/heartbeat-with-local-elasticsearch-and-kibana-69b99f7e23a6">上一篇文章</a>中，我们修改了<code class="fe lx ly lz ma b">heartbeat.yml</code>文件，以便从我们的<em class="ky"> hello-microservice </em>中探测正常运行时间数据，该服务通过端口<em class="ky"> 3001 </em>公开了一个 http 端点。我们现在需要确保包含上面提到的处理器。为此，我们添加了以下部分:</p><pre class="mb mc md me gt mf ma mg mh aw mi bi"><span id="088e" class="kz la in ma b gy mj mk l ml mm">processors:<br/>  - add_observer_metadata:<br/>      cache.ttl: 5m<br/>      geo:<br/>        name: rabat-dc-01<br/>        location: "33.9715904, -6.8498129"<br/>        continent_name: Africa<br/>        country_iso_code: MAR<br/>        region_name: Rabat-Salé-Kénitra<br/>        region_iso_code: MA-07<br/>        city_name: Rabat</span></pre><p id="c801" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:你可以将你所有的心跳配置组合在一个<code class="fe lx ly lz ma b">.yml</code>文件中，并在启动心跳时使用<code class="fe lx ly lz ma b">-c</code>标志来使用这些配置。</p><p id="2353" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然在本节中您可以配置许多处理器，但是在我们的例子中，只有一个处理器就够了。<em class="ky"> add_observer_metadata </em>处理器需要两条信息:</p><ul class=""><li id="4cc9" class="mn mo in kc b kd ke kh ki kl mp kp mq kt mr kx ms mt mu mv bi translated">第一个是关于<strong class="kc io"> cache.ttl </strong>或缓存到期时间，我们将把它设置为<em class="ky"> 5m </em>。</li><li id="2a4e" class="mn mo in kc b kd mw kh mx kl my kp mz kt na kx ms mt mu mv bi translated">然后，我们必须指定<strong class="kc io"> geo </strong>参数或当前位置(<em class="ky">经纬度</em>，并为其输入一个名称。除了位置和名称，我们还可以选择指定其他参数，如<em class="ky">洲名</em>、<em class="ky">国家 iso 代码</em>、<em class="ky">地区名称</em>、<em class="ky">地区 iso 代码</em>或<em class="ky">城市名称</em>。填写完必填字段后，我们的处理器就配置好了，我们只需使用以下命令启动 Heartbeat:</li></ul><pre class="mb mc md me gt mf ma mg mh aw mi bi"><span id="2b02" class="kz la in ma b gy mj mk l ml mm">./heartbeat -e</span></pre><p id="f66a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从这一点开始，Heartbeat 将开始探测微服务的正常运行时间信息。我们的处理器将在每次生成新事件时使用，它将修改事件以包含新信息，然后将其发送到指定的输出。</p><p id="9964" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦我们的事件被发送到 Elasticsearch，我们就可以使用 Kibana 来检查一切是否正常。实际上，除了与我们的监视器相关联的位置之外，与先前获得的显示没有任何变化。单击最右侧的箭头，在我们的显示器上展开更多信息，或者只需单击显示器名称。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/894410700f3b7c0f4518b99aa15626a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XQVuH4x7mIhUfZRIgHUUw.png"/></div></div></figure><h2 id="b74c" class="kz la in bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">创建热图</h2><p id="b5d2" class="pw-post-body-paragraph ka kb in kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">现在我们已经有了我们的位置信息，让我们创建一个仪表板，显示一个包含这些信息的<strong class="kc io">热图</strong>。为此，我们首先需要建立一个<em class="ky">索引模式</em>。在<em class="ky">管理部分</em>，打开<em class="ky">堆栈管理</em>，在 Kibana 部分下寻找<em class="ky">数据视图</em>。在这里，我们将创建一个新的<em class="ky">数据视图</em> ( <em class="ky">您可以为其选择一个名称</em>)和一个索引模式，该索引模式与包含来自 Heartbeat 的信息的已配置索引和别名相匹配。所以只需提供这个索引模式<code class="fe lx ly lz ma b">heartbeat-*</code>，它将匹配所有现有的索引和别名，并从时间戳字段中选择<em class="ky"> @timestamp </em>。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/f49ccfcadb2addd4df55d526b96301a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*foC_FPlWc0IIfk1rJq8P_Q.png"/></div></div></figure><p id="2f96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，我们现在可以转到<code class="fe lx ly lz ma b">Analytics &gt; Visualize library</code>部分并创建一个新的仪表板。点击创建新的可视化，并将类型设置为<strong class="kc io">地图</strong>。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/8a813831b43e651f4886572ee1bfeb68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9cWdAdEU_kgP6y3mC1yag.png"/></div></div></figure><p id="932d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">随着地图的显示，继续点击<em class="ky">添加图层</em>按钮。从列表中选择<em class="ky">热图</em>，并选择我们之前配置的索引模式。在<em class="ky">群集</em>字段中，我们将选择选项<em class="ky"> observer.geo.location </em>。Kibana 会自动更新地图并突出显示已写入的数据。只需添加图层并可视化热图，热图将显示监视器从微服务收集正常运行时间数据的确切位置。你可以放大来检查信息的准确性或获得更高的精确度。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/51a5976d6b28a3541c4c6125316c5aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWG1EH6-m1igso3RPYEZOw.png"/></div></div></figure><p id="a298" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一切似乎都正常😎！我们今天就说到这里，为了获得更多的细节，请随意查阅关于这个主题的官方文件。</p><p id="970c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="9578" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们下次再见，看更多的帖子🚀。</p><p id="fd21" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>