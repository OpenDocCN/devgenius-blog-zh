<html>
<head>
<title>Connecting a Django Web App to a Snowflake Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Django Web 应用程序连接到雪花数据库</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/connecting-a-django-web-app-to-a-snowflake-database-855c16df590?source=collection_archive---------1-----------------------#2020-08-17">https://blog.devgenius.io/connecting-a-django-web-app-to-a-snowflake-database-855c16df590?source=collection_archive---------1-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/73c499e5cda5cec85878c95b1421184d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LAsJeHJVNR013BXNUG_9tg.png"/></div></div></figure><h1 id="04a0" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">简短而令人愉快的</h1><h2 id="50ec" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">此流程的高级步骤:</h2><ul class=""><li id="bcf0" class="ll lm iq ln b lo lp lq lr lb ls le lt lh lu lv lw lx ly lz bi translated">使用雪花数据库中的表定义 sql 查询</li><li id="6727" class="ll lm iq ln b lo ma lq mb lb mc le md lh me lv lw lx ly lz bi translated">使用 python 的 snoflake.connector 库创建与雪花的连接</li><li id="79f7" class="ll lm iq ln b lo ma lq mb lb mc le md lh me lv lw lx ly lz bi translated">使用雪花连接执行所述查询，并将结果转换为 pandas 数据帧</li><li id="9db0" class="ll lm iq ln b lo ma lq mb lb mc le md lh me lv lw lx ly lz bi translated">修改数据框架列标题(手动)</li><li id="b406" class="ll lm iq ln b lo ma lq mb lb mc le md lh me lv lw lx ly lz bi translated">使用 sqlalchemy 创建引擎</li><li id="96ab" class="ll lm iq ln b lo ma lq mb lb mc le md lh me lv lw lx ly lz bi translated">将数据帧导入回雪花数据库的新表中</li></ul><h2 id="9ec4" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">给我看看代码</h2><p id="18fe" class="pw-post-body-paragraph mf mg iq ln b lo lp mh mi lq lr mj mk lb ml mm mn le mo mp mq lh mr ms mt lv ij bi translated">下面是一个连接 web 应用程序的简单方法，在我的例子中是 Django web 应用程序(在上周之前我对它一无所知，所以不要把你的 web 应用程序构建愿望建立在这篇文章的基础上)连接到 Snowflake(我也从来没有真正接触过它，所以在这里也要小心)。</p><h2 id="69e0" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">导入</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="e590" class="kw jz iq mz b gy nd ne l nf ng">import pandas as pd<br/>import snowflake.connector as sf<br/>from snowflake.sqlalchemy import URL<br/>from sqlalchemy import create_engine</span></pre><h2 id="b8b2" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">创建虚拟数据帧</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9769" class="kw jz iq mz b gy nd ne l nf ng">x = [1,2,3]<br/>y = [2,3,4]<br/>df = pd.DataFrame([x, y], columns=['one', 'two', 'three'])</span></pre><h2 id="a60b" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">用 sqlalchemy 创建引擎 url</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="e5c6" class="kw jz iq mz b gy nd ne l nf ng"># Fill in your SFlake details here<br/>engine = create_engine(URL(<br/>    account = 'x',<br/>    user = 'a',<br/>    password = 'a!',<br/>    database = 'af',<br/>    warehouse = 'f',<br/>    role = 'd',<br/>    schema = 'f',<br/>))</span></pre><h2 id="05b7" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">创建连接变量</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9aef" class="kw jz iq mz b gy nd ne l nf ng">connection = engine.connect()</span></pre><h2 id="cb9e" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">将数据帧导入回您的雪花数据库</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="c391" class="kw jz iq mz b gy nd ne l nf ng">df.to_sql('test_table', con=engine, if_exists='replace', index=False) #make sure index is False, Snowflake doesnt accept indexes</span></pre><h1 id="ff5c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">现在，如果您想导入一个数据帧，而该数据帧中的数据来自对雪花数据库的查询，该怎么办呢？</h1><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2338" class="kw jz iq mz b gy nd ne l nf ng">#create connection variable - use your own creds obviously<br/>conn = sf.connect(<br/>    account = 'a',<br/>    user = 'd',<br/>    password = 'f!',<br/>    database = 'f',<br/>    warehouse = 's',<br/>    role = 'a',<br/>    schema = 'f',<br/>)</span><span id="f57a" class="kw jz iq mz b gy nh ne l nf ng"># execute_query(connection, query):<br/>sql = 'select * from "some_db"."some_schema"."some_table"'</span><span id="6102" class="kw jz iq mz b gy nh ne l nf ng"># Create cursor<br/>cur = conn.cursor()</span><span id="274f" class="kw jz iq mz b gy nh ne l nf ng"># Execute SQL statement<br/>cur.execute(sql)</span><span id="dfa2" class="kw jz iq mz b gy nh ne l nf ng"># Fetch result<br/># print(cur.fetchall())</span><span id="6183" class="kw jz iq mz b gy nh ne l nf ng"># Create Dataframe<br/>data = []<br/>data = cur.fetchall()<br/>df = pd.DataFrame(data)</span><span id="f707" class="kw jz iq mz b gy nh ne l nf ng">#Change Col Names<br/>df.columns = ['DQ_RULE_ID'<br/>,'RULE_SHORT_DESC'<br/>,'RULE_LONG_DESC'<br/>,'DQ_RULE_CAT'<br/>,'DQ_RULE_SQL'<br/>,'ACTIVE_IND'<br/>,'CREATE_TS'<br/>,'LST_UPDT_TS'<br/>,'LST_UPDT_USR_ID'<br/>,'RULE_PCT_IND']</span><span id="c23e" class="kw jz iq mz b gy nh ne l nf ng">print(df)</span></pre><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/40b73afde72112e49ae97d6409a18dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRA6qMU8FwF_SUN5hjzN6w.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">df 结果</figcaption></figure><p id="8343" class="pw-post-body-paragraph mf mg iq ln b lo nn mh mi lq no mj mk lb np mm mn le nq mp mq lh nr ms mt lv ij bi translated">太好了，这将查询我们的数据库，并把数据放入熊猫数据框架。接下来，我们需要将它导入回雪花。这一部分让人们有点犹豫，因为 django 有它自己的数据库模型，最重要的是，你可能会想“我必须使用那个模型”——你没有。</p><h2 id="f5ce" class="kw jz iq bd ka kx ky dn ke kz la dp ki lb lc ld km le lf lg kq lh li lj ku lk bi translated">将 df 导入回雪花</h2><p id="bb68" class="pw-post-body-paragraph mf mg iq ln b lo lp mh mi lq lr mj mk lb ml mm mn le mo mp mq lh mr ms mt lv ij bi translated">我们只需回收用于虚拟数据库的相同代码，就可以了。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="b4ce" class="kw jz iq mz b gy nd ne l nf ng"># Fill in your SFlake details here<br/>engine = create_engine(URL(<br/>    account = 'a',<br/>    user = 'd',<br/>    password = 'f!',<br/>    database = 'vb',<br/>    warehouse = 'z',<br/>    role = 'x',<br/>    schema = 'c',<br/>))</span><span id="aca5" class="kw jz iq mz b gy nh ne l nf ng">connection = engine.connect()</span><span id="ab28" class="kw jz iq mz b gy nh ne l nf ng">df.to_sql('test_table', con=engine, if_exists='replace', index=False) #make sure index is False, Snowflake doesnt accept indexes</span></pre><p id="a38f" class="pw-post-body-paragraph mf mg iq ln b lo nn mh mi lq no mj mk lb np mm mn le nq mp mq lh nr ms mt lv ij bi translated">这是一个高层次的概述。希望代码有意义。这很简单。</p><p id="caa0" class="pw-post-body-paragraph mf mg iq ln b lo nn mh mi lq no mj mk lb np mm mn le nq mp mq lh nr ms mt lv ij bi translated">这是在 jupyter 笔记本和 django 应用程序中完成的。我试图构建一个数据库连接工具，让用户可以连接到雪花数据库，然后编写查询。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/72e37205419d4e73bb8511823ce78cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8MX22_uCzsfMPHOWCKVU0g.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">此连接的 Django web 应用程序版本</figcaption></figure><p id="b07d" class="pw-post-body-paragraph mf mg iq ln b lo nn mh mi lq no mj mk lb np mm mn le nq mp mq lh nr ms mt lv ij bi translated">显然，这可以更好地编码，但对于快速和肮脏的东西，它的工作。希望这有所帮助。</p></div></div>    
</body>
</html>