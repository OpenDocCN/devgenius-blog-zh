<html>
<head>
<title>Trying Agones for Multiplayer Game in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">尝试在 Kubernetes 进行多人游戏</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/what-i-learned-from-trying-agones-577f93193419?source=collection_archive---------10-----------------------#2022-07-27">https://blog.devgenius.io/what-i-learned-from-trying-agones-577f93193419?source=collection_archive---------10-----------------------#2022-07-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="0fcb" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">KUBERNETES + AGONES</h2><div class=""/><div class=""><h2 id="2278" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">即使项目没有完成，也总有东西要学。</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f5e073bae433381026b20afb6d1a65b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*83-EeD2NmJgyqNPY.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Agones 标志。</figcaption></figure><p id="fe17" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我最近的项目是尝试学习 Agones，这是谷歌开发的多人游戏舵图。尽管我没有及时完成这个项目，但我从中吸取了一些教训。</p><h1 id="b439" class="lx ly in bd lz ma mb mc md me mf mg mh kc mi kd mj kf mk kg ml ki mm kj mn mo bi translated">背景</h1><p id="eea2" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">Agones 是安装在 Kuberenetes 集群中的一个框架，用于创建和管理多人游戏。理论上，Agones 允许我们在配对过程完成后(意味着房间已满，游戏准备开始)产生一个新的游戏服务器。</p><p id="de4d" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我为什么对 Agones 感兴趣？因为在过去的几个月里，我一直在思考游戏服务器是如何工作的，以及它的可扩展性。因此，当我发现 Agones 时，我很有兴趣看看它是如何工作的。</p><p id="37cf" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这个想法是 Agones 可以为每个游戏分配一个新的游戏服务器。它不像一个游戏服务器装满了许多房间(不像 Socket.io)。相反，一个游戏服务器专用于一个房间。至少概念上是这样。</p><h1 id="e8d2" class="lx ly in bd lz ma mb mc md me mf mg mh kc mi kd mj kf mk kg ml ki mm kj mn mo bi translated">学习过程</h1><h2 id="e6b3" class="mv ly in bd lz mw mx dn md my mz dp mh lk na nb mj lo nc nd ml ls ne nf mn it bi translated">开发游戏</h2><p id="03dc" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">为了尝试 Agones，我开发了一款井字游戏。我将代码存储在三个存储库中:</p><ul class=""><li id="c62b" class="ng nh in ld b le lf lh li lk ni lo nj ls nk lw nl nm nn no bi translated">前端代码，包含游戏的用户界面。</li><li id="814b" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw nl nm nn no bi translated">游戏服务器代码，包含游戏过程中的后台逻辑。</li><li id="3a77" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw nl nm nn no bi translated">后端数据库代码，包含一个连接 MongoDB 的简单服务器。</li></ul><p id="ac07" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">现在，你可能想知道，为什么我需要 3 个服务。原因是在测试过程中，我发现由于 Webpack 的原因，前端无法使用 Mongoose 库，所以我需要创建一个专用于访问 MongoDB 的服务。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/28435fe88565a11dbe9926e174d6bc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ly1NLUF3DIjlsKCMTwPIZw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">计划的井字游戏的架构图。</figcaption></figure><p id="98b7" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这是前端代码。前端用 Next.js 编程，使用西奥多鲁斯·克拉伦斯的<a class="ae mu" href="https://github.com/theodorusclarence/ts-nextjs-tailwind-starter" rel="noopener ugc nofollow" target="_blank"> awesome 模板。开发花了相当长的时间，因为我不习惯反应钩子，但最后，我让它工作。</a></p><div class="nv nw gp gr nx ny"><a href="https://github.com/iamdejan/agones-tic-tac-toe-fe" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ix gy z fp od fr fs oe fu fw iw bi translated">GitHub-iamdejan/agones-TIC-tac-toe-Fe</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">在 GitHub 上创建一个帐户，为 iamdejan/agones-tic-tac-toe-fe 的开发做出贡献。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kv ny"/></div></div></a></div><p id="b91d" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这是游戏服务器代码。游戏服务器用 Node.js 和 Typescript 编程。前端和游戏服务器的连接使用 Socket.io，我之所以使用 Socket.io 是因为它更简单，相比 Websocket(甚至直接处理 TCP)。</p><div class="nv nw gp gr nx ny"><a href="https://github.com/iamdejan/agones-tic-tac-toe-be" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ix gy z fp od fr fs oe fu fw iw bi translated">GitHub-iamdejan/agones-TIC-tac-toe-be</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om kv ny"/></div></div></a></div><p id="64d0" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这是后端数据库代码。它是用 Express.js 和 Typescript 构建的。如前所述，该服务仅充当数据库的代理。创建游戏和/或通过游戏 ID 检索游戏服务器 URL 的端点很少。</p><div class="nv nw gp gr nx ny"><a href="https://github.com/iamdejan/agones-tic-tac-toe-be-db" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ix gy z fp od fr fs oe fu fw iw bi translated">GitHub-iamdejan/Agones-Tic-Tac-Toe-BE-db:Agones Tic-Tac-Toe-BE 从 FE 到 DB 的代理</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oo l oj ok ol oh om kv ny"/></div></div></a></div><p id="006d" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">因为我很少编码井字游戏(特别是前端部分花了很长时间)，这三个库大概花了我一个月的时间。</p><h2 id="d46e" class="mv ly in bd lz mw mx dn md my mz dp mh lk na nb mj lo nc nd ml ls ne nf mn it bi translated">供应基础设施</h2><p id="642d" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">现在，在开发完基础设施之后，我需要提供 Kubernetes 集群，并安装 Agones。我使用谷歌 Kubernetes 引擎只是因为我还有免费的信用。</p><p id="29f1" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">你可以在这里看到代码(抱歉没有<code class="fe op oq or os b">README</code>文件):</p><div class="nv nw gp gr nx ny"><a href="https://github.com/iamdejan/agones-tic-tac-toe-be-infra.git" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ix gy z fp od fr fs oe fu fw iw bi translated">GitHub-iamdejan/Agones-Tic-Tac-Toe-be-Infra:Agones Tic-Tac-Toe Infra</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="ot l oj ok ol oh om kv ny"/></div></div></a></div><p id="a825" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">请注意，我创建了自己的模块来从 Terraform 调配 GKE，您可以在这里看到:</p><div class="nv nw gp gr nx ny"><a href="https://github.com/iamdejan/terraform-k8s-module" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ix gy z fp od fr fs oe fu fw iw bi translated">GitHub-iam dejan/terra form-k8s-module:terra form 模块，用于在 GCP 提供一个 Kubernetes 集群。</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">这是一个简单的 Terraform 模块，用于在谷歌云平台(GCP)中提供 Kubernetes 集群。参考本模块…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="ou l oj ok ol oh om kv ny"/></div></div></a></div><p id="5f99" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">然而，在供应步骤中，我面临两个困难:</p><ol class=""><li id="62c0" class="ng nh in ld b le lf lh li lk ni lo nj ls nk lw ov nm nn no bi translated">如果我在供应期间添加了<code class="fe op oq or os b">ip_allocation_policy</code>，Terraform 将显示错误。原来，当我们第一次创建集群时，GKE 坚持自己创建和分配二级子网(用于 Kubernetes pods 和服务的子网)。</li><li id="4565" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">在配置 Kubernetes 集群之后，如果我没有添加<code class="fe op oq or os b">ip_allocation_policy</code>，那么 Terraform 将“重置”(删除然后重新创建)Kubernetes 集群。我们不希望每次应用 Terraform 配置时都出现这种情况。解决方案是在配置集群后添加<code class="fe op oq or os b">ip_allocation_policy</code>。是，不理想，但是我没有研究如何解决这个问题，尤其是在 Jakarta ( <code class="fe op oq or os b">asia-southeast2</code>)提供 Kubernetes 集群时。</li></ol><p id="cdf4" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">解决方法写在<code class="fe op oq or os b">terraform-k8s-module</code> repo 的<code class="fe op oq or os b">README</code>文件里。</p><h2 id="bb0e" class="mv ly in bd lz mw mx dn md my mz dp mh lk na nb mj lo nc nd ml ls ne nf mn it bi translated">尝试 Agones</h2><p id="6285" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">现在，进入主要部分，这是尝试 Agones。</p><p id="e5a7" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">我的第一次尝试是使用我推送到 Google 容器注册表的图像。我通过修改<a class="ae mu" href="https://agones.dev/site/docs/getting-started/create-gameserver/" rel="noopener ugc nofollow" target="_blank">到</a>的教程来创建游戏服务器。这是 YAML 的档案:</p><pre class="km kn ko kp gt ow os ox oy aw oz bi"><span id="eeb4" class="mv ly in os b gy pa pb l pc pd">apiVersion: "agones.dev/v1"<br/>kind: GameServer<br/>metadata:<br/>  generateName: "tic-tac-toe-"<br/>spec:<br/>  health:<br/>    disabled: true<br/>  ports:<br/>  - name: default<br/>    portPolicy: Dynamic<br/>    containerPort: 4000<br/>    protocol: TCP<br/>  template:<br/>    spec:<br/>      containers:<br/>      - name: agones-tic-tac-toe<br/>        image: [the image version of the game server]<br/>        resources:<br/>          requests:<br/>            memory: 128Mi<br/>            cpu: 40m<br/>          limits:<br/>            memory: 128Mi<br/>            cpu: 40m</span></pre><p id="2fef" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">然后，按照教程，我运行<code class="fe op oq or os b">kubectl create -f game-server.yaml</code>。游戏服务器被创建，然后状态变为<code class="fe op oq or os b">Scheduled</code>。但是，我不能访问它。发生了什么事？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pe"><img src="../Images/a0195fa684d3bddb0fa5debd15ac7930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXrGSPxb6V0edTp9wTB32Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">一分钟后，游戏服务器的状态停留在预定状态。</figcaption></figure><p id="7839" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">原来我需要设置服务器的状态为<code class="fe op oq or os b">Ready</code>，否则服务器无法接收流量。<em class="pf">我好傻</em>，脑子里对自己说，没有完全看完教程，错过了接受连接所需的状态。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pg"><img src="../Images/4cfb61651db05fd956fbefa2a69f1da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6zO37jT570K0PfCmOD2-Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来自<a class="ae mu" href="https://agones.dev/site/docs/getting-started/create-gameserver/" rel="noopener ugc nofollow" target="_blank"> Agones 教程</a>的截图，说明游戏服务器需要放入<code class="fe op oq or os b">Ready state in order to receive connection.</code></figcaption></figure><p id="9f00" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">看完教程，我可以通过向<code class="fe op oq or os b"><a class="ae mu" href="http://localhost:${AGONES_SDK_HTTP_PORT" rel="noopener ugc nofollow" target="_blank">http://localhost:${AGONES_SDK_HTTP_PORT</a>}/ready</code>发送 POST 请求，将游戏服务器的状态设置为<code class="fe op oq or os b">Ready</code>。你可以在这里看到变化<a class="ae mu" href="https://github.com/iamdejan/agones-tic-tac-toe-be/compare/e6fb968fbc34cef5a0ab1e64d68e58559b636363...b52015343a31ec2028a0f0b82008e19ac7609cf8" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ph"><img src="../Images/7f72dbf3806f4258630d492aca54e69a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1TUpS1zrxUNLn1vxPlUUcg.png"/></div></div></figure><p id="d85b" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">然后，正如教程中所写的，我试着使用<code class="fe op oq or os b">nc -u {IP} {PORT}</code>命令从我的本地笔记本电脑上测试连接。但是，它卡住了。什么都没发生。我试着用<code class="fe op oq or os b">nc -vz</code>命令调试连接，但这是我在本地找到的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pi"><img src="../Images/03b53d6e515a610f48c66edebb56c60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fmyXKkRzl-pIOM1vZ79aw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">状态更改为就绪后，无法连接到游戏服务器。</figcaption></figure><p id="2126" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">结果是我需要在 Kubernetes 节点中打开 7000–8000 端口。这很有趣，因为我通常依靠<code class="fe op oq or os b">Service</code>或<code class="fe op oq or os b">Ingress</code>来访问 Kubernetes pods。我从不直接打开 Kubernetes 节点的端口。</p><p id="29ed" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">为了打开端口的节点，您可以添加一个防火墙规则(如果您使用的是<code class="fe op oq or os b">default</code>网络，则在防火墙页面中；如果您在 VPC 提供 Kubernetes 集群，则在 VPC 页面中)来打开 TCP(这是我所需要的，因为我使用的是 Socket.io)、UDP(如果您正在学习 Agones 教程，这可能是您所需要的)的 7000–8000 端口。为了定位 Kubernetes 节点，您需要使用<code class="fe op oq or os b">gke-node</code>网络标签。理想情况下，我希望使用 Terraform，但是由于这对我来说是一个未知领域，所以我选择直接在控制台中添加规则。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pj"><img src="../Images/b1c770161cf1485bb4e0ed229c8d4b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0oydZNAWGIEsEZyJxUiFfA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我在自定义 VPC 中为 Agones 连接添加了防火墙规则。</figcaption></figure><p id="da68" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">然后，我又试了一次。但是，还是超时了。看来我在给 Kubernetes 节点添加防火墙规则后需要删除游戏服务器了。于是我删除并重新创建了游戏服务器，连接成功了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pk"><img src="../Images/011f412caeaf137a3082b9460ca620df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reDAvh9LnxHMHT5KDp2Nlg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">新的游戏服务器准备好了。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pl"><img src="../Images/9b01d5205bdeec143190d8fd02e13219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyprOzbaYctzmmX96DxdIg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我的本地计算机已成功连接到 Agones 的游戏服务器。</figcaption></figure><p id="78f3" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">现在，是玩游戏的时候了。我在本地电脑上运行游戏，我用谷歌 Chrome 和 Brave 浏览器玩。理想情况下，我还需要将前端放在 Kubernetes 集群中，但是时间不允许(参见下面的<code class="fe op oq or os b">The Unfinished Part</code>部分)。</p><p id="9a07" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">下面是我尝试玩游戏时的截图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/508bcb0201e106a6a0d7df5fda607385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DeJPWfe3fDpmo9wQYomPng.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">井字游戏的主页。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pm"><img src="../Images/9ab55b62ba5e07543cea7dafbc87e266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3T2RsohqFS9jXDRmqRqMfA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">点击“创建游戏”按钮后，游戏创建者在等候室。然后需要由第二个玩家输入游戏 ID。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/b4737b0a936ce3e2c4442f54a1b67b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rK0xOUlUeP62PU2AFDC5JA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">第二个玩家输入由第一个玩家(游戏的创建者)给出的游戏 ID。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/0208a0a62800432f08407fccf8a7f52d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVXwBSNo5upbzMFc11GU8w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">第二个玩家点击“加入游戏”按钮后游戏开始，我们可以玩游戏了。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pn"><img src="../Images/b3146985eb166c14ff54a44dd4bc4b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0I7pF6LlJcTeADs4hOrD_A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">一个玩家赢了之后的页面，不是 X 就是 o。</figcaption></figure><h1 id="1dfd" class="lx ly in bd lz ma mb mc md me mf mg mh kc mi kd mj kf mk kg ml ki mm kj mn mo bi translated">未完成的部分</h1><p id="f52c" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">对于这个项目，我需要改进几个方面:</p><ol class=""><li id="5e75" class="ng nh in ld b le lf lh li lk ni lo nj ls nk lw ov nm nn no bi translated">目前，IP 地址和端口是硬编码在前端，因为我从云壳手动创建游戏服务器。理想情况下，我不仅将前端放在 Kubernetes 集群中，还需要在代码中创建游戏服务器，而不是硬编码 IP 地址和端口。我认为这可以在以后改进，一旦我转移到另一个云提供商并获得另一个免费积分:)</li><li id="a91d" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">可以改进的一个逻辑是，当玩家创建游戏室时，我提供游戏服务器。我认为更优化的版本是在房间满了之后才提供 T2。</li><li id="fece" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">我想尝试但时间不允许(我的 GCP 免费试用期快到了)的一件事是，我想使用 Agones 的<code class="fe op oq or os b">GameServerAllocator</code>，这样我就不需要创建游戏服务器，而是使用已经分配给我的服务器。这和第一点有关。</li></ol><h1 id="be19" class="lx ly in bd lz ma mb mc md me mf mg mh kc mi kd mj kf mk kg ml ki mm kj mn mo bi translated">结论</h1><p id="f32f" class="pw-post-body-paragraph lb lc in ld b le mp jx lg lh mq ka lj lk mr lm ln lo ms lq lr ls mt lu lv lw ig bi translated">尽管这是一个未完成的项目，我还是学到了一些东西:</p><ol class=""><li id="5eb3" class="ng nh in ld b le lf lh li lk ni lo nj ls nk lw ov nm nn no bi translated">在尝试实现自定义游戏之前，先了解所需的工具。我花了几个星期开发井字游戏，才意识到 Agones 并不像我想象的那么简单，因为我需要设置很多东西，从 Kubernetes 集群、游戏服务器(包括它的状态)和防火墙规则。</li><li id="664d" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">正确阅读教程。仅仅因为你认为你知道它是如何工作的，这并不保证你真的知道。慢慢适当的看教程。</li><li id="fef6" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">与第一点相关，试试 Agones 给出的例子。如果这个例子不起作用，你知道要么你误解了指南，要么只是指南不够好。如果遵循这些例子不起作用，至少你在开发定制游戏之前节省了一些时间。这也和第二点有关。</li><li id="0fde" class="ng nh in ld b le np lh nq lk nr lo ns ls nt lw ov nm nn no bi translated">对于创业公司，如果资源允许(资金、人员等。)，我觉得还是用<a class="ae mu" href="https://cloud.google.com/game-servers" rel="noopener ugc nofollow" target="_blank">谷歌云游戏服务器</a>比较好，因为他们已经帮你管理服务器分配了。谷歌云游戏服务器内部使用 Agones。然而，如果你在其他云提供商那里已经有了 Kubernetes，我可以看到直接使用 Agones 的吸引力。</li></ol><p id="f0cf" class="pw-post-body-paragraph lb lc in ld b le lf jx lg lh li ka lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">也就是说，最重要的结论是<strong class="ld ix">不要害怕尝试</strong>。你很少第一次就把所有事情都做对。</p></div></div>    
</body>
</html>