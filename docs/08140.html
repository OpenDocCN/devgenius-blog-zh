<html>
<head>
<title>How to Train a Scalable Classifier with FastAPI and SerpApi ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 FastAPI 和 SerpApi 训练一个可扩展的分类器？</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-train-a-scalable-classifier-with-fastapi-and-serpapi-f528ddf1949f?source=collection_archive---------11-----------------------#2022-05-19">https://blog.devgenius.io/how-to-train-a-scalable-classifier-with-fastapi-and-serpapi-f528ddf1949f?source=collection_archive---------11-----------------------#2022-05-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/89f1a30a056282f8ad9b3d80aa3671a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ds1cO8Ae7qlEbfkhqnlYyg.jpeg"/></div></div></figure><div class=""/><p id="0a68" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是与人工智能实现相关的系列博文的一部分。如果你对故事的背景或情节感兴趣:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="61b6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本周，我们将探索<a class="ae kz" href="https://serpapi.com/" rel="noopener ugc nofollow" target="_blank"> SerpApi </a>强大的<a class="ae kz" href="https://serpapi.com/images-results" rel="noopener ugc nofollow" target="_blank">Google Images Results Scraper API</a>在<a class="ae kz" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>快速构建 web 框架之上的组合能力。我们将从用同步方法创建一个简单的图像数据库创建器开始，并从那里开始构建。</p><h1 id="3e8a" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">可伸缩分类器是什么意思？</h1><p id="e0b0" class="pw-post-body-paragraph jv jw iy jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">该术语指的是在机器学习训练过程中使用的扩展图像数据库的可扩展性，以及以最小的努力在规模上扩展或再训练模型。简单来说，如果你有一个区分猫和狗的模型，你应该能够通过自动收集猴子图像，重新训练或扩展现有的分类器来轻松扩展它。</p><h1 id="adfc" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">带有解释的最小 FastAPI 文件夹结构</h1><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><ul class=""><li id="d4ae" class="md me iy jx b jy jz kc kd kg mf kk mg ko mh ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">datasets</code>:这个文件夹将存储我们将要下载的图像，存储旧的下载历史，并将测试数据库分割成训练数据库。</li><li id="967f" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">datasets -&gt; test</code>:该文件夹将包含不同的文件夹，其中包含查询的名称。每个带有查询名称的文件夹将包含我们将使用的图像。</li><li id="2654" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">datasets -&gt; train</code>:不在本周范围内。但在结构上，它将是测试文件夹的复制品。但是，出于训练目的，每个文件夹中的图像数量将少于测试文件夹。</li><li id="aa00" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">datasets -&gt; previous_images.json</code>:该文件将包含之前已经下载的链接，以避免再次下载相同的图像。</li><li id="7936" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">add.py</code>:这个文件将负责从 SerpApi 的 Google Images Results Scraper API 中收集唯一的链接，然后将图片下载到相应的位置。</li><li id="61c5" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">main.py</code>:运行服务器和定义路由的主文件。</li><li id="7808" class="md me iy jx b jy mq kc mr kg ms kk mt ko mu ks mi mj mk ml bi translated"><code class="fe mm mn mo mp b">requirements.txt</code>:我们在运行 Serpapi 时使用的库。你需要通过 pip 下载它们。</li></ul><h1 id="b54d" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">要求</h1><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="8482" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是我们需要添加到<code class="fe mm mn mo mp b">requirements.txt</code>文件中的所需库。</p><h1 id="56dc" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">应用程序配置</h1><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="6ae8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">顾名思义，FastApi 允许以最小的努力实现快速开发过程。我们现在将在<code class="fe mm mn mo mp b">main.py</code>中添加两条路由，一条问候用户，另一条接受来自端点的查询对象:</p><p id="ac1f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">类将包含 pydantic 基本模型对象，该对象包含用于从 SerpApi 的 Google Images Scraper API 获得不同结果的参数。<code class="fe mm mn mo mp b">Download</code>班会监督整个过程。</p><p id="71b0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">至于<code class="fe mm mn mo mp b">add</code>端点的后台进程，让我们在<code class="fe mm mn mo mp b">add.py</code>中导入必要的库:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="52ad" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">from multiprocessing.dummy import Array</code>:这是一个自动添加的用于多处理目的的库<br/> <code class="fe mm mn mo mp b">from serpapi import GoogleSearch</code>:这是 SerpApi 的库，用于使用 SerpApi 支持的各种引擎。你可以在它的<a class="ae kz" href="https://github.com/serpapi/google-search-results-python" rel="noopener ugc nofollow" target="_blank"> Github 回购</a>上找到更多信息。只需通过<code class="fe mm mn mo mp b">pip install google-search-results</code>命令安装即可。<br/> <code class="fe mm mn mo mp b">from pydantic import BaseModel</code> : Pydantic 允许我们轻松地创建对象模型。<br/> <code class="fe mm mn mo mp b">import mimetypes</code> : Mimetypes 对于在将下载的元素写入图像之前猜测其扩展名非常有用。它允许我们猜测<code class="fe mm mn mo mp b">.jpg</code>、<code class="fe mm mn mo mp b">.png</code>等。文件的扩展名。<br/> <code class="fe mm mn mo mp b">import requests</code> : Python 的 HTTP requests 库有史以来最酷的库标识。<br/> <code class="fe mm mn mo mp b">import json</code>:用于读写<code class="fe mm mn mo mp b">JSON</code>文件。这将有助于存储我们已经下载的图片的旧链接。<br/> <code class="fe mm mn mo mp b">import os</code>:用于在服务器的本地存储中写入图像，或者为不同的查询创建文件夹。</p><p id="d679" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看如何包含对<code class="fe mm mn mo mp b">add</code>端点的查询:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="da7f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个比例模型中，<code class="fe mm mn mo mp b">q</code>和<code class="fe mm mn mo mp b">api_key</code>参数必须给定。然而正如我在评论中所说的，你可以用给定的方法硬编码你的<code class="fe mm mn mo mp b">api_key</code>,这样你就不必每次都输入它。有问题的<code class="fe mm mn mo mp b">api_key</code>指的是 SerpApi API 键。你可以通过我们的<a class="ae kz" href="https://serpapi.com/users/sign_up" rel="noopener ugc nofollow" target="_blank">注册链接</a>注册一个免费或付费账户。您的唯一 API 密钥可以在<a class="ae kz" href="https://serpapi.com/manage-api-key" rel="noopener ugc nofollow" target="_blank">管理 API 密钥</a>页面中找到。</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mv"><img src="../Images/94759bae22c5e2a4bbd4dce3b1582ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zNbJ9UkERXdMxN0C.png"/></div></div></figure><p id="3bbb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">SerpApi 免费提供缓存结果。这意味着如果对<code class="fe mm mn mo mp b">Apple</code>的搜索被缓存，你将免费得到它。但是，如果您查询了<code class="fe mm mn mo mp b">Monkey</code>，而它不在我们的缓存中，或者不在您创建的缓存中，它将从您的帐户中消耗一个信用点数。</p><p id="1f02" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">google_domain</code>:会刮到<code class="fe mm mn mo mp b">Google Images</code>的哪个域。<br/> <code class="fe mm mn mo mp b">num</code>:给定查询的结果数。默认为最大值<code class="fe mm mn mo mp b">100</code>。<br/> <code class="fe mm mn mo mp b">ijn</code>:指页码。默认为<code class="fe mm mn mo mp b">0</code>，结果将从<code class="fe mm mn mo mp b">ijn x num</code>开始，到<code class="fe mm mn mo mp b">(ijn x num) + num</code>结束(这些公式适用于理想情况。谷歌可能不会为某些查询提供那么多数据。)起始结果索引将默认为<code class="fe mm mn mo mp b">0</code>，因为默认<code class="fe mm mn mo mp b">ijn</code>为<code class="fe mm mn mo mp b">0</code>。<br/> <code class="fe mm mn mo mp b">q</code>:您要进行的扩展图像数据库的查询。<br/> <code class="fe mm mn mo mp b">api_key</code>:指<code class="fe mm mn mo mp b">SerpApi</code> API 键。</p><h1 id="f715" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">下载图像</h1><p id="9a46" class="pw-post-body-paragraph jv jw iy jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">让我们声明我们将下载图像的类:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="a3a4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">self.query</code>:我们在类对象<br/> <code class="fe mm mn mo mp b">self.results</code>中存储查询的地方:我们在这里存储在 Google 图片搜索中找到的所有图片链接。<br/> <code class="fe mm mn mo mp b">self.previous_results</code>:以前下载的，或跳过的(将在下面解释)图片链接，以避免重新下载。<br/> <code class="fe mm mn mo mp b">self.unique_results</code>:我们从查询中收集的唯一链接，我们必须下载以扩展图像数据库。<br/> <code class="fe mm mn mo mp b">self.new_results</code>:要写入 JSON 文件的以前结果和唯一结果的组合。</p><p id="917b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们定义负责对 SerpApi 进行查询的函数:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="9ea8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见，一些参数如<code class="fe mm mn mo mp b">engine</code>和<code class="fe mm mn mo mp b">tbm</code>是预定义的。这些参数负责刮<code class="fe mm mn mo mp b">SerpApi's Google Images Scraper API</code>。当您对 SerpApi 执行以下查询时，它将返回一个包含 SERP 结果不同部分的 JSON:<br/><code class="fe mm mn mo mp b"><a class="ae kz" href="https://serpapi.com/search?engine=google&amp;google_domain=google.com&amp;ijn=0&amp;num=100&amp;q=Apple" rel="noopener ugc nofollow" target="_blank">https://serpapi.com/search?engine=google&amp;google_domain=google.com&amp;ijn=0&amp;num=100&amp;q=Apple</a></code><br/>这是 SerpApi Python 库的基本功能。结果将如下所示:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="65b6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是 SerpApi 可以理解并将其作为 JSON 的原始 HTML 文件:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mw"><img src="../Images/468e87142e111d85ffc832bebd4f2a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uCneXA7ViLdfvgjZ.png"/></div></div></figure><p id="023f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你也可以去 SerpApi 游乐场获得更多的视觉体验和调整能力。只需将链接中的<code class="fe mm mn mo mp b">search?</code>改为<code class="fe mm mn mo mp b">playground?</code> : <br/> <code class="fe mm mn mo mp b"><a class="ae kz" href="https://serpapi.com/search?engine=google&amp;google_domain=google.com&amp;ijn=0&amp;num=100&amp;q=Apple" rel="noopener ugc nofollow" target="_blank">https://serpapi.com/search?engine=google&amp;google_domain=google.com&amp;ijn=0&amp;num=100&amp;q=Apple</a></code></p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mx"><img src="../Images/bb403f810dab38f62aba595c472205fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gll0z-3CkTTt-x8G.png"/></div></div></figure><p id="a0ec" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们对<code class="fe mm mn mo mp b">images_results</code>的<code class="fe mm mn mo mp b">original</code>键感兴趣，因为它们是下载原始尺寸图像的直接链接。关于引擎的更多信息，你可以去 SerpApi 的 Google Images Scraper API 的<a class="ae kz" href="https://serpapi.com/images-results" rel="noopener ugc nofollow" target="_blank">文档，探索更多选项。</a></p><p id="e1e1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们探索一下如何检查旧的下载链接，并分离出唯一的结果:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="6df4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们读取<code class="fe mm mn mo mp b">previous_images.json</code>文件并在其中寻找<code class="fe mm mn mo mp b">previous</code>键。然后，最后一行决定了唯一的结果。</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="0fbd" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们把这个函数分解成几个步骤。首先，我们要定义一个下载路径:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="937c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是我们也需要检查这样的路径是否存在。例如，如果我们的查询是<code class="fe mm mn mo mp b">Apple</code>，我们需要一个像<code class="fe mm mn mo mp b">datasets/test/apple</code>这样的文件夹存在。如果它不存在，我们就创建一个。</p><p id="4a89" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看下载图像的名称选择:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="e905" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们会给图片编号，以保持名称的唯一性。如果还没有下载任何文件，文件名将为<code class="fe mm mn mo mp b">0</code>。如果有，那么该名称将是最大数量加 1。</p><p id="710e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们来看看猜测扩展，并将图像下载到其正确的路径:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="3ab6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们使用链接以字节的形式获取图像，然后猜测图像的扩展名。Mimetype 将`. webp '图像猜测为“html”。因此，我们为这种情况制定了一个安全措施，并使用我们之前生成的路径和扩展名来编写图像。</p><p id="223d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们看看如何更新我们存储的 JSON 文件，以便将来进行独特的下载:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="896c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然每个函数都准备好了，让我们看看包含我们从<code class="fe mm mn mo mp b">add</code>端点调用的整个流程的函数。</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="66f0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在那里放了一点 try 和 except 块，以确保在请求过程中没有意外错误。</p><h1 id="e67b" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用 Uvicorn 运行应用程序</h1><p id="5e63" class="pw-post-body-paragraph jv jw iy jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">可以使用应用程序路径中的命令在本地计算机上部署 FastApi:</p><p id="82de" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">uvicorn main:app --host 0.0.0.0 --port 8000</code></p><p id="a796" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你会看到下面的 prompt:‌</p><p id="5369" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">【T2<br/><code class="fe mm mn mo mp b">INFO: Waiting for application startup.</code><br/><code class="fe mm mn mo mp b">INFO: Application startup complete.</code><br/><code class="fe mm mn mo mp b">INFO: Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)</code></p><p id="1b1b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这意味着您的服务器运行没有问题。如果您在本地机器上前往<code class="fe mm mn mo mp b">localhost:8000</code>，您将会看到这样一个结构:</p><p id="5c32" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">{"Hello":"World"}</code></p><p id="8345" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是应用程序的主页面。这将在未来的博客文章中形成。<br/>让我们直奔<code class="fe mm mn mo mp b">localhost:8000/docs</code>:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi my"><img src="../Images/858d61f7878aac8c26e7ec883bb96452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3uPsc1b2TxDN_Wgc.png"/></div></div></figure><p id="57a1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">FastApi 允许自动文档和应用程序的游乐场。这对我们手动测试端点很有用。这对我们手动创建对<code class="fe mm mn mo mp b">add</code>端点的 post 请求很有用。只需点击带有<code class="fe mm mn mo mp b">Create Query</code>的按钮:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mz"><img src="../Images/63091a743df6a0d94bb235847446c845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IXX3sRWQTe4aJooE.png"/></div></div></figure><p id="55e4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，点击<code class="fe mm mn mo mp b">Try it out</code>按钮:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi na"><img src="../Images/dcce76d58637b1fedd2e925a27952afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*70Um4Ya1HXCFzJG8.png"/></div></div></figure><p id="ec7c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<code class="fe mm mn mo mp b">api_key</code>参数更改为您的 API 键，并将<code class="fe mm mn mo mp b">q</code>更改为您希望用来扩展数据库的查询。</p><p id="c696" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们按下“执行”之前，让我们来看看文件夹结构:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/97ed454f6e144b61df96a892d53c5d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/0*YmOSgAGQ_uxDwH21.png"/></div></figure><p id="e187" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见,<code class="fe mm mn mo mp b">datasets -&gt; test</code>文件夹是空的，在执行时，它将被图像填满。</p><p id="9272" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们按下浏览器中的<code class="fe mm mn mo mp b">Execute</code>按钮，看看有什么变化:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nc"><img src="../Images/5a4c13569bd1f40d4ef94c288b099f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YTsAztVILD41_Jo1.png"/></div></div></figure><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nd"><img src="../Images/d4ce6be2317edc726b11db9f9d4af87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XCg_ppbU3bTzU9u1.png"/></div></div></figure><p id="8d73" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将在浏览器和终端中自动看到变化。</p><p id="d66b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完成后，您可以在浏览器中观察到响应:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ne"><img src="../Images/8f274ceeb05bd4e6c963b1a28e779f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZfR4M4UNjHXp5NkJ.png"/></div></div></figure><p id="9b3d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您也可以前往您的文件夹，查看图像是否已更新:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nf"><img src="../Images/0874216b84236234a51ed7db0b13de22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rTEC3rNehqxqYp_l.png"/></div></div></figure><h1 id="ee6d" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">完整代码</h1><p id="7f30" class="pw-post-body-paragraph jv jw iy jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated"><code class="fe mm mn mo mp b">main.py</code></p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="e6b1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">add.py</code></p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="d0cc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">requirements.txt</code></p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="9e34" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mm mn mo mp b">datasets/previous_images.json</code></p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="kx ky l"/></div></figure><h1 id="27f4" class="la lb iy bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="2d90" class="pw-post-body-paragraph jv jw iy jx b jy ly ka kb kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks ig bi translated">我为出版晚了一天向读者道歉，感谢他们的关注。本周我们已经介绍了如何使用 SerpApi 和 FastApi 创建一个可扩展的图像数据库生成器，并在 Uvicorn 上运行该应用程序。两周之后，我们将探讨如何添加异步进程，实现 Pytorch。我感谢塞尔帕皮的杰出人民给我这个机会。</p></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><p id="d6fa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nn">原载于 2022 年 5 月 19 日</em><a class="ae kz" href="https://serpapi.com/blog/scalable-classifier-serpapi-fastapi/" rel="noopener ugc nofollow" target="_blank"><em class="nn">【https://serpapi.com】</em></a><em class="nn">。</em></p></div></div>    
</body>
</html>