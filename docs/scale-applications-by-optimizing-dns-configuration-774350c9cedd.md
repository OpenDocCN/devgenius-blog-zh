# 通过优化 DNS 配置来扩展应用程序

> 原文：<https://blog.devgenius.io/scale-applications-by-optimizing-dns-configuration-774350c9cedd?source=collection_archive---------3----------------------->

T **域名系统** (DNS)在互联网时代起着至关重要的作用。其设计的美妙之处在于，每个工程师都认为这是理所当然的，这是最好的系统设计之一，从这个简单而强大的解决方案中可以学到很多东西。

我们理所当然地认为另一个健壮而简单的组件是负载平衡器**。LB 充当客户机和服务器之间的中间人；客户端将请求发送到 LB，并在内部通过物理网卡发送到 VIPs，然后转发到连接的服务器。那么我们在这里看到了什么挑战呢？负载平衡器本身，在您复杂、健壮的系统设计中，负载平衡器将成为单点故障。如果 LB 宕机，您的系统也会宕机。您可以通过引入 **Zookeeper** 和主动-被动/主动-主动 LBs 逻辑来增加更多的复杂性，但这可能有点过头了。**

或者，使用 **DNS 负载平衡**。

![](img/711d6294d29cd1617e10cfb22a4df430.png)

DNS 流程简介

## 关于图表:

1.  **ISP:互联网服务提供商:**您的所有请求都会通过您的 ISP 进行路由，这有助于解析所请求主机名的 IP 地址。这将是缓存中的第一次查找；如果它失败了，那么就把请求委托给 ISP 内部的 DNS 解析器。
2.  **DNS 解析器**:它首先向根域名服务器发送请求，以获取顶级域名服务器。作为回报，TLD NS 提供权威名称服务器的地址，根据您的配置，它将返回 IP 地址列表或单个 IP。
3.  **根域名服务器(RN):**DNS 层次结构的顶层或根。这些根服务器有 13 套，分布在世界各地，由 12 个不同的组织运营。每个集合都有其唯一的 IP 地址。它包含顶级域名的全球列表和通用顶级域名(。com，。网，。org)、国家代码顶级域名(。不可以。se，。英国)和国际化顶级域名。它的作用是返回顶级域名服务器地址，以便进一步查找。你可以在[这里](https://securitytrails.com/blog/dns-root-servers)了解更多信息。
4.  **顶级域名服务器(TLD 域名服务器):**存储顶级域名的地址信息，如。com，。网，。org 等。它也不会返回所请求域名的实际 IP 地址；而是返回最终权威名称服务器的地址。
5.  **权威域名服务器(ANS)** :负责了解域名的一切，包括 IP 地址或 IP 地址列表。DNS 负载平衡使权威服务器能够向客户端返回特定域的不同 IP 地址。对于每个请求，权威服务器以循环方式改变列表中 IP 地址的顺序。当客户端收到列表时，它向第一个 IP 地址发出请求，从网站获取数据。向客户端返回 IP 地址列表的原因是，如果第一个 IP 地址没有在规定的时间内返回响应，它可以使用列表中的其他 IP 地址。当另一个客户端向权威服务器请求 IP 地址时，它会对列表重新排序，并按照循环算法将另一个 IP 地址放在列表的顶部。

**注意** : *域名 IP 缓存在 DNS 解析器，ISP，和带 TTL 的客户端。*

## 地理负载平衡

任何系统设计的总体目标都是最小化客户机和服务器之间的延迟。无论服务器有多快，如果客户端位于世界的另一端，由于网络延迟，响应时间将超过 100ms，光速限制了它。更不用说通过公共互联网长距离发送数据时增加的错误率了。

您可以将流量分配到位于其他地区的不同数据中心，以缓解这些性能问题。但是，如何确保客户端与地理上最近的 L4 负载平衡器通信呢？

这就是 DNS 地理负载平衡的用武之地——它是 DNS 的扩展，考虑从 IP 推断的客户端位置，并返回地理上最接近的 L4 负载平衡器 IP/VIP 的列表。

## 结论

最基本的负载平衡形式可以通过 DNS 来实现。假设您有几台服务器，您希望在这些服务器上对请求进行负载平衡。如果这些服务器具有可公开访问的 IP 地址，您可以将这些地址添加到服务的 DNS 记录中，并让客户端在解析 DNS 地址时选择一个地址。

虽然这很有效，但它不能很好地处理失败。如果两台服务器中的一台出现故障，DNS 服务器会很高兴地继续为其 IP 地址提供服务，而不会意识到故障。您可以手动重新配置 DNS 记录以删除有问题的 IP，但是由于 DNS 缓存的性质，不会立即应用更改。