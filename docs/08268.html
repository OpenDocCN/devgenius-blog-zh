<html>
<head>
<title>Loading Large JSON Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加载大型 JSON 文件</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/loading-large-json-files-bbd27b01f740?source=collection_archive---------1-----------------------#2022-06-01">https://blog.devgenius.io/loading-large-json-files-bbd27b01f740?source=collection_archive---------1-----------------------#2022-06-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a11f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">而不是在数据库上花钱</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/b69a2af52a7ca61ac52f1fb2ae127332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twzT7xDTtRcgJdZ2gCD_9A.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated">在<a class="ae ks" href="https://unsplash.com/s/photos/save-money?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ks" href="https://unsplash.com/@micheile?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> micheile dot com </a>拍摄的照片</figcaption></figure><p id="32a2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi lp translated">这是我想写给未来的自己的帖子之一，让我回来后重温我过去是如何做一些事情的。现在，你也可以读它，帮我赚几块钱！如果你想支持我成为一名作家，请<a class="ae ks" href="https://programarivm.medium.com/membership" rel="noopener">考虑注册我的链接</a>成为一名媒介会员。我会赚一小笔佣金。</p><p id="e265" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在 GitHub 上的 ChesslaBlab repos 上工作了一年之后，已经做了很多工作，有时我觉得好像我没有特别写这个或那个东西。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/chesslablab" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">切斯拉拉布</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">面向网络的开源象棋。ChesslaBlab 有 7 个可用的存储库。在 GitHub 上关注他们的代码。</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp km mb"/></div></div></a></div><p id="c5af" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一切都很好，尽管我记不起来了。一个好的迹象是，尽管一套 chess web 应用程序带来了越来越多的复杂性，但代码可以很容易地更改。DevOps 方面的东西也保持最小化，这与下面上一篇文章中描述的 AWS 设置非常相似。</p><div class="ly lz gp gr ma mb"><a href="https://medium.com/geekculture/how-to-make-docker-containers-talk-to-each-other-38029a461ad2" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">如何让 Docker 容器相互对话</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">通过使用桥接网络</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">medium.com</p></div></div><div class="mk l"><div class="mq l mm mn mo mk mp km mb"/></div></div></a></div><p id="0a72" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基本上，我仍然使用一个单独的<a class="ae ks" href="https://aws.amazon.com/ec2/instance-types/t2/" rel="noopener ugc nofollow" target="_blank"> t2.micro 实例</a>来运行所有需要的服务，每个月花费大约 14 美元，然而，在过去的四个月里，事实证明，一台机器单独处理这些资源太多了。</p><p id="7219" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，有一个重大的变化，以保持一切尽可能便宜。</p><h1 id="ac18" class="mr ms in bd mt mu mv mw mx my mz na nb jt nc ju nd jw ne jx nf jz ng ka nh ni bi translated">我摆脱了 MySQL 数据库</h1><p id="a36c" class="pw-post-body-paragraph kt ku in kv b kw nj jo ky kz nk jr lb lc nl le lf lg nm li lj lk nn lm ln lo ig bi translated">至少目前是这样。</p><p id="c9f8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着目前所有的象棋游戏都被转储到一个大的 JSON 文件中，供 PHP 象棋服务器进一步处理，而不是使用数据库。我想可以说平面文件数据库已经被取代了。JSON 平面文件可以做到这一点，因为它只在服务器启动时加载到内存中一次。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/cf5a4f41a98d03591d94b79dcff55560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFHH3Ibfq2g8TkoPvjueKA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated"><strong class="bd mt">图一</strong>。<a class="ae ks" href="https://github.com/chesslablab/chess-server/blob/309fa5020d42c6013abc19b6b498936694f630d8/src/Socket.php" rel="noopener ugc nofollow" target="_blank">象棋服务器构造器</a>。</figcaption></figure><p id="ae10" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">值得注意的是，WebSocket chess 服务器不同于 HTTP web 服务器，在 HTTP web 服务器中，大型 JSON 文件将在每个 HTTP 请求中加载，而不是在启动时加载，这使得平面文件方法由于内存问题而不可行。如果您需要在 web 应用程序中处理大型 JSON 文件，您可以考虑使用流解析器或像 JSON Machine 这样的内存高效解析器。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/salsify/jsonstreamingparser" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">GitHub-sals ify/jsonstreamingparser:一个用 PHP 实现的 JSON 流解析器。</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">这是一个简单的流解析器，用于处理大型 JSON 文档。使用它来解析非常大的 JSON 文档…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="np l mm mn mo mk mp km mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://github.com/halaxa/json-machine" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">GitHub - halaxa/json-machine:高效、易用、快速的 PHP JSON 流解析器</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">(README 与代码同步)非常易于使用，内存效率高，是低效迭代的替代产品…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="nq l mm mn mo mk mp km mb"/></div></div></a></div><h1 id="3d8e" class="mr ms in bd mt mu mv mw mx my mz na nb jt nc ju nd jw ne jx nf jz ng ka nh ni bi translated">如前所述</h1><p id="e831" class="pw-post-body-paragraph kt ku in kv b kw nj jo ky kz nk jr lb lc nl le lf lg nm li lj lk nn lm ln lo ig bi translated">棘轮 WebSocket 服务器就不是这种情况，因为 JSON 文件可以在 PHP Chess 库的<code class="fe nr ns nt nu b">Chess\Grandmaster</code>类的帮助下加载到服务器构造函数中。</p><div class="ly lz gp gr ma mb"><a href="https://php-chess.readthedocs.io/en/latest/grandmaster/" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">象棋\特级大师- PHP 象棋</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">Chess\Grandmaster 根据传递给其构造函数的 JSON 文件路径计算出下一步要走的棋…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">php-chess.readthedocs.io</p></div></div></div></a></div><p id="3314" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用技术语言更准确地说，一个类型为<code class="fe nr ns nt nu b">Grandmaster</code>的对象在 chess server 构造函数中被实例化，然后被分配给<code class="fe nr ns nt nu b">$this-&gt;grandmaster</code>。</p><pre class="kd ke kf kg gt nv nu nw nx aw ny bi"><span id="60f6" class="nz ms in nu b gy oa ob l oc od">$this-&gt;grandmaster = new Grandmaster(<br/>    self::DATA_FOLDER.'/players.json'<br/>);</span></pre><p id="2a6b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nr ns nt nu b">Chess\Grandmaster</code>试图根据传递给其构造函数的文件路径来判断下一步要做的事情，如下例所示。</p><pre class="kd ke kf kg gt nv nu nw nx aw ny bi"><span id="4747" class="nz ms in nu b gy oa ob l oc od"><strong class="nu io">use</strong> <strong class="nu io">Chess</strong>\<strong class="nu io">Game</strong>;<br/><strong class="nu io">use</strong> <strong class="nu io">Chess</strong>\<strong class="nu io">Grandmaster;</strong></span><span id="6884" class="nz ms in nu b gy oe ob l oc od">$game = <strong class="nu io">new</strong> Game(Game::MODE_GRANDMASTER);<br/>$game-&gt;play('w', 'e4');  </span><span id="2015" class="nz ms in nu b gy oe ob l oc od">$move = (<strong class="nu io">new</strong> Grandmaster(<strong class="nu io">__DIR__</strong>.'/../data/players.json'))<br/>    -&gt;move($game);</span><span id="dc52" class="nz ms in nu b gy oe ob l oc od">print_r($move);</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/da07663e4a44bb4ff6b2fa9884f7546f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2FNEG_QxOagmaeNLdFYpsQ.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated"><strong class="bd mt">图二</strong>。<code class="fe nr ns nt nu b">Chess\Grandmaster</code>计算出下一步的行动。</figcaption></figure><h1 id="8ed7" class="mr ms in bd mt mu mv mw mx my mz na nb jt nc ju nd jw ne jx nf jz ng ka nh ni bi translated">用象棋游戏数据创建一个 JSON 文件</h1><p id="b7f7" class="pw-post-body-paragraph kt ku in kv b kw nj jo ky kz nk jr lb lc nl le lf lg nm li lj lk nn lm ln lo ig bi translated">JSON 文件可以用 Chess 数据报告中的命令行工具生成。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/chesslablab/chess-data" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">GitHub-chess lab/chess-data:一个国际象棋数据库，数据科学和使用 Rubix ML 的机器学习。</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">一个象棋数据库，数据科学和机器学习用 Rubix ML。一个国际象棋数据库…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="og l mm mn mo mk mp km mb"/></div></div></a></div><p id="4c0c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一个分三步走的过程。首先要做的是将一堆游戏加载到 MySQL 数据库中。</p><pre class="kd ke kf kg gt nv nu nw nx aw ny bi"><span id="a699" class="nz ms in nu b gy oa ob l oc od">$ php cli/seed/players.php data/players/t2.micro<br/>✗ 2 games did not pass the validation.<br/>✓ 3893 games out of a total of 3895 are OK.<br/>✓ 3365 games out of a total of 3365 are OK.<br/>✓ 3430 games out of a total of 3430 are OK.<br/>✓ 2743 games out of a total of 2743 are OK.<br/>✗ 5 games did not pass the validation.<br/>✓ 1341 games out of a total of 1346 are OK.<br/>✓ 597 games out of a total of 597 are OK.<br/>✓ 1540 games out of a total of 1540 are OK.<br/>✓ 827 games out of a total of 827 are OK.<br/>✓ 1186 games out of a total of 1186 are OK.<br/>✗ 1 games did not pass the validation.<br/>✓ 2385 games out of a total of 2386 are OK.<br/>✓ 1826 games out of a total of 1826 are OK.<br/>✓ 919 games out of a total of 919 are OK.<br/>✓ 1186 games out of a total of 1186 are OK.<br/>✗ 1 games did not pass the validation.<br/>✓ 3497 games out of a total of 3498 are OK.<br/>✗ 2 games did not pass the validation.<br/>✓ 2108 games out of a total of 2110 are OK.<br/>✓ 1571 games out of a total of 1571 are OK.<br/>✓ 2851 games out of a total of 2851 are OK.<br/>✓ 3102 games out of a total of 3102 are OK.<br/>✓ 1395 games out of a total of 1395 are OK.<br/>✓ 3985 games out of a total of 3985 are OK.<br/>✓ 2658 games out of a total of 2658 are OK.<br/>✓ 847 games out of a total of 847 are OK.<br/>✓ 909 games out of a total of 909 are OK.<br/>✓ 2231 games out of a total of 2231 are OK.<br/>✓ 2902 games out of a total of 2902 are OK.<br/>✓ 1824 games out of a total of 1824 are OK.<br/>✓ 701 games out of a total of 701 are OK.<br/>✓ 1124 games out of a total of 1124 are OK.</span></pre><p id="4635" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个命令将在<code class="fe nr ns nt nu b"><a class="ae ks" href="https://github.com/chesslablab/chess-data/tree/master/data/players/t2.micro" rel="noopener ugc nofollow" target="_blank">data/players/t2.micro</a></code>中找到的文件植入<code class="fe nr ns nt nu b">players</code>表，T6 是一个包含几十个来自<a class="ae ks" href="https://www.pgnmentor.com/files.html" rel="noopener ugc nofollow" target="_blank"> PGN 导师</a>的游戏的文件夹。</p><blockquote class="oh oi oj"><p id="8016" class="kt ku ok kv b kw kx jo ky kz la jr lb ol ld le lf om lh li lj on ll lm ln lo ig bi translated">请注意，Chess Data repo 中的数据库专门用于为进一步的机器学习创建和准备数据，所有这些都是在本地完成的。</p></blockquote><p id="2177" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，数据被转储到<code class="fe nr ns nt nu b">output/players.csv</code>文件中。</p><pre class="kd ke kf kg gt nv nu nw nx aw ny bi"><span id="1e93" class="nz ms in nu b gy oa ob l oc od">$ php cli/csv/players.php</span></pre><p id="c9c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，使用 csvtojson 将<code class="fe nr ns nt nu b">players.csv</code>转换成<code class="fe nr ns nt nu b">players.json</code>。</p><div class="ly lz gp gr ma mb"><a href="https://www.npmjs.com/package/csvtojson" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd io gy z fp mg fr fs mh fu fw im bi translated">csvtojson</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">一个专注于将 csv 数据转换为 JSON 的工具，支持定制的解析器。最新版本:2.0.10，最新…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">www.npmjs.com</p></div></div><div class="mk l"><div class="oo l mm mn mo mk mp km mb"/></div></div></a></div><pre class="kd ke kf kg gt nv nu nw nx aw ny bi"><span id="7614" class="nz ms in nu b gy oa ob l oc od">$ csvtojson output/players.csv &gt; output/players.json</span></pre><h1 id="c251" class="mr ms in bd mt mu mv mw mx my mz na nb jt nc ju nd jw ne jx nf jz ng ka nh ni bi translated">就是这样！</h1><p id="7d3b" class="pw-post-body-paragraph kt ku in kv b kw nj jo ky kz nk jr lb lc nl le lf lg nm li lj lk nn lm ln lo ig bi translated">得到的<code class="fe nr ns nt nu b">players.json</code>大小为 35 MB，将被存储在<a class="ae ks" href="https://github.com/chesslablab/chess-server/tree/master/data" rel="noopener ugc nofollow" target="_blank">象棋服务器/数据</a>文件夹中。</p><p id="77c4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从最终用户的角度来看，当猜测国际象棋大师的走法时，这些数据被提取并显示在屏幕上，如下图所示。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi op"><img src="../Images/a76e7f8d5eb503aac11aa747aafb1504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ObpZu9cHciJjdfp7R7re-Q.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk translated"><strong class="bd mt">图 3 </strong>。训练&gt;猜棋</figcaption></figure><p id="aba2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">目前，只要国际象棋服务器没有获得太多的流量，这在 www.chesslablab.com 运行得很好。该解决方案不涉及任何数据库管理系统，只是帮助将成本保持在最低水平，这对 MVP 来说是非常好的。</p></div></div>    
</body>
</html>