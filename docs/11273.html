<html>
<head>
<title>Line Charts with Labels at Ends of Lines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">线条末端带有标签的折线图</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/line-charts-with-labels-at-ends-of-lines-6a438687fbc5?source=collection_archive---------4-----------------------#2022-12-29">https://blog.devgenius.io/line-charts-with-labels-at-ends-of-lines-6a438687fbc5?source=collection_archive---------4-----------------------#2022-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0a07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">折线图通常用于显示一段时间内的趋势。例如，我们可以查看“谷歌”股票每周或每月的价格趋势。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/333100fcfdcf7e99e51a46db9cf796df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*npO3fbILzGV8ToxfyBllSg.png"/></div></figure><p id="aee5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者，可以使用折线图来比较多个系列，方法是将它们都绘制在同一个图表上，也就是说，我们可以通过并排绘制来比较“谷歌”、“苹果”和“微软”的股价。</p><p id="d673" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当在同一图表上绘制多个系列时，会引入“图例”来帮助正确识别系列。在下面的例子中，显示在底部的图例帮助我们将“红色”线与苹果联系起来，“绿色”线与谷歌联系起来，“蓝色”线与微软联系起来。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/59478f2b79a7cba7c20cce7a7a967786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*4fmwvRos7l6ZUBA6i7hUxQ.png"/></div></figure></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="1412" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">目标</h1><p id="b254" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">上面的图表是非常基本的。包括 Microsoft Excel 和 PowerPoint 在内的大多数商业智能工具都可以轻松创建这些图例，并提供自定义图例的选项—位置、大小、字体等。</p><p id="141c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，我们的客户没有包括图例，而是要求将系列标签放在行尾。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/59e5e96faf29fd673264b19d0193e246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*P0oGIGjDGj3o4N0ly6-cJQ.png"/></div></figure><p id="60bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这可以在 PowerPoint 中通过隐藏图例并在系列旁边手动放置标签来轻松创建。但是，想象一下图表是每月更新的仪表板的一部分的场景。如果标签是根据系列的新终点自动绘制的，而不需要有人手动更改它，这不是很好吗？</p><p id="6457" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我将介绍在 r 中使用“ggplot”创建这个图表的两种方法。</p><p id="f232" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我假设你对“ggplot”有一个基本的了解。如果你是 ggplot 新手，<a class="ae ma" href="https://ggplot2.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">https://ggplot2.tidyverse.org/</a>是帮助你入门的绝佳资源。在这篇文章<a class="ae ma" href="https://medium.com/dev-genius/fancy-bubble-plot-using-ggplot2-ab8efefffded" rel="noopener">中，我还介绍了更多基本的“ggplot”术语。</a></p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="3989" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置</h1><p id="884d" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">对于这个例子，我使用“quantmod”R 库从“yahoo”获取每日股票价格。但是你可以用你喜欢的任何数据替换它。</p><h1 id="9841" class="kx ky in bd kz la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu bi translated">加载库</h1><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="c615" class="ml ky in mh b be mm mn l mo mp">if (!(require(pacman))) install.packages("pacman")<br/><br/>library(pacman)<br/>p_load(data.table, quantmod,<br/>       ggplot2, gridExtra)</span></pre><h1 id="4cee" class="kx ky in bd kz la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu bi translated">“谷歌”、“苹果”和“微软”的源股票价格</h1><p id="4e83" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">函数<code class="fe mq mr ms mh b">getMonthlyClosingPrice</code>提取两个日期(含)之间给定符号的每日股票价格。通过对给定月份的股票收盘价取平均值，将数据转换为月度数据。</p><p id="77a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该函数在返回数据之前创建一个带有股票标识符的<code class="fe mq mr ms mh b">bName</code>列。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="a0a6" class="ml ky in mh b be mm mn l mo mp">getMonthlyClosingPrice &lt;- function(x, sDate, eDate)<br/>{<br/>  # Inputs-<br/>  # x    : list with the stock symbol and string to identify the stock<br/>  # sDate: Start Date of data<br/>  # eDate: End Date of data<br/>  <br/>  # Outputs -<br/>  # DT   : Average monthly stock prices<br/>  symb &lt;- x[1] # Symbol<br/>  bName &lt;- x[2] # String identifier for the stock<br/>  <br/>  DT &lt;- data.frame(<br/>    getSymbols( # Function to pull stock prices<br/>    Symbols = symb, # Stock symbol on the exchange, for example 'GOOG' for 'Google'<br/>    src = "yahoo", # Source of data. Check the function help for more sources<br/>    from = sDate, # Start date of data<br/>    to = eDate, # End date of data<br/>    auto.assign = F # If this 'TRUE', a data frame will be auto created<br/>    )<br/>    )<br/>  <br/>  # Below two lines remove the 'symbol' from column names.<br/>  # This helps with appending the data by generalizing the column names<br/>  cName &lt;- sub(paste0(symb, "."), "", colnames(DT))<br/>  colnames(DT) &lt;- cName<br/>  <br/>  # Create a column with year and month, in the format YYYYMM<br/>  # for example, 202101 for Jan 2021.<br/>  DT$yr_month &lt;- (as.POSIXlt(rownames(DT))$year + 1900) * 100 + (as.POSIXlt(rownames(DT))$mon + 1)<br/>  <br/>  # Create a summarized monthly dataset<br/>  DT &lt;- data.table(DT)[,.(avgPr = mean(Close, na.rm = T)),<br/>                         by=.(yr_month)]<br/>  # Add a column with stock identifier<br/>  DT$brand &lt;- bName<br/>  <br/>  # Return the dataset<br/>  return(DT)<br/>}</span></pre><p id="58df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mq mr ms mh b">stockList</code>是要拉的符号和股票对应名称的列表。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="7363" class="ml ky in mh b be mm mn l mo mp"># List of stock to pull<br/># Each entry has a 'symbol' and 'stock identifier'<br/>stockList &lt;- list(<br/>  c("GOOG", "Google"),<br/>  c("AAPL", "Apple"),<br/>  c("MSFT", "Microsoft")<br/>)</span></pre><p id="0eb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">向<code class="fe mq mr ms mh b">lapply</code>提供<code class="fe mq mr ms mh b">stockList</code>将返回 3 个数据集，每个符号一个。使用<code class="fe mq mr ms mh b">rbind</code>和<code class="fe mq mr ms mh b">do.call</code>将这些组合成一个数据集。</p><p id="46ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以选择在一个<code class="fe mq mr ms mh b">for</code>循环中使用<code class="fe mq mr ms mh b">rbind</code>，而不是<code class="fe mq mr ms mh b">do.call</code>和<code class="fe mq mr ms mh b">lapply</code>。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="e3ab" class="ml ky in mh b be mm mn l mo mp"># Pull stock prices for 3 stocks in the list and<br/># create a combined dataset<br/>DT &lt;- do.call("rbind", <br/>              lapply(<br/>                stockList,<br/>                getMonthlyClosingPrice,<br/>                "2020-01-01",<br/>                "2021-12-31"<br/>              )<br/>              )</span></pre><p id="51a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经有了创建图的数据，让我们看看两个选项。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="5718" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">选项 1-扩展图边距并关闭“裁剪”</h1><p id="88c3" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">使用<code class="fe mq mr ms mh b">geom_line</code>创建折线图，使用<code class="fe mq mr ms mh b">geom_text</code>绘制标签。</p><p id="fab3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为标签是为系列中的最后一个点绘制的，所以<code class="fe mq mr ms mh b">geom_text</code>的数据是使用<code class="fe mq mr ms mh b">tail</code>函数的子集。请注意，函数<code class="fe mq mr ms mh b">getMonthlyClosingPrice</code>生成的数据集已经按升序排列，所以我在调用<code class="fe mq mr ms mh b">tail</code>函数之前跳过了对数据集排序的步骤。</p><p id="5917" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您不熟悉“data.table”，请参考<a class="ae ma" href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" rel="noopener ugc nofollow" target="_blank">https://cran . r-project . org/web/packages/data . table/vignettes/datatable-intro . html</a>。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="25bf" class="ml ky in mh b be mm mn l mo mp">ggplot(data = DT) + <br/>  # Create the line chart<br/>  geom_line(aes(<br/>    x = factor(yr_month), # 'yr_month' is numeric. By converting it to 'factor', we force ggplot to treat the x-axis as discrete instead of continuous<br/>    y = avgPr,<br/>    group = brand, color = brand),<br/>            size = 1 # controls thickness of the line<br/>    ) +<br/>  # Create labels<br/>  geom_text(<br/>    data = DT[,lapply(.SD,tail,1),by=.(brand)], # Subset data to keep only the last entry per series. This is 'data.table' terminology.<br/>    aes(<br/>      x = Inf, # This plots the labels towards the extreme right of the chart<br/>      y = avgPr, <br/>      label = brand, color = brand),<br/>      hjust = 0 # Left justify labels<br/>    ) +<br/>  # X-axis and Y-axis titles<br/>  xlab("Months") + ylab("Closing Price") +<br/>  # Plot Title<br/>  ggtitle("Average Monthly Closing Price") +<br/>  # Switch off clipping of text. This is required because 'x = Inf' will push<br/>  # the labels to be printed on extreme right of the plot, causing some letters<br/>  # to fall beyond the chart margins. By default, these characters will not be<br/>  # shown. Switching off the 'clip' option, ensures the characters are displayed.<br/>  coord_cartesian(clip = "off") +<br/>  theme_minimal() +<br/>  theme(<br/>    plot.title = element_text(hjust = 0.5, size = 14, face = "bold.italic"),<br/>    axis.text.x = element_text(size = 11, angle = 90),<br/>    panel.grid = element_blank(),<br/>    axis.line.x = element_line(size = 2),<br/>    legend.position = "none",<br/>    # 'plot.margin' is used to expand the margins<br/>    plot.margin = unit(<br/>      c(1,3,1,1), <br/>      "lines")<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/59e5e96faf29fd673264b19d0193e246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*P0oGIGjDGj3o4N0ly6-cJQ.png"/></div></figure><p id="cf42" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个选项简单明了。对于标签短且甜的情况，它工作得非常好。但是，如果标签较长或 x 轴延长，即如果显示 36 个月而不是 24 个月，您可能会遇到标签重叠或部分标签被切掉的问题。</p><p id="5e9f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您遇到这些问题，请尝试选项 2。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="65af" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">选项 2-创建两个图并并排显示</h1><p id="1ab0" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在前一个选项中，折线图和标签绘制在同一个图表上。现在，我们将折线图和标签绘制成两个独立的图表。然后使用<code class="fe mq mr ms mh b">gridExtra</code>库中的<code class="fe mq mr ms mh b">grid.arrange</code>将它们组合起来。</p><p id="8cb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为两个图是独立的，所以需要一些额外的步骤来确保图尺寸对齐。</p><ol class=""><li id="9929" class="mt mu in jm b jn jo jr js jv mv jz mw kd mx kh my mz na nb bi translated">y 轴极限必须手动设置。标签图的数据是仅保留最后一个入口点的子集。如果 y 轴限制是自动设置的，则折线图和标签图的限制可能会不同，因此标签可能会错位。</li><li id="ebd9" class="mt mu in jm b jn nc jr nd jv ne jz nf kd ng kh my mz na nb bi translated">标签图上的一些元素必须被标绘，但通过指定透明颜色来隐藏。例如，影响绘图区的元素有图表标题、x 轴标签和标题以及 x 轴线条。这些必须标绘，但使用透明颜色“#FFFFFF00”隐藏。</li></ol><h2 id="1d6d" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">折线图</h2><p id="5acf" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">与“选项 1”相同，但我们不再绘制<code class="fe mq mr ms mh b">geom_text</code>。设置 y 轴的最小和最大限值。</p><p id="d527" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mq mr ms mh b">plot.margin</code>用于通过固定上下页边距来确保两个图表对齐。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="3062" class="ml ky in mh b be mm mn l mo mp"># Lower and Upper limits for Y-axis<br/>yMin &lt;- min(DT$avgPr) * 0.9 # 90% of the minimum average closing price across all series<br/>yMax &lt;- max(DT$avgPr) * 1.1 # 110% of the maximum average closing price across all series<br/><br/>lChart &lt;- ggplot(data = DT) + <br/>  # Create the line chart<br/>  geom_line(aes(<br/>    x = factor(yr_month), # 'yr_month' is numeric. By converting it to 'factor', we force ggplot to treat the x-axis as discrete instead of continuous<br/>    y = avgPr,<br/>    group = brand, color = brand),<br/>            size = 1 # controls thickness of the line<br/>    ) +<br/>  # X-axis and Y-axis titles<br/>  xlab("Months") + ylab("Closing Price") +<br/>  # Plot Title<br/>  ggtitle("Average Monthly Closing Price") +<br/>  coord_cartesian(ylim = c(yMin, yMax), clip = "off") +<br/>  theme_minimal() +<br/>  theme(<br/>    plot.title = element_text(hjust = 0.5, size = 14, face = "bold.italic"),<br/>    axis.text.x = element_text(size = 11, angle = 90),<br/>    panel.grid = element_blank(),<br/>    axis.line.x = element_line(size = 2),<br/>    legend.position = "none",<br/>    # 'plot.margin' is used to expand the margins<br/>    plot.margin = unit(<br/>      c(1,1,1,1), <br/>      "lines")<br/>  )</span></pre><h2 id="4a33" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">标签</h2><p id="e3c5" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">这部分代码有明显的变化。</p><ol class=""><li id="6751" class="mt mu in jm b jn jo jr js jv mv jz mw kd mx kh my mz na nb bi translated"><code class="fe mq mr ms mh b">x=Inf</code>替换为<code class="fe mq mr ms mh b">x=factor(yr_month)</code></li><li id="6cb7" class="mt mu in jm b jn nc jr nd jv ne jz nf kd ng kh my mz na nb bi translated"><code class="fe mq mr ms mh b">color</code>为绘图标题，x 轴标签和标题，x 轴本身设置为' #FFFFFF00' (hexcode 为透明)。</li><li id="797b" class="mt mu in jm b jn nc jr nd jv ne jz nf kd ng kh my mz na nb bi translated"><code class="fe mq mr ms mh b">plot.margin</code>用于确保标签完全显示。你可能需要调整左边距来得到正确的结果。</li></ol><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="d2c1" class="ml ky in mh b be mm mn l mo mp">tChart &lt;- ggplot(data = DT) +<br/>  # Create labels<br/>  geom_text(<br/>    data = DT[,lapply(.SD,tail,1),by=.(brand)], # Subset data to keep only the last entry per series. This is 'data.table' terminology.<br/>    aes(<br/>      x = factor(yr_month), # The labels are no longer forced to be outside the plotting. So we can use the 'yr_month' for the last point in the series.<br/>      y = avgPr, <br/>      label = brand, color = brand),<br/>      hjust = 0 # Left justify labels<br/>    ) +<br/>  # X-axis and Y-axis titles<br/>  xlab("Months") + ylab("Closing Price") +<br/>  # Plot Title<br/>  ggtitle("Average Monthly Closing Price") +<br/>  coord_cartesian(ylim = c(yMin, yMax), clip = "off") +<br/>  theme_minimal() +<br/>  theme(<br/>    plot.title = element_text(hjust = 0.5, size = 14, face = "bold.italic",<br/>                              color = "#FFFFFF00"),<br/>    axis.text.y = element_blank(),<br/>    axis.title.y = element_blank(),<br/>    axis.title.x = element_text(color = "#FFFFFF00"),<br/>    axis.text.x = element_text(size = 11, angle = 90,<br/>                               color = "#FFFFFF00"),<br/>    panel.grid = element_blank(),<br/>    axis.line.x = element_line(size = 2, color = "#FFFFFF00"),<br/>    legend.position = "none",<br/>    # 'plot.margin' is used to expand the margins<br/>    plot.margin = unit(<br/>      c(1,5,1,1), <br/>      "lines")<br/>  )</span></pre><h2 id="35ff" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">将折线图和标签放在一起</h2><p id="92b1" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">这两个图表是使用<code class="fe mq mr ms mh b">grid.arrange</code>并排绘制的。使用<code class="fe mq mr ms mh b">widths</code>选项控制分配给每个图表的区域。在这种情况下，90%的区域分配给<code class="fe mq mr ms mh b">lChart</code>(折线图)，10%分配给<code class="fe mq mr ms mh b">tChart</code>(标签图)。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="ae77" class="ml ky in mh b be mm mn l mo mp">grid.arrange(<br/>  lChart, <br/>  tChart, <br/>  widths = c(9, 1)<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/52dba93378864ec5023bd6f84258190e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*tqiKImfDDsrvMFyPgzTY8w.png"/></div></figure><p id="6cbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当标签较长或 x 轴延长时，固定分配给每个图表的区域给我们更多的灵活性，即我们绘制 36 个月而不是 24 个月。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="934d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">要探索的其他功能</h1><h2 id="491e" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">字符串换行</h2><p id="c839" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">对于绘制更长的标签，尝试<code class="fe mq mr ms mh b">stringr</code>库中的<code class="fe mq mr ms mh b">str_wrap</code>功能。你可以在<code class="fe mq mr ms mh b">geom_text</code>的<code class="fe mq mr ms mh b">label</code>美学中调用这个函数。</p><pre class="kj kk kl km gt mg mh mi bn mj mk bi"><span id="cb4d" class="ml ky in mh b be mm mn l mo mp">#geom_text(aes(label = stringr::str_wrap(brand, width = 5)))</span></pre><h2 id="aec4" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">几何 _ 文本 _ 排斥</h2><p id="a7be" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">如果标签重叠，尝试用<code class="fe mq mr ms mh b">ggrepel</code>库中的<code class="fe mq mr ms mh b">geom_text_repel</code>替换<code class="fe mq mr ms mh b">geom_text</code>。</p><h2 id="3bc8" class="nh ky in bd kz ni nj dn ld nk nl dp lh jv nm nn ll jz no np lp kd nq nr lt ns bi translated">刻度 _ 颜色 _ 手动</h2><p id="9f11" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">您可能已经注意到，我们没有在代码中为任何品牌指定颜色。颜色由 ggplot 根据默认调色板自动分配。您可以使用<code class="fe mq mr ms mh b">ggplot</code>中的<code class="fe mq mr ms mh b">scale_color_manual</code>选择指定特定的颜色。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="07b3" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="cab2" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在本文中，我们使用<code class="fe mq mr ms mh b">quantmod</code>库获取股票价格。使用<code class="fe mq mr ms mh b">do.call</code>和<code class="fe mq mr ms mh b">lapply</code>合并数据集。</p><p id="d641" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们看到了绘制折线图的两个选项，其中系列标签显示在每个系列的最后一个点的右侧。</p><ul class=""><li id="a9c4" class="mt mu in jm b jn jo jr js jv mv jz mw kd mx kh nt mz na nb bi translated">选项 1 —通过使用<code class="fe mq mr ms mh b">x=Inf</code>将标签推向最右侧，将标签绘制在同一图表上。使用<code class="fe mq mr ms mh b">theme</code>中的<code class="fe mq mr ms mh b">plot.margin</code>选项扩展情节页边距，并使用<code class="fe mq mr ms mh b">coord_cartesian</code>中的<code class="fe mq mr ms mh b">clip="off"</code>关闭字符剪辑。</li><li id="e5d5" class="mt mu in jm b jn nc jr nd jv ne jz nf kd ng kh nt mz na nb bi translated">选项 2 —标签绘制在单独的图表上。然后使用<code class="fe mq mr ms mh b">grid.arrange</code>将折线图和标签放在一起。使用<code class="fe mq mr ms mh b">widths</code>分配每个图表的绘图区域。</li></ul><p id="03fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">检查这个<a class="ae ma" href="https://stackoverflow.com/questions/29357612/plot-labels-at-ends-of-lines" rel="noopener ugc nofollow" target="_blank">线程</a>以获得创建这些图的其他方法。</p><p id="fd73" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望你觉得这篇文章有趣。请在评论区留下你的想法/反馈。</p></div></div>    
</body>
</html>