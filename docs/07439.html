<html>
<head>
<title>You should be aware of this if you are using Collectors.toMap in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果您在 Java 中使用 Collectors.toMap，您应该意识到这一点</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/you-should-be-aware-of-this-if-you-are-using-collectors-tomap-in-java-5d2e7bbd136?source=collection_archive---------6-----------------------#2022-03-25">https://blog.devgenius.io/you-should-be-aware-of-this-if-you-are-using-collectors-tomap-in-java-5d2e7bbd136?source=collection_archive---------6-----------------------#2022-03-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="574e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">已经使用过 stream 和 Collectors 的人可能已经知道了这一点。但是我最近犯了一个错误，我想和大家分享一下。如果你已经知道了，我希望这是对你的一个修正，如果没有，那么你会学到一些新的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2f9662ec7166f3fad20e2fe5a8a50b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xuq0Izoeo26mlRuX"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@emilymorter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾米丽·莫特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="89d7" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">首先，Collectors.toMap 做什么？</h1><p id="8e77" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">如果你有一个集合(它可以是一个列表，集合，链表，栈等等。)并且你想把它转换成地图，那么这个<code class="fe mc md me mf b">Collectors.toMap</code>可以帮你解决。</p><h1 id="7770" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">让我们举一个例子</strong></h1><p id="f279" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我们有一个跳远运动员的列表，我们想把它转换成一个<code class="fe mc md me mf b">&lt;name, length&gt;</code>的地图。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="44b6" class="mk la in mf b gy ml mm l mn mo">// This is our Long jump athlete class<br/>public class LongJumpAthlete {<br/>    private String name;<br/>    private double length;<br/>    private String state;</span><span id="0333" class="mk la in mf b gy mp mm l mn mo">    public String getName() {<br/>        return this.name;<br/>    }</span><span id="5453" class="mk la in mf b gy mp mm l mn mo">    public double getLength() {<br/>        return this.length;<br/>    }</span><span id="da37" class="mk la in mf b gy mp mm l mn mo">    public String getState() {<br/>        return this.state;<br/>    }</span><span id="aea6" class="mk la in mf b gy mp mm l mn mo">    public LongJumpAthlete(<br/>        String name, double length, String state) <br/>    {<br/>        this.name = name;<br/>        this.length = length;<br/>        this.state = state;<br/>    }<br/>}</span></pre><p id="8797" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们看看如何将它转换成一个<code class="fe mc md me mf b">Map&lt;name, length&gt;</code>。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="0fb3" class="mk la in mf b gy ml mm l mn mo">// Here we are converting the list of Long jump athletes to Map&lt;name, length&gt;<br/>public class ToMapDemo {<br/>    public static void main(String[] args) {<br/>        List&lt;LongJumpAthlete&gt; athletes = new ArrayList&lt;&gt;();<br/>        athletes.add(new LongJumpAthlete("Ram", 1.23, "UP"));<br/>        athletes.add(new LongJumpAthlete("Shyam", 1.29, "Delhi"));<br/>        athletes.add(new LongJumpAthlete(<br/>            "Ghanshyam", 1.27, "Karnatka")<br/>        );</span><span id="f62e" class="mk la in mf b gy mp mm l mn mo">        Map&lt;String, Double&gt; map = athletes.<br/>           stream().<br/>           collect(Collectors.toMap(<br/>              LongJumpAthlete::getName,  <br/>              LongJumpAthlete::getLength)<br/>           );</span><span id="daa6" class="mk la in mf b gy mp mm l mn mo">       for(Map.Entry&lt;String, Double&gt; entry: map.entrySet()) {<br/>            System.out.println(<br/>                "key " + entry.getKey() + <br/>                " value " entry.getValue()<br/>            );<br/>        }<br/>    }<br/>}</span></pre><p id="1d10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们运行程序。它将在输出终端中打印出来。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/33e84ffa03b3791271c3b39dc688767f.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*W5EoIWiNEEG5oQv2tjXOeQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">程序的输出</figcaption></figure><p id="bdb8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好吧，你一定认为这很好，那还有什么问题。</p><h1 id="c3ab" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">让我们现在讨论这个问题</h1><p id="39f1" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在上面的例子中，我们没有任何重复的条目，对吗？让我们看看如果我们向列表中添加另一个同名条目会发生什么。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="3b4a" class="mk la in mf b gy ml mm l mn mo">athletes.add(new LongJumpAthlete("Ram", 1.27, "UP"));</span></pre><h2 id="4c90" class="mk la in bd lb mr ms dn lf mt mu dp lj jv mv mw ln jz mx my lr kd mz na lv nb bi translated">现在让我们运行程序。你看到了什么？</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/534883b6ecaebebf9641d2b11d9b2516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIQuR3hdsQwKRNPSsCoeiA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">出现重复键时出现 IllegalStateException</figcaption></figure><p id="ff0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到<code class="fe mc md me mf b">IllegalStateException</code>是因为重复的键。</p><h2 id="1524" class="mk la in bd lb mr ms dn lf mt mu dp lj jv mv mw ln jz mx my lr kd mz na lv nb bi translated">为什么会这样？</h2><p id="823a" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">这是因为我们的算法不知道使用哪种策略来解决冲突。</p><p id="9327" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可能有不同的策略，这将取决于具体的用例。</p><ol class=""><li id="442c" class="nd ne in jm b jn jo jr js jv nf jz ng kd nh kh ni nj nk nl bi translated">在某些情况下，我们可以让程序覆盖这个值，选择最新的值</li><li id="e00c" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated">而在某些情况下，我们希望从两个值中选择最小值或最大值</li><li id="2884" class="nd ne in jm b jn nm jr nn jv no jz np kd nq kh ni nj nk nl bi translated">或者在某些情况下，我们想要合并结果或者取两者的平均值</li></ol><h1 id="e6db" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">让我们看看如何解决这个问题</h1><p id="97e0" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated"><code class="fe mc md me mf b">Collectors.toMap</code>接受一个合并函数，在这个函数中，您可以定义如何解决重复键的策略。</p><p id="6c77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看看，在我们的例子中，我们想要两个冲突条目的最佳长度。所以我们可以这样做。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="9382" class="mk la in mf b gy ml mm l mn mo">map = athletes.<br/>    stream().<br/>    collect(<br/>        Collectors.toMap(<br/>            LongJumpAthlete::getName, <br/>            LongJumpAthlete::getLength, <br/>            (a,b) -&gt; Math.max(a,b)<br/>        )<br/>    );</span></pre><p id="e0c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在输出将是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/24d76e5d0e027e93711f575b929e174a.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*vFRTGF_SkmT1abfxVt7j1A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用 toMap 的程序输出</figcaption></figure><h1 id="603b" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">额外小费</h1><p id="6b54" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated"><code class="fe mc md me mf b">Collectors.toMap</code>还接受了一个供应商函数，通过它你可以指定你想要作为最终地图使用的地图的具体实现。</p><p id="afd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的例子中，如果你注意到我们在列表中插入条目的顺序和映射的顺序不匹配。这是因为默认情况下它返回一个<code class="fe mc md me mf b">HashMap</code>。但是假设我们想要保持顺序，那么我们可以选择<code class="fe mc md me mf b">LinkedHashMap</code>，或者如果我们想要对键进行排序，那么我们可以使用<code class="fe mc md me mf b">TreeMap</code>。</p><p id="4f15" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看两个例子。</p><h2 id="e065" class="mk la in bd lb mr ms dn lf mt mu dp lj jv mv mw ln jz mx my lr kd mz na lv nb bi translated">树形图</h2><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="a28a" class="mk la in mf b gy ml mm l mn mo">// Tree Map<br/>Map&lt;String, Double&gt; map  = athletes.stream().<br/>    collect(<br/>        Collectors.toMap(<br/>            LongJumpAthlete::getName, <br/>            LongJumpAthlete::getLength, <br/>            (a,b) -&gt; Math.max(a,b),<br/>            TreeMap::new<br/>        )<br/>   );</span></pre><p id="ff3a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用这个实现，输出将如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/347a55ee4d0a92f076cb7230ab29d296.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*I2AvFUoNbwWB_GnCWExvQQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用树形图实现的输出</figcaption></figure><h2 id="c5da" class="mk la in bd lb mr ms dn lf mt mu dp lj jv mv mw ln jz mx my lr kd mz na lv nb bi translated">LinkedHashMap</h2><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="258b" class="mk la in mf b gy ml mm l mn mo">// LinkedHash Map<br/>Map&lt;String, Double&gt; map  = athletes.stream().<br/>    collect(<br/>        Collectors.toMap(<br/>            LongJumpAthlete::getName, <br/>            LongJumpAthlete::getLength, <br/>            (a,b) -&gt; Math.max(a,b),<br/>            LinkedHashMap::new<br/>        )<br/>   );</span></pre><p id="3ff2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用这个实现，输出将如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e7ff5896ef5d448285d86b97bc5e7b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*VH4LPstOW0KVEWWni3-GrQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">LinkedHashMap 实现的输出</figcaption></figure><p id="c2ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望这能帮助到你们中的一些人。</p></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><p id="758e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想了解更多，请浏览这个文档。</p><ol class=""><li id="25c7" class="nd ne in jm b jn jo jr js jv nf jz ng kd nh kh ni nj nk nl bi translated"><a class="ae ky" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html#toMap-java.util.function.Function-java.util.function.Function-" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/javase/8/docs/API/Java/util/stream/collectors . html # toMap-Java . util . function . function-Java . util . function . function-</a></li></ol></div></div>    
</body>
</html>