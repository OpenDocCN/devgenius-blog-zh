<html>
<head>
<title>Messaging Using Google Pub/Sub and Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌发布/订阅和 Spring Boot 发送消息</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/messaging-using-google-pub-sub-and-spring-boot-1bc8a20adb2c?source=collection_archive---------0-----------------------#2021-02-07">https://blog.devgenius.io/messaging-using-google-pub-sub-and-spring-boot-1bc8a20adb2c?source=collection_archive---------0-----------------------#2021-02-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="b828" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">Pub/Sub 是一个完全托管的实时消息服务，允许您在独立的应用程序之间发送和接收消息。</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/bb0dac03a14ffcc0e7df496b0f5c7053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6s7oMX4QJ6_Iwr2-fpU8rA.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">托马索·佩奇奥利在<a class="ae kw" href="https://unsplash.com/s/photos/post-office?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4776" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你可能遇到过很多这样的情况，当你打开你的电子邮件收件箱时，你会发现一封来自亚马逊的促销邮件，声明其即将到来的销售，但随后你可能会发现你的邮件也是同样的邮件(当然，如果他允许你偷看他的收件箱)。这些邮件发送给所有像你我一样订阅了亚马逊促销通知的消费者。这些邮件是发布者-订阅者设计模式的一个广泛的例子，像 Google，Amazon，Spotify 等更大的组织。定期使用向所有消费者(或者更确切地说是订户)推广活动。</p><h1 id="b769" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">发布/订阅模式</h1><p id="c19b" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">发布/订阅模式，也称为发布/订阅，是一种架构设计模式，为发布者和订阅者之间交换消息提供了一个框架。这种模式涉及依赖消息代理的发布者和订阅者，消息代理将消息从发布者中继到订阅者。主持人(发布者)将消息(事件)发布到订阅者可以注册的频道。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj mq"><img src="../Images/9f74b266e20557011713112ead67ad9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/1*-GHFC93E4ODwNc98IE5_vA.gif"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">发布/订阅通信基础设施。图片来自<a class="ae kw" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/images/ff649664.despublishsubscribe_f01(en-us,pandp.10).gif" rel="noopener ugc nofollow" target="_blank">微软</a></figcaption></figure><h1 id="0e3c" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">云发布/订阅</h1><p id="7851" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">Google Cloud Pub/Sub 是一种异步消息服务，建立在许多 Google 产品依赖了十多年的核心 Google 基础设施组件之上。包括广告、搜索和 Gmail 在内的谷歌产品使用这一基础设施每秒发送超过 5 亿封邮件，总计超过 1TB/s 的数据。太棒了！不是吗？</p><p id="9b61" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">据说它是谷歌自己实现的 Apache Kafka，并且它完全由谷歌管理，这使得它具有很高的可靠性和可扩展性。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="ms mt l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">一个优秀的 YouTube 视频，概述了 Pub/Sub 在现实生活中的应用</figcaption></figure><h1 id="7c92" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">一些动手操作来开始</h1><p id="7928" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">最近，我为我的组织创建了一个 Spring boot 应用程序，该应用程序订阅了一个主题事件，并将在接收来自发布者的消息时执行一项任务。当然，主题是在 Google 发布/订阅服务中创建的。</p><p id="df63" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在本文中，我将在 Google Cloud Platform 中创建一个发布/订阅主题，并发布一条消息，这条消息将被一个 Spring boot 应用程序订阅，并将在控制台中记录这条消息。显然，这篇文章将是一个简单的演示，向您介绍发布/订阅服务的要点。</p><h2 id="0424" class="mu lu ir bd lv mv mw dn lz mx my dp md lg mz na mf lk nb nc mh lo nd ne mj nf bi translated">先决条件</h2><ul class=""><li id="6282" class="ng nh ir kz b la ml ld mm lg ni lk nj lo nk ls nl nm nn no bi translated">你需要有一个 GCP 账户。如果你没有，你可以用你的信用卡或借记卡轻松创建，他们不会向你收取任何费用。90 天的免费试用给你 300 美元。更多详情请参考<a class="ae kw" href="https://console.cloud.google.com/freetrial/signup/tos" rel="noopener ugc nofollow" target="_blank"> <em class="mr">此处</em> </a>。</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj np"><img src="../Images/0c6cd9b656af8831f99b9c0ba885457f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*C_wHmtmITDlpauguIEgncQ.png"/></div></figure><ul class=""><li id="e852" class="ng nh ir kz b la lb ld le lg nq lk nr lo ns ls nl nm nn no bi translated">您必须熟悉<a class="ae kw" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Cloud SDK </a>来认证您的本地机器以连接到发布/订阅服务。阅读<a class="ae kw" href="https://cloud.google.com/sdk/docs/authorizing" rel="noopener ugc nofollow" target="_blank"> <em class="mr">此处</em> </a>用谷歌云认证你的机器。</li><li id="7561" class="ng nh ir kz b la nt ld nu lg nv lk nw lo nx ls nl nm nn no bi translated">基本了解 Spring boot 框架(考虑到你懂一些 Java)。当然，编程语言并不妨碍学习发布/订阅服务，只是，对于本文和演示的范围，我使用的是 Spring boot。</li></ul><h2 id="4057" class="mu lu ir bd lv mv mw dn lz mx my dp md lg mz na mf lk nb nc mh lo nd ne mj nf bi translated">创建云发布/订阅主题和订阅</h2><p id="42bf" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">假设您已经在 GCP 帐户中创建了一个项目，因为 Google Cloud 中的每个服务都需要一个项目，该项目可以被视为创建 VPC、VPN、虚拟机、数据库和其他云服务的工作空间。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ny"><img src="../Images/aeee8eb6bd56c161bd3e1732c4d3729c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0aAPkPLftyz7_VVVGwQ8Q.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">我创建发布/订阅主题的项目名称</figcaption></figure><p id="4a9e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后您需要<em class="mr">启用发布/订阅 API </em>来使用服务。您可以将鼠标悬停在菜单上的所有服务上，然后选择发布/订阅，这将进入启用发布/订阅 API 页面。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj nz"><img src="../Images/689354b1a50d5c3c880a3d07bb9f1401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*PzbgteOmRb31eqL3XjmdJg.png"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">选择发布/订阅以启用 API 并使用服务。</figcaption></figure><p id="0ff1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">一旦启用了发布/订阅服务，您就可以创建一个主题来发布消息。所以，我们来创造一个话题。我给了一个名字<code class="fe oa ob oc od b">pubsubdemoTopic</code>，点击<em class="mr">创建话题</em>。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oe"><img src="../Images/fb2df0a2bea4b69bc31bbcca23912ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CoAkPjFOEB0_MUFsWADLjw.png"/></div></div></figure><p id="ed5a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在 Pub/Sub 主页中，您需要点击<em class="mr">创建订阅</em>按钮并创建订阅<code class="fe oa ob oc od b">pubsubdemoSubscription<strong class="kz is">.</strong></code> <strong class="kz is"> </strong>您需要<strong class="kz is"> </strong>选择云 Pub/Sub 主题<code class="fe oa ob oc od b">pubsubdemoTopic<strong class="kz is">,</strong></code>交付类型为<em class="mr">拉</em>并点击<em class="mr">创建。</em></p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj of"><img src="../Images/ad8ca83836398ba346a9b96b1910f2ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70rhHQ5mMEzdczeLxkTWgA.png"/></div></div></figure><h2 id="ce2b" class="mu lu ir bd lv mv mw dn lz mx my dp md lg mz na mf lk nb nc mh lo nd ne mj nf bi translated">创建 Spring Boot 应用程序</h2><p id="c457" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">我已经创建了一个 spring boot 应用程序，它使用订阅来阅读发布的消息。为此，您基本上需要使用两个依赖项。</p><pre class="kh ki kj kk gu og od oh oi aw oj bi"><span id="007a" class="mu lu ir od b gz ok ol l om on">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-cloud-gcp-starter-pubsub&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-integration-core&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="1250" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">事件订阅者的完整 pom.xml 由两个重要的依赖项组成，<code class="fe oa ob oc od b">spring-cloud-gcp-starter-pubsub</code> <strong class="kz is"> </strong>和<code class="fe oa ob oc od b">spring-integration-core</code>。<strong class="kz is"/><strong class="kz is"/>应用程序是一个 web 应用程序，将使用嵌入式 tomcat 服务器。</p><p id="56ef" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is"> pom.xml </strong></p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="oo mt l"/></div></figure><p id="aefe" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了从创建的订阅中提取消息，我创建了一个名为<code class="fe oa ob oc od b">EventSubscriberService.</code>的服务</p><p id="47de" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">EventSubscriberService.java</strong></p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="oo mt l"/></div></figure><p id="4e9d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe oa ob oc od b">inboundChannelAdapter</code>使用<code class="fe oa ob oc od b">PubSubTemplate</code>从订阅<code class="fe oa ob oc od b">pubsubdemoSubscription</code>异步提取消息，并将消息发送给<code class="fe oa ob oc od b">inputMessageChannel.</code><code class="fe oa ob oc od b">inboundChannelAdapter</code>将确认模式设置为<code class="fe oa ob oc od b">MANUAL</code>，这样应用程序就可以在处理完消息后确认消息。<code class="fe oa ob oc od b">PubSubInboundChannelAdapter</code>类型的默认确认模式是<code class="fe oa ob oc od b">AUTO</code>。<code class="fe oa ob oc od b">ServiceActivator</code> bean <code class="fe oa ob oc od b">messageReceiver</code>将到达<code class="fe oa ob oc od b">inputMessageChannel</code>的每个消息记录到标准输出，然后确认该消息。</p><h2 id="b35b" class="mu lu ir bd lv mv mw dn lz mx my dp md lg mz na mf lk nb nc mh lo nd ne mj nf bi translated">从订阅发布消息和打印</h2><p id="dfed" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">要发布消息，您必须进入发布/订阅主页，然后选择主题，您必须点击<em class="mr">发布消息。</em></p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj op"><img src="../Images/f79f34e12eb5b25d324d67a0c8481b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVvLlrAG1GkXdNmX1ehFsg.png"/></div></div></figure><p id="a2d1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">将出现一个页面，让您在<em class="mr">消息正文</em>中发布一条消息，然后<em class="mr">发布。</em></p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oq"><img src="../Images/ba5d7215d435ac016be85ac26a1048d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zqgIqA8fa7AtJ8ismG8heQ.png"/></div></div></figure><p id="d1e7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，因为应用程序已经订阅了主题，所以消息将被成功地记录到控制台上。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj or"><img src="../Images/816e98f830d7fcb22994152a4e1599fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSgxurVsfSD2VTM05lT27A.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk translated">控制台中记录的消息</figcaption></figure><p id="393d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果您遵循了，那么恭喜您，您刚刚创建了一个订阅应用程序，它记录了来自云发布/订阅主题的消息。</p><p id="5eab" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你可以从<a class="ae kw" href="https://github.com/viveknaskar/event-subscriber/tree/master" rel="noopener ugc nofollow" target="_blank"> <em class="mr">这个 GitHub 库</em> </a>获取完整代码。</p><h1 id="2ddd" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">这是一个总结！</h1><p id="a086" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">这只是发布者-订阅者模式的一个小概述，这只是一个小应用程序。Pub/Sub 服务可以做的事情太多了，老实说，本文几乎没有涉及到。我强烈建议<a class="ae kw" href="https://cloud.google.com/pubsub/docs" rel="noopener ugc nofollow" target="_blank"> <em class="mr">阅读文档以获得更多见解</em> </a>。</p><p id="e55f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">包括亚马逊网络服务(AWS)和微软 Azure 在内的所有其他主要云服务提供商都实现了发布/订阅服务。对于 Google Cloud，Pub/Sub 是平台中使用最多的服务之一，在构建各种“企业”事件交付系统方面表现突出。</p><p id="32b2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">一个这样的例子是<em class="mr"> Spotify 的事件交付系统</em>，你可以从他们的文档中读到。</p><div class="os ot gq gs ou ov"><a href="https://engineering.atspotify.com/2016/03/03/spotifys-event-delivery-the-road-to-the-cloud-part-ii/" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd is gz z fq pa fs ft pb fv fx iq bi translated">Spotify 的活动交付——通向云之路(下)</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">每当用户在 Spotify 客户端执行一项操作时——比如听歌或搜索艺术家——一个小的…</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">engineering.atspotify.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj kq ov"/></div></div></a></div></div><div class="ab cl pk pl hv pm" role="separator"><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp"/></div><div class="ik il im in io"><p id="264c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">如果你喜欢读这篇文章，你可能也会发现下面的文章值得你花时间去读。</strong></p><div class="os ot gq gs ou ov"><a href="https://medium.com/dev-genius/a-developers-guide-for-passing-google-cloud-associate-cloud-engineer-exam-8a95adb44721" rel="noopener follow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd is gz z fq pa fs ft pb fv fx iq bi translated">通过谷歌云助理云工程师考试的开发者指南</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">我最近通过了云考试，这是我如何准备考试的旅程。</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">medium.com</p></div></div><div class="pe l"><div class="pr l pg ph pi pe pj kq ov"/></div></div></a></div><div class="os ot gq gs ou ov"><a href="https://medium.com/dev-genius/features-that-every-developer-must-know-about-spring-boot-c1c0d7f1c0a8" rel="noopener follow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd is gz z fq pa fs ft pb fv fx iq bi translated">每个开发人员都必须知道的关于 Spring Boot 的特性</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">该框架通常被称为“类固醇上的弹簧”，的确如此。</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">medium.com</p></div></div><div class="pe l"><div class="ps l pg ph pi pe pj kq ov"/></div></div></a></div><div class="os ot gq gs ou ov"><a href="https://medium.com/dev-genius/everything-a-developer-must-know-about-microservices-dae854782ab" rel="noopener follow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd is gz z fq pa fs ft pb fv fx iq bi translated">开发人员必须了解的关于微服务的一切</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">微服务是首选的应用平台，每个开发人员都必须了解它。</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">medium.com</p></div></div><div class="pe l"><div class="pt l pg ph pi pe pj kq ov"/></div></div></a></div></div></div>    
</body>
</html>