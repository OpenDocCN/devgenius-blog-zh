<html>
<head>
<title>How to use Google cloud vision API to detect labels in image upload in Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Laravel 中使用 Google cloud vision API 检测图片上传中的标签</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-to-use-google-cloud-vision-api-to-detect-labels-in-image-upload-in-laravel-ca0bcd6a0412?source=collection_archive---------8-----------------------#2022-11-07">https://blog.devgenius.io/how-to-use-google-cloud-vision-api-to-detect-labels-in-image-upload-in-laravel-ca0bcd6a0412?source=collection_archive---------8-----------------------#2022-11-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/02d1753a8bb9d25e099d03a03ebe76b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O-ddvh78AkRbbj0d"/></div></div></figure><div class=""/><p id="5b94" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将了解如何使用 Google cloud vision API 来检测 Laravel 应用程序中图像上传的标签。</p><ul class=""><li id="3ed1" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated"><a class="ae lc" href="https://cloud.google.com/vision/docs/labels" rel="noopener ugc nofollow" target="_blank">检测标签</a></li></ul><p id="5d53" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了能够检测和检索图像中各种类别的实体信息，Google vision API 就派上了用场。</p><p id="270c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">标签可以识别一般对象、位置、活动、动物种类、产品等等。如果你需要有针对性的定制标签，Cloud AutoML Vision 可以让你训练一个定制的机器学习模型来对图像进行分类。</p><p id="694f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">标签仅以英文返回。云翻译 API 可以将英语标签翻译成许多其他语言。</p><p id="0360" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程<a class="ae lc" href="https://alemsbaja.hashnode.dev/how-to-use-google-cloud-vision-api-safe-search-detection-to-detect-explicit-content-on-image-uploads-in-laravel" rel="noopener ugc nofollow" target="_blank">如何使用 Google cloud vision API 安全搜索检测来检测 Laravel </a>中图片上传的露骨内容中，我们详细介绍了如何创建 Google Cloud Platform (GCP)项目、服务帐户凭证以及将 cloud vision 软件包集成到 Laravel 中。</p><p id="e2bf" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了保持这篇文章的简短，我们将直接探讨图像属性检测如何在文件上传上工作，因为我们已经有了一个用于上传文件的<a class="ae lc" href="https://github.com/RaphAlemoh/google_cloud_vision_features/blob/main/resources/views/uploads/create.blade.phpt" rel="noopener ugc nofollow" target="_blank">表单。</a></p><figure class="le lf lg lh gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ld"><img src="../Images/faa226b40c0aad44679ba17be5a8b048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qdu42QatndiC9jZz"/></div></div></figure><p id="aaff" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:为了清楚起见，每个特征在 web.php 文件中都有自己的路径。</p><p id="6fc4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您也可以检查 Github 上的一个特定分支，查看它的实现</p><p id="cf14" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Vision API 可以对本地图像文件执行功能检测，方法是在请求正文中以 base64 编码字符串的形式发送图像文件的内容。</p><p id="4b02" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一个<a class="ae lc" href="https://github.com/GoogleCloudPlatform/php-docs-samples/blob/master/vision/src/detect_label.php" rel="noopener ugc nofollow" target="_blank">存储库</a>及其集成的例子。</p><ul class=""><li id="8cab" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">导入类</li></ul><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="e1fc" class="ln lo iy lj b gy lp lq l lr ls">use Google\Cloud\Vision\V1\ImageAnnotatorClient;<br/>// this HtmlStringclass is used to format the text detected on the image<br/>use Illuminate\Support\HtmlString;</span></pre><ul class=""><li id="6ad1" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">对上传的图像运行标签检测</li></ul><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="ed8d" class="ln lo iy lj b gy lp lq l lr ls">public function detectLabels(Request $request)<br/>    {</span><span id="bcef" class="ln lo iy lj b gy lt lq l lr ls">$request-&gt;validate([<br/>            'avatar' =&gt; 'required|image|max:10240',<br/>        ]);</span><span id="cc17" class="ln lo iy lj b gy lt lq l lr ls">try {</span><span id="b6f5" class="ln lo iy lj b gy lt lq l lr ls">$imageAnnotator = new ImageAnnotatorClient([<br/>                //we can also keep the details of the google cloud json file in an env and read it as an object here<br/>                'credentials' =&gt; config_path('laravel-cloud-features.json')<br/>            ]);</span><span id="112c" class="ln lo iy lj b gy lt lq l lr ls"># annotate the image<br/>            $image = file_get_contents($request-&gt;file("avatar"));<br/>            $response = $imageAnnotator-&gt;labelDetection($image);<br/>            $labels = $response-&gt;getLabelAnnotations();</span><span id="8ea4" class="ln lo iy lj b gy lt lq l lr ls">$number_of_labels  = 0;</span><span id="60ec" class="ln lo iy lj b gy lt lq l lr ls">$img_label_content = '';<br/>            if ($labels) {<br/>                $number_of_labels = count($labels);<br/>                print('Labels:' . PHP_EOL);<br/>                foreach ($labels as $label) {<br/>                    $img_label_content .= "{$label-&gt;getDescription()} &lt;br&gt;";<br/>                }<br/>            } else {</span><span id="2c6f" class="ln lo iy lj b gy lt lq l lr ls">$img_label_content .= 'No label found';<br/>            }</span><span id="849a" class="ln lo iy lj b gy lt lq l lr ls">$formatted_label_details = new HtmlString("Image Properties detection successful!!! Number of Items with Labels:  $number_of_labels Formatted Details of Image Labels found on image uploaded: $img_label_content");</span><span id="9288" class="ln lo iy lj b gy lt lq l lr ls">return redirect()-&gt;route('home')<br/>                -&gt;with('success', $formatted_label_details);<br/>        } catch (Exception $e) {<br/>            return $e-&gt;getMessage();<br/>        }<br/>        $imageAnnotator-&gt;close();<br/>    }</span></pre><ul class=""><li id="95a9" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">我们将上传该图像，并查看检测标签功能如何返回内容</li></ul><p id="3d1b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">上传的图像</strong></p><figure class="le lf lg lh gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lu"><img src="../Images/ecbcd3f151aa197ec2ffefa663ff0af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MzBV2v0FGR6KarEk"/></div></div></figure><ul class=""><li id="82fb" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">在上传的图像中检测到标签</li></ul><figure class="le lf lg lh gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lv"><img src="../Images/c879d76535d81c16b1108ba2d685e59b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y2PkWgUgjSCh0iQI"/></div></div></figure><ul class=""><li id="0fd3" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">检测远程图像中的文本(谷歌云存储，Cloudinary，S3 桶等)</li></ul><p id="a6dc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">标签检测可以直接在 Google 云存储上存储的图像上执行，而不必将内容作为正文请求的一部分进行传递。</p><p id="10fe" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx iz">注意:当从 HTTP/HTTPS URL 获取图像时，Google 不能保证请求会被完成。如果指定的主机拒绝了请求(例如，由于请求限制或 DOS 阻止)，或者如果 Google 为了防止滥用而限制了对站点的请求，您的请求可能会失败。生产应用程序不应依赖外部托管的映像。</strong></p><p id="b561" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需将上传文件名替换为互联网或远程存储上的图像 URL</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="d88f" class="ln lo iy lj b gy lp lq l lr ls">$image = 'file_path...<a class="ae lc" href="https://googleapis.com.......png'" rel="noopener ugc nofollow" target="_blank">https://googleapis.com.......png'</a>;</span><span id="2ab3" class="ln lo iy lj b gy lt lq l lr ls">//run the image details detection feature on the image<br/>            $response = $imageAnnotatorClient-&gt;labelDetection($image);</span></pre><p id="88e9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是教程<a class="ae lc" href="https://github.com/RaphAlemoh/google_cloud_vision_features" rel="noopener ugc nofollow" target="_blank">资源库</a></p><p id="5d28" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您阅读本文！！！。</p><p id="12c3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你觉得这篇文章有帮助，请分享给你的网络，并随时使用评论区的问题，答案和贡献。</p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><p id="a2cb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="md">原发布于</em><a class="ae lc" href="https://alemsbaja.hashnode.dev/how-to-use-google-cloud-vision-api-to-detect-labels-in-image-upload-in-laravel" rel="noopener ugc nofollow" target="_blank"><em class="md">https://alemsbaja . hashnode . dev</em></a><em class="md">。</em></p></div></div>    
</body>
</html>