<html>
<head>
<title>Magento 2 Module Development with Pestle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Magento 2模块开发与杵</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/magento-2-module-development-with-pestle-e122c77dc755?source=collection_archive---------13-----------------------#2020-07-20">https://blog.devgenius.io/magento-2-module-development-with-pestle-e122c77dc755?source=collection_archive---------13-----------------------#2020-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/555a19e062d60309e69bb76df7761a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIzNp-TiXtc4-OpvCiU8-w.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk translated">布莱克·康纳利在<a class="ae jz" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2b7b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Magento 2有很多工具可以帮助你开发模块。Magento中一个著名的CLI工具是Magerun。这是Magento自带的CLI工具的扩展，在你安装Magento 2的时候就已经开箱即用了。我经常使用的最喜欢的工具之一是艾伦·斯道姆的<a class="ae jz" href="https://github.com/astorm/pestle" rel="noopener ugc nofollow" target="_blank">杵</a>。</p><p id="b9bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于我们编写的大部分代码主要由模板(可重用的)代码组成，slaust有助于生成大量这种代码。最终，这在开发Magento 2模块时节省了大量时间。</p><p id="b607" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">杵是什么</strong></p><p id="d6cf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以把slash想象成一个PHP框架，帮助你在Magento 2中构建和组织CLI程序。例如，您可以使用自己的模板扩展现有的函数，如“生成”函数。</p><p id="5a4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">熟悉Python的人，杵类似于Python如何导入模块。</p><p id="72ce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它也是一个CLI程序的集合，重点是Magento 2代码生成。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="bedb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">安装杵</strong></p><p id="c8dc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">杵以. phar文件(PHP归档文件)的形式出现，很容易下载，如下所示。Phar文件是自包含的跨平台的，所以它在MacOS，Windows和Linux上都可以工作。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="5772" class="lo lp in lk b gy lq lr l ls lt">#with curl:<br/>curl -LO <a class="ae jz" href="http://pestle.pulsestorm.net/pestle.phar" rel="noopener ugc nofollow" target="_blank">http://pestle.pulsestorm.net/pestle.phar</a></span><span id="de44" class="lo lp in lk b gy lu lr l ls lt">#with wget:<br/>wget <a class="ae jz" href="http://pestle.pulsestorm.net/pestle.phar" rel="noopener ugc nofollow" target="_blank">http://pestle.pulsestorm.net/pestle.phar</a></span></pre><p id="2ac3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者你可以在他们的<a class="ae jz" href="https://github.com/astorm/pestle/releases" rel="noopener ugc nofollow" target="_blank"> Github </a>页面下载其他版本。</p><p id="f871" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行下面的“PHP slaust . phar version”看看安装的是哪个版本。</p><p id="6555" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们要建造什么？</p><p id="21e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将建立一个简单的模块，我们可以导航到前端页面。安装完list之后，运行“PHP slaust . phar”来查看选项列表。</p><p id="2a09" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们对Magento 2的生成选项特别感兴趣。要仅查看“生成”选项的运行情况:</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="abc6" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar | grep generate --color=never</span></pre><p id="a84d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">注册一个模块</strong></p><p id="1c92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们从注册一个模块开始。现在有两个选项，“全模块”和“模块”选项。</p><p id="648e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完整模块的工作方式与模块选项略有不同。这个选项不是直接创建PHP和XML模块文件，而是生成一个Unix shell脚本，该脚本执行其他slash命令来生成模块。</p><p id="7fcd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们坚持“模块”选项。运行:</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="fde1" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:generate:module</span></pre><p id="67f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">杵现在会提出几个问题。</p><ul class=""><li id="e591" class="lv lw in kc b kd ke kh ki kl lx kp ly kt lz kx ma mb mc md bi translated">供应商名称空间应该是什么</li><li id="a8f7" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">模块的名字应该是什么。</li><li id="2489" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">哪个版本。参见如下内容:</li></ul><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="3776" class="lo lp in lk b gy lq lr l ls lt">www-data@example-php-fpm:04:51 PM:/var/www/html$ php pestle.phar magento2:generate:module<br/>Vendor Namespace? (Pulsestorm)] Rick<br/>Module Name? (Testbed)] Helloworld<br/>Version? (0.0.1)] <br/>Creating [/var/www/html/app/code/Rick/Helloworld/etc] <br/>Created: /var/www/html/app/code/Rick/Helloworld/etc/module.xml<br/>Created: /var/www/html/app/code/Rick/Helloworld/registration.php</span></pre><p id="ed94" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，你会看到在app/code/Rick下，一个Helloworld模块已经被创建了。运行“bin/magento s:up”进行注册。</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/3c9c2cdb0dd6fcd821a5c37ddf147e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U4abiTf0cspmJoNZ84yxEg.png"/></div></div></figure><p id="dd4a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建前端路由</strong></p><p id="cd8e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经创建并安装了一个模块，我们可以创建一个路由。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="c463" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:generate:route</span></pre><p id="04be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，像处理generate: module一样填写问题。</p><ul class=""><li id="5526" class="lv lw in kc b kd ke kh ki kl lx kp ly kt lz kx ma mb mc md bi translated">选择您想要在哪个模块中创建路由，在我们的例子中是Rick_Helloworld</li><li id="1920" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">选择它是前端还是管理路由，默认为前端，因此只需按enter键。</li><li id="5bcc" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">昵称和路线id: rick_helloworld</li><li id="3c13" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">使用默认(索引)作为“控制器名称”</li><li id="539b" class="lv lw in kc b kd me kh mf kl mg kp mh kt mi kx ma mb mc md bi translated">使用默认(索引)作为“操作名称”</li></ul><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="9077" class="lo lp in lk b gy lq lr l ls lt">www-data@example-php-fpm:04:51 PM:/var/www/html$ php pestle.phar magento2:generate:route <br/>Which Module? (Pulsestorm_HelloWorld)] Rick_Helloworld<br/>Which Area (frontend, adminhtml)? (frontend)] <br/>Frontname/Route ID? (pulsestorm_helloworld)] rick_helloworld<br/>Controller name? (Index)] <br/>Action name? (Index)] <br/>Backing existing file: /var/www/html/app/code/Rick/Helloworld/etc/frontend/routes.xml.5f1db51e071db.bak.php<br/>/var/www/html/app/code/Rick/Helloworld/etc/frontend/routes.xml<br/>/var/www/html/app/code/Rick/Helloworld/Controller/Index/Index.php</span></pre><p id="5747" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">之后你会在app/code/Rick/Helloworld /etc /中看到一个routes.xml</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="115e" class="lo lp in lk b gy lq lr l ls lt">&lt;?xml version="1.0"?&gt;<br/>&lt;config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:App/etc/routes.xsd"&gt;<br/>    &lt;router id="standard"&gt;<br/>        &lt;route id="rick_helloworld" frontName="rick_helloworld"&gt;<br/>            &lt;module name="Rick_Helloworld"/&gt;<br/>        &lt;/route&gt;<br/>    &lt;/router&gt;<br/>&lt;/config&gt;</span></pre><p id="2436" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果routes.xml已经存在，它将添加一个. bak扩展名，以便您保留现有文件的备份。如果不再需要，您可以选择删除它。</p><p id="479f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们通过运行以下命令创建一个前端视图:</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="b246" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:generate:view</span></pre><p id="e5f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择“Rick_Helloworld”作为模块，并接受区域、句柄、块名、模板文件和布局的默认值。最终，您会看到slakut创建了以下文件。</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/5a384d033cd35d8086d38a342c59b617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yn0CfiGmsaRyd0q54AmxFQ.png"/></div></div></figure><p id="4bca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后用“bin/magento c:c”删除你的缓存，转到<a class="ae jz" href="http://Finally delete your cache with bin / magento c: c and go to https: //app.example.test/webfant_helloworld/index/index" rel="noopener ugc nofollow" target="_blank"><em class="ml">https://app . example . test/Rick _ hello world/index/index</em>T3】</a></p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/818e2ace4989d9de57affd6b61ad2fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXpLZ6X0R3wrqF3EThVVPQ.png"/></div></div></figure><p id="17cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如你所见，在很短的时间内，我创建、注册并安装了一个Magento 2模块，构建了一个控制器，构建了一个包含块、布局和模板的route.xml，而没有编写任何代码。杵提供了广泛的选项来帮助您开发Magento 2模块，所以我强烈建议您看看杵提供的其他选项。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="6bad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">杵中有用的命令</strong> <br/>除了生成代码，还可以执行扫描和检查。</p><p id="ae66" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更正PHP对象管理器的直接使用</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="ecef" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:fix-direct-om</span></pre><p id="83b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恢复权利</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="c73a" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:fix-permissions-mod</span></pre><p id="d808" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">扫描模块中的ACL规则id，并确保它们都被使用/定义</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="c222" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:scan:acl-used</span></pre><p id="7b51" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在MySQL数据库中搜索无效的键</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="5f05" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar mysql:key-check</span></pre><p id="3ea2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从Magento 1代码迁移到Magento 2</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="4ecd" class="lo lp in lk b gy lq lr l ls lt">php pestle.phar magento2:convert-class<br/>php pestle.phar magento2:convert-observers-xml<br/>php pestle.phar magento2:convert-system-xml</span></pre><h1 id="d280" class="mn lp in bd mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj bi translated">觉得这个帖子有用吗？请点击👏下面的按钮！:)</h1></div></div>    
</body>
</html>