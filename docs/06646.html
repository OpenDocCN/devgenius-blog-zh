<html>
<head>
<title>GraphQL + Django -Tutorial with example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">graph QL+Django-带示例的教程</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/graphql-with-django-7dbbfb556461?source=collection_archive---------1-----------------------#2022-01-23">https://blog.devgenius.io/graphql-with-django-7dbbfb556461?source=collection_archive---------1-----------------------#2022-01-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="987b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">技术栈</strong> — Django、Graphene、PostgreSQL</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/f3b31f7497ba2f07039bb5d7edce7182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*euKKJrb3Qy8GEvFs2CBK0w.png"/></div></div></figure><p id="81be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">自从脸书推出 GraphQL 以来，它已经成为了 REST API 的革命性替代品。GraphQL 克服了 RESTful 架构的许多问题。然而，它确实带来了一系列必须评估的新问题。GraphQL 给了我们通过编写查询来请求我们想要检索的数据的强大能力。这篇博客文章将向你介绍使用 Graphene 和 Django 来使用 GraphQl API 所需要知道的一切。</p><p id="ca7e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们从头开始创建一个简单的售书应用程序，以便清楚地了解如何在<strong class="jm io"> Django </strong>中实现<strong class="jm io"> GraphQL </strong>。</p><p id="5f37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们通过下面的实体关系模型来理解构建这个应用程序所需的模型。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lb"><img src="../Images/f0031b4e9357b1de824360d0392b11b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tm_B-2U3LVZHM1mhcjaqDQ.jpeg"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">ERD 图</figcaption></figure><p id="dc8e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您想知道为什么我在中间有链接表，那么将太多的关系分解成一个太多的关系总是一个好主意，因为这使得子记录只有一个父记录，这将有助于计算更快的查找。</p><p id="1f7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们定义 GraphQL 中的查询是什么样子的，通过下面的一个简单查询，我们可以请求一个用户列表，并可以根据特定用例的需要限制细节。</p><p id="6485" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">用户查询</strong>:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="0c6e" class="ll lm in lh b gy ln lo l lp lq">query{<br/> users{<br/>    name<br/>    email<br/>    phoneNo<br/>    location<br/>   }<br/>}</span></pre><p id="8f49" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">响应如下:</strong></p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="e073" class="ll lm in lh b gy ln lo l lp lq">{<br/>  "data": {<br/>    "users": [<br/>      {<br/>        "name": "Jonny",<br/>        "email": "jonny@gmail.com",<br/>        "phoneNo": "+1234567899",<br/>        "location": "London"<br/>      },<br/>      {<br/>        "name": "Sammy",<br/>        "email": "sammy@gmail.com",<br/>        "phoneNo": "+1234567898",<br/>        "location":"New York"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="36ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我们开始吧:)</p><p id="daac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为这是一个主要关注 GraphQL 的教程，所以我假设您对 Django 有一定的了解，但是如果没有，也没关系，我将带您从开始到如何设置和运行它的每个步骤。</p><p id="400f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以在这里得到整个项目的参考-<a class="ae lr" href="https://github.com/samarthgowda96/resale_app.git" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">https://github.com/samarthgowda96/resale_app.git</strong></a></p><p id="ed55" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤 1 </strong>设置</p><p id="2ba7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了与<strong class="jm io"> GraphQL </strong>和<strong class="jm io"> Django </strong>一起工作，我们需要安装<strong class="jm io"> Graphene </strong>一个开源包，它非常酷，让我们能够利用令人惊叹的特性来定义我们的 GraphQL API，请查看他们的文档以了解更多细节——<a class="ae lr" href="https://docs.graphene-python.org/projects/django/en/latest/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">https://docs.graphene-python.org/projects/django/en/latest/</strong></a></p><p id="05e1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要安装 Django，请使用 pip 运行以下命令:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="ce2e" class="ll lm in lh b gy ln lo l lp lq">pip install Django</span></pre><p id="8f93" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要安装 Graphene，请使用 pip 运行以下命令:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="454d" class="ll lm in lh b gy ln lo l lp lq">pip install graphene-django</span></pre><p id="5766" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我们安装了所有的包，现在让我们通过下面的命令创建一个 Django 项目:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="203b" class="ll lm in lh b gy ln lo l lp lq">django-admin startproject books</span></pre><p id="0984" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在 books 是我们的父目录，在这里我们将在<code class="fe ls lt lu lh b">books/settings.py</code>文件中配置所有需要的包依赖项。</p><p id="dd3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们生成一个应用程序；<code class="fe ls lt lu lh b">resaleapp</code> <strong class="jm io">，</strong>这基本上是不同卖家转售图书的一个简单应用:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="d026" class="ll lm in lh b gy ln lo l lp lq">python3 manage.py startapp resaleapp</span></pre><p id="e609" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在 books 目录下的<code class="fe ls lt lu lh b">books/settings.py</code>文件中包含了下面这个新生成的 app 和<code class="fe ls lt lu lh b">graphene_django</code>的依赖关系。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="8209" class="ll lm in lh b gy ln lo l lp lq">INSTALLED_APPS = [<br/>'django.contrib.admin',<br/>'django.contrib.auth',<br/>'django.contrib.contenttypes',<br/>'django.contrib.sessions',<br/>'django.contrib.messages',<br/>'django.contrib.staticfiles',<br/>'graphene_django',<br/>'resaleapp'<br/>]</span></pre><p id="8bf7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以使用任何数据库来开发该应用程序，让我们在<code class="fe ls lt lu lh b">books/settings.py</code>中定义配置:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="7582" class="ll lm in lh b gy ln lo l lp lq">DATABASES = {<br/>  "default": {<br/>      "ENGINE": "django.db.backends.postgresql",<br/>      "NAME": "books",<br/>      "HOST": "localhost,<br/>      "PORT": "5432",<br/>      "USER": "postgres",<br/>      "ATOMIC_MUTATIONS": True,<br/>      "PASSWORD": os.getenv('POSTGRES_PASSWORD') # Your local DB password<br/>      }<br/>}</span></pre><p id="adc2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe ls lt lu lh b">books/settings.py</code>中添加 GraphQL</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="c6c8" class="ll lm in lh b gy ln lo l lp lq">GRAPHENE = {<br/>  'SCHEMA': 'resaleapp.schema.schema'<br/>}</span></pre><p id="b267" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe ls lt lu lh b">books/settings.py</code>中配置您的媒体路径以存储媒体/静态文件</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="cef1" class="ll lm in lh b gy ln lo l lp lq">MEDIA_URL = ‘/media/’<br/>MEDIA_ROOT = os.path.join(BASE_DIR, ‘media’)<br/>STATICFILES_DIRS = (os.path.join(BASE_DIR, ‘static’), )</span></pre><p id="6867" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，在<code class="fe ls lt lu lh b">resale_app/urls.py</code>中，包含这些用于开发环境的库</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="779a" class="ll lm in lh b gy ln lo l lp lq">from django.urls import path<br/>from resaleapp.schema import schema<br/>from  import views<br/>from django.views.decorators.csrf import csrf_exempt<br/>from graphene_file_upload.django import FileUploadGraphQLView</span><span id="da69" class="ll lm in lh b gy lv lo l lp lq">urlpatterns = [path('graphql/',<br/>               csrf_exempt(FileUploadGraphQLView.as_view(graphiql=True,<br/>               schema=schema)))]</span></pre><p id="a4a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，包含<strong class="jm io"> resaleapp </strong> url 并将其媒体配置包装在<code class="fe ls lt lu lh b">books/urls.py</code>中的父目录<code class="fe ls lt lu lh b">urls.py</code>文件中</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="999f" class="ll lm in lh b gy ln lo l lp lq">from django.contrib import admin<br/>from django.urls import path, include<br/>from django.views.decorators.csrf import csrf_exempt<br/>from graphene_file_upload.django import FileUploadGraphQLView<br/>from resaleapp.schema import schema<br/>from graphene_django.views import GraphQLView<br/>from django.conf.urls.static import static<br/>from django.conf import settings</span><span id="e2f5" class="ll lm in lh b gy lv lo l lp lq">urlpatterns = [path('admin/', admin.site.urls), path('',<br/>               include('resaleapp.urls'))] + static(settings.MEDIA_URL,<br/>        document_root=settings.MEDIA_ROOT)</span></pre><p id="75c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第二步</strong>运行你的应用程序</p><p id="0dfe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦在应用程序中完成了所有这些设置，我们就可以使用以下命令在<a class="ae lr" href="http://localhost:8000/graphql/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">http://localhost:8000/graph QL/</strong></a>上启动服务器了。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="2209" class="ll lm in lh b gy ln lo l lp lq">python3 manage.py runserver</span></pre><p id="0e37" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你得到一个错误，那是因为我们没有创建<code class="fe ls lt lu lh b">schema.py</code>并试图在<code class="fe ls lt lu lh b">resaleapp/urls.py</code>中导入(现在移除它)</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="d148" class="ll lm in lh b gy ln lo l lp lq">urlpatterns = [path('graphql/',<br/>               csrf_exempt(FileUploadGraphQLView.as_view(graphiql=True)))]</span></pre><p id="643c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建你的模型</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="baca" class="ll lm in lh b gy ln lo l lp lq">from django.db import models</span><span id="6a2a" class="ll lm in lh b gy lv lo l lp lq">import uuid</span><span id="408b" class="ll lm in lh b gy lv lo l lp lq">import datetime</span><span id="5137" class="ll lm in lh b gy lv lo l lp lq">import os</span><span id="abb9" class="ll lm in lh b gy lv lo l lp lq"># <em class="lw">Create your models here.</em></span><span id="b5ab" class="ll lm in lh b gy lv lo l lp lq">def filepath(request, filename): # <em class="lw">File Path for your uploaded media</em></span><span id="6515" class="ll lm in lh b gy lv lo l lp lq">    old_filename = filename<br/>    timeNow = datetime.datetime.now().strftime('%Y%m%d%H:%M:%S')<br/>    filename = '%s_%s' % (timeNow, old_filename)<br/>    return os.path.join('media/', filename)</span><span id="dc38" class="ll lm in lh b gy lv lo l lp lq">class User(models.Model):</span><span id="3bcf" class="ll lm in lh b gy lv lo l lp lq">    id = models.UUIDField(primary_key=True, default=uuid.uuid4,<br/>                          editable=False, unique=True)<br/>    name = models.CharField(max_length=512)<br/>    location = models.CharField(null=True, max_length=512)<br/>    email = models.EmailField(null=True)<br/>    phone_no = models.CharField(max_length=10, null=True)</span><span id="c4e4" class="ll lm in lh b gy lv lo l lp lq">    def __str__(self):<br/>        return self.name</span><span id="787b" class="ll lm in lh b gy lv lo l lp lq">class Book(models.Model):</span><span id="82f1" class="ll lm in lh b gy lv lo l lp lq">    id = models.UUIDField(primary_key=True, default=uuid.uuid4,<br/>                          editable=False, unique=True)<br/>    book_name = models.CharField(max_length=512)<br/>    author = models.CharField(max_length=512)<br/>    price = models.CharField(max_length=512)<br/>    book_image = models.FileField(upload_to=filepath, unique=True)</span><span id="8d8b" class="ll lm in lh b gy lv lo l lp lq">class BookUser(models.Model):</span><span id="dcea" class="ll lm in lh b gy lv lo l lp lq">    id = models.UUIDField(primary_key=True, default=uuid.uuid4,<br/>                          editable=False, unique=True)<br/>    user = models.ForeignKey(User, null=True, on_delete=models.CASCADE)<br/>    book = models.ForeignKey(Book, null=True, on_delete=models.CASCADE)</span><span id="77d2" class="ll lm in lh b gy lv lo l lp lq">class Comment(models.Model):</span><span id="5604" class="ll lm in lh b gy lv lo l lp lq">    id = models.UUIDField(primary_key=True, default=uuid.uuid4,<br/>                          editable=False, unique=True)<br/>    book = models.ForeignKey(Book, null=True, on_delete=models.CASCADE)<br/>    body = models.CharField(max_length=512)</span><span id="29f1" class="ll lm in lh b gy lv lo l lp lq">class CommentUser(models.Model):</span><span id="df3d" class="ll lm in lh b gy lv lo l lp lq">    id = models.UUIDField(primary_key=True, default=uuid.uuid4,<br/>                          editable=False, unique=True)<br/>    user = models.ForeignKey(User, null=True, on_delete=models.CASCADE)<br/>    comment = models.ForeignKey(Comment, null=True,<br/>                                on_delete=models.CASCADE)</span></pre><p id="608d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们将刚才创建的模型的更改迁移到 PostgreSQL 数据库中</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="d80b" class="ll lm in lh b gy ln lo l lp lq">python3 manage.py makemigrations<br/>python3 manage.py migrate</span></pre><p id="46c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望你不要在这里得到任何错误:)</p><p id="7589" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们创建我们的<code class="fe ls lt lu lh b">resaleapp/fields.py</code>文件。</p><p id="84ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一般来说，它用于将数据转换成各自的格式进行处理。</p><p id="c544" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">类型是一个代表模型的 GraphQL 对象，您可以对它进行定制，以允许您基于一组标准过滤您的结果。</p><p id="74c1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们在应用程序<code class="fe ls lt lu lh b">resaleapp/fields.py</code>中为<code class="fe ls lt lu lh b">graphene</code>创建一个字段文件</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="22ab" class="ll lm in lh b gy ln lo l lp lq">import graphene</span><span id="3331" class="ll lm in lh b gy lv lo l lp lq">from graphene_django import DjangoObjectType</span><span id="bb9c" class="ll lm in lh b gy lv lo l lp lq">from graphene_django.filter import DjangoFilterConnectionField</span><span id="cbca" class="ll lm in lh b gy lv lo l lp lq">from .models import User, Book, Comment, BookUser, CommentUser</span><span id="ddbf" class="ll lm in lh b gy lv lo l lp lq">class BookClass(DjangoObjectType):</span><span id="a62f" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="a500" class="ll lm in lh b gy lv lo l lp lq">       model = Book</span><span id="7947" class="ll lm in lh b gy lv lo l lp lq">class UserClass(DjangoObjectType):</span><span id="df40" class="ll lm in lh b gy lv lo l lp lq">    book = graphene.List(BookClass)</span><span id="5821" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="cfb1" class="ll lm in lh b gy lv lo l lp lq">      model = User</span><span id="86c6" class="ll lm in lh b gy lv lo l lp lq">    def resolve_book(self, info, root):<br/>        book_user = \<br/>                  BookUser.objects.filter(user_id=self.id).values_list('book_id'<br/>                )<br/>        books = Book.object.filter(id__in=book_user)<br/>        return books</span><span id="6d28" class="ll lm in lh b gy lv lo l lp lq">class BookUserClass(DjangoObjectType):</span><span id="178a" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="d17e" class="ll lm in lh b gy lv lo l lp lq">      model = BookUser<br/>class CommentClass(DjangoObjectType):</span><span id="4acb" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="d469" class="ll lm in lh b gy lv lo l lp lq">       model = Comment</span><span id="58b1" class="ll lm in lh b gy lv lo l lp lq">class CommentUserClass(DjangoObjectType):</span><span id="2e26" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="c291" class="ll lm in lh b gy lv lo l lp lq">       model = CommentUser</span></pre><p id="af8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您已经观察到，创建的每个模型都定义了自己的字段类类型，还允许为每个字段定义自定义解析器，我们可以通过调用它自己的类连接来访问它。</p><p id="bf96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤 4 </strong>让我们在 GraphQL API 中创建我们的模式和变体来处理来自客户端的查询请求。</p><p id="674b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们在应用程序<code class="fe ls lt lu lh b">resaleapp/mutations.py</code>中为<code class="fe ls lt lu lh b">graphene</code>创建一个突变文件</p><p id="3296" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们定义几个<code class="fe ls lt lu lh b">mutate</code>函数来存储 PostgreSQL 中的数据。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="3b02" class="ll lm in lh b gy ln lo l lp lq">import graphene</span><span id="9c0d" class="ll lm in lh b gy lv lo l lp lq">from graphene_file_upload.scalars import Upload</span><span id="ac6f" class="ll lm in lh b gy lv lo l lp lq">from .fields import UserClass, BookClass, CommentClass</span><span id="04eb" class="ll lm in lh b gy lv lo l lp lq">from .models import User, Book, Comment, BookUser, CommentUser</span><span id="547a" class="ll lm in lh b gy lv lo l lp lq">class createUser(graphene.Mutation):</span><span id="d4e0" class="ll lm in lh b gy lv lo l lp lq">    error = graphene.String()<br/>    success = graphene.Boolean()<br/>    user = graphene.Field(UserClass)</span><span id="3a5d" class="ll lm in lh b gy lv lo l lp lq">    class Meta:</span><span id="e1ff" class="ll lm in lh b gy lv lo l lp lq">    description = 'Add user details'</span><span id="d90e" class="ll lm in lh b gy lv lo l lp lq">    class Arguments:</span><span id="33ba" class="ll lm in lh b gy lv lo l lp lq">        name = graphene.String(required=True)<br/>        email = graphene.String(required=True)<br/>        location = graphene.String()<br/>        phone_no = graphene.String()</span><span id="fd66" class="ll lm in lh b gy lv lo l lp lq">    def mutate(<br/>        self,<br/>        info,<br/>        phone_no=None,<br/>        location=None,<br/>        **kwargs<br/>        ):<br/>        try:<br/>            user = User.objects.create(name=kwargs.get('name'),<br/>                    email=kwargs.get('email'), phone_no=phone_no,<br/>                    location=location)<br/>            return createUser(user=user, success=True)<br/>        except Exception, e:<br/>            return createUser(user=None, success=False, error=e)</span><span id="cecd" class="ll lm in lh b gy lv lo l lp lq">class createBook(graphene.Mutation):</span><span id="79bd" class="ll lm in lh b gy lv lo l lp lq">    error = graphene.String()<br/>    success = graphene.Boolean()<br/>    book = graphene.Field(BookClass)</span><span id="af23" class="ll lm in lh b gy lv lo l lp lq">    class Arguments:</span><span id="3722" class="ll lm in lh b gy lv lo l lp lq">        user_id = graphene.ID(required=True)<br/>        book_name = graphene.String(required=True)<br/>        author = graphene.String(required=True)<br/>        book_image = Upload()<br/>        price = graphene.Int()</span><span id="64ff" class="ll lm in lh b gy lv lo l lp lq">    def mutate(self, info, **kwargs):<br/>        try:<br/>            book =    Book.objects.create(book_name=kwargs.get('book_name'<br/>                    ), author=kwargs.get('author'),<br/>                    book_image=kwargs.get('book_image'),<br/>                    price=kwargs.get('price'))<br/>            book_user = BookUser.objects.create(book_id=book.id,<br/>                    user_id=kwargs.get('user_id'))<br/>            return createBook(book=book, success=True)<br/>        except Exception, e:<br/>            return createBook(book=book, success=False, error=e)</span><span id="8cda" class="ll lm in lh b gy lv lo l lp lq">class createComment(graphene.Mutation):</span><span id="56e4" class="ll lm in lh b gy lv lo l lp lq">    error = graphene.String()<br/>    success = graphene.Boolean()<br/>    comment = graphene.Field(CommentClass)</span><span id="b706" class="ll lm in lh b gy lv lo l lp lq">    class Arguments:</span><span id="1ac2" class="ll lm in lh b gy lv lo l lp lq">        user_id = graphene.ID(required=True)<br/>        book_id = graphene.ID(required=True)<br/>        body = graphene.String(required=True)</span><span id="b8bc" class="ll lm in lh b gy lv lo l lp lq">    def mutate(self, info, **kwargs):<br/>        try:<br/>            comment = \<br/>                Comment.objects.create(book_id=kwargs.get('book_id'),<br/>                    body=kwargs.get('body'))<br/>            comment_user = \<br/>                CommentUser.objects.create(user_id=kwargs.get('user_id'<br/>                    ), comment_id=comment.id)</span><span id="54c3" class="ll lm in lh b gy lv lo l lp lq">return createComment(success=True, comment=comment)<br/>        except Exception, e:<br/>            return createComment(success=False, error=e)</span><span id="8aa4" class="ll lm in lh b gy lv lo l lp lq">class delete(graphene.Mutation):</span><span id="32a1" class="ll lm in lh b gy lv lo l lp lq">    error = graphene.String()<br/>    success = graphene.Boolean()</span><span id="b204" class="ll lm in lh b gy lv lo l lp lq">    class Arguments:</span><span id="4631" class="ll lm in lh b gy lv lo l lp lq">        user_id = graphene.ID()<br/>        book_id = graphene.ID()<br/>        comment_id = graphene.ID()</span><span id="c400" class="ll lm in lh b gy lv lo l lp lq">    def mutate(self, info, **kwargs):<br/>        try:<br/>            if kwargs.get('user_id'):<br/>                User.objects.filter(id=kwargs.get('user_id')).delete()<br/>            if kwargs.get('book_id'):<br/>                Book.objects.filter(id=kwargs.get('book_id')).delete()<br/>            if kwargs.get('comment_id'):<br/>                Comment.objects.filter(id=kwargs.get('comment_id'<br/>                        )).delete()<br/>            return delete(success=True)<br/>        except Exception, e:<br/>            return delete(success=False, error=e)</span></pre><p id="8733" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，我们创建了一个代表我们模型的对象<code class="fe ls lt lu lh b">UserClass</code>类，然后创建了一个为<code class="fe ls lt lu lh b">User</code>模型创建记录的变异函数<code class="fe ls lt lu lh b">createUser</code>。</p><p id="210a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们在应用程序<code class="fe ls lt lu lh b">resaleapp/schema.py</code>中为<code class="fe ls lt lu lh b">graphene</code>创建一个模式文件</p><p id="7f42" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">模式本质上是一个文件，它将您的模型转换成 GraphQL，并告知它它们是什么以及它们应该如何交互。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="0bef" class="ll lm in lh b gy ln lo l lp lq">import graphene</span><span id="0388" class="ll lm in lh b gy lv lo l lp lq">from .fields import UserClass, CommentClass, BookClass</span><span id="659f" class="ll lm in lh b gy lv lo l lp lq">from models import User, Book, Comment</span><span id="b0a3" class="ll lm in lh b gy lv lo l lp lq">from mutations import createUser, createBook, createComment, delete</span><span id="877c" class="ll lm in lh b gy lv lo l lp lq">class Query(graphene.ObjectType):</span><span id="6b6b" class="ll lm in lh b gy lv lo l lp lq">    users = graphene.List(UserClass)<br/>    user = graphene.Field(UserClass, id=graphene.ID())<br/>    books = graphene.List(BookClass)<br/>    book = graphene.Field(BookClass, id=graphene.ID())<br/>    comments = graphene.List(CommentClass)<br/>    comment = graphene.Field(CommentClass, id=graphene.ID())</span><span id="cfcb" class="ll lm in lh b gy lv lo l lp lq">def resolve_users(root, info):<br/>        return User.objects.all()</span><span id="b9e0" class="ll lm in lh b gy lv lo l lp lq">def resolve_user(root, info, id):<br/>        return User.objects.get(id=id)</span><span id="a121" class="ll lm in lh b gy lv lo l lp lq">def resolve_books(root, info):<br/>        return Book.objects.all()</span><span id="a2ff" class="ll lm in lh b gy lv lo l lp lq">def resolve_book(root, info, id):<br/>        return Book.objects.get(id=id)</span><span id="1301" class="ll lm in lh b gy lv lo l lp lq">def resolve_comments(root, info):<br/>        return Comment.objects.all()</span><span id="2d66" class="ll lm in lh b gy lv lo l lp lq">def resolve_comment(root, info, id):<br/>        return Comment.objects.get(id=id)</span><span id="7a9b" class="ll lm in lh b gy lv lo l lp lq">class Mutation(graphene.ObjectType):</span><span id="a569" class="ll lm in lh b gy lv lo l lp lq">create_user = createUser.Field()<br/>    create_book = createBook.Field()<br/>    create_comment = createComment.Field()<br/>    delete = delete.Field()</span><span id="4f4a" class="ll lm in lh b gy lv lo l lp lq">schema = graphene.Schema(query=Query, mutation=Mutation)</span></pre><p id="c4e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，我们创建了一个类<code class="fe ls lt lu lh b">UserClass</code>，它是一个表示我们模型的对象，然后创建了一个解析器<code class="fe ls lt lu lh b">resolve_users</code>，它返回一个字段的值</p><p id="4c2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太棒了，干得好！你们都达到了使用 Graphene + Django 构建基本应用的要求:)</p><p id="2e38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Step — 7 </strong>让我们在<a class="ae lr" href="http://localhost:8000/graphql/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">http://localhost:8000/graph QL/</strong></a>测试我们的应用程序</p><p id="eb68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了<strong class="jm io">创建/删除/更新</strong>数据，我们在 GraphQL 中使用突变查询</p><p id="0bfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">变异查询</strong>:</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="eea3" class="ll lm in lh b gy ln lo l lp lq">mutation{<br/>  createUser(email:"<a class="ae lr" href="mailto:booksapp@gmail.com" rel="noopener ugc nofollow" target="_blank">booksapp@gmail.com</a>", phoneNo:"123456789", name:"Sammy", location:"New York"){<br/>    success<br/>    user{<br/>      name,<br/>      phoneNo,<br/>      email,<br/>      location<br/>    }<br/>  }<br/>}</span></pre><p id="4b7f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">响应:</strong></p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="0336" class="ll lm in lh b gy ln lo l lp lq">{<br/>  "data": {<br/>    "createUser": {<br/>      "success": true,<br/>      "user": {<br/>        "name": "Sammy",<br/>        "phoneNo": "123456789",<br/>        "email": "<a class="ae lr" href="mailto:booksapp@gmail.com" rel="noopener ugc nofollow" target="_blank">booksapp@gmail.com</a>",<br/>        "location": "New York"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lx"><img src="../Images/21ca47ee73100426575df74b26551ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBaYAVvqevh3R4nEdNAf9Q.png"/></div></div></figure><p id="c1f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了<strong class="jm io">获得</strong>数据，我们在 GraphQL 中使用解析器查询:</p><p id="9bad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">查询:</strong></p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="95b1" class="ll lm in lh b gy ln lo l lp lq">query{<br/>  users{<br/>    name,<br/>    phoneNo,<br/>    email,<br/>    location<br/>  }<br/>}</span></pre><p id="2339" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">响应:</strong></p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="0130" class="ll lm in lh b gy ln lo l lp lq">{<br/>  "data": {<br/>    "users": [<br/>      {<br/>        "name": "Johnny",<br/>        "phoneNo": "2112132323",<br/>        "email": "<a class="ae lr" href="mailto:johnny@gmail.com" rel="noopener ugc nofollow" target="_blank">johnny@gmail.com</a>",<br/>        "location": "Amsterdam"<br/>      },<br/>      {<br/>        "name": "Sammy",<br/>        "phoneNo": "1234567890",<br/>        "email": "<a class="ae lr" href="mailto:booksapp@gmail.com" rel="noopener ugc nofollow" target="_blank">booksapp@gmail.com</a>",<br/>        "location": "New York"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ly"><img src="../Images/d7384cfac89bdbfeb332389fb32a17e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSWvJZs-2mhhnu2nt_BviQ.png"/></div></div></figure><p id="ddfb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">任何意见都将不胜感激。请别忘了留下评论。希望你觉得这篇文章有用，干杯:)</p><p id="2c44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">Github</strong>——<a class="ae lr" href="https://github.com/samarthgowda96/resale_app" rel="noopener ugc nofollow" target="_blank">https://github.com/samarthgowda96/resale_app</a></p><p id="bf86" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">领英</strong>——<a class="ae lr" href="https://www.linkedin.com/in/samarth-gowda96/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/samarth-gowda96/</a></p><p id="245e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">参考</strong>—<a class="ae lr" href="https://gearheart.io/articles/how-to-use-graphql-with-django-with-example/" rel="noopener ugc nofollow" target="_blank">https://gear heart . io/articles/how-to-use-graph QL-with-django-with-example/</a></p><p id="47db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">感谢您的阅读！！！</strong></p></div></div>    
</body>
</html>