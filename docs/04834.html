<html>
<head>
<title>Variable precedence in Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform 中的变量优先级</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/variable-precedence-in-terraform-f32dd283dcb9?source=collection_archive---------1-----------------------#2021-05-11">https://blog.devgenius.io/variable-precedence-in-terraform-f32dd283dcb9?source=collection_archive---------1-----------------------#2021-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9fab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和 3 种向 terraform 代码中的变量传递值的方法</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/31cc851518a8b84997aa222bb920648e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*iuL3V_yG5TY7sxLy-d0xjA.png"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="e58d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi la translated">erraform 变量有助于定义服务器细节，而不必记住特定于基础设施的值。它们同样便于重用共享参数，比如不会在配置之间改变的公共 SSH 密钥。在计算机程序中，变量有多种用途。变量用于在程序中存储信息，如果需要，可以访问和修改这些信息。变量有许多用途。它还可以用程序读者可以清楚理解的名称来标记数据。这同样适用于地形。</p><p id="09ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为以下示例的一部分，我们尝试在 us-east-1 地区创建一个 AWS 实例。在第 3 行，第 11 行声明并使用了变量 instance_type。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lj lk l"/></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">Terraform 示例代码</figcaption></figure><p id="6444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用命令<code class="fe lp lq lr ls b">terraform init &amp;&amp; terraform plan &amp;&amp; terraform apply</code>执行代码。以下是执行该命令后的输出。要创建 EC2，必须提供一个值。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lt"><img src="../Images/9cb44a3b78eeb1114c32871c29b6014b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h052p9acH_mpRslO5Jxb2w.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">terraform 应用命令的执行输出</figcaption></figure><p id="1f4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果未提供值，将出现以下错误。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ly"><img src="../Images/f106817d94cb0b3817647b3175dd7aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCHzavd0ZpefafZHn3MnoQ.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">未提供变量时出错</figcaption></figure><p id="a589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功创建 AWS 实例的第一种方法是为 instance_type 变量提供一个值，最好是从 EC2 实例类型页面中提供。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lz"><img src="../Images/714d9557369c0f0e4184e0d76c5444fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cUEsAn4x3oYc1Mvi0xyNA.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">提供实例类型值时的响应</figcaption></figure><p id="7f55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二种方法是将值内联传递给<code class="fe lp lq lr ls b">terraform apply</code>命令。例如，<code class="fe lp lq lr ls b">terraform apply -var instance_type=t3a.micro</code>就应该做到这一点。任何作为参数传递给 cli 的内容都优先。像在 bash 中一样，我们也可以在 terraform 中将环境变量作为变量值传入。如果有我们不想保存为版本控制的一部分的敏感值，传递环境变量是有帮助的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ma"><img src="../Images/1629309d945e6c1ed357953b1239e5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxVb0o9hDyex_obYq-4UAw.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">内联传递变量值。</figcaption></figure><p id="e81f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三种也是最后一种方法是使用一个<em class="mb"> tfvars </em>文件。请创建一个新文件，将其命名为<em class="mb"> terraform.tfvars </em>，并添加行<code class="fe lp lq lr ls b">instance_type = "t3a.medium"</code>。在执行 terraform 计划时，您应该看到 EC2 的<em class="mb">实例类型</em>被设置为<em class="mb"> t3a.medium </em>。我们还可以创建一个<em class="mb"> us-east.tfvars </em>并在其中添加<code class="fe lp lq lr ls b">instance_type = "t3a.medium"</code>行。然后对<em class="mb"> terraform plan/apply </em>命令，传递参数<code class="fe lp lq lr ls b">--var-file=us-east.tfvars</code>，你应该看到<em class="mb"> instance_type </em>值生效。请注意，传递的<code class="fe lp lq lr ls b">-var</code>标志优先于<em class="mb"> tfvars </em>文件。</p><blockquote class="mc md me"><p id="040a" class="jn jo mb jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">如果同时传递了 var 文件和-var instance_type=t3a.medium，则参数的顺序非常重要。第二个参数优先于第一个参数。</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mi"><img src="../Images/56dd96163cd0f17901f89265f2d38c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fWArk6W7IrfoL-S6zr3ew.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">参数优先级</figcaption></figure></div></div>    
</body>
</html>