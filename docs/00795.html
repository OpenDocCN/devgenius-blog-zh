<html>
<head>
<title>How Selenium Works — High Level Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Selenium 如何工作——高级架构</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-selenium-works-high-level-architecture-8a1793ca9387?source=collection_archive---------34-----------------------#2020-06-16">https://blog.devgenius.io/how-selenium-works-high-level-architecture-8a1793ca9387?source=collection_archive---------34-----------------------#2020-06-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bed287a08920ce42495fe0fe99c203a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46Hxn-XctQ-qkJZkgTzRtw.jpeg"/></div></div></figure><p id="a70f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当试图使用一个特定的工具或库时，建立有效的双向关系的最好方式是偷看一眼并看看里面。这就是我们从高层次架构的角度对 Selenium 所做的事情，肯定会带来一些“啊哈”时刻。</p><p id="44d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ku" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank"> Selenium WebDriver </a>无疑仍然是 web 自动化和测试的王者/女王。工具、框架、社区、招聘信息、数百万人与它互动以及生态系统的其余部分都建立在一个始于 2004 年的项目上。这证明，在所有维护它并为它做出贡献的人们的努力下，它在目标上是那么好。</p><p id="0cb6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">即使介绍的内容非常精简，不管您目前是否在使用 Selenium，了解一下这个工具的架构只会对您有好处。欣赏风景。</p><h1 id="33e6" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">高层</h1><p id="0215" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">首先，大多数直接使用 Selenium 的人，<em class="kt">直接表示一个</em> <a class="ae ku" href="https://www.selenium.dev/documentation/en/selenium_installation/installing_selenium_libraries/" rel="noopener ugc nofollow" target="_blank"> <em class="kt">客户端库</em> </a>，正在编写脚本，使用他们最喜欢的语言，描述他们想要在真实浏览器实例上模拟的特定步骤和交互。这可能是从导航到页面，点击元素到提交表单，以及<em class="kt">未经许可删除内容</em>。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="a728" class="mh kw in md b gy mi mj l mk ml">WebDriver driver = new ChromeDriver();                  </span><span id="744e" class="mh kw in md b gy mm mj l mk ml">driver.get("https://www.selenium.dev/projects/"); // Open this URL in the browser instance      </span><span id="dc0e" class="mh kw in md b gy mm mj l mk ml">WebElement searchElement = driver.findElement(By.name("search")); // Find the hipster search of this website            <br/>searchElement.sendKeys("firefox"); // Fill the input with the search term</span></pre><p id="4872" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面只是一个简单的 Java 代码示例，QA 工程师习惯于为他们的日常工作编写这些代码。您运行这个脚本(<em class="kt">和其余的样板文件</em>)，您会在 Selenium 网站上看到一个 Chrome 窗口，搜索栏中有“firefox”一词，非常简单。我们使用的完全相同的 API 暴露在不同的语言绑定中，如 JavaScript、Python 和 Ruby。</p><p id="1d42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，对于一些人来说，这些命令到达浏览器必须经过的过程和部分，以及它们如何一起操作，是一种模糊的画面。</p><p id="5e6e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以从下图开始清除模糊:</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/a66fff9cafac39e3fa68a3db15730433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0Qp7m49jQdc1qy5l.png"/></div></div></figure><p id="6d77" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有些组件可能看起来很熟悉，有些则不那么熟悉。我们将把它们一个一个地分解，以便把点连接起来，填补你理解 Selenium WebDriver 的任何潜在障碍。</p><h1 id="c23c" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">组件</h1><h1 id="c977" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">客户端库</h1><p id="005e" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">客户端库或称为<em class="kt">语言绑定</em>，是允许开发人员在他们选择的语言中使用 Selenium 高级 API 的库。在不知道所有细节的情况下，通常“客户机库”所提供的是通过某种传输机制的包装器来与一组固定的端点进行通信。<em class="kt">把它们想象成一层薄薄的东西，大部分时间是把它们从一种语言翻译成另一种语言。_</em></p><p id="7691" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ku" href="https://github.com/SeleniumHQ/selenium/blob/master/javascript/webdriver/http/http.js" rel="noopener ugc nofollow" target="_blank">至少对于 WebDriver 的 JavaScript 包装器来说是这样的。</a></p><h1 id="5071" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">JsonWire 协议</h1><p id="f64f" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">正如在<em class="kt"> (1) </em>中提到的，客户端库使用一个特定的 HTTP API，就像<a class="ae ku" href="https://www.theautomatedtester.co.uk/blog/how-selenium-works-transport/" rel="noopener ugc nofollow" target="_blank"> David Burns 说的</a>一样，将它们想要的命令传递给<em class="kt">浏览器驱动程序</em>，我们稍后会谈到。</p><p id="f67e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了防止客户库作者和维护者的混乱、痛苦和预期偏差，系统需要定义一种标准化的方式与外界通信。WebDriver 决定尽可能统一地与<em class="kt">浏览器驱动程序</em>通信，这是对<a class="ae ku" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol" rel="noopener ugc nofollow" target="_blank"> JsonWire 协议</a>的实现，现在你可以想象，它是基于 HTTP 的 JSON。这个 API 端点的规范可以在<a class="ae ku" href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#command-reference" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8fad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要了解这有多简单，这里有一个小例子:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="8618" class="mh kw in md b gy mi mj l mk ml">/* <br/> * Send the command to the session with id=sessionId <br/> * to initiate a navigation to the "url" body parameter <br/> */</span><span id="0f9b" class="mh kw in md b gy mm mj l mk ml">POST /session/:sessionId/url <br/>{<br/>  "url": "https://example.com"}<br/>}</span></pre><p id="d651" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从 GitHub 转到 JsonWire 规范页面，您一定注意到了这个过时的警告，但是不要犹豫。这并不意味着这是一个被放弃的项目，或者那里的信息是不相关的，相反，它已经向前迈出了一大步。尽管这一协议被广泛使用，在它背后有着巨大的技术和人力生态系统，它还是成功地成为了 W3C 标准的实际工作草案。</p><p id="7ccf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这一事实使得它成为一个官方协议，用户代理的目标是实现和遵守它，以便程序能够远程控制网络浏览器的行为。在我看来，这是 WebDriver 项目的巨大成功和认可。</p><h1 id="1a95" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">浏览器驱动程序</h1><p id="f0fb" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated"><em class="kt">浏览器驱动</em>可以被认为是 WebDriver 架构的“后端”。它充当 JsonWire 协议的终端主机，以我们前面展示的形式接受命令，并以类似的方式用值、错误、统计或协议定义的任何内容进行响应。一方面，它实际上像客户端库的常规独立 HTTP 服务器一样工作。另一方面，它使用自己的 HTTP API 进行通信，发送命令，并在检测其行为时接收来自实际浏览器实例的响应。</p><p id="920a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在尝试使用 Selenium 时，您可能会想到或者已经注意到，不同的浏览器有特定的驱动程序来实现将从客户端库检索到的命令实际发送到浏览器实例的重要部分。例如支持 Firefox 的 GeckoDriver，支持 Chrome/Chrome 的 ChromeDriver，Opera <a class="ae ku" href="https://www.selenium.dev/downloads/#browsersCollapse" rel="noopener ugc nofollow" target="_blank">的 OperaDriver 等等</a>。</p><p id="0270" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些<em class="kt">浏览器驱动</em>中的每一个都使用自己的方式和实现与实际的浏览器实例进行通信。一些例子:</p><ul class=""><li id="05a2" class="mo mp in jx b jy jz kc kd kg mq kk mr ko ms ks mt mu mv mw bi translated">ChromeDriver 使用<a class="ae ku" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank"> DevTools 协议</a>。</li><li id="f563" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">壁虎驱动程序使用<a class="ae ku" href="https://firefox-source-docs.mozilla.org/testing/marionette/" rel="noopener ugc nofollow" target="_blank">木偶</a>远程协议。</li><li id="13ac" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">Opera driver(<em class="kt">for Opera&gt;= 26</em>)基于 ChromeDriver，并做了一些调整<a class="ae ku" href="https://github.com/operasoftware/operachromiumdriver" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="ec29" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如你所理解的，一些驱动程序可能不是由维护公司开源的，但是我相信如果你浏览每个驱动程序的页面和文档，你可以找到更多的信息。</p><h1 id="b0de" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">浏览器</h1><p id="834d" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">实际的浏览器实例将接收相应浏览器驱动程序的命令，并最终模拟我们一直计划的 web 自动化任务。</p><h1 id="0ca0" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">关闭</h1><p id="a023" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">在我看来，这就是我们对构成“硒架构”的高层架构组件的近距离观察。当我看着所有演员如何走到一起，以及在每个项目的开发和维护中投入了多少工作和努力时，我希望你和我一样喜欢它。</p><p id="2509" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">十字贴来自:<br/></em><a class="ae ku" href="https://www.thehomeofwebautomation.com/how-selenium-works-architecture/" rel="noopener ugc nofollow" target="_blank"><em class="kt">Web 自动化之家</em> </a></p><p id="de04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">封面图片由</em> <a class="ae ku" href="https://pixabay.com/users/Tama66-1032521/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5146458" rel="noopener ugc nofollow" target="_blank"> <em class="kt">彼得 H </em> </a> <em class="kt">从</em> <a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5146458" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> Pixabay </em> </a></p></div></div>    
</body>
</html>