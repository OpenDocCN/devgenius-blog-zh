<html>
<head>
<title>How I kept my browser Spoiler-free (Javascript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何保持我的浏览器不受干扰(Javascript)</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/how-i-kept-my-browser-spoiler-free-javascript-91fa32530f75?source=collection_archive---------16-----------------------#2020-06-16">https://blog.devgenius.io/how-i-kept-my-browser-spoiler-free-javascript-91fa32530f75?source=collection_archive---------16-----------------------#2020-06-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="8b22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编写一个chrome扩展，帮助你避开任何剧透，电视节目，文学，电影。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aa5be650abe206a94b3e89bbc77881fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DXbFCl38Jv5HcYVELsSpQ.jpeg"/></div></div></figure><p id="269a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 1。写一个</strong> <a class="ae ku" href="https://developer.chrome.com/extensions/manifest" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">的清单</strong> </a> <strong class="jm io">文件。</strong>内容脚本的JSON对象接受matches等参数，这是一个正则表达式，用于决定内容js文件将运行哪些网页。</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="3a32" class="la lb in kw b gy lc ld l le lf">{ <br/> "manifest_version" : 2, <br/> "name" : "Spoiler Alert", <br/> "description": "Proividing it with a list of literature, TV, Films that whose spoilers you want to keep away",<br/> "version" : "0.103",<br/> "content_scripts" : [ <br/>  { <br/>   "matches" : [ <br/>    "*://*/*" <br/>   ], <br/>  "js" : ["content.js"]<br/>  }<br/> ]<br/>}</span></pre><p id="4272" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 2。将option_ui添加到清单中，以便我们可以接受用户的输入。在我们的例子中，我们将采用用户想要避免的各种文献/媒体。我们还需要添加存储权限，这样我们就可以使用<a class="ae ku" href="https://developer.chrome.com/apps/storage" rel="noopener ugc nofollow" target="_blank"> chrome.storage </a> API来存储用户输入。</strong></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="00e9" class="la lb in kw b gy lc ld l le lf">{<br/>"manifest_version" : 2, <br/> "name" : "Spoiler Alert", <br/> "description": "Proividing it with a list of literature, TV, Films that whose spoilers you want to keep away",<br/> "version" : "0.103",<br/> "content_scripts" : [ <br/>  { <br/>   "matches" : [ <br/>    "*://*/*" <br/>   ], <br/>  "js" : ["content.js"]<br/>  }<br/> ],<br/> <strong class="kw io">"options_ui": {<br/>     "page": "options.html",<br/>     "open_in_tab": false<br/> },<br/> "permissions": [<br/>     "storage"<br/> ]</strong><br/>}</span></pre><p id="98cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 3。编写选项页面</strong>。定义了一个文本框供用户提供“；”独立的内容以防止剧透，以及一个具有触发功能的按钮以将值存储在chrome.storage中。使用chrome.storage.sync可以在用户级别进行处理。也就是说，你可以在用户登录的任何chrome浏览器上读取存储内容。</p><p id="1fd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lg">options.html:</em></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="4098" class="la lb in kw b gy lc ld l le lf">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/> &lt;body&gt;<br/>  &lt;h2&gt;List of Shows/Movies/Books you want to keep spoiler-free&lt;/h2&gt;<br/>  &lt;h3&gt;Enter them ';' separated&lt;/h3&gt;<br/>  &lt;input type="text" id="collection" name="collection"&gt;&lt;br&gt;&lt;br&gt;<br/>  &lt;button id="save"&gt;Save&lt;/button&gt;<br/>  &lt;script src="options.js"&gt; &lt;/script&gt;<br/> &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="0063" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lg"> options.js : </em></p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="a01a" class="la lb in kw b gy lc ld l le lf">// Saves options to chrome.storage<br/>document.getElementById(“save”).addEventListener(“click”, save_options);<br/>function save_options() {<br/> var collection = document.getElementById(‘collection’).value;<br/> console.log(collection);<br/> chrome.storage.sync.set({‘collections’: collection.split(“;”)});<br/>}</span></pre><p id="897b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 4。编写content.js </strong>遍历HTML元素，如果包含用户提供的媒体元素之一，则用<strong class="jm io"> *【剧透】* </strong>替换这些元素。</p><pre class="kj kk kl km gt kv kw kx ky aw kz bi"><span id="d16b" class="la lb in kw b gy lc ld l le lf">window.onload = function() {replace()};<br/>window.onscroll = function() {replace()};</span><span id="a2e8" class="la lb in kw b gy lh ld l le lf">function replace() {<br/> <br/> var tags = ["p", "span", "h", "h3", "a"];<br/> let spoiler = "&lt;h1 style=\"color:#FF0000\"&gt;[SPOILER]&lt;/h1&gt;";</span><span id="4905" class="la lb in kw b gy lh ld l le lf">chrome.storage.sync.get(['collections'], function (retVal) {<br/>  var precious = retVal.collections;<br/>  for (element of precious){<br/>    if(element != ""){<br/>      item = element.toLowerCase().trim();<br/>      for(tag of tags){<br/>        let currentTag = document.getElementsByTagName(tag);<br/>        for (elt of currentTag){<br/>          if(elt.innerHTML.toLowerCase().indexOf(item) != -1)<br/>             elt.innerHTML = spoiler;<br/>          }<br/>        }<br/>      }<br/>    }<br/> });<br/>}</span></pre><p id="20da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> 5。将延伸部分装载到chrome </strong>上。将包含所有文件的扩展项目文件夹添加到chrome://extensions</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi li"><img src="../Images/f91250184b14fa3a90f959585b81a661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*_XL2EQxDrmiZn3prBx1HqQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">chrome扩展页面截图</figcaption></figure><p id="2f6e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">尝试网飞系列《巫师》的延伸。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ln"><img src="../Images/67ac5c11f8fdab8bdf554d94f51c8c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzIV6Xgbmw3xD3ru0Fv7vA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">将巫师设定为你想避免的剧透</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lo"><img src="../Images/acb066d53417b20aebcccaae6d4ec327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMY4yoYteve-kUqaFtW8Vg.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">谷歌搜索巫师演职人员</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lp"><img src="../Images/3c0f145a66f3202ce75e9dba91e17b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygfZkP9XBoKyjEV-LEOisw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">在脸书寻找巫师</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lq"><img src="../Images/fdf4c4068faa43c39aaef2c9a8382615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iQG44bNhA3POs_FKakEsw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">在网飞寻找巫师</figcaption></figure></div></div>    
</body>
</html>