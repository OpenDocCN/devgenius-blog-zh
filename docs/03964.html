<html>
<head>
<title>Validate Objects with Joi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Joi 验证对象</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/validate-objects-with-joi-ef4132ce2150?source=collection_archive---------1-----------------------#2021-01-09">https://blog.devgenius.io/validate-objects-with-joi-ef4132ce2150?source=collection_archive---------1-----------------------#2021-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5cf353673baa8b2f33c94fd02ae127d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UGBSDgUbmQjZDBSL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@jtylernix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰勒·尼克斯</a>拍摄</figcaption></figure><p id="d87c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Joi 是一个让我们轻松验证对象结构的库。</p><p id="71c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用 Joi 验证对象。</p><h1 id="2fe6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">入门指南</h1><p id="4c9f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过运行以下命令来安装 Joi:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1062" class="mn lc iq mj b gy mo mp l mq mr">npm i joi</span></pre><p id="0ead" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a0fa" class="mn lc iq mj b gy mo mp l mq mr">const Joi = require("joi");</span><span id="1b40" class="mn lc iq mj b gy ms mp l mq mr">const schema = Joi.object({<br/>  username: Joi.string().alphanum().min(3).max(30).required(),<br/>  password: Joi.string().pattern(new RegExp("^[a-zA-Z0-9]+$"))<br/>});</span><span id="9e80" class="mn lc iq mj b gy ms mp l mq mr">const value = schema.validate({ username: "abc", password: "abc123" });<br/>console.log(value);</span></pre><p id="3678" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过调用 Joi 的内置方法来创建一个模式。</p><p id="28be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关键字是属性名，</p><p id="32c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保它是一个字符串。</p><p id="9560" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">alphanum</code>检查字母数字字符。</p><p id="5dcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">min</code>检查最小数量的字符。</p><p id="dcfb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">max</code>检查最大字符数。</p><p id="d976" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">required</code>使财产增值所需。</p><p id="28fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">pattern</code>检查给定的正则表达式模式。</p><p id="4074" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们创建了一个模式，我们就调用<code class="fe mt mu mv mj b">schema.validate</code>来验证属性值。</p><p id="c589" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个具有<code class="fe mt mu mv mj b">value</code>和<code class="fe mt mu mv mj b">error</code>属性的对象。</p><p id="489d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有我们传进去的论点。</p><p id="135c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">error</code>发现有任何错误。</p><p id="5eea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们打电话:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7ccc" class="mn lc iq mj b gy mo mp l mq mr">const value = schema.validate({});</span></pre><p id="0487" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe mt mu mv mj b">error</code>将是一个带有消息的对象:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="30e4" class="mn lc iq mj b gy mo mp l mq mr">'ValidationError: "username" is required'</span></pre><p id="2a7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">details</code>属性有更多的细节。</p><p id="ffaf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">validateAsync</code>方法异步进行验证。</p><p id="b2ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9c0c" class="mn lc iq mj b gy mo mp l mq mr">const Joi = require("joi");</span><span id="29ac" class="mn lc iq mj b gy ms mp l mq mr">const schema = Joi.object({<br/>  username: Joi.string().alphanum().min(3).max(30).required(),<br/>  password: Joi.string().pattern(new RegExp("^[a-zA-Z0-9]+$"))<br/>});</span><span id="618e" class="mn lc iq mj b gy ms mp l mq mr">(async () =&gt; {<br/>  try {<br/>    const value = await schema.validateAsync({<br/>      username: "abc",<br/>      password: "abc123"<br/>    });<br/>    console.log(value);<br/>  } catch (err) {<br/>    console.log(err);<br/>  }<br/>})();</span></pre><p id="06e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来做验证。</p><p id="cf8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">value</code>有我们传入<code class="fe mt mu mv mj b">validateAsync</code>的值。</p><p id="3789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe mt mu mv mj b">err</code>有验证错误。</p><h1 id="5e81" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">断言</h1><p id="4e5b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">assert</code>方法让我们根据模式进行验证，如果验证失败就抛出一个错误。</p><p id="91eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d38a" class="mn lc iq mj b gy mo mp l mq mr">Joi.assert("x", Joi.number());</span></pre><p id="32b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们会得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fe27" class="mn lc iq mj b gy mo mp l mq mr">"value" must be a number</span></pre><p id="5475" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显示错误。</p><p id="6516" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是要验证的值。</p><p id="ac3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是要验证的数据类型。</p><p id="de57" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">attempt</code>方法验证模式并返回一个有效的对象。</p><p id="d342" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果验证失败，它将抛出一个错误。</p><p id="9e1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ae42" class="mn lc iq mj b gy mo mp l mq mr">const result = Joi.attempt("10", Joi.number());<br/>console.log(result);</span></pre><p id="cb57" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe mt mu mv mj b">result</code>是 10。</p><h1 id="2528" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">默认</h1><p id="6677" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">defaults</code>方法返回一个新的<code class="fe mt mu mv mj b">joi</code>实例，该实例将提供的修饰符函数应用于每个新模式。</p><p id="c2a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6a19" class="mn lc iq mj b gy mo mp l mq mr">const Joi = require("joi");<br/>const custom = Joi.defaults((schema) =&gt; {<br/>  switch (schema.type) {<br/>    case "string":<br/>      return schema.allow("");<br/>    case "object":<br/>      return schema.min(1);<br/>    default:<br/>      return schema;<br/>  }<br/>});</span><span id="1a6d" class="mn lc iq mj b gy ms mp l mq mr">const schema = custom.object();</span></pre><p id="b7cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe mt mu mv mj b">schema</code>就是<code class="fe mt mu mv mj b">schema.min(1)</code>，因为<code class="fe mt mu mv mj b">'object'</code>是<code class="fe mt mu mv mj b">schema.type</code>的值。</p><h1 id="ddaf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe mt mu mv mj b">in</code></h1><p id="8078" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">in</code>方法返回对另一个模式的引用。</p><p id="7ddd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ceeb" class="mn lc iq mj b gy mo mp l mq mr">const Joi = require("joi");<br/>const schema = Joi.object({<br/>  a: Joi.array().items(Joi.number()),<br/>  b: Joi.number().valid(Joi.in("a"))<br/>});</span></pre><p id="564a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查属性<code class="fe mt mu mv mj b">a</code>的模式，这是一个有数字的数组。</p><p id="963b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们用<code class="fe mt mu mv mj b">in</code>方法检查它是一个在<code class="fe mt mu mv mj b">a</code>数组中的数字。</p><h1 id="f32d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b87c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用 Joi 检查对象属性和值。</p></div></div>    
</body>
</html>