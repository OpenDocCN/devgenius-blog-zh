<html>
<head>
<title>Making HTTP Requests with React Query — Query Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Query-Query函数发出HTTP请求</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/making-http-requests-with-react-query-query-functions-cc8930830279?source=collection_archive---------11-----------------------#2021-05-13">https://blog.devgenius.io/making-http-requests-with-react-query-query-functions-cc8930830279?source=collection_archive---------11-----------------------#2021-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4bd02c8cc5a713c15c9794a526c5a683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HTAlfm9OBX4S4F2V"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Syed Rifat Hossain 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="7042" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React查询库让我们可以在React应用程序中轻松地发出HTTP请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query发出HTTP请求。</p><h1 id="eef5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">查询功能</h1><p id="cd97" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">查询函数是返回承诺的函数，它被传递到<code class="fe me mf mg mh b">useQuery</code>钩子的第二个参数中。</p><p id="bf2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="4f5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7732" class="mq lc iq mh b gy mr ms l mt mu">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="e43d" class="mq lc iq mh b gy mv ms l mt mu">const queryClient = new QueryClient();</span><span id="172b" class="mq lc iq mh b gy mv ms l mt mu">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="f913" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">App.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ab06" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery("yesNo", () =&gt; axios("https://yesno.wtf/api"));</span><span id="6fe8" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="1148" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过<code class="fe me mf mg mh b">axios</code>功能返回承诺返回。</p><p id="a690" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回的承诺数据将被设置为<code class="fe me mf mg mh b">data</code>属性的值。</p><h1 id="66e0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理和抛出错误</h1><p id="62a6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">React Query期望在发生错误时在查询函数中抛出错误。</p><p id="8ea6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果不行，我们就自己扔了它。</p><p id="54b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="81b8" class="mq lc iq mh b gy mr ms l mt mu">import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { error } = useQuery("todo", async () =&gt; {<br/>    const response = await fetch(<br/>      "https://jsonplaceholder.typicode.com/posts/100000000000"<br/>    );<br/>    if (!response.ok) {<br/>      throw new Error("Network response was not ok");<br/>    }<br/>    return response.json();<br/>  });</span><span id="c098" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{error &amp;&amp; error.message}&lt;/div&gt;;<br/>}</span></pre><p id="68a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用Fetch API发出HTTP请求，那么我们必须检查<code class="fe me mf mg mh b">response.ok</code>属性是否是<code class="fe me mf mg mh b">true</code>。</p><p id="c85c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果不是，那么我们必须抛出一个错误，让React Query知道发生了错误。</p><p id="7cde" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这必须完成，因为当我们得到非200系列响应时<code class="fe me mf mg mh b">fetch</code>不会抛出错误。</p><p id="e11f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">response.ok</code>是<code class="fe me mf mg mh b">true</code>，我们通过调用<code class="fe me mf mg mh b">response.json()</code>返回响应。</p><h1 id="d04d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">查询对象</h1><p id="c2f7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以传入一个查询对象，而不是传入每个单独的参数来进行GET请求。</p><p id="0f3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6ba1" class="mq lc iq mh b gy mr ms l mt mu">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";<br/>export default function App() {<br/>  const { data } = useQuery({<br/>    queryKey: ["todo", 1],<br/>    queryFn: ({ queryKey: [, id] }) =&gt; {<br/>      return axios(`https://jsonplaceholder.typicode.com/posts/${id}`);<br/>    }<br/>  });</span><span id="7583" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="2f15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">queryKey</code>有请求的标识符。</p><p id="0974" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">queryFn</code>是发出请求的函数。</p><h1 id="ceaf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="7b14" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以向<code class="fe me mf mg mh b">useQuery</code>钩子传递返回请求承诺的函数，用React发出GET请求。</p></div></div>    
</body>
</html>