<html>
<head>
<title>Set Your Multi-App Environment up in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 5 分钟内设置好多应用环境</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/nx-monorepo-why-and-how-71310504aa29?source=collection_archive---------3-----------------------#2022-05-16">https://blog.devgenius.io/nx-monorepo-why-and-how-71310504aa29?source=collection_archive---------3-----------------------#2022-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ea0b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Nx monorepo:如何以及为什么？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/591c554cd1578e7c13bbae260dd3fe9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2hbenSiM3Zh6xKXD.png"/></div></div></figure><h1 id="fb3a" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="199e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">您是否考虑过如何在多个应用程序之间共享组件？或者如何让后端和前端应用程序使用来自同一来源的相同数据模型？所以你也想到了 monorepo 的设置。</p><p id="2fd5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我向您展示如何轻松设置 monorepo，并强调这种方法的利与弊。</p><p id="6997" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">管理单一回购协议有很多方法。你可以在这里查看 monorepo 工具(以及更多有用的东西)的完整列表<a class="ae mk" href="https://github.com/korfuri/awesome-monorepo" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5ebf" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我选择了<a class="ae mk" href="https://nx.dev/getting-started/intro" rel="noopener ugc nofollow" target="_blank"> NX 构建系统</a>，它提供了 monorepo 管理、代码生成插件和加速开发的集成。</p><h1 id="5c02" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">NX monorepo 概念</h1><blockquote class="ml mm mn"><p id="eefc" class="lj lk mo ll b lm mf jr lo lp mg ju lr mp mh lu lv mq mi ly lz mr mj mc md me ij bi translated">典型的 Nx 工作空间由<em class="iq">“apps”</em>和<em class="iq">“libs”</em>构成。这种区别允许我们通过遵循关注点分离方法，将我们的源代码和逻辑组织成更小、更集中和高度内聚的单元，从而拥有更模块化的架构。</p><p id="affb" class="lj lk mo ll b lm mf jr lo lp mg ju lr mp mh lu lv mq mi ly lz mr mj mc md me ij bi translated">Nx 自动在<code class="fe ms mt mu mv b">tsconfig.base.json</code>文件中创建 TypeScript 路径映射，这样它们可以很容易地被其他应用程序或库使用。</p><p id="eb68" class="lj lk mo ll b lm mf jr lo lp mg ju lr mp mh lu lv mq mi ly lz mr mj mc md me ij bi translated"><code class="fe ms mt mu mv b">import { Button } from '@shop/ui';</code></p><p id="e6f9" class="lj lk mo ll b lm mf jr lo lp mg ju lr mp mh lu lv mq mi ly lz mr mj mc md me ij bi translated">因此，使用库非常简单，类似于您在以前的项目中可能已经习惯的方式。</p><p id="9019" class="lj lk mo ll b lm mf jr lo lp mg ju lr mp mh lu lv mq mi ly lz mr mj mc md me ij bi translated">然而，与仅仅将代码分离到文件夹中相比，拥有一个专用的库项目是一个更强的界限。每个 Nx 库都有一个所谓的<em class="iq">“公共 API”</em>，用一个<code class="fe ms mt mu mv b">index.ts</code>桶文件表示。这迫使开发人员进入一种<em class="iq">“API 思维”</em>的状态，即什么应该公开，从而可供其他人使用，而什么应该在库本身内部保持私有。</p></blockquote><p id="2a36" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在<a class="ae mk" href="https://nx.dev/structure/applications-and-libraries" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多信息。</p><h1 id="b3c1" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">设置 monorepo</h1><p id="e099" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们用两个前端 react 应用程序和一个 nest 后端应用程序来设置项目。例如，拥有客户应用程序、后台应用程序和 API 后端服务器的在线商店。</p><ul class=""><li id="ef62" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">生成一个空的 nx 工作空间:<br/>T3】</li></ul><p id="d897" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">Nx CLI 将提示您命名工作区(在我们的示例中为“商店”)，选择工作区类型(在我们的示例中为“反应”)，键入第一个应用程序名称(在我们的示例中为“客户端”)，并选择使用或不使用 Nx 云(在我们的示例中为“否”)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/a71b288e48b0351cc4346817adc4d21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B5bsxeJzfJ97XqUuEsw3sg.png"/></div></div></figure><ul class=""><li id="36cd" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">生成后台 react app: <br/> <code class="fe ms mt mu mv b">nx g @nrwl/react:app backoffice</code></li><li id="67a0" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">安装嵌套生成器:<br/> <code class="fe ms mt mu mv b">npm install --save-dev @nrwl/nest</code></li><li id="90ac" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">生成服务器 app: <br/> <code class="fe ms mt mu mv b">npx nx g @nrwl/nest:app api</code></li></ul><p id="5f27" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">此时，您的文件结构应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/7637fd693c07422dc96ed9d7bc4b7fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*43U_7n_aoLJgtfGlsHe7tQ.png"/></div></figure><p id="40d3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">为了定义应用程序将被服务的端口，向<code class="fe ms mt mu mv b">project.json</code>文件的<code class="fe ms mt mu mv b">serve.options</code>部分添加一个新字段<code class="fe ms mt mu mv b">"port":3000</code>用于客户端应用程序，添加<code class="fe ms mt mu mv b">"port":3100</code>用于后台应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/ba643ca44ed0e29e542a24751ad8d476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NP1bdG_cnogaeamkY3fjDw.png"/></div></div></figure><p id="a49b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">是时候一起运行所有应用了:<br/> <code class="fe ms mt mu mv b">nx run-many --target=serve --projects=client,backoffice,api</code></p><p id="f4fa" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在，您的终端显示了在端口 3000 和 3100 上运行的两个 react 应用程序以及在端口 3333 上运行的 server 应用程序。让我们检查一下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/00390f76626d89ee3ff6b75cadceec5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALjANi4n6_8vX9uFmgzpHA.png"/></div></div></figure><h2 id="ff7d" class="no ks iq bd kt np nq dn kx nr ns dp lb ls nt nu ld lw nv nw lf ma nx ny lh nz bi translated">你刚刚看到了什么？</h2><p id="6549" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们刚刚使用 4 个命令在 3 分钟内创建了具有基本文件夹、文件结构以及构建、服务、lint 和测试流的 3 个应用程序吗？</p><p id="4ef1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">是的，测试和林挺<em class="mo">启动器</em>也被创建。但是还有更多的。</p><div class="oa ob gp gr oc od"><a href="https://medium.com/subscribe/@kirichuk" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">每当叶夫根尼·基里丘克发表文章时，就收到一封电子邮件。</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">每当叶夫根尼·基里丘克发表文章时，就收到一封电子邮件。关于 web 开发、生产力、黑客的内容！立即加入！通过签名…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or kp od"/></div></div></a></div><h1 id="df1e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">添加共享组件</h1><p id="9589" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为了共享组件或数据模型，我们必须首先创建库。</p><ul class=""><li id="4b83" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">生成库:<br/> <code class="fe ms mt mu mv b">nx g @nrwl/react:lib ui</code></li><li id="c3e5" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">用一个简单的按钮组件生成一个<code class="fe ms mt mu mv b">atoms</code>文件夹:<br/> <code class="fe ms mt mu mv b">nx generate @nrwl/react:component button --project=ui --directory=atoms --export</code></li></ul><p id="b51b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们检查一下<code class="fe ms mt mu mv b">ui/atoms</code>库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/cda7e2a7db72ae2691664c55fe86606b.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*Nxr0iaFm9BMnKbbc9Ybtag.png"/></div></figure><p id="2dcf" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这是我接触 Nx 后印象深刻的一点。</p><p id="67a9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">唯一的命令在<code class="fe ms mt mu mv b">ui</code>库中创建 atoms 文件夹、简单的<code class="fe ms mt mu mv b">button.tsx</code>组件、样式表文件、测试套件和用于<code class="fe ms mt mu mv b">ui</code>库导出的全局别名。该组件已经从库中导出，可供应用程序使用。一个命令，而不是没完没了地开始为每个新组件编写。</p><p id="9db6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这太棒了。不是吗？</p><p id="a1fc" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在我们可以这样使用按钮组件:<br/> <code class="fe ms mt mu mv b">import {Button} from "@test/ui";</code></p><h1 id="5e8f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Monorepo 使用案例</h1><p id="5932" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这个列表是无止境的，所以让我突出我在 monorepo 的第一天就发现的最有用的案例。</p><ul class=""><li id="4200" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">几个前端应用程序之间的共享组件。</li><li id="c2f5" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">一个用于前端和后端应用程序的 typescript 数据模型源。</li><li id="8395" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">一个 API 为前端和后端应用程序路由源代码。</li></ul><h1 id="19e7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Monorepo 优势</h1><ul class=""><li id="03b3" class="mw mx iq ll b lm ln lp lq ls ot lw ou ma ov me nb nc nd ne bi translated">所有团队成员的透明代码库。</li><li id="1ba7" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">一组依赖关系。</li><li id="45d0" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">无痛的项目范围重构。</li><li id="c6b1" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">不同的团队共享最佳实践和开发文化。</li><li id="95a6" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">在一个地方配置 CI/CD。</li><li id="0f77" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">入职和开发环境设置变得更快。</li></ul><h1 id="ae88" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Monorepo 缺点</h1><ul class=""><li id="cc25" class="mw mx iq ll b lm ln lp lq ls ot lw ou ma ov me nb nc nd ne bi translated">不可能只允许访问特定的应用程序。</li><li id="4c8f" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">CI/CD 变得更加难以设置。</li><li id="35d5" class="mw mx iq ll b lm ng lp nh ls ni lw nj ma nk me nb nc nd ne bi translated">需要规则来保持提交历史的可读性。</li></ul><h1 id="14b3" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="cf82" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">一旦我尝试了 monorepo，就感觉无穷无尽的新机会被打开了。</p><p id="79ea" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我清楚地知道，这样的方法不适合许多团队和项目。同时，我相信有很多团队和项目 monorepo 可能会带来很多好处。</p><p id="93e4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果还没有尝试使用 monorepo，请在评论中分享你的观点。</p><p id="ac75" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">彻尔斯。</p><div class="oa ob gp gr oc od"><a href="https://medium.com/subscribe/@kirichuk" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">每当叶夫根尼·基里丘克发表文章时，就收到一封电子邮件。</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">每当叶夫根尼·基里丘克发表文章时，就收到一封电子邮件。关于 web 开发、生产力、黑客的内容！立即加入！通过签名…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or kp od"/></div></div></a></div></div></div>    
</body>
</html>