<html>
<head>
<title>Relationships in MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB 中的关系</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/relationships-in-mongodb-927b0c24ecd0?source=collection_archive---------4-----------------------#2022-10-31">https://blog.devgenius.io/relationships-in-mongodb-927b0c24ecd0?source=collection_archive---------4-----------------------#2022-10-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/159a990eb207e935a7c4524ea368e64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T3T-wfrUg1s1K3mh.png"/></div></div></figure><p id="2b79" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于 MongoDB 中的关系、方法、关系类型、示例和特性的基本文章。</p><h1 id="8c8c" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">MongoDB 中的关系</h1><p id="2289" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">容易混淆的一个标准是术语非关系数据库或没有关系的 NoSQL，但事实是 MongoDB 几年来一直允许通过一个称为“引用”的概念来实现关系，甚至官方文档也谈到关系数据库中已知的基数和其他特征，区别在于 MongoDB 没有忠实地遵守 er(实体关系)模型和关系数据库的其他特性。</p><h1 id="b7fa" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关系方法</h1><p id="55f4" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">MongoDB 中的关系可以用两种不同的方法建模:嵌入关系或引用关系，这些方法的选择将取决于解决的诡辩类型和数据建模决策。以下是对每种方法的简要描述:</p><ul class=""><li id="218c" class="lw lx in jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me bi translated"><strong class="jx io">嵌入关系</strong>:涉及存储嵌入父文档中的子文档的关系。</li></ul><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/4146e27f0a34924c8f73686ad2a4062a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*3ziEdQ_O1CQ--BKWu-zt8A.png"/></div></div></figure><ul class=""><li id="4622" class="lw lx in jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me bi translated">引用关系:通过引用连接不同集合的关系。通过公共属性或键进行引用。这些引用可以有两种类型；<a class="ae mk" href="https://www.mongodb.com/docs/manual/reference/database-references/#manual-references" rel="noopener ugc nofollow" target="_blank">手动参考</a>或<a class="ae mk" href="https://www.mongodb.com/docs/manual/reference/database-references/#dbrefs" rel="noopener ugc nofollow" target="_blank"> DBRefs </a>。</li></ul><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/b2157e7b2b2aa63a9d84095ec58acf64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SJT9Xrh6OYnE0qZysBp7JQ.png"/></div></div></figure><p id="de62" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些关系可以具有以下类型的基数:</p><ul class=""><li id="fac4" class="lw lx in jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me bi translated">1:1 —一对一。</li><li id="ed39" class="lw lx in jx b jy mm kc mn kg mo kk mp ko mq ks mb mc md me bi translated">1:N —一对多。</li><li id="1e2b" class="lw lx in jx b jy mm kc mn kg mo kk mp ko mq ks mb mc md me bi translated">N:M —多对多。</li></ul><p id="71d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">注意</strong> 🧐:本文将关注与引用的方法和手工类型的关系，对联合使用聚合操作符。</p><h1 id="f07f" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">查找运算符</h1><p id="19eb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">MongoDB 为我们提供的创建文档间关系的工具之一是$lookup 操作符。该操作符旨在使用左外连接方法将信息从一个文档合并到另一个文档。</p><p id="30c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">句法</p><pre class="mg mh mi mj gt mr ms mt mu aw mv bi"><span id="802e" class="mw ku in ms b gy mx my l mz na">{   <br/>  $lookup: {       <br/>    from: &lt;collection to join&gt;,     <br/>    localField: &lt;field from the input documents&gt;,       <br/>    foreignField: &lt;field from "from" collection&gt;,<br/>    as: &lt;output array field&gt;     <br/>  }<br/>}</span></pre><h1 id="ed36" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关系 1:1</h1><p id="ead8" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">通过使用相同值的共享键属性链接来自不同集合的两个文档，可以创建一对一的关系。通常，创建这种关系的最佳方式是让子集合查询第一个集合的键值。ObjectIds 通常用于建立连接，尽管它可以是任何其他类型。</p><pre class="mg mh mi mj gt mr ms mt mu aw mv bi"><span id="6290" class="mw ku in ms b gy mx my l mz na">// Users collection<br/>{<br/>  "_id" : ObjectId("6342ef6f73d381100e27b8e4"),<br/>  "name" : "Juan",<br/>  "age" : 40<br/>}</span><span id="a949" class="mw ku in ms b gy nb my l mz na">// Address collection<br/>{<br/>  "_id" : ObjectId("6342efb173d381100e27b8e5"),<br/>  "street" : "Fifth Avenue",<br/>  "number" : 1421.0,<br/>  "city" : "New York",<br/>  "user_id" : ObjectId("6342ef6f73d381100e27b8e4") <br/>}</span><span id="cd6a" class="mw ku in ms b gy nb my l mz na">// Query<br/>db.getCollection("employees").aggregate({<br/>  $lookup: {<br/>    from: "address",<br/>    localField: "_id",<br/>    foreignField: "user_id",<br/>    as: "address"<br/>  }<br/>})</span><span id="e003" class="mw ku in ms b gy nb my l mz na">// Result<br/>{<br/>  "_id" : ObjectId("6342ef6f73d381100e27b8e4"),<br/>  "name" : "Juan",<br/>  "age" : 40.0,<br/>  "address" : [{<br/>    "_id" : ObjectId("6342efb173d381100e27b8e5"),<br/>    "street" : "Fifth Avenue",<br/>    "number" : 1421.0,<br/>    "city" : "New York",<br/>    "user_id" : ObjectId("6342ef6f73d381100e27b8e4")<br/>  }]<br/>}</span></pre><h1 id="359d" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关系 1:N</h1><p id="3bf4" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">一对多关系是通过将一个集合中的文档链接到另一个集合中的多个文档来创建的。提到这种关系可以通过多种方式实现，但是一种广泛使用的选择是使用递增和可变数组，这将在下面显示。</p><pre class="mg mh mi mj gt mr ms mt mu aw mv bi"><span id="2900" class="mw ku in ms b gy mx my l mz na">// Authors Collection<br/>{<br/>  "_id" : ObjectId("63430b9e73d381100e27b8e9"),<br/>  "name" : "J. K. Rowling",<br/>  "books" : [<br/>     ObjectId("63430b8a73d381100e27b8e7"),<br/>     ObjectId("63430b8a73d381100e27b8e8")<br/>  ]<br/>}</span><span id="f844" class="mw ku in ms b gy nb my l mz na">// Books Collection<br/>{<br/>  "_id" : ObjectId("63430b8a73d381100e27b8e7"),<br/>  "name" : "Philosopher's Stone"<br/>},<br/>{<br/>  "_id" : ObjectId("63430b8a73d381100e27b8e8"),<br/>  "name" : "Chamber of Secrets"<br/>}</span><span id="7bb5" class="mw ku in ms b gy nb my l mz na">// Query<br/>db.getCollection("authors").aggregate({<br/>  $lookup: {<br/>    from: "books",<br/>    localField: "books",<br/>    foreignField: "_id",<br/>    as: "books"<br/>  }<br/>})</span><span id="2581" class="mw ku in ms b gy nb my l mz na">// Result<br/>{<br/>  "_id" : ObjectId("63430b9e73d381100e27b8e9"),<br/>  "name" : "J. K. Rowling",<br/>  "books" : [{<br/>    "_id" : ObjectId("63430b8a73d381100e27b8e7"),<br/>    "name" : "Philosopher's Stone"<br/>  },<br/>  {<br/>    "_id" : ObjectId("63430b8a73d381100e27b8e8"),<br/>    "name" : "Chamber of Secrets"<br/>  }<br/> ]<br/>}</span></pre><h1 id="66e0" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关系 N:M</h1><p id="6fc9" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">多对多关系是通过将一个集合中的多个文档与另一个集合中的多个文档相关联来创建的。同样，为了实现这种关系，使用了几种策略，其中对于示例，我们将继续使用递增和可变矩阵。</p><pre class="mg mh mi mj gt mr ms mt mu aw mv bi"><span id="a755" class="mw ku in ms b gy mx my l mz na">// Orders collection<br/>{<br/>  "_id" : ObjectId("634312b873d381100e27b8ea"),<br/>  "company" : "Microsoft",<br/>  "products" : [<br/>    ObjectId("634312f073d381100e27b8ec"),<br/>    ObjectId("634312f073d381100e27b8ed")<br/>  ]<br/>},<br/>{<br/>  "_id" : ObjectId("634312b873d381100e27b8eb"),<br/>  "company" : "Apple",<br/>  "products" : [<br/>    ObjectId("634312f073d381100e27b8ed")<br/>  ]<br/>}</span><span id="2954" class="mw ku in ms b gy nb my l mz na">// Products collection<br/>{<br/>  "_id" : ObjectId("634312f073d381100e27b8ec"),<br/>  "name" : "Mouse logitech",<br/>  "orders" : [<br/>    ObjectId("634312b873d381100e27b8ea")<br/>  ]<br/>},<br/>{<br/>  "_id" : ObjectId("634312f073d381100e27b8ed"),<br/>  "name" : "Keyboard logitech",<br/>  "orders" : [<br/>    ObjectId("634312b873d381100e27b8ea"),<br/>    ObjectId("634312b873d381100e27b8eb")<br/>  ]<br/>}</span><span id="8ed5" class="mw ku in ms b gy nb my l mz na">// Query( can be queried from both endsm the example only products )<br/>db.getCollection("products").aggregate({<br/>  $lookup: {<br/>   from: "orders",<br/>   localField: "orders",<br/>   foreignField: "_id",<br/>   as: "orders"<br/>  }<br/> }<br/>)</span><span id="2144" class="mw ku in ms b gy nb my l mz na">// Result<br/>{<br/>  "_id" : ObjectId("634312f073d381100e27b8ec"),<br/>  "name" : "Mouse logitech",<br/>  "orders" : [{<br/>    "_id" : ObjectId("634312b873d381100e27b8ea"),<br/>    "company" : "Microsoft",<br/>    "products" : [<br/>      ObjectId("634312f073d381100e27b8ec"),<br/>      ObjectId("634312f073d381100e27b8ed")<br/>     ]<br/>   }<br/> ]<br/>},<br/>{<br/>  "_id" : ObjectId("634312f073d381100e27b8ed"),<br/>  "name" : "Keyboard logitech",<br/>  "orders" : [{<br/>    "_id" : ObjectId("634312b873d381100e27b8ea"),<br/>    "company" : "Microsoft",<br/>    "products" : [<br/>      ObjectId("634312f073d381100e27b8ec"),<br/>      ObjectId("634312f073d381100e27b8ed")<br/>    ]<br/>   },<br/>   {<br/>   "_id" : ObjectId("634312b873d381100e27b8eb"),<br/>   "company" : "Apple",<br/>   "products" : [<br/>     ObjectId("634312f073d381100e27b8ed")<br/>    ]<br/>   }<br/>  ]<br/>}</span></pre><h1 id="7838" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">MongoDB 中的关系资源</h1><ul class=""><li id="a25b" class="lw lx in jx b jy lr kc ls kg nc kk nd ko ne ks mb mc md me bi translated"><a class="ae mk" href="https://www.mongodb.com/docs/manual/applications/data-models/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">MongoDB</strong></a>中的模型数据和模式:结构策略，例子，最常见的模式。</li><li id="b8ed" class="lw lx in jx b jy mm kc mn kg mo kk mp ko mq ks mb mc md me bi translated"><a class="ae mk" href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">$查找运算符</strong> </a>:定义、语法和示例。</li></ul></div><div class="ab cl nf ng hr nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ig ih ii ij ik"><p id="6ee2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢你远道而来，如果你觉得这很有用，别忘了鼓掌👏。订阅以接收更多内容🔔。</p><p id="532c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你需要额外的帮助，请联系我🤠。</p><ul class=""><li id="60b4" class="lw lx in jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me bi translated">✉️ <a class="ae mk" href="mailto:dcortes.net@gmail.com" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">给我发邮件</strong> </a></li><li id="323a" class="lw lx in jx b jy mm kc mn kg mo kk mp ko mq ks mb mc md me bi translated">🤝<a class="ae mk" href="https://www.linkedin.com/in/dcortesnet/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">在 LinkedIn 上联系我</strong> </a></li><li id="cbe1" class="lw lx in jx b jy mm kc mn kg mo kk mp ko mq ks mb mc md me bi translated">📮<a class="ae mk" href="https://twitter.com/dcortes_net" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">在 Twitter 上联系我</strong> </a></li></ul><p id="0dc2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">非常感谢您的阅读，我感谢您的时间。</p></div></div>    
</body>
</html>