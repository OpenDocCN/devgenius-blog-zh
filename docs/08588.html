<html>
<head>
<title>Refresher Project : A glimpse of System Design and Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">复习项目:系统设计和架构一瞥</h1>
<blockquote>原文：<a href="https://blog.devgenius.io/refresher-project-a-glimpse-of-system-design-and-architecture-aaef28510dd4?source=collection_archive---------9-----------------------#2022-06-26">https://blog.devgenius.io/refresher-project-a-glimpse-of-system-design-and-architecture-aaef28510dd4?source=collection_archive---------9-----------------------#2022-06-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9fbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用姜戈、芹菜、格拉夫纳和普罗米修斯来启动你的想法。如果你没有想法，你可以建立一个基础设施来代替！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/1b181bd4fbdc77351d827270ddb33473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*OGgQn1xzHOcvuUhHKaGV6Q.png"/></div></figure><h1 id="92ab" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">介绍</h1><p id="e973" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">你可能在某个笔记本上有很多关于你想开始实施的特定项目的想法。你可能还会一遍又一遍地<em class="lt">谷歌</em>同一套指令，你可能总是会忘记<code class="fe lu lv lw lx b">Dockerfile.</code>中的一些语法</p><p id="2637" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">相反，<em class="lt">你为什么不拥有一个完整的项目，随着你的经验增长而增长，并作为你自己的技术</em> <strong class="jm io"> <em class="lt">更新者</em>。</strong><strong class="jm io"/>进修项目旨在更新技术技能，并创造一个为试验想法和扩展做好准备的环境。这个项目的每个版本都应该介绍一个设计方案。</p><p id="bbec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lt">这是复习者 v1。</em></p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h1 id="dad0" class="kq kr in bd ks kt mf kv kw kx mg kz la lb mh ld le lf mi lh li lj mj ll lm ln bi translated">复习项目</h1><h1 id="b733" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">概观</h1><p id="ecd0" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">Refresher project 是一个完整的基础设施，它包含了服务于一系列任务的不同技术。refresher 项目旨在为这些技术的每个方面创建一个完整的指南，作为启动类似项目的指南或模板。这个项目基本上没有明确的目标，而不是有一个教育管道，既复杂又简单，以深入了解如何开发，阶段，发布和维护项目。</p><h2 id="2dd3" class="mk kr in bd ks ml mm dn kw mn mo dp la jv mp mq le jz mr ms li kd mt mu lm mv bi translated">复习用例</h2><p id="cdea" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">假设您需要一个基于 cronjob(调度)的应用程序，该应用程序在您选择的特定时间间隔执行特定任务<strong class="jm io">和</strong>存储关于这些任务的信息(输出、日志…等)。).此外，您需要根据成功和失败来监控这些任务。您还需要监控您的系统使用、数据库使用和 docker 服务(容器)的健康状况。最后，您需要将所有这些服务可视化，而不是在控制台上查看表格、查询中的大量杂乱数据。尽管如此，您仍然需要公开和安全地提供您的应用程序。</p><p id="6166" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> refresher 项目</strong>是一个 Django 后端，使用 PostgresSQL 数据库和异步任务调度器——celery——使用 Redis 代理。在复习项目中有一个 Django 应用程序叫做<strong class="jm io"> speedtester </strong>应用程序。speedtester 应用程序主要使用 celery workers 每隔特定间隔<strong class="jm io">运行互联网速度测试，并使用 Django 的 ORM 将每次测试的<code class="fe lu lv lw lx b">download</code>、<code class="fe lu lv lw lx b">upload</code>速度和<code class="fe lu lv lw lx b">url</code>存储到 PostgresSQL。使用 celery beat 数据库调度程序，数据库现在保存有关 celery 任务和定义的时间间隔的信息。这意味着您可以简单地通过您的管理门户来指示在您的后端编写的特定任务定期运行。</strong></p><p id="aec9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户使用<strong class="jm io"> Django </strong>管理门户添加周期性任务，这将自动在数据库的指定数据表中添加周期性任务及其定义的时间间隔。celery——异步任务调度程序——有两个主要进程在运行(celery <strong class="jm io"> worker </strong>和 celery <strong class="jm io"> beat </strong>)。使用<code class="fe lu lv lw lx b">django-celery-beat</code>应用程序，在<strong class="jm io"> Django </strong>和<strong class="jm io"> Celery </strong>之间建立了连接，其中<strong class="jm io"> Celery Beat </strong>调度程序进程现在正在寻找存储在数据库中的任务。换句话说，Django 让 celery beat 监视存储在上述指定数据表中的预定任务。然后，Celery beat 收集这些任务，并将它们添加到一个代理(<strong class="jm io"> Redis </strong> ) —内存数据库的时髦说法。Redis 中的那些任务正等待由一个<strong class="jm io">芹菜工人</strong>来完成——负责执行任务单元的进程。最后，任务本身——在本例中是 speedtester 单元——被执行。任务速度测试器单元使用<code class="fe lu lv lw lx b">RefresherSpeedtest()</code>类执行互联网速度测试，并通过<strong class="jm io"> Django 的</strong> ORM 将数据作为 db 条目存储到<strong class="jm io">PostgreSQL</strong>数据库中。现在，工人将任务标记为已完成，并开始处理下一个任务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/e6017e38a61d792a64112ccae92cd26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70BHz00ThzszFscDlBHrog.png"/></div></div></figure><p id="453b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">refresher 项目现在有了一些围绕它构建基础设施的基本想法。</p><ol class=""><li id="4e34" class="nb nc in jm b jn jo jr js jv nd jz ne kd nf kh ng nh ni nj bi translated">一个全功能的 Django 后端</li><li id="3817" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated"><strong class="jm io">异步任务调度器</strong>(基本上管理良好的 cronjobs)</li><li id="dc21" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated">一个<strong class="jm io">PostgreSQL</strong>数据库</li></ol><p id="d8d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">速度测试仪收集每次进行网速测试<code class="fe lu lv lw lx b">apps.speedtester.tasks.process_speedtest</code>的<code class="fe lu lv lw lx b">download</code>、<code class="fe lu lv lw lx b">upload</code>速度和<code class="fe lu lv lw lx b">url</code>。在这样做的时候，它还保留了每个 speedtest 的 ping 服务器的详细信息列表，例如(国家、国家代码、坐标)。所有这些都保存在数据库中，现在<strong class="jm io">需要</strong>——可以——来可视化我们的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi np"><img src="../Images/4381837e4cf48c117f7559fedf85c427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m14mbQB_F2E7QL8UPbtHBg.png"/></div></div></figure><p id="2613" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上图是一个<a class="ae nq" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>仪表盘，显示<code class="fe lu lv lw lx b">speedtester</code>应用程序的数据表。这可以通过将 Grafana 连接到数据库来轻松完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nr"><img src="../Images/959b27e6475648ff9cd1a67c55c70373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8kBgiUWttB-UP2b997pZHA.png"/></div></div></figure></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h1 id="34a9" class="kq kr in bd ks kt mf kv kw kx mg kz la lb mh ld le lf mi lh li lj mj ll lm ln bi translated">技术</h1><h1 id="4682" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">技术堆栈</h1><p id="b95e" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">在本节中，将对 refresher 项目的技术体系进行可视化描述和解释。tech stack 是一个图表，包含了用于构建这个项目的所有组件和工具，不仅仅是技术工具，还有项目管理工具、持续集成(CI)和代码覆盖率。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ns"><img src="../Images/5e912863d2688e39d16304edb9ecfc5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AV8CsOYwYZhZ78nOuF-DtQ.png"/></div></div></figure><h1 id="0bce" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">体系结构</h1><p id="390f" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">refresh project V1 在一台主机(虚拟机)上运行，以简化架构可视化。运行在 Azure 计算虚拟机上，使用 Docker 运行容器。在<strong class="jm io"> <em class="lt"> V2 </em> </strong>及以后的版本中，refresher project 将随着项目的增长而改变其架构。是一个单片单主机项目，使用 dockerized 容器共享同一个网络来服务不同的目的。</p><blockquote class="nt"><p id="a8b1" class="nu nv in bd nw nx ny nz oa ob oc kh dk translated"><em class="od">这里有很多错误，但对于快速启动选项来说，这是可以考虑的。</em></p></blockquote><figure class="of og oh oi oj kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oe"><img src="../Images/5efb66f5f0207bb4cde98c12b48e09a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HtgVHb3H5ar2kWmrJ3Kwzg.png"/></div></div></figure><blockquote class="ok ol om"><p id="bfd2" class="jk jl lt jm b jn jo jp jq jr js jt ju on jw jx jy oo ka kb kc op ke kf kg kh ig bi translated">好吧，让我们来分析一下。refresher 项目有一个附属的子域，即 <code class="fe lu lv lw lx b"><em class="in">speedtester.withnoedge.tech</em></code></p></blockquote><p id="40c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安全 web 应用网关(Secure Web Application Gateway)是一个工具，它封装了运行安全 Web 应用所必需的工具，正如它所说的“设置一个 Nginx web 服务器和反向代理，支持 PHP 和一个内置的 certbot 客户端，自动生成免费的 SSL 服务器证书和更新过程”, SWAG 具有:</p><ol class=""><li id="4caa" class="nb nc in jm b jn jo jr js jv nd jz ne kd nf kh ng nh ni nj bi translated"><a class="ae nq" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank">证书机器人</a></li><li id="66a0" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated"><a class="ae nq" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> NGINX </a></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oq"><img src="../Images/7beb6d93e2648bfaa103364f152d1541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gy-MguzowIUbdwgA"/></div></div></figure><p id="6bd4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">基本上是有主域名<code class="fe lu lv lw lx b">withnoedge.tech</code>附加一个子域<code class="fe lu lv lw lx b">speedtester</code>，所以变成了<code class="fe lu lv lw lx b">speedtester.withnoedge.tech</code>那个<em class="lt">子域</em>现在链接一个<a class="ae nq" href="https://www.cloudflare.com/learning/dns/dns-records/dns-a-record/" rel="noopener ugc nofollow" target="_blank"> <em class="lt">一个 DNS 记录</em> </a>到一个<a class="ae nq" href="https://azure.microsoft.com/en-us/services/virtual-machines/#overview" rel="noopener ugc nofollow" target="_blank"> Azure 虚拟机</a>的<em class="lt">公共 IPV4 </em>地址。之后，每次你<em class="lt">访问</em> <code class="fe lu lv lw lx b">speedtester.withnoedge.tech</code>都会被路由到虚拟机。</p><blockquote class="ok ol om"><p id="1354" class="jk jl lt jm b jn jo jp jq jr js jt ju on jw jx jy oo ka kb kc op ke kf kg kh ig bi translated">你有没有注意到“拜访”这个词是斜体的？</p></blockquote><p id="367f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">嗯，是的。在这里访问一个域名(一个虚拟机)需要被识别——或者为了使这在技术上正确，需要<strong class="jm io">识别</strong>然后<strong class="jm io">路由</strong>。</p><h1 id="99d3" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">应用级公路旅行</h1><p id="8dc1" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">首先，您需要确定需要从您的服务器访问哪些应用程序(您的虚拟机现在是服务器了！)，这里的<a class="ae nq" href="https://www.imperva.com/learn/application-security/osi-model/" rel="noopener ugc nofollow" target="_blank">应用</a>意在描述工具的一般用法(HTTP、ssh、telnet…等)。)—<em class="lt">OSI</em>中的第 7 层——例如，这个项目中的大部分使用将通过 Web 浏览器进行 HTTP(s)请求。我们还需要 SSH 来安全地访问机器的控制台。</p><p id="aee6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其次，您需要将您的应用程序路由到您将主要使用的端口，例如，默认的<code class="fe lu lv lw lx b">HTTPS runs on port 443</code>和<code class="fe lu lv lw lx b">ssh run on port 22</code>。所以简单地说，在本地网络中有一台暴露了<code class="fe lu lv lw lx b">port 22</code>的机器，你现在可以使用你的终端连接到那台机器的控制台，如果你有一个运行在<code class="fe lu lv lw lx b">port 9000</code>上的 web 服务器，你可以简单地在你的浏览器中用<code class="fe lu lv lw lx b">port 9000</code>和<strong class="jm io">写下本地机器的 IP，它就工作了</strong>！</p><p id="0a70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">复杂地说，我们在做同样的事情，但规模更大。</p><p id="5dbd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，同时，<em class="lt"> SWAG </em>负责我们三个主要应用程序的分发、保护和路由。</p><ol class=""><li id="5257" class="nb nc in jm b jn jo jr js jv nd jz ne kd nf kh ng nh ni nj bi translated">姜戈</li><li id="0c5c" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated"><a class="ae nq" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank">格拉夫纳</a></li><li id="1c1e" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated"><a class="ae nq" href="https://flower.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">花</a></li></ol></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><p id="c923" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来:深入介绍我如何设置我的<strong class="jm io">复习项目。</strong></p><div class="or os gp gr ot ou"><a rel="noopener  ugc nofollow" target="_blank" href="/refresher-project-part-2-explaining-how-to-build-a-simple-infrastructure-with-django-celery-ddf7a797c791"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd io gy z fp oz fr fs pa fu fw im bi translated">复习项目—第 2 部分:解释如何用 Django，Celery 构建一个简单的基础设施…</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">深入演练复习项目的主要组件以及如何构建基础架构和系统…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">blog.devgenius.io</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ko ou"/></div></div></a></div><h1 id="a255" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">谢谢！</h1></div></div>    
</body>
</html>